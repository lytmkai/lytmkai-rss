<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å‰ç«¯è½®å­ï¼ˆ1ï¼‰--å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°]]></title>    <link>https://juejin.cn/post/7585706951603601434</link>    <guid>https://juejin.cn/post/7585706951603601434</guid>    <pubDate>2025-12-21T02:18:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951603601434" data-draft-id="7585463258690502665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è½®å­ï¼ˆ1ï¼‰--å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,Node.js"/> <meta itemprop="datePublished" content="2025-12-21T02:18:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°æ˜“"/> <meta itemprop="url" content="https://juejin.cn/user/2032344744857127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è½®å­ï¼ˆ1ï¼‰--å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2032344744857127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°æ˜“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:18:14.000Z" title="Sun Dec 21 2025 02:18:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å‰ç«¯è½®å­ç³»åˆ—ï¼š</p>
<ol>
<li><a href="https://juejin.cn/spost/7585706951603601434" target="_blank" title="https://juejin.cn/spost/7585706951603601434">å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°</a></li>
<li>å¦‚ä½•ä¼˜é›…diyå“åº”æ•°æ®</li>
<li>å¦‚ä½•ä¼˜é›…è¿›è¡Œwebviewè°ƒè¯•</li>
<li>å¦‚ä½•å®ç°æµ‹è¯•ç¯å¢ƒçš„è‡ªåŠ¨ç™»å½•</li>
<li/>
</ol>
</blockquote>
<blockquote>
<p>é¡¹ç›®éƒ¨ç½²åï¼šé€šçŸ¥æ›´æ–°ã€å¼ºåˆ¶åˆ·æ–°ã€è‡ªæµ‹è®¿é—®çš„é¡µé¢ä¸ºæœ€æ–°ä»£ç ï¼ˆæ˜¯å¦å‘ç‰ˆæˆåŠŸï¼‰<br/>
é‡ç‚¹ï¼š<strong>è‡ªæµ‹ã€ææµ‹ã€ä¿®æ”¹bug</strong>åï¼Œç¡®è®¤è®¿é—®çš„ä¸º<strong>æœ€æ–°é¡µé¢</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e5d14d5dcee4533938fe6b167aab982~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5piT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766888338&amp;x-signature=CZ5zNZQsNzIVWwr9mEh1fKlvH6M%3D" alt="check-version.gif" loading="lazy"/></p>
<h2 data-id="heading-0">å®ç°æ€è·¯</h2>
<p>ç›®çš„ï¼šç”Ÿæˆæ–°çš„ç‰ˆæœ¬æ ‡è¯†ï¼Œé€šè¿‡å¯¹æ¯”æ ‡è¯† ==&gt; å½“å‰ä¸ºæœ€æ–° è¿˜æ˜¯ æ—§é¡µé¢</p>
<ol>
<li>ç”Ÿæˆç‰ˆæœ¬å·ï¼šå¦‚ï¼š1.1.10 ï¼Œæˆ–è€…æ—¶é—´æˆ³ï¼ˆ202512201416ï¼‰
<ul>
<li>è‡ªåŠ¨åŒ–è„šæœ¬ç”Ÿæˆ</li>
<li>æ‰‹åŠ¨æ§åˆ¶</li>
</ul>
</li>
<li>å¯¹æ¯”ç‰ˆæœ¬å·ï¼šç›¸ç­‰=&gt; å½“å‰ä¸ºæœ€æ–°ï¼›ä¸ç­‰ =&gt; å½“å‰ä¸ºæ—§é¡µé¢</li>
<li>é€šè¿‡å¯¹æ¯”ç»“æœ å¯¹åº”å¤„ç†äº§å“é€»è¾‘ å®Œäº‹å„¿~</li>
</ol>
<h2 data-id="heading-1">å…·ä½“å®ç°</h2>
<h3 data-id="heading-2">æ–¹æ¡ˆä¸€ï¼šç”Ÿæˆæ—¶é—´æˆ³ï¼Œæ³¨å…¥å˜é‡ï¼Œæ§åˆ¶å°æ‰“å°</h3>
<h4 data-id="heading-3">åœ¨vue-clié¡¹ç›®ä¸­</h4>
<p>é€šè¿‡vue.config.js å…¥å˜é‡<br/>
ç„¶ååœ¨main.jsä¸­æ‰“å°å˜é‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'__BUILD_TIME__'</span>, __BUILD_TIME__)
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vue.config.js</span>
<span class="hljs-keyword">const</span> _date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUILD_TIME</span> = _date.<span class="hljs-property">toLocaleString</span> ? _date.<span class="hljs-title function_">toLocaleString</span>() : _date.<span class="hljs-title function_">getTime</span>()

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">configureWebpack</span>: {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>({
        <span class="hljs-attr">__BUILD_TIME__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable constant_">BUILD_TIME</span>)
      })
    ]
  },
}

</code></pre>
<h4 data-id="heading-4">åœ¨viteé¡¹ç›®ä¸­</h4>
<p>é€šè¿‡vite.config.js æ³¨å…¥ <strong>BUILD_TIME</strong> å˜é‡<br/>
ç„¶ååœ¨main.jsä¸­æ‰“å° <strong>BUILD_TIME</strong> å˜é‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'__BUILD_TIME__'</span>, __BUILD_TIME__)
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">const</span> _date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUILD_TIME</span> = _date.<span class="hljs-property">toLocaleString</span> ? _date.<span class="hljs-title function_">toLocaleString</span>() : _date.<span class="hljs-title function_">getTime</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__BUILD_TIME__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable constant_">BUILD_TIME</span>)
    },
  }
})
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆï¼Œå®ç°äº†åœ¨æ§åˆ¶å°æ‰“å°ã€‚ä½†æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæ— æ³•åšåˆ°ç‰ˆæœ¬å·çš„å¯¹æ¯”<br/>
ä¸ºå•¥ï¼Ÿ å› ä¸ºä¸Šçº¿ ä¸€èˆ¬ä¼šå»æ‰æ—¥å¿—çš„æ‰“å°ï¼Œ æ‰€ä»¥å’±é€šè¿‡ç‰ˆæœ¬å·æ¥~</p>
<h3 data-id="heading-5">æ–¹æ¡ˆäºŒï¼šè®°å½•ç‰ˆæœ¬å·ï¼Œè½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·</h3>
<ol>
<li>ç¼–å†™ç”Ÿæˆç‰ˆæœ¬å·çš„è„šæœ¬ï¼Œç”Ÿæˆç‰ˆæœ¬å·æ–‡ä»¶</li>
<li>buildç»“æŸï¼Œè°ƒç”¨è„šæœ¬å»ç”Ÿæˆç‰ˆæœ¬å·æ–‡ä»¶</li>
<li>è½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·æ–‡ä»¶ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåšç›¸åº”æ“ä½œ</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// dist/version.json</span>
{
  <span class="hljs-string">"buildTime"</span>: <span class="hljs-string">"2025-12-20 14:16:00"</span>
}
</code></pre>
<p><strong>prebuild</strong>: buildå‰æ‰§è¡Œçš„è„šæœ¬<br/>
<strong>postbuild</strong>ï¼šbuildç»“æŸåæ‰§è¡Œçš„è„šæœ¬ï¼Œç”¨äºç”Ÿæˆç‰ˆæœ¬å·æ–‡ä»¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// package.json</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"postbuild"</span>: <span class="hljs-string">"node scripts/generate-version-dist.mjs"</span>
  }
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/generate-version-dist.mjs</span>
<span class="hljs-keyword">import</span> { writeFile } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs/promises'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename)
<span class="hljs-keyword">const</span> root = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'..'</span>)


<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> _date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUILD_TIME</span> = _date.<span class="hljs-property">toLocaleString</span> ? _date.<span class="hljs-title function_">toLocaleString</span>() : _date.<span class="hljs-title function_">getTime</span>()

  <span class="hljs-keyword">const</span> outPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'dist'</span>, <span class="hljs-string">'version.json'</span>)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">writeFile</span>(outPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-variable constant_">BUILD_TIME</span> }, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) + <span class="hljs-string">'\n'</span>, <span class="hljs-string">'utf-8'</span>)

}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[generate-version] failed'</span>, e)
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
})
</code></pre>
<h4 data-id="heading-6">è½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·</h4>
<ol>
<li>è½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·æ–‡ä»¶ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåšç›¸åº”æ“ä½œ</li>
<li>é¡µé¢éšè—ã€åˆ‡åå°æ—¶ï¼Œåœæ­¢è½®è¯¢ï¼Œé¡µé¢å…³é—­æ—¶ï¼Œåœæ­¢è½®è¯¢</li>
<li>é¡µé¢æ˜¾ç¤ºã€åˆ‡å‰å°æ—¶ï¼Œå¼€å§‹è½®è¯¢</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createVersionPoller } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/versionPoller'</span>
<span class="hljs-title function_">createVersionPoller</span>({
  <span class="hljs-attr">versionUrl</span>: <span class="hljs-string">'/version.json'</span>,
  <span class="hljs-attr">storageKey</span>: <span class="hljs-string">'__VERSION_CHECK__CURRENT_BUILD_TIME__'</span>,
  <span class="hljs-attr">intervalMs</span>: <span class="hljs-number">15_000</span>,
  <span class="hljs-attr">maxDelayMs</span>: <span class="hljs-number">60_000</span>,
  <span class="hljs-attr">onResult</span>: <span class="hljs-function">(<span class="hljs-params">{ remoteVersion, remoteBuildTime }</span>) =&gt;</span> {
    <span class="hljs-comment">// è½®è¯¢åˆ°jsonæ–‡ä»¶ æˆåŠŸï¼Œé¢å¤–å¤„ç†é€»è¾‘</span>
  },
  <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-comment">// è½®è¯¢å¤±è´¥ï¼Œé¢å¤–å¤„ç†é€»è¾‘</span>
  },
  <span class="hljs-attr">onUpdate</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œéœ€è¦æ›´æ–°ï¼Œé¢å¤–å¤„ç†é€»è¾‘</span>
  }
}).<span class="hljs-title function_">start</span>()


</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * è½®è¯¢ /version.jsonï¼Œå¯¹æ¯” buildTime åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼ˆsetTimeout + é”™è¯¯æŒ‡æ•°é€€è®©ï¼‰
 *
 * è¡Œä¸ºè¯´æ˜ï¼š
 * - start() ä¼šè‡ªåŠ¨æ³¨å†Œç›‘å¬ï¼švisibilitychange / beforeunload / unload
 * - stop() ä¼šæ¸…ç†å®šæ—¶å™¨å¹¶å¸è½½ç›‘å¬
 * - è¯·æ±‚å¤±è´¥ä¼šæŒ‡æ•°é€€è®©ï¼ˆdelay *= 2ï¼Œæœ€å¤§ä¸è¶…è¿‡ maxDelayMsï¼‰ï¼›æˆåŠŸåæ¢å¤ intervalMs
 * - currentBuildTime ä¼šå†™å…¥ localStorageï¼ˆstorageKeyï¼‰
 *
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.versionUrl='/version.json'] ç‰ˆæœ¬æ–‡ä»¶åœ°å€
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.storageKey='__VERSION_CHECK__CURRENT_BUILD_TIME__'] localStorage key
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} [options.intervalMs=15000] æ­£å¸¸è½®è¯¢é—´éš”ï¼ˆæ¯«ç§’ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} [options.maxDelayMs=60000] é€€è®©æœ€å¤§é—´éš”ï¼ˆæ¯«ç§’ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">(info:{localBuildTime:string,remoteBuildTime:string,remoteVersion:string,data:any</span>})=&gt;void} [options.onResult] æ¯æ¬¡æˆåŠŸæ‹‰å–åçš„å›è°ƒ
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">(error:any)=&gt;void</span>} [options.onError] æ‹‰å–å¤±è´¥å›è°ƒ
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">(info:{localBuildTime:string,remoteBuildTime:string,remoteVersion:string,data:any</span>})=&gt;void} [options.onUpdate] å‘ç°æ–° buildTime æ—¶å›è°ƒï¼ˆé»˜è®¤ä¼š stopï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createVersionPoller</span>(<span class="hljs-params">{
  versionUrl = <span class="hljs-string">'/version.json'</span>,
  storageKey = <span class="hljs-string">'__VERSION_CHECK__CURRENT_BUILD_TIME__'</span>,
  intervalMs = <span class="hljs-number">15000</span>,
  maxDelayMs = <span class="hljs-number">60000</span>,
  onResult,
  onError,
  onUpdate
} = {}</span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> stopped = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">let</span> delayMs = intervalMs
  <span class="hljs-keyword">let</span> bound = <span class="hljs-literal">false</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">readLocal</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(storageKey) || <span class="hljs-string">''</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">writeLocal</span> = (<span class="hljs-params">v</span>) =&gt; v &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(storageKey, <span class="hljs-title class_">String</span>(v))

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!timer) <span class="hljs-keyword">return</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">clearTimeout</span>(timer)
    timer = <span class="hljs-literal">null</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">isVisible</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-property">visibilityState</span> !== <span class="hljs-string">'hidden'</span>
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchRemote</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> sep = versionUrl.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>) ? <span class="hljs-string">'&amp;'</span> : <span class="hljs-string">'?'</span>
    <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${versionUrl}</span><span class="hljs-subst">${sep}</span>t=<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, { <span class="hljs-attr">cache</span>: <span class="hljs-string">'no-store'</span>, <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span> } })
    <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`fetch <span class="hljs-subst">${versionUrl}</span> failed: <span class="hljs-subst">${res.status}</span>`</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">tick</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (stopped || !<span class="hljs-title function_">isVisible</span>()) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">const</span> localBuildTime = <span class="hljs-title function_">readLocal</span>() || <span class="hljs-string">''</span>

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchRemote</span>()
      <span class="hljs-keyword">const</span> remoteVersion = <span class="hljs-title class_">String</span>(data?.<span class="hljs-property">version</span> || <span class="hljs-string">''</span>)
      <span class="hljs-keyword">const</span> remoteBuildTime = <span class="hljs-title class_">String</span>(data?.<span class="hljs-property">BUILD_TIME</span> || <span class="hljs-string">''</span>)

      delayMs = intervalMs
      onResult?.({ localBuildTime, remoteBuildTime, remoteVersion, data })

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( remoteBuildTime , <span class="hljs-string">'=&gt;'</span>, localBuildTime)

      <span class="hljs-keyword">if</span> (remoteBuildTime &amp;&amp; remoteBuildTime !== localBuildTime) {
        <span class="hljs-comment">// è®°å½•æœ€æ–° buildTimeï¼Œé¿å…é‡å¤æç¤ºåŒä¸€ä¸ªæ›´æ–°</span>
        <span class="hljs-title function_">writeLocal</span>(remoteBuildTime)
        onUpdate?.({ localBuildTime, remoteBuildTime, remoteVersion, data })
      }
    } <span class="hljs-keyword">catch</span> (e) {
      delayMs = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxDelayMs, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">500</span>, delayMs * <span class="hljs-number">2</span>))
      onError?.(e)
    }

    timer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(tick, delayMs)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onVisibilityChange</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (stopped) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isVisible</span>()) <span class="hljs-keyword">return</span> <span class="hljs-title function_">clear</span>()
    <span class="hljs-title function_">clear</span>()
    timer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(tick, <span class="hljs-number">0</span>)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureBound</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (bound) <span class="hljs-keyword">return</span>
    bound = <span class="hljs-literal">true</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, onVisibilityChange)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, stop)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unload'</span>, stop)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureUnbound</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!bound) <span class="hljs-keyword">return</span>
    bound = <span class="hljs-literal">false</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, onVisibilityChange)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'beforeunload'</span>, stop)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'unload'</span>, stop)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!stopped) <span class="hljs-keyword">return</span>
    stopped = <span class="hljs-literal">false</span>
    delayMs = intervalMs
    <span class="hljs-title function_">ensureBound</span>()
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isVisible</span>()) timer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(tick, <span class="hljs-number">0</span>)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    stopped = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">clear</span>()
    <span class="hljs-title function_">ensureUnbound</span>()
  }

  <span class="hljs-keyword">return</span> { start, stop }
}

</code></pre>
<h2 data-id="heading-7">æ³¨æ„ç‚¹</h2>
<ul>
<li>è½®è¯¢ç‰ˆæœ¬æ–‡ä»¶ï¼Œæ‹¼ æ—¶é—´æˆ³ã€è®¾ç½®è¯·æ±‚å¤´ é¿å…å‘½ä¸­ç¼“å­˜</li>
<li>è½®è¯¢ç‰ˆæœ¬æ–‡ä»¶ï¼Œæ—¶é—´é—´éš”ä¸è¦å¤ªçŸ­ï¼Œè€—è´¹ç½‘ç»œï¼Œè™½ç„¶å·²ç»åšäº†è½®è¯¢æŒ‡æ•°é€€è®©</li>
<li>ç”Ÿæˆçš„ç‰ˆæœ¬æ–‡ä»¶ ç”Ÿæˆåˆ°distä¸‹ æ³¨æ„è®¿é—®è·¯å¾„</li>
<li>ç‰ˆæœ¬å·éœ€è¦ä¸Šä¼ åˆ°gitï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬&amp;commit + push</li>
</ul>
<h2 data-id="heading-8">æºç </h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoyi1255%2Fversion-check" target="_blank" title="https://github.com/xiaoyi1255/version-check" ref="nofollow noopener noreferrer">xiaoyi1255</a></p>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ”¶è·ï¼Œéº»çƒ¦åŠ¨åŠ¨å‘è´¢çš„å°æ‰‹ï¼Œç‚¹ç‚¹å…³æ³¨ã€ç‚¹ç‚¹èµï¼ï¼ï¼ğŸ‘»ğŸ‘»ğŸ‘»</p>
<p>å› ä¸ºæ”¶è—===ä¼šäº†</p>
<p>å¦‚æœæœ‰ä¸å¯¹ã€æ›´å¥½çš„æ–¹å¼å®ç°ã€å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œè°¢è°¢ğŸ‘¾ğŸ‘¾ğŸ‘¾</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[G1ä¸ZGCåƒåœ¾æ”¶é›†å™¨æ·±åº¦å‰–æ]]></title>    <link>https://juejin.cn/post/7585474459776696356</link>    <guid>https://juejin.cn/post/7585474459776696356</guid>    <pubDate>2025-12-20T10:26:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776696356" data-draft-id="7585474459776679972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="G1ä¸ZGCåƒåœ¾æ”¶é›†å™¨æ·±åº¦å‰–æ"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-20T10:26:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            G1ä¸ZGCåƒåœ¾æ”¶é›†å™¨æ·±åº¦å‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T10:26:21.000Z" title="Sat Dec 20 2025 10:26:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»33åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>G1å’ŒZGCæ˜¯ç°ä»£Javaåº”ç”¨çš„é¦–é€‰åƒåœ¾æ”¶é›†å™¨,ä»£è¡¨äº†GCæŠ€æœ¯çš„æ¼”è¿›æ–¹å‘ã€‚G1é€šè¿‡Regionåˆ†åŒºå’Œå¯é¢„æµ‹åœé¡¿,åœ¨JDK 9åæˆä¸ºé»˜è®¤æ”¶é›†å™¨,é€‚åˆ4GBä»¥ä¸Šå †å†…å­˜ã€è¿½æ±‚å¹³è¡¡æ€§èƒ½çš„åº”ç”¨;ZGCåˆ™é€šè¿‡æŸ“è‰²æŒ‡é’ˆå’Œå¹¶å‘é‡å®šä½æŠ€æœ¯,å®ç°æ¥è¿‘é›¶åœé¡¿(&lt; 10ms),ä¸“ä¸ºè¶…å¤§å †(TBçº§)å’Œæä½å»¶è¿Ÿåœºæ™¯è®¾è®¡ã€‚æœ¬æ–‡ä»ç†è®ºåˆ°å®æˆ˜,æ·±åº¦å‰–æä¸¤è€…çš„æ ¸å¿ƒåŸç†(Regionè®¾è®¡ã€RSetã€SATBã€æŸ“è‰²æŒ‡é’ˆã€å¤šé‡æ˜ å°„)ã€GCæµç¨‹ã€å‚æ•°è°ƒä¼˜,å¹¶é€šè¿‡ç”Ÿäº§æ¡ˆä¾‹å¯¹æ¯”åˆ†æ,å¸®åŠ©è¯»è€…åœ¨å®é™…é¡¹ç›®ä¸­é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨,æŒæ¡æ€§èƒ½è°ƒä¼˜æŠ€å·§ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç†è®ºèƒŒæ™¯ä¸æ¼”è¿›</h2>
<h3 data-id="heading-2">1.1 ä¼ ç»ŸGCçš„ç—›ç‚¹</h3>
<p>åœ¨G1å’ŒZGCå‡ºç°ä¹‹å‰,Javaåº”ç”¨ä¸»è¦ä½¿ç”¨Serialã€Parallelå’ŒCMSæ”¶é›†å™¨ã€‚è¿™äº›ä¼ ç»ŸGCå­˜åœ¨æ˜¾è‘—ç—›ç‚¹:</p>
<p><strong>Serial GC (ä¸²è¡Œæ”¶é›†å™¨)</strong>:</p>
<ul>
<li>å•çº¿ç¨‹æ”¶é›†,Stop-The-Worldæ—¶é—´é•¿</li>
<li>é€‚ç”¨åœºæ™¯: Clientæ¨¡å¼,å•æ ¸CPUç¯å¢ƒ</li>
<li>ç—›ç‚¹: ç”Ÿäº§ç¯å¢ƒä¸å¯æ¥å—,åœé¡¿æ—¶é—´è¾¾ç§’çº§</li>
</ul>
<p><strong>Parallel GC (å¹¶è¡Œæ”¶é›†å™¨)</strong>:</p>
<ul>
<li>å¤šçº¿ç¨‹å¹¶è¡Œ,ååé‡ä¼˜å…ˆ</li>
<li>é€‚ç”¨åœºæ™¯: åå°è®¡ç®—,æ‰¹å¤„ç†ä»»åŠ¡</li>
<li>ç—›ç‚¹: Full GCæ—¶STWæ—¶é—´é•¿,å †è¶Šå¤§åœé¡¿è¶Šä¹…(8GBå †å¯è¾¾2-5ç§’)</li>
</ul>
<p><strong>CMS GC (å¹¶å‘æ ‡è®°æ¸…é™¤)</strong>:</p>
<ul>
<li>ä½å»¶è¿Ÿ,å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ</li>
<li>é€‚ç”¨åœºæ™¯: äº’è”ç½‘åº”ç”¨,è¦æ±‚ä½åœé¡¿</li>
<li>ç—›ç‚¹:
<ul>
<li><strong>CPUæ•æ„Ÿ</strong>: å¹¶å‘é˜¶æ®µå ç”¨CPU,é™ä½ååé‡</li>
<li><strong>æµ®åŠ¨åƒåœ¾</strong>: å¹¶å‘æ¸…é™¤æ—¶äº§ç”Ÿçš„æ–°åƒåœ¾æ— æ³•å›æ”¶</li>
<li><strong>å†…å­˜ç¢ç‰‡</strong>: æ ‡è®°-æ¸…é™¤ç®—æ³•,ä¸æ•´ç†ç¢ç‰‡,å¯èƒ½æå‰è§¦å‘Full GC</li>
<li><strong>Concurrent Mode Failure</strong>: å¹¶å‘æ ‡è®°æœªå®Œæˆè€å¹´ä»£å·²æ»¡,é€€åŒ–ä¸ºSerial Old,åœé¡¿æ—¶é—´æ›´é•¿</li>
</ul>
</li>
</ul>
<p><strong>æ ¸å¿ƒçŸ›ç›¾</strong>:</p>
<p>ä¼ ç»ŸGCé¢ä¸´"ä¸å¯èƒ½ä¸‰è§’":</p>
<ul>
<li><strong>ååé‡</strong> (Throughput): è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´å æ¯”</li>
<li><strong>å»¶è¿Ÿ</strong> (Latency): GCåœé¡¿æ—¶é—´</li>
<li><strong>å †å¤§å°</strong> (Heap Size): æ”¯æŒçš„æœ€å¤§å †å†…å­˜</li>
</ul>
<p>ä¼ ç»ŸGCåªèƒ½åœ¨ä¸‰è€…ä¸­é€‰æ‹©ä¸¤ä¸ª,æ— æ³•å…¼é¡¾ã€‚ä¾‹å¦‚:</p>
<ul>
<li>Parallel GC: é«˜ååé‡ + æ”¯æŒå¤§å †,ä½†å»¶è¿Ÿé«˜</li>
<li>CMS: ä½å»¶è¿Ÿ + æ”¯æŒä¸­ç­‰å †,ä½†ååé‡ä¸‹é™ä¸”æœ‰ç¢ç‰‡é—®é¢˜</li>
</ul>
<h3 data-id="heading-3">1.2 G1çš„è¯ç”ŸèƒŒæ™¯</h3>
<p><strong>G1 (Garbage-First)</strong> äºJDK 7å¼•å…¥,JDK 9æˆä¸ºé»˜è®¤æ”¶é›†å™¨,ç›®æ ‡æ˜¯æ‰“ç ´ä¼ ç»ŸGCçš„é™åˆ¶:</p>
<p><strong>è®¾è®¡ç›®æ ‡</strong>:</p>
<ol>
<li><strong>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´</strong>: é€šè¿‡<code>-XX:MaxGCPauseMillis</code>è®¾ç½®åœé¡¿ç›®æ ‡(è½¯ç›®æ ‡)</li>
<li><strong>é€‚åº”å¤§å †</strong>: æ”¯æŒå‡ åGBå †,Full GCæ—¶é—´å¯æ§</li>
<li><strong>å¹³è¡¡ååé‡å’Œå»¶è¿Ÿ</strong>: ä¸ç‰ºç‰²å¤ªå¤šååé‡çš„å‰æä¸‹,é™ä½åœé¡¿æ—¶é—´</li>
</ol>
<p><strong>æ ¸å¿ƒåˆ›æ–°</strong>:</p>
<ul>
<li><strong>Regionåˆ†åŒº</strong>: å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Region,ä¸å†å›ºå®šåˆ†ä»£è¾¹ç•Œ</li>
<li><strong>Garbage-Firstç­–ç•¥</strong>: ä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„Region,åœ¨åœé¡¿æ—¶é—´å…è®¸èŒƒå›´å†…æœ€å¤§åŒ–å›æ”¶æ•ˆæœ</li>
<li><strong>å¢é‡å›æ”¶</strong>: æ¯æ¬¡åªå›æ”¶éƒ¨åˆ†Region,é¿å…å…¨å †æ‰«æ</li>
</ul>
<h3 data-id="heading-4">1.3 ZGCçš„è¯ç”ŸèƒŒæ™¯</h3>
<p><strong>ZGC (Z Garbage Collector)</strong> äºJDK 11å¼•å…¥(å®éªŒæ€§),JDK 15è½¬æ­£,ç›®æ ‡æ˜¯å®ç°è¶…ä½å»¶è¿Ÿ:</p>
<p><strong>è®¾è®¡ç›®æ ‡</strong>:</p>
<ol>
<li><strong>æä½åœé¡¿</strong>: åœé¡¿æ—¶é—´ &lt; 10ms,ä¸å †å¤§å°æ— å…³</li>
<li><strong>æ”¯æŒè¶…å¤§å †</strong>: 4TBä»¥ä¸Šå †,åœé¡¿æ—¶é—´ä¾ç„¶åœ¨10msä»¥å†…</li>
<li><strong>é«˜ååé‡</strong>: åœé¡¿æ—¶é—´é™ä½çš„åŒæ—¶,ååé‡æŸå¤±æ§åˆ¶åœ¨15%ä»¥å†…</li>
</ol>
<p><strong>æ ¸å¿ƒåˆ›æ–°</strong>:</p>
<ul>
<li><strong>æŸ“è‰²æŒ‡é’ˆ</strong> (Colored Pointers): å°†GCä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­,è€Œä¸æ˜¯å¯¹è±¡å¤´</li>
<li><strong>è¯»å±éšœ</strong> (Load Barrier): å¯¹è±¡è®¿é—®æ—¶é€šè¿‡è¯»å±éšœè‡ªåŠ¨å¤„ç†é‡å®šä½</li>
<li><strong>å¹¶å‘é‡å®šä½</strong>: å¯¹è±¡ç§»åŠ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ,æ— éœ€STW</li>
<li><strong>å¤šé‡æ˜ å°„</strong>: åŒä¸€ç‰©ç†å†…å­˜æ˜ å°„åˆ°å¤šä¸ªè™šæ‹Ÿåœ°å€,å®ç°å¹¶å‘å®‰å…¨</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ä½å»¶è¿Ÿè¦æ±‚æé«˜çš„åº”ç”¨ (é‡‘èäº¤æ˜“ã€å®æ—¶ç³»ç»Ÿ)</li>
<li>è¶…å¤§å †å†…å­˜åº”ç”¨ (å‡ åGBåˆ°TBçº§)</li>
<li>è¿½æ±‚æè‡´ç”¨æˆ·ä½“éªŒçš„äº’è”ç½‘åº”ç”¨</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€G1åƒåœ¾æ”¶é›†å™¨åŸç†</h2>
<h3 data-id="heading-6">2.1 G1çš„æ•´ä½“æ¶æ„</h3>
<p>G1çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯"åŒ–æ•´ä¸ºé›¶",å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªRegion,æ‰“ç ´ä¼ ç»Ÿåˆ†ä»£GCçš„å›ºå®šè¾¹ç•Œã€‚</p>
<h4 data-id="heading-7">2.1.1 Regionåˆ†åŒºè®¾è®¡</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1854670ba37c4decbceda4d0454108d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=lJK%2FJIW3pJkAJ4CHeSg6SoL3dQ4%3D" alt="g1-region-structure.svg" loading="lazy"/></p>
<p><strong>Regionæ˜¯G1çš„åŸºæœ¬å•ä½</strong>:</p>
<ul>
<li>å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Region(é»˜è®¤2048ä¸ª)</li>
<li>Regionå¤§å° = å †å¤§å° / 2048 (å‘ä¸Šå–2çš„å¹‚)</li>
<li>èŒƒå›´: 1MB ~ 32MB,å¿…é¡»æ˜¯2çš„å¹‚</li>
</ul>
<p><strong>Regionå¤§å°è®¡ç®—ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">å †8GB:  Regionå¤§å° = 8GB / 2048 â‰ˆ 4MB
å †16GB: Regionå¤§å° = 16GB / <span class="hljs-attr">2048</span> = <span class="hljs-number">8</span>MB
å †32GB: Regionå¤§å° = 32GB / <span class="hljs-attr">2048</span> = <span class="hljs-number">16</span>MB
</code></pre>
<p><strong>æ‰‹åŠ¨è®¾ç½®Regionå¤§å°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">-XX:G1HeapRegionSize=8m  <span class="hljs-comment"># è®¾ç½®Regionå¤§å°ä¸º8MB</span>
</code></pre>
<p><strong>Regionç±»å‹</strong>:</p>
<p>G1ä¸­çš„Regionå¯ä»¥åŠ¨æ€åˆ†é…ä¸ºä¸åŒç±»å‹:</p>
<ol>
<li>
<p><strong>Eden Region (EdenåŒº)</strong>:</p>
<ul>
<li>æ–°å¯¹è±¡åˆ†é…çš„åŒºåŸŸ</li>
<li>Young GCæ—¶å…¨éƒ¨æ¸…ç©º</li>
</ul>
</li>
<li>
<p><strong>Survivor Region (SurvivoråŒº)</strong>:</p>
<ul>
<li>Young GCåå­˜æ´»å¯¹è±¡çš„åŒºåŸŸ</li>
<li>é‡‡ç”¨å¤åˆ¶ç®—æ³•,From/Toè§’è‰²äº’æ¢</li>
</ul>
</li>
<li>
<p><strong>Old Region (è€å¹´ä»£åŒº)</strong>:</p>
<ul>
<li>å­˜æ”¾æ™‹å‡å¯¹è±¡</li>
<li>Mixed GCæ—¶éƒ¨åˆ†å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>Humongous Region (å¤§å¯¹è±¡åŒº)</strong>:</p>
<ul>
<li>å­˜æ”¾å¤§å¯¹è±¡(â‰¥ Regionå¤§å°çš„50%)</li>
<li>å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</li>
<li>å¯èƒ½è·¨è¶Šå¤šä¸ªè¿ç»­Region</li>
</ul>
</li>
<li>
<p><strong>Free Region (ç©ºé—²åŒº)</strong>:</p>
<ul>
<li>æœªåˆ†é…çš„Region</li>
<li>å¯éšæ—¶åˆ†é…ä¸ºä»»ä½•ç±»å‹</li>
</ul>
</li>
</ol>
<p><strong>åŠ¨æ€åˆ†é…çš„ä¼˜åŠ¿</strong>:</p>
<p>ä¼ ç»Ÿåˆ†ä»£GCä¸­,æ–°ç”Ÿä»£å’Œè€å¹´ä»£æœ‰å›ºå®šè¾¹ç•Œ:</p>
<pre><code class="hljs language-ini" lang="ini">ä¼ ç»ŸGC: <span class="hljs-section">[æ–°ç”Ÿä»£ | è€å¹´ä»£]</span>  â† å›ºå®šè¾¹ç•Œ,æ— æ³•åŠ¨æ€è°ƒæ•´
</code></pre>
<p>G1ä¸­,Regionå¯ä»¥åŠ¨æ€åˆ†é…:</p>
<pre><code class="hljs language-ini" lang="ini">G1: <span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[S]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span>  â† E/S/Oå¯ä»¥åŠ¨æ€è°ƒæ•´
</code></pre>
<ul>
<li>æ ¹æ®<code>MaxGCPauseMillis</code>ç›®æ ‡,G1è‡ªåŠ¨è°ƒæ•´æ–°ç”Ÿä»£å¤§å°</li>
<li>æ–°ç”Ÿä»£Regionæ•°é‡åœ¨5%-60%ä¹‹é—´åŠ¨æ€å˜åŒ–</li>
<li>é¿å…å›ºå®šè¾¹ç•Œå¯¼è‡´çš„ç©ºé—´æµªè´¹</li>
</ul>
<h4 data-id="heading-8">2.1.2 Remembered Set (RSet)</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b6717abccd47dc8ee071f028144404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=n%2FfaoyQqWQsVQJJL5jh%2BHfJGpEM%3D" alt="g1-rset-structure.svg" loading="lazy"/></p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦RSet?</strong></p>
<p>Young GCæ—¶,éœ€è¦çŸ¥é“å“ªäº›è€å¹´ä»£å¯¹è±¡å¼•ç”¨äº†å¹´è½»ä»£å¯¹è±¡ã€‚ä¼ ç»Ÿåšæ³•æ˜¯å…¨å †æ‰«æ,æ•ˆç‡æä½ã€‚G1é€šè¿‡RSetè®°å½•å¤–éƒ¨Regionå¯¹æœ¬Regionçš„å¼•ç”¨ã€‚</p>
<p><strong>RSetç»“æ„</strong>:</p>
<p>æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªRSet,è®°å½•å“ªäº›Regionå¼•ç”¨äº†æœ¬Regionä¸­çš„å¯¹è±¡:</p>
<pre><code class="hljs language-css" lang="css">Region <span class="hljs-selector-tag">A</span>çš„RSet: {Region <span class="hljs-selector-tag">B</span>, Region C}
// è¡¨ç¤ºRegion <span class="hljs-selector-tag">B</span>å’ŒRegion Cä¸­çš„å¯¹è±¡å¼•ç”¨äº†Region <span class="hljs-selector-tag">A</span>ä¸­çš„å¯¹è±¡
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>å‡è®¾æœ‰3ä¸ªRegion:</p>
<ul>
<li>Region A (Old): åŒ…å«å¯¹è±¡A1ã€A2</li>
<li>Region B (Eden): åŒ…å«å¯¹è±¡B1ã€B2</li>
<li>Region C (Old): åŒ…å«å¯¹è±¡C1ã€C2</li>
</ul>
<p>å¼•ç”¨å…³ç³»:</p>
<ul>
<li>A1 â†’ B1 (è€å¹´ä»£å¼•ç”¨å¹´è½»ä»£)</li>
<li>A2 â†’ B2</li>
</ul>
<p>åˆ™Region Bçš„RSetè®°å½•: <code>{Region A}</code></p>
<p><strong>Young GCæ—¶ä½¿ç”¨RSet</strong>:</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. è¦å›æ”¶Region <span class="hljs-selector-tag">B</span> (EdenåŒº)
<span class="hljs-number">2</span>. æŸ¥çœ‹Region <span class="hljs-selector-tag">B</span>çš„RSet: {Region <span class="hljs-selector-tag">A</span>}
<span class="hljs-number">3</span>. åªéœ€æ‰«æRegion <span class="hljs-selector-tag">A</span>ä¸­çš„å¯¹è±¡,æ‰¾å‡ºå¯¹Region <span class="hljs-selector-tag">B</span>çš„å¼•ç”¨
<span class="hljs-number">4</span>. æ— éœ€æ‰«ææ•´ä¸ªè€å¹´ä»£,å¤§å¹…æå‡æ•ˆç‡
</code></pre>
<p><strong>å†™å±éšœç»´æŠ¤RSet</strong>:</p>
<p>æ¯æ¬¡å¼•ç”¨æ›´æ–°æ—¶,JVMæ’å…¥å†™å±éšœä»£ç ,ç»´æŠ¤RSet:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç : G1çš„å†™å±éšœ</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">oop_field_store</span><span class="hljs-params">(oop* field, oop new_value)</span> {
  <span class="hljs-comment">// 1. å‰ç½®å†™å±éšœ (SATB,è®°å½•æ—§å€¼,ä¸‹æ–‡è¯¦è¿°)</span>
  pre_write_barrier(field);

  <span class="hljs-comment">// 2. å®é™…çš„å¼•ç”¨æ›´æ–°</span>
  *field = new_value;

  <span class="hljs-comment">// 3. åç½®å†™å±éšœ (ç»´æŠ¤RSet)</span>
  <span class="hljs-keyword">if</span> (is_in_young(new_value) &amp;&amp; is_in_old(field)) {
    <span class="hljs-comment">// è€å¹´ä»£å¯¹è±¡å¼•ç”¨å¹´è½»ä»£å¯¹è±¡</span>
    Region* young_region = get_region(new_value);
    Region* old_region = get_region(field);
    <span class="hljs-comment">// å°†old_regionæ·»åŠ åˆ°young_regionçš„RSet</span>
    young_region-&gt;rset-&gt;add(old_region);
  }
}
</code></pre>
<p><strong>å¡è¡¨(Card Table)å®ç°ç»†èŠ‚</strong>:</p>
<p>RSetçš„åº•å±‚å®ç°ä½¿ç”¨å¡è¡¨(Card Table):</p>
<ul>
<li>å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªCard(é»˜è®¤512å­—èŠ‚)</li>
<li>æ¯ä¸ªCardå¯¹åº”ä¸€ä¸ªå­—èŠ‚çš„æ ‡è®°ä½</li>
<li>å¼•ç”¨å˜åŒ–æ—¶,æ ‡è®°å¯¹åº”Cardä¸º"è„"</li>
<li>RSetè®°å½•çš„æ˜¯Cardçš„é›†åˆ,è€Œä¸æ˜¯å…·ä½“å¯¹è±¡</li>
<li>Young GCæ—¶,åªéœ€æ‰«æRSetä¸­æ ‡è®°ä¸º"è„"çš„Card</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">Regionå†…çš„å¡è¡¨: <span class="hljs-section">[0]</span><span class="hljs-section">[1]</span><span class="hljs-section">[0]</span><span class="hljs-section">[1]</span><span class="hljs-section">[0]</span>
                  â†‘  â†‘  â†‘  â†‘  â†‘
               å¹²å‡€ è„ å¹²å‡€ è„ å¹²å‡€
</code></pre>
<p><strong>RSetçš„ä¼˜åŠ¿ä¸ä»£ä»·</strong>:</p>
<p>ä¼˜åŠ¿:</p>
<ul>
<li>Young GCæ— éœ€å…¨å †æ‰«æ,åªæ‰«æRSetè®°å½•çš„Region</li>
<li>å¤§å¹…æå‡Young GCé€Ÿåº¦</li>
<li>æ”¯æŒéƒ¨åˆ†å›æ”¶(åªå›æ”¶éƒ¨åˆ†Region)</li>
</ul>
<p>ä»£ä»·:</p>
<ul>
<li>RSetå ç”¨é¢å¤–å†…å­˜(çº¦å †å¤§å°çš„5-10%)</li>
<li>å†™å±éšœå¸¦æ¥é¢å¤–CPUå¼€é”€</li>
<li>æ¯æ¬¡å¼•ç”¨æ›´æ–°éƒ½éœ€è¦ç»´æŠ¤RSet</li>
</ul>
<h3 data-id="heading-9">2.2 G1çš„åƒåœ¾å›æ”¶æµç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c6de1f77fc44246bad6faf842d12947~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=AX10mOz%2FGYPZEo0S%2BhXLISxSoY4%3D" alt="g1-gc-flow.svg" loading="lazy"/></p>
<p>G1çš„GCæµç¨‹åŒ…æ‹¬ä¸‰ç§ç±»å‹:Young GCã€Mixed GCå’ŒFull GCã€‚</p>
<h4 data-id="heading-10">2.2.1 Young GC (çº¯å¹´è½»ä»£å›æ”¶)</h4>
<p><strong>è§¦å‘æ¡ä»¶</strong>: Eden Regionæ»¡</p>
<p><strong>å›æ”¶è¿‡ç¨‹</strong> (STWåœé¡¿):</p>
<ol>
<li><strong>æš‚åœåº”ç”¨çº¿ç¨‹</strong> (STWå¼€å§‹)</li>
<li><strong>æ‰«æGC Roots</strong>: çº¿ç¨‹æ ˆã€å…¨å±€å˜é‡ã€JNIå¥æŸ„ç­‰</li>
<li><strong>æ‰«æRSet</strong>: æ‰¾å‡ºè€å¹´ä»£Regionå¯¹å¹´è½»ä»£çš„å¼•ç”¨</li>
<li><strong>å¤åˆ¶å­˜æ´»å¯¹è±¡</strong>:
<ul>
<li>Edenå’ŒSurvivorä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Survivor Region</li>
<li>å¹´é¾„è¾¾åˆ°é˜ˆå€¼(é»˜è®¤15)çš„å¯¹è±¡æ™‹å‡åˆ°Old Region</li>
</ul>
</li>
<li><strong>æ¸…ç©ºEden</strong>: æ‰€æœ‰Eden Regionæ ‡è®°ä¸ºç©ºé—²</li>
<li><strong>æ¢å¤åº”ç”¨çº¿ç¨‹</strong> (STWç»“æŸ)</li>
</ol>
<p><strong>åœé¡¿æ—¶é—´</strong>: 20-100ms (å–å†³äºå †å¤§å°å’Œå­˜æ´»å¯¹è±¡æ•°é‡)</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">GCå‰:
<span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[S]</span><span class="hljs-section">[S]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span>
 â†‘  â†‘  â†‘  â†‘  â†‘  â†‘
Edenæ»¡,è§¦å‘Young GC

GCå:
<span class="hljs-section">[F]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span><span class="hljs-section">[S]</span><span class="hljs-section">[S]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span>
                â†‘  â†‘  â†‘
          æ–°çš„Survivor, éƒ¨åˆ†æ™‹å‡åˆ°Old
</code></pre>
<h4 data-id="heading-11">2.2.2 Mixed GC (æ··åˆå›æ”¶)</h4>
<p><strong>è§¦å‘æ¡ä»¶</strong>:</p>
<ol>
<li>å¹¶å‘æ ‡è®°å‘¨æœŸå®Œæˆ</li>
<li>è€å¹´ä»£ä½¿ç”¨ç‡ â‰¥ <code>InitiatingHeapOccupancyPercent</code> (é»˜è®¤45%)</li>
</ol>
<p><strong>å›æ”¶èŒƒå›´</strong>:</p>
<ul>
<li>å¹´è½»ä»£(å…¨éƒ¨Eden + Survivor)</li>
<li>éƒ¨åˆ†è€å¹´ä»£Region (åƒåœ¾æœ€å¤šçš„)</li>
</ul>
<p><strong>æ ¸å¿ƒç­–ç•¥: Garbage-First</strong></p>
<p>G1æ ¹æ®<code>MaxGCPauseMillis</code>ç›®æ ‡,é€‰æ‹©åƒåœ¾æœ€å¤šçš„è€å¹´ä»£Regionå›æ”¶:</p>
<pre><code class="hljs language-erlang" lang="erlang">å‡è®¾æœ‰<span class="hljs-number">10</span>ä¸ªOld Region,åƒåœ¾å æ¯”åˆ†åˆ«ä¸º:
Region1: <span class="hljs-number">90</span><span class="hljs-comment">%</span>
Region2: <span class="hljs-number">85</span><span class="hljs-comment">%</span>
Region3: <span class="hljs-number">70</span><span class="hljs-comment">%</span>
Region4: <span class="hljs-number">50</span><span class="hljs-comment">%</span>
...

G1ä¼˜å…ˆé€‰æ‹©Region1ã€Region2ã€Region3å›æ”¶,
åœ¨åœé¡¿æ—¶é—´å…è®¸èŒƒå›´å†…,å°½å¯èƒ½å¤šå›æ”¶Regionã€‚
</code></pre>
<p><strong>åœé¡¿æ§åˆ¶</strong>:</p>
<p>G1é€šè¿‡<code>MaxGCPauseMillis</code>æ§åˆ¶åœé¡¿æ—¶é—´:</p>
<pre><code class="hljs language-bash" lang="bash">-XX:MaxGCPauseMillis=200  <span class="hljs-comment"># æœŸæœ›æœ€å¤§åœé¡¿200ms</span>
</code></pre>
<p>æ³¨æ„: è¿™æ˜¯è½¯ç›®æ ‡,G1ä¼šå°½åŠ›è¾¾æˆä½†ä¸ä¿è¯ã€‚</p>
<p><strong>åœé¡¿æ—¶é—´</strong>: 50-200ms (å¯é€šè¿‡å‚æ•°æ§åˆ¶)</p>
<p><strong>å¤šæ¬¡Mixed GC</strong>:</p>
<p>ä¸€ä¸ªå¹¶å‘æ ‡è®°å‘¨æœŸå,å¯èƒ½è§¦å‘å¤šæ¬¡Mixed GC,é€æ­¥å›æ”¶è€å¹´ä»£åƒåœ¾ã€‚</p>
<h4 data-id="heading-12">2.2.3 å¹¶å‘æ ‡è®°å‘¨æœŸ (Concurrent Marking Cycle)</h4>
<p>å¹¶å‘æ ‡è®°å‘¨æœŸæ˜¯Mixed GCçš„å‰ç½®é˜¶æ®µ,ç”¨äºæ ‡è®°è€å¹´ä»£ä¸­çš„å­˜æ´»å¯¹è±¡,ç¡®å®šå“ªäº›Regionéœ€è¦å›æ”¶ã€‚</p>
<p><strong>é˜¶æ®µ1: åˆå§‹æ ‡è®° (Initial Mark, STW)</strong></p>
<ul>
<li><strong>STWåœé¡¿</strong>: å‡ æ¯«ç§’</li>
<li><strong>å·¥ä½œ</strong>: æ ‡è®°GC Rootsç›´æ¥å¯è¾¾å¯¹è±¡</li>
<li><strong>ä¼˜åŒ–</strong>: å€Ÿç”¨Young GCçš„STW,æ— é¢å¤–åœé¡¿</li>
</ul>
<p><strong>é˜¶æ®µ2: å¹¶å‘æ ‡è®° (Concurrent Mark, å¹¶å‘)</strong></p>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: åº”ç”¨çº¿ç¨‹ç»§ç»­è¿è¡Œ</li>
<li><strong>å·¥ä½œ</strong>: éå†æ•´ä¸ªå¯¹è±¡å›¾,æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡</li>
<li><strong>è€—æ—¶</strong>: å‡ ç™¾æ¯«ç§’åˆ°å‡ ç§’</li>
</ul>
<p><strong>é˜¶æ®µ3: æœ€ç»ˆæ ‡è®° (Final Mark, STW)</strong></p>
<ul>
<li><strong>STWåœé¡¿</strong>: å‡ åæ¯«ç§’</li>
<li><strong>å·¥ä½œ</strong>: å¤„ç†SATBé˜Ÿåˆ—,ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´çš„å¼•ç”¨å˜åŒ–</li>
</ul>
<p><strong>é˜¶æ®µ4: æ¸…ç† (Cleanup, éƒ¨åˆ†STW)</strong></p>
<ul>
<li><strong>STWéƒ¨åˆ†</strong>: ç»Ÿè®¡Regionå­˜æ´»ç‡ (å‡ æ¯«ç§’)</li>
<li><strong>å¹¶å‘éƒ¨åˆ†</strong>: æ¸…ç†å®Œå…¨ç©ºçš„Region (å‡ åæ¯«ç§’)</li>
</ul>
<p><strong>å®Œæ•´æµç¨‹</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">åˆå§‹æ ‡è®° â†’ å¹¶å‘æ ‡è®° â†’ æœ€ç»ˆæ ‡è®° â†’ æ¸…ç† â†’ è§¦å‘Mixed GC
 (STW)     (å¹¶å‘)     (STW)    (éƒ¨åˆ†STW)
</code></pre>
<h3 data-id="heading-13">2.3 SATBç®—æ³•è¯¦è§£</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ebab0f2dd8b4fe9b2c0a9c04a90f1b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=LLMz6uWL%2FqcDtxNAbuNuX7d9XDI%3D" alt="tricolor-satb.svg" loading="lazy"/></p>
<h4 data-id="heading-14">2.3.1 ä¸‰è‰²æ ‡è®°ç®—æ³•</h4>
<p>G1ä½¿ç”¨ä¸‰è‰²æ ‡è®°ç®—æ³•è¿›è¡Œå¹¶å‘æ ‡è®°:</p>
<ul>
<li><strong>ç™½è‰²å¯¹è±¡</strong>: æœªæ ‡è®°,å¯èƒ½æ˜¯åƒåœ¾</li>
<li><strong>ç°è‰²å¯¹è±¡</strong>: å·²æ ‡è®°,ä½†å­å¯¹è±¡æœªæ‰«æ</li>
<li><strong>é»‘è‰²å¯¹è±¡</strong>: å·²æ ‡è®°,ä¸”å­å¯¹è±¡å·²æ‰«æ</li>
</ul>
<p><strong>æ ‡è®°æµç¨‹</strong>:</p>
<ol>
<li>åˆå§‹: æ‰€æœ‰å¯¹è±¡ä¸ºç™½è‰²</li>
<li>GC Rootsæ ‡è®°ä¸ºç°è‰²</li>
<li>ä»ç°è‰²å¯¹è±¡é˜Ÿåˆ—å–å‡ºå¯¹è±¡,æ‰«æå…¶å¼•ç”¨:
<ul>
<li>å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</li>
<li>å½“å‰å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²</li>
</ul>
</li>
<li>é‡å¤æ­¥éª¤3,ç›´åˆ°ç°è‰²å¯¹è±¡é˜Ÿåˆ—ä¸ºç©º</li>
<li>å‰©ä½™ç™½è‰²å¯¹è±¡ = åƒåœ¾,å›æ”¶</li>
</ol>
<p><strong>ä¸å˜å¼</strong>: é»‘è‰²å¯¹è±¡ä¸èƒ½ç›´æ¥å¼•ç”¨ç™½è‰²å¯¹è±¡</p>
<p>è‹¥è¿å,å¯èƒ½å¯¼è‡´å¯¹è±¡æ¼æ ‡:</p>
<ul>
<li>é»‘è‰²å¯¹è±¡å·²æ‰«æå®Œæˆ</li>
<li>æ–°å¢ç™½è‰²å¼•ç”¨ä¸ä¼šè¢«å‘ç°</li>
<li>ç™½è‰²å¯¹è±¡è¢«è¯¯è®¤ä¸ºåƒåœ¾</li>
<li><strong>å­˜æ´»å¯¹è±¡è¢«é”™è¯¯å›æ”¶!</strong></li>
</ul>
<h4 data-id="heading-15">2.3.2 å¹¶å‘æ ‡è®°çš„é—®é¢˜</h4>
<p>å¹¶å‘æ ‡è®°æœŸé—´,åº”ç”¨çº¿ç¨‹å¯èƒ½ä¿®æ”¹å¯¹è±¡å¼•ç”¨,å¯¼è‡´å¯¹è±¡æ¼æ ‡ã€‚</p>
<p><strong>å¯¹è±¡æ¼æ ‡çš„ä¸¤ä¸ªå……è¦æ¡ä»¶</strong>:</p>
<ol>
<li>é»‘è‰²å¯¹è±¡æ–°å¢å¯¹ç™½è‰²å¯¹è±¡çš„å¼•ç”¨</li>
<li>ç°è‰²å¯¹è±¡åˆ é™¤å¯¹ç™½è‰²å¯¹è±¡çš„å¼•ç”¨</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>åˆå§‹çŠ¶æ€:</p>
<pre><code class="hljs language-scss" lang="scss">GC Root (é»‘) â†’ å¯¹è±¡<span class="hljs-selector-tag">A</span> (ç°) â†’ å¯¹è±¡<span class="hljs-selector-tag">B</span> (ç™½)
</code></pre>
<p>å¹¶å‘æœŸé—´,åº”ç”¨çº¿ç¨‹æ‰§è¡Œ:</p>
<pre><code class="hljs language-java" lang="java">root.fieldB = objectB;  <span class="hljs-comment">// é»‘â†’ç™½å¼•ç”¨</span>
objectA.fieldB = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// åˆ é™¤ç°â†’ç™½å¼•ç”¨</span>
</code></pre>
<p>ç»“æœ:</p>
<pre><code class="hljs language-scss" lang="scss">GC Root (é»‘) â†’ å¯¹è±¡<span class="hljs-selector-tag">B</span> (ç™½)
</code></pre>
<p>é—®é¢˜:</p>
<ul>
<li>GC Root(é»‘)å·²æ‰«æå®Œ,ä¸ä¼šå†æ‰«æ</li>
<li>å¯¹è±¡A(ç°)åˆ é™¤å¼•ç”¨,ä¸ä¼šè®¿é—®B</li>
<li>å¯¹è±¡B(ç™½)æ²¡æœ‰å…¶ä»–å¼•ç”¨è·¯å¾„</li>
<li><strong>å¯¹è±¡Bè¢«è¯¯è®¤ä¸ºåƒåœ¾,é”™è¯¯å›æ”¶!</strong></li>
</ul>
<h4 data-id="heading-16">2.3.3 SATB (Snapshot-At-The-Beginning) è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>: æ ‡è®°å¼€å§‹æ—¶çš„å¯¹è±¡å¿«ç…§(é€»è¾‘å¿«ç…§,éç‰©ç†å¿«ç…§)</p>
<p><strong>å†™å±éšœå®ç°</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// G1çš„SATBå†™å±éšœ (å‰ç½®å±éšœ)</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">oop_field_store</span><span class="hljs-params">(oop* field, oop new_value)</span> {
  <span class="hljs-type">oop</span> <span class="hljs-variable">old_value</span> <span class="hljs-operator">=</span> *field;  <span class="hljs-comment">// 1. è¯»å–æ—§å€¼</span>
  <span class="hljs-keyword">if</span> (old_value != <span class="hljs-literal">null</span> &amp;&amp; is_marking_active()) {
    satb_enqueue(old_value);  <span class="hljs-comment">// 2. ä¿å­˜æ—§å€¼åˆ°SATBé˜Ÿåˆ—</span>
  }
  *field = new_value;  <span class="hljs-comment">// 3. æ‰§è¡Œå®é™…çš„å¼•ç”¨æ›´æ–°</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè®°å½•æ—§å€¼è€Œä¸æ˜¯æ–°å€¼?</strong></p>
<ul>
<li>SATBç›®æ ‡: ä¿è¯æ ‡è®°å¼€å§‹æ—¶çš„å¿«ç…§ä¸­çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½è¢«æ ‡è®°</li>
<li>æ—§å€¼å¯èƒ½æ˜¯å”¯ä¸€å¼•ç”¨è·¯å¾„,åˆ é™¤åå¯¹è±¡ä¼šå­¤ç«‹</li>
<li>æ–°å€¼ä¼šåœ¨å¹¶å‘æ ‡è®°ä¸­æ­£å¸¸æ‰«æåˆ°</li>
</ul>
<p><strong>SATBé˜Ÿåˆ—å¤„ç†</strong>:</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªæœ¬åœ°SATBé˜Ÿåˆ—</li>
<li>é˜Ÿåˆ—æ»¡æ—¶,è½¬ç§»åˆ°å…¨å±€é˜Ÿåˆ—</li>
<li>æœ€ç»ˆæ ‡è®°é˜¶æ®µ,GCçº¿ç¨‹å¤„ç†æ‰€æœ‰SATBé˜Ÿåˆ—</li>
<li>ä»é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°æ‰«æ,æ ‡è®°ä¸ºç°è‰²</li>
</ul>
<p><strong>SATBçš„ä¿å®ˆæ€§</strong>:</p>
<ul>
<li>å¯èƒ½æ ‡è®°ä¸€äº›å·²ç»æ­»äº¡çš„å¯¹è±¡(æµ®åŠ¨åƒåœ¾)</li>
<li>ç‰ºç‰²éƒ¨åˆ†ç²¾åº¦,æ¢å–ä¸æ¼æ ‡çš„ä¿è¯</li>
<li>æµ®åŠ¨åƒåœ¾åœ¨ä¸‹ä¸€æ¬¡GCä¼šè¢«å›æ”¶</li>
</ul>
<h3 data-id="heading-17">2.4 G1çš„å‚æ•°è°ƒä¼˜</h3>
<h4 data-id="heading-18">2.4.1 æ ¸å¿ƒå‚æ•°</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨G1</span>
-XX:+UseG1GC

<span class="hljs-comment"># æœŸæœ›æœ€å¤§åœé¡¿æ—¶é—´ (è½¯ç›®æ ‡)</span>
-XX:MaxGCPauseMillis=200  <span class="hljs-comment"># é»˜è®¤200ms</span>

<span class="hljs-comment"># å †å¤§å° (å»ºè®®Xms = Xmx)</span>
-Xms4g -Xmx4g

<span class="hljs-comment"># Regionå¤§å° (1MB-32MB,å¿…é¡»æ˜¯2çš„å¹‚)</span>
-XX:G1HeapRegionSize=8m

<span class="hljs-comment"># è€å¹´ä»£å ç”¨ç‡è¾¾åˆ°æ­¤é˜ˆå€¼æ—¶è§¦å‘å¹¶å‘æ ‡è®°</span>
-XX:InitiatingHeapOccupancyPercent=45  <span class="hljs-comment"># é»˜è®¤45%</span>

<span class="hljs-comment"># ä¿ç•™ç©ºé—´,é˜²æ­¢æ™‹å‡å¤±è´¥</span>
-XX:G1ReservePercent=10  <span class="hljs-comment"># é»˜è®¤10%</span>

<span class="hljs-comment"># æ–°ç”Ÿä»£å¤§å°èŒƒå›´</span>
-XX:G1NewSizePercent=5       <span class="hljs-comment"># æ–°ç”Ÿä»£æœ€å°å æ¯”5%</span>
-XX:G1MaxNewSizePercent=60   <span class="hljs-comment"># æ–°ç”Ÿä»£æœ€å¤§å æ¯”60%</span>

<span class="hljs-comment"># å¹¶å‘æ ‡è®°çº¿ç¨‹æ•° (é»˜è®¤ParallelGCThreads/4)</span>
-XX:ConcGCThreads=4

<span class="hljs-comment"># å¹¶è¡ŒGCçº¿ç¨‹æ•° (é»˜è®¤ç­‰äºCPUæ ¸å¿ƒæ•°)</span>
-XX:ParallelGCThreads=8
</code></pre>
<h4 data-id="heading-19">2.4.2 å®Œæ•´é…ç½®ç¤ºä¾‹</h4>
<p><strong>Webåº”ç”¨ (4æ ¸8GB,å †4GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms4g -Xmx4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:G1HeapRegionSize=8m \
     -XX:InitiatingHeapOccupancyPercent=45 \
     -XX:G1ReservePercent=10 \
     -XX:MetaspaceSize=256m \
     -XX:MaxMetaspaceSize=512m \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/var/log/heapdump.hprof \
     -Xloggc:/var/log/gc.log \
     -XX:+PrintGCDetails \
     -XX:+PrintGCDateStamps \
     -jar application.jar
</code></pre>
<p><strong>å¤§å†…å­˜åº”ç”¨ (16æ ¸32GB,å †24GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms24g -Xmx24g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=100 \
     -XX:G1HeapRegionSize=16m \
     -XX:InitiatingHeapOccupancyPercent=40 \
     -XX:G1ReservePercent=15 \
     -XX:ConcGCThreads=4 \
     -XX:ParallelGCThreads=16 \
     -XX:MetaspaceSize=512m \
     -XX:MaxMetaspaceSize=1g \
     -Xloggc:/var/log/gc.log \
     -jar application.jar
</code></pre>
<hr/>
<h2 data-id="heading-20">ä¸‰ã€ZGCåƒåœ¾æ”¶é›†å™¨åŸç†</h2>
<h3 data-id="heading-21">3.1 ZGCçš„æ•´ä½“æ¶æ„</h3>
<p>ZGCæ˜¯JDK 11å¼•å…¥çš„è¶…ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨,ç›®æ ‡æ˜¯å®ç°åœé¡¿æ—¶é—´ &lt; 10ms,ä¸å †å¤§å°æ— å…³ã€‚</p>
<h4 data-id="heading-22">3.1.1 æ ¸å¿ƒæŠ€æœ¯</h4>
<p>ZGCçš„ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯:</p>
<ol>
<li><strong>æŸ“è‰²æŒ‡é’ˆ (Colored Pointers)</strong>: å°†GCä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­</li>
<li><strong>è¯»å±éšœ (Load Barrier)</strong>: å¯¹è±¡è®¿é—®æ—¶è‡ªåŠ¨å¤„ç†é‡å®šä½</li>
<li><strong>å¹¶å‘é‡å®šä½</strong>: å¯¹è±¡ç§»åŠ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</li>
</ol>
<h3 data-id="heading-23">3.2 æŸ“è‰²æŒ‡é’ˆ (Colored Pointers)</h3>
<p><img src="images/07/zgc-colored-pointers.svg" alt="ZGCæŸ“è‰²æŒ‡é’ˆç»“æ„" loading="lazy"/></p>
<h4 data-id="heading-24">3.2.1 64ä½æŒ‡é’ˆå¸ƒå±€</h4>
<p>ZGCåˆ©ç”¨64ä½æŒ‡é’ˆçš„é«˜ä½å­˜å‚¨GCä¿¡æ¯:</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">63</span>              <span class="hljs-number">47</span> <span class="hljs-number">46</span> <span class="hljs-number">45</span> <span class="hljs-number">44</span> <span class="hljs-number">43</span> <span class="hljs-number">42</span>                                        <span class="hljs-number">0</span>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reserved     â”‚Fiâ”‚Reâ”‚M1â”‚M0â”‚Res â”‚      <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">Address</span> (<span class="hljs-number">42</span>ä½)           â”‚
â”‚   (<span class="hljs-number">16</span>ä½)       â”‚naâ”‚maâ”‚arâ”‚arâ”‚erv â”‚                                      â”‚
â”‚                â”‚<span class="hljs-selector-tag">li</span>â”‚ppâ”‚keâ”‚keâ”‚ed  â”‚                                      â”‚
â”‚                â”‚zaâ”‚edâ”‚d1â”‚d0â”‚(<span class="hljs-number">2</span>) â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å…ƒæ•°æ®ä½ [47:42]</strong>:</p>
<ul>
<li><strong>Marked0 (ä½44)</strong>: å¥‡æ•°è½®å¹¶å‘æ ‡è®°,æ ‡è®°ä¸º1è¡¨ç¤ºå¯¹è±¡å­˜æ´»</li>
<li><strong>Marked1 (ä½45)</strong>: å¶æ•°è½®å¹¶å‘æ ‡è®°,æ ‡è®°ä¸º1è¡¨ç¤ºå¯¹è±¡å­˜æ´»</li>
<li><strong>Remapped (ä½46)</strong>: æ ‡è®°å¯¹è±¡æ˜¯å¦å·²é‡å®šä½,1è¡¨ç¤ºå·²ç§»åŠ¨åˆ°æ–°åœ°å€</li>
<li><strong>Finalizable (ä½47)</strong>: æ ‡è®°å¯¹è±¡æ˜¯å¦å¯ç»ˆç»“,1è¡¨ç¤ºæœ‰finalizeæ–¹æ³•</li>
</ul>
<p><strong>å¯¹è±¡åœ°å€ [41:0]</strong>:</p>
<ul>
<li>42ä½åœ°å€å¯å¯»å€ 4TB (2^42 = 4TB)</li>
<li>Linux x86-64ä»…ä½¿ç”¨ä½48ä½</li>
</ul>
<h4 data-id="heading-25">3.2.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªMarkedä½?</h4>
<p>ZGCæ¯è½®GCäº¤æ›¿ä½¿ç”¨Marked0å’ŒMarked1:</p>
<ul>
<li>ç¬¬1è½®GC: ä½¿ç”¨Marked0 (Marked0=1è¡¨ç¤ºå­˜æ´»)</li>
<li>ç¬¬2è½®GC: ä½¿ç”¨Marked1 (Marked1=1è¡¨ç¤ºå­˜æ´»)</li>
</ul>
<p><strong>å¥½å¤„</strong>: æ— éœ€é‡ç½®æ‰€æœ‰å¯¹è±¡çš„æ ‡è®°ä½,ç›´æ¥åˆ‡æ¢ä½¿ç”¨å“ªä¸ªä½å³å¯ã€‚</p>
<p>ä¾‹å¦‚:</p>
<ul>
<li>ç¬¬1è½®GCå,Marked0=1çš„å¯¹è±¡æ˜¯å­˜æ´»çš„</li>
<li>ç¬¬2è½®GCå¼€å§‹æ—¶,ç›´æ¥ä½¿ç”¨Marked1,æ— éœ€æ¸…é™¤Marked0</li>
</ul>
<h4 data-id="heading-26">3.2.3 æŸ“è‰²æŒ‡é’ˆçš„ä¼˜åŠ¿</h4>
<p><strong>1. ä¸€æ¬¡æ€§æ ‡è®°</strong></p>
<p>æ— éœ€éå†å¯¹è±¡å›¾,ç›´æ¥é€šè¿‡æŒ‡é’ˆé¢œè‰²åˆ¤æ–­å¯¹è±¡çŠ¶æ€:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²æ ‡è®°</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">is_marked</span><span class="hljs-params">(Object* ptr)</span> {
  <span class="hljs-keyword">return</span> (ptr &amp; MARKED_BIT) != <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>2. å¹¶å‘é‡å®šä½</strong></p>
<p>å¯¹è±¡ç§»åŠ¨å,æ—§æŒ‡é’ˆé€šè¿‡è¯»å±éšœè‡ªåŠ¨é‡å®šå‘åˆ°æ–°åœ°å€,æ— éœ€STWæ›´æ–°æ‰€æœ‰å¼•ç”¨ã€‚</p>
<p><strong>3. å¤šä»£è§†å›¾</strong></p>
<p>åŒä¸€ç‰©ç†åœ°å€,é€šè¿‡ä¸åŒé¢œè‰²çš„æŒ‡é’ˆ,å¯ä»¥åŒæ—¶è¡¨ç¤ºæ—§å¯¹è±¡å’Œæ–°å¯¹è±¡ã€‚</p>
<p><strong>4. ä½å»¶è¿Ÿ</strong></p>
<p>é…åˆè¯»å±éšœå’Œå¤šé‡æ˜ å°„,å®ç°æ¥è¿‘é›¶åœé¡¿çš„GC (STWé€šå¸¸ &lt; 10ms)ã€‚</p>
<h3 data-id="heading-27">3.3 è¯»å±éšœ (Load Barrier)</h3>
<p>ZGCä½¿ç”¨è¯»å±éšœ(è€Œä¸æ˜¯å†™å±éšœ)æ¥å®ç°å¹¶å‘é‡å®šä½ã€‚</p>
<p><strong>è¯»å±éšœä¼ªä»£ç </strong>:</p>
<pre><code class="hljs language-java" lang="java">Object <span class="hljs-title function_">load</span><span class="hljs-params">(Object* addr)</span> {
  <span class="hljs-type">Object</span> <span class="hljs-variable">ptr</span> <span class="hljs-operator">=</span> *addr;  <span class="hljs-comment">// 1. è¯»å–æŒ‡é’ˆ</span>

  <span class="hljs-comment">// 2. æ£€æŸ¥æŒ‡é’ˆçš„é¢œè‰²ä½</span>
  <span class="hljs-keyword">if</span> (is_good_color(ptr)) {
    <span class="hljs-keyword">return</span> ptr;  <span class="hljs-comment">// é¢œè‰²æ­£ç¡®,ç›´æ¥è¿”å›</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> slow_path(ptr);  <span class="hljs-comment">// é¢œè‰²ä¸å¯¹,è¿›å…¥æ…¢é€Ÿè·¯å¾„ (é‡å®šä½/æ ‡è®°)</span>
  }
}
</code></pre>
<p><strong>å¿«é€Ÿè·¯å¾„</strong>: é¢œè‰²æ­£ç¡®,ç›´æ¥è¿”å›æŒ‡é’ˆ (å‡ ä¹æ— å¼€é”€)</p>
<p><strong>æ…¢é€Ÿè·¯å¾„</strong>: é¢œè‰²ä¸å¯¹,è¿›è¡Œé‡å®šä½æˆ–æ ‡è®°,ç„¶åæ›´æ–°æŒ‡é’ˆé¢œè‰²</p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>å¯¹è±¡ç§»åŠ¨å,æ—§æŒ‡é’ˆé€šè¿‡è¯»å±éšœè‡ªåŠ¨é‡å®šå‘åˆ°æ–°åœ°å€</li>
<li>åº”ç”¨çº¿ç¨‹è®¿é—®æ—¶è‡ªåŠ¨å®Œæˆé‡å®šä½,æ— éœ€STW</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>è¯»æ“ä½œæœ‰é¢å¤–å¼€é”€ (ä½†ç°ä»£CPUåˆ†æ”¯é¢„æµ‹ä¼˜åŒ–åå½±å“å¾ˆå°)</li>
</ul>
<h3 data-id="heading-28">3.4 ZGCçš„åƒåœ¾å›æ”¶æµç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fef8decbcab344748d4128ccfb7a4779~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=xnCkYJ58A2hitKJ3%2Bqy3XFPwi88%3D" alt="zgc-gc-flow.svg" loading="lazy"/></p>
<p>ZGCçš„GCæµç¨‹åŒ…æ‹¬7ä¸ªé˜¶æ®µ,åªæœ‰3ä¸ªæçŸ­çš„STWé˜¶æ®µã€‚</p>
<h4 data-id="heading-29">3.4.1 é˜¶æ®µ1: Pause Mark Start (åˆå§‹æ ‡è®° - STW)</h4>
<ul>
<li><strong>STWåœé¡¿</strong>: ~1ms</li>
<li><strong>å·¥ä½œ</strong>: æ ‡è®°GC Rootsç›´æ¥å¯è¾¾å¯¹è±¡</li>
<li><strong>é¢œè‰²æŒ‡é’ˆ</strong>: è®¾ç½®å½“å‰ä½¿ç”¨çš„Markedä½ (Marked0æˆ–Marked1)</li>
</ul>
<h4 data-id="heading-30">3.4.2 é˜¶æ®µ2: Concurrent Mark (å¹¶å‘æ ‡è®°)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: åº”ç”¨çº¿ç¨‹ç»§ç»­è¿è¡Œ</li>
<li><strong>å·¥ä½œ</strong>: éå†æ•´ä¸ªå¯¹è±¡å›¾,æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡</li>
<li><strong>é¢œè‰²æŒ‡é’ˆ</strong>:
<ul>
<li>å·²æ ‡è®°å¯¹è±¡: Markedä½ = 1</li>
<li>æœªæ ‡è®°å¯¹è±¡: Markedä½ = 0 (åƒåœ¾å€™é€‰)</li>
</ul>
</li>
</ul>
<h4 data-id="heading-31">3.4.3 é˜¶æ®µ3: Pause Mark End (æœ€ç»ˆæ ‡è®° - STW)</h4>
<ul>
<li><strong>STWåœé¡¿</strong>: ~1ms</li>
<li><strong>å·¥ä½œ</strong>: å¤„ç†å¹¶å‘æ ‡è®°æœŸé—´çš„å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ç­‰</li>
<li><strong>é€‰æ‹©å›æ”¶å¯¹è±¡</strong>: Markedä½ = 0 çš„å¯¹è±¡ä¸ºåƒåœ¾</li>
</ul>
<h4 data-id="heading-32">3.4.4 é˜¶æ®µ4: Concurrent Process Non-Strong References (å¤„ç†å¼±å¼•ç”¨)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: å¤„ç†è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ã€Finalizer</li>
<li><strong>å·¥ä½œ</strong>:
<ul>
<li>å¤„ç†è½¯å¼•ç”¨: æ ¹æ®å†…å­˜æƒ…å†µå†³å®šæ˜¯å¦å›æ”¶</li>
<li>å¤„ç†å¼±å¼•ç”¨: æ ‡è®°é˜¶æ®µæœªæ ‡è®°çš„å¯¹è±¡,å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«å›æ”¶</li>
<li>å¤„ç†è™šå¼•ç”¨</li>
<li>å¤„ç†Finalizer: è°ƒç”¨finalize()æ–¹æ³•</li>
</ul>
</li>
</ul>
<h4 data-id="heading-33">3.4.5 é˜¶æ®µ5: Concurrent Reset Relocation Set (é‡ç½®é‡å®šä½é›†)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: å‡†å¤‡é‡å®šä½,é‡ç½®ä¸Šä¸€æ¬¡GCçš„é‡å®šä½æ˜ å°„è¡¨</li>
<li><strong>å·¥ä½œ</strong>: æ¸…ç†ä¸Šä¸€æ¬¡GCçš„è½¬å‘è¡¨ (Forwarding Table)</li>
</ul>
<h4 data-id="heading-34">3.4.6 é˜¶æ®µ6: Pause Relocate Start (å¼€å§‹é‡å®šä½ - STW)</h4>
<ul>
<li><strong>STWåœé¡¿</strong>: ~1ms</li>
<li><strong>å·¥ä½œ</strong>: é‡å®šä½GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡,æ›´æ–°GC Rootsä¸­çš„å¼•ç”¨æŒ‡é’ˆ</li>
<li><strong>é¢œè‰²æŒ‡é’ˆ</strong>:
<ul>
<li>å·²é‡å®šä½å¯¹è±¡: Remappedä½ = 1</li>
<li>æ›´æ–°æŒ‡é’ˆæŒ‡å‘æ–°åœ°å€</li>
</ul>
</li>
</ul>
<h4 data-id="heading-35">3.4.7 é˜¶æ®µ7: Concurrent Relocate (å¹¶å‘é‡å®šä½)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: ç§»åŠ¨å¯¹è±¡,æ›´æ–°å¼•ç”¨æŒ‡é’ˆ</li>
<li><strong>å·¥ä½œ</strong>:
<ul>
<li>éå†Relocation Setä¸­çš„Page,å°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°æ–°Page</li>
<li>å»ºç«‹è½¬å‘è¡¨ (Forwarding Table): è®°å½•æ—§åœ°å€ â†’ æ–°åœ°å€æ˜ å°„</li>
<li>é€šè¿‡è¯»å±éšœ,åº”ç”¨çº¿ç¨‹è®¿é—®æ—§åœ°å€æ—¶è‡ªåŠ¨è½¬å‘åˆ°æ–°åœ°å€</li>
</ul>
</li>
</ul>
<p><strong>è¯»å±éšœçš„ä½œç”¨</strong>:</p>
<p>å¹¶å‘é‡å®šä½æœŸé—´,åº”ç”¨çº¿ç¨‹å¦‚ä½•è®¿é—®å·²ç§»åŠ¨çš„å¯¹è±¡?</p>
<p>åœºæ™¯: GCçº¿ç¨‹å·²å°†å¯¹è±¡Aä»åœ°å€0x1000ç§»åŠ¨åˆ°0x2000,ä½†åº”ç”¨çº¿ç¨‹æŒæœ‰æ—§æŒ‡é’ˆ0x1000</p>
<ol>
<li>åº”ç”¨çº¿ç¨‹è®¿é—®å¯¹è±¡A: <code>obj = *ptr;</code> (è§¦å‘è¯»å±éšœ)</li>
<li>è¯»å±éšœæ£€æŸ¥é¢œè‰²ä½:
<ul>
<li>Remapped = 0: å¯¹è±¡è¿˜åœ¨æ—§åœ°å€,ç›´æ¥è¿”å›</li>
<li>Remapped = 1: å¯¹è±¡å·²ç§»åŠ¨,æŸ¥è¯¢è½¬å‘è¡¨è·å–æ–°åœ°å€</li>
</ul>
</li>
<li>è½¬å‘åˆ°æ–°åœ°å€:
<ul>
<li>ä»è½¬å‘è¡¨æŸ¥è¯¢: 0x1000 â†’ 0x2000</li>
<li>è¿”å›æ–°åœ°å€çš„å¯¹è±¡</li>
<li>æ›´æ–°æŒ‡é’ˆä¸ºæ–°åœ°å€ (å¯é€‰ä¼˜åŒ–)</li>
</ul>
</li>
</ol>
<h3 data-id="heading-36">3.5 å¤šé‡æ˜ å°„å†…å­˜ç®¡ç†</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da1b1805c4a74a599643973ffa89e987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=pDIQ9cgwlDBtCqg1ejFoiVLfgTg%3D" alt="zgc-multi-mapping.svg" loading="lazy"/></p>
<h4 data-id="heading-37">3.5.1 æ ¸å¿ƒæ€æƒ³</h4>
<p>ZGCå°†åŒä¸€å—ç‰©ç†å†…å­˜æ˜ å°„åˆ°3ä¸ªä¸åŒçš„è™šæ‹Ÿåœ°å€ç©ºé—´:</p>
<ul>
<li><strong>Marked0 View</strong>: Marked0=1 çš„æŒ‡é’ˆè®¿é—®æ­¤è§†å›¾</li>
<li><strong>Marked1 View</strong>: Marked1=1 çš„æŒ‡é’ˆè®¿é—®æ­¤è§†å›¾</li>
<li><strong>Remapped View</strong>: Remapped=1 çš„æŒ‡é’ˆè®¿é—®æ­¤è§†å›¾</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">è™šæ‹Ÿåœ°å€ç©ºé—´:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Marked0 <span class="hljs-keyword">View</span>    â”‚ <span class="hljs-number">0x0000</span>_0000_0000 <span class="hljs-operator">-</span> <span class="hljs-number">0x0000</span>_03FF_FFFF
â”‚ (è™šæ‹Ÿåœ°å€)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æ˜ å°„
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰©ç†å†…å­˜        â”‚ <span class="hljs-number">0x1000</span>_0000 <span class="hljs-operator">-</span> <span class="hljs-number">0x13FF</span>_FFFF (<span class="hljs-number">64</span>MB)
â”‚ (å¯¹è±¡A, B, C...)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ æ˜ å°„
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Remapped <span class="hljs-keyword">View</span>   â”‚ <span class="hljs-number">0x0000</span>_0800_0000 <span class="hljs-operator">-</span> <span class="hljs-number">0x0000</span>_0BFF_FFFF
â”‚ (è™šæ‹Ÿåœ°å€)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-38">3.5.2 å·¥ä½œåŸç†</h4>
<p><strong>åœºæ™¯</strong>: å°†å¯¹è±¡Aä»ç‰©ç†åœ°å€0x1000_1000 é‡å®šä½åˆ° 0x1000_5000</p>
<p><strong>æ­¥éª¤1: å¹¶å‘æ ‡è®°é˜¶æ®µ (ä½¿ç”¨Marked0è§†å›¾)</strong></p>
<ul>
<li>å¯¹è±¡Açš„æŒ‡é’ˆ: 0x0001_0000_1000 (Marked0=1)</li>
<li>é€šè¿‡Marked0è§†å›¾è®¿é—®ç‰©ç†åœ°å€ 0x1000_1000</li>
<li>è™šæ‹Ÿåœ°å€: 0x0000_0000_1000 â†’ ç‰©ç†åœ°å€: 0x1000_1000</li>
</ul>
<p><strong>æ­¥éª¤2: å¹¶å‘é‡å®šä½é˜¶æ®µ (åˆ‡æ¢åˆ°Remappedè§†å›¾)</strong></p>
<ul>
<li>GCçº¿ç¨‹å°†å¯¹è±¡Aå¤åˆ¶åˆ°æ–°ç‰©ç†åœ°å€ 0x1000_5000</li>
<li>åˆ›å»ºè½¬å‘è¡¨: 0x1000_1000 â†’ 0x1000_5000</li>
<li>æ–°æŒ‡é’ˆ: 0x0004_0000_5000 (Remapped=1)</li>
<li>é€šè¿‡Remappedè§†å›¾è®¿é—®æ–°ç‰©ç†åœ°å€ 0x1000_5000</li>
<li>è™šæ‹Ÿåœ°å€: 0x0000_0800_5000 â†’ ç‰©ç†åœ°å€: 0x1000_5000</li>
</ul>
<p><strong>æ­¥éª¤3: è¯»å±éšœå¤„ç†æ—§æŒ‡é’ˆ</strong></p>
<ul>
<li>åº”ç”¨çº¿ç¨‹æŒæœ‰æ—§æŒ‡é’ˆ: 0x0001_0000_1000</li>
<li>è¯»å±éšœæ£€æŸ¥Marked0=1, Remapped=0</li>
<li>æŸ¥è¯¢è½¬å‘è¡¨: 0x1000_1000 â†’ 0x1000_5000</li>
<li>è¿”å›æ–°åœ°å€å¯¹è±¡</li>
<li>å¯é€‰: æ›´æ–°æŒ‡é’ˆä¸º 0x0004_0000_5000</li>
</ul>
<h4 data-id="heading-39">3.5.3 å¤šé‡æ˜ å°„çš„ä¼˜åŠ¿</h4>
<p><strong>âœ… æ— éœ€ç‰©ç†å¤åˆ¶</strong></p>
<ul>
<li>å¯¹è±¡é‡å®šä½åªéœ€åˆ‡æ¢æŒ‡é’ˆé¢œè‰²ä½</li>
<li>æ— éœ€å¤åˆ¶å¯¹è±¡æ•°æ®</li>
<li>æå¤§å‡å°‘GCå¼€é”€</li>
</ul>
<p><strong>âœ… å¹¶å‘å®‰å…¨</strong></p>
<ul>
<li>æ—§è§†å›¾å’Œæ–°è§†å›¾åŒæ—¶æœ‰æ•ˆ</li>
<li>åº”ç”¨çº¿ç¨‹é€šè¿‡è¯»å±éšœè‡ªåŠ¨è½¬å‘</li>
<li>æ— éœ€STWæ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
</ul>
<p><strong>âœ… å¤šä»£åˆ‡æ¢</strong></p>
<ul>
<li>Marked0/Marked1 äº¤æ›¿ä½¿ç”¨</li>
<li>æ— éœ€æ¸…é™¤ä¸Šä¸€è½®æ ‡è®°ä½</li>
<li>èŠ‚çœæ ‡è®°é‡ç½®æ—¶é—´</li>
</ul>
<p><strong>âœ… æ”¯æŒå¤§å †</strong></p>
<ul>
<li>42ä½åœ°å€æ”¯æŒ4TBå †</li>
<li>åœé¡¿æ—¶é—´ä¸å †å¤§å°æ— å…³</li>
</ul>
<p><strong>âŒ ç¼ºç‚¹: è™šæ‹Ÿåœ°å€ç©ºé—´å¼€é”€</strong></p>
<ul>
<li>éœ€è¦3å€è™šæ‹Ÿåœ°å€ç©ºé—´</li>
<li>Linux x86-64: 128TBè™šæ‹Ÿåœ°å€ç©ºé—´,è¶³å¤Ÿä½¿ç”¨</li>
</ul>
<p><strong>âŒ ç¼ºç‚¹: è¯»å±éšœå¼€é”€</strong></p>
<ul>
<li>æ¯æ¬¡è¯»å–å¯¹è±¡å¼•ç”¨éƒ½éœ€è¦æ£€æŸ¥</li>
<li>ç°ä»£CPUåˆ†æ”¯é¢„æµ‹ä¼˜åŒ–åå½±å“è¾ƒå°</li>
</ul>
<h3 data-id="heading-40">3.6 ZGCçš„å‚æ•°è°ƒä¼˜</h3>
<h4 data-id="heading-41">3.6.1 æ ¸å¿ƒå‚æ•°</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ZGC</span>
-XX:+UseZGC

<span class="hljs-comment"># å †å¤§å° (å»ºè®®Xms = Xmx)</span>
-Xms16g -Xmx16g

<span class="hljs-comment"># å¹¶å‘GCçº¿ç¨‹æ•° (é»˜è®¤ParallelGCThreads/4)</span>
-XX:ConcGCThreads=4

<span class="hljs-comment"># å¹¶è¡ŒGCçº¿ç¨‹æ•° (é»˜è®¤ç­‰äºCPUæ ¸å¿ƒæ•°)</span>
-XX:ParallelGCThreads=8

<span class="hljs-comment"># è½¯æœ€å¤§å †å¤§å° (ZGCä¼šå°½åŠ›ä¸è¶…è¿‡æ­¤å€¼)</span>
-XX:SoftMaxHeapSize=14g

<span class="hljs-comment"># å…ƒç©ºé—´</span>
-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m
</code></pre>
<h4 data-id="heading-42">3.6.2 å®Œæ•´é…ç½®ç¤ºä¾‹</h4>
<p><strong>å¤§å†…å­˜åº”ç”¨ (16æ ¸32GB,å †24GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms24g -Xmx24g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=4 \
     -XX:ParallelGCThreads=16 \
     -XX:SoftMaxHeapSize=20g \
     -XX:MetaspaceSize=512m \
     -XX:MaxMetaspaceSize=1g \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/var/log/heapdump.hprof \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar application.jar
</code></pre>
<p><strong>è¶…å¤§å †åº”ç”¨ (32æ ¸128GB,å †96GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms96g -Xmx96g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=8 \
     -XX:ParallelGCThreads=32 \
     -XX:SoftMaxHeapSize=80g \
     -XX:MetaspaceSize=1g \
     -XX:MaxMetaspaceSize=2g \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar application.jar
</code></pre>
<hr/>
<h2 data-id="heading-43">å››ã€G1 vs ZGCå¯¹æ¯”åˆ†æ</h2>
<h3 data-id="heading-44">4.1 æ ¸å¿ƒæŠ€æœ¯å¯¹æ¯”</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>åˆ†åŒºè®¾è®¡</strong></td><td>Regionåˆ†åŒº (1MB-32MB)</td><td>Pageåˆ†åŒº (2MB, 32KB, 256KBä¸‰ç§)</td></tr><tr><td><strong>æ ‡è®°ç®—æ³•</strong></td><td>ä¸‰è‰²æ ‡è®° + SATB</td><td>ä¸‰è‰²æ ‡è®° + æŸ“è‰²æŒ‡é’ˆ</td></tr><tr><td><strong>å±éšœç±»å‹</strong></td><td>å†™å±éšœ (ç»´æŠ¤RSet) + å‰ç½®å†™å±éšœ (SATB)</td><td>è¯»å±éšœ (Load Barrier)</td></tr><tr><td><strong>é‡å®šä½</strong></td><td>å¤åˆ¶ç®—æ³• (STW)</td><td>å¹¶å‘é‡å®šä½ (è¯»å±éšœ + è½¬å‘è¡¨)</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>å•ä¸€è§†å›¾</td><td>å¤šé‡æ˜ å°„ (3ä¸ªè§†å›¾)</td></tr><tr><td><strong>GCä¿¡æ¯å­˜å‚¨</strong></td><td>å¯¹è±¡å¤´ (Mark Word)</td><td>æŒ‡é’ˆå…ƒæ•°æ®ä½</td></tr></tbody></table>
<h3 data-id="heading-45">4.2 æ€§èƒ½å¯¹æ¯”</h3>








































<table><thead><tr><th>æŒ‡æ ‡</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>åœé¡¿æ—¶é—´</strong></td><td>50-200ms</td><td>&lt; 10ms (é€šå¸¸ &lt; 1ms)</td></tr><tr><td><strong>ååé‡</strong></td><td>95-98%</td><td>85-95%</td></tr><tr><td><strong>å †å¤§å°</strong></td><td>4GB - 64GB (æœ€ä½³)</td><td>8GB - 16TB</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>é€šç”¨åœºæ™¯,å¹³è¡¡æ€§èƒ½</td><td>è¶…å¤§å †,æä½å»¶è¿Ÿ</td></tr><tr><td><strong>CPUå¼€é”€</strong></td><td>ä¸­ç­‰</td><td>è¾ƒé«˜ (è¯»å±éšœ)</td></tr><tr><td><strong>å†…å­˜å¼€é”€</strong></td><td>RSetå 5-10%</td><td>è™šæ‹Ÿåœ°å€ç©ºé—´3å€ (ç‰©ç†å†…å­˜ä¸å¢åŠ )</td></tr></tbody></table>
<h3 data-id="heading-46">4.3 GCæµç¨‹å¯¹æ¯”</h3>



































<table><thead><tr><th>GCé˜¶æ®µ</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>Young GC</strong></td><td>STW,20-100ms</td><td>æ— ç‹¬ç«‹Young GC,ç»Ÿä¸€æµç¨‹</td></tr><tr><td><strong>å¹¶å‘æ ‡è®°</strong></td><td>4é˜¶æ®µ,2ä¸ªSTW (åˆå§‹/æœ€ç»ˆæ ‡è®°)</td><td>7é˜¶æ®µ,3ä¸ªSTW (æ¯ä¸ª &lt; 1ms)</td></tr><tr><td><strong>Mixed GC</strong></td><td>STW,50-200ms,å›æ”¶éƒ¨åˆ†è€å¹´ä»£</td><td>æ— Mixed GCæ¦‚å¿µ</td></tr><tr><td><strong>é‡å®šä½</strong></td><td>STW,å¤åˆ¶å¯¹è±¡</td><td>å¹¶å‘,æ— STW</td></tr><tr><td><strong>Full GC</strong></td><td>å¯èƒ½å‘ç”Ÿ,åœé¡¿å‡ ç§’</td><td>å‡ ä¹ä¸å‘ç”Ÿ</td></tr></tbody></table>
<h3 data-id="heading-47">4.4 å‚æ•°å¤æ‚åº¦å¯¹æ¯”</h3>






























<table><thead><tr><th>ç»´åº¦</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒå‚æ•°</strong></td><td>~10ä¸ª</td><td>~5ä¸ª</td></tr><tr><td><strong>è°ƒä¼˜éš¾åº¦</strong></td><td>ä¸­ç­‰</td><td>ä½</td></tr><tr><td><strong>è‡ªé€‚åº”èƒ½åŠ›</strong></td><td>è¾ƒå¼º</td><td>æå¼º</td></tr><tr><td><strong>é»˜è®¤é…ç½®</strong></td><td>é€‚ç”¨å¤§å¤šæ•°åœºæ™¯</td><td>å¼€ç®±å³ç”¨</td></tr></tbody></table>
<h3 data-id="heading-48">4.5 é€‰æ‹©å»ºè®®</h3>
<p><strong>é€‰æ‹©G1çš„åœºæ™¯</strong>:</p>
<p>âœ… å †å†…å­˜ 4GB - 64GB
âœ… åœé¡¿æ—¶é—´è¦æ±‚ 50-200ms
âœ… è¿½æ±‚ååé‡å’Œå»¶è¿Ÿçš„å¹³è¡¡
âœ… é€šç”¨äº’è”ç½‘åº”ç”¨,ç”µå•†,ç¤¾äº¤,å†…å®¹å¹³å°
âœ… å¾®æœåŠ¡æ¶æ„</p>
<p><strong>é€‰æ‹©ZGCçš„åœºæ™¯</strong>:</p>
<p>âœ… å †å†…å­˜ â‰¥ 16GB,ç”šè‡³TBçº§
âœ… åœé¡¿æ—¶é—´è¦æ±‚ &lt; 10ms
âœ… ä½å»¶è¿Ÿä¼˜å…ˆçº§é«˜äºååé‡
âœ… é‡‘èäº¤æ˜“ç³»ç»Ÿ,å®æ—¶ç«ä»·,æ¸¸æˆæœåŠ¡å™¨
âœ… å¤§æ•°æ®å®æ—¶å¤„ç†,æµè®¡ç®—</p>
<hr/>
<h2 data-id="heading-49">äº”ã€ç”Ÿäº§ç¯å¢ƒåº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-50">5.1 ç”µå•†ç§’æ€ç³»ç»Ÿ (é€‰æ‹©G1)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>æµé‡å³°å€¼: ç§’æ€æ´»åŠ¨ç¬æ—¶QPSä»1000é£™å‡è‡³10ä¸‡</li>
<li>å †å†…å­˜: 8GB</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ: å¤§éƒ¨åˆ†å¯¹è±¡çŸ­ç”Ÿå‘½å‘¨æœŸ(HTTPè¯·æ±‚å¯¹è±¡ã€ç¼“å­˜å¯¹è±¡)</li>
<li>å»¶è¿Ÿè¦æ±‚: TP99 &lt; 200ms</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©G1</strong>:</p>
<ul>
<li>å †å†…å­˜8GB,G1é€‚ç”¨èŒƒå›´</li>
<li>åŠ¨æ€è°ƒæ•´æ–°ç”Ÿä»£å¤§å°,åº”å¯¹æµé‡å³°å€¼</li>
<li>Young GCé¢‘ç¹ä½†åœé¡¿æ—¶é—´çŸ­(50ms)</li>
<li>Mixed GCå¯æ§åˆ¶åœ¨100mså†…</li>
</ul>
<p><strong>G1é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms8g -Xmx8g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=100 \
     -XX:G1HeapRegionSize=8m \
     -XX:InitiatingHeapOccupancyPercent=40 \
     -XX:G1ReservePercent=15 \
     -XX:MetaspaceSize=256m \
     -XX:MaxMetaspaceSize=512m \
     -Xloggc:/var/log/gc.log \
     -jar seckill-service.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (Parallel GC)</th><th>è°ƒä¼˜å (G1)</th></tr></thead><tbody><tr><td>TP99å»¶è¿Ÿ</td><td>500ms</td><td>150ms</td></tr><tr><td>GCåœé¡¿</td><td>200-500ms</td><td>50-100ms</td></tr><tr><td>ååé‡</td><td>95%</td><td>96%</td></tr><tr><td>Full GCé¢‘ç‡</td><td>æ¯å°æ—¶2æ¬¡</td><td>åŸºæœ¬æ— Full GC</td></tr></tbody></table>
<h3 data-id="heading-51">5.2 é‡‘èæ”¯ä»˜ç³»ç»Ÿ (é€‰æ‹©ZGC)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>æµé‡: ç¨³å®šQPS 5000,å³°å€¼1ä¸‡</li>
<li>å †å†…å­˜: 32GB</li>
<li>å»¶è¿Ÿè¦æ±‚: <strong>æä½å»¶è¿Ÿ,TP99 &lt; 50ms,ä»»ä½•è¶…è¿‡100msçš„åœé¡¿éƒ½å¯èƒ½å¯¼è‡´äº¤æ˜“å¤±è´¥</strong></li>
<li>ç›‘ç®¡è¦æ±‚: æ”¯ä»˜å“åº”æ—¶é—´ &lt; 100ms</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©ZGC</strong>:</p>
<ul>
<li>å †å†…å­˜32GB,G1çš„Full GCå¯èƒ½è¾¾åˆ°1-2ç§’,ä¸å¯æ¥å—</li>
<li>ZGCåœé¡¿æ—¶é—´ &lt; 10ms,ä¸å †å¤§å°æ— å…³</li>
<li>é‡‘èç³»ç»Ÿå¯¹å»¶è¿Ÿæ•æ„Ÿ,æ„¿æ„ç‰ºç‰²5-10%ååé‡æ¢å–æä½åœé¡¿</li>
</ul>
<p><strong>ZGCé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms32g -Xmx32g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=8 \
     -XX:ParallelGCThreads=16 \
     -XX:SoftMaxHeapSize=28g \
     -XX:MetaspaceSize=512m \
     -XX:MaxMetaspaceSize=1g \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar payment-service.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (G1)</th><th>è°ƒä¼˜å (ZGC)</th></tr></thead><tbody><tr><td>TP99å»¶è¿Ÿ</td><td>120ms</td><td>45ms</td></tr><tr><td>GCåœé¡¿</td><td>50-150ms</td><td>&lt; 5ms</td></tr><tr><td>ååé‡</td><td>97%</td><td>92%</td></tr><tr><td>Full GCåœé¡¿</td><td>å¶å°”1-2ç§’</td><td>æ— Full GC</td></tr></tbody></table>
<h3 data-id="heading-52">5.3 å¤§æ•°æ®å®æ—¶è®¡ç®— (é€‰æ‹©ZGC)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>å®æ—¶æµå¤„ç†: Flinkä»»åŠ¡,å¤„ç†10äº¿æ¡/å¤©çš„æ—¥å¿—æ•°æ®</li>
<li>å †å†…å­˜: 64GB</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ: ä¸­é•¿ç”Ÿå‘½å‘¨æœŸ(çŠ¶æ€æ•°æ®ã€çª—å£æ•°æ®)</li>
<li>å»¶è¿Ÿè¦æ±‚: å¤„ç†å»¶è¿Ÿ &lt; 1ç§’,GCåœé¡¿ä¸èƒ½å½±å“å®æ—¶æ€§</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©ZGC</strong>:</p>
<ul>
<li>å †å†…å­˜64GB,G1çš„Mixed GCå¯èƒ½è¾¾åˆ°200-500ms</li>
<li>å®æ—¶è®¡ç®—å¯¹å»¶è¿Ÿæ•æ„Ÿ,é•¿æ—¶é—´GCå¯¼è‡´æ•°æ®ç§¯å‹</li>
<li>ZGCå¹¶å‘é‡å®šä½,å¯¹è®¡ç®—çº¿ç¨‹å½±å“æœ€å°</li>
</ul>
<p><strong>ZGCé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms64g -Xmx64g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=16 \
     -XX:ParallelGCThreads=32 \
     -XX:SoftMaxHeapSize=56g \
     -XX:MetaspaceSize=1g \
     -XX:MaxMetaspaceSize=2g \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar flink-taskmanager.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (G1)</th><th>è°ƒä¼˜å (ZGC)</th></tr></thead><tbody><tr><td>æ•°æ®å¤„ç†å»¶è¿Ÿ</td><td>800ms</td><td>400ms</td></tr><tr><td>GCåœé¡¿</td><td>100-300ms</td><td>&lt; 8ms</td></tr><tr><td>ååé‡</td><td>96%</td><td>90%</td></tr><tr><td>æ•°æ®ç§¯å‹</td><td>å¶å°”å‘ç”Ÿ</td><td>åŸºæœ¬æ— ç§¯å‹</td></tr></tbody></table>
<h3 data-id="heading-53">5.4 å¾®æœåŠ¡ç½‘å…³ (é€‰æ‹©G1)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>é«˜å¹¶å‘: QPS 2ä¸‡,å³°å€¼5ä¸‡</li>
<li>å †å†…å­˜: 4GB</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ: æçŸ­(HTTPè¯·æ±‚/å“åº”å¯¹è±¡)</li>
<li>å»¶è¿Ÿè¦æ±‚: TP99 &lt; 100ms</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©G1</strong>:</p>
<ul>
<li>å †å†…å­˜4GB,G1å¤Ÿç”¨</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæçŸ­,å¤§éƒ¨åˆ†åœ¨EdenåŒºå›æ”¶</li>
<li>Young GCé¢‘ç¹ä½†åœé¡¿æ—¶é—´çŸ­</li>
<li>G1çš„ååé‡ä¼˜äºZGC</li>
</ul>
<p><strong>G1é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms4g -Xmx4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=50 \
     -XX:G1HeapRegionSize=4m \
     -XX:G1NewSizePercent=40 \
     -XX:G1MaxNewSizePercent=60 \
     -XX:MetaspaceSize=128m \
     -XX:MaxMetaspaceSize=256m \
     -Xloggc:/var/log/gc.log \
     -jar gateway-service.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (CMS)</th><th>è°ƒä¼˜å (G1)</th></tr></thead><tbody><tr><td>TP99å»¶è¿Ÿ</td><td>150ms</td><td>80ms</td></tr><tr><td>GCåœé¡¿</td><td>20-100ms</td><td>20-50ms</td></tr><tr><td>ååé‡</td><td>93%</td><td>97%</td></tr><tr><td>Full GCé¢‘ç‡</td><td>æ¯å¤©2-3æ¬¡</td><td>åŸºæœ¬æ— Full GC</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-54">å…­ã€ç”Ÿäº§æ¡ˆä¾‹ä¸è°ƒä¼˜å®æˆ˜</h2>
<h3 data-id="heading-55">6.1 æ¡ˆä¾‹1: G1é¢‘ç¹Full GC</h3>
<p><strong>æ•…éšœç°è±¡</strong>:</p>
<p>æŸç”µå•†ç³»ç»Ÿ(å †8GB)ä½¿ç”¨G1,ç”Ÿäº§ç¯å¢ƒæ¯å°æ—¶è§¦å‘5-10æ¬¡Full GC,æ¯æ¬¡åœé¡¿2-3ç§’,å¯¼è‡´æ¥å£è¶…æ—¶ã€‚</p>
<p><strong>æ’æŸ¥è¿‡ç¨‹</strong>:</p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—</strong></p>
<pre><code class="hljs language-bash" lang="bash">grep <span class="hljs-string">"Full GC"</span> gc.log | <span class="hljs-built_in">tail</span> -20
</code></pre>
<p>å‘ç°Full GCé¢‘ç¹,å›æ”¶æ•ˆæœå·®(åªå›æ”¶500MB)ã€‚</p>
<p><strong>2. åˆ†æè§¦å‘åŸå› </strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2024-01-15T14:23:45.123</span><span class="hljs-string">+0800:</span> <span class="hljs-attr">7890.456:</span> [<span class="hljs-string">Full</span> <span class="hljs-string">GC</span> <span class="hljs-string">(Allocation</span> <span class="hljs-string">Failure)</span> <span class="hljs-string">7680M-&gt;7280M(8192M)</span>, <span class="hljs-number">2.3456789</span> <span class="hljs-string">secs</span>]
</code></pre>
<p>è§¦å‘åŸå› : <code>Allocation Failure</code> â†’ å¯¹è±¡åˆ†é…å¤±è´¥,æ™‹å‡å¤±è´¥ã€‚</p>
<p><strong>3. æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</strong></p>
<pre><code class="hljs language-bash" lang="bash">jstat -gc &lt;pid&gt; 1000 10
</code></pre>
<p>å‘ç°è€å¹´ä»£ä½¿ç”¨ç‡æŒç»­åœ¨90%ä»¥ä¸Šã€‚</p>
<p><strong>4. dumpå†…å­˜åˆ†æ</strong></p>
<pre><code class="hljs language-bash" lang="bash">jmap -dump:live,format=b,file=heap.hprof &lt;pid&gt;
</code></pre>
<p>ä½¿ç”¨MATåˆ†æ,å‘ç°å¤§é‡<code>byte[]</code>å¯¹è±¡,å ç”¨4GBå†…å­˜,å¼•ç”¨é“¾:</p>
<pre><code class="hljs language-arduino" lang="arduino">CacheManager.<span class="hljs-built_in">imageCache</span> (<span class="hljs-type">static</span>)
  â†“
ConcurrentHashMap
  â†“
SoftReference&lt;<span class="hljs-type">byte</span>[]&gt;  â† ç¼“å­˜çš„å›¾ç‰‡æ•°æ®
</code></pre>
<p><strong>é—®é¢˜å®šä½</strong>:</p>
<p>ä»£ç ä½¿ç”¨<code>SoftReference</code>ç¼“å­˜å›¾ç‰‡,ä½†ç¼“å­˜æ²¡æœ‰ä¸Šé™,å†…å­˜ä¸è¶³æ—¶é›†ä¸­å›æ”¶å¯¼è‡´é¢‘ç¹Full GCã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<p>ä½¿ç”¨Guava Cacheæ›¿ä»£SoftReference:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¿®å¤å‰</span>
Map&lt;String, SoftReference&lt;<span class="hljs-type">byte</span>[]&gt;&gt; imageCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-comment">// ä¿®å¤å</span>
Cache&lt;String, <span class="hljs-type">byte</span>[]&gt; imageCache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">5000</span>)              <span class="hljs-comment">// é™åˆ¶5000ä¸ª</span>
    .expireAfterWrite(<span class="hljs-number">1</span>, TimeUnit.HOURS)
    .build();
</code></pre>
<p><strong>è°ƒæ•´G1å‚æ•°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é™ä½å¹¶å‘æ ‡è®°è§¦å‘é˜ˆå€¼,æå‰è§¦å‘Mixed GC</span>
-XX:InitiatingHeapOccupancyPercent=35  <span class="hljs-comment"># ä»45%é™è‡³35%</span>

<span class="hljs-comment"># å¢åŠ ä¿ç•™ç©ºé—´,é˜²æ­¢æ™‹å‡å¤±è´¥</span>
-XX:G1ReservePercent=15  <span class="hljs-comment"># ä»10%å¢è‡³15%</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æ”¹å–„</th></tr></thead><tbody><tr><td>Full GCé¢‘ç‡</td><td>æ¯å°æ—¶5-10æ¬¡</td><td>åŸºæœ¬æ— </td><td><strong>99%â†“</strong></td></tr><tr><td>å †ä½¿ç”¨ç‡</td><td>90%</td><td>60%</td><td><strong>33%â†“</strong></td></tr><tr><td>TP99å»¶è¿Ÿ</td><td>2500ms</td><td>120ms</td><td><strong>95%â†“</strong></td></tr></tbody></table>
<h3 data-id="heading-56">6.2 æ¡ˆä¾‹2: ZGCå†…å­˜æ³„æ¼</h3>
<p><strong>æ•…éšœç°è±¡</strong>:</p>
<p>æŸæ”¯ä»˜ç³»ç»Ÿ(å †32GB)ä½¿ç”¨ZGC,è¿è¡Œ3å¤©å,å †ä½¿ç”¨ç‡æŒç»­å¢é•¿è‡³95%,è§¦å‘é¢‘ç¹GC,ä½†å›æ”¶æ•ˆæœå·®ã€‚</p>
<p><strong>æ’æŸ¥è¿‡ç¨‹</strong>:</p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">tail</span> -1000 gc.log | grep <span class="hljs-string">"Heap: "</span>
</code></pre>
<p>å‘ç°å †ä½¿ç”¨ç‡ä»60%é€æ­¥å¢é•¿åˆ°95%,GCæ— æ³•æœ‰æ•ˆå›æ”¶ã€‚</p>
<p><strong>2. å¯¹æ¯”ä¸åŒæ—¶é—´ç‚¹çš„heap dump</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¬¬1å¤©</span>
jmap -dump:live,format=b,file=heap_day1.hprof &lt;pid&gt;

<span class="hljs-comment"># ç¬¬3å¤©</span>
jmap -dump:live,format=b,file=heap_day3.hprof &lt;pid&gt;
</code></pre>
<p><strong>3. MATå¯¹æ¯”åˆ†æ</strong></p>
<p>ä½¿ç”¨MATçš„Histogramå¯¹æ¯”åŠŸèƒ½,å‘ç°:</p>
<ul>
<li><code>java.util.concurrent.ConcurrentHashMap$Node</code>å¯¹è±¡æ•°é‡ä»10ä¸‡å¢é•¿åˆ°500ä¸‡</li>
<li>å ç”¨å†…å­˜ä»500MBå¢é•¿åˆ°15GB</li>
</ul>
<p><strong>4. å®šä½æ³„æ¼ä»£ç </strong></p>
<p>é€šè¿‡Dominator Tree,æ‰¾åˆ°å¼•ç”¨é“¾:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">RequestContextHolder</span> (<span class="hljs-keyword">static</span>)
  â†“
<span class="hljs-title class_">ThreadLocal</span>&lt;<span class="hljs-title class_">RequestContext</span>&gt;
  â†“
<span class="hljs-title class_">ConcurrentHashMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; (request attributes)
</code></pre>
<p><strong>é—®é¢˜å®šä½</strong>:</p>
<p>ä»£ç åœ¨æ¯ä¸ªè¯·æ±‚ä¸­å°†å¤§é‡æ•°æ®å­˜å…¥<code>ThreadLocal</code>,ä½†è¯·æ±‚ç»“æŸåæœªæ¸…ç†,å¯¼è‡´çº¿ç¨‹æ± åœºæ™¯ä¸‹<code>ThreadLocal</code>æ³„æ¼ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é—®é¢˜ä»£ç </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;RequestContext&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> {
        context.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestContext</span>(request));
        chain.doFilter(request, response);
        <span class="hljs-comment">// âŒ å¿˜è®°æ¸…ç†!</span>
    }
}

<span class="hljs-comment">// ä¿®å¤å</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;RequestContext&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> {
        <span class="hljs-keyword">try</span> {
            context.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestContext</span>(request));
            chain.doFilter(request, response);
        } <span class="hljs-keyword">finally</span> {
            context.remove();  <span class="hljs-comment">// âœ… æ¸…ç†ThreadLocal</span>
        }
    }
}
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æ”¹å–„</th></tr></thead><tbody><tr><td>å †ä½¿ç”¨ç‡</td><td>95%</td><td>60%</td><td><strong>37%â†“</strong></td></tr><tr><td>GCé¢‘ç‡</td><td>æ¯åˆ†é’Ÿ10æ¬¡</td><td>æ¯10åˆ†é’Ÿ1æ¬¡</td><td><strong>99%â†“</strong></td></tr><tr><td>å†…å­˜æ³„æ¼</td><td>æ¯å¤©å¢é•¿5GB</td><td>æ— å¢é•¿</td><td><strong>100%ä¿®å¤</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-57">ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­”</h2>
<h3 data-id="heading-58">7.1 G1å’ŒZGCå¦‚ä½•é€‰æ‹©?</h3>
<p><strong>å†³ç­–æ ‘</strong>:</p>
<pre><code class="hljs language-objectivec" lang="objectivec">å †å†…å­˜å¤§å°?
  â”œâ”€â”€ &lt; <span class="hljs-number">4</span>GB  â†’ G1 æˆ– <span class="hljs-built_in">CMS</span>
  â”œâ”€â”€ <span class="hljs-number">4</span><span class="hljs-number">-16</span>GB â†’ G1
  â”œâ”€â”€ <span class="hljs-number">16</span><span class="hljs-number">-64</span>GB â†’ G1 æˆ– ZGC (æ ¹æ®å»¶è¿Ÿè¦æ±‚)
  â””â”€â”€ â‰¥ <span class="hljs-number">64</span>GB  â†’ ZGC

å»¶è¿Ÿè¦æ±‚?
  â”œâ”€â”€ TP99 &lt; <span class="hljs-number">10</span>ms  â†’ ZGC
  â”œâ”€â”€ TP99 &lt; <span class="hljs-number">100</span>ms â†’ G1
  â””â”€â”€ ååé‡ä¼˜å…ˆ â†’ G1

åº”ç”¨ç±»å‹?
  â”œâ”€â”€ é‡‘èäº¤æ˜“ã€å®æ—¶ç³»ç»Ÿ â†’ ZGC
  â”œâ”€â”€ ç”µå•†ã€ç¤¾äº¤ã€å†…å®¹å¹³å° â†’ G1
  â”œâ”€â”€ å¤§æ•°æ®å®æ—¶è®¡ç®— â†’ ZGC
  â””â”€â”€ å¾®æœåŠ¡ã€ç½‘å…³ â†’ G1
</code></pre>
<h3 data-id="heading-59">7.2 G1çš„MaxGCPauseMilliså¦‚ä½•è®¾ç½®?</h3>
<p><strong>åŸåˆ™</strong>:</p>
<ul>
<li>è¿™æ˜¯è½¯ç›®æ ‡,G1ä¼šå°½åŠ›è¾¾æˆä½†ä¸ä¿è¯</li>
<li>è®¾ç½®è¿‡å°(å¦‚10ms),G1æ— æ³•è¾¾æˆ,å¯èƒ½é¢‘ç¹è§¦å‘Full GC</li>
<li>è®¾ç½®è¿‡å¤§(å¦‚500ms),å¤±å»G1çš„ä½å»¶è¿Ÿä¼˜åŠ¿</li>
</ul>
<p><strong>å»ºè®®</strong>:</p>
<ul>
<li>é€šç”¨åº”ç”¨: 100-200ms</li>
<li>ä½å»¶è¿Ÿåº”ç”¨: 50-100ms</li>
<li>ååé‡ä¼˜å…ˆ: 200-500ms</li>
</ul>
<p><strong>éªŒè¯æ–¹æ³•</strong>:</p>
<p>æŸ¥çœ‹GCæ—¥å¿—,ç¡®è®¤å®é™…åœé¡¿æ—¶é—´:</p>
<pre><code class="hljs language-bash" lang="bash">grep <span class="hljs-string">"GC pause"</span> gc.log | awk <span class="hljs-string">'{print $NF}'</span> | <span class="hljs-built_in">sort</span> -n | <span class="hljs-built_in">tail</span> -100
</code></pre>
<p>å¦‚æœå®é™…åœé¡¿æ—¶é—´è¿œè¶…ç›®æ ‡,è€ƒè™‘:</p>
<ul>
<li>å¢å¤§å †å†…å­˜</li>
<li>é™ä½<code>InitiatingHeapOccupancyPercent</code>,æå‰è§¦å‘å¹¶å‘æ ‡è®°</li>
<li>å¢åŠ å¹¶å‘GCçº¿ç¨‹æ•°</li>
</ul>
<h3 data-id="heading-60">7.3 ä¸ºä»€ä¹ˆG1ä»ç„¶ä¼šè§¦å‘Full GC?</h3>
<p><strong>Full GCçš„è§¦å‘åœºæ™¯</strong>:</p>
<ol>
<li>
<p><strong>æ™‹å‡å¤±è´¥ (Promotion Failure)</strong>:</p>
<ul>
<li>Young GCæ—¶,è€å¹´ä»£æ²¡æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³æ™‹å‡å¯¹è±¡</li>
<li>è§£å†³: å¢å¤§å †å†…å­˜,é™ä½<code>InitiatingHeapOccupancyPercent</code></li>
</ul>
</li>
<li>
<p><strong>å·¨å‹å¯¹è±¡åˆ†é…å¤±è´¥ (Humongous Allocation Failure)</strong>:</p>
<ul>
<li>æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­Regionå­˜å‚¨å¤§å¯¹è±¡</li>
<li>è§£å†³: å¢å¤§<code>G1HeapRegionSize</code>,é¿å…å¤§å¯¹è±¡(ä¼˜åŒ–ä»£ç ,æ‹†åˆ†å¯¹è±¡)</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ¨¡å¼å¤±è´¥ (Concurrent Mode Failure)</strong>:</p>
<ul>
<li>å¹¶å‘æ ‡è®°æœªå®Œæˆ,è€å¹´ä»£å·²æ»¡</li>
<li>è§£å†³: é™ä½<code>InitiatingHeapOccupancyPercent</code>,å¢åŠ <code>ConcGCThreads</code></li>
</ul>
</li>
<li>
<p><strong>å…ƒç©ºé—´ä¸è¶³</strong>:</p>
<ul>
<li>Metaspace OOM</li>
<li>è§£å†³: å¢å¤§<code>MaxMetaspaceSize</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-61">7.4 ZGCæœ‰å“ªäº›é™åˆ¶?</h3>
<p><strong>ZGCçš„é™åˆ¶</strong>:</p>
<ol>
<li>
<p><strong>JDKç‰ˆæœ¬</strong>:</p>
<ul>
<li>JDK 11: å®éªŒæ€§ç‰¹æ€§ (<code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code>)</li>
<li>JDK 15+: æ­£å¼ç‰¹æ€§ (<code>-XX:+UseZGC</code>)</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œç³»ç»Ÿ</strong>:</p>
<ul>
<li>Linux (x86-64): å®Œå…¨æ”¯æŒ</li>
<li>macOS: JDK 14+æ”¯æŒ</li>
<li>Windows: JDK 14+æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>å †å¤§å°</strong>:</p>
<ul>
<li>æœ€å°: 8GB (å»ºè®®)</li>
<li>æœ€å¤§: 16TB (ç†è®ºä¸Š)</li>
<li>å®é™…ç”Ÿäº§: 16GB - 512GB</li>
</ul>
</li>
<li>
<p><strong>CPUå¼€é”€</strong>:</p>
<ul>
<li>è¯»å±éšœå¸¦æ¥é¢å¤–CPUå¼€é”€</li>
<li>å¹¶å‘GCçº¿ç¨‹å ç”¨CPU</li>
<li>ååé‡æŸå¤±5-15%</li>
</ul>
</li>
<li>
<p><strong>ä¸æ”¯æŒå‹ç¼©ç±»æŒ‡é’ˆ</strong>:</p>
<ul>
<li>ZGCä¸æ”¯æŒ<code>-XX:+UseCompressedClassPointers</code></li>
<li>å…ƒç©ºé—´å ç”¨ç•¥é«˜</li>
</ul>
</li>
</ol>
<h3 data-id="heading-62">7.5 å¦‚ä½•ç›‘æ§G1å’ŒZGCçš„æ€§èƒ½?</h3>
<p><strong>GCæ—¥å¿—åˆ†æ</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># JDK 8åŠä¹‹å‰ (G1)</span>
-XX:+PrintGCDetails
-XX:+PrintGCDateStamps
-Xloggc:/var/log/gc.log

<span class="hljs-comment"># JDK 9+ (G1/ZGC)</span>
-Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags
</code></pre>
<p><strong>åœ¨çº¿åˆ†æå·¥å…·</strong>:</p>
<ul>
<li><strong>GCEasy</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgceasy.io" target="_blank" title="https://gceasy.io" ref="nofollow noopener noreferrer">gceasy.io</a> (å…è´¹,å¯è§†åŒ–GCæ—¥å¿—)</li>
<li><strong>GCViewer</strong>: å¼€æºGCæ—¥å¿—åˆ†æå·¥å…·</li>
</ul>
<p><strong>å…³é”®æŒ‡æ ‡</strong>:</p>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>G1ç›®æ ‡</th><th>ZGCç›®æ ‡</th></tr></thead><tbody><tr><td>ååé‡</td><td>â‰¥ 95%</td><td>â‰¥ 90%</td></tr><tr><td>Young GCåœé¡¿</td><td>&lt; 100ms</td><td>N/A</td></tr><tr><td>Mixed GCåœé¡¿</td><td>&lt; 200ms</td><td>N/A</td></tr><tr><td>ZGCåœé¡¿</td><td>N/A</td><td>&lt; 10ms</td></tr><tr><td>Full GCé¢‘ç‡</td><td>0</td><td>0</td></tr></tbody></table>
<p><strong>APMç³»ç»Ÿé›†æˆ</strong>:</p>
<ul>
<li>Prometheus + Grafana</li>
<li>SkyWalking</li>
<li>Arthas dashboard</li>
</ul>
<hr/>
<h2 data-id="heading-63">å…«ã€æœ€ä½³å®è·µä¸å»ºè®®</h2>
<h3 data-id="heading-64">8.1 G1æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-65">8.1.1 å‚æ•°é…ç½®Checklist</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-Xms</code> = <code>-Xmx</code> (é¿å…åŠ¨æ€æ‰©å®¹)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å †å¤§å° = ç‰©ç†å†…å­˜çš„60-80%</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:MaxGCPauseMillis=100-200</code> (æ ¹æ®ä¸šåŠ¡è°ƒæ•´)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:G1HeapRegionSize</code> æ‰‹åŠ¨è®¾ç½®(å † â‰¥ 16GBæ—¶)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:InitiatingHeapOccupancyPercent=40-45</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:G1ReservePercent=10-15</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¼€å¯GCæ—¥å¿—,é…ç½®æ—¥å¿—æ»šåŠ¨</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:+HeapDumpOnOutOfMemoryError</code></li>
</ul>
<h4 data-id="heading-66">8.1.2 ä»£ç å±‚é¢ä¼˜åŒ–</h4>
<p><strong>é¿å…å¤§å¯¹è±¡</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: åˆ›å»ºå¤§æ•°ç»„</span>
<span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];  <span class="hljs-comment">// 10MB,å¯èƒ½æˆä¸ºHumongouså¯¹è±¡</span>

<span class="hljs-comment">// âœ… æ­£ç¡®: ä½¿ç”¨å¯¹è±¡æ± </span>
<span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> bufferPool.acquire();
</code></pre>
<p><strong>åŠæ—¶é‡Šæ”¾èµ„æº</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: èµ„æºæ³„æ¼</span>
<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> dataSource.getConnection();
<span class="hljs-comment">// å¿˜è®°close()</span>

<span class="hljs-comment">// âœ… æ­£ç¡®: try-with-resources</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> dataSource.getConnection()) {
    <span class="hljs-comment">// ä½¿ç”¨conn</span>
}  <span class="hljs-comment">// è‡ªåŠ¨close()</span>
</code></pre>
<p><strong>ä½¿ç”¨æœ¬åœ°å˜é‡</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: é™æ€é›†åˆæŒæœ‰å¯¹è±¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-comment">// æ°¸ä¸æ¸…ç†,æ³„æ¼!</span>
}

<span class="hljs-comment">// âœ… æ­£ç¡®: ä½¿ç”¨Guava Cache</span>
Cache&lt;String, Object&gt; cache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">10000</span>)
    .expireAfterWrite(<span class="hljs-number">30</span>, TimeUnit.MINUTES)
    .build();
</code></pre>
<h3 data-id="heading-67">8.2 ZGCæœ€ä½³å®è·µ</h3>
<h4 data-id="heading-68">8.2.1 å‚æ•°é…ç½®Checklist</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-Xms</code> = <code>-Xmx</code> (é¿å…åŠ¨æ€æ‰©å®¹)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å †å¤§å° â‰¥ 16GB</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:SoftMaxHeapSize</code> è®¾ç½®ä¸ºXmxçš„80-90%</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:ConcGCThreads</code> æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å…ƒç©ºé—´é…ç½® (ZGCä¸æ”¯æŒå‹ç¼©ç±»æŒ‡é’ˆ)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¼€å¯GCæ—¥å¿— (ä½¿ç”¨JDK 9+ç»Ÿä¸€æ—¥å¿—æ ¼å¼)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:+HeapDumpOnOutOfMemoryError</code></li>
</ul>
<h4 data-id="heading-69">8.2.2 é€‚ç”¨åœºæ™¯è¯„ä¼°</h4>
<p><strong>ZGCé€‚åˆ</strong>:</p>
<p>âœ… å †å†…å­˜ â‰¥ 16GB
âœ… å»¶è¿Ÿæ•æ„Ÿåº”ç”¨ (TP99 &lt; 10ms)
âœ… æ„¿æ„ç‰ºç‰²5-15%ååé‡æ¢å–ä½å»¶è¿Ÿ
âœ… JDK 15+</p>
<p><strong>ZGCä¸é€‚åˆ</strong>:</p>
<p>âŒ å°å †åº”ç”¨ (&lt; 8GB)
âŒ ååé‡ä¼˜å…ˆåœºæ™¯
âŒ JDK 8/11 (éœ€è¦å‡çº§åˆ°JDK 15+)
âŒ CPUèµ„æºç´§å¼ çš„ç¯å¢ƒ</p>
<h3 data-id="heading-70">8.3 è°ƒä¼˜æµç¨‹</h3>
<h4 data-id="heading-71">8.3.1 æ€§èƒ½åŸºçº¿å»ºç«‹</h4>
<ol>
<li>
<p><strong>æ”¶é›†å½“å‰æ€§èƒ½æ•°æ®</strong> (è‡³å°‘24å°æ—¶):</p>
<ul>
<li>GCæ—¥å¿—</li>
<li>æ¥å£RT/TP99</li>
<li>ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ (CPU/å†…å­˜/IO)</li>
<li>ä¸šåŠ¡æŒ‡æ ‡ (QPS/TPS/é”™è¯¯ç‡)</li>
</ul>
</li>
<li>
<p><strong>åˆ†æå½“å‰ç“¶é¢ˆ</strong>:</p>
<ul>
<li>GCé¢‘ç‡è¿‡é«˜?</li>
<li>GCåœé¡¿è¿‡é•¿?</li>
<li>å †ä½¿ç”¨ç‡è¿‡é«˜?</li>
<li>Full GCé¢‘ç¹?</li>
</ul>
</li>
</ol>
<h4 data-id="heading-72">8.3.2 è°ƒä¼˜æ­¥éª¤</h4>
<ol>
<li><strong>å°æ­¥å¿«è·‘</strong>: æ¯æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°</li>
<li><strong>å‹æµ‹éªŒè¯</strong>: æ¨¡æ‹Ÿç”Ÿäº§æµé‡å‹æµ‹</li>
<li><strong>ç°åº¦å‘å¸ƒ</strong>: 10% â†’ 50% â†’ 100%</li>
<li><strong>æŒç»­ç›‘æ§</strong>: è§‚å¯Ÿ7å¤©,ç¡®ä¿æ— å¼‚å¸¸</li>
</ol>
<h4 data-id="heading-73">8.3.3 ç›‘æ§å‘Šè­¦</h4>
<p>è®¾ç½®å‘Šè­¦é˜ˆå€¼:</p>
<ul>
<li>Full GCé¢‘ç‡ &gt; 1æ¬¡/å°æ—¶</li>
<li>å †ä½¿ç”¨ç‡ &gt; 80%</li>
<li>GCåœé¡¿ &gt; ç›®æ ‡å€¼ (G1: 200ms, ZGC: 10ms)</li>
<li>æ¥å£TP99 &gt; ä¸šåŠ¡ç›®æ ‡</li>
</ul>
<h3 data-id="heading-74">8.4 å¸¸è§é™·é˜±</h3>
<p><strong>é™·é˜±1: ç›²ç›®è¿½æ±‚MaxGCPauseMillis</strong></p>
<p>è®¾ç½®è¿‡å°çš„åœé¡¿ç›®æ ‡(å¦‚10ms),G1æ— æ³•è¾¾æˆ,å¯èƒ½é¢‘ç¹è§¦å‘Full GCã€‚</p>
<p><strong>é™·é˜±2: å¿½ç•¥ååé‡</strong></p>
<p>ZGCä½å»¶è¿Ÿçš„ä»£ä»·æ˜¯ååé‡ä¸‹é™5-15%,éœ€è¦è¯„ä¼°ä¸šåŠ¡æ˜¯å¦å¯æ¥å—ã€‚</p>
<p><strong>é™·é˜±3: ä¸ç›‘æ§GCæ—¥å¿—</strong></p>
<p>GCæ—¥å¿—æ˜¯è°ƒä¼˜çš„åŸºç¡€,å¿…é¡»å¼€å¯å¹¶å®šæœŸåˆ†æã€‚</p>
<p><strong>é™·é˜±4: ä»£ç é—®é¢˜é GCè§£å†³</strong></p>
<p>å†…å­˜æ³„æ¼ã€å¤§å¯¹è±¡é¢‘ç¹åˆ›å»ºç­‰ä»£ç é—®é¢˜,è°ƒæ•´GCå‚æ•°æ— æ³•æ ¹æ²»,å¿…é¡»ä¼˜åŒ–ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-75">æ€»ç»“</h2>
<p>G1å’ŒZGCä»£è¡¨äº†Java GCæŠ€æœ¯çš„æ¼”è¿›æ–¹å‘,ä»å¹³è¡¡æ€§èƒ½åˆ°æè‡´ä½å»¶è¿Ÿã€‚<strong>G1é€šè¿‡Regionåˆ†åŒºã€RSetå’ŒSATBç®—æ³•,å®ç°å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´,é€‚ç”¨äº4GB-64GBå †çš„é€šç”¨åœºæ™¯;ZGCé€šè¿‡æŸ“è‰²æŒ‡é’ˆã€è¯»å±éšœå’Œå¹¶å‘é‡å®šä½,å®ç°&lt; 10msçš„è¶…ä½åœé¡¿,ä¸“ä¸ºè¶…å¤§å †å’Œæä½å»¶è¿Ÿåœºæ™¯è®¾è®¡ã€‚</strong></p>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>:</p>
<ol>
<li><strong>Regionè®¾è®¡</strong>: G1çš„æ ¸å¿ƒåˆ›æ–°,æ‰“ç ´å›ºå®šåˆ†ä»£è¾¹ç•Œ,æ”¯æŒåŠ¨æ€è°ƒæ•´</li>
<li><strong>RSetæœºåˆ¶</strong>: è®°å½•è·¨Regionå¼•ç”¨,é¿å…å…¨å †æ‰«æ,å¤§å¹…æå‡Young GCæ•ˆç‡</li>
<li><strong>SATBç®—æ³•</strong>: G1çš„å¹¶å‘æ ‡è®°å®ç°,ä¿è¯ä¸æ¼æ ‡å¯¹è±¡,ä»£ä»·æ˜¯æµ®åŠ¨åƒåœ¾</li>
<li><strong>æŸ“è‰²æŒ‡é’ˆ</strong>: ZGCçš„æ ¸å¿ƒåˆ›æ–°,å°†GCä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­,å®ç°å¹¶å‘æ ‡è®°å’Œé‡å®šä½</li>
<li><strong>è¯»å±éšœ</strong>: ZGCçš„å…³é”®æŠ€æœ¯,å¯¹è±¡è®¿é—®æ—¶è‡ªåŠ¨å¤„ç†é‡å®šä½,æ— éœ€STW</li>
<li><strong>å¤šé‡æ˜ å°„</strong>: ZGCçš„å†…å­˜ç®¡ç†æŠ€æœ¯,åŒä¸€ç‰©ç†å†…å­˜æ˜ å°„åˆ°å¤šä¸ªè™šæ‹Ÿåœ°å€,å®ç°å¹¶å‘å®‰å…¨</li>
</ol>
<p><strong>é€‰æ‹©å»ºè®®</strong>:</p>
<ul>
<li><strong>å † &lt; 16GB,å»¶è¿Ÿè¦æ±‚ä¸­ç­‰</strong>: é€‰æ‹©G1,å¹³è¡¡æ€§èƒ½,ååé‡é«˜</li>
<li><strong>å † â‰¥ 16GB,å»¶è¿Ÿè¦æ±‚æé«˜</strong>: é€‰æ‹©ZGC,è¶…ä½åœé¡¿,ä»£ä»·æ˜¯ååé‡ä¸‹é™</li>
<li><strong>é€šç”¨äº’è”ç½‘åº”ç”¨</strong>: G1æ˜¯é¦–é€‰,å¼€ç®±å³ç”¨,è°ƒä¼˜ç®€å•</li>
<li><strong>é‡‘èã€å®æ—¶ç³»ç»Ÿ</strong>: ZGCæ˜¯é¦–é€‰,ä½å»¶è¿Ÿä¼˜å…ˆçº§é«˜äºååé‡</li>
</ul>
<p><strong>è°ƒä¼˜åŸåˆ™</strong>:</p>
<ul>
<li>å»ºç«‹æ€§èƒ½åŸºçº¿,å°æ­¥å¿«è·‘,å‹æµ‹éªŒè¯,ç°åº¦å‘å¸ƒ</li>
<li>ä»£ç ä¼˜åŒ–ä¼˜äºå‚æ•°è°ƒä¼˜,é¿å…å†…å­˜æ³„æ¼å’Œå¤§å¯¹è±¡</li>
<li>æŒç»­ç›‘æ§GCæ—¥å¿—,å®šæœŸReviewæ€§èƒ½æ•°æ®</li>
<li>æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨,ä¸è¦ç›²ç›®è¿½æ±‚æ–°æŠ€æœ¯</li>
</ul>
<p>æŒæ¡G1å’ŒZGCçš„åŸç†ä¸è°ƒä¼˜,èƒ½å¤Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ¸¸åˆƒæœ‰ä½™åœ°è¿›è¡ŒGCè°ƒä¼˜,æå‡ç³»ç»Ÿæ€§èƒ½,é™ä½æ•…éšœé£é™©ã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>:</p>
<ul>
<li>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº:JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬3ç‰ˆ)ã€‹- å‘¨å¿—æ˜</li>
<li>ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹- Scott Oaks</li>
<li>Oracleå®˜æ–¹JVMæ–‡æ¡£</li>
<li>OpenJDK ZGCå®˜æ–¹æ–‡æ¡£</li>
<li>GCEasy: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgceasy.io" target="_blank" title="https://gceasy.io" ref="nofollow noopener noreferrer">gceasy.io</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹]]></title>    <link>https://juejin.cn/post/7585474459776761892</link>    <guid>https://juejin.cn/post/7585474459776761892</guid>    <pubDate>2025-12-20T11:36:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776761892" data-draft-id="7585468725332574262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2025-12-20T11:36:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:36:42.000Z" title="Sat Dec 20 2025 11:36:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»32åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>MySQLä½œä¸ºæœ€æµè¡Œçš„å¼€æºå…³ç³»å‹æ•°æ®åº“,åœ¨äº’è”ç½‘åº”ç”¨ä¸­æ‰®æ¼”ç€æ ¸å¿ƒè§’è‰²ã€‚ç†è§£MySQLçš„æ¶æ„åŸç†ä¸SQLæ‰§è¡Œæµç¨‹,æ˜¯æ¯ä½åç«¯å·¥ç¨‹å¸ˆçš„å¿…ä¿®è¯¾ã€‚æœ¬æ–‡ä»MySQLé€»è¾‘æ¶æ„ã€InnoDBå­˜å‚¨å¼•æ“ã€Buffer Poolç¼“å†²æ± ã€B+æ ‘ç´¢å¼•åŸç†ã€SQLæ‰§è¡Œæµç¨‹(SELECT/UPDATE)ã€EXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æç­‰å¤šä¸ªç»´åº¦,æ·±å…¥å‰–æMySQLçš„å†…éƒ¨è¿è¡Œæœºåˆ¶,å¹¶ç»“åˆç”Ÿäº§ç¯å¢ƒå®æˆ˜æ¡ˆä¾‹,è®²è§£æ…¢æŸ¥è¯¢ä¼˜åŒ–ã€ç´¢å¼•ä¼˜åŒ–ç­‰æœ€ä½³å®è·µ,å¸®åŠ©è¯»è€…æ„å»ºå®Œæ•´çš„MySQLæ€§èƒ½ä¼˜åŒ–çŸ¥è¯†ä½“ç³»,åœ¨é¢è¯•å’Œå®é™…å·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç†è®ºçŸ¥è¯†ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-2">1.1 MySQLçš„å®šä½ä¸ç‰¹ç‚¹</h3>
<p>MySQLæ˜¯ä¸€æ¬¾å¼€æºçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(RDBMS),ç”±ç‘å…¸MySQL ABå…¬å¸å¼€å‘,ç°å±äºOracleæ——ä¸‹äº§å“ã€‚MySQLå‡­å€Ÿå…¶é«˜æ€§èƒ½ã€é«˜å¯é æ€§ã€æ˜“ç”¨æ€§,æˆä¸ºäº’è”ç½‘åº”ç”¨çš„é¦–é€‰æ•°æ®åº“ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:</p>
<ul>
<li><strong>å¼€æºå…è´¹</strong>: ç¤¾åŒºç‰ˆ(GPLè®¸å¯)å…è´¹ä½¿ç”¨,é™ä½ä¼ä¸šæˆæœ¬</li>
<li><strong>è·¨å¹³å°</strong>: æ”¯æŒLinuxã€Windowsã€macOSç­‰å¤šç§æ“ä½œç³»ç»Ÿ</li>
<li><strong>é«˜æ€§èƒ½</strong>: æ”¯æŒåƒä¸‡çº§æ•°æ®è¡¨,QPSå¯è¾¾æ•°ä¸‡ç”šè‡³æ•°åä¸‡</li>
<li><strong>é«˜å¯ç”¨</strong>: æ”¯æŒä¸»ä»å¤åˆ¶ã€MGRé›†ç¾¤ç­‰é«˜å¯ç”¨æ–¹æ¡ˆ</li>
<li><strong>ä¸°å¯Œçš„å­˜å‚¨å¼•æ“</strong>: InnoDBã€MyISAMã€Memoryç­‰,æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚</li>
<li><strong>ACIDäº‹åŠ¡æ”¯æŒ</strong>: InnoDBå¼•æ“æ”¯æŒå®Œæ•´çš„ACIDäº‹åŠ¡ç‰¹æ€§</li>
<li><strong>å¼ºå¤§çš„ç¤¾åŒºæ”¯æŒ</strong>: åºå¤§çš„å¼€å‘è€…ç¤¾åŒº,ä¸°å¯Œçš„æ–‡æ¡£å’Œå·¥å…·</li>
</ul>
<h3 data-id="heading-3">1.2 InnoDB vs MyISAM</h3>
<p>MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“,å…¶ä¸­InnoDBå’ŒMyISAMæ˜¯æœ€å¸¸ç”¨çš„ä¸¤ç§:</p>
<p><strong>InnoDB (MySQL 5.5+é»˜è®¤å¼•æ“)</strong>:</p>
<ul>
<li>âœ… <strong>æ”¯æŒäº‹åŠ¡</strong>(ACIDç‰¹æ€§),é€‚åˆé‡‘èã€ç”µå•†ç­‰å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
<li>âœ… <strong>è¡Œçº§é”</strong>,å¹¶å‘æ€§èƒ½å¥½,æ”¯æŒé«˜å¹¶å‘å†™æ“ä½œ</li>
<li>âœ… <strong>æ”¯æŒå¤–é”®çº¦æŸ</strong>,ä¿è¯æ•°æ®å®Œæ•´æ€§</li>
<li>âœ… <strong>å´©æºƒæ¢å¤èƒ½åŠ›å¼º</strong>,é€šè¿‡Redo Logä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
<li>âœ… <strong>MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong>,æå‡è¯»å†™å¹¶å‘æ€§èƒ½</li>
<li>âŒ <strong>å ç”¨ç©ºé—´å¤§</strong>,æ¯ä¸ªè¡¨å¯¹åº”.ibdæ–‡ä»¶,åŒ…å«æ•°æ®å’Œç´¢å¼•</li>
</ul>
<p><strong>MyISAM (è€ç‰ˆæœ¬é»˜è®¤å¼•æ“)</strong>:</p>
<ul>
<li>âŒ <strong>ä¸æ”¯æŒäº‹åŠ¡</strong>,æ— æ³•ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li>âŒ <strong>è¡¨çº§é”</strong>,å¹¶å‘å†™æ€§èƒ½å·®</li>
<li>âŒ <strong>ä¸æ”¯æŒå¤–é”®çº¦æŸ</strong></li>
<li>âœ… <strong>æ’å…¥é€Ÿåº¦å¿«</strong>,é€‚åˆæ—¥å¿—ã€å†å²æ•°æ®ç­‰åªè¯»æˆ–å°‘å†™åœºæ™¯</li>
<li>âœ… <strong>å ç”¨ç©ºé—´å°</strong>,æ¯ä¸ªè¡¨å¯¹åº”3ä¸ªæ–‡ä»¶(.frm/.MYD/.MYI)</li>
</ul>
<p><strong>ç»“è®º</strong>: ç”Ÿäº§ç¯å¢ƒå¼ºçƒˆæ¨èä½¿ç”¨InnoDBå¼•æ“,MyISAMå·²é€æ­¥è¢«æ·˜æ±°ã€‚</p>
<h3 data-id="heading-4">1.3 æ ¸å¿ƒæ¦‚å¿µ</h3>
<p><strong>Buffer Pool (ç¼“å†²æ± )</strong>:</p>
<ul>
<li>InnoDBçš„æ ¸å¿ƒå†…å­˜ç»“æ„,ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/O</li>
<li>é»˜è®¤å¤§å°128MB,ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„50-80%</li>
<li>é‡‡ç”¨æ”¹è¿›çš„LRUç®—æ³•ç®¡ç†ç¼“å­˜,åˆ†ä¸ºYoungåŒºå’ŒOldåŒº</li>
</ul>
<p><strong>B+æ ‘</strong>:</p>
<ul>
<li>MySQLç´¢å¼•çš„åº•å±‚æ•°æ®ç»“æ„,éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼,æ‰€æœ‰æ•°æ®åœ¨å¶å­èŠ‚ç‚¹</li>
<li>3å±‚B+æ ‘èƒ½å­˜å‚¨çº¦2000ä¸‡è¡Œæ•°æ®,æŸ¥è¯¢åªéœ€3æ¬¡ç£ç›˜I/O</li>
<li>å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥,èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ</li>
</ul>
<p><strong>WAL (Write-Ahead Logging)</strong>:</p>
<ul>
<li>å…ˆå†™æ—¥å¿—,å†å†™æ•°æ®çš„æœºåˆ¶,æ ¸å¿ƒæ˜¯Redo Log</li>
<li>Redo Logé¡ºåºå†™(å¿«),æ•°æ®æ–‡ä»¶éšæœºå†™(æ…¢),å†™å…¥æ€§èƒ½æå‡10-100å€</li>
<li>å´©æºƒæ¢å¤æ—¶é€šè¿‡Redo Logé‡æ”¾,ä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<p><strong>2PC (Two-Phase Commit)</strong>:</p>
<ul>
<li>ä¸¤é˜¶æ®µæäº¤åè®®,ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§</li>
<li>æµç¨‹: Redo Log prepare â†’ å†™Binlog â†’ Redo Log commit</li>
<li>é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€MySQLé€»è¾‘æ¶æ„è¯¦è§£</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bd3db2455784f61929c84e1c5cba10a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=xa1KMdQ%2Fm9JVDrtbUB9WBmNUvG8%3D" alt="mysql-architecture.svg" loading="lazy"/></p>
<p>MySQLé‡‡ç”¨<strong>åˆ†å±‚æ¶æ„è®¾è®¡</strong>,ä»ä¸Šåˆ°ä¸‹åˆ†ä¸º3å±‚:è¿æ¥å±‚ã€SQLå±‚(Serverå±‚)ã€å­˜å‚¨å¼•æ“å±‚ã€‚è¿™ç§åˆ†å±‚è®¾è®¡å®ç°äº†Serverå±‚ä¸å­˜å‚¨å¼•æ“çš„è§£è€¦,æ”¯æŒæ’ä»¶å¼å­˜å‚¨å¼•æ“ã€‚</p>
<h3 data-id="heading-6">2.1 ç¬¬1å±‚: è¿æ¥å±‚ (Connector)</h3>
<p><strong>è¿æ¥å±‚è´Ÿè´£å®¢æˆ·ç«¯è¿æ¥ç®¡ç†,åŒ…æ‹¬è¿æ¥å»ºç«‹ã€èº«ä»½éªŒè¯ã€æƒé™è·å–ã€‚</strong></p>
<p><strong>è¿æ¥å»ºç«‹æµç¨‹</strong>:</p>
<ol>
<li><strong>TCPä¸‰æ¬¡æ¡æ‰‹</strong>: å®¢æˆ·ç«¯(å¦‚JDBCã€MySQLå‘½ä»¤è¡Œ)ä¸MySQL Serverå»ºç«‹TCPè¿æ¥</li>
<li><strong>èº«ä»½éªŒè¯</strong>: æœåŠ¡å™¨éªŒè¯ç”¨æˆ·åå’Œå¯†ç ,æŸ¥è¯¢<code>mysql.user</code>è¡¨</li>
<li><strong>æƒé™è·å–</strong>: éªŒè¯é€šè¿‡å,ä»æƒé™è¡¨ä¸­è¯»å–è¯¥ç”¨æˆ·çš„æƒé™ä¿¡æ¯,ç¼“å­˜åˆ°è¿æ¥å¯¹è±¡ä¸­</li>
<li><strong>åŠ å…¥è¿æ¥æ± </strong>: è¿æ¥åŠ å…¥è¿æ¥æ± ,å¯é€šè¿‡<code>SHOW PROCESSLIST</code>æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿æ¥</li>
</ol>
<p><strong>è¿æ¥ç±»å‹</strong>:</p>
<ul>
<li><strong>çŸ­è¿æ¥</strong>: æ¯æ¬¡æŸ¥è¯¢åç«‹å³æ–­å¼€,é€‚åˆä½é¢‘è®¿é—®åœºæ™¯</li>
<li><strong>é•¿è¿æ¥</strong>: ä¿æŒè¿æ¥ä¸æ–­å¼€,é€‚åˆé«˜é¢‘è®¿é—®åœºæ™¯(å¦‚Webåº”ç”¨)</li>
</ul>
<p><strong>é•¿è¿æ¥çš„é—®é¢˜</strong>: é•¿æ—¶é—´ä½¿ç”¨å,MySQL Serverå†…å­˜å ç”¨ä¼šæŒç»­å¢é•¿,å› ä¸ºè¿æ¥è¿‡ç¨‹ä¸­çš„ä¸´æ—¶å†…å­˜ä¸ä¼šé‡Šæ”¾ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li><strong>å®šæœŸæ–­å¼€é•¿è¿æ¥</strong>: è¿æ¥ä½¿ç”¨è¶…è¿‡ä¸€å®šæ—¶é—´(å¦‚8å°æ—¶)æˆ–æ‰§è¡Œè¿‡å¤§æŸ¥è¯¢å,ä¸»åŠ¨æ–­å¼€é‡è¿</li>
<li><strong>æ‰§è¡Œ<code>mysql_reset_connection</code></strong>: MySQL 5.7+æ”¯æŒ,é‡ç½®è¿æ¥çŠ¶æ€,é‡Šæ”¾ä¸´æ—¶å†…å­˜,æ— éœ€é‡æ–°å»ºç«‹è¿æ¥</li>
</ol>
<p><strong>å…³é”®å‚æ•°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">max_connections=1000         <span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°,é»˜è®¤151</span>
wait_timeout=28800           <span class="hljs-comment"># éäº¤äº’è¿æ¥è¶…æ—¶æ—¶é—´(ç§’),é»˜è®¤8å°æ—¶</span>
interactive_timeout=28800    <span class="hljs-comment"># äº¤äº’å¼è¿æ¥è¶…æ—¶æ—¶é—´(ç§’)</span>
</code></pre>
<h3 data-id="heading-7">2.2 ç¬¬2å±‚: SQLå±‚ (Serverå±‚) - æŸ¥è¯¢ç¼“å­˜</h3>
<p><strong>æŸ¥è¯¢ç¼“å­˜æ˜¯MySQL Serverå±‚çš„ç¬¬ä¸€é“å…³å¡,åœ¨MySQL 8.0å·²è¢«ç§»é™¤ã€‚</strong></p>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<ul>
<li>ä½¿ç”¨SQLè¯­å¥ä½œä¸ºkey,æŸ¥è¯¢ç»“æœä½œä¸ºvalue,å­˜å‚¨åˆ°ç¼“å­˜ä¸­</li>
<li>åç»­å®Œå…¨ç›¸åŒçš„SQLç›´æ¥è¿”å›ç¼“å­˜ç»“æœ,è·³è¿‡åç»­çš„åˆ†æã€ä¼˜åŒ–ã€æ‰§è¡Œæ­¥éª¤</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¢«ç§»é™¤?</strong></p>
<ol>
<li><strong>å‘½ä¸­ç‡æä½</strong>: SQLå¿…é¡»å®Œå…¨ç›¸åŒ(åŒ…æ‹¬ç©ºæ ¼ã€å¤§å°å†™),ç¨æœ‰å·®å¼‚å°±æ— æ³•å‘½ä¸­</li>
<li><strong>å¤±æ•ˆé¢‘ç¹</strong>: åªè¦è¡¨æœ‰ä»»ä½•æ›´æ–°(INSERT/UPDATE/DELETE),è¯¥è¡¨çš„æ‰€æœ‰æŸ¥è¯¢ç¼“å­˜å…¨éƒ¨å¤±æ•ˆ</li>
<li><strong>ç»´æŠ¤æˆæœ¬é«˜</strong>: ç¼“å­˜çš„åŠ é”ã€å¤±æ•ˆã€æ·˜æ±°æœºåˆ¶å¸¦æ¥é¢å¤–å¼€é”€</li>
<li><strong>é€‚ç”¨åœºæ™¯å°‘</strong>: åªé€‚åˆé™æ€è¡¨(å¦‚é…ç½®è¡¨ã€å­—å…¸è¡¨),å®é™…ç”Ÿäº§ä¸­æå°‘</li>
</ol>
<p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>: ä½¿ç”¨Redisã€Memcachedç­‰å¤–éƒ¨ç¼“å­˜ä¸­é—´ä»¶,æ›´çµæ´»ã€å‘½ä¸­ç‡æ›´é«˜ã€‚</p>
<h3 data-id="heading-8">2.3 ç¬¬3å±‚: SQLå±‚ (Serverå±‚) - åˆ†æå™¨</h3>
<p><strong>åˆ†æå™¨è´Ÿè´£å¯¹SQLè¯­å¥è¿›è¡Œè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æ,ç”Ÿæˆè¯­æ³•æ ‘(AST)ã€‚</strong></p>
<p><strong>è¯æ³•åˆ†æ (Lexical Analysis)</strong>:</p>
<p>å°†SQLå­—ç¬¦ä¸²æ‹†è§£ä¸ºä¸€ä¸ªä¸ªtoken(è¯æ³•å•å…ƒ):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>æ‹†è§£ç»“æœ:</p>
<ul>
<li>å…³é”®å­—: SELECT, FROM, WHERE, ORDER BY, LIMIT</li>
<li>æ ‡è¯†ç¬¦: id, name, age, users</li>
<li>å¸¸é‡: 25, 10</li>
<li>è¿ç®—ç¬¦: &gt;, =</li>
</ul>
<p><strong>è¯­æ³•åˆ†æ (Syntax Analysis)</strong>:</p>
<p>æ ¹æ®MySQLçš„è¯­æ³•è§„åˆ™,å°†tokenåºåˆ—ç»„ç»‡æˆè¯­æ³•æ ‘(Parse Tree / AST):</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span>
â”œâ”€â”€ <span class="hljs-keyword">SELECT</span> LIST: id, name, age
â”œâ”€â”€ <span class="hljs-keyword">FROM</span>: users
â”œâ”€â”€ <span class="hljs-keyword">WHERE</span>: age &gt; <span class="hljs-number">25</span>
â”œâ”€â”€ <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>: id
â””â”€â”€ LIMIT: <span class="hljs-number">10</span>
</code></pre>
<p><strong>è¯­æ³•é”™è¯¯æ£€æŸ¥</strong>:</p>
<p>å¦‚æœSQLä¸ç¬¦åˆè¯­æ³•è§„åˆ™,åˆ†æå™¨æŠ¥é”™:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> FORM users;  <span class="hljs-comment">-- é”™è¯¯: å…³é”®å­—æ‹¼å†™é”™è¯¯(FROMå†™æˆFORM)</span>
</code></pre>
<p>æŠ¥é”™ä¿¡æ¯: <code>You have an error in your SQL syntax; check the manual...</code></p>
<p><strong>è¾“å‡º</strong>: è¯­æ³•æ ‘(AST),ä¾›ä¼˜åŒ–å™¨ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-9">2.4 ç¬¬4å±‚: SQLå±‚ (Serverå±‚) - ä¼˜åŒ–å™¨</h3>
<p><strong>ä¼˜åŒ–å™¨è´Ÿè´£ç”Ÿæˆæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’,å†³å®šå¦‚ä½•é«˜æ•ˆåœ°æ‰§è¡ŒSQLã€‚</strong></p>
<p><strong>æ ¸å¿ƒä»»åŠ¡</strong>:</p>
<p><strong>1. ç´¢å¼•é€‰æ‹©</strong>:</p>
<p>æŸ¥è¯¢<code>users</code>è¡¨æœ‰å“ªäº›ç´¢å¼•å¯ç”¨:</p>
<ul>
<li>ä¸»é”®ç´¢å¼•: <code>PRIMARY KEY (id)</code></li>
<li>äºŒçº§ç´¢å¼•: <code>idx_age (age)</code>, <code>idx_name (name)</code>, <code>idx_age_name (age, name)</code></li>
</ul>
<p><strong>æˆæœ¬è®¡ç®— (CBO - Cost-Based Optimizer)</strong>:</p>
<p>MySQLä½¿ç”¨åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨,è®¡ç®—æ¯ç§æ‰§è¡Œæ–¹å¼çš„æˆæœ¬,é€‰æ‹©æˆæœ¬æœ€ä½çš„:</p>
<ul>
<li><strong>å…¨è¡¨æ‰«ææˆæœ¬</strong>: è¯»å–æ‰€æœ‰æ•°æ®é¡µçš„I/Oæˆæœ¬ + CPUè®¡ç®—æˆæœ¬</li>
<li><strong>ç´¢å¼•æ‰«ææˆæœ¬</strong>: è¯»å–ç´¢å¼•é¡µçš„I/Oæˆæœ¬ + å›è¡¨I/Oæˆæœ¬ + CPUæˆæœ¬</li>
</ul>
<p>æˆæœ¬å…¬å¼(ç®€åŒ–ç‰ˆ):</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Cost</span> = I/O_cost + CPU_cost
I/<span class="hljs-attr">O_cost</span> = pages_read Ã— io_cost_per_page
<span class="hljs-attr">CPU_cost</span> = rows_examined Ã— cpu_cost_per_row
</code></pre>
<p><strong>ç´¢å¼•é€‰æ‹©ç­–ç•¥</strong>:</p>
<ul>
<li>æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•: ä¼˜å…ˆä½¿ç”¨ç´¢å¼•</li>
<li>å¤šä¸ªç´¢å¼•å¯é€‰: é€‰æ‹©é€‰æ‹©æ€§æœ€é«˜çš„ç´¢å¼•(æ‰«æè¡Œæ•°æœ€å°‘)</li>
<li>ç´¢å¼•æ‰«ææˆæœ¬ &gt; å…¨è¡¨æ‰«ææˆæœ¬: ä½¿ç”¨å…¨è¡¨æ‰«æ(å¦‚æŸ¥è¯¢ç»“æœå è¡¨æ€»è¡Œæ•°çš„30%ä»¥ä¸Š)</li>
</ul>
<p><strong>2. JOINé¡ºåºä¼˜åŒ–</strong>:</p>
<p>å¤šè¡¨JOINæ—¶,JOINé¡ºåºå½±å“æ€§èƒ½:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">JOIN</span> products p <span class="hljs-keyword">ON</span> o.product_id <span class="hljs-operator">=</span> p.id
<span class="hljs-keyword">WHERE</span> u.age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;
</code></pre>
<p>å¯èƒ½çš„JOINé¡ºåº:</p>
<ul>
<li><code>orders â†’ users â†’ products</code></li>
<li><code>users â†’ orders â†’ products</code> (ä¼˜åŒ–å™¨å¯èƒ½é€‰æ‹©è¿™ä¸ª,å› ä¸ºå…ˆè¿‡æ»¤users.age &gt; 25,å‡å°‘JOINè¡Œæ•°)</li>
</ul>
<p><strong>3. å­æŸ¥è¯¢æ”¹å†™</strong>:</p>
<p>ä¼˜åŒ–å™¨å¯èƒ½å°†å­æŸ¥è¯¢æ”¹å†™ä¸ºJOIN:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åŸå§‹SQL (å­æŸ¥è¯¢)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>);

<span class="hljs-comment">-- ä¼˜åŒ–å™¨æ”¹å†™ä¸ºJOIN (å¯èƒ½æ›´é«˜æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> u.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users u
<span class="hljs-keyword">JOIN</span> orders o <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> o.user_id
<span class="hljs-keyword">WHERE</span> o.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>è¾“å‡º</strong>: æ‰§è¡Œè®¡åˆ’(Execution Plan),å¯é€šè¿‡<code>EXPLAIN</code>æŸ¥çœ‹ã€‚</p>
<h3 data-id="heading-10">2.5 ç¬¬5å±‚: SQLå±‚ (Serverå±‚) - æ‰§è¡Œå™¨</h3>
<p><strong>æ‰§è¡Œå™¨è´Ÿè´£æ‰§è¡ŒSQL,è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£é€è¡Œè¯»å–æ•°æ®ã€‚</strong></p>
<p><strong>æ‰§è¡Œæµç¨‹</strong>:</p>
<p><strong>1. æƒé™æ£€æŸ¥</strong>:</p>
<p>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è¯¥è¡¨çš„SELECTæƒé™(æƒé™åœ¨è¿æ¥é˜¶æ®µå·²è·å–):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;
</code></pre>
<p>å¦‚æœæ— æƒé™,æŠ¥é”™: <code>Access denied for user 'xxx'@'xxx' to table 'users'</code></p>
<p><strong>2. è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£</strong>:</p>
<p>æ‰§è¡Œå™¨è°ƒç”¨InnoDBå¼•æ“çš„readæ¥å£,ä¼ å…¥æ¡ä»¶<code>age &gt; 25</code>:</p>
<pre><code class="hljs language-ini" lang="ini">executor.read(<span class="hljs-attr">table</span>=<span class="hljs-string">"users"</span>, condition=<span class="hljs-string">"age &gt; 25"</span>)
</code></pre>
<p><strong>3. é€è¡Œè¯»å–æ•°æ®</strong>:</p>
<ul>
<li>InnoDBæ ¹æ®æ‰§è¡Œè®¡åˆ’(ä½¿ç”¨idx_ageç´¢å¼•)å®šä½æ•°æ®</li>
<li>é€šè¿‡B+æ ‘æŸ¥æ‰¾age &gt; 25çš„ç¬¬ä¸€è¡Œ</li>
<li>è¿”å›ç»™æ‰§è¡Œå™¨</li>
<li>æ‰§è¡Œå™¨ç»§ç»­è°ƒç”¨readæ¥å£,è¯»å–ä¸‹ä¸€è¡Œ</li>
<li>é‡å¤ç›´åˆ°è¯»å®Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¡Œ</li>
</ul>
<p><strong>4. è¿‡æ»¤ã€æ’åºã€é™åˆ¶</strong>:</p>
<ul>
<li>è¿‡æ»¤: WHEREæ¡ä»¶è¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„è¡Œ</li>
<li>æ’åº: ORDER BY id (å¯èƒ½ä½¿ç”¨idx_idç´¢å¼•é¿å…æ’åº,æˆ–ä½¿ç”¨filesort)</li>
<li>é™åˆ¶: LIMIT 10,åªè¿”å›å‰10è¡Œ</li>
</ul>
<p><strong>5. è¿”å›ç»“æœé›†</strong>:</p>
<p>æ‰§è¡Œå™¨å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><strong>6. è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</strong>:</p>
<p>å¦‚æœæŸ¥è¯¢æ—¶é—´ &gt; <code>long_query_time</code>(é»˜è®¤10ç§’),è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—:</p>
<pre><code class="hljs language-bash" lang="bash">slow_query_log=ON                          <span class="hljs-comment"># å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span>
long_query_time=1                          <span class="hljs-comment"># æ…¢æŸ¥è¯¢é˜ˆå€¼1ç§’</span>
slow_query_log_file=/var/log/mysql-slow.log
</code></pre>
<h3 data-id="heading-11">2.6 Serverå±‚æ€»ç»“</h3>
<p><strong>Serverå±‚æ˜¯MySQLçš„å¤§è„‘</strong>,è´Ÿè´£è¿æ¥ç®¡ç†ã€SQLè§£æã€ä¼˜åŒ–ã€æ‰§è¡Œ,ä¸å­˜å‚¨å¼•æ“æ— å…³ã€‚åŒä¸€æ¡SQL,æ— è®ºä½¿ç”¨InnoDBè¿˜æ˜¯MyISAM,Serverå±‚çš„å¤„ç†æµç¨‹å®Œå…¨ç›¸åŒ,åªæ˜¯æœ€åè°ƒç”¨çš„å­˜å‚¨å¼•æ“æ¥å£ä¸åŒã€‚</p>
<p><strong>Serverå±‚ä¸å­˜å‚¨å¼•æ“çš„åˆ†å±‚è®¾è®¡ä¼˜åŠ¿</strong>:</p>
<ul>
<li><strong>è§£è€¦</strong>: Serverå±‚ä¸“æ³¨SQLå¤„ç†,å­˜å‚¨å¼•æ“ä¸“æ³¨æ•°æ®å­˜å‚¨å’Œè¯»å†™</li>
<li><strong>æ’ä»¶å¼æ¶æ„</strong>: å¯è‡ªç”±åˆ‡æ¢å­˜å‚¨å¼•æ“(InnoDB/MyISAM/Memory),æ— éœ€ä¿®æ”¹SQL</li>
<li><strong>çµæ´»æ€§</strong>: ä¸åŒè¡¨å¯ä½¿ç”¨ä¸åŒå­˜å‚¨å¼•æ“,æ»¡è¶³ä¸åŒä¸šåŠ¡éœ€æ±‚</li>
</ul>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€InnoDBå­˜å‚¨å¼•æ“æ¶æ„</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c86e176846d846baa86acc68214e4753~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=4faIJMs8oQZ%2FHUCgKys0oSrPqp4%3D" alt="innodb-architecture.svg" loading="lazy"/>
InnoDBæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“(MySQL 5.5+),ä¸“ä¸ºäº‹åŠ¡å¤„ç†è®¾è®¡,æ¶æ„åˆ†ä¸º<strong>å†…å­˜ç»“æ„</strong>å’Œ<strong>ç£ç›˜ç»“æ„</strong>ä¸¤å¤§éƒ¨åˆ†ã€‚</p>
<h3 data-id="heading-13">3.1 InnoDBæ•´ä½“æ¶æ„</h3>
<p><strong>InnoDBçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³</strong>: <strong>å†…å­˜ä¼˜å…ˆ + WALæœºåˆ¶ + å´©æºƒæ¢å¤</strong></p>
<ul>
<li><strong>å†…å­˜ä¼˜å…ˆ</strong>: æ•°æ®ä¼˜å…ˆç¼“å­˜åˆ°Buffer Pool,å‡å°‘ç£ç›˜I/O</li>
<li><strong>WAL (Write-Ahead Logging)</strong>: å…ˆå†™æ—¥å¿—(Redo Log),å†å¼‚æ­¥åˆ·è„é¡µ,æå‡å†™å…¥æ€§èƒ½</li>
<li><strong>å´©æºƒæ¢å¤</strong>: é€šè¿‡Redo Logé‡æ”¾,ä¿è¯äº‹åŠ¡æŒä¹…æ€§(Durability)</li>
</ul>
<h3 data-id="heading-14">3.2 å†…å­˜ç»“æ„ (In-Memory Structure)</h3>
<p><strong>1. Buffer Pool (ç¼“å†²æ± )</strong>:</p>
<p><strong>Buffer Poolæ˜¯InnoDBæ€§èƒ½çš„æ ¸å¿ƒ</strong>,ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/Oã€‚</p>
<p><strong>ç¼“å­˜å†…å®¹</strong>:</p>
<ul>
<li>æ•°æ®é¡µ (Data Page): è¡¨çš„è¡Œæ•°æ®</li>
<li>ç´¢å¼•é¡µ (Index Page): B+æ ‘ç´¢å¼•èŠ‚ç‚¹</li>
<li>æ’å…¥ç¼“å†² (Insert Buffer): äºŒçº§ç´¢å¼•çš„æ’å…¥ç¼“å†²</li>
<li>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• (Adaptive Hash Index): InnoDBè‡ªåŠ¨åˆ›å»ºçš„å“ˆå¸Œç´¢å¼•</li>
<li>é”ä¿¡æ¯ (Lock Info): è¡Œé”ã€è¡¨é”ä¿¡æ¯</li>
</ul>
<p><strong>LRUé“¾è¡¨ç®¡ç†</strong>:</p>
<p>Buffer Poolé‡‡ç”¨æ”¹è¿›çš„LRU(Least Recently Used)ç®—æ³•ç®¡ç†ç¼“å­˜é¡µ,åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸ:</p>
<ul>
<li><strong>YoungåŒº</strong> (æ–°æ•°æ®åŒº): å Buffer Poolçš„5/8 (62.5%),å­˜æ”¾çƒ­æ•°æ®</li>
<li><strong>OldåŒº</strong> (è€æ•°æ®åŒº): å Buffer Poolçš„3/8 (37.5%),å­˜æ”¾å†·æ•°æ®</li>
</ul>
<p><strong>Midpointæ’å…¥ç­–ç•¥</strong>:</p>
<p>ä¼ ç»ŸLRUç®—æ³•çš„é—®é¢˜: å…¨è¡¨æ‰«æä¼šå°†å¤§é‡å†·æ•°æ®åŠ è½½åˆ°ç¼“å­˜,æŒ¤æ‰çƒ­æ•°æ®(ç¼“å­˜æ±¡æŸ“)ã€‚</p>
<p><strong>InnoDBçš„æ”¹è¿›</strong>:</p>
<ul>
<li>æ–°æ•°æ®é¡µä¸æ’å…¥é“¾è¡¨å¤´,è€Œæ˜¯æ’å…¥OldåŒºå¤´éƒ¨(Midpointä½ç½®)</li>
<li>åªæœ‰åœ¨OldåŒºåœç•™â‰¥1ç§’(<code>innodb_old_blocks_time=1000</code>)åå†æ¬¡è®¿é—®,æ‰ç§»åŠ¨åˆ°YoungåŒº</li>
<li>å…¨è¡¨æ‰«æçš„æ•°æ®é¡µåªåœç•™åœ¨OldåŒº,ä¸å½±å“YoungåŒºçš„çƒ­æ•°æ®</li>
</ul>
<p><strong>Buffer Poolå‚æ•°é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_buffer_pool_size=8G          <span class="hljs-comment"># Buffer Poolå¤§å°,å»ºè®®ç‰©ç†å†…å­˜çš„50-80%</span>
innodb_buffer_pool_instances=8      <span class="hljs-comment"># Buffer Poolå®ä¾‹æ•°,å‡å°‘é”ç«äº‰</span>
innodb_old_blocks_pct=37            <span class="hljs-comment"># OldåŒºå æ¯”37% (é»˜è®¤)</span>
innodb_old_blocks_time=1000         <span class="hljs-comment"># OldåŒºåœç•™æ—¶é—´1ç§’ (é»˜è®¤)</span>
</code></pre>
<p><strong>2. Change Buffer (å†™ç¼“å†²)</strong>:</p>
<p><strong>Change Bufferç”¨äºç¼“å­˜äºŒçº§ç´¢å¼•(éå”¯ä¸€ç´¢å¼•)çš„å˜æ›´æ“ä½œ,å‡å°‘éšæœºI/Oã€‚</strong></p>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<p>å½“æ›´æ–°éå”¯ä¸€ç´¢å¼•æ—¶:</p>
<ol>
<li>å¦‚æœç´¢å¼•é¡µåœ¨Buffer Pool: ç›´æ¥æ›´æ–°</li>
<li>å¦‚æœç´¢å¼•é¡µä¸åœ¨Buffer Pool: å°†å˜æ›´è®°å½•åˆ°Change Buffer (è€Œä¸æ˜¯ç«‹å³ä»ç£ç›˜åŠ è½½ç´¢å¼•é¡µ)</li>
<li>åç»­è¯»å–è¯¥ç´¢å¼•é¡µæ—¶,åˆå¹¶Change Bufferä¸­çš„å˜æ›´(Mergeæ“ä½œ)</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: éå”¯ä¸€ç´¢å¼•,å†™å¤šè¯»å°‘çš„åœºæ™¯(å¦‚æ—¥å¿—è¡¨ã€å†å²è®°å½•è¡¨)</p>
<p><strong>ä¸ºä»€ä¹ˆå”¯ä¸€ç´¢å¼•ä¸èƒ½ç”¨Change Buffer?</strong></p>
<p>å”¯ä¸€ç´¢å¼•éœ€è¦æ£€æŸ¥å”¯ä¸€æ€§çº¦æŸ,å¿…é¡»è¯»å–ç´¢å¼•é¡µ,æ— æ³•å»¶è¿Ÿæ›´æ–°ã€‚</p>
<p><strong>3. Adaptive Hash Index (è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•)</strong>:</p>
<p>InnoDBè‡ªåŠ¨åˆ›å»ºçš„å“ˆå¸Œç´¢å¼•,åŠ é€Ÿç­‰å€¼æŸ¥è¯¢ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<ul>
<li>InnoDBç›‘æ§B+æ ‘ç´¢å¼•çš„è®¿é—®æ¨¡å¼</li>
<li>å¯¹äºé¢‘ç¹è®¿é—®çš„ç´¢å¼•é¡µ,è‡ªåŠ¨åˆ›å»ºå“ˆå¸Œç´¢å¼•</li>
<li>å“ˆå¸ŒæŸ¥è¯¢O(1)æ—¶é—´å¤æ‚åº¦,æ¯”B+æ ‘O(log n)æ›´å¿«</li>
</ul>
<p><strong>é™åˆ¶</strong>: åªæ”¯æŒç­‰å€¼æŸ¥è¯¢(=),ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢(&lt;, &gt;),ç”±InnoDBè‡ªåŠ¨ç®¡ç†,æ— æ³•æ‰‹åŠ¨é…ç½®ã€‚</p>
<p><strong>4. Log Buffer (æ—¥å¿—ç¼“å†²)</strong>:</p>
<p><strong>Log Bufferç¼“å­˜Redo Log,æé«˜æ—¥å¿—å†™å…¥æ€§èƒ½ã€‚</strong></p>
<p><strong>å·¥ä½œæµç¨‹</strong>:</p>
<ol>
<li>äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶,å…ˆå†™Redo Log Buffer (å†…å­˜)</li>
<li>äº‹åŠ¡æäº¤æ—¶,å°†Redo Log Bufferåˆ·ç›˜åˆ°ib_logfile0/1 (ç£ç›˜)</li>
<li>åˆ·ç›˜ç­–ç•¥ç”±<code>innodb_flush_log_at_trx_commit</code>æ§åˆ¶</li>
</ol>
<p><strong>å‚æ•°é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_log_buffer_size=16M          <span class="hljs-comment"># Log Bufferå¤§å°,é»˜è®¤16MB</span>
innodb_flush_log_at_trx_commit=1   <span class="hljs-comment"># åˆ·ç›˜ç­–ç•¥:</span>
                                    <span class="hljs-comment"># 0: æ¯ç§’åˆ·ç›˜ä¸€æ¬¡ (æ€§èƒ½æœ€å¥½,ä½†å¯èƒ½ä¸¢å¤±1ç§’æ•°æ®)</span>
                                    <span class="hljs-comment"># 1: æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜ (æœ€å®‰å…¨,æ¨è)</span>
                                    <span class="hljs-comment"># 2: æ¯æ¬¡æäº¤å†™OSç¼“å­˜,æ¯ç§’åˆ·ç›˜ (æŠ˜ä¸­)</span>
</code></pre>
<h3 data-id="heading-15">3.3 ç£ç›˜ç»“æ„ (On-Disk Structure)</h3>
<p><strong>1. è¡¨ç©ºé—´ (Tablespace)</strong>:</p>
<p><strong>ç³»ç»Ÿè¡¨ç©ºé—´ (System Tablespace)</strong>:</p>
<ul>
<li>æ–‡ä»¶: ibdata1</li>
<li>å­˜å‚¨: æ•°æ®å­—å…¸ã€Undo Logã€Change Bufferã€Doublewrite Buffer</li>
<li>ç‰¹ç‚¹: æ‰€æœ‰è¡¨å…±äº«,ä¸æ¨èå­˜å‚¨ç”¨æˆ·æ•°æ®</li>
</ul>
<p><strong>ç‹¬ç«‹è¡¨ç©ºé—´ (File-Per-Table Tablespace)</strong>:</p>
<ul>
<li>æ–‡ä»¶: æ¯ä¸ªè¡¨ä¸€ä¸ª.ibdæ–‡ä»¶ (å¦‚users.ibd)</li>
<li>å­˜å‚¨: è¡¨çš„æ•°æ®å’Œç´¢å¼•</li>
<li>å‚æ•°: <code>innodb_file_per_table=ON</code> (MySQL 5.6+é»˜è®¤å¼€å¯)</li>
<li>ä¼˜åŠ¿: è¡¨çº§åˆ«ç®¡ç†,DROP TABLEç›´æ¥åˆ é™¤.ibdæ–‡ä»¶,å›æ”¶ç©ºé—´</li>
</ul>
<p><strong>2. æ•°æ®æ–‡ä»¶ç»“æ„</strong>:</p>
<p><strong>è¡¨ç©ºé—´ â†’ æ®µ(Segment) â†’ åŒº(Extent) â†’ é¡µ(Page) â†’ è¡Œ(Row)</strong></p>
<ul>
<li><strong>é¡µ(Page)</strong>: InnoDBæœ€å°I/Oå•ä½,é»˜è®¤16KB (<code>innodb_page_size=16384</code>)</li>
<li><strong>åŒº(Extent)</strong>: è¿ç»­64ä¸ªé¡µ,å¤§å°1MB (64 Ã— 16KB)</li>
<li><strong>æ®µ(Segment)</strong>: æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ</li>
</ul>
<p><strong>3. Redo Log (é‡åšæ—¥å¿—)</strong>:</p>
<p><strong>Redo Logæ˜¯InnoDBå´©æºƒæ¢å¤çš„æ ¸å¿ƒ,è®°å½•æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ã€‚</strong></p>
<p><strong>æ–‡ä»¶</strong>:</p>
<ul>
<li>ib_logfile0, ib_logfile1 (é»˜è®¤2ä¸ªæ–‡ä»¶)</li>
<li>å¾ªç¯å†™å…¥(Circular Write),å†™æ»¡ib_logfile1åå›åˆ°ib_logfile0</li>
</ul>
<p><strong>ä½œç”¨</strong>:</p>
<ul>
<li><strong>å´©æºƒæ¢å¤</strong>: é‡å¯å,é€šè¿‡Redo Logé‡æ”¾(redo),æ¢å¤æœªåˆ·ç›˜çš„è„é¡µæ•°æ®</li>
<li><strong>äº‹åŠ¡æŒä¹…æ€§(Durability)</strong>: äº‹åŠ¡æäº¤å,å³ä½¿ç«‹å³å´©æºƒ,Redo Logä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<p><strong>Redo Log vs Binlog</strong>:</p>



































<table><thead><tr><th>ç»´åº¦</th><th>Redo Log</th><th>Binlog</th></tr></thead><tbody><tr><td><strong>å±‚æ¬¡</strong></td><td>InnoDBå¼•æ“å±‚</td><td>MySQL Serverå±‚</td></tr><tr><td><strong>ä½œç”¨</strong></td><td>å´©æºƒæ¢å¤</td><td>ä¸»ä»å¤åˆ¶ã€æ•°æ®å¤‡ä»½</td></tr><tr><td><strong>å†…å®¹</strong></td><td>ç‰©ç†æ—¥å¿—(æ•°æ®é¡µçš„ä¿®æ”¹)</td><td>é€»è¾‘æ—¥å¿—(SQLè¯­å¥æˆ–è¡Œå˜æ›´)</td></tr><tr><td><strong>å†™å…¥æ–¹å¼</strong></td><td>å¾ªç¯å†™(å›ºå®šå¤§å°,è¦†ç›–æ—§æ•°æ®)</td><td>è¿½åŠ å†™(ä¸€ç›´å†™æ–°æ–‡ä»¶)</td></tr><tr><td><strong>äº‹åŠ¡æäº¤</strong></td><td>2PCä¸¤é˜¶æ®µæäº¤</td><td>2PCä¸¤é˜¶æ®µæäº¤</td></tr></tbody></table>
<p><strong>4. Undo Log (å›æ»šæ—¥å¿—)</strong>:</p>
<p><strong>Undo Logç”¨äºäº‹åŠ¡å›æ»šå’ŒMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚</strong></p>
<p><strong>ä½œç”¨</strong>:</p>
<ol>
<li><strong>äº‹åŠ¡å›æ»š</strong>: è®°å½•ä¿®æ”¹å‰çš„æ—§å€¼,äº‹åŠ¡å¤±è´¥æ—¶é€šè¿‡Undo Logå›æ»š</li>
<li><strong>MVCC</strong>: å…¶ä»–äº‹åŠ¡è¯»å–æ—§ç‰ˆæœ¬æ•°æ®,å®ç°å¿«ç…§è¯»</li>
</ol>
<p><strong>å­˜å‚¨ä½ç½®</strong>: ç³»ç»Ÿè¡¨ç©ºé—´(ibdata1)æˆ–Undoè¡¨ç©ºé—´(undo_001, undo_002)</p>
<h3 data-id="heading-16">3.4 B+æ ‘ç´¢å¼•åŸç†</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdff00281b9f4e38b1a5175ab8027754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=CjnbB9eDm5P%2B0f1Rv280ihdLJFI%3D" alt="btree-structure.svg" loading="lazy"/></p>
<p><strong>ä¸ºä»€ä¹ˆMySQLé€‰æ‹©B+æ ‘ä½œä¸ºç´¢å¼•æ•°æ®ç»“æ„?</strong></p>
<p><strong>å¯¹æ¯”å…¶ä»–æ•°æ®ç»“æ„</strong>:</p>
<p><strong>å“ˆå¸Œè¡¨</strong>:</p>
<ul>
<li>âŒ ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢: <code>age &gt; 25</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
<li>âŒ ä¸æ”¯æŒæ’åº: <code>ORDER BY age</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
<li>âŒ ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢: <code>name LIKE 'abc%'</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
</ul>
<p><strong>äºŒå‰æœç´¢æ ‘(BST)</strong>:</p>
<ul>
<li>âŒ å¯èƒ½é€€åŒ–æˆé“¾è¡¨: æ’å…¥é¡ºåºæ•°æ®(å¦‚1,2,3,4,5)æ—¶,æ ‘å˜æˆé“¾è¡¨</li>
<li>âŒ æ ‘é«˜è¿‡é«˜: ç™¾ä¸‡æ•°æ®æ ‘é«˜çº¦20å±‚,æŸ¥è¯¢éœ€è¦20æ¬¡ç£ç›˜I/O</li>
</ul>
<p><strong>AVLæ ‘ / çº¢é»‘æ ‘</strong>:</p>
<ul>
<li>âŒ æ ‘é«˜ä¾ç„¶è¿‡é«˜: ç™¾ä¸‡æ•°æ®æ ‘é«˜çº¦20å±‚</li>
<li>âŒ ç£ç›˜I/Oæ¬¡æ•°å¤š: æ¯å±‚ä¸€æ¬¡I/O,å¤ªæ…¢</li>
</ul>
<p><strong>Bæ ‘</strong>:</p>
<ul>
<li>âŒ éå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®: æµªè´¹ç©ºé—´,æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„é”®å€¼æ•°é‡å°‘</li>
<li>âŒ èŒƒå›´æŸ¥è¯¢éœ€è¦ä¸­åºéå†: éœ€è¦å›æº¯åˆ°æ ¹èŠ‚ç‚¹,æ•ˆç‡ä½</li>
</ul>
<p><strong>B+æ ‘ (InnoDBé€‰æ‹©)</strong>:</p>
<ul>
<li>âœ… <strong>éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼</strong>: æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨æ›´å¤šé”®(çº¦1170ä¸ª),æ ‘é«˜ä½(3å±‚çº¦2000ä¸‡è¡Œ)</li>
<li>âœ… <strong>æ‰€æœ‰æ•°æ®åœ¨å¶å­èŠ‚ç‚¹</strong>: æŸ¥è¯¢ç¨³å®š,æ¯æ¬¡æŸ¥è¯¢è·¯å¾„é•¿åº¦ç›¸åŒ</li>
<li>âœ… <strong>å¶å­èŠ‚ç‚¹åŒå‘é“¾è¡¨è¿æ¥</strong>: èŒƒå›´æŸ¥è¯¢åªéœ€é¡ºåºéå†é“¾è¡¨,æ— éœ€å›æº¯</li>
<li>âœ… <strong>ç£ç›˜I/Oæ¬¡æ•°å°‘</strong>: æ ‘é«˜ = I/Oæ¬¡æ•°,3æ¬¡I/Oå³å¯å®šä½ä»»æ„æ•°æ®</li>
</ul>
<p><strong>3å±‚B+æ ‘èƒ½å­˜å¤šå°‘æ•°æ®?</strong></p>
<p><strong>å‰ææ¡ä»¶</strong>:</p>
<ul>
<li>InnoDBé¡µå¤§å°: 16KB (<code>innodb_page_size=16384</code>)</li>
<li>ä¸»é”®(Bigint): 8å­—èŠ‚</li>
<li>æŒ‡é’ˆå¤§å°: 6å­—èŠ‚(InnoDBé¡µå·)</li>
<li>æ¯è¡Œæ•°æ®å¤§å°: å‡è®¾1KB</li>
</ul>
<p><strong>è®¡ç®—è¿‡ç¨‹</strong>:</p>
<p><strong>1. éå¶å­èŠ‚ç‚¹èƒ½å­˜å¤šå°‘ä¸ªé”®?</strong></p>
<p>æ¯ä¸ªé”® = ä¸»é”®(8B) + æŒ‡é’ˆ(6B) = 14å­—èŠ‚</p>
<p>æ¯ä¸ªèŠ‚ç‚¹(16KB) èƒ½å­˜: 16KB / 14B â‰ˆ <strong>1170ä¸ªé”®</strong></p>
<p><strong>2. å¶å­èŠ‚ç‚¹èƒ½å­˜å¤šå°‘è¡Œæ•°æ®?</strong></p>
<p>æ¯è¡Œæ•°æ® = 1KB (å‡è®¾)</p>
<p>æ¯ä¸ªèŠ‚ç‚¹(16KB) èƒ½å­˜: 16KB / 1KB = <strong>16è¡Œæ•°æ®</strong></p>
<p><strong>3. 3å±‚B+æ ‘èƒ½å­˜å¤šå°‘è¡Œ?</strong></p>
<ul>
<li>ç¬¬1å±‚(æ ¹èŠ‚ç‚¹): 1ä¸ªèŠ‚ç‚¹, 1170ä¸ªé”®, æŒ‡å‘1170ä¸ªç¬¬2å±‚èŠ‚ç‚¹</li>
<li>ç¬¬2å±‚: 1170ä¸ªèŠ‚ç‚¹, æ¯ä¸ª1170ä¸ªé”®, æŒ‡å‘ 1170 Ã— 1170 = 1,368,900 ä¸ªå¶å­èŠ‚ç‚¹</li>
<li>ç¬¬3å±‚(å¶å­èŠ‚ç‚¹): 1,368,900 Ã— 16 = <strong>21,902,400 â‰ˆ 2190ä¸‡è¡Œ</strong></li>
</ul>
<p><strong>ç»“è®º</strong>: <strong>3å±‚B+æ ‘, ä»…éœ€3æ¬¡ç£ç›˜I/O, å°±èƒ½å®šä½åˆ°2000ä¸‡æ¡æ•°æ®ä¸­çš„ä»»æ„ä¸€æ¡!</strong></p>
<p><strong>å¯¹æ¯”</strong>: å¦‚æœç”¨çº¢é»‘æ ‘, 2000ä¸‡æ•°æ®æ ‘é«˜çº¦25å±‚, éœ€è¦25æ¬¡I/O,æ€§èƒ½å·®è·1000å€ä»¥ä¸Š!</p>
<p><strong>ä¸ºä»€ä¹ˆæ ‘é«˜è¿™ä¹ˆä½?</strong></p>
<p>éå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®,åªå­˜å‚¨é”®+æŒ‡é’ˆ,æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨1000+ä¸ªé”®,æ ‘çš„æ‰‡å‡º(Fan-out)æå¤§,æ ‘é«˜æä½ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆI/Oæ¬¡æ•°é‡è¦?</strong></p>
<p>ç£ç›˜éšæœºI/Oæ˜¯æ€§èƒ½ç“¶é¢ˆ:</p>
<ul>
<li>æœºæ¢°ç¡¬ç›˜: çº¦10ms/æ¬¡</li>
<li>SSD: çº¦0.1ms/æ¬¡</li>
</ul>
<p>3æ¬¡I/Oçº¦30ms,25æ¬¡I/Oçº¦250ms,å·®è·10å€!</p>
<hr/>
<h2 data-id="heading-17">å››ã€ä¸€æ¡SQLçš„æ‰§è¡Œæµç¨‹</h2>
<h3 data-id="heading-18">4.1 SELECTè¯­å¥çš„æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3668fdf2a47b4fc6b7a39485c724344c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=XOq1yiHJ5qaqmIWIi4yJeMLjeZk%3D" alt="select-execution-flow.svg" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹SQL</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>å®Œæ•´æµç¨‹</strong>:</p>
<p><strong>æ­¥éª¤1: è¿æ¥å™¨ (Connector)</strong></p>
<ul>
<li>TCPæ¡æ‰‹,å»ºç«‹è¿æ¥</li>
<li>éªŒè¯ç”¨æˆ·åå¯†ç (æŸ¥è¯¢<code>mysql.user</code>è¡¨)</li>
<li>è·å–ç”¨æˆ·æƒé™(ä¿å­˜åˆ°è¿æ¥å¯¹è±¡ä¸­)</li>
<li>åŠ å…¥è¿æ¥æ± (<code>SHOW PROCESSLIST</code>å¯æŸ¥çœ‹)</li>
</ul>
<p><strong>æ­¥éª¤2: æŸ¥è¯¢ç¼“å­˜ (Query Cache, MySQL 8.0å·²ç§»é™¤)</strong></p>
<ul>
<li>ä½¿ç”¨SQLè¯­å¥ä½œä¸ºkey,æŸ¥è¯¢ç»“æœä½œä¸ºvalue</li>
<li><strong>å‘½ä¸­ç¼“å­˜</strong>: ç›´æ¥è¿”å›ç»“æœ,è·³è¿‡åç»­æ­¥éª¤</li>
<li><strong>æœªå‘½ä¸­</strong>: ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤</li>
<li><strong>è¡¨æ›´æ–°ä¼šæ¸…ç©ºè¯¥è¡¨çš„æ‰€æœ‰ç¼“å­˜</strong>(å‘½ä¸­ç‡æä½)</li>
</ul>
<p><strong>æ­¥éª¤3: åˆ†æå™¨ (Analyzer)</strong></p>
<p><strong>3.1 è¯æ³•åˆ†æ (Lexical Analysis)</strong>:</p>
<ul>
<li>è¯†åˆ«SQLä¸­çš„å…³é”®å­—: SELECT, FROM, WHERE, ORDER BY, LIMIT</li>
<li>è¯†åˆ«è¡¨å: users, å­—æ®µå: id, name, age</li>
</ul>
<p><strong>3.2 è¯­æ³•åˆ†æ (Syntax Analysis)</strong>:</p>
<ul>
<li>æ„å»ºè¯­æ³•æ ‘ (Parse Tree)</li>
<li>æ£€æŸ¥è¯­æ³•é”™è¯¯(å¦‚: <code>SELECT * FORM users</code>)</li>
</ul>
<p><strong>è¾“å‡º</strong>: è¯­æ³•æ ‘(AST)</p>
<p><strong>æ­¥éª¤4: ä¼˜åŒ–å™¨ (Optimizer)</strong></p>
<p><strong>4.1 ç´¢å¼•é€‰æ‹©</strong>:</p>
<ul>
<li>æŸ¥è¯¢usersè¡¨æœ‰å“ªäº›ç´¢å¼•(ä¸»é”®ç´¢å¼•ã€ageç´¢å¼•ã€nameç´¢å¼•...)</li>
<li><strong>æˆæœ¬è®¡ç®— (CBO - Cost-Based Optimizer)</strong>: è®¡ç®—å…¨è¡¨æ‰«æ vs ç´¢å¼•æ‰«æçš„æˆæœ¬</li>
<li>é€‰æ‹©æˆæœ¬æœ€ä½çš„ç´¢å¼•(å‡è®¾é€‰æ‹©idx_ageç´¢å¼•)</li>
</ul>
<p><strong>4.2 æ‰§è¡Œè®¡åˆ’ç”Ÿæˆ</strong>:</p>
<ul>
<li>ç¡®å®šJOINé¡ºåº(å¤šè¡¨æŸ¥è¯¢)</li>
<li>ç¡®å®šæ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨/æ’åº</li>
<li>ç”Ÿæˆæœ€ä¼˜æ‰§è¡Œè®¡åˆ’</li>
</ul>
<p><strong>è¾“å‡º</strong>: æ‰§è¡Œè®¡åˆ’(Execution Plan) - å¯é€šè¿‡<code>EXPLAIN</code>æŸ¥çœ‹</p>
<p><strong>æ­¥éª¤5: æ‰§è¡Œå™¨ (Executor)</strong></p>
<ul>
<li><strong>æƒé™æ£€æŸ¥</strong>: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰usersè¡¨çš„SELECTæƒé™(ç¬¬1æ­¥å·²è·å–)</li>
<li><strong>è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£</strong>: InnoDBå¼•æ“çš„readæ¥å£,ä¼ å…¥æ¡ä»¶: <code>age &gt; 25</code></li>
<li><strong>é€è¡Œè¯»å–æ•°æ®</strong>: è¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„è¡Œ</li>
<li><strong>æ’åº</strong>: <code>ORDER BY id</code></li>
<li><strong>é™åˆ¶ç»“æœ</strong>: <code>LIMIT 10</code></li>
<li><strong>è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</strong>(å¦‚è¶…è¿‡é˜ˆå€¼)</li>
</ul>
<p><strong>æ­¥éª¤6: å­˜å‚¨å¼•æ“ (InnoDB)</strong></p>
<p><strong>6.1 æ£€æŸ¥Buffer Pool</strong>:</p>
<ul>
<li><strong>æ•°æ®é¡µåœ¨ç¼“å­˜ä¸­</strong>: ç›´æ¥è¿”å›æ•°æ®(ç¼“å­˜å‘½ä¸­, æ— ç£ç›˜I/O)</li>
<li><strong>æ•°æ®é¡µä¸åœ¨ç¼“å­˜ä¸­</strong>: ä»ç£ç›˜åŠ è½½æ•°æ®é¡µåˆ°Buffer Pool(ç£ç›˜I/O)</li>
</ul>
<p><strong>6.2 è¯»å–æ•°æ®</strong>:</p>
<ul>
<li>é€šè¿‡ageç´¢å¼•å®šä½æ•°æ®(B+æ ‘æŸ¥æ‰¾)</li>
<li><strong>å›è¡¨æŸ¥è¯¢</strong>: é€šè¿‡ä¸»é”®ç´¢å¼•è·å–å®Œæ•´è¡Œ</li>
</ul>
<p><strong>è¿”å›æ•°æ®ç»™æ‰§è¡Œå™¨ â†’ è¿”å›ç»“æœé›†ç»™å®¢æˆ·ç«¯</strong></p>
<p><strong>SELECTæ‰§è¡Œæµç¨‹å…³é”®ç‚¹</strong>:</p>
<ul>
<li>å®Œæ•´æµç¨‹: è¿æ¥å™¨ â†’ æŸ¥è¯¢ç¼“å­˜(8.0å·²ç§»é™¤) â†’ åˆ†æå™¨ â†’ ä¼˜åŒ–å™¨ â†’ æ‰§è¡Œå™¨ â†’ å­˜å‚¨å¼•æ“</li>
<li><strong>æ…¢æŸ¥è¯¢ä¼˜åŒ–é‡ç‚¹</strong>: ä¼˜åŒ–å™¨çš„ç´¢å¼•é€‰æ‹©ã€æ‰§è¡Œå™¨çš„å›è¡¨æ¬¡æ•°ã€å­˜å‚¨å¼•æ“çš„Buffer Poolå‘½ä¸­ç‡</li>
</ul>
<h3 data-id="heading-19">4.2 UPDATEè¯­å¥çš„æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/727e8844b0ca4d0e82e704836f61dbc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=rATo1PrVy8cJJiW1E5g4AF2lsE8%3D" alt="update-execution-flow.svg" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹SQL</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
</code></pre>
<p><strong>å‰5æ­¥ä¸SELECTç›¸åŒ</strong>: è¿æ¥å™¨ â†’ æŸ¥è¯¢ç¼“å­˜ â†’ åˆ†æå™¨ â†’ ä¼˜åŒ–å™¨ â†’ æ‰§è¡Œå™¨</p>
<p><strong>æ­¥éª¤6: InnoDBæ›´æ–°æµç¨‹ (WAL + 2PC)</strong></p>
<p><strong>6.1 æŸ¥æ‰¾æ•°æ® (WHERE id = 100)</strong></p>
<ul>
<li>å…ˆæŸ¥è¯¢Buffer Poolç¼“å­˜: æ•°æ®é¡µåœ¨ç¼“å­˜ä¸­,ç›´æ¥è¿”å›</li>
<li>æ•°æ®é¡µä¸åœ¨ç¼“å­˜: ä»ç£ç›˜.ibdæ–‡ä»¶åŠ è½½åˆ°Buffer Pool</li>
</ul>
<p><strong>6.2 å†™Undo Log (å›æ»šæ—¥å¿—)</strong></p>
<ul>
<li>è®°å½•æ—§å€¼: <code>id=100, age=25</code> (ç”¨äºäº‹åŠ¡å›æ»š)</li>
<li>ç”¨äºMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(å…¶ä»–äº‹åŠ¡è¯»å–æ—§ç‰ˆæœ¬æ•°æ®)</li>
<li>å­˜å‚¨ä½ç½®: Undoè¡¨ç©ºé—´æˆ–ç³»ç»Ÿè¡¨ç©ºé—´(ibdata1)</li>
</ul>
<p><strong>6.3 æ›´æ–°Buffer Poolå†…å­˜æ•°æ®</strong></p>
<ul>
<li>åœ¨Buffer Poolä¸­ä¿®æ”¹æ•°æ®: <code>id=100, age=25 â†’ age=26</code></li>
<li>æ ‡è®°æ•°æ®é¡µä¸º"<strong>è„é¡µ</strong>" (Dirty Page)</li>
<li><strong>æ­¤æ—¶æ•°æ®åªåœ¨å†…å­˜ä¸­æ›´æ–°,å°šæœªå†™å…¥ç£ç›˜</strong> (WALæœºåˆ¶æ ¸å¿ƒ)</li>
</ul>
<p><strong>6.4 å†™Redo Log - prepareé˜¶æ®µ (InnoDBå¼•æ“å±‚)</strong></p>
<ul>
<li>å…ˆå†™Redo Log Buffer (å†…å­˜)</li>
<li>åˆ·ç›˜åˆ°ib_logfile0/1 (ç£ç›˜,é¡ºåºå†™)</li>
<li>è®°å½•å†…å®¹: "å°†usersè¡¨id=100çš„ageå­—æ®µæ”¹ä¸º26"</li>
<li><strong>çŠ¶æ€: prepare</strong> (ä¸¤é˜¶æ®µæäº¤ç¬¬1é˜¶æ®µ)</li>
<li><strong>ä½œç”¨</strong>: å´©æºƒæ¢å¤æ—¶,é€šè¿‡Redo Logé‡æ”¾,ä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<p><strong>å‚æ•°</strong>: <code>innodb_flush_log_at_trx_commit=1</code> (æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜,æœ€å®‰å…¨)</p>
<p><strong>6.5 å†™Binlog (MySQL Serverå±‚)</strong></p>
<ul>
<li>Binlogæ˜¯MySQL Serverå±‚çš„æ—¥å¿—(æ‰€æœ‰å­˜å‚¨å¼•æ“å…±äº«)</li>
<li>è®°å½•å®Œæ•´çš„SQLè¯­å¥æˆ–è¡Œå˜æ›´</li>
<li>åˆ·ç›˜åˆ°binlogæ–‡ä»¶(mysql-bin.000001)</li>
<li><strong>å‚æ•°</strong>: <code>sync_binlog=1</code> (æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜,æœ€å®‰å…¨)</li>
<li><strong>ä½œç”¨</strong>: ä¸»ä»å¤åˆ¶ã€æ•°æ®å¤‡ä»½ã€æ•°æ®æ¢å¤(point-in-time recovery)</li>
<li><strong>Binlogæ ¼å¼</strong>: ROW(è¡Œæ¨¡å¼,æ¨è), STATEMENT, MIXED</li>
</ul>
<p><strong>6.6 æäº¤äº‹åŠ¡ - Redo Log commité˜¶æ®µ (ä¸¤é˜¶æ®µæäº¤ç¬¬2é˜¶æ®µ)</strong></p>
<ul>
<li>å°†Redo LogçŠ¶æ€ä»prepareæ”¹ä¸ºcommit</li>
<li>äº‹åŠ¡æ­£å¼æäº¤æˆåŠŸ</li>
<li><strong>2PCä¸¤é˜¶æ®µæäº¤å®Œæˆ</strong>: prepare â†’ å†™Binlog â†’ commit (ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§)</li>
<li><strong>æ­¤æ—¶æ•°æ®ä»åœ¨Buffer Pool,å°šæœªå†™å…¥.ibdæ–‡ä»¶</strong></li>
</ul>
<p><strong>6.7 åˆ·è„é¡µ (Flush Dirty Pages) - å¼‚æ­¥åå°çº¿ç¨‹</strong></p>
<ul>
<li><strong>åå°çº¿ç¨‹å¼‚æ­¥å°†è„é¡µåˆ·å›ç£ç›˜</strong> (.ibdæ•°æ®æ–‡ä»¶, éšæœºå†™)</li>
<li><strong>è§¦å‘æ—¶æœº</strong>:
<ol>
<li>Redo Logæ»¡äº†(å¿…é¡»åˆ·è„é¡µ,è…¾å‡ºRedo Logç©ºé—´)</li>
<li>Buffer Poolç©ºé—´ä¸è¶³(æ·˜æ±°è„é¡µ,éœ€å…ˆåˆ·ç›˜)</li>
<li>MySQLç©ºé—²æ—¶(åå°çº¿ç¨‹å®šæœŸåˆ·ç›˜)</li>
<li>MySQLæ­£å¸¸å…³é—­æ—¶(åˆ·æ‰€æœ‰è„é¡µ)</li>
</ol>
</li>
</ul>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>innodb_io_capacity=200</code>: åˆ·ç›˜IOPSèƒ½åŠ›(SSDå¯è°ƒé«˜åˆ°1000-5000)</li>
<li><code>innodb_max_dirty_pages_pct=75</code>: è„é¡µæ¯”ä¾‹é˜ˆå€¼75%</li>
</ul>
<p><strong>WAL (Write-Ahead Logging) æœºåˆ¶æ ¸å¿ƒ</strong>:</p>
<p><strong>ä¸ºä»€ä¹ˆå…ˆå†™æ—¥å¿—,å†å¼‚æ­¥åˆ·è„é¡µ?</strong></p>
<ul>
<li><strong>Redo Logé¡ºåºå†™</strong> (appendè¿½åŠ æ¨¡å¼), é€Ÿåº¦æå¿«(ç£ç›˜é¡ºåºI/Oçº¦100MB/s)</li>
<li><strong>æ•°æ®æ–‡ä»¶éšæœºå†™</strong> (.ibdæ–‡ä»¶, é€Ÿåº¦æ…¢, ç£ç›˜éšæœºI/Oçº¦100æ¬¡/s)</li>
<li><strong>äº‹åŠ¡æäº¤æ—¶åªéœ€åˆ·Redo Log</strong>(å¿«), è„é¡µå¼‚æ­¥åˆ·ç›˜(æ…¢,ä½†ä¸é˜»å¡äº‹åŠ¡) â†’ <strong>å†™å…¥æ€§èƒ½æå‡10-100å€</strong></li>
<li><strong>å´©æºƒæ¢å¤</strong>: é‡å¯å,é€šè¿‡Redo Logé‡æ”¾(redo),æ¢å¤æœªåˆ·ç›˜çš„è„é¡µæ•°æ®,ä¿è¯äº‹åŠ¡æŒä¹…æ€§(Durability)</li>
</ul>
<p><strong>2PC (Two-Phase Commit) ä¸¤é˜¶æ®µæäº¤</strong>:</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦2PC? ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§</strong></p>
<ul>
<li>Redo Log (InnoDBå¼•æ“å±‚) + Binlog (MySQL Serverå±‚) ä¸¤ä»½æ—¥å¿—,å¿…é¡»ä¿æŒä¸€è‡´</li>
<li><strong>2PCæµç¨‹</strong>: Redo Log prepare â†’ å†™Binlog â†’ Redo Log commit</li>
<li><strong>å´©æºƒæ¢å¤åœºæ™¯</strong>:
<ul>
<li>â‘  prepareæˆåŠŸ,Binlogå¤±è´¥ â†’ å›æ»š</li>
<li>â‘¡ prepareæˆåŠŸ,BinlogæˆåŠŸ,commitå¤±è´¥ â†’ æäº¤(é€šè¿‡Binlogæ¢å¤)</li>
</ul>
</li>
<li><strong>ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§</strong>: Binlogç”¨äºä¸»ä»å¤åˆ¶,2PCç¡®ä¿ä¸»åº“Redo Logå’Œä»åº“Binlogä¸€è‡´</li>
</ul>
<p><strong>UPDATEæ‰§è¡Œæµç¨‹å…³é”®ç‚¹</strong>:</p>
<ul>
<li><strong>WALæœºåˆ¶</strong>: å…ˆå†™æ—¥å¿—(Redo Log/Binlog, é¡ºåºI/O), å†å¼‚æ­¥åˆ·è„é¡µ(æ•°æ®æ–‡ä»¶, éšæœºI/O), å†™å…¥æ€§èƒ½æå‡10-100å€</li>
<li><strong>2PCä¸¤é˜¶æ®µæäº¤</strong>: ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§, é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>äº‹åŠ¡æŒä¹…æ€§ä¿è¯</strong>: äº‹åŠ¡æäº¤å,å³ä½¿ç«‹å³å´©æºƒ,é‡å¯åé€šè¿‡Redo Logé‡æ”¾,æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<hr/>
<h2 data-id="heading-20">äº”ã€Buffer Poolç¼“å†²æ± åŸç†ä¸ä¼˜åŒ–</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb0fc9da772440ea84459e5530cbdcbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=N2miBGwfnLffaWt2X2eHxsH8ek0%3D" alt="buffer-pool-lru.svg" loading="lazy"/></p>
<h3 data-id="heading-21">5.1 Buffer Poolæ•´ä½“ç»“æ„</h3>
<p><strong>Buffer Poolæ˜¯InnoDBæ€§èƒ½çš„æ ¸å¿ƒ</strong>,ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/Oã€‚</p>
<p><strong>Buffer Poolç»“æ„</strong>:</p>
<ul>
<li><strong>YoungåŒº</strong> (æ–°æ•°æ®åŒº): å Buffer Poolçš„5/8 (62.5%),å­˜æ”¾çƒ­æ•°æ®</li>
<li><strong>OldåŒº</strong> (è€æ•°æ®åŒº): å Buffer Poolçš„3/8 (37.5%),å­˜æ”¾å†·æ•°æ®</li>
<li><strong>Midpointåˆ†ç•Œç‚¹</strong>: YoungåŒºå’ŒOldåŒºçš„è¾¹ç•Œ</li>
</ul>
<h3 data-id="heading-22">5.2 æ”¹è¿›çš„LRUé“¾è¡¨</h3>
<p><strong>ä¼ ç»ŸLRUç®—æ³•çš„é—®é¢˜</strong>:</p>
<p>å…¨è¡¨æ‰«æä¼šå°†å¤§é‡å†·æ•°æ®åŠ è½½åˆ°ç¼“å­˜,æŒ¤æ‰çƒ­æ•°æ®(ç¼“å­˜æ±¡æŸ“)ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> large_table;  <span class="hljs-comment">-- å…¨è¡¨æ‰«æ,åŠ è½½å‡ ç™¾ä¸‡è¡Œæ•°æ®åˆ°ç¼“å­˜</span>
</code></pre>
<p>ä¼ ç»ŸLRU: æ–°æ•°æ®æ’å…¥é“¾è¡¨å¤´,çƒ­æ•°æ®è¢«æŒ¤åˆ°é“¾è¡¨å°¾,æœ€ç»ˆè¢«æ·˜æ±° â†’ <strong>ç¼“å­˜æ±¡æŸ“</strong></p>
<p><strong>InnoDBçš„æ”¹è¿› (Midpointæ’å…¥ç­–ç•¥)</strong>:</p>
<ol>
<li><strong>æ–°æ•°æ®é¡µä¸æ’å…¥é“¾è¡¨å¤´,è€Œæ˜¯æ’å…¥OldåŒºå¤´éƒ¨(Midpointä½ç½®)</strong></li>
<li><strong>åªæœ‰åœ¨OldåŒºåœç•™â‰¥1ç§’åå†æ¬¡è®¿é—®,æ‰ç§»åŠ¨åˆ°YoungåŒº</strong></li>
<li><strong>å…¨è¡¨æ‰«æçš„æ•°æ®é¡µåªåœç•™åœ¨OldåŒº,ä¸å½±å“YoungåŒºçš„çƒ­æ•°æ®</strong></li>
</ol>
<p><strong>å‚æ•°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_old_blocks_pct=37            <span class="hljs-comment"># OldåŒºå æ¯”37% (é»˜è®¤)</span>
innodb_old_blocks_time=1000         <span class="hljs-comment"># OldåŒºåœç•™æ—¶é—´1ç§’ (é»˜è®¤)</span>
</code></pre>
<p><strong>å¥½å¤„</strong>:</p>
<ul>
<li><strong>å…¨è¡¨æ‰«æçš„æ•°æ®é¡µåªåœç•™åœ¨OldåŒº,ä¸å½±å“YoungåŒºçš„çƒ­æ•°æ®</strong></li>
<li><strong>çœŸæ­£çš„çƒ­æ•°æ®(å¤šæ¬¡è®¿é—®)æ‰ä¼šè¿›å…¥YoungåŒº</strong></li>
<li><strong>æœ‰æ•ˆé˜²æ­¢ç¼“å­˜æ±¡æŸ“</strong></li>
</ul>
<h3 data-id="heading-23">5.3 æ•°æ®é¡µåŠ è½½ä¸æ·˜æ±°æµç¨‹</h3>
<p><strong>åœºæ™¯1: ä»ç£ç›˜åŠ è½½æ–°æ•°æ®é¡µ</strong></p>
<ol>
<li>æ£€æŸ¥Buffer Poolæ˜¯å¦æœ‰ç©ºé—²é¡µ</li>
<li>è‹¥æ— ç©ºé—²,ä»LRUé“¾è¡¨å°¾æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„é¡µ</li>
<li>å°†æ–°æ•°æ®é¡µåŠ è½½åˆ°Buffer Pool</li>
<li><strong>æ’å…¥åˆ°LRUé“¾è¡¨çš„OldåŒºå¤´éƒ¨(Midpoint)</strong></li>
<li>1ç§’åå†æ¬¡è®¿é—®,ç§»åŠ¨åˆ°YoungåŒºå¤´éƒ¨</li>
</ol>
<p><strong>åœºæ™¯2: è„é¡µåˆ·ç›˜</strong></p>
<ul>
<li><strong>è„é¡µ</strong> = å†…å­˜ä¸­å·²ä¿®æ”¹ä½†æœªå†™å…¥ç£ç›˜çš„æ•°æ®é¡µ</li>
<li><strong>åˆ·ç›˜æ—¶æœº</strong>:
<ul>
<li>Redo Logæ»¡äº†</li>
<li>Buffer Poolç©ºé—´ä¸è¶³,éœ€è¦æ·˜æ±°è„é¡µ</li>
<li>MySQLç©ºé—²æ—¶,åå°çº¿ç¨‹åˆ·ç›˜</li>
<li>MySQLæ­£å¸¸å…³é—­æ—¶</li>
</ul>
</li>
</ul>
<p><strong>åœºæ™¯3: é¡µè¢«è®¿é—®</strong></p>
<ol>
<li><strong>é¡µåœ¨YoungåŒº</strong>: ä¸ç§»åŠ¨,é¿å…é¢‘ç¹è°ƒæ•´é“¾è¡¨</li>
<li><strong>é¡µåœ¨OldåŒº</strong>:
<ul>
<li>åˆšè¿›å…¥OldåŒº(&lt;1ç§’): ä¸ç§»åŠ¨</li>
<li>åœ¨OldåŒºåœç•™â‰¥1ç§’: ç§»åŠ¨åˆ°YoungåŒºå¤´éƒ¨</li>
</ul>
</li>
<li><strong>é¡µä¸åœ¨Buffer Pool</strong>: ä»ç£ç›˜åŠ è½½(åœºæ™¯1)</li>
</ol>
<h3 data-id="heading-24">5.4 é¢„è¯»æœºåˆ¶ (Read-Ahead)</h3>
<p><strong>é¢„è¯»æœºåˆ¶</strong>: InnoDBé¢„æµ‹å³å°†è®¿é—®çš„æ•°æ®é¡µ,æå‰åŠ è½½åˆ°Buffer Poolã€‚</p>
<p><strong>1. çº¿æ€§é¢„è¯» (Linear Read-Ahead)</strong>:</p>
<ul>
<li>é¡ºåºè®¿é—®åŒº(Extent, 64ä¸ªè¿ç»­é¡µ)ä¸­çš„é¡µè¾¾åˆ°é˜ˆå€¼,é¢„è¯»ä¸‹ä¸€ä¸ªåŒºçš„æ‰€æœ‰é¡µ</li>
<li>å‚æ•°: <code>innodb_read_ahead_threshold=56</code> (é»˜è®¤56,èŒƒå›´0-64)</li>
<li>é€‚ç”¨: å…¨è¡¨æ‰«æã€èŒƒå›´æŸ¥è¯¢</li>
</ul>
<p><strong>2. éšæœºé¢„è¯» (Random Read-Ahead)</strong>:</p>
<ul>
<li>åŒä¸€ä¸ªåŒºä¸­,å¤šä¸ªé¡µè¢«è®¿é—®,é¢„è¯»æ•´ä¸ªåŒºçš„å…¶ä»–é¡µ</li>
<li>é»˜è®¤å…³é—­: <code>innodb_random_read_ahead=OFF</code></li>
</ul>
<p><strong>é¢„è¯»çš„å½±å“</strong>:</p>
<ul>
<li>âœ… <strong>å¥½å¤„</strong>: å‡å°‘ç£ç›˜I/O,æå‡é¡ºåºè¯»æ€§èƒ½</li>
<li>âŒ <strong>åå¤„</strong>: å¯èƒ½é¢„è¯»æ— ç”¨é¡µ,æµªè´¹Buffer Poolç©ºé—´</li>
</ul>
<h3 data-id="heading-25">5.5 Buffer Poolæ ¸å¿ƒè¦ç‚¹</h3>
<ul>
<li><strong>Buffer Poolæ˜¯InnoDBæ€§èƒ½çš„æ ¸å¿ƒ</strong>,ç¼“å­˜çƒ­æ•°æ®,å‡å°‘ç£ç›˜I/O</li>
<li><strong>æ”¹è¿›çš„LRUç®—æ³•é¿å…å…¨è¡¨æ‰«ææ±¡æŸ“çƒ­æ•°æ®</strong>(OldåŒº+1ç§’å»¶è¿Ÿç­–ç•¥)</li>
<li><strong>è„é¡µå¼‚æ­¥åˆ·ç›˜</strong>,WALæœºåˆ¶ä¿è¯æ€§èƒ½å’Œæ•°æ®æŒä¹…æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-26">å…­ã€å®æˆ˜åœºæ™¯åº”ç”¨</h2>
<h3 data-id="heading-27">6.1 ä½¿ç”¨EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae6579d53d6d438997a486e111fda543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=goDDkWwvREh9bqhoI0an%2B89a4ik%3D" alt="explain-example.svg" loading="lazy"/></p>
<p><strong>EXPLAINæ˜¯SQLä¼˜åŒ–çš„ç¬¬ä¸€æ­¥</strong>,åˆ†ææ‰§è¡Œè®¡åˆ’,å®šä½æ€§èƒ½ç“¶é¢ˆã€‚</p>
<p><strong>å…³é”®å­—æ®µ</strong>:</p>
<p><strong>type (è®¿é—®ç±»å‹,æ€§èƒ½å…³é”®)</strong>:</p>
<ul>
<li>âœ… <strong>system &gt; const &gt; eq_ref &gt; ref</strong> (ä¼˜ç§€,ä½¿ç”¨ç´¢å¼•ç²¾ç¡®æŸ¥æ‰¾)</li>
<li>âš ï¸ <strong>range &gt; index</strong> (å¯æ¥å—,ç´¢å¼•èŒƒå›´æ‰«ææˆ–ç´¢å¼•å…¨æ‰«æ)</li>
<li>âŒ <strong>ALL</strong> (å…¨è¡¨æ‰«æ,æœ€å·®)</li>
</ul>
<p><strong>key (å®é™…ä½¿ç”¨çš„ç´¢å¼•)</strong>:</p>
<ul>
<li><strong>NULL</strong>: æœªä½¿ç”¨ç´¢å¼•,éœ€ä¼˜åŒ–</li>
<li><strong>idx_name</strong>: ä½¿ç”¨ç´¢å¼•,æ€§èƒ½å¥½</li>
</ul>
<p><strong>rows (æ‰«æçš„è¡Œæ•°)</strong>:</p>
<ul>
<li><strong>è¶Šå°‘è¶Šå¥½</strong>,rowsè¿‡å¤§(å¦‚&gt;10ä¸‡)éœ€æ£€æŸ¥ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆ</li>
</ul>
<p><strong>Extra (é¢å¤–ä¿¡æ¯)</strong>:</p>
<ul>
<li>âœ… <strong>Using index</strong>: è¦†ç›–ç´¢å¼•,åªè¯»ç´¢å¼•,ä¸å›è¡¨,æ€§èƒ½æœ€ä¼˜</li>
<li>âœ… <strong>Using where</strong>: ä½¿ç”¨WHEREè¿‡æ»¤</li>
<li>âŒ <strong>Using filesort</strong>: æ–‡ä»¶æ’åº,æ€§èƒ½å·®,éœ€ä¼˜åŒ– â†’ åœ¨ORDER BYå­—æ®µä¸Šå»ºç´¢å¼•</li>
<li>âŒ <strong>Using temporary</strong>: ä½¿ç”¨ä¸´æ—¶è¡¨,æ€§èƒ½å·®,éœ€ä¼˜åŒ– â†’ åœ¨GROUP BYå­—æ®µä¸Šå»ºç´¢å¼•</li>
</ul>
<p><strong>ç¤ºä¾‹1: ä¼˜ç§€çš„æ‰§è¡Œè®¡åˆ’</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>ç»“æœ</strong>: type=ref (ä¼˜ç§€), key=idx_age, rows=1000</p>
<p><strong>åˆ†æ</strong>: ä½¿ç”¨idx_ageç´¢å¼•,æ‰«æ1000è¡Œ,æ€§èƒ½è‰¯å¥½</p>
<p><strong>ç¤ºä¾‹2: ç³Ÿç³•çš„æ‰§è¡Œè®¡åˆ’</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(birthday) <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;
</code></pre>
<p><strong>ç»“æœ</strong>: type=ALL (å…¨è¡¨æ‰«æ), key=NULL (æœªä½¿ç”¨ç´¢å¼•), rows=5000000</p>
<p><strong>é—®é¢˜</strong>:</p>
<ul>
<li>WHEREæ¡ä»¶ä½¿ç”¨äº†å‡½æ•°<code>YEAR(birthday)</code>,å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li>
<li>å…¨è¡¨æ‰«æ500ä¸‡è¡Œ,æ€§èƒ½æå·®</li>
</ul>
<p><strong>ä¼˜åŒ–</strong>: æ”¹ä¸º <code>WHERE birthday BETWEEN '2000-01-01' AND '2000-12-31'</code>,å¯ä½¿ç”¨idx_birthdayç´¢å¼•</p>
<p><strong>ç¤ºä¾‹3: æ–‡ä»¶æ’åº</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> birthday;
</code></pre>
<p><strong>ç»“æœ</strong>: type=range, key=idx_age, Extra=<strong>Using filesort</strong></p>
<p><strong>é—®é¢˜</strong>: ORDER BYçš„å­—æ®µ(birthday)ä¸WHEREæ¡ä»¶çš„ç´¢å¼•(idx_age)ä¸åŒ,æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åº,éœ€è¦é¢å¤–çš„filesortæ“ä½œ</p>
<p><strong>ä¼˜åŒ–</strong>: åˆ›å»ºè”åˆç´¢å¼•<code>idx_age_birthday(age, birthday)</code>,ORDER BYå­—æ®µåœ¨ç´¢å¼•ä¸­,é¿å…filesort</p>
<h3 data-id="heading-28">6.2 æ…¢æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜</h3>
<p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">slow_query_log=ON                           <span class="hljs-comment"># å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span>
long_query_time=1                           <span class="hljs-comment"># æ…¢æŸ¥è¯¢é˜ˆå€¼1ç§’</span>
slow_query_log_file=/var/log/mysql-slow.log
log_queries_not_using_indexes=ON            <span class="hljs-comment"># è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span>
</code></pre>
<p><strong>æ…¢æŸ¥è¯¢åˆ†æå·¥å…·</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># mysqldumpslow: MySQLè‡ªå¸¦çš„æ…¢æŸ¥è¯¢åˆ†æå·¥å…·</span>
mysqldumpslow -s t -t 10 /var/log/mysql-slow.log  <span class="hljs-comment"># æŒ‰æ—¶é—´æ’åº,æ˜¾ç¤ºå‰10æ¡</span>

<span class="hljs-comment"># pt-query-digest: Percona Toolkitå·¥å…·(æ¨è)</span>
pt-query-digest /var/log/mysql-slow.log
</code></pre>
<p><strong>å¸¸è§æ…¢æŸ¥è¯¢åœºæ™¯ä¸ä¼˜åŒ–</strong>:</p>
<p><strong>åœºæ™¯1: ç´¢å¼•å¤±æ•ˆ - åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(birthday) <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ– (ä½¿ç”¨ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> birthday <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2000-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2000-12-31'</span>;
</code></pre>
<p><strong>åœºæ™¯2: ç´¢å¼•å¤±æ•ˆ - éšå¼ç±»å‹è½¬æ¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (nameæ˜¯varchar,ä¸æ•°å­—123æ¯”è¾ƒ,å‘ç”Ÿéšå¼ç±»å‹è½¬æ¢,ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'123'</span>;
</code></pre>
<p><strong>åœºæ™¯3: ç´¢å¼•å¤±æ•ˆ - LIKEå‰ç¼€é€šé…ç¬¦</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (å‰ç¼€é€šé…ç¬¦,ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%abc'</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ– (åç¼€é€šé…ç¬¦,å¯ä½¿ç”¨ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'abc%'</span>;
</code></pre>
<p><strong>åœºæ™¯4: å›è¡¨æ¬¡æ•°è¿‡å¤š - ä½¿ç”¨è¦†ç›–ç´¢å¼•</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (å›è¡¨100ä¸‡æ¬¡)</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;  <span class="hljs-comment">-- å‡è®¾è¿”å›100ä¸‡è¡Œ</span>

<span class="hljs-comment">-- âœ… ä¼˜åŒ– (è¦†ç›–ç´¢å¼•,æ— éœ€å›è¡¨)</span>
<span class="hljs-comment">-- åˆ›å»ºè”åˆç´¢å¼• idx_age_name_id(age, name, id)</span>
<span class="hljs-comment">-- æˆ–è€…åªæŸ¥è¯¢ç´¢å¼•åˆ—</span>
<span class="hljs-keyword">SELECT</span> id, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>åœºæ™¯5: æ·±åˆ†é¡µé—®é¢˜</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (æ‰«æ100ä¸‡+10è¡Œ,ä¸¢å¼ƒ100ä¸‡è¡Œ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">10</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–1: ä½¿ç”¨idèŒƒå›´æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000000</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–2: å»¶è¿Ÿå…³è” (å…ˆæŸ¥ä¸»é”®,å†å›è¡¨)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users
<span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">10</span>);
</code></pre>
<p><strong>åœºæ™¯6: æœªæ·»åŠ å¿…è¦ç´¢å¼•</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (WHEREæ¡ä»¶åˆ—æ— ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–: åˆ›å»ºè”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_id_status (user_id, status);
</code></pre>
<hr/>
<h2 data-id="heading-29">ä¸ƒã€æœ€ä½³å®è·µä¸æ€»ç»“</h2>
<h3 data-id="heading-30">7.1 SQLç¼–å†™è§„èŒƒ</h3>
<p>**1. é¿å…SELECT ***:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ)</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>å¥½å¤„</strong>: å‡å°‘ç½‘ç»œä¼ è¾“ã€å‡å°‘Buffer Poolå ç”¨ã€å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•</p>
<p><strong>2. WHEREæ¡ä»¶åˆ—æ·»åŠ ç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (ageåˆ—æ— ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (æ·»åŠ ç´¢å¼•)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);
</code></pre>
<p><strong>3. é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(birthday) <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡®</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> birthday <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2000-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2000-12-31'</span>;
</code></pre>
<p><strong>4. ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢ç»“æœ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (è¿”å›å…¨éƒ¨100ä¸‡è¡Œ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (é™åˆ¶è¿”å›1000è¡Œ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> LIMIT <span class="hljs-number">1000</span>;
</code></pre>
<p><strong>5. é¿å…å¤§äº‹åŠ¡,æ§åˆ¶äº‹åŠ¡èŒƒå›´</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (å¤§äº‹åŠ¡,é”å®šæ—¶é—´é•¿)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-comment">-- ... æ‰§è¡Œ100æ¡SQL ...</span>
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (æ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">27</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h3 data-id="heading-31">7.2 ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ</h3>
<p><strong>1. é«˜é€‰æ‹©æ€§å­—æ®µä¼˜å…ˆå»ºç´¢å¼•</strong>:</p>
<ul>
<li>âœ… <strong>é€‰æ‹©æ€§é«˜</strong>: ä¸»é”®ã€å”¯ä¸€é”®ã€æ‰‹æœºå·ã€é‚®ç®± (æ¯ä¸ªå€¼å‡ ä¹å”¯ä¸€)</li>
<li>âŒ <strong>é€‰æ‹©æ€§ä½</strong>: æ€§åˆ«ã€çŠ¶æ€ã€ç±»å‹ (åªæœ‰2-5ä¸ªå€¼)</li>
</ul>
<p><strong>2. è”åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºè”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age_name (age, name);

<span class="hljs-comment">-- âœ… èƒ½ä½¿ç”¨ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;                    <span class="hljs-comment">-- ä½¿ç”¨age</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>; <span class="hljs-comment">-- ä½¿ç”¨age + name</span>

<span class="hljs-comment">-- âŒ ä¸èƒ½ä½¿ç”¨ç´¢å¼• (è¿åæœ€å·¦å‰ç¼€åŸåˆ™)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;              <span class="hljs-comment">-- nameä¸æ˜¯æœ€å·¦åˆ—</span>
</code></pre>
<p><strong>3. è¦†ç›–ç´¢å¼•,é¿å…å›è¡¨</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢: SELECT id, age FROM users WHERE age &gt; 25;</span>

<span class="hljs-comment">-- âœ… åˆ›å»ºè¦†ç›–ç´¢å¼• (ç´¢å¼•åŒ…å«id, age)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);  <span class="hljs-comment">-- idæ˜¯ä¸»é”®,è‡ªåŠ¨åŒ…å«åœ¨äºŒçº§ç´¢å¼•ä¸­</span>

<span class="hljs-comment">-- æ‰§è¡Œè®¡åˆ’: Extra=Using index (è¦†ç›–ç´¢å¼•,æ— éœ€å›è¡¨)</span>
</code></pre>
<p><strong>4. ç´¢å¼•åˆ—ä¸å®œè¿‡å¤š</strong>:</p>
<ul>
<li>å•è¡¨ç´¢å¼•æ•°é‡å»ºè®® â‰¤ 5ä¸ª</li>
<li>è”åˆç´¢å¼•å­—æ®µæ•°é‡å»ºè®® â‰¤ 3ä¸ª</li>
<li><strong>ç´¢å¼•è¿‡å¤š</strong>: å½±å“INSERT/UPDATE/DELETEæ€§èƒ½,å ç”¨ç©ºé—´</li>
</ul>
<p><strong>5. å®šæœŸæ¸…ç†æ— ç”¨ç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢æœªä½¿ç”¨çš„ç´¢å¼• (MySQL 5.7+)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.schema_unused_indexes;

<span class="hljs-comment">-- åˆ é™¤æ— ç”¨ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">DROP</span> INDEX idx_unused;
</code></pre>
<h3 data-id="heading-32">7.3 Buffer Poolè°ƒä¼˜</h3>
<p><strong>1. åˆç†è®¾ç½®Buffer Poolå¤§å°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_buffer_pool_size=8G     <span class="hljs-comment"># å»ºè®®:ç‰©ç†å†…å­˜çš„50-80%</span>
</code></pre>
<p><strong>ç›‘æ§Buffer Poolå‘½ä¸­ç‡</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Innodb_buffer_pool%'</span>;

<span class="hljs-comment">-- è®¡ç®—å‘½ä¸­ç‡</span>
Buffer Poolå‘½ä¸­ç‡ <span class="hljs-operator">=</span> (Innodb_buffer_pool_read_requests <span class="hljs-operator">-</span> Innodb_buffer_pool_reads) <span class="hljs-operator">/</span> Innodb_buffer_pool_read_requests

<span class="hljs-comment">-- å»ºè®®: å‘½ä¸­ç‡ â‰¥ 99%</span>
</code></pre>
<p><strong>2. å¤šå®ä¾‹å‡å°‘é”ç«äº‰</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_buffer_pool_instances=8  <span class="hljs-comment"># Buffer Poolå®ä¾‹æ•°,é»˜è®¤8 (â‰¥1GBæ—¶ç”Ÿæ•ˆ)</span>
</code></pre>
<h3 data-id="heading-33">7.4 æ—¥å¿—å‚æ•°è°ƒä¼˜</h3>
<p><strong>1. Redo Logé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_log_file_size=1G              <span class="hljs-comment"># Redo Logå•ä¸ªæ–‡ä»¶å¤§å°</span>
innodb_log_files_in_group=2          <span class="hljs-comment"># Redo Logæ–‡ä»¶æ•°é‡</span>
innodb_flush_log_at_trx_commit=1     <span class="hljs-comment"># åˆ·ç›˜ç­–ç•¥:</span>
                                     <span class="hljs-comment"># 0: æ¯ç§’åˆ·ç›˜ä¸€æ¬¡ (æ€§èƒ½æœ€å¥½,ä½†å¯èƒ½ä¸¢å¤±1ç§’æ•°æ®)</span>
                                     <span class="hljs-comment"># 1: æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜ (æœ€å®‰å…¨,æ¨è)</span>
                                     <span class="hljs-comment"># 2: æ¯æ¬¡æäº¤å†™OSç¼“å­˜,æ¯ç§’åˆ·ç›˜ (æŠ˜ä¸­)</span>
</code></pre>
<p><strong>2. Binlogé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">sync_binlog=1                        <span class="hljs-comment"># æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜(æœ€å®‰å…¨)</span>
binlog_format=ROW                    <span class="hljs-comment"># ROWæ¨¡å¼(æ¨è),è®°å½•è¡Œå˜æ›´</span>
expire_logs_days=7                   <span class="hljs-comment"># Binlogä¿ç•™7å¤©</span>
</code></pre>
<h3 data-id="heading-34">7.5 æ€»ç»“</h3>
<p><strong>MySQLæ¶æ„æ ¸å¿ƒè¦ç‚¹</strong>:</p>
<ol>
<li><strong>é€»è¾‘æ¶æ„åˆ†ä¸º3å±‚</strong>: è¿æ¥å±‚ã€SQLå±‚(Serverå±‚)ã€å­˜å‚¨å¼•æ“å±‚,Serverå±‚ä¸å­˜å‚¨å¼•æ“è§£è€¦</li>
<li><strong>InnoDBæ˜¯é»˜è®¤å¼•æ“</strong>: æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®ã€å´©æºƒæ¢å¤ã€MVCC,ç”Ÿäº§ç¯å¢ƒé¦–é€‰</li>
<li><strong>Buffer Poolæ˜¯æ€§èƒ½æ ¸å¿ƒ</strong>: ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/O,æ”¹è¿›çš„LRUç®—æ³•é˜²æ­¢ç¼“å­˜æ±¡æŸ“</li>
<li><strong>B+æ ‘ç´¢å¼•ç»“æ„</strong>: 3å±‚B+æ ‘èƒ½å­˜2000ä¸‡è¡Œ,æŸ¥è¯¢åªéœ€3æ¬¡I/O,èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ</li>
<li><strong>WALæœºåˆ¶</strong>: å…ˆå†™æ—¥å¿—(Redo Log/Binlog),å†å¼‚æ­¥åˆ·è„é¡µ,å†™å…¥æ€§èƒ½æå‡10-100å€</li>
<li><strong>2PCä¸¤é˜¶æ®µæäº¤</strong>: ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§,é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>EXPLAINæ˜¯SQLä¼˜åŒ–ç¬¬ä¸€æ­¥</strong>: åˆ†ææ‰§è¡Œè®¡åˆ’,å®šä½æ€§èƒ½ç“¶é¢ˆ,typeè¾¾åˆ°refä»¥ä¸Š,é¿å…å…¨è¡¨æ‰«æå’ŒUsing filesort</li>
</ol>
<p><strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong>:</p>
<ul>
<li><strong>åˆç†è®¾è®¡ç´¢å¼•</strong>: é«˜é€‰æ‹©æ€§å­—æ®µä¼˜å…ˆ,éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™,ä½¿ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨</li>
<li><strong>é¿å…ç´¢å¼•å¤±æ•ˆ</strong>: ä¸åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°,é¿å…éšå¼ç±»å‹è½¬æ¢,LIKEé¿å…å‰ç¼€é€šé…ç¬¦</li>
<li><strong>åˆç†é…ç½®Buffer Pool</strong>: è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„50-80%,ç›‘æ§å‘½ä¸­ç‡â‰¥99%</li>
<li><strong>ä½¿ç”¨EXPLAINåˆ†ææ¯æ¡SQL</strong>: ä¸Šçº¿å‰å¿…é¡»EXPLAIN,ç¡®ä¿typeè¾¾åˆ°refä»¥ä¸Š</li>
<li><strong>å®šæœŸReviewæ…¢æŸ¥è¯¢æ—¥å¿—</strong>: å‘ç°æ€§èƒ½ç“¶é¢ˆ,åŠæ—¶ä¼˜åŒ–</li>
</ul>
<p>æŒæ¡MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹,æ˜¯æ¯ä½åç«¯å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ã€‚é€šè¿‡æ·±å…¥ç†è§£MySQLçš„å†…éƒ¨è¿è¡Œæœºåˆ¶,ç»“åˆEXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æå’Œæ…¢æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜,èƒ½å¤Ÿåœ¨é¢è¯•å’Œå®é™…å·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™,æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ•°æ®åº“ç³»ç»Ÿã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>:</p>
<ul>
<li>ã€ŠMySQLæŠ€æœ¯å†…å¹•: InnoDBå­˜å‚¨å¼•æ“ã€‹(ç¬¬2ç‰ˆ) - å§œæ‰¿å°§</li>
<li>ã€Šé«˜æ€§èƒ½MySQLã€‹(ç¬¬4ç‰ˆ) - Baron Schwartzç­‰</li>
<li>MySQLå®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2F" target="_blank" title="https://dev.mysql.com/doc/" ref="nofollow noopener noreferrer">dev.mysql.com/doc/</a></li>
<li>InnoDBå­˜å‚¨å¼•æ“å®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F8.0%2Fen%2Finnodb-storage-engine.html" target="_blank" title="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html" ref="nofollow noopener noreferrer">dev.mysql.com/doc/refman/â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7585706951583842313</link>    <guid>https://juejin.cn/post/7585706951583842313</guid>    <pubDate>2025-12-20T12:00:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951583842313" data-draft-id="7585484081435787315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-20T12:00:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="okseekw"/> <meta itemprop="url" content="https://juejin.cn/user/1933379625032649"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1933379625032649/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    okseekw
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:00:17.000Z" title="Sat Dec 20 2025 12:00:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯</h2>
<p>åœ¨ç°ä»£Javaå¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹æ˜¯æå‡ç¨‹åºæ€§èƒ½ã€ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚æ— è®ºæ˜¯é«˜å¹¶å‘çš„ç”µå•†ç³»ç»Ÿã€å®æ—¶é€šä¿¡åº”ç”¨ï¼Œè¿˜æ˜¯åå°æ•°æ®å¤„ç†æœåŠ¡ï¼Œéƒ½ç¦»ä¸å¼€å¤šçº¿ç¨‹çš„æ”¯æŒã€‚æœ¬æ–‡å°†ä»çº¿ç¨‹åŸºç¡€æ¦‚å¿µå‡ºå‘ï¼Œé€æ­¥æ·±å…¥çº¿ç¨‹åˆ›å»ºã€å¸¸ç”¨æ–¹æ³•ã€çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹æ± ç­‰æ ¸å¿ƒæŠ€æœ¯ï¼Œå¹¶é€šè¿‡å®æˆ˜æ¡ˆä¾‹å¸®åŠ©å¤§å®¶æŒæ¡å¤šçº¿ç¨‹çš„å®é™…åº”ç”¨ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€çº¿ç¨‹ä¸å¤šçº¿ç¨‹åŸºç¡€è®¤çŸ¥</h3>
<h4 data-id="heading-2">1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</h4>
<p>çº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯ç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œæµç¨‹ï¼Œä¸€ä¸ªç¨‹åºè‹¥åªæœ‰ä¸€æ¡æ‰§è¡Œæµç¨‹ï¼Œåˆ™ä¸ºå•çº¿ç¨‹ç¨‹åºã€‚ä¾‹å¦‚ï¼Œç®€å•çš„æ§åˆ¶å°è¾“å‡ºç¨‹åºé€šå¸¸æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚</p>
<h4 data-id="heading-3">2. å¤šçº¿ç¨‹çš„å®šä¹‰ä¸åº”ç”¨åœºæ™¯</h4>
<p>å¤šçº¿ç¨‹æ˜¯æŒ‡ä»è½¯ç¡¬ä»¶å±‚é¢å®ç°å¤šæ¡æ‰§è¡Œæµç¨‹çš„æŠ€æœ¯ï¼Œå¤šæ¡çº¿ç¨‹ç”±CPUè°ƒåº¦æ‰§è¡Œã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äº<strong>æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡</strong>ï¼Œè®©å¤šä¸ªä»»åŠ¡å¹¶è¡Œå¤„ç†ã€‚</p>
<p><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>12306è´­ç¥¨ç³»ç»Ÿï¼šåŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ç”¨æˆ·çš„æŸ¥è¯¢ã€è´­ç¥¨è¯·æ±‚</li>
<li>ç™¾åº¦ç½‘ç›˜ä¸Šä¼ ä¸‹è½½ï¼šåå°ä¼ è¾“æ–‡ä»¶çš„åŒæ—¶ï¼Œå‰å°å¯è¿›è¡Œå…¶ä»–æ“ä½œ</li>
<li>ç”µå•†å¹³å°ï¼šè®¢å•å¤„ç†ã€åº“å­˜æ›´æ–°ã€æ¶ˆæ¯æ¨é€ç­‰ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ</li>
</ul>
<h4 data-id="heading-4">3. å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«</h4>
<ul>
<li><strong>å¹¶å‘</strong>ï¼šCPUè½®è¯¢è°ƒåº¦å¤šä¸ªçº¿ç¨‹ï¼Œç”±äºåˆ‡æ¢é€Ÿåº¦æå¿«ï¼Œç»™äºº"åŒæ—¶æ‰§è¡Œ"çš„é”™è§‰ï¼ˆå®é™…åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼‰</li>
<li><strong>å¹¶è¡Œ</strong>ï¼šåŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è¢«CPUåŒæ—¶è°ƒåº¦æ‰§è¡Œï¼ˆéœ€å¤šæ ¸CPUæ”¯æŒï¼‰</li>
</ul>
<h3 data-id="heading-5">äºŒã€Javaå¤šçº¿ç¨‹çš„ä¸‰ç§åˆ›å»ºæ–¹å¼</h3>
<p>Javaæä¾›äº†ä¸‰ç§ä¸»æµçš„çº¿ç¨‹åˆ›å»ºæ–¹å¼ï¼Œå„æœ‰ä¼˜åŠ£ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ã€‚</p>
<h4 data-id="heading-6">1. ç»§æ‰¿Threadç±»</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„åˆ›å»ºæ–¹å¼ï¼Œæ­¥éª¤ç®€å•ç›´æ¥ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å®šä¹‰å­ç±»ç»§æ‰¿<code>java.lang.Thread</code></li>
<li>é‡å†™<code>run()</code>æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹ä»»åŠ¡é€»è¾‘</li>
<li>åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œè°ƒç”¨<code>start()</code>æ–¹æ³•å¯åŠ¨çº¿ç¨‹</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadDemo1</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span>
        Thread t1 = <span class="hljs-keyword">new</span> MyThread();
        <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹ï¼ˆå¿…é¡»è°ƒç”¨start()ï¼Œè€Œéç›´æ¥è°ƒç”¨run()ï¼‰</span>
        t1.start();

        <span class="hljs-comment">// ä¸»çº¿ç¨‹ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}

<span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-title">extends</span> <span class="hljs-title">Thread</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        <span class="hljs-comment">// å­çº¿ç¨‹ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç¼–ç ç®€å•ï¼Œå¯ç›´æ¥ä½¿ç”¨Threadç±»çš„æ–¹æ³•</li>
<li>ç¼ºç‚¹ï¼šJavaå•ç»§æ‰¿é™åˆ¶ï¼Œçº¿ç¨‹ç±»æ— æ³•ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ‰©å±•æ€§å·®</li>
</ul>
<h4 data-id="heading-7">2. å®ç°Runnableæ¥å£</h4>
<p>æ¨èä½¿ç”¨çš„åˆ›å»ºæ–¹å¼ï¼Œè§„é¿äº†å•ç»§æ‰¿é™åˆ¶ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å®šä¹‰ä»»åŠ¡ç±»å®ç°<code>Runnable</code>æ¥å£</li>
<li>é‡å†™<code>run()</code>æ–¹æ³•ï¼Œç¼–å†™ä»»åŠ¡é€»è¾‘</li>
<li>åˆ›å»ºä»»åŠ¡å¯¹è±¡ï¼Œäº¤ç»™Threadå¤„ç†</li>
<li>è°ƒç”¨<code>start()</code>æ–¹æ³•å¯åŠ¨çº¿ç¨‹</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼ˆå«åŒ¿åå†…éƒ¨ç±»ç®€åŒ–å†™æ³•ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadDemo2_2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// æ–¹å¼1ï¼šå¸¸è§„å†™æ³•</span>
        Runnable r = <span class="hljs-keyword">new</span> Runnable() {
            @Override
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹1è¾“å‡ºï¼š"</span> + i);
                }
            }
        };
        <span class="hljs-keyword">new</span> Thread(r).start();

        <span class="hljs-comment">// æ–¹å¼2ï¼šåŒ¿åå†…éƒ¨ç±»ç®€åŒ–</span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() {
            @Override
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹2è¾“å‡ºï¼š"</span> + i);
                }
            }
        }).start();

        <span class="hljs-comment">// æ–¹å¼3ï¼šLambdaè¡¨è¾¾å¼ï¼ˆJDK8+ï¼‰</span>
        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹3è¾“å‡ºï¼š"</span> + i);
            }
        }).start();

        <span class="hljs-comment">// ä¸»çº¿ç¨‹ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä»»åŠ¡ç±»å¯ç»§æ‰¿å…¶ä»–ç±»ã€å®ç°å…¶ä»–æ¥å£ï¼Œæ‰©å±•æ€§å¼º</li>
<li>ç¼ºç‚¹ï¼šæ— æ³•ç›´æ¥è¿”å›çº¿ç¨‹æ‰§è¡Œç»“æœ</li>
</ul>
<h4 data-id="heading-8">3. å®ç°Callableæ¥å£ï¼ˆJDK5+ï¼‰</h4>
<p>è§£å†³äº†å‰ä¸¤ç§æ–¹å¼æ— æ³•è¿”å›æ‰§è¡Œç»“æœçš„é—®é¢˜ï¼Œé€‚ç”¨äºéœ€è¦è·å–çº¿ç¨‹æ‰§è¡Œç»“æœçš„åœºæ™¯ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å®šä¹‰ä»»åŠ¡ç±»å®ç°<code>Callable</code>æ¥å£ï¼ŒæŒ‡å®šè¿”å›å€¼ç±»å‹</li>
<li>é‡å†™<code>call()</code>æ–¹æ³•ï¼ˆå¯æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œç¼–å†™ä»»åŠ¡é€»è¾‘å¹¶è¿”å›ç»“æœ</li>
<li>å°†Callableå¯¹è±¡å°è£…ä¸º<code>FutureTask</code>ï¼ˆå…¼å…·Runnableå’Œç»“æœè·å–åŠŸèƒ½ï¼‰</li>
<li>äº¤ç»™Threadå¤„ç†å¹¶å¯åŠ¨çº¿ç¨‹</li>
<li>é€šè¿‡<code>FutureTask.get()</code>æ–¹æ³•è·å–æ‰§è¡Œç»“æœ</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;
<span class="hljs-keyword">import</span> java.util.concurrent.FutureTask;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadDemo3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// åˆ›å»ºCallableä»»åŠ¡å¯¹è±¡</span>
        Callable&lt;String&gt; c1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>(<span class="hljs-number">100</span>);
        Callable&lt;String&gt; c2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>(<span class="hljs-number">50</span>);

        <span class="hljs-comment">// å°è£…ä¸ºFutureTask</span>
        FutureTask&lt;String&gt; f1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(c1);
        FutureTask&lt;String&gt; f2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(c2);

        <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(f1).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(f2).start();

        <span class="hljs-comment">// è·å–æ‰§è¡Œç»“æœï¼ˆä¸»çº¿ç¨‹ä¼šé˜»å¡ç›´åˆ°ç»“æœè¿”å›ï¼‰</span>
        System.out.println(f1.get());
        System.out.println(f2.get());
    }
}

<span class="hljs-comment">// è‡ªå®šä¹‰Callableä»»åŠ¡ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> n;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyCallable</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-built_in">this</span>.n = n;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= n; i++) {
            sum += i;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1-"</span> + n + <span class="hljs-string">"çš„å’Œæ˜¯ï¼š"</span> + sum;
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ‰©å±•æ€§å¼ºï¼Œå¯è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ</li>
<li>ç¼ºç‚¹ï¼šç¼–ç ç›¸å¯¹å¤æ‚ï¼Œè·å–ç»“æœæ—¶å¯èƒ½é˜»å¡</li>
</ul>
<h3 data-id="heading-9">ä¸‰ã€çº¿ç¨‹å¸¸ç”¨æ ¸å¿ƒæ–¹æ³•</h3>

































<table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>start()</code></td><td>å¯åŠ¨çº¿ç¨‹ï¼ŒJVMè°ƒç”¨<code>run()</code>æ–¹æ³•</td></tr><tr><td><code>run()</code></td><td>çº¿ç¨‹ä»»åŠ¡é€»è¾‘æ‰€åœ¨ï¼Œä¸å¯ç›´æ¥è°ƒç”¨</td></tr><tr><td><code>getName()</code>/<code>setName()</code></td><td>è·å–/è®¾ç½®çº¿ç¨‹åç§°</td></tr><tr><td><code>currentThread()</code></td><td>è·å–å½“å‰æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡</td></tr><tr><td><code>sleep(long millis)</code></td><td>è®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šæ¯«ç§’æ•°</td></tr><tr><td><code>join()</code></td><td>è®©è°ƒç”¨çº¿ç¨‹å…ˆæ‰§è¡Œå®Œæ¯•ï¼Œå…¶ä»–çº¿ç¨‹å†ç»§ç»­</td></tr></tbody></table>
<p><strong>å…³é”®æ–¹æ³•ç¤ºä¾‹</strong>ï¼š</p>
<ol>
<li><strong>çº¿ç¨‹ä¼‘çœ ï¼ˆsleepï¼‰</strong> ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadApiDemo2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"mainçº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ä¼‘çœ 1ç§’</span>
                Thread.sleep(<span class="hljs-number">1000</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>çº¿ç¨‹æ’é˜Ÿï¼ˆjoinï¼‰</strong> ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadApiDemo3</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws InterruptedException</span> {
        MyThread2 t1 = <span class="hljs-keyword">new</span> MyThread2();
        t1.start();

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>) {
                <span class="hljs-comment">// è®©t1çº¿ç¨‹æ’é˜Ÿï¼Œæ‰§è¡Œå®Œæ¯•åä¸»çº¿ç¨‹å†ç»§ç»­</span>
                t1.<span class="hljs-keyword">join</span>();
            }
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">MyThread2</span> <span class="hljs-title">extends</span> <span class="hljs-title">Thread</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}
</code></pre>
<h3 data-id="heading-10">å››ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-11">1. çº¿ç¨‹å®‰å…¨é—®é¢˜çš„äº§ç”Ÿæ¡ä»¶</h4>
<p>å½“æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š</p>
<ul>
<li>å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ</li>
<li>çº¿ç¨‹å…±äº«åŒä¸€ä¸ªèµ„æº</li>
<li>çº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œä¿®æ”¹æ“ä½œ</li>
</ul>
<p><strong>æ¨¡æ‹Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ï¼ˆé“¶è¡Œå–æ¬¾æ¡ˆä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è´¦æˆ·ç±»ï¼ˆå…±äº«èµ„æºï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> cardId;
    <span class="hljs-keyword">private</span> double money;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">drawMoney</span>(<span class="hljs-params">double money</span>) {
        <span class="hljs-title class_">String</span> name = <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">getName</span>();
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span> &gt;= money) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span> -= money;
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span> + <span class="hljs-string">"å…ƒ"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
        }
    }
}

<span class="hljs-comment">// å–æ¬¾çº¿ç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Thread</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Account</span> account;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DrawThread</span>(<span class="hljs-title class_">String</span> name, <span class="hljs-title class_">Account</span> account) {
        <span class="hljs-variable language_">super</span>(name);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">account</span> = account;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        account.<span class="hljs-title function_">drawMoney</span>(<span class="hljs-number">100000</span>);
    }
}

<span class="hljs-comment">// æµ‹è¯•ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadDemo1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// åŒä¸€ä¸ªè´¦æˆ·ï¼Œåˆå§‹ä½™é¢10ä¸‡</span>
        <span class="hljs-title class_">Account</span> account = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>(<span class="hljs-string">"ICBC-110"</span>, <span class="hljs-number">100000</span>);
        <span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å–æ¬¾10ä¸‡</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawThread</span>(<span class="hljs-string">"å°æ˜"</span>, account).<span class="hljs-title function_">start</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawThread</span>(<span class="hljs-string">"å°çº¢"</span>, account).<span class="hljs-title function_">start</span>();
    }
}
</code></pre>
<p><strong>é—®é¢˜ç°è±¡</strong>ï¼šå¯èƒ½å‡ºç°å°æ˜å’Œå°çº¢åŒæ—¶å–æ¬¾æˆåŠŸï¼Œä½™é¢å˜ä¸ºè´Ÿæ•°çš„æƒ…å†µã€‚</p>
<h4 data-id="heading-12">2. çº¿ç¨‹åŒæ­¥è§£å†³æ–¹æ¡ˆ</h4>
<p>æ ¸å¿ƒæ€æƒ³ï¼šè®©å¤šä¸ªçº¿ç¨‹<strong>å…ˆåä¾æ¬¡è®¿é—®</strong>å…±äº«èµ„æºï¼Œé¿å…å¹¶å‘ä¿®æ”¹ã€‚</p>
<h5 data-id="heading-13">ï¼ˆ1ï¼‰åŒæ­¥ä»£ç å—</h5>
<p>å°†è®¿é—®å…±äº«èµ„æºçš„æ ¸å¿ƒä»£ç ä¸Šé”ï¼Œæ¯æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ‰§è¡Œã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span> (é”å¯¹è±¡) {
    <span class="hljs-comment">// è®¿é—®å…±äº«èµ„æºçš„æ ¸å¿ƒä»£ç </span>
}
</code></pre>
<p><strong>ä¼˜åŒ–åçš„è´¦æˆ·ç±»</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> String cardId;
    <span class="hljs-keyword">private</span> double money;

    <span class="hljs-keyword">public</span> void drawMoney(double money) {
        String name = Thread.currentThread().getName();
        <span class="hljs-comment">// é”å¯¹è±¡ï¼šæ¨èä½¿ç”¨å…±äº«èµ„æºæœ¬èº«ï¼ˆthisï¼‰</span>
        synchronized (<span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.money &gt;= money) {
                System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
                <span class="hljs-keyword">this</span>.money -= money;
                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-keyword">this</span>.money + <span class="hljs-string">"å…ƒ"</span>);
            } <span class="hljs-keyword">else</span> {
                System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-14">ï¼ˆ2ï¼‰åŒæ­¥æ–¹æ³•</h5>
<p>å°†æ•´ä¸ªæ–¹æ³•ä¸Šé”ï¼Œç®€åŒ–åŒæ­¥ä»£ç å—çš„å†™æ³•ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¿®é¥°ç¬¦ <span class="hljs-keyword">synchronized</span> è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å‚æ•°åˆ—è¡¨) {
    <span class="hljs-comment">// æ“ä½œå…±äº«èµ„æºçš„ä»£ç </span>
}
</code></pre>
<p><strong>ä¼˜åŒ–åçš„å–æ¬¾æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> synchronized <span class="hljs-keyword">void</span> <span class="hljs-title">drawMoney</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> money</span>)</span> {
    String name = Thread.currentThread().getName();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.money &gt;= money) {
        System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
        <span class="hljs-keyword">this</span>.money -= money;
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-keyword">this</span>.money + <span class="hljs-string">"å…ƒ"</span>);
    } <span class="hljs-keyword">else</span> {
        System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
    }
}
</code></pre>
<p><strong>åº•å±‚åŸç†</strong>ï¼š</p>
<ul>
<li>å®ä¾‹æ–¹æ³•ï¼šé»˜è®¤ä½¿ç”¨<code>this</code>ä½œä¸ºé”å¯¹è±¡</li>
<li>é™æ€æ–¹æ³•ï¼šé»˜è®¤ä½¿ç”¨<code>ç±»å.class</code>ä½œä¸ºé”å¯¹è±¡</li>
</ul>
<h5 data-id="heading-15">ï¼ˆ3ï¼‰Locké”ï¼ˆJDK5+ï¼‰</h5>
<p><code>java.util.concurrent.locks.Lock</code>æ¥å£æä¾›äº†æ›´çµæ´»çš„é”å®šæ“ä½œï¼Œæ¨èä½¿ç”¨å…¶å®ç°ç±»<code>ReentrantLock</code>ã€‚</p>
<p><strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼š</p>
<ul>
<li><code>lock()</code>ï¼šè·å–é”</li>
<li><code>unlock()</code>ï¼šé‡Šæ”¾é”ï¼ˆå»ºè®®åœ¨<code>finally</code>ä¸­æ‰§è¡Œï¼Œç¡®ä¿é”ä¸€å®šé‡Šæ”¾ï¼‰</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.Lock;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> String cardId;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> money;
    <span class="hljs-comment">// åˆ›å»ºLocké”å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawMoney</span><span class="hljs-params">(<span class="hljs-type">double</span> money)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> Thread.currentThread().getName();
        lock.lock(); <span class="hljs-comment">// åŠ é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.money &gt;= money) {
                System.out.println(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
                <span class="hljs-built_in">this</span>.money -= money;
                System.out.println(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-built_in">this</span>.money + <span class="hljs-string">"å…ƒ"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">// é‡Šæ”¾é”ï¼ˆæ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œéƒ½å¿…é¡»é‡Šæ”¾ï¼‰</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-16">äº”ã€çº¿ç¨‹æ± æŠ€æœ¯ï¼ˆJDK5+ï¼‰</h3>
<h4 data-id="heading-17">1. çº¿ç¨‹æ± çš„æ ¸å¿ƒä»·å€¼</h4>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ï¼ˆçº¿ç¨‹åˆ›å»ºæˆæœ¬é«˜ï¼‰</li>
<li>æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢çº¿ç¨‹è¿‡å¤šå¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½</li>
<li>å¤ç”¨çº¿ç¨‹ï¼Œæé«˜ç¨‹åºå“åº”é€Ÿåº¦</li>
</ul>
<h4 data-id="heading-18">2. çº¿ç¨‹æ± çš„åˆ›å»ºæ–¹å¼</h4>
<h5 data-id="heading-19">ï¼ˆ1ï¼‰é€šè¿‡ThreadPoolExecutoræ‰‹åŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰</h5>
<p><code>ThreadPoolExecutor</code>æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ç±»ï¼Œå¯çµæ´»é…ç½®å‚æ•°ã€‚</p>
<p><strong>æ„é€ å™¨å‚æ•°è¯´æ˜</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(
    <span class="hljs-type">int</span> corePoolSize, <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆå¸¸é©»çº¿ç¨‹ï¼‰</span>
    <span class="hljs-type">int</span> maximumPoolSize, <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ ¸å¿ƒ+ä¸´æ—¶çº¿ç¨‹ï¼‰</span>
    <span class="hljs-type">long</span> keepAliveTime, <span class="hljs-comment">// ä¸´æ—¶çº¿ç¨‹ç©ºé—²æ—¶é—´</span>
    TimeUnit unit, <span class="hljs-comment">// æ—¶é—´å•ä½</span>
    BlockingQueue&lt;Runnable&gt; workQueue, <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—</span>
    ThreadFactory threadFactory, <span class="hljs-comment">// çº¿ç¨‹å·¥å‚ï¼ˆåˆ›å»ºçº¿ç¨‹ï¼‰</span>
    RejectedExecutionHandler handler <span class="hljs-comment">// ä»»åŠ¡æ‹’ç»ç­–ç•¥</span>
)</span>
</span></code></pre>
<p><strong>ä»»åŠ¡æ‹’ç»ç­–ç•¥</strong>ï¼š</p>

























<table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>AbortPolicy</td><td>ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td>DiscardPolicy</td><td>ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>DiscardOldestPolicy</td><td>ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€ä¹…çš„ä»»åŠ¡ï¼ŒåŠ å…¥æ–°ä»»åŠ¡</td></tr><tr><td>CallerRunsPolicy</td><td>ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹ï¼ˆå¦‚ä¸»çº¿ç¨‹ï¼‰ç›´æ¥æ‰§è¡Œ</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutorServiceDemo1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹æ± </span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
            <span class="hljs-number">3</span>, <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°3</span>
            <span class="hljs-number">5</span>, <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°5</span>
            <span class="hljs-number">10</span>, <span class="hljs-comment">// ä¸´æ—¶çº¿ç¨‹ç©ºé—²10ç§’åé”€æ¯</span>
            TimeUnit.SECONDS,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>), <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—å®¹é‡3</span>
            Executors.defaultThreadFactory(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy() <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span>
        );

        <span class="hljs-comment">// æäº¤ä»»åŠ¡ï¼ˆRunnableï¼‰</span>
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i++) {
            pool.execute(task);
        }

        <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± ï¼ˆä¸€èˆ¬ä¸ä¸»åŠ¨å…³é—­ï¼Œé™¤éç¨‹åºç»“æŸï¼‰</span>
        <span class="hljs-comment">// pool.shutdown(); // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­</span>
    }
}
</code></pre>
<h5 data-id="heading-20">ï¼ˆ2ï¼‰é€šè¿‡Executorså·¥å…·ç±»åˆ›å»ºï¼ˆä¸æ¨èåœ¨å¤§å‹ç³»ç»Ÿä¸­ä½¿ç”¨ï¼‰</h5>
<p>Executorsæä¾›äº†ç®€åŒ–çš„çº¿ç¨‹æ± åˆ›å»ºæ–¹æ³•ï¼Œä½†å­˜åœ¨èµ„æºè€—å°½é£é™©ï¼š</p>
<ul>
<li><code>newFixedThreadPool(int n)</code>ï¼šå›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </li>
<li><code>newSingleThreadExecutor()</code>ï¼šå•çº¿ç¨‹çº¿ç¨‹æ± </li>
<li><code>newCachedThreadPool()</code>ï¼šç¼“å­˜çº¿ç¨‹æ± ï¼ˆçº¿ç¨‹æ•°å¯æ— é™å¢é•¿ï¼‰</li>
<li><code>newScheduledThreadPool(int corePoolSize)</code>ï¼šå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </li>
</ul>
<p><strong>é£é™©è¯´æ˜</strong>ï¼ˆé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼‰ï¼š</p>
<ul>
<li><code>FixedThreadPool</code>å’Œ<code>SingleThreadExecutor</code>ï¼šä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¯èƒ½å †ç§¯å¤§é‡ä»»åŠ¡å¯¼è‡´OOM</li>
<li><code>CachedThreadPool</code>å’Œ<code>ScheduledThreadPool</code>ï¼šæœ€å¤§çº¿ç¨‹æ•°ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹å¯¼è‡´OOM</li>
</ul>
<h3 data-id="heading-21">å…­ã€å®æˆ˜æ¡ˆä¾‹ï¼šçº¢åŒ…é›¨æ¸¸æˆ</h3>
<h4 data-id="heading-22">éœ€æ±‚è¯´æ˜</h4>
<ul>
<li>100åå‘˜å·¥ï¼ˆ100ä¸ªçº¿ç¨‹ï¼‰æŠ¢200ä¸ªçº¢åŒ…</li>
<li>å°çº¢åŒ…ï¼ˆ1-30å…ƒï¼‰å 80%ï¼ˆ160ä¸ªï¼‰ï¼Œå¤§çº¢åŒ…ï¼ˆ31-100å…ƒï¼‰å 20%ï¼ˆ40ä¸ªï¼‰</li>
<li>è¾“å‡ºæŠ¢çº¢åŒ…è¿‡ç¨‹ï¼Œæ´»åŠ¨ç»“æŸåæŒ‰å‘˜å·¥æŠ¢åˆ°çš„æ€»é‡‘é¢é™åºæ’åº</li>
</ul>
<h4 data-id="heading-23">æ ¸å¿ƒæ€è·¯</h4>
<ol>
<li>ç”Ÿæˆç¬¦åˆè¦æ±‚çš„çº¢åŒ…é›†åˆï¼ˆçº¿ç¨‹å…±äº«èµ„æºï¼‰</li>
<li>100ä¸ªçº¿ç¨‹å¹¶å‘æŠ¢çº¢åŒ…ï¼Œé€šè¿‡åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li>ç»Ÿè®¡æ¯ä¸ªå‘˜å·¥æŠ¢åˆ°çš„æ€»é‡‘é¢ï¼Œæ’åºåå±•ç¤º</li>
</ol>
<h4 data-id="heading-24">å®Œæ•´ä»£ç </h4>
<pre><code class="hljs language-csharp" lang="csharp">import java.util.*;

<span class="hljs-comment">// çº¢åŒ…æŠ¢å¤ºçº¿ç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">PeopleGetRedPacket</span> <span class="hljs-title">extends</span> <span class="hljs-title">Thread</span> {
    <span class="hljs-keyword">private</span> List&lt;Integer&gt; redPackets;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Integer&gt; totalMoneyMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(); <span class="hljs-comment">// ç»Ÿè®¡æ€»é‡‘é¢</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PeopleGetRedPacket</span>(<span class="hljs-params">List&lt;Integer&gt; redPackets, String name</span>)</span> {
        super(name);
        <span class="hljs-keyword">this</span>.redPackets = redPackets;
        totalMoneyMap.put(name, <span class="hljs-number">0</span>); <span class="hljs-comment">// åˆå§‹åŒ–æ€»é‡‘é¢ä¸º0</span>
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        String name = Thread.currentThread().getName();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            synchronized (redPackets) {
                <span class="hljs-keyword">if</span> (redPackets.isEmpty()) {
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-comment">// éšæœºæŠ¢å¤ºä¸€ä¸ªçº¢åŒ…</span>
                <span class="hljs-built_in">int</span> index = <span class="hljs-keyword">new</span> Random().nextInt(redPackets.size());
                Integer money = redPackets.<span class="hljs-keyword">remove</span>(index);
                System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"æŠ¢åˆ°çº¢åŒ…ï¼š"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
                <span class="hljs-comment">// æ›´æ–°æ€»é‡‘é¢</span>
                totalMoneyMap.put(name, totalMoneyMap.<span class="hljs-keyword">get</span>(name) + money);
                <span class="hljs-keyword">if</span> (redPackets.isEmpty()) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"\nçº¢åŒ…é›¨ç»“æŸï¼"</span>);
                    <span class="hljs-comment">// æ’åºå¹¶å±•ç¤ºç»“æœ</span>
                    showResult();
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }

    <span class="hljs-comment">// å±•ç¤ºæŠ¢çº¢åŒ…ç»“æœï¼ˆæŒ‰æ€»é‡‘é¢é™åºï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showResult</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"=== æŠ¢çº¢åŒ…ç»“æœæ’å ==="</span>);
        <span class="hljs-comment">// å°†mapè½¬æ¢ä¸ºlistå¹¶æ’åº</span>
        List&lt;Map.Entry&lt;String, Integer&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(totalMoneyMap.entrySet());
        list.sort((o1, o2) -&gt; o2.getValue() - o1.getValue());

        <span class="hljs-comment">// è¾“å‡ºæ’å</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; list.size(); i++) {
            Map.Entry&lt;String, Integer&gt; entry = list.<span class="hljs-keyword">get</span>(i);
            System.<span class="hljs-keyword">out</span>.println((i + <span class="hljs-number">1</span>) + <span class="hljs-string">"ã€"</span> + entry.getKey() + <span class="hljs-string">" æ€»é‡‘é¢ï¼š"</span> + entry.getValue() + <span class="hljs-string">"å…ƒ"</span>);
        }
    }
}

<span class="hljs-comment">// æµ‹è¯•ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadTest</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// ç”Ÿæˆ200ä¸ªçº¢åŒ…</span>
        List&lt;Integer&gt; redPackets = getRedPackets();
        <span class="hljs-comment">// åˆ›å»º100ä¸ªå‘˜å·¥çº¿ç¨‹æŠ¢çº¢åŒ…</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100</span>; i++) {
            <span class="hljs-keyword">new</span> PeopleGetRedPacket(redPackets, <span class="hljs-string">"å‘˜å·¥"</span> + i).start();
        }
    }

    <span class="hljs-comment">// ç”Ÿæˆçº¢åŒ…ï¼š160ä¸ªå°çº¢åŒ…ï¼Œ40ä¸ªå¤§çº¢åŒ…</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Integer&gt; <span class="hljs-title">getRedPackets</span>()</span> {
        List&lt;Integer&gt; redPackets = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        Random random = <span class="hljs-keyword">new</span> Random();
        <span class="hljs-comment">// å°çº¢åŒ…ï¼ˆ1-30å…ƒï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">160</span>; i++) {
            redPackets.<span class="hljs-keyword">add</span>(random.nextInt(<span class="hljs-number">30</span>) + <span class="hljs-number">1</span>);
        }
        <span class="hljs-comment">// å¤§çº¢åŒ…ï¼ˆ31-100å…ƒï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) {
            redPackets.<span class="hljs-keyword">add</span>(random.nextInt(<span class="hljs-number">70</span>) + <span class="hljs-number">31</span>);
        }
        <span class="hljs-keyword">return</span> redPackets;
    }
}
</code></pre>
<h3 data-id="heading-25">ä¸ƒã€æ€»ç»“</h3>
<p>Javaå¤šçº¿ç¨‹æŠ€æœ¯æ˜¯ä¸€æŠŠ"åŒåˆƒå‰‘"ï¼šåˆç†ä½¿ç”¨èƒ½å¤§å¹…æå‡ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æœå¤„ç†ä¸å½“ï¼ˆå¦‚çº¿ç¨‹å®‰å…¨é—®é¢˜ã€èµ„æºè€—å°½ï¼‰ï¼Œä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸ç”šè‡³å´©æºƒã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹å›é¡¾</strong>ï¼š</p>
<ol>
<li>çº¿ç¨‹åˆ›å»ºä¼˜å…ˆé€‰æ‹©<code>Runnable</code>æˆ–<code>Callable</code>æ¥å£ï¼Œè§„é¿å•ç»§æ‰¿é™åˆ¶</li>
<li>çº¿ç¨‹å®‰å…¨é—®é¢˜éœ€é€šè¿‡åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•æˆ–Locké”è§£å†³</li>
<li>çº¿ç¨‹æ± æ¨èä½¿ç”¨<code>ThreadPoolExecutor</code>æ‰‹åŠ¨åˆ›å»ºï¼Œæ˜ç¡®é…ç½®å‚æ•°</li>
<li>é«˜å¹¶å‘åœºæ™¯éœ€æ³¨æ„èµ„æºæ§åˆ¶ï¼Œé¿å…OOMç­‰é£é™©</li>
</ol>
<p>æŒæ¡å¤šçº¿ç¨‹æŠ€æœ¯éœ€è¦ä¸æ–­å®è·µï¼Œåœ¨å®é™…å¼€å‘ä¸­éœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå¹³è¡¡æ€§èƒ½ä¸å®‰å…¨æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NestJS æ¶æ„è®¾è®¡ç³»åˆ—ï¼šåº”ç”¨æœåŠ¡ä¸é¢†åŸŸæœåŠ¡çš„åŒºåˆ«]]></title>    <link>https://juejin.cn/post/7585458459166375970</link>    <guid>https://juejin.cn/post/7585458459166375970</guid>    <pubDate>2025-12-20T12:32:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166375970" data-draft-id="7585452404113424399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS æ¶æ„è®¾è®¡ç³»åˆ—ï¼šåº”ç”¨æœåŠ¡ä¸é¢†åŸŸæœåŠ¡çš„åŒºåˆ«"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-20T12:32:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»„æ°¸æ ‡hyb"/> <meta itemprop="url" content="https://juejin.cn/user/8451822197277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS æ¶æ„è®¾è®¡ç³»åˆ—ï¼šåº”ç”¨æœåŠ¡ä¸é¢†åŸŸæœåŠ¡çš„åŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/8451822197277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»„æ°¸æ ‡hyb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:32:10.000Z" title="Sat Dec 20 2025 12:32:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href="https://juejin.cn/post/7578198815729696768" target="_blank" title="https://juejin.cn/post/7578198815729696768">NestJS æ¶æ„è®¾è®¡ï¼š5 åˆ†é’ŸæŠ“ä½ DDD çš„å‘½è„‰</a>ã€‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† DDD ï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰çš„ç»å…¸åˆ†å±‚æ¶æ„ã€‚å…¶ä¸­ï¼Œåº”ç”¨å±‚ä¸é¢†åŸŸå±‚åˆ†åˆ«å¯¹åº”ä¸¤ç±»å…³é”®æœåŠ¡ï¼š</p>
<ul>
<li><strong>åº”ç”¨æœåŠ¡ï¼ˆApplication Service / Usecaseï¼‰</strong>ï¼šä½äºåº”ç”¨å±‚ï¼Œè´Ÿè´£æµç¨‹ç¼–æ’ï¼›</li>
<li><strong>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</strong>ï¼šä½äºé¢†åŸŸå±‚ï¼Œæ‰¿è½½æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼šåº”ç”¨æœåŠ¡è¡¨è¾¾ç”¨æˆ·æƒ³åšä»€ä¹ˆï¼Œé¢†åŸŸæœåŠ¡è¡¨è¾¾ä¸šåŠ¡è¯¥æ€ä¹ˆåšã€‚</p>
</blockquote>
<p>ä»¥åˆ›å»ºè®¢å•ä¸ºä¾‹ï¼š</p>
<ul>
<li><strong>åº”ç”¨æœåŠ¡</strong>ï¼šç”¨æˆ·ç‚¹å‡»ç»“ç®— â†’ è®¡ç®—é‡‘é¢ â†’ å‘èµ·æ”¯ä»˜ â†’ åˆ›å»ºè®¢å• â†’ é€šçŸ¥ç”¨æˆ·ï¼›</li>
<li><strong>é¢†åŸŸæœåŠ¡</strong>ï¼šé‡‘é¢è®¡ç®—ã€æ”¯ä»˜å¤„ç†ã€è®¢å•çŠ¶æ€å˜æ›´ç­‰å…·ä½“ä¸šåŠ¡è§„åˆ™ã€‚</li>
</ul>
<p>åº”ç”¨æœåŠ¡è´Ÿè´£<strong>ä¸²è”æ•´ä¸ªç”¨ä¾‹æµç¨‹</strong>ï¼Œè€Œé¢†åŸŸæœåŠ¡åˆ™ä¸“æ³¨äº<strong>æ¯ä¸ªç¯èŠ‚çš„ä¸šåŠ¡å®ç°</strong>ã€‚</p>
<h2 data-id="heading-1">åº”ç”¨æœåŠ¡ï¼ˆUsecaseï¼‰</h2>
<p>åº”ç”¨æœåŠ¡æ˜¯è¡¨è¾¾å…·ä½“ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚å–æ¶ˆè®¢å•ã€åˆ›å»ºæ”¯ä»˜ï¼‰çš„ä¸»è¦è½½ä½“ï¼Œå®ƒå¯¹åº”ç”¨æˆ·å‘èµ·çš„ä¸€ä¸ªå®Œæ•´æ“ä½œæµç¨‹ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒèŒè´£</h3>
<p>åº”ç”¨æœåŠ¡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåè°ƒå™¨ï¼Œå…¶èŒè´£åŒ…æ‹¬ï¼š</p>
<ul>
<li>åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡ä¸é¢†åŸŸæœåŠ¡ï¼›</li>
<li>æ§åˆ¶ä¸šåŠ¡ç”¨ä¾‹çš„æ‰§è¡Œé¡ºåºï¼›</li>
<li>ç»„è£…å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚</li>
</ul>
<p>å°½ç®¡åº”ç”¨å±‚ä¸åº”åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä½†å®ƒå¯ä»¥åˆç†å¤„ç†ä»¥ä¸‹éæ ¸å¿ƒä½†å¿…è¦çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š<strong>æƒé™æ ¡éªŒã€äº‹åŠ¡æ§åˆ¶ã€ç»“æœç»„è£…ã€å‘é€é€šçŸ¥ï¼ˆé‚®ä»¶ã€æ¶ˆæ¯ç­‰éæ ¸å¿ƒä¸šåŠ¡ï¼‰</strong>ã€‚</p>
<h3 data-id="heading-3">ä»£ç ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªçœŸå® NestJS é¡¹ç›®ä¸­çš„åº”ç”¨æœåŠ¡ <code>CancelOrderUsecase</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrderStatus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/modules/payment/client/constant/Order'</span>;
<span class="hljs-comment">// ... çœç•¥å…¶ä»– imports</span>

@<span class="hljs-title class_">Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancelOrderUsecase</span> {
  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">dataAssembler</span>: <span class="hljs-title class_">DataAssembler</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">cancelOrderByOrderIdService</span>: <span class="hljs-title class_">CancelOrderByOrderIdService</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">getOrderByOrderIdService</span>: <span class="hljs-title class_">GetOrderByOrderIdService</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">validatePaymentRelatedEntityPrivilegeService</span>: <span class="hljs-title class_">ValidatePaymentRelatedEntityPrivilegeService</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">stripeService</span>: <span class="hljs-title class_">StripeService</span>;
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">orderId: number, userId: number</span>) {
    <span class="hljs-comment">// 1. è·å–è®¢å•ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> order = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">getOrderByOrderIdService</span>.<span class="hljs-title function_">execute</span>(orderId);

    <span class="hljs-comment">// 2. çŠ¶æ€æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> (order.<span class="hljs-property">status</span> === <span class="hljs-title class_">OrderStatus</span>.<span class="hljs-property">Pending</span>) <span class="hljs-keyword">throw</span> <span class="hljs-title class_">ExceptionFactory</span>.<span class="hljs-title function_">bizException</span>(<span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">INVALID_PARAM</span>);

    <span class="hljs-comment">// 3. æƒé™éªŒè¯</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">validatePaymentRelatedEntityPrivilegeService</span>.<span class="hljs-title function_">execute</span>({
      <span class="hljs-attr">entityId</span>: order.<span class="hljs-property">entityId</span>,
      <span class="hljs-attr">entityType</span>: order.<span class="hljs-property">entityType</span>,
      userId,
    });

    <span class="hljs-comment">// 4. è°ƒç”¨é¢†åŸŸæœåŠ¡æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡</span>
    <span class="hljs-keyword">const</span> cancelResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelOrderByOrderIdService</span>.<span class="hljs-title function_">execute</span>(orderId);

    <span class="hljs-comment">// 5. å¤„ç†ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆéæ ¸å¿ƒä¸šåŠ¡ï¼‰</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">configService</span>.<span class="hljs-property">bizConfig</span>.<span class="hljs-property">isGlobalEdition</span> &amp;&amp; order.<span class="hljs-property">paymentInfo</span>.<span class="hljs-property">invoice</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">stripeService</span>.<span class="hljs-title function_">voidInvoice</span>(order.<span class="hljs-property">paymentInfo</span>.<span class="hljs-property">invoice</span>.<span class="hljs-property">id</span>);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// ç¬¬ä¸‰æ–¹è°ƒç”¨å¤±è´¥ä¸å½±å“ä¸»æµç¨‹</span>
      }
    }

    <span class="hljs-comment">// 6. å‘é€é€šçŸ¥ï¼ˆéæ ¸å¿ƒä¸šåŠ¡ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendNotification</span>(order, userId);

    <span class="hljs-comment">// 7. ç»„è£…è¿”å›ç»“æœ</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataAssembler</span>.<span class="hljs-property">assemble</span>&lt;<span class="hljs-title class_">EntityDTO</span>&lt;<span class="hljs-title class_">Order</span>&gt;&gt;({
      <span class="hljs-attr">domainObject</span>: cancelResult,
    });

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">SingleResponse</span>.<span class="hljs-title function_">of</span>(result);
  }
}
</code></pre>
<p>ä»ä»¥ä¸Šä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“åº”ç”¨æœåŠ¡çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘</strong>ï¼šè®¢å•å–æ¶ˆçš„æ ¸å¿ƒé€»è¾‘ç”± <code>CancelOrderByOrderIdService</code> é¢†åŸŸæœåŠ¡å®ç°ï¼›</li>
<li><strong>ç¼–æ’å¤šä¸ªæœåŠ¡</strong>ï¼šä¾æ¬¡è°ƒç”¨æŸ¥è¯¢ã€éªŒè¯ã€å–æ¶ˆç­‰æœåŠ¡ï¼›</li>
<li><strong>å¤„ç†éæ ¸å¿ƒä¸šåŠ¡</strong>ï¼šå‘é€é€šçŸ¥ã€è°ƒç”¨ Stripe ç¬¬ä¸‰æ–¹ APIï¼›</li>
<li><strong>ç»„è£…è¿”å›ç»“æœ</strong>ï¼šé€šè¿‡ <code>DataAssembler</code> å°†é¢†åŸŸå¯¹è±¡è½¬æ¢ä¸º DTOã€‚</li>
</ul>
<h2 data-id="heading-4">é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</h2>
<p>å¹¶éæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½èƒ½è‡ªç„¶åœ°å½’å±åˆ°æŸä¸ª<strong>å®ä½“</strong>æˆ–<strong>å€¼å¯¹è±¡</strong>ä¸­ã€‚å½“ä¸€ä¸ªæ“ä½œæ¶‰åŠå¤šä¸ªèšåˆã€éœ€è¦åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡ï¼Œæˆ–æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ä¸šåŠ¡è§„åˆ™æ—¶ï¼Œæˆ‘ä»¬å°±å°†å…¶æŠ½ä¸º<strong>é¢†åŸŸæœåŠ¡</strong>ã€‚</p>
<p>å®ƒæ˜¯é¢†åŸŸå±‚çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸“æ³¨äºå®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä½†ä»…é™äºé‚£äº›<strong>ä¸å±äºä»»ä½•å•ä¸€é¢†åŸŸå¯¹è±¡</strong>çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-5">æ ¸å¿ƒåŸåˆ™</h3>
<p>é¢†åŸŸæœåŠ¡çš„è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š</p>
<ul>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªæœåŠ¡ä¸“æ³¨äºä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡æ“ä½œï¼›</li>
<li><strong>æ— çŠ¶æ€</strong>ï¼šçŠ¶æ€ç”±é¢†åŸŸå¯¹è±¡ï¼ˆå¦‚å®ä½“ Entityï¼‰ä¿å­˜ï¼Œé¢†åŸŸæœåŠ¡æœ¬èº«ä¸æŒæœ‰çŠ¶æ€ï¼›</li>
<li><strong>å¯å¤ç”¨æ€§</strong>ï¼šå¯ä»¥è¢«å¤šä¸ªåº”ç”¨æœåŠ¡è°ƒç”¨ä»¥æ‰§è¡Œç›¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼›</li>
<li><strong>çº¯ç²¹æ€§</strong>ï¼šåªå¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œé¿å…æ··å…¥éä¸šåŠ¡ç›¸å…³çš„ä»£ç ã€‚</li>
</ul>
<h3 data-id="heading-6">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨é¢†åŸŸæœåŠ¡ï¼Ÿ</h3>
<ul>
<li>å½“éœ€è¦æ‰§è¡Œä¸€ä¸ªæ˜¾è‘—çš„ä¸šåŠ¡æ“ä½œè¿‡ç¨‹æ—¶ï¼›</li>
<li>å¯¹é¢†åŸŸå¯¹è±¡è¿›è¡Œè½¬æ¢æˆ–è®¡ç®—ï¼›</li>
<li>å½“ä¸šåŠ¡é€»è¾‘æ¶‰åŠå¤šä¸ªé¢†åŸŸå¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦è¿”å›ä¸€ä¸ªå€¼å¯¹è±¡ä½œä¸ºç»“æœæ—¶ã€‚</li>
</ul>
<h3 data-id="heading-7">ä»£ç ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬åŒæ ·æ¥çœ‹ä¸€ä¸ªçœŸå® NestJS é¡¹ç›®ä¸­çš„é¢†åŸŸæœåŠ¡ <code>TransferUserCreditToTeamService</code>ï¼ˆç”¨æˆ·ç§¯åˆ†è½¬å›¢é˜Ÿï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">{
  userId,
  teamId,
  transactionId,
  userCreditHistoryData,
  teamCreditHistoryData,
  amount,
}: {
  userId: number;
  teamId: number;
  transactionId: string;
  amount: number;
  userCreditHistoryData: Record&lt;string, unknown&gt;;
  teamCreditHistoryData: Record&lt;string, unknown&gt;;
}</span>) {
  <span class="hljs-comment">// å¼€å¯äº‹åŠ¡å‰çš„å‡†å¤‡å·¥ä½œ</span>
  <span class="hljs-keyword">const</span> knex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">teamCreditRepository</span>.<span class="hljs-title function_">getKnex</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateRedisLock</span>(teamId);
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">teamCreditRepository</span>.<span class="hljs-title function_">findOrCreateOne</span>(teamId);
  <span class="hljs-keyword">const</span> userCredit = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userCreditRepository</span>.<span class="hljs-title function_">findOrCreateOne</span>(userId);
  
  <span class="hljs-comment">// ä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼šä½™é¢æ˜¯å¦è¶³å¤Ÿ</span>
  <span class="hljs-keyword">if</span> (userCredit.<span class="hljs-property">amount</span> &lt; amount) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`user <span class="hljs-subst">${userId}</span> credit not enough`</span>);
  }
  
  <span class="hljs-comment">// åˆ›å»º Stripe ä½™é¢è®°å½•</span>
  <span class="hljs-keyword">const</span> balanceTransactionId = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createStripeCustomerBalance</span>(...);
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> knex.<span class="hljs-title function_">transaction</span>(<span class="hljs-keyword">async</span> (trx) =&gt; {
      <span class="hljs-comment">// äº‹åŠ¡å†…çš„ä¸šåŠ¡é€»è¾‘ï¼š</span>
      <span class="hljs-comment">// 1. æ£€æŸ¥æµæ°´æ˜¯å¦å·²å­˜åœ¨ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
      <span class="hljs-comment">// 2. æ‰£å‡ç”¨æˆ·ç§¯åˆ†</span>
      <span class="hljs-comment">// 3. å¢åŠ å›¢é˜Ÿç§¯åˆ†</span>
      <span class="hljs-comment">// 4. æ ¡éªŒæœ€ç»ˆçŠ¶æ€</span>
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">throw</span> error;
  }
  
  <span class="hljs-comment">// å‘å¸ƒé¢†åŸŸäº‹ä»¶</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">domainEventPublisher</span>.<span class="hljs-title function_">publishSync</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserCreditHistoryCreatedEvent</span>(...)
  );
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">domainEventPublisher</span>.<span class="hljs-title function_">publishSync</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeamCreditHistoryCreatedEvent</span>(...)
  );
}
</code></pre>
<p>è¿™ä¸ªé¢†åŸŸæœåŠ¡å…·ä½“å±•ç¤ºäº†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>ä¸šåŠ¡è§„åˆ™</strong>ï¼šå¦‚ä½™é¢æ ¡éªŒã€æµæ°´å¹‚ç­‰æ€§æ£€æŸ¥ï¼›</li>
<li><strong>äº‹åŠ¡å¤„ç†</strong>ï¼šç¡®ä¿è½¬è´¦è¿‡ç¨‹ä¸­çš„åŸå­æ€§ï¼Œä¿éšœæ•°æ®ä¸€è‡´æ€§ï¼›</li>
<li><strong>é¢†åŸŸäº‹ä»¶</strong>ï¼šè¿‡å‘å¸ƒé¢†åŸŸäº‹ä»¶é€šçŸ¥å…¶ä»–èšåˆå…³äºç§¯åˆ†å˜åŠ¨çš„ä¿¡æ¯ã€‚</li>
</ul>
<h2 data-id="heading-8">å®ä½“ï¼ˆEntityï¼‰ä¸é¢†åŸŸæœåŠ¡çš„èŒè´£åˆ’åˆ†</h2>
<p>åœ¨å‰é¢ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†<strong>å®ä½“ï¼ˆEntityï¼‰å’Œå€¼å¯¹è±¡</strong>ï¼Œåœ¨ DDD ä¸­ï¼Œ<strong>ä¸šåŠ¡é€»è¾‘åº”ä¼˜å…ˆå†…èšåœ¨å®ä½“æˆ–å€¼å¯¹è±¡ä¸­</strong>ã€‚åªæœ‰å½“æŸä¸ªè¡Œä¸ºæ— æ³•è‡ªç„¶å½’å±äºå•ä¸€å®ä½“ï¼ˆä¾‹å¦‚æ¶‰åŠå¤šä¸ªèšåˆã€æ— çŠ¶æ€æ“ä½œã€æˆ–è·¨å¯¹è±¡åä½œï¼‰æ—¶ï¼Œ<strong>æ‰å°†å…¶æå–ä¸ºé¢†åŸŸæœåŠ¡</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œå…·ä½“å¦‚ä½•åˆ¤æ–­ä¸€æ®µé€»è¾‘è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦è¿›è¡Œæƒè¡¡ï¼š</p>






























<table><thead><tr><th>ç»´åº¦</th><th>å®ä½“ï¼ˆEntityï¼‰</th><th>é¢†åŸŸæœåŠ¡ï¼ˆDomain Service</th></tr></thead><tbody><tr><td>çŠ¶æ€ä¾èµ–</td><td>é€»è¾‘å¼ºä¾èµ–äºè‡ªèº«çŠ¶æ€ï¼ˆå¦‚å®ä¾‹å±æ€§ï¼‰</td><td>æ— çŠ¶æ€ï¼Œä¸æŒæœ‰æ•°æ®ï¼Œä»…åŸºäºè¾“å…¥å‚æ•°æ‰§è¡Œæ“ä½œ</td></tr><tr><td>ä½œç”¨èŒƒå›´</td><td>ä»…æ“ä½œå½“<strong>å‰å®ä½“å®ä¾‹</strong></td><td>é€šå¸¸æ¶‰åŠ<strong>å¤šä¸ªå®ä½“ã€èšåˆæˆ–å€¼å¯¹è±¡</strong></td></tr><tr><td>èšåˆè¾¹ç•Œ</td><td>ä¸åº”è·¨è¶Šèšåˆè¾¹ç•Œï¼ˆå³ä¸ç›´æ¥æ“ä½œå…¶ä»–èšåˆæ ¹ï¼‰</td><td>å¯åè°ƒ<strong>å¤šä¸ªèšåˆ</strong>ä¹‹é—´çš„äº¤äº’ï¼ˆä½†éœ€è°¨æ…ï¼‰å¤šä¸ªé¢†åŸŸå¯¹è±¡</td></tr><tr><td>å†…èšæ€§</td><td>è¡Œä¸ºæ˜¯è¯¥å®ä½“<strong>å¤©ç„¶å…·å¤‡çš„èƒ½åŠ›</strong>ï¼ˆå¦‚ order.cancel()ï¼‰</td><td>è¡Œä¸ºæ˜¯<strong>å¤–éƒ¨èµ‹äºˆçš„åä½œé€»è¾‘</strong>ï¼ˆå¦‚ transferCredit(user, team)ï¼‰</td></tr></tbody></table>
<p>æ¥çœ‹ä¸€ä¸ªçœŸå® NestJS é¡¹ç›®ä¸­çš„ <code>Order</code> å®ä½“ä¸­çš„è¡Œä¸ºï¼š</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Property</span>({ <span class="hljs-attr">persist</span>: <span class="hljs-literal">false</span> })
<span class="hljs-keyword">get</span> <span class="hljs-title function_">paymentInfo</span>(): <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> databaseValue =
      <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span> === <span class="hljs-string">'string'</span>
        ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span>)
        : <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span>;
    <span class="hljs-keyword">const</span> clone = <span class="hljs-title function_">cloneDeep</span>(databaseValue);

    <span class="hljs-comment">// åŸºäºå½“å‰è®¢å• ID ç”Ÿæˆé¢„è§ˆè·¯å¾„ï¼ˆå¼ºä¾èµ– this.idï¼‰</span>
    <span class="hljs-keyword">if</span> (
      clone.<span class="hljs-property">credential</span>?.<span class="hljs-property">receiptFiles</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
    ) {
      clone.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span> = clone.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
        <span class="hljs-title function_">getCredentialImagePreviewPath</span>(<span class="hljs-title class_">String</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>), item)
      );
    }

    <span class="hljs-keyword">return</span> clone;
  } <span class="hljs-keyword">catch</span> {
    <span class="hljs-keyword">return</span> {};
  }
}

<span class="hljs-keyword">set</span> <span class="hljs-title function_">paymentInfo</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">const</span> parsed = <span class="hljs-title function_">safeJsonParse</span>(value, {});

  <span class="hljs-comment">// æ¸…ç†è·¯å¾„å‰ç¼€ï¼ˆåŒæ ·ä¾èµ– this.idï¼‰</span>
  <span class="hljs-keyword">if</span> (parsed.<span class="hljs-property">credential</span>?.<span class="hljs-property">receiptFiles</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    parsed.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span> = parsed.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
      <span class="hljs-title function_">removeCredentialImagePrefix</span>(<span class="hljs-title class_">String</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>), item)
    );
  }

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span> = parsed;
}
</code></pre>
<p>è¿™æ®µé€»è¾‘ï¼š</p>
<ul>
<li>å®Œå…¨åŸºäº <code>this.id</code> å’Œ <code>this._paymentInfo</code> è¿è¡Œï¼›</li>
<li>ä¸è°ƒç”¨å…¶ä»–èšåˆæˆ–æœåŠ¡ï¼›</li>
<li>æ˜¯å¯¹è‡ªèº«æŒä¹…åŒ–æ•°æ®çš„è§†å›¾è½¬æ¢ï¼Œè€Œéä¸šåŠ¡å†³ç­–ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå®ƒéå¸¸é€‚åˆæ”¾åœ¨å®ä½“å†…éƒ¨ï¼Œæ—¢ä¿æŒäº†å†…èšæ€§ï¼Œåˆé¿å…äº†ä¸å¿…è¦çš„æœåŠ¡è†¨èƒ€ã€‚</p>
<p>æœ€åï¼Œ<strong>åº”ç”¨æœåŠ¡</strong>å’Œ<strong>é¢†åŸŸæœåŠ¡</strong>çš„åŒºåˆ«å·²ä»‹ç»å®Œæ¯•ï¼Œé˜…è¯»æœ¬ç¯‡æ–‡ç« æœ€å¥½ç»“åˆä¸Šç¯‡æ–‡ç« ã€Š<a href="https://juejin.cn/post/7578198815729696768" target="_blank" title="https://juejin.cn/post/7578198815729696768">NestJS æ¶æ„è®¾è®¡ï¼š5 åˆ†é’ŸæŠ“ä½ DDD çš„å‘½è„‰</a>ã€‹ä¸€èµ·é˜…è¯»ï¼Œå¯èƒ½ä¼šæ›´å¥½ç†è§£ï¼Œå¦‚æœä½ è§‰å¾—æœ‰ä»€ä¹ˆåœ°æ–¹é—æ¼ã€ç–‘æƒ‘ï¼Œæ¬¢è¿è¯„è®ºè®¨è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLä¸»ä»å»¶è¿Ÿé£™å‡ï¼Ÿå…ƒæ•°æ®é”å¯èƒ½æ˜¯â€œçœŸå‡¶â€]]></title>    <link>https://juejin.cn/post/7585706951602946074</link>    <guid>https://juejin.cn/post/7585706951602946074</guid>    <pubDate>2025-12-20T12:46:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951602946074" data-draft-id="7585463195201847346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLä¸»ä»å»¶è¿Ÿé£™å‡ï¼Ÿå…ƒæ•°æ®é”å¯èƒ½æ˜¯â€œçœŸå‡¶â€"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T12:46:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æŠ€æœ¯ä¸æ‰“çƒŠ"/> <meta itemprop="url" content="https://juejin.cn/user/893244690677165"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLä¸»ä»å»¶è¿Ÿé£™å‡ï¼Ÿå…ƒæ•°æ®é”å¯èƒ½æ˜¯â€œçœŸå‡¶â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/893244690677165/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æŠ€æœ¯ä¸æ‰“çƒŠ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:46:35.000Z" title="Sat Dec 20 2025 12:46:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b48074932b2460aade85ae0ca5642d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5LiN5omT54OK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766839594&amp;x-signature=4DwwL750q9J0tMZ7vobEDqA10h8%3D" alt="bdf10e7027a93077604be8d3a1238ffe09d8b8ef055fc8360f5ece011507cb9f_1766233783492.jpg" loading="lazy"/>
ç°è±¡ï¼šIOçº¿ç¨‹æ¬¢å¿«ï¼ŒSQLçº¿ç¨‹å´åœ¨åˆ’æ°´çœ‹åˆ°ä»åº“çš„SecondsBehindMasterä»30ç§’ç›´çº¿é£™å‡åˆ°1000ç§’ï¼Œä½ æ˜¯ä¸æ˜¯å†·æ±—ç›´å†’ï¼Ÿ<br/>
IOçº¿ç¨‹è¿˜åœ¨æ¬¢å¿«åœ°è¯»å–æ—¥å¿—ï¼ŒSQLçº¿ç¨‹å´åƒè¢«å†»ä½äº†ä¸€æ ·ï¼Œä¸€æ­¥ä¸€æ­¥å¾€åæŒªï¼Œè€Œä¸”è¶Šæ¥è¶Šæ…¢ã€‚<br/>
è¿™çœŸçš„ä¸æ˜¯ç½‘ç»œé—®é¢˜ï¼Œè€Œæ˜¯ä½ çš„DDLæ“ä½œåœ¨æš—åœ°é‡Œæç ´åã€‚æˆ‘è§è¿‡å¤ªå¤šçº¿ä¸Šäº‹æ•…çš„æ ¹æºå°±è—åœ¨ä¸€æ¡çœ‹ä¼¼ä¸èµ·çœ¼çš„ALTERTABLEé‡Œâ€”â€”æœ‰ä¸ªå“¥ä»¬æ”¹äº†ä¸€ä¸ªvarchar(5000)å­—æ®µï¼Œæƒ³æ‰©å®¹åˆ°varchar(6000)ï¼Œç»“æœæ•´ä¸ªä»åº“å´©æºƒäº†ã€‚<br/>
ä»Šå¤©å°±ç»™ä½ è®²æ¸…æ¥šè¿™ä¸ªå‘åˆ°åº•æ€ä¹ˆè¸©ï¼Œä»¥åŠæ€ä¹ˆå®‰ç¨³åœ°è·¨è¿‡å»ã€‚é—®é¢˜æœ€åˆçœ‹èµ·æ¥å¾ˆè¯¡å¼‚ã€‚ä½ ç”¨SHOWREPLICASTATUSä¸€çœ‹ï¼ŒSecondsBehindMasterç›´æ¥å†²åˆ°1000+ç§’ï¼Œä¸šåŠ¡å‘Šè¯‰ä½ æ•°æ®æ²¡åŒæ­¥ï¼Œä½†æ˜¯ä½ ç™»ä¸Šä»åº“æŸ¥çœ‹ï¼š</p>
<p>SecondsBehindMaster:1000<br/>
IOThreadRunning:Yes<br/>
SQLThreadRunning:Yes<br/>
RelayLogIORunning:Yes</p>
<p>è¿™è¯´æ˜è¯»æ—¥å¿—çš„çº¿ç¨‹æ´»å¾—å¥½å¥½çš„ï¼Œé—®é¢˜ä¸€å®šå‡ºåœ¨åº”ç”¨æ—¥å¿—çš„çº¿ç¨‹ä¸Šã€‚<br/>
<strong>IOçº¿ç¨‹æ­£å¸¸å·¥ä½œï¼Œè¯´æ˜ä¸»åº“æ²¡é—®é¢˜ï¼Œç½‘ç»œä¹Ÿæ²¡é—®é¢˜ã€‚</strong><br/>
é‚£ä¸ºä»€ä¹ˆSQLçº¿ç¨‹è¿™ä¹ˆæ…¢å‘¢ï¼Ÿå¤šåŠæ˜¯è¢«ä»€ä¹ˆä¸œè¥¿å¡ä½äº†ã€‚å®šä½ï¼šSHOWREPLICASTATUSé‡Œçš„å‡è±¡è¿™é‡Œæœ€è½»æ˜“å‡ºç°çš„å·®é”™å°±æ˜¯çœ‹é”™ä½ç½®ã€‚ä½ æˆ–è®¸ä¼šçœ‹åˆ°SQLDelay:0<br/>
RelayLogPos:1024çœ‹èµ·æ¥SQLDelayæ˜¯0ï¼Œè¯´æ˜æ²¡æœ‰æ•…æ„å»¶è¿Ÿå¤åˆ¶ï¼ŒRelayLogPosä¹Ÿåœ¨é‚£å„¿â€¦â€¦å¯è¿™TMä¸€ä¸ªå°æ—¶éƒ½æ²¡åŠ¨è¿‡ï¼<br/>
<strong>è¿™å°±æ˜¯å…³é”®ä¿¡å·ï¼šä¸­ç»§æ—¥å¿—ä½ç½®ä¸å†å¢é•¿ï¼Œè¯´æ˜SQLçº¿ç¨‹å¡ä½äº†ã€‚</strong><br/>
è¿™æ—¶å€™ï¼Œå¾ˆå¤šäººä¼šå‚»æ„£æ„£åœ°æŸ¥çœ‹ç½‘ç»œã€æ£€æŸ¥ç£ç›˜ç©ºé—´ã€è§‚å¯Ÿç¼“å†²æ± ï¼Œå®Œå…¨æ²¡å¯Ÿè§‰åˆ°ï¼Œé—®é¢˜å°±åœ¨è¿™æ—¶å‡ºç°äº†ï¼šæŸå¼ è¡¨å·²ç»è¢«é”å®šï¼ŒSQLçº¿ç¨‹æ­£åœ¨ä¾æ¬¡æ’é˜Ÿç­‰ç€è§£é”æŠ“é”ï¼šperformanceschemaé‡Œçš„çœŸå‡¶æ‰“å¼€performanceschemaï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å…ƒæ•°æ®é”ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM performance_schema.metadata_locksÂ WHEREÂ <span class="hljs-attr">OBJECT_SCHEMA</span>Â =Â <span class="hljs-string">'your_db'</span>Â Â Â ANDÂ OBJECT_NAMEÂ =Â <span class="hljs-string">'your_table'</span>Â Â Â ANDÂ LOCK_TYPEÂ =Â <span class="hljs-string">'EXCLUSIVE'</span><span class="hljs-comment">;</span>
</code></pre>
<p>å¦‚æœè¿™é‡Œè¹¦å‡ºä¸€æ¡è®°å½•ï¼ŒLOCKTYPEæ˜¯EXCLUSIVEï¼ŒçŠ¶æ€æ˜¯WAITINGFORï¼Œé‚£ä½ å°±æ‰¾åˆ°çœŸå‡¶äº†ã€‚
å¤§æ¦‚ç‡æ˜¯ï¼š</p>

































<table><thead><tr><th>å­—æ®µå</th><th>å€¼</th></tr></thead><tbody><tr><td>OBJECTSCHEMA</td><td>yourdb</td></tr><tr><td>OBJECTNAME</td><td>yourtable</td></tr><tr><td>LOCKTYPE</td><td>EXCLUSIVE</td></tr><tr><td>LOCKDURATION</td><td>TRANSACTION</td></tr><tr><td>STATUS</td><td>WAITING FOR TABLE METADATA LOCK</td></tr><tr><td>OBJECTTYPE</td><td>TABLE</td></tr></tbody></table>
<p>è¿™è¯´æ˜æœ‰ä¸ªALTERTABLEæ“ä½œæ­£åœ¨ç­‰å¾…è¡¨çš„å…ƒæ•°æ®é”ï¼Œè€Œå®ƒæˆåŠŸåœ°æŠŠæ•´ä¸ªå¤åˆ¶é˜Ÿåˆ—ç»™å µæ­»äº†ã€‚æ ¹å› ï¼šå¤§å­—æ®µæ”¹åŠ¨è§¦å‘å…¨è¡¨é‡å»ºä½ çš„DBAæˆ–è€…å¼€å‘åœ¨æ”¹è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œäº†è¿™æ ·çš„å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>Â big_table MODIFYÂ <span class="hljs-keyword">COLUMN</span>Â descriptionÂ <span class="hljs-type">varchar</span>(<span class="hljs-number">6000</span>);
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ä¸ªå¾ˆå°çš„æ”¹åŠ¨å¯¹å§ï¼Ÿ</p>
<p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼švarchar(5000)æ”¹åˆ°varchar(6000)ï¼Œè™½ç„¶éƒ½æ˜¯å¯å˜é•¿åº¦å­—æ®µï¼Œä½†MySQL5.7å’Œæ—©æœŸçš„8.0ä¸è®¤å•Šï¼<br/>
å®ƒä»¬ä¸èƒ½ç”¨INSTANTç®—æ³•ï¼Œå¿…é¡»é‡å»ºæ•´ä¸ªè¡¨ï¼Œè¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>éœ€è¦ä¸€æŠŠæ’ä»–é”ï¼ˆEXCLUSIVEï¼‰</li>
<li>è¦æŠŠæ‰€æœ‰è¡Œéƒ½é‡æ–°å†™ä¸€é</li>
</ul>
<p>è¦æ˜¯è¡¨æœ‰è¿™10GBæ•°æ®ï¼Œé‚£å¯èƒ½è¦èŠ±10åˆ†ã€‚<br/>
åœ¨è¿™10åˆ†é’Ÿé‡Œï¼Œæ‰€æœ‰è¯•å›¾è®¿é—®è¿™ä¸ªè¡¨çš„æŸ¥è¯¢éƒ½è¢«æŒ¡åœ¨å¤–é¢ã€‚<br/>
<strong>ä»åº“ä¸Šçš„SQLçº¿ç¨‹è¦åŒæ­¥è¿™ä¸ªDDLï¼Œä½†æ˜¯å®ƒæ’åœ¨é˜Ÿä¼æœ€åé¢ï¼Œè¦ç­‰ä¸»åº“ä¸Šçš„æ‰€æœ‰æ•°æ®å˜æ›´éƒ½å¤åˆ¶å®Œäº†æ‰èƒ½è½®åˆ°å®ƒâ€¦â€¦ç»“æœå°±æ˜¯ï¼šå»¶è¿Ÿè¶Šæ¥è¶Šå¤§ï¼Œæœ€åå½»åº•å´©æºƒã€‚</strong> è§£å†³ï¼šMySQL8.0çš„INSTANTé­”æ³•å¦‚æœä½ ç”¨çš„æ˜¯MySQL8.0.12åŠä»¥ä¸Šï¼Œæ­å–œä½ ï¼Œæœ‰ä¸ªç§˜å¯†æ­¦å™¨ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>Â big_table MODIFYÂ <span class="hljs-keyword">COLUMN</span>Â descriptionÂ <span class="hljs-type">varchar</span>(<span class="hljs-number">6000</span>), ALGORITHM<span class="hljs-operator">=</span>INSTANT;
</code></pre>
<p>åªè¦æ”¹åŠ¨çš„å­—æ®µé•¿åº¦â‰¤255å­—èŠ‚ï¼Œæˆ–è€…åªæ˜¯æ‰©å¤§é•¿åº¦ï¼ˆä»å°åˆ°å¤§ï¼‰ï¼ŒALGORITHM=INSTANTå°±èƒ½ç§’çº§å®Œæˆï¼ŒçœŸçš„ï¼Œå°±æ˜¯ç§’çº§ã€‚</p>
<p>è¿™ä¸ªç®—æ³•æœ‰å¤šçŒ›ï¼š</p>
<ul>
<li>âœ… åªä¿®æ”¹å…ƒæ•°æ®ï¼Œä¸ç¢°è¡¨æ•°æ®</li>
<li>âœ… ä¸éœ€è¦æ’ä»–é”ï¼Œå…¶ä»–æŸ¥è¯¢ç…§å¸¸æ‰§è¡Œ</li>
<li>âœ… ä¸äº§ç”Ÿå¤§é‡binlog</li>
<li>âœ… ä»åº“å®Œå…¨æ— æ„ŸçŸ¥</li>
<li>âœ… SecondsBehindMasterè¿˜æ˜¯0</li>
</ul>
<p>ç§’æ€ï¼ŒçœŸçš„å¤§æ‰©å®¹æ€ä¹ˆåŠï¼Ÿç”¨gh-ostæ•‘å‘½ä½†æ˜¯ï¼Œå¦‚æœä½ è¿™æ ·åš</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>Â big_table MODIFYÂ <span class="hljs-keyword">COLUMN</span>Â dataÂ <span class="hljs-type">varchar</span>(<span class="hljs-number">5000</span>)Â <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-type">varchar</span>(<span class="hljs-number">50000</span>);
</code></pre>
<p>è¿™è¶…å‡º255å­—èŠ‚çš„è·¨åº¦ï¼ŒINSTANTä¹Ÿçˆ±è«èƒ½åŠ©ï¼Œå¾—é‡æ–°æ„å»ºè¡¨ï¼Œè¿™æ—¶å€™ï¼Œä¸å¯ä»¥è®©ä¸»åº“ç›´æ¥å¼€å±•ALTERæ“ä½œï¼Œå¾—è¿ç”¨ä¸“ä¸šå·¥å…·gh-ostã€‚</p>
<p>gh-ostæ˜¯æ€ä¹ˆæ´»å‘½çš„</p>
<pre><code class="hljs language-scss" lang="scss">gh-ost <span class="hljs-attr">--user</span>="root"Â <span class="hljs-attr">--password</span>="pass"Â <span class="hljs-attr">--host</span>="<span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>"Â \Â  <span class="hljs-attr">--database</span>="your_db"Â <span class="hljs-attr">--table</span>="your_table"Â \Â  <span class="hljs-attr">--alter</span>="MODIFY COLUMN data <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50000</span>)"Â \Â  <span class="hljs-attr">--execute</span>
</code></pre>
<p>è¿™ä¸ªå·¥å…·ä¼šåœ¨åå°æ‚„æ‚„åœ°</p>
<ol>
<li>åˆ›å»ºå½±å­è¡¨ï¼ˆè·ŸåŸè¡¨ä¸€æ ·çš„ç»“æ„ï¼‰</li>
<li>è¾¹æ”¹è¡¨è¾¹å¤åˆ¶æ•°æ®ï¼Œä¸šåŠ¡ç…§å¸¸è¯»å†™</li>
<li>åœ¨äºŒè¿›åˆ¶æ—¥å¿—é‡ŒæŠ„ä¸‹å¢é‡æ›´æ–°ï¼Œä¸æ–­åº”ç”¨åˆ°å½±å­è¡¨</li>
<li>åˆ°æœ€åä¸€ç¬é—´ï¼ŒåŸè¡¨å’Œå½±å­è¡¨é—ªç”µåˆ‡æ¢</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨ä¸€ç§’éƒ½ä¸é”ï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚<br/>
è™½ç„¶æ¯”INSTANTæ…¢ï¼Œä½†ä¹Ÿå°±æ˜¯å‡ åˆ†é’Ÿçš„äº‹ï¼Œé¥é¥å¥½è¿‡ç›´æ¥ALTERè¦èŠ±çš„åŠå°æ—¶ã€‚é¢„é˜²ï¼šæ‰“å¥½è¿™ä¸‰é“ä¿é™©ç¬¬ä¸€é“ï¼šæ‰€æœ‰DDLå…ˆéªŒè¯ä¸€é</p>
<pre><code class="hljs language-scss" lang="scss">pt-online-schema-changeÂ \Â  <span class="hljs-attr">--user</span>=root <span class="hljs-attr">--password</span>=pass <span class="hljs-attr">--host</span>=<span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>Â \Â  <span class="hljs-attr">--database</span>=your_db <span class="hljs-attr">--table</span>=your_tableÂ \Â  <span class="hljs-attr">--alter</span>="MODIFY COLUMN description <span class="hljs-built_in">varchar</span>(<span class="hljs-number">6000</span>)"Â \Â  <span class="hljs-attr">--dry-run</span>
</code></pre>
<p>--dry-runä¸ä¼šçœŸçš„æ”¹è¡¨ï¼Œä½†ä¼šå‘Šè¯‰ä½ è¿™ä¸ªæ”¹åŠ¨ä¼šèŠ±å¤šé•¿æ—¶é—´ï¼Œéœ€è¦å¤šå°‘èµ„æºã€‚
å¦‚æœè¾“å‡ºæ˜¾ç¤º"æ¨¡æ‹ŸæˆåŠŸ"ï¼ŒçœŸæ­£æ‰§è¡Œçš„æ—¶å€™æˆåŠŸç‡å°±å¾ˆé«˜ã€‚</p>
<p>ç¬¬äºŒé“ï¼šåŠ ä¸Šæ‰§è¡Œæ—¶é—´é™åˆ¶æŠŠè¿™ä¸ªå‚æ•°å†™è¿›my.cnf`</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span><span class="hljs-attr">max_execution_time</span>=<span class="hljs-number">300000</span>
</code></pre>
<p>æ‰€æœ‰æŸ¥è¯¢æœ€å¤šï¼Œè€—è´¹æ—¶é—´300ç§’ï¼ˆä¹Ÿå°±æ˜¯300000æ¯«ç§’ï¼‰ï¼Œè¦æ˜¯è¶…å‡ºæ—¶é—´å°±ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥ï¼Œä¸è¦è®©æ…¢æŸ¥è¯¢ä¸€ç›´å ç”¨èµ„æºä¸é‡Šæ”¾ã€‚ç¬¬ä¸‰é“ï¼šå…³é”®çš„DDLä¸€å®šåœ¨ä¸šåŠ¡ä½è°·æœŸæ‰§è¡Œã€‚å‡Œæ™¨3ç‚¹ä¿®æ”¹è¡¨æ ¼ï¼Œæ¸…æ™¨8ç‚¹åˆä¸Šçº¿ï¼Œå³ä¾¿å‡ºç°äº›è®¸é—®é¢˜ä¹Ÿä¸ä¼šå½±å“ç™½å¤©çš„ç”¨æˆ·ï¼Œç»“è¯­<strong>MySQLä¸»ä»å»¶è¿Ÿçš„æ ¹æºå¾€å¾€ä¸åœ¨ç½‘ç»œã€ä¸åœ¨ç£ç›˜ã€ä¹Ÿä¸åœ¨ç¼“å†²æ± ï¼Œè€Œåœ¨ä½ å¯¹DDLæ“ä½œçš„æ•¬ç•å¿ƒä¸å¤Ÿã€‚</strong>  ä¸€æ¡å°å°çš„ALTERTABLEï¼Œå¦‚æœå¤„ç†ä¸å½“ï¼Œå°±èƒ½æŠŠæ•´æ¡ä¸»ä»é“¾è·¯ç‚¸æ‰ï¼Œè®©ä½ æ’æŸ¥åŠå¤©è¿˜æ‘¸ä¸ç€å¤´è„‘ã€‚ç‰¢è®°è¿™ä¸ªé¡ºåºï¼Œå…ˆç”¨ï¼Œpt-online-schema-change--dry-runæ¥éªŒè¯ï¼Œå°çš„æ”¹åŠ¨ä½¿ç”¨INSTANTï¼Œå¤§çš„æ”¹åŠ¨é‡‡ç”¨gh-ostï¼Œå…³é”®æ“ä½œï¼Œè®¾ç½®maxexecution_timeï¼Œæ¥ç€æŒ‘é€‰ä¸€ä¸ªä¸šåŠ¡ä½å³°æœŸå»æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ1000ç§’çš„å»¶è¿Ÿé›ªå´©ä¾¿æ°¸è¿œä¸ä¼šåˆ°æ¥ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« å¸®ä½ é¿å…äº†ä¸€æ¬¡çº¿ä¸Šäº‹æ•…ï¼Œæœ€å¥½çš„å›æŠ¥å°±æ˜¯å…³æ³¨å’Œè½¬å‘ã€‚<br/>
è®©æ›´å¤šäººçŸ¥é“DDLæ“ä½œçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼Œå’±ä»¬ä¸€èµ·æŠŠæ•°æ®åº“æç¨³å®šã€‚</p>
<p>å£°æ˜ï¼Œæœ¬æ–‡å†…å®¹ä¹æˆæ˜¯æœ¬äººåŸåˆ›ï¼Œå°‘é‡ç´ æç»è¿‡AIè¾…åŠ©ç”Ÿæˆï¼Œå¹¶ä¸”æ‰€æœ‰å†…å®¹éƒ½ç»è¿‡æœ¬äººä¸¥æ ¼æ ¸æŸ¥ï¼Œå›¾ç‰‡ç´ æï¼Œéƒ½æ¥è‡ªçœŸå®ç´ ææˆ–è€…AIåŸåˆ›ï¼Œæ–‡ç« æ—¨åœ¨å®£æ‰¬æ­£èƒ½é‡ï¼Œæ²¡æœ‰ä½ä¿—ä¸è‰¯å¯¼å‘ï¼Œå¸Œæœ›è¯»è€…çŸ¥é“ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€MCPå…¥é—¨ç¯‡ã€‘ä»0åˆ°1æ•™ä½ æ­å»ºMCPæœåŠ¡]]></title>    <link>https://juejin.cn/post/7585452404113522703</link>    <guid>https://juejin.cn/post/7585452404113522703</guid>    <pubDate>2025-12-20T13:06:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113522703" data-draft-id="7585476892976119842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€MCPå…¥é—¨ç¯‡ã€‘ä»0åˆ°1æ•™ä½ æ­å»ºMCPæœåŠ¡"/> <meta itemprop="keywords" content="åç«¯,MCP"/> <meta itemprop="datePublished" content="2025-12-20T13:06:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="omenkk7"/> <meta itemprop="url" content="https://juejin.cn/user/933901076016858"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€MCPå…¥é—¨ç¯‡ã€‘ä»0åˆ°1æ•™ä½ æ­å»ºMCPæœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933901076016858/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    omenkk7
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:06:26.000Z" title="Sat Dec 20 2025 13:06:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MCPåŸºç¡€æ¦‚å¿µè®²è§£</h2>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦MCP</h3>
<p>å¯¹äºä¸åŒå‚å•†æä¾›çš„å¤§æ¨¡å‹ å¯¹FunctionCallingçš„æ ¼å¼è¦æ±‚å„ä¸ç›¸åŒ åœ¨å¯¹æ¥å¤šä¸ªå¤§æ¨¡å‹æ—¶</p>
<p>å¼€å‘è€…éœ€è¦ä¸ºæ¯ç§æ¨¡å‹ç¼–å†™é€‚é…é€»è¾‘ è¿™ç§æƒ…å†µä¸‹ç»´æŠ¤æˆæœ¬éå¸¸é«˜</p>
<p>å› æ­¤éœ€è¦æœ‰ä¸€ç§ç»Ÿä¸€çš„è§„èŒƒ è§„èŒƒå·¥å…·çš„æè¿° è°ƒç”¨ å“åº”ç­‰</p>
<p>ä½¿å¾—å·¥å…·æœåŠ¡åªéœ€è¦æŒ‰ç…§è¿™ç§è§„èŒƒå»å®ç° å°±å¯ä»¥è¢«ä»»æ„æ”¯æŒMCPçš„LLMå®¢æˆ·ç«¯è°ƒç”¨</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯MCP</h3>
<p>MCPå°±æ˜¯<strong>ä¸€ç§æ ‡å‡†åŒ–å·¥å…·è°ƒç”¨åè®®è§„èŒƒ</strong></p>
<p>ä»–è§£å†³äº†ä»¥ä¸‹é—®é¢˜:</p>
<ul>
<li>å·¥å…·æœåŠ¡æ€ä¹ˆæš´éœ²å‡ºèƒ½åŠ›</li>
<li>è°ƒç”¨ç«¯å¦‚ä½•å»å£°æ˜è‡ªå·±æœ‰å“ªäº›å·¥å…·</li>
<li>æ¨¡å‹å¦‚ä½•å‘ç°å¯ç”¨å·¥å…·</li>
<li>æ¨¡å‹å¦‚ä½•å‘èµ·å·¥å…·è°ƒç”¨</li>
<li>è°ƒç”¨ç»“æœå¦‚ä½•è¿”å›å¹¶ä¸”ç»§ç»­æ¨ç†</li>
</ul>
<p><strong>å·¥å…·æœåŠ¡åªéœ€è¦æŒ‰ç…§è¿™ç§è§„èŒƒå»æ„å»ºåº”ç”¨</strong></p>
<p><strong>LLM</strong> <strong>å®¢æˆ·ç«¯åœ¨å’Œ</strong> <strong>å¤§æ¨¡å‹</strong> <strong>è¿›è¡Œäº¤äº’çš„æ—¶å€™ å°†</strong> <strong>MCP</strong> <strong>å·¥å…·æè¿°è½¬æ¢ä¸ºå¯¹åº”æ¨¡å‹æ‰€éœ€è¦çš„Function Toolå‚æ•°</strong></p>
<p><strong>å½“</strong> <strong>å¤§æ¨¡å‹</strong> <strong>å†³å®šè°ƒç”¨å·¥å…·çš„æ—¶å€™ ä¼šè¿”å›ä¸€ä¸ªå·¥å…·è°ƒç”¨çš„è¯·æ±‚</strong> <strong>MCP</strong> <strong>å»æ‹¦æˆªè¯¥è¯·æ±‚ å°†å…¶è½¬å‘ç»™å¯¹åº”çš„MCP Serveræ‰§è¡Œ</strong></p>
<p>å†å°†ç»“æœå›å¡«ç»™å¤§æ¨¡å‹ è®©å¤§æ¨¡å‹ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8039fa6aa4864687801b19319cf499cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb21lbmtrNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766840786&amp;x-signature=0F%2BKpWlvE8l2mxr6eIbPDlyKNI4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">SpringAIæ­å»ºMCP-Server</h2>
<p>æœ¬æ–‡ä»¥Javaè¯­è¨€ é€šè¿‡SpringAIä¸ºä¾‹ è®²è§£Stdio SSEä¸¤ç§å½¢å¼çš„MCP-Serverçš„å®Œæ•´æµç¨‹</p>
<p>å®ç°ä¸€ä¸ªåŠ å‡ä¹˜é™¤çš„Tool é€‚åˆæƒ³è¦å…¥é—¨å­¦ä¹ MCPçš„å°ç™½</p>
<h3 data-id="heading-4">STDIOæ¨¡å¼</h3>
<p>åˆ›å»ºåŸºäºè¿›ç¨‹å†…é€šä¿¡çš„ä¼ è¾“</p>
<p>å½“ä½ ä½¿ç”¨ STDIO ä¼ è¾“æ–¹å¼è¿æ¥ MCP æœåŠ¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥è¿è¡Œä½ çš„ MCP æœåŠ¡ç¨‹åº</p>
<h4 data-id="heading-5">å¼•å…¥ä¾èµ–</h4>
<p>æœ¬æ–‡ä»¥1.0.0-RC1ç‰ˆæœ¬ä¸ºä¾‹ éœ€è¦å¼•å…¥å¦‚ä¸‹ä¾èµ–:</p>
<p>spring-ai-starter-mcp-serveræä¾›äº†å¿«é€Ÿæ„å»º MCPæœåŠ¡å™¨çš„åŠŸèƒ½</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-ai.version</span>&gt;</span>1.0.0-RC1<span class="hljs-tag">&lt;/<span class="hljs-name">spring-ai.version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-ai.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">åˆ›å»ºå·¥å…·æœåŠ¡</h4>
<p>SpringAIæä¾›äº†Toolæ³¨è§£ é€šè¿‡Toolæ³¨è§£ å¯ä»¥å°†æˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•å®šä¹‰ä¸ºä¸€ç§å·¥å…·</p>
<p>é€šè¿‡descriptionæ¥æè¿°è¿™ä¸ªå·¥å…·çš„ä½œç”¨ è¿™æ˜¯ç»™AIçœ‹çš„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cn.omenkk.service;

<span class="hljs-keyword">import</span> org.springframework.ai.tool.annotation.Tool;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-comment">/**
* <span class="hljs-doctag">@author</span> omenkk7
* <span class="hljs-doctag">@description</span> æ•°å­¦å·¥å…·ç±»ï¼Œæä¾›åŸºæœ¬çš„åŠ å‡ä¹˜é™¤è¿ç®—
* <span class="hljs-doctag">@create</span> 2025/12/20
*/</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MathTool</span> {

    <span class="hljs-comment">/**
* åŠ æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a ç¬¬ä¸€ä¸ªæ•°
* <span class="hljs-doctag">@param</span> b ç¬¬äºŒä¸ªæ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹å’Œ
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }

    <span class="hljs-comment">/**
* å‡æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a è¢«å‡æ•°
* <span class="hljs-doctag">@param</span> b å‡æ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹å·®
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡Œå‡æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å·®")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">subtract</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a - b;
    }

    <span class="hljs-comment">/**
* ä¹˜æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a ç¬¬ä¸€ä¸ªæ•°
* <span class="hljs-doctag">@param</span> b ç¬¬äºŒä¸ªæ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹ç§¯
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡Œä¹˜æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">multiply</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a * b;
    }

    <span class="hljs-comment">/**
* é™¤æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a è¢«é™¤æ•°
* <span class="hljs-doctag">@param</span> b é™¤æ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹å•†
* <span class="hljs-doctag">@throws</span> IllegalArgumentException å½“é™¤æ•°ä¸º0æ—¶æŠ›å‡ºå¼‚å¸¸
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡Œé™¤æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å•†")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">divide</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º0"</span>);
        }
        <span class="hljs-keyword">return</span> a / b;
    }

}
</code></pre>
<h4 data-id="heading-7">åˆ›å»ºä½ çš„Spring Application</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpDemo3Application</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">McpDemo3Application</span>.<span class="hljs-property">class</span>, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ToolCallbackProvider</span> <span class="hljs-title function_">mathTools</span>(<span class="hljs-params">MathTool mathTool</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">MethodToolCallbackProvider</span>.<span class="hljs-title function_">builder</span>().<span class="hljs-title function_">toolObjects</span>(mathTool).<span class="hljs-title function_">build</span>();
    }
}
</code></pre>
<h4 data-id="heading-8">æ„å»ºé¡¹ç›®</h4>
<p>æ‰§è¡Œmvn package å°†é¡¹ç›®æ‰“æˆjaråŒ…</p>
<h4 data-id="heading-9">åœ¨å®¢æˆ·ç«¯ä½¿ç”¨</h4>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"mcpServers"</span>: {
    <span class="hljs-string">"è®¡ç®—MCP"</span>: {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"è®¡ç®—MCP"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"stdio"</span>,
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"C:\Users\è¿åº†è¾‰\AppData\Local\Programs\Eclipse Adoptium\jdk-17.0.17.10-hotspot\bin\java.exe"</span>,
      <span class="hljs-string">"args"</span>: [
       <span class="hljs-comment">// ç¦ç”¨ Spring Boot Web åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆSTDIO æ¨¡å¼ä¸éœ€è¦å¯åŠ¨HTTPæœåŠ¡å™¨ï¼‰</span>
        <span class="hljs-string">"-Dspring.main.web-application-type=none"</span>,  
        <span class="hljs-comment">// // å¯ç”¨ MCP æœåŠ¡å™¨çš„ STDIO ä¼ è¾“æ¨¡å¼</span>
        <span class="hljs-string">"-Dspring.ai.mcp.server.stdio=true"</span>,
        <span class="hljs-string">"-jar"</span>,
        <span class="hljs-string">"G:\ai-agent\code\mcp-demo2<span class="hljs-subst">\t</span>arget\mcp-demo2-0.0.1-SNAPSHOT.jar"</span>
      ],
      <span class="hljs-string">"environmentVariables"</span>: {
      },
      <span class="hljs-string">"timeout"</span>: <span class="hljs-number">60</span>
    }
  }
}
</code></pre>
<p>æˆ‘æ˜¯åœ¨Cherry studioä¸Šè·‘çš„ åƒç±»ä¼¼çš„åº”ç”¨ å¦‚cursor Traeä¸Šå‡å¯ä»¥ä½¿ç”¨</p>
<p>è¯»è€…å¯ä»¥æ£€ç´¢èµ„æ–™ å°è¯•åšä¸€ä¸ªMCP Client å¯¹æ¥è‡ªå·±çš„MCP Server</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a92625c4a6cf4bcebcc36f1ac4707c95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb21lbmtrNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766840786&amp;x-signature=j2xArvukl61DJboxrVnCnnYyrZc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">SSEæ¨¡å¼</h3>
<p>SSE æ˜¯åŸºäº HTTP åè®®çš„ä¸€ç§â€œå•å‘ã€æœåŠ¡å™¨ä¸»åŠ¨æ¨é€â€çš„é•¿è¿æ¥é€šä¿¡æœºåˆ¶ å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡SpringMVCæ¥æ„å»º</p>
<p>é€šè¿‡SSEæ¨¡å¼è·‘çš„MCPæœåŠ¡ å¯ä»¥éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Š é€šè¿‡SSEè¿æ¥å‘å¤–æä¾›åŠŸèƒ½</p>
<p>ä¸‹é¢æˆ‘é‡‡ç”¨çš„æ˜¯1.1.2çš„ç‰ˆæœ¬spring-ai-bom å®ƒèƒ½å¤Ÿå¸®ä½ ç®¡ç†spring-aiç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬</p>
<h4 data-id="heading-11">å¼•å…¥ä¾èµ–</h4>
<p>é‡ç‚¹æ˜¯å¼•å…¥spring-ai-starter-mcp-server-webmvcä¾èµ–:</p>
<ul>
<li>ä½¿ç”¨ Spring MVC çš„åŸºäº HTTP çš„ä¼ è¾“</li>
<li>è‡ªåŠ¨é…ç½® SSE ä¼ è¾“æ‰€éœ€çš„ Web ç«¯ç‚¹ä¸ Controlleræˆ–å¤„ç†æµå¼å“åº”é€»è¾‘ï¼Œæ— éœ€é¢å¤–ç¼–ç ã€‚</li>
<li>å¯é€‰<code>STDIO</code>ä¼ è¾“ï¼ˆé€šè¿‡è®¾ç½®å¯ç”¨<code>spring.ai.mcp.server.stdio=true</code>ï¼‰</li>
<li>åŒ…å«<code>spring-boot-starter-web</code>ä¾èµ–é¡¹</li>
</ul>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-ai.version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">spring-ai.version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-ai.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># spring.main.web-application-type=none</span>

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> You must disable the banner and the console logging</span>
<span class="hljs-comment"># to allow the STDIO transport to work !!!</span>
<span class="hljs-attr">spring.main.banner-mode</span>=<span class="hljs-literal">off</span>
<span class="hljs-comment"># logging.pattern.console=</span>

<span class="hljs-comment"># spring.ai.mcp.server.stdio=false</span>

<span class="hljs-attr">spring.ai.mcp.server.name</span>=my-weather-server
<span class="hljs-attr">spring.ai.mcp.server.version</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>

<span class="hljs-attr">spring.ai.mcp.server.protocol</span>=STREAMABLE
<span class="hljs-comment"># spring.ai.mcp.server.protocol=STATELESS</span>

<span class="hljs-attr">logging.file.name</span>=./model-context-protocol/weather/starter-webmvc-server/target/starter-webmvc-server.log
</code></pre>
<h4 data-id="heading-12">åˆ›å»ºå·¥å…·æœåŠ¡</h4>
<p>ä¸SSEæ¨¡å¼ç±»ä¼¼ ä¸å†èµ˜è¿°</p>
<h4 data-id="heading-13">åˆ›å»ºä½ çš„SpringApplication</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpDemo3Application</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">McpDemo3Application</span>.<span class="hljs-property">class</span>, args);
    }

<span class="hljs-comment">//æ˜¾å¼æ‰‹åŠ¨æ³¨å†Œä½ çš„å·¥å…·æœåŠ¡</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ToolCallbackProvider</span> <span class="hljs-title function_">mathTools</span>(<span class="hljs-params">MathTool mathTool</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">MethodToolCallbackProvider</span>.<span class="hljs-title function_">builder</span>().<span class="hljs-title function_">toolObjects</span>(mathTool).<span class="hljs-title function_">build</span>();
    }
}
</code></pre>
<h4 data-id="heading-14">åœ¨å®¢æˆ·ç«¯ä½¿ç”¨</h4>
<p>é¦–å…ˆéœ€è¦åœ¨æœ¬åœ°æˆ–è€…æœåŠ¡å™¨å¯åŠ¨ä½ çš„WebæœåŠ¡ æ¥ä¸‹æ¥ æš´éœ²ä½ çš„æœåŠ¡ç»™å®¢æˆ·ç«¯ è®©ä»–çŸ¥é“æ€ä¹ˆå»è°ƒç”¨ä½ çš„æœåŠ¡</p>
<pre><code class="hljs language-css" lang="css">{
  "mcpServers": {
    "æ•°å­¦è¿ç®—æœåŠ¡<span class="hljs-number">1</span>": {
      "name": <span class="hljs-string">"æ•°å­¦è¿ç®—æœåŠ¡1"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"streamableHttp"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://localhost:8080/mcp"</span>,
      <span class="hljs-string">"headers"</span>: {
        "<span class="hljs-attribute">Content</span>-Type": <span class="hljs-string">"application/json"</span>,
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer token"</span>
      },
      "timeout": <span class="hljs-number">60</span>,
      <span class="hljs-string">"advancedSettings"</span>: {}
    }
  }
}
</code></pre>
<h4 data-id="heading-15">ç¤ºä¾‹</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42eca20f5cba43d789636c0b9b67cf1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb21lbmtrNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766840786&amp;x-signature=%2BKZn9cP%2FDoEi7KlYY%2FJpRISLVZs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16">å°ç»“</h2>
<p>æœ¬æ–‡è®²è§£äº†å…³äºMCP ä»¥åŠç®€å•è®²è§£äº†æ€ä¹ˆä½¿ç”¨SpringAIå»åˆ›å»ºä¸€ä¸ªMCP Server</p>
<p>å¦‚æœå¯¹ä½ æœ‰å¸®åŠ© è¯·ç‚¹ä¸ªèµè°¢è°¢!!!</p>
<p><strong>å‚è€ƒèµ„æ–™:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2F1.0%2Fapi%2Fmcp%2Fmcp-server-boot-starter-docs.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/1.0/api/mcp/mcp-server-boot-starter-docs.html" ref="nofollow noopener noreferrer">docs.spring.io/spring-ai/râ€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-ai-examples" target="_blank" title="https://github.com/spring-projects/spring-ai-examples" ref="nofollow noopener noreferrer">github.com/spring-projâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š`EnvironmentPostProcessor` è¯¦è§£]]></title>    <link>https://juejin.cn/post/7585502118459473939</link>    <guid>https://juejin.cn/post/7585502118459473939</guid>    <pubDate>2025-12-20T13:08:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585502118459473939" data-draft-id="7585474459776843812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š`EnvironmentPostProcessor` è¯¦è§£"/> <meta itemprop="keywords" content="Java,Spring"/> <meta itemprop="datePublished" content="2025-12-20T13:08:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Webå¤©æ¢¯ä¹‹è·¯"/> <meta itemprop="url" content="https://juejin.cn/user/2825061103052843"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š`EnvironmentPostProcessor` è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2825061103052843/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Webå¤©æ¢¯ä¹‹è·¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:08:11.000Z" title="Sat Dec 20 2025 13:08:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š<code>EnvironmentPostProcessor</code>Â è¯¦è§£</h2>
<p>åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬èšç„¦äº† Spring Boot å¯åŠ¨æœ€æ—©çš„æ‰©å±•ç‚¹Â <code>SpringApplicationRunListener.starting()</code>ï¼Œè§£å†³äº†å¯åŠ¨ç›‘æ§ã€å¤±è´¥å‘Šè­¦ç­‰æ ¸å¿ƒé—®é¢˜ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥è®²è§£<strong>é…ç½®åŠ è½½é˜¶æ®µçš„æ ¸å¿ƒæ‰©å±•ç‚¹</strong>â€”â€”<code>EnvironmentPostProcessor</code>ï¼Œå®ƒæ˜¯å®šåˆ¶åŒ–é…ç½®åŠ è½½ã€åŠ¨æ€é…ç½®æ³¨å…¥ã€é…ç½®åŠ å¯†è§£å¯†çš„ â€œé»„é‡‘å…¥å£â€ï¼Œä¹Ÿæ˜¯ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®æ²»ç†çš„æ ¸å¿ƒå·¥å…·ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯Â <code>EnvironmentPostProcessor</code>ï¼Ÿ</h3>
<p><code>EnvironmentPostProcessor</code>Â æ˜¯ Spring Boot æä¾›çš„é…ç½®åç½®å¤„ç†æ‰©å±•ç‚¹ï¼Œåœ¨ä»¥ä¸‹æ—¶æœºè¢«è§¦å‘ï¼š</p>
<ul>
<li><strong>Environment å·²åˆå§‹åŒ–</strong>ï¼ˆä½†æœªå®Œå…¨åŠ è½½æ‰€æœ‰é…ç½®æºï¼‰ï¼›</li>
<li><strong>åº”ç”¨é…ç½®æ–‡ä»¶ï¼ˆapplication.yml/propertiesï¼‰å·²è¯»å–ï¼Œä½†æœªç”Ÿæ•ˆ</strong>ï¼›</li>
<li><strong>ApplicationContext å°šæœªåˆ›å»º</strong>ï¼Œä½†å¯ä¿®æ”¹ Environment ä¸­çš„é…ç½®ï¼›</li>
<li><strong>æ‰§è¡Œä¼˜å…ˆçº§é«˜äºÂ <code>@Configuration</code>ã€<code>@Value</code>Â ç­‰é…ç½®æ³¨å…¥é€»è¾‘</strong>ã€‚</li>
</ul>
<blockquote>
<p>âœ…Â <strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šåœ¨é…ç½®æœ€ç»ˆç”Ÿæ•ˆå‰ï¼Œå¯¹é…ç½®è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ã€è¡¥å……ã€åŠ å¯†è§£å¯†ï¼Œå®ç°é…ç½®çš„ç»Ÿä¸€æ²»ç†ã€‚</p>
</blockquote>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªæ‰©å±•ç‚¹å¸¸ç”¨äºè§£å†³ â€œé…ç½®ä¸­å¿ƒåŒ–â€â€œé…ç½®åŠ å¯†â€â€œå¤šç¯å¢ƒé…ç½®åŠ¨æ€åˆ‡æ¢â€ ç­‰æ ¸å¿ƒé—®é¢˜ã€‚</p>
<h3 data-id="heading-2">äºŒã€åœºæ™¯ 1ï¼šé…ç½®ä¸­å¿ƒæ‹‰å–ï¼ˆæ›¿ä»£åŸç”Ÿé…ç½®æ–‡ä»¶ï¼‰</h3>
<h4 data-id="heading-3">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè‹¥å°†é…ç½®å†™æ­»åœ¨Â <code>application.yml</code>Â ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>é…ç½®ä¸ä»£ç è€¦åˆï¼Œä¿®æ”¹é…ç½®éœ€é‡æ–°æ‰“åŒ…éƒ¨ç½²ï¼›</li>
<li>å¤šç¯å¢ƒï¼ˆdev/test/prodï¼‰é…ç½®ç®¡ç†æ··ä¹±ï¼Œæ˜“å‡ºé”™ï¼›</li>
<li>é…ç½®ç¼ºä¹ç»Ÿä¸€ç®¡æ§ï¼Œæ³„éœ²é£é™©é«˜ã€‚</li>
</ul>
<h4 data-id="heading-4">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â ä»é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacos/Apollo/ æºç¨‹ Apolloï¼‰æ‹‰å–é…ç½®ï¼Œè¦†ç›–æœ¬åœ°é…ç½®ï¼Œå®ç°é…ç½®ä¸ä»£ç è§£è€¦ã€‚</p>
<h5 data-id="heading-5">å®ç°ä»£ç </h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">envprocessor</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">env</span>.<span class="hljs-property">EnvironmentPostProcessor</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">ConfigurableEnvironment</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MapPropertySource</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MutablePropertySources</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;

<span class="hljs-comment">/**
 * ç”Ÿäº§çº§é…ç½®ä¸­å¿ƒæ‹‰å–å¤„ç†å™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCenterEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-comment">// æ¨¡æ‹Ÿé…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯ï¼ˆç”Ÿäº§ç¯å¢ƒæ›¿æ¢ä¸ºçœŸå®Nacos/Apolloå®¢æˆ·ç«¯ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCenterClient</span> {
        <span class="hljs-comment">// æ ¹æ®ç¯å¢ƒæ‹‰å–é…ç½®</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">pullConfig</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> env</span>) {
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; configMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒä»é…ç½®ä¸­å¿ƒæ‹‰å–çœŸå®é…ç½®</span>
            <span class="hljs-keyword">switch</span> (env) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"prod"</span>:
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://prod-mysql:3306/prod_db?useSSL=false"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.username"</span>, <span class="hljs-string">"prod_user"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.password"</span>, <span class="hljs-string">"prod_pass123"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"prod-redis:6379"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"true"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"test"</span>:
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://test-mysql:3306/test_db?useSSL=false"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.username"</span>, <span class="hljs-string">"test_user"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.password"</span>, <span class="hljs-string">"test_pass123"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"test-redis:6379"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"false"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-attr">default</span>:
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://localhost:3306/dev_db?useSSL=false"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.username"</span>, <span class="hljs-string">"root"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.password"</span>, <span class="hljs-string">"root"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"localhost:6379"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"false"</span>);
            }
            <span class="hljs-keyword">return</span> configMap;
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessEnvironment</span>(<span class="hljs-params">ConfigurableEnvironment environment, SpringApplication application</span>) {
        <span class="hljs-comment">// 1. è·å–å½“å‰æ¿€æ´»çš„ç¯å¢ƒï¼ˆé€šè¿‡å¯åŠ¨å‚æ•°/ç³»ç»Ÿå˜é‡ä¼ é€’ï¼‰</span>
        <span class="hljs-title class_">String</span>[] activeProfiles = environment.<span class="hljs-title function_">getActiveProfiles</span>();
        <span class="hljs-title class_">String</span> env = activeProfiles.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? activeProfiles[<span class="hljs-number">0</span>] : <span class="hljs-string">"dev"</span>;
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®ä¸­å¿ƒ] å¼€å§‹æ‹‰å– %s ç¯å¢ƒé…ç½®%n"</span>, env);

        <span class="hljs-comment">// 2. ä»é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®</span>
        <span class="hljs-title class_">ConfigCenterClient</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigCenterClient</span>();
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; configMap = client.<span class="hljs-title function_">pullConfig</span>(env);

        <span class="hljs-comment">// 3. å°†é…ç½®æ³¨å…¥Environmentï¼ˆä¼˜å…ˆçº§é«˜äºæœ¬åœ°é…ç½®ï¼‰</span>
        <span class="hljs-title class_">MutablePropertySources</span> propertySources = environment.<span class="hljs-title function_">getPropertySources</span>();
        <span class="hljs-comment">// æ·»åŠ åˆ°æœ€å‰é¢ï¼Œç¡®ä¿ä¼˜å…ˆçº§æœ€é«˜</span>
        propertySources.<span class="hljs-title function_">addFirst</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">"configCenterProperties"</span>, configMap));

        <span class="hljs-comment">// 4. æ‰“å°åŠ è½½ç»“æœï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨SLF4Jï¼‰</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®ä¸­å¿ƒ] æˆåŠŸåŠ è½½ %d ä¸ªé…ç½®é¡¹ï¼Œç¯å¢ƒï¼š%s%n"</span>, configMap.<span class="hljs-title function_">size</span>(), env);
        configMap.<span class="hljs-title function_">forEach</span>((key, value) -&gt; {
            <span class="hljs-comment">// å¯†ç è„±æ•è¾“å‡º</span>
            <span class="hljs-title class_">String</span> displayValue = key.<span class="hljs-title function_">contains</span>(<span class="hljs-string">"password"</span>) ? <span class="hljs-string">"******"</span> : <span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(value);
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®ä¸­å¿ƒ] %s = %s%n"</span>, key, displayValue);
        });
    }
}
</code></pre>
<h5 data-id="heading-6">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.ConfigCenterEnvironmentPostProcessor
</code></pre>
<h5 data-id="heading-7">å¯åŠ¨æµ‹è¯•</h5>
<p>æ·»åŠ å¯åŠ¨å‚æ•°æ¿€æ´»ç”Ÿäº§ç¯å¢ƒï¼š<code>--spring.profiles.active=prod</code></p>
<h5 data-id="heading-8">è¾“å‡º</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> å¼€å§‹æ‹‰å– prod ç¯å¢ƒé…ç½®
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> æˆåŠŸåŠ è½½ 5 ä¸ªé…ç½®é¡¹ï¼Œç¯å¢ƒï¼šprod
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">spring.datasource.username</span> = prod_user
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">spring.datasource.url</span> = jdbc:mysql://prod-mysql:<span class="hljs-number">3306</span>/prod_db?useSSL=<span class="hljs-literal">false</span>
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">redis.host</span> = prod-redis:<span class="hljs-number">6379</span>
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">app.prod.mode</span> = <span class="hljs-literal">true</span>
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">spring.datasource.password</span> = ******

  .   ____          _            __ _ _
 /\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )___ | '_ | '_| | '_ / _` | \ \ \ \
 \/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |___, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.5.8)

2025-12-11T21:46:23.284+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Starting DemoApplication using Java 21.0.9 with PID 10075 (/Users/wangmingfei/Documents/ä¸ªäºº/05 javaå¤©æ¢¯ä¹‹è·¯/01 æºç /03 æ¯æ—¥æ‰“å¡ç³»åˆ—/daily-check-in/springbooté’©å­/demo/target/classes started by wangmingfei in /Users/wangmingfei/Documents/ä¸ªäºº/05 javaå¤©æ¢¯ä¹‹è·¯/01 æºç /03 æ¯æ—¥æ‰“å¡ç³»åˆ—/daily-check-in/springbooté’©å­/demo)
2025-12-11T21:46:23.288+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : The following 1 profile is active: "prod"
2025-12-11T21:46:23.575+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-12-11T21:46:23.582+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardService   : Starting service <span class="hljs-section">[Tomcat]</span>
2025-12-11T21:46:23.582+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardEngine    : Starting Servlet engine: <span class="hljs-section">[Apache Tomcat/10.1.49]</span>
2025-12-11T21:46:23.600+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.a.c.c.C.<span class="hljs-section">[Tomcat]</span>.<span class="hljs-section">[localhost]</span>.<span class="hljs-section">[/]</span>       : Initializing Spring embedded WebApplicationContext
2025-12-11T21:46:23.600+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 298 ms
2025-12-11T21:46:23.739+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-12-11T21:46:23.743+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Started DemoApplication in 9.056 seconds (process running for 9.206)
</code></pre>
<h5 data-id="heading-9">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>é…ç½®ä¸ä»£ç è§£è€¦ï¼Œä¿®æ”¹é…ç½®æ— éœ€é‡æ–°éƒ¨ç½²ï¼›</li>
<li>å¤šç¯å¢ƒé…ç½®ç»Ÿä¸€ç®¡æ§ï¼Œé¿å…é…ç½®æ··ä¹±ï¼›</li>
<li>é…ç½®ä¸­å¿ƒå¯å®ç°é…ç½®çƒ­æ›´æ–°ã€ç°åº¦å‘å¸ƒç­‰é«˜çº§ç‰¹æ€§ï¼›</li>
<li>é…ç½®æ‹‰å–è¿‡ç¨‹å¯å¢åŠ é‰´æƒã€åŠ å¯†ï¼Œæå‡å®‰å…¨æ€§ã€‚</li>
</ul>
<h3 data-id="heading-10">ä¸‰ã€åœºæ™¯ 2ï¼šé…ç½®åŠ å¯†è§£å¯†ï¼ˆæ•æ„Ÿé…ç½®é˜²æ³„éœ²ï¼‰</h3>
<h4 data-id="heading-11">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ•°æ®åº“å¯†ç ã€Redis å¯†ç ã€æ¥å£å¯†é’¥ç­‰æ•æ„Ÿé…ç½®è‹¥æ˜æ–‡å­˜å‚¨ï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨é£é™©ï¼š</p>
<ul>
<li>é…ç½®æ–‡ä»¶æ³„éœ²å¯¼è‡´æ•æ„Ÿä¿¡æ¯è¢«ç›—ï¼›</li>
<li>è¿ç»´äººå‘˜å¯ç›´æ¥æŸ¥çœ‹æ˜æ–‡å¯†ç ï¼Œä¸ç¬¦åˆå®‰å…¨è§„èŒƒï¼›</li>
<li>å®¡è®¡æ— æ³•è¿½æº¯å¯†ç ä½¿ç”¨è®°å½•ã€‚</li>
</ul>
<h4 data-id="heading-12">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â å¯¹åŠ å¯†çš„é…ç½®è¿›è¡Œè§£å¯†ï¼Œæ•æ„Ÿé…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ä»¥å¯†æ–‡å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†ã€‚</p>
<h5 data-id="heading-13">å®ç°ä»£ç </h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.envprocessor;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.env.EnvironmentPostProcessor;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.PropertySource;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;

<span class="hljs-keyword">import</span> javax.crypto.Cipher;
<span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.util.Base64;

<span class="hljs-comment">/** * æ•æ„Ÿé…ç½®è§£å¯†å¤„ç†å™¨ */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EncryptedConfigEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-comment">// åŠ å¯†å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒä»å®‰å…¨å­˜å‚¨ä¸­è¯»å–ï¼Œå¦‚KMS/æœ¬åœ°åŠ å¯†æ–‡ä»¶ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENCRYPT_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"prod_key_1234567"</span>; <span class="hljs-comment">// å®é™…ä½¿ç”¨éœ€16/24/32ä½</span>
    <span class="hljs-comment">// å¯†æ–‡å‰ç¼€æ ‡è¯†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENCRYPT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"encrypt:"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {
        System.out.println(<span class="hljs-string">"[é…ç½®è§£å¯†] å¼€å§‹å¤„ç†æ•æ„Ÿé…ç½®è§£å¯†"</span>);

        <span class="hljs-comment">// éå†æ‰€æœ‰é…ç½®æºï¼Œè§£å¯†æ•æ„Ÿé…ç½®</span>
        <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; propertySource : environment.getPropertySources()) {
            <span class="hljs-comment">// è·³è¿‡ç³»ç»Ÿé…ç½®æºï¼Œåªå¤„ç†åº”ç”¨é…ç½®</span>
            <span class="hljs-keyword">if</span> (propertySource.getName().startsWith(<span class="hljs-string">"system"</span>) || propertySource.getName().startsWith(<span class="hljs-string">"configCenter"</span>)) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// è§£å¯†æ ¸å¿ƒæ•æ„Ÿé…ç½®</span>
            decryptConfig(environment, <span class="hljs-string">"spring.datasource.password"</span>);
            decryptConfig(environment, <span class="hljs-string">"redis.password"</span>);
            decryptConfig(environment, <span class="hljs-string">"app.api.secret"</span>);
        }

        System.out.println(<span class="hljs-string">"[é…ç½®è§£å¯†] æ•æ„Ÿé…ç½®è§£å¯†å®Œæˆ"</span>);
    }

    <span class="hljs-comment">// è§£å¯†å•ä¸ªé…ç½®é¡¹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decryptConfig</span><span class="hljs-params">(ConfigurableEnvironment environment, String configKey)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> environment.getProperty(configKey);
        <span class="hljs-keyword">if</span> (StringUtils.hasText(value) &amp;&amp; value.startsWith(ENCRYPT_PREFIX)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// æˆªå–å¯†æ–‡éƒ¨åˆ†</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">cipherText</span> <span class="hljs-operator">=</span> value.substring(ENCRYPT_PREFIX.length());
                <span class="hljs-comment">// è§£å¯†</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">plainText</span> <span class="hljs-operator">=</span> decrypt(cipherText, ENCRYPT_KEY);
                <span class="hljs-comment">// æ›¿æ¢ä¸ºæ˜æ–‡ï¼ˆæ³¨å…¥åˆ°æœ€é«˜ä¼˜å…ˆçº§é…ç½®æºï¼‰</span>
                environment.getSystemProperties().put(configKey, plainText);
                System.out.printf(<span class="hljs-string">"[é…ç½®è§£å¯†] æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼š%s%n"</span>, configKey);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"é…ç½®è§£å¯†å¤±è´¥ï¼š"</span> + configKey, e);
            }
        }
    }

    <span class="hljs-comment">// AESè§£å¯†å®ç°ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨éå¯¹ç§°åŠ å¯†RSAï¼‰</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String cipherText, String key)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(key.getBytes(StandardCharsets.UTF_8), <span class="hljs-string">"AES"</span>);
        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">"AES/ECB/PKCS5Padding"</span>);
        cipher.init(Cipher.DECRYPT_MODE, secretKey);
        <span class="hljs-type">byte</span>[] decryptedBytes = cipher.doFinal(Base64.getDecoder().decode(cipherText));
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(decryptedBytes, StandardCharsets.UTF_8);
    }

    <span class="hljs-comment">// åŠ å¯†æ–¹æ³•ï¼ˆç”¨äºç”Ÿæˆå¯†æ–‡é…ç½®ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String plainText, String key)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(key.getBytes(StandardCharsets.UTF_8), <span class="hljs-string">"AES"</span>);
        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">"AES/ECB/PKCS5Padding"</span>);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);
        <span class="hljs-type">byte</span>[] encryptedBytes = cipher.doFinal(plainText.getBytes(StandardCharsets.UTF_8));
        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(encryptedBytes);
    }

    <span class="hljs-comment">// æµ‹è¯•ç”Ÿæˆå¯†æ–‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ç”Ÿæˆå¯†æ–‡ï¼šencrypt:xxxxxx</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"prod_pass123"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">cipherText</span> <span class="hljs-operator">=</span> encrypt(password, ENCRYPT_KEY);
        System.out.println(<span class="hljs-string">"å¯†æ–‡é…ç½®ï¼šencrypt:"</span> + cipherText);
    }
}
</code></pre>
<h5 data-id="heading-14">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.EncryptedConfigEnvironmentPostProcessor
</code></pre>
<h5 data-id="heading-15">é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://prod-mysql:3306/prod_db?useSSL=false</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">prod_user</span>
    <span class="hljs-comment"># å¯†æ–‡å­˜å‚¨ï¼Œå‰ç¼€æ ‡è¯†éœ€è¦è§£å¯†</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">prod-redis:6379</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">secret:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
</code></pre>
<h5 data-id="heading-16">è¾“å‡º</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> å¼€å§‹å¤„ç†æ•æ„Ÿé…ç½®è§£å¯†
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼šspring<span class="hljs-selector-class">.datasource</span><span class="hljs-selector-class">.password</span>
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼šredis<span class="hljs-selector-class">.password</span>
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼šapp<span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.secret</span>
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æ•æ„Ÿé…ç½®è§£å¯†å®Œæˆ
</code></pre>
<h5 data-id="heading-17">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>æ•æ„Ÿé…ç½®å¯†æ–‡å­˜å‚¨ï¼Œå³ä½¿é…ç½®æ–‡ä»¶æ³„éœ²ä¹Ÿæ— æ³•è·å–æ˜æ–‡ï¼›</li>
<li>è§£å¯†é€»è¾‘é›†ä¸­ç®¡æ§ï¼Œç¬¦åˆç­‰ä¿åˆè§„è¦æ±‚ï¼›</li>
<li>å¯ç»“åˆ KMSï¼ˆå¯†é’¥ç®¡ç†æœåŠ¡ï¼‰å®ç°å¯†é’¥çš„å®‰å…¨å­˜å‚¨ï¼Œé¿å…ç¡¬ç¼–ç ï¼›</li>
<li>è§£å¯†è¿‡ç¨‹å¯å¢åŠ å®¡è®¡æ—¥å¿—ï¼Œè¿½æº¯æ•æ„Ÿé…ç½®ä½¿ç”¨è®°å½•ã€‚</li>
</ul>
<h3 data-id="heading-18">å››ã€åœºæ™¯ 3ï¼šå¤šç¯å¢ƒé…ç½®åŠ¨æ€è¦†ç›–ï¼ˆè§£å†³é…ç½®å†²çªï¼‰</h3>
<h4 data-id="heading-19">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¤šç¯å¢ƒé…ç½®å¸¸å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>æµ‹è¯•ç¯å¢ƒé…ç½®æ±¡æŸ“ç”Ÿäº§ç¯å¢ƒï¼›</li>
<li>ä¸åŒç¯å¢ƒçš„é…ç½®ä¼˜å…ˆçº§æ··ä¹±ï¼›</li>
<li>ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚ç°åº¦å‘å¸ƒï¼‰éœ€è¦ä¸´æ—¶è¦†ç›–é…ç½®ã€‚</li>
</ul>
<h4 data-id="heading-20">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â å®ç°é…ç½®çš„åŠ¨æ€è¦†ç›–ï¼Œæ ¹æ®ç¯å¢ƒã€æœºå™¨æ ‡ç­¾ç­‰æ¡ä»¶åŠ¨æ€è°ƒæ•´é…ç½®ä¼˜å…ˆçº§ã€‚</p>
<h5 data-id="heading-21">å®ç°ä»£ç </h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.envprocessor;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.env.EnvironmentPostProcessor;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.MapPropertySource;
<span class="hljs-keyword">import</span> org.springframework.core.env.MutablePropertySources;

<span class="hljs-keyword">import</span> java.net.InetAddress;
<span class="hljs-keyword">import</span> java.net.UnknownHostException;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/** * å¤šç¯å¢ƒé…ç½®åŠ¨æ€è¦†ç›–å¤„ç†å™¨ */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvConfigOverrideProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. è·å–æœºå™¨æ ‡è¯†ï¼ˆç”Ÿäº§ç¯å¢ƒå¯ä»æœºå™¨æ ‡ç­¾/ECSå…ƒæ•°æ®è·å–ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">hostName</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostName();
            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostAddress();
            System.out.printf(<span class="hljs-string">"[é…ç½®è¦†ç›–] æœºå™¨ä¿¡æ¯ï¼š%s(%s)%n"</span>, hostName, ip);

            <span class="hljs-comment">// 2. åˆ¤æ–­æ˜¯å¦ä¸ºç°åº¦æœºå™¨</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isGray</span> <span class="hljs-operator">=</span> hostName.contains(<span class="hljs-string">"gray"</span>) || ip.startsWith(<span class="hljs-string">"192.168.100."</span>);
            <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç”Ÿäº§ç¯å¢ƒ</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isProd</span> <span class="hljs-operator">=</span> environment.getActiveProfiles().length &gt; <span class="hljs-number">0</span> &amp;&amp;
                    <span class="hljs-string">"prod"</span>.equals(environment.getActiveProfiles()[<span class="hljs-number">0</span>]);

            <span class="hljs-comment">// 3. åŠ¨æ€è¦†ç›–é…ç½®</span>
            Map&lt;String, Object&gt; overrideConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-keyword">if</span> (isProd &amp;&amp; isGray) {
                <span class="hljs-comment">// ç°åº¦æœºå™¨ä½¿ç”¨ç°åº¦é…ç½®</span>
                overrideConfig.put(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://gray-mysql:3306/prod_db?useSSL=false"</span>);
                overrideConfig.put(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"gray-redis:6379"</span>);
                overrideConfig.put(<span class="hljs-string">"app.gray.mode"</span>, <span class="hljs-string">"true"</span>);
                System.out.println(<span class="hljs-string">"[é…ç½®è¦†ç›–] ç°åº¦æœºå™¨ï¼ŒåŠ è½½ç°åº¦é…ç½®"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isProd) {
                <span class="hljs-comment">// ç”Ÿäº§æœºå™¨ä½¿ç”¨ç”Ÿäº§é…ç½®</span>
                overrideConfig.put(<span class="hljs-string">"app.gray.mode"</span>, <span class="hljs-string">"false"</span>);
                overrideConfig.put(<span class="hljs-string">"app.log.level"</span>, <span class="hljs-string">"INFO"</span>);
                System.out.println(<span class="hljs-string">"[é…ç½®è¦†ç›–] ç”Ÿäº§æœºå™¨ï¼ŒåŠ è½½ç”Ÿäº§é…ç½®"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// æµ‹è¯•/å¼€å‘æœºå™¨æ”¾å®½é…ç½®é™åˆ¶</span>
                overrideConfig.put(<span class="hljs-string">"app.log.level"</span>, <span class="hljs-string">"DEBUG"</span>);
                overrideConfig.put(<span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>, <span class="hljs-string">"10"</span>);
                System.out.println(<span class="hljs-string">"[é…ç½®è¦†ç›–] éç”Ÿäº§æœºå™¨ï¼ŒåŠ è½½æµ‹è¯•é…ç½®"</span>);
            }

            <span class="hljs-comment">// 4. è¦†ç›–é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰</span>
            <span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">propertySources</span> <span class="hljs-operator">=</span> environment.getPropertySources();
            propertySources.addFirst(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">"dynamicOverrideConfig"</span>, overrideConfig));

            <span class="hljs-comment">// 5. æ‰“å°æœ€ç»ˆç”Ÿæ•ˆçš„æ ¸å¿ƒé…ç½®</span>
            System.out.printf(<span class="hljs-string">"[é…ç½®è¦†ç›–] æœ€ç»ˆç”Ÿæ•ˆçš„æ•°æ®åº“åœ°å€ï¼š%s%n"</span>,
                    environment.getProperty(<span class="hljs-string">"spring.datasource.url"</span>));
            System.out.printf(<span class="hljs-string">"[é…ç½®è¦†ç›–] æœ€ç»ˆç”Ÿæ•ˆçš„ç°åº¦æ¨¡å¼ï¼š%s%n"</span>,
                    environment.getProperty(<span class="hljs-string">"app.gray.mode"</span>));

        } <span class="hljs-keyword">catch</span> (UnknownHostException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æœºå™¨ä¿¡æ¯å¤±è´¥"</span>, e);
        }
    }
}
</code></pre>
<h5 data-id="heading-22">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.EnvConfigOverrideProcessor
</code></pre>
<h5 data-id="heading-23">è¾“å‡ºï¼ˆç”Ÿäº§æœºå™¨ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[é…ç½®è¦†ç›–]</span> æœºå™¨ä¿¡æ¯ï¼šxxx(127.0.0.1)
<span class="hljs-section">[é…ç½®è¦†ç›–]</span> ç”Ÿäº§æœºå™¨ï¼ŒåŠ è½½ç”Ÿäº§é…ç½®
<span class="hljs-section">[é…ç½®è¦†ç›–]</span> æœ€ç»ˆç”Ÿæ•ˆçš„æ•°æ®åº“åœ°å€ï¼šjdbc:mysql://prod-mysql:3306/prod_db?<span class="hljs-attr">useSSL</span>=<span class="hljs-literal">false</span>
<span class="hljs-section">[é…ç½®è¦†ç›–]</span> æœ€ç»ˆç”Ÿæ•ˆçš„ç°åº¦æ¨¡å¼ï¼šfalse
</code></pre>
<h5 data-id="heading-24">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>åŸºäºæœºå™¨æ ‡ç­¾åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œå®ç°ç°åº¦å‘å¸ƒã€è“ç»¿éƒ¨ç½²ï¼›</li>
<li>é¿å…æµ‹è¯•é…ç½®æ±¡æŸ“ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®éš”ç¦»æ›´å½»åº•ï¼›</li>
<li>ç”Ÿäº§ç¯å¢ƒå¯ä¸´æ—¶è¦†ç›–é…ç½®ï¼Œæ— éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼›</li>
<li>é…ç½®ä¼˜å…ˆçº§å¯ç²¾ç»†åŒ–æ§åˆ¶ï¼Œè§£å†³é…ç½®å†²çªé—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-25">äº”ã€åœºæ™¯ 4ï¼šé…ç½®æ ¡éªŒä¸è¡¥å…¨ï¼ˆæå‰æ‹¦æˆªéæ³•é…ç½®ï¼‰</h3>
<h4 data-id="heading-26">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé…ç½®é”™è¯¯å¸¸å¯¼è‡´åº”ç”¨å¯åŠ¨åä¸å¯ç”¨ï¼š</p>
<ul>
<li>æ ¸å¿ƒé…ç½®ç¼ºå¤±ï¼ˆå¦‚æ•°æ®åº“åœ°å€ä¸ºç©ºï¼‰ï¼›</li>
<li>é…ç½®æ ¼å¼é”™è¯¯ï¼ˆå¦‚ç«¯å£å·éæ•°å­—ï¼‰ï¼›</li>
<li>é…ç½®å€¼è¶…å‡ºåˆç†èŒƒå›´ï¼ˆå¦‚çº¿ç¨‹æ± å¤§å°è®¾ç½®ä¸º 0ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-27">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â åœ¨é…ç½®ç”Ÿæ•ˆå‰è¿›è¡Œæ ¡éªŒï¼Œéæ³•é…ç½®ç›´æ¥ç»ˆæ­¢å¯åŠ¨ï¼Œå¹¶ç»™å‡ºæ˜ç¡®çš„é”™è¯¯æç¤ºã€‚</p>
<h5 data-id="heading-28">å®ç°ä»£ç </h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">envprocessor</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">env</span>.<span class="hljs-property">EnvironmentPostProcessor</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">ConfigurableEnvironment</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">util</span>.<span class="hljs-property">StringUtils</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">regex</span>.<span class="hljs-property">Pattern</span>;

<span class="hljs-comment">/** * é…ç½®æ ¡éªŒä¸è¡¥å…¨å¤„ç†å™¨ */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigValidateProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-comment">// ç«¯å£å·æ­£åˆ™</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Pattern</span> <span class="hljs-variable constant_">PORT_PATTERN</span> = <span class="hljs-title class_">Pattern</span>.<span class="hljs-title function_">compile</span>(<span class="hljs-string">"^\d{1,5}$"</span>);
    <span class="hljs-comment">// æ•°æ®åº“URLæ­£åˆ™</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Pattern</span> <span class="hljs-variable constant_">DB_URL_PATTERN</span> = <span class="hljs-title class_">Pattern</span>.<span class="hljs-title function_">compile</span>(<span class="hljs-string">"^jdbc:\w+://.+:\d+/\w+.*$"</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessEnvironment</span>(<span class="hljs-params">ConfigurableEnvironment environment, SpringApplication application</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[é…ç½®æ ¡éªŒ] å¼€å§‹æ ¡éªŒæ ¸å¿ƒé…ç½®"</span>);

        <span class="hljs-comment">// 1. æ ¡éªŒæ ¸å¿ƒé…ç½®æ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"spring.datasource.url"</span>);
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"spring.datasource.username"</span>);
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"spring.datasource.password"</span>);
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"redis.host"</span>);

        <span class="hljs-comment">// 2. æ ¡éªŒé…ç½®æ ¼å¼</span>
        <span class="hljs-title function_">validateConfigFormat</span>(environment, <span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-variable constant_">DB_URL_PATTERN</span>, <span class="hljs-string">"æ•°æ®åº“URLæ ¼å¼éæ³•"</span>);
        <span class="hljs-title function_">validateConfigFormat</span>(environment, <span class="hljs-string">"server.port"</span>, <span class="hljs-variable constant_">PORT_PATTERN</span>, <span class="hljs-string">"ç«¯å£å·æ ¼å¼éæ³•"</span>);

        <span class="hljs-comment">// 3. æ ¡éªŒé…ç½®å€¼èŒƒå›´</span>
        <span class="hljs-title function_">validatePortRange</span>(environment, <span class="hljs-string">"server.port"</span>);
        <span class="hljs-title function_">validateThreadPoolSize</span>(environment, <span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>);

        <span class="hljs-comment">// 4. è¡¥å…¨é»˜è®¤é…ç½®</span>
        <span class="hljs-title function_">supplementDefaultConfig</span>(environment, <span class="hljs-string">"server.port"</span>, <span class="hljs-string">"8080"</span>);
        <span class="hljs-title function_">supplementDefaultConfig</span>(environment, <span class="hljs-string">"spring.datasource.hikari.minimum-idle"</span>, <span class="hljs-string">"5"</span>);

        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[é…ç½®æ ¡éªŒ] æ ¸å¿ƒé…ç½®æ ¡éªŒé€šè¿‡ï¼Œé»˜è®¤é…ç½®å·²è¡¥å…¨"</span>);
    }

    <span class="hljs-comment">// æ ¡éªŒé…ç½®æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateConfigExists</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æ ¸å¿ƒé…ç½®ç¼ºå¤±ï¼š"</span> + configKey);
        }
    }

    <span class="hljs-comment">// æ ¡éªŒé…ç½®æ ¼å¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateConfigFormat</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey,
                                      Pattern pattern, <span class="hljs-built_in">String</span> errorMsg</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value) &amp;&amp; !pattern.<span class="hljs-title function_">matcher</span>(value).<span class="hljs-title function_">matches</span>()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(errorMsg + <span class="hljs-string">"ï¼Œé…ç½®é¡¹ï¼š"</span> + configKey + <span class="hljs-string">"ï¼Œå€¼ï¼š"</span> + value);
        }
    }

    <span class="hljs-comment">// æ ¡éªŒç«¯å£å·èŒƒå›´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validatePortRange</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value) &amp;&amp; <span class="hljs-variable constant_">PORT_PATTERN</span>.<span class="hljs-title function_">matcher</span>(value).<span class="hljs-title function_">matches</span>()) {
            int port = <span class="hljs-title class_">Integer</span>.<span class="hljs-built_in">parseInt</span>(value);
            <span class="hljs-keyword">if</span> (port &lt; <span class="hljs-number">1</span> || port &gt; <span class="hljs-number">65535</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç«¯å£å·è¶…å‡ºèŒƒå›´(1-65535)ï¼š"</span> + configKey + <span class="hljs-string">"="</span> + value);
            }
        }
    }

    <span class="hljs-comment">// æ ¡éªŒçº¿ç¨‹æ± å¤§å°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateThreadPoolSize</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value)) {
            <span class="hljs-keyword">try</span> {
                int size = <span class="hljs-title class_">Integer</span>.<span class="hljs-built_in">parseInt</span>(value);
                <span class="hljs-keyword">if</span> (size &lt; <span class="hljs-number">1</span> || size &gt; <span class="hljs-number">100</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"çº¿ç¨‹æ± å¤§å°è¶…å‡ºåˆç†èŒƒå›´(1-100)ï¼š"</span> + configKey + <span class="hljs-string">"="</span> + value);
                }
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">NumberFormatException</span> e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"çº¿ç¨‹æ± å¤§å°å¿…é¡»ä¸ºæ•°å­—ï¼š"</span> + configKey + <span class="hljs-string">"="</span> + value);
            }
        }
    }

    <span class="hljs-comment">// è¡¥å…¨é»˜è®¤é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">supplementDefaultConfig</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey, <span class="hljs-built_in">String</span> defaultValue</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value)) {
            environment.<span class="hljs-title function_">getSystemProperties</span>().<span class="hljs-title function_">put</span>(configKey, defaultValue);
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®è¡¥å…¨] é…ç½®é¡¹ %s ç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼š%s%n"</span>, configKey, defaultValue);
        }
    }
}
</code></pre>
<h5 data-id="heading-29">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.ConfigValidateProcessor
</code></pre>
<h5 data-id="heading-30">é…ç½®æ–‡ä»¶</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment">#spring:</span>
<span class="hljs-comment">#  datasource:</span>
<span class="hljs-comment">#    url: jdbc:mysql://prod-mysql:3306/prod_db?useSSL=false</span>
<span class="hljs-comment">#    username: prod_user</span>
<span class="hljs-comment">#    # å¯†æ–‡å­˜å‚¨ï¼Œå‰ç¼€æ ‡è¯†éœ€è¦è§£å¯†</span>
<span class="hljs-comment">#    password: encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">prod-redis:6379</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">secret:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
</code></pre>
<h5 data-id="heading-31">é”™è¯¯è¾“å‡ºç¤ºä¾‹</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[é…ç½®æ ¡éªŒ]</span> å¼€å§‹æ ¡éªŒæ ¸å¿ƒé…ç½®
<span class="hljs-number">22</span>:<span class="hljs-number">15</span>:<span class="hljs-number">56.187</span> [main] ERROR org.springframework.boot.SpringApplication -- Application run failed
java.lang.IllegalArgumentException: æ ¸å¿ƒé…ç½®ç¼ºå¤±ï¼šspring.datasource.url
    at com.example.demo.envprocessor.ConfigValidateProcessor.<span class="hljs-built_in">validateConfigExists</span>(ConfigValidateProcessor.java:<span class="hljs-number">47</span>)
    at com.example.demo.envprocessor.ConfigValidateProcessor.<span class="hljs-built_in">postProcessEnvironment</span>(ConfigValidateProcessor.java:<span class="hljs-number">23</span>)
    at org.springframework.boot.env.EnvironmentPostProcessorApplicationListener.<span class="hljs-built_in">onApplicationEnvironmentPreparedEvent</span>(EnvironmentPostProcessorApplicationListener.java:<span class="hljs-number">132</span>)
    at org.springframework.boot.env.EnvironmentPostProcessorApplicationListener.<span class="hljs-built_in">onApplicationEvent</span>(EnvironmentPostProcessorApplicationListener.java:<span class="hljs-number">115</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">doInvokeListener</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">185</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">invokeListener</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">178</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">multicastEvent</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">156</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">multicastEvent</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">138</span>)
    at org.springframework.boot.context.event.EventPublishingRunListener.<span class="hljs-built_in">multicastInitialEvent</span>(EventPublishingRunListener.java:<span class="hljs-number">136</span>)
    at org.springframework.boot.context.event.EventPublishingRunListener.<span class="hljs-built_in">environmentPrepared</span>(EventPublishingRunListener.java:<span class="hljs-number">81</span>)
    at org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$<span class="hljs-number">2</span>(SpringApplicationRunListeners.java:<span class="hljs-number">64</span>)
    at java.base/java.lang.Iterable.<span class="hljs-built_in">forEach</span>(Iterable.java:<span class="hljs-number">75</span>)
    at org.springframework.boot.SpringApplicationRunListeners.<span class="hljs-built_in">doWithListeners</span>(SpringApplicationRunListeners.java:<span class="hljs-number">118</span>)
    at org.springframework.boot.SpringApplicationRunListeners.<span class="hljs-built_in">doWithListeners</span>(SpringApplicationRunListeners.java:<span class="hljs-number">112</span>)
    at org.springframework.boot.SpringApplicationRunListeners.<span class="hljs-built_in">environmentPrepared</span>(SpringApplicationRunListeners.java:<span class="hljs-number">63</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">prepareEnvironment</span>(SpringApplication.java:<span class="hljs-number">353</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">run</span>(SpringApplication.java:<span class="hljs-number">313</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">run</span>(SpringApplication.java:<span class="hljs-number">1361</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">run</span>(SpringApplication.java:<span class="hljs-number">1350</span>)
    at com.example.demo.DemoApplication.<span class="hljs-built_in">main</span>(DemoApplication.java:<span class="hljs-number">11</span>)
å·²ä¸åœ°å€ä¸º <span class="hljs-string">''</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">57589</span><span class="hljs-string">'ï¼Œä¼ è¾“: '</span>å¥—æ¥å­—<span class="hljs-string">''</span> çš„ç›®æ ‡è™šæ‹Ÿæœºæ–­å¼€è¿æ¥
</code></pre>
<h5 data-id="heading-32">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>æå‰æ‹¦æˆªéæ³•é…ç½®ï¼Œé¿å…åº”ç”¨å¯åŠ¨åä¸å¯ç”¨ï¼›</li>
<li>é”™è¯¯æç¤ºæ˜ç¡®ï¼Œç¼©çŸ­é…ç½®é—®é¢˜æ’æŸ¥æ—¶é—´ï¼›</li>
<li>è¡¥å…¨é»˜è®¤é…ç½®ï¼Œå‡å°‘é…ç½®æ–‡ä»¶ç»´æŠ¤æˆæœ¬ï¼›</li>
<li>ç»Ÿä¸€æ ¡éªŒè§„åˆ™ï¼Œç¬¦åˆç”Ÿäº§ç¯å¢ƒé…ç½®è§„èŒƒã€‚</li>
</ul>
<h3 data-id="heading-33">å…­ã€æ€»ç»“</h3>
<p><code>EnvironmentPostProcessor</code>Â æ˜¯ Spring Boot é…ç½®æ²»ç†çš„æ ¸å¿ƒæ‰©å±•ç‚¹ï¼Œå®ƒåœ¨é…ç½®æœ€ç»ˆç”Ÿæ•ˆå‰æä¾›äº†å¼ºå¤§çš„å®šåˆ¶åŒ–èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>é…ç½®ä¸­å¿ƒåŒ–</strong>ï¼šä»é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®ï¼Œè§£è€¦é…ç½®ä¸ä»£ç ï¼›</li>
<li><strong>é…ç½®åŠ å¯†</strong>ï¼šæ•æ„Ÿé…ç½®å¯†æ–‡å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†ï¼›</li>
<li><strong>åŠ¨æ€è¦†ç›–</strong>ï¼šåŸºäºç¯å¢ƒ / æœºå™¨æ ‡ç­¾åŠ¨æ€è°ƒæ•´é…ç½®ï¼›</li>
<li><strong>é…ç½®æ ¡éªŒ</strong>ï¼šæå‰æ‹¦æˆªéæ³•é…ç½®ï¼Œä¿éšœåº”ç”¨å¯åŠ¨æˆåŠŸã€‚</li>
</ul>
<p>ç›¸è¾ƒäºÂ <code>SpringApplicationRunListener</code>ï¼Œ<code>EnvironmentPostProcessor</code>Â æ›´èšç„¦äºé…ç½®å±‚é¢çš„æ‰©å±•ï¼Œæ˜¯æ„å»º â€œé…ç½®å³ä»£ç â€â€œé…ç½®ç»Ÿä¸€ç®¡æ§â€ ç”Ÿäº§çº§åº”ç”¨çš„å…³é”®å·¥å…·ã€‚</p>
<p>ğŸ“ŒÂ <strong>å…³æ³¨æˆ‘</strong>ï¼Œæ¯å¤© 5 åˆ†é’Ÿï¼Œå¸¦ä½ ä» Java å°ç™½å˜èº«ç¼–ç¨‹é«˜æ‰‹ï¼</p>
<p>ğŸ‘‰ ç‚¹èµ + å…³æ³¨ + è½¬å‘ï¼Œè®©æ›´å¤šå°ä¼™ä¼´ä¸€èµ·è¿›æ­¥ï¼</p>
<p>ğŸ‘‰ ç§ä¿¡ "SpringBoot é’©å­æºç " è·å–å®Œæ•´æºç ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flinkæºç é˜…è¯»ï¼šCheckpointæœºåˆ¶ï¼ˆä¸‹ï¼‰]]></title>    <link>https://juejin.cn/post/7585458459166507042</link>    <guid>https://juejin.cn/post/7585458459166507042</guid>    <pubDate>2025-12-20T13:59:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166507042" data-draft-id="7585458459166490658" data-original-type="2" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flinkæºç é˜…è¯»ï¼šCheckpointæœºåˆ¶ï¼ˆä¸‹ï¼‰"/> <meta itemprop="keywords" content="Flink,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2025-12-20T13:59:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢å‘Googleç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flinkæºç é˜…è¯»ï¼šCheckpointæœºåˆ¶ï¼ˆä¸‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢å‘Googleç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:59:07.000Z" title="Sat Dec 20 2025 13:59:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¹¦æ¥ä¸Šå›ï¼Œå‰æ–‡æˆ‘ä»¬æ¢³ç†çš„ Checkpoint æœºåˆ¶çš„æºç ï¼Œä½†æ˜¯å¯¹äºå¦‚ä½•å†™å…¥çŠ¶æ€æ•°æ®å¹¶æ²¡æœ‰æ·±å…¥äº†è§£ã€‚ä»Šå¤©å°±ä¸€èµ·æ¥æ¢³ç†ä¸€ä¸‹è¿™éƒ¨åˆ†ä»£ç ã€‚</p>
<h3 data-id="heading-0">å†™åœ¨å‰é¢</h3>
<p>å‰é¢æˆ‘ä»¬äº†è§£åˆ°åœ¨ <code>StreamOperatorStateHandler.snapshotState</code> æ–¹æ³•ä¸­ä¼šåˆ›å»ºå››ä¸ª Futureï¼Œç”¨æ¥æ”¯æŒä¸åŒç±»å‹çš„çŠ¶æ€å†™å…¥ã€‚</p>
<pre><code class="hljs language-java" lang="java">snapshotInProgress.setKeyedStateRawFuture(snapshotContext.getKeyedStateStreamFuture());
snapshotInProgress.setOperatorStateRawFuture(
        snapshotContext.getOperatorStateStreamFuture());

<span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != operatorStateBackend) {
    snapshotInProgress.setOperatorStateManagedFuture(
            operatorStateBackend.snapshot(
                    checkpointId, timestamp, factory, checkpointOptions));
}

<span class="hljs-keyword">if</span> (useAsyncState &amp;&amp; <span class="hljs-literal">null</span> != asyncKeyedStateBackend) {
    <span class="hljs-keyword">if</span> (isCanonicalSavepoint(checkpointOptions.getCheckpointType())) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"Not supported yet."</span>);
    } <span class="hljs-keyword">else</span> {
        snapshotInProgress.setKeyedStateManagedFuture(
                asyncKeyedStateBackend.snapshot(
                        checkpointId, timestamp, factory, checkpointOptions));
    }
}
</code></pre>
<p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒ ManagedStateï¼ŒManagedState éƒ½æ˜¯è°ƒç”¨ <code>Snapshotable.snapshot</code> æ–¹æ³•æ¥å†™å…¥æ•°æ®çš„ï¼Œä¸‹é¢å…·ä½“çœ‹ KeyedState å’Œ OperatorState çš„å…·ä½“å®ç°ã€‚</p>
<h3 data-id="heading-1">KeyedState</h3>
<p>KeyedState æˆ‘ä»¬ä»¥ HeapKeyedStateBackend ä¸ºä¾‹ï¼Œè¿™é‡Œå…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ª <code>SnapshotStrategyRunner</code> å®ä¾‹ï¼ŒSnapshotStrategyRunner æ˜¯ä¸€ä¸ªå¿«ç…§ç­–ç•¥çš„ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œåˆ›å»ºå®Œæˆåå°±ä¼šè°ƒç”¨ snapshot æ–¹æ³•ã€‚åœ¨è¿™ä¸ª snapshot æ–¹æ³•ä¸­ä¸»è¦åšäº†åšäº†ä¸‹é¢å‡ ä»¶äº‹ï¼š</p>
<ol>
<li>
<p>åŒæ­¥æ‹·è´çŠ¶æ€æ•°æ®çš„å¼•ç”¨ã€‚</p>
</li>
<li>
<p>åˆ›å»º Checkpoint è¾“å‡ºæµ <code>CheckpointStateOutputStream</code></p>
</li>
<li>
<p>å®Œæˆ Checkpoint æŒä¹…åŒ–</p>
</li>
<li>
<p>è¿”å›å…ƒä¿¡æ¯ç»“æœ</p>
</li>
</ol>
<h4 data-id="heading-2">çŠ¶æ€æ•°æ®å¼•ç”¨æ‹·è´</h4>
<p>åœ¨ HeapSnapshotStrategy çš„ syncPrepareResources æ–¹æ³•ä¸­è°ƒç”¨äº† <code>HeapSnapshotResources.create</code> æ–¹æ³•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°æ˜¯ registeredKVStatesï¼Œå®ƒä»£è¡¨æˆ‘ä»¬åœ¨ä¸šåŠ¡ä»£ç ä¸­æ³¨å†Œçš„çŠ¶æ€æ•°æ®è¡¨ã€‚</p>
<pre><code class="hljs language-java" lang="java">ValueStateDescriptor&lt;Tuple2&lt;Long, Long&gt;&gt; descriptor =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;&gt;(
                <span class="hljs-string">"average"</span>,
                TypeInformation.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHint</span>&lt;Tuple2&lt;Long, Long&gt;&gt;() {}));
</code></pre>
<p>ä¾‹å¦‚æˆ‘ä»¬è¿™æ ·æ³¨å†ŒçŠ¶æ€æ•°æ®è¡¨ï¼Œé‚£ä¹ˆ registeredKVStates çš„ key å°±æ˜¯ averageï¼Œvalue å°±æ˜¯çŠ¶æ€è¡¨ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ª CopyOnWriteStateTableã€‚å…·ä½“çš„çŠ¶æ€æ•°æ®å¼•ç”¨æ‹·è´çš„é€»è¾‘åœ¨ <code>processSnapshotMetaInfoForAllStates</code> æ–¹æ³•ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSnapshotMetaInfoForAllStates</span><span class="hljs-params">(
        List&lt;StateMetaInfoSnapshot&gt; metaInfoSnapshots,
        Map&lt;StateUID, StateSnapshot&gt; cowStateStableSnapshots,
        Map&lt;StateUID, Integer&gt; stateNamesToId,
        Map&lt;String, ? extends StateSnapshotRestore&gt; registeredStates,
        StateMetaInfoSnapshot.BackendStateType stateType)</span> {

    <span class="hljs-keyword">for</span> (Map.Entry&lt;String, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateSnapshotRestore</span>&gt; kvState :
            registeredStates.entrySet()) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">StateUID</span> <span class="hljs-variable">stateUid</span> <span class="hljs-operator">=</span> StateUID.of(kvState.getKey(), stateType);
        stateNamesToId.put(stateUid, stateNamesToId.size());
        <span class="hljs-type">StateSnapshotRestore</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> kvState.getValue();
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != state) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">StateSnapshot</span> <span class="hljs-variable">stateSnapshot</span> <span class="hljs-operator">=</span> state.stateSnapshot();
            metaInfoSnapshots.add(stateSnapshot.getMetaInfoSnapshot());
            cowStateStableSnapshots.put(stateUid, stateSnapshot);
        }
    }
}
</code></pre>
<p>é’ˆå¯¹æ¯ä¸ª Stateï¼Œè¿™é‡Œéƒ½åˆ›å»ºä¸€ä¸ª CopyOnWriteStateTableSnapshotï¼Œç„¶åå­˜åœ¨ cowStateStableSnapshots é‡Œã€‚è¿™é‡Œ CopyOnWriteStateTableSnapshot å°±æ˜¯æ‹·è´æ•°æ®çš„å¼•ç”¨ï¼Œå› æ­¤å¯ä»¥åŒæ­¥æ‰§è¡Œã€‚</p>
<h4 data-id="heading-3">åˆ›å»º CheckpointStateOutputStream</h4>
<p>åˆ›å»º CheckpointStateOutputStream çš„æ–¹æ³•æ˜¯ <code>CheckpointStreamWithResultProvider.createSimpleStream</code>ï¼Œç”Ÿäº§ç¯å¢ƒé€šå¸¸ä½¿ç”¨çš„æ˜¯ FsCheckpointStateOutputStreamã€‚FsCheckpointStateOutputStream ä¸­çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çŠ¶æ€æ•°æ®å†™å…¥ç¼“å†²æ•°ç»„ï¼Œæ•°æ®å…ˆå†™åˆ°å†…å­˜ä¸­ï¼Œç„¶å flush åˆ°ç£ç›˜</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] writeBuffer;

<span class="hljs-comment">// ç¼“å†²æ•°ç»„å½“å‰å†™å…¥ä½ç½®</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pos;

<span class="hljs-comment">// æ–‡ä»¶è¾“å‡ºæµ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> FSDataOutputStream outStream;

<span class="hljs-comment">// å†…å­˜ä¸­çŠ¶æ€å¤§å°é˜ˆå€¼ï¼Œè¶…è¿‡é˜ˆå€¼ä¼š flush åˆ°ç£ç›˜ï¼Œé»˜è®¤20KBï¼Œæœ€å¤§1MB</span>
<span class="hljs-comment">// ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å°æ–‡ä»¶æ•°é‡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> localStateThreshold;

<span class="hljs-comment">// checkpoint åŸºç¡€è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Path basePath;

<span class="hljs-comment">// Flink è‡ªå·±å°è£…çš„æ–‡ä»¶ç³»ç»Ÿ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileSystem fs;

<span class="hljs-comment">// çŠ¶æ€æ•°æ®å®Œæ•´è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Path statePath;

<span class="hljs-comment">// ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">private</span> String relativeStatePath;

<span class="hljs-comment">// æ˜¯å¦å·²å…³é—­</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> closed;

<span class="hljs-comment">// æ˜¯å¦å…è®¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> allowRelativePaths;
</code></pre>
<h4 data-id="heading-4">Checkpoint æŒä¹…åŒ–</h4>
<p>åˆ›å»ºå®Œ CheckpointStateOutputStream ä¹‹åï¼Œä¼šè°ƒç”¨ <code>serializationProxy.write(outView)</code> å†™å…¥çŠ¶æ€çš„å…ƒæ•°æ®ã€‚å…ƒæ•°æ®åŒ…æ‹¬çŠ¶æ€çš„åç§°ã€ç±»å‹ã€åºåˆ—åŒ–å™¨ç­‰ä¸€äº›é…ç½®ã€‚</p>
<p>å…ƒæ•°æ®å†™å®Œä¹‹åï¼Œå°±å¼€å§‹åˆ†ç»„å†™å…¥çŠ¶æ€æ•°æ®ã€‚åœ¨å†™å…¥æ—¶ï¼Œå…ˆå†™ keyGroupIdï¼Œç„¶åå†å†™å½“å‰åˆ†ç»„çš„çŠ¶æ€æ•°æ®</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">keyGroupPos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        keyGroupPos &lt; keyGroupRange.getNumberOfKeyGroups();
        ++keyGroupPos) {
    <span class="hljs-type">int</span> <span class="hljs-variable">keyGroupId</span> <span class="hljs-operator">=</span> keyGroupRange.getKeyGroupId(keyGroupPos);
    keyGroupRangeOffsets[keyGroupPos] = localStream.getPos();
    <span class="hljs-comment">// å†™ keyGroupId</span>
    outView.writeInt(keyGroupId);

    <span class="hljs-keyword">for</span> (Map.Entry&lt;StateUID, StateSnapshot&gt; stateSnapshot :
            cowStateStableSnapshots.entrySet()) {
        StateSnapshot.<span class="hljs-type">StateKeyGroupWriter</span> <span class="hljs-variable">partitionedSnapshot</span> <span class="hljs-operator">=</span>
                stateSnapshot.getValue().getKeyGroupWriter();
        <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">kgCompressionOut</span> <span class="hljs-operator">=</span>
                keyGroupCompressionDecorator.decorateWithCompression(localStream)) {
            <span class="hljs-type">DataOutputViewStreamWrapper</span> <span class="hljs-variable">kgCompressionView</span> <span class="hljs-operator">=</span>
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataOutputViewStreamWrapper</span>(kgCompressionOut);
            kgCompressionView.writeShort(stateNamesToId.get(stateSnapshot.getKey()));
            <span class="hljs-comment">// å†™çŠ¶æ€æ•°æ®</span>
            partitionedSnapshot.writeStateInKeyGroup(kgCompressionView, keyGroupId);
        } <span class="hljs-comment">// this will just close the outer compression stream</span>
    }
}
</code></pre>
<p>çŠ¶æ€æ•°æ®å†™å…¥çš„è°ƒç”¨é“¾è·¯å¦‚ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8532e00e4e14497d964c456054bcacba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843949&amp;x-signature=kgoMWNFeh65SzeUp4yF%2F7vhDS5Q%3D" alt="writeState" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeState</span><span class="hljs-params">(
        TypeSerializer&lt;K&gt; keySerializer,
        TypeSerializer&lt;N&gt; namespaceSerializer,
        TypeSerializer&lt;S&gt; stateSerializer,
        <span class="hljs-meta">@Nonnull</span> DataOutputView dov,
        <span class="hljs-meta">@Nullable</span> StateSnapshotTransformer&lt;S&gt; stateSnapshotTransformer)</span>
        <span class="hljs-keyword">throws</span> IOException {
    SnapshotIterator&lt;K, N, S&gt; snapshotIterator =
            getIterator(
                    keySerializer,
                    namespaceSerializer,
                    stateSerializer,
                    stateSnapshotTransformer);

    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> snapshotIterator.size();
    dov.writeInt(size);
    <span class="hljs-keyword">while</span> (snapshotIterator.hasNext()) {
        StateEntry&lt;K, N, S&gt; stateEntry = snapshotIterator.next();
        namespaceSerializer.serialize(stateEntry.getNamespace(), dov);
        keySerializer.serialize(stateEntry.getKey(), dov);
        stateSerializer.serialize(stateEntry.getState(), dov);
    }
}
</code></pre>
<h4 data-id="heading-5">è¿”å›ç»“æœ</h4>
<p>æœ€åä¸€æ­¥å°±æ˜¯å°è£…å¹¶è¿”å›å…ƒä¿¡æ¯ï¼Œè¿™é‡Œæ”¶é›†çš„ä¿¡æ¯åŒ…æ‹¬äº†æ¯ä¸ª keyGroup çš„çŠ¶æ€æ•°æ®åœ¨çŠ¶æ€æ–‡ä»¶ä¸­çš„å­˜å‚¨ä½ç½®ï¼ŒçŠ¶æ€æ•°æ®å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶å¤§å°ç­‰ã€‚</p>
<h3 data-id="heading-6">OperatorState</h3>
<p>OperatorState çš„å¤„ç†é€»è¾‘æ¯” KeyedState æ›´ç®€å•ä¸€äº›ï¼Œæµç¨‹ä¸Šéƒ½æ˜¯å…ˆåšçŠ¶æ€æ•°æ®çš„å¼•ç”¨å¿«ç…§ï¼Œç„¶åå†™å…¥çŠ¶æ€æ•°æ®å’Œè¿”å›ç»“æœã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œæ²¡æœ‰äº†åˆ†ç»„å†™å…¥çš„é€»è¾‘ã€‚ç›´æ¥å¤„ç† operatorState å’Œ broadcastStateã€‚è¿™é‡Œå°±åªè´´ä¸€ä¸‹è°ƒç”¨æµç¨‹ï¼Œä¸åšè¿‡å¤šèµ˜è¿°äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50fefebe3e664ff1b639d9d3fbfb4bb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843949&amp;x-signature=f0ziWpm1rFWYSxSJffCQessZf%2FY%3D" alt="operatorState" loading="lazy"/></p>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>æœ¬æ–‡æˆ‘ä»¬é‡ç‚¹æ¢³ç†äº† KeyedState æ•°æ®å†™å…¥çš„ä»£ç ã€‚å…¶ä¸»è¦æ­¥éª¤åŒ…æ‹¬ï¼šåŒæ­¥æ‹·è´çŠ¶æ€æ•°æ®çš„å¼•ç”¨ï¼Œåˆ›å»º Checkpoint è¾“å‡ºæµ <code>CheckpointStateOutputStream</code> å¹¶å®Œæˆ Checkpoint æŒä¹…åŒ–ï¼Œæœ€åè¿”å›å…ƒä¿¡æ¯ç»“æœã€‚OperatorState çš„å¤„ç†è¿‡ç¨‹å’Œ KeyedState çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯å°‘äº†åˆ†ç»„çš„é€»è¾‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flinkæºç é˜…è¯»ï¼šçŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7585485284152721443</link>    <guid>https://juejin.cn/post/7585485284152721443</guid>    <pubDate>2025-12-20T13:59:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485284152721443" data-draft-id="7585485284152705059" data-original-type="2" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flinkæºç é˜…è¯»ï¼šçŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="Flink,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2025-12-20T13:59:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢å‘Googleç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flinkæºç é˜…è¯»ï¼šçŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢å‘Googleç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:59:08.000Z" title="Sat Dec 20 2025 13:59:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº† Flink çŠ¶æ€çš„åˆ†ç±»å’Œåº”ç”¨ã€‚ä»Šå¤©ä»æºç å±‚é¢å†çœ‹ä¸€ä¸‹ Flink æ˜¯å¦‚ä½•ç®¡ç†çŠ¶æ€çš„ã€‚</p>
<h3 data-id="heading-0">State æ¦‚è¿°</h3>
<p>å…³äº State çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F08%2F04%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E7%258A%25B6%25E6%2580%2581%25E7%25B1%25BB%25E5%259E%258B%25E5%2592%258C%25E5%25BA%2594%25E7%2594%25A8%2F" target="_blank" title="https://jackeyzhe.github.io/2025/08/04/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%8A%B6%E6%80%81%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BA%94%E7%94%A8/" ref="nofollow noopener noreferrer">Flinkå­¦ä¹ ç¬”è®°ï¼šçŠ¶æ€ç±»å‹å’Œåº”ç”¨</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F08%2F24%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E7%258A%25B6%25E6%2580%2581%25E5%2590%258E%25E7%25AB%25AF%2F" target="_blank" title="https://jackeyzhe.github.io/2025/08/24/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%8A%B6%E6%80%81%E5%90%8E%E7%AB%AF/" ref="nofollow noopener noreferrer">Flinkå­¦ä¹ ç¬”è®°ï¼šçŠ¶æ€åç«¯</a>è¿™ä¸¤ç¯‡æ–‡ç« ï¼Œä¸ºäº†æ–¹é¢é˜…è¯»ï¼Œè¿™é‡Œæˆ‘ä»¬å†ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h4 data-id="heading-1">State ä½¿ç”¨</h4>
<p>State æ˜¯ Flink åšå¤æ‚é€»è¾‘æ‰€ä¾èµ–çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒçš„åˆ†ç±»å¦‚ä¸‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ad090ad897d49c6960c91af4f4dfcea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843950&amp;x-signature=CCLUmR20a58UhW88Y03xyDuUTDA%3D" alt="State åˆ†ç±»" loading="lazy"/></p>
<p>å¸¸è§çš„æ˜¯ Keyed State å’Œ Operator Stateï¼ŒKeyed State ä½œç”¨äº KeyedStream ä¸Šï¼ŒOperator State å¯ä»¥ä½œç”¨äºæ‰€æœ‰çš„ Operator ä¸Šã€‚Keyed State ä½¿ç”¨æ—¶ï¼Œéœ€è¦å…ˆåˆ›å»º StateDescriptorï¼Œç„¶åå†è°ƒç”¨ getState è·å–ã€‚</p>
<pre><code class="hljs language-java" lang="java">ValueStateDescriptor&lt;Tuple2&lt;Long, Long&gt;&gt; descriptor =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;&gt;(
                <span class="hljs-string">"average"</span>,
                TypeInformation.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHint</span>&lt;Tuple2&lt;Long, Long&gt;&gt;() {}));
ValueState&lt;Tuple2&lt;Long, Long&gt;&gt; sum = getRuntimeContext().getState(descriptor);
</code></pre>
<p>Opeartor State çš„è·å–æ–¹å¼ä¸ Keyed State ç±»ä¼¼ï¼Œéƒ½éœ€è¦ StateDescriptorã€‚Operator State åœ¨å®šä¹‰æ—¶éœ€è¦å®ç° CheckpointedFunctionã€‚</p>
<h4 data-id="heading-2">State å­˜å‚¨</h4>
<p>State Backend ç”¨æ¥ç®¡ç† State å­˜å‚¨ï¼Œæ ¹æ®å­˜å‚¨æ ¼å¼å’Œå­˜å‚¨ç±»å‹çš„ç»„åˆï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ol>
<li>
<p>MemoryStateBackendï¼šHashMapStateBackend å’Œ JobManagerCheckpointStorage çš„ç»„åˆï¼Œå³å°† State ä»¥ Java å¯¹è±¡çš„å½¢å¼å­˜å‚¨åœ¨ JobManager å†…å­˜ä¸­ã€‚</p>
</li>
<li>
<p>FsStateBackendï¼šHashMapStateBackend å’Œ FileSystemCheckpointStorage çš„ç»„åˆï¼Œå°† State ä»¥ Java å¯¹è±¡çš„å½¢å¼å­˜å‚¨åœ¨è¿œç«¯æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p>
</li>
<li>
<p>RocksDBStateBackendï¼šEmbeddedRocksDBStateBackend å’Œ FileSystemCheckpointStorage çš„ç»„åˆï¼ŒState åºåˆ—åŒ–åå­˜å‚¨åœ¨ RocksDBã€‚</p>
</li>
</ol>
<h3 data-id="heading-3">åˆ›å»º State Backend</h3>
<p>åˆ›å»º State Backend çš„å…¥å£åœ¨ StreamTaskï¼ŒStreamTask æ˜¯ Flink éƒ¨ç½²å’Œè¿è¡Œåœ¨ TaskManager çš„åŸºæœ¬å•å…ƒã€‚</p>
<p>åœ¨ StreamTask çš„ invoke æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ restoreStateAndGates æ–¹æ³•å»åˆ›å»º State Backendã€‚å®Œæ•´çš„è°ƒç”¨é“¾è·¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69608e44b8314186b748a766bb8eef6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843950&amp;x-signature=BVoarsKFnzdP%2BJASPW8XWtPuIoo%3D" alt="stateBackend" loading="lazy"/></p>
<p>åœ¨ streamOperatorStateContext æ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è°ƒç”¨äº† keyedStatedBackend å’Œ operatorStateBackend æ¥åˆ›å»ºä¸¤ç§ State Backendã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ keyedStateBackend çš„é€»è¾‘ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> &lt;K, R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Disposable</span> &amp; Closeable&gt; R <span class="hljs-title function_">keyedStatedBackend</span><span class="hljs-params">(
        TypeSerializer&lt;K&gt; keySerializer,
        String operatorIdentifierText,
        PrioritizedOperatorSubtaskState prioritizedOperatorSubtaskStates,
        CloseableRegistry backendCloseableRegistry,
        MetricGroup metricGroup,
        <span class="hljs-type">double</span> managedMemoryFraction,
        StateObject.StateObjectSizeStatsCollector statsCollector,
        KeyedStateBackendCreator&lt;K, R&gt; keyedStateBackendCreator)</span>
        <span class="hljs-keyword">throws</span> Exception {

    <span class="hljs-keyword">if</span> (keySerializer == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    ......

    <span class="hljs-keyword">final</span> <span class="hljs-type">KeyGroupRange</span> <span class="hljs-variable">keyGroupRange</span> <span class="hljs-operator">=</span>
            KeyGroupRangeAssignment.computeKeyGroupRangeForOperatorIndex(
                    taskInfo.getMaxNumberOfParallelSubtasks(),
                    taskInfo.getNumberOfParallelSubtasks(),
                    taskInfo.getIndexOfThisSubtask());

    <span class="hljs-comment">// Now restore processing is included in backend building/constructing process, so we need</span>
    <span class="hljs-comment">// to make sure</span>
    <span class="hljs-comment">// each stream constructed in restore could also be closed in case of task cancel, for</span>
    <span class="hljs-comment">// example the data</span>
    <span class="hljs-comment">// input stream opened for serDe during restore.</span>
    <span class="hljs-type">CloseableRegistry</span> <span class="hljs-variable">cancelStreamRegistryForRestore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloseableRegistry</span>();
    backendCloseableRegistry.registerCloseable(cancelStreamRegistryForRestore);
    BackendRestorerProcedure&lt;R, KeyedStateHandle&gt; backendRestorer =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BackendRestorerProcedure</span>&lt;&gt;(
                    (stateHandles) -&gt; {
                        KeyedStateBackendParametersImpl&lt;K&gt; parameters =
                                <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyedStateBackendParametersImpl</span>&lt;&gt;(...);
                        <span class="hljs-keyword">return</span> keyedStateBackendCreator.create(...),
                                parameters);
                    },
                    backendCloseableRegistry,
                    logDescription);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> backendRestorer.createAndRestore(
                prioritizedOperatorSubtaskStates.getPrioritizedManagedKeyedState(),
                statsCollector);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (backendCloseableRegistry.unregisterCloseable(cancelStreamRegistryForRestore)) {
            IOUtils.closeQuietly(cancelStreamRegistryForRestore);
        }
    }
}
</code></pre>
<p>è¿™é‡Œçš„åˆ›å»ºè¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå…ˆæ˜¯è·å– KeyGroupRangeï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯å½“å‰ Operator ä¸Šå¤„ç†çš„ key çš„èŒƒå›´ã€‚ç„¶åå°±æ˜¯åˆ›å»º StateBackend å®ä¾‹ï¼Œè¿™é‡Œé€šè¿‡ BackendRestorerProcedure å°è£…ç»Ÿä¸€çš„æ¢å¤ã€å¼‚å¸¸å¤„ç†å’Œèµ„æºæ¸…ç†é€»è¾‘ã€‚operatorStateBackend æ–¹æ³•çš„é€»è¾‘ç›¸æ¯”è¾ƒæ¥è¯´ï¼Œåªæ˜¯å°‘äº† KeyGroupRange çš„å¤„ç†ï¼Œç›´æ¥åˆ›å»º StateBackend å®ä¾‹ã€‚</p>
<h3 data-id="heading-4">åˆ›å»ºå’Œä½¿ç”¨ State</h3>
<h4 data-id="heading-5">åˆ›å»º KeyedState</h4>
<p>KeyedState æ˜¯é€šè¿‡è°ƒç”¨ StreamingRuntimeContext.getState æ–¹æ³•è·å–çš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹å®Œæ•´çš„è°ƒç”¨æµç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9fcfec7f0c14599b878274c903f8105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843950&amp;x-signature=e4sko2oJgvXk7%2BBo4jNViJQjnUY%3D" alt="getState" loading="lazy"/></p>
<p>åœ¨è°ƒç”¨ getState è¿™äº›æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ keyedStateStore æä¾›çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ Flink æä¾›çš„ä¸€ä¸ªå°è£… keyedStateBackend çš„æ¥å£ã€‚è°ƒç”¨æµç¨‹çš„æœ€åï¼Œæ˜¯è°ƒç”¨ keyedStateBackend ä¸­çš„ createOrUpdateInternalState æ–¹æ³•ï¼ˆè¿™é‡Œæˆ‘ä»¬ä»¥ HeapStateBackend ä¸ºä¾‹ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> &lt;N, SV, SEV, S <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span>, IS <span class="hljs-keyword">extends</span> <span class="hljs-title class_">S</span>&gt; IS <span class="hljs-title function_">createOrUpdateInternalState</span><span class="hljs-params">(
        <span class="hljs-meta">@Nonnull</span> TypeSerializer&lt;N&gt; namespaceSerializer,
        <span class="hljs-meta">@Nonnull</span> StateDescriptor&lt;S, SV&gt; stateDesc,
        <span class="hljs-meta">@Nonnull</span> StateSnapshotTransformFactory&lt;SEV&gt; snapshotTransformFactory,
        <span class="hljs-type">boolean</span> allowFutureMetadataUpdates)</span>
        <span class="hljs-keyword">throws</span> Exception {
    StateTable&lt;K, N, SV&gt; stateTable =
            tryRegisterStateTable(
                    namespaceSerializer,
                    stateDesc,
                    getStateSnapshotTransformFactory(stateDesc, snapshotTransformFactory),
                    allowFutureMetadataUpdates);

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-type">IS</span> <span class="hljs-variable">createdState</span> <span class="hljs-operator">=</span> (IS) createdKVStates.get(stateDesc.getName());
    <span class="hljs-keyword">if</span> (createdState == <span class="hljs-literal">null</span>) {
        <span class="hljs-type">StateCreateFactory</span> <span class="hljs-variable">stateCreateFactory</span> <span class="hljs-operator">=</span> STATE_CREATE_FACTORIES.get(stateDesc.getType());
        <span class="hljs-keyword">if</span> (stateCreateFactory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlinkRuntimeException</span>(stateNotSupportedMessage(stateDesc));
        }
        createdState =
                stateCreateFactory.createState(stateDesc, stateTable, getKeySerializer());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">StateUpdateFactory</span> <span class="hljs-variable">stateUpdateFactory</span> <span class="hljs-operator">=</span> STATE_UPDATE_FACTORIES.get(stateDesc.getType());
        <span class="hljs-keyword">if</span> (stateUpdateFactory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlinkRuntimeException</span>(stateNotSupportedMessage(stateDesc));
        }
        createdState = stateUpdateFactory.updateState(stateDesc, stateTable, createdState);
    }

    createdKVStates.put(stateDesc.getName(), createdState);
    <span class="hljs-keyword">return</span> createdState;
}


<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;StateDescriptor.Type, StateCreateFactory&gt; STATE_CREATE_FACTORIES =
        Stream.of(
                        Tuple2.of(
                                StateDescriptor.Type.VALUE,
                                (StateCreateFactory) HeapValueState::create),
                        Tuple2.of(
                                StateDescriptor.Type.LIST,
                                (StateCreateFactory) HeapListState::create),
                        Tuple2.of(
                                StateDescriptor.Type.MAP,
                                (StateCreateFactory) HeapMapState::create),
                        Tuple2.of(
                                StateDescriptor.Type.AGGREGATING,
                                (StateCreateFactory) HeapAggregatingState::create),
                        Tuple2.of(
                                StateDescriptor.Type.REDUCING,
                                (StateCreateFactory) HeapReducingState::create))
                .collect(Collectors.toMap(t -&gt; t.f0, t -&gt; t.f1));
</code></pre>
<p>è¿™é‡Œé¦–å…ˆæ˜¯æ³¨å†Œäº†ä¸€ä¸ª StateTableï¼Œè¿™ä¸ªæ˜¯ State ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æˆå‘˜å˜é‡ï¼Œå®ƒå†…éƒ¨æ˜¯ä¸€ä¸ªç±»ä¼¼ Map çš„ç»“æ„ï¼Œç”¨æ¥ä¿å­˜ key å’Œ key çš„çŠ¶æ€ã€‚</p>
<p>STATE_CREATE_FACTORIES è¿™ä¸ªå˜é‡ä¿å­˜äº†ä¸åŒç±»å‹çš„ State å’Œå®ƒå¯¹åº”çš„åˆ›å»ºæ–¹æ³•ï¼ŒåŒç† STATE_UPDATE_FACTORIES ä¿å­˜çš„æ˜¯ä¸åŒ State å¯¹åº”çš„ æ›´æ–°æ–¹æ³•ã€‚</p>
<h4 data-id="heading-6">åˆ›å»º OperatorState</h4>
<p>çœ‹å®Œäº† KeyedState çš„åˆ›å»ºè¿‡ç¨‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ OperatorState çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<p>OperatorState çš„åˆ›å»ºæ–¹æ³•æ˜¯é€šè¿‡ FunctionInitializationContext å…ˆè·å–åˆ° OperatorStateStoreï¼Œå®ƒä¸ KeyedStateStore ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ StateBackend çš„æ–¹æ³•è¿›è¡Œäº†å°è£…ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeState</span><span class="hljs-params">(FunctionInitializationContext context)</span> <span class="hljs-keyword">throws</span> Exception {
    ListStateDescriptor&lt;Tuple2&lt;String, Integer&gt;&gt; descriptor =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListStateDescriptor</span>&lt;&gt;(
                    <span class="hljs-string">"buffered-elements"</span>,
                    TypeInformation.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHint</span>&lt;Tuple2&lt;String, Integer&gt;&gt;() {}));

    checkpointedState = context.getOperatorStateStore().getListState(descriptor);

    <span class="hljs-keyword">if</span> (context.isRestored()) {
        <span class="hljs-keyword">for</span> (Tuple2&lt;String, Integer&gt; element : checkpointedState.get()) {
            bufferedElements.add(element);
        }
    }
}
</code></pre>
<p>OperatorStateStore çš„ getListState æ–¹æ³•ä¸­ï¼Œç›´æ¥åˆ›å»ºå‡ºäº† PartitionableListStateï¼ŒåŒæ—¶ä¹Ÿåšäº†ä¸€äº›ç¼“å­˜æ“ä½œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> &lt;S&gt; ListState&lt;S&gt; <span class="hljs-title function_">getListState</span><span class="hljs-params">(
        ListStateDescriptor&lt;S&gt; stateDescriptor, OperatorStateHandle.Mode mode)</span>
        <span class="hljs-keyword">throws</span> StateMigrationException {

    ......
    PartitionableListState&lt;S&gt; partitionableListState =
            (PartitionableListState&lt;S&gt;) registeredOperatorStates.get(name);

    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == partitionableListState) {
        <span class="hljs-comment">// no restored state for the state name; simply create new state holder</span>

        partitionableListState =
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PartitionableListState</span>&lt;&gt;(
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegisteredOperatorStateBackendMetaInfo</span>&lt;&gt;(
                                name, partitionStateSerializer, mode));

        registeredOperatorStates.put(name, partitionableListState);
    } <span class="hljs-keyword">else</span> {
        ......
    }

    accessedStatesByName.put(name, partitionableListState);
    <span class="hljs-keyword">return</span> partitionableListState;
}
</code></pre>
<p>PartitionableListState å†…éƒ¨æœ‰ä¸€ä¸ª ArrayList ç”¨äºä¿å­˜æ•°æ®ã€‚</p>
<h4 data-id="heading-7">ä½¿ç”¨ KeyedState</h4>
<p>äº†è§£å®Œ State çš„åˆ›å»ºä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ State çš„ä½¿ç”¨äº†ã€‚æˆ‘ä»¬ä»¥ HeapValueState ä¸ºä¾‹æ¥çœ‹å¦‚ä½•è·å– Stateã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// HeapValueState ç±»</span>
<span class="hljs-keyword">public</span> V <span class="hljs-title function_">value</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">V</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stateTable.get(currentNamespace);

    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> getDefaultValue();
    }

    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>åœ¨ HeapValueState ç±»çš„ value æ–¹æ³•ä¸­ï¼Œç›´æ¥è°ƒç”¨ StateTable çš„ get æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ CopyOnWriteStateMap çš„ get æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ HashMap çš„ get æ–¹æ³•æ¯”è¾ƒç±»ä¼¼ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> S <span class="hljs-title function_">get</span><span class="hljs-params">(K key, N namespace)</span> {

    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> computeHashForOperationAndDoIncrementalRehash(key, namespace);
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">requiredVersion</span> <span class="hljs-operator">=</span> highestRequiredSnapshotVersion;
    <span class="hljs-keyword">final</span> StateMapEntry&lt;K, N, S&gt;[] tab = selectActiveTable(hash);
    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> hash &amp; (tab.length - <span class="hljs-number">1</span>);

    <span class="hljs-keyword">for</span> (StateMapEntry&lt;K, N, S&gt; e = tab[index]; e != <span class="hljs-literal">null</span>; e = e.next) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">K</span> <span class="hljs-variable">eKey</span> <span class="hljs-operator">=</span> e.key;
        <span class="hljs-keyword">final</span> <span class="hljs-type">N</span> <span class="hljs-variable">eNamespace</span> <span class="hljs-operator">=</span> e.namespace;
        <span class="hljs-keyword">if</span> ((e.hash == hash &amp;&amp; key.equals(eKey) &amp;&amp; namespace.equals(eNamespace))) {

            <span class="hljs-comment">// copy-on-write check for state</span>
            <span class="hljs-keyword">if</span> (e.stateVersion &lt; requiredVersion) {
                <span class="hljs-comment">// copy-on-write check for entry</span>
                <span class="hljs-keyword">if</span> (e.entryVersion &lt; requiredVersion) {
                    e = handleChainedEntryCopyOnWrite(tab, hash &amp; (tab.length - <span class="hljs-number">1</span>), e);
                }
                e.stateVersion = stateMapVersion;
                e.state = getStateSerializer().copy(e.state);
            }

            <span class="hljs-keyword">return</span> e.state;
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-8">ä½¿ç”¨ OperatorState</h4>
<p>OperatorState åº•å±‚ä½¿ç”¨çš„æ˜¯ PartitionableListStateï¼Œå‰é¢ä¹Ÿæåˆ°äº†ï¼Œå®ƒçš„å†…éƒ¨ç”¨äº†ä¸€ä¸ª ArrayList æ¥ä¿å­˜æ•°æ®ï¼Œå¯¹äº OperatorState çš„å„ç§æ“ä½œä¹Ÿéƒ½æ˜¯æ¥æ“ä½œè¿™ä¸ª ArrayListã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
    internalList.clear();
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Iterable&lt;S&gt; <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> internalList;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(S value)</span> {
    Preconditions.checkNotNull(value, <span class="hljs-string">"You cannot add null to a ListState."</span>);
    internalList.add(value);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(List&lt;S&gt; values)</span> {
    internalList.clear();

    addAll(values);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(List&lt;S&gt; values)</span> {
    Preconditions.checkNotNull(values, <span class="hljs-string">"List of values to add cannot be null."</span>);
    <span class="hljs-keyword">if</span> (!values.isEmpty()) {
        <span class="hljs-keyword">for</span> (S value : values) {
            checkNotNull(value, <span class="hljs-string">"Any value to add to a list cannot be null."</span>);
            add(value);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>æœ¬æ–‡å¯¹ State çš„ç›¸å…³ä»£ç è¿›è¡Œäº†æ¢³ç†ã€‚åŒ…æ‹¬ StateBackend çš„åˆ›å»ºï¼ŒKeyedState å’Œ OperatorState çš„åˆ›å»ºå’Œä½¿ç”¨ã€‚State å’Œ Checkpoint ä¸¤è€…éœ€è¦ç»“åˆä½¿ç”¨ï¼Œå› æ­¤åé¢æˆ‘ä»¬ä¼šå†æ¢³ç† Checkpoint çš„ç›¸å…³ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java çš„é‡‘é¢è®¡ç®—ç”¨ long è¿˜æ˜¯ BigDecimalï¼Ÿèµ„æ·±ç¨‹åºå‘˜è¿™æ ·é€‰]]></title>    <link>https://juejin.cn/post/7585485074038554630</link>    <guid>https://juejin.cn/post/7585485074038554630</guid>    <pubDate>2025-12-21T02:42:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038554630" data-draft-id="7577705544875589670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java çš„é‡‘é¢è®¡ç®—ç”¨ long è¿˜æ˜¯ BigDecimalï¼Ÿèµ„æ·±ç¨‹åºå‘˜è¿™æ ·é€‰"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-21T02:42:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java çš„é‡‘é¢è®¡ç®—ç”¨ long è¿˜æ˜¯ BigDecimalï¼Ÿèµ„æ·±ç¨‹åºå‘˜è¿™æ ·é€‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:42:38.000Z" title="Sun Dec 21 2025 02:42:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>æœ€è¿‘æ¥è§¦ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå‘ç°ç³»ç»Ÿä¸­æ‰€æœ‰é‡‘é¢ç›¸å…³å­—æ®µéƒ½ä½¿ç”¨<code>long</code>ç±»å‹æ¥è¡¨ç¤ºã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªä¹ æƒ¯ä½¿ç”¨<code>BigDecimal</code>å¤„ç†é‡‘é¢çš„å¼€å‘è€…ï¼Œè¿™è®©æˆ‘äº§ç”Ÿäº†ç–‘æƒ‘ï¼šè¿™ä¼šä¸ä¼šæœ‰ç²¾åº¦é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ</p>
<p>â€œç”¨<code>double</code>ä¸è¡Œå—ï¼Ÿå®ƒä¹Ÿèƒ½è¡¨ç¤ºå°æ•°å•Šï¼â€</p>
<p>ç»è¿‡ä¸€ç•ªç ”ç©¶å’Œæ€è€ƒï¼ŒæŠŠæœ€ç»ˆå¾—å‡ºçš„ç»“è®ºæ¥å’Œå¤§å®¶è¯¦ç»†åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€doubleã€floatç±»å‹æ¯”è¾ƒ</h3>
<p><code>double</code>å’Œ<code>float</code>éƒ½æ˜¯Javaä¸­çš„æµ®ç‚¹æ•°ç±»å‹ï¼Œå®ƒä»¬é‡‡ç”¨IEEE 754æ ‡å‡†æ¥è¡¨ç¤ºå°æ•°ã€‚</p>
<p>è¿™ç§è¡¨ç¤ºæ–¹æ³•ç±»ä¼¼äºç§‘å­¦è®¡æ•°æ³•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªè‡´å‘½é—®é¢˜ï¼š<strong>ä¸æ˜¯æ‰€æœ‰å°æ•°éƒ½èƒ½ç²¾ç¡®è¡¨ç¤º</strong>ã€‚</p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">double</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span>;
<span class="hljs-type">double</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span>;
<span class="hljs-type">double</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> a + b;
System.out.println(result); 
<span class="hljs-comment">// è¾“å‡ºï¼š0.30000000000000004</span>
</code></pre>
<p>ä»€ä¹ˆï¼Ÿç®€å•çš„0.1 + 0.2å±…ç„¶ä¸ç­‰äº0.3ï¼Ÿ</p>
<p>æ˜¯çš„ï¼Œè¿™æ˜¯å› ä¸ºåœ¨äºŒè¿›åˆ¶çš„è®¡ç®—ä¸­ï¼Œæœ‰äº›åè¿›åˆ¶å°æ•°æ²¡æœ‰åŠæ³•ç²¾ç¡®è¡¨ç¤ºï¼Œå°±åƒ1é™¤ä»¥3ä¸€æ ·ï¼Œåœ¨åè¿›åˆ¶ä¸­ä¹Ÿä¸èƒ½ç²¾ç¡®è¡¨ç¤ºï¼ˆ0.33333...ï¼‰ã€‚</p>
<h3 data-id="heading-2">äºŒã€BigDecimal è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-3">BigDecimalçš„æ­£ç¡®ç”¨æ³•</h4>
<p><code>BigDecimal</code>å¯ä»¥è§£å†³ç²¾åº¦é—®é¢˜ï¼Œä½†å¿…é¡»æ­£ç¡®ä½¿ç”¨ã€‚</p>
<p><strong>é”™è¯¯çš„æ„é€ æ–¹å¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">wrong1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.1</span>); 
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">wrong2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.2</span>);
</code></pre>
<p>è¿™ç§ä¼ å…¥æµ®ç‚¹å‹çš„æ„é€ æ–¹å¼è¿˜æ˜¯ä¼šæœ‰ç²¾åº¦é—®é¢˜ã€‚</p>
<p><strong>æ­£ç¡®çš„æ„é€ æ–¹å¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">correct1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.1"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">correct2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.2"</span>);
System.out.println(<span class="hljs-string">"æ­£ç¡®æ–¹å¼: "</span> + correct1.add(correct2)); <span class="hljs-comment">// 0.3</span>
</code></pre>
<p>é€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²è¿›è¡Œæ„é€ ã€‚</p>
<p><strong>æˆ–è€…ç”¨valueOfï¼ˆå†…éƒ¨ä¹Ÿæ˜¯è½¬å­—ç¬¦ä¸²ï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">safe1</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(<span class="hljs-number">0.1</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">safe2</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(<span class="hljs-number">0.2</span>);
System.out.println(<span class="hljs-string">"å®‰å…¨æ–¹å¼: "</span> + safe1.add(safe2)); <span class="hljs-comment">// 0.3</span>
</code></pre>
<h4 data-id="heading-4">BigDecimalçš„è¿ç®—è§„åˆ™</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDecimalOperations</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"19.99"</span>);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">quantity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"3"</span>);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">taxRate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.13"</span>);
        
        <span class="hljs-comment">// ä¹˜æ³•</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">subtotal</span> <span class="hljs-operator">=</span> price.multiply(quantity);
        
        <span class="hljs-comment">// é™¤æ³•å¿…é¡»æŒ‡å®šç²¾åº¦å’Œèˆå…¥æ¨¡å¼</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">tax</span> <span class="hljs-operator">=</span> subtotal.multiply(taxRate)
                               .setScale(<span class="hljs-number">2</span>, RoundingMode.HALF_UP);
        
        <span class="hljs-comment">// åŠ æ³•</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> subtotal.add(tax);
        
        System.out.println(<span class="hljs-string">"å°è®¡: "</span> + subtotal); <span class="hljs-comment">// 59.97</span>
        System.out.println(<span class="hljs-string">"ç¨é‡‘: "</span> + tax);      <span class="hljs-comment">// 7.80</span>
        System.out.println(<span class="hljs-string">"æ€»è®¡: "</span> + total);    <span class="hljs-comment">// 67.77</span>
    }
}
</code></pre>
<h4 data-id="heading-5">BigDecimalçš„æ¯”è¾ƒæ“ä½œ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDecimalComparison</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.00"</span>);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.000"</span>);
        
        <span class="hljs-comment">// é”™è¯¯ï¼šæ¯”è¾ƒå¼•ç”¨</span>
        System.out.println(<span class="hljs-string">"== æ¯”è¾ƒ: "</span> + (num1 == num2)); <span class="hljs-comment">// false</span>
        
        <span class="hljs-comment">// é”™è¯¯ï¼šequalsä¼šæ¯”è¾ƒç²¾åº¦</span>
        System.out.println(<span class="hljs-string">"equalsæ¯”è¾ƒ: "</span> + num1.equals(num2)); <span class="hljs-comment">// false</span>
        
        <span class="hljs-comment">// æ­£ç¡®ï¼šcompareToåªæ¯”è¾ƒæ•°å€¼</span>
        System.out.println(<span class="hljs-string">"compareToæ¯”è¾ƒ: "</span> + (num1.compareTo(num2) == <span class="hljs-number">0</span>)); <span class="hljs-comment">// true</span>
    }
}
</code></pre>
<h4 data-id="heading-6">BigDecimalçš„ç¼ºç‚¹</h4>
<ol>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šå¯¹è±¡åˆ›å»ºå’Œè¿ç®—æˆæœ¬é«˜</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šæ¯ä¸ªå¯¹è±¡éœ€è¦20-30å­—èŠ‚</li>
<li><strong>ä½¿ç”¨å¤æ‚</strong>ï¼šå®¹æ˜“ç”¨é”™æ„é€ æ–¹æ³•å’Œè¿ç®—è§„åˆ™</li>
<li><strong>ä»£ç å†—é•¿</strong>ï¼šç®€å•çš„è¿ç®—ä¹Ÿéœ€è¦å¤šè¡Œä»£ç </li>
</ol>
<h3 data-id="heading-7">ä¸‰ã€longæ–¹æ¡ˆ</h3>
<h4 data-id="heading-8">æ ¸å¿ƒæ€æƒ³ï¼šä»¥åˆ†ä¸ºå•ä½å­˜å‚¨</h4>
<p>ä½¿ç”¨<code>long</code>è¡¨ç¤ºé‡‘é¢çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼šä¸ä»¥å…ƒä¸ºå•ä½ï¼Œè€Œä»¥æœ€å°è´§å¸å•ä½ï¼ˆåˆ†ï¼‰å­˜å‚¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongAmountDemo</span> {
    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šå…ƒè½¬åˆ†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">yuanToFen</span><span class="hljs-params">(<span class="hljs-type">double</span> yuan)</span> {
        <span class="hljs-keyword">return</span> Math.round(yuan * <span class="hljs-number">100</span>);
    }
    
    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šåˆ†è½¬å…ƒï¼ˆç”¨äºæ˜¾ç¤ºï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fenToYuanDisplay</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"Â¥%.2f"</span>, fen / <span class="hljs-number">100.0</span>);
    }
    
    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šåˆ†è½¬å…ƒï¼ˆç”¨äºè®¡ç®—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">fenToYuan</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> fen / <span class="hljs-number">100.0</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä»¥åˆ†ä¸ºå•ä½å­˜å‚¨æ‰€æœ‰é‡‘é¢</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> yuanToFen(<span class="hljs-number">19.99</span>);  <span class="hljs-comment">// 1999åˆ† = 19.99å…ƒ</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">quantity</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">taxRate</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;  <span class="hljs-comment">// 13% = 0.13ï¼Œè¿™é‡Œç”¨æ•´æ•°è¡¨ç¤ºç™¾åˆ†æ¯”</span>
        
        <span class="hljs-comment">// è®¡ç®—è¿‡ç¨‹å…¨éƒ¨ä½¿ç”¨æ•´æ•°è¿ç®—</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">subtotal</span> <span class="hljs-operator">=</span> price * quantity;                    <span class="hljs-comment">// 5997åˆ†</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">tax</span> <span class="hljs-operator">=</span> (subtotal * taxRate) / <span class="hljs-number">100</span>;               <span class="hljs-comment">// 780åˆ†</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> subtotal + tax;                         <span class="hljs-comment">// 6777åˆ†</span>
        
        System.out.println(<span class="hljs-string">"å°è®¡: "</span> + fenToYuanDisplay(subtotal)); <span class="hljs-comment">// Â¥59.97</span>
        System.out.println(<span class="hljs-string">"ç¨é‡‘: "</span> + fenToYuanDisplay(tax));      <span class="hljs-comment">// Â¥7.80</span>
        System.out.println(<span class="hljs-string">"æ€»è®¡: "</span> + fenToYuanDisplay(total));    <span class="hljs-comment">// Â¥67.77</span>
    }
}
</code></pre>
<h4 data-id="heading-9">longæ–¹æ¡ˆçš„ä¼˜åŠ¿</h4>
<p><strong>1.ç»å¯¹ç²¾ç¡®</strong>
æ•´æ•°è¿ç®—åœ¨è®¡ç®—æœºä¸­æ˜¯ç²¾ç¡®çš„ï¼Œä¸ä¼šå‡ºç°æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ã€‚</p>
<p><strong>2.æ€§èƒ½å“è¶Š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// longè¿ç®— - æœºå™¨æŒ‡ä»¤çº§åˆ«ï¼Œæå¿«</span>
<span class="hljs-type">long</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000L</span>, b = <span class="hljs-number">2000L</span>;
<span class="hljs-type">long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> a + b;

<span class="hljs-comment">// BigDecimalè¿ç®— - æ–¹æ³•è°ƒç”¨ï¼Œå¯¹è±¡åˆ›å»ºï¼Œè¾ƒæ…¢</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"20.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">result2</span> <span class="hljs-operator">=</span> c.add(d);
</code></pre>
<p><strong>3.å­˜å‚¨é«˜æ•ˆ</strong></p>
<ul>
<li><code>long</code>ï¼šå›ºå®š8å­—èŠ‚</li>
<li><code>BigDecimal</code>ï¼šå¯¹è±¡å¤´+æ•°å€¼ï¼Œé€šå¸¸20-30å­—èŠ‚</li>
</ul>
<p><strong>4.åºåˆ—åŒ–ç®€å•</strong>
åœ¨æ•°æ®åº“ã€JSONã€ç½‘ç»œä¼ è¾“ä¸­å¤„ç†æ›´ç®€å•ã€‚</p>
<h4 data-id="heading-10">å®é™…ä¸šåŠ¡åº”ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// è®¢å•é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> orderAmount;
    <span class="hljs-comment">// ä¼˜æƒ é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> discountAmount;
    <span class="hljs-comment">// å®ä»˜é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> actualAmount;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">calculateOrder</span><span class="hljs-params">(<span class="hljs-type">long</span> unitPrice, <span class="hljs-type">int</span> quantity, <span class="hljs-type">long</span> discountRate)</span> {
        <span class="hljs-comment">// è®¡ç®—è®¢å•é‡‘é¢</span>
        orderAmount = unitPrice * quantity;
        
        <span class="hljs-comment">// è®¡ç®—ä¼˜æƒ é‡‘é¢</span>
        discountAmount = (orderAmount * discountRate) / <span class="hljs-number">100</span>;
        
        <span class="hljs-comment">// è®¡ç®—å®ä»˜é‡‘é¢</span>
        actualAmount = orderAmount - discountAmount;
    }
    
    <span class="hljs-comment">// æ˜¾ç¤ºæ–¹æ³•</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDisplayAmount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"è®¢å•é‡‘é¢: %s, ä¼˜æƒ : %s, å®ä»˜: %s"</span>, 
            formatFen(orderAmount),
            formatFen(discountAmount),
            formatFen(actualAmount));
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatFen</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"Â¥%.2f"</span>, fen / <span class="hljs-number">100.0</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">å››ã€å„ç§æ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯</h3>
<h4 data-id="heading-12">double/floatï¼šç»å¯¹ä¸è¦ç”¨äºé‡‘é¢</h4>
<ul>
<li>ç§‘å­¦è®¡ç®—ã€å›¾å½¢å¤„ç†</li>
<li>ç»Ÿè®¡åˆ†æï¼ˆå…è®¸è¯¯å·®ï¼‰</li>
<li>ç‰©ç†æ¨¡æ‹Ÿ</li>
<li>ä¸é€‚ç”¨äºä»»ä½•é‡‘é¢è®¡ç®—</li>
</ul>
<h4 data-id="heading-13">BigDecimalï¼šå¤æ‚é‡‘èè®¡ç®—</h4>
<ul>
<li>é«˜ç²¾åº¦åˆ©ç‡ã€æ±‡ç‡è®¡ç®—</li>
<li>ç¨åŠ¡è®¡ç®—ï¼ˆéœ€è¦å¤æ‚å°æ•°è¿ç®—ï¼‰</li>
<li>é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿ</li>
<li>éœ€è¦ä»»æ„ç²¾åº¦çš„åœºæ™¯</li>
</ul>
<h4 data-id="heading-14">longï¼šå¤§å¤šæ•°ä¸šåŠ¡ç³»ç»Ÿ</h4>
<ul>
<li>ç”µå•†è®¢å•ç³»ç»Ÿ</li>
<li>æ”¯ä»˜ç³»ç»Ÿ</li>
<li>è´¦æˆ·ä½™é¢ç®¡ç†</li>
<li>ç§¯åˆ†ã€ä¼˜æƒ åˆ¸ç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-15">äº”ã€BigDecimalçš„æœ€ä½³å®è·µ</h3>
<p>å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨BigDecimalï¼Œè¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p>
<h4 data-id="heading-16">1. æ„é€ æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¨è</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.1"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(<span class="hljs-number">0.1</span>);  <span class="hljs-comment">// å†…éƒ¨è½¬å­—ç¬¦ä¸²</span>

<span class="hljs-comment">// é¿å…</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.1</span>);      <span class="hljs-comment">// ç²¾åº¦é—®é¢˜</span>
</code></pre>
<h4 data-id="heading-17">2. è¿ç®—æ§åˆ¶</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"3.00"</span>);

<span class="hljs-comment">// é™¤æ³•å¿…é¡»æŒ‡å®šç²¾åº¦</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> num1.divide(num2, <span class="hljs-number">4</span>, RoundingMode.HALF_UP);

<span class="hljs-comment">// ä¹˜æ³•å»ºè®®æ§åˆ¶ç²¾åº¦</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> num1.multiply(num2).setScale(<span class="hljs-number">2</span>, RoundingMode.HALF_UP);
</code></pre>
<h4 data-id="heading-18">3. æ•°å€¼æ¯”è¾ƒ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100.000"</span>);

<span class="hljs-comment">// æ­£ç¡®</span>
<span class="hljs-keyword">if</span> (amount1.compareTo(amount2) == <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// æ•°å€¼ç›¸ç­‰</span>
}

<span class="hljs-comment">// é”™è¯¯</span>
<span class="hljs-keyword">if</span> (amount1.equals(amount2)) {
    <span class="hljs-comment">// ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºç²¾åº¦ä¸åŒ</span>
}
</code></pre>
<h3 data-id="heading-19">å…­ã€longæ–¹æ¡ˆçš„å®æ–½å»ºè®®</h3>
<h4 data-id="heading-20">1. å»ºç«‹å·¥å…·ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyUtils</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MoneyUtils</span><span class="hljs-params">()</span> {} <span class="hljs-comment">// å·¥å…·ç±»ï¼Œé˜²æ­¢å®ä¾‹åŒ–</span>
    
    <span class="hljs-comment">// å…ƒè½¬åˆ†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">yuanToFen</span><span class="hljs-params">(<span class="hljs-type">double</span> yuan)</span> {
        <span class="hljs-keyword">return</span> Math.round(yuan * <span class="hljs-number">100</span>);
    }
    
    <span class="hljs-comment">// åˆ†è½¬å…ƒï¼ˆæ˜¾ç¤ºç”¨ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fenToDisplayYuan</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"Â¥%.2f"</span>, fen / <span class="hljs-number">100.0</span>);
    }
    
    <span class="hljs-comment">// åˆ†è½¬å…ƒï¼ˆè®¡ç®—ç”¨ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">fenToYuan</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> fen / <span class="hljs-number">100.0</span>;
    }
    
    <span class="hljs-comment">// é‡‘é¢åŠ æ³•ï¼ˆé˜²æ­¢æº¢å‡ºï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">long</span> amount1, <span class="hljs-type">long</span> amount2)</span> {
        <span class="hljs-keyword">return</span> Math.addExact(amount1, amount2);
    }
    
    <span class="hljs-comment">// é‡‘é¢ä¹˜æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">multiply</span><span class="hljs-params">(<span class="hljs-type">long</span> amount, <span class="hljs-type">int</span> multiplier)</span> {
        <span class="hljs-keyword">return</span> Math.multiplyExact(amount, multiplier);
    }
}
</code></pre>
<h4 data-id="heading-21">2. æ•°æ®åº“è®¾è®¡</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä½¿ç”¨bigintå­˜å‚¨é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    order_amount <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'è®¢å•é‡‘é¢ï¼ˆåˆ†ï¼‰'</span>,
    discount_amount <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'ä¼˜æƒ é‡‘é¢ï¼ˆåˆ†ï¼‰'</span>,
    actual_amount <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'å®ä»˜é‡‘é¢ï¼ˆåˆ†ï¼‰'</span>
);
</code></pre>
<h4 data-id="heading-22">3. APIè®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨Longç±»å‹è¡¨ç¤ºé‡‘é¢ï¼ˆåˆ†ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRequest</span> {
    <span class="hljs-keyword">private</span> Long productId;
    <span class="hljs-keyword">private</span> Integer quantity;
    <span class="hljs-keyword">private</span> Long unitPrice;  <span class="hljs-comment">// å•ä»·ï¼ˆåˆ†ï¼‰</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderResponse</span> {
    <span class="hljs-keyword">private</span> String orderNo;
    <span class="hljs-keyword">private</span> Long totalAmount;  <span class="hljs-comment">// æ€»é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> String displayAmount; <span class="hljs-comment">// æ˜¾ç¤ºé‡‘é¢ "Â¥99.99"</span>
}
</code></pre>
<h3 data-id="heading-23">æ€»ç»“ä¸é€‰æ‹©</h3>
<h4 data-id="heading-24">ä¸ºä»€ä¹ˆé‚£ä¸ªé¡¹ç›®é€‰æ‹©longï¼Ÿ</h4>
<p>ç°åœ¨æˆ‘å¯ä»¥ç†è§£é‚£ä¸ªé¡¹ç›®çš„è®¾è®¡æ€è·¯äº†ï¼š</p>
<ol>
<li><strong>ä¸šåŠ¡ç‰¹æ€§</strong>ï¼šä¸»è¦æ˜¯ç®€å•çš„åŠ å‡ä¹˜è¿ç®—ï¼Œæ²¡æœ‰å¤æ‚çš„å°æ•°é™¤æ³•</li>
<li><strong>æ€§èƒ½è¦æ±‚</strong>ï¼šé«˜å¹¶å‘åœºæ™¯ï¼Œéœ€è¦æœ€ä¼˜æ€§èƒ½</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šç»Ÿä¸€è§„èŒƒï¼Œé¿å…BigDecimalçš„è¯¯ç”¨</li>
<li><strong>ç³»ç»Ÿå¤æ‚åº¦</strong>ï¼šé™ä½ç³»ç»Ÿå¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬</li>
</ol>
<h4 data-id="heading-25">å¦‚ä½•é€‰æ‹©ï¼Ÿ</h4>



































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>ç®€å•ä¸šåŠ¡ç³»ç»Ÿ</td><td><strong>long</strong></td><td>æ€§èƒ½å¥½ï¼Œç®€å•å¯é </td></tr><tr><td>é“¶è¡Œé‡‘èç³»ç»Ÿ</td><td><strong>BigDecimal</strong></td><td>ç²¾åº¦è¦æ±‚æé«˜</td></tr><tr><td>é«˜å¹¶å‘äº¤æ˜“</td><td><strong>long</strong></td><td>æ€§èƒ½è‡³å…³é‡è¦</td></tr><tr><td>å¤æ‚ç¨åŠ¡è®¡ç®—</td><td><strong>BigDecimal</strong></td><td>éœ€è¦å¤æ‚å°æ•°è¿ç®—</td></tr><tr><td>æ–°é¡¹ç›®å¯åŠ¨</td><td><strong>long</strong></td><td>æŠ€æœ¯å€ºåŠ¡å°‘</td></tr></tbody></table>
<p>æŠ€æœ¯é€‰å‹ä»æ¥éƒ½ä¸æ˜¯å•ä¸€çš„ï¼Œç†è§£ä¸šåŠ¡çš„éœ€æ±‚ï¼Œèƒ½é€‰æ‹©å‡ºæœ€é€‚åˆçš„æŠ€æœ¯æ–¹æ¡ˆå°±æ˜¯æœ€å¥½çš„æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-26">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6V83qjR6u0nyfzL-14xYAw" target="_blank" title="https://mp.weixin.qq.com/s/6V83qjR6u0nyfzL-14xYAw" ref="nofollow noopener noreferrer">ã€Šasync/await åˆ°åº•è¦ä¸è¦åŠ  try-catchï¼Ÿå¼‚æ­¥é”™è¯¯å¤„ç†æœ€ä½³å®è·µã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPQ_w7CDVoIZPn-CVH2DKJg" target="_blank" title="https://mp.weixin.qq.com/s/PQ_w7CDVoIZPn-CVH2DKJg" ref="nofollow noopener noreferrer">ã€ŠVue3 å’Œ Vue2 çš„æ ¸å¿ƒåŒºåˆ«ï¼Ÿå¾ˆå¤šå¼€å‘è€…éƒ½æ²¡å®Œå…¨ææ‡‚çš„ 10 ä¸ªç»†èŠ‚ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">ã€ŠJava å¼€å‘å¿…çœ‹ï¼šä»€ä¹ˆæ—¶å€™ç”¨ forï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Streamï¼Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqI3TRTdDfRJSH9kCTqAQUw" target="_blank" title="https://mp.weixin.qq.com/s/qI3TRTdDfRJSH9kCTqAQUw" ref="nofollow noopener noreferrer">ã€Šè¿™ 10 ä¸ª MySQL é«˜çº§ç”¨æ³•ï¼Œè®©ä½ çš„ä»£ç åˆå¿«åˆå¥½çœ‹ã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript åˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰è¯¦è§£ï¼šå‰ç«¯é¢è¯•ä¸­å¦‚ä½•ä»é€’å½’ O(nÂ²) ä¼˜åŒ–åˆ°ä¸€æ¬¡éå† O(n)]]></title>    <link>https://juejin.cn/post/7585706951603716122</link>    <guid>https://juejin.cn/post/7585706951603716122</guid>    <pubDate>2025-12-21T02:53:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951603716122" data-draft-id="7585534343561822258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript åˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰è¯¦è§£ï¼šå‰ç«¯é¢è¯•ä¸­å¦‚ä½•ä»é€’å½’ O(nÂ²) ä¼˜åŒ–åˆ°ä¸€æ¬¡éå† O(n)"/> <meta itemprop="keywords" content="JavaScript,ç®—æ³•,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-21T02:53:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½å…°åœ°ç©ºç“¶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript åˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰è¯¦è§£ï¼šå‰ç«¯é¢è¯•ä¸­å¦‚ä½•ä»é€’å½’ O(nÂ²) ä¼˜åŒ–åˆ°ä¸€æ¬¡éå† O(n)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½å…°åœ°ç©ºç“¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:53:55.000Z" title="Sun Dec 21 2025 02:53:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šOffer æ˜¯æ€ä¹ˆæ²¡çš„ï¼Ÿ</h2>
<p>åœ¨å‰ç«¯é¢è¯•çš„æ±Ÿæ¹–é‡Œï¼Œ<strong>ã€Œåˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰ã€</strong> æ˜¯ä¸€é“å¦¥å¦¥çš„é«˜é¢‘é¢˜ã€‚</p>
<p>å¾ˆå¤šåŒå­¦ä¸€çœ‹åˆ°è¿™é“é¢˜ï¼Œå†…å¿ƒ OS éƒ½æ˜¯ï¼š</p>
<blockquote>
<p>ğŸ˜ã€Œç®€å•å•Šï¼Œé€’å½’ï¼ã€</p>
</blockquote>
<p>ä»£ç å†™å®Œï¼Œè‡ªä¿¡æŠ¬å¤´ã€‚<br/>
é¢è¯•å®˜å´æ…¢æ‚ æ‚ åœ°é—®äº†ä¸€å¥ï¼š</p>
<blockquote>
<p>ğŸ¤¨ã€Œå¦‚æœæ˜¯ <strong>10 ä¸‡æ¡æ•°æ®</strong> å‘¢ï¼Ÿ<br/>
ğŸ‘‰ æ—¶é—´å¤æ‚åº¦å¤šå°‘ï¼Ÿ<br/>
ğŸ‘‰ ä¼šä¸ä¼šæ ˆæº¢å‡ºï¼Ÿã€</p>
</blockquote>
<p><strong>ç©ºæ°”çªç„¶å®‰é™ã€‚</strong></p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æŠŠè¿™é“é¢˜å½»åº•æ‹†å¼€ï¼š<br/>
ä»ã€Œèƒ½å†™ã€åˆ°ã€Œå†™å¾—å¯¹ã€ï¼Œå†åˆ°ã€Œå†™å¾—æ¼‚äº®ã€ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆé¢è¯•å®˜æ€»ç›¯ç€è¿™æ£µâ€œæ ‘â€ï¼Ÿ</h2>
<p>å› ä¸ºåœ¨çœŸå®ä¸šåŠ¡ä¸­ï¼Œ<strong>åç«¯ç»™ä½ çš„å‡ ä¹æ°¸è¿œæ˜¯æ‰å¹³æ•°æ®</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">const</span> <span class="hljs-string">list</span> <span class="hljs-string">=</span> [
  { <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'åŒ—äº¬å¸‚'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'é¡ºä¹‰åŒº'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'æœé˜³åŒº'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">4</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'åæ²™å³ª'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">121</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'æ±Ÿè¥¿çœ'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">155</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">121</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'æŠšå·å¸‚'</span> }
]<span class="hljs-string">;</span>
</code></pre>
<p>è€Œå‰ç«¯ç»„ä»¶ï¼ˆMenuã€Treeã€Cascaderï¼‰è¦çš„å´æ˜¯ğŸ‘‡</p>
<pre><code class="hljs language-markdown" lang="markdown">çœ
 â””â”€ å¸‚
<span class="hljs-code">     â””â”€ åŒº
</span></code></pre>
<hr/>
<h3 data-id="heading-2">ğŸ¯ é¢è¯•å®˜çš„çœŸå®è€ƒç‚¹</h3>
<ul>
<li><strong>æ•°æ®ç»“æ„ç†è§£</strong>ï¼šæ˜¯å¦çœŸæ­£ç†è§£ <code>parentId</code></li>
<li><strong>é€’å½’æ„è¯† &amp; ä»£ä»·</strong>ï¼šä¸åªä¼šå†™ï¼Œè¿˜è¦çŸ¥é“å‘åœ¨å“ª</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–èƒ½åŠ›</strong>ï¼šèƒ½å¦ä» <code>O(nÂ²)</code> ä¼˜åŒ–åˆ° <code>O(n)</code></li>
<li><strong>JS å¼•ç”¨ç†è§£</strong>ï¼šæ˜¯å¦ç†è§£å¯¹è±¡åœ¨å†…å­˜ä¸­çš„è¡¨ç°</li>
</ul>
<hr/>
<h2 data-id="heading-3">äºŒã€ç¬¬ä¸€é‡å¢ƒç•Œï¼šé€’å½’æ³•ï¼ˆèƒ½å†™ï¼Œä½†ä¸ç¨³ï¼‰</h2>
<h3 data-id="heading-4">1ï¸âƒ£ æœ€åŸºç¡€çš„é€’å½’å†™æ³•</h3>
<pre><code class="hljs language-ini" lang="ini">function list2tree(list, <span class="hljs-attr">parentId</span> = <span class="hljs-number">0</span>) {
  return list
    .filter(<span class="hljs-attr">item</span> =&gt; item.parentId === parentId)
    .map(<span class="hljs-attr">item</span> =&gt; ({
      ...item,
      children: list2tree(list, item.id)
    }))<span class="hljs-comment">;</span>
}
</code></pre>
<p>é€»è¾‘éå¸¸ç›´è§‚ï¼š</p>
<ul>
<li>æ‰¾å½“å‰ <code>parentId</code> çš„æ‰€æœ‰å­èŠ‚ç‚¹</li>
<li>å¯¹æ¯ä¸ªå­èŠ‚ç‚¹ç»§ç»­é€’å½’</li>
<li>æ²¡æœ‰å­èŠ‚ç‚¹æ—¶è‡ªç„¶é€€å‡º</li>
</ul>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€è¿›é˜¶ï¼šES6 ä¼˜é›…å†™æ³•ï¼ˆçœ‹èµ·æ¥å¾ˆé«˜çº§ï¼‰</h2>
<p>å¦‚æœä½ åœ¨é¢è¯•ä¸­å†™å‡ºä¸‹é¢è¿™æ®µä»£ç ğŸ‘‡<br/>
<strong>é¢è¯•å®˜å¤§æ¦‚ç‡ä¼šå…ˆç‚¹å¤´ã€‚</strong></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">list2tree</span> = (list, parentId = <span class="hljs-number">0</span>) =&gt;
  list
    .filter(<span class="hljs-attr">item</span> =&gt; item.parentId === parentId)
    .map(<span class="hljs-attr">item</span> =&gt; ({
      ...item,              // è§£æ„èµ‹å€¼ï¼Œä¿æŒåŸå¯¹è±¡çº¯å‡€
      children: list2tree(list, item.id)
    }))<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸€ç‰ˆä»£ç ï¼š</p>
<ul>
<li>âœ… ç®­å¤´å‡½æ•°</li>
<li>âœ… <code>filter + map</code> é“¾å¼è°ƒç”¨</li>
<li>âœ… è§£æ„èµ‹å€¼ï¼Œä¸æ±¡æŸ“åŸæ•°æ®</li>
<li>âœ… å¯è¯»æ€§å¾ˆå¥½ï¼Œçœ‹èµ·æ¥å¾ˆâ€œES6â€</li>
</ul>
<p>ğŸ‘‰ <strong>å¾ˆå¤šåŒå­¦åˆ°è¿™ä¸€æ­¥å°±è§‰å¾—ç¨³äº†ã€‚</strong></p>
<hr/>
<h3 data-id="heading-6">ğŸ¤” é¢è¯•å®˜çš„ç»å…¸è¿½é—®</h3>
<blockquote>
<p>ã€Œè¿™ä¸ªæ–¹æ¡ˆï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿã€</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">ğŸ¯ æ ‡å‡†å›ç­”ï¼ˆä¸€å®šè¦è¯´å‡ºæ¥ï¼‰</h3>
<blockquote>
<p>ã€Œè¿™ä¸ªæ–¹æ¡ˆçš„æœ¬è´¨æ˜¯ <strong>åµŒå¥—å¾ªç¯</strong>ã€‚<br/>
æ¯ä¸€å±‚é€’å½’ï¼Œéƒ½ä¼šéå†ä¸€æ¬¡å®Œæ•´çš„ <code>list</code>ã€‚</p>
<p>ğŸ‘‰ æ—¶é—´å¤æ‚åº¦æ˜¯ <strong><code>O(nÂ²)</code></strong><br/>
ğŸ‘‰ å¦‚æœå±‚çº§è¿‡æ·±ï¼Œè¿˜å¯èƒ½å¯¼è‡´ <strong>æ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰</strong> ã€‚ã€</p>
</blockquote>
<p>ğŸ“Œ <strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š</p>
<blockquote>
<p>ES6 å†™æ³•åªæ˜¯â€œçœ‹èµ·æ¥ä¼˜é›…â€ï¼Œ<br/>
æ€§èƒ½é—®é¢˜ä¸ä¼šå› ä¸ºä»£ç å¥½çœ‹å°±è‡ªåŠ¨æ¶ˆå¤±ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">å››ã€ç¬¬äºŒé‡å¢ƒç•Œï¼šMap ä¼˜åŒ–ï¼ˆé¢è¯•åŠæ ¼çº¿ï¼‰</h2>
<p>æ—¢ç„¶æ…¢ï¼Œæ˜¯å› ä¸º<strong>åå¤éå†æ‰¾çˆ¶èŠ‚ç‚¹</strong>ï¼Œ<br/>
é‚£å°±ç”¨ <strong>Map å»ºç«‹ç´¢å¼•</strong>ã€‚</p>
<blockquote>
<p>ğŸ‘‰ å…¸å‹çš„ï¼š<strong>ç©ºé—´æ¢æ—¶é—´</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-9">æ ¸å¿ƒæ€è·¯</h3>
<ol>
<li>ç¬¬ä¸€éï¼šæŠŠæ‰€æœ‰èŠ‚ç‚¹æ”¾è¿› <code>Map</code></li>
<li>ç¬¬äºŒéï¼šé€šè¿‡ <code>parentId</code> ç›´æ¥æŒ‚è½½</li>
<li>åˆ©ç”¨ JS <strong>å¯¹è±¡å¼•ç”¨</strong>ï¼Œè‡ªåŠ¨åŒæ­¥æ ‘ç»“æ„</li>
</ol>
<hr/>
<h3 data-id="heading-10">ä»£ç å®ç°</h3>
<pre><code class="hljs language-ini" lang="ini">function listToTreeWithMap(list) {
  const <span class="hljs-attr">map</span> = new Map()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tree</span> = []<span class="hljs-comment">;</span>

  // åˆå§‹åŒ–
  for (const item of list) {
    map.set(item.id, { ...item, children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
  }

  // æ„å»ºæ ‘
  for (const item of list) {
    const <span class="hljs-attr">node</span> = map.get(item.id)<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">item.parentId</span> === <span class="hljs-number">0</span>) {
      tree.push(node)<span class="hljs-comment">;</span>
    } else {
      const <span class="hljs-attr">parent</span> = map.get(item.parentId)<span class="hljs-comment">;</span>
      parent &amp;&amp; parent.children.push(node)<span class="hljs-comment">;</span>
    }
  }

  return tree<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-11">â± å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n)</code></li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(n)</code></li>
</ul>
<p>ğŸ“Œ åˆ°è¿™ä¸€æ­¥ï¼Œ<strong>å·²ç»å¯ä»¥åº”ä»˜å¤§å¤šæ•°é¢è¯•</strong>äº†ã€‚</p>
<hr/>
<h2 data-id="heading-12">äº”ã€ç»ˆæå¥¥ä¹‰ï¼šä¸€æ¬¡éå† + å¼•ç”¨é­”æ³•ï¼ˆTop Tierï¼‰</h2>
<blockquote>
<p>é¢è¯•å®˜ï¼š<br/>
ã€Œèƒ½ä¸èƒ½åªéå†ä¸€æ¬¡ï¼Ÿã€</p>
</blockquote>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>èƒ½ï¼Œè€Œä¸”è¿™æ‰æ˜¯å¤©èŠ±æ¿è§£æ³•ã€‚</strong></p>
<hr/>
<h3 data-id="heading-13">æ ¸å¿ƒç²¾é«“ï¼šå ä½ + å¼•ç”¨åŒæ­¥</h3>
<ul>
<li>å­èŠ‚ç‚¹å¯èƒ½å…ˆäºçˆ¶èŠ‚ç‚¹å‡ºç°</li>
<li>å…ˆåœ¨ Map é‡Œç»™çˆ¶èŠ‚ç‚¹ <strong>å ä½</strong></li>
<li>åç»­å†è¡¥å…¨æ•°æ®</li>
<li>å¼•ç”¨åœ°å€å§‹ç»ˆä¸å˜ï¼Œæ ‘ä¼šâ€œè‡ªå·±é•¿å¥½â€</li>
</ul>
<hr/>
<h3 data-id="heading-14">ä»£ç å®ç°ï¼ˆä¸€æ¬¡éå†ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">function listToTreePerfect(list) {
  const <span class="hljs-attr">map</span> = new Map()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tree</span> = []<span class="hljs-comment">;</span>

  for (const item of list) {
    const { id, parentId } = item<span class="hljs-comment">;</span>

    if (!map.has(id)) {
      map.set(id, { children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
    }

    const <span class="hljs-attr">node</span> = map.get(id)<span class="hljs-comment">;</span>
    Object.assign(node, item)<span class="hljs-comment">;</span>

    if (<span class="hljs-attr">parentId</span> === <span class="hljs-number">0</span>) {
      tree.push(node)<span class="hljs-comment">;</span>
    } else {
      if (!map.has(parentId)) {
        map.set(parentId, { children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
      }
      map.get(parentId).children.push(node)<span class="hljs-comment">;</span>
    }
  }

  return tree<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-15">ğŸ† ä¸ºä»€ä¹ˆè¿™æ˜¯ç‹è€…è§£æ³•ï¼Ÿ</h3>
<ul>
<li>âœ… ä¸€æ¬¡éå†ï¼Œ<code>O(n)</code></li>
<li>âœ… æ”¯æŒä¹±åºæ•°æ®</li>
<li>âœ… æ·±åº¦ç†è§£ JS å¼•ç”¨æœºåˆ¶</li>
<li>âœ… é¢è¯•å®˜ä¸€çœ¼å°±æ‡‚ä½ æ˜¯â€œçœŸä¼šâ€</li>
</ul>
<hr/>
<h2 data-id="heading-16">å…­ã€çœŸå®å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯</h2>
<ul>
<li>ğŸ”¹ æƒé™ / èœå•æ ‘ï¼ˆAnt Design / Elementï¼‰</li>
<li>ğŸ”¹ çœå¸‚åŒº / Cascader</li>
<li>ğŸ”¹ æ–‡ä»¶ç›®å½•ç»“æ„ï¼ˆäº‘ç›˜ã€ç¼–è¾‘å™¨ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-17">ä¸ƒã€é¢è¯•æ€»ç»“ &amp; é¿å‘æŒ‡å—</h2>

























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>è¯„ä»·</th></tr></thead><tbody><tr><td>é€’å½’</td><td><code>O(nÂ²)</code></td><td>èƒ½å†™ï¼Œä½†å±é™©</td></tr><tr><td>Map ä¸¤æ¬¡éå†</td><td><code>O(n)</code></td><td>é¢è¯•åˆæ ¼</td></tr><tr><td>ä¸€æ¬¡éå†</td><td><code>O(n)</code></td><td>é¢è¯•åŠ åˆ†</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">é¢è¯•åŠ åˆ†è¡¨è¾¾</h3>
<ul>
<li>ä¸»åŠ¨æ <strong>ç©ºé—´æ¢æ—¶é—´</strong></li>
<li>ç‚¹å‡º <strong>JS å¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹</strong></li>
<li>è¯¢é—® <code>parentId</code> æ˜¯å¦å¯èƒ½ä¸º <code>null</code></li>
<li>è¯´æ˜æ˜¯å¦ä¼šä¿®æ”¹åŸæ•°æ®ï¼ˆå¿…è¦æ—¶æ·±æ‹·è´ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-19">ç»“è¯­</h2>
<blockquote>
<p>ç®—æ³•ä¸æ˜¯ä¸ºäº†ä¸ºéš¾äººï¼Œ<br/>
è€Œæ˜¯ä¸ºäº†åœ¨å¤æ‚ä¸šåŠ¡ä¸­ï¼Œ<br/>
<strong>é€‰å‡ºé‚£æ¡æœ€ç¨³ã€æœ€ä¼˜é›…çš„è·¯ã€‚</strong></p>
</blockquote>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ğŸ‘‡<br/>
ğŸ‘ ç‚¹ä¸ªèµ<br/>
ğŸ’¬ è¯„è®ºåŒºèŠèŠä½ åœ¨é¡¹ç›®é‡Œé‡åˆ°è¿‡çš„å¥‡è‘©æ•°æ®ç»“æ„</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹åŸç†å‰–æâ€”â€”ä»æŠ€æœ¯ç‰¹æ€§ã€åº•å±‚æ¶æ„åˆ°è½åœ°é€»è¾‘çš„å…¨ç»´åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7585484081436606515</link>    <guid>https://juejin.cn/post/7585484081436606515</guid>    <pubDate>2025-12-21T02:57:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585484081436606515" data-draft-id="7585463195202502706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹åŸç†å‰–æâ€”â€”ä»æŠ€æœ¯ç‰¹æ€§ã€åº•å±‚æ¶æ„åˆ°è½åœ°é€»è¾‘çš„å…¨ç»´åº¦è§£æ"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-21T02:57:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¾é†’"/> <meta itemprop="url" content="https://juejin.cn/user/708512558088669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹åŸç†å‰–æâ€”â€”ä»æŠ€æœ¯ç‰¹æ€§ã€åº•å±‚æ¶æ„åˆ°è½åœ°é€»è¾‘çš„å…¨ç»´åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/708512558088669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¾é†’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:57:17.000Z" title="Sun Dec 21 2025 02:57:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>è¿‘å¹´æ¥ï¼Œå¤§æ¨¡å‹ä»¥å…¶é¢ è¦†æ€§çš„æ™ºèƒ½è¡¨ç°å¸­å·æŠ€æœ¯é¢†åŸŸâ€”â€”ä»ç²¾å‡†çš„ä»£ç ç”Ÿæˆåˆ°è‡ªç„¶çš„å¤šè½®å¯¹è¯ï¼Œä»è·¨æ¨¡æ€çš„æ–‡ç”Ÿå›¾åˆ°å¤æ‚çš„é€»è¾‘æ¨ç†ï¼Œå…¶èƒŒåæ˜¯ä¸€å¥—èåˆ<strong>è§„æ¨¡ã€æ¶æ„ã€æ•°æ®ä¸è®­ç»ƒèŒƒå¼</strong>çš„æŠ€æœ¯ä½“ç³»ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒç‰¹æ€§ã€æ¶æ„åŸºç¡€ã€è¡Œä¸šç°çŠ¶åˆ°è½åœ°é€»è¾‘ï¼Œæ·±å…¥æ‹†è§£å¤§æ¨¡å‹çš„åº•å±‚è¿è¡ŒåŸç†ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å¤§æ¨¡å‹çš„æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§ï¼šâ€œå¤§â€ä¹‹å¤–çš„åº•å±‚é€»è¾‘</h2>
<p>å¤§æ¨¡å‹çš„â€œèƒ½åŠ›å£å’â€å¹¶éä»…æºäºâ€œå‚æ•°å¤šâ€ï¼Œè€Œæ˜¯å¤šç»´åº¦æŠ€æœ¯ç‰¹æ€§çš„ååŒä½œç”¨ï¼š</p>
<h3 data-id="heading-2">1. è¶…å¤§è§„æ¨¡å‚æ•°ä¸è‡ªç›‘ç£é¢„è®­ç»ƒï¼šé€šç”¨è§„å¾‹çš„â€œå­¦ä¹ åº•åº§â€</h3>
<ul>
<li><strong>å‚æ•°è§„æ¨¡çš„æŠ€æœ¯å®šä¹‰</strong>ï¼šå¤§æ¨¡å‹çš„â€œå¤§â€é€šå¸¸æŒ‡<strong>ç™¾äº¿çº§ä»¥ä¸Šçš„å¯è®­ç»ƒå‚æ•°</strong>ï¼ˆå¦‚GPT-3è¾¾1750äº¿å‚æ•°ï¼‰ï¼Œå¯¹åº”æ¨¡å‹ç»“æ„ä¸­Transformerçš„â€œç¼–ç å™¨/è§£ç å™¨å±‚æ•°â€â€œæ³¨æ„åŠ›å¤´æ•°â€â€œéšè—å±‚ç»´åº¦â€ç­‰ç»„ä»¶çš„è§„æ¨¡æ‰©å¼ ï¼ˆä¾‹å¦‚GPT-4çš„Transformerè§£ç å™¨å±‚æ•°è¶…è¿‡90å±‚ï¼‰ã€‚</li>
<li><strong>è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ ¸å¿ƒé€»è¾‘</strong>ï¼šæ¨¡å‹é€šè¿‡â€œæ— æ ‡æ³¨æ•°æ®çš„è‡ªæˆ‘å­¦ä¹ â€æŒæ¡é€šç”¨è¯­ä¹‰ï¼Œå…¸å‹ä»»åŠ¡åŒ…æ‹¬ï¼š
<ul>
<li><strong>æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMLMï¼‰</strong>ï¼šéšæœºé®ç›–æ–‡æœ¬ä¸­çš„éƒ¨åˆ†tokenï¼Œè®©æ¨¡å‹é¢„æµ‹è¢«é®ç›–å†…å®¹ï¼ˆBERTçš„æ ¸å¿ƒé¢„è®­ç»ƒä»»åŠ¡ï¼‰ï¼›</li>
<li><strong>ä¸‹ä¸€å¥é¢„æµ‹ï¼ˆNSPï¼‰</strong>ï¼šè®©æ¨¡å‹åˆ¤æ–­ä¸¤ä¸ªå¥å­æ˜¯å¦ä¸ºè¿ç»­çš„ä¸Šä¸‹æ–‡ï¼›</li>
<li><strong>è‡ªå›å½’è¯­è¨€å»ºæ¨¡</strong>ï¼šä»å·¦åˆ°å³é€tokené¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼ˆGPTç³»åˆ—çš„æ ¸å¿ƒä»»åŠ¡ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ•°æ®è§„æ¨¡çš„åŒ¹é…è¦æ±‚</strong>ï¼šé¢„è®­ç»ƒéœ€æŠ•å–‚<strong>ä¸‡äº¿çº§tokençš„é«˜è´¨é‡æ•°æ®</strong>ï¼ˆæ¶µç›–æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰ï¼‰ï¼Œæ•°æ®çš„å¤šæ ·æ€§ä¸è¦†ç›–åº¦ç›´æ¥å†³å®šæ¨¡å‹çš„â€œé€šç”¨è®¤çŸ¥èƒ½åŠ›â€ã€‚</li>
</ul>
<h3 data-id="heading-3">2. æ¶Œç°èƒ½åŠ›ï¼šè§„æ¨¡çªç ´åçš„â€œæ™ºèƒ½è·ƒè¿â€</h3>
<p>â€œæ¶Œç°èƒ½åŠ›â€æ˜¯å¤§æ¨¡å‹æœ€ç‹¬ç‰¹çš„å±æ€§â€”â€”å½“å‚æ•°è§„æ¨¡ã€æ•°æ®é‡çªç ´æŸä¸€é˜ˆå€¼åï¼Œæ¨¡å‹ä¼šçªç„¶å…·å¤‡é¢„è®­ç»ƒä»»åŠ¡ä¸­æœªæ˜ç¡®å­¦ä¹ çš„èƒ½åŠ›ï¼ˆå¦‚æ€ç»´é“¾æ¨ç†ã€ä¸Šä¸‹æ–‡å­¦ä¹ ï¼‰ã€‚</p>
<ul>
<li><strong>æŠ€æœ¯æœ¬è´¨</strong>ï¼šç›®å‰å­¦ç•Œè®¤ä¸ºï¼Œå¤§å‚æ•°æ¨¡å‹èƒ½åœ¨é«˜ç»´ç‰¹å¾ç©ºé—´ä¸­æ•æ‰åˆ°æ•°æ®çš„â€œå¤æ‚éšå¼æ¨¡å¼â€ï¼Œå½“è§„æ¨¡è¶³å¤Ÿå¤§æ—¶ï¼Œè¿™äº›æ¨¡å¼ä¼šå½¢æˆâ€œæ³›åŒ–èƒ½åŠ›çš„å åŠ â€ï¼›</li>
<li><strong>å…¸å‹æ¡ˆä¾‹</strong>ï¼šæ€ç»´é“¾ï¼ˆChain-of-Thoughtï¼‰èƒ½åŠ›â€”â€”é€šè¿‡åœ¨æç¤ºè¯ä¸­åŠ å…¥â€œåˆ†æ­¥æ¨ç†â€ç¤ºä¾‹ï¼Œæ¨¡å‹å¯å­¦ä¼šæ‹†è§£å¤æ‚ä»»åŠ¡ï¼ˆå¦‚æ•°å­¦é¢˜ã€é€»è¾‘é¢˜ï¼‰ï¼Œå…¶æœ¬è´¨æ˜¯è°ƒç”¨äº†é¢„è®­ç»ƒä¸­å­¦ä¹ åˆ°çš„â€œå› æœæ¨ç†ç±»ç‰¹å¾â€ã€‚</li>
</ul>
<h3 data-id="heading-4">3. å¤šæ¨¡æ€ä¸é€šç”¨é€‚é…æ€§ï¼šå‘AGIé è¿‘çš„æŠ€æœ¯è·¯å¾„</h3>
<p>å¤§æ¨¡å‹çš„â€œé€šç”¨æ€§â€æºäº<strong>ç»Ÿä¸€çš„è¯­ä¹‰è¡¨ç¤ºæ¡†æ¶</strong>ï¼š</p>
<ul>
<li><strong>å¤šæ¨¡æ€æŠ€æœ¯åŸºç¡€</strong>ï¼šé€šè¿‡â€œè·¨æ¨¡æ€å¯¹é½â€å°†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰ä¸åŒç±»å‹æ•°æ®è½¬åŒ–ä¸ºç»Ÿä¸€çš„tokenè¡¨ç¤ºï¼ˆä¾‹å¦‚CLIPæ¨¡å‹é€šè¿‡â€œå›¾æ–‡å¯¹â€æ•°æ®ï¼Œè®©æ–‡æœ¬åµŒå…¥ä¸å›¾åƒåµŒå…¥æ˜ å°„åˆ°åŒä¸€è¯­ä¹‰ç©ºé—´ï¼‰ï¼›</li>
<li><strong>é¢†åŸŸé€‚é…æ–¹å¼</strong>ï¼šæ— éœ€é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œä»…é€šè¿‡â€œæç¤ºå­¦ä¹ â€æˆ–â€œè½»é‡å¾®è°ƒâ€å³å¯é€‚é…ä¸åŒåœºæ™¯ï¼š
<ul>
<li><strong>å°‘æ ·æœ¬æç¤º</strong>ï¼šç»™æ¨¡å‹1-5ä¸ªä»»åŠ¡ç¤ºä¾‹ï¼Œå³å¯è®©å…¶æ¨¡ä»¿å®Œæˆæ–°ä»»åŠ¡ï¼›</li>
<li><strong>æŒ‡ä»¤å¾®è°ƒ</strong>ï¼šç”¨â€œè‡ªç„¶è¯­è¨€æŒ‡ä»¤+ä»»åŠ¡è¾“å‡ºâ€çš„æ•°æ®é›†å¾®è°ƒæ¨¡å‹ï¼Œæå‡å…¶å¯¹äººç±»æŒ‡ä»¤çš„ç†è§£èƒ½åŠ›ï¼›</li>
<li><strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong>ï¼šç»“åˆå¤–éƒ¨çŸ¥è¯†åº“ï¼ˆå¦‚è¡Œä¸šæ–‡æ¡£ã€å®æ—¶æ•°æ®ï¼‰ï¼Œè®©æ¨¡å‹ç”Ÿæˆæ›´ç²¾å‡†çš„é¢†åŸŸå†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">4. è¶…é•¿ä¸Šä¸‹æ–‡ä¸éå®æ—¶æ€§é™åˆ¶ï¼šèƒ½åŠ›çš„â€œè¾¹ç•Œâ€</h3>
<ul>
<li><strong>è¶…é•¿ä¸Šä¸‹æ–‡çš„æŠ€æœ¯æ”¯æ’‘</strong>ï¼šåŸºäºTransformerçš„â€œæ³¨æ„åŠ›æœºåˆ¶â€ï¼Œé€šè¿‡ä¼˜åŒ–ï¼ˆå¦‚æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ã€ç¨€ç–æ³¨æ„åŠ›ï¼‰å®ç°å¯¹é•¿åºåˆ—çš„å¤„ç†ï¼ˆä¾‹å¦‚GPT-4çš„ä¸Šä¸‹æ–‡çª—å£è¾¾128k tokenï¼Œå¯å®¹çº³çº¦20ä¸‡å­—çš„æ–‡æœ¬ï¼‰ï¼Œå…¶æ ¸å¿ƒæ˜¯è®©æ¨¡å‹èƒ½â€œè®°ä½â€é•¿æ–‡æœ¬ä¸­çš„å…³è”ä¿¡æ¯ï¼›</li>
<li><strong>éå®æ—¶æ€§çš„æ ¹æº</strong>ï¼šå¤§æ¨¡å‹çš„é¢„è®­ç»ƒæ˜¯åŸºäºâ€œé™æ€æ•°æ®å¿«ç…§â€ï¼ˆå¦‚GPT-4çš„è®­ç»ƒæ•°æ®æˆªæ­¢åˆ°2023å¹´10æœˆï¼‰ï¼Œæ¨ç†é˜¶æ®µæ— æ³•å®æ—¶æ¥å…¥æ–°æ•°æ®â€”â€”è¿™æ˜¯å…¶ä¸æœç´¢å¼•æ“çš„æ ¸å¿ƒåŒºåˆ«ï¼ˆæœç´¢å¼•æ“ä¾èµ–å®æ—¶ç´¢å¼•ï¼Œè€Œå¤§æ¨¡å‹ä¾èµ–é¢„è®­ç»ƒçŸ¥è¯†ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-6">äºŒã€å¤§æ¨¡å‹çš„æ¶æ„åŸºç¡€ï¼šTransformerçš„â€œç»Ÿæ²»åŠ›â€</h2>
<p>å½“å‰æ‰€æœ‰å¤§æ¨¡å‹å‡åŸºäº<strong>Transformeræ¶æ„</strong>ï¼ˆ2017å¹´ç”±Googleæå‡ºï¼‰ï¼Œå…¶æ ¸å¿ƒç»„ä»¶å†³å®šäº†æ¨¡å‹çš„â€œè§„æ¨¡æ‰©å±•æ€§â€ä¸â€œè¯­ä¹‰æ•æ‰èƒ½åŠ›â€ï¼š</p>
<ol>
<li><strong>æ³¨æ„åŠ›æœºåˆ¶</strong>ï¼šé€šè¿‡â€œç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›â€è®¡ç®—æ¯ä¸ªtokenä¸å…¶ä»–tokençš„å…³è”æƒé‡ï¼Œè®©æ¨¡å‹åœ¨å¤„ç†æ–‡æœ¬æ—¶â€œèšç„¦å…³é”®ä¿¡æ¯â€ï¼›</li>
<li><strong>Encoder-Decoderç»“æ„</strong>ï¼š
<ul>
<li><strong>Encoder</strong>ï¼šè´Ÿè´£å°†è¾“å…¥æ–‡æœ¬è½¬åŒ–ä¸ºâ€œè¯­ä¹‰åµŒå…¥â€ï¼ˆå¦‚BERTä»…ç”¨Encoderï¼‰ï¼›</li>
<li><strong>Decoder</strong>ï¼šè´Ÿè´£åŸºäºè¯­ä¹‰åµŒå…¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬ï¼ˆå¦‚GPTä»…ç”¨Decoderï¼‰ï¼›</li>
</ul>
</li>
<li><strong>ä½ç½®ç¼–ç </strong>ï¼šç»™tokenæ·»åŠ ä½ç½®ä¿¡æ¯ï¼ˆå¦‚æ­£å¼¦ä½™å¼¦ç¼–ç ï¼‰ï¼Œè§£å†³Transformerâ€œæ— åºåˆ—æ„ŸçŸ¥â€çš„é—®é¢˜ï¼›</li>
<li><strong>æ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–</strong>ï¼šç¼“è§£å¤§æ¨¡å‹è®­ç»ƒä¸­çš„â€œæ¢¯åº¦æ¶ˆå¤±â€é—®é¢˜ï¼Œæ”¯æ’‘è¶…å¤šå±‚æ•°çš„æ¨¡å‹è®­ç»ƒã€‚</li>
</ol>
<h2 data-id="heading-7">ä¸‰ã€å¤§æ¨¡å‹çš„è¡Œä¸šæŠ€æœ¯ç°çŠ¶ï¼šè§„æ¨¡ä¸å£å’çš„åšå¼ˆ</h2>
<h3 data-id="heading-8">1. æ¨¡å‹åŒè´¨åŒ–ï¼šTransformerçš„â€œæŠ€æœ¯é”å®šâ€</h3>
<p>ç›®å‰å‡ ä¹æ‰€æœ‰å¤§æ¨¡å‹å‡åŸºäºTransformerè¡ç”Ÿæ¶æ„ï¼ˆå¦‚GPTçš„Decoder-onlyã€PaLMçš„Pathwaysæ¶æ„ï¼‰ï¼Œæ ¸å¿ƒåŸå› æ˜¯ï¼šTransformerçš„â€œæ³¨æ„åŠ›æœºåˆ¶+æ®‹å·®è¿æ¥â€æ˜¯å½“å‰å”¯ä¸€èƒ½æ”¯æ’‘â€œåƒäº¿çº§å‚æ•°+ä¸‡äº¿çº§æ•°æ®â€è®­ç»ƒçš„æ¶æ„ï¼Œæš‚æ— æ›´ä¼˜æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-9">2. è§„æ¨¡æ•ˆåº”ï¼šâ€œå¤§åŠ›å‡ºå¥‡è¿¹â€çš„æŠ€æœ¯ä¾æ®</h3>
<p>å­¦ç•Œç ”ç©¶æ˜¾ç¤ºï¼Œå¤§æ¨¡å‹çš„æ€§èƒ½ï¼ˆå¦‚å›°æƒ‘åº¦ã€ä»»åŠ¡å‡†ç¡®ç‡ï¼‰ä¸<strong>å‚æ•°è§„æ¨¡ã€è®­ç»ƒæ•°æ®é‡</strong>å‘ˆâ€œå¹‚å¾‹å…³ç³»â€ï¼šå½“å‚æ•°ä»10äº¿æå‡åˆ°1000äº¿æ—¶ï¼Œæ€§èƒ½ä¼šå‡ºç°â€œé˜¶æ¢¯å¼è·ƒå‡â€ï¼ˆä¾‹å¦‚GPT-2ï¼ˆ15äº¿å‚æ•°ï¼‰ä¸GPT-3ï¼ˆ1750äº¿å‚æ•°ï¼‰çš„èƒ½åŠ›å·®è·ï¼‰ã€‚</p>
<h3 data-id="heading-10">3. å¤´éƒ¨å„æ–­ï¼šæŠ€æœ¯é—¨æ§›çš„â€œé©¬å¤ªæ•ˆåº”â€</h3>
<p>å¤§æ¨¡å‹çš„ç ”å‘å­˜åœ¨æé«˜çš„â€œç®—åŠ›+æ•°æ®+èµ„é‡‘â€å£å’ï¼š</p>
<ul>
<li><strong>ç®—åŠ›æˆæœ¬</strong>ï¼šè®­ç»ƒä¸€æ¬¡åƒäº¿çº§å‚æ•°æ¨¡å‹éœ€æ¶ˆè€—â€œæ•°ä¸‡å¼ A100æ˜¾å¡Ã—æ•°æœˆæ—¶é—´â€ï¼Œæˆæœ¬è¶…è¿‡åƒä¸‡ç¾å…ƒï¼›</li>
<li><strong>æ•°æ®å£å’</strong>ï¼šé«˜è´¨é‡è®­ç»ƒæ•°æ®ï¼ˆå°¤å…¶æ˜¯å¤šæ¨¡æ€ã€å¤šè¯­è¨€æ•°æ®ï¼‰è¢«å¤´éƒ¨ä¼ä¸šå„æ–­ï¼›</li>
<li><strong>æŠ€æœ¯é—­ç¯</strong>ï¼šå¤´éƒ¨ä¼ä¸šé€šè¿‡â€œæ¨¡å‹ä¸å¼€æº+APIå•†ä¸šåŒ–â€æ„å»ºå£å’ï¼Œä¸­å°ä¼ä¸šä»…èƒ½åŸºäºAPIè¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</li>
</ul>
<h2 data-id="heading-11">å››ã€å¤§æ¨¡å‹çš„è½åœ°åº”ç”¨ï¼šæŠ€æœ¯é€»è¾‘çš„åœºæ™¯åŒ–å®ç°</h2>
<p>å¤§æ¨¡å‹çš„åº”ç”¨å¹¶éâ€œé»‘ç®±è°ƒç”¨â€ï¼Œè€Œæ˜¯æŠ€æœ¯ç‰¹æ€§ä¸åœºæ™¯éœ€æ±‚çš„ç²¾å‡†åŒ¹é…ï¼š</p>
<h3 data-id="heading-12">1. æ–‡æœ¬ç”Ÿæˆï¼šè‡ªå›å½’çš„â€œå†…å®¹ç”Ÿäº§é“¾â€</h3>
<ul>
<li><strong>æŠ€æœ¯é€»è¾‘</strong>ï¼šåŸºäºè‡ªå›å½’è¯­è¨€å»ºæ¨¡ï¼Œä»å·¦åˆ°å³é€tokené¢„æµ‹ï¼ˆä¾‹å¦‚ç”Ÿæˆä»£ç æ—¶ï¼Œæ¨¡å‹ä¼šåŸºäºå‰æ–‡çš„è¯­æ³•è§„åˆ™ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦/å…³é”®å­—ï¼‰ï¼›</li>
<li><strong>å…¸å‹åœºæ™¯</strong>ï¼šä»£ç ç”Ÿæˆï¼ˆGitHub Copilotï¼‰ã€æ–‡æ¡ˆæ’°å†™ã€æ•°å­¦è§£é¢˜ï¼ˆé€šè¿‡æ€ç»´é“¾æ‹†è§£æ­¥éª¤ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-13">2. æ™ºèƒ½å®¢æœï¼šRAGçš„â€œçŸ¥è¯†å¢å¼ºâ€</h3>
<ul>
<li><strong>æŠ€æœ¯é€»è¾‘</strong>ï¼šå…ˆé€šè¿‡æ£€ç´¢å¼•æ“ä»â€œè¡Œä¸šçŸ¥è¯†åº“â€ï¼ˆå¦‚é“¶è¡Œäº§å“æ‰‹å†Œã€åŒ»é™¢è¯Šç–—æŒ‡å—ï¼‰ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œå†å°†ä¿¡æ¯ä¼ å…¥å¤§æ¨¡å‹ï¼Œç”Ÿæˆç¬¦åˆåœºæ™¯çš„å›å¤ï¼›</li>
<li><strong>ä»·å€¼</strong>ï¼šè§£å†³å¤§æ¨¡å‹â€œçŸ¥è¯†è¿‡æ—¶â€â€œå¹»è§‰ï¼ˆç¼–é€ ä¿¡æ¯ï¼‰â€çš„é—®é¢˜ï¼Œæå‡å›å¤çš„ç²¾å‡†æ€§ã€‚</li>
</ul>
<h3 data-id="heading-14">3. å¤šæ¨¡æ€ä»»åŠ¡ï¼šè·¨æ¨¡æ€å¯¹é½çš„â€œèƒ½åŠ›å»¶ä¼¸â€</h3>
<ul>
<li><strong>æ–‡ç”Ÿå›¾</strong>ï¼šå¤§è¯­è¨€æ¨¡å‹å°†æ–‡æœ¬æè¿°è½¬åŒ–ä¸ºâ€œè¯­ä¹‰åµŒå…¥â€ï¼Œå†è¾“å…¥æ‰©æ•£æ¨¡å‹ï¼ˆå¦‚Stable Diffusionï¼‰ï¼Œç”Ÿæˆä¸è¯­ä¹‰åŒ¹é…çš„å›¾åƒï¼›</li>
<li><strong>çœ‹å›¾è¯´è¯</strong>ï¼šå¤§æ¨¡å‹å°†å›¾åƒè½¬åŒ–ä¸ºâ€œè§†è§‰åµŒå…¥â€ï¼Œå†æ˜ å°„ä¸ºè‡ªç„¶è¯­è¨€æè¿°ï¼ˆä¾èµ–é¢„è®­ç»ƒä¸­çš„å›¾æ–‡å¯¹é½æ•°æ®ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-15">4. æƒ…æ„Ÿåˆ†æï¼šè¯­ä¹‰è¡¨ç¤ºçš„â€œç»†ç²’åº¦ç†è§£â€</h3>
<ul>
<li><strong>æŠ€æœ¯é€»è¾‘</strong>ï¼šå¤§æ¨¡å‹é€šè¿‡é¢„è®­ç»ƒä¸­å­¦ä¹ çš„â€œæƒ…æ„Ÿç±»è¯æ±‡ç‰¹å¾â€ï¼ˆå¦‚â€œå¼€å¿ƒâ€â€œå¤±æœ›â€ï¼‰ï¼Œå¯¹æ–‡æœ¬çš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢/ä¸­æ€§ï¼‰è¿›è¡Œåˆ†ç±»ï¼Œç”šè‡³èƒ½è¯†åˆ«â€œè®½åˆºâ€â€œåè¯â€ç­‰å¤æ‚æƒ…æ„Ÿã€‚</li>
</ul>
<h2 data-id="heading-16">æ€»ç»“</h2>
<p>å¤§æ¨¡å‹çš„æœ¬è´¨æ˜¯â€œæ•°æ®ä¸è§„æ¨¡é©±åŠ¨çš„é€šç”¨è¯­ä¹‰å¼•æ“â€ï¼Œå…¶èƒ½åŠ›è¾¹ç•Œä»åœ¨æ‰©å¼ ï¼Œä½†æŠ€æœ¯åº•å±‚çš„é€»è¾‘ï¼ˆTransformeræ¶æ„ã€è‡ªç›‘ç£é¢„è®­ç»ƒï¼‰å·²ç›¸å¯¹æ¸…æ™°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜]]></title>    <link>https://juejin.cn/post/7585502118459965459</link>    <guid>https://juejin.cn/post/7585502118459965459</guid>    <pubDate>2025-12-21T01:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585502118459965459" data-draft-id="7585502118459949075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-21T01:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T01:33:10.000Z" title="Sun Dec 21 2025 01:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šNginx access.log é‡‡é›†åˆ° Kafkaï¼Œç» Logstash æ¸…æ´—ï¼ˆå« GeoIPï¼‰è½ ES</li>
<li>ç»“è®ºï¼šUbuntu 22.04 ä¸Š Filebeat 7.3 å¯èƒ½å¯åŠ¨å¤±è´¥ï¼Œå‡çº§åˆ° 7.17 å¯ç›´æ¥æ¢å¤</li>
<li>äº§å‡ºï¼šå¯å¤ç”¨çš„ filebeat.yml + logstash_kafka_es.conf åŠå¸¸è§æ•…éšœå®šä½/ä¿®å¤è¡¨</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a079c04ef87c482a83d324b56e56f9b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=xmJV1l6nxgxbX1NyXNAUzSTM12U%3D" alt="å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>















































<table><thead><tr><th>ç»„ä»¶</th><th>ç‰ˆæœ¬</th><th>ç¯å¢ƒ/ç³»ç»Ÿ</th><th>å·²éªŒè¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Filebeat</td><td>7.3.0</td><td>Ubuntu 22.04.3</td><td>å¦</td><td>æ–‡ä¸­å‡ºç° cgo/pthread æŠ¥é”™ï¼Œæ— æ³•å¯åŠ¨ï¼ˆåŒæœºå‹/æƒé™åœºæ™¯ä¸‹ï¼‰</td></tr><tr><td>Filebeat</td><td>7.17.0</td><td>Ubuntu 22.04.3</td><td>æ˜¯</td><td>æŒ‰æ–‡ä¸­é…ç½®å¯å¯åŠ¨å¹¶å‘ Kafka å†™å…¥äº‹ä»¶ï¼Œäº‹ä»¶ metadata æ˜¾ç¤º 7.17.0</td></tr><tr><td>Logstash</td><td>7.3.0</td><td>æœªæ˜ç¡®</td><td>éƒ¨åˆ†</td><td>-t é…ç½®æµ‹è¯•é€šè¿‡å¹¶å¯å¯åŠ¨ï¼›ç³»ç»Ÿ/JDK æœªæä¾›ï¼Œè·¨ç¯å¢ƒç»“è®ºä¸å¤–æ¨</td></tr><tr><td>Kafka</td><td>æœªæä¾›</td><td>æœªæä¾›</td><td>éƒ¨åˆ†</td><td>ä»…éªŒè¯åˆ°å¯è¢« filebeat å†™å…¥ã€å¯ç”¨ console-consumer æ¶ˆè´¹ï¼ˆç‰ˆæœ¬/é‰´æƒæœªæè¿°ï¼‰</td></tr><tr><td>Elasticsearch</td><td>æœªæä¾›</td><td>æœªæä¾›</td><td>å¦</td><td>ä»…ç»™å‡º output é…ç½®ä¸ç´¢å¼•å‘½åè§„åˆ™ï¼Œæœªæä¾› ES ç‰ˆæœ¬ä¸è½åº“éªŒè¯æˆªå›¾/æŸ¥è¯¢</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbfeaa3325e3420fa2f24eb3f02a8085~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=7ijvokJ3tQ%2BK4nCLJ5wEE1Pxi3k%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-2">Filebeat</h2>
<h3 data-id="heading-3">å®˜æ–¹åœ°å€</h3>
<p>Filebeatä¸»è¦ä¸ºäº†è§£å†³Logstashå·¥å…·æ˜¯æ¶ˆè€—èµ„æºæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºLogstashæ˜¯Javaè¯­è¨€ç¼–å†™çš„ï¼Œéœ€è¦å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºã€‚å®˜æ–¹ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜æ¨å‡ºäº†ä¸€äº›è½»é‡çº§çš„é‡‡é›†å·¥å…·ï¼ŒBeatsç³»åˆ—ï¼Œå…¶ä¸­æ¯”è¾ƒå¹¿æ³›ä½¿ç”¨çš„æ˜¯Filebeatã€‚</p>
<pre><code class="hljs language-shell" lang="shell">https://www.elastic.co/guide/en/beats/filebeat/7.3/index.html
</code></pre>
<h3 data-id="heading-4">å¯¹æ¯”åŒºåˆ«</h3>
<ul>
<li>Logstashæ˜¯è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šçš„ï¼Œå¯åŠ¨ä¸€ä¸ªLogstashéœ€è¦æ¶ˆè€—500Mçš„å†…å­˜ï¼ˆæ‰€ä»¥å¯åŠ¨ç‰¹åˆ«æ…¢ï¼‰ï¼Œè€ŒFilebeatåªéœ€è¦10Må·¦å³</li>
<li>å¸¸ç”¨çš„ELKæ—¥å¿—é‡‡é›†ä¸­ï¼Œå¤§éƒ¨åˆ†çš„åšæ³•å°±æ˜¯å°†æ‰€æœ‰èŠ‚ç‚¹çš„æ—¥å¿—å†…å®¹é€šè¿‡Filebeatå‘é€åˆ°Kafkaé›†ç¾¤ï¼ŒLogstashæ¶ˆè´¹Kafkaï¼Œå†æ ¹æ®é…ç½®æ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå°†è¿‡æ»¤çš„æ–‡ä»¶è¾“å‡ºåˆ°Elasticsearchä¸­ï¼Œå†åˆ°Kibanaå»å±•ç¤ºã€‚</li>
</ul>
<h3 data-id="heading-5">é¡¹ç›®å®‰è£…</h3>
<p>ç›®å‰æˆ‘é€‰æ‹©åœ¨ h121 èŠ‚ç‚¹ä¸Šï¼Œä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æƒ…å†µæ¥å®‰è£…ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.3.0-linux-x86_64.tar.gz
</code></pre>
<p>ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcef53d87c9d42559a460f5e876a2aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=XDQ2WPLzMRQDfKS9FXA%2ByQ3QHTc%3D" alt="Logstash filebeat" loading="lazy"/></p>
<h3 data-id="heading-6">è§£å‹é…ç½®</h3>
<pre><code class="hljs language-shell" lang="shell">tar -zxvf filebeat-7.3.0-linux-x86_64.tar.gz
mv filebeat-7.3.0-linux-x86_64 ../servers
cd ../servers
</code></pre>
<p>å¯¹åº”çš„å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81c0c360a2db41a998ebe8cb7cf527b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=LLRCbuWtU%2BoLUYVawmnRHcl3JWg%3D" alt="FileBeat é…ç½®" loading="lazy"/>
ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/filebeat-7.3.0-linux-x86_64
vim filebeat.yml
</code></pre>
<p>å½“å‰æ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51385114eea45709c4a52ae4e1ce7a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=DXi0w6cPFxLrBF%2ByQLuhS8Fwn%2F8%3D" alt="FileBeat é…ç½®æ–‡ä»¶" loading="lazy"/></p>
<h4 data-id="heading-7">inputéƒ¨åˆ†</h4>
<p>ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„å†…å®¹ filebeat.inputs éƒ¨åˆ†çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">- type: log
<span class="hljs-meta prompt_">
  # </span><span class="bash">Change to <span class="hljs-literal">true</span> to <span class="hljs-built_in">enable</span> this input configuration.</span>
  enabled: true
<span class="hljs-meta prompt_">
  # </span><span class="bash">Paths that should be crawled and fetched. Glob based paths.</span>
  paths:
    - /opt/wzk/logs/access.log
    #- c:\programdata\elasticsearch\logs\*
<span class="hljs-meta prompt_">
  # </span><span class="bash">Exclude lines. A list of regular expressions to match. It drops the lines that are</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">matching any regular expression from the list.</span>
<span class="hljs-meta prompt_">  #</span><span class="bash">exclude_lines: [<span class="hljs-string">'^DBG'</span>]</span>
<span class="hljs-meta prompt_">
  # </span><span class="bash">Include lines. A list of regular expressions to match. It exports the lines that are</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">matching any regular expression from the list.</span>
<span class="hljs-meta prompt_">  #</span><span class="bash">include_lines: [<span class="hljs-string">'^ERR'</span>, <span class="hljs-string">'^WARN'</span>]</span>
<span class="hljs-meta prompt_">
  # </span><span class="bash">Exclude files. A list of regular expressions to match. Filebeat drops the files that</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">are matching any regular expression from the list. By default, no files are dropped.</span>
<span class="hljs-meta prompt_">  #</span><span class="bash">exclude_files: [<span class="hljs-string">'.gz$'</span>]</span>
<span class="hljs-meta prompt_">
  # </span><span class="bash">Optional additional fields. These fields can be freely picked</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">to add additional information to the crawled <span class="hljs-built_in">log</span> files <span class="hljs-keyword">for</span> filtering</span>
  fields:
    app: www
    type: nginx-access
  fields_under_root: true
<span class="hljs-meta prompt_">  #</span><span class="bash"><span class="hljs-comment">## Multiline options</span></span>
</code></pre>
<p>ä¿®æ”¹çš„æˆªå›¾å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4a6b970dd544721b64c02ea4c8eb880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=1qOOWumgLOO3oVvCqbv6puJWSN4%3D" alt="FileBeat inputé…ç½®" loading="lazy"/></p>
<h4 data-id="heading-8">outputéƒ¨åˆ†</h4>
<pre><code class="hljs language-shell" lang="shell">output.kafka:
  hosts: ["h121.wzk.icu:9092"]
  topic: "nginx_access_log"
</code></pre>
<p>å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b699aec78cfc4b789578f18e2fa48755~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=C7XSkGjA68v4DN77p3diP0EOnn4%3D" alt="FileBeat output é…ç½®" loading="lazy"/></p>
<h3 data-id="heading-9">å¯åŠ¨æœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/filebeat-7.3.0-linux-x86_64
./filebeat -e -c filebeat.yml
</code></pre>
<p>å¦‚æœä½ åœ¨è¿™é‡Œé‡åˆ°äº† runtime-cgo-pthread-create-failed-operation-not-permitted çš„é”™è¯¯ï¼Œé‚£ä½ å¯ä»¥å°è¯•å°† FileBeat çš„ç‰ˆæœ¬è¿›è¡Œæå‡ï¼Œæˆ‘è¿™é‡Œå°±é‡åˆ°äº†ï¼Œæ‰€ä»¥åç»­è¿›è¡Œç‰ˆæœ¬æå‡</p>
<h3 data-id="heading-10">é‡åˆ°é”™è¯¯ runtime-cgo-pthread-create-failed-operation-not-permitted</h3>
<p>å¦‚æœä½ æ²¡æœ‰é‡åˆ°ï¼Œç›´æ¥è·³è¿‡ï¼
æˆ‘è¿™é‡Œç‰ˆæœ¬ä¸€ç‚¹ç‚¹çš„å¾€ä¸Šå°è¯•ï¼Œå¤§è‡´çŒœæµ‹æ˜¯æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬å¯èƒ½æ–°ä¸€äº›ï¼Œæ‰€ä»¥åŸæ¥çš„Goçš„åº“æ— æ³•æ”¯æŒæ–°çš„æ“ä½œç³»ç»Ÿäº†ï¼ˆçŒœæµ‹çš„ï¼‰ã€‚
è¿™é‡Œæˆ‘æµ‹è¯•åˆ° 7.17 çš„ç‰ˆæœ¬å°±å¥½äº†ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.0-linux-x86_64.tar.gz
</code></pre>
<p>æ ¹æ®åˆšæ‰çš„æ“ä½œï¼Œæˆ‘å·²ç»é…ç½®å¥½äº†è·¯åŠ²ç­‰å†…å®¹ï¼Œä¸”ä¿®æ”¹äº† filebeat.yml çš„é…ç½®æ–‡ä»¶å†…å®¹
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/098bb25df873458b9e8ad8e234811a6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=V8rd3HwZ22piN9xmglC15X%2FqR%2Bs%3D" alt="FileBeat é…ç½®æ–‡ä»¶" loading="lazy"/>
è¿›è¡Œå¯åŠ¨æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/filebeat-7.17.0-linux-x86_64
./filebeat -e -c filebeat.yml
</code></pre>
<p>é¡ºåˆ©å¯åŠ¨ï¼Œå¯åŠ¨ç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cffe5bda76fe4ca8af40e2ba94c0a735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=kKlbCMO15EPTlb1eT1RRZKdLaCc%3D" alt="FileBeat æ—¥å¿—æ–‡ä»¶" loading="lazy"/></p>
<h3 data-id="heading-11">æµ‹è¯•æ•°æ®</h3>
<p>å¯åŠ¨ä¸€åˆ‡æ­£å¸¸ä¹‹åï¼Œæˆ‘ä»¬åœ¨Nginxåˆ·æ–°å‡ æ¬¡ï¼Œæ¥ç”Ÿæˆä¸€äº›æ•°æ®å‡ºæ¥ã€‚</p>
<h3 data-id="heading-12">æŸ¥çœ‹æ¶ˆè´¹</h3>
<pre><code class="hljs language-shell" lang="shell">kafka-console-consumer.sh --bootstrap-server h121.wzk.icu:9092 --topic nginx_access_log --
from-beginning
</code></pre>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»æ¥äº†ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59e867337ad4ca491316ca4b572cb8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=1Qd59gRGaPJNpfYbWklZcjPmkbo%3D" alt="FileBeat Kafkaæ¶ˆè´¹è€…å¯åŠ¨" loading="lazy"/>
æˆ‘ä»¬è¿›è¡Œä¸€ä¸‹JSONçš„æ ¼å¼åŒ–æ“ä½œï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"@timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-08-19T08:14:52.073Z"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"@metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"beat"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"filebeat"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_doc"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7.17.0"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"cloud"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"availability_zone"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cn-north-1b"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"service"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ECS"</span>
		<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"huawei"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"instance"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ccf8173b-3e47-468e-be8a-5ea3a03c76e0"</span>
		<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"region"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cn-north-1"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"log"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2034</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"file"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/opt/wzk/logs/access.log"</span>
		<span class="hljs-punctuation">}</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{ \"@timestamp\": \"2024-08-19T16:14:46+08:00\", \"remote_addr\": \"223.80.101.21\", \"remote_user\": \"-\", \"body_bytes_sent\": \"0\", \"request_time\": \"0.000\", \"status\": \"304\", \"request_uri\": \"/\", \"request_method\": \"GET\", \"http_referrer\": \"-\", \"http_x_forwarded_for\": \"-\", \"http_user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36\"}"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"fields"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"www"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nginx-access"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"log"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"hostname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"ephemeral_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ebc9ac86-db92-4bb1-a631-e6a868393270"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da3cc603-7d17-4b4a-ac3b-6b557805a2e2"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"filebeat"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7.17.0"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"ecs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.12.0"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"host"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"mac"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"fa:16:3e:6b:c3:30"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"hostname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"architecture"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"x86_64"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"os"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"codename"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"jammy"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"linux"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"platform"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ubuntu"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22.04.3 LTS (Jammy Jellyfish)"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"family"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"debian"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Ubuntu"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"kernel"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.15.0-92-generic"</span>
		<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"42ed7c7740bf4c19a180c6b736d11bbf"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"containerized"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"ip"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"192.168.0.109"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"fe80::f816:3eff:fe6b:c330"</span><span class="hljs-punctuation">]</span>
	<span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-13">Logstash</h2>
<h3 data-id="heading-14">å®˜æ–¹æ–‡æ¡£</h3>
<p>Logstashç”¨æ¥è¯»å–Kafkaä¸­çš„æ•°æ®</p>
<pre><code class="hljs language-shell" lang="shell">https://www.elastic.co/guide/en/logstash/7.3/plugins-inputs-kafka.html
</code></pre>
<h3 data-id="heading-15">ç¼–å†™é…ç½®</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/logstash-7.3.0/config
vim logstash_kafka_es.conf
</code></pre>
<p>ä¿®æ”¹å¦‚ä¸‹çš„é…ç½®å¦‚ä½•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">input {
    kafka {
        bootstrap_servers =&gt; "h121.wzk.icu:9092"
        topics =&gt; ["nginx_access_log"]
        codec =&gt; "json"
    }
}

filter {
    if [app] == "www" {
        if [type] == "nginx-access" {
            json {
                source =&gt; "message"
                remove_field =&gt; ["message"]
            }
            geoip {
                source =&gt; "remote_addr"
                target =&gt; "geoip"
                database =&gt; "/opt/wzk/GeoLite2-City.mmdb"
                add_field =&gt; ["[geoip][coordinates]", "%{[geoip][longitude]}"]
                add_field =&gt; ["[geoip][coordinates]", "%{[geoip][latitude]}"]
            }
            mutate {
                convert =&gt; ["[geoip][coordinates]", "float"]
            }
        }
    }
}

output {
    elasticsearch {
        hosts =&gt; ["http://h121.wzk.icu:9200"]
        index =&gt; "logstash-%{type}-%{+YYYY.MM.dd}"
    }
    stdout {
        codec =&gt; rubydebug
    }
}

</code></pre>
<h3 data-id="heading-16">ä¸‹è½½ä¾èµ–</h3>
<p>æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œç”¨äº†ä¸€ä¸ª GeoLite2-City.mmdbï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½GeoLite2-City.mmdbï¼š</p>
<pre><code class="hljs language-shell" lang="shell">https://github.com/P3TERX/GeoLite.mmdb?tab=readme-ov-file
</code></pre>
<p>è¿™é‡Œæˆ‘ç›´æ¥ä¸‹è½½ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/wzk/
wget https://git.io/GeoLite2-City.mmdb
</code></pre>
<p>ä¸‹è½½è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9663451f16234837a932d68a4b97846b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=KngFemdDrbsmdqqGV0noVQdReNo%3D" alt="FileBeat Logstash" loading="lazy"/></p>
<h3 data-id="heading-17">æµ‹è¯•æœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/logstash-7.3.0
bin/logstash -f /opt/servers/logstash-7.3.0/config/logstash_kafka_es.conf -t
</code></pre>
<p>è¿è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e21f4bb28264e0a909e3a96949273f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=jEGfip6EHFR%2FkSVU1S6iYswj%2Fyg%3D" alt="FileBeat Logstash æµ‹è¯•æœåŠ¡" loading="lazy"/></p>
<h3 data-id="heading-18">å¯åŠ¨æœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/logstash-7.3.0
bin/logstash -f /opt/servers/logstash-7.3.0/config/logstash_kafka_es.conf
</code></pre>
<p>å¯åŠ¨ä¹‹åç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b0169c31630494fbcf0b2d42ec20850~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=3hNVl%2FSPmLLkvM7JMwNBQPiTkh0%3D" alt="FileBeat Logstash å¯åŠ¨æµ‹è¯•" loading="lazy"/>
Kafaå¯¹åº”çš„æ—¥å¿—éƒ¨åˆ†ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acc1b7a4814c49d1a2832ce7b081ba22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=Te2BkM28JiD4hf8IhfTT6RYjKT4%3D" alt="FileBeat Kafkaæ—¥å¿—" loading="lazy"/></p>
<h3 data-id="heading-19">æµ‹è¯•æ•°æ®</h3>
<p>æˆ‘ä»¬åˆ·æ–°Nginxçš„é¡µé¢ï¼Œæä¾›ä¸€äº›æ•°æ®å‡ºæ¥ã€‚
æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Logstash çš„æ§åˆ¶å°è¾“å‡ºäº†å¯¹åº”çš„å†…å®¹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd194aeb840d47249402cb5a90f06a3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=KJQFsQwCRJGDBq6zWQb13vy2sBQ%3D" alt="FileBeat æµ‹è¯•æ•°æ®" loading="lazy"/></p>
<h2 data-id="heading-20">é”™è¯¯é€ŸæŸ¥</h2>















































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› </th><th>å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td>Filebeat å¯åŠ¨æŠ¥ runtime-cgo-pthread-create-failed-operation-not-permitted</td><td>äºŒè¿›åˆ¶/Go è¿è¡Œæ—¶ä¸ç³»ç»Ÿ/æƒé™/çº¿ç¨‹é™åˆ¶ä¸å…¼å®¹ï¼ˆåœ¨æ–°ç³»ç»Ÿæ›´å¸¸è§ï¼‰</td><td>ç›´æ¥åœ¨ ./filebeat -e -c filebeat.yml æ§åˆ¶å°å¤ç°</td><td>å‡çº§ Filebeat åˆ° 7.17.0ï¼ˆæ–‡ä¸­éªŒè¯å¯ç”¨ï¼‰ï¼Œä¿æŒåŸé…ç½®è¿ç§»</td></tr><tr><td>Kafka ç«¯æ¶ˆè´¹ä¸åˆ°æ•°æ®</td><td>input è·¯å¾„æ— æ–°æ—¥å¿—ã€enabled æœªå¼€ã€topic/hosts é…é”™</td><td>Filebeat æ§åˆ¶å°çœ‹ harvest/publishï¼›Kafka ç”¨ console-consumer éªŒè¯</td><td>ç¡®è®¤ filebeat.inputs.enabled: trueã€paths æŒ‡å‘çœŸå®æ–‡ä»¶ã€output.kafka.hosts/topic æ­£ç¡®ï¼›åˆ·æ–° Nginx äº§ç”Ÿæ–°è¡Œ</td></tr><tr><td>Kafka console-consumer å‘½ä»¤æŠ¥é”™æˆ–ä¸è¾“å‡º</td><td>å‘½ä»¤å‚æ•°è¢«æ¢è¡Œ/æˆªæ–­ï¼ˆ--from-beginning å†™æˆ --\nfrom-beginningï¼‰</td><td>ç›´æ¥çœ‹å‘½ä»¤è¡Œå›æ˜¾</td><td>ä½¿ç”¨å®Œæ•´ä¸€è¡Œå‘½ä»¤ï¼škafka-console-consumer.sh --bootstrap-server ... --topic ... --from-beginning</td></tr><tr><td>Logstash è§£æåå­—æ®µç¼ºå¤±/ä»æ˜¯åŸ message å­—ç¬¦ä¸²</td><td>codec =&gt; json åªè§£æ Kafka å¤–å±‚äº‹ä»¶ï¼›çœŸæ­£ä¸šåŠ¡ JSON åœ¨ message å­—æ®µå†…ï¼Œéœ€è¦äºŒæ¬¡ json filter</td><td>stdout(rubydebug) è§‚å¯Ÿäº‹ä»¶ç»“æ„ï¼šå¤–å±‚å­—æ®µ vs message å­—ç¬¦ä¸²</td><td>ä¿æŒ codec =&gt; jsonï¼Œå†ç”¨ json { source =&gt; "message" remove_field =&gt; ["message"] } äºŒæ¬¡è§£æï¼ˆæ–‡ä¸­å·²é…ç½®ï¼‰</td></tr><tr><td>GeoIP ä¸ç”Ÿæ•ˆæˆ–å¯åŠ¨æŠ¥æ•°æ®åº“è·¯å¾„é”™è¯¯</td><td>mmdb æ–‡ä»¶ä¸å­˜åœ¨/è·¯å¾„ä¸å¯¹/æƒé™ä¸è¶³</td><td>Logstash æ—¥å¿—æœ GeoIP/mmdbï¼›æ£€æŸ¥ /opt/wzk/GeoLite2-City.mmdb</td><td>ç¡®ä¿ mmdb å­˜åœ¨ä¸”å¯è¯»ï¼›è·¯å¾„ä¸é…ç½®ä¸€è‡´ï¼›å¿…è¦æ—¶è°ƒæ•´æ–‡ä»¶æƒé™/å±ä¸»</td></tr><tr><td>ES æ— ç´¢å¼•æˆ–å†™å…¥å¤±è´¥</td><td>ES åœ°å€ä¸å¯è¾¾ã€ç´¢å¼•æƒé™/æ¨¡æ¿é—®é¢˜ã€ç½‘ç»œ/è®¤è¯æœªé…ç½®</td><td>Logstash è¾“å‡ºä¸­çœ‹ elasticsearch output çš„é”™è¯¯å †æ ˆ</td><td>å…ˆç”¨ curl æµ‹ ES è¿é€šï¼›ç¡®è®¤ hosts =&gt; ["<a href="https://link.juejin.cn?target=http%3A%2F%2F...%3A9200" target="_blank" title="http://...:9200" ref="nofollow noopener noreferrer">http://...:9200</a>"] å¯è®¿é—®ï¼›å¦‚å¯ç”¨å®‰å…¨è®¤è¯éœ€è¡¥å……ç”¨æˆ·åå¯†ç /SSL é…ç½®</td></tr></tbody></table>
<h2 data-id="heading-21">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-22">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-23">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-196 æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹ï¼šRabbitMQ vs RocketMQ vs Kafka</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSå·²å®Œç»“ï¼ŒGuavaCacheå·²å®Œç»“ï¼ŒEVCacheå·²å®Œç»“ï¼ŒRabbitMQæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-24">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘]]></title>    <link>https://juejin.cn/post/7585474459777187876</link>    <guid>https://juejin.cn/post/7585474459777187876</guid>    <pubDate>2025-12-21T00:07:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459777187876" data-draft-id="7585502118459899923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘"/> <meta itemprop="keywords" content="åç«¯,PHP"/> <meta itemprop="datePublished" content="2025-12-21T00:07:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T00:07:38.000Z" title="Sun Dec 21 2025 00:07:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘</h2>
<h3 data-id="heading-1">é€‰å‹å›°å¢ƒä¸­çš„ä¸€æ¬¡å¶ç„¶</h3>
<p>åš Laravel å¼€å‘è¿™äº›å¹´,æ¯æ¬¡å¯åŠ¨æ–°é¡¹ç›®æ—¶æ€»ä¼šé¢ä¸´åŒä¸€ä¸ªé—®é¢˜:åå°ç®¡ç†ç³»ç»Ÿè¯¥æ€ä¹ˆæ­?è‡ªå·±ä»é›¶å†™ä¸€å¥—æƒé™ã€èœå•ã€ç”¨æˆ·ç®¡ç†?å¤ªè€—æ—¶ã€‚ç”¨ç°æˆçš„æ–¹æ¡ˆ?å¸‚é¢ä¸Šçš„é€‰æ‹©ä¸å°‘,ä½†æ€»æœ‰äº›åœ°æ–¹ä¸å¤Ÿé¡ºæ‰‹ã€‚æœ‰äº›è¿‡äºè‡ƒè‚¿,é›†æˆäº†ä¸€å †ç”¨ä¸ä¸Šçš„åŠŸèƒ½;æœ‰äº›åˆè¿‡äºç®€é™‹,ç¨å¾®å¤æ‚ç‚¹çš„éœ€æ±‚å°±å¾—å¤§æ”¹ã€‚</p>
<p>ç›´åˆ°æŸå¤©åœ¨ GitHub ä¸Šé—²é€›æ—¶,å¶ç„¶çœ‹åˆ°äº† CatchAdmin V5 çš„ä»‹ç»ã€‚"åŸºäº Laravel 12 å’Œ Vue3 çš„æ¨¡å—åŒ–åå°ç®¡ç†ç³»ç»Ÿ"â€”â€”è¿™ä¸ªæ ‡ç­¾ç«‹åˆ»å¸å¼•äº†æˆ‘ã€‚Laravel 12 æ˜¯æœ€æ–°ç‰ˆæœ¬,Vue3 + Element Plus çš„å‰ç«¯ç»„åˆä¹Ÿå¾ˆç°ä»£,ä½†çœŸæ­£è®©æˆ‘ç‚¹è¿›å»çš„,æ˜¯"æ¨¡å—åŒ–"è¿™ä¸‰ä¸ªå­—ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-12%2Fcatchadmin-v5-modular-laravel-admin" target="_blank" title="https://catchadmin.com/post/2025-12/catchadmin-v5-modular-laravel-admin" ref="nofollow noopener noreferrer">åŸæ–‡é“¾æ¥ å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘</a></p>
<h3 data-id="heading-2">ç¬¬ä¸€å°è±¡:å®‰è£…ä½“éªŒå‡ºä¹æ„æ–™</h3>
<p>æŠ±ç€è¯•è¯•çœ‹çš„å¿ƒæ€,æˆ‘å†³å®šåœ¨æœ¬åœ°è·‘ä¸€ä¸‹ã€‚æ•´ä¸ªå®‰è£…è¿‡ç¨‹ç®€å•å¾—è®©äººæ„å¤–:</p>
<pre><code class="hljs language-bash" lang="bash">composer global -W require catchadmin/installer

<span class="hljs-comment"># æ–°å»ºé¡¹ç›®</span>
catch new my-admin

<span class="hljs-comment"># å®‰è£…é¡¹ç›®</span>
<span class="hljs-built_in">cd</span> my-admin &amp;&amp; php artisan catch:install

<span class="hljs-comment"># å¯åŠ¨é¡¹ç›®</span>
composer run dev
</code></pre>
<p>å››è¡Œå‘½ä»¤,ä¸€ä¸ªå®Œæ•´çš„åå°ç®¡ç†ç³»ç»Ÿå°±ç«‹åœ¨äº†çœ¼å‰ã€‚æ²¡æœ‰å¤æ‚çš„é…ç½®æ–‡ä»¶è¦å¡«,æ²¡æœ‰ç¹ççš„ä¾èµ–è¦è£…,ç”šè‡³è¿æ•°æ®åº“è¿ç§»éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ã€‚è¿™ç§"å¼€ç®±å³ç”¨"çš„ä½“éªŒ,è®©æˆ‘æƒ³èµ·äº†ç¬¬ä¸€æ¬¡ç”¨ Laravel æ—¶çš„é‚£ç§æƒŠå–œâ€”â€”ä¸€åˆ‡éƒ½è¢«å®‰æ’å¾—æ°åˆ°å¥½å¤„ã€‚</p>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—®åå°,ç•Œé¢å¹²å‡€åˆ©è½ã€‚Element Plus çš„ç»„ä»¶é£æ ¼å¾ˆèˆ’æœ,æ²¡æœ‰é‚£ç§"åå°ç³»ç»Ÿç‰¹æœ‰çš„è€æ°”æ„Ÿ"ã€‚ä¾§è¾¹æ ã€è¡¨æ ¼ã€è¡¨å•,æ¯ä¸ªäº¤äº’éƒ½å¾ˆæµç•…ã€‚ä½†è¿™äº›éƒ½è¿˜åªæ˜¯è¡¨é¢,çœŸæ­£è®©æˆ‘çœ¼å‰ä¸€äº®çš„,æ˜¯å®ƒçš„æ¶æ„è®¾è®¡ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea9af422a95f4b85bf7ab74fbbd6c936~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmluZ29Hbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766880458&amp;x-signature=RcMjtH%2FufLJEVAQpJGkaEJxrNJY%3D" alt="CatchAdmin v5 æ¬¢è¿å›æ¥" loading="lazy"/></p>
<h3 data-id="heading-3">æ¨¡å—åŒ–è®¾è®¡:ä¸åªæ˜¯è¯´è¯´è€Œå·²</h3>
<p>å¾ˆå¤šæ¡†æ¶éƒ½å£°ç§°è‡ªå·±"æ¨¡å—åŒ–",ä½†å®é™…ç”¨èµ·æ¥,æ¨¡å—ä¹‹é—´å¾€å¾€è¿˜æ˜¯è—•æ–­ä¸è¿ã€‚CatchAdmin åœ¨è¿™æ–¹é¢åšå¾—å¾ˆå½»åº•:æ¯ä¸ªæ¨¡å—éƒ½æœ‰ç‹¬ç«‹çš„æ§åˆ¶å™¨ã€è·¯ç”±ã€æ¨¡å‹ã€æ•°æ®è¡¨,ç”šè‡³é…ç½®æ–‡ä»¶éƒ½æ˜¯éš”ç¦»çš„ã€‚</p>
<p>ä¸¾ä¸ªå…·ä½“ä¾‹å­ã€‚æˆ‘æƒ³ç»™ç³»ç»ŸåŠ ä¸€ä¸ª"æ–‡ç« ç®¡ç†"æ¨¡å—ã€‚ä¼ ç»Ÿåšæ³•æ˜¯åœ¨ç°æœ‰ä»£ç é‡Œä¸œåŠ ä¸€ç‚¹ã€è¥¿æ”¹ä¸€ç‚¹,æœ€åæ•´ä¸ªé¡¹ç›®å˜æˆä¸€å›¢æ„å¤§åˆ©é¢ã€‚ä½†åœ¨ CatchAdmin é‡Œ,æˆ‘å¯ä»¥è¿™æ ·åš:</p>
<pre><code class="hljs language-bash" lang="bash">php artisan catch:module:install
</code></pre>
<p>ç³»ç»Ÿä¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ¨¡å—,æˆ‘é€‰æ‹©å®‰è£… <code>permissions</code>(æƒé™ç®¡ç†)æ¨¡å—ã€‚å®‰è£…å®Œæˆå,åˆ·æ–°é¡µé¢,å·¦ä¾§èœå•æ è‡ªåŠ¨å‡ºç°äº†å¯¹åº”çš„èœå•é¡¹,æ•°æ®è¡¨ä¹Ÿè‡ªåŠ¨åˆ›å»ºå¥½äº†ã€‚æ•´ä¸ªè¿‡ç¨‹å®Œå…¨ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»»ä½•ä»£ç ã€‚</p>
<p>æ›´å¦™çš„æ˜¯,æ¨¡å—çš„é…ç½®ä¹Ÿæ˜¯ç‹¬ç«‹çš„ã€‚ä¸åƒä¼ ç»Ÿ Laravel é¡¹ç›®é‡Œæ‰€æœ‰é…ç½®éƒ½å †åœ¨ <code>config/</code> ç›®å½•ä¸‹,CatchAdmin çš„æ¨¡å—é…ç½®æ˜¯è¿™æ ·è®¿é—®çš„:</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// è®¿é—® permissions æ¨¡å—çš„é…ç½®</span>
<span class="hljs-title function_ invoke__">config</span>(<span class="hljs-string">'permissions.one.some_key'</span>)
</code></pre>
<p>è¿™ç§è®¾è®¡è®©æ¨¡å—ä¹‹é—´çš„è¾¹ç•Œéå¸¸æ¸…æ™°ã€‚æˆ‘å¯ä»¥æ”¾å¿ƒåœ°å¼€å‘è‡ªå·±çš„ä¸šåŠ¡æ¨¡å—,ä¸ç”¨æ‹…å¿ƒä¼šå½±å“åˆ°å…¶ä»–åŠŸèƒ½ã€‚å¦‚æœæŸå¤©ä¸éœ€è¦æŸä¸ªæ¨¡å—äº†,ç›´æ¥å¸è½½å³å¯,ä¸ä¼šç•™ä¸‹ä»»ä½•"é—è¿¹"ã€‚</p>
<h3 data-id="heading-4">ä»£ç ç”Ÿæˆå™¨:ä»é‡å¤åŠ³åŠ¨ä¸­è§£æ”¾</h3>
<p>å¦‚æœè¯´æ¨¡å—åŒ–è®¾è®¡æ˜¯ CatchAdmin çš„éª¨æ¶,é‚£ä»£ç ç”Ÿæˆå™¨å°±æ˜¯å®ƒçš„çµé­‚ã€‚</p>
<p>åšåå°å¼€å‘,æœ€çƒ¦çš„å°±æ˜¯å†™ CRUDã€‚ç”¨æˆ·è¡¨è¦ CRUD,æ–‡ç« è¡¨è¦ CRUD,è®¢å•è¡¨ä¹Ÿè¦ CRUDâ€¦â€¦æ¯æ¬¡éƒ½æ˜¯å¤åˆ¶ç²˜è´´æ”¹å­—æ®µå,æ¯ç‡¥åˆå®¹æ˜“å‡ºé”™ã€‚CatchAdmin çš„ä»£ç ç”Ÿæˆå™¨å½»åº•è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨åå°çš„"ä»£ç ç”Ÿæˆ"æ¨¡å—é‡Œ,æˆ‘åªéœ€è¦:</p>
<ol>
<li>é€‰æ‹©ä¸€å¼ æ•°æ®è¡¨(æ¯”å¦‚ <code>articles</code>)</li>
<li>åœ¨å¯è§†åŒ–ç•Œé¢ä¸Šé…ç½®å­—æ®µä¿¡æ¯:å“ªäº›å­—æ®µè¦åœ¨åˆ—è¡¨é¡µæ˜¾ç¤º,å“ªäº›è¦åœ¨è¡¨å•é‡Œç¼–è¾‘,ç”¨ä»€ä¹ˆç»„ä»¶(è¾“å…¥æ¡†ã€ä¸‹æ‹‰æ¡†ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç­‰)</li>
<li>ç‚¹å‡»"ä¸€é”®ç”Ÿæˆ"</li>
</ol>
<p>ç„¶å,é­”æ³•å‘ç”Ÿäº†ã€‚åç«¯çš„ Controllerã€Modelã€Request éªŒè¯ç±»,å‰ç«¯çš„åˆ—è¡¨é¡µã€æ–°å¢é¡µã€ç¼–è¾‘é¡µ,å…¨éƒ¨è‡ªåŠ¨ç”Ÿæˆå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ã€‚åˆ·æ–°é¡µé¢,å·¦ä¾§èœå•æ å·²ç»å‡ºç°äº†"æ–‡ç« ç®¡ç†"é¡¹,å®Œæ•´çš„å¢åˆ æ”¹æŸ¥ã€æœç´¢ã€å¯¼å‡ºåŠŸèƒ½å…¨éƒ½å°±ç»ªã€‚</p>
<p>æˆ‘å‡ ä¹æ²¡æœ‰æ‰‹å†™ä¸€è¡Œä¸šåŠ¡ä»£ç ,å°±å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½æ¨¡å—ã€‚è¿™ç§æ•ˆç‡æå‡,æ˜¯è´¨çš„é£è·ƒã€‚</p>
<h3 data-id="heading-5">æƒé™ä½“ç³»:ç»†è‡´åˆ°è®©äººå®‰å¿ƒ</h3>
<p>åå°ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯æƒé™æ§åˆ¶ã€‚CatchAdmin åœ¨è¿™æ–¹é¢åšå¾—å¾ˆæ‰å®ã€‚</p>
<p>å®ƒé‡‡ç”¨çš„æ˜¯æ ‡å‡†çš„ RBAC(åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)æ¨¡å‹,ä½†åšäº†å¾ˆå¤šç»†èŠ‚ä¼˜åŒ–:</p>
<p><strong>ä¸‰çº§æƒé™ç®¡æ§</strong>:èœå•æƒé™ã€æŒ‰é’®æƒé™ã€æ•°æ®æƒé™ã€‚ä¸ä»…å¯ä»¥æ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›èœå•,è¿˜èƒ½æ§åˆ¶èƒ½ç‚¹å‡»å“ªäº›æŒ‰é’®(æ¯”å¦‚"åˆ é™¤"æŒ‰é’®),ç”šè‡³èƒ½æ§åˆ¶èƒ½çœ‹åˆ°å“ªäº›æ•°æ®(æ¯”å¦‚"åå—åŒºç»ç†åªèƒ½çœ‹åå—åŒºçš„è®¢å•")ã€‚</p>
<p><strong>éƒ¨é—¨ä¸å²—ä½</strong>:æ”¯æŒæ ‘å½¢çš„éƒ¨é—¨ç»“æ„,å¯ä»¥ç»™ç”¨æˆ·åˆ†é…å²—ä½ã€‚è¿™è®©æƒé™ç®¡ç†æ›´è´´è¿‘å®é™…ä¸šåŠ¡åœºæ™¯ã€‚</p>
<p><strong>åŠ¨æ€èœå•</strong>:èœå•æ˜¯æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€ç”Ÿæˆçš„ã€‚ä¸åŒè§’è‰²ç™»å½•åå°,çœ‹åˆ°çš„èœå•å®Œå…¨ä¸åŒã€‚è¿™åœ¨å¤šç§Ÿæˆ·æˆ–å¤šè§’è‰²çš„ç³»ç»Ÿä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>åœ¨åå°çš„"è§’è‰²ç®¡ç†"é¡µé¢,æˆ‘å¯ä»¥ç”¨æ ‘å½¢é€‰æ‹©å™¨å‹¾é€‰æƒé™,éå¸¸ç›´è§‚ã€‚é…ç½®å¥½ä¹‹å,æ•´ä¸ªæƒé™ä½“ç³»å°±è‡ªåŠ¨ç”Ÿæ•ˆäº†,ä¸éœ€è¦åœ¨ä»£ç é‡Œå†™ä¸€å † <code>if</code> åˆ¤æ–­ã€‚</p>
<h3 data-id="heading-6">æ’ä»¶ç”Ÿæ€:æ‹¥æŠ± Composer</h3>
<p>CatchAdmin V5 çš„å¦ä¸€ä¸ªäº®ç‚¹æ˜¯æ’ä»¶ç³»ç»Ÿã€‚å®ƒæ²¡æœ‰è‡ªå·±å‘æ˜ä¸€å¥—æ’ä»¶æœºåˆ¶,è€Œæ˜¯ç›´æ¥ç»‘å®š Composer ç”Ÿæ€ã€‚</p>
<p>è¿™æ„å‘³ç€ä»€ä¹ˆ?ä»»ä½•ä¸€ä¸ª Composer åŒ…éƒ½å¯ä»¥æˆä¸º CatchAdmin çš„æ’ä»¶ã€‚æˆ‘ä¸éœ€è¦å­¦ä¹ æ–°çš„æ’ä»¶å¼€å‘è§„èŒƒ,åªéœ€è¦æŒ‰ç…§ Laravel Package çš„æ ‡å‡†å†™ä»£ç ,ç„¶åé€šè¿‡ Composer å®‰è£…å³å¯ã€‚</p>
<p>è¿™ç§è®¾è®¡éå¸¸èªæ˜ã€‚å®ƒæ²¡æœ‰æŠŠè‡ªå·±å°é—­èµ·æ¥,è€Œæ˜¯æ‹¥æŠ±äº†æ•´ä¸ª PHP ç”Ÿæ€ã€‚æˆ‘å¯ä»¥è½»æ¾åœ°é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡(æ”¯ä»˜ã€çŸ­ä¿¡ã€OSS ç­‰),ä¹Ÿå¯ä»¥æŠŠè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å°è£…æˆæ’ä»¶,åœ¨ä¸åŒé¡¹ç›®é—´å¤ç”¨ã€‚</p>
<h3 data-id="heading-7">å¼€å‘ä½“éªŒ:ç»†èŠ‚é‡Œçš„è´´å¿ƒ</h3>
<p>ç”¨äº†ä¸€æ®µæ—¶é—´å,æˆ‘å‘ç° CatchAdmin åœ¨å¾ˆå¤šç»†èŠ‚ä¸Šéƒ½å¾ˆè´´å¿ƒ:</p>
<p><strong>æ“ä½œæ—¥å¿—</strong>:ç³»ç»Ÿè‡ªåŠ¨è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ,åŒ…æ‹¬è®¿é—®äº†å“ªä¸ªé¡µé¢ã€ä¿®æ”¹äº†å“ªæ¡æ•°æ®ã€‚è¿™åœ¨æ’æŸ¥é—®é¢˜æˆ–å®¡è®¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>ç™»å½•æ—¥å¿—</strong>:è®°å½•æ¯æ¬¡ç™»å½•çš„æ—¶é—´ã€IPã€è®¾å¤‡ä¿¡æ¯ã€‚å¯ä»¥å¿«é€Ÿå‘ç°å¼‚å¸¸ç™»å½•ã€‚</p>
<p><strong>æ•°æ®è¡¨ç»´æŠ¤</strong>:å¯ä»¥åœ¨åå°ç›´æ¥æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„,æ¸…ç†ç¢ç‰‡,ä¼˜åŒ–è¡¨ã€‚ä¸éœ€è¦æ‰“å¼€ phpMyAdmin æˆ– Navicatã€‚</p>
<p><strong>å­—å…¸ç®¡ç†</strong>:å¯¹äºä¸€äº›å›ºå®šçš„æšä¸¾å€¼(æ¯”å¦‚"è®¢å•çŠ¶æ€:å¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€å·²å–æ¶ˆ"),å¯ä»¥åœ¨å­—å…¸é‡Œç»Ÿä¸€ç®¡ç†,ç„¶ååœ¨ä»£ç é‡Œå¼•ç”¨ã€‚ç”šè‡³å¯ä»¥ä¸€é”®å¯¼å‡ºæˆ PHP æšä¸¾ç±»ã€‚</p>
<p>è¿™äº›åŠŸèƒ½çœ‹èµ·æ¥ä¸èµ·çœ¼,ä½†åœ¨å®é™…å¼€å‘ä¸­èƒ½çœä¸‹ä¸å°‘æ—¶é—´ã€‚</p>
<h3 data-id="heading-8">å‰ç«¯ä½“éªŒ:Vue3 + Element Plus çš„ç°ä»£æ„Ÿ</h3>
<p>å‰ç«¯æ˜¯åŸºäº Vue3 å’Œ Element Plus æ„å»ºçš„,ä»£ç ç»„ç»‡å¾—å¾ˆæ¸…æ™°ã€‚CatchAdmin å°è£…äº†ä¸€å¥— Composition API çš„ Hooks,ç”¨èµ·æ¥éå¸¸é¡ºæ‰‹:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ—è¡¨é¡µ</span>
<span class="hljs-keyword">const</span> { data, query, search, reset, loading } = <span class="hljs-title function_">useGetList</span>(api)
<span class="hljs-keyword">const</span> tableData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> data.<span class="hljs-property">value</span>?.<span class="hljs-property">data</span>)

<span class="hljs-comment">// æ–°å¢/ç¼–è¾‘</span>
<span class="hljs-keyword">const</span> { formData, form, loading, submitForm, close } = <span class="hljs-title function_">useCreate</span>(props.<span class="hljs-property">api</span>, props.<span class="hljs-property">primary</span>)

<span class="hljs-comment">// åˆ é™¤</span>
<span class="hljs-keyword">const</span> { destroy, deleted } = <span class="hljs-title function_">useDestroy</span>()
</code></pre>
<p>è¿™äº› Hooks æŠŠå¸¸è§çš„ CRUD æ“ä½œéƒ½å°è£…å¥½äº†,æˆ‘åªéœ€è¦ä¼ å…¥ API åœ°å€,å°±èƒ½å¿«é€Ÿæ­å»ºå‡ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é¡µé¢ã€‚</p>
<p>å‰ç«¯æ”¯æŒ"å³æ—¶æ¸²æŸ“",ä¹Ÿå°±æ˜¯è¯´æˆ‘å¯ä»¥åœ¨ä¸ç¼–è¯‘çš„æƒ…å†µä¸‹ç›´æ¥ä¿®æ”¹ Vue æ–‡ä»¶,åˆ·æ–°æµè§ˆå™¨å°±èƒ½çœ‹åˆ°æ•ˆæœã€‚è¿™åœ¨å¼€å‘é˜¶æ®µéå¸¸æ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-9">ä¸€ä¸ªå…·ä½“çš„åœºæ™¯:å¿«é€Ÿæ­å»º CMS</h3>
<p>å‡è®¾æˆ‘è¦ç”¨ CatchAdmin æ­å»ºä¸€ä¸ªç®€å•çš„å†…å®¹ç®¡ç†ç³»ç»Ÿ(CMS)ã€‚éœ€è¦ç®¡ç†æ–‡ç« ã€åˆ†ç±»ã€æ ‡ç­¾ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>:åˆ›å»ºæ•°æ®è¡¨ã€‚æˆ‘å¯ä»¥ç”¨ Laravel çš„ Migration,ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ CatchAdmin çš„"Schema ç®¡ç†"é‡Œå¯è§†åŒ–åˆ›å»ºã€‚</p>
<p><strong>ç¬¬äºŒæ­¥</strong>:ç”¨ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆ CRUD ä»£ç ã€‚é€‰æ‹© <code>articles</code> è¡¨,é…ç½®å­—æ®µ(æ ‡é¢˜ç”¨è¾“å…¥æ¡†,å†…å®¹ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨,åˆ†ç±»ç”¨ä¸‹æ‹‰æ¡†),ä¸€é”®ç”Ÿæˆã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥</strong>:é…ç½®æƒé™ã€‚åœ¨"è§’è‰²ç®¡ç†"é‡Œç»™"ç¼–è¾‘"è§’è‰²åˆ†é…"æ–‡ç« ç®¡ç†"æƒé™ã€‚</p>
<p><strong>ç¬¬å››æ­¥</strong>:å¦‚æœéœ€è¦è‡ªå®šä¹‰é€»è¾‘(æ¯”å¦‚æ–‡ç« å‘å¸ƒæ—¶è‡ªåŠ¨æ¨é€é€šçŸ¥),åœ¨ç”Ÿæˆçš„ Controller é‡ŒåŠ å‡ è¡Œä»£ç å³å¯ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹,æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¹‹å¤–çš„ä»£ç ,æˆ‘å‡ ä¹ä¸€è¡Œéƒ½æ²¡å†™ã€‚è¿™å°±æ˜¯ CatchAdmin å¸¦æ¥çš„æ•ˆç‡æå‡ã€‚</p>
<h3 data-id="heading-10">æ€§èƒ½ä¸ç¨³å®šæ€§</h3>
<p>CatchAdmin åŸºäº Laravel 12,å……åˆ†åˆ©ç”¨äº† PHP 8+ çš„ç‰¹æ€§ã€‚åœ¨æˆ‘çš„æµ‹è¯•ç¯å¢ƒé‡Œ(æœ¬åœ° XAMPP,æ²¡åšä»»ä½•ä¼˜åŒ–),å“åº”é€Ÿåº¦å¾ˆå¿«,åˆ—è¡¨é¡µåŠ è½½åŸºæœ¬åœ¨ 100ms ä»¥å†…ã€‚</p>
<p>å½“ç„¶,å®ƒæ¯•ç«Ÿæ˜¯ä¼ ç»Ÿçš„ PHP-FPM æ¨¡å¼,ä¸åƒ Swoole æˆ– Webman é‚£æ ·å¸¸é©»å†…å­˜ã€‚å¦‚æœå¯¹æ€§èƒ½æœ‰æè‡´è¦æ±‚,å¯ä»¥è€ƒè™‘å®˜æ–¹æä¾›çš„ Webman ç‰ˆæœ¬ã€‚ä½†å¯¹äºå¤§å¤šæ•°ä¸­å°å‹é¡¹ç›®æ¥è¯´,Laravel ç‰ˆæœ¬çš„æ€§èƒ½å·²ç»å®Œå…¨å¤Ÿç”¨ã€‚</p>
<h3 data-id="heading-11">é€‚ç”¨åœºæ™¯</h3>
<p>ç”¨äº†ä¸€æ®µæ—¶é—´å,æˆ‘è§‰å¾— CatchAdmin ç‰¹åˆ«é€‚åˆè¿™äº›åœºæ™¯:</p>
<p><strong>ä¼ä¸šå†…éƒ¨ç®¡ç†ç³»ç»Ÿ</strong>:OAã€CRMã€è¿›é”€å­˜ç­‰ã€‚æ¨¡å—åŒ–è®¾è®¡è®©ä½ å¯ä»¥æŒ‰éœ€ç»„åˆåŠŸèƒ½,ä¸ä¼šæœ‰å¤ªå¤šå†—ä½™ã€‚</p>
<p><strong>SaaS å¹³å°çš„ç®¡ç†åå°</strong>:å¤šç§Ÿæˆ·ã€å¤šè§’è‰²çš„æƒé™ç®¡ç†æ˜¯åˆšéœ€,CatchAdmin çš„ RBAC ä½“ç³»èƒ½å¾ˆå¥½åœ°æ»¡è¶³ã€‚</p>
<p><strong>å†…å®¹ç®¡ç†ç³»ç»Ÿ</strong>:CMSã€åšå®¢ã€æ–°é—»ç«™ç­‰ã€‚ä»£ç ç”Ÿæˆå™¨èƒ½å¿«é€Ÿæ­å»ºå‡ºå†…å®¹ç®¡ç†çš„åŸºç¡€æ¡†æ¶ã€‚</p>
<p><strong>å¿«é€ŸåŸå‹å¼€å‘</strong>:å¦‚æœä½ éœ€è¦åœ¨çŸ­æ—¶é—´å†…åšå‡ºä¸€ä¸ªå¯æ¼”ç¤ºçš„åå°ç³»ç»Ÿ,CatchAdmin æ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<h3 data-id="heading-12">ä¸€äº›æ€è€ƒ</h3>
<p>ä½“éªŒ CatchAdmin V5 çš„è¿‡ç¨‹,è®©æˆ‘å¯¹"æ¡†æ¶"è¿™ä¸ªæ¦‚å¿µæœ‰äº†æ–°çš„ç†è§£ã€‚</p>
<p>å¥½çš„æ¡†æ¶ä¸åº”è¯¥æ˜¯ä¸€ä¸ª"é»‘ç›’",è€Œåº”è¯¥æ˜¯ä¸€ä¸ª"è„šæ‰‹æ¶"ã€‚å®ƒæä¾›äº†åšå®çš„åŸºç¡€å’Œä¾¿æ·çš„å·¥å…·,ä½†ä¸ä¼šé™åˆ¶ä½ çš„å‘æŒ¥ç©ºé—´ã€‚CatchAdmin åœ¨è¿™æ–¹é¢åšå¾—å¾ˆå¥½:æ¨¡å—åŒ–è®¾è®¡è®©ä½ å¯ä»¥è‡ªç”±ç»„åˆåŠŸèƒ½,ä»£ç ç”Ÿæˆå™¨å¸®ä½ å¤„ç†é‡å¤åŠ³åŠ¨,æ’ä»¶ç³»ç»Ÿè®©ä½ å¯ä»¥æ— ç¼é›†æˆç¬¬ä¸‰æ–¹èƒ½åŠ›ã€‚</p>
<p>å®ƒæ²¡æœ‰è¯•å›¾æˆä¸º"å¤§è€Œå…¨"çš„è§£å†³æ–¹æ¡ˆ,è€Œæ˜¯ä¸“æ³¨äºåšå¥½"åå°ç®¡ç†ç³»ç»Ÿ"è¿™ä¸€ä»¶äº‹ã€‚è¿™ç§å…‹åˆ¶,åè€Œè®©å®ƒæ›´åŠ å®ç”¨ã€‚</p>
<h3 data-id="heading-13">å†™åœ¨æœ€å</h3>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªç°ä»£åŒ–çš„ Laravel åå°ç®¡ç†ç³»ç»Ÿæ¡†æ¶,æˆ–è€…å¯¹ç°æœ‰æ–¹æ¡ˆçš„å¼€å‘æ•ˆç‡æ„Ÿåˆ°ä¸æ»¡,æˆ‘å»ºè®®ä½ èŠ±åŠä¸ªå°æ—¶è¯•è¯• CatchAdmin V5ã€‚</p>
<p>å®ƒä¸ä¼šè®©ä½ å¤±æœ›ã€‚æ¨¡å—åŒ–çš„æ¶æ„ã€å¼ºå¤§çš„ä»£ç ç”Ÿæˆå™¨ã€å®Œå–„çš„æƒé™ä½“ç³»,ä»¥åŠå¯¹ Laravel ç”Ÿæ€çš„æ·±åº¦æ•´åˆ,éƒ½è®©å®ƒæˆä¸ºä¸€ä¸ªå€¼å¾—ä¿¡èµ–çš„é€‰æ‹©ã€‚</p>
<p>å¥½çš„å·¥å…·è‡ªå·±ä¼šè¯´è¯ã€‚å½“ä½ ç¬¬ä¸€æ¬¡ç”¨ä»£ç ç”Ÿæˆå™¨ä¸€é”®ç”Ÿæˆå‡ºä¸€ä¸ªå®Œæ•´çš„ CRUD æ¨¡å—æ—¶,ä½ å°±ä¼šæ˜ç™½æˆ‘åœ¨è¯´ä»€ä¹ˆã€‚</p>
<p>Laravel ç”Ÿæ€ä¾ç„¶å……æ»¡æ´»åŠ›,è€Œ CatchAdmin æ­£æ˜¯è¿™ç§æ´»åŠ›çš„è¯æ˜ã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬,PHP åå°å¼€å‘å¯ä»¥æ›´é«˜æ•ˆã€æ›´ä¼˜é›…ã€æ›´ç°ä»£ã€‚</p>
<h3 data-id="heading-14">é¡¹ç›®åœ°å€</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJaguarJack%2Fcatch-admin" target="_blank" title="https://github.com/JaguarJack/catch-admin" ref="nofollow noopener noreferrer">GitHub åœ°å€</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcatchadmin%2FcatchAdmin" target="_blank" title="https://gitee.com/catchadmin/catchAdmin" ref="nofollow noopener noreferrer">Gitee åœ°å€</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§]]></title>    <link>https://juejin.cn/post/7585458459167195170</link>    <guid>https://juejin.cn/post/7585458459167195170</guid>    <pubDate>2025-12-21T00:17:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459167195170" data-draft-id="7585476892977152034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-21T00:17:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T00:17:03.000Z" title="Sun Dec 21 2025 00:17:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼ŒJavaScriptçš„æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚éšç€åº”ç”¨å¤æ‚åº¦çš„æå‡ï¼Œå†…å­˜æ³„æ¼ã€GCï¼ˆåƒåœ¾å›æ”¶ï¼‰åœé¡¿å’Œä½æ•ˆçš„ä»£ç æ‰§è¡Œæˆä¸ºå¼€å‘è€…é¢ä¸´çš„å¸¸è§é—®é¢˜ã€‚V8å¼•æ“ä½œä¸ºChromeå’ŒNode.jsçš„æ ¸å¿ƒï¼Œå…¶å†…éƒ¨æœºåˆ¶å¯¹JavaScriptçš„æ‰§è¡Œæ•ˆç‡æœ‰ç€å†³å®šæ€§å½±å“ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æV8å¼•æ“çš„7ä¸ªå…³é”®åŸç†ï¼Œå¹¶ç»“åˆå®æˆ˜æŠ€å·§ï¼Œå¸®åŠ©ä½ å°†å†…å­˜æ³„æ¼å‡å°‘90%ï¼ŒåŒæ—¶æå‡ä»£ç è¿è¡Œæ•ˆç‡ã€‚</p>
<h2 data-id="heading-2">1. ç†è§£V8çš„å†…å­˜æ¨¡å‹</h2>
<h3 data-id="heading-3">å †å†…å­˜çš„åˆ†ä»£ç®¡ç†</h3>
<p>V8å°†å †å†…å­˜åˆ†ä¸º<strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰<strong>å’Œ</strong>è€ç”Ÿä»£ï¼ˆOld Generationï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æ–°ç”Ÿä»£</strong>ï¼šå­˜æ”¾å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ï¼Œé€šè¿‡Scavengeç®—æ³•å¿«é€Ÿå›æ”¶ã€‚</li>
<li><strong>è€ç”Ÿä»£</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œé‡‡ç”¨æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰å’Œæ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡ï¼Œç›´æ¥åˆ†é…åˆ°è€ç”Ÿä»£ä¼šå¢åŠ GCå‹åŠ›ã€‚</li>
<li>ä½¿ç”¨<code>Object.assign</code>æˆ–å±•å¼€è¿ç®—ç¬¦æ›¿ä»£æ·±æ‹·è´ï¼Œå‡å°‘ä¸´æ—¶å¯¹è±¡ç”Ÿæˆã€‚</li>
</ul>
<h2 data-id="heading-4">2. éšè—ç±»ä¸å†…è”ç¼“å­˜ï¼ˆInline Cacheï¼‰</h2>
<h3 data-id="heading-5">éšè—ç±»ï¼ˆHidden Classï¼‰</h3>
<p>V8é€šè¿‡éšè—ç±»ä¼˜åŒ–å±æ€§è®¿é—®é€Ÿåº¦ã€‚å½“å¯¹è±¡ç»“æ„å˜åŒ–æ—¶ï¼ˆå¦‚åŠ¨æ€æ·»åŠ å±æ€§ï¼‰ï¼Œéšè—ç±»ä¼šå¤±æ•ˆï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>åœ¨æ„é€ å‡½æ•°ä¸­ä¸€æ¬¡æ€§åˆå§‹åŒ–æ‰€æœ‰å±æ€§ã€‚</li>
<li>é¿å…ä½¿ç”¨<code>delete</code>åˆ é™¤å¯¹è±¡å±æ€§ï¼Œè¿™ä¼šç ´åéšè—ç±»ã€‚</li>
</ul>
<h3 data-id="heading-6">å†…è”ç¼“å­˜</h3>
<p>V8é€šè¿‡å†…è”ç¼“å­˜ç¼“å­˜æ–¹æ³•è°ƒç”¨è·¯å¾„ï¼ŒåŠ é€Ÿé‡å¤æ“ä½œã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä¿æŒå‡½æ•°å‚æ•°ç±»å‹ç¨³å®šï¼Œé¿å…å¤šæ€è°ƒç”¨ï¼ˆå¦‚åŒä¸€å‡½æ•°å¤„ç†å¤šç§ç±»å‹å‚æ•°ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-7">3. é€ƒé€¸åˆ†æä¸æ ˆåˆ†é…</h2>
<h3 data-id="heading-8">é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰</h3>
<p>V8ä¼šåˆ†æå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœå¯¹è±¡æœªé€ƒé€¸å‡ºå‡½æ•°ä½œç”¨åŸŸï¼Œå¯èƒ½è¢«åˆ†é…åˆ°æ ˆä¸Šè€Œéå †ä¸­ï¼Œä»è€Œå‡å°‘GCå‹åŠ›ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>å°½é‡é™åˆ¶å¯¹è±¡çš„å¯è§èŒƒå›´ï¼ˆå¦‚ä½¿ç”¨é—­åŒ…æ—¶è°¨æ…æš´éœ²å¯¹è±¡ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-9">4. GCè§¦å‘æœºåˆ¶ä¸ä¼˜åŒ–ç­–ç•¥</h2>
<h3 data-id="heading-10">Major GCä¸Minor GC</h3>
<ul>
<li><strong>Minor GC</strong>ï¼šé¢‘ç¹æ¸…ç†æ–°ç”Ÿä»£ï¼Œé€Ÿåº¦å¿«ä½†å¯èƒ½å¼•å‘çŸ­æš‚åœé¡¿ã€‚</li>
<li><strong>Major GC</strong>ï¼šæ¸…ç†è€ç”Ÿä»£ï¼Œè€—æ—¶é•¿ä¸”é˜»å¡ä¸»çº¿ç¨‹ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>weakMap</code>æˆ–<code>weakSet</code>å­˜å‚¨ä¸´æ—¶å¼•ç”¨ï¼Œé¿å…å¹²æ‰°GCã€‚</li>
<li>Node.jsä¸­å¯é€šè¿‡<code>--max-old-space-size</code>è°ƒæ•´è€ç”Ÿä»£å¤§å°ã€‚</li>
</ul>
<h2 data-id="heading-11">5. TurboFanç¼–è¯‘å™¨ä¸çƒ­ç‚¹ä»£ç ä¼˜åŒ–</h2>
<h3 data-id="heading-12">JITç¼–è¯‘æµç¨‹</h3>
<p>V8é€šè¿‡Ignitionè§£é‡Šå™¨ç”Ÿæˆå­—èŠ‚ç ï¼ŒTurboFanå°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºé«˜æ•ˆæœºå™¨ç ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>é¿å…åœ¨çƒ­ç‚¹ä»£ç ä¸­ä½¿ç”¨<code>eval</code>æˆ–<code>with</code>ï¼Œå®ƒä»¬ä¼šé˜»æ­¢TurboFanä¼˜åŒ–ã€‚</li>
<li>ä½¿ç”¨ç±»å‹æ˜ç¡®çš„å˜é‡ï¼ˆå¦‚<code>let sum = 0</code>è€Œé<code>let sum = ''</code>ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-13">6. å†…å­˜æ³„æ¼çš„å¸¸è§æ¨¡å¼ä¸æ’æŸ¥</h2>
<h3 data-id="heading-14">å…¸å‹æ³„æ¼åœºæ™¯</h3>
<ol>
<li><strong>å…¨å±€å˜é‡æ±¡æŸ“</strong>ï¼šæ„å¤–å®šä¹‰çš„å…¨å±€å˜é‡æ— æ³•è¢«å›æ”¶ã€‚</li>
<li><strong>é—­åŒ…å¼•ç”¨</strong>ï¼šæœªé‡Šæ”¾çš„å¤–éƒ¨å˜é‡å¯¼è‡´é—­åŒ…æŒæœ‰å†…å­˜ã€‚</li>
<li><strong>å®šæ—¶å™¨/äº‹ä»¶ç›‘å¬æœªæ¸…é™¤</strong>ï¼šå¦‚æœªæ¸…ç†çš„<code>setInterval</code>æˆ–DOMäº‹ä»¶ç»‘å®šã€‚</li>
</ol>
<p><strong>æ’æŸ¥å·¥å…·</strong>ï¼š</p>
<ul>
<li>Chrome DevToolsçš„Memoryé¢æ¿ï¼ˆHeap Snapshotså¯¹æ¯”ï¼‰ã€‚</li>
<li>Node.jsçš„<code>heapdump</code>æ¨¡å—ç”Ÿæˆå †å¿«ç…§åˆ†æã€‚</li>
</ul>
<h2 data-id="heading-15">7. ArrayBufferä¸SharedArrayBufferçš„é«˜æ•ˆä½¿ç”¨</h2>
<h3 data-id="heading-16">TypedArrayä¸å†…å­˜å…±äº«</h3>
<p>ç›´æ¥æ“ä½œäºŒè¿›åˆ¶æ•°æ®å¯å‡å°‘ä¸­é—´è½¬æ¢å¼€é”€ï¼Œä½†éœ€æ³¨æ„å†…å­˜å®‰å…¨ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨TypedArrayè€Œéæ™®é€šæ•°ç»„å¤„ç†å¤§æ•°æ®é›†ã€‚</li>
<li>SharedArrayBufferéœ€é…åˆAtomicsé¿å…ç«æ€æ¡ä»¶ï¼ˆä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡å¯ç”¨ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-17">æ€»ç»“</h2>
<p>ç†è§£V8çš„å†…éƒ¨å·¥ä½œåŸç†æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚é€šè¿‡åˆç†åˆ©ç”¨éšè—ç±»ã€æ§åˆ¶GCè¡Œä¸ºã€é¿å…å†…å­˜æ³„æ¼æ¨¡å¼ä»¥åŠå–„ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ç‰¹æ€§ï¼Œå¼€å‘è€…å¯ä»¥æ˜¾è‘—æå‡JavaScriptåº”ç”¨çš„æ•ˆç‡å¹¶å‡å°‘èµ„æºæ¶ˆè€—ã€‚å»ºè®®ç»“åˆChrome DevToolså’ŒNode.jsçš„åˆ†æå·¥å…·æŒç»­ç›‘æ§æ€§èƒ½è¡¨ç°ï¼Œå°†ç†è®ºè½¬åŒ–ä¸ºå®è·µä¸­çš„é«˜æ€§èƒ½ä»£ç ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[INFINI Labs äº§å“æ›´æ–° - Coco AI v0.10 Ã— Easysearch v2.0 è”è¢‚ä¸Šçº¿ï¼šUI å…¨é¢é‡æ„ï¼Œä½“éªŒç„•ç„¶ä¸€æ–°]]></title>    <link>https://juejin.cn/post/7585474459777040420</link>    <guid>https://juejin.cn/post/7585474459777040420</guid>    <pubDate>2025-12-20T16:01:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459777040420" data-draft-id="7585485074038226950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="INFINI Labs äº§å“æ›´æ–° - Coco AI v0.10 Ã— Easysearch v2.0 è”è¢‚ä¸Šçº¿ï¼šUI å…¨é¢é‡æ„ï¼Œä½“éªŒç„•ç„¶ä¸€æ–°"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,æ•°æ®åº“,äº§å“"/> <meta itemprop="datePublished" content="2025-12-20T16:01:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æé™å®éªŒå®¤"/> <meta itemprop="url" content="https://juejin.cn/user/1258294223312599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            INFINI Labs äº§å“æ›´æ–° - Coco AI v0.10 Ã— Easysearch v2.0 è”è¢‚ä¸Šçº¿ï¼šUI å…¨é¢é‡æ„ï¼Œä½“éªŒç„•ç„¶ä¸€æ–°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1258294223312599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æé™å®éªŒå®¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T16:01:14.000Z" title="Sat Dec 20 2025 16:01:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b3cf45ea364c72b6de8313cd849c09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=oZ4jGSnf%2FriNljOwhOrN5VLvAAc%3D" alt="release" loading="lazy"/></p>
<p>æ­¤æ¬¡æ›´æ–°ä¸»è¦åŒ…æ‹¬ Coco AI v0.10.0 æ›´æ¢å…¨æ–°çš„ UI ç»„ä»¶ï¼ŒæœåŠ¡ç«¯æ–°å¢ milvus å’Œ dropbox è¿æ¥å™¨ï¼›Easysearch v2.0.2 æ­£å¼å‘å¸ƒï¼Œ æ–°å¢åµŒå…¥æ–‡æ¡£è¯­ä¹‰æœç´¢ï¼Œä¼˜åŒ–å†…ç½® UI å“åº”é€Ÿåº¦ï¼Œæ— éœ€ä¾èµ– Kibanaï¼Œå®ç°é›†ç¾¤â€œå¼€ç®±å³ç®¡â€ï¼›INFINI Consoleã€Gatewayã€Agentã€Loadgen v1.30.1.1 ç»Ÿä¸€åŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fv1.4.0" target="_blank" title="https://docs.infinilabs.com/framework/v1.4.0" ref="nofollow noopener noreferrer">Framework v1.4.0</a> å‡çº§ï¼Œä¼˜åŒ–æœ¬åœ°ç£ç›˜é˜Ÿåˆ—æ•°æ®æ¶ˆè´¹ã€‚è¯¦æƒ…è§ Release Notesã€‚</p>
<h2 data-id="heading-0">Coco AI 0.10</h2>
<p>Coco AI æ˜¯ä¸€æ¬¾å®Œå…¨å¼€æºã€è·¨å¹³å°çš„ä¼ä¸šçº§æ™ºèƒ½æœç´¢ä¸åŠ©æ‰‹ç³»ç»Ÿï¼Œä¸“ä¸ºç°ä»£ä¼ä¸šæ‰“é€ ã€‚å®ƒé€šè¿‡ç»Ÿä¸€æœç´¢å…¥å£ï¼Œè¿æ¥ä¼ä¸šå†…å¤–éƒ¨çš„å¼‚æ„æ•°æ®æºï¼Œèåˆå¤§æ¨¡å‹èƒ½åŠ›ï¼Œå¸®åŠ©å›¢é˜Ÿé«˜æ•ˆè®¿é—®çŸ¥è¯†ï¼Œæ™ºèƒ½å†³ç­–åä½œã€‚</p>
<p>Coco AI æœ¬æ¬¡è¯¦ç»†æ›´æ–°è®°å½•å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-1">Coco AI å®¢æˆ·ç«¯ 0.10</h3>
<h3 data-id="heading-2">ğŸš€ åŠŸèƒ½ç‰¹æ€§ (Features)</h3>
<ul>
<li>æ‰©å±•ç¨‹åº UI æ”¯æŒå¯è°ƒæ•´çª—å£å¤§å°
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cfcf0f5ec5344df971c8f8c25a2248e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=3LfmwUilwxIzsCn8vyvdXrCTdA0%3D" alt="" loading="lazy"/></li>
<li>æ·»åŠ æ‰“å¼€æŒ‰é’®ä»¥å¯åŠ¨å·²å®‰è£…çš„æ‰©å±•ç¨‹åº
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d1cda9fedda4197af56eb70064d658c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=ISfKKivS0PHL8zO%2F9NSioqUGW04%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-3">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>å°†åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶æœç´¢è§†ä¸ºæ™®é€šæ‰©å±•</li>
<li>é€šè¿‡æ·±åº¦é“¾æ¥å®‰è£…æ‰©å±•å¤±è´¥æ—¶ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ˆè€Œéé”™è¯¯ä»£ç ï¼‰</li>
<li>ç”¨ shadcn/ui ç»„ä»¶æ›¿æ¢æ—§ç»„ä»¶
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9905d490877f422cbe393caa6a46fe3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=HbdZKDHyWZ2tcZlqU7%2BHCHvSeHc%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f918d306c56435e92a6c28f477c2b4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=O7NQ5NE2Xpyc%2BMUnSgj3MCbH50c%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-4">ğŸ› é—®é¢˜ä¿®å¤(Bug Fixes)</h3>
<ul>
<li>ä¿®å¤è¾“å…¥æ¡†é«˜åº¦å¼‚å¸¸é—®é¢˜</li>
<li>ä¸º Extension.minimum_coco_version å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–</li>
</ul>
<h3 data-id="heading-5">Coco AI æœåŠ¡ç«¯ 0.10</h3>
<h3 data-id="heading-6">ğŸš€ åŠŸèƒ½ç‰¹æ€§ (Features)</h3>
<ul>
<li>æ–°å¢ milvus è¿æ¥å™¨
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aa68d6552f84388955e7ac844d83011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=cYEfJ%2FLrQuWbhOPJfZU7srw3Rcs%3D" alt="" loading="lazy"/></li>
<li>æ–°å¢ dropbox è¿æ¥å™¨
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/150a330ec4814e3ca1653ba8be66bbeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=bDnQGicjduBQaEJa8EqbtG%2Bs64E%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-7">ğŸ› é—®é¢˜ä¿®å¤(Bug Fixes)</h3>
<ul>
<li>ä¿®å¤æœç´¢ API ä¸­å›¾æ ‡ç»å¯¹ URL çš„è§£æé—®é¢˜</li>
<li>ä¿®å¤é›†æˆå•†åº—è¯»å–å‰ªè´´æ¿æ•°æ®åçš„æ˜¾ç¤ºé—®é¢˜</li>
</ul>
<h3 data-id="heading-8">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>ç§»é™¤åˆ†é¡µå¹¶åœ¨å…¨å±æ¨¡å¼ä¸‹æ·»åŠ æ— é™æ»šåŠ¨</li>
</ul>
<h2 data-id="heading-9">Easysearch v2.0.2</h2>
<p>INFINI Easysearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å‹æ•°æ®åº“ï¼Œå®ç°éç»“æ„åŒ–æ•°æ®æ£€ç´¢ã€å…¨æ–‡æ£€ç´¢ã€å‘é‡æ£€ç´¢ã€åœ°ç†ä½ç½®ä¿¡æ¯æŸ¥è¯¢ã€ç»„åˆç´¢å¼•æŸ¥è¯¢ã€å¤šè¯­ç§æ”¯æŒã€èšåˆåˆ†æç­‰ã€‚Easysearch å¯ä»¥å®Œç¾æ›¿ä»£ Elasticsearchï¼ŒåŒæ—¶æ·»åŠ å’Œå®Œå–„å¤šé¡¹ä¼ä¸šçº§åŠŸèƒ½ã€‚Easysearch åŠ©æ‚¨æ‹¥æœ‰ç®€æ´ã€é«˜æ•ˆã€æ˜“ç”¨çš„æœç´¢ä½“éªŒã€‚</p>
<p>Easysearch æœ¬æ¬¡æ›´æ–°å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-10">ğŸ’¥ é‡å¤§å˜æ›´(Breaking Changes)</h3>
<ul>
<li>æ­£å¼å‘å¸ƒ Easysearch 2.0.2 ç‰ˆæœ¬ï¼Œåº•å±‚ Lucene æ›´æ–°åˆ° 9.12.2</li>
<li>æ–°å¢ ui æ’ä»¶ï¼Œä¸º Easysearch æä¾›äº†è½»é‡çº§ç•Œé¢åŒ–ç®¡ç†åŠŸèƒ½ï¼Œä¸å†ä¾èµ–ç¬¬ä¸‰æ–¹å¯¹é›†ç¾¤è¿›è¡Œç®¡ç†ï¼ŒçœŸæ­£åšåˆ°å¼€ç®±å³ç”¨</li>
</ul>
<h3 data-id="heading-11">ğŸš€ åŠŸèƒ½ç‰¹æ€§ (Features)</h3>
<ul>
<li>è¯­ä¹‰æœç´¢æ–°å¢æ”¯æŒ NestedQueryBuilder</li>
<li>KNN mapping çš„ L å’Œ k å‚æ•°æ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿï¼Œæå‡æ˜“ç”¨æ€§</li>
</ul>
<h3 data-id="heading-12">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>UI æ’ä»¶é™æ€æ–‡ä»¶æ”¯æŒ gzip å‹ç¼©ï¼ŒåŠ å¿«é¡µé¢åŠ è½½</li>
<li>ä¼˜åŒ–äº†å›¾æ ‡èµ„æºå¤§å°</li>
<li>è°ƒæ•´äº†å†…éƒ¨æ„å»ºæµç¨‹å’Œ CSP ç­–ç•¥</li>
</ul>
<h3 data-id="heading-13">ğŸ› é—®é¢˜ä¿®å¤(Bug Fixes)</h3>
<ul>
<li>ä¿®å¤äº†å¼€å‘è€…å·¥å…·çš„ä¸»é¢˜é¢œè‰²æ˜¾ç¤ºé—®é¢˜</li>
</ul>
<h2 data-id="heading-14">Console v1.30.1</h2>
<p>INFINI Console æ˜¯ä¸€æ¬¾å¼€æºçš„éå¸¸è½»é‡çº§çš„å¤šé›†ç¾¤ã€è·¨ç‰ˆæœ¬çš„æœç´¢åŸºç¡€è®¾æ–½ç»Ÿä¸€ç®¡æ§å¹³å°ã€‚é€šè¿‡å¯¹æµè¡Œçš„æœç´¢å¼•æ“åŸºç¡€è®¾æ–½è¿›è¡Œè·¨ç‰ˆæœ¬ã€å¤šé›†ç¾¤çš„é›†ä¸­çº³ç®¡ï¼Œä¼ä¸šå¯ä»¥å¿«é€Ÿæ–¹ä¾¿çš„ç»Ÿä¸€ç®¡ç†ä¼ä¸šå†…éƒ¨çš„ä¸åŒç‰ˆæœ¬çš„å¤šå¥—æœç´¢é›†ç¾¤ã€‚</p>
<p>Console æœ¬æ¬¡è¯¦ç»†æ›´æ–°è®°å½•å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-15">ğŸš€ åŠŸèƒ½ç‰¹æ€§ (Features)</h3>
<ul>
<li>æ”¯æŒ Easysearch 2.x å’Œ Opensearch 3.x</li>
</ul>
<h3 data-id="heading-16">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>æ­¤ç‰ˆæœ¬åŒ…å«äº†åº•å±‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fv1.4.0" target="_blank" title="https://docs.infinilabs.com/framework/v1.4.0" ref="nofollow noopener noreferrer">Framework v1.4.0</a> çš„æ›´æ–°ï¼Œè§£å†³äº†ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¹¶å¢å¼ºäº†æ•´ä½“ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚è™½ç„¶ Console æœ¬èº«æ²¡æœ‰ç›´æ¥çš„å˜æ›´ï¼Œä½†ä» Framework ä¸­ç»§æ‰¿çš„æ”¹è¿›é—´æ¥åœ°ä½¿ Console å—ç›Šã€‚</li>
</ul>
<h2 data-id="heading-17">Gateway v1.30.1</h2>
<p>INFINI Gateway æ˜¯ä¸€ä¸ªå¼€æºçš„é¢å‘æœç´¢åœºæ™¯çš„é«˜æ€§èƒ½æ•°æ®ç½‘å…³ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡ç½‘å…³å¤„ç†åå†è½¬å‘åˆ°åç«¯çš„æœç´¢ä¸šåŠ¡é›†ç¾¤ã€‚åŸºäº INFINI Gateway å¯ä»¥å®ç°ç´¢å¼•çº§åˆ«çš„é™é€Ÿé™æµã€å¸¸è§æŸ¥è¯¢çš„ç¼“å­˜åŠ é€Ÿã€æŸ¥è¯¢è¯·æ±‚çš„å®¡è®¡ã€æŸ¥è¯¢ç»“æœçš„åŠ¨æ€ä¿®æ”¹ç­‰ç­‰ã€‚</p>
<p>Gateway æœ¬æ¬¡æ›´æ–°å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-18">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>æ­¤ç‰ˆæœ¬åŒ…å«äº†åº•å±‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fv1.4.0" target="_blank" title="https://docs.infinilabs.com/framework/v1.4.0" ref="nofollow noopener noreferrer">Framework v1.4.0</a> çš„æ›´æ–°ï¼Œè§£å†³äº†ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¹¶å¢å¼ºäº†æ•´ä½“ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚è™½ç„¶ Gateway æœ¬èº«æ²¡æœ‰ç›´æ¥çš„å˜æ›´ï¼Œä½†ä» Framework ä¸­ç»§æ‰¿çš„æ”¹è¿›é—´æ¥åœ°ä½¿ Gateway å—ç›Šã€‚</li>
</ul>
<h2 data-id="heading-19">Agent v1.30.1</h2>
<p>INFINI Agent è´Ÿè´£é‡‡é›†å’Œä¸Šä¼  Elasticsearch, Easysearch, Opensearch é›†ç¾¤çš„æ—¥å¿—å’ŒæŒ‡æ ‡ä¿¡æ¯ï¼Œé€šè¿‡ INFINI Console ç®¡ç†ï¼Œæ”¯æŒä¸»æµæ“ä½œç³»ç»Ÿå’Œå¹³å°ï¼Œå®‰è£…åŒ…è½»é‡ä¸”æ— ä»»ä½•å¤–éƒ¨ä¾èµ–ï¼Œå¯ä»¥å¿«é€Ÿæ–¹ä¾¿åœ°å®‰è£…ã€‚</p>
<p>Agent æœ¬æ¬¡æ›´æ–°å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-20">ğŸš€ åŠŸèƒ½ç‰¹æ€§ (Features)</h3>
<ul>
<li>åœ¨ Kubernetes ç¯å¢ƒä¸‹é€šè¿‡ç¯å¢ƒå˜é‡ http.port æ¢æµ‹ Easysearch çš„ HTTP ç«¯å£</li>
</ul>
<h3 data-id="heading-21">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>æ­¤ç‰ˆæœ¬åŒ…å«äº†åº•å±‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fv1.4.0" target="_blank" title="https://docs.infinilabs.com/framework/v1.4.0" ref="nofollow noopener noreferrer">Framework v1.4.0</a> çš„æ›´æ–°ï¼Œè§£å†³äº†ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¹¶å¢å¼ºäº†æ•´ä½“ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚è™½ç„¶ Agent æœ¬èº«æ²¡æœ‰ç›´æ¥çš„å˜æ›´ï¼Œä½†ä» Framework ä¸­ç»§æ‰¿çš„æ”¹è¿›é—´æ¥åœ°ä½¿ Agent å—ç›Šã€‚</li>
</ul>
<h2 data-id="heading-22">Loadgen v1.30.1</h2>
<p>INFINI Loadgen æ˜¯ä¸€æ¬¾å¼€æºçš„ä¸“ä¸º Easysearchã€Elasticsearchã€OpenSearch è®¾è®¡çš„è½»é‡çº§æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚</p>
<p>Loadgen æœ¬æ¬¡æ›´æ–°å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-23">âœˆï¸ æ”¹è¿›ä¼˜åŒ– (Improvements)</h3>
<ul>
<li>æ­¤ç‰ˆæœ¬åŒ…å«äº†åº•å±‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fv1.4.0" target="_blank" title="https://docs.infinilabs.com/framework/v1.4.0" ref="nofollow noopener noreferrer">Framework v1.4.0</a> çš„æ›´æ–°ï¼Œè§£å†³äº†ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¹¶å¢å¼ºäº†æ•´ä½“ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚è™½ç„¶ Loadgen æœ¬èº«æ²¡æœ‰ç›´æ¥çš„å˜æ›´ï¼Œä½†ä» Framework ä¸­ç»§æ‰¿çš„æ”¹è¿›é—´æ¥åœ°ä½¿ Loadgen å—ç›Šã€‚</li>
</ul>
<h2 data-id="heading-24">Framework 1.4.0</h2>
<p>INFINI Framework æ˜¯ INFINI Labs åŸºäº Golang çš„äº§å“çš„æ ¸å¿ƒåŸºç¡€ï¼Œå·²å¼€æºã€‚è¯¥æ¡†æ¶ä»¥å¼€å‘è€…ä¸ºä¸­å¿ƒè®¾è®¡ï¼Œç®€åŒ–äº†æ„å»ºé«˜æ€§èƒ½ã€å¯æ‰©å±•ä¸”å¯é çš„åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ã€‚</p>
<p>Framework æœ¬æ¬¡æ›´æ–°å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-25">ğŸš€ åŠŸèƒ½ç‰¹æ€§ (Features)</h3>
<ul>
<li>ä¸º curl æ·»åŠ  p12 è¯ä¹¦æ”¯æŒï¼ˆ#239ï¼‰</li>
<li>ä» util ä¸­ç§»é™¤ curlï¼ˆ#242ï¼‰</li>
<li>ä¼˜å…ˆä½¿ç”¨é›†ç¾¤åç§°ï¼ˆ#243ï¼‰</li>
<li>ä¸º access_token æ·»åŠ æ ‡ç­¾ï¼ˆ#244ï¼‰</li>
<li>ä¸ºç”¨æˆ·ä¸»ä½“ï¼ˆprincipalï¼‰æ·»åŠ å¤´åƒé…ç½®ï¼ˆ#246ï¼‰</li>
</ul>
<h3 data-id="heading-26">ğŸ› é—®é¢˜ä¿®å¤ (Bug Fixes)</h3>
<ul>
<li>ä¿®å¤é‡å¤å†™å…¥å’Œæœªå†™å…¥çš„é—®é¢˜ï¼ˆ#234ï¼‰</li>
<li>å½“ filePath ä¸ºç»å¯¹è·¯å¾„æ—¶ï¼Œæ£€æŸ¥å…¶æ˜¯å¦å­˜åœ¨ï¼ˆ#241ï¼‰</li>
</ul>
<h3 data-id="heading-27">âœˆï¸ æ”¹è¿› (Improvements)</h3>
<ul>
<li>æ”¹è¿› TryGetFileAbsPath() çš„ panic é”™è¯¯ä¿¡æ¯ï¼ˆ#240ï¼‰</li>
</ul>
<p>æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ä»¥ä¸‹å„äº§å“çš„ Release Notes æˆ–è”ç³»æˆ‘ä»¬çš„æŠ€æœ¯æ”¯æŒå›¢é˜Ÿï¼</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fcoco-app%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/coco-app/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>Coco AI App</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fcoco-server%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/coco-server/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>Coco AI Server</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Feasysearch%2Fmain%2Fdocs%2Frelease-notes%2Feasysearch%2F" target="_blank" title="https://docs.infinilabs.com/easysearch/main/docs/release-notes/easysearch/" ref="nofollow noopener noreferrer"><strong>INFINI Easysearch</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fgateway%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/gateway/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Gateway</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fconsole%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/console/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Console</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fagent%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/agent/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Agent</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Floadgen%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/loadgen/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Loadgen</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/framework/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Framework</strong></a></li>
</ul>
<h2 data-id="heading-28">æœŸå¾…åé¦ˆ</h2>
<p>æ¬¢è¿ä¸‹è½½ä½“éªŒä½¿ç”¨ï¼Œå¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°å¦‚ä½•ç–‘é—®æˆ–è€…é—®é¢˜ï¼Œæ¬¢è¿å‰å¾€ INFINI Labs Githubï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs" target="_blank" title="https://github.com/infinilabs" ref="nofollow noopener noreferrer">github.com/infinilabs</a>ï¼‰ ä¸­çš„å¯¹åº”é¡¹ç›®ä¸­æäº¤ Feature Request æˆ–æäº¤ Bugã€‚</p>
<p><strong>ä¸‹è½½åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Finfinilabs.cn%2Fdownload" target="_blank" title="https://infinilabs.cn/download" ref="nofollow noopener noreferrer">infinilabs.cn/download</a></p>
<p><strong>Discord</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2F4tKTMkkvVX" target="_blank" title="https://discord.gg/4tKTMkkvVX" ref="nofollow noopener noreferrer">discord.gg/4tKTMkkvVX</a></p>
<h2 data-id="heading-29">å…³äºæé™ç§‘æŠ€ï¼ˆINFINI Labsï¼‰</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93e4ec4d3ae84094ab00fa25c078653f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851274&amp;x-signature=F0ceOW3eCRroaQgwQRHa4u0ZStY%3D" alt="INFINI Labs" loading="lazy"/></p>
<p>æé™ç§‘æŠ€ï¼Œå…¨ç§°æé™æ•°æ®ï¼ˆåŒ—äº¬ï¼‰ç§‘æŠ€æœ‰é™å…¬å¸ï¼Œæ˜¯ä¸€å®¶ä¸“æ³¨äºå®æ—¶æœç´¢ä¸æ•°æ®åˆ†æçš„è½¯ä»¶å…¬å¸ã€‚æ——ä¸‹å“ç‰Œæé™å®éªŒå®¤ï¼ˆINFINI Labsï¼‰è‡´åŠ›äºæ‰“é€ æè‡´æ˜“ç”¨çš„æ•°æ®æ¢ç´¢ä¸åˆ†æä½“éªŒã€‚</p>
<p>æé™ç§‘æŠ€æ˜¯ä¸€æ”¯å¹´è½»çš„å›¢é˜Ÿï¼Œé‡‡ç”¨å¤©ç„¶åˆ†å¸ƒå¼çš„æ–¹å¼æ¥è¿›è¡Œè¿œç¨‹åä½œï¼Œå‘˜å·¥åˆ†å¸ƒåœ¨å…¨çƒå„åœ°ï¼Œå¸Œæœ›é€šè¿‡åŠªåŠ›æˆä¸ºä¸­å›½ä¹ƒè‡³å…¨çƒä¼ä¸šå¤§æ•°æ®å®æ—¶æœç´¢åˆ†æäº§å“çš„é¦–é€‰ï¼Œä¸ºä¸­å›½æŠ€æœ¯å“ç‰Œè¾“å‡ºæ·»ç –åŠ ç“¦ã€‚</p>
<p>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Finfinilabs.cn" target="_blank" title="https://infinilabs.cn" ref="nofollow noopener noreferrer">infinilabs.cn</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ23ï¼‰Nettyçš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§å¦‚ä½•å®ç°ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585502118459883539</link>    <guid>https://juejin.cn/post/7585502118459883539</guid>    <pubDate>2025-12-20T23:58:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585502118459883539" data-draft-id="7585485074038358022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ23ï¼‰Nettyçš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§å¦‚ä½•å®ç°ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T23:58:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ23ï¼‰Nettyçš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§å¦‚ä½•å®ç°ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T23:58:17.000Z" title="Sat Dec 20 2025 23:58:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Nettyä¸­å®ç°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ï¼Œé€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œä»¥åˆ†æ•£è´Ÿè½½ã€‚</li>
<li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šç¡®ä¿ç³»ç»Ÿåœ¨éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µä¸‹ä»èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯å®ç°Nettyè´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§çš„ä¸€äº›å¸¸è§æ–¹æ³•ï¼š</p>
<h3 data-id="heading-0">è´Ÿè½½å‡è¡¡</h3>
<p>è´Ÿè½½å‡è¡¡å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨ã€DNSè½®è¯¢å’Œè½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚Nginxã€HAProxyï¼‰ã€‚åœ¨Nettyä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä»£ç å®ç°ç®€å•çš„è´Ÿè½½å‡è¡¡é€»è¾‘ã€‚</p>
<h4 data-id="heading-1">ç¤ºä¾‹ï¼šåŸºäºNettyçš„ç®€å•è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯éœ€è¦å°†è¯·æ±‚åˆ†å‘åˆ°è¿™äº›æœåŠ¡å™¨ï¼š</p>
<ol>
<li><strong>åˆ›å»ºæœåŠ¡å™¨åˆ—è¡¨å’Œé€‰æ‹©ç­–ç•¥</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadBalancer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;String&gt; serverList;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicInteger index;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LoadBalancer</span><span class="hljs-params">(List&lt;String&gt; serverList)</span> {
        <span class="hljs-built_in">this</span>.serverList = serverList;
        <span class="hljs-built_in">this</span>.index = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getNextServer</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">currentIndex</span> <span class="hljs-operator">=</span> index.getAndIncrement();
        <span class="hljs-keyword">return</span> serverList.get(currentIndex % serverList.size());
    }
}
</code></pre>
<ol start="2">
<li><strong>å®¢æˆ·ç«¯åˆå§‹åŒ–å’Œè¯·æ±‚å‘é€</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpClientCodec;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpRequest;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpResponse;

<span class="hljs-keyword">import</span> java.util.Arrays;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadBalancedHttpClient</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;String&gt; servers = Arrays.asList(<span class="hljs-string">"localhost:8081"</span>, <span class="hljs-string">"localhost:8082"</span>, <span class="hljs-string">"localhost:8083"</span>);
        <span class="hljs-type">LoadBalancer</span> <span class="hljs-variable">loadBalancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadBalancer</span>(servers);

        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
             .channel(NioSocketChannel.class)
             .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                 <span class="hljs-meta">@Override</span>
                 <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpClientCodec</span>());
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">512</span> * <span class="hljs-number">1024</span>));
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadBalancedHttpClientHandler</span>());
                 }
             });

            <span class="hljs-type">String</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> loadBalancer.getNextServer();
            String[] hostPort = server.split(<span class="hljs-string">":"</span>);
            b.connect(hostPort[<span class="hljs-number">0</span>], Integer.parseInt(hostPort[<span class="hljs-number">1</span>])).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }
}
</code></pre>
<ol start="3">
<li><strong>å¤„ç†è¯·æ±‚å’Œå“åº”</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.*;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.netty.handler.codec.http.HttpMethod.GET;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.netty.handler.codec.http.HttpVersion.HTTP_1_1;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadBalancedHttpClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;FullHttpResponse&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> {
        <span class="hljs-type">FullHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFullHttpRequest</span>(HTTP_1_1, GET, <span class="hljs-string">"/"</span>);
        request.headers().set(HttpHeaderNames.HOST, <span class="hljs-string">"localhost"</span>);
        request.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);
        ctx.writeAndFlush(request);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, FullHttpResponse response)</span> {
        System.out.println(<span class="hljs-string">"Response received: "</span> + response.content().toString(io.netty.util.CharsetUtil.UTF_8));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> {
        cause.printStackTrace();
        ctx.close();
    }
}
</code></pre>
<h3 data-id="heading-2">é«˜å¯ç”¨æ€§</h3>
<p>é«˜å¯ç”¨æ€§é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>å¥åº·æ£€æŸ¥</strong>ï¼šå®šæœŸæ£€æŸ¥å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ï¼Œç§»é™¤ä¸å¯ç”¨çš„èŠ‚ç‚¹ã€‚</li>
<li><strong>æ•…éšœè½¬ç§»</strong>ï¼šåœ¨æ£€æµ‹åˆ°èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–å¯ç”¨èŠ‚ç‚¹ã€‚</li>
</ol>
<h4 data-id="heading-3">ç¤ºä¾‹ï¼šåŸºäºNettyçš„å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»</h4>
<ol>
<li><strong>å¥åº·æ£€æŸ¥å™¨</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthChecker</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;String&gt; serverList;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HealthChecker</span><span class="hljs-params">(List&lt;String&gt; serverList)</span> {
        <span class="hljs-built_in">this</span>.serverList = serverList;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
        scheduler.scheduleAtFixedRate(<span class="hljs-built_in">this</span>::checkHealth, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, TimeUnit.SECONDS);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkHealth</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¥åº·æ£€æŸ¥é€»è¾‘ï¼Œä¾‹å¦‚å‘é€HTTPè¯·æ±‚åˆ°æ¯ä¸ªæœåŠ¡å™¨å¹¶æ£€æŸ¥å“åº”çŠ¶æ€</span>
        <span class="hljs-comment">// å¦‚æœæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™ä»serverListä¸­ç§»é™¤</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
        scheduler.shutdown();
    }
}
</code></pre>
<ol start="2">
<li><strong>é›†æˆå¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡</strong>ï¼š</li>
</ol>
<p>åœ¨å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œå¯åŠ¨å¥åº·æ£€æŸ¥å™¨ï¼Œå¹¶åœ¨è´Ÿè½½å‡è¡¡é€»è¾‘ä¸­ä½¿ç”¨å¥åº·æ£€æŸ¥ç»“æœã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadBalancedHttpClientWithHealthCheck</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;String&gt; servers = Arrays.asList(<span class="hljs-string">"localhost:8081"</span>, <span class="hljs-string">"localhost:8082"</span>, <span class="hljs-string">"localhost:8083"</span>);
        <span class="hljs-type">LoadBalancer</span> <span class="hljs-variable">loadBalancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadBalancer</span>(servers);
        <span class="hljs-type">HealthChecker</span> <span class="hljs-variable">healthChecker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HealthChecker</span>(servers);
        healthChecker.start();

        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
             .channel(NioSocketChannel.class)
             .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                 <span class="hljs-meta">@Override</span>
                 <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpClientCodec</span>());
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">512</span> * <span class="hljs-number">1024</span>));
                     ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadBalancedHttpClientHandler</span>());
                 }
             });

            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-type">String</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> loadBalancer.getNextServer();
                String[] hostPort = server.split(<span class="hljs-string">":"</span>);
                b.connect(hostPort[<span class="hljs-number">0</span>], Integer.parseInt(hostPort[<span class="hljs-number">1</span>])).sync().channel().closeFuture().sync();
            }
        } <span class="hljs-keyword">finally</span> {
            healthChecker.stop();
            group.shutdownGracefully();
        }
    }
}
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥å®ç°ä¸€ä¸ªåŸºäºNettyçš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§å®¢æˆ·ç«¯ã€‚å¥åº·æ£€æŸ¥å™¨å®šæœŸæ£€æŸ¥åç«¯æœåŠ¡å™¨çš„å¥åº·çŠ¶æ€ï¼Œå¹¶åœ¨è´Ÿè½½å‡è¡¡é€»è¾‘ä¸­ä½¿ç”¨å¥åº·æ£€æŸ¥ç»“æœæ¥é€‰æ‹©å¯ç”¨çš„æœåŠ¡å™¨èŠ‚ç‚¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ24ï¼‰Nettyä¸­çš„é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“]]></title>    <link>https://juejin.cn/post/7585474459777171492</link>    <guid>https://juejin.cn/post/7585474459777171492</guid>    <pubDate>2025-12-20T23:59:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459777171492" data-draft-id="7585485074038374406" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ24ï¼‰Nettyä¸­çš„é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T23:59:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ24ï¼‰Nettyä¸­çš„é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T23:59:12.000Z" title="Sat Dec 20 2025 23:59:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nettyä¸­çš„é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿæä¾›çš„é›¶æ‹·è´åŠŸèƒ½ï¼Œä½¿å¾—æ–‡ä»¶æ•°æ®å¯ä»¥ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿä¼ è¾“åˆ°ç½‘ç»œï¼Œè€Œæ— éœ€ç»è¿‡ç”¨æˆ·ç©ºé—´ã€‚è¿™å¤§å¤§æé«˜äº†æ•°æ®ä¼ è¾“çš„æ•ˆç‡ï¼Œå‡å°‘äº†CPUçš„ä½¿ç”¨å’Œå†…å­˜çš„æ‹·è´æ“ä½œã€‚</p>
<p>Nettyé€šè¿‡ <code>FileRegion</code> å’Œ <code>DefaultFileRegion</code> ç±»æ¥å®ç°é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š</p>
<h3 data-id="heading-0">æœåŠ¡å™¨ç«¯å®ç°</h3>
<ol>
<li><strong>åˆ›å»ºæœåŠ¡å™¨å¼•å¯¼ç¨‹åºï¼ˆServerBootstrapï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyFileServer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">1</span>);
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
             .channel(NioServerSocketChannel.class)
             .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroCopyFileServerInitializer</span>());

            b.bind(<span class="hljs-number">8080</span>).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>åˆå§‹åŒ–æœåŠ¡å™¨ç®¡é“ï¼ˆChannelPipelineï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LogLevel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LoggingHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyFileServerInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(LogLevel.INFO));
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroCopyFileServerHandler</span>());
    }
}
</code></pre>
<ol start="3">
<li><strong>å®ç°æ–‡ä»¶ä¼ è¾“å¤„ç†å™¨ï¼ˆChannelInboundHandlerAdapterï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFutureListener;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;
<span class="hljs-keyword">import</span> io.netty.channel.DefaultFileRegion;

<span class="hljs-keyword">import</span> java.io.RandomAccessFile;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyFileServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(<span class="hljs-string">"path/to/file.txt"</span>, <span class="hljs-string">"r"</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">fileLength</span> <span class="hljs-operator">=</span> file.length();

        <span class="hljs-type">DefaultFileRegion</span> <span class="hljs-variable">region</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFileRegion</span>(file.getChannel(), <span class="hljs-number">0</span>, fileLength);
        ctx.writeAndFlush(region).addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelFutureListener</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operationComplete</span><span class="hljs-params">(ChannelFuture future)</span> <span class="hljs-keyword">throws</span> Exception {
                file.close();
                ctx.close();
            }
        });
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> {
        cause.printStackTrace();
        ctx.close();
    }
}
</code></pre>
<h3 data-id="heading-1">å®¢æˆ·ç«¯å®ç°</h3>
<p>å®¢æˆ·ç«¯éœ€è¦æ¥æ”¶æ–‡ä»¶æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚</p>
<ol>
<li><strong>åˆ›å»ºå®¢æˆ·ç«¯å¼•å¯¼ç¨‹åºï¼ˆBootstrapï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyFileClient</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
             .channel(NioSocketChannel.class)
             .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroCopyFileClientInitializer</span>());

            b.connect(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">8080</span>).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>åˆå§‹åŒ–å®¢æˆ·ç«¯ç®¡é“ï¼ˆChannelPipelineï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LogLevel;
<span class="hljs-keyword">import</span> io.netty.handler.logging.LoggingHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyFileClientInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingHandler</span>(LogLevel.INFO));
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZeroCopyFileClientHandler</span>());
    }
}
</code></pre>
<ol start="3">
<li><strong>å®ç°æ–‡ä»¶æ¥æ”¶å¤„ç†å™¨ï¼ˆChannelInboundHandlerAdapterï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.buffer.ByteBuf;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;

<span class="hljs-keyword">import</span> java.io.FileOutputStream;
<span class="hljs-keyword">import</span> java.io.RandomAccessFile;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroCopyFileClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-keyword">private</span> FileOutputStream fos;
    <span class="hljs-keyword">private</span> RandomAccessFile file;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(<span class="hljs-string">"received_file.txt"</span>, <span class="hljs-string">"rw"</span>);
        fos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file.getFD());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (msg <span class="hljs-keyword">instanceof</span> ByteBuf) {
            <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> (ByteBuf) msg;
            <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[buf.readableBytes()];
            buf.readBytes(bytes);
            fos.write(bytes);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelInactive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        fos.close();
        file.close();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> {
        cause.printStackTrace();
        ctx.close();
    }
}
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒæœåŠ¡å™¨ç«¯é€šè¿‡ <code>DefaultFileRegion</code> å®ç°äº†é›¶æ‹·è´æ–‡ä»¶ä¼ è¾“ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–‡ä»¶æ•°æ®å¹¶å°†å…¶å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ‹·è´æ¬¡æ•°ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šå›¾åƒä¸æ–‡ä»¶ä¸Šä¼ ä¸‹è½½]]></title>    <link>https://juejin.cn/post/7585574047074353152</link>    <guid>https://juejin.cn/post/7585574047074353152</guid>    <pubDate>2025-12-20T21:47:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585574047074353152" data-draft-id="7585466235662336052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šå›¾åƒä¸æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"/> <meta itemprop="keywords" content="åç«¯,Node.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T21:47:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šå›¾åƒä¸æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T21:47:49.000Z" title="Sat Dec 20 2025 21:47:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨ Web åº”ç”¨ä¸­ï¼Œæ–‡ä»¶ä¸å›¾ç‰‡ä¸Šä¼ ä¸‹è½½å‡ ä¹æ˜¯å¿…å¤‡åŠŸèƒ½ã€‚ä»ç”¨æˆ·å¤´åƒã€é™„ä»¶ä¸Šä¼ ï¼Œåˆ°åå°æŠ¥è¡¨å¯¼å‡ºã€å›¾ç‰‡èµ„æºåˆ†å‘ï¼Œéƒ½ç¦»ä¸å¼€ç¨³å®šå¯é çš„æ–‡ä»¶å¤„ç†èƒ½åŠ›ã€‚Node.js å¤©ç„¶é€‚åˆ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œåœ¨æ–‡ä»¶ä¼ è¾“å’Œæµå¼å¤„ç†æ–¹é¢å…·æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†ä»åŸºç¡€åŸç†å‡ºå‘ï¼Œä»‹ç» Node.js ä¸­æ–‡ä»¶ä¸å›¾ç‰‡çš„ä¸Šä¼ ã€å­˜å‚¨ã€ä¸‹è½½ä»¥åŠå¸¸è§ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ–‡ä»¶ä¸Šä¼ çš„åŸºæœ¬åŸç†</h2>
<p>æ–‡ä»¶ä¸Šä¼ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œæµè§ˆå™¨é€šå¸¸ä½¿ç”¨ <code>multipart/form-data</code> ç¼–ç æ–¹å¼ï¼Œå°†æ–‡ä»¶å†…å®¹ä¸è¡¨å•æ•°æ®ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ã€‚</p>
<p>Node.js æœ¬èº«å¹¶ä¸ç›´æ¥è§£æè¿™ç§æ ¼å¼ï¼Œå› æ­¤åœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸éœ€è¦å€ŸåŠ©ä¸­é—´ä»¶æ¥å®Œæˆè§£æå’Œå­˜å‚¨ã€‚</p>
<p>å¸¸è§çš„å¤„ç†æµç¨‹åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯é€‰æ‹©æ–‡ä»¶å¹¶æäº¤è¡¨å•</li>
<li>æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚å¹¶è§£ææ–‡ä»¶æµ</li>
<li>å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æˆ–äº‘å­˜å‚¨</li>
<li>è¿”å›ä¸Šä¼ ç»“æœç»™å®¢æˆ·ç«¯</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€ä½¿ç”¨ Multer å¤„ç†æ–‡ä»¶ä¸Šä¼ </h2>
<p>åœ¨ Node.js Web é¡¹ç›®ä¸­ï¼Œ<code>multer</code> æ˜¯æœ€å¸¸ç”¨çš„æ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»¶ï¼Œå¸¸ä¸ Express æ­é…ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-2">1. åŸºæœ¬é…ç½®</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({
  <span class="hljs-attr">dest</span>: <span class="hljs-string">'uploads/'</span>
});
</code></pre>
<p>è¿™é‡Œçš„ <code>dest</code> æŒ‡å®šäº†æ–‡ä»¶çš„ä¸´æ—¶å­˜å‚¨ç›®å½•ï¼Œä¸Šä¼ å®Œæˆåæ–‡ä»¶ä¼šè‡ªåŠ¨å†™å…¥è¯¥è·¯å¾„ã€‚</p>
<hr/>
<h3 data-id="heading-3">2. å•æ–‡ä»¶ä¸Šä¼ </h3>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'file'</span>), <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">filename</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">filename</span>,
    <span class="hljs-attr">originalname</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">originalname</span>
  });
});
</code></pre>
<p><code>upload.single</code> ç”¨äºå¤„ç†å•ä¸ªæ–‡ä»¶ï¼Œå‚æ•°åç§°å¿…é¡»ä¸å‰ç«¯è¡¨å•å­—æ®µä¿æŒä¸€è‡´ã€‚</p>
<hr/>
<h3 data-id="heading-4">3. å¤šæ–‡ä»¶ä¸Šä¼ </h3>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/uploads'</span>, upload.<span class="hljs-title function_">array</span>(<span class="hljs-string">'files'</span>, <span class="hljs-number">5</span>), <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">count</span>: req.<span class="hljs-property">files</span>.<span class="hljs-property">length</span>
  });
});
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥é™åˆ¶ä¸Šä¼ æ–‡ä»¶æ•°é‡ï¼Œé˜²æ­¢èµ„æºæ»¥ç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€å›¾ç‰‡ä¸Šä¼ ä¸å¤„ç†</h2>
<p>å›¾ç‰‡é€šå¸¸éœ€è¦é¢å¤–çš„å¤„ç†ï¼Œä¾‹å¦‚å°ºå¯¸å‹ç¼©ã€æ ¼å¼è½¬æ¢æˆ–ç”Ÿæˆç¼©ç•¥å›¾ã€‚</p>
<h3 data-id="heading-6">1. å›¾ç‰‡ç±»å‹æ ¡éªŒ</h3>
<p>åœ¨ä¸Šä¼ é˜¶æ®µåº”é™åˆ¶æ–‡ä»¶ç±»å‹ï¼Œé¿å…ä¸Šä¼ éæ³•æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({
  <span class="hljs-title function_">fileFilter</span>(<span class="hljs-params">req, file, cb</span>) {
    <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">mimetype</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'image/'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'åªå…è®¸ä¸Šä¼ å›¾ç‰‡'</span>));
    }
    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
  }
});
</code></pre>
<hr/>
<h3 data-id="heading-7">2. å›¾ç‰‡å‹ç¼©ä¸å¤„ç†</h3>
<p><code>sharp</code> æ˜¯ Node.js ä¸­éå¸¸æµè¡Œçš„å›¾ç‰‡å¤„ç†åº“ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> sharp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sharp'</span>);

<span class="hljs-title function_">sharp</span>(<span class="hljs-string">'input.jpg'</span>)
  .<span class="hljs-title function_">resize</span>(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>)
  .<span class="hljs-title function_">toFile</span>(<span class="hljs-string">'output.jpg'</span>);
</code></pre>
<p>åœ¨ä¸Šä¼ å®Œæˆåå¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å­˜å‚¨ç©ºé—´å’Œç½‘ç»œä¼ è¾“å‹åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-8">å››ã€æ–‡ä»¶ä¸‹è½½çš„å®ç°æ–¹å¼</h2>
<p>æ–‡ä»¶ä¸‹è½½æœ¬è´¨æ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æµï¼Œå¹¶è®¾ç½®æ­£ç¡®çš„å“åº”å¤´ã€‚</p>
<h3 data-id="heading-9">1. ä¸‹è½½æœ¬åœ°æ–‡ä»¶</h3>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/download'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> filePath = <span class="hljs-string">'./uploads/example.pdf'</span>;
  res.<span class="hljs-title function_">download</span>(filePath);
});
</code></pre>
<p><code>res.download</code> ä¼šè‡ªåŠ¨å¤„ç†æ–‡ä»¶åå’Œå“åº”å¤´ï¼Œæ˜¯æœ€ç®€å•çš„ä¸‹è½½æ–¹å¼ã€‚</p>
<hr/>
<h3 data-id="heading-10">2. ä½¿ç”¨æµè¿›è¡Œä¸‹è½½</h3>
<p>å¯¹äºå¤§æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨æµå¼ä¼ è¾“ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/download'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> stream = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">'./bigfile.zip'</span>);
  stream.<span class="hljs-title function_">pipe</span>(res);
});
</code></pre>
<p>è¿™ç§æ–¹å¼å¯ä»¥æ˜¾è‘—é™ä½å†…å­˜å ç”¨ï¼Œæå‡å¹¶å‘èƒ½åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-11">äº”ã€æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆé€‰æ‹©</h2>
<h3 data-id="heading-12">1. æœ¬åœ°ç£ç›˜å­˜å‚¨</h3>
<p>é€‚åˆå°å‹é¡¹ç›®æˆ–å†…éƒ¨ç³»ç»Ÿï¼Œéƒ¨ç½²ç®€å•ï¼Œä½†ä¸åˆ©äºæ‰©å±•å’Œå¤šå®ä¾‹éƒ¨ç½²ã€‚</p>
<h3 data-id="heading-13">2. å¯¹è±¡å­˜å‚¨æœåŠ¡</h3>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡æ¥ä¿å­˜æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å›¾ç‰‡ä¸è§†é¢‘èµ„æº</li>
<li>ç”¨æˆ·ä¸Šä¼ é™„ä»¶</li>
<li>é™æ€ä¸‹è½½æ–‡ä»¶</li>
</ul>
<p>Node.js åªè´Ÿè´£ä¸Šä¼ å’Œä¸‹è½½çš„ä¸­è½¬ä¸æƒé™æ ¡éªŒï¼ŒçœŸæ­£çš„æ•°æ®å­˜å‚¨äº¤ç”±ä¸“ä¸šæœåŠ¡å¤„ç†ã€‚</p>
<hr/>
<h2 data-id="heading-14">å…­ã€å®‰å…¨ä¸æ€§èƒ½æ³¨æ„äº‹é¡¹</h2>
<p>åœ¨å®ç°æ–‡ä»¶ä¸å›¾ç‰‡ä¸Šä¼ ä¸‹è½½æ—¶ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>é™åˆ¶æ–‡ä»¶å¤§å°ï¼Œé˜²æ­¢æ¶æ„å ç”¨èµ„æº</li>
<li>æ ¡éªŒæ–‡ä»¶ç±»å‹ï¼Œé¿å…æ‰§è¡Œå‹æ–‡ä»¶ä¸Šä¼ </li>
<li>ä½¿ç”¨éšæœºæ–‡ä»¶åï¼Œé˜²æ­¢è·¯å¾„çŒœæµ‹</li>
<li>å¤§æ–‡ä»¶é‡‡ç”¨æµå¼å¤„ç†ï¼Œé¿å…é˜»å¡äº‹ä»¶å¾ªç¯</li>
</ul>
<p>åˆç†çš„é™åˆ¶ä¸æ ¡éªŒï¼Œæ˜¯åç«¯ç³»ç»Ÿå®‰å…¨çš„é‡è¦ä¸€ç¯ã€‚</p>
<hr/>
<h2 data-id="heading-15">ä¸ƒã€å¸¸è§åº”ç”¨åœºæ™¯</h2>
<p>Node.js æ–‡ä»¶ä¸å›¾ç‰‡å¤„ç†å¸¸è§äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ç”¨æˆ·å¤´åƒä¸å›¾ç‰‡ä¸Šä¼ </li>
<li>åå°é™„ä»¶ç®¡ç†ç³»ç»Ÿ</li>
<li>æŠ¥è¡¨ä¸æ•°æ®æ–‡ä»¶ä¸‹è½½</li>
<li>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å›¾ç‰‡ç®¡ç†</li>
<li>æ‰¹é‡å¯¼å…¥å¯¼å‡ºæ–‡ä»¶</li>
</ul>
<p>è¿™äº›åœºæ™¯å¯¹ç¨³å®šæ€§å’Œæ€§èƒ½è¦æ±‚éƒ½è¾ƒé«˜ï¼Œéå¸¸é€‚åˆä½¿ç”¨ Node.js æ¥å®ç°ã€‚</p>
<hr/>
<h2 data-id="heading-16">å…«ã€æ€»ç»“</h2>
<p>Node.js åœ¨æ–‡ä»¶ä¸å›¾ç‰‡ä¸Šä¼ ä¸‹è½½æ–¹é¢å…·å¤‡å®Œå–„çš„ç”Ÿæ€æ”¯æŒã€‚é€šè¿‡ä¸­é—´ä»¶è§£ææ–‡ä»¶ã€ç»“åˆæµå¼å¤„ç†ä¸å›¾ç‰‡å‹ç¼©ï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„æ–‡ä»¶æœåŠ¡ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåº”æ ¹æ®æ–‡ä»¶å¤§å°ã€è®¿é—®é¢‘ç‡å’Œéƒ¨ç½²æ¶æ„ï¼Œé€‰æ‹©åˆé€‚çš„å­˜å‚¨å’Œå¤„ç†æ–¹æ¡ˆï¼Œä»è€Œåœ¨æ€§èƒ½ã€å®‰å…¨ä¸ç»´æŠ¤æˆæœ¬ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šæ—¥å¿—ç®¡ç†ä¸åˆ†æ]]></title>    <link>https://juejin.cn/post/7585466235662352436</link>    <guid>https://juejin.cn/post/7585466235662352436</guid>    <pubDate>2025-12-20T21:48:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585466235662352436" data-draft-id="7585458459166998562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šæ—¥å¿—ç®¡ç†ä¸åˆ†æ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Node.js"/> <meta itemprop="datePublished" content="2025-12-20T21:48:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šæ—¥å¿—ç®¡ç†ä¸åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T21:48:19.000Z" title="Sat Dec 20 2025 21:48:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨åç«¯ç³»ç»Ÿä¸­ï¼Œæ—¥å¿—ä¸ä»…æ˜¯æ’æŸ¥é—®é¢˜çš„å·¥å…·ï¼Œæ›´æ˜¯ç³»ç»Ÿè¿è¡ŒçŠ¶æ€çš„é‡è¦è®°å½•ã€‚æ— è®ºæ˜¯æ¥å£æŠ¥é”™ã€æ€§èƒ½ç“¶é¢ˆï¼Œè¿˜æ˜¯ç”¨æˆ·è¡Œä¸ºåˆ†æï¼Œéƒ½ç¦»ä¸å¼€é«˜è´¨é‡çš„æ—¥å¿—ä½“ç³»ã€‚Node.js åº”ç”¨é€šå¸¸è¿è¡Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœæ—¥å¿—è®¾è®¡ä¸åˆç†ï¼Œå¾ˆå®¹æ˜“å‡ºç°ä¿¡æ¯ç¼ºå¤±ã€æ€§èƒ½ä¸‹é™ç”šè‡³ç£ç›˜è¢«å†™æ»¡ç­‰é—®é¢˜ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†å›´ç»• Node.js æ—¥å¿—çš„è®¾è®¡æ€è·¯ã€å¸¸è§å®ç°æ–¹å¼ä»¥åŠæ—¥å¿—åˆ†æå®è·µè¿›è¡Œè®²è§£ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆæ—¥å¿—å¦‚æ­¤é‡è¦</h2>
<p>æ—¥å¿—åœ¨ Node.js åº”ç”¨ä¸­ä¸»è¦æ‰¿æ‹…ä¸‰ç±»èŒè´£ã€‚</p>
<p>ç¬¬ä¸€ï¼Œç”¨äºé—®é¢˜æ’æŸ¥ã€‚å½“çº¿ä¸Šå‡ºç°å¼‚å¸¸æ—¶ï¼Œæ—¥å¿—å¾€å¾€æ˜¯å®šä½é—®é¢˜çš„ç¬¬ä¸€æ‰‹èµ„æ–™ã€‚
ç¬¬äºŒï¼Œç”¨äºè¿è¡Œç›‘æ§ã€‚é€šè¿‡æ—¥å¿—å¯ä»¥äº†è§£ç³»ç»Ÿæ˜¯å¦ç¨³å®šã€æ¥å£æ˜¯å¦è¶…æ—¶ã€‚
ç¬¬ä¸‰ï¼Œç”¨äºè¡Œä¸ºåˆ†æã€‚ä¸šåŠ¡æ—¥å¿—å¯ä»¥å¸®åŠ©åˆ†æç”¨æˆ·æ“ä½œè·¯å¾„å’Œç³»ç»Ÿä½¿ç”¨æƒ…å†µã€‚</p>
<p>ç¼ºä¹ç»Ÿä¸€æ—¥å¿—è§„èŒƒçš„é¡¹ç›®ï¼Œéšç€è§„æ¨¡æ‰©å¤§ï¼Œç»´æŠ¤æˆæœ¬ä¼šè¿…é€Ÿä¸Šå‡ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€Node.js æ—¥å¿—çš„åŸºæœ¬åˆ†ç±»</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šå¸¸ä¼šå°†æ—¥å¿—åˆ†ä¸ºå‡ ç±»ã€‚</p>
<ul>
<li>è®¿é—®æ—¥å¿—ï¼šè®°å½•æ¯ä¸€æ¬¡è¯·æ±‚çš„åŸºæœ¬ä¿¡æ¯</li>
<li>åº”ç”¨æ—¥å¿—ï¼šè®°å½•ä¸šåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®èŠ‚ç‚¹</li>
<li>é”™è¯¯æ—¥å¿—ï¼šè®°å½•å¼‚å¸¸å’Œé”™è¯¯å †æ ˆ</li>
<li>æ€§èƒ½æ—¥å¿—ï¼šè®°å½•è€—æ—¶ã€æ…¢æ¥å£ç­‰ä¿¡æ¯</li>
</ul>
<p>æ¸…æ™°çš„åˆ†ç±»ï¼Œæœ‰åŠ©äºåæœŸåˆ†æå’Œè‡ªåŠ¨åŒ–å¤„ç†ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€åŸºç¡€æ—¥å¿—è¾“å‡ºæ–¹å¼</h2>
<p>Node.js æœ€ç®€å•çš„æ—¥å¿—æ–¹å¼æ˜¯ä½¿ç”¨ <code>console</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'server started'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'something went wrong'</span>);
</code></pre>
<p>è¿™ç§æ–¹å¼é€‚åˆå¼€å‘è°ƒè¯•é˜¶æ®µï¼Œä½†å¹¶ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚å®ƒæ— æ³•æ§åˆ¶æ—¥å¿—æ ¼å¼ã€çº§åˆ«ï¼Œä¹Ÿä¸ä¾¿äºæŒä¹…åŒ–å’Œé›†ä¸­åˆ†æã€‚</p>
<hr/>
<h2 data-id="heading-3">å››ã€ä½¿ç”¨æ—¥å¿—åº“è¿›è¡Œæ—¥å¿—ç®¡ç†</h2>
<p>åœ¨ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸“ä¸šæ—¥å¿—åº“æ¥ç®¡ç†æ—¥å¿—ã€‚</p>
<h3 data-id="heading-4">1. æ—¥å¿—çº§åˆ«è®¾è®¡</h3>
<p>å¸¸è§æ—¥å¿—çº§åˆ«åŒ…æ‹¬ï¼š</p>
<ul>
<li>debugï¼šè°ƒè¯•ä¿¡æ¯</li>
<li>infoï¼šè¿è¡ŒçŠ¶æ€ä¿¡æ¯</li>
<li>warnï¼šæ½œåœ¨é—®é¢˜</li>
<li>errorï¼šé”™è¯¯ä¸å¼‚å¸¸</li>
</ul>
<p>é€šè¿‡åˆç†çš„æ—¥å¿—çº§åˆ«ï¼Œå¯ä»¥åœ¨ä¸åŒç¯å¢ƒè¾“å‡ºä¸åŒç²’åº¦çš„æ—¥å¿—ã€‚</p>
<hr/>
<h3 data-id="heading-5">2. ä½¿ç”¨æ—¥å¿—åº“ç¤ºä¾‹</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> winston = <span class="hljs-built_in">require</span>(<span class="hljs-string">'winston'</span>);

<span class="hljs-keyword">const</span> logger = winston.<span class="hljs-title function_">createLogger</span>({
  <span class="hljs-attr">level</span>: <span class="hljs-string">'info'</span>,
  <span class="hljs-attr">transports</span>: [
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">File</span>({ <span class="hljs-attr">filename</span>: <span class="hljs-string">'app.log'</span> })
  ]
});

logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'application started'</span>);
logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">'database connection failed'</span>);
</code></pre>
<p>æ—¥å¿—åº“å¯ä»¥å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ã€æ§åˆ¶å°ï¼Œç”šè‡³è¿œç¨‹æœåŠ¡ã€‚</p>
<hr/>
<h2 data-id="heading-6">äº”ã€æ—¥å¿—æ ¼å¼ä¸ç»“æ„åŒ–æ—¥å¿—</h2>
<p>ç›¸æ¯”çº¯æ–‡æœ¬æ—¥å¿—ï¼Œç»“æ„åŒ–æ—¥å¿—æ›´é€‚åˆè‡ªåŠ¨åŒ–åˆ†æã€‚</p>
<pre><code class="hljs language-js" lang="js">logger.<span class="hljs-title function_">info</span>({
  <span class="hljs-attr">event</span>: <span class="hljs-string">'user_login'</span>,
  <span class="hljs-attr">userId</span>: <span class="hljs-number">123</span>,
  <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
});
</code></pre>
<p>è¿™ç§ JSON æ ¼å¼æ—¥å¿—å¯ä»¥ç›´æ¥è¢«æ—¥å¿—ç³»ç»Ÿè§£æã€ç­›é€‰å’Œèšåˆï¼Œå¤§å¹…æå‡åˆ†ææ•ˆç‡ã€‚</p>
<hr/>
<h2 data-id="heading-7">å…­ã€è®¿é—®æ—¥å¿—çš„è®°å½•æ–¹å¼</h2>
<p>å¯¹äº Web åº”ç”¨æ¥è¯´ï¼Œè®¿é—®æ—¥å¿—éå¸¸å…³é”®ã€‚</p>
<p>å¸¸è§è®°å½•å†…å®¹åŒ…æ‹¬è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€å“åº”çŠ¶æ€ã€è€—æ—¶ç­‰ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">method</span>, req.<span class="hljs-property">url</span>, <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start);
  });
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<p>é€šè¿‡è®¿é—®æ—¥å¿—ï¼Œå¯ä»¥å¿«é€Ÿå‘ç°å¼‚å¸¸æµé‡å’Œæ…¢è¯·æ±‚ã€‚</p>
<hr/>
<h2 data-id="heading-8">ä¸ƒã€æ—¥å¿—åˆ‡å‰²ä¸å­˜å‚¨ç­–ç•¥</h2>
<p>æ—¥å¿—æ–‡ä»¶å¦‚æœä¸åšæ§åˆ¶ï¼Œå¾ˆå®¹æ˜“æ— é™å¢é•¿ã€‚</p>
<p>å¸¸è§çš„è§£å†³æ–¹å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li>æŒ‰å¤©æˆ–æŒ‰å¤§å°è¿›è¡Œæ—¥å¿—åˆ‡å‰²</li>
<li>å®šæœŸæ¸…ç†å†å²æ—¥å¿—</li>
<li>å°†æ—¥å¿—å­˜å‚¨åˆ°ç‹¬ç«‹ç£ç›˜æˆ–æœåŠ¡</li>
</ul>
<p>åˆç†çš„æ—¥å¿—ç­–ç•¥å¯ä»¥é¿å…ç£ç›˜ç©ºé—´è¢«æ—¥å¿—å æ»¡ã€‚</p>
<hr/>
<h2 data-id="heading-9">å…«ã€æ—¥å¿—é›†ä¸­ç®¡ç†ä¸åˆ†æ</h2>
<p>åœ¨åˆ†å¸ƒå¼æˆ–å¤šå®ä¾‹éƒ¨ç½²åœºæ™¯ä¸­ï¼Œå•æœºæ—¥å¿—å·²ç»æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</p>
<p>é€šå¸¸ä¼šå°†æ—¥å¿—é›†ä¸­åˆ°ç»Ÿä¸€å¹³å°è¿›è¡Œåˆ†æï¼Œå®Œæˆï¼š</p>
<ul>
<li>ç»Ÿä¸€æ£€ç´¢</li>
<li>å¼‚å¸¸å‘Šè­¦</li>
<li>è¿è¡Œè¶‹åŠ¿åˆ†æ</li>
</ul>
<p>Node.js åªè´Ÿè´£æ—¥å¿—é‡‡é›†ï¼ŒçœŸæ­£çš„åˆ†æäº¤ç”±ä¸“ä¸šç³»ç»Ÿå¤„ç†ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä¹ã€æ€§èƒ½ä¸å®‰å…¨æ³¨æ„äº‹é¡¹</h2>
<p>æ—¥å¿—è™½ç„¶é‡è¦ï¼Œä½†ä¹Ÿä¸èƒ½å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>é¿å…åœ¨é«˜é¢‘è·¯å¾„ä¸­è®°å½•è¿‡å¤šæ—¥å¿—</li>
<li>ä¸è¦åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯</li>
<li>ä½¿ç”¨å¼‚æ­¥æ–¹å¼å†™å…¥æ—¥å¿—</li>
<li>å¯¹é”™è¯¯æ—¥å¿—è¿›è¡Œé‡ç‚¹ç›‘æ§</li>
</ul>
<p>å¹³è¡¡æ—¥å¿—è´¨é‡ä¸æ€§èƒ½ï¼Œæ˜¯æˆç†Ÿç³»ç»Ÿçš„æ ‡å¿—ä¹‹ä¸€ã€‚</p>
<hr/>
<h2 data-id="heading-11">åã€æ€»ç»“</h2>
<p>æ—¥å¿—ç®¡ç†æ˜¯ Node.js åº”ç”¨èµ°å‘ç”Ÿäº§ç¯å¢ƒçš„é‡è¦ä¸€æ­¥ã€‚ä¸€ä¸ªæ¸…æ™°ã€ç¨³å®šã€å¯åˆ†æçš„æ—¥å¿—ä½“ç³»ï¼Œå¯ä»¥æ˜¾è‘—é™ä½æ’é”™æˆæœ¬ï¼Œæé«˜ç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚</p>
<p>åœ¨é¡¹ç›®åˆæœŸå°±å»ºç«‹è‰¯å¥½çš„æ—¥å¿—è§„èŒƒï¼Œæ¯”åæœŸè¡¥æ•‘è¦è½»æ¾å¾—å¤šã€‚éšç€ä¸šåŠ¡è§„æ¨¡æ‰©å¤§ï¼Œæ—¥å¿—ä¸ä»…æ˜¯æ’é”™å·¥å…·ï¼Œæ›´æ˜¯ç³»ç»Ÿè¿è¡Œçš„é‡è¦æ•°æ®èµ„äº§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†æ­»ç£•æ‰©æ•£æ¨¡å‹äº†ï¼ŒMiniMaxæ–°å¼€æºæ­ç¤ºï¼šè§†è§‰Tokenizeræ‰æ˜¯ä¸‹ä¸€ä¸ªé‡‘çŸ¿]]></title>    <link>https://juejin.cn/post/7585485284152934435</link>    <guid>https://juejin.cn/post/7585485284152934435</guid>    <pubDate>2025-12-20T16:05:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485284152934435" data-draft-id="7585458459166687266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†æ­»ç£•æ‰©æ•£æ¨¡å‹äº†ï¼ŒMiniMaxæ–°å¼€æºæ­ç¤ºï¼šè§†è§‰Tokenizeræ‰æ˜¯ä¸‹ä¸€ä¸ªé‡‘çŸ¿"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-20T16:05:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†æ­»ç£•æ‰©æ•£æ¨¡å‹äº†ï¼ŒMiniMaxæ–°å¼€æºæ­ç¤ºï¼šè§†è§‰Tokenizeræ‰æ˜¯ä¸‹ä¸€ä¸ªé‡‘çŸ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T16:05:18.000Z" title="Sat Dec 20 2025 16:05:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨AIç»˜ç”»å’Œè§†é¢‘ç”Ÿæˆå·åˆ°é£èµ·çš„ä»Šå¤©ï¼Œä¸ç®¡æ˜¯å¤§å‚è¿˜æ˜¯å¼€æºç¤¾åŒºï¼Œå¤§å®¶ä¼¼ä¹éƒ½é™·å…¥äº†ä¸€ä¸ªæ€ªåœˆï¼šæ‹¼å‘½å †ç®—åŠ›å»è®­ç»ƒæ›´å¤§çš„Diffusion Transformerï¼ˆDiTï¼‰ï¼ŒæŒ‡æœ›é€šè¿‡å¢åŠ ç”Ÿæˆæ¨¡å‹çš„å‚æ•°æ¥è·å¾—æ›´å¥½çš„ç”»è´¨ã€‚</p>
<p>ä½†å°±åœ¨å‰ä¸¤å¤©ï¼Œå‡­å€Ÿæµ·èºè§†é¢‘ï¼ˆHailuo AIï¼‰åœ¨åœˆå†…åå£°å¤§å™ªçš„MiniMaxå›¢é˜Ÿï¼Œçªç„¶å¼€æºäº†ä¸€ä¸ªåä¸ºVTPï¼ˆVisual Tokenizer Pre-trainingï¼‰çš„é¡¹ç›®ã€‚çœ‹å®Œä»–ä»¬çš„è®ºæ–‡å’Œä»£ç ï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œè¿™å¸®äººå¯èƒ½åˆšåˆšæ€ç¿»äº†è§†è§‰ç”Ÿæˆé¢†åŸŸçš„æ¡Œå­ã€‚</p>
<p>ä»–ä»¬æŠ›å‡ºäº†ä¸€ä¸ªæå…¶åç›´è§‰çš„ç»“è®ºï¼š<strong>å¦‚æœæˆ‘ä»¬ä¸€ç›´åœ¨é”™è¯¯çš„åœ°æ–¹ç”¨åŠ›å‘¢ï¼Ÿå¦‚æœä½ ç”»ä¸å‡ºå¥½å›¾ï¼Œå¯èƒ½ä¸æ˜¯å› ä¸ºä½ çš„ç”»ç¬”ï¼ˆDiTï¼‰ä¸å¤Ÿå¥½ï¼Œè€Œæ˜¯å› ä¸ºä½ çš„çœ¼ç›ï¼ˆTokenizerï¼‰æ ¹æœ¬æ²¡çœ‹æ‡‚è¿™ä¸ªä¸–ç•Œã€‚</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fdasfsdgv-1024x347.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/dasfsdgv-1024x347.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d3a65057d7c42a5bace62bde3177ff0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851518&amp;x-signature=Wn8vnGHcft6h8Wkotub1QWxy2kI%3D" alt="dasfsdgv" loading="lazy"/></a></p>
<h2 data-id="heading-0">ä¼ ç»Ÿçš„æ­»èƒ¡åŒï¼šåªåšå¤è¯»æœºï¼Œä¸åšç†è§£è€…</h2>
<p>ä¸ºäº†ç†è§£VTPçš„çªç ´ï¼Œæˆ‘ä»¬å¾—å…ˆèŠèŠç°åœ¨çš„è§†è§‰æ¨¡å‹æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªTokenizerï¼ˆæ¯”å¦‚VAEï¼‰æŠŠå›¾ç‰‡å‹ç¼©æˆLatentï¼ˆæ½œåœ¨è¡¨ç¤ºï¼‰ï¼Œç„¶åè®©ç”Ÿæˆæ¨¡å‹å»å­¦ä¹ è¿™ä¸ªLatentã€‚</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼ ç»ŸTokenizerçš„å”¯ä¸€KPIå°±æ˜¯â€œè¿˜åŸåº¦â€ã€‚å®ƒå°±åƒä¸€ä¸ªæå…¶æ­»æ¿çš„å¤å°åº—è€æ¿ï¼Œåªåœ¨ä¹å‹ç¼©åçš„å›¾ç‰‡è§£å‹å‡ºæ¥è·ŸåŸå›¾åƒä¸åƒã€‚åƒç´ å¯¹ä¸Šäº†ï¼Œä»»åŠ¡å°±å®Œæˆäº†ã€‚</p>
<p>è¿™å°±å¯¼è‡´äº†ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼š<strong>Scaling Lawåœ¨Tokenizerä¸Šå¤±æ•ˆäº†ã€‚</strong></p>
<p>ä¸è®ºä½ ç»™ä¼ ç»ŸVAEæŠ•å¤šå°‘ç®—åŠ›ã€å–‚å¤šå°‘æ•°æ®ï¼Œåªè¦å®ƒåªç›¯ç€åƒç´ é‡å»ºï¼Œä¸‹æ¸¸çš„ç”Ÿæˆæ¨¡å‹å°±å¾ˆéš¾ä»ä¸­å—ç›Šã€‚ç”šè‡³æœ‰æ—¶å€™ï¼Œé‡å»ºå¾—è¶Šå®Œç¾ï¼Œç”Ÿæˆçš„ç”»è´¨åè€Œè¶Šå·®ã€‚å› ä¸ºæ¨¡å‹æŠŠç®—åŠ›éƒ½æµªè´¹åœ¨äº†æç»˜å¢™çº¸çš„ç»†å¾®çº¹ç†ä¸Šï¼Œå´å¿˜äº†ç†è§£ç”»é¢é‡Œç«™ç€çš„æ˜¯ä¸ªäººè¿˜æ˜¯æ¡ç‹—ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fegerhgt.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/egerhgt.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62299bb6f69a448fa9688c692761f9b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851518&amp;x-signature=ypVaoGDtfwkcfXFlobHj01HYDeg%3D" alt="egerhgt" loading="lazy"/></a></p>
<h2 data-id="heading-1">MiniMaxçš„è§£é¢˜æ€è·¯ï¼šç†è§£é©±åŠ¨ç”Ÿæˆ</h2>
<p>MiniMaxå›¢é˜Ÿè¿™æ¬¡å¹²çš„äº‹æƒ…ï¼Œå°±æ˜¯é‡æ–°å‘æ˜äº†Tokenizerã€‚ä»–ä»¬æå‡ºçš„VTPæ¡†æ¶ï¼Œæ ¸å¿ƒé€»è¾‘éå¸¸æ€§æ„Ÿï¼š<strong>ä¸€ä¸ªå¥½çš„Tokenizerï¼Œä¸åº”è¯¥åªæ˜¯åƒç´ çš„æ¬è¿å·¥ï¼Œè€Œåº”è¯¥æ˜¯è¯­ä¹‰çš„ç¿»è¯‘å®˜ã€‚</strong></p>
<p>VTPä¸å†å•çº¯è¿½æ±‚â€œç”»å¾—åƒâ€ï¼Œè€Œæ˜¯è¿½æ±‚â€œå¬å¾—æ‡‚â€å’Œâ€œçœ‹å¾—æ‡‚â€ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä»–ä»¬åœ¨é¢„è®­ç»ƒé˜¶æ®µæäº†ä¸€ä¸ªâ€œæ··åˆåŒæ‰“â€ï¼Œå¼ºè¡Œè®©TokenizeråŒæ—¶ä»ä¸‰ä¸ªç»´åº¦å­¦ä¹ ï¼š</p>
<ol>
<li><strong>åƒç´ çº§é‡å»º</strong>ï¼šè€æœ¬è¡Œä¸èƒ½ä¸¢ï¼Œä¿è¯åŸºæœ¬çš„è§†è§‰ç»†èŠ‚ï¼ˆä½†æƒé‡é™ä½äº†ï¼‰ã€‚</li>
<li><strong>è¯­ä¹‰ç†è§£ï¼ˆCLIPé£æ ¼ï¼‰</strong>ï¼šè®©Tokenizerç†è§£è¿™å¼ å›¾å¯¹åº”ä»€ä¹ˆæ–‡å­—ï¼ŒçŸ¥é“â€œçŒ«â€é•¿ä»€ä¹ˆæ ·ã€‚</li>
<li><strong>ç»“æ„è®¤çŸ¥ï¼ˆDINOé£æ ¼ï¼‰</strong>ï¼šé€šè¿‡è‡ªç›‘ç£å­¦ä¹ ï¼Œææ¸…æ¥šç‰©ä½“çš„ç©ºé—´ç»“æ„å’Œå±€éƒ¨å…³ç³»ã€‚</li>
</ol>
<p>è¿™å°±åƒæ˜¯æ•™ä¸€ä¸ªå­¦ç”»ç”»çš„å­¦ç”Ÿï¼Œä¸å†è®©ä»–æ²¡æ—¥æ²¡å¤œåœ°ä¸´æ‘¹ç…§ç‰‡ï¼ˆçº¯é‡å»ºï¼‰ï¼Œè€Œæ˜¯å…ˆæ•™ä»–è§£å‰–å­¦ã€å…‰å½±åŸç†å’Œè‰ºæœ¯å²ï¼ˆè¯­ä¹‰ä¸ç»“æ„ç†è§£ï¼‰ã€‚ç»“æœæ˜¾è€Œæ˜“è§ï¼Œæ‡‚åŸç†çš„å­¦ç”Ÿï¼Œåˆ›ä½œèƒ½åŠ›å®Œçˆ†åªä¼šä¸´æ‘¹çš„å­¦ç”Ÿã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fegregehre-1024x368.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/egregehre-1024x368.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ae854b38e44dc9bddf28bbb18abb9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851518&amp;x-signature=avnhWufV4O2jjacl4AqDqyCIvWw%3D" alt="egregehre" loading="lazy"/></a></p>
<h2 data-id="heading-2">æ•°æ®ä¸ä¼šéª—äººï¼šScaling Lawç»ˆäºç”Ÿæ•ˆäº†</h2>
<p>VTPæœ€è®©å¼€å‘è€…å…´å¥‹çš„ï¼Œä¸æ˜¯å®ƒç”¨äº†ä»€ä¹ˆæ–°æ¶æ„ï¼ˆå…¶å®è¿˜æ˜¯ViTï¼‰ï¼Œè€Œæ˜¯å®ƒè¯æ˜äº†<strong>è§†è§‰Tokenizerä¹Ÿå­˜åœ¨Scaling Law</strong>ã€‚</p>
<p>æ ¹æ®MiniMaxå…¬å¸ƒçš„å®éªŒæ•°æ®ï¼Œå½“ä½ å¢åŠ VTPçš„å‚æ•°é‡ã€è®­ç»ƒæ•°æ®å’Œè®¡ç®—é‡æ—¶ï¼Œä¸‹æ¸¸çš„ç”Ÿæˆæ¨¡å‹æ€§èƒ½å‘ˆç°å‡ºä¸€æ¡æ¼‚äº®çš„ä¸Šå‡æ›²çº¿ã€‚</p>
<p>è¿™ç»„å¯¹æ¯”æ•°æ®éå¸¸éœ‡æ’¼ï¼š</p>
<ul>
<li>åœ¨åŒæ ·çš„ç”Ÿæˆæ¨¡å‹ç®—åŠ›ä¸‹ï¼Œä»…ä»…æ˜¯å°†Tokenizeræ¢æˆVTPï¼Œ<strong>FIDï¼ˆå›¾åƒè´¨é‡æŒ‡æ ‡ï¼‰ç›´æ¥æå‡äº†65.8%</strong>ã€‚</li>
<li><strong>æ”¶æ•›é€Ÿåº¦å¿«äº†4.1å€</strong>ã€‚è¿™æ„å‘³ç€å¦‚æœä½ åœ¨è®­ç»ƒè‡ªå·±çš„SDæˆ–DiTæ¨¡å‹ï¼Œç”¨VTPå¯èƒ½è®©ä½ çœä¸‹ä¸€å¤§ç¬”æ˜¾å¡ç”µè´¹ã€‚</li>
<li>åœ¨ImageNetçš„é›¶æ ·æœ¬åˆ†ç±»æµ‹è¯•ä¸­ï¼ŒVTPç”šè‡³è·‘å‡ºäº†78.2%çš„å‡†ç¡®ç‡ï¼Œæ¯”åŸç‰ˆCLIPè¿˜é«˜ã€‚è¿™è¯´æ˜è¿™ä¸ªTokenizeræ˜¯çœŸçš„â€œçœ‹æ‡‚â€äº†å›¾ç‰‡ã€‚</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Ffdgsdgf-1024x365.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/fdgsdgf-1024x365.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0217b8c35be14bc5b35d12e21e91da1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851518&amp;x-signature=pyDjrDJIg4guzFq5XmXjFEab1ns%3D" alt="fdgsdgf" loading="lazy"/></a></p>
<h2 data-id="heading-3">ç»™è¡Œä¸šçš„ä¸€è®°é‡æ‹³</h2>
<p>MiniMaxè¿™æ¬¡å¼€æºVTPï¼Œå®é™…ä¸Šæ˜¯ç»™æ‰€æœ‰åšæ–‡ç”Ÿå›¾ã€æ–‡ç”Ÿè§†é¢‘çš„å›¢é˜ŸæŒ‡äº†ä¸€æ¡æ–°è·¯ã€‚</p>
<p>åœ¨è¿‡å»ï¼Œå½“ç”Ÿæˆæ•ˆæœé‡åˆ°ç“¶é¢ˆæ—¶ï¼Œå¤§å®¶çš„ååº”é€šå¸¸æ˜¯ï¼šâ€œåŠ å±‚æ•°ï¼åŠ æ•°æ®ï¼æŠŠDiTåšå¤§ï¼â€ä½†VTPå‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ç§è›®åŠ›ä¹Ÿè®¸å¹¶éæœ€ä¼˜è§£ã€‚ä¸å…¶æ— æ­¢å¢ƒåœ°æ‰©å¤§ç”Ÿæˆæ¨¡å‹çš„è§„æ¨¡ï¼Œä¸å¦‚å›å¤´çœ‹çœ‹æœ€åŸºç¡€çš„Tokenizerã€‚</p>
<p>è¿™ä¸€æ­¥â€œç£¨åˆ€ä¸è¯¯ç æŸ´å·¥â€çš„ç­–ç•¥ï¼Œæå…·æ€§ä»·æ¯”ã€‚å®ƒè¯æ˜äº†åœ¨ç¬¬ä¸€é˜¶æ®µï¼ˆTokenizerï¼‰æ³¨å…¥æ›´å¤šçš„ç†è§£èƒ½åŠ›ï¼Œä¼šç›´æ¥è®©ç¬¬äºŒé˜¶æ®µï¼ˆç”Ÿæˆï¼‰å˜å¾—å¦‚è™æ·»ç¿¼ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œLatentæ˜“å­¦æ€§â€ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fsgetrhrth-1024x399.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/sgetrhrth-1024x399.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3529d97c9bc401b874d1cc2bd532e63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851518&amp;x-signature=LT64T5552MiZ1InqsUkQnESgJ8k%3D" alt="sgetrhrth" loading="lazy"/></a></p>
<h2 data-id="heading-4">æ€»ç»“</h2>
<p>å¦‚æœä½ æ˜¯ä¸€åAIå·¥ç¨‹å¸ˆæˆ–ç ”ç©¶è€…ï¼Œå»ºè®®ç«‹åˆ»å»GitHubä¸Šæ‹‰å–VTPçš„ä»£ç è¯•è¯•ã€‚MiniMaxæä¾›äº†å®Œæ•´çš„é¢„è®­ç»ƒæƒé‡å’Œå¾®è°ƒè„šæœ¬ã€‚</p>
<p>VTPçš„å‡ºç°æˆ–è®¸æ ‡å¿—ç€è§†è§‰ç”Ÿæˆè¿›å…¥äº†ä¸€ä¸ªæ–°é˜¶æ®µï¼šæˆ‘ä»¬ä¸å†æ»¡è¶³äºç”Ÿæˆåƒç´ å®Œç¾çš„å›¾åƒï¼Œè€Œæ˜¯å¼€å§‹è¿½æ±‚ç”Ÿæˆå…·å¤‡æ·±å±‚è¯­ä¹‰ä¸€è‡´æ€§çš„è§†è§‰å†…å®¹ã€‚</p>
<p>æœ‰äº›æ—¶å€™ï¼Œçªç ´ç“¶é¢ˆçš„é’¥åŒ™ï¼Œå¾€å¾€å°±è—åœ¨ä½ è§‰å¾—æœ€ä¸èµ·çœ¼çš„é‚£ä¸ªç»„ä»¶é‡Œã€‚</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é‡‘é±¼è®°å¿†åˆ°è¿‡ç›®ä¸å¿˜ï¼šTransformer å¦‚ä½•è®©AIçœŸæ­£ç†è§£ä¸€å¥è¯ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585574047074074624</link>    <guid>https://juejin.cn/post/7585574047074074624</guid>    <pubDate>2025-12-20T16:50:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585574047074074624" data-draft-id="7585574047074058240" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é‡‘é±¼è®°å¿†åˆ°è¿‡ç›®ä¸å¿˜ï¼šTransformer å¦‚ä½•è®©AIçœŸæ­£ç†è§£ä¸€å¥è¯ï¼Ÿ"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-20T16:50:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MobotStone"/> <meta itemprop="url" content="https://juejin.cn/user/3839909554568840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é‡‘é±¼è®°å¿†åˆ°è¿‡ç›®ä¸å¿˜ï¼šTransformer å¦‚ä½•è®©AIçœŸæ­£ç†è§£ä¸€å¥è¯ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3839909554568840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MobotStone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T16:50:59.000Z" title="Sat Dec 20 2025 16:50:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ï¼ŒChatGPT æ˜¯æ€ä¹ˆæ—¢èƒ½å†™è¯—ï¼Œåˆèƒ½ç¿»è¯‘å¤–è¯­ï¼Œè®²èµ·é‡å­åŠ›å­¦æ¥è¿˜åƒä¸ªè€æ•™æˆä¸€æ ·ä¸€å¥—ä¸€å¥—çš„ï¼Ÿ</p>
<p>è¿™éƒ½å¾—å½’åŠŸäº2017å¹´ï¼ŒGoogleå›¢é˜Ÿå‘è¡¨çš„ä¸€ç¯‡åä¸ºã€ŠAttention Is All You Needã€‹çš„è®ºæ–‡ï¼Œå½»åº•æ”¹å˜äº†äººå·¥æ™ºèƒ½çš„å†å²è¿›ç¨‹ã€‚åœ¨æ­¤ä¹‹å‰ï¼ŒAIå¤„ç†é•¿æ–‡æœ¬å¦‚åŒâ€œå³ä½¿åªæœ‰7ç§’è®°å¿†çš„é‡‘é±¼â€ï¼Œè€ŒTransformerçš„å‡ºç°èµ‹äºˆäº†æœºå™¨â€œè¿‡ç›®ä¸å¿˜â€çš„èƒ½åŠ›ã€‚ä»Šå¤©æˆ‘ä»¬æ¥ç†è§£è¯­è¨€æ¨¡å‹å¦‚ä½•å®ç°æ™ºèƒ½è¡¨ç°ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a9313776c704e72b1e80d7a3db51a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9ib3RTdG9uZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766854258&amp;x-signature=%2FwxK%2BMFpMoQLsmm9j2gViQOKxd8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">æ ¸å¿ƒæœºåˆ¶ï¼šä¸€åˆ‡åœ¨äºæ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰</h2>
<p>é˜…è¯»è¿™å¥è¯æ—¶ï¼š</p>
<blockquote>
<p><em>â€œçŒ«ååœ¨å«å­ä¸Šï¼Œå› ä¸ºå®ƒå¾ˆæŸ”è½¯ã€‚â€</em> vs. <em>â€œçŒ«ååœ¨å«å­ä¸Šï¼Œå› ä¸ºå®ƒå¾ˆç´¯äº†ã€‚â€</em></p>
</blockquote>
<p>åœ¨ç¬¬ä¸€å¥ä¸­ï¼Œä½ ä¼šç¬é—´ç†è§£â€œå®ƒâ€æŒ‡ä»£â€œå«å­â€ï¼ˆå› ä¸ºå«å­æŸ”è½¯ï¼‰ï¼›è€Œåœ¨ç¬¬äºŒå¥ä¸­ï¼Œâ€œå®ƒâ€æŒ‡ä»£â€œçŒ«â€ï¼ˆå› ä¸ºçŒ«ä¼šç´¯ï¼‰ã€‚ äººç±»å¤§è„‘èƒ½ç²¾å‡†<strong>èšç„¦</strong>äºå…³é”®ä¿¡æ¯å¹¶æ¶ˆé™¤æ­§ä¹‰ã€‚æ—§æœ‰çš„AIæ¨¡å‹ï¼ˆå¦‚RNNï¼‰å¾€å¾€åœ¨å¤„ç†åˆ°å¥å­æœ«å°¾æ—¶å°±å¿˜è®°äº†å¼€å¤´çš„â€œçŒ«â€ï¼Œå¯¼è‡´æŒ‡ä»£é”™è¯¯ã€‚ <strong>Transformersçš„è¿ä½œæ–¹å¼</strong>åˆ™å¦‚åŒæ‹¥æœ‰â€œä¸Šå¸è§†è§’â€ï¼šå®ƒä¸å†å—çº¿æ€§é˜…è¯»é™åˆ¶ï¼Œè€Œæ˜¯ä»¥é—ªç”µé€Ÿåº¦è®¡ç®—å¥å­ä¸­æ‰€æœ‰è¯è¯­ä¹‹é—´çš„<strong>å…³è”æƒé‡</strong>ï¼Œç¬é—´åˆ¤æ–­å‡ºâ€œæŸ”è½¯â€ä¸â€œå«å­â€çš„ç›¸å…³åº¦é«˜è¾¾90%ï¼Œè€Œä¸â€œçŒ«â€çš„ç›¸å…³åº¦ä»…ä¸º10%ã€‚</p>
<h2 data-id="heading-1">è‡ªæˆ‘æ³¨æ„åŠ›çš„çªç ´æ€§é©æ–°</h2>
<p>æ—§å¼æ¨¡å‹é€è¯è§£æï¼ˆè¯»å®ŒAæ‰è¯»Bï¼‰ï¼Œæ•ˆç‡ä½ä¸‹ä¸”éš¾ä»¥æ•æ‰é•¿è·ç¦»ä¾èµ–ã€‚è€ŒTransformers<strong>åŒæ­¥è§‚æµ‹æ‰€æœ‰è¯è¯­</strong>ã€‚æ¯ä¸ªè¯éƒ½ä¼šè‡ªé—®ï¼š</p>
<blockquote>
<p><strong>â€œåœ¨è¿™å¥è¯ä¸­ï¼Œå“ªäº›è¯ä¸æˆ‘ç›¸å…³ï¼Ÿæˆ‘å¯¹å®ƒä»¬çš„â€˜å…³æ³¨åº¦â€™è¯¥åˆ†é…å¤šå°‘ï¼Ÿâ€</strong></p>
</blockquote>
<p>é€šè¿‡<strong>æŸ¥è¯¢ï¼ˆQueryï¼‰ã€é”®ï¼ˆKeyï¼‰ã€å€¼ï¼ˆValueï¼‰ä¸‰ä¸ªå‘é‡çš„å·§å¦™è¿ç®—ï¼Œè¯è¯­é—´åŠ¨æ€ç»‡å‡ºäº†ä¸€å¼ å¤æ‚çš„â€œå…³ç³»ç½‘â€ã€‚ä¸ºäº†ç†è§£è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¯”ä½œ</strong>å›¾ä¹¦é¦†æ£€ç´¢ç³»ç»Ÿï¼š</p>
<ul>
<li><strong>Query (æŸ¥è¯¢)</strong> ï¼šä½ æ‰‹ä¸­çš„ä¹¦å•ï¼ˆæ¯”å¦‚ä½ æƒ³æ‰¾å…³äºâ€œçŒ«â€çš„ä¿¡æ¯ï¼‰ã€‚</li>
<li><strong>Key (é”®)</strong> ï¼šå›¾ä¹¦é¦†ä¹¦è„Šä¸Šçš„æ ‡ç­¾ï¼ˆæ¯æœ¬ä¹¦çš„å†…å®¹ç´¢å¼•ï¼‰ã€‚</li>
<li><strong>Value (å€¼)</strong> ï¼šä¹¦ä¸­å®é™…çš„çŸ¥è¯†å†…å®¹ã€‚</li>
</ul>
<p>å½“â€œçŒ«â€å‘å‡ºQueryæ—¶ï¼Œå®ƒä¼šä¸å…¨å¥æ‰€æœ‰è¯çš„Keyè¿›è¡ŒåŒ¹é…ã€‚å¦‚æœKeyåŒ¹é…åº¦é«˜ï¼ˆç‚¹ç§¯è¿ç®—ç»“æœå¤§ï¼‰ï¼Œæ¨¡å‹å°±ä¼šæå–æ›´å¤šçš„Valueä¿¡æ¯ã€‚</p>
<ul>
<li>â€œå®ƒâ€ä¸â€œå«å­â€äº§ç”Ÿå¼ºå…³è”ï¼ˆåŒ¹é…åº¦é«˜ï¼Œæå–å¤§é‡ç‰¹å¾ï¼‰</li>
<li>â€œçŒ«â€ä¸â€œåâ€å»ºç«‹é€»è¾‘è¿æ¥ï¼ˆä¸»è°“å…³ç³»æ¸…æ™°ï¼‰</li>
</ul>
<h2 data-id="heading-2">ä¿¡æ¯æµåŠ¨æµæ°´çº¿ï¼šåˆ†æ­¥è§£æ</h2>
<h3 data-id="heading-3">â‘  è¾“å…¥åµŒå…¥ (Input Embeddings)ï¼šå°†è¯è¯­è½¬åŒ–ä¸ºæ•°å­—è¡¨å¾</h3>
<p>è®¡ç®—æœºä¸è®¤è¯†æ±‰å­—ï¼Œåªè®¤è¯†æ•°å­—ã€‚æ¨¡å‹å°†è¯è¯­è½¬ä¸ºé«˜ç»´å‘é‡ã€‚</p>
<ul>
<li><strong>å®ä¾‹</strong>ï¼šåœ¨GPT-3æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¯è¢«è½¬åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º12,288ç»´çš„å‘é‡ã€‚</li>
<li><strong>æ•°å­¦ç›´è§‰</strong>ï¼šåœ¨è¿™ç§é«˜ç»´ç©ºé—´ä¸­ï¼Œè¯­ä¹‰ç›¸è¿‘çš„è¯è·ç¦»æ›´è¿‘ã€‚ç»å…¸çš„å‘é‡è¿ç®—æ¡ˆä¾‹æ˜¯ï¼šå›½ç‹âˆ’ç”·äºº+å¥³äººâ‰ˆå¥³ç‹ã€‚è¿™è¯æ˜äº†æ¨¡å‹ä¸æ˜¯åœ¨æ­»è®°ç¡¬èƒŒï¼Œè€Œæ˜¯ç†è§£äº†è¯è¯­é—´çš„ç©ºé—´å‡ ä½•å…³ç³»ã€‚</li>
</ul>
<h3 data-id="heading-4">â‘¡ ä½ç½®ç¼–ç  (Positional Encoding)ï¼šè¡¥è¶³è¯åºä¿¡æ¯</h3>
<p>ç”±äºTransformeræ˜¯å¹¶è¡Œå¤„ç†ï¼ˆä¸€æ¬¡æ€§åƒè¿›æ‰€æœ‰è¯ï¼‰ï¼Œå®ƒå¤©ç„¶ä¸çŸ¥é“é¡ºåºã€‚å°±åƒæŠŠä¸€æœ¬ä¹¦æ‹†æ•£é¡µæ‰”åœ¨åœ°ä¸Šã€‚</p>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç»™æ¯ä¸ªè¯æ‰“ä¸Šç‹¬ç‰¹çš„â€œæ—¶é—´æˆ³â€æˆ–â€œé¡µç â€ã€‚é€šè¿‡æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„æ³¢å½¢å åŠ ï¼Œæ¨¡å‹èƒ½åŒºåˆ†â€œå¼ ä¸‰æ‰“äº†æå››â€ä¸â€œæå››æ‰“äº†å¼ ä¸‰â€æˆªç„¶ä¸åŒçš„å«ä¹‰ï¼Œç†è§£â€œçŒ«â€åœ¨â€œåâ€ä¹‹å‰ã€‚</li>
</ul>
<h3 data-id="heading-5">â‘¢ è‡ªæ³¨æ„åŠ› (Self-Attention)ï¼šåŠ¨æ€ç¤¾äº¤ç½‘ç»œ ğŸ‰</h3>
<p>è¿™ä¸æ˜¯ç®€å•çš„â€œçœ‹ä¸€çœ¼â€ï¼Œè€Œæ˜¯<strong>å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰</strong> ã€‚</p>
<ul>
<li>
<p><strong>å…·è±¡ç†è§£</strong>ï¼šæƒ³è±¡æœ‰96ä¸ªä¸åŒçš„â€œé˜…è¯»ä¸“å®¶â€åŒæ—¶åœ¨çœ‹è¿™å¥è¯ã€‚</p>
<ul>
<li>
<p>ä¸“å®¶Aå…³æ³¨<strong>è¯­æ³•ç»“æ„</strong>ï¼ˆä¸»è°“å®¾ï¼‰ï¼›</p>
</li>
<li>
<p>ä¸“å®¶Bå…³æ³¨<strong>æŒ‡ä»£å…³ç³»</strong>ï¼ˆâ€œå®ƒâ€æ˜¯è°ï¼‰ï¼›</p>
</li>
<li>
<p>ä¸“å®¶Cå…³æ³¨<strong>æƒ…ç»ªè‰²å½©</strong>ï¼ˆæ˜¯è¤’ä¹‰è¿˜æ˜¯è´¬ä¹‰ï¼‰ã€‚</p>
<p>æœ€ç»ˆï¼Œè¿™äº›ä¸“å®¶æŠŠå„è‡ªçš„è§‚å¯Ÿç»“æœæ±‡æ€»ï¼Œå½¢æˆå¯¹è¿™ä¸ªè¯å…¨é¢è€Œç«‹ä½“çš„ç†è§£ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">â‘£ å‰é¦ˆç½‘ç»œ (Feed-Forward Networks)ï¼šæ·±åº¦ä¿¡æ¯åŠ å·¥</h3>
<p>æ¯ä¸ªè¯çš„è¡¨å¾ç»è¿·ä½ ç¥ç»ç½‘ç»œè½¬æ¢ï¼Œè¿™æ˜¯æ¨¡å‹çš„â€œè®°å¿†åº“â€ã€‚</p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå¦‚æœæ³¨æ„åŠ›å±‚æ˜¯åœ¨â€œæ”¶é›†çº¿ç´¢â€ï¼Œè¿™ä¸€å±‚å°±æ˜¯åœ¨â€œæŸ¥é˜…ç™¾ç§‘å…¨ä¹¦â€ã€‚å®ƒå°†æå–çš„ç‰¹å¾ï¼ˆå¦‚â€œæŸ”è½¯â€ï¼‰æ˜ å°„åˆ°æ›´å¹¿é˜”çš„çŸ¥è¯†ç©ºé—´ï¼Œå¼ºåŒ–ç»†èŠ‚ç†è§£ï¼ˆå¦‚ï¼š <em>â€œæŸ”è½¯â€ â†’ [èˆ’é€‚æ„Ÿ]ã€[çººç»‡å“]ã€[æ˜“å˜å½¢]ç­‰å…³è”æ¦‚å¿µ</em>ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">â‘¤ å±‚å å †å ï¼šä»è¯­æ³•åˆ°æ„å›¾</h3>
<p>Transformeræ¶æ„é€šå¸¸é‡å¤æ„å»º12å±‚ï¼ˆBERT-Baseï¼‰ã€96å±‚ï¼ˆGPT-3ï¼‰ç”šè‡³æ›´å¤šã€‚</p>
<ul>
<li><strong>æµ…å±‚ï¼ˆ1-10å±‚ï¼‰</strong> ï¼šå¤„ç†åŸºç¡€è¯­æ³•ï¼Œå¦‚è¯†åˆ«åè¯ã€åŠ¨è¯ã€‚</li>
<li><strong>ä¸­å±‚ï¼ˆ10-50å±‚ï¼‰</strong> ï¼šç†è§£è¯­ä¹‰å…³è”ï¼Œå¦‚é€»è¾‘æ¨ç†ã€å› æœå…³ç³»ã€‚</li>
<li><strong>æ·±å±‚ï¼ˆ50+å±‚ï¼‰</strong> ï¼šæç‚¼æŠ½è±¡æ¦‚å¿µï¼Œå¦‚è®½åˆºã€éšå–»ã€å¹½é»˜æ„Ÿæˆ–ç‰¹å®šé¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ã€‚</li>
<li><strong>æ•°æ®æ”¯æ’‘</strong>ï¼šç ”ç©¶è¡¨æ˜ï¼Œå±‚æ•°è¶Šæ·±ï¼Œæ¨¡å‹å¯¹æŠ½è±¡æ¦‚å¿µçš„çº¿æ€§å¯åˆ†æ€§è¶Šå¼ºã€‚</li>
</ul>
<h3 data-id="heading-8">â‘¥ è¾“å‡ºå±‚ï¼šç”Ÿæˆæ™ºèƒ½å›åº”</h3>
<p>æœ€ç»ˆå°†é«˜ç»´å‘é‡æ˜ å°„å›äººç±»è¯æ±‡è¡¨ï¼ˆé€šå¸¸çº¦50,000+ä¸ªè¯ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>æœºåˆ¶</strong>ï¼šè¾“å‡ºçš„æ˜¯<strong>æ¦‚ç‡åˆ†å¸ƒ</strong>ã€‚ä¾‹å¦‚ï¼Œå¯¹äºâ€œå¤©ç©ºæ˜¯__â€ï¼Œæ¨¡å‹å¯èƒ½ä¼šé¢„æµ‹ï¼š</p>
<ul>
<li>
<p>è“è‰² (85%)</p>
</li>
<li>
<p>ç°è’™è’™ (10%)</p>
</li>
<li>
<p>å¹¿é˜” (4%)</p>
</li>
<li>
<p>ç»¿è‰² (0.001% - æä½æ¦‚ç‡)</p>
<p>æ¨¡å‹æ ¹æ®è¿™äº›æ¦‚ç‡ï¼ˆç»“åˆæ¸©åº¦å‚æ•°Temperatureï¼‰é€‰æ‹©æœ€åˆé€‚çš„è¯ä½œä¸ºå›ç­”ã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">è®¾è®¡ä¼˜åŠ¿ï¼šä¸ºä½•è¶…è¶Šä¼ ç»Ÿæ¨¡å‹</h2>
<ul>
<li><strong>å¹¶è¡Œè®¡ç®—çš„èƒœåˆ©</strong>ï¼šä¼ ç»ŸRNNå¿…é¡»è¯»å®Œç¬¬ä¸€ä¸ªè¯æ‰èƒ½è¯»ç¬¬äºŒä¸ªï¼Œè®­ç»ƒåƒè·‘é©¬æ‹‰æ¾ã€‚Transformeråˆ©ç”¨GPUçš„å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œå°±åƒä¸€æ”¯åƒäººå›¢é˜ŸåŒæ—¶é˜…è¯»æ–‡ç« çš„ä¸åŒæ®µè½ã€‚è¿™ä½¿å¾—è®­ç»ƒä¸‡äº¿å‚æ•°çº§æ¨¡å‹ï¼ˆå¦‚GPT-4ï¼‰ä»â€œä¸å¯èƒ½â€å˜ä¸ºâ€œç°å®â€ã€‚</li>
<li><strong>é•¿è·å…³è” (Long-Range Dependencies)</strong> ï¼šRNNå¤§çº¦åªèƒ½è®°ä½å‰100ä¸ªè¯çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨è¿™ä¸ªè·ç¦»å¤–å°±ä¼šå‘ç”Ÿâ€œæ¢¯åº¦æ¶ˆå¤±â€ã€‚è€ŒTransformerçš„ä¸Šä¸‹æ–‡çª—å£ï¼ˆContext Windowï¼‰å¯è½»æ¾è¾¾åˆ°128kç”šè‡³100ä¸‡tokenï¼ˆå¦‚Gemini 1.5 Proï¼‰ï¼Œæ„å‘³ç€å®ƒèƒ½è¯»å®Œã€Šçº¢æ¥¼æ¢¦ã€‹å…¨ä¹¦åï¼Œä¾ç„¶è®°å¾—ç¬¬ä¸€ç« çš„ä¼ç¬”ã€‚</li>
<li><strong>å¯æ‰©å±•æ€§ (Scalability)</strong> ï¼š<strong>ç¼©æ”¾å®šå¾‹ (Scaling Laws)</strong> è¯æ˜ï¼Œå•çº¯å¢åŠ æ•°æ®è§„æ¨¡ã€ç®—åŠ›å’Œæ¨¡å‹å±‚æ•°ï¼Œæ™ºèƒ½æ°´å¹³å°±ä¼šå‘ˆç°æŒ‡æ•°çº§è·ƒè¿ï¼Œæ¶Œç°å‡ºæ„æƒ³ä¸åˆ°çš„èƒ½åŠ›ï¼ˆå¦‚åœ¨æœªä¸“é—¨è®­ç»ƒçš„æƒ…å†µä¸‹å­¦ä¼šç¼–ç¨‹ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-10">æ€ç»´æ¨¡æ‹Ÿæœ¬è´¨ï¼šå¦‚ä½•â€œç†è§£â€è¯­è¨€</h2>
<p>è™½éäººç±»é‚£æ ·çš„ç”Ÿç‰©æ„è¯†ï¼Œä½†é€šè¿‡ä¸‰æ­¥ä¿¡æ¯å¤„ç†å®ç°äº†æé«˜ä¿çœŸçš„â€œç±»æ™ºèƒ½â€ï¼š</p>
<ol>
<li><strong>æ”¶é›†çº¿ç´¢</strong>ï¼ˆæ³¨æ„åŠ›æœºåˆ¶åƒé›·è¾¾ä¸€æ ·æ‰«æå…¨ç½‘å…³è”ï¼‰ï¼›</li>
<li><strong>ä¿¡å·èåˆ</strong>ï¼ˆé€šè¿‡ç™¾å±‚ç½‘ç»œçš„éçº¿æ€§å˜æ¢ï¼Œå°†ç®€å•è¯æ±‡å‡ç»´æˆå¤æ‚æ¦‚å¿µï¼‰ï¼›</li>
<li><strong>æ¨¡å¼é¢„æµ‹</strong>ï¼ˆåŸºäºæµ·é‡äººç±»æ–‡æœ¬çš„ç»Ÿè®¡è§„å¾‹ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªæœ€åˆç†çš„å­—ï¼‰ã€‚</li>
</ol>
<p><strong>å¦‚åŒç²¾å¯†ç¼–æ’çš„æ•°æ®èˆè¹ˆï¼Œå½“èˆæ­¥è¶³å¤Ÿå¤æ‚ä¸ç²¾å‡†æ—¶ï¼Œä¾¿å‘ˆç°å‡ºâ€œæ€è€ƒâ€çš„ä¼˜é›…å§¿æ€ã€‚</strong></p>
<h2 data-id="heading-11">è·¨é¢†åŸŸåº”ç”¨ï¼šé€šç”¨æ™ºèƒ½æ¶æ„</h2>
<p>Transformerå·²ä¸ä»…ä»…æ˜¯è¯­è¨€æ¨¡å‹ï¼Œå®ƒæˆä¸ºäº†AIç•Œçš„â€œå¤§ä¸€ç»Ÿç†è®ºâ€ï¼š</p>
<ul>
<li><strong>å›¾åƒç”Ÿæˆ</strong>ï¼šDALLÂ·Eå’ŒStable Diffusionå°†å›¾åƒåˆ‡ç‰‡è§†ä¸ºâ€œå•è¯â€ï¼Œåˆ©ç”¨Transformerå­¦ä¹ åƒç´ é—´çš„å…³è”ï¼Œä»è€Œæ— ä¸­ç”Ÿæœ‰åœ°åˆ›é€ ç”»ä½œã€‚</li>
<li><strong>ç”Ÿå‘½ç§‘å­¦é©å‘½</strong>ï¼šDeepMindçš„<strong>AlphaFold</strong>å°†æ°¨åŸºé…¸åºåˆ—è§†ä¸ºâ€œæ–‡æœ¬â€ï¼Œåˆ©ç”¨Transformeré¢„æµ‹è›‹ç™½è´¨çš„ä¸‰ç»´ç»“æ„ã€‚å®ƒåœ¨çŸ­çŸ­å‡ å¹´å†…é¢„æµ‹äº†è¶…è¿‡2äº¿ç§è›‹ç™½è´¨ç»“æ„ï¼Œè§£å†³äº†ç”Ÿç‰©å­¦ç•Œå›°æ‰°50å¹´çš„éš¾é¢˜ï¼ŒåŠ é€Ÿäº†æ–°è¯ç ”å‘ã€‚</li>
<li><strong>è‡ªåŠ¨é©¾é©¶ä¸éŸ³è§†é¢‘</strong>ï¼šç‰¹æ–¯æ‹‰ç­‰å…¬å¸ä½¿ç”¨Vision Transformers (ViT) å¤„ç†æ‘„åƒå¤´æ•°æ®ï¼Œç†è§£é“è·¯ä¸Šçš„åŠ¨æ€åœºæ™¯ï¼Œè®©æ±½è½¦å­¦ä¼šâ€œçœ‹è·¯â€ã€‚</li>
</ul>
<p>Transformersæ­£æˆä¸ºAIçš„å…ƒå­¦ä¹ å¼•æ“ï¼Œå‡­çµæ´»çš„æ³¨æ„åŠ›æœºåˆ¶é©±åŠ¨ç€ä»åŸå­å°ºåº¦åˆ°å®‡å®™å°ºåº¦çš„å…¨é¢†åŸŸåˆ›æ–°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ†äº«å‡ ä¸ªä½¿ç”¨Nano Banana Pro ç”»ä¿¡æ¯å›¾çš„æç¤ºè¯]]></title>    <link>https://juejin.cn/post/7585485074038194182</link>    <guid>https://juejin.cn/post/7585485074038194182</guid>    <pubDate>2025-12-20T15:24:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038194182" data-draft-id="7585468725332918326" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ†äº«å‡ ä¸ªä½¿ç”¨Nano Banana Pro ç”»ä¿¡æ¯å›¾çš„æç¤ºè¯"/> <meta itemprop="keywords" content="GitHub,åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T15:24:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èµ›åšä¸œå“¥CyberFD"/> <meta itemprop="url" content="https://juejin.cn/user/4323692639162087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ†äº«å‡ ä¸ªä½¿ç”¨Nano Banana Pro ç”»ä¿¡æ¯å›¾çš„æç¤ºè¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4323692639162087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èµ›åšä¸œå“¥CyberFD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T15:24:33.000Z" title="Sat Dec 20 2025 15:24:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å°†æ–‡ç« å˜æˆé»‘æ¿æŠ¥çš„æç¤ºè¯</h2>
<pre><code class="hljs language-diff" lang="diff">{å†…å®¹}

è¯·æ ¹æ®è¾“å…¥å†…å®¹æå–æ ¸å¿ƒä¸»é¢˜ä¸è¦ç‚¹ï¼Œç”Ÿæˆä¸€å¼ é»‘æ¿æŠ¥é£æ ¼çš„ä¿¡æ¯å›¾ï¼š  
<span class="hljs-deletion">- é‡‡ç”¨é»‘è‰²é»‘æ¿èƒŒæ™¯å’Œç²‰ç¬”æ‰‹ç»˜é£æ ¼ï¼Œæ¨ªç‰ˆï¼ˆ16:9ï¼‰æ„å›¾ã€‚  </span>
<span class="hljs-deletion">- ä¿¡æ¯ç²¾ç®€ï¼Œçªå‡ºå…³é”®è¯ä¸æ ¸å¿ƒæ¦‚å¿µï¼Œå¤šç•™ç™½ï¼Œæ˜“äºä¸€çœ¼æŠ“ä½é‡ç‚¹ã€‚  </span>
<span class="hljs-deletion">- åŠ å…¥å°‘é‡ç®€æ´çš„å¡é€šå…ƒç´ ã€å›¾æ ‡æˆ–åäººç”»åƒï¼Œå¢å¼ºè¶£å‘³æ€§å’Œè§†è§‰è®°å¿†ã€‚  </span>
<span class="hljs-deletion">- æ‰€æœ‰å›¾åƒã€æ–‡å­—å¿…é¡»ä½¿ç”¨å½©è‰²ç²‰ç¬”ç»˜åˆ¶ï¼Œæ²¡æœ‰å†™å®é£æ ¼å›¾ç”»å…ƒç´   </span>
<span class="hljs-deletion">- é™¤éç‰¹åˆ«è¦æ±‚ï¼Œå¦åˆ™è¯­è¨€ä¸è¾“å…¥å†…å®¹è¯­è¨€ä¸€è‡´ã€‚  </span>
è¯·æ ¹æ®è¾“å…¥çš„å†…å®¹ä½¿ç”¨ nano banana pro ç”»å›¾ï¼š
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3736e7104b744eff84f10e289670c72d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LWb5Y2a5Lic5ZOlQ3liZXJGRA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766849072&amp;x-signature=TQs0I3pRlyG1RswjHrYzEs9juQQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">ä¿¡æ¯å›¾çš„å…ƒæç¤ºè¯</h2>
<p><strong>æ³¨æ„ï¼š</strong> è¿™æ˜¯ç”»å›¾æç¤ºè¯çš„å…ƒæç¤ºè¯</p>
<pre><code class="hljs">  
ä½ æ˜¯ä¸€ä½ä¸–ç•Œçº§çš„æ•™å­¦è®¾è®¡å¸ˆ  
  
ä½ æ˜¯ä¸€ä½æ“…é•¿åˆ¶ä½œæ¸…æ™°ã€ç®€æ´ä¸”å¼•äººå…¥èƒœçš„å­¦ä¹ ææ–™çš„å¤§å¸ˆã€‚ä½ ä¹Ÿæ˜¯ä¸€ä½è§†è§‰è®¾è®¡ä¸“å®¶ï¼Œæ‡‚å¾—å¦‚ä½•åˆ©ç”¨è§†è§‰å…ƒç´ å°†å¤æ‚çš„æ¦‚å¿µä»¥é€šä¿—æ˜“æ‡‚çš„æ–¹å¼ä¼ è¾¾å‡ºæ¥ã€‚åŒæ—¶ï¼Œä½ è¿˜æ˜¯è®²æ•…äº‹çš„å¤§å¸ˆï¼Œæ‡‚å¾—å¦‚ä½•è¿ç”¨æ•…äº‹è®©å­¦ä¹ è¿‡ç¨‹æ›´ä»¤äººéš¾å¿˜ä¸”å……æ»¡è¶£å‘³ã€‚  
  
ä½ çš„ä»»åŠ¡æ˜¯åˆ†ææä¾›çš„ã€æºèƒŒæ™¯ä¿¡æ¯ã€‘å’Œã€ç”¨æˆ·å¼•å¯¼æç¤ºã€‘ï¼Œå¹¶ç”Ÿæˆä¸€ä»½ç»“æ„åŒ–çš„ä¿¡æ¯å›¾è¡¨å†…å®¹ã€‚è¯¥å†…å®¹å°†å‘ŠçŸ¥ä¸“ä¸šä¿¡æ¯å›¾è®¾è®¡å¸ˆéœ€è¦ä¼ è¾¾å“ªäº›ä¿¡æ¯ï¼Œä»¥ä¾¿å—ä¼—èƒ½æ¸…æ™°ç†è§£æºèƒŒæ™¯ä¿¡æ¯ã€‚  
  
è¿™ä»½å†…å®¹å°†åœ¨ä¸‹ä¸€æ­¥ä¼ é€’ç»™ä¸“ä¸šä¿¡æ¯å›¾è®¾è®¡å¸ˆï¼Œä»–ä»¬å°†ä¾æ®æ­¤å†…å®¹åˆ¶ä½œé«˜è´¨é‡çš„ä¿¡æ¯å›¾ã€‚è®¾è®¡å¸ˆæ— æ³•è®¿é—®ã€æºèƒŒæ™¯ä¿¡æ¯ã€‘ï¼Œå› æ­¤è¯·ç¡®ä¿å†…å®¹è¡¨è¿°å……åˆ†ã€‚ ä¿¡æ¯å›¾å¿…é¡»ä½¿ç”¨ ã€ä¸­æ–‡ã€‘ã€‚  
  
ä½ è¿˜éœ€è¦åˆ†ææä¾›çš„ã€ç”¨æˆ·å¼•å¯¼æç¤ºã€‘ï¼Œä»ä¸­æå–ä»…ä¸è®¾è®¡ç›¸å…³çš„æŒ‡ä»¤ï¼ˆé£æ ¼ã€å¸ƒå±€ã€é¢œè‰²ç­‰ï¼‰ï¼Œå¹¶å°†å…¶æ”¾å…¥æœ«å°¾ä¸“é—¨çš„è®¾è®¡æŒ‡å—éƒ¨åˆ†ã€‚  
  
å·¥ä½œæµç¨‹  
  
ç¬¬ 1 æ­¥ï¼šåˆ†ææºæ–‡æ¡£ã€‚é€šè¯»æ•´ç¯‡æ–‡æ¡£å¹¶æ·±å…¥ç†è§£å…¶å†…å®¹ã€‚  
  
ç¬¬ 2 æ­¥ï¼šåˆ›å»ºé«˜å±‚çº§å¤§çº²ã€‚å¤§çº²åº”åŒ…å«æ ‡é¢˜å’Œæ‰€æœ‰ä¸»è¦å­¦ä¹ ç›®æ ‡åˆ—è¡¨ã€‚  
  
ç¬¬ 3 æ­¥ï¼šå……å®å¤§çº²å†…å®¹ã€‚ä¸ºæ¯ä¸ªå­¦ä¹ ç›®æ ‡åˆ›å»ºä¸€ä¸ªç« èŠ‚ã€‚æ¯ä¸ªç« èŠ‚éƒ½åº”åŒ…å«æ¦‚å¿µè§£é‡Šå’Œå®æ“æ•™ç¨‹çš„ç»„åˆã€‚  
  
å…³é”®è§„åˆ™  
  
è§„åˆ™ 1ï¼šè¾“å‡ºæ ¼å¼ä¸º Markdownã€‚æ‰€æœ‰ç”Ÿæˆçš„å†…å®¹å¿…é¡»ä¸¥æ ¼éµå®ˆ Markdown æ ¼å¼ã€‚  
  
è§„åˆ™ 2ï¼šè¯­æ°”å’Œå£å»ã€‚è¯­æ°”åº”å¦‚åŒä¸“å®¶åŸ¹è®­å¸ˆï¼šçŸ¥è¯†æ¸Šåšã€å……æ»¡é¼“åŠ±ä¸”æ¸…æ™°æ˜äº†ã€‚  
  
è§„åˆ™ 3ï¼šæ— æ–°å¢ä¿¡æ¯ã€‚ä¸è¦æ·»åŠ ä»»ä½•æºæ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„ä¿¡æ¯ã€‚  
  
è§„åˆ™ 4ï¼šæºæ•°æ®å¤„ç†ã€‚æºæ–‡æ¡£ä¸­çš„æ‰€æœ‰æ•°æ®å¿…é¡»é€å­—å¤åˆ¶ã€‚ä¸è¦è¿›è¡Œæ€»ç»“æˆ–æ”¹å†™
</code></pre>
<p>ç¤ºä¾‹ï¼š
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fshare%2Fd2241f26e734" target="_blank" title="https://gemini.google.com/share/d2241f26e734" ref="nofollow noopener noreferrer">gemini.google.com/share/d2241â€¦</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7782d90b6664f1d90f879c7c93784d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LWb5Y2a5Lic5ZOlQ3liZXJGRA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766849072&amp;x-signature=zhWIwGZRGi6hxRsoHVlqy6vzlSg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">æ‰‹ç»˜é£æ ¼çš„ä¿¡æ¯å›¾å¡ç‰‡æç¤ºè¯</h2>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åˆ›ä½œä¸€å¼ æ‰‹ç»˜é£æ ¼çš„ä¿¡æ¯å›¾å¡ç‰‡ï¼Œæ¯”ä¾‹ä¸º9:16ç«–ç‰ˆã€‚å¡ç‰‡ä¸»é¢˜é²œæ˜ï¼ŒèƒŒæ™¯ä¸ºå¸¦æœ‰çº¸è´¨è‚Œç†çš„ç±³è‰²æˆ–ç±³ç™½è‰²ï¼Œæ•´ä½“è®¾è®¡ä½“ç°è´¨æœ´ã€äº²åˆ‡çš„æ‰‹ç»˜ç¾æ„Ÿã€‚  </span>
  
å¡ç‰‡ä¸Šæ–¹ä»¥çº¢é»‘ç›¸é—´ã€å¯¹æ¯”é²œæ˜çš„å¤§å·æ¯›ç¬”è‰ä¹¦å­—ä½“çªå‡ºæ ‡é¢˜ï¼Œå¸å¼•è§†è§‰ç„¦ç‚¹ã€‚æ–‡å­—å†…å®¹å‡é‡‡ç”¨ä¸­æ–‡è‰ä¹¦ï¼Œæ•´ä½“å¸ƒå±€åˆ†ä¸º2è‡³4ä¸ªæ¸…æ™°çš„å°èŠ‚ï¼Œæ¯èŠ‚ä»¥ç®€çŸ­ã€ç²¾ç‚¼çš„ä¸­æ–‡çŸ­è¯­è¡¨è¾¾æ ¸å¿ƒè¦ç‚¹ã€‚å­—ä½“ä¿æŒè‰ä¹¦æµç•…çš„éŸµå¾‹æ„Ÿï¼Œæ—¢æ¸…æ™°å¯è¯»åˆå¯Œæœ‰è‰ºæœ¯æ°”æ¯ã€‚  
  
å¡ç‰‡ä¸­ç‚¹ç¼€ç®€å•ã€æœ‰è¶£çš„æ‰‹ç»˜æ’ç”»æˆ–å›¾æ ‡ï¼Œä¾‹å¦‚äººç‰©æˆ–è±¡å¾ç¬¦å·ï¼Œä»¥å¢å¼ºè§†è§‰å¸å¼•åŠ›ï¼Œå¼•å‘è¯»è€…æ€è€ƒä¸å…±é¸£ã€‚æ•´ä½“å¸ƒå±€æ³¨æ„è§†è§‰å¹³è¡¡ï¼Œé¢„ç•™è¶³å¤Ÿçš„ç©ºç™½ç©ºé—´ï¼Œç¡®ä¿ç”»é¢ç®€æ´æ˜äº†ï¼Œæ˜“äºé˜…è¯»å’Œç†è§£ã€‚  
  
ä¸»é¢˜æ˜¯ï¼šâ€œåšIPæ˜¯é•¿æœŸå¤åˆ©ï¼ŒåšæŒæ¯æ—¥å‡ºæ‘Šï¼ŒæŒç»­åšï¼Œè‚¯å®šä¼šæœ‰ç»“æœï¼Œå› ä¸º99%éƒ½åšæŒä¸ä½çš„

</code></pre>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ed016d458d849c8a3aebc51553796c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LWb5Y2a5Lic5ZOlQ3liZXJGRA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766849072&amp;x-signature=MXFN9yZc2RxDG90%2FqrH3H9zWFzE%3D" alt="image.png" width="50%" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonå…¥é—¨æŒ‡å—(äº”) - ä¸ºä»€ä¹ˆé€‰æ‹© FastAPIï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585485074038259718</link>    <guid>https://juejin.cn/post/7585485074038259718</guid>    <pubDate>2025-12-20T16:00:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038259718" data-draft-id="7585485074038243334" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonå…¥é—¨æŒ‡å—(äº”) - ä¸ºä»€ä¹ˆé€‰æ‹© FastAPIï¼Ÿ"/> <meta itemprop="keywords" content="Python,FastAPI,åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T16:00:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å´ä½³æµ©"/> <meta itemprop="url" content="https://juejin.cn/user/2696441245481975"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonå…¥é—¨æŒ‡å—(äº”) - ä¸ºä»€ä¹ˆé€‰æ‹© FastAPIï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2696441245481975/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å´ä½³æµ©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T16:00:34.000Z" title="Sat Dec 20 2025 16:00:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"ğŸº";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"ğŸ»";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"ğŸ¥‚";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"ğŸ¥ƒ";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"ğŸ”¸"}.markdown-body ul li li{list-style-type:"â—»ï¸"}.markdown-body ul li li li{list-style-type:"â–«ï¸"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"ğŸŸ©";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"âœ…"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0"><strong>Pythonå…¥é—¨æŒ‡å—(äº”) - ä¸ºä»€ä¹ˆé€‰æ‹© FastAPIï¼Ÿ</strong></h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7b25ea2caab4006a83fc7c2cacbd6a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766851234&amp;x-signature=P2%2F4d2YObqiy0fcQdTXOzmsMcjw%3D" alt="image.png" loading="lazy"/></p>
<p>æ¬¢è¿æ¥åˆ°Pythonå…¥é—¨æŒ‡å—çš„ç¬¬äº”éƒ¨åˆ†ï¼åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†Pythonå¼€å‘ç¯å¢ƒçš„åˆå§‹åŒ–é…ç½®ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥å®æˆ˜é˜¶æ®µâ€”â€”é€‰æ‹©åˆé€‚çš„Webæ¡†æ¶æ¥æ„å»ºæˆ‘ä»¬çš„APIæœåŠ¡ã€‚</p>
<p>æœ¬ç« å°†æ·±å…¥å¯¹æ¯” <strong>Flask</strong> å’Œ <strong>FastAPI</strong>ï¼Œå¸®åŠ©ä½ ç†è§£ä¸ºä»€ä¹ˆåœ¨ç°ä»£Pythonå¼€å‘ä¸­ï¼ŒFastAPIæ­£åœ¨æˆä¸ºè¶Šæ¥è¶Šå¤šå¼€å‘è€…çš„é¦–é€‰ã€‚</p>
<hr/>
<h3 data-id="heading-1">** ä¸ºä»€ä¹ˆéœ€è¦Webæ¡†æ¶ï¼Ÿ**</h3>
<p>åœ¨è¿›å…¥å¯¹æ¯”ä¹‹å‰ï¼Œå…ˆç†è§£Webæ¡†æ¶çš„æ ¸å¿ƒä½œç”¨ï¼š</p>
<ul>
<li><strong>å¤„ç†HTTPè¯·æ±‚å’Œå“åº”</strong>ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œè¿”å›å¤„ç†ç»“æœ</li>
<li><strong>è·¯ç”±ç®¡ç†</strong>ï¼šå°†ä¸åŒçš„URLæ˜ å°„åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°</li>
<li><strong>æ•°æ®éªŒè¯</strong>ï¼šç¡®ä¿æ¥æ”¶åˆ°çš„æ•°æ®ç¬¦åˆé¢„æœŸæ ¼å¼</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæé«˜å¹¶å‘æ€§èƒ½ï¼Œå¤„ç†æ›´å¤šç”¨æˆ·è¯·æ±‚</li>
<li><strong>è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</strong>ï¼šè®©APIä½¿ç”¨è€…å¿«é€Ÿäº†è§£æ¥å£ç”¨æ³•</li>
</ul>
<hr/>
<h3 data-id="heading-2">** Flask vs FastAPIï¼šæ ¸å¿ƒå¯¹æ¯”**</h3>
<h4 data-id="heading-3"><strong>1. æ€§èƒ½å¯¹æ¯”</strong></h4>
<p>FastAPIåŸºäºASGIï¼ˆå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼‰ï¼Œè€ŒFlaskåŸºäºWSGIï¼ˆåŒæ­¥ï¼‰ã€‚è¿™å¸¦æ¥äº†å·¨å¤§çš„æ€§èƒ½å·®å¼‚ï¼š</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>Flask</th><th>FastAPI</th></tr></thead><tbody><tr><td><strong>å¹¶å‘æ¨¡å‹</strong></td><td>åŒæ­¥ï¼ˆWSGIï¼‰</td><td>å¼‚æ­¥ï¼ˆASGIï¼‰</td></tr><tr><td><strong>æ¯ç§’è¯·æ±‚æ•°</strong></td><td>~1,000-3,000</td><td>~10,000-20,000</td></tr><tr><td><strong>å»¶è¿Ÿ</strong></td><td>è¾ƒé«˜</td><td>æä½</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä¼ ç»ŸWebåº”ç”¨</td><td>é«˜å¹¶å‘APIæœåŠ¡</td></tr></tbody></table>
<p><strong>æ€§èƒ½æµ‹è¯•å¯¹æ¯”ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç›¸åŒçš„ç®€å•ç«¯ç‚¹ï¼ŒFastAPIæ¯”Flaskå¿«3-5å€</span>
<span class="hljs-comment"># åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå·®è·å¯è¾¾10å€ä»¥ä¸Š</span>
</code></pre>
<hr/>
<h4 data-id="heading-4"><strong>2. ä»£ç å¯¹æ¯”ï¼šä¸€ç›®äº†ç„¶çš„å·®å¼‚</strong></h4>
<h5 data-id="heading-5"><strong>Flask ä»£ç ç¤ºä¾‹</strong></h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify

app = Flask(__name__)

<span class="hljs-comment"># å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆéœ€è¦æ‰‹åŠ¨éªŒè¯ï¼‰</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/users'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>():
    data = request.get_json()
    
    <span class="hljs-comment"># æ‰‹åŠ¨éªŒè¯æ•°æ®</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'name'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(data[<span class="hljs-string">'name'</span>], <span class="hljs-built_in">str</span>):
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'åç§°å¿…é¡»æ˜¯å­—ç¬¦ä¸²'</span>}), <span class="hljs-number">400</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'age'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(data[<span class="hljs-string">'age'</span>], <span class="hljs-built_in">int</span>):
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'å¹´é¾„å¿…é¡»æ˜¯æ•´æ•°'</span>}), <span class="hljs-number">400</span>
    <span class="hljs-keyword">if</span> data[<span class="hljs-string">'age'</span>] &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> data[<span class="hljs-string">'age'</span>] &gt; <span class="hljs-number">150</span>:
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´'</span>}), <span class="hljs-number">400</span>
    
    <span class="hljs-comment"># å¤„ç†é€»è¾‘</span>
    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">'id'</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">'name'</span>: data[<span class="hljs-string">'name'</span>],
        <span class="hljs-string">'age'</span>: data[<span class="hljs-string">'age'</span>]
    })

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/users/&lt;int:user_id&gt;'</span>, methods=[<span class="hljs-string">'GET'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">user_id</span>):
    <span class="hljs-comment"># åŒæ­¥æ•°æ®åº“æŸ¥è¯¢ï¼ˆä¼šé˜»å¡ï¼‰</span>
    user = {<span class="hljs-string">'id'</span>: user_id, <span class="hljs-string">'name'</span>: <span class="hljs-string">'John'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">30</span>}
    <span class="hljs-keyword">return</span> jsonify(user)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>Flaskçš„ç—›ç‚¹</strong>ï¼š</p>
<ul>
<li>æ•°æ®éªŒè¯éœ€è¦å¤§é‡æ‰‹åŠ¨ä»£ç </li>
<li>ç±»å‹æç¤ºä¸å®Œå–„ï¼ŒIDEæ— æ³•æœ‰æ•ˆè¾…åŠ©</li>
<li>åŒæ­¥æ¨¡å¼ï¼Œé«˜å¹¶å‘æ€§èƒ½å·®</li>
<li>æ²¡æœ‰è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£</li>
</ul>
<hr/>
<h5 data-id="heading-6"><strong>FastAPI ä»£ç ç¤ºä¾‹</strong></h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field

app = FastAPI()

<span class="hljs-comment"># ä½¿ç”¨Pydanticè‡ªåŠ¨éªŒè¯æ•°æ®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    name: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">1</span>, max_length=<span class="hljs-number">50</span>)
    age: <span class="hljs-built_in">int</span> = Field(..., ge=<span class="hljs-number">0</span>, le=<span class="hljs-number">150</span>)

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">'/users'</span>, response_model=User</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: User</span>):
    <span class="hljs-comment"># æ•°æ®è‡ªåŠ¨éªŒè¯ï¼Œæ— æ•ˆæ•°æ®è‡ªåŠ¨è¿”å›400é”™è¯¯</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'id'</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">'name'</span>: user.name,
        <span class="hljs-string">'age'</span>: user.age
    }

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">'/users/{user_id}'</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-comment"># å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡å…¶ä»–è¯·æ±‚</span>
    user = {<span class="hljs-string">'id'</span>: user_id, <span class="hljs-string">'name'</span>: <span class="hljs-string">'John'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">30</span>}
    <span class="hljs-keyword">return</span> user

<span class="hljs-comment"># è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£è®¿é—®ï¼šhttp://localhost:8000/docs</span>
</code></pre>
<p><strong>FastAPIçš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… è‡ªåŠ¨æ•°æ®éªŒè¯ï¼Œä»£ç é‡å‡å°‘60%</li>
<li>âœ… å®Œæ•´çš„ç±»å‹æç¤ºï¼ŒIDEæ™ºèƒ½è¡¥å…¨</li>
<li>âœ… å¼‚æ­¥æ”¯æŒï¼Œæ€§èƒ½æå‡5-10å€</li>
<li>âœ… è‡ªåŠ¨ç”ŸæˆSwagger UIæ–‡æ¡£</li>
</ul>
<hr/>
<h4 data-id="heading-7"><strong>3. æ•°æ®éªŒè¯å¯¹æ¯”</strong></h4>
<p>è¿™æ˜¯ä¸¤ä¸ªæ¡†æ¶æœ€å¤§çš„å·®å¼‚ä¹‹ä¸€ï¼š</p>
<p><strong>Flaskéœ€è¦æ‰‹åŠ¨éªŒè¯</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Flaskï¼šæ¯ä¸ªå­—æ®µéƒ½è¦å†™éªŒè¯é€»è¾‘</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data.get(<span class="hljs-string">'email'</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data[<span class="hljs-string">'email'</span>]:
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'é‚®ç®±æ ¼å¼é”™è¯¯'</span>}, <span class="hljs-number">400</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data.get(<span class="hljs-string">'password'</span>) <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(data[<span class="hljs-string">'password'</span>]) &lt; <span class="hljs-number">8</span>:
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'å¯†ç è‡³å°‘8ä½'</span>}, <span class="hljs-number">400</span>
<span class="hljs-comment"># ... æ›´å¤šå­—æ®µéªŒè¯</span>
</code></pre>
<p><strong>FastAPIè‡ªåŠ¨éªŒè¯</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># FastAPIï¼šå£°æ˜å³éªŒè¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRegister</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    email: EmailStr  <span class="hljs-comment"># è‡ªåŠ¨éªŒè¯é‚®ç®±æ ¼å¼</span>
    password: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">8</span>)  <span class="hljs-comment"># è‡ªåŠ¨éªŒè¯é•¿åº¦</span>
    age: <span class="hljs-built_in">int</span> = Field(..., ge=<span class="hljs-number">18</span>, le=<span class="hljs-number">100</span>)  <span class="hljs-comment"># è‡ªåŠ¨éªŒè¯èŒƒå›´</span>

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">'/register'</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">user: UserRegister</span>):
    <span class="hljs-comment"># åˆ°è¾¾è¿™é‡Œï¼Œæ•°æ®å·²ç»100%ç¬¦åˆè¦æ±‚</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'message'</span>: <span class="hljs-string">'æ³¨å†ŒæˆåŠŸ'</span>}
</code></pre>
<hr/>
<h4 data-id="heading-8"><strong>4. è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£</strong></h4>
<p>è¿™æ˜¯FastAPIçš„æ€æ‰‹çº§ç‰¹æ€§ï¼š</p>
<p><strong>Flask</strong>ï¼š</p>
<ul>
<li>âŒ éœ€è¦æ‰‹åŠ¨ç¼–å†™æ–‡æ¡£</li>
<li>âŒ éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚flask-swaggerï¼‰</li>
<li>âŒ æ–‡æ¡£å’Œä»£ç å®¹æ˜“ä¸åŒæ­¥</li>
</ul>
<p><strong>FastAPI</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨åè‡ªåŠ¨ç”ŸæˆSwagger UIæ–‡æ¡£ï¼š<code>http://localhost:8000/docs</code></li>
<li>è‡ªåŠ¨ç”ŸæˆReDocæ–‡æ¡£ï¼š<code>http://localhost:8000/redoc</code></li>
<li>æ–‡æ¡£å§‹ç»ˆä¸ä»£ç åŒæ­¥</li>
</ul>
<p><strong>FastAPIè‡ªåŠ¨æ–‡æ¡£ç•Œé¢é¢„è§ˆ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI - Swagger UI                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  POST  /users      åˆ›å»ºç”¨æˆ·             â”‚
â”‚  â”œâ”€ Request Body                        â”‚
â”‚  â”‚   {                                  â”‚
â”‚  â”‚     <span class="hljs-string">"name"</span>: <span class="hljs-string">"string"</span>,                â”‚
â”‚  â”‚     <span class="hljs-string">"age"</span>: 0                         â”‚
â”‚  â”‚   }                                  â”‚
â”‚  â””â”€ Try it out (å¯ç›´æ¥æµ‹è¯•)             â”‚
â”‚                                         â”‚
â”‚  GET   /users/{<span class="hljs-built_in">id</span>}  è·å–ç”¨æˆ·             â”‚
â”‚  â””â”€ Parameters: user_id (<span class="hljs-built_in">integer</span>)       â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>æ¶æ„æµç¨‹å¯¹æ¯”</strong></h3>
<p>è®©æˆ‘ä»¬ç”¨Mermaidå›¾ç›´è§‚å±•ç¤ºä¸¤ä¸ªæ¡†æ¶çš„è¯·æ±‚å¤„ç†æµç¨‹ï¼š</p>
<h4 data-id="heading-10"><strong>Flask è¯·æ±‚å¤„ç†æµç¨‹</strong></h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[å®¢æˆ·ç«¯è¯·æ±‚] --&gt; B[WSGIæœåŠ¡å™¨]
    B --&gt; C[Flaskè·¯ç”±åŒ¹é…]
    C --&gt; D[è§†å›¾å‡½æ•°å¤„ç†]
    D --&gt; E{æ‰‹åŠ¨æ•°æ®éªŒè¯}
    E --&gt;|éªŒè¯å¤±è´¥| F[è¿”å›é”™è¯¯å“åº”]
    E --&gt;|éªŒè¯æˆåŠŸ| G[ä¸šåŠ¡é€»è¾‘å¤„ç†]
    G --&gt; H[åŒæ­¥æ•°æ®åº“æŸ¥è¯¢]
    H --&gt;|é˜»å¡ç­‰å¾…| I[è¿”å›å“åº”]
    I --&gt; J[å®¢æˆ·ç«¯æ¥æ”¶]
    
    style E fill:#ff6b6b
    style H fill:#ff6b6b
    style F fill:#ffd93d
</code></pre>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªè¯·æ±‚éƒ½ä¼šé˜»å¡ä¸€ä¸ªçº¿ç¨‹</li>
<li>æ‰‹åŠ¨éªŒè¯å®¹æ˜“å‡ºé”™ä¸”ä»£ç å†—ä½™</li>
<li>é«˜å¹¶å‘æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™</li>
</ul>
<hr/>
<h4 data-id="heading-11"><strong>FastAPI è¯·æ±‚å¤„ç†æµç¨‹</strong></h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[å®¢æˆ·ç«¯è¯·æ±‚] --&gt; B[ASGIæœåŠ¡å™¨ Uvicorn]
    B --&gt; C[FastAPIè·¯ç”±åŒ¹é…]
    C --&gt; D{Pydanticè‡ªåŠ¨éªŒè¯}
    D --&gt;|éªŒè¯å¤±è´¥| E[è‡ªåŠ¨è¿”å›422é”™è¯¯]
    D --&gt;|éªŒè¯æˆåŠŸ| F[å¼‚æ­¥å¤„ç†å‡½æ•°]
    F --&gt; G[å¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢]
    G --&gt;|éé˜»å¡| H[å…¶ä»–è¯·æ±‚ç»§ç»­å¤„ç†]
    G --&gt; I[è¿”å›å“åº”]
    I --&gt; J[å®¢æˆ·ç«¯æ¥æ”¶]
    
    style D fill:#51cf66
    style F fill:#51cf66
    style G fill:#51cf66
    style H fill:#4dabf7
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å¼‚æ­¥å¤„ç†ï¼Œå•çº¿ç¨‹å¤„ç†æ•°åƒå¹¶å‘</li>
<li>è‡ªåŠ¨éªŒè¯ï¼Œé›¶æ‰‹åŠ¨ä»£ç </li>
<li>éé˜»å¡IOï¼Œæ€§èƒ½æè‡´ä¼˜åŒ–</li>
</ul>
<hr/>
<h3 data-id="heading-12"><strong>æ€§èƒ½å¯¹æ¯”ï¼šå®æˆ˜æµ‹è¯•</strong></h3>
<h4 data-id="heading-13"><strong>å¹¶å‘èƒ½åŠ›å¯¹æ¯”</strong></h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[1000ä¸ªå¹¶å‘è¯·æ±‚] --&gt; B[FlaskåŒæ­¥å¤„ç†]
    A --&gt; C[FastAPIå¼‚æ­¥å¤„ç†]
    
    B --&gt; D[è€—æ—¶: 10ç§’&lt;br/&gt;CPU: 95%&lt;br/&gt;å†…å­˜: 500MB]
    C --&gt; E[è€—æ—¶: 2ç§’&lt;br/&gt;CPU: 40%&lt;br/&gt;å†…å­˜: 150MB]
    
    style D fill:#ff6b6b
    style E fill:#51cf66
</code></pre>
<h4 data-id="heading-14"><strong>å®é™…åœºæ™¯ç¤ºä¾‹</strong></h4>
<p><strong>åœºæ™¯ï¼šè°ƒç”¨å¤–éƒ¨APIè·å–æ•°æ®</strong></p>
<p><strong>Flaskï¼ˆåŒæ­¥ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/weather'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>():
    <span class="hljs-comment"># è°ƒç”¨å¤–éƒ¨APIï¼ˆé˜»å¡3ç§’ï¼‰</span>
    response = requests.get(<span class="hljs-string">'https://api.weather.com/...'</span>)
    <span class="hljs-comment"># è¿™3ç§’å†…ï¼Œè¯¥çº¿ç¨‹æ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚</span>
    <span class="hljs-keyword">return</span> response.json()
</code></pre>
<p><strong>FastAPIï¼ˆå¼‚æ­¥ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">'/weather'</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>():
    <span class="hljs-comment"># å¼‚æ­¥è°ƒç”¨ï¼ˆéé˜»å¡ï¼‰</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient() <span class="hljs-keyword">as</span> client:
        response = <span class="hljs-keyword">await</span> client.get(<span class="hljs-string">'https://api.weather.com/...'</span>)
    <span class="hljs-comment"># ç­‰å¾…æœŸé—´ï¼Œå¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚</span>
    <span class="hljs-keyword">return</span> response.json()
</code></pre>
<hr/>
<h3 data-id="heading-15">** ç”Ÿæ€ç³»ç»Ÿ**</h3>
<h4 data-id="heading-16"/>
<p><strong>FastAPIç”Ÿæ€</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((FastAPI))
    å†…ç½®åŠŸèƒ½
      è‡ªåŠ¨æ–‡æ¡£
      æ•°æ®éªŒè¯
      ä¾èµ–æ³¨å…¥
      å¼‚æ­¥æ”¯æŒ
    é›†æˆå·¥å…·
      SQLAlchemyå¼‚æ­¥
      Tortoise ORM
      Rediså¼‚æ­¥
      WebSocket
    ç°ä»£ç‰¹æ€§
      ç±»å‹æç¤º
      å¼‚æ­¥ä¼˜å…ˆ
      é«˜æ€§èƒ½
      ç®€æ´API
</code></pre>
<hr/>
<h3 data-id="heading-17"><strong>ğŸ“ˆ ä½¿ç”¨åœºæ™¯æ¨è</strong></h3>
<h4 data-id="heading-18"><strong>ä»€ä¹ˆæ—¶å€™é€‰æ‹©Flaskï¼Ÿ</strong></h4>
<p>é€‚åˆåœºæ™¯ï¼š</p>
<ul>
<li>ä¼ ç»ŸWebåº”ç”¨ï¼ˆæ¨¡æ¿æ¸²æŸ“ä¸ºä¸»ï¼‰</li>
<li>å°å‹é¡¹ç›®ï¼Œå¿«é€ŸåŸå‹</li>
<li>å›¢é˜Ÿå·²æœ‰Flaskç»éªŒ</li>
<li>ä¸éœ€è¦é«˜å¹¶å‘å¤„ç†</li>
</ul>
<h4 data-id="heading-19"><strong>ä»€ä¹ˆæ—¶å€™é€‰æ‹©FastAPIï¼Ÿ</strong></h4>
<p>é€‚åˆåœºæ™¯ï¼š</p>
<ul>
<li><strong>ç°ä»£APIæœåŠ¡</strong>ï¼ˆRESTful APIï¼‰</li>
<li><strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼ˆå¾®æœåŠ¡ã€å®æ—¶ç³»ç»Ÿï¼‰</li>
<li><strong>éœ€è¦è‡ªåŠ¨æ–‡æ¡£</strong>ï¼ˆå›¢é˜Ÿåä½œï¼‰</li>
<li><strong>AI/MLæ¨¡å‹éƒ¨ç½²</strong>ï¼ˆå¦‚YOLOæ£€æµ‹æœåŠ¡ï¼‰</li>
<li><strong>WebSocketå®æ—¶é€šä¿¡</strong></li>
</ul>
<hr/>
<h3 data-id="heading-20">** FastAPI + YOLOï¼šå®Œç¾ç»„åˆ**</h3>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨FastAPIæ„å»ºYOLOç›®æ ‡æ£€æµ‹æœåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œç¾çš„åº”ç”¨åœºæ™¯ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant F as FastAPIæœåŠ¡
    participant Y as YOLOæ¨¡å‹
    participant D as æ•°æ®åº“
    
    C-&gt;&gt;F: ä¸Šä¼ å›¾ç‰‡/è§†é¢‘
    F-&gt;&gt;F: å¼‚æ­¥éªŒè¯æ•°æ®
    F-&gt;&gt;Y: å¼‚æ­¥è°ƒç”¨æ¨¡å‹æ£€æµ‹
    Y--&gt;&gt;F: è¿”å›æ£€æµ‹ç»“æœ
    F-&gt;&gt;D: å¼‚æ­¥ä¿å­˜ç»“æœ
    F--&gt;&gt;C: å®æ—¶è¿”å›ç»“æœ
    
    Note over F,Y: å¼‚æ­¥å¤„ç†å…è®¸åŒæ—¶&lt;br/&gt;å¤„ç†å¤šä¸ªæ£€æµ‹è¯·æ±‚
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆYOLOéœ€è¦FastAPIï¼Ÿ</strong></p>
<ul>
<li>æ¨¡å‹æ¨ç†éœ€è¦æ—¶é—´ï¼Œå¼‚æ­¥å¤„ç†é¿å…é˜»å¡</li>
<li>è‡ªåŠ¨æ–‡æ¡£è®©å‰ç«¯å¼€å‘è€…å¿«é€Ÿå¯¹æ¥</li>
<li>æ”¯æŒè§†é¢‘æµå®æ—¶æ£€æµ‹ï¼ˆWebSocketï¼‰</li>
<li>é«˜å¹¶å‘å¤„ç†å¤šä¸ªæ£€æµ‹è¯·æ±‚</li>
</ul>
<hr/>
<h3 data-id="heading-21"><strong>ğŸ’¡å®æˆ˜å»ºè®®</strong></h3>
<h4 data-id="heading-22"><strong>å­¦ä¹ è·¯å¾„</strong></h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[å­¦ä¹ FastAPIåŸºç¡€] --&gt; B[æŒæ¡PydanticéªŒè¯]
    B --&gt; C[ç†è§£å¼‚æ­¥ç¼–ç¨‹]
    C --&gt; D[é›†æˆæ•°æ®åº“]
    D --&gt; E[éƒ¨ç½²YOLOæ¨¡å‹]
    E --&gt; F[æ„å»ºå®Œæ•´é¡¹ç›®]
    
    style A fill:#4dabf7
    style C fill:#ffd93d
    style E fill:#ff6b6b
</code></pre>
<h4 data-id="heading-23"><strong>ç¬¬ä¸€ä¸ªFastAPIé¡¹ç›®</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># main.py</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI(title=<span class="hljs-string">"æˆ‘çš„ç¬¬ä¸€ä¸ªFastAPIé¡¹ç›®"</span>)

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"Hello FastAPI!"</span>}

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items/{item_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, q: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"item_id"</span>: item_id, <span class="hljs-string">"q"</span>: q}
</code></pre>
<p><strong>è¿è¡Œé¡¹ç›®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…FastAPIå’ŒUvicorn</span>
pip install fastapi uvicorn

<span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span>
uvicorn main:app --reload

<span class="hljs-comment"># è®¿é—®æ–‡æ¡£ï¼šhttp://localhost:8000/docs</span>
</code></pre>
<hr/>
<h3 data-id="heading-24"><strong>ğŸ¯ æœ¬ç« æ€»ç»“</strong></h3>













































<table><thead><tr><th>ç»´åº¦</th><th>Flask</th><th>FastAPI</th></tr></thead><tbody><tr><td><strong>æ€§èƒ½</strong></td><td>â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>å¼€å‘æ•ˆç‡</strong></td><td>â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>ç±»å‹å®‰å…¨</strong></td><td>â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>è‡ªåŠ¨æ–‡æ¡£</strong></td><td>â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>å¼‚æ­¥æ”¯æŒ</strong></td><td>â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>â­â­â­â­</td><td>â­â­â­â­</td></tr><tr><td><strong>ç”Ÿæ€æˆç†Ÿåº¦</strong></td><td>â­â­â­â­â­</td><td>â­â­â­â­</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒç»“è®º</strong>ï¼š</p>
<blockquote>
<p>FastAPIæ˜¯ç°ä»£Python Webå¼€å‘çš„æœ€ä½³é€‰æ‹©ï¼Œç‰¹åˆ«é€‚åˆAPIæœåŠ¡ã€é«˜å¹¶å‘åœºæ™¯å’ŒAIæ¨¡å‹éƒ¨ç½²ã€‚å®ƒç”¨æ›´å°‘çš„ä»£ç ï¼Œå®ç°æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-25">** ä¸‹ä¸€ç« é¢„å‘Š**</h3>
<p>åœ¨ç¬¬å…­ç« ä¸­ï¼Œæˆ‘ä»¬å°†ï¼š</p>
<ul>
<li>ä½¿ç”¨FastAPIæ­å»ºç¬¬ä¸€ä¸ªWebæœåŠ¡</li>
<li>é›†æˆUltralytics YOLOæ¨¡å‹</li>
<li>å®ç°å›¾ç‰‡ä¸Šä¼ å’Œå®æ—¶ç›®æ ‡æ£€æµ‹</li>
<li>æ„å»ºä¸€ä¸ªå®Œæ•´çš„AIæ£€æµ‹API</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIæ¦‚å¿µæ‰«ç›²ï¼šLoRAå¾®è°ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585463195201962034</link>    <guid>https://juejin.cn/post/7585463195201962034</guid>    <pubDate>2025-12-20T14:05:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463195201962034" data-draft-id="7585686247285211187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIæ¦‚å¿µæ‰«ç›²ï¼šLoRAå¾®è°ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-20T14:05:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæ³ŠAI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIæ¦‚å¿µæ‰«ç›²ï¼šLoRAå¾®è°ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæ³ŠAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T14:05:17.000Z" title="Sat Dec 20 2025 14:05:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>LoRA(Low-Rank Adaptation)æ˜¯ä¸€ç§ç”¨äºå¾®è°ƒå¤§å‹è¯­è¨€æ¨¡å‹(LLM)çš„é«˜æ•ˆæ–¹æ³•ï¼Œèƒ½å¤Ÿåœ¨ä¸å¤§å¹…å¢åŠ è®¡ç®—èµ„æºçš„æƒ…å†µä¸‹ï¼Œè®©æ¨¡å‹å¿«é€Ÿé€‚åº”æ–°ä»»åŠ¡æˆ–æ–°é¢†åŸŸã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51c4da85ec324fbcbbca748dfb4ed30e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844317&amp;x-signature=poOcH1riiDt6MBN5ltewyT48%2FJo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>1.èƒŒæ™¯: ä¸ºä»€ä¹ˆéœ€è¦ LoRA?</strong></p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹(æ¯”å¦‚ GPT-3ã€LLaMA)å°±åƒä¸€è¾†è¶…çº§è·‘è½¦ï¼Œé‡Œé¢æœ‰å‡ åäº¿ç”šè‡³ä¸Šåƒäº¿ä¸ªé›¶ä»¶(å‚æ•°)ã€‚</p>
<p>è¿™äº›æ¨¡å‹åœ¨é€šç”¨ä»»åŠ¡ä¸Šå¾ˆå¼ºï¼Œä½†å¦‚æœä½ æƒ³è®©å®ƒä¸“é—¨å¤„ç†æŸä¸ªæ–°ä»»åŠ¡(æ¯”å¦‚åŒ»ç–—é—®ç­”ã€é‡‘èåˆ†æ)ï¼Œä¼ ç»Ÿæ–¹æ³•æ˜¯æŠŠæ•´ä¸ªå‹çš„å‚æ•°é‡æ–°è°ƒæ•´ä¸€éã€‚</p>
<p>è¿™å°±åƒä¸ºäº†è®©è·‘è½¦è·‘å¾—æ›´å¿«ï¼ŒæŠŠå‘åŠ¨æœºã€è½®èƒã€åº•ç›˜å…¨æ‹†äº†é‡è£…ä¸€éï¼Œè´¹æ—¶è´¹åŠ›è¿˜è´¹é’±ã€‚</p>
<p>ä½†ç°å®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€æ²¡æœ‰é‚£ä¹ˆå¤šèµ„æº--è®­ç»ƒä¸€ä¸ªå¤§æ¨¡å‹éœ€è¦è¶…çº§è®¡ç®—æœºå’Œæµ·é‡æ—¶é—´ã€‚</p>
<p>äºæ˜¯ï¼ŒLORA å‡ºç°äº†ã€‚å®ƒçš„æ ¸å¿ƒæ€è·¯æ˜¯: ä¸ç”¨åŠ¨æ•´ä¸ªæ¨¡å‹ï¼Œåªè°ƒæ•´ä¸€å°éƒ¨åˆ†å‚æ•°ï¼Œå°±èƒ½è®©æ¨¡å‹é€‚åº”æ–°ä»»åŠ¡ã€‚</p>
<p>è¿™å°±åƒåœ¨è·‘è½¦ä¸ŠåŠ ä¸ªå°æ¶¡è½®å¢å‹å™¨ï¼Œæ—¢çœé’±åˆçœåŠ›ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨æ™ºæ³ŠAIã€‚</strong></a></p>
<p><strong>2.LoRA çš„åŸç†: ä½ç§©é€‚é…æ˜¯ä»€ä¹ˆ?</strong></p>
<p>ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯â€œä½ç§©é€‚é…â€ã€‚è¿™ä¸ªåLORA çš„å…¨ç§°æ˜¯ Low-Rank Adaptation,å­—å¬èµ·æ¥æœ‰ç‚¹å­¦æœ¯ï¼Œä½†å…¶å®åŸç†å¾ˆç®€å•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/656443e03f4d4622858a9edc27be0c14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844317&amp;x-signature=Vf8M4WilOvs68f%2B03pEGB2dvxrw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æ¨¡å‹çš„å‚æ•°æ˜¯å¤§çŸ©é˜µ</strong></p>
<p>å¤§å‹è¯­è¨€æ¨¡å‹çš„å‚æ•°å¾ˆå¤šæ˜¯ä»¥çŸ©é˜µå½¢å¼å­˜åœ¨çš„ï¼Œæ¯”å¦‚è‡ªæ³¨æ„åŠ›å±‚é‡Œçš„æƒé‡çŸ©é˜µã€‚è¿™äº›çŸ©é˜µå¾ˆå¤§ï¼ŒåŒ…å«äº†æ¨¡å‹çš„æ ¸å¿ƒçŸ¥è¯†ã€‚</p>
<p><strong>ä½ç§©åˆ†è§£: ç²¾ç®€æ›´æ–°</strong></p>
<p>LORA çš„èªæ˜ä¹‹å¤„åœ¨äºï¼Œå®ƒè®¤ä¸ºä½ ä¸éœ€è¦æ›´æ–°æ•´ä¸ªå¤§çŸ©é˜µï¼Œè€Œæ˜¯å¯ä»¥ç”¨ä¸€ä¸ªâ€œç²¾ç®€ç‰ˆâ€œæ¥ä»£æ›¿ã€‚è¿™ä¸ªç²¾ç®€ç‰ˆå«â€œä½ç§©çŸ©é˜µâ€ï¼Œå®ƒæ•æ‰äº†å¤§çŸ©é˜µé‡Œæœ€æ ¸å¿ƒçš„å˜åŒ–ä¿¡æ¯ï¼Œä½†å‚æ•°é‡å°å¾—å¤šã€‚</p>
<p>å…·ä½“æ“ä½œæ˜¯è¿™æ ·çš„:</p>
<p>åœ¨åŸå§‹çš„æƒé‡çŸ©é˜µ(è®°ä¸º(W))æ—è¾¹ï¼ŒåŠ ä¸¤ä¸ªå°çŸ©é˜µ(A)å’Œ(B); (A)å’Œ(B)çš„â€œç§©â€(rank)å¾ˆä½(æ¯”å¦‚8æˆ–16)ï¼Œå‚æ•°é‡è¿œå°äº(W); å¾®è°ƒæ—¶ï¼ŒåŸå§‹çŸ©é˜µ(W)ä¸åŠ¨ï¼Œåªæ›´æ–°(A)å’Œ(B)ã€‚</p>
<p>æœ€åï¼Œæ¨¡å‹çš„è¾“å‡ºå˜æˆ w+AxBï¼Œè¿™é‡Œçš„ AxBå°±åƒä¸€ä¸ªå°åŠ©æ‰‹ï¼Œå¸®åŸå§‹æ¨¡å‹é€‚åº”æ–°ä»»åŠ¡ã€‚</p>
<p><strong>é€šä¿—æ¯”å–»</strong></p>
<p>æƒ³è±¡ä½ æœ‰ä¸ªå¤§å…¬å¸(åŸå§‹æ¨¡å‹)ï¼Œè¦æ¥æ‰‹ä¸€ä¸ªæ–°ä¸šåŠ¡ã€‚ä¼ ç»Ÿæ–¹æ³•æ˜¯æŠŠæ‰€æœ‰éƒ¨é—¨éƒ½æ”¹ç»„ï¼Œå¤ªéº»çƒ¦ã€‚</p>
<p>LORAåˆ™æ˜¯æ´¾ä¸€ä¸ªå°å›¢é˜Ÿ((A)å’Œ(B))ï¼Œä¸“é—¨è´Ÿè´£æ–°ä¸šåŠ¡ï¼Œæ—¢é«˜æ•ˆåˆä¸å½±å“å…¬å¸æ ¸å¿ƒè¿ä½œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ae1e471ff73457e934f270f6065129c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844317&amp;x-signature=Zk8ei4w9KS8jpvO0JgPuxmD8ewA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>3.LoRA çš„ä¼˜åŠ¿: ä¸ºä»€ä¹ˆè¿™ä¹ˆå—æ¬¢è¿?</strong></p>
<p>LoRA èƒ½ç«èµ·æ¥ï¼Œæ˜¯å› ä¸ºå®ƒæœ‰å‡ ä¸ªç‰¹åˆ«ç‰›çš„ä¼˜åŠ¿</p>
<p>å‚æ•°è¶…å°‘: ä¼ ç»Ÿå¾®è°ƒè¦æ›´æ–°å…¨éƒ¨å‚æ•°(æ¯”å¦‚å‡ åäº¿ä¸ª)LORA åªæ›´æ–°ä¸€å°éƒ¨åˆ†(é€šå¸¸æ˜¯åŸå§‹æ¨¡å‹çš„ 0.01%åˆ°1%)å­˜å‚¨å’Œè®¡ç®—æˆæœ¬å¤§å¹…é™ä½ã€‚</p>
<p>è®­ç»ƒè¶…å¿«: å‚æ•°å°‘ï¼Œè®­ç»ƒè‡ªç„¶å¿«ï¼Œæ™®é€š GPUå°±èƒ½è·‘ï¼Œä¸ç”¨è¶…ç®—ã€‚</p>
<p>éƒ¨ç½²è¶…æ–¹ä¾¿: LoRA æ¨¡å—åƒâ€œæ’ä»¶â€œä¸€æ ·ï¼Œå¯ä»¥éšæ—¶æ’æ‹”ã€‚æ¯”å¦‚ä¸€ä¸ªåŸºç¡€æ¨¡å‹ï¼Œå¯ä»¥åŠ è½½ä¸åŒçš„ LoRA æ¨¡å—æ¥å¤„ç†ä¸åŒä»»åŠ¡ã€‚</p>
<p>æ•ˆæœè¿˜ä¸é”™: è™½ç„¶å‚æ•°å°‘ï¼Œä½†åœ¨å¾ˆå¤šä»»åŠ¡ä¸Šï¼ŒLORAçš„è¡¨ç°å’Œå…¨å‚æ•°å¾®è°ƒå·®ä¸å¤šï¼Œç”šè‡³æ›´å¥½ã€‚</p>
<p><strong>é€šä¿—æ¯”å–»</strong></p>
<p>LORA å°±åƒç»™æ‰‹æœºè£…ä¸ªå°åº”ç”¨ã€‚ä¸ç”¨æ¢æ–°æ‰‹æœºï¼Œåªéœ€ä¸‹è½½ä¸ªæ’ä»¶ï¼Œå°±èƒ½è®©æ‰‹æœºå¤šä¼šå‡ æ‹›ï¼Œæ—¢çœé’±åˆæ–¹ä¾¿ã€‚</p>
<p><strong>4. LoRA çš„åº”ç”¨åœºæ™¯: èƒ½å¹²å•¥?</strong></p>
<p>LoRA åœ¨å®é™…ä¸­ç”¨é€”å¾ˆå¹¿ï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†(NLP)é¢†åŸŸã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…¸å‹åœºæ™¯:</p>
<p>é¢†åŸŸé€‚é…:è®©é€šç”¨æ¨¡å‹å˜æˆâ€œä¸“å®¶â€ã€‚æ¯”å¦‚æ‹¿åŒ»ç–—æ•°æ®å¾®è°ƒä¸€ä¸ª LoRA æ¨¡å—ï¼Œæ¨¡å‹å°±èƒ½å›ç­”åŒ»å­¦é—®é¢˜ã€‚</p>
<p>å¤šä»»åŠ¡å­¦ä¹ :ä¸€ä¸ªåŸºç¡€æ¨¡å‹ï¼Œé€šè¿‡ä¸åŒ LoRA æ¨¡å—å¤„ç†ä¸åŒä»»åŠ¡ï¼Œæ¯”å¦‚ç¿»è¯‘ã€å¯¹è¯ã€æ–‡æœ¬ç”Ÿæˆã€‚</p>
<p>ä¸ªæ€§åŒ–å®šåˆ¶:ä¸ºç‰¹å®šç”¨æˆ·æˆ–åœºæ™¯å®šåˆ¶æ¨¡å‹ï¼Œæ¯”å¦‚è®©èŠå¤©æœºå™¨äººæ¨¡ä»¿ä½ çš„è¯­è¨€é£æ ¼ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbcaed83281249d3813cc03f842536b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844317&amp;x-signature=77osFiTC1IElKvqlgBjZL1t7Yh0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>å®é™…ä¾‹å­</strong></p>
<p>å‡è®¾ä½ æœ‰ä¸ªé€šç”¨èŠå¤©æœºå™¨äººï¼Œæƒ³è®©å®ƒåœ¨é‡‘èé¢†åŸŸè¡¨ç°æ›´å¥½ã€‚ä¼ ç»Ÿæ–¹æ³•æ˜¯ç”¨é‡‘èæ•°æ®é‡è®­æ•´ä¸ªæ¨¡å‹ï¼Œè´¹æ—¶è´¹åŠ›ã€‚</p>
<p>LORA åˆ™æ˜¯è®­ç»ƒä¸€ä¸ªé‡‘èé¢†åŸŸçš„ LoRA æ¨¡å—ï¼Œæ’åˆ°åŸå§‹æ¨¡å‹ä¸Šï¼Œæœºå™¨äººç«‹é©¬å˜æˆâ€œé‡‘èä¸“å®¶â€ã€‚</p>
<p><strong>5.LoRA çš„å·¥ä½œæµç¨‹: æ€ä¹ˆç”¨?</strong></p>
<p>LoRA çš„ä½¿ç”¨è¿‡ç¨‹å¾ˆç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹</p>
<p>1.é€‰ä¸ªåŸºç¡€æ¨¡å‹: æ¯”å¦‚ä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„å¤§æ¨¡å‹(LLaMAã€GPTç­‰)</p>
<p>2.åŠ  LoRA æ¨¡å—: åœ¨æ¨¡å‹çš„æŸäº›å±‚(æ¯”å¦‚è‡ªæ³¨æ„åŠ›å±‚)æ—è¾¹åŠ ä¸¤ä¸ªå°çŸ©é˜µ(A)å’Œ(B)ã€‚</p>
<p>å†»ç»“åŸå§‹å‚æ•°: è®­ç»ƒæ—¶ï¼ŒåŸå§‹æ¨¡å‹çš„å‚æ•°ä¸åŠ¨ï¼Œåªæ›´æ–°(A)å’Œ(B)ã€‚</p>
<p>å¾®è°ƒ: ç”¨æ–°ä»»åŠ¡çš„æ•°æ®è®­ç»ƒ(A)å’Œ(B)ï¼Œè®©å®ƒä»¬å­¦ä¼šA.æ–°æŠ€èƒ½ã€‚</p>
<p>æ¨ç†: ç”¨çš„æ—¶å€™ï¼ŒæŠŠ LoRA æ¨¡å—åŠ åˆ°åŸå§‹æ¨¡å‹ä¸Šï¼Œæ¨¡å‹å°±èƒ½å¹²æ–°æ´»äº†ã€‚</p>
<p><strong>é€šä¿—æ¯”å–»</strong></p>
<p>ä½ æœ‰ä¸ªæ™ºèƒ½éŸ³ç®±ï¼Œæƒ³è®©å®ƒä¼šè®²ç¬‘è¯ã€‚ä¸ç”¨æŠŠéŸ³ç®±æ‹†äº†é‡è£…ï¼Œåªéœ€ä¸‹è½½ä¸ªâ€œç¬‘è¯æ’ä»¶â€(LORA æ¨¡å—)ï¼Œæ’ä¸Šå°±èƒ½è®²ç¬‘è¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec0d84a409ff41248552b1ed4f4183f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844317&amp;x-signature=8MB5XxUXZYsLD1izuPg9%2FZv05Js%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>6.LoRA çš„æ•°å­¦ç»†èŠ‚: æƒ³æ·±å…¥äº†è§£?</strong></p>
<p>å¦‚æœä½ å¯¹æ•°å­¦æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ LoRA çš„ç®€å•åŸç†(ä¸æ„Ÿå…´è¶£å¯ä»¥è·³è¿‡)</p>
<p>åŸå§‹æƒé‡çŸ©é˜µ(W)æ˜¯dxdçš„ï¼Œå‚æ•°é‡æ˜¯ d^2(æ¯”å¦‚ï¼Œd=1000 å‚æ•°é‡å°±æ˜¯ 100 ä¸‡)ã€‚</p>
<p>LORAåŠ äº†Delta(w)=AxBï¼Œå…¶ä¸­(A)æ˜¯d x r(B)æ˜¯rxd,(r)å¾ˆå°(æ¯”å¦‚8)ã€‚å‚æ•°é‡å˜æˆ 2xdxr(æ¯”å¦‚)2x1000 x8=16000 ï¼Œè¿œå°äº d^2</p>
<p>ç®€å•è¯´ï¼ŒLoRA ç”¨å¾ˆå°‘çš„å‚æ•°(æ¯”å¦‚1.6ä¸‡ä¸ª)ä»£æ›¿äº†æ›´æ–°å…¨éƒ¨å‚æ•°(100 ä¸‡ä¸ª)ï¼Œä½†æ•ˆæœä¾ç„¶å¾ˆå¥½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71f936604d384417bbd7bedc1c648e36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844317&amp;x-signature=4dQUjGpQb88rj17gtFl%2BMrir2vw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>7.LoRA çš„å±€é™æ€§: æœ‰å•¥ä¸è¶³?</strong></p>
<p>LORA è™½ç„¶å¥½ç”¨ï¼Œä½†ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„:</p>
<p>æ•ˆæœæœ‰é™: æŸäº›å¤æ‚ä»»åŠ¡ä¸Šï¼ŒLORA å¯èƒ½ä¸å¦‚å…¨å‚æ•°å¾®è°ƒã€‚</p>
<p>è¶…å‚æ•°éº»çƒ¦: æ¯”å¦‚ç§©(r)çš„é€‰æ‹©ï¼Œå¤ªå°æ•ˆæœä¸å¥½ï¼Œå¤ªå¤§å‚æ•°åˆå¤šï¼Œéœ€è¦è¯•é”™ã€‚</p>
<p>ä½ç½®é€‰æ‹©: LORA åŠ åœ¨å“ªäº›å±‚æ•ˆæœæœ€å¥½ï¼Œé ç»éªŒæˆ–å®éªŒã€‚</p>
<p>ä¸ºäº†æ”¹è¿›è¿™äº›é—®é¢˜ï¼Œå‡ºç°äº† LORA+ã€DORA ç­‰å‡çº§ç‰ˆæ€§èƒ½æ›´å¼ºï¼Œé€‚åº”æ€§æ›´å¥½ã€‚</p>
<p><strong>8.æ€»ç»“: LORA åˆ°åº•æ˜¯å•¥?</strong></p>
<p>LoRA æ˜¯ä¸€ç§é«˜æ•ˆå¾®è°ƒå¤§å‹è¯­è¨€æ¨¡å‹çš„æ–¹æ³•ï¼Œé€šè¿‡åœ¨åŸå§‹æ¨¡å‹æ—è¾¹åŠ ä¸¤ä¸ªå°çŸ©é˜µ(ä½ç§©çŸ©é˜µ)ï¼Œè®©æ¨¡å‹å¿«é€Ÿé€‚åº”æ–°ä»»åŠ¡ã€‚</p>
<p>å®ƒçš„ä¼˜åŠ¿æ˜¯å‚æ•°å°‘ã€è®­ç»ƒå¿«ã€éƒ¨ç½²æ–¹ä¾¿ï¼Œç‰¹åˆ«é€‚åˆèµ„æºæœ‰é™æˆ–éœ€è¦å¿«é€Ÿé€‚åº”çš„åœºæ™¯ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒLoRA å°±åƒç»™æ¨¡å‹è£…äº†ä¸ªâ€œå¤–æŒ‚â€ï¼Œä¸ç”¨å¤§åŠ¨å¹²æˆˆï¼Œå°±èƒ½è®©æ¨¡å‹å­¦ä¼šæ–°æŠ€èƒ½ã€‚</p>
<p><strong>é€šä¿—æ€»ç»“</strong></p>
<p>LORA æ˜¯æ¨¡å‹çš„â€œæ¶¡è½®å¢å‹å™¨â€ï¼Œå°æŠ•å…¥å¤§å›æŠ¥ï¼Œè®©å¾®è°ƒå˜å¾—åƒè£…æ’ä»¶ä¸€æ ·ç®€å•ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨æ™ºæ³ŠAIã€‚</strong></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç°åœ¨è¿˜æœ‰Javaé¢è¯•è€…ä¸ä¼šå¼€å‘Starterç»„ä»¶]]></title>    <link>https://juejin.cn/post/7585534343561396274</link>    <guid>https://juejin.cn/post/7585534343561396274</guid>    <pubDate>2025-12-20T14:21:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585534343561396274" data-draft-id="7585706951603175450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç°åœ¨è¿˜æœ‰Javaé¢è¯•è€…ä¸ä¼šå¼€å‘Starterç»„ä»¶"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-20T14:21:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çˆ±æµ·è´¼çš„æ— å¤„ä¸åœ¨"/> <meta itemprop="url" content="https://juejin.cn/user/2359988032644541"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç°åœ¨è¿˜æœ‰Javaé¢è¯•è€…ä¸ä¼šå¼€å‘Starterç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2359988032644541/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çˆ±æµ·è´¼çš„æ— å¤„ä¸åœ¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T14:21:46.000Z" title="Sat Dec 20 2025 14:21:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯è¯´æ˜ï¼šçœŸå®çš„é¢è¯•æ„Ÿå—</h2>
<p>æœ€è¿‘åœ¨å…¬å¸é¢è¯•äº†ä¸€æ‰¹ <strong>4â€“7 å¹´å¼€å‘ç»éªŒ</strong>çš„åç«¯å·¥ç¨‹å¸ˆï¼Œç®€å†æ•´ä½“å¹¶ä¸å·®ï¼Œåšè¿‡çš„é¡¹ç›®ä¹Ÿä¸å°‘ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜è®©æˆ‘å°è±¡éå¸¸æ·±åˆ»ï¼š</p>
<blockquote>
<p><strong>å‡ ä¹æ²¡æœ‰äººèƒ½æŠŠã€Œå¦‚ä½•å¼€å‘ä¸€ä¸ª Spring Boot Starterã€ä»¥åŠç›¸å…³åŸç†è¯´æ¸…æ¥šã€‚</strong></p>
</blockquote>
<p>è¿›ä¸€æ­¥äº¤æµåå‘ç°ï¼Œè¿™ç±»å€™é€‰äººæ™®éæœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼š<br/>
<strong>é•¿æœŸå¤„åœ¨å¤–åŒ…ç¯å¢ƒæˆ–ä¸šåŠ¡é«˜åº¦å›ºåŒ–çš„é¡¹ç›®ä¸­</strong>ï¼ŒæŠ€æœ¯ä½¿ç”¨åœç•™åœ¨â€œä¼šç”¨æ¡†æ¶â€ï¼Œä½†å¾ˆå°‘å»æ€è€ƒï¼š</p>
<ul>
<li>
<p>æ¡†æ¶èƒ½åŠ›æ˜¯å¦‚ä½•è¢«å°è£…å‡ºæ¥çš„</p>
</li>
<li>
<p>é€šç”¨æŠ€æœ¯èƒ½åŠ›å¦‚ä½•è¢«å¤ç”¨ã€æ ‡å‡†åŒ–</p>
</li>
<li>
<p>ä¸€ä¸ªç»„ä»¶æ˜¯å¦‚ä½•åšåˆ°â€œå³æ’å³ç”¨ã€ä¸ä¾µå…¥ä¸šåŠ¡â€çš„</p>
</li>
</ul>
<p>åœ¨é¢è¯•ä¸­ï¼Œè¿™ç›´æ¥ä½“ç°åœ¨ï¼š<br/>
<strong>å¯¹ Spring Boot Starter çš„ç†è§£æ¨¡ç³Šã€è¡¨è¾¾æ··ä¹±ã€ç¼ºä¹å·¥ç¨‹æŠ½è±¡æ„è¯†</strong>ï¼Œæœ€ç»ˆåªèƒ½ç»™å‡ºä¸é€šè¿‡çš„ç»“è®ºã€‚</p>
<p>å…¶å®ï¼Œ<strong>å¼€å‘ä¸€ä¸ª Spring Boot Starter æœ¬èº«å¹¶ä¸éš¾</strong>ã€‚<br/>
çœŸæ­£éš¾çš„ä¸æ˜¯ APIï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>ä½ æœ‰æ²¡æœ‰åœ¨æŠ€æœ¯é¢†åŸŸè¿›è¡ŒæŒç»­ã€ä¸»åŠ¨çš„å­¦ä¹ å’ŒæŠ½è±¡ã€‚</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bedfdcbc0094013a52562f03151ed91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rW36LS855qE5peg5aSE5LiN5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845306&amp;x-signature=FfBPUgluilk9Bl0SH%2F8DH%2B%2FgpVY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">äºŒã€å¼€å‘ Spring Boot Starter çš„æ ¸å¿ƒæ­¥éª¤</h2>
<p>æˆ‘è®¤ä¸º<strong>ä»»ä½•ä¸€ä¸ªåç«¯å·¥ç¨‹å¸ˆéƒ½åº”è¯¥èƒ½è¯´æ¸…æ¥šã€å¹¶ä¸”å®è·µè¿‡çš„</strong> Starter å¼€å‘æµç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6861139e51a404085ca0d39df3f9d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rW36LS855qE5peg5aSE5LiN5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845306&amp;x-signature=o7Q%2F1RSRjud3JGp77BU6XbM9nwE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šæ˜ç¡® Starter æä¾›çš„æŠ€æœ¯èƒ½åŠ›åŠå…¶è¾¹ç•Œ</h3>
<p>åœ¨å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œé¦–å…ˆè¦æƒ³æ¸…æ¥šä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li>
<p>Starter <strong>è§£å†³ä»€ä¹ˆæŠ€æœ¯é—®é¢˜</strong></p>
</li>
<li>
<p>Starter <strong>ä¸è§£å†³ä»€ä¹ˆé—®é¢˜</strong></p>
</li>
<li>
<p>Starter æ˜¯å¦åªæ˜¯æä¾› <strong>é»˜è®¤èƒ½åŠ›</strong>ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶èƒ½åŠ›</p>
</li>
</ul>
<h3 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šåˆ›å»º xxx-spring-boot-starter åŒ…</h3>
<p>Starter æœ¬èº«æ˜¯ä¸€ä¸ª<strong>å¯¹å¤–æš´éœ²çš„å…¥å£æ¨¡å—</strong>ï¼Œå®ƒçš„èŒè´£éå¸¸ç®€å•ï¼š</p>
<ul>
<li>
<p>ä½œä¸ºä¸šåŠ¡ç³»ç»Ÿçš„ä¾èµ–å…¥å£</p>
</li>
<li>
<p>èšåˆæ‰€éœ€çš„ä¾èµ–</p>
</li>
<li>
<p>ä¸æ‰¿è½½å…·ä½“å®ç°é€»è¾‘</p>
</li>
</ul>
<p>è¿™ä¸€å±‚å­˜åœ¨çš„æ„ä¹‰æ˜¯ï¼š<br/>
<strong>è®©ä½¿ç”¨æ–¹â€œåªå¼•ä¸€ä¸ªä¾èµ–â€å°±èƒ½è·å¾—èƒ½åŠ›</strong>ã€‚</p>
<h3 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º XxxxProperties ä¸ XxxxAutoConfiguration</h3>
<p>è¿™æ˜¯ Starter çš„æ ¸å¿ƒå®ç°éƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p><code>XxxxProperties</code>ï¼š</p>
<ul>
<li>
<p>ç”¨äºç»‘å®šå¤–éƒ¨é…ç½®</p>
</li>
<li>
<p>å®šä¹‰ç»Ÿä¸€çš„é…ç½®å‰ç¼€</p>
</li>
<li>
<p>æä¾›é»˜è®¤é…ç½®å€¼</p>
</li>
</ul>
</li>
<li>
<p><code>XxxxAutoConfiguration</code>ï¼š</p>
<ul>
<li>
<p>ä½œä¸ºè‡ªåŠ¨è£…é…å…¥å£</p>
</li>
<li>
<p>è´Ÿè´£åˆå§‹åŒ– Starter æä¾›çš„æŠ€æœ¯èƒ½åŠ›</p>
</li>
<li>
<p>å‘ Spring å®¹å™¨æ³¨å†Œé»˜è®¤ Bean</p>
</li>
</ul>
</li>
</ul>
<p>è¿™ä¸€å±‚çš„å…³é”®ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š<br/>
<strong>è®©æŠ€æœ¯èƒ½åŠ›åœ¨åˆé€‚çš„æ—¶æœºè¢«è‡ªåŠ¨æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚</strong></p>
<h3 data-id="heading-5">ç¬¬å››æ­¥ï¼šé€šè¿‡æ¡ä»¶æ§åˆ¶ Starter æ˜¯å¦ç”Ÿæ•ˆ</h3>
<p>ä¸€ä¸ªåˆæ ¼çš„ Starter <strong>ä¸€å®šä¸æ˜¯æ— æ¡ä»¶ç”Ÿæ•ˆçš„</strong>ã€‚</p>
<p>å¸¸è§çš„æ§åˆ¶æ–¹å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>æ˜¯å¦å¼€å¯ï¼š<code>enabled</code> æ€»å¼€å…³</p>
</li>
<li>
<p>æ˜¯å¦å­˜åœ¨æŸäº›ä¾èµ–</p>
</li>
<li>
<p>ç”¨æˆ·æ˜¯å¦å·²ç»å®šä¹‰äº†åŒç±» Bean</p>
</li>
<li>
<p>å½“å‰è¿è¡Œç¯å¢ƒæ˜¯å¦æ»¡è¶³è¦æ±‚</p>
</li>
</ul>
<p>æ ¸å¿ƒåŸåˆ™åªæœ‰ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>Starter æä¾›çš„æ˜¯â€œå…œåº•èƒ½åŠ›â€ï¼Œä¸æ˜¯â€œå¼ºåˆ¶æ¥ç®¡â€ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-6">ç¬¬äº”æ­¥ï¼šé€šè¿‡ spring.factories å£°æ˜è‡ªåŠ¨è£…é…ç±»</h3>
<p>è¦è®© Spring Boot åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­å‘ç°ä½ çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>
<p>åœ¨æŒ‡å®šä½ç½®å£°æ˜è‡ªåŠ¨é…ç½®å…¥å£</p>
</li>
<li>
<p>è®©å…¶å‚ä¸ Spring Boot çš„è‡ªåŠ¨è£…é…æµç¨‹</p>
</li>
</ul>
<p>è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯ï¼š<br/>
<strong>æŠŠä½ çš„ Starter æŒ‚è½½åˆ° Spring Boot çš„è‡ªåŠ¨é…ç½®ä½“ç³»ä¸­ã€‚</strong></p>
<h3 data-id="heading-7">ç¬¬å…­æ­¥ï¼šéªŒè¯ä¸‰ç§å…³é”®ä½¿ç”¨åœºæ™¯</h3>
<p>ä¸€ä¸ª Starter æ˜¯å¦åˆæ ¼ï¼Œè‡³å°‘è¦éªŒè¯ä¸‰ç§åœºæ™¯ï¼š</p>
<ol>
<li>
<p><strong>å®Œå…¨ä¸å†™ä»»ä½•é…ç½®</strong>ï¼Œåº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸å¯åŠ¨</p>
</li>
<li>
<p><strong>ç”¨æˆ·è‡ªå®šä¹‰ Bean</strong>ï¼Œæ˜¯å¦ä¼˜å…ˆç”Ÿæ•ˆ</p>
</li>
<li>
<p><strong>å…³é—­ enabled å¼€å…³</strong>ï¼ŒStarter æ˜¯å¦å½»åº•å¤±æ•ˆ</p>
</li>
</ol>
<h2 data-id="heading-8">ä¸‰ã€é¢è¯•ä¸­æˆ‘é‡ç‚¹å…³æ³¨çš„å‡ ä¸ªé—®é¢˜</h2>
<p>åœ¨é¢è¯•ä¸­ï¼Œæˆ‘é€šå¸¸ä¼šå›´ç»• Starter è¿½é—®ä¸‹é¢è¿™äº›é—®é¢˜ï¼Œç”¨æ¥åˆ¤æ–­å€™é€‰äººæ˜¯å¦çœŸæ­£ç†è§£è¿‡ã€‚</p>
<ul>
<li>
<p><strong>Starter å’Œæ™®é€š jar çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
</li>
<li>
<p><strong>Spring Boot æ˜¯å¦‚ä½•å‘ç°å¹¶åŠ è½½ Starter çš„ï¼Ÿ</strong></p>
</li>
<li>
<p><strong>å¦‚æœç”¨æˆ·è‡ªå·±å®šä¹‰äº†ç›¸åŒç±»ä¼¼çš„ Beanï¼Œä½ çš„ Starter å¦‚ä½•å¤„ç†ï¼Ÿ</strong></p>
</li>
<li>
<p><strong>Starter ä¸ºä»€ä¹ˆä¸€å®šè¦æœ‰ enabled å¼€å…³ï¼Ÿ</strong></p>
</li>
<li>
<p><strong>å¦‚ä½•é¿å… Starter å¯¹ä¸šåŠ¡äº§ç”Ÿä¾µå…¥ï¼Ÿ</strong></p>
</li>
<li>
<p><strong>ä½ åœ¨å†™ Starter æ—¶é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>
</li>
<li>
<p><strong>Starter ç»„ä»¶ä¸­çš„ <code>spring.factories</code> æ˜¯å¦æœ‰å¿…è¦å­˜åœ¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
</li>
</ul>
<p>è¿™äº›é—®é¢˜çš„ç›®çš„å¹¶ä¸æ˜¯åˆéš¾äººï¼Œè€Œæ˜¯åˆ¤æ–­ï¼š</p>
<blockquote>
<p>ä½ æ˜¯â€œç”¨è¿‡ Starterâ€ï¼Œè¿˜æ˜¯â€œè®¾è®¡è¿‡ Starterâ€ã€‚</p>
</blockquote>
<h2 data-id="heading-9">å››ã€æŠ€æœ¯èƒ½åŠ›æ¥è‡ªæŒç»­å­¦ä¹ ä¸æ‹†è§£ä¼˜ç§€é¡¹ç›®</h2>
<p>æŠ€æœ¯èƒ½åŠ›å¹¶ä¸æ˜¯åªé é¡¹ç›®å †å‡ºæ¥çš„ã€‚<br/>
<strong>é•¿æœŸåœ¨å›ºå®šæ¨¡å¼çš„é¡¹ç›®é‡Œï¼Œå¾ˆå®¹æ˜“å½¢æˆæŠ€æœ¯æƒ°æ€§ã€‚</strong></p>
<p>å¦‚æœæƒ³çœŸæ­£ç†è§£ Starterã€è‡ªåŠ¨è£…é…ã€ç»„ä»¶åŒ–è®¾è®¡ï¼Œ<strong>æœ€æœ‰æ•ˆçš„æ–¹å¼å°±æ˜¯çœ‹æˆç†Ÿé¡¹ç›®çš„å®ç°</strong>ã€‚</p>
<p>æ¯”å¦‚è¿™ä¸ªéå¸¸å€¼å¾—å­¦ä¹ çš„é¡¹ç›®ï¼š</p>
<blockquote>
<p><strong>admin4j-framework</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fadmin4j%2Fadmin4j-framework" target="_blank" title="https://github.com/admin4j/admin4j-framework" ref="nofollow noopener noreferrer">github.com/admin4j/admâ€¦</a></p>
</blockquote>
<p>è¿™ä¸ªé¡¹ç›®æœ¬èº«å°±æ˜¯ä¸€ä¸ª <strong>Starter ç»„ä»¶é›†åˆ</strong>ï¼Œæ¶µç›–äº†ï¼š</p>
<ul>
<li>
<p>å®‰å…¨</p>
</li>
<li>
<p>æ—¥å¿—è¿½è¸ª</p>
</li>
<li>
<p>å¤šç§Ÿæˆ·</p>
</li>
<li>
<p>æ•°æ®è„±æ•</p>
</li>
<li>
<p>ä¸­é—´ä»¶é›†æˆ</p>
</li>
</ul>
<p>éå¸¸é€‚åˆç”¨æ¥å­¦ä¹ ï¼š</p>
<ul>
<li>
<p>Starter çš„æ¨¡å—æ‹†åˆ†æ–¹å¼</p>
</li>
<li>
<p>è‡ªåŠ¨é…ç½®çš„è®¾è®¡æ€è·¯</p>
</li>
<li>
<p>æ¡ä»¶åŒ–ç”Ÿæ•ˆä¸è¾¹ç•Œæ§åˆ¶</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d519b2016044647afbfe302ca70a2f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rW36LS855qE5peg5aSE5LiN5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845306&amp;x-signature=LmyW6wzTjJTAQk3GprY8eDpVltY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">äº”ã€ç»“è¯­</h2>
<p>Spring Boot Starter ä¸æ˜¯ä¸€ä¸ªâ€œé«˜éš¾åº¦æŠ€æœ¯ç‚¹â€ï¼Œ<br/>
ä½†å®ƒæ˜¯ä¸€ä¸ª<strong>éå¸¸å¥½çš„å·¥ç¨‹èƒ½åŠ›åˆ†æ°´å²­</strong>ã€‚</p>
<blockquote>
<p><strong>æ˜¯å¦æ„¿æ„æŠŠâ€œç”¨çš„æŠ€æœ¯â€ï¼Œå˜æˆâ€œå¯å¤ç”¨çš„èƒ½åŠ›â€ï¼Œ<br/>
å¾€å¾€å†³å®šäº†ä¸€ä¸ªå·¥ç¨‹å¸ˆèƒ½èµ°å¤šè¿œã€‚</strong></p>
</blockquote>
<p>å¦‚æœä½ è®°ä½ä¸Šé¢è¿™ 6 æ­¥ï¼Œå¹¶ä¸”è‡ªå·±å®Œæ•´åŠ¨æ‰‹å®ç°è¿‡ä¸€æ¬¡ï¼Œ<br/>
æ— è®ºæ˜¯é¢è¯•ï¼Œè¿˜æ˜¯æ—¥å¸¸æ¶æ„è®¾è®¡ï¼Œéƒ½ä¼šæ˜æ˜¾ä¸ä¸€æ ·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI å¤§å‚çš„â€œæŠ¤åŸæ²³â€ï¼Œä¹Ÿä¼šæˆä¸ºå®ƒä»¬çš„æŸç¼š]]></title>    <link>https://juejin.cn/post/7585485074038145030</link>    <guid>https://juejin.cn/post/7585485074038145030</guid>    <pubDate>2025-12-20T14:46:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038145030" data-draft-id="7585474459776958500" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI å¤§å‚çš„â€œæŠ¤åŸæ²³â€ï¼Œä¹Ÿä¼šæˆä¸ºå®ƒä»¬çš„æŸç¼š"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,åˆ›ä¸š"/> <meta itemprop="datePublished" content="2025-12-20T14:46:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å“¥æ•°æ™ºè°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI å¤§å‚çš„â€œæŠ¤åŸæ²³â€ï¼Œä¹Ÿä¼šæˆä¸ºå®ƒä»¬çš„æŸç¼š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å“¥æ•°æ™ºè°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T14:46:36.000Z" title="Sat Dec 20 2025 14:46:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ï¼Œæˆ‘çš„ä¸€ä¸ªæ ¹æ·±è’‚å›ºçš„è®¤çŸ¥è¢«è½»è½»æ’¬åŠ¨äº†ä¸€ä¸‹ã€‚</p>
<p>é•¿ä¹…ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´ç¬ƒä¿¡ä¸€ä¸ªâ€œå¸¸è¯†â€ï¼š<strong>ä¸€æ—¦å¤§å‚ä¸‹åœºåš AIï¼Œåˆ›ä¸šå›¢é˜ŸåŸºæœ¬å°±å‡‰äº†</strong>ã€‚</p>
<p>ç†ç”±å¾ˆæœ´ç´ â€”â€”å¤§å‚æœ‰é’±ã€æœ‰äººã€æœ‰æ•°æ®ã€æœ‰ç®—åŠ›ï¼Œè¿˜æœ‰ç°æˆçš„ç”¨æˆ·å’Œç”Ÿæ€ã€‚å®ƒä»¬åªè¦çœ‹ä¸­æŸä¸ªæ–¹å‘ï¼Œè°ƒé›†èµ„æºä¸€å‹ï¼Œåˆ›ä¸šå…¬å¸é‚£ç‚¹å¾®å¼±çš„ç«è‹—ï¼Œä¸æ˜¯è¢«æ‰‘ç­ï¼Œå°±æ˜¯è¢«æ”¶ç¼–ã€‚</p>
<p>è¿™ç§â€œå¤§å‚ç¢¾å‹è®ºâ€åœ¨å¾ˆå¤šé¢†åŸŸéƒ½æˆç«‹ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæˆ‘ç”šè‡³æŠŠå®ƒå½“æˆäº†é»˜è®¤é€»è¾‘ã€‚</p>
<p>ä½†å‰å‡ å¤©çœ‹åˆ°ä¸€ä¸ªè§‚ç‚¹ï¼Œè®©æˆ‘æ„£äº†ä¸€ä¸‹ï¼š</p>
<p>â€œ<strong>å¤§å‚æœ‰è‡ªæœ‰æ¨¡å‹çš„ä¼˜åŠ¿ï¼Œä½†ä¹Ÿè¢«è‡ªå·±çš„æ¨¡å‹â€˜ç»‘æ¶â€™äº†ã€‚</strong>â€</p>
<p>è¿™å¥è¯ä¹å¬ç®€å•ï¼Œç»†æƒ³å´å¾ˆæœ‰åš¼å¤´ã€‚</p>
<p>æ¯”å¦‚ <code>OpenAI</code>ï¼Œå“ªæ€•å®ƒç§ä¸‹æ‰¿è®¤ <code>Claude</code> åœ¨æŸäº›ä»»åŠ¡ä¸Šæ›´ç¨³ã€æ¨ç†æ›´æ¸…æ™°ã€å¹»è§‰æ›´å°‘ï¼Œå®ƒä¹Ÿä¸å¯èƒ½åœ¨è‡ªå®¶äº§å“é‡Œè°ƒç”¨ <code>Anthropic</code> çš„ <code>API</code>ã€‚</p>
<p>ä¸æ˜¯æŠ€æœ¯ä¸è¡Œï¼Œè€Œæ˜¯èº«ä»½ä¸å…è®¸ã€‚</p>
<p>å®ƒçš„æ•´ä¸ªå“ç‰Œã€å™äº‹ã€ä¼°å€¼ï¼Œéƒ½å»ºç«‹åœ¨â€œæˆ‘ä»¬æ‹¥æœ‰ä¸–ç•Œæœ€å¥½çš„æ¨¡å‹â€è¿™ä¸ªå‰æä¸Šã€‚ä¸€æ—¦å®ƒå¼€å§‹ç”¨åˆ«äººçš„æ¨¡å‹ï¼Œç­‰äºåŠ¨æ‘‡äº†è‡ªå·±çš„æ ¹åŸºã€‚</p>
<p>è€Œåˆ›ä¸šå›¢é˜Ÿæ°æ°ç›¸å â€”â€” å®ƒä»¬æ²¡æœ‰â€œå¿…é¡»ç”¨è‡ªå·±æ¨¡å‹â€çš„åŒ…è¢±ã€‚è°å®¶æ¨¡å‹æ•ˆæœå¥½ã€æˆæœ¬ä½ã€å“åº”å¿«ï¼Œå°±ç”¨è°çš„ã€‚ä»Šå¤©ç”¨ GPTï¼Œæ˜å¤©åˆ‡ Claudeï¼Œåå¤©è¯•è¯• DeepSeekã€‚</p>
<p>ç”šè‡³ï¼Œéƒ½å¯ä»¥åœ¨ä¸€ä¸ªä¸šåŠ¡æµç¨‹çš„<strong>ä¸åŒé˜¶æ®µè°ƒç”¨ä¸åŒçš„æ¨¡å‹</strong>ï¼Œè¾¾åˆ°å„å®¶äº§å“<strong>ä¼˜åŠ¿çš„å……åˆ†åˆ©ç”¨</strong>ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå¤§å‚è¦è¯æ˜â€œæˆ‘çš„å¼•æ“å¤©ä¸‹ç¬¬ä¸€â€ï¼Œè€Œåˆ›ä¸šå›¢é˜Ÿåªéœ€å›ç­”â€œè¿™è¾†è½¦èƒ½ä¸èƒ½æŠŠä½ å®‰å…¨å¿«é€Ÿåœ°é€åˆ°ç›®çš„åœ°â€ã€‚</p>
<p>åŸæ¥ä¸æ˜¯èµ›é“è¢«å°æ­»ï¼Œè€Œæ˜¯æˆ‘çœ‹çª„äº†ã€‚</p>
<p>å¤§å‚å¿™ç€é€ è‡ªå·±çš„èˆªæ¯ï¼Œè€Œæˆ‘ä»¬å¯ä»¥è‡ªç”±æ‹¼è£…å¼•æ“ã€èˆ¹ä½“å’Œå¯¼èˆªç³»ç»Ÿâ€”â€”ç”¨æœ€å¥½çš„é›¶ä»¶ï¼Œé€ ä¸€è‰˜çœŸæ­£æœåŠ¡ç”¨æˆ·çš„å¿«è‰‡ã€‚</p>
<p>ä¹Ÿè®¸ï¼Œæˆ‘ä»¬è¿˜èƒ½æ›´å¿«åˆ°å¯¹å²¸å‘¢~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Hooks æ·±åº¦ç†è§£ï¼šuseState / useEffect å¦‚ä½•ç®¡ç†å‰¯ä½œç”¨ä¸å†…å­˜]]></title>    <link>https://juejin.cn/post/7585484081436033075</link>    <guid>https://juejin.cn/post/7585484081436033075</guid>    <pubDate>2025-12-20T13:32:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585484081436033075" data-draft-id="7585686247270006793" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Hooks æ·±åº¦ç†è§£ï¼šuseState / useEffect å¦‚ä½•ç®¡ç†å‰¯ä½œç”¨ä¸å†…å­˜"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-20T13:32:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½å…°åœ°ç©ºç“¶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Hooks æ·±åº¦ç†è§£ï¼šuseState / useEffect å¦‚ä½•ç®¡ç†å‰¯ä½œç”¨ä¸å†…å­˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½å…°åœ°ç©ºç“¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:32:06.000Z" title="Sat Dec 20 2025 13:32:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ¤¯ä½ ä»¥ä¸º React Hooks åªæ˜¯è¯­æ³•ç³–ï¼Ÿ</h2>
<h3 data-id="heading-1">ä¸â€”â€”å®ƒä»¬æ˜¯åœ¨å¸®ä½ å¯¹æŠ—ã€Œå‰¯ä½œç”¨ã€å’Œã€Œå†…å­˜æ³„æ¼ã€</h3>
<blockquote>
<p><strong>å¦‚æœä½ åªæŠŠ Hooks å½“æˆâ€œä¸ç”¨ class äº†â€ï¼Œ<br/>
é‚£ä½ å¯èƒ½åªç†è§£äº† React çš„ 10%ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-2">ğŸš€ ä¸€ã€ä¸€ä¸ªâ€œçœ‹èµ·æ¥æ¯«æ— é—®é¢˜â€çš„ç»„ä»¶</h3>
<p>æˆ‘ä»¬å…ˆä»ä¸€ä¸ªä½ æˆ‘éƒ½å†™è¿‡æ— æ•°æ¬¡çš„ç»„ä»¶å¼€å§‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">App</span>() {
  const <span class="hljs-selector-attr">[num, setNum]</span> = <span class="hljs-built_in">useState</span>(<span class="hljs-number">0</span>)

  return (
    &lt;div onClick={() =&gt; <span class="hljs-built_in">setNum</span>(num + <span class="hljs-number">1</span>)}&gt;
      {num}
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
  )
}
</code></pre>
<p>çœ‹èµ·æ¥éå¸¸å®Œç¾ï¼š</p>
<ul>
<li>âœ… æ²¡æœ‰ class</li>
<li>âœ… æ²¡æœ‰ this</li>
<li>âœ… å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°</li>
</ul>
<p>ä½†é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p><strong>React ä¸ºä»€ä¹ˆè¦å‘æ˜ Hooksï¼Ÿ</strong><br/>
<strong>useState / useEffect åˆ°åº•è§£å†³äº†ä»€ä¹ˆâ€œæœ¬è´¨é—®é¢˜â€ï¼Ÿ</strong></p>
</blockquote>
<p>ç­”æ¡ˆå…¶å®åªæœ‰ä¸€ä¸ªå…³é”®è¯ğŸ‘‡</p>
<hr/>
<h3 data-id="heading-3">ğŸ’£ äºŒã€React ä¸–ç•Œçš„ç»ˆææ•Œäººï¼šå‰¯ä½œç”¨ï¼ˆSide Effectï¼‰</h3>
<p>React èƒŒåæœ‰ä¸€ä¸ª<strong>å¾ˆå°‘è¢«æ˜è¯´ï¼Œä½†æå…¶é‡è¦çš„ä¿¡ä»°</strong>ï¼š</p>
<blockquote>
<p><strong>ç»„ä»¶ â‰ˆ çº¯å‡½æ•°</strong></p>
</blockquote>
<h4 data-id="heading-4">ğŸ§  ä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Ÿ</h4>
<ul>
<li>ç›¸åŒè¾“å…¥ â†’ æ°¸è¿œç›¸åŒè¾“å‡º</li>
<li>ä¸ä¾èµ–å¤–éƒ¨å˜é‡</li>
<li>ä¸äº§ç”Ÿé¢å¤–å½±å“ï¼ˆI/Oã€å®šæ—¶å™¨ã€è¯·æ±‚ï¼‰</li>
</ul>
<pre><code class="hljs language-css" lang="css">function add(<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>) {
  return <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>
}
</code></pre>
<p>è€Œç†æƒ³ä¸­çš„ React ç»„ä»¶æ˜¯ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">(props + <span class="hljs-keyword">state</span>) â†’ JSX
</code></pre>
<blockquote>
<p><strong>React å¸Œæœ›ä½ â€œåªè´Ÿè´£ç®— UIâ€ï¼Œ<br/>
è€Œä¸æ˜¯åœ¨æ¸²æŸ“æ—¶å¹²åˆ«çš„äº‹ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-5">âš ï¸ ä½†ç°å®æ˜¯ï¼šä½ å¿…é¡»å¹²â€œåäº‹â€</h3>
<p>çœŸå®ä¸šåŠ¡ä¸­ï¼Œä½ ä¸å¯é¿å…è¦åšè¿™äº›äº‹ï¼š</p>
<ul>
<li>ğŸŒ è¯·æ±‚æ¥å£</li>
<li>â±ï¸ è®¾ç½®å®šæ—¶å™¨</li>
<li>ğŸ§ äº‹ä»¶ç›‘å¬</li>
<li>ğŸ“¦ è®¢é˜… / å–æ¶ˆè®¢é˜…</li>
<li>ğŸ§± æ“ä½œ DOM</li>
</ul>
<p>è¿™äº›è¡Œä¸ºæœ‰ä¸€ä¸ªå…±åŒç‚¹ğŸ‘‡</p>
<blockquote>
<p>âŒ <strong>å®ƒä»¬éƒ½ä¸æ˜¯çº¯å‡½æ•°è¡Œä¸º</strong><br/>
âœ… <strong>å®ƒä»¬éƒ½æ˜¯å‰¯ä½œç”¨</strong></p>
</blockquote>
<p>å¦‚æœä½ ç›´æ¥æŠŠå‰¯ä½œç”¨å†™è¿›ç»„ä»¶å‡½æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>) <span class="hljs-comment">// âŒ</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> /&gt;</span></span>
}
</code></pre>
<p>ğŸ‘‰ æ¯ä¸€æ¬¡ render éƒ½è¯·æ±‚<br/>
ğŸ‘‰ çŠ¶æ€æ›´æ–° â†’ å† render â†’ å†è¯·æ±‚<br/>
ğŸ‘‰ <strong>ç»„ä»¶ç›´æ¥å¤±æ§</strong></p>
<hr/>
<h3 data-id="heading-6">ğŸ§¯ ä¸‰ã€useEffectï¼šå‰¯ä½œç”¨çš„â€œéš”ç¦»åŒºâ€</h3>
<p><code>useEffect</code> çš„å­˜åœ¨ï¼Œæœ¬è´¨åªå¹²ä¸€ä»¶äº‹ï¼š</p>
<blockquote>
<p><strong>æŠŠå‰¯ä½œç”¨ä»â€œæ¸²æŸ“é˜¶æ®µâ€æŒªèµ°</strong></p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  <span class="hljs-comment">// å‰¯ä½œç”¨é€»è¾‘</span>
}, <span class="hljs-selector-attr">[]</span>)
</code></pre>
<p>ğŸ’¡ <strong>ä¸€å¥è¯ç†è§£ï¼š</strong></p>
<blockquote>
<p><strong>render é˜¶æ®µå¿…é¡»çº¯ï¼Œ<br/>
effect é˜¶æ®µå…è®¸è„ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-7">ğŸ“¦ å››ã€ä¾èµ–æ•°ç»„ä¸æ˜¯ç»†èŠ‚ï¼Œè€Œæ˜¯â€œå‰¯ä½œç”¨è¾¹ç•Œâ€</h3>
<h4 data-id="heading-8">1ï¸âƒ£ åªæ‰§è¡Œä¸€æ¬¡ï¼ˆæŒ‚è½½ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>('mounted')
}, <span class="hljs-selector-attr">[]</span>)
</code></pre>
<ul>
<li>åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ</li>
<li>ç±»ä¼¼ Vue çš„ <code>onMounted</code></li>
</ul>
<hr/>
<h4 data-id="heading-9">2ï¸âƒ£ ä¾èµ–å˜åŒ–æ‰æ‰§è¡Œ</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(num)
}, <span class="hljs-selector-attr">[num]</span>)
</code></pre>
<ul>
<li><code>num</code> å˜åŒ– â†’ æ‰§è¡Œ</li>
<li>ä¸å˜ â†’ ä¸æ‰§è¡Œ</li>
</ul>
<blockquote>
<p><strong>ä¾èµ–æ•°ç»„çš„æœ¬è´¨æ˜¯ï¼š<br/>
â€œè¿™ä¸ªå‰¯ä½œç”¨ä¾èµ–è°ï¼Ÿâ€</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-10">3ï¸âƒ£ ä¸å†™ä¾èµ–é¡¹ï¼Ÿ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'every render'</span>)
})
</code></pre>
<p>ğŸ‘‰ æ¯æ¬¡ render éƒ½æ‰§è¡Œ<br/>
ğŸ‘‰ <strong>99% çš„æ—¶å€™æ˜¯æ€§èƒ½é™·é˜±</strong></p>
<hr/>
<h3 data-id="heading-11">ğŸ’¥ äº”ã€90% æ–°æ‰‹éƒ½ä¼šè¸©çš„å‘ï¼šå†…å­˜æ³„æ¼</h3>
<p>æ¥çœ‹ä¸€ä¸ª<strong>æå…¶ç»å…¸</strong>çš„ Hooks é”™è¯¯å†™æ³•ğŸ‘‡</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  const timer = <span class="hljs-built_in">setInterval</span>(() =&gt; {
    console<span class="hljs-selector-class">.log</span>(num)
  }, <span class="hljs-number">1000</span>)
}, <span class="hljs-selector-attr">[num]</span>)
</code></pre>
<p>ä½ è§‰å¾—è¿™æ®µä»£ç æœ‰é—®é¢˜å—ï¼Ÿ</p>
<blockquote>
<p><strong>æœ‰ï¼Œè€Œä¸”éå¸¸è‡´å‘½ã€‚</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-12">âŒ é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ</h4>
<ul>
<li><code>num</code> æ¯å˜ä¸€æ¬¡</li>
<li>effect é‡æ–°æ‰§è¡Œ</li>
<li>æ–°å»ºä¸€ä¸ªå®šæ—¶å™¨</li>
<li>â—æ—§å®šæ—¶å™¨è¿˜æ´»ç€</li>
</ul>
<p>ç»“æœå°±æ˜¯ï¼š</p>
<ul>
<li>â±ï¸ å®šæ—¶å™¨è¶Šæ¥è¶Šå¤š</li>
<li>ğŸ“ˆ å†…å­˜æŒç»­ä¸Šæ¶¨</li>
<li>ğŸ’¥ æ§åˆ¶å°ç–¯ç‹‚æ‰“å°</li>
<li>ğŸ§  <strong>å†…å­˜æ³„æ¼</strong></li>
</ul>
<hr/>
<h3 data-id="heading-13">ğŸ§¹ å…­ã€useEffect returnï¼šå‰¯ä½œç”¨çš„â€œå–„ç»ˆæœºåˆ¶â€</h3>
<p>React ç»™ä½ å‡†å¤‡äº†ä¸€ä¸ª<strong>å®˜æ–¹æ¸…ç†é€šé“</strong>ğŸ‘‡</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  const timer = <span class="hljs-built_in">setInterval</span>(() =&gt; {
    console<span class="hljs-selector-class">.log</span>(num)
  }, <span class="hljs-number">1000</span>)

  return () =&gt; {
    <span class="hljs-built_in">clearInterval</span>(timer)
  }
}, <span class="hljs-selector-attr">[num]</span>)
</code></pre>
<h4 data-id="heading-14">âš ï¸ é‡ç‚¹æ¥äº†</h4>
<blockquote>
<p><strong>return çš„å‡½æ•°ä¸æ˜¯â€œå¸è½½æ—¶æ‰æ‰§è¡Œâ€</strong></p>
</blockquote>
<p>è€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>ä¸‹ä¸€æ¬¡ effect æ‰§è¡Œå‰ï¼Œä¸€å®šä¼šå…ˆæ‰§è¡Œå®ƒ</strong></p>
</blockquote>
<p>React å†…éƒ¨é¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>æ‰§è¡Œä¸Šä¸€æ¬¡ effect çš„ cleanup</li>
<li>å†æ‰§è¡Œæ–°çš„ effect</li>
</ol>
<p>ğŸ‘‰ <strong>è¿™å°±æ˜¯ Hooks é˜²å†…å­˜æ³„æ¼çš„æ ¸å¿ƒè®¾è®¡</strong></p>
<hr/>
<h3 data-id="heading-15">ğŸ§  ä¸ƒã€useStateï¼šä¸ºä»€ä¹ˆåˆå§‹åŒ–ä¸èƒ½å¼‚æ­¥ï¼Ÿ</h3>
<p>ä½ åœ¨å­¦ä¹  Hooks æ—¶ï¼Œä¸€å®šé—®è¿‡è¿™ä¸ªé—®é¢˜ğŸ‘‡</p>
<blockquote>
<p>â“ æˆ‘èƒ½ä¸èƒ½åœ¨ useState åˆå§‹åŒ–æ—¶è¯·æ±‚æ¥å£ï¼Ÿ</p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin">useState(async () =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">data</span> = await fetchData()
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>
})
</code></pre>
<p>ç­”æ¡ˆå¾ˆå¹²è„†ï¼š</p>
<blockquote>
<p>âŒ <strong>ä¸è¡Œ</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-16">ğŸ¤” ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿ</h4>
<p>å› ä¸º React å¿…é¡»ä¿è¯ï¼š</p>
<ul>
<li>é¦–æ¬¡ render <strong>ç«‹å³æœ‰ç¡®å®šçš„ state</strong></li>
<li>å¼‚æ­¥ç»“æœæ˜¯ä¸ç¡®å®šçš„</li>
<li>state ä¸€æ—¦åˆå§‹åŒ–ï¼Œå¿…é¡»æ˜¯åŒæ­¥å€¼</li>
</ul>
<p>React å…è®¸çš„åªæœ‰è¿™ç§ğŸ‘‡</p>
<pre><code class="hljs language-css" lang="css">useState(() =&gt; {
  const <span class="hljs-selector-tag">a</span> = <span class="hljs-number">1</span> + <span class="hljs-number">2</span>
  const <span class="hljs-selector-tag">b</span> = <span class="hljs-number">2</span> + <span class="hljs-number">3</span>
  return <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>
})
</code></pre>
<p>ğŸ’¡ è¿™å« <strong>æƒ°æ€§åˆå§‹åŒ–</strong><br/>
ğŸ’¡ ä½†å‰ææ˜¯ï¼š<strong>åŒæ­¥ + çº¯å‡½æ•°</strong></p>
<hr/>
<h3 data-id="heading-17">ğŸŒ å…«ã€é‚£å¼‚æ­¥è¯·æ±‚åˆ°åº•è¯¥å†™å“ªï¼Ÿ</h3>
<p>ç­”æ¡ˆåªæœ‰ä¸€ä¸ªåœ°æ–¹ï¼š</p>
<blockquote>
<p><strong>useEffect</strong></p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  async function <span class="hljs-built_in">query</span>() {
    const data = await <span class="hljs-built_in">queryData</span>()
    <span class="hljs-built_in">setNum</span>(data)
  }
  <span class="hljs-built_in">query</span>()
}, <span class="hljs-selector-attr">[]</span>)
</code></pre>
<p>ğŸ¯ <strong>è¿™æ˜¯ React å®˜æ–¹æ¨èæ¨¡å¼</strong></p>
<ul>
<li>state åˆå§‹åŒ– â†’ ç¡®å®š</li>
<li>å¼‚æ­¥è¯·æ±‚ â†’ å‰¯ä½œç”¨</li>
<li>æ•°æ®å›æ¥ â†’ æ›´æ–°çŠ¶æ€</li>
</ul>
<hr/>
<h3 data-id="heading-18">ğŸ”„ ä¹ã€ä¸ºä»€ä¹ˆ setState å¯ä»¥ä¼ å‡½æ•°ï¼Ÿ</h3>
<pre><code class="hljs language-ini" lang="ini">setNum(<span class="hljs-attr">prev</span> =&gt; prev + <span class="hljs-number">1</span>)
</code></pre>
<p>è¿™ä¸æ˜¯â€œèŠ±é‡Œèƒ¡å“¨â€ï¼Œè€Œæ˜¯<strong>å¹¶å‘å®‰å…¨è®¾è®¡</strong>ã€‚</p>
<p>React å†…éƒ¨å¯èƒ½ä¼šï¼š</p>
<ul>
<li>åˆå¹¶å¤šæ¬¡æ›´æ–°</li>
<li>å»¶è¿Ÿæ‰§è¡Œ setState</li>
</ul>
<p>å¦‚æœä½ ç›´æ¥ç”¨ <code>num + 1</code>ï¼Œå¾ˆå¯èƒ½æ‹¿åˆ°çš„æ˜¯æ—§å€¼ã€‚</p>
<blockquote>
<p><strong>å‡½æ•°å¼ setState = æ°¸è¿œå®‰å…¨</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-19">ğŸ åã€Hooks çš„çœŸæ­£ä»·å€¼ï¼ˆæ€»ç»“ï¼‰</h3>
<p>å¦‚æœä½ åªæŠŠ Hooks å½“æˆï¼š</p>
<blockquote>
<p>â€œä¸ç”¨å†™ class äº†â€</p>
</blockquote>
<p>é‚£ä½ åªçœ‹åˆ°äº†è¡¨é¢ã€‚</p>
<h4 data-id="heading-20">Hooks çœŸæ­£è§£å†³çš„æ˜¯ï¼š</h4>
<ul>
<li>ğŸ§© <strong>çŠ¶æ€å¦‚ä½•åœ¨å‡½æ•°ä¸­ç¨³å®šå­˜åœ¨</strong></li>
<li>ğŸ§¯ <strong>å‰¯ä½œç”¨å¦‚ä½•è¢«ç²¾ç¡®æ§åˆ¶</strong></li>
<li>ğŸ§  <strong>ç”Ÿå‘½å‘¨æœŸå¦‚ä½•æ˜¾å¼å»ºæ¨¡</strong></li>
<li>ğŸ”’ <strong>å†…å­˜æ³„æ¼å¦‚ä½•è¢«ä¸»åŠ¨è§„é¿</strong></li>
</ul>
<hr/>
<h3 data-id="heading-21">âœ¨ æœ€åçš„æ˜é‡‘é‡‘å¥</h3>
<blockquote>
<p><strong>useState è§£å†³çš„æ˜¯ï¼šæ•°æ®å¦‚ä½•â€œæ´»ç€â€</strong><br/>
<strong>useEffect è§£å†³çš„æ˜¯ï¼šå‰¯ä½œç”¨å¦‚ä½•â€œå–„ç»ˆâ€</strong></p>
<p>React Hooks ä¸åªæ˜¯è¯­æ³•å‡çº§ï¼Œ<br/>
è€Œæ˜¯ä¸€åœºä»â€œå‘½ä»¤å¼ç”Ÿå‘½å‘¨æœŸâ€<br/>
åˆ°â€œå£°æ˜å¼å‰¯ä½œç”¨ç®¡ç†â€çš„é©å‘½ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent ä»‹ç»]]></title>    <link>https://juejin.cn/post/7585458459166359586</link>    <guid>https://juejin.cn/post/7585458459166359586</guid>    <pubDate>2025-12-20T12:18:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166359586" data-draft-id="7585476892976070690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent ä»‹ç»"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-20T12:18:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­æ´‹"/> <meta itemprop="url" content="https://juejin.cn/user/1099167359835015"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167359835015/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­æ´‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:18:00.000Z" title="Sat Dec 20 2025 12:18:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>è¿™å‘¨åœ¨ç»„å†…åšäº†ä¸€æ¬¡å…³äº <strong>Agent è®¾è®¡æ¨¡å¼</strong> çš„åˆ†äº«ï¼Œä¸»è¦ä»‹ç»å’Œè®²è§£äº† <strong>ReAct æ¨¡å¼</strong> ä¸ <strong>P&amp;Aï¼ˆPlan and Executeï¼‰æ¨¡å¼</strong>ã€‚æˆ‘è®¡åˆ’å°†è¿™æ¬¡åˆ†äº«æ‹†åˆ†ä¸ºä¸‰ç¯‡æ–‡ç« ï¼Œå¯¹æˆ‘åœ¨ç»„ä¼šä¸­è®²è§£çš„å†…å®¹è¿›è¡Œæ›´åŠ ç³»ç»Ÿå’Œç»†è‡´çš„æ•´ç†ã€‚</p>
<p>åœ¨æ­£å¼è¿›å…¥å…·ä½“çš„ Agent æ¨¡å¼å®ç°ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªç»•ä¸å¼€çš„é—®é¢˜éœ€è¦å…ˆå›ç­”æ¸…æ¥šï¼š</p>
<blockquote>
<p><strong>ä»€ä¹ˆæ˜¯ AI Agentï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä»¥åŠåœ¨è¿‘å‡ å¹´ AI æŠ€æœ¯ä¸åº”ç”¨å¿«é€Ÿæ¼”è¿›çš„è¿‡ç¨‹ä¸­ï¼ŒAI åº”ç”¨çš„å¼€å‘èŒƒå¼ç»å†äº†å“ªäº›å…³é”®å˜åŒ–ï¼Ÿ</strong></p>
</blockquote>
<p>è¿™ä¸€ç¯‡å°†ä¸ç›´æ¥å±•å¼€æŸä¸€ç§ Agent æ¨¡å¼çš„å®ç°ç»†èŠ‚ï¼Œè€Œæ˜¯å…ˆå›åˆ°æ›´å®è§‚çš„è§†è§’ï¼Œä» <strong>AI åº”ç”¨å½¢æ€ä¸å·¥ç¨‹èŒƒå¼çš„æ¼”è¿›</strong> å…¥æ‰‹ï¼Œæ¢³ç† Agent å‡ºç°çš„æŠ€æœ¯èƒŒæ™¯ä¸å¿…ç„¶æ€§ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä¸‹æ–‡å¯¹ AI åº”ç”¨æ¼”è¿›é˜¶æ®µçš„åˆ’åˆ†ï¼Œæ˜¯ä¸€ç§<strong>ä»¥â€œåº”ç”¨å¼€å‘èŒƒå¼â€ä¸ºæ ¸å¿ƒçš„æŠ½è±¡æ€»ç»“</strong>ã€‚çœŸå®çš„æŠ€æœ¯æ¼”è¿›åœ¨æ—¶é—´ä¸Šå­˜åœ¨æ˜æ˜¾é‡å ï¼Œä½†è¿™ç§é˜¶æ®µåŒ–çš„å™è¿°æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ï¼š<strong>ä¸ºä»€ä¹ˆ Agent ä¼šåœ¨å½“ä¸‹æˆä¸ºä¸»æµæ–¹å‘</strong>ã€‚</p>
<h2 data-id="heading-1">AI åº”ç”¨çš„å‘å±•å†ç¨‹</h2>
<h3 data-id="heading-2">ç¬¬ä¸€é˜¶æ®µï¼šæç¤ºè¯å·¥ç¨‹</h3>
<p>2022 å¹´ 11 æœˆï¼ŒGPT-3.5 å‘å¸ƒåï¼Œå¤§æ¨¡å‹å¼€å§‹ä»ç ”ç©¶é¢†åŸŸè¿›å…¥å¤§ä¼—è§†é‡ã€‚å¯¹å¼€å‘è€…æ¥è¯´ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡å¯ä»¥åœ¨å®é™…äº§å“ä¸­ç›´æ¥ä½¿ç”¨é€šç”¨è¯­è¨€æ¨¡å‹ã€‚</p>
<p>è¿™ä¸€é˜¶æ®µçš„ AI åº”ç”¨å½¢æ€éå¸¸ç®€å•ï¼Œå¤§å¤šæ•°äº§å“æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªå¯¹è¯ç•Œé¢ï¼š<code>ç”¨æˆ·è¾“å…¥é—®é¢˜</code> â†’ <code>æ¨¡å‹ç”Ÿæˆå›ç­”</code> â†’ <code>ç»“æŸ</code>ã€‚</p>
<p>å¾ˆå¿«ï¼Œå›´ç»• Prompt çš„å·¥ç¨‹å®è·µå¼€å§‹å‡ºç°ã€‚ç”±äºæ¨¡å‹å¯¹ä¸Šä¸‹æ–‡éå¸¸æ•æ„Ÿï¼Œ<strong>ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰æˆä¸ºå½“æ—¶æœ€ç›´æ¥ã€ä¹Ÿæœ€æœ‰æ•ˆçš„æ§åˆ¶æ‰‹æ®µ</strong>ã€‚å¸¸è§çš„åšæ³•æ˜¯é€šè¿‡æç¤ºè¯çº¦æŸæ¨¡å‹çš„è§’è‰²ã€è¾“å‡ºå½¢å¼å’Œå…³æ³¨é‡ç‚¹ï¼Œä¾‹å¦‚ï¼š</p>
<blockquote>
<p>â€œä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œè¯·ä¸¥æ ¼ä»¥ JSON æ ¼å¼è¾“å‡ºç»“æœâ€¦â€¦â€</p>
</blockquote>
<p>è¿™ç±»â€œèº«ä»½é¢å…·â€å¼çš„æç¤ºï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸Šä¸‹æ–‡çº¦æŸæ¥å‡å°‘æ¨¡å‹è¾“å‡ºçš„å‘æ•£æ€§ï¼Œè®©ç»“æœæ›´è´´è¿‘é¢„æœŸã€‚åœ¨è¿™ä¸€é˜¶æ®µï¼Œä¹Ÿé™†ç»­å‡ºç°äº† <strong>Chain-of-Thoughtã€Few-shot Prompting</strong> ç­‰æ¨ç†å¢å¼ºæŠ€å·§ï¼Œä½†å®ƒä»¬ä¾ç„¶å±äº<strong>å•æ¬¡ç”Ÿæˆæ¨¡å¼</strong>ï¼šæ¨¡å‹åœ¨ä¸€æ¬¡è°ƒç”¨ä¸­å®Œæˆå…¨éƒ¨æ¨ç†ï¼Œè¿‡ç¨‹ä¸­æ— æ³•è·å¾—å¤–éƒ¨åé¦ˆï¼Œä¹Ÿæ— æ³•æ ¹æ®ä¸­é—´ç»“æœè°ƒæ•´ç­–ç•¥ã€‚</p>
<h3 data-id="heading-3">ç¬¬äºŒé˜¶æ®µï¼šRAG</h3>
<p>å½“ AI å¼€å§‹è¢«ç”¨äºçœŸå®ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œå¾ˆå¿«æš´éœ²å‡ºä¸¤ä¸ªé—®é¢˜ï¼š<strong>æ¨¡å‹ä¸äº†è§£ç§æœ‰çŸ¥è¯†</strong>ï¼Œä»¥åŠ<strong>ç”Ÿæˆç»“æœéš¾ä»¥æ ¡éªŒ</strong>ã€‚ä»¥ GPT-3.5 ä¸ºä¾‹ï¼Œå®ƒçš„è®­ç»ƒæ•°æ®æˆªæ­¢åœ¨ 21 å¹´å·¦å³ï¼Œå¯¹äºæ–°æŠ€æœ¯ä»¥åŠä¼ä¸šå†…éƒ¨æ–‡æ¡£ã€ä¸šåŠ¡è§„åˆ™æ›´æ˜¯ä¸äº†è§£ï¼Œç›´æ¥ä½¿ç”¨å¾€å¾€ä¸å¯æ§ã€‚</p>
<p>RAGï¼ˆRetrieval-Augmented Generationï¼‰æ˜¯åœ¨è¿™ç§èƒŒæ™¯ä¸‹è¢«å¹¿æ³›é‡‡ç”¨çš„æ–¹æ¡ˆã€‚å®ƒçš„æ ¸å¿ƒåšæ³•æ˜¯ï¼š</p>
<ul>
<li>å°†ç§æœ‰çŸ¥è¯†è¿›è¡Œåˆ‡åˆ†å’Œå‘é‡åŒ–å­˜å‚¨ï¼›</li>
<li>ç”¨æˆ·æé—®æ—¶ï¼Œå…ˆè¿›è¡Œç›¸ä¼¼åº¦æ£€ç´¢ï¼›</li>
<li>å°†å‘½ä¸­çš„å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡æä¾›ç»™æ¨¡å‹ï¼Œå†ç”±æ¨¡å‹å®Œæˆç”Ÿæˆã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹ä¸éœ€è¦è®°ä½æ‰€æœ‰çŸ¥è¯†ï¼Œè€Œæ˜¯åœ¨ç”Ÿæˆæ—¶æŒ‰éœ€è·å–å‚è€ƒä¿¡æ¯ã€‚</p>
<p>RAG çš„ä»·å€¼ä¸ä»…åœ¨äºè¡¥å……æ–°çŸ¥è¯†ï¼Œæ›´é‡è¦çš„æ˜¯å¸¦æ¥äº†<strong>å¯æ§æ€§å’Œå¯è¿½æº¯æ€§</strong>ï¼šç”Ÿæˆå†…å®¹å¯ä»¥æ˜ç¡®å¯¹åº”åˆ°åŸå§‹æ–‡æ¡£ï¼Œè¿™ä¸€ç‚¹åœ¨ä¼ä¸šåœºæ™¯ä¸­å°¤ä¸ºå…³é”®ã€‚</p>
<h3 data-id="heading-4">ç¬¬ä¸‰é˜¶æ®µï¼šTool Calling</h3>
<p>å¦‚æœè¯´ RAG è®©æ¨¡å‹èƒ½å¤Ÿâ€œæŸ¥èµ„æ–™â€ï¼Œé‚£ä¹ˆ <strong>Function / Tool Calling</strong> åˆ™è®©æ¨¡å‹å¼€å§‹èƒ½å¤Ÿâ€œåšäº‹æƒ…â€ã€‚</p>
<p>åœ¨è¿™ä¸€é˜¶æ®µï¼Œå¼€å‘è€…ä¼šæŠŠå¯ç”¨èƒ½åŠ›ï¼ˆå¦‚æŸ¥è¯¢æ•°æ®åº“ã€è°ƒç”¨æ¥å£ã€æ‰§è¡Œè„šæœ¬ï¼‰ä»¥ç»“æ„åŒ–çš„æ–¹å¼æä¾›ç»™æ¨¡å‹ï¼ŒåŒ…æ‹¬å‡½æ•°åã€å‚æ•°è¯´æ˜å’ŒåŠŸèƒ½æè¿°ã€‚æ¨¡å‹åœ¨ç†è§£ç”¨æˆ·æ„å›¾åï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ˜ç¡®çš„å·¥å…·è°ƒç”¨è¯·æ±‚ï¼Œå†ç”±ç¨‹åºå®Œæˆå®é™…æ‰§è¡Œã€‚</p>
<p>è¿™ä¸€èƒ½åŠ›çš„å‡ºç°ï¼Œæ ‡å¿—ç€ <strong>AI ç¬¬ä¸€æ¬¡åœ¨å·¥ç¨‹ä¸Šå…·å¤‡äº†å¯é è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿçš„èƒ½åŠ›</strong>ã€‚å®ƒä¸å†åªæ˜¯ä¸€ä¸ªèŠå¤©æœºå™¨äººï¼Œè€Œæ˜¯ä¸€ä¸ªå¯ä»¥è§¦å‘çœŸå®ä¸–ç•ŒåŠ¨ä½œçš„â€œæ§åˆ¶å™¨â€ï¼Œè¿™ä¹Ÿæ˜¯åç»­ Agent èƒ½å¤Ÿè½åœ°çš„å…³é”®æŠ€æœ¯æ”¯æ’‘ã€‚</p>
<h3 data-id="heading-5">ç¬¬å››é˜¶æ®µï¼šAI Workflow</h3>
<p>å½“ RAG èƒ½åŠ›å’Œ Tool Calling èƒ½åŠ›é€æ¸æˆç†Ÿåï¼Œå¼€å‘è€…å¼€å§‹å°è¯•æŠŠå¤šä¸ªæ­¥éª¤ç»„åˆèµ·æ¥ï¼Œå½¢æˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚è¿™å‚¬ç”Ÿäº†ä»¥ Difyã€Coze ä¸ºä»£è¡¨çš„ <strong>AI Workflow</strong> èŒƒå¼ã€‚</p>
<p>åœ¨ Workflow æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ª AI åº”ç”¨ä¼šè¢«æ‹†è§£ä¸ºå¤šä¸ªå›ºå®šèŠ‚ç‚¹ï¼Œå¹¶æŒ‰ç…§é¢„è®¾é¡ºåºæ‰§è¡Œï¼Œä¾‹å¦‚ï¼šæ£€ç´¢ â†’ åˆ¤æ–­ â†’ å·¥å…·è°ƒç”¨ â†’ æ±‡æ€»è¾“å‡ºã€‚</p>
<p>Workflow çš„ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼š</p>
<ul>
<li>æµç¨‹æ¸…æ™°ï¼Œè¡Œä¸ºå¯é¢„æœŸï¼›</li>
<li>æ˜“äºæµ‹è¯•å’Œè¿è¥ï¼›</li>
<li>å¯¹éå·¥ç¨‹äººå‘˜å‹å¥½ã€‚</li>
</ul>
<p>ä½†é—®é¢˜ä¹ŸåŒæ ·æ˜æ˜¾ï¼šæµç¨‹å®Œå…¨ç”±äººè®¾è®¡ï¼Œæ¨¡å‹åªæ˜¯æ‰§è¡Œè€…ã€‚æ— è®ºé—®é¢˜å¤æ‚ä¸å¦ï¼Œéƒ½å¿…é¡»èµ°å®Œæ•´æ¡è·¯å¾„ã€‚è¿™ç§æ–¹å¼åœ¨åº”å¯¹é«˜åº¦åŠ¨æ€æˆ–éæ ‡å‡†ä»»åŠ¡æ—¶ï¼Œçµæ´»æ€§æœ‰é™ã€‚</p>
<h3 data-id="heading-6">ç¬¬äº”é˜¶æ®µï¼šAgent</h3>
<p>åœ¨ Agent å‡ºç°ä¹‹å‰ï¼Œå¤§å¤šæ•° AI åº”ç”¨ä»ç„¶éµå¾ªä¸€ç§å…¸å‹æ¨¡å¼ï¼š<code>è¾“å…¥</code> â†’ <code>å•æ¬¡/ç¼–æ’å¥½çš„æ¨ç†</code> â†’ <code>è¾“å‡º</code>ã€‚</p>
<p>è€Œ Agent çš„å‡ºç°ï¼Œæœ¬è´¨ä¸Šæ˜¯<strong>å°†â€œä»»åŠ¡ç¼–æ’â€çš„æ§åˆ¶æƒä»äººç±»æ‰‹ä¸­äº¤è¿˜ç»™äº† AI</strong>ã€‚åœ¨ Agent æ¶æ„ä¸‹ï¼ŒAI ä¸å†æ˜¯è¢«åŠ¨æ‰§è¡Œä¸€æ®µä»£ç ï¼Œè€Œæ˜¯ä¸€ä¸ªå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›çš„é—­ç¯ç³»ç»Ÿï¼š</p>
<ul>
<li>å°†å¤æ‚ç›®æ ‡æ‹†è§£ä¸ºå¤šä¸ªå¯æ‰§è¡Œæ­¥éª¤ï¼›</li>
<li>æ ¹æ®å·¥å…·æ‰§è¡Œç»“æœè°ƒæ•´åç»­è¡ŒåŠ¨ï¼›</li>
<li>åœ¨å¤±è´¥æ—¶å°è¯•ä¿®æ­£ç­–ç•¥ï¼›</li>
<li>åœ¨å¤šæ­¥è¿‡ç¨‹ä¸­ç»´æŠ¤ä¸Šä¸‹æ–‡çŠ¶æ€ã€‚</li>
</ul>
<p>è¿™äº›èƒ½åŠ›å¹¶ä¸æ˜¯ä¸€æ¬¡æ¨¡å‹è°ƒç”¨å®Œæˆçš„ï¼Œè€Œæ˜¯é€šè¿‡å¤šè½®æ¨ç†ä¸æ‰§è¡Œå½¢æˆé—­ç¯ã€‚ä¹Ÿæ­£æ˜¯åœ¨è¿™ä¸€ç‚¹ä¸Šï¼ŒAgent ä¸å‰é¢çš„åº”ç”¨å½¢æ€æ‹‰å¼€äº†å·®è·ã€‚</p>
<h2 data-id="heading-7">Agent è®¾è®¡æ¨¡å¼è§£å†³çš„é—®é¢˜</h2>
<p>å½“ Agent å¼€å§‹æ‰¿æ‹…æ›´å¤æ‚çš„ä»»åŠ¡æ—¶ï¼Œé—®é¢˜ä¹Ÿéšä¹‹å‡ºç°ï¼š</p>
<ul>
<li>å¤šæ­¥æ¨ç†å®¹æ˜“è·‘åï¼›</li>
<li>æ‰§è¡Œå¤±è´¥åç¼ºä¹ç»Ÿä¸€çš„ä¿®æ­£ç­–ç•¥ï¼›</li>
<li>æˆæœ¬å’Œç¨³å®šæ€§éš¾ä»¥æ§åˆ¶ã€‚</li>
</ul>
<p><strong>Agent è®¾è®¡æ¨¡å¼çš„ä½œç”¨ï¼Œå°±æ˜¯æŠŠè¿™äº›åå¤å‡ºç°çš„é—®é¢˜æŠ½è±¡æˆå¯å¤ç”¨çš„ç»“æ„ã€‚</strong></p>
<p>æ— è®ºæ˜¯ <strong>ReAct</strong>ï¼Œè¿˜æ˜¯ <strong>Plan and Execute</strong>ï¼Œå®ƒä»¬å…³æ³¨çš„æ ¸å¿ƒå¹¶ä¸æ˜¯â€œè®©æ¨¡å‹æ›´èªæ˜â€ï¼Œè€Œæ˜¯ï¼š<strong>å¦‚ä½•åœ¨å·¥ç¨‹ä¸Šç»„ç»‡æ¨¡å‹çš„æ¨ç†ã€è¡ŒåŠ¨å’Œåé¦ˆè¿‡ç¨‹ï¼Œä½¿ç³»ç»Ÿæ•´ä½“å¯æ§ã€å¯ç»´æŠ¤ã€‚</strong></p>
<p>ç†è§£è¿™äº›æ¨¡å¼ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨æ„å»º Agent ç³»ç»Ÿæ—¶å°‘èµ°å¼¯è·¯ï¼Œè€Œä¸æ˜¯æ¯ä¸€æ¬¡éƒ½ä»é›¶å¼€å§‹è®¾è®¡æ•´å¥—äº¤äº’ä¸æ§åˆ¶é€»è¾‘ã€‚</p>
<h2 data-id="heading-8">ç»“è¯­</h2>
<p>ä»æœ€åˆåŸºäº Prompt çš„ç®€å•å¯¹è¯ï¼Œåˆ°å¦‚ä»Šå…·å¤‡ä¸€å®šè‡ªä¸»èƒ½åŠ›çš„ Agentï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ä¸åªæ˜¯æ¨¡å‹èƒ½åŠ›çš„æå‡ï¼Œæ›´æ˜¯ AI åœ¨å®é™…ä½¿ç”¨æ–¹å¼ä¸Šçš„å˜åŒ–ã€‚</p>
<p>å›é¡¾æ•´ä¸ªè¿‡ç¨‹ä¼šå‘ç°ï¼Œå¾ˆå¤šå…³é”®æŠ€æœ¯å¹¶ä¸æ˜¯æœ€è¿‘æ‰å‡ºç°çš„ã€‚RAG çš„æ ¸å¿ƒæ€è·¯æ—©åœ¨å‡ å¹´å‰å°±å·²ç»è¢«æå‡ºï¼ŒReAct ä¹Ÿå¹¶éæ–°æ¦‚å¿µï¼Œåªæ˜¯åœ¨æœ€è¿‘éšç€æ¨¡å‹æ¨ç†èƒ½åŠ›æå‡ã€å·¥å…·é“¾é€æ¸æˆç†Ÿï¼Œæ‰çœŸæ­£å…·å¤‡äº†å·¥ç¨‹è½åœ°çš„æ¡ä»¶ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå¹¶ä¸æ˜¯æƒ³æ³•ä¸å­˜åœ¨ï¼Œè€Œæ˜¯æ—¶æœºè¿˜æ²¡åˆ°ã€‚</p>
<p>ç†è§£è¿™äº›æ¼”è¿›èƒŒæ™¯ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åˆ¤æ–­å“ªäº›èƒ½åŠ›æ˜¯çŸ­æœŸå™±å¤´ï¼Œå“ªäº›æ˜¯é•¿æœŸæ–¹å‘ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†èšç„¦ Agent è®¾è®¡æ¨¡å¼ä¸­æœ€å¸¸è§ã€ä¹Ÿæœ€å®ç”¨çš„ ReAct æ¨¡å¼ï¼Œç»“åˆå®é™…å®ç°ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è®© AI åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ä¸­é€æ­¥æ€è€ƒã€ä¸æ–­è°ƒæ•´ç­–ç•¥çš„ã€‚</p>
<h2 data-id="heading-9">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.promptingguide.ai%2F" target="_blank" title="https://www.promptingguide.ai/" ref="nofollow noopener noreferrer">æç¤ºå·¥ç¨‹æŒ‡å—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bohrium.com%2Fpaper%2Fread%3FlibraryId%3D8578838" target="_blank" title="https://www.bohrium.com/paper/read?libraryId=8578838" ref="nofollow noopener noreferrer">Chain-of-Thought Prompting Elicits Reasoning in Large Language Models.</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bohrium.com%2Fpaper%2Fread%3FlibraryId%3D8579062" target="_blank" title="https://www.bohrium.com/paper/read?libraryId=8579062" ref="nofollow noopener noreferrer">Language Models are Few-Shot Learners</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bohrium.com%2Fpaper%2Fread%3FlibraryId%3D8578906%26activeReadTab%3Dchat" target="_blank" title="https://www.bohrium.com/paper/read?libraryId=8578906&amp;activeReadTab=chat" ref="nofollow noopener noreferrer">Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks.</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bohrium.com%2Fpaper%2Fread%3FlibraryId%3D8578958%26activeReadTab%3Dchat" target="_blank" title="https://www.bohrium.com/paper/read?libraryId=8578958&amp;activeReadTab=chat" ref="nofollow noopener noreferrer">Toolformer: Language Models Can Teach Themselves to Use Tools.</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bohrium.com%2Fpaper%2Fread%3FlibraryId%3D8578981" target="_blank" title="https://www.bohrium.com/paper/read?libraryId=8578981" ref="nofollow noopener noreferrer">A Survey on Large Language Model based Autonomous Agents.</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€èŠ‚ç‚¹ã€‘[LinearToGammaSpaceExactèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨]]></title>    <link>https://juejin.cn/post/7585484081435639859</link>    <guid>https://juejin.cn/post/7585484081435639859</guid>    <pubDate>2025-12-20T11:07:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585484081435639859" data-draft-id="7585463258691174409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€èŠ‚ç‚¹ã€‘[LinearToGammaSpaceExactèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨"/> <meta itemprop="keywords" content="æ¸¸æˆå¼€å‘,å›¾å½¢å­¦,Unity3D"/> <meta itemprop="datePublished" content="2025-12-20T11:07:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€èŠ‚ç‚¹ã€‘[LinearToGammaSpaceExactèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:07:21.000Z" title="Sat Dec 20 2025 11:07:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<h2 data-id="heading-0">çº¿æ€§é¢œè‰²ç©ºé—´ä¸ä¼½é©¬é¢œè‰²ç©ºé—´åŸºç¡€æ¦‚å¿µ</h2>
<p>åœ¨è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œé¢œè‰²ç©ºé—´çš„ç®¡ç†æ˜¯æ¸²æŸ“æµç¨‹ä¸­è‡³å…³é‡è¦çš„ç¯èŠ‚ã€‚ç†è§£çº¿æ€§é¢œè‰²ç©ºé—´å’Œä¼½é©¬é¢œè‰²ç©ºé—´çš„åŒºåˆ«å¯¹äºåˆ›å»ºé€¼çœŸçš„æ¸²æŸ“æ•ˆæœè‡³å…³é‡è¦ã€‚</p>
<p>çº¿æ€§é¢œè‰²ç©ºé—´æŒ‡çš„æ˜¯é¢œè‰²æ•°å€¼ä¸å®é™…ç‰©ç†å…‰å¼ºå‘ˆçº¿æ€§å…³ç³»çš„é¢œè‰²è¡¨ç¤ºæ–¹å¼ã€‚åœ¨è¿™ç§ç©ºé—´ä¸­ï¼Œé¢œè‰²å€¼0.5è¡¨ç¤ºçš„å…‰å¼ºæ­£å¥½æ˜¯é¢œè‰²å€¼1.0çš„ä¸€åŠã€‚è¿™ç§è¡¨ç¤ºæ–¹å¼ç¬¦åˆç‰©ç†ä¸–ç•Œçš„çœŸå®å…‰ç…§è¡Œä¸ºï¼Œåœ¨æ¸²æŸ“è®¡ç®—ä¸­èƒ½å¤Ÿäº§ç”Ÿå‡†ç¡®çš„æ•°å­¦ç»“æœã€‚</p>
<p>ä¼½é©¬é¢œè‰²ç©ºé—´åˆ™æ˜¯ä¸ºäº†é€‚åº”ä¼ ç»Ÿæ˜¾ç¤ºè®¾å¤‡çš„éçº¿æ€§ç‰¹æ€§è€Œè®¾è®¡çš„é¢œè‰²è¡¨ç¤ºç³»ç»Ÿã€‚ç”±äºCRTæ˜¾ç¤ºå™¨ä»¥åŠå…¶ä»–æ˜¾ç¤ºè®¾å¤‡å¯¹è¾“å…¥ä¿¡å·çš„å“åº”ä¸æ˜¯çº¿æ€§çš„ï¼Œå®é™…ä¸Šæ˜¾ç¤ºè®¾å¤‡ä¼šå¯¹è¾“å…¥ä¿¡å·è¿›è¡Œä¼½é©¬å˜æ¢ã€‚åœ¨ä¼½é©¬ç©ºé—´ä¸­ï¼Œé¢œè‰²æ•°å€¼ä¸æœ€ç»ˆæ˜¾ç¤ºçš„äº®åº¦ä¹‹é—´ä¸æ˜¯ç®€å•çš„çº¿æ€§å…³ç³»ï¼Œè€Œæ˜¯éµå¾ªä¸€ä¸ªå¹‚å‡½æ•°å…³ç³»ã€‚</p>
<h3 data-id="heading-1">ä¼½é©¬æ ¡æ­£çš„å†å²èƒŒæ™¯</h3>
<p>ä¼½é©¬æ ¡æ­£çš„æ¦‚å¿µèµ·æºäºæ—©æœŸçš„CRTæ˜¾ç¤ºå™¨æ—¶ä»£ã€‚CRTæ˜¾ç¤ºå™¨å…·æœ‰å›ºæœ‰çš„éçº¿æ€§å“åº”ç‰¹æ€§ï¼Œå…¶äº®åº¦è¾“å‡ºä¸è¾“å…¥ç”µå‹ä¹‹é—´çš„å…³ç³»å¤§è‡´ç¬¦åˆå¹‚å‡½æ•°è§„å¾‹ï¼ŒæŒ‡æ•°çº¦ä¸º2.2ã€‚è¿™æ„å‘³ç€å³ä½¿è¾“å…¥çº¿æ€§çš„é¢œè‰²ä¿¡å·ï¼Œæ˜¾ç¤ºå™¨ä¹Ÿä¼šè‡ªåŠ¨åº”ç”¨ä¸€ä¸ªè¿‘ä¼¼çš„ä¼½é©¬å˜æ¢ã€‚</p>
<p>ä¸ºäº†è¡¥å¿è¿™ç§éçº¿æ€§ï¼Œå›¾åƒå’Œè§†é¢‘å†…å®¹åœ¨åˆ›å»ºæ—¶å°±ä¼šé¢„å…ˆåº”ç”¨ä¸€ä¸ªåå‘çš„ä¼½é©¬å˜æ¢ï¼ˆæŒ‡æ•°çº¦ä¸º1/2.2ï¼‰ï¼Œè¿™æ ·å½“å†…å®¹åœ¨æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºæ—¶ï¼Œä¸¤è€…çš„å˜æ¢ç›¸äº’æŠµæ¶ˆï¼Œæœ€ç»ˆç”¨æˆ·çœ‹åˆ°çš„å°±æ˜¯æ­£ç¡®çš„çº¿æ€§äº®åº¦å…³ç³»ã€‚è¿™ç§é¢„å¤„ç†è¿‡ç¨‹å°±æ˜¯æ‰€è°“çš„ä¼½é©¬æ ¡æ­£ã€‚</p>
<h3 data-id="heading-2">ç°ä»£æ¸²æŸ“ä¸­çš„ä¼½é©¬å¤„ç†</h3>
<p>åœ¨ç°ä»£æ¸²æŸ“ç®¡çº¿ä¸­ï¼Œè™½ç„¶CRTæ˜¾ç¤ºå™¨å·²é€æ¸è¢«LCDã€OLEDç­‰æ–°æŠ€æœ¯å–ä»£ï¼Œä½†ä¼½é©¬æ ¡æ­£çš„æ¦‚å¿µä»ç„¶éå¸¸é‡è¦ã€‚ä¸»è¦åŸå› åŒ…æ‹¬ï¼š</p>
<ul>
<li>å‘åå…¼å®¹æ€§ï¼šå¤§é‡ç°æœ‰çš„å›¾åƒå†…å®¹å’Œæ ‡å‡†éƒ½æ˜¯åŸºäºä¼½é©¬ç©ºé—´è®¾è®¡çš„</li>
<li>æ„ŸçŸ¥å‡åŒ€æ€§ï¼šäººç±»è§†è§‰ç³»ç»Ÿå¯¹äº®åº¦çš„æ„ŸçŸ¥ä¹Ÿæ˜¯éçº¿æ€§çš„ï¼Œä¼½é©¬ç¼–ç å¯ä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨æœ‰é™çš„æ¯”ç‰¹æ·±åº¦</li>
<li>è¡Œä¸šæ ‡å‡†ï¼šsRGBç­‰ç°ä»£é¢œè‰²æ ‡å‡†ä»ç„¶å»ºç«‹åœ¨ä¼½é©¬ç¼–ç çš„åŸºç¡€ä¸Š</li>
</ul>
<h2 data-id="heading-3">LinearToGammaSpaceExactèŠ‚ç‚¹æ ¸å¿ƒåŠŸèƒ½</h2>
<p>LinearToGammaSpaceExactèŠ‚ç‚¹æ˜¯Unity URP Shader Graphä¸­ä¸“é—¨ç”¨äºé¢œè‰²ç©ºé—´è½¬æ¢çš„å·¥å…·èŠ‚ç‚¹ã€‚è¯¥èŠ‚ç‚¹æ‰§è¡Œä»çº¿æ€§é¢œè‰²ç©ºé—´åˆ°ä¼½é©¬é¢œè‰²ç©ºé—´çš„ç²¾ç¡®æ•°å­¦è½¬æ¢ï¼Œç¡®ä¿é¢œè‰²æ•°æ®åœ¨ä¸åŒç©ºé—´ä¹‹é—´çš„å‡†ç¡®è½¬æ¢ã€‚</p>
<h3 data-id="heading-4">æ•°å­¦åŸç†</h3>
<p>LinearToGammaSpaceExactèŠ‚ç‚¹å®ç°çš„æ•°å­¦è½¬æ¢åŸºäºæ ‡å‡†çš„sRGBä¼½é©¬æ ¡æ­£å…¬å¼ã€‚è½¬æ¢è¿‡ç¨‹ä½¿ç”¨åˆ†æ®µå‡½æ•°æ¥ç²¾ç¡®å¤„ç†æ•´ä¸ªæ•°å€¼èŒƒå›´ï¼š</p>
<p>å¯¹äºè¾“å…¥å€¼å°äºæˆ–ç­‰äº0.0031308çš„æƒ…å†µï¼š</p>
<pre><code class="hljs">ä¼½é©¬å€¼ = 12.92 Ã— çº¿æ€§å€¼
</code></pre>
<p>å¯¹äºè¾“å…¥å€¼å¤§äº0.0031308çš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ä¼½é©¬å€¼ = <span class="hljs-number">1.055</span> Ã— çº¿æ€§å€¼^(<span class="hljs-number">1</span>/<span class="hljs-number">2.4</span>) - <span class="hljs-number">0.055</span>
</code></pre>
<p>è¿™ç§åˆ†æ®µå¤„ç†ç¡®ä¿äº†åœ¨ä½äº®åº¦åŒºåŸŸçš„çº¿æ€§å…³ç³»å’Œè¾ƒé«˜äº®åº¦åŒºåŸŸçš„å¹‚å‡½æ•°å…³ç³»ä¹‹é—´çš„å¹³æ»‘è¿‡æ¸¡ï¼Œç¬¦åˆsRGBæ ‡å‡†è§„èŒƒã€‚</p>
<h3 data-id="heading-5">ä¸è¿‘ä¼¼æ–¹æ³•çš„åŒºåˆ«</h3>
<p>Unityæä¾›äº†ä¸¤ç§ä¼½é©¬è½¬æ¢æ–¹æ³•ï¼šLinearToGammaSpaceExactå’ŒLinearToGammaSpaceã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºç²¾åº¦å’Œæ€§èƒ½ï¼š</p>
<ul>
<li>LinearToGammaSpaceExactï¼šä½¿ç”¨ç²¾ç¡®çš„sRGBè½¬æ¢å…¬å¼ï¼Œè®¡ç®—ç»“æœå‡†ç¡®ä½†è®¡ç®—é‡ç¨å¤§</li>
<li>LinearToGammaSpaceï¼šä½¿ç”¨è¿‘ä¼¼çš„è½¬æ¢å…¬å¼ï¼ˆé€šå¸¸ä¸ºçº¿æ€§å€¼^(1/2.2)ï¼‰ï¼Œè®¡ç®—é€Ÿåº¦å¿«ä½†ç²¾åº¦ç•¥ä½</li>
</ul>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸¤ç§æ–¹æ³•çš„è§†è§‰å·®å¼‚ä¸å¤§ï¼Œä½†åœ¨éœ€è¦ä¸¥æ ¼é¢œè‰²å‡†ç¡®æ€§çš„åœºæ™¯ä¸­ï¼ˆå¦‚ä¸“ä¸šå›¾åƒå¤„ç†ã€é¢œè‰²åˆ†çº§ç­‰ï¼‰ï¼Œåº”ä¼˜å…ˆä½¿ç”¨Exactç‰ˆæœ¬ã€‚</p>
<h2 data-id="heading-6">èŠ‚ç‚¹æ¥å£è¯¦è§£</h2>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/LinearToGammaSpaceExactNodeThumb.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">è¾“å…¥ç«¯å£</h3>
<p>Inè¾“å…¥ç«¯å£æ¥æ”¶Floatç±»å‹çš„æ•°å€¼ï¼Œä»£è¡¨çº¿æ€§é¢œè‰²ç©ºé—´ä¸­çš„é¢œè‰²åˆ†é‡ã€‚è¯¥ç«¯å£å¯ä»¥æ¥å—ä»¥ä¸‹ç±»å‹çš„æ•°å€¼ï¼š</p>
<ul>
<li>å•ä¸ªæµ®ç‚¹æ•°å€¼ï¼šè¡¨ç¤ºå•é¢œè‰²é€šé“çš„çº¿æ€§å€¼</li>
<li>äºŒç»´å‘é‡ï¼šè¡¨ç¤ºä¸¤ä¸ªé¢œè‰²é€šé“çš„çº¿æ€§å€¼</li>
<li>ä¸‰ç»´å‘é‡ï¼šè¡¨ç¤ºRGBé¢œè‰²çš„çº¿æ€§å€¼</li>
<li>å››ç»´å‘é‡ï¼šè¡¨ç¤ºRGBAé¢œè‰²çš„çº¿æ€§å€¼ï¼ŒåŒ…æ‹¬é€æ˜åº¦</li>
</ul>
<p>è¾“å…¥å€¼çš„æœ‰æ•ˆèŒƒå›´é€šå¸¸æ˜¯[0,1]ï¼Œä½†èŠ‚ç‚¹ä¹Ÿå¯ä»¥å¤„ç†è¶…å‡ºæ­¤èŒƒå›´çš„HDRå€¼ï¼Œè½¬æ¢æ—¶ä¼šä¿æŒæ•°å€¼çš„ç›¸å¯¹å…³ç³»ã€‚</p>
<h3 data-id="heading-8">è¾“å‡ºç«¯å£</h3>
<p>Outè¾“å‡ºç«¯å£è¿”å›è½¬æ¢åçš„Floatç±»å‹æ•°å€¼ï¼Œè¡¨ç¤ºä¼½é©¬é¢œè‰²ç©ºé—´ä¸­çš„é¢œè‰²åˆ†é‡ã€‚è¾“å‡ºå€¼çš„èŒƒå›´ä¸è¾“å…¥ç›¸å¯¹åº”ï¼š</p>
<ul>
<li>å¯¹äºæ ‡å‡†èŒƒå›´[0,1]çš„è¾“å…¥ï¼Œè¾“å‡ºä¹Ÿåœ¨[0,1]èŒƒå›´å†…</li>
<li>å¯¹äºHDRå€¼ï¼ˆå¤§äº1ï¼‰ï¼Œè¾“å‡ºä¼šä¿æŒç›¸åº”çš„ç›¸å¯¹äº®åº¦å…³ç³»</li>
</ul>
<p>è¾“å‡ºæ•°æ®ç±»å‹ä¸è¾“å…¥ä¿æŒä¸€è‡´ï¼Œå¦‚æœè¾“å…¥æ˜¯å‘é‡ç±»å‹ï¼Œè¾“å‡ºä¹Ÿæ˜¯ç›¸åº”çš„å‘é‡ç±»å‹ï¼Œæ¯ä¸ªåˆ†é‡éƒ½ç‹¬ç«‹è¿›è¡Œä¼½é©¬è½¬æ¢ã€‚</p>
<h2 data-id="heading-9">å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-10">åå¤„ç†æ•ˆæœä¸­çš„é¢œè‰²æ ¡æ­£</h3>
<p>åœ¨åå¤„ç†æ¸²æŸ“ä¸­ï¼ŒLinearToGammaSpaceExactèŠ‚ç‚¹å¸¸ç”¨äºå°†çº¿æ€§ç©ºé—´çš„è®¡ç®—ç»“æœè½¬æ¢ä¸ºé€‚åˆæ˜¾ç¤ºçš„ä¼½é©¬ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œåœ¨å®ç°è‰²å½©åˆ†çº§ã€è‰²è°ƒæ˜ å°„æˆ–Bloomæ•ˆæœæ—¶ï¼š</p>
<ul>
<li>åœ¨è‰²è°ƒæ˜ å°„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆåœ¨çº¿æ€§ç©ºé—´ä¸­è¿›è¡Œäº®åº¦å‹ç¼©å’Œé¢œè‰²è°ƒæ•´</li>
<li>ä½¿ç”¨LinearToGammaSpaceExactå°†ç»“æœè½¬æ¢åˆ°ä¼½é©¬ç©ºé—´</li>
<li>æœ€ç»ˆè¾“å‡ºåˆ°å±å¹•ç¼“å†²åŒºï¼Œç¡®ä¿æ˜¾ç¤ºè®¾å¤‡èƒ½æ­£ç¡®å‘ˆç°</li>
</ul>
<p>è¿™ç§å·¥ä½œæµç¨‹ä¿è¯äº†é¢œè‰²å¤„ç†çš„å‡†ç¡®æ€§ï¼Œé¿å…äº†å› é¢œè‰²ç©ºé—´ä¸åŒ¹é…å¯¼è‡´çš„é¢œè‰²å¤±çœŸã€‚</p>
<h3 data-id="heading-11">UIå…ƒç´ ä¸æ¸²æŸ“ç»“æœçš„æ··åˆ</h3>
<p>å½“éœ€è¦å°†3Dæ¸²æŸ“ç»“æœä¸UIå…ƒç´ ç»“åˆæ—¶ï¼Œæ­£ç¡®ç®¡ç†é¢œè‰²ç©ºé—´è‡³å…³é‡è¦ï¼š</p>
<ul>
<li>3Dæ¸²æŸ“é€šå¸¸åœ¨çº¿æ€§ç©ºé—´ä¸­è¿›è¡Œè®¡ç®—</li>
<li>UIå…ƒç´ å’Œçº¹ç†é€šå¸¸å­˜å‚¨åœ¨ä¼½é©¬ç©ºé—´ä¸­</li>
<li>ä½¿ç”¨LinearToGammaSpaceExactå¯ä»¥å°†æ¸²æŸ“ç»“æœè½¬æ¢åˆ°ä¸UIä¸€è‡´çš„é¢œè‰²ç©ºé—´</li>
<li>ç¡®ä¿æ··åˆåçš„è§†è§‰æ•ˆæœé¢œè‰²ä¸€è‡´ï¼Œæ²¡æœ‰æ˜æ˜¾çš„ç•Œé™æˆ–å·®å¼‚</li>
</ul>
<h3 data-id="heading-12">è‡ªå®šä¹‰å…‰ç…§æ¨¡å‹å¼€å‘</h3>
<p>åœ¨å¼€å‘è‡ªå®šä¹‰å…‰ç…§æ¨¡å‹æ—¶ï¼Œæ­£ç¡®ç®¡ç†é¢œè‰²ç©ºé—´æ˜¯ä¿è¯å…‰ç…§è®¡ç®—å‡†ç¡®æ€§çš„å…³é”®ï¼š</p>
<ul>
<li>å…‰ç…§è®¡ç®—åœ¨çº¿æ€§ç©ºé—´ä¸­æ‰§è¡Œï¼Œç¬¦åˆç‰©ç†è§„å¾‹</li>
<li>ä½¿ç”¨LinearToGammaSpaceExactå°†æœ€ç»ˆå…‰ç…§ç»“æœè½¬æ¢åˆ°æ˜¾ç¤ºç©ºé—´</li>
<li>ç¡®ä¿å…‰ç…§çš„äº®åº¦å’Œé¢œè‰²å…³ç³»åœ¨æ˜¾ç¤ºæ—¶ä¿æŒæ­£ç¡®</li>
</ul>
<p>ç‰¹åˆ«æ˜¯åœ¨å®ç°å¤æ‚çš„PBRæè´¨æ—¶ï¼Œé¢œè‰²ç©ºé—´çš„æ­£ç¡®è½¬æ¢å¯¹äºé‡‘å±åº¦ã€ç²—ç³™åº¦ç­‰å‚æ•°çš„å‡†ç¡®è¡¨ç°å°¤ä¸ºé‡è¦ã€‚</p>
<h2 data-id="heading-13">ä½¿ç”¨ç¤ºä¾‹ä¸æ¡ˆä¾‹åˆ†æ</h2>
<h3 data-id="heading-14">åŸºç¡€é¢œè‰²ç©ºé—´è½¬æ¢</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Shader Graphè®¾ç½®ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨LinearToGammaSpaceExactèŠ‚ç‚¹è¿›è¡ŒåŸºæœ¬çš„é¢œè‰²ç©ºé—´è½¬æ¢ï¼š</p>
<ul>
<li>åˆ›å»ºColorèŠ‚ç‚¹ä½œä¸ºçº¿æ€§ç©ºé—´çš„é¢œè‰²è¾“å…¥</li>
<li>å°†ColorèŠ‚ç‚¹è¿æ¥åˆ°LinearToGammaSpaceExactèŠ‚ç‚¹çš„Inç«¯å£</li>
<li>å°†LinearToGammaSpaceExactèŠ‚ç‚¹çš„Outç«¯å£è¿æ¥åˆ°ä¸»èŠ‚ç‚¹çš„Base Colorè¾“å…¥</li>
<li>é€šè¿‡è°ƒèŠ‚è¾“å…¥é¢œè‰²ï¼Œè§‚å¯Ÿè½¬æ¢å‰åé¢œè‰²çš„å˜åŒ–</li>
</ul>
<p>è¿™ç§åŸºç¡€è®¾ç½®å¯ä»¥å¸®åŠ©ç†è§£çº¿æ€§ç©ºé—´ä¸ä¼½é©¬ç©ºé—´ä¹‹é—´é¢œè‰²è¡¨ç°çš„å·®å¼‚ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸­ç­‰äº®åº¦åŒºåŸŸï¼Œå·®å¼‚æœ€ä¸ºæ˜æ˜¾ã€‚</p>
<h3 data-id="heading-15">HDRé¢œè‰²å¤„ç†æ¡ˆä¾‹</h3>
<p>åœ¨å¤„ç†é«˜åŠ¨æ€èŒƒå›´é¢œè‰²æ—¶ï¼ŒLinearToGammaSpaceExactèŠ‚ç‚¹çš„è¡Œä¸ºå€¼å¾—ç‰¹åˆ«å…³æ³¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å‡è®¾åœ¨çº¿æ€§ç©ºé—´ä¸­æœ‰ä»¥ä¸‹HDRé¢œè‰²å€¼</span>
float3 linearColor = <span class="hljs-built_in">float3</span>(<span class="hljs-number">2.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.5</span>);

<span class="hljs-comment">// åº”ç”¨LinearToGammaSpaceExactè½¬æ¢</span>
float3 gammaColor = <span class="hljs-built_in">LinearToGammaSpaceExact</span>(linearColor);

<span class="hljs-comment">// ç»“æœä¼šä¿æŒç›¸å¯¹çš„äº®åº¦å…³ç³»</span>
<span class="hljs-comment">// ä½†æ•°å€¼å¯èƒ½è¶…å‡ºæ ‡å‡†[0,1]èŒƒå›´</span>
</code></pre>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šåœ¨ä¼½é©¬è½¬æ¢å‰å…ˆè¿›è¡Œè‰²è°ƒæ˜ å°„ï¼Œå°†HDRå€¼å‹ç¼©åˆ°æ˜¾ç¤ºè®¾å¤‡èƒ½å¤Ÿå¤„ç†çš„èŒƒå›´å†…ã€‚</p>
<h3 data-id="heading-16">è‡ªå®šä¹‰åå¤„ç†æ•ˆæœå®ç°</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°ç®€å•é¢œè‰²åˆ†çº§æ•ˆæœçš„Shader Graphç¤ºä¾‹ï¼š</p>
<ul>
<li>ä½¿ç”¨Scene ColorèŠ‚ç‚¹è·å–å½“å‰æ¸²æŸ“çš„çº¿æ€§ç©ºé—´é¢œè‰²</li>
<li>åº”ç”¨é¢œè‰²è°ƒæ•´èŠ‚ç‚¹ï¼ˆå¦‚å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ã€è‰²ç›¸è°ƒæ•´ï¼‰</li>
<li>æ‰€æœ‰è°ƒæ•´åœ¨çº¿æ€§ç©ºé—´ä¸­æ‰§è¡Œï¼Œä¿è¯è®¡ç®—å‡†ç¡®æ€§</li>
<li>ä½¿ç”¨LinearToGammaSpaceExactèŠ‚ç‚¹å°†ç»“æœè½¬æ¢åˆ°ä¼½é©¬ç©ºé—´</li>
<li>è¾“å‡ºåˆ°Blitå‘½ä»¤æˆ–åå¤„ç†å †æ ˆ</li>
</ul>
<p>è¿™ç§æ–¹æ³•ç¡®ä¿äº†é¢œè‰²è°ƒæ•´çš„ç‰©ç†å‡†ç¡®æ€§ï¼Œé¿å…äº†åœ¨ä¼½é©¬ç©ºé—´ä¸­è¿›è¡Œè°ƒæ•´å¯èƒ½å¼•å…¥çš„æ•°å­¦é”™è¯¯ã€‚</p>
<h2 data-id="heading-17">æ€§èƒ½è€ƒé‡ä¸ä¼˜åŒ–å»ºè®®</h2>
<h3 data-id="heading-18">è®¡ç®—å¼€é”€åˆ†æ</h3>
<p>LinearToGammaSpaceExactèŠ‚ç‚¹çš„è®¡ç®—å¼€é”€ä¸»è¦æ¥è‡ªå¹‚å‡½æ•°è®¡ç®—å’Œæ¡ä»¶åˆ¤æ–­ã€‚è™½ç„¶å•ä¸ªèŠ‚ç‚¹çš„å¼€é”€ä¸å¤§ï¼Œä½†åœ¨åƒç´ ç€è‰²å™¨ä¸­å¤§é‡ä½¿ç”¨æ—¶ä»éœ€æ³¨æ„ï¼š</p>
<ul>
<li>æ¯ä¸ªåƒç´ è‡³å°‘éœ€è¦æ‰§è¡Œä¸€æ¬¡æ¡ä»¶åˆ¤æ–­å’Œä¸€æ¬¡å¹‚è¿ç®—</li>
<li>åœ¨é«˜åˆ†è¾¨ç‡æ¸²æŸ“ä¸­ï¼Œè¿™äº›æ“ä½œä¼šç´¯ç§¯æˆå¯è§‚çš„è®¡ç®—é‡</li>
<li>åœ¨ç§»åŠ¨å¹³å°æˆ–æ€§èƒ½å—é™çš„ç¯å¢ƒä¸­åº”è°¨æ…ä½¿ç”¨</li>
</ul>
<h3 data-id="heading-19">ä¼˜åŒ–ç­–ç•¥</h3>
<p>é’ˆå¯¹æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<ul>
<li>åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è¿›è¡Œè½¬æ¢ï¼šå¦‚æœé¢œè‰²æ•°æ®åœ¨é¡¶ç‚¹é—´å˜åŒ–ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¶ç‚¹é˜¶æ®µè¿›è¡Œè½¬æ¢</li>
<li>ä½¿ç”¨è¿‘ä¼¼ç‰ˆæœ¬ï¼šåœ¨è§†è§‰è¦æ±‚ä¸é«˜çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨LinearToGammaSpaceæ›¿ä»£Exactç‰ˆæœ¬</li>
<li>æ‰¹é‡å¤„ç†ï¼šå°†å¤šä¸ªé¢œè‰²é€šé“çš„è½¬æ¢åˆå¹¶å¤„ç†ï¼Œå‡å°‘æ¡ä»¶åˆ¤æ–­æ¬¡æ•°</li>
<li>LUTä¼˜åŒ–ï¼šå¯¹äºå›ºå®šçš„é¢œè‰²è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨æŸ¥æ‰¾è¡¨æ›¿ä»£å®æ—¶è®¡ç®—</li>
</ul>
<h3 data-id="heading-20">å¹³å°ç‰¹å¼‚æ€§è€ƒè™‘</h3>
<p>ä¸åŒç¡¬ä»¶å¹³å°å¯¹è¶…è¶Šå‡½æ•°ï¼ˆå¦‚å¹‚è¿ç®—ï¼‰çš„æ”¯æŒç¨‹åº¦ä¸åŒï¼š</p>
<ul>
<li>ç°ä»£æ¡Œé¢GPUé€šå¸¸æœ‰ä¸“é—¨çš„ç¡¬ä»¶å•å…ƒå¤„ç†è¿™ç±»è¿ç®—ï¼Œæ•ˆç‡è¾ƒé«˜</li>
<li>ç§»åŠ¨GPUå¯èƒ½é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿï¼Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</li>
<li>åœ¨é’ˆå¯¹å¤šå¹³å°å¼€å‘æ—¶ï¼Œåº”æµ‹è¯•ç›®æ ‡å¹³å°çš„æ€§èƒ½è¡¨ç°</li>
</ul>
<h2 data-id="heading-21">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-22">é¢œè‰²æ˜¾ç¤ºä¸ä¸€è‡´é—®é¢˜</h3>
<p>åœ¨ä½¿ç”¨LinearToGammaSpaceExactèŠ‚ç‚¹æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°é¢œè‰²æ˜¾ç¤ºä¸ä¸€è‡´çš„é—®é¢˜ï¼š</p>
<ul>
<li>é—®é¢˜è¡¨ç°ï¼šåœ¨ä¸åŒè®¾å¤‡æˆ–ä¸åŒæŸ¥çœ‹æ¡ä»¶ä¸‹é¢œè‰²æ˜¾ç¤ºæœ‰å·®å¼‚</li>
<li>å¯èƒ½åŸå› ï¼šé¢œè‰²ç©ºé—´é…ç½®é”™è¯¯ã€æ˜¾ç¤ºå™¨æ ¡å‡†ä¸ä¸€è‡´ã€å›¾åƒæ ¼å¼ä¸åŒ¹é…</li>
<li>è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æ•´ä¸ªæ¸²æŸ“ç®¡çº¿é¢œè‰²ç©ºé—´è®¾ç½®ä¸€è‡´ï¼Œä½¿ç”¨æ ‡å‡†é¢œè‰²é…ç½®æ–‡ä»¶ï¼Œå®šæœŸæ ¡å‡†æ˜¾ç¤ºè®¾å¤‡</li>
</ul>
<h3 data-id="heading-23">æ€§èƒ½ç“¶é¢ˆè¯†åˆ«ä¸è§£å†³</h3>
<p>å¦‚æœå‘ç°ä½¿ç”¨LinearToGammaSpaceExactèŠ‚ç‚¹åæ€§èƒ½ä¸‹é™ï¼š</p>
<ul>
<li>ä½¿ç”¨Unity Profileråˆ†æç€è‰²å™¨æ‰§è¡Œæ—¶é—´</li>
<li>æ£€æŸ¥æ˜¯å¦åœ¨ä¸éœ€è¦ç²¾ç¡®è½¬æ¢çš„åœ°æ–¹ä½¿ç”¨äº†Exactç‰ˆæœ¬</li>
<li>è€ƒè™‘å°†è½¬æ¢ç§»åˆ°æ¸²æŸ“ç®¡çº¿çš„åæœŸé˜¶æ®µï¼Œå‡å°‘é‡å¤è®¡ç®—</li>
<li>è¯„ä¼°æ˜¯å¦å¯ä»¥ä½¿ç”¨æ›´ç®€åŒ–çš„é¢œè‰²ç©ºé—´å¤„ç†æ–¹æ¡ˆ</li>
</ul>
<h3 data-id="heading-24">HDRä¸LDRå·¥ä½œæµåˆ‡æ¢</h3>
<p>åœ¨HDRå’ŒLDRæ¸²æŸ“ç®¡çº¿ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œé¢œè‰²ç©ºé—´å¤„ç†éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p>
<ul>
<li>HDRç®¡çº¿é€šå¸¸åœ¨çº¿æ€§ç©ºé—´ä¸­å¤„ç†æ›´å¤šè®¡ç®—</li>
<li>LDRç®¡çº¿å¯èƒ½æ··åˆä½¿ç”¨çº¿æ€§å’Œä¼½é©¬ç©ºé—´</li>
<li>ä½¿ç”¨LinearToGammaSpaceExactèŠ‚ç‚¹æ—¶åº”æ˜ç¡®å½“å‰çš„é¢œè‰²ç©ºé—´çŠ¶æ€</li>
<li>å»ºç«‹ç»Ÿä¸€çš„é¢œè‰²ç©ºé—´ç®¡ç†ç­–ç•¥ï¼Œç¡®ä¿åœ¨ä¸åŒç®¡çº¿é—´çš„ä¸€è‡´æ€§</li>
</ul>
<h2 data-id="heading-25">æœ€ä½³å®è·µæ€»ç»“</h2>
<p>æ­£ç¡®ä½¿ç”¨LinearToGammaSpaceExactèŠ‚ç‚¹éœ€è¦éµå¾ªä¸€ç³»åˆ—æœ€ä½³å®è·µï¼š</p>
<ul>
<li>å§‹ç»ˆäº†è§£æ•°æ®å½“å‰æ‰€å¤„çš„é¢œè‰²ç©ºé—´ï¼Œåœ¨çº¿æ€§ç©ºé—´ä¸­è¿›è¡Œå…‰ç…§å’Œé¢œè‰²è®¡ç®—</li>
<li>ä»…åœ¨æœ€ç»ˆè¾“å‡ºåˆ°å±å¹•æˆ–éæµ®ç‚¹æ ¼å¼çº¹ç†æ—¶è¿›è¡Œä¼½é©¬è½¬æ¢</li>
<li>åœ¨éœ€è¦æœ€é«˜é¢œè‰²å‡†ç¡®æ€§çš„åœºæ™¯ä¸­ä½¿ç”¨Exactç‰ˆæœ¬ï¼Œå…¶ä»–æƒ…å†µå¯è€ƒè™‘ä½¿ç”¨è¿‘ä¼¼ç‰ˆæœ¬</li>
<li>å»ºç«‹é¡¹ç›®ç»Ÿä¸€çš„é¢œè‰²ç©ºé—´ç®¡ç†è§„èŒƒï¼Œé¿å…æ··ä¹±çš„é¢œè‰²ç©ºé—´ä½¿ç”¨</li>
<li>å®šæœŸæµ‹è¯•åœ¨ä¸åŒæ˜¾ç¤ºè®¾å¤‡ä¸Šçš„é¢œè‰²è¡¨ç°ï¼Œç¡®ä¿ä¸€è‡´æ€§</li>
<li>æ–‡æ¡£åŒ–é¢œè‰²ç©ºé—´å†³ç­–ï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œåç»­ç»´æŠ¤</li>
</ul>
<p>é€šè¿‡éµå¾ªè¿™äº›å®è·µåŸåˆ™ï¼Œå¯ä»¥ç¡®ä¿æ¸²æŸ“ç»“æœçš„è§†è§‰å‡†ç¡®æ€§ï¼ŒåŒæ—¶åœ¨æ€§èƒ½å’Œç”»è´¨ä¹‹é—´å–å¾—è‰¯å¥½å¹³è¡¡ã€‚LinearToGammaSpaceExactèŠ‚ç‚¹ä½œä¸ºé¢œè‰²ç®¡ç†å·¥å…·ç®±ä¸­çš„é‡è¦ç»„ä»¶ï¼Œåœ¨æ­£ç¡®çš„ä½¿ç”¨åœºæ™¯ä¸‹èƒ½å¤Ÿæ˜¾è‘—æå‡æ¸²æŸ“è´¨é‡ã€‚</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong>
ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[15 Go Eino AIåº”ç”¨å¼€å‘å®æˆ˜ | æ€§èƒ½ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7585468725332475958</link>    <guid>https://juejin.cn/post/7585468725332475958</guid>    <pubDate>2025-12-20T09:57:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585468725332475958" data-draft-id="7585474459776450596" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="15 Go Eino AIåº”ç”¨å¼€å‘å®æˆ˜ | æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Go"/> <meta itemprop="datePublished" content="2025-12-20T09:57:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹ä¸­é˜³è®²AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2189882892232029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            15 Go Eino AIåº”ç”¨å¼€å‘å®æˆ˜ | æ€§èƒ½ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2189882892232029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹ä¸­é˜³è®²AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T09:57:57.000Z" title="Sat Dec 20 2025 09:57:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,æ€æºé»‘ä½“ CN,æ€æºé»‘ä½“,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><blockquote>
<p>å£°æ˜ï¼šæœ¬AIåº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹é¦–å‘åœ¨åŒåå…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F5DYsyMKh9cDJdVvs_Mn9_Q" target="_blank" title="https://mp.weixin.qq.com/s/5DYsyMKh9cDJdVvs_Mn9_Q" ref="nofollow noopener noreferrer">ç‹ä¸­é˜³</a>ï¼Œæœªç»æˆæƒç¦æ­¢è½¬è½½ã€‚</p>
</blockquote>
<p>Go-Eino Interview Agent å¹³å°çš„æ€§èƒ½ä¼˜åŒ–ä¸“æ³¨äºå®ç°é«˜ååé‡ã€ä½å»¶è¿Ÿå’Œé«˜æ•ˆèµ„æºåˆ©ç”¨ï¼Œæ¶µç›–æ•°æ®åº“è¿æ¥ã€ç¼“å­˜ç­–ç•¥ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå‘é‡æœç´¢æ“ä½œã€‚è¿™ç§ç»¼åˆæ–¹æ³•ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†å¹¶å‘é¢è¯•ä¼šè¯ï¼ŒåŒæ—¶ä¿æŒå“åº”å¼ AI äº¤äº’ã€‚</p>
<h2 data-id="heading-0">æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–</h2>
<p>æ•°æ®åº“å±‚é‡‡ç”¨å¤æ‚çš„è¿æ¥æ± æŠ€æœ¯æ¥é«˜æ•ˆç®¡ç† MySQL è¿æ¥ã€‚ç³»ç»Ÿä½¿ç”¨ GORM é…åˆä¼˜åŒ–çš„è¿æ¥å‚æ•°ï¼Œå¹³è¡¡èµ„æºä½¿ç”¨ä¸æ€§èƒ½éœ€æ±‚ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ¥è‡ª database.go çš„è¿æ¥æ± é…ç½®</span>
sqlDB.SetMaxIdleConns(dbConfig.MaxIdleConns)
sqlDB.SetMaxOpenConns(dbConfig.MaxOpenConns)
<span class="hljs-keyword">if</span> dbConfig.ConnMaxLifetime != <span class="hljs-string">""</span> {
    connMaxLifetime, err := time.ParseDuration(dbConfig.ConnMaxLifetime)
    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
        sqlDB.SetConnMaxLifetime(connMaxLifetime)
    }
}
</code></pre>
<p>è¯¥é…ç½®æ”¯æŒé€šè¿‡ YAML é…ç½®æ–‡ä»¶åŠ¨æ€è°ƒæ•´è¿æ¥æ± å‚æ•°ï¼Œå…è®¸åŸºäºç”Ÿäº§å·¥ä½œè´Ÿè½½æ¨¡å¼è¿›è¡Œå¾®è°ƒã€‚ç³»ç»Ÿç»´æŠ¤å…¨å±€æ•°æ®åº“å®ä¾‹ï¼Œåœ¨æ‰€æœ‰æœåŠ¡ç»„ä»¶é—´å¤ç”¨è¿æ¥ï¼Œæœ€å°åŒ–è¿æ¥å¼€é”€ã€‚</p>
<blockquote>
<p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼šåº”æ ¹æ®å®é™…æ•°æ®åº“æŒ‡æ ‡ç›‘æ§å¹¶è°ƒæ•´è¿æ¥æ± å‚æ•°ã€‚åœ¨å…¸å‹é¢è¯•å·¥ä½œè´Ÿè½½ä¸‹ï¼Œå°† <code>MaxIdleConns</code> è®¾ç½®ä¸º <code>MaxOpenConns</code> çš„ 20-30% å¯è·å¾—æœ€ä½³æ€§èƒ½ã€‚</p>
</blockquote>
<h2 data-id="heading-1">Redis ç¼“å­˜ç­–ç•¥</h2>
<p>Redis ä½œä¸ºç¼“å­˜å±‚å’Œæ¶ˆæ¯é˜Ÿåˆ—åŸºç¡€è®¾æ–½ï¼Œä¸ºé¢‘ç¹è®¿é—®çš„æ•°æ®æä¾›äºšæ¯«ç§’çº§è®¿é—®ã€‚ç¼“å­˜å®ç°ä¸“æ³¨äºä¼šè¯ç®¡ç†ã€é¢è¯•çŠ¶æ€æŒä¹…åŒ–å’Œ AI ç”Ÿæˆå†…å®¹çš„ä¸´æ—¶å­˜å‚¨ã€‚</p>
<p><strong>æ¥æº</strong>ï¼šredis.go</p>
<p>Redis å®¢æˆ·ç«¯é…ç½®é€šè¿‡åº•å±‚ go-redis åº“æ”¯æŒè¿æ¥æ± ï¼Œå…·æœ‰è‡ªåŠ¨è¿æ¥å¤ç”¨å’Œæ•…éšœè½¬ç§»å¤„ç†åŠŸèƒ½ã€‚ç¼“å­˜å±‚å®ç°äº†ç®€å•çš„é”®å€¼æ¥å£ï¼Œæ”¯æŒå¯é…ç½®çš„è¿‡æœŸæ—¶é—´ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ”¯æŒä¸Šä¸‹æ–‡çš„ç¼“å­˜æ“ä½œ</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SetCache</span><span class="hljs-params">(ctx context.Context, key <span class="hljs-type">string</span>, value <span class="hljs-keyword">interface</span>{}, expiration <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> RedisClient.Set(ctx, key, value, <span class="hljs-number">0</span>).Err()
}
</code></pre>
<p>ç³»ç»Ÿåˆ©ç”¨ Redis pub/sub åŠŸèƒ½åœ¨é¢è¯•ç»„ä»¶é—´å®æ—¶åˆ†å‘æ¶ˆæ¯ï¼Œå½“é¢è¯•çŠ¶æ€å˜åŒ–æ—¶èƒ½å¤Ÿç«‹å³æ›´æ–°è¿æ¥çš„å®¢æˆ·ç«¯ã€‚</p>
<h2 data-id="heading-2">æ¶ˆæ¯é˜Ÿåˆ—æ€§èƒ½</h2>
<p>åŸºäº Redis çš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°ä¸ºè®¡ç®—å¯†é›†å‹æ“ä½œï¼ˆå¦‚ AI æ¨¡å‹æ¨ç†å’Œè¯„ä¼°æŠ¥å‘Šç”Ÿæˆï¼‰æä¾›å¼‚æ­¥å¤„ç†èƒ½åŠ›ã€‚é˜Ÿåˆ—æ¶æ„ç¡®ä¿éé˜»å¡è¯·æ±‚å¤„ç†ï¼ŒåŒæ—¶ç»´æŠ¤æ¶ˆæ¯é¡ºåºå’Œäº¤ä»˜ä¿è¯ã€‚</p>
<p><strong>æ¥æº</strong>ï¼šredis_queue.go</p>
<p>é˜Ÿåˆ—ç³»ç»Ÿå®ç°äº†åŸºäº goroutine çš„å¤„ç†å™¨çš„å¹¶å‘æ¶ˆæ¯å¤„ç†ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å¹¶å‘æ¶ˆæ¯å¤„ç†</span>
<span class="hljs-keyword">for</span> _, h := <span class="hljs-keyword">range</span> handlers {
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(handler MessageHandler, m *Message)</span></span> {
        <span class="hljs-keyword">if</span> err := handler(ctx, m); err != <span class="hljs-literal">nil</span> {
            log.Printf(<span class="hljs-string">"[RedisQueue] Error processing message: %v, type: %s"</span>, err, m.Type)
        }
    }(h, &amp;message)
}
</code></pre>
<p>åŸºäºé€šé“çš„æ¶ˆæ¯è·¯ç”±ç¡®ä¿æ ¹æ®æ¶ˆæ¯ç±»å‹é«˜æ•ˆåˆ†å‘åˆ°ç›¸åº”å¤„ç†å™¨ï¼Œè€Œ pub/sub æœºåˆ¶ä¸ºè®¢é˜…ç»„ä»¶æä¾›å®æ—¶äº¤ä»˜ã€‚</p>
<h2 data-id="heading-3">å‘é‡æœç´¢ä¼˜åŒ–</h2>
<p>Milvus å‘é‡æ•°æ®åº“é›†æˆå®ç°äº†é’ˆå¯¹ç®€å†åŒ¹é…å’Œé—®é¢˜æ£€ç´¢çš„ä¼˜åŒ–ç›¸ä¼¼æ€§æœç´¢ã€‚ç³»ç»Ÿä¸“æ³¨äºæœ€å°åŒ–æŸ¥è¯¢å»¶è¿Ÿï¼ŒåŒæ—¶ä¿æŒé¢è¯•ç›¸å…³å†…å®¹çš„é«˜å¬å›ç‡ã€‚</p>
<p><strong>æ¥æº</strong>ï¼šmilvus_retriever_tool.go</p>
<p>å‘é‡æœç´¢å·¥ä½œæµç¨‹åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æŸ¥è¯¢é¢„å¤„ç†</strong>ï¼šè¾“å…¥éªŒè¯å’ŒåµŒå…¥ç”Ÿæˆ</li>
<li><strong>ç´¢å¼•é€‰æ‹©</strong>ï¼šåŸºäºæ•°æ®ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç´¢å¼•</li>
<li><strong>ç›¸ä¼¼æ€§æœç´¢</strong>ï¼šé«˜æ•ˆ ANNï¼ˆè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰æœç´¢ï¼Œæ”¯æŒå¯é…ç½®çš„ top-k ç»“æœ</li>
<li><strong>ç»“æœæ ¼å¼åŒ–</strong>ï¼šåŒ…å«ç›¸ä¼¼åº¦åˆ†æ•°å’Œå…ƒæ•°æ®çš„ç»“æ„åŒ–è¾“å‡º</li>
</ol>
<p>æ£€ç´¢å™¨æœåŠ¡å®ç°äº†è¿æ¥æ± å’ŒæŸ¥è¯¢æ‰¹å¤„ç†ï¼Œä»¥åœ¨é¢è¯•é«˜å³°æœŸæœ€å¤§åŒ–ååé‡ã€‚</p>
<h2 data-id="heading-4">æ¨¡å‹ç®¡ç†æ€§èƒ½</h2>
<p>é™æ€æ¨¡å‹ç®¡ç†å™¨å®ç°äº† AI æ¨¡å‹é…ç½®çš„é«˜æ•ˆå†…å­˜ç¼“å­˜ï¼Œå…·æœ‰ O(1) æŸ¥æ‰¾æ€§èƒ½ã€‚ç³»ç»Ÿä½¿ç”¨è¯»å†™äº’æ–¥é”ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ—¶æœ€å°åŒ–é”äº‰ç”¨ã€‚</p>
<p><strong>æ¥æº</strong>ï¼šmanager_impl.go</p>
<p>æ¨¡å‹ç®¡ç†æ¶æ„æ”¯æŒï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ”¯æŒæ˜ å°„ä¼˜åŒ–çš„çº¿ç¨‹å®‰å…¨æ¨¡å‹æŸ¥æ‰¾</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *staticManager)</span></span> Get(ctx context.Context, id <span class="hljs-type">int64</span>) (*InternalModel, <span class="hljs-type">error</span>) {
    s.mu.RLock()
    <span class="hljs-keyword">defer</span> s.mu.RUnlock()
    
    <span class="hljs-keyword">if</span> m, ok := s.mapping[id]; ok {
        <span class="hljs-keyword">return</span> m, <span class="hljs-literal">nil</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>æ‰¹é‡æ“ä½œï¼ˆMGetï¼‰é€šè¿‡å•æ¬¡æ“ä½œæ£€ç´¢å¤šä¸ªæ¨¡å‹æ¥æœ€å°åŒ–æ•°æ®åº“å¾€è¿”ï¼Œè€Œ list å‡½æ•°æ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<h2 data-id="heading-5">å†…å­˜ç®¡ç†å’Œå¹¶å‘</h2>
<p>ç³»ç»Ÿé‡‡ç”¨å¤šç§å†…å­˜ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<ul>
<li><strong>å¯¹è±¡æ± </strong>ï¼šå¤ç”¨é¢‘ç¹åˆ†é…çš„å¯¹è±¡ä»¥å‡å°‘ GC å‹åŠ›</li>
<li><strong>æµå¼å¤„ç†</strong>ï¼šåˆ†å—å¤„ç†å¤§å‹æ–‡æ¡£ä»¥æœ€å°åŒ–å†…å­˜ä½¿ç”¨</li>
<li><strong>Goroutine ç®¡ç†</strong>ï¼šæ§åˆ¶ goroutine ç”Ÿå‘½å‘¨æœŸä»¥é˜²æ­¢èµ„æºæ³„æ¼</li>
<li><strong>ç¼“å†²åŒºç®¡ç†</strong>ï¼šä¸º I/O æ“ä½œä½¿ç”¨å¤§å°åˆé€‚çš„ç¼“å†²åŒºä»¥å¹³è¡¡å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½</li>
</ul>
<p>å¹¶å‘æ¶æ„ä½¿ç”¨ <code>sync.RWMutex</code> å¤„ç†è¯»å¯†é›†å‹æ“ä½œï¼ˆå¦‚æ¨¡å‹æŸ¥æ‰¾ï¼‰ï¼Œä½¿ç”¨ <code>sync.Mutex</code> å¤„ç†å†™æ“ä½œï¼Œç¡®ä¿åœ¨æ··åˆè¯»å†™å·¥ä½œè´Ÿè½½ä¸‹çš„æœ€ä½³æ€§èƒ½ã€‚</p>
<h2 data-id="heading-6">æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡</h2>
<p>è™½ç„¶åŸºç¡€åŸºç¡€è®¾æ–½å·²å°±ä½ï¼Œä½†ç”Ÿäº§ç¯å¢ƒåº”å®æ–½å…¨é¢çš„æ€§èƒ½ç›‘æ§ï¼š</p>
<ol>
<li>æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿå’Œè¿æ¥æ± æŒ‡æ ‡</li>
<li>Redis ç¼“å­˜å‘½ä¸­ç‡å’Œå†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ååé‡å’Œå¤„ç†å»¶è¿Ÿ</li>
<li>å‘é‡æœç´¢æŸ¥è¯¢æ—¶é—´å’Œå‡†ç¡®æ€§æŒ‡æ ‡</li>
<li>AI æ¨¡å‹æ¨ç†å»¶è¿Ÿå’Œèµ„æºåˆ©ç”¨ç‡</li>
</ol>
<p>å®æ–½å¸¦æœ‰å…³è” ID çš„ç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼Œä»¥è¿½è¸ªé¢è¯•å¤„ç†ç®¡é“ä¸­çš„æ€§èƒ½ç“¶é¢ˆã€‚è¿™æœ‰åŠ©äºå¯¹ç«¯åˆ°ç«¯å»¶è¿Ÿè¿›è¡Œè¯¦ç»†åˆ†æã€‚</p>
<h2 data-id="heading-7">ä¼˜åŒ–å»ºè®®</h2>
<p>åŸºäºå½“å‰æ¶æ„ï¼Œè€ƒè™‘ä»¥ä¸‹æ€§èƒ½å¢å¼ºæªæ–½ï¼š</p>
<ol>
<li><strong>æ•°æ®åº“ç´¢å¼•</strong>ï¼šä¸ºé¢è¯•è®°å½•å’Œç”¨æˆ·ä¼šè¯ä¸­çš„é¢‘ç¹æŸ¥è¯¢æ¨¡å¼æ·»åŠ å¤åˆç´¢å¼•</li>
<li><strong>ç¼“å­˜é¢„çƒ­</strong>ï¼šå°†é¢‘ç¹è®¿é—®çš„é¢è¯•æ¨¡æ¿å’Œé—®é¢˜é›†é¢„åŠ è½½åˆ° Redis ç¼“å­˜ä¸­</li>
<li><strong>è¿æ¥æ± è°ƒä¼˜</strong>ï¼šæ ¹æ®å¹¶å‘ç”¨æˆ·æŒ‡æ ‡è°ƒæ•´æ•°æ®åº“å’Œ Redis è¿æ¥æ± </li>
<li><strong>æ‰¹å¤„ç†</strong>ï¼šä¸º AI æ¨¡å‹æ¨ç†å®ç°æ‰¹å¤„ç†æ“ä½œä»¥æé«˜ GPU åˆ©ç”¨ç‡</li>
<li><strong>CDN é›†æˆ</strong>ï¼šé€šè¿‡ CDN æä¾›é™æ€èµ„æºå’Œç¼“å­˜å“åº”ä»¥å‡å°‘å»¶è¿Ÿ</li>
</ol>
<p>æ€§èƒ½ä¼˜åŒ–åŸºç¡€ä¸ºå¤„ç†ä¸æ–­å¢é•¿çš„é¢è¯•å·¥ä½œè´Ÿè½½æä¾›äº†å¯æ‰©å±•çš„åŸºç¡€ï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿå“åº”æ€§å’Œå¯é æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸‰ç§ä¾èµ–æ³¨å…¥è¯¦è§£]]></title>    <link>https://juejin.cn/post/7585463195201519666</link>    <guid>https://juejin.cn/post/7585463195201519666</guid>    <pubDate>2025-12-20T10:05:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463195201519666" data-draft-id="7585463258690977801" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸‰ç§ä¾èµ–æ³¨å…¥è¯¦è§£"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-20T10:05:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="L0CK"/> <meta itemprop="url" content="https://juejin.cn/user/3555195572989993"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸‰ç§ä¾èµ–æ³¨å…¥è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3555195572989993/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    L0CK
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T10:05:03.000Z" title="Sat Dec 20 2025 10:05:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Spring æ¡†æ¶ä¸­ï¼Œå°†ä¸€ä¸ª Bean æ³¨å…¥åˆ°å¦ä¸€ä¸ª Bean é‡Œï¼Œä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. å±æ€§æ³¨å…¥ (Field Injection)</h2>
<p>è¿™æ˜¯åˆå­¦é˜¶æ®µå’Œå„ç§æ•™ç¨‹ä¸­æœ€å¸¸è§çš„æ–¹å¼ã€‚ç›´æ¥åœ¨æˆå‘˜å˜é‡ä¸ŠåŠ  <code>@Autowired</code>ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Java</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-meta">@Autowired</span> <span class="hljs-comment">// æ ¸å¿ƒåŠ¨ä½œï¼šç›´æ¥åœ¨å±æ€§ä¸Šç‚¹å</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserService</span> userService;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">list</span>(<span class="hljs-params"/>) {
        userService.<span class="hljs-title function_">findAll</span>();
    }
}
</code></pre>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šä»£ç æœ€ç®€æ´ï¼Œçœ‹èµ·æ¥éå¸¸å¹²å‡€ã€‚</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><strong>éš¾ä»¥è„±ç¦»å®¹å™¨ä½¿ç”¨</strong>ï¼šå¦‚æœä½ æƒ³åœ¨æ²¡æœ‰ Spring ç¯å¢ƒçš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚å†™çº¯ Java çš„å•å…ƒæµ‹è¯•ï¼‰æ‰‹åŠ¨ new è¿™ä¸ªå¯¹è±¡ï¼Œä½ æ²¡æ³•ç»™ <code>userService</code> èµ‹å€¼ã€‚</li>
<li><strong>å®¹æ˜“å¾ªç¯ä¾èµ–</strong>ï¼šå¦‚æœ A æ³¨å…¥ Bï¼ŒB åˆæ³¨å…¥ Aï¼Œè¿™ç§æ–¹å¼æœ‰æ—¶ä¼šæ©ç›–ä»£ç è®¾è®¡çš„ç¼ºé™·ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. Setter æ–¹æ³•æ³¨å…¥ (Setter Injection)</h2>
<p>é€šè¿‡ç±»çš„ Setter æ–¹æ³•æ¥å®Œæˆæ³¨å…¥ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Java</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserService</span> userService;

    <span class="hljs-meta">@Autowired</span> <span class="hljs-comment">// æ ¸å¿ƒåŠ¨ä½œï¼šåœ¨ Setter æ–¹æ³•ä¸Šç‚¹å</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUserService</span>(<span class="hljs-params">UserService userService</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span> = userService;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">list</span>(<span class="hljs-params"/>) {
        userService.<span class="hljs-title function_">findAll</span>();
    }
}
</code></pre>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºåé‡æ–°ä¿®æ”¹æ³¨å…¥çš„å®ä¾‹ã€‚</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><strong>å®‰å…¨æ€§è¾ƒä½</strong>ï¼šå¯¹è±¡åœ¨è¢«è°ƒç”¨æ—¶ï¼Œå¯èƒ½è¿˜æ²¡æœ‰è¢«æ³¨å…¥ï¼ˆæ¯”å¦‚æœ‰äººä¸å°å¿ƒæ”¹äº†å€¼ï¼‰ï¼Œå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</li>
<li><strong>ä»£ç å†—é•¿</strong>ï¼šæ¯ä¸ªå±æ€§éƒ½è¦å†™ä¸€å¥— Setterã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">3. æ„é€ å™¨æ³¨å…¥ (Constructor Injection) â€”â€” <strong>å®˜æ–¹æ¨è</strong></h2>
<p>é€šè¿‡ç±»çš„æ„é€ æ–¹æ³•æ¥å®Œæˆæ³¨å…¥ã€‚è¿™æ˜¯ Spring å®˜æ–¹ç›®å‰æœ€æ¨èçš„æ–¹å¼ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>Java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService; <span class="hljs-comment">// ç”šè‡³å¯ä»¥åŠ  finalï¼Œä¿è¯ä¸å¯å˜</span>

    <span class="hljs-comment">// æ ¸å¿ƒåŠ¨ä½œï¼šåœ¨æ„é€ å‡½æ•°ä¸Šæ³¨å…¥ï¼ˆSpring 4.3åï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œ@Autowiredå¯çœç•¥ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserController</span><span class="hljs-params">(UserService userService)</span> {
        <span class="hljs-built_in">this</span>.userService = userService;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">list</span><span class="hljs-params">()</span> {
        userService.findAll();
    }
}
</code></pre>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>ä¿è¯ä¸ä¸ºç©º</strong>ï¼šå¯¹è±¡ä¸€å‡ºç”Ÿï¼ˆæ„é€ æ—¶ï¼‰å°±å¿…é¡»æŠŠä¾èµ–ä¼ è¿›æ¥ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
<li><strong>ä¸å¯å˜æ€§</strong>ï¼šå¯ä»¥ä½¿ç”¨ <code>final</code> å…³é”®å­—ï¼Œé˜²æ­¢ä»¥åè¢«ä¿®æ”¹ã€‚</li>
<li><strong>åˆ©äºæµ‹è¯•</strong>ï¼šå³ä¾¿æ²¡æœ‰ Springï¼Œä½ ä¹Ÿå¯ä»¥è½»æ¾åœ°é€šè¿‡ <code>new UserController(mockService)</code> æ¥è¿›è¡Œæµ‹è¯•ã€‚</li>
</ol>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼šå½“ä¾èµ–éå¸¸å¤šï¼ˆæ¯”å¦‚æœ‰ 10 ä¸ªï¼‰æ—¶ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¼šéå¸¸é•¿ã€‚</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-3">æ€»ç»“ï¼šé¢è¯•æ€ä¹ˆç­”ï¼Ÿ</h2>

























<table><thead><tr><th><strong>æ–¹å¼</strong></th><th><strong>æ¨èç¨‹åº¦</strong></th><th><strong>ç†ç”±</strong></th></tr></thead><tbody><tr><td><strong>æ„é€ å™¨æ³¨å…¥</strong></td><td>â­â­â­â­â­</td><td>å®˜æ–¹æ¨èï¼Œå®‰å…¨ã€å¯é ã€æ–¹ä¾¿æµ‹è¯•ï¼Œä¿è¯å¯¹è±¡çŠ¶æ€å®Œæ•´ã€‚</td></tr><tr><td><strong>å±æ€§æ³¨å…¥</strong></td><td>â­â­â­</td><td>å¼€å‘å¿«ï¼Œä»£ç çœäº‹ï¼Œä½†åœ¨å¤§å‹é¡¹ç›®å’Œä¸¥æ ¼æµ‹è¯•ä¸­ä¸æ¨èã€‚</td></tr><tr><td><strong>Setter æ³¨å…¥</strong></td><td>â­â­</td><td>é™¤ééœ€è¦åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€æ”¹å˜ä¾èµ–ï¼Œå¦åˆ™å¾ˆå°‘ä½¿ç”¨ã€‚</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linuxå…¥ä¾µæŒ–çŸ¿å¤„ç†è®°å½•]]></title>    <link>https://juejin.cn/post/7585412203979096107</link>    <guid>https://juejin.cn/post/7585412203979096107</guid>    <pubDate>2025-12-20T10:05:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585412203979096107" data-draft-id="7585412203979079723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Linuxå…¥ä¾µæŒ–çŸ¿å¤„ç†è®°å½•"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T10:05:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¹³å‡¡çš„è¿ç»´ä¹‹è·¯"/> <meta itemprop="url" content="https://juejin.cn/user/917424464473512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Linuxå…¥ä¾µæŒ–çŸ¿å¤„ç†è®°å½•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/917424464473512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¹³å‡¡çš„è¿ç»´ä¹‹è·¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T10:05:29.000Z" title="Sat Dec 20 2025 10:05:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Linuxå…¥ä¾µæŒ–çŸ¿å¤„ç†è®°å½•</h3>
<ul>
<li>çªç„¶æ”¶åˆ°ç³»ç»Ÿå‘Šè­¦ï¼Œcpuä½¿ç”¨è¶…50%ä»¥ä¸Šï¼Œå®é™…å‘¨æœ«ä¸šåŠ¡ä½è°·æœŸï¼Œä¸ä¼šä½¿ç”¨è¿™ä¹ˆé«˜çš„cpuä½¿ç”¨ç‡ã€‚</li>
</ul>
<h4 data-id="heading-1">è§£å†³æ€è·¯</h4>
<ul>
<li>
<p>ç³»ç»ŸåŸºç¡€å‘½ä»¤è¢«æ›¿æ¢å¯¼è‡´ï¼Œæ— æ³•å±•ç¤ºéšè—çš„è¿›ç¨‹æˆ–è€…å…¶ä»–ä¿¡æ¯ï¼Œä½¿ç”¨BusyBox å‘½ä»¤ä»£æ›¿åŸºç¡€å‘½ä»¤ï¼Œèƒ½è¾“å‡ºå®Œæ•´ä¿¡æ¯ã€‚</p>
<ul>
<li>ä¸‹è½½åœ°å€ <code>https://www.busybox.net/downloads/binaries/1.30.0-i686/busybox</code></li>
</ul>
</li>
<li>
<p>ä½¿ç”¨busybox topå‘½ä»¤</p>
<ul>
<li>ä½¿ç”¨busybox topå‘½ä»¤ï¼Œå¯ä»¥æ¸…æ¥šå‘ç°å¼‚å¸¸è¿›ç¨‹å ç”¨cpuè¶…50%,</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e923f90398e24bb38cb1bc02a0ed04e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bmz5Yeh55qE6L-Q57u05LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766829929&amp;x-signature=BXOQitlP3GekJ8aMv0s%2Ba7omr4s%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>æ‰¾åˆ°è¿›ç¨‹æ–‡ä»¶ï¼Œæ¸…ç†è¯¥æ–‡ä»¶
<ul>
<li>è¿›å…¥/procç›®å½•ä¸‹æ‰¾åˆ°å¯¹åº”pidï¼ŒæŸ¥çœ‹environæ–‡ä»¶ï¼ŒSSC_ARGV0=å°±æ˜¯ç¨‹åºæœ¬èº«ï¼Œåˆ é™¤è¯¥æ–‡ä»¶åï¼Œé‡å¯æœåŠ¡å™¨çœ‹æ˜¯å¦è¿˜ä¼šæœ‰å¼‚å¸¸è¿›ç¨‹ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feb6d0e294604584b578e445bc80cd89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bmz5Yeh55qE6L-Q57u05LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766829929&amp;x-signature=WSmx8bJ0rh7h11v90efV5UmB57Y%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Strapi 5 æ€ä¹ˆç”¨æ‰å¤Ÿçˆ½ï¼Ÿè¿™æ¬¾æ’ä»¶å¸¦ä½ å®ç°â€œå»ºç«™è‡ªç”±â€]]></title>    <link>https://juejin.cn/post/7585452404113227791</link>    <guid>https://juejin.cn/post/7585452404113227791</guid>    <pubDate>2025-12-20T09:10:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113227791" data-draft-id="7585452404113195023" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Strapi 5 æ€ä¹ˆç”¨æ‰å¤Ÿçˆ½ï¼Ÿè¿™æ¬¾æ’ä»¶å¸¦ä½ å®ç°â€œå»ºç«™è‡ªç”±â€"/> <meta itemprop="keywords" content="åç«¯,Node.js"/> <meta itemprop="datePublished" content="2025-12-20T09:10:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ¥èˆªé©¿ç«™"/> <meta itemprop="url" content="https://juejin.cn/user/4125023356335576"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Strapi 5 æ€ä¹ˆç”¨æ‰å¤Ÿçˆ½ï¼Ÿè¿™æ¬¾æ’ä»¶å¸¦ä½ å®ç°â€œå»ºç«™è‡ªç”±â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023356335576/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ¥èˆªé©¿ç«™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T09:10:10.000Z" title="Sat Dec 20 2025 09:10:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>Strapi 5 æ˜¯ä¸€ä¸ªä¼˜ç§€çš„åŸºçŸ³ï¼Œè€Œ <strong>strapi-plugin-bag</strong> åˆ™æ˜¯å…¶ä¸Šçš„â€œç²¾è£…ä¿®â€æ–¹æ¡ˆã€‚æˆ‘ä»¬è‡´åŠ›äºè§£å†³å¼€å‘è€…åœ¨å•†ä¸šåŒ–äº¤ä»˜è¿‡ç¨‹ä¸­çš„é‚£äº›é‡å¤åŠ³åŠ¨ï¼Œè®©å¤§å®¶èƒ½æŠŠç²¾åŠ›é›†ä¸­åœ¨çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p>
<p>æœ¬é¡¹ç›®å·²åœ¨ GitHub å¼€æºï¼Œå¹¶åŸºäº <strong>Turborepo</strong> ç»´æŠ¤ï¼ŒåŒ…å«äº†å®Œæ•´çš„æ–‡æ¡£å’Œå‰åç«¯ä»£ç ã€‚</p>
<ul>
<li><strong>GitHub ä»“åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhangjob%2Fstrapi-plugin-bag" target="_blank" title="https://github.com/hangjob/strapi-plugin-bag" ref="nofollow noopener noreferrer">github.com/hangjob/strâ€¦</a></li>
<li><strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhangjob.github.io%2Fstrapi-plugin-bag%2F" target="_blank" title="https://hangjob.github.io/strapi-plugin-bag/" ref="nofollow noopener noreferrer">hangjob.github.io/strapi-plugâ€¦</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be8cfd60d9942b08d2b6f5cd91cc7c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6Iiq6am_56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766826610&amp;x-signature=vqmEgr8EqX9brTXu41eqHLr%2BkEQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">æ ¸å¿ƒç‰¹æ€§</h2>
<ul>
<li>ğŸ›¡ï¸ <strong>å®‰å…¨é˜²å¾¡</strong>ï¼šå†…ç½®åŠ¨æ€ IP é»‘ç™½åå•ã€å¤šé‡éªŒè¯ç æ‹¦æˆªé€»è¾‘ã€‚</li>
<li>ğŸ” <strong>éšç§åŠ å›º</strong>ï¼šä¸€é”®å¯ç”¨ RSA 2048 ä¸ AES 256 æ•°æ®åŠ å¯†æœåŠ¡ã€‚</li>
<li>ğŸ“° <strong>å†…å®¹ç”Ÿæ€</strong>ï¼šå®Œå–„çš„æ–‡ç« ã€åˆ†ç±»ã€æ ‡ç­¾ç®¡ç†ï¼Œå†…ç½® SEO ä¸é˜…è¯»é‡ç»Ÿè®¡ã€‚</li>
<li>ğŸ—ºï¸ <strong>å¯è§†åŒ–è¿è¥</strong>ï¼šå¯è§†åŒ–ç®¡ç†å¤šçº§èœå•ã€å¹»ç¯ç‰‡ã€å‹æƒ…é“¾æ¥ã€‚</li>
<li>ğŸ’¬ <strong>äº’åŠ¨äº¤äº’</strong>ï¼šå¼ºå¤§çš„å¤šçº§è¯„è®ºå®¡æ ¸æœºåˆ¶ä¸ç‹¬ç«‹ç•™è¨€æ¿ã€‚</li>
<li>ğŸš€ <strong>æé€Ÿäº¤ä»˜</strong>ï¼šå…¨ä¸­æ–‡é€‚é…ï¼Œæ·±åº¦ä¼˜åŒ– Strapi 5 æ“ä½œä½“éªŒã€‚</li>
<li/>
</ul>
<h2 data-id="heading-1">ç¯å¢ƒè¦æ±‚</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„å¼€å‘ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li><strong>Strapi ç‰ˆæœ¬</strong>: <code>^5.0.0</code> (æ”¯æŒæœ€æ–°çš„ Strapi 5 æ¶æ„)</li>
<li><strong>Node.js ç‰ˆæœ¬</strong>: <code>&gt;=22.10.0</code></li>
<li><strong>æ•°æ®åº“</strong>: MySQL, PostgreSQL æˆ– SQLite</li>
</ul>
<h2 data-id="heading-2">å®‰è£…æ­¥éª¤</h2>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„åŒ…ç®¡ç†å™¨å°†æ’ä»¶æ·»åŠ åˆ°æ‚¨çš„ Strapi é¡¹ç›®ä¸­ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add strapi-plugin-bag
</code></pre>
<h2 data-id="heading-3">å¯ç”¨æ’ä»¶</h2>
<p>å®‰è£…å®Œæˆåï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨åœ¨ Strapi çš„é…ç½®æ–‡ä»¶ä¸­å¯ç”¨è¯¥æ’ä»¶ã€‚</p>
<p>ç¼–è¾‘æˆ–åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>config/plugins.js</code> (æˆ– <code>config/plugins.ts</code>) æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">{ env }</span>) =&gt;</span> ({
  <span class="hljs-comment">// ... å…¶ä»–æ’ä»¶é…ç½®</span>
  <span class="hljs-string">"strapi-plugin-bag"</span>: {
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  },
});
</code></pre>
<h2 data-id="heading-4">é‡æ–°æ„å»º</h2>
<p>ä¸ºäº†è®©æ’ä»¶çš„åå°ç®¡ç†ç•Œé¢ç”Ÿæ•ˆï¼Œæ‚¨éœ€è¦é‡æ–°æ„å»º Strapi çš„ç®¡ç†é¢æ¿å¹¶é‡å¯æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ„å»ºç®¡ç†é¢æ¿</span>
npm run build

<span class="hljs-comment"># å¯åŠ¨å¼€å‘æœåŠ¡å™¨</span>
npm run dev
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98a42f9b6b8c4bfab6fa57256a876ebf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6Iiq6am_56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766826610&amp;x-signature=AyHO1SHMe%2Fv2P9ts4dI%2BLF9PsI4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">æƒé™é…ç½®</h2>
<p>å¯ç”¨æ’ä»¶åï¼Œæ‚¨éœ€è¦ä¸ºç›¸åº”çš„è§’è‰²é…ç½® API è®¿é—®æƒé™ï¼š</p>
<ol>
<li>ç™»å½• Strapi ç®¡ç†åå°ã€‚</li>
<li>å‰å¾€ <strong>Settings (è®¾ç½®)</strong> -&gt; <strong>Users &amp; Permissions Plugin</strong> -&gt; <strong>Roles (è§’è‰²)</strong>ã€‚</li>
<li>é€‰æ‹©æ‚¨æƒ³è¦é…ç½®çš„è§’è‰²ï¼ˆå¦‚ <code>Public</code> æˆ– <code>Authenticated</code>ï¼‰ã€‚</li>
<li>åœ¨ <strong>Permissions (æƒé™)</strong> åˆ—è¡¨ä¸­æ‰¾åˆ° <strong>Strapi-plugin-bag</strong>ã€‚</li>
<li>å‹¾é€‰æ‚¨éœ€è¦å¼€æ”¾çš„ API æƒé™ï¼ˆå¦‚ <code>article.find</code>, <code>menu.findOne</code> ç­‰ï¼‰ã€‚</li>
<li>ç‚¹å‡»å³ä¸Šè§’çš„ <strong>Save (ä¿å­˜)</strong>ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7481680accff4270b0df50836742b563~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6Iiq6am_56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766826610&amp;x-signature=8%2FSWWqCtXMnQcYAESliBfHl91RI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">ç¯å¢ƒå¯è§†åŒ–é…ç½®</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff3db7f4873f4ab38d1dbec6fd4914c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6Iiq6am_56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766826610&amp;x-signature=c%2ByHVcnSweVJqau6aANHwykrmhY%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”dotenv]]></title>    <link>https://juejin.cn/post/7585474459776466980</link>    <guid>https://juejin.cn/post/7585474459776466980</guid>    <pubDate>2025-12-20T08:58:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776466980" data-draft-id="7585485074037456902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”dotenv"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:58:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”dotenv
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:58:20.000Z" title="Sat Dec 20 2025 08:58:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p>dotenv æ˜¯ä¸€ä¸ª<strong>è½»é‡çº§çš„ Node.js ç¯å¢ƒå˜é‡ç®¡ç†å·¥å…·</strong>ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯ï¼š<strong>ä»é¡¹ç›®æ ¹ç›®å½•çš„Â <code>.env</code>Â æ–‡ä»¶ä¸­åŠ è½½è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶å°†å®ƒä»¬æ³¨å…¥åˆ° Node.js çš„Â <code>process.env</code>Â å¯¹è±¡ä¸­</strong>ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä»£ç ä¸­ç»Ÿä¸€é€šè¿‡Â <code>process.env.XXX</code>Â çš„æ–¹å¼è·å–è¿™äº›ç¯å¢ƒé…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨ç³»ç»Ÿç¯å¢ƒä¸­é…ç½®ä¸´æ—¶å˜é‡æˆ–æ°¸ä¹…å˜é‡ã€‚</p>
<h2 data-id="heading-1">æ ¸å¿ƒå·¥ä½œåŸç†</h2>
<ol>
<li>å½“åœ¨é¡¹ç›®ä¸­å¼•å…¥å¹¶æ‰§è¡Œ dotenv æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„Â <code>.env</code>Â æ–‡ä»¶ï¼ˆè¯¥æ–‡ä»¶ä¸ºçº¯æ–‡æœ¬æ ¼å¼ï¼Œé‡‡ç”¨é”®å€¼å¯¹é…ç½®ï¼‰ï¼›</li>
<li>å®ƒä¼šè§£æÂ <code>.env</code>Â æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œé…ç½®ï¼ˆæ ¼å¼é€šå¸¸ä¸ºÂ <code>KEY=VALUE</code>ï¼‰ï¼›</li>
<li>å°†è§£æåçš„é”®å€¼å¯¹é€ä¸€æŒ‚è½½åˆ° Node.js å†…ç½®çš„Â <code>process.env</code>Â å¯¹è±¡ä¸Šï¼ˆ<code>process.env</code>Â åŸæœ¬ç”¨äºå­˜å‚¨ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡ï¼Œdotenv ä¸ºå…¶æ‰©å±•äº†é¡¹ç›®è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ï¼‰ï¼›</li>
<li>ä¹‹ååœ¨é¡¹ç›®çš„ä»»æ„ä»£ç æ–‡ä»¶ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡Â <code>process.env.KEY</code>Â çš„å½¢å¼è·å–å¯¹åº”çš„å€¼ã€‚</li>
</ol>
<h2 data-id="heading-2">ä½¿ç”¨ç¤ºä¾‹</h2>
<pre><code class="hljs language-css" lang="css">npm install dotenv <span class="hljs-attr">--save</span>
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env æ–‡ä»¶å†…å®¹ å½“å‰ç”¨æˆ·è·¯å¾„ä¸‹åˆ›å»ºÂ `.env`Â æ–‡ä»¶</span>
<span class="hljs-attr">PORT</span>=<span class="hljs-number">3000</span>
<span class="hljs-attr">DB_HOST</span>=localhost
<span class="hljs-attr">DB_USER</span>=root
<span class="hljs-attr">DB_PASSWORD</span>=<span class="hljs-number">123456</span>
<span class="hljs-attr">API_KEY</span>=abcdefg123456
</code></pre>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> dotenv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>);
    <span class="hljs-keyword">const</span> dotenvPath = path.<span class="hljs-title function_">resolve</span>(userHome, <span class="hljs-string">'.env'</span>); <span class="hljs-comment">// /Users/***/.env</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">pathExists</span>(dotenvPath)) {
        dotenv.<span class="hljs-title function_">config</span>({
            <span class="hljs-attr">path</span>: dotenvPath,
        });
    }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ŠFlutterå…¨æ ˆå¼€å‘å®æˆ˜æŒ‡å—ï¼šä»é›¶åˆ°é«˜çº§ã€‹- 26 -æŒç»­é›†æˆä¸éƒ¨ç½²]]></title>    <link>https://juejin.cn/post/7585463195201404978</link>    <guid>https://juejin.cn/post/7585463195201404978</guid>    <pubDate>2025-12-20T08:56:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463195201404978" data-draft-id="7585686247269548041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ŠFlutterå…¨æ ˆå¼€å‘å®æˆ˜æŒ‡å—ï¼šä»é›¶åˆ°é«˜çº§ã€‹- 26 -æŒç»­é›†æˆä¸éƒ¨ç½²"/> <meta itemprop="keywords" content="Flutter,Android,iOS"/> <meta itemprop="datePublished" content="2025-12-20T08:56:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QuantumLeapä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/1767603104125197"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ŠFlutterå…¨æ ˆå¼€å‘å®æˆ˜æŒ‡å—ï¼šä»é›¶åˆ°é«˜çº§ã€‹- 26 -æŒç»­é›†æˆä¸éƒ¨ç½²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1767603104125197/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QuantumLeapä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:56:38.000Z" title="Sat Dec 20 2025 08:56:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<blockquote>
<p>ä»£ç å†™å¾—å†å¥½ï¼Œæ²¡æœ‰è‡ªåŠ¨åŒ–çš„æµæ°´çº¿ï¼Œå°±åƒæ³•æ‹‰åˆ©å¼•æ“è£…åœ¨ç‰›è½¦ä¸Šï¼ï¼ï¼</p>
</blockquote>
<p><strong>ä»€ä¹ˆæ˜¯æŒç»­é›†æˆä¸éƒ¨ç½²ï¼Ÿç®€å•è¯´å°±æ˜¯ï¼š</strong></p>
<ul>
<li>ä½ å†™ä»£ç  â†’ è‡ªåŠ¨æµ‹è¯• â†’ è‡ªåŠ¨æ‰“åŒ… â†’ è‡ªåŠ¨å‘å¸ƒ</li>
<li>å°±åƒå·¥å‚çš„æµæ°´çº¿ï¼Œä»£ç è¿›å»ï¼ŒAppå‡ºæ¥</li>
</ul>
<p>ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ¥æ­å»ºè¿™æ¡"ä»£ç æµæ°´çº¿"ï¼Œè®©ä½ çš„å¼€å‘æ•ˆç‡å¤§å¹…æå‡ï¼</p>
<h3 data-id="heading-1">ä¸€ï¼šCI/CDåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ¯ä¸ªå›¢é˜Ÿéƒ½éœ€è¦ï¼Ÿ</h3>
<h4 data-id="heading-2">1.1 ä»æ‰‹åŠ¨æ“ä½œåˆ°è‡ªåŠ¨åŒ–æµæ°´çº¿</h4>
<p>å…ˆçœ‹çœ‹ä¼ ç»Ÿå¼€å‘æµç¨‹çš„ç—›ç‚¹ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¼ ç»Ÿå‘å¸ƒæµç¨‹ï¼ˆæ‰‹åŠ¨ç‰ˆï¼‰</span>
  <span class="hljs-number">1.</span> æœ¬åœ°è¿è¡Œæµ‹è¯•();       <span class="hljs-comment">// æŸäº›æµ‹è¯•å¯èƒ½å¿˜è®°è¿è¡Œ</span>
  <span class="hljs-number">2.</span> æ‰‹åŠ¨æ‰“åŒ…Android();    <span class="hljs-comment">// é…ç½®è¯ä¹¦ã€ç­¾åã€ç‰ˆæœ¬å·...</span>
  <span class="hljs-number">3.</span> æ‰‹åŠ¨æ‰“åŒ…iOS();        <span class="hljs-comment">// è¯ä¹¦ã€æè¿°æ–‡ä»¶ã€ä¸Šæ¶æˆªå›¾...</span>
  <span class="hljs-number">4.</span> ä¸Šä¼ åˆ°æµ‹è¯•å¹³å°();     <span class="hljs-comment">// æ‰¾æµ‹è¯•å¦¹å­è¦æ‰‹æœºå·</span>
  <span class="hljs-number">5.</span> æ”¶é›†åé¦ˆä¿®å¤bug();    <span class="hljs-comment">// æ¥å›æ²Ÿé€šï¼Œæ•ˆç‡ä½ä¸‹</span>
  <span class="hljs-number">6.</span> é‡å¤æ­¥éª¤<span class="hljs-number">1</span><span class="hljs-number">-5</span>();        <span class="hljs-comment">// æ— é™å¾ªç¯...</span>
</code></pre>
<p>å†çœ‹è‡ªåŠ¨åŒ–æµæ°´çº¿ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ï¼ˆCI/CDç‰ˆï¼‰</span>
<span class="hljs-string">æµç¨‹:</span>
  <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">æ¨é€ä»£ç åˆ°GitHub/Gitlab</span> <span class="hljs-string">â†’</span> <span class="hljs-string">è‡ªåŠ¨è§¦å‘</span>
  <span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">è¿è¡Œæ‰€æœ‰æµ‹è¯•</span> <span class="hljs-string">â†’</span> <span class="hljs-string">å¤±è´¥è‡ªåŠ¨é€šçŸ¥</span>
  <span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">æ‰“åŒ…æ‰€æœ‰å¹³å°</span> <span class="hljs-string">â†’</span> <span class="hljs-string">åŒæ—¶è¿›è¡Œ</span>
  <span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">åˆ†å‘åˆ°æµ‹è¯•ç¯å¢ƒ</span> <span class="hljs-string">â†’</span> <span class="hljs-string">è‡ªåŠ¨åˆ†å‘ç»™æµ‹è¯•äººå‘˜</span>
  <span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">å‘å¸ƒåˆ°åº”ç”¨å•†åº—</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ¡ä»¶è§¦å‘</span>
</code></pre>
<h4 data-id="heading-3">1.2 CI/CDçš„æ ¸å¿ƒä»·å€¼</h4>
<p>å¾ˆå¤šæ–°æ‰‹è§‰å¾—CI/CDæ˜¯"å¤§å…¬å¸æ‰éœ€è¦çš„ä¸œè¥¿"ï¼Œå…¶å®å®Œå…¨é”™äº†ï¼å®ƒè§£å†³çš„æ˜¯è¿™äº›ç—›ç‚¹ï¼š</p>
<p><strong>é—®é¢˜1ï¼šç¯å¢ƒä¸ä¸€è‡´</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">æœ¬åœ°ç¯å¢ƒ: Flutter 3.10, Dart 2.18, Mac M1</span>
<span class="hljs-section">æµ‹è¯•ç¯å¢ƒ: Flutter 3.7, Dart 2.17, Windows</span>
<span class="hljs-section">ç”Ÿäº§ç¯å¢ƒ: ???</span>
</code></pre>
<p><strong>é—®é¢˜2ï¼šæ‰‹åŠ¨æ“ä½œå®¹æ˜“å‡ºé”™</strong>
ä¹‹å‰é‡åˆ°è¿‡åŒäº‹æŠŠdebugåŒ…å‘ç»™äº†ç”¨æˆ·ï¼Œå› ä¸ºæ‰“åŒ…æ—¶é€‰é”™äº†æ„å»ºå˜ä½“ã€‚</p>
<p><strong>é—®é¢˜3ï¼šåé¦ˆå‘¨æœŸå¤ªé•¿</strong>
ä»£ç æäº¤ â†’ æ‰‹åŠ¨æ‰“åŒ… â†’ å‘ç»™æµ‹è¯• â†’ å‘ç°é—®é¢˜ â†’ å·²ç»è¿‡äº†åŠå¤©</p>
<h4 data-id="heading-4">1.3 CI/CDçš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ä»£ç æäº¤] --&gt; B[æŒç»­é›†æˆ CI]
    B --&gt; C[æŒç»­äº¤ä»˜ CD]
    C --&gt; D[æŒç»­éƒ¨ç½² CD]
    
    B --&gt; E[è‡ªåŠ¨æ„å»º]
    B --&gt; F[è‡ªåŠ¨æµ‹è¯•]
    
    C --&gt; G[è‡ªåŠ¨æ‰“åŒ…]
    C --&gt; H[è‡ªåŠ¨å‘å¸ƒåˆ°æµ‹è¯•]
    
    D --&gt; I[è‡ªåŠ¨å‘å¸ƒåˆ°ç”Ÿäº§]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
</code></pre>
<p><strong>æŒç»­é›†æˆï¼ˆCIï¼‰</strong>ï¼šé¢‘ç¹é›†æˆä»£ç åˆ°ä¸»å¹²ï¼Œæ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•</p>
<p><strong>æŒç»­äº¤ä»˜ï¼ˆCDï¼‰</strong>ï¼šè‡ªåŠ¨å°†ä»£ç æ‰“åŒ…æˆå¯éƒ¨ç½²çš„äº§ç‰©</p>
<p><strong>æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰</strong>ï¼šè‡ªåŠ¨å°†äº§ç‰©éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸¤ä¸ªCDè™½ç„¶ç¼©å†™ä¸€æ ·ï¼Œä½†å«ä¹‰ä¸åŒã€‚Continuous Deliveryï¼ˆæŒç»­äº¤ä»˜ï¼‰å’Œ Continuous Deploymentï¼ˆæŒç»­éƒ¨ç½²ï¼‰</p>
</blockquote>
<h3 data-id="heading-5">äºŒï¼šGitHub Actions</h3>
<p>æˆ‘ä»¬ä»¥githubä¸ºä¾‹ï¼Œå½“ç„¶å„å…¬å¸æœ‰å•ç‹¬éƒ¨ç½²çš„gitlabï¼Œå¤§åŒå°å¼‚è¿™é‡Œä¸åœ¨èµ˜è¿°ã€‚ã€‚ã€‚</p>
<h4 data-id="heading-6">2.1 GitHub Actionså·¥ä½œåŸç†</h4>
<p>GitHub Actionsä¸æ˜¯é­”æ³•ï¼Œè€Œæ˜¯GitHubæä¾›çš„<strong>è‡ªåŠ¨åŒ–æ‰§è¡Œç¯å¢ƒ</strong>ã€‚æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ä½ çš„ä»£ç ä»“åº“] --&gt; B[äº‹ä»¶æ¨é€/PR]
    B --&gt; C[GitHub ActionsæœåŠ¡å™¨]
    C --&gt; D[åˆ†é…è™šæ‹Ÿæœº]
    D --&gt; E[ä½ çš„å·¥ä½œæµ]
    E --&gt; F[è¿è¡Œä½ çš„è„šæœ¬]

    style A fill:#f9f,stroke:#333,stroke-width:1px
    style C fill:#9f9,stroke:#333,stroke-width:1px
    style E fill:#99f,stroke:#333,stroke-width:1px
</code></pre>
<p><strong>æ ¸å¿ƒç»„ä»¶è§£æ</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># å·¥ä½œæµç»„ä»¶å…³ç³»å›¾</span>
<span class="hljs-string">å·¥ä½œæµæ–‡ä»¶</span> <span class="hljs-string">(.github/workflows/ci.yml)</span>
    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">è§¦å‘å™¨:</span> <span class="hljs-string">ä»€ä¹ˆæƒ…å†µä¸‹è¿è¡Œ</span> <span class="hljs-string">(push,</span> <span class="hljs-string">pull_request)</span>
    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">ä»»åŠ¡:</span> <span class="hljs-string">åœ¨ä»€ä¹ˆç¯å¢ƒä¸‹è¿è¡Œ</span> <span class="hljs-string">(ubuntu-latest)</span>
    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">æ­¥éª¤:</span> <span class="hljs-string">å…·ä½“æ‰§è¡Œä»€ä¹ˆ</span> <span class="hljs-string">(å®‰è£…Flutterã€è¿è¡Œæµ‹è¯•)</span>
</code></pre>
<h4 data-id="heading-7">2.2 åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå·¥ä½œæµ</h4>
<p>åˆ«è¢«å“åˆ°ï¼Œå…¶å®åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„CIæµç¨‹åªéœ€è¦5åˆ†é’Ÿï¼š</p>
<ol>
<li><strong>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæ–‡ä»¶å¤¹</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p .github/workflows
</code></pre>
<ol start="2">
<li><strong>åˆ›å»ºCIé…ç½®æ–‡ä»¶</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/flutter-ci.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Flutter</span> <span class="hljs-string">CI</span>  <span class="hljs-comment"># å·¥ä½œæµåç§°</span>

<span class="hljs-comment"># è§¦å‘æ¡ä»¶ï¼šå½“æœ‰ä»£ç æ¨é€åˆ°mainåˆ†æ”¯ï¼Œæˆ–è€…æœ‰PRæ—¶</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span>, <span class="hljs-string">develop</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-comment"># è®¾ç½®æƒé™</span>
<span class="hljs-attr">permissions:</span>
  <span class="hljs-attr">contents:</span> <span class="hljs-string">read</span>  <span class="hljs-comment"># åªè¯»æƒé™ï¼Œä¿è¯å®‰å…¨</span>

<span class="hljs-comment"># å·¥ä½œæµä¸­çš„ä»»åŠ¡</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-comment"># ä»»åŠ¡1ï¼šè¿è¡Œæµ‹è¯•</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-comment"># è¿è¡Œåœ¨Ubuntuæœ€æ–°ç‰ˆ</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-comment"># ä»»åŠ¡æ­¥éª¤</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-comment"># æ­¥éª¤1ï¼šæ£€å‡ºä»£ç </span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-comment"># æ­¥éª¤2ï¼šå®‰è£…Flutter</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">'3.10.x'</span>  <span class="hljs-comment"># æŒ‡å®šFlutterç‰ˆæœ¬</span>
          <span class="hljs-attr">channel:</span> <span class="hljs-string">'stable'</span>          <span class="hljs-comment"># ç¨³å®šç‰ˆ</span>
        
      <span class="hljs-comment"># æ­¥éª¤3ï¼šè·å–ä¾èµ–</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
        
      <span class="hljs-comment"># æ­¥éª¤4ï¼šè¿è¡Œæµ‹è¯•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">test</span>
        
      <span class="hljs-comment"># æ­¥éª¤5ï¼šæ£€æŸ¥ä»£ç æ ¼å¼</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">formatting</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">format</span> <span class="hljs-string">--set-exit-if-changed</span> <span class="hljs-string">.</span>
        
      <span class="hljs-comment"># æ­¥éª¤6ï¼šé™æ€åˆ†æ</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Analyze</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">analyze</span>
</code></pre>
<ol start="3">
<li><strong>æäº¤å¹¶æ¨é€ä»£ç </strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">git add .github/workflows/flutter-ci.yml
git commit -m <span class="hljs-string">"æ·»åŠ CIå·¥ä½œæµ"</span>
git push origin main
</code></pre>
<p>æ¨é€åˆ°GitHubåï¼Œæ‰“å¼€ä½ çš„ä»“åº“é¡µé¢ï¼Œç‚¹å‡»"Actions"æ ‡ç­¾ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå·¥ä½œæµæ­£åœ¨è¿è¡Œï¼</p>
<h4 data-id="heading-8">2.3 GitHub Actionsæ¶æ„</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph &amp;#34;GitHub Actionsæ¶æ„&amp;#34;
        A[ä½ çš„ä»£ç ä»“åº“] --&gt; B[è§¦å‘äº‹ä»¶]
        B --&gt; C[GitHub Actions Runner]
        
        subgraph &amp;#34;Runneræ‰§è¡Œç¯å¢ƒ&amp;#34;
            C --&gt; D[åˆ›å»ºè™šæ‹Ÿæœº]
            D --&gt; E[æ‰§è¡Œå·¥ä½œæµ]
            
            subgraph &amp;#34;å·¥ä½œæµæ­¥éª¤&amp;#34;
                E --&gt; F[æ£€å‡ºä»£ç ]
                F --&gt; G[ç¯å¢ƒé…ç½®]
                G --&gt; H[æ‰§è¡Œè„šæœ¬]
                H --&gt; I[äº§å‡ºç‰©]
            end
        end
        
        I --&gt; J[ç»“æœåé¦ˆ]
        J --&gt; K[GitHub UIæ˜¾ç¤º]
        J --&gt; L[é‚®ä»¶/é€šçŸ¥]
    end
    
    style A fill:#e3f2fd
    style C fill:#f3e5f5
    style E fill:#e8f5e8
    style I fill:#fff3e0
</code></pre>
<p><strong>æ ¸å¿ƒæ¦‚å¿µè§£é‡Š</strong>ï¼š</p>
<ol>
<li><strong>Runner</strong>ï¼šGitHubæä¾›çš„è™šæ‹Ÿæœºï¼ˆæˆ–ä½ è‡ªå·±çš„æœåŠ¡å™¨ï¼‰ï¼Œç”¨æ¥æ‰§è¡Œå·¥ä½œæµ</li>
<li><strong>Workflow</strong>ï¼šå·¥ä½œæµï¼Œä¸€ä¸ªå®Œæ•´çš„è‡ªåŠ¨åŒ–æµç¨‹</li>
<li><strong>Job</strong>ï¼šä»»åŠ¡ï¼Œå·¥ä½œæµä¸­çš„ç‹¬ç«‹å•å…ƒ</li>
<li><strong>Step</strong>ï¼šæ­¥éª¤ï¼Œä»»åŠ¡ä¸­çš„å…·ä½“æ“ä½œ</li>
<li><strong>Action</strong>ï¼šå¯å¤ç”¨çš„æ“ä½œå•å…ƒï¼Œå¦‚"å®‰è£…Flutter"</li>
</ol>
<h3 data-id="heading-9">ä¸‰ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿</h3>
<h4 data-id="heading-10">3.1 ä¸ºä»€ä¹ˆè‡ªåŠ¨åŒ–æµ‹è¯•å¦‚æ­¤é‡è¦ï¼Ÿ</h4>
<p>åŠŸèƒ½ä¸Šçº¿å‰ï¼Œå…¨éƒ¨åŠŸèƒ½æ‰‹åŠ¨æµ‹è¯•è€—æ—¶é•¿ï¼Œæ˜“å‡ºbugã€‚åŠ å…¥è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæœ‰æ•ˆå‡å°‘bugç‡ã€‚</p>
<p><strong>æµ‹è¯•é‡‘å­—å¡”ç†è®º</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">        /\
       /  \      E2Eæµ‹è¯•ï¼ˆå°‘é‡ï¼‰
      /____\     
     /      \    é›†æˆæµ‹è¯•ï¼ˆé€‚ä¸­ï¼‰
    /________\
   /          \  å•å…ƒæµ‹è¯•ï¼ˆå¤§é‡ï¼‰
  /____________\
</code></pre>
<p>å¯¹äºFlutterï¼Œæµ‹è¯•åˆ†ä¸ºä¸‰å±‚ï¼š</p>
<h4 data-id="heading-11">3.2 é…ç½®å•å…ƒæµ‹è¯•</h4>
<p>å•å…ƒæµ‹è¯•æ˜¯æœ€åŸºç¡€çš„ï¼Œæµ‹è¯•å•ä¸ªå‡½æ•°æˆ–ç±»ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/unit-tests.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Unit</span> <span class="hljs-string">Tests</span>

<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>, <span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">unit-tests:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-comment"># åœ¨ä¸åŒç‰ˆæœ¬çš„Flutterä¸Šè¿è¡Œæµ‹è¯•</span>
        <span class="hljs-attr">flutter:</span> [<span class="hljs-string">'3.7.x'</span>, <span class="hljs-string">'3.10.x'</span>]
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.flutter</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.flutter</span> <span class="hljs-string">}}</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">unit</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
          flutter test
</span>          
          <span class="hljs-comment"># ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š</span>
          <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">--coverage</span>
          
          <span class="hljs-comment"># ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š</span>
          <span class="hljs-string">bash</span> <span class="hljs-string">&lt;(curl</span> <span class="hljs-string">-s</span> <span class="hljs-string">https://codecov.io/bash)</span>
</code></pre>
<p><strong>å•å…ƒæµ‹è¯•</strong>ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// test/calculator_test.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_test/flutter_test.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:my_app/utils/calculator.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  group(<span class="hljs-string">'ä»¥Calculatoræµ‹è¯•ä¸ºä¾‹'</span>, () {
    <span class="hljs-keyword">late</span> Calculator calculator;
    
    <span class="hljs-comment">// å‡†å¤‡å·¥ä½œ</span>
    setUp(() {
      calculator = Calculator();
    });
    
    test(<span class="hljs-string">'ä¸¤ä¸ªæ­£æ•°ç›¸åŠ '</span>, () {
      expect(calculator.add(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">5</span>);
    });
    
    test(<span class="hljs-string">'æ­£æ•°ä¸è´Ÿæ•°ç›¸åŠ '</span>, () {
      expect(calculator.add(<span class="hljs-number">5</span>, <span class="hljs-number">-3</span>), <span class="hljs-number">2</span>);
    });
    
    test(<span class="hljs-string">'é™¤ä»¥é›¶åº”è¯¥æŠ›å‡ºå¼‚å¸¸'</span>, () {
      expect(() =&gt; calculator.divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>), throwsA(isA&lt;ArgumentError&gt;()));
    });
  });
}
</code></pre>
<h4 data-id="heading-12">3.3 é…ç½®é›†æˆæµ‹è¯•</h4>
<p>é›†æˆæµ‹è¯•æµ‹è¯•å¤šä¸ªç»„ä»¶çš„äº¤äº’ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># é›†æˆæµ‹è¯•å·¥ä½œæµ</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">integration-tests:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">macos-latest</span>  <span class="hljs-comment"># iOSé›†æˆæµ‹è¯•éœ€è¦macOS</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">integration</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # å¯åŠ¨æ¨¡æ‹Ÿå™¨
          # flutter emulators --launch flutter_emulator
</span>          
          <span class="hljs-comment"># è¿è¡Œé›†æˆæµ‹è¯•</span>
          <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">integration_test/</span>
          
      <span class="hljs-comment"># å¦‚æœé›†æˆæµ‹è¯•å¤±è´¥ï¼Œä¸Šä¼ æˆªå›¾è¾…åŠ©è°ƒè¯•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">screenshots</span> <span class="hljs-string">on</span> <span class="hljs-string">failure</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">failure()</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">integration-test-screenshots</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">screenshots/</span>
</code></pre>
<h4 data-id="heading-13">3.4 é…ç½®Widgetæµ‹è¯•</h4>
<p>Widgetæµ‹è¯•æµ‹è¯•UIç»„ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">widget-tests:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          flutter pub get
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">widget</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # è¿è¡Œæ‰€æœ‰widgetæµ‹è¯•
          flutter test test/widget_test.dart
</span>          
          <span class="hljs-comment"># æˆ–è€…è¿è¡Œç‰¹å®šç›®å½•</span>
          <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">test/widgets/</span>
</code></pre>
<h4 data-id="heading-14">3.5 æµ‹è¯•æµæ°´çº¿</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant D as å¼€å‘è€…
    participant G as Gitä»“åº“
    participant CI as CIæœåŠ¡å™¨
    participant UT as å•å…ƒæµ‹è¯•æœåŠ¡
    participant WT as Widgetæµ‹è¯•æœåŠ¡
    participant IT as é›†æˆæµ‹è¯•æœåŠ¡
    participant R as æŠ¥å‘ŠæœåŠ¡
    participant N as é€šçŸ¥æœåŠ¡
    
    D-&gt;&gt;G: æ¨é€ä»£ç 
    G-&gt;&gt;CI: è§¦å‘Webhook
    
    CI-&gt;&gt;CI: è§£æå·¥ä½œæµé…ç½®
    CI-&gt;&gt;CI: åˆ†é…æµ‹è¯•èµ„æº
    
    par å¹¶è¡Œæ‰§è¡Œ
        CI-&gt;&gt;UT: å¯åŠ¨å•å…ƒæµ‹è¯•
        UT-&gt;&gt;UT: å‡†å¤‡ç¯å¢ƒ
        UT-&gt;&gt;UT: æ‰§è¡Œæµ‹è¯•
        UT-&gt;&gt;UT: åˆ†æè¦†ç›–ç‡
        UT--&gt;&gt;CI: è¿”å›ç»“æœ
    and
        CI-&gt;&gt;WT: å¯åŠ¨Widgetæµ‹è¯•
        WT-&gt;&gt;WT: å‡†å¤‡UIç¯å¢ƒ
        WT-&gt;&gt;WT: æ‰§è¡Œæµ‹è¯•
        WT-&gt;&gt;WT: æˆªå›¾å¯¹æ¯”
        WT--&gt;&gt;CI: è¿”å›ç»“æœ
    and
        CI-&gt;&gt;IT: å¯åŠ¨é›†æˆæµ‹è¯•
        IT-&gt;&gt;IT: å‡†å¤‡è®¾å¤‡
        IT-&gt;&gt;IT: æ‰§è¡Œæµ‹è¯•
        IT-&gt;&gt;IT: ç«¯åˆ°ç«¯éªŒè¯
        IT--&gt;&gt;CI: è¿”å›ç»“æœ
    end
    
    CI-&gt;&gt;CI: æ”¶é›†æ‰€æœ‰ç»“æœ
    
    alt æ‰€æœ‰æµ‹è¯•é€šè¿‡
        CI-&gt;&gt;R: è¯·æ±‚ç”ŸæˆæŠ¥å‘Š
        R-&gt;&gt;R: ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
        R--&gt;&gt;CI: è¿”å›æŠ¥å‘Š
        CI-&gt;&gt;N: å‘é€æˆåŠŸé€šçŸ¥
        N--&gt;&gt;D: é€šçŸ¥å¼€å‘è€…
    else æœ‰æµ‹è¯•å¤±è´¥
        CI-&gt;&gt;R: è¯·æ±‚ç”Ÿæˆé”™è¯¯æŠ¥å‘Š
        R-&gt;&gt;R: ç”Ÿæˆé”™è¯¯æŠ¥å‘Š
        R--&gt;&gt;CI: è¿”å›æŠ¥å‘Š
        CI-&gt;&gt;N: å‘é€å¤±è´¥é€šçŸ¥
        N--&gt;&gt;D: è­¦æŠ¥å¼€å‘è€…
    end
</code></pre>
<h3 data-id="heading-15">å››ï¼šè‡ªåŠ¨æ‰“åŒ…ä¸å‘å¸ƒæµæ°´çº¿</h3>
<h4 data-id="heading-16">4.1 Androidè‡ªåŠ¨æ‰“åŒ…</h4>
<p>Androidæ‰“åŒ…ç›¸å¯¹ç®€å•ï¼Œä½†è¦æ³¨æ„ç­¾åé—®é¢˜ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/android-build.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Android</span> <span class="hljs-string">Build</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>  <span class="hljs-comment"># åªæœ‰æ‰“tagæ—¶æ‰è§¦å‘æ‰“åŒ…</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build-android:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Java</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">distribution:</span> <span class="hljs-string">'temurin'</span>
          <span class="hljs-attr">java-version:</span> <span class="hljs-string">'17'</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">keystore</span>
        <span class="hljs-comment"># ä»GitHub Secretsè¯»å–ç­¾åå¯†é’¥</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          echo "${{ secrets.ANDROID_KEYSTORE }}" &gt; android/app/key.jks.base64
          base64 -d android/app/key.jks.base64 &gt; android/app/key.jks
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">APK</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # æ„å»ºReleaseç‰ˆAPK
          flutter build apk --release \
            --dart-define=APP_VERSION=${{ github.ref_name }} \
            --dart-define=BUILD_NUMBER=${{ github.run_number }}
            
</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">App</span> <span class="hljs-string">Bundle</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # æ„å»ºApp Bundle
          flutter build appbundle --release
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">artifacts</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">android-build-${{</span> <span class="hljs-string">github.run_number</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">|
            build/app/outputs/flutter-apk/app-release.apk
            build/app/outputs/bundle/release/app-release.aab
</span></code></pre>
<h4 data-id="heading-17">4.2 iOSè‡ªåŠ¨æ‰“åŒ…</h4>
<p>iOSæ‰“åŒ…ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦è‹¹æœå¼€å‘è€…è´¦å·ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/ios-build.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">iOS</span> <span class="hljs-string">Build</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build-ios:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">macos-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">CocoaPods</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          cd ios
          pod install
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Xcode</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # è®¾ç½®Xcodeç‰ˆæœ¬
          sudo xcode-select -s /Applications/Xcode_14.2.app
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">provisioning</span> <span class="hljs-string">profiles</span>
        <span class="hljs-comment"># é…ç½®è¯ä¹¦å’Œæè¿°æ–‡ä»¶</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">BUILD_CERTIFICATE_BASE64:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.BUILD_CERTIFICATE</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">P12_PASSWORD:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.P12_PASSWORD</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">BUILD_PROVISION_PROFILE_BASE64:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.BUILD_PROVISION_PROFILE</span> <span class="hljs-string">}}</span>
          
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # å¯¼å…¥è¯ä¹¦
          echo $BUILD_CERTIFICATE_BASE64 | base64 --decode &gt; certificate.p12
</span>          
          <span class="hljs-comment"># åˆ›å»ºé’¥åŒ™é“¾</span>
          <span class="hljs-string">security</span> <span class="hljs-string">create-keychain</span> <span class="hljs-string">-p</span> <span class="hljs-string">""</span> <span class="hljs-string">build.keychain</span>
          <span class="hljs-string">security</span> <span class="hljs-string">default-keychain</span> <span class="hljs-string">-s</span> <span class="hljs-string">build.keychain</span>
          <span class="hljs-string">security</span> <span class="hljs-string">unlock-keychain</span> <span class="hljs-string">-p</span> <span class="hljs-string">""</span> <span class="hljs-string">build.keychain</span>
          
          <span class="hljs-comment"># å¯¼å…¥è¯ä¹¦åˆ°é’¥åŒ™é“¾</span>
          <span class="hljs-string">security</span> <span class="hljs-string">import</span> <span class="hljs-string">certificate.p12</span> <span class="hljs-string">-k</span> <span class="hljs-string">build.keychain</span> <span class="hljs-string">\</span>
            <span class="hljs-string">-P</span> <span class="hljs-string">$P12_PASSWORD</span> <span class="hljs-string">-T</span> <span class="hljs-string">/usr/bin/codesign</span>
          
          <span class="hljs-comment"># å¯¼å…¥æè¿°æ–‡ä»¶</span>
          <span class="hljs-string">echo</span> <span class="hljs-string">$BUILD_PROVISION_PROFILE_BASE64</span> <span class="hljs-string">|</span> <span class="hljs-string">base64</span> <span class="hljs-string">--decode</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">profile.mobileprovision</span>
          <span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">~/Library/MobileDevice/Provisioning\</span> <span class="hljs-string">Profiles</span>
          <span class="hljs-string">cp</span> <span class="hljs-string">profile.mobileprovision</span> <span class="hljs-string">~/Library/MobileDevice/Provisioning\</span> <span class="hljs-string">Profiles/</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">iOS</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # æ„å»ºiOSåº”ç”¨
          flutter build ipa --release \
            --export-options-plist=ios/ExportOptions.plist \
            --dart-define=APP_VERSION=${{ github.ref_name }} \
            --dart-define=BUILD_NUMBER=${{ github.run_number }}
            
</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">IPA</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">ios-build-${{</span> <span class="hljs-string">github.run_number</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">build/ios/ipa/*.ipa</span>
</code></pre>
<h4 data-id="heading-18">4.3 å¤šç¯å¢ƒæ„å»ºé…ç½®</h4>
<p>çœŸå®çš„é¡¹ç›®é€šå¸¸æœ‰å¤šä¸ªç¯å¢ƒï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># å¤šç¯å¢ƒæ„å»ºé…ç½®</span>
<span class="hljs-attr">env:</span>
  <span class="hljs-comment"># æ ¹æ®åˆ†æ”¯é€‰æ‹©ç¯å¢ƒ</span>
  <span class="hljs-attr">APP_ENV:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">'production'</span> <span class="hljs-string">||</span> <span class="hljs-string">'staging'</span> <span class="hljs-string">}}</span>
  <span class="hljs-attr">APP_NAME:</span> <span class="hljs-string">${{</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">'ç”Ÿäº§'</span> <span class="hljs-string">||</span> <span class="hljs-string">'æµ‹è¯•'</span> <span class="hljs-string">}}</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-comment"># åŒæ—¶æ„å»ºå¤šä¸ªFlavor</span>
        <span class="hljs-attr">flavor:</span> [<span class="hljs-string">development</span>, <span class="hljs-string">staging</span>, <span class="hljs-string">production</span>]
        <span class="hljs-attr">platform:</span> [<span class="hljs-string">android</span>, <span class="hljs-string">ios</span>]
        
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">}}</span> <span class="hljs-string">for</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.flavor</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          if [ "${{ matrix.platform }}" = "android" ]; then
            flutter build apk --flavor ${{ matrix.flavor }} --release
          else
            flutter build ipa --flavor ${{ matrix.flavor }} --release
          fi
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.flavor</span> <span class="hljs-string">}}</span> <span class="hljs-string">build</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">}}-${{</span> <span class="hljs-string">matrix.flavor</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">|
            build/app/outputs/flutter-apk/app-${{ matrix.flavor }}-release.apk
            build/ios/ipa/*.ipa
</span></code></pre>
<h4 data-id="heading-19">4.4 è‡ªåŠ¨åŒ–å‘å¸ƒåˆ°æµ‹è¯•å¹³å°</h4>
<p>æ„å»ºå®Œæˆåï¼Œè‡ªåŠ¨åˆ†å‘ç»™æµ‹è¯•äººå‘˜ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># åˆ†å‘åˆ°æµ‹è¯•å¹³å°</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">distribute:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">needs:</span> [<span class="hljs-string">build</span>]  <span class="hljs-comment"># ä¾èµ–buildä»»åŠ¡</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">artifacts</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/download-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">artifacts/</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">to</span> <span class="hljs-string">Firebase</span> <span class="hljs-string">App</span> <span class="hljs-string">Distribution</span>
        <span class="hljs-comment"># åˆ†å‘åˆ°Firebase</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # å®‰è£…Firebase CLI
          curl -sL https://firebase.tools | bash
</span>          
          <span class="hljs-comment"># ç™»å½•Firebase</span>
          <span class="hljs-string">echo</span> <span class="hljs-string">"$<span class="hljs-template-variable">{{ secrets.FIREBASE_TOKEN }}</span>"</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">firebase_token.json</span>
          
          <span class="hljs-comment"># åˆ†å‘Android APK</span>
          <span class="hljs-string">firebase</span> <span class="hljs-string">appdistribution:distribute</span> <span class="hljs-string">artifacts/android-production/app-release.apk</span> <span class="hljs-string">\</span>
            <span class="hljs-string">--app</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.FIREBASE_ANDROID_APP_ID</span> <span class="hljs-string">}}</span> <span class="hljs-string">\</span>
            <span class="hljs-string">--groups</span> <span class="hljs-string">"testers"</span> <span class="hljs-string">\</span>
            <span class="hljs-string">--release-notes-file</span> <span class="hljs-string">CHANGELOG.md</span>
            
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">to</span> <span class="hljs-string">TestFlight</span>
        <span class="hljs-comment"># iOSä¸Šä¼ åˆ°TestFlight</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">==</span> <span class="hljs-string">'ios'</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # ä½¿ç”¨altoolä¸Šä¼ åˆ°App Store Connect
          xcrun altool --upload-app \
            -f artifacts/ios-production/*.ipa \
            -t ios \
            --apiKey ${{ secrets.APPSTORE_API_KEY }} \
            --apiIssuer ${{ secrets.APPSTORE_API_ISSUER }}
            
</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Notify</span> <span class="hljs-string">testers</span>
        <span class="hljs-comment"># é€šçŸ¥æµ‹è¯•äººå‘˜</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">8398a7/action-slack@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">status:</span> <span class="hljs-string">${{</span> <span class="hljs-string">job.status</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">fields:</span> <span class="hljs-string">repo,message,commit,author,action,eventName,ref,workflow,job,took</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">SLACK_WEBHOOK_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.SLACK_WEBHOOK_URL</span> <span class="hljs-string">}}</span>
</code></pre>
<h4 data-id="heading-20">4.5 æ‰“åŒ…å‘å¸ƒæµæ°´çº¿</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title Flutteræ‰“åŒ…å‘å¸ƒæµæ°´çº¿
    dateFormat HH:mm
    axisFormat %H:%M
    
    section è§¦å‘ä¸å‡†å¤‡
    ä»£ç æäº¤æ£€æµ‹ :00:00, 2m
    ç¯å¢ƒåˆå§‹åŒ– :00:02, 3m
    ä¾èµ–å®‰è£… :00:05, 4m
    
    section Androidæ„å»º
    Androidç¯å¢ƒå‡†å¤‡ :00:05, 2m
    Androidä»£ç ç¼–è¯‘ :00:07, 6m
    Androidä»£ç ç­¾å :00:13, 3m
    Androidæ‰“åŒ… :00:16, 2m
    
    section iOSæ„å»º
    iOSç¯å¢ƒå‡†å¤‡ :00:05, 3m
    iOSä»£ç ç¼–è¯‘ :00:08, 8m
    iOSè¯ä¹¦é…ç½® :00:16, 4m
    iOSæ‰“åŒ… :00:20, 3m
    
    section æµ‹è¯•åˆ†å‘
    ä¸Šä¼ åˆ°æµ‹è¯•å¹³å° :00:23, 5m
    æµ‹è¯•äººå‘˜é€šçŸ¥ :00:28, 2m
    æµ‹è¯•æ‰§è¡Œå‘¨æœŸ :00:30, 30m
    
    section ç”Ÿäº§å‘å¸ƒ
    æµ‹è¯•ç»“æœè¯„ä¼° :01:00, 3m
    ç”Ÿäº§ç¯å¢ƒå‡†å¤‡ :01:03, 5m
    æäº¤åˆ°åº”ç”¨å•†åº— :01:08, 10m
    å•†åº—å®¡æ ¸ç­‰å¾… :01:18, 30m
    å‘å¸ƒå®Œæˆé€šçŸ¥ :01:48, 2m
    
    section ç¯å¢ƒé…ç½®ç®¡ç†
    å¯†é’¥åŠ è½½ :00:02, 3m
    ç¯å¢ƒå˜é‡è®¾ç½® :00:05, 2m
    é…ç½®æ–‡ä»¶è§£æ :00:07, 3m
    ç‰ˆæœ¬å·å¤„ç† :00:10, 2m
</code></pre>
<h3 data-id="heading-21">äº”ï¼šç¯å¢ƒé…ç½®ç®¡ç†</h3>
<h4 data-id="heading-22">5.1 ä¸ºä»€ä¹ˆéœ€è¦ç¯å¢ƒé…ç½®ç®¡ç†ï¼Ÿ</h4>
<p>å…ˆçœ‹ä¸€ä¸ªåé¢æ•™æï¼šæˆ‘ä»¬é¡¹ç›®æ—©æœŸï¼Œä¸åŒç¯å¢ƒçš„APIåœ°å€æ˜¯ç¡¬ç¼–ç çš„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä¸æ¨èï¼šç¡¬ç¼–ç é…ç½®</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiConfig</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> baseUrl = <span class="hljs-string">'https://api.production.com'</span>;
  <span class="hljs-comment">// æµ‹è¯•æ—¶éœ€è¦æ‰‹åŠ¨æ”¹æˆï¼š'https://api.staging.com'</span>
  <span class="hljs-comment">// å¾ˆå®¹æ˜“å¿˜è®°æ”¹å›æ¥ï¼</span>
}
</code></pre>
<p>ç»“æœå°±æ˜¯ï¼šæµ‹è¯•æ—¶è°ƒç”¨äº†ç”Ÿäº§æ¥å£ï¼ŒæŠŠæµ‹è¯•æ•°æ®æ’åˆ°äº†ç”Ÿäº§æ•°æ®åº“ï¼ğŸ’¥</p>
<h4 data-id="heading-23">5.2 å¤šç¯å¢ƒé…ç½®æ–¹æ¡ˆ</h4>
<p><strong>æ–¹æ¡ˆä¸€ï¼šåŸºäºFlavorçš„é…ç½®</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/config/flavors.dart</span>
<span class="hljs-keyword">enum</span> AppFlavor {
  development,
  staging,
  production,
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig</span> </span>{
  <span class="hljs-keyword">final</span> AppFlavor flavor;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> appName;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> apiBaseUrl;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enableAnalytics;
  
  AppConfig({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.flavor,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.appName,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.apiBaseUrl,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.enableAnalytics,
  });
  
  <span class="hljs-comment">// æ ¹æ®Flavoråˆ›å»ºé…ç½®</span>
  <span class="hljs-keyword">factory</span> AppConfig.fromFlavor(AppFlavor flavor) {
    <span class="hljs-keyword">switch</span> (flavor) {
      <span class="hljs-keyword">case</span> AppFlavor.development:
        <span class="hljs-keyword">return</span> AppConfig(
          flavor: flavor,
          appName: <span class="hljs-string">'MyApp Dev'</span>,
          apiBaseUrl: <span class="hljs-string">'https://api.dev.xxxx.com'</span>,
          enableAnalytics: <span class="hljs-keyword">false</span>,
        );
      <span class="hljs-keyword">case</span> AppFlavor.staging:
        <span class="hljs-keyword">return</span> AppConfig(
          flavor: flavor,
          appName: <span class="hljs-string">'MyApp Staging'</span>,
          apiBaseUrl: <span class="hljs-string">'https://api.staging.xxxx.com'</span>,
          enableAnalytics: <span class="hljs-keyword">true</span>,
        );
      <span class="hljs-keyword">case</span> AppFlavor.production:
        <span class="hljs-keyword">return</span> AppConfig(
          flavor: flavor,
          appName: <span class="hljs-string">'MyApp'</span>,
          apiBaseUrl: <span class="hljs-string">'https://api.xxxx.com'</span>,
          enableAnalytics: <span class="hljs-keyword">true</span>,
        );
    }
  }
}
</code></pre>
<p><strong>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨dart-defineä¼ å…¥é…ç½®</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># CIé…ç½®ä¸­ä¼ å…¥ç¯å¢ƒå˜é‡</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">with</span> <span class="hljs-string">environment</span> <span class="hljs-string">variables</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    flutter build apk --release \
      --dart-define=APP_FLAVOR=production \
      --dart-define=API_BASE_URL=https://api.xxxx.com \
      --dart-define=ENABLE_ANALYTICS=true
</span></code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// åœ¨ä»£ç ä¸­è¯»å–ç¯å¢ƒå˜é‡</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnvConfig</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> flavor = <span class="hljs-built_in">String</span>.fromEnvironment(<span class="hljs-string">'APP_FLAVOR'</span>);
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> apiBaseUrl = <span class="hljs-built_in">String</span>.fromEnvironment(<span class="hljs-string">'API_BASE_URL'</span>);
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span> enableAnalytics = <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">'ENABLE_ANALYTICS'</span>);
}
</code></pre>
<h4 data-id="heading-24">5.3 ç®¡ç†æ•æ„Ÿä¿¡æ¯</h4>
<p>æ•æ„Ÿä¿¡æ¯ç»ä¸èƒ½å†™åœ¨ä»£ç é‡Œï¼</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ä½¿ç”¨GitHub Secrets</span>
<span class="hljs-attr">steps:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Use</span> <span class="hljs-string">secrets</span>
    <span class="hljs-attr">env:</span>
      <span class="hljs-comment"># ä»Secretsè¯»å–</span>
      <span class="hljs-attr">API_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.API_KEY</span> <span class="hljs-string">}}</span>
      <span class="hljs-attr">DATABASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.DATABASE_URL</span> <span class="hljs-string">}}</span>
      <span class="hljs-attr">SIGNING_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.ANDROID_SIGNING_KEY</span> <span class="hljs-string">}}</span>
      
    <span class="hljs-attr">run:</span> <span class="hljs-string">|
      # åœ¨è„šæœ¬ä¸­ä½¿ç”¨
      echo "API Key: $API_KEY"
</span>      
      <span class="hljs-comment"># å†™å…¥åˆ°é…ç½®æ–‡ä»¶</span>
      <span class="hljs-string">echo</span> <span class="hljs-string">"{ \"apiKey\": \"$API_KEY\" }"</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">config.json</span>
</code></pre>
<p><strong>å¦‚ä½•è®¾ç½®Secrets</strong>ï¼š</p>
<ol>
<li>æ‰“å¼€GitHubä»“åº“ â†’ Settings â†’ Secrets and variables â†’ Actions</li>
<li>ç‚¹å‡»"New repository secret"</li>
<li>è¾“å…¥åç§°å’Œå€¼</li>
</ol>
<h4 data-id="heading-25">5.4 é…ç½®æ–‡ä»¶ç®¡ç†</h4>
<p>æ¨èä»¥ä¸‹åˆ†å±‚é…ç½®ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">config/
â”œâ”€â”€ .env.example          <span class="hljs-comment"># ç¤ºä¾‹æ–‡ä»¶ï¼Œä¸å«çœŸå®å€¼</span>
â”œâ”€â”€ .env.development      <span class="hljs-comment"># å¼€å‘ç¯å¢ƒé…ç½®</span>
â”œâ”€â”€ .env.staging          <span class="hljs-comment"># æµ‹è¯•ç¯å¢ƒé…ç½®</span>
â”œâ”€â”€ .env.production       <span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒé…ç½®</span>
â””â”€â”€ config_loader.dart    <span class="hljs-comment"># é…ç½®åŠ è½½å™¨</span>
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// config/config_loader.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_dotenv/flutter_dotenv.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConfigLoader</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; load(<span class="hljs-built_in">String</span> env) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// æ ¹æ®ç¯å¢ƒåŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶</span>
    <span class="hljs-keyword">await</span> dotenv.load(fileName: <span class="hljs-string">'.env.<span class="hljs-subst">$env</span>'</span>);
  }
  
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> apiBaseUrl =&gt; dotenv.<span class="hljs-keyword">get</span>(<span class="hljs-string">'API_BASE_URL'</span>);
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> apiKey =&gt; dotenv.<span class="hljs-keyword">get</span>(<span class="hljs-string">'API_KEY'</span>);
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isDebug =&gt; dotenv.<span class="hljs-keyword">get</span>(<span class="hljs-string">'DEBUG'</span>) == <span class="hljs-string">'true'</span>;
}

<span class="hljs-comment">// main.dart</span>
<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  <span class="hljs-comment">// æ ¹æ®ç¼–è¯‘æ¨¡å¼é€‰æ‹©ç¯å¢ƒ</span>
  <span class="hljs-keyword">const</span> flavor = <span class="hljs-built_in">String</span>.fromEnvironment(<span class="hljs-string">'FLAVOR'</span>, defaultValue: <span class="hljs-string">'development'</span>);
  
  <span class="hljs-keyword">await</span> ConfigLoader.load(flavor);
  
  runApp(MyApp());
}
</code></pre>
<h4 data-id="heading-26">5.5 è®¾è®¡ç¯å¢ƒé…ç½®</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph &amp;#34;ç¯å¢ƒé…ç½®ç®¡ç†æ¶æ„&amp;#34;
        A[é…ç½®æ¥æº] --&gt; B[ä¼˜å…ˆçº§]
        
        subgraph &amp;#34;B[ä¼˜å…ˆçº§]&amp;#34;
            B1[1. è¿è¡Œæ—¶ç¯å¢ƒå˜é‡] --&gt; B2[æœ€é«˜ä¼˜å…ˆçº§]
            B3[2. é…ç½®æ–‡ä»¶] --&gt; B4[ä¸­ç­‰ä¼˜å…ˆçº§]
            B5[3. é»˜è®¤å€¼] --&gt; B6[æœ€ä½ä¼˜å…ˆçº§]
        end
        
        A --&gt; C[æ•æ„Ÿä¿¡æ¯å¤„ç†]
        
        subgraph &amp;#34;C[æ•æ„Ÿä¿¡æ¯å¤„ç†]&amp;#34;
            C1[å¯†é’¥/å¯†ç ] --&gt; C2[GitHub Secrets]
            C3[APIä»¤ç‰Œ] --&gt; C4[ç¯å¢ƒå˜é‡æ³¨å…¥]
            C5[æ•°æ®åº“è¿æ¥] --&gt; C6[è¿è¡Œæ—¶è·å–]
        end
        
        A --&gt; D[ç¯å¢ƒç±»å‹]
        
        subgraph &amp;#34;D[ç¯å¢ƒç±»å‹]&amp;#34;
            D1[å¼€å‘ç¯å¢ƒ] --&gt; D2[æœ¬åœ°è°ƒè¯•]
            D3[æµ‹è¯•ç¯å¢ƒ] --&gt; D4[CI/CDæµ‹è¯•]
            D5[é¢„å‘ç¯å¢ƒ] --&gt; D6[ç”Ÿäº§å‰éªŒè¯]
            D7[ç”Ÿäº§ç¯å¢ƒ] --&gt; D8[çº¿ä¸Šç”¨æˆ·]
        end
        
        B --&gt; E[é…ç½®åˆå¹¶]
        C --&gt; E
        D --&gt; E
        
        E --&gt; F[æœ€ç»ˆé…ç½®]
        
        F --&gt; G[åº”ç”¨å¯åŠ¨]
        F --&gt; H[APIè°ƒç”¨]
        F --&gt; I[åŠŸèƒ½å¼€å…³]
    end
    
    subgraph &amp;#34;å®‰å…¨å®è·µ&amp;#34;
        J[æ°¸è¿œä¸è¦æäº¤] --&gt; K[.envæ–‡ä»¶åˆ°Git]
        L[ä½¿ç”¨.gitignore] --&gt; M[å¿½ç•¥æ•æ„Ÿæ–‡ä»¶]
        N[å®šæœŸè½®æ¢] --&gt; O[å¯†é’¥å’Œä»¤ç‰Œ]
        P[æœ€å°æƒé™åŸåˆ™] --&gt; Q[ä»…æˆäºˆå¿…è¦æƒé™]
    end
    
    style A fill:#e3f2fd
    style C fill:#f3e5f5
    style D fill:#e8f5e8
    style J fill:#fff3e0
</code></pre>
<h3 data-id="heading-27">å…­ï¼šå¸¸è§CI/CDæŠ€å·§</h3>
<h4 data-id="heading-28">6.1 ä½¿ç”¨ç¼“å­˜åŠ é€Ÿæ„å»º</h4>
<p>Flutteré¡¹ç›®ä¾èµ–ä¸‹è½½å¾ˆæ…¢ï¼Œä½¿ç”¨ç¼“å­˜å¯ä»¥å¤§å¹…æé€Ÿï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Cache</span> <span class="hljs-string">Flutter</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">|
            /opt/hostedtoolcache/flutter
            ${{ github.workspace }}/.pub-cache
            ${{ github.workspace }}/build
</span>          <span class="hljs-attr">key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">runner.os</span> <span class="hljs-string">}}-flutter-${{</span> <span class="hljs-string">hashFiles('pubspec.lock')</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">restore-keys:</span> <span class="hljs-string">|
            ${{ runner.os }}-flutter-
</span>            
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Cache</span> <span class="hljs-string">Android</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">|
            ~/.gradle/caches
            ~/.gradle/wrapper
</span>          <span class="hljs-attr">key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">runner.os</span> <span class="hljs-string">}}-gradle-${{</span> <span class="hljs-string">hashFiles('**/*.gradle*',</span> <span class="hljs-string">'**/gradle-wrapper.properties'</span><span class="hljs-string">)</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">restore-keys:</span> <span class="hljs-string">|
            ${{ runner.os }}-gradle-
</span></code></pre>
<h4 data-id="heading-29">6.2 æ„å»ºç­–ç•¥</h4>
<p>åŒæ—¶æµ‹è¯•å¤šä¸ªé…ç½®ç»„åˆï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.os</span> <span class="hljs-string">}}</span>
    
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-comment"># å®šä¹‰</span>
        <span class="hljs-attr">os:</span> [<span class="hljs-string">ubuntu-latest</span>, <span class="hljs-string">macos-latest</span>]
        <span class="hljs-attr">flutter-version:</span> [<span class="hljs-string">'3.7.x'</span>, <span class="hljs-string">'3.10.x'</span>]
    
        <span class="hljs-attr">exclude:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">os:</span> <span class="hljs-string">macos-latest</span>
            <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">'3.7.x'</span>
        <span class="hljs-comment"># åŒ…å«ç‰¹å®šç»„åˆ</span>
        <span class="hljs-attr">include:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">os:</span> <span class="hljs-string">windows-latest</span>
            <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">'3.10.x'</span>
            <span class="hljs-attr">channel:</span> <span class="hljs-string">'beta'</span>
            
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Test</span> <span class="hljs-string">on</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.os</span> <span class="hljs-string">}}</span> <span class="hljs-string">with</span> <span class="hljs-string">Flutter</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.flutter-version</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">"Running tests..."</span>
</code></pre>
<h4 data-id="heading-30">6.3 æ¡ä»¶æ‰§è¡Œä¸å·¥ä½œæµæ§åˆ¶</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-comment"># åªæœ‰ç‰¹å®šåˆ†æ”¯æ‰æ‰§è¡Œ</span>
    <span class="hljs-attr">if:</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span>
    
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">changed</span> <span class="hljs-string">files</span>
        <span class="hljs-comment"># åªæœ‰ç‰¹å®šæ–‡ä»¶æ”¹åŠ¨æ‰æ‰§è¡Œ</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">dorny/paths-filter@v2</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">changes</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">filters:</span> <span class="hljs-string">|
            src:
              - 'src/**'
            configs:
              - 'config/**'
              
</span>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">if</span> <span class="hljs-string">src</span> <span class="hljs-string">changed</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">steps.changes.outputs.src</span> <span class="hljs-string">==</span> <span class="hljs-string">'true'</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">"Source code changed"</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Skip</span> <span class="hljs-string">if</span> <span class="hljs-string">only</span> <span class="hljs-string">docs</span> <span class="hljs-string">changed</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">github.event_name</span> <span class="hljs-string">==</span> <span class="hljs-string">'pull_request'</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">contains(github.event.pull_request.title,</span> <span class="hljs-string">'[skip-ci]'</span><span class="hljs-string">)</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          echo "Skipping CI due to [skip-ci] in PR title"
          exit 0
</span></code></pre>
<h4 data-id="heading-31">6.4 è‡ªå®šä¹‰Actions</h4>
<p>å½“é€šç”¨Actionsä¸å¤Ÿç”¨æ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/actions/flutter-setup/action.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">'Flutter Setup with Custom Options'</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">'Setup Flutter environment with custom configurations'</span>

<span class="hljs-attr">inputs:</span>
  <span class="hljs-attr">flutter-version:</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">'Flutter version'</span>
    <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">default:</span> <span class="hljs-string">'stable'</span>
  <span class="hljs-attr">channel:</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">'Flutter channel'</span>
    <span class="hljs-attr">required:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">default:</span> <span class="hljs-string">'stable'</span>
  <span class="hljs-attr">enable-web:</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">'Enable web support'</span>
    <span class="hljs-attr">required:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">default:</span> <span class="hljs-string">'false'</span>

<span class="hljs-attr">runs:</span>
  <span class="hljs-attr">using:</span> <span class="hljs-string">"composite"</span>
  <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">${{</span> <span class="hljs-string">inputs.flutter-version</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">channel:</span> <span class="hljs-string">${{</span> <span class="hljs-string">inputs.channel</span> <span class="hljs-string">}}</span>
        
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Enable</span> <span class="hljs-string">web</span> <span class="hljs-string">if</span> <span class="hljs-string">needed</span>
      <span class="hljs-attr">if:</span> <span class="hljs-string">${{</span> <span class="hljs-string">inputs.enable-web</span> <span class="hljs-string">==</span> <span class="hljs-string">'true'</span> <span class="hljs-string">}}</span>
      <span class="hljs-attr">shell:</span> <span class="hljs-string">bash</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">config</span> <span class="hljs-string">--enable-web</span>
      
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">licenses</span>
      <span class="hljs-attr">shell:</span> <span class="hljs-string">bash</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">doctor</span> <span class="hljs-string">--android-licenses</span>
</code></pre>
<h3 data-id="heading-32">ä¸ƒï¼šä¸ºç°æœ‰é¡¹ç›®æ·»åŠ CI/CD</h3>
<h4 data-id="heading-33">7.1 åˆ†æç°æœ‰é¡¹ç›®</h4>
<p>å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç°æˆçš„Flutteråº”ç”¨ï¼Œéœ€è¦æ·»åŠ CI/CDï¼š</p>
<pre><code class="hljs language-bash" lang="bash">é¡¹ç›®ç»“æ„ï¼š
my_flutter_app/
â”œâ”€â”€ lib/
â”œâ”€â”€ <span class="hljs-built_in">test</span>/
â”œâ”€â”€ android/
â”œâ”€â”€ ios/
â””â”€â”€ pubspec.yaml
</code></pre>
<p><strong>å½“å‰é—®é¢˜</strong>ï¼š</p>
<ol>
<li>æ‰‹åŠ¨æµ‹è¯•ï¼Œç»å¸¸æ¼æµ‹</li>
<li>æ‰“åŒ…éœ€è¦20åˆ†é’Ÿï¼Œä¸”å®¹æ˜“å‡ºé”™</li>
<li>ä¸åŒå¼€å‘è€…ç¯å¢ƒä¸ä¸€è‡´</li>
<li>å‘å¸ƒæµç¨‹ç¹ç</li>
</ol>
<h4 data-id="heading-34">7.2 åˆ†é˜¶æ®µå®æ–½è‡ªåŠ¨åŒ–</h4>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šå®ç°åŸºç¡€CI</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> æ·»åŠ åŸºç¡€æµ‹è¯•æµæ°´çº¿</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> ä»£ç è´¨é‡æ£€æŸ¥</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> é…ç½®GitHub Actions</li>
</ul>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼šè‡ªåŠ¨åŒ–æ„å»º</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Androidè‡ªåŠ¨æ‰“åŒ…</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> iOSè‡ªåŠ¨æ‰“åŒ…</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¤šç¯å¢ƒé…ç½®</li>
</ul>
<p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šè‡ªåŠ¨åŒ–å‘å¸ƒ</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æµ‹è¯•ç¯å¢ƒè‡ªåŠ¨åˆ†å‘</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨å‘å¸ƒ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ç›‘æ§ä¸å‘Šè­¦</li>
</ul>
<h4 data-id="heading-35">7.3 é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/ecommerce-ci.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">E-commerce</span> <span class="hljs-string">App</span> <span class="hljs-string">CI/CD</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">develop</span>]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>, <span class="hljs-string">develop</span>]
  <span class="hljs-attr">schedule:</span>
    <span class="hljs-comment"># æ¯å¤©å‡Œæ™¨2ç‚¹è·‘ä¸€éæµ‹è¯•</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">cron:</span> <span class="hljs-string">'0 2 * * *'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-comment"># ä»£ç è´¨é‡</span>
  <span class="hljs-attr">quality-gate:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-attr">passed:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.quality-check.outputs.passed</span> <span class="hljs-string">}}</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Quality</span> <span class="hljs-string">Check</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">quality-check</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # ä»£ç è§„èŒƒæ£€æŸ¥
          flutter analyze . || echo "::warning::Code analysis failed"
</span>          
          <span class="hljs-comment"># æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡</span>
          <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">--coverage</span>
          <span class="hljs-string">PERCENTAGE=$(lcov</span> <span class="hljs-string">--summary</span> <span class="hljs-string">coverage/lcov.info</span> <span class="hljs-string">|</span> <span class="hljs-string">grep</span> <span class="hljs-string">lines</span> <span class="hljs-string">|</span> <span class="hljs-string">awk</span> <span class="hljs-string">'{print $4}'</span> <span class="hljs-string">|</span> <span class="hljs-string">sed</span> <span class="hljs-string">'s/%//'</span><span class="hljs-string">)</span>
          <span class="hljs-string">if</span> <span class="hljs-string">((</span> <span class="hljs-string">$(echo</span> <span class="hljs-string">"$PERCENTAGE &lt; 80"</span> <span class="hljs-string">|</span> <span class="hljs-string">bc</span> <span class="hljs-string">-l)</span> <span class="hljs-string">));</span> <span class="hljs-string">then</span>
            <span class="hljs-string">echo</span> <span class="hljs-string">"::error::Test coverage $PERCENTAGE% is below 80% threshold"</span>
            <span class="hljs-string">echo</span> <span class="hljs-string">"passed=false"</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">$GITHUB_OUTPUT</span>
          <span class="hljs-string">else</span>
            <span class="hljs-string">echo</span> <span class="hljs-string">"passed=true"</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">$GITHUB_OUTPUT</span>
          <span class="hljs-string">fi</span>
          
  <span class="hljs-comment"># é›†æˆæµ‹è¯•</span>
  <span class="hljs-attr">integration-test:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">quality-gate</span>
    <span class="hljs-attr">if:</span> <span class="hljs-string">needs.quality-gate.outputs.passed</span> <span class="hljs-string">==</span> <span class="hljs-string">'true'</span>
    
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">macos-latest</span>
    
    <span class="hljs-attr">services:</span>
      <span class="hljs-comment"># å¯åŠ¨æµ‹è¯•æ•°æ®åº“</span>
      <span class="hljs-attr">postgres:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:14</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">POSTGRES_PASSWORD:</span> <span class="hljs-string">postgres</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">&gt;-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
</span>          
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">integration</span> <span class="hljs-string">tests</span> <span class="hljs-string">with</span> <span class="hljs-string">database</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">DATABASE_URL:</span> <span class="hljs-string">postgres://postgres:postgres@postgres:5432/test_db</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          flutter test integration_test/ --dart-define=DATABASE_URL=$DATABASE_URL
</span>          
  <span class="hljs-comment"># æ€§èƒ½æµ‹è¯•</span>
  <span class="hljs-attr">performance-test:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">integration-test</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">performance</span> <span class="hljs-string">benchmarks</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # è¿è¡Œæ€§èƒ½æµ‹è¯•
          flutter drive --target=test_driver/app_perf.dart
</span>          
          <span class="hljs-comment"># åˆ†ææ€§èƒ½æ•°æ®</span>
          <span class="hljs-string">dart</span> <span class="hljs-string">analyze_performance.dart</span> <span class="hljs-string">perf_data.json</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">performance</span> <span class="hljs-string">report</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">performance-report</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">perf_report.json</span>
          
  <span class="hljs-comment"># å®‰å…¨æ‰«æ</span>
  <span class="hljs-attr">security-scan:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">security</span> <span class="hljs-string">scan</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">snyk/actions/dart@master</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">SNYK_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.SNYK_TOKEN</span> <span class="hljs-string">}}</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">for</span> <span class="hljs-string">secrets</span> <span class="hljs-string">in</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">trufflesecurity/trufflehog@main</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">./</span>
          
  <span class="hljs-comment"># æŠ¥å‘Š</span>
  <span class="hljs-attr">report:</span>
    <span class="hljs-attr">needs:</span> [<span class="hljs-string">quality-gate</span>, <span class="hljs-string">integration-test</span>, <span class="hljs-string">performance-test</span>, <span class="hljs-string">security-scan</span>]
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">if:</span> <span class="hljs-string">always()</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Generate</span> <span class="hljs-string">CI/CD</span> <span class="hljs-string">Report</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          echo "# CI/CD Run Report" &gt; report.md
          echo "## Run: ${{ github.run_id }}" &gt;&gt; report.md
          echo "## Status: ${{ job.status }}" &gt;&gt; report.md
          echo "## Jobs:" &gt;&gt; report.md
          echo "- Quality Gate: ${{ needs.quality-gate.result }}" &gt;&gt; report.md
          echo "- Integration Test: ${{ needs.integration-test.result }}" &gt;&gt; report.md
          echo "- Performance Test: ${{ needs.performance-test.result }}" &gt;&gt; report.md
          echo "- Security Scan: ${{ needs.security-scan.result }}" &gt;&gt; report.md
</span>          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">report</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">ci-cd-report</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">report.md</span>
</code></pre>
<h4 data-id="heading-36">7.4 æµç¨‹ä¼˜åŒ–</h4>
<p>CI/CDä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œéœ€è¦æŒç»­ä¼˜åŒ–ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ç›‘æ§CI/CDæ€§èƒ½</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI/CD</span> <span class="hljs-string">Performance</span> <span class="hljs-string">Monitoring</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">workflow_run:</span>
    <span class="hljs-attr">workflows:</span> [<span class="hljs-string">"E-commerce App CI/CD"</span>]
    <span class="hljs-attr">types:</span> [<span class="hljs-string">completed</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">analyze-performance:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Download</span> <span class="hljs-string">workflow</span> <span class="hljs-string">artifacts</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/github-script@v6</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">script:</span> <span class="hljs-string">|
            const { data: artifacts } = await github.rest.actions.listWorkflowRunArtifacts({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: context.payload.workflow_run.id,
            });
</span>            
            <span class="hljs-string">//</span> <span class="hljs-string">åˆ†ææ‰§è¡Œæ—¶é—´</span>
            <span class="hljs-string">const</span> <span class="hljs-string">runDuration</span> <span class="hljs-string">=</span> <span class="hljs-string">new</span> <span class="hljs-string">Date(context.payload.workflow_run.updated_at)</span> <span class="hljs-bullet">-</span> 
                               <span class="hljs-string">new</span> <span class="hljs-string">Date(context.payload.workflow_run.run_started_at);</span>
            
            <span class="hljs-string">console.log(`Workflow</span> <span class="hljs-string">took</span> <span class="hljs-string">${runDuration</span> <span class="hljs-string">/</span> <span class="hljs-number">1000</span><span class="hljs-string">}</span> <span class="hljs-string">seconds`);</span>
            
            <span class="hljs-string">//</span> <span class="hljs-string">å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ</span>
            <span class="hljs-string">//</span> <span class="hljs-string">...</span>
            
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Send</span> <span class="hljs-string">to</span> <span class="hljs-string">monitoring</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # å‘é€æŒ‡æ ‡åˆ°Prometheus/Grafana
          echo "ci_duration_seconds $DURATION" | \
            curl -X POST -H "Content-Type: text/plain" \
            --data-binary @- http://monitoring.xxxx.com/metrics
</span></code></pre>
<h3 data-id="heading-37">å…«ï¼šå¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-38">8.1 GitHub Actionså¸¸è§é—®é¢˜</h4>
<p><strong>Qï¼šå·¥ä½œæµè¿è¡Œå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>Aï¼šä¼˜åŒ–æ‰‹æ®µï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 1. ä½¿ç”¨ç¼“å­˜</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v3</span>
  <span class="hljs-attr">with:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">~/.pub-cache</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">runner.os</span> <span class="hljs-string">}}-pub-${{</span> <span class="hljs-string">hashFiles('pubspec.lock')</span> <span class="hljs-string">}}</span>

<span class="hljs-comment"># 2. å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹ä»»åŠ¡</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test-android:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
  <span class="hljs-attr">test-ios:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">macos-latest</span>
  <span class="hljs-comment"># ä¸¤ä¸ªä»»åŠ¡ä¼šå¹¶è¡Œæ‰§è¡Œ</span>

<span class="hljs-comment"># 3. é¡¹ç›®å¤§å¯ä»¥è€ƒè™‘ä½¿ç”¨è‡ªæ‰˜ç®¡Runner</span>
<span class="hljs-attr">runs-on:</span> [<span class="hljs-string">self-hosted</span>, <span class="hljs-string">linux</span>, <span class="hljs-string">x64</span>]
</code></pre>
<p><strong>Qï¼šiOSæ„å»ºå¤±è´¥ï¼Œè¯ä¹¦é—®é¢˜ï¼Ÿ</strong></p>
<p>Aï¼šiOSè¯ä¹¦é…ç½®æµç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¯¼å‡ºå¼€å‘è¯ä¹¦</span>
openssl pkcs12 -<span class="hljs-keyword">in</span> certificate.p12 -out certificate.pem -nodes

<span class="hljs-comment"># 2. åœ¨GitHub Secretsä¸­å­˜å‚¨</span>
<span class="hljs-comment"># ä½¿ç”¨base64ç¼–ç </span>
<span class="hljs-built_in">base64</span> -i certificate.p12 &gt; certificate.txt

<span class="hljs-comment"># 3. åœ¨CIä¸­è¿˜åŸ</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${{ secrets.IOS_CERTIFICATE }</span>}"</span> | <span class="hljs-built_in">base64</span> --decode &gt; certificate.p12
security import certificate.p12 -k build.keychain -P <span class="hljs-string">"<span class="hljs-variable">${{ secrets.CERT_PASSWORD }</span>}"</span>
</code></pre>
<p><strong>Qï¼šå¦‚ä½•è°ƒè¯•å¤±è´¥çš„CIï¼Ÿ</strong></p>
<p>Aï¼šè°ƒè¯•æŠ€å·§ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 1. å¯ç”¨è°ƒè¯•æ—¥å¿—</span>
<span class="hljs-attr">run:</span> <span class="hljs-string">|
  # æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
  flutter build apk --verbose
</span>  
  <span class="hljs-comment"># æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡</span>
  <span class="hljs-attr">env:</span>
    <span class="hljs-attr">FLUTTER_VERBOSE:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment"># 2. ä¸Šä¼ æ„å»ºæ—¥å¿—</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">build</span> <span class="hljs-string">logs</span>
  <span class="hljs-attr">if:</span> <span class="hljs-string">failure()</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v3</span>
  <span class="hljs-attr">with:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">build-logs</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">|
      ~/flutter/bin/cache/
      build/
</span>      
<span class="hljs-comment"># 3. ä½¿ç”¨tmateè¿›è¡ŒSSHè°ƒè¯•</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">tmate</span> <span class="hljs-string">session</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">mxschmitt/action-tmate@v3</span>
  <span class="hljs-attr">if:</span> <span class="hljs-string">failure()</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span>
</code></pre>
<h4 data-id="heading-39">8.2 Flutteré—®é¢˜</h4>
<p><strong>Qï¼šä¸åŒç‰ˆæœ¬å…¼å®¹æ€§ï¼Ÿ</strong></p>
<p>Aï¼šç‰ˆæœ¬ç®¡ç†ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ä½¿ç”¨ç‰ˆæœ¬æµ‹è¯•å…¼å®¹æ€§</span>
<span class="hljs-attr">strategy:</span>
  <span class="hljs-attr">matrix:</span>
    <span class="hljs-attr">flutter-version:</span> [<span class="hljs-string">'3.7.x'</span>, <span class="hljs-string">'3.10.x'</span>, <span class="hljs-string">'stable'</span>]
    
<span class="hljs-comment"># åœ¨ä»£ç ä¸­æ£€æŸ¥ç‰ˆæœ¬</span>
<span class="hljs-string">void</span> <span class="hljs-string">checkFlutterVersion()</span> {
  <span class="hljs-string">const</span> <span class="hljs-string">minVersion</span> <span class="hljs-string">=</span> <span class="hljs-string">'3.7.0'</span><span class="hljs-string">;</span>
  <span class="hljs-string">final</span> <span class="hljs-string">currentVersion</span> <span class="hljs-string">=</span> <span class="hljs-string">FlutterVersion.instance.version;</span>
  
  <span class="hljs-string">if</span> <span class="hljs-string">(Version.parse(currentVersion)</span> <span class="hljs-string">&lt;</span> <span class="hljs-string">Version.parse(minVersion))</span> {
    <span class="hljs-string">throw</span> <span class="hljs-string">Exception('Flutter</span> <span class="hljs-string">version</span> <span class="hljs-string">$minVersion</span> <span class="hljs-string">or</span> <span class="hljs-string">higher</span> <span class="hljs-string">required');</span>
  }
}
</code></pre>
<p><strong>Qï¼šWebæ„å»ºå¤±è´¥ï¼Ÿ</strong></p>
<p>Aï¼šWebæ„å»ºé…ç½®ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ç¡®ä¿å¯ç”¨Webæ”¯æŒ</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Enable</span> <span class="hljs-string">web</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">config</span> <span class="hljs-string">--enable-web</span>

<span class="hljs-comment"># æ„å»ºWebç‰ˆæœ¬</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">for</span> <span class="hljs-string">web</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    flutter build web \
      --web-renderer canvaskit \
      --release \
      --dart-define=FLUTTER_WEB_USE_SKIA=true
      
</span><span class="hljs-comment"># å¤„ç†Webç‰¹å®šé—®é¢˜</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Fix</span> <span class="hljs-string">web</span> <span class="hljs-string">issues</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    # æ¸…ç†ç¼“å­˜
    flutter clean
</span>    
    <span class="hljs-comment"># æ›´æ–°Webå¼•æ“</span>
    <span class="hljs-string">flutter</span> <span class="hljs-string">precache</span> <span class="hljs-string">--web</span>
</code></pre>
<h4 data-id="heading-40">8.3 å®‰å…¨ä¸æƒé™é—®é¢˜</h4>
<p><strong>Qï¼šå¦‚ä½•ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Ÿ</strong></p>
<p>Aï¼šå®‰å…¨å®è·µï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 1. ä½¿ç”¨ç¯å¢ƒçº§åˆ«çš„Secrets</span>
<span class="hljs-attr">env:</span>
  <span class="hljs-attr">SUPER_SECRET_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.PRODUCTION_KEY</span> <span class="hljs-string">}}</span>

<span class="hljs-comment"># 2. æœ€å°æƒé™åŸåˆ™</span>
<span class="hljs-attr">permissions:</span>
  <span class="hljs-attr">contents:</span> <span class="hljs-string">read</span>
  <span class="hljs-attr">packages:</span> <span class="hljs-string">write</span>  <span class="hljs-comment"># åªæœ‰éœ€è¦æ—¶æ‰å†™</span>
  
<span class="hljs-comment"># 3. ä½¿ç”¨ä¸´æ—¶å‡­è¯</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Configure</span> <span class="hljs-string">AWS</span> <span class="hljs-string">credentials</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">aws-actions/configure-aws-credentials@v1</span>
  <span class="hljs-attr">with:</span>
    <span class="hljs-attr">aws-access-key-id:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_ACCESS_KEY_ID</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">aws-secret-access-key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_SECRET_ACCESS_KEY</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">aws-region:</span> <span class="hljs-string">us-east-1</span>
    
<span class="hljs-comment"># 4. å®šæœŸè½®æ¢å¯†é’¥</span>
<span class="hljs-comment"># è®¾ç½®æé†’æ¯æœˆæ›´æ–°ä¸€æ¬¡Secrets</span>
</code></pre>
<h3 data-id="heading-41">æœ€å</h3>
<p>é€šè¿‡è¿™ç¯‡æ•™ç¨‹æˆ‘ä»¬æŒæ¡äº†Flutter CI/CDçš„æ ¸å¿ƒçŸ¥è¯†ï¼Œä¸€ä¸ªå®Œç¾çš„æµæ°´çº¿æ˜¯ä¸€æ¬¡æ¬¡è¿­ä»£å‡ºæ¥çš„ï¼Œéœ€è¦ä¸æ–­ä¼˜åŒ–ã€‚<strong>å¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œåˆ«å¿˜äº†ä¸€é”®ä¸‰è¿ï¼Œæ”¯æŒä¸€ä¸‹</strong></p>
<hr/>
<p><strong>æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Geminiç®€ç›´æ— æ•Œäº†ã€‘æŒé—´æ˜Ÿæ²³ï¼šé€šè¿‡MediaPipeå®ç°æ‰‹åŠ¿æ§åˆ¶ç²’å­]]></title>    <link>https://juejin.cn/post/7585463258690863113</link>    <guid>https://juejin.cn/post/7585463258690863113</guid>    <pubDate>2025-12-20T09:15:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463258690863113" data-draft-id="7585706951583416329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Geminiç®€ç›´æ— æ•Œäº†ã€‘æŒé—´æ˜Ÿæ²³ï¼šé€šè¿‡MediaPipeå®ç°æ‰‹åŠ¿æ§åˆ¶ç²’å­"/> <meta itemprop="keywords" content="Gemini,React.js"/> <meta itemprop="datePublished" content="2025-12-20T09:15:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é±¼å°é±¼å¹²"/> <meta itemprop="url" content="https://juejin.cn/user/2162083945256777"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Geminiç®€ç›´æ— æ•Œäº†ã€‘æŒé—´æ˜Ÿæ²³ï¼šé€šè¿‡MediaPipeå®ç°æ‰‹åŠ¿æ§åˆ¶ç²’å­
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2162083945256777/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é±¼å°é±¼å¹²
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T09:15:45.000Z" title="Sat Dec 20 2025 09:15:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å—æ˜é‡‘å¤§ä½¬â€œä¸å¦‚æ‘¸é±¼å»â€çš„å¯å‘ï¼Œæˆ‘ä¹Ÿè¯•è¯• Gemini 3åšä¸€ä¸‹æ‰‹åŠ¿+ç²’å­äº¤äº’ï¼Œ ç¡®å®å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œåœ¨è¿™é‡Œç®€å•çš„åˆ†äº«ä¸‹ã€‚
githubåœ°å€ï¼šæŒé—´æ˜Ÿæ²³ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuijieya%2FGesture-Galaxy.git" target="_blank" title="https://github.com/huijieya/Gesture-Galaxy.git" ref="nofollow noopener noreferrer">github.com/huijieya/Geâ€¦</a></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f905388d114ac69818a85dd2cf3cf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6bG85bCP6bG85bmy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766826945&amp;x-signature=lrD0UZyeu9uscVe8UxT8t66b%2FIE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript">åŸºäºåŸç”Ÿh5ã€æµè§ˆå™¨ã€<span class="hljs-variable constant_">PC</span>æ‘„åƒå¤´å®ç°æ‰‹åŠ¿æ§åˆ¶ç²’å­ç‰¹æ•ˆäº¤äº’çš„é€»è¾‘ï¼Œç²’å­é»˜è®¤ç¦»æ•£ï¼Œç±»ä¼¼é“¶æ²³ç³»åˆ†å¸ƒç¼“æ…¢ç§»åŠ¨ï¼ŒåŒæ—¶æœ‰<span class="hljs-number">5</span>ç§æ‰‹åŠ¿ï¼š

æ‰‹åŠ¿<span class="hljs-number">1</span>: æ¡æ‹³ï¼Œæ¡æ‹³åç²’å­èšæ‹¢æ˜¾ç¤ºçˆ±å¿ƒçš„å½¢çŠ¶

æ‰‹åŠ¿<span class="hljs-number">2</span>: å±•å¼€æ‰‹æŒå¹¶æŒ¥æ‰‹ï¼Œå±•å¼€æ‰‹æŒæŒ¥æ‰‹åç²’å­ä»å½“å‰çŠ¶æ€æ¢å¤åˆ°ç¦»æ•£çŠ¶æ€

æ‰‹åŠ¿<span class="hljs-number">3</span>: ğŸ‘† æ¯” <span class="hljs-number">1</span> ï¼šåªæœ‰é£ŸæŒ‡ä¼¸ç›´ï¼Œå…¶ä»– <span class="hljs-number">3</span> æ ¹å¼¯æ›²ï¼Œæ­¤æ—¶ç²’å­èšæ‹¢æ˜¾ç¤ºç¬¬ä¸€å¥è¯ï¼šæ˜¥æ¥å¤å¾€

æ‰‹åŠ¿<span class="hljs-number">4</span>: âœŒ æ¯” <span class="hljs-number">2</span> ï¼šåªæœ‰é£ŸæŒ‡å’Œä¸­æŒ‡ä¼¸ç›´ï¼Œå…¶ä»– <span class="hljs-number">2</span> æ ¹å¼¯æ›²æ‰‹æ­¤æ—¶ç²’å­èšæ‹¢æ˜¾ç¤ºç¬¬äºŒå¥è¯ï¼š ç§‹æ”¶å†¬è—

æ‰‹åŠ¿<span class="hljs-number">5</span>: ğŸ‘Œ æ¯” <span class="hljs-number">3</span> ï¼šåªæœ‰ä¸­æŒ‡ã€æ— åæŒ‡ã€å°æŒ‡ä¼¸ç›´ï¼Œé£ŸæŒ‡å¼¯æ›²ï¼Œæ­¤æ—¶ç²’å­èšæ‹¢æ˜¾ç¤ºç¬¬ä¸‰å¥è¯ï¼šæˆ‘ä»¬æ¥æ—¥æ–¹é•¿
</code></pre>
<h2 data-id="heading-0">æ•ˆæœå±•ç¤º</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/692793d7f1254e37a0fa1f4787aa72a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6bG85bCP6bG85bmy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766826945&amp;x-signature=AUwLnI1AilLfnzkzxYmDz7tjPvI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h2 data-id="heading-1">æºç åœ°å€</h2>
<p>æŒé—´æ˜Ÿæ²³ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuijieya%2FGesture-Galaxy.git" target="_blank" title="https://github.com/huijieya/Gesture-Galaxy.git" ref="nofollow noopener noreferrer">github.com/huijieya/Geâ€¦</a></p>
<h2 data-id="heading-2">æºç åˆ†æ</h2>
<h3 data-id="heading-3">æ‰‹åŠ¿è¯†åˆ«æµç¨‹</h3>
<h4 data-id="heading-4">1. æ‰‹éƒ¨æ£€æµ‹åˆå§‹åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// HandTracker.tsx ä¸­åˆå§‹åŒ– MediaPipe Hands</span>
<span class="hljs-keyword">const</span> hands = <span class="hljs-keyword">new</span> (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-title class_">Hands</span>({
  <span class="hljs-attr">locateFile</span>: <span class="hljs-function">(<span class="hljs-params">file: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-string">`https://cdn.jsdelivr.net/npm/@mediapipe/hands/<span class="hljs-subst">${file}</span>`</span>
});

hands.<span class="hljs-title function_">setOptions</span>({
  <span class="hljs-attr">maxNumHands</span>: <span class="hljs-number">1</span>,           <span class="hljs-comment">// æœ€å¤šæ£€æµ‹ä¸€åªæ‰‹</span>
  <span class="hljs-attr">modelComplexity</span>: <span class="hljs-number">1</span>,       <span class="hljs-comment">// æ¨¡å‹å¤æ‚åº¦</span>
  <span class="hljs-attr">minDetectionConfidence</span>: <span class="hljs-number">0.7</span>,  <span class="hljs-comment">// æœ€å°æ£€æµ‹ç½®ä¿¡åº¦</span>
  <span class="hljs-attr">minTrackingConfidence</span>: <span class="hljs-number">0.7</span>    <span class="hljs-comment">// æœ€å°è·Ÿè¸ªç½®ä¿¡åº¦</span>
});
</code></pre>
<h4 data-id="heading-5">2. æ‰‹éƒ¨å…³é”®ç‚¹è·å–</h4>
<p>MediaPipe ä¼šæ£€æµ‹æ‰‹éƒ¨çš„21ä¸ªå…³é”®ç‚¹ï¼ˆlandmarksï¼‰ï¼Œæ¯ä¸ªå…³é”®ç‚¹åŒ…å« x, y, z åæ ‡ï¼š</p>
<ul>
<li>æŒ‡å°–: 4(æ‹‡æŒ‡), 8(é£ŸæŒ‡), 12(ä¸­æŒ‡), 16(æ— åæŒ‡), 20(å°æŒ‡)</li>
<li>æŒ‡å…³èŠ‚: ç”¨äºåˆ¤æ–­æ‰‹æŒ‡æ˜¯å¦ä¼¸ç›´</li>
</ul>
<h4 data-id="heading-6">3. æ‰‹åŠ¿åˆ†ç±»é€»è¾‘</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// gestureLogic.ts ä¸­çš„ classifyGesture å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">isExtended</span> = (<span class="hljs-params">tipIdx: <span class="hljs-built_in">number</span>, mcpIdx: <span class="hljs-built_in">number</span></span>) =&gt; landmarks[tipIdx].<span class="hljs-property">y</span> &lt; landmarks[mcpIdx].<span class="hljs-property">y</span>;

<span class="hljs-comment">// åˆ¤æ–­å„æ‰‹æŒ‡æ˜¯å¦ä¼¸ç›´</span>
<span class="hljs-keyword">const</span> indexExt = <span class="hljs-title function_">isExtended</span>(<span class="hljs-number">8</span>, <span class="hljs-number">5</span>);   <span class="hljs-comment">// é£ŸæŒ‡</span>
<span class="hljs-keyword">const</span> middleExt = <span class="hljs-title function_">isExtended</span>(<span class="hljs-number">12</span>, <span class="hljs-number">9</span>); <span class="hljs-comment">// ä¸­æŒ‡</span>
<span class="hljs-keyword">const</span> ringExt = <span class="hljs-title function_">isExtended</span>(<span class="hljs-number">16</span>, <span class="hljs-number">13</span>);  <span class="hljs-comment">// æ— åæŒ‡</span>
<span class="hljs-keyword">const</span> pinkyExt = <span class="hljs-title function_">isExtended</span>(<span class="hljs-number">20</span>, <span class="hljs-number">17</span>); <span class="hljs-comment">// å°æŒ‡</span>

<span class="hljs-comment">// æ ¹æ®æ‰‹æŒ‡çŠ¶æ€è¯†åˆ«ä¸åŒæ‰‹åŠ¿</span>
<span class="hljs-keyword">if</span> (!indexExt &amp;&amp; !middleExt &amp;&amp; !ringExt &amp;&amp; !pinkyExt) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureType</span>.<span class="hljs-property">HEART</span>; <span class="hljs-comment">// æ¡æ‹³ - æ˜¾ç¤ºçˆ±å¿ƒ</span>
}
<span class="hljs-keyword">if</span> (indexExt &amp;&amp; middleExt &amp;&amp; ringExt &amp;&amp; pinkyExt) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureType</span>.<span class="hljs-property">GALAXY</span>; <span class="hljs-comment">// æ‰‹æŒå±•å¼€ - é“¶æ²³çŠ¶æ€</span>
}
<span class="hljs-comment">// ... å…¶ä»–æ‰‹åŠ¿åˆ¤æ–­</span>
</code></pre>
<h3 data-id="heading-7">ç²’å­ç»˜åˆ¶æœºåˆ¶</h3>
<h4 data-id="heading-8">1. ç²’å­ç³»ç»Ÿåˆå§‹åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ParticleCanvas.tsx ä¸­åˆå§‹åŒ–ç²’å­</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">particles</span>: <span class="hljs-title class_">Particle</span>[] = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable constant_">PARTICLE_COUNT</span>; i++) {
    particles.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">x</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,     <span class="hljs-comment">// éšæœºåˆå§‹ä½ç½®</span>
      <span class="hljs-attr">y</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,
      <span class="hljs-attr">targetX</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-comment">// ç›®æ ‡ä½ç½®</span>
      <span class="hljs-attr">targetY</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,
      <span class="hljs-attr">vx</span>: <span class="hljs-number">0</span>,                                    <span class="hljs-comment">// é€Ÿåº¦</span>
      <span class="hljs-attr">vy</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1.5</span> + <span class="hljs-number">0.5</span>,          <span class="hljs-comment">// å¤§å°</span>
      <span class="hljs-attr">color</span>: <span class="hljs-variable constant_">COLORS</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable constant_">COLORS</span>.<span class="hljs-property">length</span>)], <span class="hljs-comment">// é¢œè‰²</span>
      <span class="hljs-attr">alpha</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.4</span> + <span class="hljs-number">0.4</span>,         <span class="hljs-comment">// é€æ˜åº¦</span>
    });
  }
  particlesRef.<span class="hljs-property">current</span> = particles;
}, []);
</code></pre>
<h4 data-id="heading-9">2. å½¢çŠ¶ç”Ÿæˆç®—æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> getShapePoints = (<span class="hljs-attr">type</span>: <span class="hljs-title class_">GestureType</span>, <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Point</span>[] =&gt; {
  <span class="hljs-keyword">const</span> centerX = width / <span class="hljs-number">2</span>;
  <span class="hljs-keyword">const</span> centerY = height / <span class="hljs-number">2</span>;
  
  <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">GestureType</span>.<span class="hljs-property">HEART</span>: 
      <span class="hljs-comment">// å¿ƒå½¢æ–¹ç¨‹å‚æ•°åŒ–ç”Ÿæˆç‚¹</span>
      <span class="hljs-comment">// x = 16sinÂ³(t)</span>
      <span class="hljs-comment">// y = 13cos(t) - 5cos(2t) - 2cos(3t) - cos(4t)</span>
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">GestureType</span>.<span class="hljs-property">TEXT_1</span>/<span class="hljs-number">2</span>/<span class="hljs-number">3</span>:
      <span class="hljs-comment">// ä½¿ç”¨ Canvas ç»˜åˆ¶æ–‡å­—å¹¶æå–åƒç´ ç‚¹</span>
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">GestureType</span>.<span class="hljs-property">GALAXY</span>:
    <span class="hljs-attr">default</span>:
      <span class="hljs-comment">// èºæ—‹é“¶æ²³å½¢çŠ¶</span>
      <span class="hljs-keyword">const</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>;
      <span class="hljs-keyword">const</span> r = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(), <span class="hljs-number">0.7</span>) * maxRadius;
      <span class="hljs-keyword">const</span> spiralFactor = <span class="hljs-number">2.0</span>;
      <span class="hljs-keyword">const</span> offset = r * (spiralFactor / maxRadius) * <span class="hljs-number">5</span>;
      points.<span class="hljs-title function_">push</span>({ 
        <span class="hljs-attr">x</span>: centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle + offset) * r, 
        <span class="hljs-attr">y</span>: centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle + offset) * r 
      });
  }
}
</code></pre>
<h4 data-id="heading-10">3. ç²’å­åŠ¨ç”»æ›´æ–°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç²’å­è¿åŠ¨å’Œæ¸²æŸ“å¾ªç¯</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// åŠé€æ˜èƒŒæ™¯è¦†ç›–äº§ç”Ÿæ‹–å°¾æ•ˆæœ</span>
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'rgba(0, 0, 0, 0.18)'</span>;
  ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>);
  
  particlesRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> {
    <span class="hljs-comment">// å¹³æ»‘æ’å€¼ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®</span>
    p.<span class="hljs-property">x</span> += (tx - p.<span class="hljs-property">x</span>) * <span class="hljs-variable constant_">LERP_FACTOR</span>;
    p.<span class="hljs-property">y</span> += (ty - p.<span class="hljs-property">y</span>) * <span class="hljs-variable constant_">LERP_FACTOR</span>;
    
    <span class="hljs-comment">// æ‰‹åŠ¿äº¤äº’å½±å“ç²’å­ä½ç½®</span>
    <span class="hljs-keyword">if</span> (hPos &amp;&amp; canInteract) {
      <span class="hljs-keyword">const</span> dx = p.<span class="hljs-property">x</span> - hPos.<span class="hljs-property">x</span>;
      <span class="hljs-keyword">const</span> dy = p.<span class="hljs-property">y</span> - hPos.<span class="hljs-property">y</span>;
      <span class="hljs-keyword">const</span> distSq = dx * dx + dy * dy;
      <span class="hljs-keyword">if</span> (distSq &lt; <span class="hljs-variable constant_">INTERACTION_RADIUS</span> * <span class="hljs-variable constant_">INTERACTION_RADIUS</span>) {
        <span class="hljs-comment">// æ’æ–¥åŠ›è®¡ç®—</span>
        <span class="hljs-keyword">const</span> dist = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(distSq);
        <span class="hljs-keyword">const</span> force = (<span class="hljs-number">1</span> - dist / <span class="hljs-variable constant_">INTERACTION_RADIUS</span>) * <span class="hljs-variable constant_">INTERACTION_STRENGTH</span>;
        p.<span class="hljs-property">x</span> += dx * force;
        p.<span class="hljs-property">y</span> += dy * force;
      }
    }
    
    <span class="hljs-comment">// æ·»åŠ éšæœºæ‰°åŠ¨ä½¿ç²’å­æ›´ç”ŸåŠ¨</span>
    p.<span class="hljs-property">x</span> += (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">0.6</span>;
    p.<span class="hljs-property">y</span> += (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">0.6</span>;
    
    <span class="hljs-comment">// ç»˜åˆ¶ç²’å­</span>
    ctx.<span class="hljs-property">fillStyle</span> = p.<span class="hljs-property">color</span>;
    ctx.<span class="hljs-property">globalAlpha</span> = p.<span class="hljs-property">alpha</span>;
    ctx.<span class="hljs-title function_">beginPath</span>();
    ctx.<span class="hljs-title function_">arc</span>(p.<span class="hljs-property">x</span>, p.<span class="hljs-property">y</span>, p.<span class="hljs-property">size</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
    ctx.<span class="hljs-title function_">fill</span>();
  });
  
  animationRef.<span class="hljs-property">current</span> = <span class="hljs-title function_">requestAnimationFrame</span>(render);
};
</code></pre>
<h4 data-id="heading-11">4. é“¶æ²³æ—‹è½¬æ•ˆæœ</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é“¶æ²³çŠ¶æ€ä¸‹çš„æ—‹è½¬åŠ¨ç”»</span>
galaxyAngleRef.<span class="hljs-property">current</span> += <span class="hljs-variable constant_">GALAXY_ROTATION_SPEED</span>;
<span class="hljs-keyword">const</span> cosA = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(galaxyAngleRef.<span class="hljs-property">current</span>);
<span class="hljs-keyword">const</span> sinA = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(galaxyAngleRef.<span class="hljs-property">current</span>);

<span class="hljs-comment">// å¯¹æ¯ä¸ªç²’å­åº”ç”¨æ—‹è½¬å˜æ¢</span>
<span class="hljs-keyword">const</span> dx = p.<span class="hljs-property">targetX</span> - cx;
<span class="hljs-keyword">const</span> dy = p.<span class="hljs-property">targetY</span> - cy;
tx = cx + dx * cosA - dy * sinA;
ty = cy + dx * sinA + dy * cosA;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ConcurrentHashMapå®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7585468725332394038</link>    <guid>https://juejin.cn/post/7585468725332394038</guid>    <pubDate>2025-12-20T09:20:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585468725332394038" data-draft-id="7585412203978948651" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ConcurrentHashMapå®ç°åŸç†"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-20T09:20:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ConcurrentHashMapå®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T09:20:39.000Z" title="Sat Dec 20 2025 09:20:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»30åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ç†è®ºçŸ¥è¯†ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-1">1.1 ä¸ºä»€ä¹ˆéœ€è¦ConcurrentHashMapï¼Ÿ</h3>
<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä½¿ç”¨Mapæ¥å­˜å‚¨å…±äº«æ•°æ®ã€‚ä½†æ™®é€šçš„<code>HashMap</code>å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šå‡ºç°ä¸¥é‡é—®é¢˜ã€‚</p>
<p><strong>HashMapçš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼š</strong></p>
<ol>
<li>
<p><strong>æ•°æ®ä¸¢å¤±</strong>ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶putï¼Œå¯èƒ½å¯¼è‡´ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®è¢«è¦†ç›–</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶æ‰§è¡Œput</span>
Thread-<span class="hljs-number">1</span>: put(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>)  <span class="hljs-comment">// è®¡ç®—åˆ°index=5</span>
Thread-<span class="hljs-number">2</span>: put(<span class="hljs-string">"key2"</span>, <span class="hljs-string">"value2"</span>)  <span class="hljs-comment">// ä¹Ÿè®¡ç®—åˆ°index=5</span>
<span class="hljs-comment">// ç»“æœï¼šåªæœ‰ä¸€ä¸ªæ•°æ®è¢«ä¿å­˜ï¼Œå¦ä¸€ä¸ªä¸¢å¤±</span>
</code></pre>
</li>
<li>
<p><strong>æ­»å¾ªç¯é—®é¢˜ï¼ˆJDK 1.7ï¼‰</strong>ï¼šæ‰©å®¹æ—¶å¤šçº¿ç¨‹å¹¶å‘å¯¼è‡´é“¾è¡¨æˆç¯</p>
<ul>
<li>çº¿ç¨‹Aæ‰©å®¹åˆ°ä¸€åŠè¢«æŒ‚èµ·</li>
<li>çº¿ç¨‹Bå®Œæˆæ‰©å®¹ï¼Œé“¾è¡¨åè½¬</li>
<li>çº¿ç¨‹Aæ¢å¤æ‰§è¡Œï¼Œå½¢æˆç¯å½¢é“¾è¡¨</li>
<li>getæ“ä½œæ—¶CPU 100%ï¼Œæ— é™å¾ªç¯</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šsize()è¿”å›å€¼ä¸å‡†ç¡®ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­æ•°æ®å˜åŒ–</p>
</li>
</ol>
<h3 data-id="heading-2">1.2 Hashtableçš„æ€§èƒ½é—®é¢˜</h3>
<p><code>Hashtable</code>é€šè¿‡å¯¹æ‰€æœ‰æ–¹æ³•åŠ <code>synchronized</code>å®ç°çº¿ç¨‹å®‰å…¨ï¼Œä½†æ€§èƒ½æå·®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> { ... }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> { ... }
</code></pre>
<p><strong>æ€§èƒ½é—®é¢˜</strong>ï¼š</p>
<ul>
<li><strong>å…¨è¡¨é”</strong>ï¼šæ— è®ºæ“ä½œå“ªä¸ªæ¡¶ï¼Œéƒ½è¦é”ä½æ•´ä¸ªè¡¨</li>
<li><strong>è¯»å†™äº’æ–¥</strong>ï¼šå³ä½¿åªæ˜¯è¯»å–ï¼Œä¹Ÿéœ€è¦ç­‰å¾…å†™æ“ä½œé‡Šæ”¾é”</li>
<li><strong>å¹¶å‘åº¦ä¸º1</strong>ï¼šåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®</li>
</ul>
<p><strong>æ€§èƒ½æµ‹è¯•æ•°æ®</strong>ï¼š</p>
<ul>
<li>å•çº¿ç¨‹ï¼šHashMap â‰ˆ Hashtable</li>
<li>10çº¿ç¨‹å¹¶å‘ï¼šHashMapä¸å®‰å…¨ï¼ŒHashtableååé‡ä»…ä¸ºHashMapçš„1/10</li>
</ul>
<h3 data-id="heading-3">1.3 Collections.synchronizedMapçš„å±€é™æ€§</h3>
<p><code>Collections.synchronizedMap</code>æ˜¯å¯¹Mapçš„ç®€å•åŒ…è£…ï¼š</p>
<pre><code class="hljs language-java" lang="java">Map&lt;K,V&gt; syncMap = Collections.synchronizedMap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;());

<span class="hljs-comment">// åº•å±‚å®ç°</span>
<span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
    <span class="hljs-keyword">synchronized</span> (mutex) {  <span class="hljs-comment">// mutex = this</span>
        <span class="hljs-keyword">return</span> m.put(key, value);
    }
}
</code></pre>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>æœ¬è´¨ä»æ˜¯<strong>å…¨è¡¨é”</strong>ï¼Œæ€§èƒ½ä¸Hashtableç±»ä¼¼</li>
<li>è¿­ä»£æ—¶éœ€è¦æ‰‹åŠ¨åŠ é”ï¼Œå¦åˆ™æŠ›<code>ConcurrentModificationException</code></li>
<li>å¤åˆæ“ä½œï¼ˆå¦‚putIfAbsentï¼‰ä¸æ˜¯åŸå­çš„ï¼Œéœ€è¦é¢å¤–åŠ é”</li>
</ul>
<h3 data-id="heading-4">1.4 ConcurrentHashMapçš„è®¾è®¡ç›®æ ‡</h3>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œ<code>ConcurrentHashMap</code>åº”è¿è€Œç”Ÿï¼Œè®¾è®¡ç›®æ ‡ï¼š</p>
<ol>
<li><strong>é«˜å¹¶å‘</strong>ï¼šæ”¯æŒé«˜å¹¶å‘è¯»å†™ï¼Œé”ç²’åº¦ç»†åŒ–</li>
<li><strong>é«˜æ€§èƒ½</strong>ï¼šè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œå±€éƒ¨é”</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li><strong>å¼±ä¸€è‡´æ€§</strong>ï¼šå…è®¸è¯»åˆ°ç¨æ—§çš„æ•°æ®ï¼Œæ¢å–æ€§èƒ½</li>
</ol>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<ul>
<li><strong>åˆ†æ®µé”ï¼ˆJDK 1.7ï¼‰</strong>ï¼šå°†Mapåˆ†ä¸ºå¤šä¸ªSegmentï¼Œæ¯ä¸ªSegmentç‹¬ç«‹åŠ é”</li>
<li><strong>CAS + synchronizedï¼ˆJDK 1.8ï¼‰</strong>ï¼šæ›´ç»†ç²’åº¦çš„é”ï¼Œé”å®šå•ä¸ªNode</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€åŸç†æ·±åº¦å‰–æ</h2>
<h3 data-id="heading-6">2.1 JDK 1.7 Segmentåˆ†æ®µé”æœºåˆ¶</h3>
<h4 data-id="heading-7">2.1.1 Segmentæ•°ç»„ç»“æ„</h4>
<p>JDK 1.7çš„<code>ConcurrentHashMap</code>é‡‡ç”¨<strong>Segmentæ•°ç»„ + HashEntryæ•°ç»„ + é“¾è¡¨</strong>çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-css" lang="css">ConcurrentHashMap
    |
    +-- Segment<span class="hljs-selector-attr">[0]</span> (extends ReentrantLock)
    |       |
    |       +-- HashEntry<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">table</span>
    |               |
    |               +-- HashEntry -&gt; HashEntry -&gt; null (é“¾è¡¨)
    |
    +-- Segment<span class="hljs-selector-attr">[1]</span>
    |       |
    |       +-- HashEntry<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">table</span>
    |
    +-- Segment<span class="hljs-selector-attr">[15]</span>  (é»˜è®¤<span class="hljs-number">16</span>ä¸ªSegment)
            |
            +-- HashEntry<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">table</span>
</code></pre>
<p><strong>æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMap</span>&lt;K,V&gt; {
    <span class="hljs-comment">// Segmentæ•°ç»„</span>
    <span class="hljs-keyword">final</span> Segment&lt;K,V&gt;[] segments;

    <span class="hljs-comment">// Segmentç»§æ‰¿ReentrantLock</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segment</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReentrantLock</span> {
        <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;  <span class="hljs-comment">// HashEntryæ•°ç»„</span>
        <span class="hljs-keyword">transient</span> <span class="hljs-type">int</span> count;  <span class="hljs-comment">// Segmentä¸­å…ƒç´ æ•°é‡</span>
        <span class="hljs-keyword">transient</span> <span class="hljs-type">int</span> modCount;  <span class="hljs-comment">// ä¿®æ”¹æ¬¡æ•°</span>
        <span class="hljs-keyword">transient</span> <span class="hljs-type">int</span> threshold;  <span class="hljs-comment">// æ‰©å®¹é˜ˆå€¼</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> loadFactor;  <span class="hljs-comment">// åŠ è½½å› å­</span>
    }

    <span class="hljs-comment">// HashEntryèŠ‚ç‚¹</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashEntry</span>&lt;K,V&gt; {
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> hash;
        <span class="hljs-keyword">final</span> K key;
        <span class="hljs-keyword">volatile</span> V value;
        <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt; next;  <span class="hljs-comment">// volatileä¿è¯å¯è§æ€§</span>
    }
}
</code></pre>
<p><strong>å…³é”®å‚æ•°ï¼š</strong></p>
<ul>
<li><strong>concurrencyLevelï¼ˆå¹¶å‘åº¦ï¼‰</strong>ï¼šSegmentæ•°ç»„é•¿åº¦ï¼Œé»˜è®¤16</li>
<li><strong>initialCapacity</strong>ï¼šåˆå§‹å®¹é‡ï¼Œé»˜è®¤16</li>
<li><strong>loadFactor</strong>ï¼šåŠ è½½å› å­ï¼Œé»˜è®¤0.75</li>
</ul>
<h4 data-id="heading-8">2.1.2 putæ“ä½œæµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
    Segment&lt;K,V&gt; s;
    <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();  <span class="hljs-comment">// valueä¸å…è®¸null</span>

    <span class="hljs-comment">// 1. è®¡ç®—hashå€¼</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> hash(key);

    <span class="hljs-comment">// 2. å®šä½Segment (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;

    <span class="hljs-comment">// 3. è·å–Segment</span>
    <span class="hljs-keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject(segments, (j &lt;&lt; SSHIFT) + SBASE)) == <span class="hljs-literal">null</span>)
        s = ensureSegment(j);  <span class="hljs-comment">// å»¶è¿Ÿåˆå§‹åŒ–Segment</span>

    <span class="hljs-comment">// 4. è°ƒç”¨Segmentçš„putæ–¹æ³•</span>
    <span class="hljs-keyword">return</span> s.put(key, hash, value, <span class="hljs-literal">false</span>);
}

<span class="hljs-comment">// Segmentçš„putæ–¹æ³•</span>
<span class="hljs-keyword">final</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, <span class="hljs-type">int</span> hash, V value, <span class="hljs-type">boolean</span> onlyIfAbsent)</span> {
    <span class="hljs-comment">// 1. å°è¯•è·å–é”(tryLock)</span>
    HashEntry&lt;K,V&gt; node = tryLock() ? <span class="hljs-literal">null</span> :
        scanAndLockForPut(key, hash, value);  <span class="hljs-comment">// å¤±è´¥åˆ™è‡ªæ—‹è·å–é”</span>

    V oldValue;
    <span class="hljs-keyword">try</span> {
        HashEntry&lt;K,V&gt;[] tab = table;
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> (tab.length - <span class="hljs-number">1</span>) &amp; hash;  <span class="hljs-comment">// å®šä½æ¡¶</span>
        HashEntry&lt;K,V&gt; first = entryAt(tab, index);  <span class="hljs-comment">// è·å–é“¾è¡¨å¤´</span>

        <span class="hljs-comment">// 2. éå†é“¾è¡¨</span>
        <span class="hljs-keyword">for</span> (HashEntry&lt;K,V&gt; e = first;;) {
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
                K k;
                <span class="hljs-comment">// æ‰¾åˆ°ç›¸åŒkeyï¼Œæ›¿æ¢value</span>
                <span class="hljs-keyword">if</span> ((k = e.key) == key ||
                    (e.hash == hash &amp;&amp; key.equals(k))) {
                    oldValue = e.value;
                    <span class="hljs-keyword">if</span> (!onlyIfAbsent) {
                        e.value = value;
                        ++modCount;
                    }
                    <span class="hljs-keyword">break</span>;
                }
                e = e.next;
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 3. æ’å…¥æ–°èŠ‚ç‚¹</span>
                <span class="hljs-keyword">if</span> (node != <span class="hljs-literal">null</span>)
                    node.setNext(first);  <span class="hljs-comment">// å¤´æ’æ³•</span>
                <span class="hljs-keyword">else</span>
                    node = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashEntry</span>&lt;K,V&gt;(hash, key, value, first);

                <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> count + <span class="hljs-number">1</span>;
                <span class="hljs-comment">// 4. åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span>
                <span class="hljs-keyword">if</span> (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)
                    rehash(node);
                <span class="hljs-keyword">else</span>
                    setEntryAt(tab, index, node);
                ++modCount;
                count = c;
                oldValue = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">break</span>;
            }
        }
    } <span class="hljs-keyword">finally</span> {
        unlock();  <span class="hljs-comment">// é‡Šæ”¾é”</span>
    }
    <span class="hljs-keyword">return</span> oldValue;
}
</code></pre>
<p><strong>æµç¨‹æ€»ç»“ï¼š</strong></p>
<ol>
<li>è®¡ç®—hashï¼Œå®šä½Segment</li>
<li>SegmentåŠ é”ï¼ˆReentrantLockï¼‰</li>
<li>å®šä½HashEntryæ¡¶ä½ç½®</li>
<li>éå†é“¾è¡¨ï¼Œæ‰¾åˆ°åˆ™æ›¿æ¢ï¼Œå¦åˆ™å¤´æ’æ³•æ’å…¥</li>
<li>åˆ¤æ–­æ˜¯å¦æ‰©å®¹</li>
<li>é‡Šæ”¾é”</li>
</ol>
<h4 data-id="heading-9">2.1.3 getæ“ä½œ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> {
    Segment&lt;K,V&gt; s;
    HashEntry&lt;K,V&gt;[] tab;

    <span class="hljs-comment">// 1. è®¡ç®—hash</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> hash(key);

    <span class="hljs-comment">// 2. å®šä½Segment</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;

    <span class="hljs-comment">// 3. æ— é”è·å–Segmentå’Œtable</span>
    <span class="hljs-keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != <span class="hljs-literal">null</span> &amp;&amp;
        (tab = s.table) != <span class="hljs-literal">null</span>) {

        <span class="hljs-comment">// 4. éå†é“¾è¡¨æŸ¥æ‰¾ï¼ˆæ— é”ï¼‰</span>
        <span class="hljs-keyword">for</span> (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile
                 (tab, ((<span class="hljs-type">long</span>)(((tab.length - <span class="hljs-number">1</span>) &amp; h)) &lt;&lt; TSHIFT) + TBASE);
             e != <span class="hljs-literal">null</span>; e = e.next) {
            K k;
            <span class="hljs-keyword">if</span> ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k)))
                <span class="hljs-keyword">return</span> e.value;  <span class="hljs-comment">// volatileè¯»ï¼Œä¿è¯å¯è§æ€§</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ— é”è¯»å–</strong>ï¼šgetä¸åŠ é”ï¼Œä¾èµ–volatileä¿è¯å¯è§æ€§</li>
<li><strong>UNSAFEæ“ä½œ</strong>ï¼šç›´æ¥ä»å†…å­˜è¯»å–ï¼Œä¿è¯è¯»åˆ°æœ€æ–°å€¼</li>
<li><strong>æ€§èƒ½æé«˜</strong>ï¼šå¹¶å‘è¯»ä¸ä¼šé˜»å¡</li>
</ul>
<h4 data-id="heading-10">2.1.4 æ‰©å®¹æœºåˆ¶</h4>
<p><strong>Segmentç‹¬ç«‹æ‰©å®¹</strong>ï¼š</p>
<ul>
<li>åªæ‰©å®¹å•ä¸ªSegmentï¼Œä¸å½±å“å…¶ä»–Segment</li>
<li>æ‰©å®¹æ—¶æŒæœ‰Segmenté”ï¼Œé˜»å¡è¯¥Segmentçš„å†™æ“ä½œ</li>
<li>è¯»æ“ä½œä»å¯å¹¶å‘è¿›è¡Œ</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rehash</span><span class="hljs-params">(HashEntry&lt;K,V&gt; node)</span> {
    HashEntry&lt;K,V&gt;[] oldTable = table;
    <span class="hljs-type">int</span> <span class="hljs-variable">oldCapacity</span> <span class="hljs-operator">=</span> oldTable.length;

    <span class="hljs-comment">// æ‰©å®¹ä¸º2å€</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> oldCapacity &lt;&lt; <span class="hljs-number">1</span>;
    threshold = (<span class="hljs-type">int</span>)(newCapacity * loadFactor);

    HashEntry&lt;K,V&gt;[] newTable =
        (HashEntry&lt;K,V&gt;[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashEntry</span>[newCapacity];
    <span class="hljs-type">int</span> <span class="hljs-variable">sizeMask</span> <span class="hljs-operator">=</span> newCapacity - <span class="hljs-number">1</span>;

    <span class="hljs-comment">// éå†æ—§tableï¼Œé‡æ–°åˆ†é…èŠ‚ç‚¹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; oldCapacity ; i++) {
        HashEntry&lt;K,V&gt; e = oldTable[i];

        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
            HashEntry&lt;K,V&gt; next = e.next;
            <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> e.hash &amp; sizeMask;

            <span class="hljs-keyword">if</span> (next == <span class="hljs-literal">null</span>)  <span class="hljs-comment">// å•èŠ‚ç‚¹ç›´æ¥æ”¾å…¥</span>
                newTable[idx] = e;
            <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// éå†é“¾è¡¨ï¼Œé‡æ–°hashåˆ†é…</span>
                HashEntry&lt;K,V&gt; lastRun = e;
                <span class="hljs-type">int</span> <span class="hljs-variable">lastIdx</span> <span class="hljs-operator">=</span> idx;
                <span class="hljs-keyword">for</span> (HashEntry&lt;K,V&gt; last = next;
                     last != <span class="hljs-literal">null</span>;
                     last = last.next) {
                    <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> last.hash &amp; sizeMask;
                    <span class="hljs-keyword">if</span> (k != lastIdx) {
                        lastIdx = k;
                        lastRun = last;
                    }
                }
                newTable[lastIdx] = lastRun;

                <span class="hljs-comment">// Clone remaining nodes</span>
                <span class="hljs-keyword">for</span> (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) {
                    <span class="hljs-type">V</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> p.value;
                    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> p.hash;
                    <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> h &amp; sizeMask;
                    HashEntry&lt;K,V&gt; n = newTable[k];
                    newTable[k] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashEntry</span>&lt;K,V&gt;(h, p.key, v, n);
                }
            }
        }
    }

    <span class="hljs-comment">// æ’å…¥æ–°èŠ‚ç‚¹</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">nodeIndex</span> <span class="hljs-operator">=</span> node.hash &amp; sizeMask;
    node.setNext(newTable[nodeIndex]);
    newTable[nodeIndex] = node;
    table = newTable;
}
</code></pre>
<h4 data-id="heading-11">2.1.5 size()æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">final</span> Segment&lt;K,V&gt;[] segments = <span class="hljs-built_in">this</span>.segments;
    <span class="hljs-type">int</span> size;
    <span class="hljs-type">boolean</span> overflow;
    <span class="hljs-type">long</span> sum;
    <span class="hljs-type">long</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">retries</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-comment">// 1. å°è¯•2æ¬¡æ— é”ç»Ÿè®¡</span>
            <span class="hljs-keyword">if</span> (retries++ == RETRIES_BEFORE_LOCK) {
                <span class="hljs-comment">// 2. å¤±è´¥åˆ™é”å®šæ‰€æœ‰Segment</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; segments.length; ++j)
                    ensureSegment(j).lock();
            }

            sum = <span class="hljs-number">0L</span>;
            size = <span class="hljs-number">0</span>;
            overflow = <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 3. ç´¯åŠ æ‰€æœ‰Segmentçš„count</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; segments.length; ++j) {
                Segment&lt;K,V&gt; seg = segmentAt(segments, j);
                <span class="hljs-keyword">if</span> (seg != <span class="hljs-literal">null</span>) {
                    sum += seg.modCount;
                    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> seg.count;
                    <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span> || (size += c) &lt; <span class="hljs-number">0</span>)
                        overflow = <span class="hljs-literal">true</span>;
                }
            }

            <span class="hljs-comment">// 4. modCountæœªå˜åŒ–ï¼Œè¯´æ˜æœŸé—´æ²¡æœ‰ä¿®æ”¹ï¼Œè¿”å›</span>
            <span class="hljs-keyword">if</span> (sum == last)
                <span class="hljs-keyword">break</span>;
            last = sum;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (retries &gt; RETRIES_BEFORE_LOCK) {
            <span class="hljs-comment">// é‡Šæ”¾æ‰€æœ‰Segmenté”</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; segments.length; ++j)
                segmentAt(segments, j).unlock();
        }
    }
    <span class="hljs-keyword">return</span> overflow ? Integer.MAX_VALUE : size;
}
</code></pre>
<p><strong>ç­–ç•¥ï¼š</strong></p>
<ul>
<li>å…ˆå°è¯•2æ¬¡æ— é”ç»Ÿè®¡ï¼Œé€šè¿‡æ¯”è¾ƒ<code>modCount</code>åˆ¤æ–­æ˜¯å¦æœ‰ä¿®æ”¹</li>
<li>å¦‚æœ2æ¬¡ç»Ÿè®¡ç»“æœä¸€è‡´ï¼Œè¯´æ˜æœŸé—´æ— ä¿®æ”¹ï¼Œç›´æ¥è¿”å›</li>
<li>å¦åˆ™é”å®šæ‰€æœ‰Segmentï¼Œå†æ¬¡ç»Ÿè®¡</li>
</ul>
<h4 data-id="heading-12">2.1.6 ä¼˜ç¼ºç‚¹åˆ†æ</h4>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>âœ… åˆ†æ®µé”ï¼Œå¹¶å‘åº¦é«˜ï¼ˆé»˜è®¤16ï¼‰</li>
<li>âœ… è¯»æ“ä½œæ— é”ï¼Œæ€§èƒ½å¥½</li>
<li>âœ… å†™æ“ä½œåªé”å•ä¸ªSegmentï¼Œä¸å½±å“å…¶ä»–Segment</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>âŒ Segmentç²’åº¦è¾ƒç²—ï¼Œå¹¶å‘åº¦å—é™äºSegmentæ•°é‡</li>
<li>âŒ æ‰©å®¹æ—¶éœ€è¦é”å®šSegment</li>
<li>âŒ ç»“æ„å¤æ‚ï¼Œå†…å­˜å ç”¨è¾ƒå¤§</li>
</ul>
<hr/>
<h3 data-id="heading-13">2.2 JDK 1.8 CAS + synchronizedå®ç°åŸç†</h3>
<h4 data-id="heading-14">2.2.1 æ•°æ®ç»“æ„å˜åŒ–</h4>
<p>JDK 1.8å®Œå…¨é‡æ„ï¼Œ<strong>å–æ¶ˆSegment</strong>ï¼Œæ”¹ä¸º<strong>Nodeæ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ConcurrentHashMap
    |
    +-- Node<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">table</span>
            |
            +-- Node<span class="hljs-selector-attr">[0]</span> -&gt; Node -&gt; Node (é“¾è¡¨)
            |
            +-- Node<span class="hljs-selector-attr">[1]</span> -&gt; TreeNode (çº¢é»‘æ ‘)
            |                 / \
            |                /   \
            |           TreeNode TreeNode
            |
            +-- Node<span class="hljs-selector-attr">[2]</span> -&gt; ForwardingNode (æ‰©å®¹æ ‡è®°)
</code></pre>
<p><strong>æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMap</span>&lt;K,V&gt; {
    <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node&lt;K,V&gt;[] table;  <span class="hljs-comment">// Nodeæ•°ç»„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;  <span class="hljs-comment">// æ‰©å®¹æ—¶çš„æ–°è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> baseCount;  <span class="hljs-comment">// å…ƒç´ æ•°é‡åŸºæ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> sizeCtl;  <span class="hljs-comment">// æ§åˆ¶æ ‡è¯†ç¬¦</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> CounterCell[] counterCells;  <span class="hljs-comment">// è®¡æ•°æ•°ç»„</span>

    <span class="hljs-comment">// NodeèŠ‚ç‚¹ï¼ˆé“¾è¡¨ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>.Entry&lt;K,V&gt; {
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> hash;
        <span class="hljs-keyword">final</span> K key;
        <span class="hljs-keyword">volatile</span> V val;  <span class="hljs-comment">// volatileä¿è¯å¯è§æ€§</span>
        <span class="hljs-keyword">volatile</span> Node&lt;K,V&gt; next;
    }

    <span class="hljs-comment">// TreeNodeï¼ˆçº¢é»‘æ ‘ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; {
        TreeNode&lt;K,V&gt; parent;
        TreeNode&lt;K,V&gt; left;
        TreeNode&lt;K,V&gt; right;
        TreeNode&lt;K,V&gt; prev;
        <span class="hljs-type">boolean</span> red;
    }

    <span class="hljs-comment">// ForwardingNodeï¼ˆæ‰©å®¹æ ‡è®°èŠ‚ç‚¹ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForwardingNode</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt; {
        <span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] nextTable;
        ForwardingNode(Node&lt;K,V&gt;[] tab) {
            <span class="hljs-built_in">super</span>(MOVED, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <span class="hljs-comment">// hash = MOVED = -1</span>
            <span class="hljs-built_in">this</span>.nextTable = tab;
        }
    }
}
</code></pre>
<p><strong>å…³é”®å˜åŒ–ï¼š</strong></p>
<ul>
<li><strong>Nodeæ•°ç»„</strong>ï¼šå–ä»£Segmentæ•°ç»„ï¼Œç›´æ¥å­˜å‚¨Node</li>
<li><strong>TreeNode</strong>ï¼šé“¾è¡¨é•¿åº¦â‰¥8ä¸”æ•°ç»„é•¿åº¦â‰¥64æ—¶ï¼Œè½¬ä¸ºçº¢é»‘æ ‘</li>
<li><strong>ForwardingNode</strong>ï¼šæ ‡è®°æ­£åœ¨è¿ç§»çš„æ¡¶ï¼Œhashå€¼ä¸º-1</li>
</ul>
<h4 data-id="heading-15">2.2.2 putæ“ä½œè¯¦ç»†æµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
    <span class="hljs-keyword">return</span> putVal(key, value, <span class="hljs-literal">false</span>);
}

<span class="hljs-keyword">final</span> V <span class="hljs-title function_">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-type">boolean</span> onlyIfAbsent)</span> {
    <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || value == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();

    <span class="hljs-comment">// 1. è®¡ç®—hashï¼ˆæ‰°åŠ¨å‡½æ•°ï¼‰</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> spread(key.hashCode());
    <span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) {
        Node&lt;K,V&gt; f; <span class="hljs-type">int</span> n, i, fh;

        <span class="hljs-comment">// æƒ…å†µ1: tableæœªåˆå§‹åŒ–</span>
        <span class="hljs-keyword">if</span> (tab == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)
            tab = initTable();

        <span class="hljs-comment">// æƒ…å†µ2: æ¡¶ä¸ºç©ºï¼ŒCASæ’å…¥ï¼ˆæ— é”ï¼‰</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-literal">null</span>,
                         <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="hljs-literal">null</span>)))
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// CASæˆåŠŸï¼Œæ’å…¥å®Œæˆ</span>
        }

        <span class="hljs-comment">// æƒ…å†µ3: æ­£åœ¨æ‰©å®¹ï¼ˆhash == MOVEDï¼‰</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)
            tab = helpTransfer(tab, f);  <span class="hljs-comment">// å¸®åŠ©æ‰©å®¹</span>

        <span class="hljs-comment">// æƒ…å†µ4: hashå†²çªï¼Œsynchronizedé”å®šæ¡¶</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">synchronized</span> (f) {  <span class="hljs-comment">// é”å®šé“¾è¡¨/æ ‘çš„å¤´èŠ‚ç‚¹</span>
                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) {  <span class="hljs-comment">// åŒé‡æ£€æŸ¥</span>
                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) {  <span class="hljs-comment">// é“¾è¡¨</span>
                        binCount = <span class="hljs-number">1</span>;
                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) {
                            K ek;
                            <span class="hljs-comment">// æ‰¾åˆ°ç›¸åŒkeyï¼Œæ›¿æ¢value</span>
                            <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;
                                ((ek = e.key) == key ||
                                 (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))) {
                                oldVal = e.val;
                                <span class="hljs-keyword">if</span> (!onlyIfAbsent)
                                    e.val = value;
                                <span class="hljs-keyword">break</span>;
                            }
                            Node&lt;K,V&gt; pred = e;
                            <span class="hljs-comment">// åˆ°è¾¾é“¾è¡¨å°¾éƒ¨ï¼Œæ’å…¥æ–°èŠ‚ç‚¹</span>
                            <span class="hljs-keyword">if</span> ((e = e.next) == <span class="hljs-literal">null</span>) {
                                pred.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key,
                                                          value, <span class="hljs-literal">null</span>);
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) {  <span class="hljs-comment">// çº¢é»‘æ ‘</span>
                        Node&lt;K,V&gt; p;
                        binCount = <span class="hljs-number">2</span>;
                        <span class="hljs-keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,
                                                       value)) != <span class="hljs-literal">null</span>) {
                            oldVal = p.val;
                            <span class="hljs-keyword">if</span> (!onlyIfAbsent)
                                p.val = value;
                        }
                    }
                }
            }  <span class="hljs-comment">// é‡Šæ”¾synchronizedé”</span>

            <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// é“¾è¡¨é•¿åº¦ &gt;= 8ï¼Œå°è¯•æ ‘åŒ–</span>
                <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)
                    treeifyBin(tab, i);
                <span class="hljs-keyword">if</span> (oldVal != <span class="hljs-literal">null</span>)
                    <span class="hljs-keyword">return</span> oldVal;
                <span class="hljs-keyword">break</span>;
            }
        }
    }

    <span class="hljs-comment">// å¢åŠ è®¡æ•°</span>
    addCount(<span class="hljs-number">1L</span>, binCount);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>æµç¨‹å›¾ï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c69b728f5be43718222afb43c84e796~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766827239&amp;x-signature=FOA7KKkZWmPXNHFgQ%2BGa379lN2k%3D" alt="concurrenthashmap-put-flow.svg" loading="lazy"/></p>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ¡¶ä¸ºç©º</strong>ï¼šç›´æ¥CASæ’å…¥ï¼Œæ— éœ€åŠ é”</li>
<li><strong>æ­£åœ¨æ‰©å®¹</strong>ï¼šå¸®åŠ©æ‰©å®¹ï¼Œåä½œå®Œæˆ</li>
<li><strong>hashå†²çª</strong>ï¼šsynchronizedé”å®š<strong>å¤´èŠ‚ç‚¹</strong>ï¼Œç²’åº¦æç»†</li>
<li><strong>æ ‘åŒ–æ¡ä»¶</strong>ï¼šé“¾è¡¨é•¿åº¦â‰¥8 <strong>ä¸”</strong> æ•°ç»„é•¿åº¦â‰¥64</li>
</ul>
<h4 data-id="heading-16">2.2.3 getæ“ä½œ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> {
    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class="hljs-type">int</span> n, eh; K ek;

    <span class="hljs-comment">// 1. è®¡ç®—hash</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> spread(key.hashCode());

    <span class="hljs-comment">// 2. tableä¸ä¸ºç©º ä¸” æ¡¶ä¸ä¸ºç©º</span>
    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;
        (e = tabAt(tab, (n - <span class="hljs-number">1</span>) &amp; h)) != <span class="hljs-literal">null</span>) {

        <span class="hljs-comment">// 3. æ£€æŸ¥å¤´èŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> ((eh = e.hash) == h) {
            <span class="hljs-keyword">if</span> ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))
                <span class="hljs-keyword">return</span> e.val;
        }
        <span class="hljs-comment">// 4. hash &lt; 0: çº¢é»‘æ ‘æˆ–ForwardingNode</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (eh &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> (p = e.find(h, key)) != <span class="hljs-literal">null</span> ? p.val : <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 5. éå†é“¾è¡¨</span>
        <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (e.hash == h &amp;&amp;
                ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek))))
                <span class="hljs-keyword">return</span> e.val;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ— é”è¯»å–</strong>ï¼šå®Œå…¨ä¸åŠ é”ï¼Œä¾èµ–volatileä¿è¯å¯è§æ€§</li>
<li><strong>ForwardingNodeå¤„ç†</strong>ï¼šæ‰©å®¹æ—¶é€šè¿‡<code>find()</code>æ–¹æ³•åœ¨æ–°è¡¨ä¸­æŸ¥æ‰¾</li>
<li><strong>æ€§èƒ½æé«˜</strong>ï¼šå¹¶å‘è¯»ä¸ä¼šé˜»å¡</li>
</ul>
<h4 data-id="heading-17">2.2.4 æ‰©å®¹æœºåˆ¶è¯¦è§£</h4>
<p><strong>å¤šçº¿ç¨‹åä½œæ‰©å®¹</strong>æ˜¯JDK 1.8çš„äº®ç‚¹ï¼Œæ ¸å¿ƒæ€æƒ³ï¼š</p>
<ul>
<li>å°†æ‰©å®¹ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°ä»»åŠ¡</li>
<li>å¤šä¸ªçº¿ç¨‹å¹¶å‘è¿ç§»ä¸åŒåŒºé—´çš„æ•°æ®</li>
<li>ä½¿ç”¨<code>ForwardingNode</code>æ ‡è®°å·²è¿ç§»çš„æ¡¶</li>
</ul>
<p><strong>å…³é”®å˜é‡ï¼š</strong></p>
<ul>
<li><code>sizeCtl</code>ï¼šæ§åˆ¶æ ‡è¯†ç¬¦
<ul>
<li><code>-1</code>ï¼šæ­£åœ¨åˆå§‹åŒ–</li>
<li><code>-(1 + nThreads)</code>ï¼šæ­£åœ¨æ‰©å®¹ï¼ŒnThreadsä¸ºå‚ä¸æ‰©å®¹çš„çº¿ç¨‹æ•°</li>
<li><code>&gt; 0</code>ï¼šä¸‹æ¬¡æ‰©å®¹é˜ˆå€¼</li>
</ul>
</li>
<li><code>transferIndex</code>ï¼šä¸‹ä¸€ä¸ªå¾…è¿ç§»çš„æ¡¶ç´¢å¼•</li>
<li><code>stride</code>ï¼šæ¯ä¸ªçº¿ç¨‹å¤„ç†çš„æ¡¶æ•°é‡ï¼ˆæœ€å°16ï¼‰</li>
</ul>
<p><strong>æ‰©å®¹æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> tab.length, stride;

    <span class="hljs-comment">// 1. è®¡ç®—æ¯ä¸ªçº¿ç¨‹å¤„ç†çš„æ¡¶æ•°ï¼ˆstrideï¼‰</span>
    <span class="hljs-keyword">if</span> ((stride = (NCPU &gt; <span class="hljs-number">1</span>) ? (n &gt;&gt;&gt; <span class="hljs-number">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)
        stride = MIN_TRANSFER_STRIDE;

    <span class="hljs-comment">// 2. åˆå§‹åŒ–æ–°è¡¨</span>
    <span class="hljs-keyword">if</span> (nextTab == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">try</span> {
            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;?,?&gt;[n &lt;&lt; <span class="hljs-number">1</span>];  <span class="hljs-comment">// 2å€æ‰©å®¹</span>
            nextTab = nt;
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            sizeCtl = Integer.MAX_VALUE;
            <span class="hljs-keyword">return</span>;
        }
        nextTable = nextTab;
        transferIndex = n;  <span class="hljs-comment">// ä»åå¾€å‰è¿ç§»</span>
    }

    <span class="hljs-type">int</span> <span class="hljs-variable">nextn</span> <span class="hljs-operator">=</span> nextTab.length;
    ForwardingNode&lt;K,V&gt; fwd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForwardingNode</span>&lt;K,V&gt;(nextTab);
    <span class="hljs-type">boolean</span> <span class="hljs-variable">advance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-variable">finishing</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// 3. å¾ªç¯å¤„ç†æ¯ä¸ªæ¡¶</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, bound = <span class="hljs-number">0</span>;;) {
        Node&lt;K,V&gt; f; <span class="hljs-type">int</span> fh;

        <span class="hljs-comment">// 3.1 é¢†å–ä»»åŠ¡ï¼šCASè·å–[bound, i]åŒºé—´</span>
        <span class="hljs-keyword">while</span> (advance) {
            <span class="hljs-type">int</span> nextIndex, nextBound;
            <span class="hljs-keyword">if</span> (--i &gt;= bound || finishing)
                advance = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((nextIndex = transferIndex) &lt;= <span class="hljs-number">0</span>) {
                i = -<span class="hljs-number">1</span>;
                advance = <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt
                     (<span class="hljs-built_in">this</span>, TRANSFERINDEX, nextIndex,
                      nextBound = (nextIndex &gt; stride ?
                                   nextIndex - stride : <span class="hljs-number">0</span>))) {
                bound = nextBound;
                i = nextIndex - <span class="hljs-number">1</span>;
                advance = <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-comment">// 3.2 å®Œæˆæ£€æŸ¥</span>
        <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span> || i &gt;= n || i + n &gt;= nextn) {
            <span class="hljs-type">int</span> sc;
            <span class="hljs-keyword">if</span> (finishing) {
                nextTable = <span class="hljs-literal">null</span>;
                table = nextTab;
                sizeCtl = (n &lt;&lt; <span class="hljs-number">1</span>) - (n &gt;&gt;&gt; <span class="hljs-number">1</span>);  <span class="hljs-comment">// 0.75 * 2n</span>
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-comment">// å½“å‰çº¿ç¨‹å®Œæˆï¼Œæ‰©å®¹çº¿ç¨‹æ•°-1</span>
            <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc = sizeCtl, sc - <span class="hljs-number">1</span>)) {
                <span class="hljs-keyword">if</span> ((sc - <span class="hljs-number">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)
                    <span class="hljs-keyword">return</span>;
                finishing = advance = <span class="hljs-literal">true</span>;
                i = n;
            }
        }

        <span class="hljs-comment">// 3.3 æ¡¶ä¸ºç©ºï¼Œæ”¾ç½®ForwardingNode</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i)) == <span class="hljs-literal">null</span>)
            advance = casTabAt(tab, i, <span class="hljs-literal">null</span>, fwd);

        <span class="hljs-comment">// 3.4 å·²ç»å¤„ç†è¿‡ï¼ˆForwardingNodeï¼‰</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)
            advance = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// 3.5 è¿ç§»æ•°æ®</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">synchronized</span> (f) {  <span class="hljs-comment">// é”å®šæ—§æ¡¶</span>
                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) {
                    Node&lt;K,V&gt; ln, hn;
                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) {  <span class="hljs-comment">// é“¾è¡¨</span>
                        <span class="hljs-comment">// æ ¹æ®hash &amp; n åˆ†ä¸ºé«˜ä½å’Œä½ä½é“¾è¡¨</span>
                        <span class="hljs-type">int</span> <span class="hljs-variable">runBit</span> <span class="hljs-operator">=</span> fh &amp; n;
                        Node&lt;K,V&gt; lastRun = f;
                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class="hljs-literal">null</span>; p = p.next) {
                            <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> p.hash &amp; n;
                            <span class="hljs-keyword">if</span> (b != runBit) {
                                runBit = b;
                                lastRun = p;
                            }
                        }
                        <span class="hljs-keyword">if</span> (runBit == <span class="hljs-number">0</span>) {
                            ln = lastRun;
                            hn = <span class="hljs-literal">null</span>;
                        }
                        <span class="hljs-keyword">else</span> {
                            hn = lastRun;
                            ln = <span class="hljs-literal">null</span>;
                        }

                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) {
                            <span class="hljs-type">int</span> <span class="hljs-variable">ph</span> <span class="hljs-operator">=</span> p.hash; <span class="hljs-type">K</span> <span class="hljs-variable">pk</span> <span class="hljs-operator">=</span> p.key; <span class="hljs-type">V</span> <span class="hljs-variable">pv</span> <span class="hljs-operator">=</span> p.val;
                            <span class="hljs-keyword">if</span> ((ph &amp; n) == <span class="hljs-number">0</span>)
                                ln = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(ph, pk, pv, ln);
                            <span class="hljs-keyword">else</span>
                                hn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(ph, pk, pv, hn);
                        }

                        <span class="hljs-comment">// ä½ä½é“¾è¡¨æ”¾åœ¨åŸä½ç½® i</span>
                        setTabAt(nextTab, i, ln);
                        <span class="hljs-comment">// é«˜ä½é“¾è¡¨æ”¾åœ¨ i + n</span>
                        setTabAt(nextTab, i + n, hn);
                        <span class="hljs-comment">// æ—§è¡¨è¯¥ä½ç½®æ”¾ForwardingNode</span>
                        setTabAt(tab, i, fwd);
                        advance = <span class="hljs-literal">true</span>;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) {  <span class="hljs-comment">// çº¢é»‘æ ‘</span>
                        <span class="hljs-comment">// æ ‘çš„è¿ç§»é€»è¾‘ï¼ˆçœç•¥ï¼‰</span>
                        ...
                    }
                }
            }
        }
    }
}
</code></pre>
<p><strong>æ‰©å®¹æµç¨‹å›¾ï¼š</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d524c07c84415f8e5ee366db93ccb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766827239&amp;x-signature=syyvRCDAs%2FqgY%2FkFZE%2B5oRApr9I%3D" alt="concurrenthashmap-resize-flow.svg" loading="lazy"/></p>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ä»»åŠ¡åˆ†é…</strong>ï¼šCASè·å–å¾…è¿ç§»åŒºé—´ï¼Œé¿å…é‡å¤</li>
<li><strong>ForwardingNode</strong>ï¼šæ ‡è®°å·²è¿ç§»ï¼Œgetæ—¶é‡å®šå‘åˆ°æ–°è¡¨</li>
<li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šè¿ç§»æ—¶é”å®šæ—§æ¡¶ï¼Œä¸å½±å“å…¶ä»–æ¡¶</li>
<li><strong>é«˜æ•ˆåä½œ</strong>ï¼šputé‡åˆ°æ‰©å®¹æ—¶ä¼š<code>helpTransfer()</code>å¸®å¿™</li>
</ul>
<h4 data-id="heading-18">2.2.5 size()æ–¹æ³•</h4>
<p>JDK 1.8ä½¿ç”¨<strong>LongAdderæ€æƒ³</strong>å®ç°é«˜æ€§èƒ½è®¡æ•°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
    <span class="hljs-type">long</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> sumCount();
    <span class="hljs-keyword">return</span> ((n &lt; <span class="hljs-number">0L</span>) ? <span class="hljs-number">0</span> :
            (n &gt; (<span class="hljs-type">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE :
            (<span class="hljs-type">int</span>)n);
}

<span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sumCount</span><span class="hljs-params">()</span> {
    CounterCell[] as = counterCells; CounterCell a;
    <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> baseCount;
    <span class="hljs-keyword">if</span> (as != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// ç´¯åŠ æ‰€æœ‰CounterCell</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; as.length; ++i) {
            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-literal">null</span>)
                sum += a.value;
        }
    }
    <span class="hljs-keyword">return</span> sum;
}

<span class="hljs-comment">// å¢åŠ è®¡æ•°</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCount</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">int</span> check)</span> {
    CounterCell[] as; <span class="hljs-type">long</span> b, s;

    <span class="hljs-comment">// å°è¯•CASæ›´æ–°baseCount</span>
    <span class="hljs-keyword">if</span> ((as = counterCells) != <span class="hljs-literal">null</span> ||
        !U.compareAndSwapLong(<span class="hljs-built_in">this</span>, BASECOUNT, b = baseCount, s = b + x)) {

        CounterCell a; <span class="hljs-type">long</span> v; <span class="hljs-type">int</span> m;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">uncontended</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// CASå¤±è´¥ï¼Œæ›´æ–°CounterCell</span>
        <span class="hljs-keyword">if</span> (as == <span class="hljs-literal">null</span> || (m = as.length - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> ||
            (a = as[ThreadLocalRandom.getProbe() &amp; m]) == <span class="hljs-literal">null</span> ||
            !(uncontended =
              U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) {
            fullAddCount(x, uncontended);  <span class="hljs-comment">// æ‰©å®¹CounterCellæ•°ç»„</span>
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (check &lt;= <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span>;
        s = sumCount();
    }

    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹</span>
    <span class="hljs-keyword">if</span> (check &gt;= <span class="hljs-number">0</span>) {
        ...
    }
}
</code></pre>
<p><strong>è®¡æ•°åŸç†ï¼š</strong></p>
<ul>
<li><strong>baseCount</strong>ï¼šåŸºç¡€è®¡æ•°</li>
<li><strong>CounterCell[]</strong>ï¼šåˆ†æ®µè®¡æ•°æ•°ç»„ï¼Œå‡å°‘CASå†²çª</li>
<li><strong>æ€»æ•° = baseCount + Î£(counterCells[i].value)</strong></li>
</ul>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>é«˜å¹¶å‘ä¸‹æ€§èƒ½ä¼˜ç§€ï¼Œé¿å…å•ç‚¹CASç«äº‰</li>
<li>size()ç›´æ¥æ±‚å’Œï¼Œæ— éœ€åŠ é”</li>
</ul>
<h4 data-id="heading-19">2.2.6 ä¸ºä»€ä¹ˆæ”¾å¼ƒåˆ†æ®µé”ï¼Ÿ</h4>













































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>JDK 1.7 Segment</th><th>JDK 1.8 CAS + synchronized</th></tr></thead><tbody><tr><td><strong>é”ç²’åº¦</strong></td><td>Segmentçº§åˆ«ï¼ˆç²—ï¼‰</td><td>Nodeçº§åˆ«ï¼ˆç»†ï¼‰</td></tr><tr><td><strong>å¹¶å‘åº¦</strong></td><td>Segmentæ•°é‡ï¼ˆé»˜è®¤16ï¼‰</td><td>æ•°ç»„é•¿åº¦ï¼ˆåŠ¨æ€ï¼‰</td></tr><tr><td><strong>æ‰©å®¹</strong></td><td>å•Segmentæ‰©å®¹</td><td>å…¨è¡¨æ‰©å®¹ï¼Œå¤šçº¿ç¨‹åä½œ</td></tr><tr><td><strong>ç»“æ„å¤æ‚åº¦</strong></td><td>ä¸‰å±‚ç»“æ„ï¼ˆSegment-HashEntry-é“¾è¡¨ï¼‰</td><td>äºŒå±‚ç»“æ„ï¼ˆNode-é“¾è¡¨/æ ‘ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆSegmentå¼€é”€ï¼‰</td><td>è¾ƒå°</td></tr><tr><td><strong>è¯»æ€§èƒ½</strong></td><td>é«˜ï¼ˆvolatileï¼‰</td><td>é«˜ï¼ˆvolatileï¼‰</td></tr><tr><td><strong>å†™æ€§èƒ½</strong></td><td>ä¸­ï¼ˆReentrantLockï¼‰</td><td>é«˜ï¼ˆCAS + synchronizedä¼˜åŒ–ï¼‰</td></tr></tbody></table>
<p><strong>æ”¾å¼ƒåŸå› ï¼š</strong></p>
<ol>
<li><strong>Segmentç²’åº¦è¿‡ç²—</strong>ï¼šå¹¶å‘åº¦å—é™ï¼Œæœ€å¤š16ä¸ªçº¿ç¨‹å¹¶å‘å†™</li>
<li><strong>synchronizedä¼˜åŒ–</strong>ï¼šJDK 1.6åsynchronizedæ€§èƒ½å¤§å¹…æå‡ï¼ˆé”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ï¼‰</li>
<li><strong>CASæ— é”æ›´å¿«</strong>ï¼šæ¡¶ä¸ºç©ºæ—¶CASç›´æ¥æ’å…¥ï¼Œæ€§èƒ½æ›´é«˜</li>
<li><strong>æ‰©å®¹æ›´é«˜æ•ˆ</strong>ï¼šå¤šçº¿ç¨‹åä½œæ‰©å®¹ï¼Œæ¯”å•Segmentæ‰©å®¹å¿«</li>
</ol>
<hr/>
<h3 data-id="heading-20">2.3 ä¸å…¶ä»–çº¿ç¨‹å®‰å…¨Mapå¯¹æ¯”</h3>





















































































<table><thead><tr><th>ç‰¹æ€§</th><th>HashMap</th><th>Hashtable</th><th>synchronizedMap</th><th>ConcurrentHashMap 1.7</th><th>ConcurrentHashMap 1.8</th></tr></thead><tbody><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>âŒ å¦</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td></tr><tr><td><strong>é”ç²’åº¦</strong></td><td>-</td><td>å…¨è¡¨é”</td><td>å…¨è¡¨é”</td><td>Segmenté”</td><td>Nodeé”</td></tr><tr><td><strong>å¹¶å‘åº¦</strong></td><td>-</td><td>1</td><td>1</td><td>16ï¼ˆé»˜è®¤ï¼‰</td><td>æ•°ç»„é•¿åº¦</td></tr><tr><td><strong>keyå…è®¸null</strong></td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âŒ å¦</td></tr><tr><td><strong>valueå…è®¸null</strong></td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âŒ å¦</td></tr><tr><td><strong>è¿­ä»£å™¨</strong></td><td>fail-fast</td><td>fail-fast</td><td>fail-fast</td><td>fail-safe</td><td>fail-safe</td></tr><tr><td><strong>æ€§èƒ½ï¼ˆå•çº¿ç¨‹ï¼‰</strong></td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>æ€§èƒ½ï¼ˆå¹¶å‘ï¼‰</strong></td><td>-</td><td>â­</td><td>â­</td><td>â­â­â­</td><td>â­â­â­â­â­</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å•çº¿ç¨‹</td><td>ä½å¹¶å‘</td><td>ä½å¹¶å‘</td><td>ä¸­é«˜å¹¶å‘</td><td>é«˜å¹¶å‘</td></tr></tbody></table>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼ˆ10çº¿ç¨‹å¹¶å‘put 100ä¸‡æ¬¡ï¼‰ï¼š</strong></p>



































<table><thead><tr><th>å®ç°</th><th>è€—æ—¶</th><th>ååé‡</th></tr></thead><tbody><tr><td>HashMap</td><td>ä¸å®‰å…¨</td><td>-</td></tr><tr><td>Hashtable</td><td>8500ms</td><td>11.7ä¸‡/s</td></tr><tr><td>synchronizedMap</td><td>8200ms</td><td>12.2ä¸‡/s</td></tr><tr><td>ConcurrentHashMap 1.7</td><td>2800ms</td><td>35.7ä¸‡/s</td></tr><tr><td>ConcurrentHashMap 1.8</td><td>1500ms</td><td>66.7ä¸‡/s</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-21">ä¸‰ã€å®æˆ˜åœºæ™¯åº”ç”¨</h2>
<h3 data-id="heading-22">3.1 åœºæ™¯1ï¼šé«˜å¹¶å‘æœ¬åœ°ç¼“å­˜å®ç°</h3>
<h4 data-id="heading-23">3.1.1 ä¸šåŠ¡èƒŒæ™¯</h4>
<p>ç”µå•†å¹³å°çš„å•†å“åŸºç¡€ä¿¡æ¯ï¼ˆå¦‚ç±»ç›®ã€å“ç‰Œï¼‰å˜åŒ–é¢‘ç‡ä½ï¼Œä½†æŸ¥è¯¢é¢‘ç¹ï¼Œé€‚åˆä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡è½»æ•°æ®åº“å‹åŠ›ã€‚</p>
<p><strong>éœ€æ±‚ï¼š</strong></p>
<ul>
<li>è¯»å¤šå†™å°‘ï¼ˆè¯»å†™æ¯” 100:1ï¼‰</li>
<li>æ”¯æŒé«˜å¹¶å‘è®¿é—®</li>
<li>æ•°æ®å®šæœŸåˆ·æ–°</li>
<li>æ”¯æŒæ‰‹åŠ¨å¤±æ•ˆ</li>
</ul>
<h4 data-id="heading-24">3.1.2 æŠ€æœ¯æ–¹æ¡ˆ</h4>
<p>ä½¿ç”¨<code>ConcurrentHashMap</code>ä½œä¸ºç¼“å­˜å®¹å™¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;
<span class="hljs-keyword">import</span> java.util.function.Function;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;

<span class="hljs-comment">/**
 * æœ¬åœ°ç¼“å­˜å·¥å…·ç±»
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalCache</span>&lt;K, V&gt; {
    <span class="hljs-comment">// ç¼“å­˜å®¹å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;K, CacheValue&lt;V&gt;&gt; cache;

    <span class="hljs-comment">// å®šæ—¶åˆ·æ–°ä»»åŠ¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ScheduledExecutorService scheduler;

    <span class="hljs-comment">// è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> expireTime;

    <span class="hljs-comment">// ç¼“å­˜å€¼åŒ…è£…ç±»</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheValue</span>&lt;V&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> V value;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> createTime;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheValue</span><span class="hljs-params">(V value)</span> {
            <span class="hljs-built_in">this</span>.value = value;
            <span class="hljs-built_in">this</span>.createTime = System.currentTimeMillis();
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpired</span><span class="hljs-params">(<span class="hljs-type">long</span> expireTime)</span> {
            <span class="hljs-keyword">return</span> System.currentTimeMillis() - createTime &gt; expireTime;
        }

        <span class="hljs-keyword">public</span> V <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> value;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LocalCache</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">long</span> expireTime)</span> {
        <span class="hljs-built_in">this</span>.cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(initialCapacity);
        <span class="hljs-built_in">this</span>.expireTime = expireTime;
        <span class="hljs-built_in">this</span>.scheduler = Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);

        <span class="hljs-comment">// å¯åŠ¨å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ä»»åŠ¡</span>
        startCleanupTask();
    }

    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜ï¼Œä¸å­˜åœ¨åˆ™åŠ è½½
     */</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key, Function&lt;K, V&gt; loader)</span> {
        CacheValue&lt;V&gt; cacheValue = cache.get(key);

        <span class="hljs-comment">// ç¼“å­˜å­˜åœ¨ä¸”æœªè¿‡æœŸ</span>
        <span class="hljs-keyword">if</span> (cacheValue != <span class="hljs-literal">null</span> &amp;&amp; !cacheValue.isExpired(expireTime)) {
            <span class="hljs-keyword">return</span> cacheValue.getValue();
        }

        <span class="hljs-comment">// ç¼“å­˜ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸï¼Œé‡æ–°åŠ è½½</span>
        <span class="hljs-comment">// ä½¿ç”¨computeIfAbsentä¿è¯åªåŠ è½½ä¸€æ¬¡</span>
        <span class="hljs-keyword">return</span> cache.compute(key, (k, oldValue) -&gt; {
            <span class="hljs-comment">// åŒé‡æ£€æŸ¥ï¼šå…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»åŠ è½½</span>
            <span class="hljs-keyword">if</span> (oldValue != <span class="hljs-literal">null</span> &amp;&amp; !oldValue.isExpired(expireTime)) {
                <span class="hljs-keyword">return</span> oldValue;
            }

            <span class="hljs-comment">// åŠ è½½æ•°æ®</span>
            <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> loader.apply(k);
            <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// ä¸ç¼“å­˜null</span>
            }

            log.info(<span class="hljs-string">"ç¼“å­˜åŠ è½½: key={}"</span>, k);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheValue</span>&lt;&gt;(value);
        }).getValue();
    }

    <span class="hljs-comment">/**
     * ä¸»åŠ¨è®¾ç½®ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
            cache.put(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheValue</span>&lt;&gt;(value));
        }
    }

    <span class="hljs-comment">/**
     * ä½¿ç¼“å­˜å¤±æ•ˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invalidate</span><span class="hljs-params">(K key)</span> {
        cache.remove(key);
        log.info(<span class="hljs-string">"ç¼“å­˜å¤±æ•ˆ: key={}"</span>, key);
    }

    <span class="hljs-comment">/**
     * æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        cache.clear();
        log.info(<span class="hljs-string">"ç¼“å­˜å·²æ¸…ç©º"</span>);
    }

    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜å¤§å°
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cache.size();
    }

    <span class="hljs-comment">/**
     * å¯åŠ¨å®šæœŸæ¸…ç†ä»»åŠ¡
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startCleanupTask</span><span class="hljs-params">()</span> {
        scheduler.scheduleAtFixedRate(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">int</span> <span class="hljs-variable">cleanCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
                <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

                <span class="hljs-comment">// éå†æ¸…ç†è¿‡æœŸæ•°æ®</span>
                <span class="hljs-keyword">for</span> (K key : cache.keySet()) {
                    CacheValue&lt;V&gt; value = cache.get(key);
                    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span> &amp;&amp; value.isExpired(expireTime)) {
                        cache.remove(key);
                        cleanCount++;
                    }
                }

                <span class="hljs-keyword">if</span> (cleanCount &gt; <span class="hljs-number">0</span>) {
                    log.info(<span class="hljs-string">"æ¸…ç†è¿‡æœŸç¼“å­˜: count={}, size={}"</span>, cleanCount, cache.size());
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"æ¸…ç†ç¼“å­˜å¼‚å¸¸"</span>, e);
            }
        }, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, TimeUnit.MINUTES);  <span class="hljs-comment">// æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡</span>
    }

    <span class="hljs-comment">/**
     * å…³é—­ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
        scheduler.shutdown();
        cache.clear();
    }
}
</code></pre>
<h4 data-id="heading-25">3.1.3 ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    <span class="hljs-comment">// å•†å“ç±»ç›®ç¼“å­˜ï¼Œè¿‡æœŸæ—¶é—´10åˆ†é’Ÿ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LocalCache&lt;Long, Category&gt; categoryCache =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalCache</span>&lt;&gt;(<span class="hljs-number">1000</span>, <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CategoryMapper categoryMapper;

    <span class="hljs-comment">/**
     * æŸ¥è¯¢ç±»ç›®ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">getCategory</span><span class="hljs-params">(Long categoryId)</span> {
        <span class="hljs-keyword">return</span> categoryCache.get(categoryId, id -&gt; {
            <span class="hljs-comment">// ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œä»æ•°æ®åº“åŠ è½½</span>
            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> categoryMapper.selectById(id);
            log.info(<span class="hljs-string">"ä»æ•°æ®åº“åŠ è½½ç±»ç›®: id={}"</span>, id);
            <span class="hljs-keyword">return</span> category;
        });
    }

    <span class="hljs-comment">/**
     * æ›´æ–°ç±»ç›®ï¼ˆå¤±æ•ˆç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateCategory</span><span class="hljs-params">(Category category)</span> {
        categoryMapper.updateById(category);
        <span class="hljs-comment">// æ›´æ–°åç«‹å³å¤±æ•ˆç¼“å­˜</span>
        categoryCache.invalidate(category.getId());
    }

    <span class="hljs-comment">/**
     * é¢„çƒ­ç¼“å­˜
     */</span>
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warmUpCache</span><span class="hljs-params">()</span> {
        List&lt;Category&gt; categories = categoryMapper.selectAll();
        <span class="hljs-keyword">for</span> (Category category : categories) {
            categoryCache.put(category.getId(), category);
        }
        log.info(<span class="hljs-string">"ç±»ç›®ç¼“å­˜é¢„çƒ­å®Œæˆ: size={}"</span>, categoryCache.size());
    }
}
</code></pre>
<h4 data-id="heading-26">3.1.4 ä¸ºä»€ä¹ˆä¸ç”¨Guava Cacheï¼Ÿ</h4>
<p><strong>åœºæ™¯å¯¹æ¯”ï¼š</strong></p>








































<table><thead><tr><th>åœºæ™¯</th><th>ConcurrentHashMap</th><th>Guava Cache</th></tr></thead><tbody><tr><td><strong>ç®€å•ç¼“å­˜ï¼Œæ‰‹åŠ¨æ§åˆ¶</strong></td><td>âœ… æ¨è</td><td>âŒ è¿‡åº¦è®¾è®¡</td></tr><tr><td><strong>éœ€è¦è‡ªåŠ¨è¿‡æœŸ</strong></td><td>âš ï¸ éœ€æ‰‹åŠ¨å®ç°</td><td>âœ… æ¨è</td></tr><tr><td><strong>éœ€è¦LRUæ·˜æ±°</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ¨è</td></tr><tr><td><strong>éœ€è¦ç¼“å­˜ç»Ÿè®¡</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ¨è</td></tr><tr><td><strong>æœ€å¤§å®¹é‡é™åˆ¶</strong></td><td>âš ï¸ éœ€æ‰‹åŠ¨å®ç°</td><td>âœ… æ¨è</td></tr><tr><td><strong>æ€§èƒ½è¦æ±‚æé«˜</strong></td><td>âœ… æ›´è½»é‡</td><td>âš ï¸ ç•¥é‡</td></tr></tbody></table>
<p><strong>æ¨èä½¿ç”¨Guava Cacheçš„æ”¹è¿›ç‰ˆæœ¬ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductServiceWithGuava</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LoadingCache&lt;Long, Category&gt; categoryCache = CacheBuilder.newBuilder()
        .maximumSize(<span class="hljs-number">1000</span>)  <span class="hljs-comment">// æœ€å¤§å®¹é‡</span>
        .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// å†™å…¥10åˆ†é’Ÿåè¿‡æœŸ</span>
        .recordStats()  <span class="hljs-comment">// è®°å½•ç»Ÿè®¡ä¿¡æ¯</span>
        .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, Category&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">load</span><span class="hljs-params">(Long id)</span> {
                <span class="hljs-keyword">return</span> categoryMapper.selectById(id);
            }
        });

    <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">getCategory</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> categoryCache.get(id);
        } <span class="hljs-keyword">catch</span> (ExecutionException e) {
            log.error(<span class="hljs-string">"åŠ è½½ç¼“å­˜å¤±è´¥"</span>, e);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-27">3.1.5 æ€§èƒ½æµ‹è¯•æ•°æ®</h4>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼š100ä¸ªçº¿ç¨‹å¹¶å‘æŸ¥è¯¢1000ä¸ªå•†å“ç±»ç›®</p>





























<table><thead><tr><th>å®ç°</th><th>æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°</th><th>å¹³å‡å“åº”æ—¶é—´</th><th>QPS</th></tr></thead><tbody><tr><td><strong>æ— ç¼“å­˜</strong></td><td>100,000</td><td>50ms</td><td>2000</td></tr><tr><td><strong>ConcurrentHashMapç¼“å­˜</strong></td><td>1,000</td><td>0.5ms</td><td>200,000</td></tr><tr><td><strong>Guava Cache</strong></td><td>1,000</td><td>0.6ms</td><td>166,667</td></tr></tbody></table>
<p><strong>ç»“è®º</strong>ï¼šæœ¬åœ°ç¼“å­˜æ€§èƒ½æå‡<strong>100å€</strong>ï¼Œæ•°æ®åº“å‹åŠ›é™ä½<strong>99%</strong></p>
<hr/>
<h3 data-id="heading-28">3.2 åœºæ™¯2ï¼šç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°</h3>
<h4 data-id="heading-29">3.2.1 ä¸šåŠ¡èƒŒæ™¯</h4>
<p>éœ€è¦å®æ—¶ç»Ÿè®¡å½“å‰åœ¨çº¿ç”¨æˆ·æ•°ï¼Œç”¨æˆ·ç™»å½•æ—¶æ·»åŠ ï¼Œé€€å‡ºæˆ–è¶…æ—¶æ—¶ç§»é™¤ã€‚</p>
<h4 data-id="heading-30">3.2.2 é”™è¯¯æ–¹æ¡ˆï¼šAtomicLong</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯æ–¹æ¡ˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnlineUserCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">onlineCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userLogin</span><span class="hljs-params">(Long userId)</span> {
        onlineCount.incrementAndGet();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userLogout</span><span class="hljs-params">(Long userId)</span> {
        onlineCount.decrementAndGet();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getOnlineCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> onlineCount.get();
    }
}
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ol>
<li>âŒ æ— æ³•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦çœŸçš„åœ¨çº¿ï¼ˆé‡å¤ç™»å½•ä¼šé‡å¤è®¡æ•°ï¼‰</li>
<li>âŒ æ— æ³•è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨</li>
<li>âŒ æ— æ³•åŒºåˆ†ç”¨æˆ·ç™»å½•å’Œé€€å‡º</li>
</ol>
<h4 data-id="heading-31">3.2.3 æ­£ç¡®æ–¹æ¡ˆï¼šConcurrentHashMap</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-comment">/**
 * åœ¨çº¿ç”¨æˆ·ç®¡ç†
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnlineUserManager</span> {
    <span class="hljs-comment">// åœ¨çº¿ç”¨æˆ·Map: userId -&gt; Session</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, UserSession&gt; onlineUsers =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">10000</span>);

    <span class="hljs-comment">// å®šæ—¶æ¸…ç†è¶…æ—¶ç”¨æˆ·</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span>
        Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);

    <span class="hljs-comment">// è¶…æ—¶æ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">TIMEOUT_MILLIS</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSession</span> {
        <span class="hljs-keyword">private</span> Long userId;
        <span class="hljs-keyword">private</span> String sessionId;
        <span class="hljs-keyword">private</span> String ip;
        <span class="hljs-keyword">private</span> LocalDateTime loginTime;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> lastActiveTime;  <span class="hljs-comment">// volatileä¿è¯å¯è§æ€§</span>

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserSession</span><span class="hljs-params">(Long userId, String sessionId, String ip)</span> {
            <span class="hljs-built_in">this</span>.userId = userId;
            <span class="hljs-built_in">this</span>.sessionId = sessionId;
            <span class="hljs-built_in">this</span>.ip = ip;
            <span class="hljs-built_in">this</span>.loginTime = LocalDateTime.now();
            <span class="hljs-built_in">this</span>.lastActiveTime = System.currentTimeMillis();
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isTimeout</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> System.currentTimeMillis() - lastActiveTime &gt; TIMEOUT_MILLIS;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateActiveTime</span><span class="hljs-params">()</span> {
            <span class="hljs-built_in">this</span>.lastActiveTime = System.currentTimeMillis();
        }
    }

    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¯åŠ¨å®šæœŸæ¸…ç†è¶…æ—¶ç”¨æˆ·</span>
        scheduler.scheduleAtFixedRate(() -&gt; {
            <span class="hljs-keyword">try</span> {
                cleanTimeoutUsers();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"æ¸…ç†è¶…æ—¶ç”¨æˆ·å¤±è´¥"</span>, e);
            }
        }, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, TimeUnit.MINUTES);
    }

    <span class="hljs-comment">/**
     * ç”¨æˆ·ç™»å½•
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userLogin</span><span class="hljs-params">(Long userId, String sessionId, String ip)</span> {
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserSession</span>(userId, sessionId, ip);

        <span class="hljs-comment">// putIfAbsent: åªæœ‰ä¸å­˜åœ¨æ—¶æ‰æ·»åŠ </span>
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">oldSession</span> <span class="hljs-operator">=</span> onlineUsers.putIfAbsent(userId, session);

        <span class="hljs-keyword">if</span> (oldSession != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ç”¨æˆ·å·²åœ¨çº¿ï¼Œæ›´æ–°sessionï¼ˆè¸¢å‡ºæ—§ç™»å½•ï¼‰</span>
            onlineUsers.put(userId, session);
            log.info(<span class="hljs-string">"ç”¨æˆ·é‡æ–°ç™»å½•: userId={}, oldSessionId={}, newSessionId={}"</span>,
                userId, oldSession.getSessionId(), sessionId);
        } <span class="hljs-keyword">else</span> {
            log.info(<span class="hljs-string">"ç”¨æˆ·ç™»å½•: userId={}, sessionId={}, onlineCount={}"</span>,
                userId, sessionId, onlineUsers.size());
        }
    }

    <span class="hljs-comment">/**
     * ç”¨æˆ·ç™»å‡º
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userLogout</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">removed</span> <span class="hljs-operator">=</span> onlineUsers.remove(userId);
        <span class="hljs-keyword">if</span> (removed != <span class="hljs-literal">null</span>) {
            log.info(<span class="hljs-string">"ç”¨æˆ·ç™»å‡º: userId={}, sessionId={}, onlineCount={}"</span>,
                userId, removed.getSessionId(), onlineUsers.size());
        }
    }

    <span class="hljs-comment">/**
     * æ›´æ–°ç”¨æˆ·æ´»è·ƒæ—¶é—´ï¼ˆå¿ƒè·³ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUserActiveTime</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> onlineUsers.get(userId);
        <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
            session.updateActiveTime();
        }
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨çº¿
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOnline</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> onlineUsers.containsKey(userId);
    }

    <span class="hljs-comment">/**
     * è·å–åœ¨çº¿ç”¨æˆ·æ•°
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOnlineCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> onlineUsers.size();
    }

    <span class="hljs-comment">/**
     * è·å–æ‰€æœ‰åœ¨çº¿ç”¨æˆ·
     */</span>
    <span class="hljs-keyword">public</span> List&lt;UserSession&gt; <span class="hljs-title function_">getOnlineUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(onlineUsers.values());
    }

    <span class="hljs-comment">/**
     * æ¸…ç†è¶…æ—¶ç”¨æˆ·
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanTimeoutUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">cleanCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (Long userId : onlineUsers.keySet()) {
            <span class="hljs-type">UserSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> onlineUsers.get(userId);

            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span> &amp;&amp; session.isTimeout()) {
                <span class="hljs-comment">// è¶…æ—¶ï¼Œç§»é™¤ç”¨æˆ·</span>
                <span class="hljs-keyword">if</span> (onlineUsers.remove(userId, session)) {  <span class="hljs-comment">// CASåˆ é™¤</span>
                    cleanCount++;
                    log.info(<span class="hljs-string">"æ¸…ç†è¶…æ—¶ç”¨æˆ·: userId={}, sessionId={}"</span>,
                        userId, session.getSessionId());
                }
            }
        }

        <span class="hljs-keyword">if</span> (cleanCount &gt; <span class="hljs-number">0</span>) {
            log.info(<span class="hljs-string">"æ¸…ç†è¶…æ—¶ç”¨æˆ·å®Œæˆ: cleanCount={}, onlineCount={}"</span>,
                cleanCount, onlineUsers.size());
        }
    }

    <span class="hljs-comment">/**
     * è·å–ç”¨æˆ·åœ¨çº¿æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getOnlineDuration</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> onlineUsers.get(userId);
        <span class="hljs-keyword">if</span> (session == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }

        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() -
            session.getLoginTime().atZone(ZoneId.systemDefault())
                .toInstant().toEpochMilli();
        <span class="hljs-keyword">return</span> duration / <span class="hljs-number">60000</span>;
    }

    <span class="hljs-meta">@PreDestroy</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
        scheduler.shutdown();
        onlineUsers.clear();
    }
}
</code></pre>
<h4 data-id="heading-32">3.2.4 ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OnlineUserManager onlineUserManager;

    <span class="hljs-comment">/**
     * ç”¨æˆ·ç™»å½•
     */</span>
    <span class="hljs-meta">@PostMapping("/login")</span>
    <span class="hljs-keyword">public</span> Response&lt;Void&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> LoginRequest request,
                                HttpServletRequest httpRequest)</span> {
        <span class="hljs-comment">// éªŒè¯ç”¨æˆ·åå¯†ç ...</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> authenticate(request);

        <span class="hljs-comment">// æ·»åŠ åˆ°åœ¨çº¿ç”¨æˆ·</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionId</span> <span class="hljs-operator">=</span> httpRequest.getSession().getId();
        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> httpRequest.getRemoteAddr();
        onlineUserManager.userLogin(userId, sessionId, ip);

        <span class="hljs-keyword">return</span> Response.success();
    }

    <span class="hljs-comment">/**
     * ç”¨æˆ·ç™»å‡º
     */</span>
    <span class="hljs-meta">@PostMapping("/logout")</span>
    <span class="hljs-keyword">public</span> Response&lt;Void&gt; <span class="hljs-title function_">logout</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("userId")</span> Long userId)</span> {
        onlineUserManager.userLogout(userId);
        <span class="hljs-keyword">return</span> Response.success();
    }

    <span class="hljs-comment">/**
     * å¿ƒè·³æ¥å£ï¼ˆå®šæœŸè°ƒç”¨ï¼Œå¦‚æ¯5åˆ†é’Ÿï¼‰
     */</span>
    <span class="hljs-meta">@PostMapping("/heartbeat")</span>
    <span class="hljs-keyword">public</span> Response&lt;Void&gt; <span class="hljs-title function_">heartbeat</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("userId")</span> Long userId)</span> {
        onlineUserManager.updateUserActiveTime(userId);
        <span class="hljs-keyword">return</span> Response.success();
    }

    <span class="hljs-comment">/**
     * è·å–åœ¨çº¿ç”¨æˆ·æ•°
     */</span>
    <span class="hljs-meta">@GetMapping("/online-count")</span>
    <span class="hljs-keyword">public</span> Response&lt;Integer&gt; <span class="hljs-title function_">getOnlineCount</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> onlineUserManager.getOnlineCount();
        <span class="hljs-keyword">return</span> Response.success(count);
    }

    <span class="hljs-comment">/**
     * è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
     */</span>
    <span class="hljs-meta">@GetMapping("/online-users")</span>
    <span class="hljs-keyword">public</span> Response&lt;List&lt;UserSession&gt;&gt; <span class="hljs-title function_">getOnlineUsers</span><span class="hljs-params">()</span> {
        List&lt;UserSession&gt; users = onlineUserManager.getOnlineUsers();
        <span class="hljs-keyword">return</span> Response.success(users);
    }
}
</code></pre>
<h4 data-id="heading-33">3.2.5 æ€§èƒ½å¯¹æ¯”</h4>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼š10000ä¸ªç”¨æˆ·å¹¶å‘ç™»å½•/ç™»å‡º</p>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>AtomicLongæ–¹æ¡ˆ</th><th>ConcurrentHashMapæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>å‡†ç¡®æ€§</strong></td><td>âŒ ä¸å‡†ç¡®ï¼ˆé‡å¤è®¡æ•°ï¼‰</td><td>âœ… å‡†ç¡®</td></tr><tr><td><strong>åŠŸèƒ½æ€§</strong></td><td>âŒ åªèƒ½è®¡æ•°</td><td>âœ… å¯æŸ¥è¯¢ç”¨æˆ·ã€åˆ¤æ–­åœ¨çº¿ã€è¶…æ—¶æ¸…ç†</td></tr><tr><td><strong>ç™»å½•è€—æ—¶</strong></td><td>0.01ms</td><td>0.05ms</td></tr><tr><td><strong>æŸ¥è¯¢è€—æ—¶</strong></td><td>0.001ms</td><td>0.01ms</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>8 bytes</td><td>~10MBï¼ˆ1ä¸‡ç”¨æˆ·ï¼‰</td></tr></tbody></table>
<p><strong>ç»“è®º</strong>ï¼šConcurrentHashMapåŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ€§èƒ½æŸå¤±å¯æ¥å—</p>
<hr/>
<h2 data-id="heading-34">å››ã€ç”Ÿäº§æ¡ˆä¾‹ä¸æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-35">4.1 æ¡ˆä¾‹1ï¼šæœ¬åœ°ç¼“å­˜æœªè®¾ä¸Šé™å¯¼è‡´OOM</h3>
<h4 data-id="heading-36">4.1.1 æ•…éšœç°è±¡</h4>
<p>æŸç”µå•†å¹³å°å•†å“æœåŠ¡åœ¨è¿è¡Œä¸€å‘¨åçªç„¶å‡ºç°ï¼š</p>
<ul>
<li>Javaè¿›ç¨‹OOM: <code>java.lang.OutOfMemoryError: Java heap space</code></li>
<li>é¢‘ç¹Full GCï¼Œæ¯æ¬¡GCåè€å¹´ä»£å›æ”¶å¾ˆå°‘</li>
<li>æœåŠ¡å“åº”å˜æ…¢ï¼Œæœ€ç»ˆä¸å¯ç”¨</li>
</ul>
<h4 data-id="heading-37">4.1.2 æ’æŸ¥è¿‡ç¨‹</h4>
<p><strong>Step 1: è·å–å †dump</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æ‰¾åˆ°è¿›ç¨‹ID</span>
jps -l

<span class="hljs-comment"># 2. ç”Ÿæˆå †dump</span>
jmap -dump:live,format=b,file=heap.hprof &lt;pid&gt;

<span class="hljs-comment"># 3. ä½¿ç”¨MATåˆ†æ</span>
<span class="hljs-comment"># Eclipse Memory Analyzer Tool</span>
</code></pre>
<p><strong>Step 2: MATåˆ†æ</strong></p>
<p>æ‰“å¼€<code>heap.hprof</code>ï¼ŒæŸ¥çœ‹Dominator Treeï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">Class Name                           Objects   Shallow Heap   Retained Heap
-----------------------------------------------------------------------------</span>
ConcurrentHashMap                        1         48 bytes    3.2 GB !!!
  |- Node[]                              1       800 MB        3.2 GB
<span class="hljs-code">      |- Product (è‡ªå®šä¹‰ç±»)          500,000     80 MB         2.4 GB
</span></code></pre>
<p>å‘ç°ï¼š</p>
<ul>
<li><code>ConcurrentHashMap</code>å ç”¨<strong>3.2GB</strong>å†…å­˜</li>
<li>å­˜å‚¨äº†<strong>50ä¸‡ä¸ª</strong>Productå¯¹è±¡</li>
<li>å ç”¨äº†å †å†…å­˜çš„<strong>80%</strong></li>
</ul>
<p><strong>Step 3: æŸ¥çœ‹ä»£ç </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é—®é¢˜ä»£ç </span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    <span class="hljs-comment">// âŒ æ²¡æœ‰å®¹é‡é™åˆ¶çš„ç¼“å­˜</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, Product&gt; productCache =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productCache.get(productId);
        <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
            product = productMapper.selectById(productId);
            <span class="hljs-comment">// âŒ åªputä¸removeï¼ŒæŒç»­å¢é•¿</span>
            productCache.put(productId, product);
        }
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<h4 data-id="heading-38">4.1.3 é—®é¢˜åˆ†æ</h4>
<p><strong>æ ¹æœ¬åŸå› ï¼š</strong></p>
<ol>
<li>âŒ <strong>åªputä¸remove</strong>ï¼šæ¯æ¬¡æŸ¥è¯¢æ–°å•†å“éƒ½ä¼šç¼“å­˜ï¼Œä»ä¸åˆ é™¤</li>
<li>âŒ <strong>æ²¡æœ‰è¿‡æœŸç­–ç•¥</strong>ï¼šæ—§æ•°æ®æ°¸è¿œä¸ä¼šè¿‡æœŸ</li>
<li>âŒ <strong>æ²¡æœ‰å®¹é‡é™åˆ¶</strong>ï¼šç¼“å­˜æ— é™å¢é•¿</li>
</ol>
<p><strong>å¢é•¿è¶‹åŠ¿ï¼š</strong></p>
<ul>
<li>å•†å“æ€»æ•°ï¼š100ä¸‡</li>
<li>æ¯å¤©è®¿é—®ä¸åŒå•†å“ï¼š5ä¸‡</li>
<li>7å¤©åç¼“å­˜å•†å“æ•°ï¼š35ä¸‡</li>
<li>æŒ‰æ¯ä¸ªProduct 5KBè®¡ç®—ï¼š35ä¸‡ * 5KB = 1.75GB</li>
</ul>
<h4 data-id="heading-39">4.1.4 è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>æ–¹æ¡ˆAï¼šä½¿ç”¨Guava Cacheï¼ˆæ¨èï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    <span class="hljs-comment">// âœ… ä½¿ç”¨Guava Cacheï¼Œè‡ªåŠ¨è¿‡æœŸå’Œå®¹é‡é™åˆ¶</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LoadingCache&lt;Long, Product&gt; productCache = CacheBuilder.newBuilder()
        .maximumSize(<span class="hljs-number">10000</span>)  <span class="hljs-comment">// æœ€å¤§ç¼“å­˜10000ä¸ªå•†å“</span>
        .expireAfterWrite(<span class="hljs-number">1</span>, TimeUnit.HOURS)  <span class="hljs-comment">// 1å°æ—¶åè¿‡æœŸ</span>
        .recordStats()  <span class="hljs-comment">// è®°å½•ç¼“å­˜ç»Ÿè®¡</span>
        .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, Product&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">load</span><span class="hljs-params">(Long id)</span> {
                <span class="hljs-keyword">return</span> productMapper.selectById(id);
            }
        });

    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> productCache.get(productId);
        } <span class="hljs-keyword">catch</span> (ExecutionException e) {
            log.error(<span class="hljs-string">"åŠ è½½å•†å“ç¼“å­˜å¤±è´¥: productId={}"</span>, productId, e);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">// æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡</span>
    <span class="hljs-meta">@Scheduled(fixedRate = 60000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logCacheStats</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> productCache.stats();
        log.info(<span class="hljs-string">"å•†å“ç¼“å­˜ç»Ÿè®¡: hitRate={}, size={}, evictionCount={}"</span>,
            stats.hitRate(), productCache.size(), stats.evictionCount());
    }
}
</code></pre>
<p><strong>æ–¹æ¡ˆBï¼šConcurrentHashMap + å®šæœŸæ¸…ç† + LRU</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductServiceWithLRU</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">EXPIRE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 1å°æ—¶</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, CacheEntry&lt;Product&gt;&gt; productCache =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// LRUé˜Ÿåˆ—ï¼ˆè®¿é—®é¡ºåºï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentLinkedDeque&lt;Long&gt; lruQueue =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLinkedDeque</span>&lt;&gt;();

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span>&lt;T&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> T value;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> createTime;

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpired</span><span class="hljs-params">(<span class="hljs-type">long</span> expireTime)</span> {
            <span class="hljs-keyword">return</span> System.currentTimeMillis() - createTime &gt; expireTime;
        }
    }

    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long productId)</span> {
        CacheEntry&lt;Product&gt; entry = productCache.get(productId);

        <span class="hljs-comment">// ç¼“å­˜å‘½ä¸­ä¸”æœªè¿‡æœŸ</span>
        <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; !entry.isExpired(EXPIRE_TIME)) {
            <span class="hljs-comment">// æ›´æ–°LRU</span>
            lruQueue.remove(productId);
            lruQueue.offerLast(productId);
            <span class="hljs-keyword">return</span> entry.getValue();
        }

        <span class="hljs-comment">// ç¼“å­˜ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸï¼ŒåŠ è½½æ•°æ®</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectById(productId);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            put(productId, product);
        }

        <span class="hljs-keyword">return</span> product;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(Long key, Product value)</span> {
        <span class="hljs-comment">// å®¹é‡æ£€æŸ¥ï¼Œè¶…è¿‡åˆ™ç§»é™¤æœ€ä¹…æœªä½¿ç”¨çš„</span>
        <span class="hljs-keyword">if</span> (productCache.size() &gt;= MAX_SIZE) {
            <span class="hljs-type">Long</span> <span class="hljs-variable">oldest</span> <span class="hljs-operator">=</span> lruQueue.pollFirst();
            <span class="hljs-keyword">if</span> (oldest != <span class="hljs-literal">null</span>) {
                productCache.remove(oldest);
            }
        }

        productCache.put(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntry</span>&lt;&gt;(value, System.currentTimeMillis()));
        lruQueue.offerLast(key);
    }

    <span class="hljs-comment">// å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®</span>
    <span class="hljs-meta">@Scheduled(fixedRate = 60000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanExpired</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">cleanCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (Long key : productCache.keySet()) {
            CacheEntry&lt;Product&gt; entry = productCache.get(key);
            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; entry.isExpired(EXPIRE_TIME)) {
                productCache.remove(key);
                lruQueue.remove(key);
                cleanCount++;
            }
        }
        <span class="hljs-keyword">if</span> (cleanCount &gt; <span class="hljs-number">0</span>) {
            log.info(<span class="hljs-string">"æ¸…ç†è¿‡æœŸç¼“å­˜: count={}, size={}"</span>, cleanCount, productCache.size());
        }
    }
}
</code></pre>
<p><strong>æ–¹æ¡ˆCï¼šé™åˆ¶æœ€å¤§å®¹é‡ï¼ˆç®€å•ç‰ˆï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductServiceSimple</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, Product&gt; productCache =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-keyword">return</span> productCache.computeIfAbsent(productId, id -&gt; {
            <span class="hljs-comment">// å®¹é‡æ£€æŸ¥</span>
            <span class="hljs-keyword">if</span> (productCache.size() &gt;= MAX_SIZE) {
                log.warn(<span class="hljs-string">"ç¼“å­˜å·²æ»¡ï¼Œæ‹’ç»æ–°å¢: size={}"</span>, productCache.size());
                <span class="hljs-keyword">return</span> productMapper.selectById(id);  <span class="hljs-comment">// ä¸ç¼“å­˜ï¼Œç›´æ¥è¿”å›</span>
            }

            <span class="hljs-keyword">return</span> productMapper.selectById(id);
        });
    }
}
</code></pre>
<h4 data-id="heading-40">4.1.5 æœ€ä½³å®è·µ</h4>
<p><strong>æœ¬åœ°ç¼“å­˜ä½¿ç”¨è§„èŒƒï¼š</strong></p>
<ol>
<li>âœ… <strong>å¿…é¡»è®¾ç½®å®¹é‡ä¸Šé™</strong>ï¼ˆmaximumSizeï¼‰</li>
<li>âœ… <strong>å¿…é¡»è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼ˆexpireAfterWrite/expireAfterAccessï¼‰</li>
<li>âœ… <strong>ä¼˜å…ˆä½¿ç”¨Guava Cache</strong>ï¼Œè€Œéè£¸ç”¨ConcurrentHashMap</li>
<li>âœ… <strong>å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®</strong></li>
<li>âœ… <strong>ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡</strong>å’Œå®¹é‡</li>
<li>âœ… <strong>å‹æµ‹éªŒè¯å†…å­˜å ç”¨</strong></li>
</ol>
<hr/>
<h3 data-id="heading-41">4.2 æ¡ˆä¾‹2ï¼šConcurrentHashMapçš„size()æ–¹æ³•æ€§èƒ½é—®é¢˜</h3>
<h4 data-id="heading-42">4.2.1 ä¸šåŠ¡åœºæ™¯</h4>
<p>æŸç›‘æ§ç³»ç»Ÿéœ€è¦é¢‘ç¹è°ƒç”¨<code>size()</code>ç»Ÿè®¡ç¼“å­˜å¤§å°ï¼Œç”¨äºå‘Šè­¦ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(fixedRate = 1000)</span>  <span class="hljs-comment">// æ¯ç§’æ‰§è¡Œä¸€æ¬¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorCacheSize</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> cache.size();
    <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">100000</span>) {
        alertService.send(<span class="hljs-string">"ç¼“å­˜å®¹é‡å‘Šè­¦: "</span> + size);
    }
}
</code></pre>
<h4 data-id="heading-43">4.2.2 æ€§èƒ½é—®é¢˜</h4>
<p><strong>é—®é¢˜åˆ†æï¼š</strong></p>
<p><code>ConcurrentHashMap</code>çš„<code>size()</code>æ–¹æ³•éœ€è¦éå†<strong>æ‰€æœ‰Node</strong>è¿›è¡Œç´¯åŠ ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
    <span class="hljs-type">long</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> sumCount();
    <span class="hljs-keyword">return</span> ((n &lt; <span class="hljs-number">0L</span>) ? <span class="hljs-number">0</span> :
            (n &gt; (<span class="hljs-type">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE :
            (<span class="hljs-type">int</span>)n);
}

<span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sumCount</span><span class="hljs-params">()</span> {
    CounterCell[] as = counterCells; CounterCell a;
    <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> baseCount;
    <span class="hljs-keyword">if</span> (as != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// éå†æ‰€æœ‰CounterCellç´¯åŠ </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; as.length; ++i) {
            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-literal">null</span>)
                sum += a.value;
        }
    }
    <span class="hljs-keyword">return</span> sum;
}
</code></pre>
<p>è™½ç„¶JDK 1.8ä½¿ç”¨<code>CounterCell</code>æ•°ç»„åˆ†æ®µè®¡æ•°ï¼Œä½†ä»éœ€<strong>éå†æ•°ç»„</strong>ï¼Œæ•°æ®é‡å¤§æ—¶æœ‰æ€§èƒ½å¼€é”€ã€‚</p>
<p><strong>æ€§èƒ½æµ‹è¯•ï¼š</strong></p>






























<table><thead><tr><th>ç¼“å­˜å¤§å°</th><th>size()è€—æ—¶</th><th>æ¯ç§’è°ƒç”¨1000æ¬¡å½±å“</th></tr></thead><tbody><tr><td>1ä¸‡</td><td>0.01ms</td><td>å¯å¿½ç•¥</td></tr><tr><td>10ä¸‡</td><td>0.05ms</td><td>50ms/s</td></tr><tr><td>100ä¸‡</td><td>0.2ms</td><td>200ms/s</td></tr><tr><td>1000ä¸‡</td><td>1ms</td><td>1000ms/sï¼ˆ1ç§’ï¼‰</td></tr></tbody></table>
<p>å½“ç¼“å­˜è¾¾åˆ°<strong>ç™¾ä¸‡çº§</strong>æ—¶ï¼Œé¢‘ç¹è°ƒç”¨<code>size()</code>ä¼šæ˜¾è‘—å½±å“æ€§èƒ½ã€‚</p>
<h4 data-id="heading-44">4.2.3 è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>ä½¿ç”¨AtomicLongå•ç‹¬è®¡æ•°</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredCache</span>&lt;K, V&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;K, V&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// âœ… å•ç‹¬ç»´æŠ¤è®¡æ•°å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-type">V</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> cache.put(key, value);
        <span class="hljs-keyword">if</span> (oldValue == <span class="hljs-literal">null</span>) {
            count.incrementAndGet();  <span class="hljs-comment">// æ–°å¢</span>
        }
        <span class="hljs-keyword">return</span> oldValue;
    }

    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">putIfAbsent</span><span class="hljs-params">(K key, V value)</span> {
        <span class="hljs-type">V</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> cache.putIfAbsent(key, value);
        <span class="hljs-keyword">if</span> (oldValue == <span class="hljs-literal">null</span>) {
            count.incrementAndGet();  <span class="hljs-comment">// æ–°å¢</span>
        }
        <span class="hljs-keyword">return</span> oldValue;
    }

    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-type">V</span> <span class="hljs-variable">removed</span> <span class="hljs-operator">=</span> cache.remove(key);
        <span class="hljs-keyword">if</span> (removed != <span class="hljs-literal">null</span>) {
            count.decrementAndGet();  <span class="hljs-comment">// åˆ é™¤</span>
        }
        <span class="hljs-keyword">return</span> removed;
    }

    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">return</span> cache.get(key);
    }

    <span class="hljs-comment">/**
     * å¿«é€Ÿè·å–å¤§å°ï¼ˆO(1)ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> count.get();
    }

    <span class="hljs-comment">/**
     * ç²¾ç¡®å¤§å°ï¼ˆéœ€è¦æ—¶è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">actualSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cache.size();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        cache.clear();
        count.set(<span class="hljs-number">0</span>);
    }
}
</code></pre>
<h4 data-id="heading-45">4.2.4 æ€§èƒ½å¯¹æ¯”</h4>























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>è·å–å¤§å°è€—æ—¶</th><th>100ä¸‡æ•°æ®</th><th>1000ä¸‡æ•°æ®</th></tr></thead><tbody><tr><td><code>cache.size()</code></td><td>éå†ç´¯åŠ </td><td>0.2ms</td><td>1ms</td></tr><tr><td><code>count.get()</code></td><td><strong>O(1)</strong></td><td><strong>0.001ms</strong></td><td><strong>0.001ms</strong></td></tr></tbody></table>
<p><strong>æ€§èƒ½æå‡ï¼š200å€</strong></p>
<h4 data-id="heading-46">4.2.5 æ³¨æ„äº‹é¡¹</h4>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½å®Œå…¨æ›¿ä»£size()ï¼Ÿ</strong></p>
<ul>
<li><code>AtomicLong</code>è®¡æ•°å¯èƒ½ä¸ç²¾ç¡®ï¼ˆå¹¶å‘removeæ—¶ï¼‰</li>
<li>éœ€è¦åœ¨æ‰€æœ‰ä¿®æ”¹æ–¹æ³•ä¸­åŒæ­¥æ›´æ–°è®¡æ•°</li>
<li>é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„åœºæ™¯</li>
</ul>
<p><strong>æ¨èä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>âœ… ç›‘æ§å‘Šè­¦ï¼ˆå…è®¸è½»å¾®è¯¯å·®ï¼‰</li>
<li>âœ… ç»Ÿè®¡å¤§ç›˜æ•°æ®</li>
<li>âŒ éœ€è¦ç²¾ç¡®è®¡æ•°çš„ä¸šåŠ¡é€»è¾‘</li>
</ul>
<hr/>
<h2 data-id="heading-47">äº”ã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-48">5.1 ConcurrentHashMapä¸ºä»€ä¹ˆkeyå’Œvalueä¸å…è®¸nullï¼Ÿ</h3>
<p><strong>åŸå› ï¼šäºŒä¹‰æ€§é—®é¢˜</strong></p>
<p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœå…è®¸nullä¼šäº§ç”Ÿæ­§ä¹‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">ConcurrentHashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-comment">// å‡è®¾å…è®¸null value</span>
<span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> map.get(<span class="hljs-string">"key"</span>);
<span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// é—®é¢˜ï¼šæ— æ³•åŒºåˆ†ä»¥ä¸‹ä¸¤ç§æƒ…å†µ</span>
    <span class="hljs-comment">// 1. keyä¸å­˜åœ¨</span>
    <span class="hljs-comment">// 2. keyå­˜åœ¨ï¼Œä½†valueä¸ºnull</span>
}

<span class="hljs-comment">// HashMapå¯ä»¥ç”¨containsKey()åˆ¤æ–­ï¼Œä½†ConcurrentHashMapä¸è¡Œ</span>
<span class="hljs-keyword">if</span> (map.containsKey(<span class="hljs-string">"key"</span>)) {
    <span class="hljs-comment">// åœ¨containsKey()å’Œget()ä¹‹é—´ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½removeäº†key</span>
    <span class="hljs-comment">// å¯¼è‡´åˆ¤æ–­å¤±æ•ˆ</span>
}
</code></pre>
<p><strong>HashMapä¸ºä»€ä¹ˆå¯ä»¥ï¼Ÿ</strong></p>
<ul>
<li>HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå•çº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥ç”¨<code>containsKey()</code>å‡†ç¡®åˆ¤æ–­</li>
<li>ConcurrentHashMapåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œ<code>containsKey()</code>å’Œ<code>get()</code>ä¹‹é—´çŠ¶æ€å¯èƒ½å˜åŒ–</li>
</ul>
<p><strong>æºç éªŒè¯ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
    <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || value == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();  <span class="hljs-comment">// ç›´æ¥æŠ›å¼‚å¸¸</span>
    ...
}
</code></pre>
<hr/>
<h3 data-id="heading-49">5.2 ConcurrentHashMapæ˜¯å¼ºä¸€è‡´æ€§çš„å—ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆï¼šä¸æ˜¯ï¼Œæ˜¯å¼±ä¸€è‡´æ€§</strong></p>
<p><strong>å¼±ä¸€è‡´æ€§è¡¨ç°ï¼š</strong></p>
<ol>
<li>
<p><strong>size()æ–¹æ³•</strong>ï¼šè¿”å›çš„æ˜¯<strong>è¿‘ä¼¼å€¼</strong>ï¼Œå¯èƒ½ä¸å‡†ç¡®</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çº¿ç¨‹1</span>
map.put(<span class="hljs-string">"k1"</span>, <span class="hljs-string">"v1"</span>);

<span class="hljs-comment">// çº¿ç¨‹2ï¼ˆåŒæ—¶ï¼‰</span>
<span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> map.size();  <span class="hljs-comment">// å¯èƒ½çœ‹ä¸åˆ°çº¿ç¨‹1çš„put</span>
</code></pre>
</li>
<li>
<p><strong>è¿­ä»£å™¨</strong>ï¼šè¿”å›çš„æ˜¯<strong>æŸä¸€æ—¶åˆ»çš„å¿«ç…§</strong>ï¼Œä¸ä¿è¯å®æ—¶æ€§</p>
<pre><code class="hljs language-java" lang="java">Iterator&lt;String&gt; it = map.keySet().iterator();
<span class="hljs-keyword">while</span> (it.hasNext()) {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> it.next();
    <span class="hljs-comment">// è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹çš„put/removeä¸ä¸€å®šèƒ½çœ‹åˆ°</span>
}
</code></pre>
</li>
<li>
<p><strong>èšåˆæ“ä½œ</strong>ï¼šå¦‚<code>putAll()</code>, <code>clear()</code>ï¼Œä¸æ˜¯åŸå­çš„</p>
<pre><code class="hljs language-java" lang="java">map.putAll(otherMap);  <span class="hljs-comment">// ä¸æ˜¯åŸå­æ“ä½œï¼Œä¸­é—´çŠ¶æ€å¯è§</span>
</code></pre>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆä¸æ˜¯å¼ºä¸€è‡´ï¼Ÿ</strong></p>
<ul>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šå¼ºä¸€è‡´éœ€è¦å…¨å±€é”ï¼Œæ€§èƒ½æŸå¤±å¤§</li>
<li><strong>å®é™…éœ€æ±‚</strong>ï¼šå¤§å¤šæ•°åœºæ™¯ä¸‹å¼±ä¸€è‡´æ€§è¶³å¤Ÿ</li>
</ul>
<p><strong>éœ€è¦å¼ºä¸€è‡´æ€§æ€ä¹ˆåŠï¼Ÿ</strong></p>
<ul>
<li>ä½¿ç”¨<code>Collections.synchronizedMap()</code></li>
<li>æˆ–åœ¨å¤–éƒ¨åŠ é”</li>
</ul>
<hr/>
<h3 data-id="heading-50">5.3 ä¸ºä»€ä¹ˆé“¾è¡¨é•¿åº¦é˜ˆå€¼æ˜¯8ï¼Œæ ‘é€€åŒ–é˜ˆå€¼æ˜¯6ï¼Ÿ</h3>
<p><strong>æ ‘åŒ–é˜ˆå€¼ä¸º8çš„åŸå› ï¼š</strong></p>
<p>æ ¹æ®<strong>æ³Šæ¾åˆ†å¸ƒ</strong>ï¼Œhashç¢°æ’è¾¾åˆ°8ä¸ªèŠ‚ç‚¹çš„æ¦‚ç‡æä½ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">0:    0.60653066</span>
<span class="hljs-section">1:    0.30326533</span>
<span class="hljs-section">2:    0.07581633</span>
<span class="hljs-section">3:    0.01263606</span>
<span class="hljs-section">4:    0.00157952</span>
<span class="hljs-section">5:    0.00015795</span>
<span class="hljs-section">6:    0.00001316</span>
<span class="hljs-section">7:    0.00000094</span>
<span class="hljs-section">8:    0.00000006  // åƒä¸‡åˆ†ä¹‹ä¸€</span>
</code></pre>
<p>å³ä½¿hashç®—æ³•ä¸€èˆ¬ï¼Œé“¾è¡¨é•¿åº¦ä¹Ÿå¾ˆéš¾è¾¾åˆ°8ï¼Œå› æ­¤8æ˜¯ä¸€ä¸ªåˆç†çš„é˜ˆå€¼ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸æ˜¯7æˆ–9ï¼Ÿ</strong></p>
<ul>
<li><strong>æ€§èƒ½å¹³è¡¡</strong>ï¼šé“¾è¡¨éå†O(n)ï¼Œçº¢é»‘æ ‘O(logn)ï¼Œå½“n=8æ—¶æ€§èƒ½å·®å¼‚æ˜¾è‘—</li>
<li><strong>å†…å­˜å¼€é”€</strong>ï¼šTreeNodeå ç”¨ç©ºé—´æ˜¯Nodeçš„<strong>2å€</strong>ï¼Œè¿‡æ—©æ ‘åŒ–æµªè´¹å†…å­˜</li>
</ul>
<p><strong>æ ‘é€€åŒ–é˜ˆå€¼ä¸º6çš„åŸå› ï¼š</strong></p>
<p><strong>é˜²æ­¢é¢‘ç¹æ ‘åŒ–/é€€åŒ–</strong>ï¼š</p>
<ul>
<li>å¦‚æœé˜ˆå€¼éƒ½æ˜¯8ï¼Œåœ¨7-8ä¹‹é—´åå¤å¢åˆ ä¼šå¯¼è‡´é¢‘ç¹æ ‘åŒ–å’Œé€€åŒ–</li>
<li>è®¾ç½®ä¸º6æä¾›äº†ä¸€ä¸ª<strong>ç¼“å†²åŒºé—´</strong>[6, 8]ï¼Œé¿å…æŠ–åŠ¨</li>
</ul>

<pre><code class="hljs language-rust" lang="rust">é“¾è¡¨é•¿åº¦å˜åŒ–:
  <span class="hljs-number">7</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">8</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">7</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">8</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">7</span>  (å¦‚æœé˜ˆå€¼éƒ½æ˜¯<span class="hljs-number">8</span>)
  é¢‘ç¹æ ‘åŒ– â†” é€€åŒ–ï¼ˆæ€§èƒ½å·®ï¼‰

  <span class="hljs-number">7</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">8</span>ï¼ˆæ ‘åŒ–ï¼‰ <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">7</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">6</span>ï¼ˆé€€åŒ–ï¼‰ <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">7</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">8</span>ï¼ˆæ ‘åŒ–ï¼‰
  ç¼“å†²åŒºé—´[<span class="hljs-number">6</span>,<span class="hljs-number">8</span>]ï¼Œå‡å°‘è½¬æ¢æ¬¡æ•°
</code></pre>
<hr/>
<h3 data-id="heading-51">5.4 ConcurrentHashMapçš„å¹¶å‘åº¦æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è®¾ç½®ï¼Ÿ</h3>
<p><strong>å¹¶å‘åº¦ï¼ˆconcurrencyLevelï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>JDK 1.7</strong>ï¼šSegmentæ•°ç»„é•¿åº¦ï¼Œé»˜è®¤16</p>
<ul>
<li>è¡¨ç¤ºæœ€å¤š<strong>16ä¸ªçº¿ç¨‹</strong>å¯ä»¥åŒæ—¶ä¿®æ”¹ï¼ˆæ¯ä¸ªSegmentä¸€ä¸ªï¼‰</li>
<li>åˆå§‹åŒ–æ—¶æŒ‡å®šï¼š<code>new ConcurrentHashMap&lt;&gt;(16, 0.75f, 16)</code></li>
</ul>
</li>
<li>
<p><strong>JDK 1.8</strong>ï¼šå·²åºŸå¼ƒï¼Œå¹¶å‘åº¦åŠ¨æ€ç­‰äº<strong>æ•°ç»„é•¿åº¦</strong></p>
<ul>
<li>æ•°ç»„æ‰©å®¹æ—¶å¹¶å‘åº¦è‡ªåŠ¨ç¿»å€</li>
<li>ç†è®ºä¸Šå¯ä»¥æœ‰<strong>æ•°ç»„é•¿åº¦</strong>ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸åŒæ¡¶</li>
</ul>
</li>
</ul>
<p><strong>å¦‚ä½•è®¾ç½®ï¼Ÿ</strong></p>
<p>JDK 1.8ä¸­ä¸éœ€è¦è®¾ç½®ï¼Œåªéœ€æŒ‡å®š<code>initialCapacity</code>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¨èæ–¹å¼</span>
ConcurrentHashMap&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(initialCapacity);

<span class="hljs-comment">// initialCapacityå»ºè®®è®¾ç½®ä¸ºé¢„æœŸå…ƒç´ æ•°é‡ / 0.75</span>
<span class="hljs-type">int</span> <span class="hljs-variable">expectedSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">initialCapacity</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (expectedSize / <span class="hljs-number">0.75</span>) + <span class="hljs-number">1</span>;
ConcurrentHashMap&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(initialCapacity);
</code></pre>
<hr/>
<h3 data-id="heading-52">5.5 è¿­ä»£ConcurrentHashMapæ—¶èƒ½ä¿®æ”¹å—ï¼Ÿ</h3>
<p><strong>ç­”æ¡ˆï¼šå¯ä»¥ï¼Œä½†è¦å°å¿ƒ</strong></p>
<p><strong>ConcurrentHashMapçš„è¿­ä»£å™¨æ˜¯fail-safeçš„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">ConcurrentHashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
map.put(<span class="hljs-string">"k1"</span>, <span class="hljs-string">"v1"</span>);
map.put(<span class="hljs-string">"k2"</span>, <span class="hljs-string">"v2"</span>);

<span class="hljs-comment">// âœ… è¿­ä»£æ—¶å¯ä»¥ä¿®æ”¹ï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span>
<span class="hljs-keyword">for</span> (String key : map.keySet()) {
    map.put(<span class="hljs-string">"k3"</span>, <span class="hljs-string">"v3"</span>);  <span class="hljs-comment">// å…è®¸</span>
    map.remove(<span class="hljs-string">"k2"</span>);     <span class="hljs-comment">// å…è®¸</span>
}

<span class="hljs-comment">// HashMapä¼šæŠ›ConcurrentModificationException</span>
HashMap&lt;String, String&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (String key : hashMap.keySet()) {
    hashMap.put(<span class="hljs-string">"k3"</span>, <span class="hljs-string">"v3"</span>);  <span class="hljs-comment">// âŒ æŠ›å¼‚å¸¸</span>
}
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ol>
<li><strong>æ–°å¢çš„å…ƒç´ å¯èƒ½çœ‹ä¸åˆ°</strong>ï¼šè¿­ä»£å™¨è¿”å›çš„æ˜¯æŸä¸€æ—¶åˆ»çš„å¿«ç…§</li>
<li><strong>åˆ é™¤çš„å…ƒç´ å¯èƒ½è¿˜èƒ½çœ‹åˆ°</strong>ï¼šè¿­ä»£å™¨å·²ç»ç¼“å­˜</li>
<li><strong>ä¸ä¿è¯è¿­ä»£é¡ºåº</strong></li>
</ol>
<p><strong>å®‰å…¨çš„è¿­ä»£æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹å¼1ï¼šå…ˆå¤åˆ¶ï¼Œå†è¿­ä»£</span>
List&lt;String&gt; keys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(map.keySet());
<span class="hljs-keyword">for</span> (String key : keys) {
    map.remove(key);  <span class="hljs-comment">// å®‰å…¨</span>
}

<span class="hljs-comment">// æ–¹å¼2ï¼šä½¿ç”¨Iterator.remove()</span>
Iterator&lt;String&gt; it = map.keySet().iterator();
<span class="hljs-keyword">while</span> (it.hasNext()) {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> it.next();
    it.remove();  <span class="hljs-comment">// å®‰å…¨</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-53">5.6 compute/computeIfAbsentçš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h3>
<p><strong>computeç³»åˆ—æ–¹æ³•æ˜¯åŸå­çš„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… computeIfAbsentæ˜¯åŸå­æ“ä½œ</span>
map.computeIfAbsent(<span class="hljs-string">"key"</span>, k -&gt; expensiveCompute());

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šéåŸå­ï¼Œå¯èƒ½å¤šæ¬¡è®¡ç®—</span>
<span class="hljs-keyword">if</span> (map.get(<span class="hljs-string">"key"</span>) == <span class="hljs-literal">null</span>) {
    map.put(<span class="hljs-string">"key"</span>, expensiveCompute());  <span class="hljs-comment">// å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹æ‰§è¡Œ</span>
}
</code></pre>
<p><strong>æºç åˆ†æï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">computeIfAbsent</span><span class="hljs-params">(K key, Function&lt;? <span class="hljs-built_in">super</span> K, ? extends V&gt; mappingFunction)</span> {
    ...
    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) {
        ...
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; h)) == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ¡¶ä¸ºç©ºï¼ŒCASæ’å…¥</span>
            Node&lt;K,V&gt; r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReservationNode</span>&lt;K,V&gt;();
            <span class="hljs-keyword">synchronized</span> (r) {  <span class="hljs-comment">// ä¸´æ—¶èŠ‚ç‚¹åŠ é”</span>
                <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-literal">null</span>, r)) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-type">V</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> mappingFunction.apply(key);  <span class="hljs-comment">// åªè®¡ç®—ä¸€æ¬¡</span>
                        ...
                    }
                }
            }
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">synchronized</span> (f) {  <span class="hljs-comment">// é”å®šæ¡¶</span>
                ...
                <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)
                        treeifyBin(tab, i);
                    <span class="hljs-keyword">if</span> (oldVal != <span class="hljs-literal">null</span>)
                        <span class="hljs-keyword">return</span> oldVal;
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }
    ...
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><code>mappingFunction.apply()</code>åªä¼šè¢«<strong>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</strong></li>
<li>å…¶ä»–çº¿ç¨‹ä¼šç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹å®Œæˆ</li>
</ul>
<p><strong>âš ï¸ æ³¨æ„æ­»é”é£é™©ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ å¯èƒ½æ­»é”</span>
map.computeIfAbsent(<span class="hljs-string">"key1"</span>, k -&gt; {
    <span class="hljs-keyword">return</span> map.computeIfAbsent(<span class="hljs-string">"key2"</span>, k2 -&gt; <span class="hljs-string">"value"</span>);  <span class="hljs-comment">// åµŒå¥—é”</span>
});
</code></pre>
<p><strong>æ­£ç¡®ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… é¿å…åµŒå¥—</span>
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> map.computeIfAbsent(<span class="hljs-string">"key"</span>, k -&gt; computeValue());
</code></pre>
<hr/>
<h3 data-id="heading-54">5.7 putIfAbsent vs computeIfAbsentçš„åŒºåˆ«</h3>






























<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>putIfAbsent</th><th>computeIfAbsent</th></tr></thead><tbody><tr><td><strong>å‚æ•°</strong></td><td><code>putIfAbsent(K key, V value)</code></td><td><code>computeIfAbsent(K key, Function&lt;K, V&gt; f)</code></td></tr><tr><td><strong>è®¡ç®—æ—¶æœº</strong></td><td><strong>ç«‹å³è®¡ç®—</strong>value</td><td><strong>å»¶è¿Ÿè®¡ç®—</strong>ï¼Œkeyä¸å­˜åœ¨æ—¶æ‰è®¡ç®—</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æµªè´¹è®¡ç®—ï¼ˆvalueå·²è®¡ç®—å¥½ï¼‰</td><td><strong>æ‡’åŠ è½½</strong>ï¼Œæ€§èƒ½æ›´å¥½</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>valueå·²å‡†å¤‡å¥½</td><td>valueè®¡ç®—æ˜‚è´µ</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åœºæ™¯1ï¼švalueå·²å‡†å¤‡å¥½ â†’ putIfAbsent</span>
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-string">"computed-value"</span>;
map.putIfAbsent(<span class="hljs-string">"key"</span>, value);

<span class="hljs-comment">// åœºæ™¯2ï¼švalueéœ€è¦è®¡ç®— â†’ computeIfAbsentï¼ˆæ¨èï¼‰</span>
map.computeIfAbsent(<span class="hljs-string">"key"</span>, k -&gt; {
    <span class="hljs-comment">// åªæœ‰keyä¸å­˜åœ¨æ—¶æ‰æ‰§è¡Œ</span>
    <span class="hljs-keyword">return</span> expensiveCompute();
});

<span class="hljs-comment">// âŒ é”™è¯¯ç”¨æ³•ï¼šæå‰è®¡ç®—æµªè´¹</span>
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> expensiveCompute();  <span class="hljs-comment">// keyå­˜åœ¨æ—¶ç™½ç®—äº†</span>
map.putIfAbsent(<span class="hljs-string">"key"</span>, value);
</code></pre>
<hr/>
<h3 data-id="heading-55">5.8 å¦‚ä½•æ­£ç¡®ç»Ÿè®¡ConcurrentHashMapçš„å…ƒç´ æ•°é‡ï¼Ÿ</h3>
<p><strong>æ–¹æ³•1ï¼šsize()ï¼ˆæ¨èï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> map.size();  <span class="hljs-comment">// O(counterCells.length)</span>
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… å®ç°ç®€å•</li>
<li>âœ… æ€§èƒ½å°šå¯ï¼ˆéå†counterCellsæ•°ç»„ï¼‰</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>âŒ è¿”å›<strong>è¿‘ä¼¼å€¼</strong>ï¼Œä¸ä¿è¯ç²¾ç¡®</li>
<li>âŒ æ•°æ®é‡å¤§æ—¶æœ‰æ€§èƒ½å¼€é”€</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šAtomicLongè®¡æ•°ï¼ˆç²¾ç¡®ï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>);

<span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
    <span class="hljs-type">V</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> map.put(key, value);
    <span class="hljs-keyword">if</span> (oldValue == <span class="hljs-literal">null</span>) {
        count.incrementAndGet();
    }
    <span class="hljs-keyword">return</span> oldValue;
}

<span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> count.get();  <span class="hljs-comment">// O(1)</span>
}
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… O(1)æ€§èƒ½</li>
<li>âœ… å®æ—¶ç²¾ç¡®</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>âŒ éœ€è¦åœ¨æ‰€æœ‰ä¿®æ”¹æ–¹æ³•ä¸­åŒæ­¥æ›´æ–°</li>
<li>âŒ ä»£ç ä¾µå…¥æ€§å¼º</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šmappingCount()ï¼ˆJDK 1.8æ¨èï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> map.mappingCount();  <span class="hljs-comment">// è¿”å›longï¼Œé¿å…æº¢å‡º</span>
</code></pre>
<p><strong>åŒºåˆ«ï¼š</strong></p>
<ul>
<li><code>size()</code>è¿”å›<code>int</code>ï¼Œæœ€å¤§<code>Integer.MAX_VALUE</code></li>
<li><code>mappingCount()</code>è¿”å›<code>long</code>ï¼Œæ”¯æŒæ›´å¤§å®¹é‡</li>
</ul>
<p><strong>æ¨èï¼š</strong></p>
<ul>
<li>æ™®é€šåœºæ™¯ï¼š<code>size()</code></li>
<li>è¶…å¤§å®¹é‡ï¼š<code>mappingCount()</code></li>
<li>æ€§èƒ½æ•æ„Ÿï¼š<code>AtomicLong</code></li>
</ul>
<hr/>
<h2 data-id="heading-56">å…­ã€æœ€ä½³å®è·µä¸æ€»ç»“</h2>
<h3 data-id="heading-57">6.1 ä»€ä¹ˆåœºæ™¯ä½¿ç”¨ConcurrentHashMapï¼Ÿ</h3>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ol>
<li>âœ… <strong>é«˜å¹¶å‘è¯»å†™</strong>ï¼šå¤šçº¿ç¨‹é¢‘ç¹è¯»å†™å…±äº«Map</li>
<li>âœ… <strong>è¯»å¤šå†™å°‘</strong>ï¼šå¦‚é…ç½®ç¼“å­˜ã€ç”¨æˆ·session</li>
<li>âœ… <strong>æ— éœ€å¼ºä¸€è‡´æ€§</strong>ï¼šå…è®¸è¯»åˆ°ç¨æ—§çš„æ•°æ®</li>
<li>âœ… <strong>éœ€è¦é«˜æ€§èƒ½</strong>ï¼šHashtableæ€§èƒ½ä¸æ»¡è¶³éœ€æ±‚</li>
</ol>
<p><strong>ä¸é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ol>
<li>âŒ <strong>å•çº¿ç¨‹</strong>ï¼šHashMapæ€§èƒ½æ›´å¥½</li>
<li>âŒ <strong>éœ€è¦å¼ºä¸€è‡´æ€§</strong>ï¼šä½¿ç”¨<code>Collections.synchronizedMap()</code></li>
<li>âŒ <strong>éœ€è¦æ’åº</strong>ï¼šä½¿ç”¨<code>ConcurrentSkipListMap</code></li>
<li>âŒ <strong>key/valueå…è®¸null</strong>ï¼šä½¿ç”¨<code>Collections.synchronizedMap(new HashMap&lt;&gt;())</code></li>
</ol>
<hr/>
<h3 data-id="heading-58">6.2 å¦‚ä½•æ­£ç¡®ä½¿ç”¨ConcurrentHashMapï¼Ÿ</h3>
<p><strong>1. é€‰æ‹©åˆé€‚çš„åˆå§‹å®¹é‡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ¨èï¼šé¢„ä¼°å…ƒç´ æ•°é‡ï¼Œé¿å…æ‰©å®¹</span>
<span class="hljs-type">int</span> <span class="hljs-variable">expectedSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">initialCapacity</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (expectedSize / <span class="hljs-number">0.75</span>) + <span class="hljs-number">1</span>;
ConcurrentHashMap&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(initialCapacity);

<span class="hljs-comment">// âŒ ä¸æ¨èï¼šé»˜è®¤å®¹é‡16ï¼Œé¢‘ç¹æ‰©å®¹</span>
ConcurrentHashMap&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
</code></pre>
<p><strong>2. ä½¿ç”¨computeç³»åˆ—æ–¹æ³•ä¿è¯åŸå­æ€§</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… åŸå­æ“ä½œ</span>
map.computeIfAbsent(<span class="hljs-string">"key"</span>, k -&gt; computeValue());

<span class="hljs-comment">// âŒ éåŸå­</span>
<span class="hljs-keyword">if</span> (!map.containsKey(<span class="hljs-string">"key"</span>)) {
    map.put(<span class="hljs-string">"key"</span>, computeValue());
}
</code></pre>
<p><strong>3. é¿å…åœ¨computeä¸­åµŒå¥—ä¿®æ”¹</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ å¯èƒ½æ­»é”</span>
map.computeIfAbsent(<span class="hljs-string">"key1"</span>, k -&gt; map.get(<span class="hljs-string">"key2"</span>));

<span class="hljs-comment">// âœ… å…ˆè·å–ï¼Œå†è®¡ç®—</span>
<span class="hljs-type">String</span> <span class="hljs-variable">key2Value</span> <span class="hljs-operator">=</span> map.get(<span class="hljs-string">"key2"</span>);
map.computeIfAbsent(<span class="hljs-string">"key1"</span>, k -&gt; process(key2Value));
</code></pre>
<p><strong>4. ä½¿ç”¨mappingCount()æ›¿ä»£size()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ”¯æŒlongï¼Œé¿å…æº¢å‡º</span>
<span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> map.mappingCount();

<span class="hljs-comment">// âš ï¸ è¿”å›intï¼Œå¯èƒ½æº¢å‡º</span>
<span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> map.size();
</code></pre>
<hr/>
<h3 data-id="heading-59">6.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<p><strong>1. åˆç†è®¾ç½®åˆå§‹å®¹é‡å’ŒåŠ è½½å› å­</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åœºæ™¯ï¼šé¢„æœŸ10000ä¸ªå…ƒç´ ï¼Œè¯»å¤šå†™å°‘</span>
ConcurrentHashMap&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(
    <span class="hljs-number">16384</span>,  <span class="hljs-comment">// initialCapacity: 10000 / 0.75 â‰ˆ 13333ï¼Œå‘ä¸Šå–2çš„å¹‚æ¬¡ = 16384</span>
    <span class="hljs-number">0.75f</span>   <span class="hljs-comment">// loadFactor: é»˜è®¤0.75å³å¯</span>
);
</code></pre>
<p><strong>2. é¿å…é¢‘ç¹size()è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ æ¯æ¬¡éƒ½è°ƒç”¨size()</span>
<span class="hljs-keyword">for</span> (...) {
    <span class="hljs-keyword">if</span> (map.size() &gt; <span class="hljs-number">10000</span>) {
        ...
    }
}

<span class="hljs-comment">// âœ… ç¼“å­˜size()ç»“æœ</span>
<span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> map.size();
<span class="hljs-keyword">for</span> (...) {
    <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">10000</span>) {
        ...
    }
}
</code></pre>
<p><strong>3. æ‰¹é‡æ“ä½œä½¿ç”¨putAll()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é€ä¸ªput</span>
<span class="hljs-keyword">for</span> (Entry&lt;K, V&gt; entry : entries) {
    map.put(entry.getKey(), entry.getValue());
}

<span class="hljs-comment">// âœ… æ‰¹é‡putAll</span>
map.putAll(otherMap);
</code></pre>
<hr/>
<h3 data-id="heading-60">6.4 å¸¸è§é”™è¯¯ç”¨æ³•</h3>
<p><strong>é”™è¯¯1ï¼šå½“ä½œå¼ºä¸€è‡´æ€§å®¹å™¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šä»¥ä¸ºæ˜¯åŸå­æ“ä½œ</span>
<span class="hljs-keyword">if</span> (map.size() &gt; <span class="hljs-number">100</span>) {
    map.remove(oldestKey);  <span class="hljs-comment">// size()å’Œremove()ä¹‹é—´ï¼Œsizeå¯èƒ½å·²å˜åŒ–</span>
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šå•ç‹¬ç»´æŠ¤è®¡æ•°</span>
<span class="hljs-keyword">if</span> (count.get() &gt; <span class="hljs-number">100</span>) {
    removeOldest();
}
</code></pre>
<p><strong>é”™è¯¯2ï¼šä¾èµ–è¿­ä»£é¡ºåº</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šConcurrentHashMapä¸ä¿è¯é¡ºåº</span>
<span class="hljs-keyword">for</span> (String key : map.keySet()) {
    <span class="hljs-comment">// æœŸæœ›æŒ‰æ’å…¥é¡ºåº...</span>
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ConcurrentSkipListMapï¼ˆæœ‰åºï¼‰</span>
ConcurrentNavigableMap&lt;K, V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentSkipListMap</span>&lt;&gt;();
</code></pre>
<p><strong>é”™è¯¯3ï¼šå¿˜è®°å¤„ç†null</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šå¿˜è®°åˆ¤null</span>
<span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> map.get(<span class="hljs-string">"key"</span>);
value.toString();  <span class="hljs-comment">// NPE</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåˆ¤ç©ºæˆ–ä½¿ç”¨getOrDefault</span>
<span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> map.getOrDefault(<span class="hljs-string">"key"</span>, defaultValue);
</code></pre>
<hr/>
<h3 data-id="heading-61">6.5 çº¿ç¨‹å®‰å…¨å®¹å™¨é€‰å‹æŒ‡å—</h3>









































<table><thead><tr><th>éœ€æ±‚</th><th>æ¨èå®¹å™¨</th></tr></thead><tbody><tr><td><strong>é«˜å¹¶å‘è¯»å†™Map</strong></td><td><code>ConcurrentHashMap</code></td></tr><tr><td><strong>æœ‰åºMap</strong></td><td><code>ConcurrentSkipListMap</code></td></tr><tr><td><strong>é«˜å¹¶å‘List</strong></td><td><code>CopyOnWriteArrayList</code>ï¼ˆè¯»å¤šå†™å°‘ï¼‰</td></tr><tr><td><strong>é«˜å¹¶å‘Set</strong></td><td><code>ConcurrentHashMap.newKeySet()</code></td></tr><tr><td><strong>é«˜å¹¶å‘Queue</strong></td><td><code>ConcurrentLinkedQueue</code>ï¼ˆæ— ç•Œï¼‰<br/><code>LinkedBlockingQueue</code>ï¼ˆæœ‰ç•Œï¼‰</td></tr><tr><td><strong>å»¶è¿Ÿé˜Ÿåˆ—</strong></td><td><code>DelayQueue</code></td></tr><tr><td><strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong></td><td><code>PriorityBlockingQueue</code></td></tr><tr><td><strong>å¼ºä¸€è‡´æ€§Map</strong></td><td><code>Collections.synchronizedMap()</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-62">æ€»ç»“</h2>
<p><code>ConcurrentHashMap</code>æ˜¯Javaå¹¶å‘åŒ…ä¸­æœ€é‡è¦çš„å®¹å™¨ä¹‹ä¸€ï¼Œç»å†äº†ä»**åˆ†æ®µé”ï¼ˆJDK 1.7ï¼‰<strong>åˆ°</strong>CAS + synchronizedï¼ˆJDK 1.8ï¼‰**çš„æ¼”è¿›ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶å®ç°äº†æé«˜çš„å¹¶å‘æ€§èƒ½ã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹å›é¡¾ï¼š</strong></p>
<ol>
<li><strong>è®¾è®¡ç›®æ ‡</strong>ï¼šé«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨ã€å¼±ä¸€è‡´æ€§</li>
<li><strong>JDK 1.7</strong>ï¼šSegmentåˆ†æ®µé”ï¼Œå¹¶å‘åº¦å—é™äºSegmentæ•°é‡ï¼ˆé»˜è®¤16ï¼‰</li>
<li><strong>JDK 1.8</strong>ï¼šNodeæ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ï¼ŒCAS + synchronizedï¼Œå¹¶å‘åº¦ç­‰äºæ•°ç»„é•¿åº¦</li>
<li><strong>å…³é”®æœºåˆ¶</strong>ï¼š
<ul>
<li>æ¡¶ä¸ºç©ºï¼šCASæ’å…¥ï¼ˆæ— é”ï¼‰</li>
<li>æ­£åœ¨æ‰©å®¹ï¼šååŠ©æ‰©å®¹ï¼ˆå¤šçº¿ç¨‹åä½œï¼‰</li>
<li>hashå†²çªï¼šsynchronizedé”å¤´èŠ‚ç‚¹ï¼ˆç»†ç²’åº¦é”ï¼‰</li>
</ul>
</li>
<li><strong>æ‰©å®¹ä¼˜åŒ–</strong>ï¼šå¤šçº¿ç¨‹åä½œè¿ç§»ï¼ŒForwardingNodeæ ‡è®°å·²è¿ç§»æ¡¶</li>
<li><strong>è®¡æ•°ä¼˜åŒ–</strong>ï¼šbaseCount + CounterCell[]ï¼ŒLongAdderæ€æƒ³</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>âœ… é¢„ä¼°å®¹é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹</li>
<li>âœ… ä½¿ç”¨computeç³»åˆ—æ–¹æ³•ä¿è¯åŸå­æ€§</li>
<li>âœ… ä½¿ç”¨mappingCount()æ›¿ä»£size()</li>
<li>âœ… é€‚ç”¨äºè¯»å¤šå†™å°‘ã€å¼±ä¸€è‡´æ€§åœºæ™¯</li>
<li>âŒ ä¸è¦åœ¨computeä¸­åµŒå¥—ä¿®æ”¹</li>
<li>âŒ ä¸è¦ä¾èµ–è¿­ä»£é¡ºåº</li>
<li>âŒ ä¸è¦é¢‘ç¹è°ƒç”¨size()</li>
</ul>
<p><code>ConcurrentHashMap</code>æ˜¯å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ç»„ä»¶ï¼Œæ·±å…¥ç†è§£å…¶åŸç†å’Œæ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼Œå¯¹æ„å»ºé«˜æ€§èƒ½å¹¶å‘ç³»ç»Ÿè‡³å…³é‡è¦ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[09 Go Eino AIåº”ç”¨å¼€å‘å®æˆ˜ | Hertz Web æ¡†æ¶æ­å»º]]></title>    <link>https://juejin.cn/post/7585474459776630820</link>    <guid>https://juejin.cn/post/7585474459776630820</guid>    <pubDate>2025-12-20T09:43:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776630820" data-draft-id="7585390679398858758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="09 Go Eino AIåº”ç”¨å¼€å‘å®æˆ˜ | Hertz Web æ¡†æ¶æ­å»º"/> <meta itemprop="keywords" content="åç«¯,äººå·¥æ™ºèƒ½,Go"/> <meta itemprop="datePublished" content="2025-12-20T09:43:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹ä¸­é˜³è®²AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2189882892232029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            09 Go Eino AIåº”ç”¨å¼€å‘å®æˆ˜ | Hertz Web æ¡†æ¶æ­å»º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2189882892232029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹ä¸­é˜³è®²AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T09:43:30.000Z" title="Sat Dec 20 2025 09:43:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,æ€æºé»‘ä½“ CN,æ€æºé»‘ä½“,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><blockquote>
<p>å£°æ˜ï¼šæœ¬AIåº”ç”¨å¼€å‘ç³»åˆ—æ•™ç¨‹é¦–å‘åœ¨åŒåå…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F5DYsyMKh9cDJdVvs_Mn9_Q" target="_blank" title="https://mp.weixin.qq.com/s/5DYsyMKh9cDJdVvs_Mn9_Q" ref="nofollow noopener noreferrer">ç‹ä¸­é˜³</a>ï¼Œæœªç»æˆæƒç¦æ­¢è½¬è½½ã€‚</p>
</blockquote>
<p>Hertz Web æ¡†æ¶ä½œä¸º AI Interview Agent å¹³å°çš„æ ¸å¿ƒæ”¯æŸ±ï¼Œæä¾›é«˜æ€§èƒ½çš„ HTTP è·¯ç”±ã€ä¸­é—´ä»¶ç¼–æ’å’Œè¯·æ±‚å¤„ç†èƒ½åŠ›ã€‚æœ¬æŒ‡å—æ¶µç›– Hertz åœ¨é¡¹ç›®æ¶æ„ä¸­çš„å®Œæ•´è®¾ç½®å’Œé…ç½®ã€‚</p>
<h2 data-id="heading-0">æ¡†æ¶åˆå§‹åŒ–</h2>
<p>Hertz æœåŠ¡å™¨åœ¨ä¸»åº”ç”¨ç¨‹åºå…¥å£ç‚¹åˆå§‹åŒ–ï¼Œé€šè¿‡åŒ…å«é…ç½®åŠ è½½ã€æ•°æ®åº“è¿æ¥å’Œä¸­é—´ä»¶æ³¨å†Œçš„å®Œæ•´è®¾ç½®åºåˆ— [main.go#L101-L175]ã€‚</p>
<p>æœåŠ¡å™¨åˆå§‹åŒ–éµå¾ªä»¥ä¸‹å…³é”®æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ä½¿ç”¨é…ç½®ä¸­çš„ä¸»æœºå’Œç«¯å£åˆå§‹åŒ– Hertz æœåŠ¡å™¨</span>
s := server.Default(server.WithHostPorts(fmt.Sprintf(<span class="hljs-string">"%s:%d"</span>, cfg.Host, cfg.Port)))
</code></pre>
<h2 data-id="heading-1">ä¸­é—´ä»¶æ¶æ„</h2>
<p>Hertz å®ç°äº†åˆ†å±‚ä¸­é—´ä»¶æ¶æ„æ¥å¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š</p>
<h3 data-id="heading-2">æ¢å¤ä¸­é—´ä»¶</h3>
<p>æ¢å¤ä¸­é—´ä»¶æ•è· panic å¹¶é˜²æ­¢æœåŠ¡å™¨å´©æºƒï¼Œæä¾›ç»“æ„åŒ–é”™è¯¯å“åº” [recovery.go#L15-L35]ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Recovery</span><span class="hljs-params">()</span></span> app.HandlerFunc {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, c *app.RequestContext)</span></span> {
        <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            <span class="hljs-keyword">if</span> r := <span class="hljs-built_in">recover</span>(); r != <span class="hljs-literal">nil</span> {
                stack := debug.Stack()
                log.Printf(<span class="hljs-string">"[PANIC] Recovered: %v\n%s"</span>, r, stack)
                <span class="hljs-comment">// è¿”å›ç»“æ„åŒ–é”™è¯¯å“åº”</span>
            }
        }()
        c.Next(ctx)
    }
}
</code></pre>
<h3 data-id="heading-3">CORS é…ç½®</h3>
<p>å…¨å±€ CORS ä¸­é—´ä»¶é€šè¿‡å…¨é¢çš„å¤´éƒ¨é…ç½®å¤„ç†è·¨åŸŸè¯·æ±‚ [main.go#L113-L127]ï¼š</p>






























<table><thead><tr><th>Header</th><th>Value</th><th>Purpose</th></tr></thead><tbody><tr><td>Access-Control-Allow-Origin</td><td>*</td><td>å…è®¸æ‰€æœ‰æ¥æº</td></tr><tr><td>Access-Control-Allow-Methods</td><td>GET, POST, PUT, DELETE, OPTIONS</td><td>å…è®¸çš„ HTTP æ–¹æ³•</td></tr><tr><td>Access-Control-Allow-Headers</td><td>Content-Type, Authorization, X-Requested-With, Cache-Control, X-Auth-Token</td><td>å…è®¸çš„è¯·æ±‚å¤´</td></tr><tr><td>Access-Control-Max-Age</td><td>86400</td><td>é¢„æ£€è¯·æ±‚ç¼“å­˜ 24 å°æ—¶</td></tr></tbody></table>
<h3 data-id="heading-4">JWT è®¤è¯</h3>
<p>JWT ä¸­é—´ä»¶æä¾›åŸºäºä»¤ç‰Œçš„è®¤è¯ï¼Œæ”¯æŒå¯é…ç½®çš„è·¯ç”±è·³è¿‡ [jwt.go#L37-L79]ã€‚ç»•è¿‡è®¤è¯çš„å…¬å…±è·¯ç”±åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>/api/user/login</code></li>
<li><code>/api/user/register</code></li>
<li><code>/api/user/logout</code></li>
<li><code>/api/user/wechat/login</code></li>
<li><code>/api/user/wechat/callback</code></li>
<li><code>/api/demo/create/model</code></li>
</ul>
<h2 data-id="heading-5">è·¯ç”±æ³¨å†Œç³»ç»Ÿ</h2>
<p>Hertz ä½¿ç”¨åŸºäº IDL å®šä¹‰çš„è‡ªåŠ¨ç”Ÿæˆè·¯ç”±æ³¨å†Œç³»ç»Ÿ [register.go#L11-L16]ã€‚è·¯ç”±å±‚æ¬¡éµå¾ªç»“æ„åŒ–æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/
â”œâ”€â”€ /api/
    â”œâ”€â”€ /interview/
    â”‚   â”œâ”€â”€ /records (GET)
    â”‚   â””â”€â”€ /stream/
    â”‚       â””â”€â”€ /start (POST)
    â”œâ”€â”€ /mianshi/
    â”‚   â”œâ”€â”€ /answer-record (GET)
    â”‚   â”œâ”€â”€ /evaluation (GET)
    â”‚   â”œâ”€â”€ /records (GET)
    â”‚   â”œâ”€â”€ /answer/
    â”‚   â”‚   â””â”€â”€ /submit (POST)
    â”‚   â”œâ”€â”€ /interview/
    â”‚   â”‚   â””â”€â”€ /end (POST)
    â”‚   â”œâ”€â”€ /session/
    â”‚   â”‚   â””â”€â”€ /info (GET)
    â”‚   â””â”€â”€ /stream/
    â”‚       â””â”€â”€ /start (POST)
    â”œâ”€â”€ /prediction/
    â”‚   â”œâ”€â”€ /:<span class="hljs-built_in">id</span> (GET)
    â”‚   â”œâ”€â”€ /list (GET)
    â”‚   â””â”€â”€ /start (POST)
    â”œâ”€â”€ /resume/
    â”‚   â”œâ”€â”€ /default (GET)
    â”‚   â”œâ”€â”€ /list (GET)
    â”‚   â”œâ”€â”€ /:resume_id (GET, PUT, DELETE)
    â”‚   â”œâ”€â”€ /set-default (POST)
    â”‚   â””â”€â”€ /upload (POST)
    â””â”€â”€ /user/
        â”œâ”€â”€ /login (POST)
        â”œâ”€â”€ /register (POST)
        â”œâ”€â”€ /profile (GET, PUT)
        â”œâ”€â”€ /create/model (POST)
        â”œâ”€â”€ /model/
        â”‚   â”œâ”€â”€ /check (GET)
        â”‚   â”œâ”€â”€ /list (GET)
        â”‚   â”œâ”€â”€ /delete/:<span class="hljs-built_in">id</span> (DELETE)
        â”‚   â”œâ”€â”€ /details/:<span class="hljs-built_in">id</span> (GET)
        â”‚   â””â”€â”€ /update/:<span class="hljs-built_in">id</span> (PUT)
        â””â”€â”€ /wechat/
            â”œâ”€â”€ /login (GET)
            â””â”€â”€ /callback (GET)
</code></pre>
<p>è·¯ç”±æ³¨å†Œæ˜¯ä½¿ç”¨ Hertz ç”Ÿæˆå™¨ä» IDL å®šä¹‰è‡ªåŠ¨ç”Ÿæˆçš„ã€‚æ‰‹åŠ¨ä¿®æ”¹ç”Ÿæˆçš„æ–‡ä»¶å°†åœ¨æ›´æ–°æ—¶è¢«è¦†ç›–ã€‚</p>
<h2 data-id="heading-6">é…ç½®é›†æˆ</h2>
<p>Hertz é…ç½®ä¸åº”ç”¨ç¨‹åºçš„é›†ä¸­å¼é…ç½®ç³»ç»Ÿé›†æˆ [config.go#L75-L83]ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> HertzConfig <span class="hljs-keyword">struct</span> {
    Host         <span class="hljs-type">string</span>        <span class="hljs-string">`yaml:"host"`</span>
    Port         <span class="hljs-type">int</span>           <span class="hljs-string">`yaml:"port"`</span>
    ReadTimeout  time.Duration <span class="hljs-string">`yaml:"read_timeout"`</span>
    WriteTimeout time.Duration <span class="hljs-string">`yaml:"write_timeout"`</span>
    IdleTimeout  time.Duration <span class="hljs-string">`yaml:"idle_timeout"`</span>
}
</code></pre>
<p>æœåŠ¡å™¨ä½¿ç”¨ç¯å¢ƒå˜é‡æ‰©å±•ï¼Œå…è®¸é€šè¿‡ YAML æ–‡ä»¶ä¸­çš„Â <code>${VAR_NAME}</code>Â è¯­æ³•è¿›è¡Œçµæ´»é…ç½®ã€‚</p>
<h2 data-id="heading-7">ä¼˜é›…å…³é—­</h2>
<p>Hertz å®ç°äº†å¸¦æœ‰é€‚å½“èµ„æºæ¸…ç†çš„ä¼˜é›…å…³é—­ [main.go#L147-L175]ï¼š</p>
<ol>
<li><strong>ä¿¡å·å¤„ç†</strong>ï¼šç›‘å¬ SIGINT å’Œ SIGTERM ä¿¡å·</li>
<li><strong>æ¶ˆè´¹è€…å…³é—­</strong>ï¼šåœæ­¢æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹è€…</li>
<li><strong>é˜Ÿåˆ—æ¸…ç†</strong>ï¼šå…³é—­æ¶ˆæ¯é˜Ÿåˆ—è¿æ¥</li>
<li><strong>æœåŠ¡å™¨å…³é—­</strong>ï¼šåœ¨ 5 ç§’è¶…æ—¶å†…ä¼˜é›…å…³é—­ HTTP è¿æ¥</li>
</ol>
<p>ä¼˜é›…å…³é—­åºåˆ—ç¡®ä¿æ‰€æœ‰è¿›è¡Œä¸­çš„è¯·æ±‚å®Œæˆï¼ŒåŒæ—¶é˜»æ­¢æ–°è¯·æ±‚ï¼Œåœ¨é‡å¯æœŸé—´ç»´æŠ¤æ•°æ®å®Œæ•´æ€§ã€‚</p>
<h2 data-id="heading-8">æ€§èƒ½è€ƒè™‘</h2>
<p>Hertz è®¾ç½®åŒ…æ‹¬å¤šé¡¹æ€§èƒ½ä¼˜åŒ–ï¼š</p>
<ul>
<li><strong>è¿æ¥æ± </strong>ï¼šé€šè¿‡æ•°æ®åº“å’Œ Redis è¿æ¥è®¾ç½®é…ç½®</li>
<li><strong>è¯·æ±‚è¶…æ—¶</strong>ï¼šå¯é…ç½®çš„è¯»å–ã€å†™å…¥å’Œç©ºé—²è¶…æ—¶é˜²æ­¢èµ„æºæ³„æ¼</li>
<li><strong>ä¸­é—´ä»¶é¡ºåº</strong>ï¼šå…³é”®ä¸­é—´ä»¶ï¼ˆæ¢å¤ã€CORSï¼‰ç½®äºè®¤è¯ä¹‹å‰ä»¥è·å¾—æœ€ä½³æ€§èƒ½</li>
<li><strong>é™æ€æ–‡ä»¶å¤„ç†</strong>ï¼šé€šè¿‡ Hertz å†…ç½®çš„é™æ€æ–‡ä»¶åŠŸèƒ½é«˜æ•ˆæä¾›</li>
</ul>
<h2 data-id="heading-9">é›†æˆç‚¹</h2>
<p>Hertz ä¸å…¶ä»–ç³»ç»Ÿç»„ä»¶æ— ç¼é›†æˆï¼š</p>
<ul>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šåŸºäº Redis çš„å¼‚æ­¥å¤„ç†é˜Ÿåˆ—</li>
<li><strong>æ•°æ®åº“</strong>ï¼šGORM é›†æˆç”¨äºæ•°æ®æŒä¹…åŒ–</li>
<li><strong>AI æœåŠ¡</strong>ï¼šEino æ¡†æ¶é›†æˆç”¨äº AI Agent ç¼–æ’</li>
<li><strong>æ–‡ä»¶å­˜å‚¨</strong>ï¼šç®€å†ä¸Šä¼ å’Œç®¡ç†èƒ½åŠ›</li>
</ul>
<p>æ¡†æ¶çš„æ¨¡å—åŒ–è®¾è®¡å…è®¸è½»æ¾æ‰©å±•å’Œç»´æŠ¤ï¼ŒåŒæ—¶ä¸º AI Interview Agent å¹³å°ä¿æŒé«˜æ€§èƒ½å’Œå¯é æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redissonåˆ†å¸ƒå¼é”å®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7585463195201339442</link>    <guid>https://juejin.cn/post/7585463195201339442</guid>    <pubDate>2025-12-20T08:01:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463195201339442" data-draft-id="7585446706327388169" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redissonåˆ†å¸ƒå¼é”å®ç°åŸç†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:01:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sir761"/> <meta itemprop="url" content="https://juejin.cn/user/1285746184422272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redissonåˆ†å¸ƒå¼é”å®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285746184422272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sir761
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:01:18.000Z" title="Sat Dec 20 2025 08:01:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¯´åˆ°redisçš„åˆ†å¸ƒå¼é”å®¹æ˜“æƒ³åˆ°äº†setNxï¼Œå¥½å¤„æ˜¯å®ç°ç®€å•ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€äº›é—®é¢˜æ¯”å¦‚è¯¯åˆ é”é—®é¢˜ã€é”ä¸å¯é‡å…¥é—®é¢˜ã€‚æ‰€ä»¥Redissonå¹¶æ²¡æœ‰é€šè¿‡setNxå‘½ä»¤æ¥å®ç°åŠ é”ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€å¥—å®Œæˆçš„åŠ é”çš„é€»è¾‘</p>
<h3 data-id="heading-0">åŠ é”ä¸è§£é”</h3>
<p>RLockç»§æ‰¿äº†Javaçš„lockæ¥å£ï¼ŒRedissonLockç»§æ‰¿è‡ªRedissonBaseLockï¼ˆæŠ½è±¡ç±»ï¼‰ï¼Œè€ŒRedissonBaseLockåˆå®ç°äº†RLockã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//è°ƒç”¨getLockæ—¶å€™å°±æ˜¯newäº†ä¸€ä¸ªRedissonLock</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">RLock</span> <span class="hljs-title function_">getLock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedissonLock</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">commandExecutor</span>, name);
}
</code></pre>
<p>æˆ‘ä»¬é‡ç‚¹çœ‹lockæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> void lock() {
 Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.lock(-<span class="hljs-number">1L</span>, (TimeUnit)<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);
 Â   } <span class="hljs-keyword">catch</span> (InterruptedException var2) {
 Â  Â  Â  Â <span class="hljs-keyword">throw</span> new IllegalStateException();
 Â   }
}
â€‹
<span class="hljs-keyword">private</span> void lock(long leaseTime, TimeUnit unit, boolean interruptibly) throws InterruptedException {
 Â  Â long threadId = Thread.currentThread().getId();
 Â  Â <span class="hljs-comment">//è°ƒç”¨äº†tryAcquireè·å–é”ï¼Œè¿™é‡Œä¼ å…¥äº†-1Lä»£è¡¨æ²¡æœ‰æŒ‡å®šé”çš„é‡Šæ”¾æ—¶é—´ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¦‚æœä¸é‡Šæ”¾æ˜¯æ°¸ä¹…æŒæœ‰ã€‚</span>
 Â  Â <span class="hljs-built_in">Long</span> ttl = <span class="hljs-keyword">this</span>.tryAcquire(-<span class="hljs-number">1L</span>, leaseTime, unit, threadId);
 Â  Â <span class="hljs-comment">//ä»¥ä¸‹ä»£ç å…ˆå¿½ç•¥</span>
 Â  Â <span class="hljs-comment">//.....</span>
}
â€‹
<span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> tryAcquire(long waitTime, long leaseTime, TimeUnit unit, long threadId) {
 Â  Â <span class="hljs-comment">//è¿™é‡Œè°ƒç”¨getï¼Œç­‰å¾…futureè¿”å›ã€‚</span>
 Â  Â <span class="hljs-keyword">return</span> (<span class="hljs-built_in">Long</span>)<span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">this</span>.tryAcquireAsync0(waitTime, leaseTime, unit, threadId));
}
â€‹
<span class="hljs-keyword">private</span> RFuture&lt;<span class="hljs-built_in">Long</span>&gt; tryAcquireAsync0(long waitTime, long leaseTime, TimeUnit unit, long threadId) {
 Â  Â <span class="hljs-comment">//ä½¿ç”¨äº†çº¿ç¨‹æ± å»è·å–é”</span>
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getServiceManager().execute(() -&gt; {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tryAcquireAsync(waitTime, leaseTime, unit, threadId);
 Â   });
}
<span class="hljs-comment">//é‡ç‚¹æ–¹æ³•æ¥äº†</span>
<span class="hljs-keyword">private</span> RFuture&lt;<span class="hljs-built_in">Long</span>&gt; tryAcquireAsync(long waitTime, long leaseTime, TimeUnit unit, long threadId) {
 Â  Â RFuture ttlRemainingFuture;
 Â  Â <span class="hljs-keyword">if</span> (leaseTime &gt; <span class="hljs-number">0L</span>) {
 Â  Â  Â  Â <span class="hljs-comment">//å¦‚æœè¿™é‡ŒleaseTimeä¸ä¸º0è¯´æ˜ç”¨æˆ·è®¾ç½®äº†é”çš„ç§Ÿçº¦æ—¶é—´ç›´æ¥ä¼ å…¥ã€‚</span>
 Â  Â  Â  Â ttlRemainingFuture = <span class="hljs-keyword">this</span>.tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);
 Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â <span class="hljs-comment">//å¦‚æœè¿™é‡ŒleaseTimeä¸º0è¯´æ˜ç”¨æˆ·æ²¡æœ‰é™åˆ¶é”çš„ç§Ÿçº¦æ—¶é—´ï¼Œä½†æ˜¯è¿™é‡Œä»ç„¶ä¼šä¼ 30ç§’çš„æŒæœ‰æ—¶é—´</span>
 Â  Â  Â  Â ttlRemainingFuture = <span class="hljs-keyword">this</span>.tryLockInnerAsync(waitTime, <span class="hljs-keyword">this</span>.internalLockLeaseTime, TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);
 Â   }
â€‹
 Â  Â CompletionStage&lt;<span class="hljs-built_in">Long</span>&gt; s = <span class="hljs-keyword">this</span>.handleNoSync(threadId, ttlRemainingFuture);
 Â  Â RFuture&lt;<span class="hljs-built_in">Long</span>&gt; ttlRemainingFuture = new CompletableFutureWrapper(s);
 Â  Â CompletionStage&lt;<span class="hljs-built_in">Long</span>&gt; f = ttlRemainingFuture.thenApply((ttlRemaining) -&gt; {
 Â  Â  Â  Â <span class="hljs-comment">//å¦‚æœä¸ºç©ºè¯´æ˜luaè·å–é”è„šæœ¬è·å¾—äº†é”</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (ttlRemaining == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å¼€å¯çœ‹é—¨ç‹—æœºåˆ¶ã€‚</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (leaseTime &gt; <span class="hljs-number">0L</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.internalLockLeaseTime = unit.toMillis(leaseTime);
 Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.scheduleExpirationRenewal(threadId);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">return</span> ttlRemaining;
 Â   });
 Â  Â <span class="hljs-keyword">return</span> new CompletableFutureWrapper(f);
}
&lt;T&gt; RFuture&lt;T&gt; tryLockInnerAsync(long waitTime, long leaseTime, TimeUnit unit, long threadId, RedisStrictCommand&lt;T&gt; command) {
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.evalWriteSyncedNoRetryAsync(<span class="hljs-keyword">this</span>.getRawName(), LongCodec.INSTANCE, command, 
    <span class="hljs-string">"if ((redis.call('exists', KEYS[1]) == 0) or (redis.call('hexists', KEYS[1], ARGV[2]) == 1)) then "</span> +
        <span class="hljs-string">"redis.call('hincrby', KEYS[1], ARGV[2], 1); "</span> +
        <span class="hljs-string">"redis.call('pexpire', KEYS[1], ARGV[1]); "</span>+
        <span class="hljs-string">"return nil; "</span>+ 
    <span class="hljs-string">"end;"</span>+
    <span class="hljs-comment">//è¿”å›é”çš„è¿‡æœŸæ—¶é—´ã€‚</span>
    <span class="hljs-string">"return redis.call('pttl', KEYS[1]);"</span>, 
    Collections.singletonList(<span class="hljs-keyword">this</span>.getRawName()), new Object[]{unit.toMillis(leaseTime), <span class="hljs-keyword">this</span>.getLockName(threadId)});
}
</code></pre>
<p>è·å–é”çš„æ•´ä¸ªé€»è¾‘æ˜¯ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7303c1cfaf4549c39ec9472e6462b533~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2lyNzYx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766822478&amp;x-signature=QQsH%2FZidVMS0dKLq54qchV%2F1e0E%3D" alt="åˆ†å¸ƒå¼é”è·å–è¿‡ç¨‹.drawio-1764576921173-4.png" loading="lazy"/>
é¦–å…ˆï¼Œå¦‚æœç”¨æˆ·è°ƒç”¨è·å–é”æ—¶å€™æ²¡æœ‰é™åˆ¶ç§Ÿçº¦æ—¶é—´ï¼Œredissonä¼šè‡ªåŠ¨ç»™tryLockInnerAsyncåŠ ä¸Šä¸€ä¸ª30ç§’çš„ç§Ÿçº¦æ—¶é—´ï¼Œå¹¶è°ƒç”¨scheduleExpirationRenewalè¿›è¡Œçœ‹é—¨ç‹—æœºåˆ¶</p>
<p>tryLockInnerAsyncæ˜¯æ‰§è¡Œäº†ä¸€ä¸ªluaè„šæœ¬ï¼Œé¦–å…ˆredissonä»–é‡‡ç”¨çš„æ˜¯hashæ¥å­˜æ”¾è¿™ä¸ªé”ï¼Œkeyæ˜¯é”çš„åå­—ï¼Œfieldç”±UUIDå’Œçº¿ç¨‹idç»„æˆï¼ˆUUIDæ˜¯åŒºåˆ†ä¸åŒå®¢æˆ·ç«¯ï¼Œé˜²æ­¢ä¸åŒå®¢æˆ·ç«¯ä½†æ˜¯çº¿ç¨‹åæ°å¥½ç›¸åŒï¼‰ï¼Œvalueæ˜¯é”çš„é‡å…¥æ¬¡æ•°ã€‚è¿™æ ·å°±é¿å…äº†é”çš„è¯¯åˆ ï¼Œé‡å…¥å’Œæ­»é”é—®é¢˜äº†ã€‚luaçš„å¤§è‡´æµç¨‹ä¸ºï¼š</p>
<ol>
<li>å…ˆåˆ¤æ–­å½“å‰é”æ˜¯å¦è¢«æŒæœ‰æˆ–è€…æŒæœ‰è€…æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯é‡å…¥æ¬¡æ•°åŠ 1ï¼Œå¹¶è®¾ç½®/é‡ç½®æ•´ä¸ªé” Key çš„è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­¢æ­»é”ï¼‰ç„¶åè¿”å›ã€‚</li>
<li>å¦‚æœä¸Šé¢ifä¸æˆç«‹è¯´æ˜é”è¢«<strong>åˆ«äºº</strong>æŒæœ‰äº†ï¼Œåˆ™è¿”å›å½“å‰é”å‰©ä½™çš„å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰ã€‚å®¢æˆ·ç«¯æ‹¿åˆ°è¿™ä¸ªæ—¶é—´åï¼Œä¼šç­‰å¾…è¿™ä¹ˆä¹…å†é‡è¯•ã€‚</li>
</ol>
<p>å›åˆ°åˆšåˆšæˆ‘ä»¬å¿½ç•¥çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">(<span class="hljs-type">long</span> leaseTime, TimeUnit unit, <span class="hljs-type">boolean</span> interruptibly)</span> <span class="hljs-keyword">throws</span> InterruptedException {
 Â  Â <span class="hljs-type">long</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> Thread.currentThread().getId();
 Â  Â <span class="hljs-type">Long</span> <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.tryAcquire(-<span class="hljs-number">1L</span>, leaseTime, unit, threadId);
 Â  Â <span class="hljs-comment">//å¦‚æœè¿™é‡Œttlä¸ä¸ºç©ºè¯´æ˜é”è¢«äººå æœ‰äº†ã€‚</span>
 Â  Â <span class="hljs-keyword">if</span> (ttl != <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â <span class="hljs-comment">//æ­¤æ—¶ä½¿ç”¨pub/subè®¢é˜…è¿™ä¸ªç®¡é“</span>
 Â  Â  Â  Â CompletableFuture&lt;RedissonLockEntry&gt; future = <span class="hljs-built_in">this</span>.subscribe(threadId);
 Â  Â  Â  Â <span class="hljs-built_in">this</span>.pubSub.timeout(future);
 Â  Â  Â  Â <span class="hljs-comment">//å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªSemaphoreç”¨äºæ§åˆ¶æœ¬åœ°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’</span>
 Â  Â  Â  Â RedissonLockEntry entry;
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (interruptibly) {
 Â  Â  Â  Â  Â  Â entry = (RedissonLockEntry)<span class="hljs-built_in">this</span>.commandExecutor.getInterrupted(future);
 Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â entry = (RedissonLockEntry)<span class="hljs-built_in">this</span>.commandExecutor.get(future);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//æ­»å¾ªç¯ç›´åˆ°è·å–é”æˆ–è€…è¢«ä¸­æ–­</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//å…ˆä¹è§‚æŸ¥è¯¢ä¸€æ¬¡</span>
 Â  Â  Â  Â  Â  Â  Â  Â ttl = <span class="hljs-built_in">this</span>.tryAcquire(-<span class="hljs-number">1L</span>, leaseTime, unit, threadId);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (ttl == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span>;
 Â  Â  Â  Â  Â  Â  Â   }
             Â  <span class="hljs-comment">//ä»ç„¶æ²¡æœ‰è·å–åˆ°é”åˆ™è¿›å…¥é˜»å¡é˜¶æ®µ</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (ttl &gt;= <span class="hljs-number">0L</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//é€šè¿‡ttlæ—¶é—´åˆ¤æ–­é”è¿˜æœ‰å¤šä¹…é‡Šæ”¾ï¼Œä»è€Œåˆ¤æ–­é˜»å¡å¤šä¹…ï¼Œé¿å…cpuç©ºè½¬å¸¦æ¥æ€§èƒ½æ¶ˆè€—ï¼Œç²¾å‡†åœ¨é”é‡Šæ”¾æ—¶å€™å”¤é†’</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//å½“æœ‰äººé‡Šæ”¾é”äº†,redissonç›‘å¬åˆ°äº†ä¹‹åè°ƒç”¨entry.getLatch().release(),æˆ–è€…åˆ°è¾¾ttläº†éƒ½ä¼šä½¿çº¿ç¨‹è¢«å”¤é†’</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â entry.getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);
 Â  Â  Â  Â  Â  Â  Â  Â  Â   } <span class="hljs-keyword">catch</span> (InterruptedException var14) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">InterruptedException</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> var14;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (interruptibly) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> e;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//å‡ºç°å¼‚å¸¸äº†ï¼Œé‡æ–°æŠ¢é”</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â entry.getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS);
 Â  Â  Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (interruptibly) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â entry.getLatch().acquire();
 Â  Â  Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â entry.getLatch().acquireUninterruptibly();
 Â  Â  Â  Â  Â  Â  Â   }
 Â  Â  Â  Â  Â   }
 Â  Â  Â   } <span class="hljs-keyword">finally</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">//æœ€åç»ˆæ­¢è®¢é˜…ã€‚</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-built_in">this</span>.unsubscribe(entry, threadId);
 Â  Â  Â   }
 Â   }
}
</code></pre>
<p>è§£é”çš„é€»è¾‘ï¼š</p>
<p>è·ŸåŠ é”é€»è¾‘ä¸€æ ·éƒ½æ˜¯å¼‚æ­¥è½¬æ¢åŒæ­¥ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> RFuture&lt;Void&gt; <span class="hljs-title function_">unlockAsync</span><span class="hljs-params">(<span class="hljs-type">long</span> threadId)</span> {
 Â  Â <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getServiceManager().generateId();
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.getServiceManager().execute(() -&gt; {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.unlockAsync0(threadId, requestId);
 Â   });
}
â€‹
<span class="hljs-keyword">private</span> RFuture&lt;Void&gt; <span class="hljs-title function_">unlockAsync0</span><span class="hljs-params">(<span class="hljs-type">long</span> threadId, String requestId)</span> {
 Â  Â CompletionStage&lt;Boolean&gt; future = <span class="hljs-built_in">this</span>.unlockInnerAsync(threadId, requestId);
 Â  Â <span class="hljs-comment">//å¤„ç†å¼‚å¸¸</span>
 Â  Â CompletionStage&lt;Void&gt; f = future.handle((res, e) -&gt; {
 Â  Â  Â  Â <span class="hljs-built_in">this</span>.cancelExpirationRenewal(threadId, res);
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> CompletionException) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> (CompletionException)e;
 Â  Â  Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletionException</span>(e);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">IllegalMonitorStateException</span> <span class="hljs-variable">cause</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>(<span class="hljs-string">"attempt to unlock lock, not locked by current thread by node id: "</span> + <span class="hljs-built_in">this</span>.id + <span class="hljs-string">" thread-id: "</span> + threadId);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletionException</span>(cause);
 Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
 Â  Â  Â   }
 Â   });
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFutureWrapper</span>(f);
}
â€‹
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> RFuture&lt;Boolean&gt; <span class="hljs-title function_">unlockInnerAsync</span><span class="hljs-params">(<span class="hljs-type">long</span> threadId, String requestId)</span> {
 Â  Â <span class="hljs-keyword">if</span> (requestId == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â requestId = <span class="hljs-built_in">this</span>.getServiceManager().generateId();
 Â   }
â€‹
 Â  Â <span class="hljs-type">MasterSlaveServersConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getServiceManager().getConfig();
 Â  Â <span class="hljs-type">long</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> ((<span class="hljs-type">long</span>)config.getTimeout() + config.getRetryDelay().calcDelay(config.getRetryAttempts()).toMillis()) * (<span class="hljs-type">long</span>)config.getRetryAttempts();
 Â  Â timeout = Math.max(timeout, <span class="hljs-number">1L</span>);
 Â  Â <span class="hljs-comment">//å¼‚æ­¥é‡Šæ”¾é”</span>
 Â  Â RFuture&lt;Boolean&gt; r = <span class="hljs-built_in">this</span>.unlockInnerAsync(threadId, requestId, (<span class="hljs-type">int</span>)timeout);
 Â  Â CompletionStage&lt;Boolean&gt; ff = r.thenApply((v) -&gt; {
 Â  Â  Â  Â <span class="hljs-type">CommandAsyncExecutor</span> <span class="hljs-variable">ce</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.commandExecutor;
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (ce <span class="hljs-keyword">instanceof</span> CommandBatchService) {
 Â  Â  Â  Â  Â  Â ce = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommandBatchService</span>(<span class="hljs-built_in">this</span>.commandExecutor);
 Â  Â  Â   }
â€‹
 Â  Â  Â   ((CommandAsyncExecutor)ce).writeAsync(<span class="hljs-built_in">this</span>.getRawName(), LongCodec.INSTANCE, RedisCommands.DEL, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{<span class="hljs-built_in">this</span>.getUnlockLatchName(<span class="hljs-built_in">this</span>.id)});
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (ce <span class="hljs-keyword">instanceof</span> CommandBatchService) {
 Â  Â  Â  Â  Â   ((CommandBatchService)ce).executeAsync();
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">return</span> v;
 Â   });
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFutureWrapper</span>(ff);
}
â€‹
<span class="hljs-keyword">protected</span> RFuture&lt;Boolean&gt; <span class="hljs-title function_">unlockInnerAsync</span><span class="hljs-params">(<span class="hljs-type">long</span> threadId, String requestId, <span class="hljs-type">int</span> timeout)</span> {
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.evalWriteSyncedNoRetryAsync(<span class="hljs-built_in">this</span>.getRawName(), LongCodec.INSTANCE, RedisCommands.EVAL_BOOLEAN,
<span class="hljs-comment">//é˜²é‡æ£€æŸ¥ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
<span class="hljs-string">"local val = redis.call('get', KEYS[3]);"</span>+
<span class="hljs-string">"if val ~= false then "</span>+
    <span class="hljs-string">"return tonumber(val);"</span>+
<span class="hljs-string">"end;"</span>+
<span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æŒæœ‰é”</span>
<span class="hljs-string">"if (redis.call('hexists', KEYS[1], ARGV[3]) == 0) then "</span>+
    <span class="hljs-string">"return nil;"</span>+
<span class="hljs-string">"end; "</span>+
<span class="hljs-comment">//æ‰£å‡é‡å…¥æ¬¡æ•°</span>
<span class="hljs-string">"local counter = redis.call('hincrby', KEYS[1], ARGV[3], -1); "</span>+
<span class="hljs-comment">//åˆ¤æ–­æ˜¯â€œé‡å…¥é‡Šæ”¾â€è¿˜æ˜¯â€œå½»åº•é‡Šæ”¾â€</span>
<span class="hljs-string">"if (counter &gt; 0) then "</span>+
    <span class="hljs-comment">//é‡å…¥æ¬¡æ•°å‡1</span>
    <span class="hljs-string">"redis.call('pexpire', KEYS[1], ARGV[2]); "</span>+
    <span class="hljs-string">"redis.call('set', KEYS[3], 0, 'px', ARGV[5]); "</span>+
<span class="hljs-string">"return 0; "</span>+
<span class="hljs-string">"else "</span>+
    <span class="hljs-comment">//å½»åº•é‡Šæ”¾é”</span>
    <span class="hljs-string">"redis.call('del', KEYS[1]); "</span>+
    <span class="hljs-comment">//å‘é€é˜Ÿåˆ—æ¶ˆæ¯</span>
    <span class="hljs-string">"redis.call(ARGV[4], KEYS[2], ARGV[1]); "</span>+
    <span class="hljs-string">"redis.call('set', KEYS[3], 1, 'px', ARGV[5]); "</span>+
    <span class="hljs-string">"return 1; "</span>+
<span class="hljs-string">"end; "</span>,
Arrays.asList(<span class="hljs-built_in">this</span>.getRawName(), <span class="hljs-built_in">this</span>.getChannelName(), <span class="hljs-built_in">this</span>.getUnlockLatchName(requestId)), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{LockPubSub.UNLOCK_MESSAGE, <span class="hljs-built_in">this</span>.internalLockLeaseTime, <span class="hljs-built_in">this</span>.getLockName(threadId), <span class="hljs-built_in">this</span>.getSubscribeService().getPublishCommand(), timeout});
}
</code></pre>
<p>luaçš„æµç¨‹ä¸ºï¼š</p>
<p>å…ˆå»æŸ¥ä¸€ä¸‹ KEYS[3]ï¼ˆæŸ¥çœ‹è§£é”è¯·æ±‚çš„ç»“æœç¼“å­˜ï¼‰æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯´æ˜<strong>è¿™ä¸ªè¯·æ±‚ä¹‹å‰å·²ç»å¤„ç†è¿‡äº†</strong>ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œæ³¢åŠ¨å¯¼è‡´å®¢æˆ·ç«¯ä»¥ä¸ºè¶…æ—¶äº†ï¼Œé‡å‘äº†è¯·æ±‚ï¼‰ã€‚ç›´æ¥è¿”å›ä¹‹å‰ç¼“å­˜çš„ç»“æœï¼ˆ0 æˆ– 1ï¼‰ï¼Œä¸éœ€è¦å†æ‰§è¡Œåé¢çš„é€»è¾‘ã€‚è¿™ä¿è¯äº†<strong>å¹‚ç­‰æ€§</strong>ã€‚</p>
<ol start="0">
<li>æ£€æŸ¥ Hash KEYS[1] ä¸­æ˜¯å¦å­˜åœ¨å½“å‰çº¿ç¨‹ ARGV[3]ã€‚å¦‚æœä¸å­˜åœ¨ï¼ˆ== 0ï¼‰ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰æŒæœ‰è¿™æŠŠé”ã€‚è¿”å› nilï¼ˆJava å®¢æˆ·ç«¯ä¼šæŠ›å‡º IllegalMonitorStateExceptionï¼‰ã€‚</li>
<li>å°†è¯¥çº¿ç¨‹çš„åŠ é”è®¡æ•°å™¨å‡ 1ï¼Œcounter æ˜¯å‡å®Œä¹‹åå‰©ä¸‹çš„æ¬¡æ•°ã€‚</li>
<li>å¦‚æœcounter &gt; 0ï¼Œè¯´æ˜é”é‡å…¥äº†ã€‚pexpireï¼šåˆ·æ–°é”çš„è¿‡æœŸæ—¶é—´ï¼ˆçœ‹é—¨ç‹—æ—¶é—´ï¼‰ï¼Œåªè¦é”è¿˜æ²¡å½»åº•é‡Šæ”¾ï¼Œå°±å¾—ç»™å®ƒç»­å‘½ã€‚set KEYS[3] 0ï¼šè®°å½•æœ¬æ¬¡è¯·æ±‚ç»“æœä¸º 0ï¼ˆè¡¨ç¤ºæœªå®Œå…¨é‡Šæ”¾ï¼‰ã€‚è¿”å› 0ï¼Œä»£è¡¨è¿˜æœªé‡Šæ”¾é”ã€‚</li>
<li>å¦‚æœcounter&lt;=0ï¼Œè¯´æ˜é”æ­¤æ—¶å¯ä»¥é‡Šæ”¾äº†ï¼Œè¿™é‡Œä¼šå…ˆåˆ é™¤è¿™ä¸ªé”å¯¹åº”çš„keyï¼Œç„¶åè°ƒç”¨<code>redis.call(ARGV[4], KEYS[2], ARGV[1]);</code>è¿™é‡ŒARGC[4]å…¶å®é€šå¸¸æ˜¯publishå‘é€æ¶ˆæ¯ï¼Œä¹‹æ‰€ä»¥ä¸å†™æ­»æ˜¯å› ä¸ºé›†ç¾¤ä¸‹å¯ä»¥ç”¨spublishåŠ å¿«æ€§èƒ½ã€‚è¿™é‡Œå‘é€æ¶ˆæ¯æ˜¯ä¸ºäº†å‰æ–‡æåˆ°çš„ï¼Œå‘Šè¯‰ç›‘å¬è€…é”å·²ç»é‡Šæ”¾ã€‚set KEYS[3] 1ï¼šç¼“å­˜æœ¬æ¬¡è¯·æ±‚ç»“æœä¸º 1ï¼Œå¹¶å°†1è¿”å›ï¼Œä»£è¡¨é”æˆåŠŸé‡Šæ”¾äº†</li>
</ol>
<p>è¿™é‡Œä¹‹æ‰€ä»¥è¦å¤šå‡ºä¸€ä¸ªKEY[3]æ˜¯ä¸ºäº†<strong>åšå¹‚ç­‰</strong>ã€‚KEY[3]å‘½åä¸€èˆ¬ä¸º{é”å‰ç¼€}:{é”å}:{requestId}ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶å€™éƒ½ä¼šå¸¦ä¸Šä¸åŒçš„requestIdï¼Œvlaueæ˜¯requestIdè¯·æ±‚çš„è§£é”ç»“æœ</p>
<p>å­˜åœ¨ä¸€ç§å¯èƒ½ï¼Œå®¢æˆ·ç«¯é‡å…¥äº†2æ¬¡é”ï¼Œå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è°ƒç”¨unlockæ—¶å€™ï¼Œredisæ­£å¸¸æ‰§è¡Œäº†è§£é”é€»è¾‘ï¼Œå¹¶æ‰£å‡äº†1æ¬¡é”è®°å½•ï¼Œä½†æ˜¯ç”±äºç½‘ç»œæ³¢åŠ¨ï¼Œå“åº”ä¸¢å¤±äº†ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¼šé‡æ–°å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼Œå¯¼è‡´é‡å¤æ‰£å‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±åˆ©ç”¨key[3]ï¼Œåˆ¤æ–­ä¸€ä¸‹ç›¸åŒçš„è¯·æ±‚idæ˜¯å¦æœ‰è®°å½•å¦‚æœæ˜¯å°±ä»£è¡¨ç¡®å®å‘é€äº†å“åº”ä¸¢å¤±ï¼Œç›´æ¥å°†ä¸Šæ¬¡çš„æ•°æ®è¿”å›ï¼Œé¿å…é‡å¤è§£é”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eedf6a2fdad34405a4e6a6423c17e22a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2lyNzYx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766822478&amp;x-signature=KTTnPGHIo7Up7jT%2F0NvTi7QGW1I%3D" alt="Redissoné”æ•°æ®ç»“æ„.drawio.png" loading="lazy"/></p>
<h3 data-id="heading-1">å…¬å¹³é”</h3>
<p>ä»¥ä¸Šé”æ˜¯é»˜è®¤éå…¬å¹³é”ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å»äº‰æŠ¢é”ï¼Œè€Œå…¬å¹³é”åˆ™æ˜¯è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œé˜²æ­¢é¥¥é¥¿é—®é¢˜ã€‚</p>
<p>å½“æˆ‘ä»¬getFairLockæ—¶å€™å…¶å®æ˜¯newäº†ä¸€ä¸ªRedissonFairLock</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">RLock</span> <span class="hljs-title function_">getFairLock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedissonFairLock</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">commandExecutor</span>, name);
}
</code></pre>
<p>RedissonFairLockç»§æ‰¿è‡ªRedissonLockä¹Ÿå°±æ˜¯è¯´åŠ é”çš„æµç¨‹éƒ½æ˜¯å¤§è‡´ç›¸åŒçš„ã€‚RedissonFairLocké‡å†™äº†tryLockInnerAsyncæ–¹æ³•</p>
<pre><code class="hljs language-ini" lang="ini">&lt;T&gt; RFuture&lt;T&gt; tryLockInnerAsync(long waitTime, long leaseTime, TimeUnit unit, long threadId, RedisStrictCommand&lt;T&gt; command) {
 Â  Â long <span class="hljs-attr">wait</span> = this.threadWaitTime<span class="hljs-comment">;</span>
 Â  Â if (waitTime &gt; 0L) {
 Â  Â  Â  Â <span class="hljs-attr">wait</span> = unit.toMillis(waitTime)<span class="hljs-comment">;</span>
 Â   }
â€‹
 Â  Â long <span class="hljs-attr">currentTime</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
 Â  Â if (<span class="hljs-attr">command</span> == RedisCommands.EVAL_NULL_BOOLEAN) {
 Â  Â  Â  Â return this.commandExecutor.syncedEvalNoRetry(
 Â  Â  Â  Â  Â  Â this.getRawName(),
 Â  Â  Â  Â  Â  Â LongCodec.INSTANCE,
 Â  Â  Â  Â  Â  Â command,
 Â  Â  Â  Â  Â  Â // Luaè„šæœ¬ - ç”¨äºè·å–é”
 Â  Â  Â  Â  Â  Â "while true do " +
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">firstThreadId2</span> = redis.call(<span class="hljs-string">'lindex'</span>, KEYS[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   if <span class="hljs-attr">firstThreadId2</span> == <span class="hljs-literal">false</span> then <span class="hljs-string">" +
 Â  Â  Â  Â  Â  Â "</span> Â  Â  Â   break<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">timeout</span> = redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], firstThreadId2)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   if timeout ~= false and tonumber(timeout) &lt;= tonumber(ARGV<span class="hljs-section">[3]</span>) then " +
 Â  Â  Â  Â  Â  Â " Â  Â  Â   redis.call('zrem', KEYS<span class="hljs-section">[3]</span>, firstThreadId2)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â  Â  Â   redis.call('lpop', KEYS<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   else " +
 Â  Â  Â  Â  Â  Â " Â  Â  Â   break<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if (redis.call('exists', KEYS<span class="hljs-section">[1]</span>) == 0) and ((redis.call('exists', KEYS<span class="hljs-section">[2]</span>) == 0) or (redis.call('lindex', KEYS<span class="hljs-section">[2]</span>, 0) == ARGV<span class="hljs-section">[2]</span>)) then " +
 Â  Â  Â  Â  Â  Â " Â   redis.call('lpop', KEYS<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('zrem', KEYS<span class="hljs-section">[3]</span>, ARGV<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">keys</span> = redis.call(<span class="hljs-string">'zrange'</span>, KEYS[<span class="hljs-number">3</span>], <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   for <span class="hljs-attr">i</span> = <span class="hljs-number">1</span>, <span class="hljs-comment">#keys, 1 do " +</span>
 Â  Â  Â  Â  Â  Â " Â  Â  Â   redis.call('zincrby', KEYS<span class="hljs-section">[3]</span>, -tonumber(ARGV<span class="hljs-section">[4]</span>), keys<span class="hljs-section">[i]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('hset', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[2]</span>, 1)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('pexpire', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[1]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   return nil<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if (redis.call('hexists', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[2]</span>) == 1) then " +
 Â  Â  Â  Â  Â  Â " Â   redis.call('hincrby', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[2]</span>, 1)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('pexpire', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[1]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   return nil<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "return 1<span class="hljs-comment">;",</span>
 Â  Â  Â  Â  Â  Â Arrays.asList(this.getRawName(), this.threadsQueueName, this.timeoutSetName),
 Â  Â  Â  Â  Â  Â new Object<span class="hljs-section">[]</span>{unit.toMillis(leaseTime), this.getLockName(threadId), currentTime, wait}
 Â  Â  Â   )<span class="hljs-comment">;</span>
 Â   } else if (<span class="hljs-attr">command</span> == RedisCommands.EVAL_LONG) {
 Â  Â  Â  Â return this.commandExecutor.syncedEvalNoRetry(
 Â  Â  Â  Â  Â  Â this.getRawName(),
 Â  Â  Â  Â  Â  Â LongCodec.INSTANCE,
 Â  Â  Â  Â  Â  Â command,
 Â  Â  Â  Â  Â  Â // Luaè„šæœ¬ - ç”¨äºå°è¯•è·å–é”å¹¶è¿”å›TTL
 Â  Â  Â  Â  Â  Â "while true do " +
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">firstThreadId2</span> = redis.call(<span class="hljs-string">'lindex'</span>, KEYS[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   if <span class="hljs-attr">firstThreadId2</span> == <span class="hljs-literal">false</span> then <span class="hljs-string">" +
 Â  Â  Â  Â  Â  Â "</span> Â  Â  Â   break<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">timeout</span> = redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], firstThreadId2)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   if timeout ~= false and tonumber(timeout) &lt;= tonumber(ARGV<span class="hljs-section">[4]</span>) then " +
 Â  Â  Â  Â  Â  Â " Â  Â  Â   redis.call('zrem', KEYS<span class="hljs-section">[3]</span>, firstThreadId2)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â  Â  Â   redis.call('lpop', KEYS<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   else " +
 Â  Â  Â  Â  Â  Â " Â  Â  Â   break<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if (redis.call('exists', KEYS<span class="hljs-section">[1]</span>) == 0) and ((redis.call('exists', KEYS<span class="hljs-section">[2]</span>) == 0) or (redis.call('lindex', KEYS<span class="hljs-section">[2]</span>, 0) == ARGV<span class="hljs-section">[2]</span>)) then " +
 Â  Â  Â  Â  Â  Â " Â   redis.call('lpop', KEYS<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('zrem', KEYS<span class="hljs-section">[3]</span>, ARGV<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">keys</span> = redis.call(<span class="hljs-string">'zrange'</span>, KEYS[<span class="hljs-number">3</span>], <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   for <span class="hljs-attr">i</span> = <span class="hljs-number">1</span>, <span class="hljs-comment">#keys, 1 do " +</span>
 Â  Â  Â  Â  Â  Â " Â  Â  Â   redis.call('zincrby', KEYS<span class="hljs-section">[3]</span>, -tonumber(ARGV<span class="hljs-section">[3]</span>), keys<span class="hljs-section">[i]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('hset', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[2]</span>, 1)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('pexpire', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[1]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   return nil<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if redis.call('hexists', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[2]</span>) == 1 then " +
 Â  Â  Â  Â  Â  Â " Â   redis.call('hincrby', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[2]</span>, 1)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   redis.call('pexpire', KEYS<span class="hljs-section">[1]</span>, ARGV<span class="hljs-section">[1]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   return nil<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "local <span class="hljs-attr">timeout</span> = redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">2</span>])<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if timeout ~= false then " +
 Â  Â  Â  Â  Â  Â " Â   local <span class="hljs-attr">ttl</span> = redis.call(<span class="hljs-string">'pttl'</span>, KEYS[<span class="hljs-number">1</span>])<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â " Â   return math.max(0, ttl)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "local <span class="hljs-attr">lastThreadId</span> = redis.call(<span class="hljs-string">'lindex'</span>, KEYS[<span class="hljs-number">2</span>], -<span class="hljs-number">1</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "local ttl<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if lastThreadId ~= false and lastThreadId ~= ARGV<span class="hljs-section">[2]</span> and redis.call('zscore', KEYS<span class="hljs-section">[3]</span>, lastThreadId) ~= false then " +
 Â  Â  Â  Â  Â  Â " Â   <span class="hljs-attr">ttl</span> = tonumber(redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], lastThreadId)) - tonumber(ARGV[<span class="hljs-number">4</span>])<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "else " +
 Â  Â  Â  Â  Â  Â " Â   <span class="hljs-attr">ttl</span> = redis.call(<span class="hljs-string">'pttl'</span>, KEYS[<span class="hljs-number">1</span>])<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "local <span class="hljs-attr">timeout</span> = ttl + tonumber(ARGV[<span class="hljs-number">3</span>]) + tonumber(ARGV[<span class="hljs-number">4</span>])<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "if redis.call('zadd', KEYS<span class="hljs-section">[3]</span>, timeout, ARGV<span class="hljs-section">[2]</span>) == 1 then " +
 Â  Â  Â  Â  Â  Â " Â   redis.call('rpush', KEYS<span class="hljs-section">[2]</span>, ARGV<span class="hljs-section">[2]</span>)<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "end<span class="hljs-comment">; " +</span>
 Â  Â  Â  Â  Â  Â "return ttl<span class="hljs-comment">;",</span>
 Â  Â  Â  Â  Â  Â Arrays.asList(this.getRawName(), this.threadsQueueName, this.timeoutSetName),
 Â  Â  Â  Â  Â  Â new Object<span class="hljs-section">[]</span>{unit.toMillis(leaseTime), this.getLockName(threadId), wait, currentTime}
 Â  Â  Â   )<span class="hljs-comment">;</span>
 Â   } else {
 Â  Â  Â  Â throw new IllegalArgumentException()<span class="hljs-comment">;</span>
 Â   }
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¿©æ®µluaè„šæœ¬ï¼Œç¬¬ä¸€æ®µå¯¹åº”çš„æ˜¯æ— å‚çš„tryLockï¼ˆï¼‰æ–¹æ³•ï¼Œè¿›è¡Œä¸€æ¬¡å¿«é€Ÿå°è¯•ï¼Œå¦‚æœè·å–ä¸åˆ°é”ç›´æ¥è¿”å›ã€‚ç¬¬äºŒæ®µå¯¹åº”çš„æ˜¯tryLock(waitTime)/lockè¿™ä¿©ä¸ªé˜»å¡ç­‰é”çš„æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬é‡ç‚¹çœ‹ç¬¬äºŒæ®µluaè„šæœ¬ï¼Œç¬¬ä¸€ä¸ªluaè„šæœ¬å’Œç¬¬äºŒä¸ªç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-java" lang="java">--å¾ªç¯çš„åˆ¤æ–­æ˜¯å¦æœ‰waitTimeå·²ç»è¶…è¿‡çš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å°±å‰”é™¤æ‰ï¼Œé˜²æ­¢å ç”¨ç€é˜Ÿåˆ—
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">do</span> 
 Â  Â --æŸ¥è¯¢ç­‰å¾…é˜Ÿåˆ—å¤´èŠ‚ç‚¹æ˜¯ä»€ä¹ˆ
 Â  Â <span class="hljs-type">local</span> <span class="hljs-variable">firstThreadId2</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'lindex'</span>, KEYS[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>); 
 Â  Â --å¦‚æœç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºåˆ™è·³å‡ºå¾ªç¯
 Â  Â <span class="hljs-keyword">if</span> firstThreadId2 == <span class="hljs-literal">false</span> then 
 Â  Â  Â  Â <span class="hljs-keyword">break</span>; 
 Â  Â end; 
 Â  Â --ä¸ä¸ºç©ºï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è¶…è¿‡äº†è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœæ˜¯å°±åˆ é™¤æ‰ï¼Œæ²¡æœ‰å°±è·³å‡ºå¾ªç¯
 Â  Â <span class="hljs-type">local</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], firstThreadId2); 
 Â  Â <span class="hljs-keyword">if</span> timeout ~= <span class="hljs-literal">false</span> and <span class="hljs-title function_">tonumber</span><span class="hljs-params">(timeout)</span> &lt;= tonumber(ARGV[<span class="hljs-number">4</span>]) then 
 Â  Â  Â  Â redis.call(<span class="hljs-string">'zrem'</span>, KEYS[<span class="hljs-number">3</span>], firstThreadId2); 
 Â  Â  Â  Â redis.call(<span class="hljs-string">'lpop'</span>, KEYS[<span class="hljs-number">2</span>]); 
 Â  Â <span class="hljs-keyword">else</span> 
 Â  Â  Â  Â <span class="hljs-keyword">break</span>; 
 Â  Â end; 
end; 
--åˆ¤æ–­ä¸€ä¸‹é”æ˜¯å¦æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰å¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—ä¸å­˜åœ¨ï¼ˆç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºï¼‰æˆ–è€…å¯¹å¤´æ˜¯æ­¤çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åˆ™è¿›å…¥æŠ¢é”ã€‚
<span class="hljs-keyword">if</span> (redis.call(<span class="hljs-string">'exists'</span>, KEYS[<span class="hljs-number">1</span>]) == <span class="hljs-number">0</span>) and ((redis.call(<span class="hljs-string">'exists'</span>, KEYS[<span class="hljs-number">2</span>]) == <span class="hljs-number">0</span>) or (redis.call(<span class="hljs-string">'lindex'</span>, KEYS[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>) == ARGV[<span class="hljs-number">2</span>])) then 
 Â  Â --å°†è‡ªå·±ä»é˜Ÿåˆ—ç§»é™¤
 Â  Â redis.call(<span class="hljs-string">'lpop'</span>, KEYS[<span class="hljs-number">2</span>]); 
 Â  Â redis.call(<span class="hljs-string">'zrem'</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">2</span>]); 
 Â  Â <span class="hljs-type">local</span> <span class="hljs-variable">keys</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'zrange'</span>, KEYS[<span class="hljs-number">3</span>], <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>); 
 Â  Â --å¾ªç¯æ•´ä¸ªé˜Ÿåˆ—ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´ï¼ˆå‡å°‘ç­‰å¾…é¢„ç®—ï¼‰
 Â  Â <span class="hljs-type">for</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>, #keys, <span class="hljs-number">1</span> <span class="hljs-keyword">do</span> 
 Â  Â  Â  Â redis.call(<span class="hljs-string">'zincrby'</span>, KEYS[<span class="hljs-number">3</span>], -tonumber(ARGV[<span class="hljs-number">3</span>]), keys[i]); 
 Â  Â end; 
 Â  Â --çœŸæ­£çš„åŠ é”é€»è¾‘ï¼ŒåŠ é”åç›´æ¥è¿”å›ã€‚
 Â  Â redis.call(<span class="hljs-string">'hset'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">2</span>], <span class="hljs-number">1</span>); 
 Â  Â redis.call(<span class="hljs-string">'pexpire'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">1</span>]); 
 Â  Â --è¿”å›nilè¯´æ˜æŠ¢é”æˆåŠŸ
 Â  Â <span class="hljs-keyword">return</span> nil; 
end; 
--å‰é¢åˆ¤æ–­ä¸º<span class="hljs-literal">false</span>ï¼Œè¯´æ˜é”è¢«æŒæœ‰äº†ï¼Œåˆ¤æ–­ä¸€ä¸‹é”æ˜¯å¦è¢«æœ¬çº¿ç¨‹æŒæœ‰ï¼Œå¦‚æœæ˜¯é‡å…¥åŠ <span class="hljs-number">1</span>å¹¶è¿”å›
<span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'hexists'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">2</span>]) == <span class="hljs-number">1</span> then 
 Â  Â redis.call(<span class="hljs-string">'hincrby'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">2</span>], <span class="hljs-number">1</span>); 
 Â  Â redis.call(<span class="hljs-string">'pexpire'</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">1</span>]); 
 Â  Â <span class="hljs-keyword">return</span> nil; 
end; 
--èµ°åˆ°è¿™é‡Œè¯´æ˜é”è¢«å…¶ä»–äººæŒæœ‰äº†ï¼Œæ­¤æ—¶åˆ¤æ–­ä¸€ä¸‹æœ¬çº¿ç¨‹æ˜¯å¦å·²ç»åœ¨æ’é˜Ÿäº†
<span class="hljs-type">local</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">2</span>]); 
<span class="hljs-keyword">if</span> timeout ~= <span class="hljs-literal">false</span> then 
 Â  Â --å¦‚æœåœ¨æ’é˜Ÿäº†ï¼Œåˆ™è¿”å›é”çš„å‰©ä½™æŒæœ‰æ—¶é—´
 Â  Â <span class="hljs-type">local</span> <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'pttl'</span>, KEYS[<span class="hljs-number">1</span>]); 
 Â  Â <span class="hljs-keyword">return</span> math.max(<span class="hljs-number">0</span>, ttl); 
end; 
--èµ°åˆ°è¿™é‡Œè¯´æ˜æ²¡æœ‰å…¥é˜Ÿï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹é˜Ÿå°¾èŠ‚ç‚¹
<span class="hljs-type">local</span> <span class="hljs-variable">lastThreadId</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'lindex'</span>, KEYS[<span class="hljs-number">2</span>], -<span class="hljs-number">1</span>); 
local ttl; 
--å¦‚æœé˜Ÿå°¾èŠ‚ç‚¹å­˜åœ¨ï¼ˆé”è¢«æŒæœ‰ï¼Œæœ‰çº¿ç¨‹ç­‰å¾…æŠ¢é”ï¼‰åˆ™ttlæ˜¯é’±ä¸€ä¸ªäººçš„è¶…æ—¶æ—¶é—´-å½“å‰æ—¶é—´ã€‚
<span class="hljs-keyword">if</span> lastThreadId ~= <span class="hljs-literal">false</span> and lastThreadId ~= ARGV[<span class="hljs-number">2</span>] and redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], lastThreadId) ~= <span class="hljs-literal">false</span> <span class="hljs-type">then</span> 
 Â  Â <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> tonumber(redis.call(<span class="hljs-string">'zscore'</span>, KEYS[<span class="hljs-number">3</span>], lastThreadId)) - tonumber(ARGV[<span class="hljs-number">4</span>]); 
<span class="hljs-keyword">else</span> 
 Â  Â --å¦‚æœé˜Ÿå°¾èŠ‚ç‚¹ä¸å­˜åœ¨ï¼ˆé”è¢«æŒæœ‰ï¼Œä¸”æ²¡æœ‰çº¿ç¨‹ç­‰å¾…æŠ¢é”ï¼‰åˆ™ttlå°±æ˜¯é”çš„è¿‡æœŸæ—¶é—´
 Â  Â ttl = redis.call(<span class="hljs-string">'pttl'</span>, KEYS[<span class="hljs-number">1</span>]); 
end; 
<span class="hljs-type">local</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> ttl + tonumber(ARGV[<span class="hljs-number">3</span>]) + tonumber(ARGV[<span class="hljs-number">4</span>]); 
--ç„¶åå…¥é˜Ÿï¼Œå°†è®¡ç®—å¥½çš„è¶…æ—¶æ—¶é—´æ”¾å…¥Zsetï¼Œå¹¶å°†æœ¬çº¿ç¨‹æ”¾å…¥é˜Ÿå°¾ã€‚
<span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'zadd'</span>, KEYS[<span class="hljs-number">3</span>], timeout, ARGV[<span class="hljs-number">2</span>]) == <span class="hljs-number">1</span> then 
 Â  Â redis.call(<span class="hljs-string">'rpush'</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">2</span>]); 
end; 
--è¿”å›å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œè¿˜éœ€è¦æ—¶é—´ä¸ºttlï¼Œä½¿ç”¨Semaphoreå»é˜»å¡ã€‚ï¼ˆå”¤é†’è¿‡ç¨‹å’Œå‰æ–‡æåˆ°è¿‡çš„ä¸€æ ·ï¼‰
<span class="hljs-keyword">return</span> ttl;
</code></pre>
<p>æ­¤è¿‡ç¨‹ä¸­ç”¨åˆ°äº†Zsetï¼ŒListï¼Œæˆ‘ä»¬ç›´åˆ°Listç”¨äºå­˜æ”¾èµ„æºäº‰æŠ¢è€…ï¼Œé‚£Zsetåˆæ˜¯å¹²å˜›çš„ï¼Ÿ</p>
<p>List è™½ç„¶èƒ½å®Œç¾å®ç° FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼Œä½†å®ƒæœ‰2ä¸ªè‡´å‘½å¼±ç‚¹ï¼š</p>
<ul>
<li><strong>ä¸å¥½åˆ¤æ–­è¿‡æœŸæ—¶é—´</strong>ï¼šList åªèƒ½å‘Šè¯‰ä½ è°æ’ç¬¬ä¸€ï¼Œä½†ä¸èƒ½å‘Šè¯‰ä½ ä»–è¿˜æ˜¯ä¸æ˜¯æ´»çš„ï¼ˆæœ‰æ²¡æœ‰è¶…æ—¶ï¼‰ï¼Œå¦‚æœéè¦åˆ©ç”¨Listå­˜å‚¨è¿‡æœŸæ—¶é—´å°±å¾—é€šè¿‡valueå»åˆ†å‰²ï¼Œä¸ä»…éœ€è¦å ç”¨cpuèµ„æºè€Œä¸”ä¸å¥½åˆ¤æ–­å¦‚ä½•åˆ†å‰²ï¼Œä¸‡ä¸€ç”¨æˆ·å‘½åä¸è§„èŒƒå¯¼è‡´åˆ†å‰²é”™è¯¯ï¼Œæ­¤æ—¶éœ€è¦Zsetï¼Œå®ƒå­˜å‚¨äº†æ¯ä¸ªäººçš„â€œæ­»äº¡æ—¶é—´â€ï¼Œç”¨æ¥åœ¨æ¯æ¬¡æ“ä½œå‰æ¸…ç† List é‡Œçš„åƒµå°¸èŠ‚ç‚¹ã€‚memberæ˜¯uuid+çº¿ç¨‹idï¼Œscoreæ˜¯è¿‡æœŸæ—¶é—´</li>
<li><strong>ä¸å¥½åˆ¤æ–­æ˜¯å¦å½“å‰çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­</strong>ï¼šListéœ€è¦O(n)åˆ¤æ–­ï¼Œæ—¶é—´æ…¢ï¼Œé€šè¿‡Zsetçš„dictæ•°æ®ç»“æ„O(1)åˆ¤æ–­ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œç”±äºæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰å¯èƒ½æ˜¯lockï¼ˆï¼‰è¿™ç§æ— ç­‰å¾…æ—¶é—´ï¼Œä¼šé˜»å¡åˆ°ä¸€ç›´è·å–é”ï¼Œåœ¨Zsetä¸­éš¾é“æˆ‘ä»¬è¦å°†Zsetçš„è¿‡æœŸåˆ†æ•°è®¾ç½®å¾ˆå¤§æˆ–è€…è®¾ç½®ä¸º-1ä»£è¡¨æ²¡æœ‰è¿‡æœŸæ—¶é—´å—ï¼Ÿé‚£å¦‚æœå®¢æˆ·ç«¯å®•æœºäº†ï¼Œè¯¥èŠ‚ç‚¹ä¸å°±å ç”¨è¿™ä¸ªZsetå’Œlistçš„èŠ‚ç‚¹ï¼Œä¸”è°ä¹Ÿæ¸…é™¤ä¸æ‰ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ä¸”è½®åˆ°å®ƒä½œä¸ºå¤´èŠ‚ç‚¹æ—¶å€™ï¼Œåˆä¸ä¼šæŠ¢é”ï¼Œå¯¼è‡´å…¨éƒ¨éƒ½åœ¨æ­»ç­‰ã€‚</p>
<p>æ—§ç‰ˆæœ¬çš„redissonæ˜¯é»˜è®¤ç»™5ç§’è¿‡æœŸæ—¶é—´ï¼Œæ¯æ¬¡5ç§’åå°±åˆ·æ–°ä¸€ä¸‹ï¼Œå¦‚æœå®¢æˆ·ç«¯å®•æœºäº†å°±ä¸ä¼šåˆ·æ–°ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¼šè¢«æ¸…é™¤æ‰ã€‚ä½†æ˜¯å½“ç«äº‰æ¿€çƒˆçš„æ—¶å€™5ç§’è·å–ä¸åˆ°é”æ—¶å€™å¤§é‡çš„çº¿ç¨‹é†’è¿‡æ¥åŒæ—¶å»æ›´æ–°è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæƒŠç¾¤æ•ˆåº”ä¼šå¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œåç»­æ–°ç‰ˆæœ¬æ”¹ä¸ºäº†5åˆ†é’Ÿã€‚</p>
<p>å¦‚å›¾ï¼Œæ¯”èµ·éå…¬å¹³é”å¤šäº†ä¿©ä¸ªæ•°æ®ç»“æ„</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fcdc19af5dd40fcb4c907beb88fa65c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2lyNzYx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766822478&amp;x-signature=fCOelRfQZtVqpd7k%2FW%2BCSTzULqE%3D" alt="åˆ†å¸ƒå¼å…¬å¹³é”è·å–è¿‡ç¨‹.drawio.png" loading="lazy"/></p>
<p>è‹¥æœ‰é”™è¯¯æ¬¢è¿æŒ‡å‡ºï¼Œå°†åŠæ—¶æ”¹æ­£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kibanaï¼šä½¿ç”¨ ES|QL æ„å»ºåœ°å›¾ï¼Œå¯¹å›½å®¶æˆ–åœ°åŒºçš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”]]></title>    <link>https://juejin.cn/post/7585474459776335908</link>    <guid>https://juejin.cn/post/7585474459776335908</guid>    <pubDate>2025-12-20T08:22:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776335908" data-draft-id="7585474459776319524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kibanaï¼šä½¿ç”¨ ES|QL æ„å»ºåœ°å›¾ï¼Œå¯¹å›½å®¶æˆ–åœ°åŒºçš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-20T08:22:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kibanaï¼šä½¿ç”¨ ES|QL æ„å»ºåœ°å›¾ï¼Œå¯¹å›½å®¶æˆ–åœ°åŒºçš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:22:04.000Z" title="Sat Dec 20 2025 08:22:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šæ¥è‡ª ElasticÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscuss.elastic.co%2Fu%2Fnathan_reese" title="https://discuss.elastic.co/u/nathan_reese" target="_blank" ref="nofollow noopener noreferrer">Nathan_Reese</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/856719b33e094553a77f3f6a06f3920a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=sIwkFyIrQn5FbGU4%2Ful7xVJkdLg%3D" alt="" loading="lazy"/></p>
<p>Kibana åœ°å›¾ æ•™ç¨‹ â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fguide%2Fen%2Fkibana%2F8.19%2Fmaps-getting-started.html" title="https://www.elastic.co/guide/en/kibana/8.19/maps-getting-started.html" target="_blank" ref="nofollow noopener noreferrer">æ„å»ºåœ°å›¾ï¼Œç”¨äºæŒ‰å›½å®¶æˆ–åœ°åŒºå¯¹æ¯”æŒ‡æ ‡</a>â€ ä½¿ç”¨ Elasticsearch çš„ DSL æŸ¥è¯¢ æ¥åˆ›å»ºåœ°å›¾ã€‚æœ€è¿‘æ–°å¢çš„ ES|QL å‡½æ•° <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Freference%2Fquery-languages%2Fesql%2Fcommands%2Flookup-join" title="https://www.elastic.co/docs/reference/query-languages/esql/commands/lookup-join" target="_blank" ref="nofollow noopener noreferrer">LOOKUP JOIN</a>ï¼ˆ 8.18 ï¼‰å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Freference%2Fquery-languages%2Fesql%2Ffunctions-operators%2Fspatial-functions%23esql-st_geotile" title="https://www.elastic.co/docs/reference/query-languages/esql/functions-operators/spatial-functions#esql-st_geotile" target="_blank" ref="nofollow noopener noreferrer">ST_GEOTILE</a>ï¼ˆ 9.2 ï¼‰ä½¿å¾—å¯ä»¥ä½¿ç”¨ ES|QL é‡æ–°åˆ›å»ºè¯¥æ•™ç¨‹ä¸­çš„åœ°å›¾ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨ ES|QL é‡æ–°åˆ›å»ºè¯¥æ•™ç¨‹åœ°å›¾çš„æ­¥éª¤ã€‚éšåï¼Œè¿™äº›æ­¥éª¤è¿˜è¶…å‡ºäº†åŸå§‹æ•™ç¨‹çš„èƒ½åŠ›èŒƒå›´ï¼Œå¹¶æŒ‰å›½å®¶äººå£å¯¹åˆ†çº§è®¾è‰²å›¾å±‚è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚</p>
<h2 data-id="heading-0">å‰ææ¡ä»¶</h2>
<ul>
<li>å¦‚æœä½ è¿˜æ²¡æœ‰ Kibanaï¼Œè¯·ä½¿ç”¨æˆ‘ä»¬çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Felasticsearch-service%2Fsignup%3Fbaymax%3Ddocs-body%26elektra%3Ddocs" title="https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=docs-body&amp;elektra=docs" target="_blank" ref="nofollow noopener noreferrer">å…è´¹è¯•ç”¨</a> è¿›è¡Œè®¾ç½®ã€‚</li>
<li>æœ¬æ•™ç¨‹éœ€è¦ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fguide%2Fen%2Fkibana%2F8.19%2Fget-started.html" title="https://www.elastic.co/guide/en/kibana/8.19/get-started.html" target="_blank" ref="nofollow noopener noreferrer">web logs ç¤ºä¾‹æ•°æ®é›†</a>ã€‚</li>
<li>ä½ å¿…é¡»å…·å¤‡åˆ›å»ºåœ°å›¾å’Œåˆ›å»ºç´¢å¼•çš„æ­£ç¡®æƒé™ã€‚</li>
<li><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ee18d03841d4a7b96cdced29f035bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=6L9%2BwGiBlMHJT3I5WumIGOqBYNM%3D" alt="" loading="lazy"/></li>
</ul>
<h2 data-id="heading-1">æ­¥éª¤ 1ï¼šåˆ›å»º åœ°å›¾</h2>
<ul>
<li>å‰å¾€ Dashboardsã€‚</li>
<li>ç‚¹å‡» Create dashboardã€‚</li>
<li>å°†æ—¶é—´èŒƒå›´è®¾ç½®ä¸º Last 7 daysã€‚</li>
<li>ç‚¹å‡» Add æŒ‰é’®å¹¶é€‰æ‹© New panelï¼Œæœ€åç‚¹å‡» Mapsã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75fc5d68a38a40f792bc5d21960ce2fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=mJiW3kgJ8oYBKljJb4IvqZq81ls%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/299c6ca01e7841c8b6e1531d07ad0624~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=scm067o%2BWSNTSko5PB19C0sNp5Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdad565309644328b1aaf0a42913a686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=PtY7x5OTT9xrruWB1E2nPc8dI6I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bf44c4e950944ca850b10893148010d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=lw1aRSNzzIR4M%2FTiDrYGyyi4L3I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77d62ab1b5054e3c8e88a8af9ef37d81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=nkla1tjbPRClZk0W0d0D4OzLjvI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c59530e10ed7425189a9495e511ae321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=Ff2hpwV1S%2FqsEW9kp%2BWcWaYKlyA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">æ­¥éª¤ 2. æ·»åŠ ä¸€ä¸ª choropleth å›¾å±‚</h2>
<p>ä½ å°†æ·»åŠ çš„ç¬¬ä¸€ä¸ªå›¾å±‚æ˜¯ä¸€ä¸ª choropleth å›¾å±‚ï¼Œç”¨äºæŒ‰ web æ—¥å¿—æµé‡ä¸ºä¸–ç•Œå„å›½ç€è‰²ã€‚è¾ƒæ·±çš„é¢œè‰²è¡¨ç¤º web æ—¥å¿—æµé‡è¾ƒå¤šçš„å›½å®¶ï¼Œè¾ƒæµ…çš„é¢œè‰²è¡¨ç¤ºæµé‡è¾ƒå°‘çš„å›½å®¶ã€‚</p>
<h3 data-id="heading-3">ç´¢å¼•ä¸–ç•Œå›½å®¶</h3>
<ul>
<li>ä¸‹è½½<a href="https://link.juejin.cn?target=https%3A%2F%2Fmaps.elastic.co%2F%23file%2Fworld_countries" title="https://maps.elastic.co/#file/world_countries" target="_blank" ref="nofollow noopener noreferrer">ä¸–ç•Œå›½å®¶ GeoJSON</a> æ–‡ä»¶</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfefe39ae1fd487aa0309dddf21cd827~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=eACxlm%2BKon4ew2isg3ZK3iirlJw%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ Kibana maps ä¸­ï¼Œç‚¹å‡» Add layer</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6248b5f4f086401e9d30e61074397de2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=1PagyFqjZttoljj5MD9LPscOGsw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/920a2f78b8384cf8b662807c1b109b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=%2BbCKB6%2FzjuUt5rIvcVSHa4%2BnWGc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2521840315d547edb220d8935431def9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=Zl4BlgIF%2F0OOIPL0i6Ld6kN6U5M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3077a8304ea04d90a34dcae0b504e448~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=mp%2BmwWXkFNUkH%2FNE%2FiBrxviIURM%3D" alt="" loading="lazy"/></p>
<ul>
<li>é€‰æ‹© Upload file</li>
<li>åœ¨æ–‡ä»¶é€‰æ‹©å™¨ä¸­é€‰æ‹©ä¸–ç•Œå›½å®¶ GeoJSON æ–‡ä»¶</li>
<li>å°† Index name è®¾ç½®ä¸º world_countries</li>
<li>æ‰“å¼€ Advanced éƒ¨åˆ†</li>
<li>å°† Index settings è®¾ç½®ä¸º { "index.mode": "lookup" }ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af35066cef874968a8f2ad7341c735bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=HzesTFW6kVSrmxME6gU7qTWCows%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">æ·»åŠ  choropleth å›¾å±‚</h3>
<ul>
<li>ç‚¹å‡» Add layer</li>
<li>é€‰æ‹© ES|QL</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0edb88e6558f4c88852224e928da565f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=6a5vS%2Bc2eTHqlcillFK5yzGRL7A%3D" alt="" loading="lazy"/></p>
<ul>
<li>å°† ES|QL statement è®¾ç½®ä¸º</li>
</ul>

<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  <span class="hljs-keyword">FROM</span> kibana_sample_data_logs 
<span class="hljs-number">2</span>.  | STATS count = COUNT() <span class="hljs-keyword">BY</span> geo.dest 
<span class="hljs-number">3</span>.  | RENAME geo.dest <span class="hljs-keyword">AS</span> iso2.keyword 
<span class="hljs-number">4</span>.  | LOOKUP <span class="hljs-keyword">JOIN</span> world_countries <span class="hljs-keyword">ON</span> iso2.keyword 
<span class="hljs-number">5</span>.  | RENAME iso2.keyword <span class="hljs-keyword">AS</span> geo.dest 
<span class="hljs-number">6</span>.  | KEEP count, geometry, geo.dest

`AIå†™ä»£ç 
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2412b1d2aa71444a9fe534fd845acb2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=3ZPwYpEy%2BYvjLfGovf6N8EaRIv0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cf38ada7d0845a5ba800dbe73770a4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=OC6es0DwoXsYv4FNwA1XpZUzQqY%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç‚¹å‡» Add and continue</li>
<li>åœ¨ Layer settings ä¸­ï¼Œè®¾ç½®ï¼š
<ul>
<li>å°† Name è®¾ç½®ä¸º Total Requests by Destinationã€‚</li>
<li>å°† Opacity è®¾ç½®ä¸º 50%ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efe3b047e63e48edb6d1ea0fe2ad2d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=v9G2LV%2FfNUpVGK7PEYlowcM4eBY%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ Layer style ä¸­
<ul>
<li>å°† Fill color è®¾ç½®ä¸º By value by countã€‚é€‰æ‹© â€œgrey to blackâ€ é¢œè‰²æ¸å˜ã€‚</li>
<li>å°† Border color è®¾ç½®ä¸º â€œwhiteâ€ã€‚4.</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cc5319e4c22433494754567f7f74405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=YUzd07oNYRMnCTSqkJaV%2F%2FSTvv4%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç‚¹å‡» Keep changesã€‚ä½ çš„åœ°å›¾ç°åœ¨åº”è¯¥çœ‹èµ·æ¥åƒ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fce6da60d5fe4a64802c857e2a2d6112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=12N4r%2FY7slCp05qi3N%2FK5r1b9Pg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">æ­¥éª¤ 3. ä¸º Elasticsearch æ•°æ®æ·»åŠ å›¾å±‚</h2>
<p>ä¸ºäº†é¿å…ä¸€æ¬¡å‘ç”¨æˆ·å±•ç¤ºè¿‡å¤šæ•°æ®ï¼Œä½ å°†ä¸º Elasticsearch æ•°æ®æ·»åŠ ä¸¤ä¸ªå›¾å±‚ã€‚ç¬¬ä¸€ä¸ªå›¾å±‚åœ¨ç”¨æˆ·æ”¾å¤§åœ°å›¾æ—¶æ˜¾ç¤ºå•ä¸ªæ–‡æ¡£ã€‚ç¬¬äºŒä¸ªå›¾å±‚åœ¨ç”¨æˆ·ç¼©å°åœ°å›¾æ—¶æ˜¾ç¤ºèšåˆæ•°æ®ã€‚</p>
<h3 data-id="heading-6">ä¸ºå•ä¸ªæ–‡æ¡£æ·»åŠ å›¾å±‚</h3>
<p>æ­¤å›¾å±‚å°† web æ—¥å¿—æ–‡æ¡£æ˜¾ç¤ºä¸ºç‚¹ã€‚<br/>
è¯¥å›¾å±‚ä»…åœ¨ç”¨æˆ·æ”¾å¤§æ—¶å¯è§ã€‚</p>
<ul>
<li>ç‚¹å‡» Add layer</li>
<li>é€‰æ‹© ES|QL</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7195fa36fd744d3f9855a4cfabb3d640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=gCo1jOY35J0wBj%2F0qorOOgWXYEg%3D" alt="" loading="lazy"/></p>
<ul>
<li>å°† ES|QL statement è®¾ç½®ä¸º</li>
</ul>

<pre><code class="hljs language-sql" lang="sql">`

<span class="hljs-number">1.</span>  <span class="hljs-keyword">FROM</span> kibana_sample_data_logs 
<span class="hljs-number">2.</span>  <span class="hljs-operator">|</span> KEEP geo.coordinates, agent, bytes, clientip, 
<span class="hljs-number">3.</span>         host, machine.os, request, response, <span class="hljs-type">timestamp</span> 
<span class="hljs-number">4.</span>  <span class="hljs-operator">|</span> LIMIT <span class="hljs-number">10000</span>

`AIå†™ä»£ç 
</code></pre>
<ul>
<li>åœ¨ ES|QL ç¼–è¾‘å™¨ä¸­ç‚¹å‡» Run query</li>
<li>ç‚¹å‡» Add and continue</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/730d8242b0514cb289a6009e5edb2f45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=IAa4srQhlXSDFk3eyMxnM4nDgSg%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ Layer settings ä¸­ï¼Œè®¾ç½®ï¼š
<ul>
<li>å°† Name è®¾ç½®ä¸º Actual Requestsã€‚</li>
<li>å°† Visibility è®¾ç½®ä¸ºèŒƒå›´ [9, 24]ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a28785535c8a4fe0b901ed166e835728~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=xnY1P%2BvT0tWOUUKOA3qxCy1F7KQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ Layer style ä¸­ï¼Œè®¾ç½®ï¼š
<ul>
<li>å°† Fill color è®¾ç½®ä¸º #2200FFã€‚</li>
<li>å°† Border width è®¾ç½®ä¸º 0ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c07660b51c74440f857eebcc605b9587~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=h578EnyVh%2FZ%2BDvoqvQreP4Q%2BsZc%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç‚¹å‡» Keep changesã€‚ä½ çš„åœ°å›¾ç°åœ¨åº”è¯¥çœ‹èµ·æ¥åƒ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff4d39c9221d44e1937a90308283b291~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=Dndj%2B%2F0T6IvXTXHZviJj8%2B2liSE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">ä¸ºèšåˆæ•°æ®æ·»åŠ å›¾å±‚</h3>
<p>ä½ å°†åˆ›å»ºä¸€ä¸ªèšåˆæ•°æ®å›¾å±‚ï¼Œå¹¶ä»…åœ¨åœ°å›¾ç¼©å°æ—¶æ˜¾ç¤ºã€‚è¾ƒæ·±çš„é¢œè‰²è¡¨ç¤º web æ—¥å¿—æµé‡æ›´å¤šçš„ç½‘æ ¼ï¼Œè¾ƒæµ…çš„é¢œè‰²è¡¨ç¤ºæµé‡è¾ƒå°‘çš„ç½‘æ ¼ã€‚è¾ƒå¤§çš„åœ†è¡¨ç¤ºä¼ è¾“æ€»å­—èŠ‚æ›´å¤šçš„ç½‘æ ¼ï¼Œè¾ƒå°çš„åœ†è¡¨ç¤ºå­—èŠ‚è¾ƒå°‘çš„ç½‘æ ¼ã€‚</p>
<ul>
<li>ç‚¹å‡» Add layer</li>
<li>é€‰æ‹© ES|QL</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26353c3fa7834282888e2f26d36aec0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=hQR3rEIMLEI%2B%2Fc8HzcqE6AB1CcI%3D" alt="" loading="lazy"/></p>
<ul>
<li>å°† ES|QL statement è®¾ç½®ä¸º</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">`

1.  FROM kibana_sample_data_logs  
2.  | EVAL <span class="hljs-attr">geotile</span> = ST_GEOTILE(geo.coordinates, <span class="hljs-number">6</span>) 
3.  | STATS <span class="hljs-attr">count</span> = COUNT(geotile), 
<span class="hljs-attr">4.          sumOfBytes</span> = SUM(bytes), 
<span class="hljs-attr">5.          centroid</span> = ST_CENTROID_AGG(geo.coordinates) BY geotile

`AIå†™ä»£ç 
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63cbfb4a468c4d9abb7b2c0a87b50320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=tdOEyoqo1YDlLEb0j2xE4do33WE%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ ES|QL ç¼–è¾‘å™¨ä¸­ç‚¹å‡» Run query</li>
<li>ç‚¹å‡» Add å¹¶ç»§ç»­</li>
<li>åœ¨ Layer settings ä¸­ï¼Œè®¾ç½®ï¼š
<ul>
<li>å°† Name è®¾ç½®ä¸º Total Requests and Bytesã€‚</li>
<li>å°† Visibility è®¾ç½®ä¸ºèŒƒå›´ [0, 9]ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8adbe05ff81480795b4230f56b6ccb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=WzfyNO%2FWRy9KFKGGdTFvd1fJPrM%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ Layer style ä¸­ï¼Œè®¾ç½®ï¼š
<ul>
<li>å°† Fill color è®¾ç½®ä¸º By value by count</li>
<li>å°† Border width è®¾ç½®ä¸º 0ã€‚</li>
<li>å°† Symbol size è®¾ç½®ä¸º By value by sumOfBytesã€‚å°†æœ€å°å°ºå¯¸è®¾ç½®ä¸º 7ï¼Œæœ€å¤§å°ºå¯¸è®¾ç½®ä¸º 25ã€‚</li>
<li>å°† Label è®¾ç½®ä¸º By value by count</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1d9989a1d94426993b7a16386386185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=nHcJDNQlFi7P%2F37bsJfSi7MIkSM%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç‚¹å‡» Keep changesã€‚ä½ çš„åœ°å›¾ç°åœ¨åº”è¯¥çœ‹èµ·æ¥åƒ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c273d329e9454d77883ac49f767a6d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=MRF3qen00nX22RKWkyljk9T4jDs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">æ­¥éª¤ 4. æŒ‰å›½å®¶äººå£æ ‡å‡†åŒ– choropleth å›¾å±‚</h2>
<p>ç¬¬ 2 æ­¥åˆ›å»ºçš„ choropleth å›¾å±‚æŒ‰ web æ—¥å¿—æµé‡ä¸ºä¸–ç•Œå„å›½ç€è‰²ã€‚ç”±äºå„å›½äººå£ä¸åŒï¼Œç›´æ¥æ¯”è¾ƒå„å›½çš„è®¡æ•°å¹¶ä¸å…¬å¹³ã€‚äººå£è¾ƒå¤šçš„å›½å®¶å¯èƒ½æœ‰æ›´å¤šçš„ web æµé‡ï¼Œè€Œäººå£è¾ƒå°‘çš„å›½å®¶æµé‡è¾ƒå°‘ã€‚ç›¸åï¼Œä½ å¸Œæœ›æŒ‰äººå£è°ƒæ•´åçš„ web æ—¥å¿—æµé‡ä¸ºä¸–ç•Œå„å›½ç€è‰²ã€‚</p>
<p>ES|QL å¯ä»¥é€šè¿‡è€ƒè™‘æ¯ä¸ªå›½å®¶çš„æ€»äººå£æ¥å¯¹ web æ—¥å¿—è®¡æ•°è¿›è¡Œæ ‡å‡†åŒ–ã€‚æˆ‘ä»¬å°†å¯è§†åŒ–æ¯ 100,000 äººçš„ web æ—¥å¿—è®¡æ•°ï¼Œè€Œä¸æ˜¯åŸå§‹è®¡æ•°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒå„å›½çš„æ ‡å‡†åŒ–è®¡æ•°ã€‚</p>
<h3 data-id="heading-9">ç´¢å¼•ä¸–ç•Œå›½å®¶äººå£</h3>
<ul>
<li>ä¸‹è½½ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnreese%2Fnotes%2Fraw%2Frefs%2Fheads%2Fmaster%2Fpopulations_2024.csv" title="https://github.com/nreese/notes/raw/refs/heads/master/populations_2024.csv" target="_blank" ref="nofollow noopener noreferrer">populations_2024.csv</a>æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶æ¥æºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fdata.worldbank.org%2Findicator%2FSP.POP.TOTL" title="https://data.worldbank.org/indicator/SP.POP.TOTL" target="_blank" ref="nofollow noopener noreferrer">World Bank Group</a>ã€‚ ä¸‹è½½å®Œæ¯•åï¼Œæˆ‘ä»¬å¿…é¡»é‡æ–°å‘½åæ–‡ä»¶åç¼€ä¸º .csv è€Œä¸æ˜¯ .txtã€‚</li>
<li>åœ¨ Kibana ä¸­ï¼Œé€šè¿‡å…¨å±€æœç´¢å­—æ®µè¿›å…¥ File uploadã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9427dce25b2d40b19f23333325109477~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=%2BP%2BpcFz4ng8SyOshN81%2FchfaYb8%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨æ–‡ä»¶é€‰æ‹©å™¨ä¸­é€‰æ‹© populations_2024.csv</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbbce9d5ad5b44ac99a3384511c1f9d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=6sZSjkloapPqJNPnUNct35TZXns%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d887ff51a0748e0918add6e011f0ad9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=9D%2BXR09h0e10Ujy40zE2pZ1lNDs%3D" alt="" loading="lazy"/></p>
<ul>
<li>å°† New index name è®¾ç½®ä¸º populations</li>
<li>ç‚¹å‡» Import</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d0645d5615f44ae8348b930b15be4d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=set59wxYd4DcSCXa8dEOARYIEw8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">å‘ world_countries ç´¢å¼•æ·»åŠ äººå£å­—æ®µ</h3>
<p>ä½¿ç”¨ enrich processor å°†äººå£æ•°æ®æ·»åŠ åˆ°ä¸–ç•Œå›½å®¶é›†åˆä¸­ã€‚</p>
<ul>
<li>é€šè¿‡å¯¼èˆªèœå•æˆ–å…¨å±€æœç´¢å­—æ®µè¿›å…¥ Developer toolsã€‚</li>
<li>åˆ›å»ºä¸€ä¸ª match enrichment policy</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">`

1.  PUT /_enrich/policy/population_lookup
2.  {
3.    <span class="hljs-string">"match"</span>: {
4.      <span class="hljs-string">"indices"</span>: <span class="hljs-string">"populations"</span>,
5.      <span class="hljs-string">"match_field"</span>: <span class="hljs-string">"iso3"</span>,
6.      <span class="hljs-string">"enrich_fields"</span>: [ <span class="hljs-string">"population_2024"</span>]
7.    }
8.  }

`AIå†™ä»£ç 
</code></pre>
<ul>
<li>è¦åˆå§‹åŒ–è¯¥ç­–ç•¥ï¼Œè¿è¡Œï¼š</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">`POST /_enrich/policy/population_lookup/_execute`AIå†™ä»£ç 
</code></pre>
<ul>
<li>è¦åˆ›å»ºä¸€ä¸ª ingest pipelineï¼Œè¿è¡Œï¼š</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _ingest/pipeline/add_population_to_world_countries
2.  {
3.    <span class="hljs-string">"processors"</span>: [
4.      {
5.        <span class="hljs-string">"enrich"</span>: {
6.          <span class="hljs-string">"field"</span>: <span class="hljs-string">"iso3"</span>,
7.          <span class="hljs-string">"policy_name"</span>: <span class="hljs-string">"population_lookup"</span>,
8.          <span class="hljs-string">"target_field"</span>: <span class="hljs-string">"population"</span>,
9.          <span class="hljs-string">"ignore_missing"</span>: <span class="hljs-literal">true</span>,
10.          <span class="hljs-string">"ignore_failure"</span>: <span class="hljs-literal">true</span>
11.        }
12.      }
13.    ]
14.  }

`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<ul>
<li>è¦å‘ world_countries æ·»åŠ äººå£æ•°æ®ï¼Œè¿è¡Œï¼š</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">`POST world_countries/_update_by_query?<span class="hljs-attr">pipeline</span>=add_population_to_world_countries`AIå†™ä»£ç 
</code></pre>
<ul>
<li>åœ¨ Discover ä¸­æŸ¥çœ‹ world_countries ç´¢å¼•ã€‚æ¯ä¸€è¡Œç°åœ¨éƒ½åŒ…å« population.population_2024 åˆ—ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7a16b1b69204dffb9ac4dcb4a15e6d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=93zdsqE99lKpjSnBXp4yIFDaQEg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">åœ¨ ES|QL statement ä¸­æŒ‰äººå£æ ‡å‡†åŒ–è®¡æ•°</h3>
<ul>
<li>ç‚¹å‡» Total Requests by Destination å›¾å±‚çš„ edit æŒ‰é’®ã€‚</li>
<li>å°† ES|QL statement æ›¿æ¢ä¸º</li>
</ul>

<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  <span class="hljs-keyword">FROM</span> kibana_sample_data_logs 
<span class="hljs-number">2</span>.  | STATS count = COUNT() <span class="hljs-keyword">BY</span> geo.dest 
<span class="hljs-number">3</span>.  | RENAME geo.dest <span class="hljs-keyword">AS</span> iso2.keyword 
<span class="hljs-number">4</span>.  | LOOKUP <span class="hljs-keyword">JOIN</span> world_countries <span class="hljs-keyword">ON</span> iso2.keyword 
<span class="hljs-number">5</span>.  | RENAME iso2.keyword <span class="hljs-keyword">AS</span> geo.dest 
<span class="hljs-number">6</span>.  | KEEP count, geometry, geo.dest, population.population_2024 
<span class="hljs-number">7</span>.  | EVAL normalized_count = TO_DOUBLE(count) / population.population_2024 * <span class="hljs-number">100000</span>

`AIå†™ä»£ç 
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e63741079f2141bd9030ad4edfa290ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=DBwGweAj8s76pmqMlOXkGeEk2k0%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ ES|QL ç¼–è¾‘å™¨ä¸­ç‚¹å‡» Run query</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21e69d74f8de451280b14ae6d8c7ddce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=XzvV31MVsr8bO%2FhyYtP9RaNfOd4%3D" alt="" loading="lazy"/></p>
<ul>
<li>åœ¨ Layer style ä¸­å°† Fill color è®¾ç½®ä¸º By value by normalized_countã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86b8e174129f42f3a2aa1ac6a42dec6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=KQKsChdXQl1oDPyjGegXlVlsE60%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç‚¹å‡» Keep changesã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ad2ef7cbb0945448f6f5439bb833c9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823724&amp;x-signature=vIleNIwrAzdRPRsF88yAeHBtg2A%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä½ å¯èƒ½å·²ç»çŒœåˆ°ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨ lookup è®¾ç½®å¯¼å…¥ populations CSV æ¥å¯¹åœ°å›¾æŸ¥è¯¢æ‰§è¡Œç¬¬äºŒæ¬¡ LOOKUP JOINã€‚é‚£æ˜¯å¯è¡Œçš„ï¼ä½†è¦æ³¨æ„ï¼Œæ¯å¢åŠ ä¸€æ¬¡ join éƒ½ä¼šæœ‰æ€§èƒ½å¼€é”€ã€‚</p>
</blockquote>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscuss.elastic.co%2Ft%2Fdec-14th-2025-en-build-a-map-to-compare-metrics-by-country-or-region-with-es-ql%2F383243" title="https://discuss.elastic.co/t/dec-14th-2025-en-build-a-map-to-compare-metrics-by-country-or-region-with-es-ql/383243" target="_blank" ref="nofollow noopener noreferrer">discuss.elastic.co/t/dec-14th-â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”root-check]]></title>    <link>https://juejin.cn/post/7585474459776237604</link>    <guid>https://juejin.cn/post/7585474459776237604</guid>    <pubDate>2025-12-20T08:02:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776237604" data-draft-id="7585463195201306674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”root-check"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:02:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”root-check
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:02:32.000Z" title="Sat Dec 20 2025 08:02:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p><code>root-check</code>Â æ˜¯ä¸€ä¸ªÂ <strong>Node.js å·¥å…·åŒ…</strong>ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯<strong>æ£€æµ‹å½“å‰ Node.js è¿›ç¨‹æ˜¯å¦ä»¥Â <code>root</code>ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰æƒé™è¿è¡Œ</strong>ï¼Œå¹¶åœ¨æ£€æµ‹åˆ°Â <code>root</code>Â æƒé™æ—¶ï¼Œè‡ªåŠ¨é™çº§ä¸ºæŒ‡å®šçš„æ™®é€šç”¨æˆ·æƒé™è¿è¡Œï¼Œä»¥æ­¤æå‡åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p>
<h3 data-id="heading-1">æ£€æµ‹ root æƒé™</h3>
<p>å®ƒä¼šåˆ¤æ–­å½“å‰è¿›ç¨‹çš„Â <code>uid</code>ï¼ˆç”¨æˆ· IDï¼‰æ˜¯å¦ä¸ºÂ <code>0</code>ï¼ˆUnix/Linux ç³»ç»Ÿä¸­Â <code>root</code>Â ç”¨æˆ·çš„Â <code>uid</code>Â å›ºå®šä¸ºÂ <code>0</code>ï¼‰ï¼Œä»¥æ­¤è¯†åˆ«æ˜¯å¦ä¸ºÂ <code>root</code>Â æƒé™è¿è¡Œã€‚</p>
<h3 data-id="heading-2">è‡ªåŠ¨é™çº§æƒé™</h3>
<p>å¦‚æœæ£€æµ‹åˆ°å½“å‰æ˜¯Â <code>root</code>Â æƒé™ï¼Œå®ƒä¼šå°è¯•åˆ‡æ¢åˆ°ä¸€ä¸ª<strong>é root æ™®é€šç”¨æˆ·</strong>çš„æƒé™æ¥è¿è¡Œåç»­ä»£ç ã€‚</p>
<ul>
<li>é»˜è®¤ä¼šå°è¯•åˆ‡æ¢åˆ°Â <code>nobody</code>Â ç”¨æˆ·ï¼ˆUnix/Linux ç³»ç»Ÿä¸­å†…ç½®çš„æ— ç‰¹æƒç”¨æˆ·ï¼‰ã€‚</li>
<li>ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šè¦åˆ‡æ¢çš„ç”¨æˆ·ï¼ˆé€šè¿‡ç”¨æˆ·åæˆ–Â <code>uid</code>ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-3">è§£å†³çš„æ ¸å¿ƒé—®é¢˜</h3>
<p>åœ¨ Unix/Linux ç³»ç»Ÿä¸­ï¼Œä»¥Â <code>root</code>Â æƒé™è¿è¡Œ Node.js åº”ç”¨å­˜åœ¨<strong>æé«˜çš„å®‰å…¨é£é™©</strong>ï¼šä¸€æ—¦åº”ç”¨å­˜åœ¨æ¼æ´è¢«æ”»å‡»ï¼Œæ”»å‡»è€…å°†ç›´æ¥è·å¾—ç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨è¢«å®Œå…¨æ§åˆ¶ã€‚<code>root-check</code>Â çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†<strong>é¿å…è¿™ç§é£é™©</strong>ï¼Œå¼ºåˆ¶åº”ç”¨ä»¥ä½æƒé™è¿è¡Œï¼Œå³ä½¿è¢«æ”»å‡»ï¼Œå½±å“èŒƒå›´ä¹Ÿä¼šè¢«å¤§å¹…é™åˆ¶ã€‚</p>
<h3 data-id="heading-4">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰å¼€å‘ï¼šå¾ˆå¤š Node.js å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚å‰ç«¯çš„æ„å»ºå·¥å…·ã€è„šæ‰‹æ¶ï¼‰ä¼šç”¨åˆ°è¿™ä¸ªåŒ…ï¼Œé˜²æ­¢ç”¨æˆ·ä»¥Â <code>root</code>Â æƒé™æ‰§è¡Œå‘½ä»¤å¸¦æ¥é£é™©ã€‚</li>
<li>æœåŠ¡ç«¯åº”ç”¨ï¼šNode.js ç¼–å†™çš„åç«¯æœåŠ¡ï¼Œéƒ¨ç½²æ—¶éœ€è¦é¿å… root æƒé™è¿è¡Œï¼Œå¯é€šè¿‡æ­¤åŒ…è‡ªåŠ¨é™çº§ã€‚</li>
</ul>
<h3 data-id="heading-5">åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-js" lang="js">npm install root-check --save
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> rootCheck = <span class="hljs-built_in">require</span>(<span class="hljs-string">'root-check'</span>).<span class="hljs-property">default</span>;
<span class="hljs-comment">// è‡ªåŠ¨é™çº§ä¸º nobody ç”¨æˆ·ï¼ˆå¦‚æœå½“å‰æ˜¯ root æƒé™ï¼‰</span>
<span class="hljs-title function_">rootCheck</span>();
<span class="hljs-comment">// æˆ–è€…æ‰‹åŠ¨æŒ‡å®šè¦åˆ‡æ¢çš„ç”¨æˆ·</span>
<span class="hljs-comment">// rootCheck('www-data'); // åˆ‡æ¢åˆ° www-data ç”¨æˆ·</span>
</code></pre>
<h3 data-id="heading-6">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>ä»…æ”¯æŒ Unix/Linux ç³»ç»Ÿ</strong>ï¼šWindows ç³»ç»Ÿæ²¡æœ‰Â <code>root</code>/<code>uid</code>Â çš„æ¦‚å¿µï¼Œè¯¥åŒ…åœ¨ Windows ä¸Šä¼šç›´æ¥å¤±æ•ˆï¼ˆæ— å‰¯ä½œç”¨ï¼‰ã€‚</li>
<li><strong>é™çº§å¤±è´¥ä¼šæŠ›å‡ºé”™è¯¯</strong>ï¼šå¦‚æœå½“å‰æ˜¯ root æƒé™ï¼Œä½†æ— æ³•åˆ‡æ¢åˆ°ç›®æ ‡ç”¨æˆ·ï¼ˆæ¯”å¦‚ç›®æ ‡ç”¨æˆ·ä¸å­˜åœ¨ï¼‰ï¼Œ<code>rootCheck</code>Â ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦æ‰‹åŠ¨æ•è·å¤„ç†ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3æ¡ä»¶æ¸²æŸ“ä¸­v-ifç³»åˆ—æŒ‡ä»¤å¦‚ä½•åˆç†ä½¿ç”¨ä¸è§„é¿é”™è¯¯ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585485284152295459</link>    <guid>https://juejin.cn/post/7585485284152295459</guid>    <pubDate>2025-12-20T08:13:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485284152295459" data-draft-id="7585452404113129487" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3æ¡ä»¶æ¸²æŸ“ä¸­v-ifç³»åˆ—æŒ‡ä»¤å¦‚ä½•åˆç†ä½¿ç”¨ä¸è§„é¿é”™è¯¯ï¼Ÿ    "/> <meta itemprop="keywords" content="å‰ç«¯,Trae,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-20T08:13:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3æ¡ä»¶æ¸²æŸ“ä¸­v-ifç³»åˆ—æŒ‡ä»¤å¦‚ä½•åˆç†ä½¿ç”¨ä¸è§„é¿é”™è¯¯ï¼Ÿ    
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:13:19.000Z" title="Sat Dec 20 2025 08:13:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€Vue3æ¡ä»¶æ¸²æŸ“çš„æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>åœ¨Vue3ä¸­ï¼Œ<strong>æ¡ä»¶æ¸²æŸ“</strong>æ˜¯æŒ‡æ ¹æ®<strong>å“åº”å¼æ•°æ®çš„çœŸå‡</strong>ï¼Œå†³å®šæ˜¯å¦åœ¨é¡µé¢ä¸Šæ¸²æŸ“æŸä¸ªå…ƒç´ æˆ–ç»„ä»¶ã€‚è€Œ<code>v-if</code>ã€<code>v-else</code>ã€<code>v-else-if</code>
è¿™ç»„æŒ‡ä»¤ï¼Œå°±æ˜¯å®ç°æ¡ä»¶æ¸²æŸ“çš„â€œæ ¸å¿ƒå·¥å…·â€â€”â€”å®ƒä»¬åƒä¸€å¥—â€œé€»è¾‘å¼€å…³â€ï¼Œå¸®ä½ ç²¾å‡†æ§åˆ¶DOMçš„æ˜¾ç¤ºä¸éšè—ã€‚</p>
<h3 data-id="heading-1">äºŒã€v-ifç³»åˆ—æŒ‡ä»¤çš„è¯­æ³•ä¸ç”¨æ³•</h3>
<p>æˆ‘ä»¬å…ˆé€ä¸ªæ‹†è§£æ¯ä¸ªæŒ‡ä»¤çš„ä½œç”¨ï¼Œå†é€šè¿‡<strong>å®é™…æ¡ˆä¾‹</strong>ä¸²èµ·æ¥ç”¨ã€‚</p>
<h4 data-id="heading-2">2.1 v-ifï¼šåŸºç¡€æ¡ä»¶åˆ¤æ–­</h4>
<p><code>v-if</code>æ˜¯æœ€åŸºç¡€çš„æ¡ä»¶æŒ‡ä»¤ï¼Œå®ƒçš„è¯­æ³•å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-html" lang="html">
<span class="hljs-tag">&lt;<span class="hljs-name">å…ƒç´ </span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"æ¡ä»¶è¡¨è¾¾å¼"</span>&gt;</span>è¦æ¸²æŸ“çš„å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">å…ƒç´ </span>&gt;</span>
</code></pre>
<ul>
<li><strong>æ¡ä»¶è¡¨è¾¾å¼</strong>ï¼šå¯ä»¥æ˜¯ä»»ä½•è¿”å›<code>true</code>æˆ–<code>false</code>çš„JavaScriptè¡¨è¾¾å¼ï¼ˆæ¯”å¦‚<code>isLogin</code>ã€<code>score &gt;= 90</code>ï¼‰ã€‚</li>
<li><strong>æƒ°æ€§æ¸²æŸ“</strong>ï¼š<code>v-if</code>æ˜¯â€œæ‡’â€çš„â€”â€”å¦‚æœåˆå§‹æ¡ä»¶ä¸æ»¡è¶³ï¼ˆæ¯”å¦‚<code>isLogin = false</code>ï¼‰ï¼Œå…ƒç´ <strong>ä¸ä¼šè¢«æ¸²æŸ“åˆ°DOMä¸­</strong>ï¼ˆè¿DOMèŠ‚ç‚¹éƒ½ä¸ä¼šç”Ÿæˆï¼‰ï¼›åªæœ‰å½“æ¡ä»¶å˜ä¸º
<code>true</code>æ—¶ï¼Œæ‰ä¼šâ€œä»é›¶å¼€å§‹â€åˆ›å»ºå…ƒç´ åŠå…¶å­ç»„ä»¶ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œæ˜¾ç¤ºä¸åŒçš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">
&lt;script setup&gt;
  import {ref} from 'vue'

  const isLogin = ref(false) // åˆå§‹æœªç™»å½•
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;!-- ç™»å½•åæ˜¾ç¤º --&gt;
    &lt;p v-if="isLogin"&gt;æ¬¢è¿å›æ¥ï¼Œç”¨æˆ·ï¼&lt;/p&gt;
    &lt;!-- æœªç™»å½•æ˜¾ç¤º --&gt;
    &lt;button v-if="!isLogin" @click="isLogin = true"&gt;ç‚¹å‡»ç™»å½•&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>å½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œ<code>isLogin</code>å˜ä¸º<code>true</code>ï¼Œæœªç™»å½•çš„æŒ‰é’®ä¼šè¢«é”€æ¯ï¼ŒåŒæ—¶æ¸²æŸ“â€œæ¬¢è¿â€æ–‡æœ¬â€”â€”è¿™å°±æ˜¯<code>v-if</code>çš„â€œé”€æ¯/é‡å»ºâ€é€»è¾‘ã€‚</p>
<details>
<summary>å¾€æœŸæ–‡ç« å½’æ¡£</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F218c3a59282c3b757447ee08a01937bb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/218c3a59282c3b757447ee08a01937bb/" ref="nofollow noopener noreferrer">Vue3åŠ¨æ€æ ·å¼æ§åˆ¶ï¼šrefã€reactiveã€watchä¸computedçš„åº”ç”¨åœºæ™¯ä¸åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1bab953e41f66ac53de099fa9fe76483%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1bab953e41f66ac53de099fa9fe76483/" ref="nofollow noopener noreferrer">Vue3ä¸­åŠ¨æ€æ ·å¼æ•°ç»„çš„åé¡¹è¦†ç›–è§„åˆ™å¦‚ä½•ä¸è®¡ç®—å±æ€§ç»“åˆå®ç°å¤æ‚çŠ¶æ€æ ·å¼ç®¡ç†ï¼Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vueæµ…å“åº”å¼å¦‚ä½•è§£å†³æ·±å±‚å“åº”å¼çš„æ€§èƒ½é—®é¢˜ï¼Ÿé€‚ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3ç»„åˆå¼APIä¸­refä¸reactiveçš„æ ¸å¿ƒå“åº”å¼å·®å¼‚åŠä½¿ç”¨æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3ç»„åˆå¼APIä¸­refä¸reactiveçš„æ ¸å¿ƒå“åº”å¼å·®å¼‚åŠä½¿ç”¨æœ€ä½³å®è·µæ˜¯ä»€ä¹ˆï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3å“åº”å¼ç³»ç»Ÿä¸­ï¼Œå¯¹è±¡æ–°å¢å±æ€§ã€æ•°ç»„æ”¹ç´¢å¼•ã€åŸå§‹å€¼ä»£ç†çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3ä¸­watchä¾¦å¬å™¨çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ä½ æŒæ¡äº†å—ï¼Ÿæ·±åº¦ç›‘å¬ã€ä¸watchEffectçš„å·®å¼‚åŠå¸¸è§æŠ¥é”™è§£æ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vueå“åº”å¼å£°æ˜çš„APIå·®å¼‚ã€åº•å±‚åŸç†ä¸å¸¸è§é™·é˜±ä½ éƒ½ææ‡‚äº†å— - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vueå“åº”å¼å£°æ˜çš„APIå·®å¼‚ã€åº•å±‚åŸç†ä¸å¸¸è§é™·é˜±ä½ éƒ½ææ‡‚äº†å— - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">ä¸ºä»€ä¹ˆVue 3éœ€è¦refå‡½æ•°ï¼Ÿå®ƒçš„å“åº”å¼åŸç†ä¸æ­£ç¡®ç”¨æ³•æ˜¯ä»€ä¹ˆï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3ä¸­reactiveå‡½æ•°å¦‚ä½•é€šè¿‡Proxyå®ç°å“åº”å¼ï¼Ÿä½¿ç”¨æ—¶è¦é¿å¼€å“ªäº›è¯¯åŒºï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3å“åº”å¼ç³»ç»Ÿçš„åº•å±‚åŸç†ä¸å®è·µè¦ç‚¹ä½ çœŸçš„æ‡‚å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3æ¨¡æ¿å¦‚ä½•é€šè¿‡ç¼–è¯‘ä¸‰é˜¶æ®µå®ç°ä»å£°æ˜å¼è¯­æ³•åˆ°é«˜æ•ˆæ¸²æŸ“çš„è·¨è¶Š - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vueæ¨¡æ¿å¼•ç”¨ï¼šä»æ”¶DOMâ€œå¿«é€’â€åˆ°è°ƒå­ç»„ä»¶æ–¹æ³•ï¼Œä½ ç©æ˜ç™½äº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vueæ¨¡æ¿é‡Œçš„JSè¡¨è¾¾å¼æœ‰å•¥ä¸èƒ½ç¢°ï¼Ÿè®¡ç®—å±æ€§ä¸ºå•¥æ¯”æ–¹æ³•æ›´èƒ½æ‰“ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vueçš„v-modelè¡¨å•ç»‘å®šï¼šè¯­æ³•ç³–ã€åŠ¨æ€å€¼ã€ä¿®é¥°ç¬¦çš„å°æŠ€å·§ä½ éƒ½æŒæ¡äº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vue3äº‹ä»¶å¤„ç†çš„æŒ‘æˆ˜é¢˜ï¼šv-onã€ä¿®é¥°ç¬¦ã€è‡ªå®šä¹‰äº‹ä»¶ä½ èƒ½é€šå…³å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vue3çš„v-æŒ‡ä»¤ï¼šæ•°æ®å’ŒDOMçš„â€œç¿»è¯‘å®˜â€åˆ°åº•æœ‰å¤šå°‘æœ¬äº‹ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">å¿«é€Ÿå…¥é—¨Vue3ï¼Œæ’å€¼ã€åŠ¨æ€ç»‘å®šå’Œé¿å‘æŠ€å·§ä½ éƒ½ææ‡‚äº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">æƒ³è®©PostgreSQLå¿«åˆ°é£èµ·ï¼Ÿå…ˆæ‰¾å¥åº·å¯†ç è¿˜æ˜¯å…ˆæ¢å¼•æ“ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">æƒ³è®©PostgreSQLæŸ¥è¯¢å¿«åˆ°é£èµ·ï¼Ÿåˆ†åŒºè¡¨ã€ç‰©åŒ–è§†å›¾ã€å¹¶è¡ŒæŸ¥è¯¢è¿™ä¸‰æ‹›çµä¸çµï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">å­æŸ¥è¯¢æ€»æ‹–æ…¢æŸ¥è¯¢ï¼ŸæŠŠå®ƒå˜æˆè¿æ¥å°±èƒ½è§£å†³ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQLå…¨è¡¨æ‰«ææ…¢åˆ°å´©æºƒï¼Ÿå»ºç´¢å¼•+æ”¹æŸ¥è¯¢+æ›´ç»Ÿè®¡ä¿¡æ¯ä¸‰æ‹›èƒ½ç ´ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">å¤æ‚æŸ¥è¯¢æ€»æ‹–åè…¿ï¼ŸPostgreSQLå¤šåˆ—ç´¢å¼•+è¦†ç›–ç´¢å¼•çš„ç¥ä»™æŠ€å·§ä½ getæ²¡ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">åªç»™è¡¨å­é›†å»ºç´¢å¼•ï¼Ÿç”¨å‡½æ•°ç»“æœå»ºç´¢å¼•ï¼ŸPostgreSQLè¿™ä¿©æ“ä½œå‡­å•¥èƒ½çœç©ºé—´åˆåŠ é€Ÿï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-treeç´¢å¼•åƒå­—å…¸æŸ¥è¯ä¸€æ ·å·¥ä½œï¼Ÿé‚£å“ªäº›æ•°æ®åº“æŸ¥è¯¢å®ƒèƒ½åŠ é€Ÿï¼Œå“ªäº›ä¸èƒ½ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">æƒ³æŠ“PostgreSQLé‡Œçš„æ…¢SQLï¼Ÿpg_stat_statementsåŸºç¡€é»‘åŒ£å­å’Œpg_stat_monitoræ—¶é—´çª—ï¼Œè°èƒ½å¸®ä½ æ›´å‡†æªå‡ºæ€§èƒ½å°å·ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQLçš„â€œæ—¶å…‰æœºâ€MVCCå’Œé”æœºåˆ¶æ˜¯æ€ä¹ˆæå®šé«˜å¹¶å‘çš„ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQLæ€§èƒ½æš´æ¶¨çš„å…³é”®ï¼Ÿå†…å­˜IOå¹¶å‘å‚æ•°å±…ç„¶è¦è¿™ä¹ˆè®¾ç½®ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">å¤§è¡¨æŸ¥è¯¢æ…¢åˆ°ç¿»éæ•´ä¸ªä¹¦æ¶ï¼ŸPostgreSQLåˆ†åŒºè¡¨æ•™ä½ æ€ä¹ˆâ€œåˆ†ç±»â€æ‰é«˜æ•ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL æŸ¥è¯¢æ…¢ï¼Ÿæ˜¯ä¸æ˜¯å¿˜äº†ä¼˜åŒ– GROUP BYã€ORDER BY å’Œçª—å£å‡½æ•°ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQLé‡Œçš„å­æŸ¥è¯¢å’ŒCTEå±…ç„¶åœ¨æ€§èƒ½ä¸Šâ€œææ¶â€ï¼Ÿåˆ°åº•è¯¥ç«™å“ªè¾¹ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQLé€‰Joinç­–ç•¥æœ‰å•¥å°ä¹ä¹ï¼ŸNested Loop/Merge/Hashè°æ˜¯å®ƒçš„èœï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQLæ–°æ‰‹SQLæ€»ç¿»è½¦ï¼Ÿè¿™7ä¸ªæ€§èƒ½é™·é˜±ä½ è¸©è¿‡æ²¡ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQLç´¢å¼•é€‰B-Treeè¿˜æ˜¯GiSTï¼Ÿâ€œç‘å£«å†›åˆ€â€å’Œâ€œå¤šé¢æ‰‹â€çš„å·®åˆ«ä½ å±…ç„¶è¿˜ä¸çŸ¥é“ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">æƒ³çŸ¥é“æ•°æ®åº“æ€ä¹ˆç»™æŸ¥è¯¢â€œç®—æˆæœ¬é€‰è·¯çº¿â€ï¼ŸEXPLAINèƒ½å¸®ä½ çœ‹æ˜ç™½ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQLå¤„ç†SQLå±…ç„¶åƒåšè›‹ç³•ï¼Ÿè§£æåˆ°æ‰§è¡Œçš„4æ­¥é‡Œè—ç€å¤šå°‘æŸ¥è¯¢ä¼˜åŒ–çš„å°å¿ƒæœºï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQLå¤‡ä»½ä¸æ˜¯å¤åˆ¶æ–‡ä»¶ï¼Ÿç‰©ç†vsé€»è¾‘å’‹é€‰ï¼Ÿè¯¯åˆ è¿˜èƒ½ç²¾å‡†æ¢å¤åˆ°1åˆ†é’Ÿå‰ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">è½¬è´¦ä¸ç¿»è½¦ã€å¹¶å‘ä¸å¹²æ‰°ï¼ŒPostgreSQLçš„ACIDç‰¹æ€§åˆ°åº•æœ‰å•¥é­”æ³•ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">é“¶è¡Œè½¬è´¦ä¸ç™½æ‰£é’±ã€ç”µå•†ä¸‹å•ä¸è¶…å–ï¼ŒPostgreSQLäº‹åŠ¡çš„è¯€çªæ˜¯å•¥ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQLé‡Œçš„PL/pgSQLåˆ°åº•æ˜¯å•¥ï¼Ÿèƒ½è®©SQLä»â€œè¯´ç›®æ ‡â€å˜â€œè®²æ­¥éª¤â€ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQLè§†å›¾ä¸å­˜æ•°æ®ï¼Ÿé‚£å®ƒæ€ä¹ˆç®€åŒ–æŸ¥è¯¢è¿˜èƒ½é€’å½’ç”Ÿæˆåºåˆ—å’Œæ§åˆ¶æƒé™ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQLç´¢å¼•è¿™ä¹ˆç©ï¼Œæ‰èƒ½è®©ä½ çš„æŸ¥è¯¢çœŸçš„â€œé£â€èµ·æ¥ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQLçš„è¡¨å…³ç³»å’Œçº¦æŸï¼Œå’‹å¸®ä½ æå®šç”¨æˆ·è®¢å•ä¸æ··ä¹±ã€å­¦ç”Ÿé€‰è¯¾ä¸é‡å¤ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQLæŸ¥è¯¢çš„ç­›å­ã€æ’åºã€èšåˆã€åˆ†ç»„ï¼Ÿä½ ä¼šç”¨å®ƒä»¬æå®šæ•°æ®å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQLæ•°æ®ç±»å‹æ€ä¹ˆé€‰æ‰é«˜æ•ˆä¸è¸©å‘ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">æƒ³è§£é”PostgreSQLæŸ¥è¯¢ä»åŸºç¡€åˆ°è¿›é˜¶çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Ÿä½ éƒ½getäº†å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETEå±…ç„¶æœ‰è¿™äº›æ“ä½œï¼Ÿè¿”å›æ•°æ®ã€è¿è¡¨åˆ ä½ è¯•è¿‡æ²¡ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATEè¯­å¥æ€ä¹ˆç©ï¼Ÿä»æ”¹é‚®ç®±åˆ°æ‰¹é‡æ›´æ–°çš„é¿å‘æŠ€å·§ä½ éƒ½ä¼šå—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQLæ’å…¥æ•°æ®è¿˜åœ¨é€æ¡æ•²ï¼Ÿæ‰¹é‡ã€å†²çªå¤„ç†ã€è¿”å›è‡ªå¢IDçš„æŠ€å·§ä½ ä¼šå—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQLçš„â€œä»“åº“-æˆ¿é—´-è´§æ¶â€æ¸¸æˆï¼Œä½ èƒ½å»ºå‡ºç”µå•†æ•°æ®åº“å’Œè¡¨å—ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17å®‰è£…æ€»ç¿»è½¦ï¼ŸWindows/macOS/Linuxé¿å‘æŒ‡å—å¸®ä½ æå®šï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">èƒ½å½“å…³ç³»å‹æ•°æ®åº“è¿˜èƒ½ç©å¯¹è±¡ç‰¹æ€§ï¼Œèƒ½æ‹†å¤æ‚æŸ¥è¯¢è¿˜èƒ½è‡ªåŠ¨ç®¡åº“å­˜ï¼ŒPostgreSQLå‡­ä»€ä¹ˆè¿™ä¹ˆé¦™ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">ç»™æ¥å£åŠ æ–°å­—æ®µåˆä¸æå´©è€å®¢æˆ·ç«¯ï¼ŸFastAPIçš„å¤šç‰ˆæœ¬APIé å“ªä¸‰æ‹›å®ç°ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">æµé‡çªå¢è¦æå´©FastAPIï¼Ÿç†”æ–­æµ‹è¯•æ˜¯æ€ä¹ˆé˜²ç³»ç»Ÿé›ªå´©çš„ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPIç§’æ€åº“å­˜æ€»å˜è´Ÿæ•°ï¼ŸRedisåˆ†å¸ƒå¼é”èƒ½å¸®ä½ å®ˆä½åº•çº¿å— - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPIçš„CIæµæ°´çº¿æ€ä¹ˆè‡ªåŠ¨æµ‹ç«¯ç‚¹ï¼Œè¿˜èƒ½è®©AllureæŠ¥å‘Šç¾åˆ°çŠ¯è§„ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">å¦‚ä½•ç”¨GitHub Actionsä¸ºFastAPIé¡¹ç›®æ‰“é€ è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿ï¼Ÿ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">å¦‚ä½•ç”¨Git Hookå’ŒCIæµæ°´çº¿ä¸ºFastAPIé¡¹ç›®ä¿é©¾æŠ¤èˆªï¼Ÿ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>å…è´¹å¥½ç”¨çš„çƒ­é—¨åœ¨çº¿å·¥å…·</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID è®¡ç®—å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">åœ¨çº¿PS - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid åœ¨çº¿ç¼–è¾‘å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">æ•°å­¦æ±‚è§£è®¡ç®—å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">æ™ºèƒ½æè¯å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">é­”æ³•ç®€å† - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - å›¾ç‰‡æ‹¼å›¾å·¥å…· | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">å­—å¹•ä¸‹è½½å·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">æ­Œè¯ç”Ÿæˆå·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">ç½‘ç›˜èµ„æºèšåˆæœç´¢ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCIIå­—ç¬¦ç”»ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens å·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt å¯†ç å·¥å…· - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF åˆæˆå™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF åˆ†è§£å™¨ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">æ–‡æœ¬éšå†™æœ¯ - åº”ç”¨å•†åº— | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon åœ¨çº¿å·¥å…· - é«˜çº§AIå·¥å…·ç®±ä¸å¼€å‘è€…å¥—ä»¶ | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">åº”ç”¨å•†åº— - å‘ç°1000+æå‡æ•ˆç‡ä¸å¼€å‘çš„AIå·¥å…·å’Œå®ç”¨ç¨‹åº | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon æ›´æ–°æ—¥å¿— - æœ€æ–°æ›´æ–°ã€åŠŸèƒ½ä¸æ”¹è¿› | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">æ”¯æŒæˆ‘ä»¬ - æˆä¸ºèµåŠ©è€… | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AIæ–‡æœ¬ç”Ÿæˆå›¾åƒ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">ä¸´æ—¶é‚®ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">äºŒç»´ç è§£æå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">æ–‡æœ¬è½¬æ€ç»´å¯¼å›¾ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">æ­£åˆ™è¡¨è¾¾å¼å¯è§†åŒ–å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">æ–‡ä»¶éšå†™å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV é¢‘é“æ¢ç´¢å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">å¿«ä¼  - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">éšæœºæŠ½å¥–å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">åŠ¨æ¼«åœºæ™¯æŸ¥æ‰¾å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">æ—¶é—´å·¥å…·ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">ç½‘é€Ÿæµ‹è¯• - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI æ™ºèƒ½æŠ å›¾å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">èƒŒæ™¯æ›¿æ¢å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">è‰ºæœ¯äºŒç»´ç ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph å…ƒæ ‡ç­¾ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">å›¾åƒå¯¹æ¯”å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">å›¾ç‰‡å‹ç¼©ä¸“ä¸šç‰ˆ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">å¯†ç ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVGä¼˜åŒ–å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">è°ƒè‰²æ¿ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">åœ¨çº¿èŠ‚æ‹å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IPå½’å±åœ°æŸ¥è¯¢ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSSç½‘æ ¼å¸ƒå±€ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">é‚®ç®±éªŒè¯å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">ä¹¦æ³•ç»ƒä¹ å­—å¸– - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">é‡‘èè®¡ç®—å™¨å¥—ä»¶ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">ä¸­å›½äº²æˆšå…³ç³»è®¡ç®—å™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer å·¥å…·ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IPå½’å±åœ°æŸ¥è¯¢ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">å›¾ç‰‡æ— æŸæ”¾å¤§ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">æ–‡æœ¬æ¯”è¾ƒå·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IPæ‰¹é‡æŸ¥è¯¢å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">åŸŸåæŸ¥è¯¢å·¥å…· - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNSå·¥å…·ç®± - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">ç½‘ç«™å›¾æ ‡ç”Ÿæˆå™¨ - åº”ç”¨å•†åº— | å…è´¹å¥½ç”¨çš„åœ¨çº¿å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<h4 data-id="heading-3">2.2 v-elseï¼šè¡¥å……é»˜è®¤åˆ†æ”¯</h4>
<p>å¦‚æœ<code>v-if</code>çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œä½ å¯ä»¥ç”¨<code>v-else</code>æ·»åŠ ä¸€ä¸ªâ€œé»˜è®¤é€‰é¡¹â€ã€‚ä½†è¦æ³¨æ„ï¼š<br/>
<strong><code>v-else</code>å¿…é¡»ç´§è·Ÿåœ¨<code>v-if</code>æˆ–<code>v-else-if</code>çš„åé¢ï¼Œä¸­é—´ä¸èƒ½æœ‰å…¶ä»–å…„å¼Ÿå…ƒç´ </strong>ï¼ˆå¦åˆ™Vueæ— æ³•è¯†åˆ«å®ƒå±äºå“ªä¸ªæ¡ä»¶ï¼‰ã€‚</p>
<p>ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­ï¼Œç”¨<code>v-else</code>ç®€åŒ–æœªç™»å½•çš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-html" lang="html">
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isLogin"</span>&gt;</span>æ¬¢è¿å›æ¥ï¼Œç”¨æˆ·ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ç›´æ¥è·Ÿåœ¨v-ifåé¢ï¼Œæ— éœ€å†™æ¡ä»¶ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-else</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"isLogin = true"</span>&gt;</span>ç‚¹å‡»ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">2.3 v-else-ifï¼šå¤šåˆ†æ”¯æ¡ä»¶åˆ¤æ–­</h4>
<p>å½“éœ€è¦åˆ¤æ–­<strong>å¤šä¸ªæ¡ä»¶</strong>æ—¶ï¼Œç”¨<code>v-else-if</code>è¿æ¥ã€‚å®ƒçš„è¯­æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-html" lang="html">
<span class="hljs-tag">&lt;<span class="hljs-name">å…ƒç´ </span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"æ¡ä»¶1"</span>&gt;</span>å†…å®¹1<span class="hljs-tag">&lt;/<span class="hljs-name">å…ƒç´ </span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">å…ƒç´ </span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"æ¡ä»¶2"</span>&gt;</span>å†…å®¹2<span class="hljs-tag">&lt;/<span class="hljs-name">å…ƒç´ </span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">å…ƒç´ </span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"æ¡ä»¶3"</span>&gt;</span>å†…å®¹3<span class="hljs-tag">&lt;/<span class="hljs-name">å…ƒç´ </span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">å…ƒç´ </span> <span class="hljs-attr">v-else</span>&gt;</span>é»˜è®¤å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">å…ƒç´ </span>&gt;</span>
</code></pre>
<p><strong>å…³é”®è§„åˆ™</strong>ï¼šVueä¼šæŒ‰<strong>æŒ‡ä»¤çš„é¡ºåºä¾æ¬¡åˆ¤æ–­</strong>ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶å°±åœæ­¢ï¼ˆæ‰€ä»¥æ¡ä»¶çš„é¡ºåºå¾ˆé‡è¦ï¼ï¼‰ã€‚</p>
<p>æ¯”å¦‚æ ¹æ®åˆ†æ•°æ˜¾ç¤ºç­‰çº§ï¼ˆæœ€å¸¸è§çš„å¤šåˆ†æ”¯åœºæ™¯ï¼‰ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">
&lt;script setup&gt;
  import {ref} from 'vue'

  const score = ref(85) // å“åº”å¼åˆ†æ•°ï¼Œåˆå§‹85åˆ†
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="score-level"&gt;
    &lt;h3&gt;ä½ çš„åˆ†æ•°ï¼š{{ score }}&lt;/h3&gt;
    &lt;!-- é¡ºåºï¼šä»é«˜åˆ°ä½ --&gt;
    &lt;p v-if="score &gt;= 90" class="excellent"&gt;ç­‰çº§ï¼šä¼˜ç§€ï¼ˆâ‰¥90ï¼‰&lt;/p&gt;
    &lt;p v-else-if="score &gt;= 80" class="good"&gt;ç­‰çº§ï¼šè‰¯å¥½ï¼ˆ80-89ï¼‰&lt;/p&gt;
    &lt;p v-else-if="score &gt;= 60" class="pass"&gt;ç­‰çº§ï¼šåŠæ ¼ï¼ˆ60-79ï¼‰&lt;/p&gt;
    &lt;p v-else class="fail"&gt;ç­‰çº§ï¼šä¸åŠæ ¼ï¼ˆ&lt;60ï¼‰&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
  .excellent {
    color: #4CAF50;
  }

  .good {
    color: #2196F3;
  }

  .pass {
    color: #FFC107;
  }

  .fail {
    color: #F44336;
  }
&lt;/style&gt;
</code></pre>
<p>è¿è¡Œè¿™ä¸ªç»„ä»¶ï¼Œä¿®æ”¹<code>score</code>çš„å€¼ï¼ˆæ¯”å¦‚æ”¹æˆ<code>95</code>æˆ–<code>50</code>ï¼‰ï¼Œä¼šçœ‹åˆ°ç­‰çº§è‡ªåŠ¨åˆ‡æ¢â€”â€”è¿™å°±æ˜¯å¤šåˆ†æ”¯æ¡ä»¶æ¸²æŸ“çš„å®é™…æ•ˆæœã€‚</p>
<h3 data-id="heading-5">ä¸‰ã€æ¡ä»¶æ¸²æŸ“çš„æµç¨‹é€»è¾‘ï¼ˆé™„æµç¨‹å›¾ï¼‰</h3>
<p>ä¸ºäº†æ›´ç›´è§‚ç†è§£<code>v-if</code>ç³»åˆ—çš„æ‰§è¡Œé¡ºåºï¼Œæˆ‘ä»¬ç”»ä¸€ä¸ª<strong>åˆ¤æ–­æµç¨‹å›¾</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[å¼€å§‹] --&gt; B{æ£€æŸ¥v-ifæ¡ä»¶}
    B --&gt;|æ»¡è¶³| C[æ¸²æŸ“v-ifå†…å®¹ï¼Œç»“æŸ]
    B --&gt;|ä¸æ»¡è¶³| D{æ£€æŸ¥ä¸‹ä¸€ä¸ªv-else-ifæ¡ä»¶}
    D --&gt;|æ»¡è¶³| E[æ¸²æŸ“å¯¹åº”å†…å®¹ï¼Œç»“æŸ]
    D --&gt;|ä¸æ»¡è¶³| F{è¿˜æœ‰v-else-ifå—?}
    F --&gt;|æ˜¯| D
    F --&gt;|å¦| G[æ¸²æŸ“v-elseå†…å®¹ï¼Œç»“æŸ]
</code></pre>
<p>ç®€å•æ¥è¯´ï¼š<strong>æŒ‰é¡ºåºâ€œé—¯å…³â€ï¼Œæ»¡è¶³æ¡ä»¶å°±â€œé€šå…³â€ï¼Œå¦åˆ™ç»§ç»­ï¼Œç›´åˆ°æœ€åä¸€ä¸ªv-else</strong>ã€‚</p>
<h3 data-id="heading-6">å››ã€è¯¾åQuizï¼šå·©å›ºä½ çš„ç†è§£</h3>
<h4 data-id="heading-7">Quiz 1ï¼šv-ifå’Œv-showæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šåŒæ ·æ˜¯â€œéšè—å…ƒç´ â€ï¼Œ<code>v-if</code>å’Œ<code>v-show</code>çš„æ ¸å¿ƒå·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿåˆ†åˆ«é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆè§£æ</strong>ï¼ˆå‚è€ƒVueå®˜ç½‘ï¼‰ï¼š</p>
<ul>
<li><code>v-if</code>ï¼š<strong>é”€æ¯/é‡å»ºDOM</strong>â€”â€”æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œå…ƒç´ ä»DOMä¸­æ¶ˆå¤±ï¼›æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé‡æ–°åˆ›å»ºã€‚é€‚åˆ<strong>æ¡ä»¶å¾ˆå°‘å˜åŒ–</strong>çš„åœºæ™¯ï¼ˆæ¯”å¦‚æƒé™åˆ¤æ–­ï¼‰ï¼Œå› ä¸ºåˆå§‹æ¸²æŸ“æ›´çœæ€§èƒ½ã€‚</li>
<li><code>v-show</code>ï¼š<strong>ä¿®æ”¹CSSæ˜¾ç¤º</strong>â€”â€”æ— è®ºæ¡ä»¶å¦‚ä½•ï¼Œå…ƒç´ éƒ½ä¼šæ¸²æŸ“åˆ°DOMï¼Œåªæ˜¯ç”¨<code>display: none</code>éšè—ã€‚é€‚åˆ<strong>æ¡ä»¶é¢‘ç¹åˆ‡æ¢</strong>çš„åœºæ™¯ï¼ˆæ¯”å¦‚
tabs åˆ‡æ¢ï¼‰ï¼Œå› ä¸ºåˆ‡æ¢æ—¶æ— éœ€é”€æ¯é‡å»ºï¼Œæ›´é«˜æ•ˆã€‚</li>
</ul>
<h4 data-id="heading-8">Quiz 2ï¼šä¸ºä»€ä¹ˆv-elseå¿…é¡»ç´§è·Ÿv-ifï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœå†™<code>v-if</code>ä¹‹åéš”äº†ä¸€ä¸ª<code>div</code>å†å†™<code>v-else</code>ï¼Œä¼šæŠ¥é”™å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<p><strong>ç­”æ¡ˆè§£æ</strong>ï¼š<br/>
ä¼šæŠ¥é”™ï¼é”™è¯¯ä¿¡æ¯æ˜¯â€œv-else has no adjacent v-ifâ€ã€‚<br/>
åŸå› ï¼šVueéœ€è¦æ˜ç¡®<code>v-else</code>å¯¹åº”çš„â€œä¸Šçº§æ¡ä»¶â€â€”â€”å®ƒå¿…é¡»ä¸æœ€è¿‘çš„<code>v-if/v-else-if</code><strong>ç›´æ¥ç›¸é‚»</strong>ï¼ˆä¸­é—´ä¸èƒ½æœ‰å…¶ä»–å…„å¼Ÿå…ƒç´ ï¼‰ã€‚å¦‚æœéš”å¼€ï¼ŒVueæ— æ³•è¯†åˆ«ä¸¤è€…çš„å…³è”ã€‚</p>
<h3 data-id="heading-9">äº”ã€å¸¸è§æŠ¥é”™ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p>åœ¨ä½¿ç”¨<code>v-if</code>ç³»åˆ—æ—¶ï¼Œæ–°æ‰‹å¸¸é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼Œæˆ‘ä»¬é€ä¸€è§£å†³ï¼š</p>
<h4 data-id="heading-10">1. æŠ¥é”™ï¼šâ€œv-else/v-else-if has no adjacent v-ifâ€</h4>
<ul>
<li><strong>åŸå› </strong>ï¼š<code>v-else</code>æˆ–<code>v-else-if</code>æ²¡æœ‰ç´§è·Ÿå¯¹åº”çš„<code>v-if</code>ï¼ˆä¸­é—´æœ‰å…¶ä»–å…ƒç´ ï¼‰ã€‚<br/>
æ¯”å¦‚ï¼š
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isShow"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ— å…³å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- ä¸­é—´çš„på…ƒç´ å¯¼è‡´é”™è¯¯ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
<li><strong>è§£å†³</strong>ï¼šåˆ é™¤ä¸­é—´çš„æ— å…³å…ƒç´ ï¼Œè®©<code>v-else</code>ç›´æ¥ç´§è·Ÿ<code>v-if</code>ã€‚</li>
<li><strong>é¢„é˜²</strong>ï¼šå†™<code>v-else</code>å‰ï¼Œå…ˆæ£€æŸ¥å‰é¢çš„å…ƒç´ æ˜¯å¦æ˜¯<code>v-if</code>æˆ–<code>v-else-if</code>ã€‚</li>
</ul>
<h4 data-id="heading-11">2. æŠ¥é”™ï¼šâ€œæ¡ä»¶å˜åŒ–æ—¶ï¼Œv-ifå†…å®¹ä¸æ›´æ–°â€</h4>
<ul>
<li><strong>åŸå› </strong>ï¼šæ¡ä»¶å˜é‡ä¸æ˜¯<strong>å“åº”å¼</strong>çš„ï¼ˆæ¯”å¦‚ç”¨<code>let isShow = false</code>è€Œä¸æ˜¯<code>ref(false)</code>ï¼‰ï¼ŒVueæ— æ³•è¿½è¸ªå…¶å˜åŒ–ã€‚</li>
<li><strong>è§£å†³</strong>ï¼šç”¨<code>ref</code>ï¼ˆåŸºæœ¬ç±»å‹ï¼‰æˆ–<code>reactive</code>ï¼ˆå¯¹è±¡/æ•°ç»„ï¼‰åŒ…è£¹æ¡ä»¶å˜é‡ï¼š
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯å†™æ³•</span>
<span class="hljs-keyword">let</span> isShow = <span class="hljs-literal">false</span> 
<span class="hljs-comment">// æ­£ç¡®å†™æ³•</span>
<span class="hljs-keyword">const</span> isShow = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
</code></pre>
</li>
<li><strong>é¢„é˜²</strong>ï¼šæ‰€æœ‰éœ€è¦â€œéšæ•°æ®å˜åŒ–è€Œæ›´æ–°â€çš„å˜é‡ï¼Œéƒ½ç”¨Vueçš„å“åº”å¼APIï¼ˆ<code>ref</code>/<code>reactive</code>ï¼‰å®šä¹‰ã€‚</li>
</ul>
<h4 data-id="heading-12">3. é€»è¾‘é”™è¯¯ï¼šv-else-ifé¡ºåºå¯¼è‡´æ¡ä»¶å¤±æ•ˆ</h4>
<ul>
<li><strong>ä¾‹å­</strong>ï¼šå…ˆå†™<code>v-else-if="score &gt;= 60"</code>ï¼Œå†å†™<code>v-else-if="score &gt;= 80"</code>â€”â€”æ­¤æ—¶<code>80åˆ†</code>ä¼šè¢«ç¬¬ä¸€ä¸ªæ¡ä»¶æ‹¦æˆªï¼Œæ°¸è¿œåˆ°ä¸äº†ç¬¬äºŒä¸ªã€‚</li>
<li><strong>åŸå› </strong>ï¼šVueæŒ‰æŒ‡ä»¤é¡ºåºåˆ¤æ–­ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶å°±åœæ­¢ã€‚</li>
<li><strong>è§£å†³</strong>ï¼šå°†<strong>æ›´ä¸¥æ ¼çš„æ¡ä»¶</strong>æ”¾åœ¨å‰é¢ï¼ˆæ¯”å¦‚å…ˆ<code>&gt;=90</code>ï¼Œå†<code>&gt;=80</code>ï¼Œæœ€å<code>&gt;=60</code>ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-13">å‚è€ƒé“¾æ¥</h3>
<p>Vueå®˜ç½‘æ¡ä»¶æ¸²æŸ“æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fconditional.html" target="_blank" title="https://vuejs.org/guide/essentials/conditional.html" ref="nofollow noopener noreferrer">vuejs.org/guide/essenâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025-12-20 vue3ä¸­ eslint9+å’Œprettieré…ç½®]]></title>    <link>https://juejin.cn/post/7585468725332197430</link>    <guid>https://juejin.cn/post/7585468725332197430</guid>    <pubDate>2025-12-20T08:19:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585468725332197430" data-draft-id="7585474459776090148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025-12-20    vue3ä¸­ eslint9+å’Œprettieré…ç½®"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:19:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mr_Swilder"/> <meta itemprop="url" content="https://juejin.cn/user/3927901716878829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025-12-20    vue3ä¸­ eslint9+å’Œprettieré…ç½®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3927901716878829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mr_Swilder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:19:05.000Z" title="Sat Dec 20 2025 08:19:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>eslint 9+ç›¸è¾ƒ8ç‰ˆæœ¬ä½¿ç”¨<code>eslint.config.js</code>å’Œæ‰å¹³åŒ–é…ç½®æ–¹å¼ã€‚</p>
</blockquote>
<h3 data-id="heading-0">1.åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®‰è£…æ‰€éœ€çš„å¼€å‘ä¾èµ–åŒ…</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ ¸å¿ƒä»£ç æ£€æŸ¥ä¸æ ¼å¼åŒ–å·¥å…·</span>
pnpm add -D eslint prettier
<span class="hljs-meta prompt_">
# </span><span class="bash">Vue.js è¯­æ³•æ”¯æŒ</span>
pnpm add -D eslint-plugin-vue
<span class="hljs-meta prompt_">
# </span><span class="bash">Prettier ä¸ ESLint é›†æˆ</span>
pnpm add -D eslint-config-prettier eslint-plugin-prettier
</code></pre>
<h3 data-id="heading-1">ğŸ’… 2. <code>prettier</code>é…ç½®</h3>
<p>åœ¨<code>vscode</code>ä¸­å®‰è£…æ’ä»¶</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1742bb6496d4f07b32be2c2963d0580~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJfU3dpbGRlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823740&amp;x-signature=%2B2%2BlEqI6zH04b3JliMIuAzgjdfY%3D" alt="image.png" loading="lazy"/></p>
<p>æ ¹ç›®å½•ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶ <code>.prettierrc</code></p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"semi"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"singleQuote"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"tabWidth"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-string">"trailingComma"</span>: <span class="hljs-string">"es5"</span>,
  <span class="hljs-string">"printWidth"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"arrowParens"</span>: <span class="hljs-string">"avoid"</span>,
  <span class="hljs-string">"htmlWhitespaceSensitivity"</span>: <span class="hljs-string">"ignore"</span>
}
</code></pre>
<h3 data-id="heading-2">3.<code>eslint</code>é…ç½®å¹¶å°†<code>prettier</code>è§„åˆ™ä½œä¸º<code>eslint</code>ä¸€éƒ¨åˆ†ï¼Œå¯¹ä¸ç¬¦åˆè¦æ±‚çš„æŠ¥é”™</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// eslint.config.js</span>
<span class="hljs-keyword">import</span> eslintPluginVue <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint-plugin-vue'</span>
<span class="hljs-keyword">import</span> vueEslintParser <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-eslint-parser'</span>
<span class="hljs-keyword">import</span> eslintPluginPrettierRecommended <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint-plugin-prettier/recommended'</span>
<span class="hljs-comment">// console.log(eslintPluginPrettierRecommended)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  <span class="hljs-comment">// å…¨å±€é…ç½®ï¼šæŒ‡å®šç¯å¢ƒã€è§£æå™¨é€‰é¡¹</span>
  {
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.js'</span>, <span class="hljs-string">'**/*.vue'</span>],
    <span class="hljs-attr">ignores</span>: [<span class="hljs-string">'vite.config.js'</span>, <span class="hljs-string">'node_modules/'</span>, <span class="hljs-string">'dist/'</span>, <span class="hljs-string">'public/'</span>],
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-string">'latest'</span>,
      <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>,
      <span class="hljs-attr">globals</span>: {
        <span class="hljs-attr">browser</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æµè§ˆå™¨ç¯å¢ƒå…¨å±€å˜é‡</span>
        <span class="hljs-attr">node</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Node.js ç¯å¢ƒå…¨å±€å˜é‡</span>
        <span class="hljs-attr">es2021</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// ES2021 è¯­æ³•æ”¯æŒ</span>
      }
    },
    <span class="hljs-attr">rules</span>: {
      <span class="hljs-string">'no-console'</span>: <span class="hljs-string">'warn'</span>,
      <span class="hljs-string">'no-debugger'</span>: <span class="hljs-string">'error'</span>,
      <span class="hljs-string">'no-unused-vars'</span>: [<span class="hljs-string">'warn'</span>, { <span class="hljs-attr">varsIgnorePattern</span>: <span class="hljs-string">'^_'</span> }]
    }
  },

  <span class="hljs-comment">// Vue å•æ–‡ä»¶ç»„ä»¶ä¸“å±é…ç½®</span>
  {
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.vue'</span>],
    <span class="hljs-comment">// ä½¿ç”¨ vue-eslint-parser è§£æ .vue æ–‡ä»¶</span>
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">parser</span>: vueEslintParser,
      <span class="hljs-attr">parserOptions</span>: {
        <span class="hljs-attr">parser</span>: <span class="hljs-string">'espree'</span>, <span class="hljs-comment">// è§£æ &lt;script&gt; å—å†…çš„ JavaScript</span>
        <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-string">'latest'</span>,
        <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>
      }
    },
    <span class="hljs-attr">plugins</span>: {
      <span class="hljs-attr">vue</span>: eslintPluginVue
    },
    <span class="hljs-attr">rules</span>: {
      <span class="hljs-comment">// å¯ç”¨ Vue å®˜æ–¹æ¨èè§„åˆ™</span>
      ...eslintPluginVue.<span class="hljs-property">configs</span>[<span class="hljs-string">'flat/recommended'</span>].<span class="hljs-property">rules</span>,
      <span class="hljs-comment">// è‡ªå®šä¹‰ Vue è§„åˆ™</span>
      <span class="hljs-string">'vue/multi-word-component-names'</span>: <span class="hljs-string">'off'</span> <span class="hljs-comment">// å…³é—­ç»„ä»¶åå¿…é¡»å¤šå•è¯çš„è¦æ±‚</span>
    }
  },
  <span class="hljs-comment">//prettieré…ç½®</span>
  eslintPluginPrettierRecommended
]
</code></pre>
<p>æ­¤æ—¶è¿è¡Œ</p>
<pre><code class="hljs language-shell" lang="shell">npm run lint
</code></pre>
<p>å¯ä»¥å¯¹ä¸ç¬¦åˆè§„åˆ™çš„ä»£ç æ£€æŸ¥ï¼ŒåŒ…å«ä¸ç¬¦åˆ<code>eslint</code>è§„åˆ™çš„</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03c23319426b4f6d86115eea28bbe3b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJfU3dpbGRlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823740&amp;x-signature=5ietbj%2FFYai2fzTxhmmDQi%2Bv82I%3D" alt="image.png" loading="lazy"/></p>
<p>4.é…ç½®vscodeæ’ä»¶<code>eslint</code>å’Œ<code>Prettier ESlint</code>ï¼Œè®¾ç½®é»˜è®¤æ ¼å¼åŒ–å·¥å…·ä¸º<code>Prettier ESlint</code>ï¼Œè®©<code>eslint</code>ç›´æ¥æŠ¥é”™<code>prettier</code>ä¸­çš„é…ç½®ï¼Œæœ‰æ—¶ä¿®æ”¹äº†<code>.prettierrc</code>ä¸­çš„é…ç½®éœ€è¦é‡å¯<code>Prettier ESlint</code>æ’ä»¶æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5991155e944d43e8a514563f1cf7d674~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJfU3dpbGRlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823740&amp;x-signature=WlILNcFyOppEaY4XsUO1tfyjRZM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca06d152bbfe4152be64ba9accbe17ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJfU3dpbGRlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766823740&amp;x-signature=H4K5RzLd9rlKbrhHdippKxV6dfM%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>å¯¹äº<code>.eslintignore</code>æ–‡ä»¶ç¼ºå¤±æ—¶<code>eslint</code>ä¼šä½¿ç”¨<code>.gitignore</code>æ–‡ä»¶</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[XMLHttpRequestã€AJAXã€Fetch ä¸ Axios]]></title>    <link>https://juejin.cn/post/7585463195201355826</link>    <guid>https://juejin.cn/post/7585463195201355826</guid>    <pubDate>2025-12-20T08:20:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463195201355826" data-draft-id="7585686247269482505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="XMLHttpRequestã€AJAXã€Fetch ä¸ Axios"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:20:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·5427784851540"/> <meta itemprop="url" content="https://juejin.cn/user/224762173330942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            XMLHttpRequestã€AJAXã€Fetch ä¸ Axios
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/224762173330942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·5427784851540
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:20:09.000Z" title="Sat Dec 20 2025 08:20:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œå‰ç«¯ä¸åç«¯çš„æ•°æ®äº¤äº’æ˜¯æ„å»ºåŠ¨æ€åº”ç”¨çš„æ ¸å¿ƒã€‚å›´ç»•è¿™ä¸€éœ€æ±‚ï¼Œè¯ç”Ÿäº†å¤šä¸ªå…³é”®æŠ€æœ¯ä¸å·¥å…·ï¼š<strong>XMLHttpRequestï¼ˆXHRï¼‰</strong> ã€<strong>AJAX</strong>ã€<strong>Axios</strong> å’Œ <strong>Fetch API</strong>ã€‚å®ƒä»¬ä¹‹é—´æ—¢æœ‰å†å²æ¼”è¿›å…³ç³»ï¼Œä¹Ÿæœ‰åŠŸèƒ½é‡å ä¸äº’è¡¥ã€‚æœ¬æ–‡å°†ç³»ç»Ÿæ¢³ç†å››è€…çš„å…³ç³»ï¼Œæ·±å…¥å‰–æ XHR çš„å·¥ä½œæœºåˆ¶ä¸ Fetch çš„åº•å±‚åŸç†ï¼Œå¹¶ç»“åˆ Vue 3 å¼€å‘å®è·µï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„å‰ç«¯ç½‘ç»œé€šä¿¡çŸ¥è¯†ä½“ç³»ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸å±‚çº§å…³ç³»</h2>
<h3 data-id="heading-1">1.1 AJAXï¼šä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼ˆä¸æ˜¯æŠ€æœ¯ï¼‰</h3>
<ul>
<li><strong>å…¨ç§°</strong>ï¼šAsynchronous JavaScript and XML</li>
<li><strong>æœ¬è´¨</strong>ï¼š<strong>ä¸€ç§å¼€å‘æ¨¡å¼</strong>ï¼ŒæŒ‡åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ JavaScript å¼‚æ­¥ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®å¹¶æ›´æ–°éƒ¨åˆ†ç½‘é¡µå†…å®¹ã€‚</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šè§£è€¦ UI æ›´æ–°ä¸æ•°æ®è·å–ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</li>
</ul>
<blockquote>
<p>âœ… <strong>å…³é”®ç‚¹</strong>ï¼š<br/>
AJAX ä¸æ˜¯æŸä¸ªå…·ä½“ APIï¼Œè€Œæ˜¯ä¸€ç§<strong>ä½¿ç”¨ç°æœ‰æŠ€æœ¯å®ç°å¼‚æ­¥é€šä¿¡çš„ç­–ç•¥</strong>ã€‚<br/>
å®ç° AJAX çš„æ ¸å¿ƒæŠ€æœ¯å°±æ˜¯ <code>XMLHttpRequest</code>ã€‚</p>
</blockquote>
<h3 data-id="heading-2">1.2 XMLHttpRequestï¼ˆXHRï¼‰ï¼šæµè§ˆå™¨åŸç”Ÿ API</h3>
<ul>
<li>
<p><strong>è§’è‰²</strong>ï¼š<strong>å®ç° AJAX çš„åº•å±‚å·¥å…·</strong></p>
</li>
<li>
<p><strong>åŠŸèƒ½</strong>ï¼šæä¾›æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œ HTTP é€šä¿¡çš„èƒ½åŠ›</p>
</li>
<li>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>åŸºäºå›è°ƒï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰</li>
<li>æ”¯æŒè¿›åº¦ç›‘æ§ã€å–æ¶ˆè¯·æ±‚ã€ä¸Šä¼ /ä¸‹è½½</li>
<li>å…¼å®¹æ€§æå¥½ï¼ˆIE7+ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>å…³ç³»</strong>ï¼š<br/>
<strong>XHR æ˜¯ AJAX çš„â€œå¼•æ“â€</strong> ã€‚æ²¡æœ‰ XHRï¼Œå°±æ²¡æœ‰ç°ä»£æ„ä¹‰ä¸Šçš„ AJAXã€‚</p>
</blockquote>
<h3 data-id="heading-3">1.3 Axiosï¼šåŸºäº Promise çš„ HTTP å®¢æˆ·ç«¯åº“</h3>
<ul>
<li>
<p><strong>å®šä½</strong>ï¼š<strong>å¯¹ XHR çš„å°è£…ä¸å¢å¼º</strong></p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>è¿”å› Promiseï¼Œæ”¯æŒ async/await</li>
<li>è‡ªåŠ¨è½¬æ¢ JSON æ•°æ®</li>
<li>æ‹¦æˆªå™¨ï¼ˆè¯·æ±‚/å“åº”ï¼‰</li>
<li>å®¢æˆ·ç«¯æ”¯æŒ XSRF é˜²æŠ¤</li>
<li>æµè§ˆå™¨ + Node.js åŒç«¯æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>åº•å±‚å®ç°</strong>ï¼šåœ¨æµè§ˆå™¨ä¸­<strong>é»˜è®¤ä½¿ç”¨ XHR</strong>ï¼Œåœ¨ Node.js ä¸­ä½¿ç”¨ <code>http</code> æ¨¡å—</p>
</li>
</ul>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Axios å†…éƒ¨ç®€åŒ–é€»è¾‘</span>
function <span class="hljs-built_in">axios</span>(config) {
  return new <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    const xhr = new <span class="hljs-built_in">XMLHttpRequest</span>();
    xhr<span class="hljs-selector-class">.open</span>(config.method, config.url);
    xhr<span class="hljs-selector-class">.send</span>(config.data);
    xhr<span class="hljs-selector-class">.onload</span> = () =&gt; <span class="hljs-built_in">resolve</span>(xhr.response);
    xhr<span class="hljs-selector-class">.onerror</span> = () =&gt; <span class="hljs-built_in">reject</span>(xhr.statusText);
  });
}
</code></pre>
<blockquote>
<p>âœ… <strong>å…³ç³»</strong>ï¼š<br/>
<strong>Axios æ˜¯ XHR çš„ç°ä»£åŒ–å°è£…</strong>ï¼Œè®©å¼€å‘è€…ç”¨æ›´ç®€æ´çš„è¯­æ³•äº«å— XHR çš„å…¨éƒ¨èƒ½åŠ›ã€‚</p>
</blockquote>
<h3 data-id="heading-4">1.4 Fetch APIï¼šæµè§ˆå™¨æ–°ä¸€ä»£åŸç”Ÿ API</h3>
<ul>
<li>
<p><strong>å®šä½</strong>ï¼š<strong>XHR çš„å®˜æ–¹ç»§ä»»è€…</strong></p>
</li>
<li>
<p><strong>è®¾è®¡ç›®æ ‡</strong>ï¼š</p>
<ul>
<li>åŸºäº Promiseï¼Œç¬¦åˆç°ä»£ JS ç¼–ç¨‹ä¹ æƒ¯</li>
<li>æ›´ç®€æ´çš„ API è®¾è®¡</li>
<li>æ›´å¥½çš„æµï¼ˆStreamï¼‰æ”¯æŒ</li>
<li>ç»Ÿä¸€è¯·æ±‚/å“åº”æ¨¡å‹ï¼ˆRequest/Response å¯¹è±¡ï¼‰</li>
</ul>
</li>
<li>
<p><strong>åº•å±‚å®ç°</strong>ï¼š<strong>å¹¶éåŸºäº XHR</strong>ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨æµè§ˆå™¨çš„ç½‘ç»œå±‚ï¼ˆå¦‚ Chromium çš„ <code>blink::WebURLLoader</code>ï¼‰</p>
</li>
</ul>
<blockquote>
<p>âš ï¸ <strong>é‡è¦åŒºåˆ«</strong>ï¼š<br/>
Fetch <strong>ä¸æ˜¯ XHR çš„å°è£…</strong>ï¼Œè€Œæ˜¯<strong>å…¨æ–°çš„åº•å±‚å®ç°</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">äºŒã€å››è€…å…³ç³»å›¾è°±</h2>
<pre><code class="hljs language-scss" lang="scss">                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚    AJAX      â”‚ â†â”€â”€ ç¼–ç¨‹èŒƒå¼ï¼ˆå¼‚æ­¥é€šä¿¡æ€æƒ³ï¼‰
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ XMLHttpRequest  â”‚   â”‚       Fetch API     â”‚   â”‚      Axios      â”‚
â”‚ (åŸç”Ÿ, å›è°ƒå¼)   â”‚   â”‚ (åŸç”Ÿ, Promiseå¼)   â”‚   â”‚ (ç¬¬ä¸‰æ–¹åº“, Promise)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   ç°ä»£ Web åº”ç”¨æ•°æ®é€šä¿¡    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p>ğŸ”‘ <strong>æ€»ç»“å…³ç³»</strong>ï¼š</p>
<ul>
<li><strong>AJAX</strong> æ˜¯æ€æƒ³ï¼Œ<strong>XHR/Fetch</strong> æ˜¯å®ç°è¯¥æ€æƒ³çš„åŸç”Ÿå·¥å…·</li>
<li><strong>Axios</strong> æ˜¯å¯¹ XHRï¼ˆæµè§ˆå™¨ç«¯ï¼‰çš„é«˜çº§å°è£…</li>
<li><strong>Fetch</strong> æ˜¯æµè§ˆå™¨æä¾›çš„ã€ä¸ XHR å¹¶åˆ—çš„æ–°ä¸€ä»£åŸç”Ÿ API</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€XMLHttpRequest è¯¦è§£</h2>
<h3 data-id="heading-7">3.1 åŸºæœ¬ä½¿ç”¨æµç¨‹</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">xhr</span> = new XMLHttpRequest()<span class="hljs-comment">;</span>
xhr.open('GET', '/api/users', true)<span class="hljs-comment">;</span>
xhr.setRequestHeader('Content-Type', 'application/json')<span class="hljs-comment">;</span>
<span class="hljs-attr">xhr.onreadystatechange</span> = function() {
  if (<span class="hljs-attr">xhr.readyState</span> === <span class="hljs-number">4</span> &amp;&amp; xhr.status === <span class="hljs-number">200</span>) {
    console.log(xhr.responseText)<span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>
xhr.send()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-8">3.2 æ ¸å¿ƒå±æ€§</h3>





























<table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>readyState</code></td><td>è¯·æ±‚çŠ¶æ€ï¼ˆ0â€“4ï¼‰</td></tr><tr><td><code>status</code> / <code>statusText</code></td><td>HTTP çŠ¶æ€ç ä¸æè¿°</td></tr><tr><td><code>responseText</code></td><td>å­—ç¬¦ä¸²å“åº”ä½“</td></tr><tr><td><code>response</code></td><td>æ ¹æ® <code>responseType</code> è§£æåçš„æ•°æ®</td></tr><tr><td><code>responseType</code></td><td>å“åº”ç±»å‹ï¼ˆ<code>json</code>ã€<code>blob</code>ã€<code>arraybuffer</code> ç­‰ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-9">3.3 äº‹ä»¶æ¨¡å‹</h3>
<ul>
<li>
<p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼š<code>onreadystatechange</code>ï¼ˆéœ€æ‰‹åŠ¨åˆ¤æ–­ <code>readyState</code>ï¼‰</p>
</li>
<li>
<p><strong>ç°ä»£æ–¹å¼</strong>ï¼ˆæ¨èï¼‰ï¼š</p>
<ul>
<li><code>onload</code>ï¼šè¯·æ±‚å®Œæˆ</li>
<li><code>onerror</code>ï¼šç½‘ç»œé”™è¯¯</li>
<li><code>ontimeout</code>ï¼šè¶…æ—¶</li>
<li><code>onabort</code>ï¼šè¢«ä¸­æ­¢</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">3.4 é«˜çº§åŠŸèƒ½</h3>
<ul>
<li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼š<code>xhr.timeout = 5000</code></li>
<li><strong>è·¨åŸŸå‡­æ®</strong>ï¼š<code>xhr.withCredentials = true</code></li>
<li><strong>ä¸Šä¼ è¿›åº¦</strong>ï¼š<code>xhr.upload.onprogress</code></li>
<li><strong>ä¸­æ­¢è¯·æ±‚</strong>ï¼š<code>xhr.abort()</code></li>
</ul>
<h3 data-id="heading-11">3.5 å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-12">æ–‡ä»¶ä¸Šä¼ ï¼ˆå¸¦è¿›åº¦ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">function uploadFile(file) {
  const <span class="hljs-attr">formData</span> = new FormData()<span class="hljs-comment">;</span>
  formData.append('file', file)<span class="hljs-comment">;</span>
  
  const <span class="hljs-attr">xhr</span> = new XMLHttpRequest()<span class="hljs-comment">;</span>
  xhr.open('POST', '/upload')<span class="hljs-comment">;</span>
  
  <span class="hljs-attr">xhr.upload.onprogress</span> = (e) =&gt; {
    if (e.lengthComputable) {
      const <span class="hljs-attr">percent</span> = (e.loaded / e.total) * <span class="hljs-number">100</span><span class="hljs-comment">;</span>
      updateProgress(percent)<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
  
  <span class="hljs-attr">xhr.onload</span> = () =&gt; {
    if (<span class="hljs-attr">xhr.status</span> === <span class="hljs-number">200</span>) showSuccess()<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
  
  xhr.send(formData)<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-13">å››ã€Fetch API åŸç†æ·±åº¦è§£æ</h2>
<h3 data-id="heading-14">4.1 æ ¸å¿ƒè®¾è®¡ï¼šåŸºäº Stream çš„è¯·æ±‚/å“åº”æ¨¡å‹</h3>
<p>Fetch çš„æ ¸å¿ƒæ˜¯ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š</p>
<ul>
<li><code>Request</code>ï¼šè¡¨ç¤º HTTP è¯·æ±‚</li>
<li><code>Response</code>ï¼šè¡¨ç¤º HTTP å“åº”</li>
</ul>
<p>ä¸¤è€…éƒ½å®ç°äº† <strong>Body mixin</strong>ï¼ŒåŒ…å«å¯è¯»æµï¼ˆReadableStreamï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">body</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ReadableStream</span>); <span class="hljs-comment">// true</span>
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">// å†…éƒ¨è¯»å– body æµå¹¶è§£æ</span>
  });
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>å…³é”®æœºåˆ¶</strong>ï¼š<br/>
Fetch å°†å“åº”ä½“è§†ä¸º<strong>æµï¼ˆStreamï¼‰</strong> ï¼Œæ”¯æŒè¾¹ä¸‹è½½è¾¹å¤„ç†ï¼Œé€‚åˆå¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®ã€‚</p>
</blockquote>
<h3 data-id="heading-15">4.2 æ‰§è¡Œæµç¨‹ï¼ˆæµè§ˆå™¨å†…éƒ¨ï¼‰</h3>
<p>ä»¥ Chromium ä¸ºä¾‹ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>fetch(url)</code> â†’ åˆ›å»º <code>Request</code> å¯¹è±¡</li>
<li>æµè§ˆå™¨ä¸»çº¿ç¨‹ â†’ ç½‘ç»œæœåŠ¡çº¿ç¨‹ï¼ˆNetwork Serviceï¼‰</li>
<li>ç½‘ç»œçº¿ç¨‹å‘èµ· HTTP è¯·æ±‚ï¼ˆå¤ç”¨è¿æ¥æ± ã€DNS ç¼“å­˜ç­‰ï¼‰</li>
<li>æ”¶åˆ°å“åº”å¤´ â†’ ç«‹å³ resolve Promiseï¼ˆè¿”å› <code>Response</code> å¯¹è±¡ï¼‰</li>
<li>å“åº”ä½“é€šè¿‡ <strong>ReadableStream</strong> é€æ­¥ä¼ è¾“åˆ° JS ä¸»çº¿ç¨‹</li>
<li>è°ƒç”¨ <code>.json()</code> / <code>.text()</code> ç­‰æ–¹æ³• â†’ æ¶ˆè´¹æµå¹¶è§£æ</li>
</ol>
<h3 data-id="heading-16">4.3 ä¸ XHR çš„å…³é”®å·®å¼‚</h3>



































<table><thead><tr><th>ç‰¹æ€§</th><th>XHR</th><th>Fetch</th></tr></thead><tbody><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td>ç½‘ç»œé”™è¯¯ â†’ <code>onerror</code>ï¼›HTTP é”™è¯¯ï¼ˆ404/500ï¼‰â†’ <code>onload</code></td><td><strong>ä»…ç½‘ç»œé”™è¯¯ reject</strong>ï¼›HTTP é”™è¯¯ä» resolveï¼ˆéœ€æ‰‹åŠ¨æ£€æŸ¥ <code>response.ok</code>ï¼‰</td></tr><tr><td><strong>Cookie å‘é€</strong></td><td>åŒåŸŸè‡ªåŠ¨å‘é€</td><td>éœ€æ˜¾å¼è®¾ç½® <code>credentials: 'same-origin'</code></td></tr><tr><td><strong>å–æ¶ˆè¯·æ±‚</strong></td><td><code>xhr.abort()</code></td><td><code>AbortController</code></td></tr><tr><td><strong>ä¸Šä¼ è¿›åº¦</strong></td><td>åŸç”Ÿ <code>upload.onprogress</code></td><td><strong>ä¸æ”¯æŒ</strong>ï¼ˆéœ€è‡ªå®šä¹‰ <code>ReadableStream</code>ï¼Œå¤æ‚ï¼‰</td></tr><tr><td><strong>è¶…æ—¶æ§åˆ¶</strong></td><td><code>xhr.timeout</code></td><td>éœ€é…åˆ <code>AbortController</code> + <code>setTimeout</code></td></tr></tbody></table>
<h4 data-id="heading-17">é”™è¯¯å¤„ç†å¯¹æ¯”ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Fetchï¼šHTTP 404 ä» resolve</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/not-found'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) { <span class="hljs-comment">// å¿…é¡»æ‰‹åŠ¨æ£€æŸ¥</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${res.status}</span>`</span>);
    }
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-comment">// åªæœ‰ç½‘ç»œæ–­å¼€æ‰ä¼šè¿›å…¥è¿™é‡Œ</span>
  });
</code></pre>
<h3 data-id="heading-18">4.4 Fetch çš„å±€é™æ€§ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-19">é—®é¢˜ 1ï¼šæ— æ³•ç›‘æ§ä¸‹è½½è¿›åº¦</h4>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ‰‹åŠ¨è¯»å–æµå¹¶è®¡ç®—è¿›åº¦ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">response</span> = await fetch(<span class="hljs-string">'/large-file'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">contentLength</span> = +response.headers.get(<span class="hljs-string">'Content-Length'</span>)<span class="hljs-comment">;</span>
let <span class="hljs-attr">loaded</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

const <span class="hljs-attr">reader</span> = response.body.getReader()<span class="hljs-comment">;</span>
while (true) {
  const { done, value } = await reader.read()<span class="hljs-comment">;</span>
  if (done) break<span class="hljs-comment">;</span>
  loaded += value.length<span class="hljs-comment">;</span>
  const <span class="hljs-attr">progress</span> = (loaded / contentLength) * <span class="hljs-number">100</span><span class="hljs-comment">;</span>
  updateProgress(progress)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-20">é—®é¢˜ 2ï¼šæ— å†…ç½®è¶…æ—¶</h4>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç»“åˆ <code>AbortController</code>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const controller = new <span class="hljs-built_in">AbortController</span>();
const timeoutId = <span class="hljs-built_in">setTimeout</span>(() =&gt; controller<span class="hljs-selector-class">.abort</span>(), <span class="hljs-number">5000</span>);

<span class="hljs-built_in">fetch</span>('/api/data', { signal: controller.signal })
  <span class="hljs-selector-class">.finally</span>(() =&gt; <span class="hljs-built_in">clearTimeout</span>(timeoutId));
</code></pre>
<hr/>
<h2 data-id="heading-21">äº”ã€Vue 3 ä¸­çš„ç½‘ç»œé€šä¿¡å®è·µ</h2>
<p>è™½ç„¶ Vue æœ¬èº«ä¸å¼ºåˆ¶ä½¿ç”¨ç‰¹å®š HTTP å®¢æˆ·ç«¯ï¼Œä½†å…¶ç»„åˆå¼ API ä¸ç°ä»£è¯·æ±‚åº“å¤©ç„¶å¥‘åˆã€‚</p>
<h3 data-id="heading-22">5.1 ä½¿ç”¨ Axiosï¼ˆæ¨èç”¨äºå¤æ‚é¡¹ç›®ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">// composables/useApi.js
import axios from 'axios'<span class="hljs-comment">;</span>

const <span class="hljs-attr">api</span> = axios.create({
  baseURL: '/api',
  timeout: 10000,
  withCredentials: true
})<span class="hljs-comment">;</span>

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(<span class="hljs-attr">config</span> =&gt; {
  const <span class="hljs-attr">token</span> = localStorage.getItem(<span class="hljs-string">'token'</span>)<span class="hljs-comment">;</span>
  if (token) <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${token}</span>`<span class="hljs-comment">;</span>
  return config<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  <span class="hljs-attr">response</span> =&gt; response.data,
  <span class="hljs-attr">error</span> =&gt; {
    if (error.response?.<span class="hljs-attr">status</span> === <span class="hljs-number">401</span>) {
      // å¤„ç†æœªæˆæƒ
      router.push('/login')<span class="hljs-comment">;</span>
    }
    return Promise.reject(error)<span class="hljs-comment">;</span>
  }
)<span class="hljs-comment">;</span>

export default api<span class="hljs-comment">;</span>
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> api <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/useApi'</span>;

<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([]);
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">try</span> {
    users.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users'</span>);
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  }
};

<span class="hljs-title function_">fetchUsers</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-23">5.2 ä½¿ç”¨ Fetchï¼ˆè½»é‡çº§é¡¹ç›®ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request.js</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">url, options = {}</span>) {
  <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>,
    ...options,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      ...options.<span class="hljs-property">headers</span>
    }
  };

  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
  <span class="hljs-keyword">const</span> timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> controller.<span class="hljs-title function_">abort</span>(), <span class="hljs-number">10000</span>);
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
      ...config,
      <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>
    });
    
    <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${response.status}</span>`</span>);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-keyword">export</span> { request };
</code></pre>
<h3 data-id="heading-24">5.3 å°è£…ä¸º Composableï¼ˆæœ€ä½³å®è·µï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">// composables/useFetch.js
import { ref } from 'vue'<span class="hljs-comment">;</span>

export function useFetch(url) {
  const <span class="hljs-attr">data</span> = ref(null)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">loading</span> = ref(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">error</span> = ref(null)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">execute</span> = async () =&gt; {
    <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">error.value</span> = null<span class="hljs-comment">;</span>
    
    try {
      const <span class="hljs-attr">res</span> = await fetch(url)<span class="hljs-comment">;</span>
      if (!res.ok) throw new Error(res.statusText)<span class="hljs-comment">;</span>
      <span class="hljs-attr">data.value</span> = await res.json()<span class="hljs-comment">;</span>
    } catch (err) {
      <span class="hljs-attr">error.value</span> = err<span class="hljs-comment">;</span>
    } finally {
      <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>

  return { data, loading, error, execute }<span class="hljs-comment">;</span>
}
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useFetch } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/useFetch'</span>;

<span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: users, loading, execute } = <span class="hljs-title function_">useFetch</span>(<span class="hljs-string">'/api/users'</span>);
<span class="hljs-title function_">execute</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">å…­ã€å¦‚ä½•é€‰æ‹©ï¼Ÿâ€”â€” ä½¿ç”¨åœºæ™¯å»ºè®®</h2>








































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>æ–°é¡¹ç›®ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰</strong></td><td><code>fetch()</code> + å·¥å…·å‡½æ•°å°è£…</td><td>åŸç”Ÿæ”¯æŒï¼Œæ— ä¾èµ–ï¼Œç¬¦åˆæ ‡å‡†</td></tr><tr><td><strong>éœ€è¦ä¸Šä¼ /ä¸‹è½½è¿›åº¦</strong></td><td><code>XMLHttpRequest</code> æˆ– Axios</td><td>åŸç”Ÿæ”¯æŒ <code>onprogress</code>ï¼Œç®€å•å¯é </td></tr><tr><td><strong>å¤æ‚æ‹¦æˆªã€è½¬æ¢ã€å…¼å®¹ Node.js</strong></td><td><code>Axios</code></td><td>åŠŸèƒ½å…¨é¢ï¼Œç”Ÿæ€æˆç†Ÿ</td></tr><tr><td><strong>ç»´æŠ¤æ—§é¡¹ç›®ï¼ˆIE11+ï¼‰</strong></td><td><code>XMLHttpRequest</code> æˆ– Axiosï¼ˆå¸¦ polyfillï¼‰</td><td>æœ€å¤§å…¼å®¹æ€§</td></tr><tr><td><strong>è½»é‡çº§åº”ç”¨ï¼Œé¿å…æ‰“åŒ…ä½“ç§¯</strong></td><td><code>fetch()</code></td><td>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td><strong>Vue 3 é¡¹ç›®</strong></td><td><strong>Axiosï¼ˆå¤æ‚ï¼‰</strong> æˆ– <strong>Fetch + Composableï¼ˆç®€å•ï¼‰</strong></td><td>ä¸ç»„åˆå¼ API å®Œç¾å¥‘åˆ</td></tr></tbody></table>
<blockquote>
<p>ğŸ“Œ <strong>ç°ä»£æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨ <code>fetch()</code> æˆ– Axios</li>
<li>å°†ç½‘ç»œé€»è¾‘å°è£…ä¸º Composableï¼Œå®ç°é€»è¾‘å¤ç”¨</li>
<li>é¿å…ç›´æ¥ä½¿ç”¨è£¸ XHRï¼ˆé™¤éç‰¹æ®Šéœ€æ±‚ï¼‰</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-26">ä¸ƒã€å®‰å…¨ä¸æ€§èƒ½æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-27">7.1 å®‰å…¨</h3>
<ul>
<li><strong>XSS é˜²æŠ¤</strong>ï¼šæ°¸è¿œä¸è¦å°†å“åº”ç›´æ¥æ’å…¥ <code>innerHTML</code></li>
<li><strong>CSRF é˜²æŠ¤</strong>ï¼šä½¿ç”¨ anti-CSRF tokenï¼Œé‡è¦æ“ä½œç”¨é GET æ–¹æ³•</li>
<li><strong>CORS ç­–ç•¥</strong>ï¼šæœåŠ¡å™¨ä¸¥æ ¼é™åˆ¶ <code>Access-Control-Allow-Origin</code></li>
<li><strong>æ•æ„Ÿæ•°æ®</strong>ï¼šä½¿ç”¨ HTTPSï¼Œé¿å…å®¢æˆ·ç«¯å­˜å‚¨å¯†ç /token</li>
</ul>
<h3 data-id="heading-28">7.2 æ€§èƒ½</h3>
<ul>
<li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šåˆç†è®¾ç½® <code>Cache-Control</code> å¤´</li>
<li><strong>è¯·æ±‚åˆå¹¶</strong>ï¼šé¿å…é¢‘ç¹å°è¯·æ±‚</li>
<li><strong>æ‡’åŠ è½½</strong>ï¼šéå…³é”®æ•°æ®å»¶è¿Ÿè¯·æ±‚</li>
<li><strong>å–æ¶ˆå†—ä½™è¯·æ±‚</strong>ï¼šç»„ä»¶é”€æ¯æ—¶ä¸­æ­¢æœªå®Œæˆçš„è¯·æ±‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 ä¸­å–æ¶ˆè¯·æ±‚</span>
<span class="hljs-keyword">import</span> { onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useFetch</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
  
  <span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
    controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚</span>
  });
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">execute</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });
  };
  
  <span class="hljs-keyword">return</span> { execute };
}
</code></pre>
<hr/>
<h2 data-id="heading-29">ç»“è¯­</h2>
<p>ç†è§£ XHRã€AJAXã€Axios ä¸ Fetch çš„å…³ç³»ï¼Œæœ¬è´¨ä¸Šæ˜¯ç†è§£ Web å¼‚æ­¥é€šä¿¡æŠ€æœ¯çš„æ¼”è¿›å²ï¼š</p>
<ul>
<li><strong>AJAX</strong> æå‡ºäº†â€œå¼‚æ­¥æ›´æ–°â€çš„æ€æƒ³</li>
<li><strong>XHR</strong> æä¾›äº†é¦–ä¸ªæ ‡å‡†åŒ–å®ç°</li>
<li><strong>Axios</strong> åœ¨ XHR åŸºç¡€ä¸Šæ„å»ºäº†å¼€å‘è€…å‹å¥½çš„æŠ½è±¡</li>
<li><strong>Fetch</strong> åˆ™ä»£è¡¨äº†æµè§ˆå™¨å‚å•†å¯¹ä¸‹ä¸€ä»£ç½‘ç»œ API çš„é‡æ–°è®¾è®¡</li>
</ul>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬ä¸å¿…æ‹˜æ³¥äºæŸä¸€ç§å·¥å…·ï¼Œè€Œåº”æ ¹æ®é¡¹ç›®éœ€æ±‚ã€æµè§ˆå™¨æ”¯æŒå’ŒåŠŸèƒ½å¤æ‚åº¦åšå‡ºåˆç†é€‰æ‹©ã€‚ä½†æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œå…¶èƒŒåçš„æ ¸å¿ƒåŸç†â€”â€”<strong>HTTP åè®®ã€CORS å®‰å…¨æ¨¡å‹ã€å¼‚æ­¥ç¼–ç¨‹èŒƒå¼</strong>â€”â€”å§‹ç»ˆä¸å˜ã€‚</p>
<p>åœ¨ Vue 3 çš„ç»„åˆå¼ API æ—¶ä»£ï¼Œå°†ç½‘ç»œé€»è¾‘å°è£…ä¸ºå¯å¤ç”¨çš„ Composableï¼Œä¸ä»…èƒ½æå‡ä»£ç å¯ç»´æŠ¤æ€§ï¼Œæ›´èƒ½å……åˆ†å‘æŒ¥ç°ä»£ JavaScript çš„è¡¨è¾¾åŠ›ã€‚æŒæ¡è¿™äº›åº•å±‚é€»è¾‘ï¼Œæ‰èƒ½åœ¨æŠ€æœ¯å˜è¿ä¸­æ¸¸åˆƒæœ‰ä½™ï¼Œæ„å»ºå‡ºé«˜æ€§èƒ½ã€é«˜å®‰å…¨æ€§çš„ç°ä»£ Web åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ path-exists]]></title>    <link>https://juejin.cn/post/7585400495684124714</link>    <guid>https://juejin.cn/post/7585400495684124714</guid>    <pubDate>2025-12-20T08:23:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585400495684124714" data-draft-id="7585474459776286756" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨  path-exists"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:23:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è„šæ‰‹æ¶å¼€å‘å·¥å…·â€”â€”åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨  path-exists
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:23:02.000Z" title="Sat Dec 20 2025 08:23:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p><code>path-exists</code>Â æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Node.js npm åŒ…ï¼Œå…¶<strong>æ ¸å¿ƒä½œç”¨æ˜¯ç®€ä¾¿ã€é«˜æ•ˆåœ°æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿä¸­æŒ‡å®šçš„è·¯å¾„ï¼ˆæ–‡ä»¶æˆ–ç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨</strong>ï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨å°è£…åŸç”Ÿæ–‡ä»¶æ“ä½œçš„å›è°ƒé€»è¾‘æˆ–é”™è¯¯å¤„ç†ï¼Œç®€åŒ–äº† Node.js ä¸­çš„è·¯å¾„å­˜åœ¨æ€§æ ¡éªŒåœºæ™¯ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒç”¨æ³•</h3>
<pre><code class="hljs language-lua" lang="lua">npm install <span class="hljs-built_in">path</span>-exists <span class="hljs-comment">--save</span>
</code></pre>
<ul>
<li>å¼‚æ­¥ç”¨æ³•ï¼ˆæ¨èï¼Œéé˜»å¡ I/Oï¼‰</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> pathExists = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path-exists'</span>);

<span class="hljs-comment">// å¼‚æ­¥æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkFilePath</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ä¼ å…¥è¦æ£€æŸ¥çš„æ–‡ä»¶/ç›®å½•è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„å‡å¯ï¼‰</span>
  <span class="hljs-keyword">const</span> isExist = <span class="hljs-keyword">await</span> <span class="hljs-title function_">pathExists</span>(<span class="hljs-string">'./test.txt'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š'</span>, isExist); <span class="hljs-comment">// è¿”å› true æˆ– false</span>
}

<span class="hljs-title function_">checkFilePath</span>();

<span class="hljs-comment">// ä¹Ÿå¯ä½¿ç”¨ Promise é“¾å¼è°ƒç”¨ï¼ˆå…¼å®¹æ—§ç‰ˆè¯­æ³•ï¼‰</span>
<span class="hljs-title function_">pathExists</span>(<span class="hljs-string">'./dist/'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">exists</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š'</span>, exists);
});
</code></pre>
<ul>
<li>åŒæ­¥ç”¨æ³•ï¼ˆé€‚ç”¨äºç®€å•è„šæœ¬ï¼Œé˜»å¡ I/Oï¼‰</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">pathExists</span> = require(<span class="hljs-string">'path-exists'</span>)<span class="hljs-comment">;</span>

// åŒæ­¥æ£€æŸ¥ç›®å½•è·¯å¾„æ˜¯å¦å­˜åœ¨
const <span class="hljs-attr">dirExists</span> = pathExists.sync(<span class="hljs-string">'./node_modules/'</span>)<span class="hljs-comment">;</span>
console.log('node_modules ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š', dirExists)<span class="hljs-comment">; // è¿”å› true æˆ– false</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[linuxæ­å»ºhadoopæœåŠ¡]]></title>    <link>https://juejin.cn/post/7585474459776385060</link>    <guid>https://juejin.cn/post/7585474459776385060</guid>    <pubDate>2025-12-20T08:27:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776385060" data-draft-id="7585474459776172068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="linuxæ­å»ºhadoopæœåŠ¡"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:27:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ä¸‰çš„å¼€å‘æ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            linuxæ­å»ºhadoopæœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ä¸‰çš„å¼€å‘æ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:27:37.000Z" title="Sat Dec 20 2025 08:27:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.åˆ›å»ºxsyncä¸jpsall</h2>
<p>mkdir -p /home/atguigu/bin</p>
<p>vim xsync</p>
<pre><code class="hljs language-js" lang="js">#!<span class="hljs-regexp">/bin/</span>bash

# <span class="hljs-number">1.</span> åˆ¤æ–­å‚æ•°ä¸ªæ•°
<span class="hljs-keyword">if</span> [ $# -lt <span class="hljs-number">1</span> ]; then
    echo <span class="hljs-string">"Not Enough Arguement!"</span>
    exit <span class="hljs-number">1</span>
fi

# <span class="hljs-number">2.</span> éå†é›†ç¾¤æ‰€æœ‰æœºå™¨
<span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> hadoop102 hadoop103 hadoop104; <span class="hljs-keyword">do</span>
    echo <span class="hljs-string">"==================== $host ===================="</span>

    # <span class="hljs-number">3.</span> éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-string">"$@"</span>; <span class="hljs-keyword">do</span>
        # <span class="hljs-number">4.</span> åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        <span class="hljs-keyword">if</span> [ -e <span class="hljs-string">"$file"</span> ]; then
            # <span class="hljs-number">5.</span> è·å–çˆ¶ç›®å½•
            pdir=$(cd -P <span class="hljs-string">"$(dirname "</span>$file<span class="hljs-string">")"</span>; pwd)
            # <span class="hljs-number">6.</span> è·å–å½“å‰æ–‡ä»¶çš„åç§°
            fname=$(basename <span class="hljs-string">"$file"</span>)

            ssh <span class="hljs-string">"$host"</span> <span class="hljs-string">"mkdir -p $pdir"</span>
            rsync -av <span class="hljs-string">"$pdir/$fname"</span> <span class="hljs-string">"$host:$pdir"</span>
        <span class="hljs-keyword">else</span>
            echo <span class="hljs-string">"$file does not exist!"</span>
        fi
    done
done
</code></pre>
<p>vim jpsall</p>
<pre><code class="hljs language-js" lang="js">#!<span class="hljs-regexp">/bin/</span>bash

<span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> hadoop102 hadoop103 hadoop104

<span class="hljs-keyword">do</span>

echo =============== $host ===============

ssh $host jps

done
</code></pre>
<h2 data-id="heading-1">2.ç¼–è¾‘/etc/profile.d/my_env.sh</h2>
<pre><code class="hljs language-js" lang="js">#<span class="hljs-variable constant_">JAVA_HOME</span>
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">JAVA_HOME</span>=<span class="hljs-regexp">/opt/m</span>odule/jdk1<span class="hljs-number">.8</span><span class="hljs-number">.0_212</span>
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">PATH</span>=<span class="hljs-attr">$PATH</span>:$JAVA_HOME/bin
#<span class="hljs-variable constant_">HADOOP_HOME</span>
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">HADOOP_HOME</span>=<span class="hljs-regexp">/opt/m</span>odule/hadoop-<span class="hljs-number">3.1</span><span class="hljs-number">.3</span>
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">PATH</span>=<span class="hljs-attr">$PATH</span>:$HADOOP_HOME/bin
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">PATH</span>=<span class="hljs-attr">$PATH</span>:$HADOOP_HOME/sbin
#<span class="hljs-variable constant_">KAFKA_HOME</span>
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">KAFKA_HOME</span>=<span class="hljs-regexp">/opt/m</span>odule/kafka
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">PATH</span>=<span class="hljs-attr">$PATH</span>:$KAFKA_HOME/bin

source /etc/profile.<span class="hljs-property">d</span>/my_env.<span class="hljs-property">sh</span>
</code></pre>
<h2 data-id="heading-2">3.ä¿®æ”¹æ–‡ä»¶ç»„</h2>
<pre><code class="hljs language-js" lang="js">åœ¨ hadoop102ã€hadoop103ã€hadoop104 éƒ½å·²ç»åˆ›å»ºå¥½çš„/opt/<span class="hljs-variable language_">module</span> å¹¶ä¸”å·²ç»æŠŠè¿™ä¸ªç›®å½•ä¿®æ”¹ä¸º <span class="hljs-attr">atguigu</span>:atguigu

<span class="hljs-number">102</span>æœåŠ¡å™¨: sudo chown <span class="hljs-attr">atguigu</span>:atguigu -R /opt/<span class="hljs-variable language_">module</span>

scp -r /opt/<span class="hljs-variable language_">module</span>/jdk1<span class="hljs-number">.8</span><span class="hljs-number">.0_212</span> atguigu@<span class="hljs-attr">hadoop103</span>:<span class="hljs-regexp">/opt/m</span>odule

scp -r /opt/<span class="hljs-variable language_">module</span>/jdk1<span class="hljs-number">.8</span><span class="hljs-number">.0_212</span> atguigu@<span class="hljs-attr">hadoop104</span>:<span class="hljs-regexp">/opt/m</span>odule
</code></pre>
<h2 data-id="heading-3">4.ä¿®æ”¹hadoopç›¸å…³é…ç½®æ–‡ä»¶</h2>
<p>cd $HADOOP_HOME/etc/hadoop</p>
<p>ç¼–è¾‘ core-site.xml</p>
<pre><code class="hljs language-js" lang="js">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;?xml-stylesheet type=<span class="hljs-string">"text/xsl"</span> href=<span class="hljs-string">"configuration.xsl"</span>?&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- æŒ‡å®š NameNode çš„åœ°å€ --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>fs.defaultFS<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- æŒ‡å®š hadoop æ•°æ®çš„å­˜å‚¨ç›®å½• --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.tmp.dir<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/opt/module/hadoop-3.1.3/data<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- é…ç½® HDFS ç½‘é¡µç™»å½•ä½¿ç”¨çš„é™æ€ç”¨æˆ·ä¸º atguigu --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
</code></pre>
<p>ç¼–è¾‘ hdfs-site.xml</p>
<pre><code class="hljs language-js" lang="js">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;?xml-stylesheet type=<span class="hljs-string">"text/xsl"</span> href=<span class="hljs-string">"configuration.xsl"</span>?&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-comment">&lt;!-- nn web ç«¯è®¿é—®åœ°å€--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>dfs.namenode.http-address<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop102:9870<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 2nn web ç«¯è®¿é—®åœ°å€--&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop104:9868<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
</code></pre>
<p>ç¼–è¾‘ yarn-site.xml</p>
<pre><code class="hljs language-js" lang="js">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;?xml-stylesheet type=<span class="hljs-string">"text/xsl"</span> href=<span class="hljs-string">"configuration.xsl"</span>?&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- æŒ‡å®š MR èµ° shuffle --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>mapreduce_shuffle<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- æŒ‡å®š ResourceManager çš„åœ°å€--&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop103<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- è®¾ç½®æ—¥å¿—èšé›†æœåŠ¡å™¨åœ°å€ --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.log.server.url<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>http://hadoop102:19888/jobhistory/logs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é—´ä¸º 7 å¤© --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>604800<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!--æ˜¯å¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æ¯ä¸ªä»»åŠ¡æ­£ä½¿ç”¨çš„ç‰©ç†å†…å­˜é‡ï¼Œå¦‚æœä»»åŠ¡è¶…å‡ºåˆ†é…å€¼ï¼Œåˆ™ç›´æ¥å°†å…¶æ€æ‰ï¼Œé»˜è®¤æ˜¯true --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!--æ˜¯å¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ£€æŸ¥æ¯ä¸ªä»»åŠ¡æ­£ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜é‡ï¼Œå¦‚æœä»»åŠ¡è¶…å‡ºåˆ†é…å€¼ï¼Œåˆ™ç›´æ¥å°†å…¶æ€æ‰ï¼Œé»˜è®¤æ˜¯true --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.log.server.url<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>http://hadoop102:19888/jobhistory/logs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
</code></pre>
<p>ç¼–è¾‘ mapred-site.xml</p>
<pre><code class="hljs language-js" lang="js">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;?xml-stylesheet type=<span class="hljs-string">"text/xsl"</span> href=<span class="hljs-string">"configuration.xsl"</span>?&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-comment">&lt;!-- æŒ‡å®š MapReduce ç¨‹åºè¿è¡Œåœ¨ Yarn ä¸Š --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>mapreduce.framework.name<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>yarn<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€ --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop102:10020<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- å†å²æœåŠ¡å™¨ web ç«¯åœ°å€ --&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop102:19888<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
</code></pre>
<p>xsyncåŒæ­¥æ–‡ä»¶</p>
<pre><code class="hljs language-js" lang="js">xsync /opt/<span class="hljs-variable language_">module</span>/hadoop-<span class="hljs-number">3.1</span><span class="hljs-number">.3</span>/etc/hadoop/
</code></pre>
<p>ç¼–è¾‘ workersæ·»åŠ å†…å®¹</p>
<pre><code class="hljs language-js" lang="js">hadoop102
hadoop103
hadoop104

æ³¨æ„ï¼šè¯¥æ–‡ä»¶ä¸­æ·»åŠ çš„å†…å®¹ç»“å°¾ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œæ–‡ä»¶ä¸­ä¸å…è®¸æœ‰ç©ºè¡Œ
</code></pre>
<h2 data-id="heading-4">5.ç¼–å†™hadoopé›†ç¾¤ç®¡ç†è„šæœ¬</h2>
<pre><code class="hljs language-js" lang="js">#!<span class="hljs-regexp">/bin/</span>bash

<span class="hljs-keyword">if</span> [ $# -lt <span class="hljs-number">1</span> ]; then
    echo <span class="hljs-string">"No Args Input..."</span>
    exit
fi

<span class="hljs-keyword">case</span> $1 <span class="hljs-keyword">in</span>
    <span class="hljs-string">"start"</span>)
        echo <span class="hljs-string">" =================== å¯åŠ¨ hadoop é›†ç¾¤ ==================="</span>
        echo <span class="hljs-string">" --------------- å¯åŠ¨ hdfs ---------------"</span>
        ssh hadoop102 <span class="hljs-string">"/opt/module/hadoop-3.1.3/sbin/start-dfs.sh"</span>
        echo <span class="hljs-string">" --------------- å¯åŠ¨ yarn ---------------"</span>
        ssh hadoop103 <span class="hljs-string">"/opt/module/hadoop-3.1.3/sbin/start-yarn.sh"</span>
        echo <span class="hljs-string">" --------------- å¯åŠ¨ historyserver ---------------"</span>
        ssh hadoop102 <span class="hljs-string">"/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver"</span>
        ;;
    <span class="hljs-string">"stop"</span>)
        echo <span class="hljs-string">" =================== å…³é—­ hadoop é›†ç¾¤ ==================="</span>
        echo <span class="hljs-string">" --------------- å…³é—­ historyserver ---------------"</span>
        ssh hadoop102 <span class="hljs-string">"/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver"</span>
        echo <span class="hljs-string">" --------------- å…³é—­ yarn ---------------"</span>
        ssh hadoop103 <span class="hljs-string">"/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh"</span>
        echo <span class="hljs-string">" --------------- å…³é—­ hdfs ---------------"</span>
        ssh hadoop102 <span class="hljs-string">"/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh"</span>
        ;;
    *)
        echo <span class="hljs-string">"Input Args Error..."</span>
        ;;
esac
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Promise ï¼šä»åŸºç¡€åŸç†åˆ°é«˜çº§å®è·µ]]></title>    <link>https://juejin.cn/post/7585686247269515273</link>    <guid>https://juejin.cn/post/7585686247269515273</guid>    <pubDate>2025-12-20T08:35:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585686247269515273" data-draft-id="7585463195201388594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Promise ï¼šä»åŸºç¡€åŸç†åˆ°é«˜çº§å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T08:35:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·5427784851540"/> <meta itemprop="url" content="https://juejin.cn/user/224762173330942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Promise ï¼šä»åŸºç¡€åŸç†åˆ°é«˜çº§å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/224762173330942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·5427784851540
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T08:35:42.000Z" title="Sat Dec 20 2025 08:35:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>Promise</code> æ˜¯ JavaScript ä¸­å¤„ç†å¼‚æ­¥æ“ä½œçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒè§£å†³äº†ä¼ ç»Ÿå›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰å¸¦æ¥çš„â€œå›è°ƒåœ°ç‹±â€ï¼ˆCallback Hellï¼‰é—®é¢˜ï¼Œä½¿å¼‚æ­¥ä»£ç æ›´æ¸…æ™°ã€å¯è¯»ã€å¯ç»´æŠ¤ã€‚è‡ª ES6ï¼ˆECMAScript 2015ï¼‰æ­£å¼å¼•å…¥ä»¥æ¥ï¼ŒPromise å·²æˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„åŸºçŸ³ï¼Œå¹¶ä¸º <code>async/await</code> è¯­æ³•æä¾›äº†åº•å±‚æ”¯æŒã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ Promiseï¼Ÿ</h2>
<h3 data-id="heading-1">1.1 å›è°ƒå‡½æ•°çš„å±€é™æ€§</h3>
<p>åœ¨ Promise å‡ºç°ä¹‹å‰ï¼Œå¼‚æ­¥æ“ä½œä¸»è¦é€šè¿‡å›è°ƒå‡½æ•°å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åµŒå¥—å›è°ƒï¼ˆå›è°ƒåœ°ç‹±ï¼‰</span>
<span class="hljs-title function_">getData</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-title function_">getMoreData</span>(a, <span class="hljs-keyword">function</span>(<span class="hljs-params">b</span>) {
    <span class="hljs-title function_">getEvenMoreData</span>(b, <span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c);
    });
  });
});
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä»£ç æ¨ªå‘æ‰©å±•ï¼Œéš¾ä»¥é˜…è¯»å’Œç»´æŠ¤</li>
<li>é”™è¯¯å¤„ç†åˆ†æ•£ï¼Œéœ€åœ¨æ¯ä¸ªå›è°ƒä¸­é‡å¤å†™ <code>try/catch</code></li>
<li>æ— æ³•ä½¿ç”¨ <code>return</code> æˆ– <code>throw</code> æ§åˆ¶æµç¨‹</li>
<li>å¤šä¸ªå¼‚æ­¥æ“ä½œçš„ç»„åˆï¼ˆå¦‚å¹¶è¡Œã€ç«æ€ï¼‰å®ç°å¤æ‚</li>
</ul>
<h3 data-id="heading-2">1.2 Promise çš„ä¼˜åŠ¿</h3>
<ul>
<li><strong>é“¾å¼è°ƒç”¨</strong>ï¼šé€šè¿‡ <code>.then()</code> å®ç°çº¿æ€§æµç¨‹</li>
<li><strong>ç»Ÿä¸€é”™è¯¯å¤„ç†</strong>ï¼šé€šè¿‡ <code>.catch()</code> æ•è·æ•´ä¸ªé“¾ä¸­çš„é”™è¯¯</li>
<li><strong>ç»„åˆèƒ½åŠ›</strong>ï¼šæ”¯æŒ <code>Promise.all</code>ã€<code>Promise.race</code> ç­‰é«˜çº§æ¨¡å¼</li>
<li><strong>ä¸ async/await æ— ç¼é›†æˆ</strong></li>
</ul>
<hr/>
<h2 data-id="heading-3">äºŒã€Promise åŸºç¡€æ¦‚å¿µ</h2>
<h3 data-id="heading-4">2.1 ä»€ä¹ˆæ˜¯ Promiseï¼Ÿ</h3>
<blockquote>
<p><strong>Promise æ˜¯ä¸€ä¸ªè¡¨ç¤ºå¼‚æ­¥æ“ä½œæœ€ç»ˆå®Œæˆæˆ–å¤±è´¥çš„å¯¹è±¡ã€‚</strong></p>
</blockquote>
<p>å®ƒæœ‰ä¸‰ç§çŠ¶æ€ï¼ˆStateï¼‰ï¼š</p>
<ul>
<li><strong>pendingï¼ˆå¾…å®šï¼‰</strong> ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸä¹Ÿä¸æ˜¯å¤±è´¥</li>
<li><strong>fulfilledï¼ˆå·²æˆåŠŸï¼‰</strong> ï¼šæ“ä½œæˆåŠŸå®Œæˆ</li>
<li><strong>rejectedï¼ˆå·²å¤±è´¥ï¼‰</strong> ï¼šæ“ä½œå¤±è´¥</li>
</ul>
<blockquote>
<p>âš ï¸ <strong>çŠ¶æ€ä¸å¯é€†</strong>ï¼š<br/>
ä¸€æ—¦ Promise ä» <code>pending</code> å˜ä¸º <code>fulfilled</code> æˆ– <code>rejected</code>ï¼ŒçŠ¶æ€å°†<strong>æ°¸ä¹…å›ºå®š</strong>ï¼Œä¸èƒ½å†æ”¹å˜ã€‚</p>
</blockquote>
<h3 data-id="heading-5">2.2 åˆ›å»º Promise</h3>
<p>ä½¿ç”¨ <code>new Promise(executor)</code> æ„é€ å‡½æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// å¼‚æ­¥æ“ä½œ</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> success = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (success) {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'æ“ä½œæˆåŠŸï¼'</span>); <span class="hljs-comment">// å°†çŠ¶æ€å˜ä¸º fulfilled</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ“ä½œå¤±è´¥ï¼'</span>)); <span class="hljs-comment">// å°†çŠ¶æ€å˜ä¸º rejected</span>
    }
  }, <span class="hljs-number">1000</span>);
});
</code></pre>
<ul>
<li><code>resolve(value)</code>ï¼šæ ‡è®° Promise æˆåŠŸï¼Œä¼ é€’ç»“æœå€¼</li>
<li><code>reject(reason)</code>ï¼šæ ‡è®° Promise å¤±è´¥ï¼Œä¼ é€’é”™è¯¯åŸå› ï¼ˆé€šå¸¸ä¸º Error å¯¹è±¡ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€Promise çš„åŸºæœ¬ç”¨æ³•</h2>
<h3 data-id="heading-7">3.1 é“¾å¼è°ƒç”¨ï¼ˆChainingï¼‰</h3>
<p>é€šè¿‡ <code>.then(onFulfilled, onRejected)</code> å¤„ç†ç»“æœï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">promise
  .<span class="hljs-title function_">then</span>(
    <span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æˆåŠŸ:'</span>, result); <span class="hljs-comment">// 'æ“ä½œæˆåŠŸï¼'</span>
      <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">toUpperCase</span>(); <span class="hljs-comment">// è¿”å›æ–°å€¼ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ª then</span>
    },
    <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å¤±è´¥:'</span>, error); <span class="hljs-comment">// ä¸ä¼šæ‰§è¡Œï¼ˆé™¤éä¸Šä¸€æ­¥ rejectï¼‰</span>
    }
  )
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">transformedResult</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è½¬æ¢å:'</span>, transformedResult); <span class="hljs-comment">// 'æ“ä½œæˆåŠŸï¼'</span>
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-comment">// æ•è·é“¾ä¸­ä»»ä½•æœªå¤„ç†çš„ reject</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ•è·é”™è¯¯:'</span>, error);
  });
</code></pre>
<blockquote>
<p>âœ… <strong>å…³é”®è§„åˆ™</strong>ï¼š</p>
<ul>
<li><code>.then()</code> æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ Promise</li>
<li>è‹¥ <code>onFulfilled</code> è¿”å›æ™®é€šå€¼ â†’ æ–° Promise çŠ¶æ€ä¸º <code>fulfilled</code></li>
<li>è‹¥ <code>onFulfilled</code> æŠ›å‡ºå¼‚å¸¸ â†’ æ–° Promise çŠ¶æ€ä¸º <code>rejected</code></li>
<li>è‹¥ <code>onFulfilled</code> è¿”å›å¦ä¸€ä¸ª Promise â†’ æ–° Promise è·Ÿéšè¯¥ Promise çš„çŠ¶æ€</li>
</ul>
</blockquote>
<h3 data-id="heading-8">3.2 é”™è¯¯å¤„ç†ï¼š<code>.catch()</code></h3>
<p><code>.catch(onRejected)</code> æ˜¯ <code>.then(null, onRejected)</code> çš„è¯­æ³•ç³–ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">fetchUserData()
  .then(<span class="hljs-attr">user</span> =&gt; processUser(user))
  .then(<span class="hljs-attr">data</span> =&gt; saveToCache(data))
  .catch(<span class="hljs-attr">error</span> =&gt; {
    // æ•è· fetchUserDataã€processUser æˆ– saveToCache ä¸­çš„ä»»ä½•é”™è¯¯
    console.error('æ“ä½œå¤±è´¥:', error.message)<span class="hljs-comment">;</span>
    showErrorMessage()<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>ğŸ“Œ <strong>æœ€ä½³å®è·µ</strong>ï¼š<br/>
åœ¨é“¾çš„æœ«å°¾ä½¿ç”¨ <code>.catch()</code> ç»Ÿä¸€å¤„ç†é”™è¯¯ï¼Œé¿å…åœ¨æ¯ä¸ª <code>.then()</code> ä¸­å†™é”™è¯¯å›è°ƒã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">å››ã€Promise çš„é«˜çº§ç‰¹æ€§</h2>
<h3 data-id="heading-10">4.1 é™æ€æ–¹æ³•</h3>
<h4 data-id="heading-11"><code>Promise.resolve(value)</code></h4>
<p>å°†å€¼è½¬ä¸ºå·²æˆåŠŸçš„ Promiseï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">42</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)); <span class="hljs-comment">// 42</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'hello'</span>)).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)); <span class="hljs-comment">// 'hello'</span>
</code></pre>
<h4 data-id="heading-12"><code>Promise.reject(reason)</code></h4>
<p>åˆ›å»ºä¸€ä¸ªå·²å¤±è´¥çš„ Promiseï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Oops!'</span>)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e.<span class="hljs-property">message</span>));
</code></pre>
<h4 data-id="heading-13"><code>Promise.all(iterable)</code></h4>
<p><strong>å¹¶è¡Œæ‰§è¡Œå¤šä¸ª Promiseï¼Œå…¨éƒ¨æˆåŠŸæ‰æˆåŠŸ</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">promises</span> = [
  fetch(<span class="hljs-string">'/api/users'</span>),
  fetch(<span class="hljs-string">'/api/posts'</span>),
  fetch(<span class="hljs-string">'/api/comments'</span>)
]<span class="hljs-comment">;</span>

Promise.all(promises)
  .then(<span class="hljs-attr">results</span> =&gt; {
    const <span class="hljs-section">[users, posts, comments]</span> = results<span class="hljs-comment">;</span>
    renderPage(users, posts, comments)<span class="hljs-comment">;</span>
  })
  .catch(<span class="hljs-attr">error</span> =&gt; {
    // ä»»ä¸€è¯·æ±‚å¤±è´¥ï¼Œç«‹å³ reject
    console.error('åŠ è½½å¤±è´¥:', error)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šè‹¥ä»»ä¸€ Promise rejectï¼Œ<code>all</code> ç«‹å³ rejectï¼Œå…¶ä½™ Promise ä»ä¼šæ‰§è¡Œä½†ç»“æœè¢«å¿½ç•¥ã€‚</p>
</blockquote>
<h4 data-id="heading-14"><code>Promise.allSettled(iterable)</code></h4>
<p>ç­‰å¾…æ‰€æœ‰ Promise å®Œæˆï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(promises)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
    results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result, i</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (result.<span class="hljs-property">status</span> === <span class="hljs-string">'fulfilled'</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è¯·æ±‚ <span class="hljs-subst">${i}</span> æˆåŠŸ:`</span>, result.<span class="hljs-property">value</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`è¯·æ±‚ <span class="hljs-subst">${i}</span> å¤±è´¥:`</span>, result.<span class="hljs-property">reason</span>);
      }
    });
  });
</code></pre>
<h4 data-id="heading-15"><code>Promise.race(iterable)</code></h4>
<p><strong>è¿”å›ç¬¬ä¸€ä¸ªå®Œæˆçš„ Promiseï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> timeout = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¶…æ—¶'</span>)), <span class="hljs-number">5000</span>)
);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>), timeout])
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•°æ®:'</span>, data))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å¤±è´¥æˆ–è¶…æ—¶:'</span>, error));
</code></pre>
<h4 data-id="heading-16"><code>Promise.any(iterable)</code>ï¼ˆES2021ï¼‰</h4>
<p>è¿”å›ç¬¬ä¸€ä¸ª<strong>æˆåŠŸ</strong>çš„ Promiseï¼ˆå¿½ç•¥å¤±è´¥ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>([
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'A å¤±è´¥'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'B æˆåŠŸ'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'C å¤±è´¥'</span>)
]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value)); <span class="hljs-comment">// 'B æˆåŠŸ'</span>
</code></pre>
<blockquote>
<p>â— è‹¥å…¨éƒ¨å¤±è´¥ï¼Œåˆ™ reject ä¸€ä¸ª <code>AggregateError</code>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-17">äº”ã€Promise ä¸ async/await</h2>
<p><code>async/await</code> æ˜¯ Promise çš„è¯­æ³•ç³–ï¼Œä½¿å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ã€‚</p>
<h3 data-id="heading-18">5.1 åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>);
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-keyword">return</span> data;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é”™è¯¯:'</span>, error);
    <span class="hljs-keyword">throw</span> error; <span class="hljs-comment">// å¯é€‰æ‹©é‡æ–°æŠ›å‡º</span>
  }
}

<span class="hljs-comment">// è°ƒç”¨</span>
<span class="hljs-title function_">fetchData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));
</code></pre>
<h3 data-id="heading-19">5.2 å…³é”®è§„åˆ™</h3>
<ul>
<li><code>async</code> å‡½æ•°<strong>æ€»æ˜¯è¿”å› Promise</strong></li>
<li><code>await</code> åªèƒ½åœ¨ <code>async</code> å‡½æ•°å†…ä½¿ç”¨</li>
<li><code>await</code> åå¯è·Ÿ Promise æˆ–æ™®é€šå€¼</li>
<li>é”™è¯¯å¯é€šè¿‡ <code>try/catch</code> æ•è·</li>
</ul>
<h3 data-id="heading-20">5.3 å¹¶è¡Œ vs ä¸²è¡Œ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ ä¸²è¡Œï¼ˆæ…¢ï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">slow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/a'</span>);
  <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/b'</span>);
  <span class="hljs-keyword">const</span> c = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/c'</span>);
}

<span class="hljs-comment">// âœ… å¹¶è¡Œï¼ˆå¿«ï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fast</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [a, b, c] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/a'</span>),
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/b'</span>),
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/c'</span>)
  ]);
}
</code></pre>
<hr/>
<h2 data-id="heading-21">å…­ã€å¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-22">6.1 é™·é˜± 1ï¼šå¿˜è®°è¿”å› Promise</h3>
<pre><code class="hljs language-ini" lang="ini">// âŒ é”™è¯¯ï¼šç¬¬äºŒä¸ª then æ— æ³•è·å–æ•°æ®
fetch('/api')
  .then(<span class="hljs-attr">res</span> =&gt; res.json())
  .then(<span class="hljs-attr">data</span> =&gt; {
    processData(data)<span class="hljs-comment">; // å¿˜è®° return</span>
  })
  .then(<span class="hljs-attr">result</span> =&gt; {
    console.log(result)<span class="hljs-comment">; // undefined!</span>
  })<span class="hljs-comment">;</span>

// âœ… æ­£ç¡®
fetch('/api')
  .then(<span class="hljs-attr">res</span> =&gt; res.json())
  .then(<span class="hljs-attr">data</span> =&gt; {
    return processData(data)<span class="hljs-comment">; // æ˜¾å¼ return</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-23">6.2 é™·é˜± 2ï¼šæœªå¤„ç†æ‹’ç»ï¼ˆUncaught Rejectionï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ å±é™©ï¼šå¯èƒ½è¢«å¿½ç•¥ï¼Œå¯¼è‡´é™é»˜å¤±è´¥</span>
somePromise.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-comment">// ...</span>
});

<span class="hljs-comment">// âœ… å®‰å…¨ï¼šå§‹ç»ˆå¤„ç†é”™è¯¯</span>
somePromise
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> { <span class="hljs-comment">/* ... */</span> })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> { <span class="hljs-comment">/* å¤„ç†é”™è¯¯ */</span> });
</code></pre>
<blockquote>
<p>ğŸ”” <strong>Node.js æç¤º</strong>ï¼šæœªå¤„ç†çš„ Promise rejection ä¼šå¯¼è‡´è¿›ç¨‹è­¦å‘Šï¼ˆæœªæ¥å¯èƒ½ç»ˆæ­¢è¿›ç¨‹ï¼‰ã€‚</p>
</blockquote>
<h3 data-id="heading-24">6.3 é™·é˜± 3ï¼šåœ¨å¾ªç¯ä¸­ä½¿ç”¨ awaitï¼ˆä¸²è¡Œè€Œéå¹¶è¡Œï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">// âŒ ä¸²è¡Œæ‰§è¡Œï¼ˆæ€»è€—æ—¶ = æ‰€æœ‰è¯·æ±‚æ—¶é—´ä¹‹å’Œï¼‰
for (const url of urls) {
  const <span class="hljs-attr">data</span> = await fetch(url)<span class="hljs-comment">;</span>
  results.push(data)<span class="hljs-comment">;</span>
}

// âœ… å¹¶è¡Œæ‰§è¡Œï¼ˆæ€»è€—æ—¶ â‰ˆ æœ€é•¿è¯·æ±‚æ—¶é—´ï¼‰
const <span class="hljs-attr">promises</span> = urls.map(url =&gt; fetch(url))<span class="hljs-comment">;</span>
const <span class="hljs-attr">results</span> = await Promise.all(promises)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-25">6.4 æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>å§‹ç»ˆå¤„ç†é”™è¯¯</strong>ï¼šä½¿ç”¨ <code>.catch()</code> æˆ– <code>try/catch</code></li>
<li><strong>é¿å…åµŒå¥— Promise</strong>ï¼šä½¿ç”¨é“¾å¼è°ƒç”¨æˆ– async/await</li>
<li><strong>æ˜ç¡®è¿”å›å€¼</strong>ï¼šåœ¨ <code>.then()</code> ä¸­æ˜¾å¼ <code>return</code></li>
<li><strong>åˆç†ä½¿ç”¨ç»„åˆæ–¹æ³•</strong>ï¼š<code>all</code>ã€<code>race</code>ã€<code>allSettled</code></li>
<li><strong>ä¸è¦æ··åˆå›è°ƒä¸ Promise</strong>ï¼šç»Ÿä¸€å¼‚æ­¥é£æ ¼</li>
</ol>
<hr/>
<h2 data-id="heading-26">ä¸ƒã€Promise çš„å†…éƒ¨åŸç†ï¼ˆç®€è¦ï¼‰</h2>
<p>è™½ç„¶å¼€å‘è€…é€šå¸¸æ— éœ€å®ç° Promiseï¼Œä½†ç†è§£å…¶æœºåˆ¶æœ‰åŠ©äºè°ƒè¯•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æç®€ Promise å®ç°ï¼ˆä»…æ¼”ç¤ºæ€è·¯ï¼‰
class SimplePromise {
  constructor(executor) {
    <span class="hljs-attr">this.state</span> = <span class="hljs-string">'pending'</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">this.value</span> = undefined<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.callbacks</span> = []<span class="hljs-comment">;</span>

    const <span class="hljs-attr">resolve</span> = value =&gt; {
      if (this.state !== 'pending') return<span class="hljs-comment">;</span>
      <span class="hljs-attr">this.state</span> = <span class="hljs-string">'fulfilled'</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">this.value</span> = value<span class="hljs-comment">;</span>
      this.callbacks.forEach(<span class="hljs-attr">cb</span> =&gt; cb())<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>

    const <span class="hljs-attr">reject</span> = reason =&gt; {
      if (this.state !== 'pending') return<span class="hljs-comment">;</span>
      <span class="hljs-attr">this.state</span> = <span class="hljs-string">'rejected'</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">this.value</span> = reason<span class="hljs-comment">;</span>
      this.callbacks.forEach(<span class="hljs-attr">cb</span> =&gt; cb())<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>

    executor(resolve, reject)<span class="hljs-comment">;</span>
  }

  then(onFulfilled) {
    return new SimplePromise((resolve) =&gt; {
      const <span class="hljs-attr">callback</span> = () =&gt; {
        if (<span class="hljs-attr">this.state</span> === <span class="hljs-string">'fulfilled'</span>) {
          const <span class="hljs-attr">result</span> = <span class="hljs-literal">on</span>Fulfilled(this.value)<span class="hljs-comment">;</span>
          resolve(result)<span class="hljs-comment">;</span>
        }
      }<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">this.state</span> === <span class="hljs-string">'pending'</span>) {
        this.callbacks.push(callback)<span class="hljs-comment">;</span>
      } else {
        callback()<span class="hljs-comment">;</span>
      }
    })<span class="hljs-comment">;</span>
  }
}
</code></pre>
<blockquote>
<p>ğŸ“š <strong>çœŸå® Promise æ›´å¤æ‚</strong>ï¼šéœ€å¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicrotask Queueï¼‰ã€thenable å¯¹è±¡ã€é€’å½’è§£æç­‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-27">å…«ã€åœ¨ Vue 3 ä¸­çš„å®è·µ</h2>
<p>Vue 3 çš„ç»„åˆå¼ API ä¸ Promise å¤©ç„¶å¥‘åˆï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// composables/useApi.js
import { ref } from 'vue'<span class="hljs-comment">;</span>

export function useApi(url) {
  const <span class="hljs-attr">data</span> = ref(null)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">loading</span> = ref(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">error</span> = ref(null)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">execute</span> = async () =&gt; {
    <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">error.value</span> = null<span class="hljs-comment">;</span>
    try {
      const <span class="hljs-attr">res</span> = await fetch(url)<span class="hljs-comment">;</span>
      if (!res.ok) throw new Error(res.statusText)<span class="hljs-comment">;</span>
      <span class="hljs-attr">data.value</span> = await res.json()<span class="hljs-comment">;</span>
    } catch (err) {
      <span class="hljs-attr">error.value</span> = err<span class="hljs-comment">;</span>
    } finally {
      <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>

  return { data, loading, error, execute }<span class="hljs-comment">;</span>
}
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/useApi'</span>;

<span class="hljs-keyword">const</span> { data, loading, error, execute } = <span class="hljs-title function_">useApi</span>(<span class="hljs-string">'/api/users'</span>);
<span class="hljs-title function_">execute</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"error"</span>&gt;</span>é”™è¯¯: {{ error.message }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">v-else</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"user in data"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"user.id"</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<blockquote>
<p>âœ… <strong>ä¼˜åŠ¿</strong>ï¼šé€»è¾‘å¤ç”¨ã€çŠ¶æ€ç®¡ç†ã€é”™è¯¯å¤„ç†ä¸€ä½“åŒ–ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-28">ç»“è¯­</h2>
<p>Promise æ˜¯ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„é‡Œç¨‹ç¢‘ï¼Œå®ƒä¸ä»…è§£å†³äº†å›è°ƒåœ°ç‹±é—®é¢˜ï¼Œè¿˜ä¸ºç°ä»£å¼‚æ­¥è¯­æ³•ï¼ˆasync/awaitï¼‰å¥ å®šäº†åŸºç¡€ã€‚æŒæ¡ Promise çš„æ ¸å¿ƒæ¦‚å¿µã€é“¾å¼è°ƒç”¨ã€é”™è¯¯å¤„ç†å’Œç»„åˆæ–¹æ³•ï¼Œæ˜¯æˆä¸ºé«˜æ•ˆå‰ç«¯å¼€å‘è€…çš„å¿…ç»ä¹‹è·¯ã€‚</p>
<p>è®°ä½ï¼š</p>
<ul>
<li><strong>Promise æ˜¯çŠ¶æ€æœº</strong>ï¼špending â†’ fulfilled/rejected</li>
<li><strong>é“¾å¼è°ƒç”¨æ˜¯æ ¸å¿ƒ</strong>ï¼šæ¯ä¸ª <code>.then()</code> è¿”å›æ–° Promise</li>
<li><strong>é”™è¯¯å¿…é¡»å¤„ç†</strong>ï¼šé¿å…é™é»˜å¤±è´¥</li>
<li><strong>ç»„åˆä¼˜äºåµŒå¥—</strong>ï¼šå–„ç”¨ <code>Promise.all</code> ç­‰é™æ€æ–¹æ³•</li>
</ul>
<p>éšç€ Web åº”ç”¨æ—¥ç›Šå¤æ‚ï¼Œå¼‚æ­¥æ“ä½œæ— å¤„ä¸åœ¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>