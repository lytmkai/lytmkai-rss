<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[C#.NET Record Struct 完全解析：语法、语义与最佳实践]]></title>    <link>https://juejin.cn/post/7577971299743907878</link>    <guid>https://juejin.cn/post/7577971299743907878</guid>    <pubDate>2025-12-01T00:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743907878" data-draft-id="7577914902431662126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET Record Struct 完全解析：语法、语义与最佳实践"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-01T00:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET Record Struct 完全解析：语法、语义与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:05:41.000Z" title="Mon Dec 01 2025 00:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>Record Structs</code> 是一种值类型的记录（<code>record</code>），结合了 <code>struct</code> 的值语义和 <code>record</code> 的功能（如自动生成相等性比较、不可变性支持）。它们是 <code>C# 9.0</code> 中引入的引用类型 <code>record</code>（默认 <code>class</code>）的扩展，专为性能敏感场景设计，特别是在需要栈分配或避免 <code>GC</code> 压力的情况下。</p>
<h4 data-id="heading-1">核心特性</h4>
<ul>
<li>
<p>值类型：存储在栈上（除非装箱），避免堆分配，适合小数据结构。</p>
</li>
<li>
<p>不可变性：默认鼓励不可变设计（通过 <code>init-only</code> 属性），但可选择可变。</p>
</li>
<li>
<p>值相等性：自动实现基于内容的相等性比较（== 和 <code>Equals</code>）。</p>
</li>
<li>
<p>自动 <code>ToString</code>：生成人类可读的字符串表示。</p>
</li>
<li>
<p>解构支持：自动提供 <code>Deconstruct</code> 方法，方便模式匹配和解构。</p>
</li>
<li>
<p><code>With</code> 表达式：支持非破坏性变异（创建新实例）。</p>
</li>
<li>
<p>继承支持：支持继承其他 <code>record structs</code>（但不能继承 <code>class</code> 或 <code>record class</code>）。</p>
</li>
</ul>
<h3 data-id="heading-2">基本语法</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 最简单的记录结构声明</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 等价于传统的结构体声明（但功能更强大）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Point
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Y { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y</span>)</span>
    {
        X = x;
        Y = y;
    }
    
    <span class="hljs-comment">// 自动生成的 Equals、GetHashCode、ToString 等方法</span>
}
</code></pre>
<h4 data-id="heading-3">可变性控制</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不可变记录结构 (推荐)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">ImmutablePoint</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 可变记录结构</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">struct</span> <span class="hljs-title">MutablePoint</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Y { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-comment">// 混合可变性</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">MixedPoint</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>) <span class="hljs-comment">// X 和 Y 默认只读</span></span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Z { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// 额外的可变属性</span>
}
</code></pre>
<h3 data-id="heading-4">记录结构 vs 记录类 vs 普通结构体</h3>





















































<table><thead><tr><th>特性</th><th>记录结构 (record struct)</th><th>记录类 (record class)</th><th>普通结构体 (struct)</th></tr></thead><tbody><tr><td>类型</td><td>值类型</td><td>引用类型</td><td>值类型</td></tr><tr><td>分配位置</td><td>栈（通常）</td><td>堆</td><td>栈（通常）</td></tr><tr><td>默认不可变</td><td>是（属性为 <code>init</code>）</td><td>是（属性为 <code>init</code>）</td><td>否（可变）</td></tr><tr><td>值相等性</td><td>自动实现</td><td>自动实现</td><td>需手动实现</td></tr><tr><td><code>with</code> 表达式</td><td>支持</td><td>支持</td><td>不支持</td></tr><tr><td>解构</td><td>自动支持</td><td>自动支持</td><td>需手动实现</td></tr><tr><td>继承</td><td>不支持</td><td>支持</td><td>不支持</td></tr></tbody></table>
<h3 data-id="heading-5">记录结构的核心特性</h3>
<h4 data-id="heading-6">位置记录结构（Positional Record Structs）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 位置记录结构 - 最简洁的形式</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> FirstName, <span class="hljs-built_in">string</span> LastName, <span class="hljs-built_in">int</span> Age</span>)</span>;

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>, <span class="hljs-number">30</span>);
Console.WriteLine(person); <span class="hljs-comment">// 输出: Person { FirstName = John, LastName = Doe, Age = 30 }</span>

<span class="hljs-comment">// 解构</span>
<span class="hljs-keyword">var</span> (firstName, lastName, age) = person;
Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{firstName}</span> <span class="hljs-subst">{lastName}</span>, <span class="hljs-subst">{age}</span>岁"</span>);
</code></pre>
<h4 data-id="heading-7">值相等性（Value Equality）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 值相等性比较</span>
<span class="hljs-keyword">var</span> point1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> point2 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> point3 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);

Console.WriteLine(point1 == point2); <span class="hljs-comment">// True - 基于值比较</span>
Console.WriteLine(point1 == point3); <span class="hljs-comment">// False</span>
Console.WriteLine(point1.Equals(point2)); <span class="hljs-comment">// True</span>
</code></pre>
<h4 data-id="heading-8">with 表达式（非破坏性变更）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> FirstName, <span class="hljs-built_in">string</span> LastName, <span class="hljs-built_in">int</span> Age</span>)</span>;

<span class="hljs-keyword">var</span> original = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>, <span class="hljs-number">30</span>);

<span class="hljs-comment">// 创建修改后的副本（非破坏性变更）</span>
<span class="hljs-keyword">var</span> updated = original <span class="hljs-keyword">with</span> { Age = <span class="hljs-number">31</span> };
<span class="hljs-keyword">var</span> renamed = original <span class="hljs-keyword">with</span> { FirstName = <span class="hljs-string">"Jane"</span> };

Console.WriteLine(original); <span class="hljs-comment">// Person { FirstName = John, LastName = Doe, Age = 30 }</span>
Console.WriteLine(updated);  <span class="hljs-comment">// Person { FirstName = John, LastName = Doe, Age = 31 }</span>
Console.WriteLine(renamed);  <span class="hljs-comment">// Person { FirstName = Jane, LastName = Doe, Age = 30 }</span>
</code></pre>
<h4 data-id="heading-9">自定义行为</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 自定义记录结构</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> FirstName, <span class="hljs-built_in">string</span> LastName</span>)</span>
{
    <span class="hljs-comment">// 添加计算属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> FullName =&gt; <span class="hljs-string">$"<span class="hljs-subst">{FirstName}</span> <span class="hljs-subst">{LastName}</span>"</span>;
    
    <span class="hljs-comment">// 添加方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetFormattedName</span>()</span> =&gt; <span class="hljs-string">$"<span class="hljs-subst">{LastName}</span>, <span class="hljs-subst">{FirstName}</span>"</span>;
    
    <span class="hljs-comment">// 重写ToString</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>()</span> =&gt; FullName;
    
    <span class="hljs-comment">// 自定义相等性逻辑（可选）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Person other</span>)</span> =&gt; 
        FirstName == other.FirstName &amp;&amp; LastName == other.LastName;
    
    <span class="hljs-comment">// 自定义GetHashCode（可选）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetHashCode</span>()</span> =&gt; 
        HashCode.Combine(FirstName, LastName);
}

<span class="hljs-comment">// 使用自定义记录结构</span>
<span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>);
Console.WriteLine(person.FullName); <span class="hljs-comment">// John Doe</span>
Console.WriteLine(person.GetFormattedName()); <span class="hljs-comment">// Doe, John</span>
Console.WriteLine(person); <span class="hljs-comment">// John Doe</span>
</code></pre>
<h3 data-id="heading-10">高级用法和模式</h3>
<h4 data-id="heading-11">与模式匹配结合</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 在模式匹配中使用记录结构</span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">ClassifyPoint</span>(<span class="hljs-params">Point point</span>)</span> =&gt; point <span class="hljs-keyword">switch</span>
{
    (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-string">"原点"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x == y =&gt; <span class="hljs-string">"在y=x线上"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第一象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &lt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第二象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &lt; <span class="hljs-number">0</span> &amp;&amp; y &lt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第三象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &lt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第四象限"</span>,
    _ =&gt; <span class="hljs-string">"在坐标轴上"</span>
};

<span class="hljs-comment">// 使用示例</span>
Console.WriteLine(ClassifyPoint(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))); <span class="hljs-comment">// 原点</span>
Console.WriteLine(ClassifyPoint(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))); <span class="hljs-comment">// 在y=x线上</span>
Console.WriteLine(ClassifyPoint(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>))); <span class="hljs-comment">// 第一象限</span>
</code></pre>
<h4 data-id="heading-12">实现接口</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Vector2D</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> X, <span class="hljs-built_in">double</span> Y</span>) : IFormattable</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Magnitude =&gt; Math.Sqrt(X * X + Y * Y);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> format, IFormatProvider formatProvider</span>)</span>
    {
        <span class="hljs-keyword">return</span> format?.ToUpper() <span class="hljs-keyword">switch</span>
        {
            <span class="hljs-string">"M"</span> =&gt; <span class="hljs-string">$"(<span class="hljs-subst">{X}</span>, <span class="hljs-subst">{Y}</span>) with magnitude <span class="hljs-subst">{Magnitude:F2}</span>"</span>,
            _ =&gt; <span class="hljs-string">$"(<span class="hljs-subst">{X}</span>, <span class="hljs-subst">{Y}</span>)"</span>
        };
    }
}

<span class="hljs-comment">// 使用接口实现</span>
<span class="hljs-keyword">var</span> vector = <span class="hljs-keyword">new</span> Vector2D(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
Console.WriteLine(vector.ToString(<span class="hljs-string">"M"</span>, CultureInfo.InvariantCulture));
<span class="hljs-comment">// 输出: (3, 4) with magnitude 5.00</span>
</code></pre>
<h4 data-id="heading-13">集合中使用 Record Structs</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 高性能点集处理</span>
<span class="hljs-keyword">var</span> points = <span class="hljs-keyword">new</span> Point[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">var</span> sum = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; points.Length; i++)
{
    points[i] = <span class="hljs-keyword">new</span> Point(i, i * <span class="hljs-number">2</span>);
    sum = sum <span class="hljs-keyword">with</span> 
    { 
        X = sum.X + points[i].X, 
        Y = sum.Y + points[i].Y 
    };
}
</code></pre>
<h4 data-id="heading-14">与 Span 和 Memory 结合</h4>
<pre><code class="hljs language-csharp" lang="csharp">Span&lt;Point&gt; points = <span class="hljs-keyword">stackalloc</span> Point[<span class="hljs-number">4</span>];
points[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
points[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
points[<span class="hljs-number">2</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
points[<span class="hljs-number">3</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 高性能几何计算</span>
<span class="hljs-built_in">double</span> area = CalculatePolygonArea(points);
</code></pre>
<h3 data-id="heading-15">实际应用场景</h3>
<h4 data-id="heading-16">数学和几何计算</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Rectangle</span>(<span class="hljs-params">Point TopLeft, Point BottomRight</span>)</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Width =&gt; BottomRight.X - TopLeft.X;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Height =&gt; BottomRight.Y - TopLeft.Y;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Area =&gt; Width * Height;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Contains</span>(<span class="hljs-params">Point point</span>)</span> =&gt;
        point.X &gt;= TopLeft.X &amp;&amp; point.X &lt;= BottomRight.X &amp;&amp;
        point.Y &gt;= TopLeft.Y &amp;&amp; point.Y &lt;= BottomRight.Y;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> Rectangle <span class="hljs-title">Inflate</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> delta</span>)</span> =&gt;
        <span class="hljs-keyword">this</span> <span class="hljs-keyword">with</span> 
        { 
            TopLeft = <span class="hljs-keyword">new</span> Point(TopLeft.X - delta, TopLeft.Y - delta),
            BottomRight = <span class="hljs-keyword">new</span> Point(BottomRight.X + delta, BottomRight.Y + delta)
        };
}

<span class="hljs-comment">// 使用几何记录结构</span>
<span class="hljs-keyword">var</span> rect = <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-keyword">new</span> Point(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>));
Console.WriteLine(<span class="hljs-string">$"面积: <span class="hljs-subst">{rect.Area}</span>"</span>); <span class="hljs-comment">// 面积: 100</span>
Console.WriteLine(<span class="hljs-string">$"包含点 (5,5): <span class="hljs-subst">{rect.Contains(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>))}</span>"</span>); <span class="hljs-comment">// True</span>

<span class="hljs-keyword">var</span> largerRect = rect.Inflate(<span class="hljs-number">2</span>);
Console.WriteLine(<span class="hljs-string">$"新面积: <span class="hljs-subst">{largerRect.Area}</span>"</span>); <span class="hljs-comment">// 新面积: 196</span>
</code></pre>
<h4 data-id="heading-17">数据传输对象（DTO）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// API 响应DTO</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">ApiResponse</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T Data, <span class="hljs-built_in">string</span> Error, DateTime Timestamp</span>)</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsSuccess =&gt; <span class="hljs-built_in">string</span>.IsNullOrEmpty(Error);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiResponse&lt;T&gt; <span class="hljs-title">Success</span>(<span class="hljs-params">T data</span>)</span> =&gt; 
        <span class="hljs-keyword">new</span> ApiResponse&lt;T&gt;(data, <span class="hljs-literal">null</span>, DateTime.UtcNow);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiResponse&lt;T&gt; <span class="hljs-title">Failure</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> error</span>)</span> =&gt; 
        <span class="hljs-keyword">new</span> ApiResponse&lt;T&gt;(<span class="hljs-literal">default</span>, error, DateTime.UtcNow);
}

<span class="hljs-comment">// 使用DTO记录结构</span>
<span class="hljs-keyword">var</span> successResponse = ApiResponse&lt;<span class="hljs-built_in">string</span>&gt;.Success(<span class="hljs-string">"操作成功"</span>);
<span class="hljs-keyword">var</span> errorResponse = ApiResponse&lt;<span class="hljs-built_in">string</span>&gt;.Failure(<span class="hljs-string">"发生错误"</span>);

Console.WriteLine(successResponse.IsSuccess); <span class="hljs-comment">// True</span>
Console.WriteLine(errorResponse.IsSuccess);   <span class="hljs-comment">// False</span>
</code></pre>
<h4 data-id="heading-18">领域模型中的值对象</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 货币值对象</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Money</span>(<span class="hljs-params"><span class="hljs-built_in">decimal</span> Amount, <span class="hljs-built_in">string</span> Currency</span>)</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Money <span class="hljs-keyword">operator</span> +(Money left, Money right)
    {
        <span class="hljs-keyword">if</span> (left.Currency != right.Currency)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"货币类型不匹配"</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Money(left.Amount + right.Amount, left.Currency);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Money <span class="hljs-keyword">operator</span> *(Money money, <span class="hljs-built_in">decimal</span> factor) =&gt;
        <span class="hljs-keyword">new</span> Money(money.Amount * factor, money.Currency);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>()</span> =&gt; <span class="hljs-string">$"<span class="hljs-subst">{Amount:F2}</span> <span class="hljs-subst">{Currency}</span>"</span>;
}

<span class="hljs-comment">// 使用值对象</span>
<span class="hljs-keyword">var</span> price1 = <span class="hljs-keyword">new</span> Money(<span class="hljs-number">100.50</span>m, <span class="hljs-string">"USD"</span>);
<span class="hljs-keyword">var</span> price2 = <span class="hljs-keyword">new</span> Money(<span class="hljs-number">50.25</span>m, <span class="hljs-string">"USD"</span>);
<span class="hljs-keyword">var</span> total = price1 + price2;
<span class="hljs-keyword">var</span> discounted = total * <span class="hljs-number">0.9</span>m;

Console.WriteLine(<span class="hljs-string">$"总价: <span class="hljs-subst">{total}</span>"</span>);       <span class="hljs-comment">// 总价: 150.75 USD</span>
Console.WriteLine(<span class="hljs-string">$"折扣价: <span class="hljs-subst">{discounted}</span>"</span>); <span class="hljs-comment">// 折扣价: 135.68 USD</span>
</code></pre>
<h3 data-id="heading-19">最佳实践和注意事项</h3>
<h4 data-id="heading-20">何时使用记录结构</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ✅ 适合使用记录结构的场景：</span>
<span class="hljs-comment">// 1. 小型、简单的数据结构</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 2. 值语义重要的场景</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Money</span>(<span class="hljs-params"><span class="hljs-built_in">decimal</span> Amount, <span class="hljs-built_in">string</span> Currency</span>)</span>;

<span class="hljs-comment">// 3. 性能敏感的场景（避免堆分配）</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Measurement</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> Value, <span class="hljs-built_in">string</span> Unit</span>)</span>;

<span class="hljs-comment">// 4. 需要值相等性的场景</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">KeyValuePair</span>&lt;<span class="hljs-title">TKey</span>, <span class="hljs-title">TValue</span>&gt;(<span class="hljs-params">TKey Key, TValue Value</span>)</span>;

<span class="hljs-comment">// ❌ 不适合使用记录结构的场景：</span>
<span class="hljs-comment">// 1. 大型数据结构（&gt;16字节）</span>
<span class="hljs-comment">// 2. 需要继承的场景</span>
<span class="hljs-comment">// 3. 需要身份标识的场景</span>
</code></pre>
<h3 data-id="heading-21">适用场景</h3>
<ul>
<li>
<p>高性能游戏开发：<code>3D</code> 坐标、向量、颜色</p>
</li>
<li>
<p>科学计算：矩阵、复数、测量单位</p>
</li>
<li>
<p>金融系统：货币金额、汇率</p>
</li>
<li>
<p>数据处理管道：中间数据结构</p>
</li>
<li>
<p>设备通信：协议数据包结构</p>
</li>
<li>
<p>地理空间计算：坐标点、边界框</p>
</li>
</ul>
<h3 data-id="heading-22">总结</h3>
<p><code>C# 10</code> 的记录结构是一个强大的特性，它结合了结构体的性能优势和记录的简洁性。关键要点：</p>
<ul>
<li>
<p>值类型语义：记录结构是值类型，分配在栈上，性能更好</p>
</li>
<li>
<p>不可变性：默认提供不可变属性（使用 <code>init</code> 访问器）</p>
</li>
<li>
<p>值相等性：自动实现基于值的相等性比较</p>
</li>
<li>
<p>简洁语法：提供位置语法、<code>with</code> 表达式和解构功能</p>
</li>
<li>
<p>适用场景：小型数据结构、值对象、性能敏感场景</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3个90%开发者都误解的JavaScript原型陷阱：从proto到class的深度剖析]]></title>    <link>https://juejin.cn/post/7578063389608509475</link>    <guid>https://juejin.cn/post/7578063389608509475</guid>    <pubDate>2025-12-01T00:16:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578063389608509475" data-draft-id="7578003302487965696" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3个90%开发者都误解的JavaScript原型陷阱：从proto到class的深度剖析"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-01T00:16:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3个90%开发者都误解的JavaScript原型陷阱：从proto到class的深度剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:16:44.000Z" title="Mon Dec 01 2025 00:16:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>3个90%开发者都误解的JavaScript原型陷阱：从__proto__到class的深度剖析</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>JavaScript的原型系统是这门语言中最强大但也最容易被误解的特性之一。尽管ES6引入了<code>class</code>语法糖，但许多开发者仍然对原型继承的本质一知半解。这种误解不仅会导致代码中的潜在bug，还可能影响性能优化和架构设计。</p>
<p>本文将深入剖析3个最常见的原型陷阱，从古老的<code>__proto__</code>到现代的<code>class</code>，揭示其背后的真相。通过本文，你将彻底理解JavaScript的原型机制，并学会如何避免这些陷阱。</p>
<hr/>
<h2 data-id="heading-2">陷阱1：混淆<code>__proto__</code>与<code>prototype</code></h2>
<h3 data-id="heading-3">问题描述</h3>
<p>大多数开发者都知道<code>prototype</code>属性存在于函数对象上，而<code>__proto__</code>存在于实例对象上。但很少有人能清晰地说出它们之间的关系和区别。更糟糕的是，许多人误以为它们是同一事物的两种表现形式。</p>
<h3 data-id="heading-4">深入解析</h3>
<ol>
<li>
<p><strong><code>prototype</code>的作用</strong></p>
<ul>
<li>只有函数对象（包括构造函数）才有<code>prototype</code>属性。</li>
<li>当你使用<code>new</code>关键字调用函数时，新创建的对象的<code>__proto__</code>会指向该函数的<code>prototype</code>。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
</li>
<li>
<p><strong>为什么不能直接用赋值修改原型链？</strong><br/>
许多人尝试直接修改对象的原型链：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {};
obj.<span class="hljs-property">__proto__</span> = { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> }; <span class="hljs-comment">// 不推荐！</span>
</code></pre>
<p>虽然这种方法在某些环境下可行，但它存在以下问题：</p>
<ul>
<li><code>__proto__</code>是非标准属性（尽管被大多数浏览器实现）。</li>
<li>直接修改原型链可能触发引擎的慢速路径（deoptimization），影响性能。<br/>
正确的方式是使用ES6的标准化方法：</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {};
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> }); <span class="hljs-comment">// 推荐方式</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">最佳实践</h3>
<ul>
<li>避免直接操作对象的原型链（除非有特殊需求）。</li>
<li>优先使用ES6提供的标准API（如Object.create/Object.setPrototypeOf）。</li>
</ul>
<hr/>
<h2 data-id="heading-6">陷阱2：误解ES6 <code>class</code>的本质</h2>
<h3 data-id="heading-7">问题描述</h3>
<p>ES6的类语法让许多开发者误以为JavaScript终于有了真正的“类”。然而这只是语法糖——它并没有改变JavaScript基于原型的本质。这种误解可能导致开发者写出不符合预期的代码。</p>
<h3 data-id="heading-8">深入解析</h3>
<ol>
<li><strong>类的底层实现</strong><br/>
下面的类声明：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>!`</span>;
  }
}
</code></pre>
实际上等价于以下传统代码：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>!`</span>;
};
</code></pre>
</li>
</ol>
<pre><code class="hljs language-scala" lang="scala">
<span class="hljs-number">2.</span> **关键区别**    
   尽管功能相似，但类语法带来了重要差异：
    - <span class="hljs-type">Class</span>方法是不可枚举的(`<span class="hljs-type">Object</span>.keys(<span class="hljs-type">Person</span>.prototype)`不会包含greet)
    - <span class="hljs-type">Class</span>必须用<span class="hljs-keyword">new</span>调用(否则抛出<span class="hljs-type">TypeError</span>)
    - <span class="hljs-type">Class</span>不存在变量提升(<span class="hljs-type">Hoisting</span>)

<span class="hljs-number">3.</span> **<span class="hljs-keyword">extends</span>的真实作用**
   当使用继承时：
```javascript
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span> </span>{}
</code></pre>
<p>这相当于手动设置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(<span class="hljs-title class_">Student</span>, <span class="hljs-title class_">Person</span>);
</code></pre>
<h3 data-id="heading-9">Best Practices</h3>
<ul>
<li>Always remember classes are just syntactic sugar for prototypes.</li>
<li>Understand that super calls translate to [[HomeObject]] lookups.</li>
</ul>
<hr/>
<h2 data-id="heading-10">Pitfall #3: Misunderstanding Property Shadowing</h2>
<h3 data-id="heading-11">The Problem</h3>
<p>Developers often expect properties to behave similarly whether they're defined directly on an object or inherited from its prototype chain. However, property shadowing creates subtle but important differences.</p>
<h3 data-id="heading-12">Deep Dive</h3>
<ol>
<li><strong>Assignment Behavior</strong>
Consider:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> parent = { <span class="hljs-attr">x</span>: <span class="hljs-string">"parent"</span> };
<span class="hljs-keyword">const</span> child = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(parent);

child.<span class="hljs-property">x</span>;         <span class="hljs-comment">// "parent"</span>
child.<span class="hljs-property">x</span> = <span class="hljs-string">"child"</span>;
child.<span class="hljs-property">x</span>;         <span class="hljs-comment">// "child"</span>
parent.<span class="hljs-property">x</span>;        <span class="hljs-comment">// still "parent"</span>
</code></pre>
<p>This demonstrates JavaScript's prototypal delegation in action:</p>
<ul>
<li>Reads search up the prototype chain.</li>
<li>Writes always occur on the target object.</li>
</ul>
<ol start="2">
<li><strong>The Hidden Performance Cost</strong>
Each time you shadow a prototype property:</li>
</ol>
<ul>
<li>You create a new own property.</li>
<li>This breaks the hidden class optimization used by V8 and other engines.</li>
</ul>
<ol start="3">
<li><strong>Special Case with Methods</strong>
Method overriding patterns can lead to unexpected behavior:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(); }

<span class="hljs-title function_">logId</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> {
<span class="hljs-title function_">logId</span>(<span class="hljs-params"/>) {
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Derived ID:'</span>, <span class="hljs-variable language_">super</span>());
}
}
</code></pre>
<p>Here <code>super()</code> doesn't work as expected because methods aren't truly bound like in classical OOP.</p>
<h3 data-id="heading-13">Practical Solutions</h3>
<ol>
<li>Prefer composition over inheritance where practical.</li>
<li>When extending built-ins (like Array), use proper symbols rather than property names.</li>
<li>Document clearly when methods are meant to be overridden.</li>
</ol>
<hr/>
<h2 data-id="heading-14">Conclusion</h2>
<p>Understanding JavaScript's prototypal nature is crucial for writing robust applications:</p>
<ol>
<li>Recognize that <code>prototype</code>, <code>[[Prototype]]</code>, and <code>__proto_ _}</code> serve distinct purposes.</li>
<li>Remember that ES6 classes are just syntactic sugar with some guardrails added.</li>
<li>Be mindful of how property shadowing affects both behavior and performance.</li>
</ol>
<p>Mastering these concepts will help you avoid subtle bugs and write more idiomatic JavaScript code—whether you're working with legacy prototypes or modern class syntax.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[女朋友换头像比翻书快？我3天肝出一个去水印小工具]]></title>    <link>https://juejin.cn/post/7577914902431694894</link>    <guid>https://juejin.cn/post/7577914902431694894</guid>    <pubDate>2025-12-01T00:15:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902431694894" data-draft-id="7577971299743924262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="女朋友换头像比翻书快？我3天肝出一个去水印小工具"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2025-12-01T00:15:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员凌览"/> <meta itemprop="url" content="https://juejin.cn/user/3350967174565198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            女朋友换头像比翻书快？我3天肝出一个去水印小工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3350967174565198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员凌览
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:15:23.000Z" title="Mon Dec 01 2025 00:15:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我女朋友天天泡小某书，看到好看的图就想当头像。可小某书的图都带水印，她嫌截图裁剪太麻烦。有一天直接甩给我一句：“你是程序员，给我想个办法把水印弄掉！”</p>
<p>得，女朋友发话，那就干呗。花三天时间，整了个去水印的小工具，挺好用。下面就是我怎么一步步搞出来的，有兴趣的可以看看。</p>
<h2 data-id="heading-0"><strong>先看效果</strong></h2>
<p>先给大佬们体验体验【去水印下载鸭】&gt;&gt;&gt; <a href="https://link.juejin.cn?target=https%3A%2F%2Fnologo.code24.top%2F" target="_blank" title="https://nologo.code24.top/" ref="nofollow noopener noreferrer">nologo.code24.top/</a> ，移动端访问需要扫码跳转。</p>
<p>电脑端是这样的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48434198a01d41de8f56212edd7c61c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155317&amp;x-signature=InRDdO0dgxB4Rysgp4pVBR1A5vc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>功能亮点</strong></h2>
<ul>
<li>小某书、某音、某手……主流平台的图片、视频都能扒</li>
<li>完全免费，不用登录，打开就用，零广告</li>
<li>复制分享链接→粘贴→秒出无水印素材，一步到位</li>
</ul>
<h2 data-id="heading-2"><strong>后端怎么做到的</strong></h2>
<p>前端只是壳，真正干活的是后端：拿到分享链接后，靠爬虫把平台返回的数据里“无水印原始地址”抠出来，再回传给你。</p>
<p>我是前端，最顺手的组合是 Node.js + Vue3，既然后端也要有人顶，干脆一把梭：Node 写接口，语法熟、模块多，撸起来嘎嘎快。</p>
<p>举个例子：拿【某信公某号】来练手，它最简单了。</p>
<p>首先想薅无水印的资源，得先摸透平台套路。公某号最“耿直”，它直接把无水印原图塞在 HTML 里。打开文章源码，一眼就能看到 <code>window.picture_page_info_list</code> 这个大对象，无水印原图地址全躺在里面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf8e5b35a1b49c2aa80ea9a6ff0e18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155317&amp;x-signature=KQgFLW2bHeNDzPU73gJkaHeMulY%3D" alt="image.png" loading="lazy"/></p>
<p>之前写过一篇文章 <strong>Node.js操作Dom ，轻松hold住简单爬虫</strong> 文章提到三方库 <code>jsdom</code>，它能把字符串html摸拟成Dom。</p>
<p>复制链接发送请求获取页面 HTML 内容，再转成模拟的 Dom，这样就能使用<code>jquery</code> 获取元素。</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
    <span class="hljs-keyword">const</span> jquery = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
    <span class="hljs-keyword">const</span> jsdom = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jsdom"</span>);
    <span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">JSDOM</span> } = jsdom;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">str2Dom</span> = (<span class="hljs-params">html = <span class="hljs-string">''</span></span>) =&gt; {
        <span class="hljs-keyword">if</span> (!html) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">new</span> <span class="hljs-title function_">JSDOM</span>(html);
        <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = page.<span class="hljs-property">window</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>;
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getHtml</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resole, reject</span>) =&gt;</span> {
            axios.<span class="hljs-title function_">get</span>(url, {
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0'</span>,
                    <span class="hljs-string">'sec-ch-ua-platform'</span>: <span class="hljs-string">"macOS"</span>,
                    <span class="hljs-attr">cookie</span>: <span class="hljs-string">'rewardsn=; wxtokenkey=777'</span>
                }
            }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
                <span class="hljs-title function_">resole</span>(res.<span class="hljs-property">data</span>)
            }, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                <span class="hljs-title function_">reject</span>(<span class="hljs-string">''</span>)
            })
        })
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileUrl</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
    	  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = <span class="hljs-title function_">str2Dom</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">getHtml</span>(url));
    	  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">let</span> $ = <span class="hljs-title function_">jquery</span>(<span class="hljs-variable language_">window</span>);
        <span class="hljs-comment">//省略...</span>
    }
</code></pre>
<p>获取所有<code>script</code> 标签，挨个循环用正则捕获数据。</p>
<pre><code class="hljs language-js" lang="js">

      <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicturePageInfoList</span> = (<span class="hljs-params">$, reversedScrips</span>) =&gt; {
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">START_STR</span> = <span class="hljs-string">'window.picture_page_info_list = ['</span>;
        <span class="hljs-keyword">let</span> result = <span class="hljs-literal">null</span>;
        $.<span class="hljs-title function_">each</span>(reversedScrips, <span class="hljs-keyword">function</span> (<span class="hljs-params">i, script</span>) {
            <span class="hljs-keyword">let</span> scriptContent = $(script).<span class="hljs-title function_">text</span>() || <span class="hljs-string">''</span>;
            <span class="hljs-keyword">if</span> (scriptContent.<span class="hljs-title function_">includes</span>(<span class="hljs-variable constant_">START_STR</span>)) {
                scriptContent = scriptContent.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.slice(0, 20)'</span>, <span class="hljs-string">''</span>)
                <span class="hljs-comment">// 使用正则表达式捕获方括号内的内容</span>
                <span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/window\.picture_page_info_list\s*=\s*(\[.*?\])(?=\s*;|\s*$)/</span>s;
                <span class="hljs-keyword">const</span> match = scriptContent.<span class="hljs-title function_">match</span>(regex);

                <span class="hljs-keyword">if</span> (match &amp;&amp; match[<span class="hljs-number">1</span>]) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">const</span> fn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">`return <span class="hljs-subst">${match[<span class="hljs-number">1</span>]}</span>`</span>);
                        result = <span class="hljs-title function_">fn</span>();
                    } <span class="hljs-keyword">catch</span> (e) {
                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'JSON解析失败，返回原始内容:'</span>, e);
                        result = match[<span class="hljs-number">1</span>]; <span class="hljs-comment">// 返回原始内容</span>
                    }
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 跳出each循环</span>
            }
        })
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileUrl</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
    	<span class="hljs-comment">//省略...</span>
        <span class="hljs-keyword">let</span> $ = <span class="hljs-title function_">jquery</span>(<span class="hljs-variable language_">window</span>);
        <span class="hljs-keyword">const</span> scrips = $(<span class="hljs-string">'script'</span>);
        <span class="hljs-keyword">const</span> reversedScrips = [...scrips].<span class="hljs-title function_">reverse</span>();
        <span class="hljs-keyword">const</span> weiXinData = <span class="hljs-title function_">getPicturePageInfoList</span>($, reversedScrips);
     }
</code></pre>
<p>这个我们就能得到某信公某号无水印的图片，某信公某号是最简单，基本没做太多防爬虫机制。</p>
<p>其他平台较复杂点，涉及到 js 逆向，大多接口做了保密。</p>
<h2 data-id="heading-3">最后</h2>
<p>本工具仅限于学习,请勿用于其他用途,否则后果自负。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 AI 做了几个超炫酷的 Flutter 动画，同时又差点被 AI 气死]]></title>    <link>https://juejin.cn/post/7578215424677003327</link>    <guid>https://juejin.cn/post/7578215424677003327</guid>    <pubDate>2025-12-01T00:20:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578215424677003327" data-draft-id="7578215424676986943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 AI 做了几个超炫酷的 Flutter 动画，同时又差点被 AI 气死"/> <meta itemprop="keywords" content="前端,Flutter,AIGC"/> <meta itemprop="datePublished" content="2025-12-01T00:20:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 AI 做了几个超炫酷的 Flutter 动画，同时又差点被 AI 气死
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:20:16.000Z" title="Mon Dec 01 2025 00:20:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    49
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 时代之后，对于开发者来说最缺乏的其实是想象力，而随着 AI 成熟之后，很多以前需要“费劲巴拉”才能实现的效果，现在只需要几句话搭配对应的资料就可以复刻，特别是在数学公式到 UI 的转换实现上。</p>
<p>而本次介绍的几种动画效果，没用任何 OpenGL 相关实现，都是纯 Dart 代码完成，整体流畅程度还过得去，都是基于已有的数学公式和资料复刻到 Flutter  的效果：</p>















<table><thead><tr><th>奇异粒子动画（Strange Attractors）</th><th>斐波那契球体动画（Fibonacci Sphere）</th><th>星云动画（Galaxy Scene）</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fde969b047449198b02f6da97ff2213~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=uul3olF1SmQgoQex0fl%2Fwd7CYh4%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b996b28641894d8a9724ae2440185072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=AZ%2FV37z1PVfTbPx%2FUChb9ZVTsx0%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fffe77a5cb24683848899578ac8d53b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=SqHyvhtl3QDOI1thgWeUbS5JmAI%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-0">奇异粒子动画</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd3b2827cdda47538a784c49c77e13a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=UVq1kftHLuT1RsL6jIqe3LufMow%3D" alt="" loading="lazy"/></p>
<p>首先是奇异粒子动画，这是一个非常酷的视觉场景，概念是它们一般被被称为奇异吸引子 (Strange Attractors)，它们是混沌理论中的经典模型，而当我看到它们还搭配了公式时，我就知道 AI 的价值来了。</p>
<p>要在一个 Flutter 页面中实现这四种粒子的 3D 运动轨迹渲染，需要解决以下几个关键点：</p>
<ul>
<li>
<p><strong>数学模型</strong>：将图片中的微分方程转化为代码（欧拉积分法更新粒子位置）</p>
</li>
<li>
<p><strong>3D 到 2D 的投影</strong>：Flutter 的 Canvas 是 2D 的，所以需要一个简单的投影算法将 (x, y, z) 坐标转换为屏幕上的 (u, v) 坐标，最好加上一点旋转让 3D 感更强</p>
</li>
</ul>
<p>然后再基于数学公式，就可以直观的呈现数学的美丽一面。</p>
<h4 data-id="heading-1">核心公式实现</h4>
<p>这这个实现中，核心就是模拟物理运动规律，所以 AI 实现了一个 <code>_updatePhysics</code> 方法，在方法里使用<strong>欧拉积分法 (Euler Integration)</strong> 将微分方程转化为代码，即：</p>
<blockquote>
<p>新位置 = 旧位置 + 变化率(dx, dy, dz) * 时间步长(dt)。</p>
</blockquote>
<p>具体到每个动画效果就是：</p>
<h5 data-id="heading-2">A. Halvorsen Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d3048736dda458497e86d806d7858e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=R1Pk8MqyAtBZ%2FXb%2BM%2BrYm%2BVFY%2B4%3D" alt="" loading="lazy"/></p>
<p>Halvorsen  是一个具有循环对称性的混沌系统，对应公式代码实现公式为:</p>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-keyword">const</span> a = <span class="hljs-number">1.4</span>;
dx = -a * p.x - <span class="hljs-number">4</span> * p.y - <span class="hljs-number">4</span> * p.z - (p.y * p.y);
dy = -a * p.y - <span class="hljs-number">4</span> * p.z - <span class="hljs-number">4</span> * p.x - (p.z * p.z);
dz = -a * p.z - <span class="hljs-number">4</span> * p.x - <span class="hljs-number">4</span> * p.y - (p.x * p.x);
</code></pre>
<h5 data-id="heading-3">B. Lorenz Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035819cc03e04e3f972d33cd9c9ce515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=kNipTWs9%2B1zT2Uxb6MHswxr1vUs%3D" alt="" loading="lazy"/></p>
<p>这是经典的混沌模型，呈现“蝴蝶效应”形状，对应公式的代码实现:、</p>
<pre><code class="hljs language-dart" lang="dart">dx = sigma * (p.y - p.x);
dy = p.x * (rho - p.z) - p.y;
dz = p.x * p.y - beta * p.z;
</code></pre>
<h5 data-id="heading-4">C. Aizawa Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47f3cafa957c40daaf54469ce093b8f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=DTqH%2FaOY2EMFEmEOxkyOGgKDuSs%3D" alt="" loading="lazy"/></p>
<p>其实从结构上看，这个实现会更复杂，因为中间有一个明显的管状结构，需要复杂的缩放和位移，对应公式的代码实现:</p>
<pre><code class="hljs language-Dart" lang="Dart">dx = (p.z - b) * p.x - d * p.y;
dy = d * p.x + (p.z - b) * p.y;
dz = c + a * p.z - (p.z * p.z * p.z) / <span class="hljs-number">3</span> - (p.x * p.x + p.y * p.y) * (<span class="hljs-number">1</span> + e * p.z) + f * p.z * (p.x * p.x * p.x);
</code></pre>
<h5 data-id="heading-5">D. Sprott B Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/741fef6c0fc6461aa6d623673437b493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=LKAtecxgM5ZxbnjdQydgra2BYfU%3D" alt="" loading="lazy"/></p>
<p>这个公式主要呈现出类似环状或星系的结构，对应的代码实现为</p>
<pre><code class="hljs language-Dart" lang="Dart">dx = a * p.y * p.z;
dy = p.x - p.y;
dz = b - p.x * p.y;
</code></pre>
<h5 data-id="heading-6">结论</h5>
<p>而在实际上，这些公式为什么能产生这些奇异的图形，简单来说就是需要从**“微分方程” (Differential Equations)** 的本质看起，其实在代码中，<strong>我们看到的公式计算的并不是粒子的“位置”，而是粒子的“速度”（或者说是趋势）</strong>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fdc895d46f34255b16156fef721be79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=54w%2BWIJ0zPl5g6kEO4P8o9%2B3rfA%3D" alt="" loading="lazy"/></p>
<p>意思就是：“<strong>在这一瞬间，x 坐标应该变化多少？</strong>”，当我们把 x, y, z 三个维度的变化率组合在一起，就形成了一个**“向量场” (Vector Field)<strong>，你可以把整个空间想象成一条充满暗流的河流，而这些公式就是告诉水流在每一个具体的点上应该</strong>往哪个方向流，流多快**。</p>
<p>举个例子， Halvorsen Attractor 的视觉效果是粒子在三个对称的圆环之间穿梭，像一个纠缠在一起的三叶结，对应的公式逻辑大致为：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1aa258cb27b4eda9625a6b71cbf6817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=dkJA%2B4OirGeY%2B3ZIRAgs6%2Fnv6MU%3D" alt="" loading="lazy"/></p>
<p>Halvorsen 的公式是循环对称的，因为 x 的变化取决于  y ， y 取决于  z ， z  又取决于  x  ，这种“你推我，我推他，他推你”的结构，导致粒子无法在一个平面停留，必须在三个维度间不断轮转。</p>
<p>而减去 y^2 ，可以让线性部分的 <code>ax-4y-4z</code> 粒子产生旋转，这里的非线性部分  y^2 就是“折叠力”，粒子跑远时，平方项会迅速变大，产生一股巨大的力量把粒子原本的轨道“掰弯”。</p>
<p>而为什么用 Halvorsen  做例子呢？因为 AI 在做出来第一版的时候，在运行 Halvorsen 效果时，粒子运动一段时间后，屏幕变空，所有粒子消失。</p>
<p>而对应的根本原因是数值发散 (Numerical Divergence)，具体原因有：</p>
<ol>
<li><strong>数学不稳定性</strong>：Halvorsen 方程包含平方项 (y^2, z^2, x^2)，当粒子距离中心稍远时，平方项会让数值瞬间变得极大</li>
<li><strong>积分误差</strong>：公式使用的是简单的离散算法（每帧加一次 <code>dx * dt</code>），一旦某个粒子因为计算误差稍微偏离轨道，平方项会迅速放大这个误差，导致坐标值在几帧内变成 <code>Infinity</code>（无穷大）或 <code>NaN</code>（非数字），从而出现绘制错误</li>
</ol>
<p>而 AI 最终通过“<strong>检测 + 重置</strong>”的机制解决了这个问题：</p>
<ul>
<li>设置电子围栏 (Boundary Check)：</li>
</ul>
<p>在每一帧计算前，检查粒子的坐标是否超过安全范围（代码中设定为 50）或是否变成 NaN</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (p.x.abs() &gt; <span class="hljs-number">50</span> || ... || p.x.isNaN) { ... }
</code></pre>
<ul>
<li>自动重生机制 (Respawn)：</li>
</ul>
<p>一旦检测到粒子“逃逸”或“计算崩溃”，立即调用 <code>_resetSingleParticle(p)</code> 之类的方法将它重置回原点附近的随机位置，这不仅修复了 BUG，还让粒子看起来像源源不断地从中心喷涌而出。</p>
<ul>
<li>微调步长 (Step Size)，</li>
</ul>
<p>针对 Halvorsen，将时间步长 dt 从默认的 0.01 降低到了 0.004，步长越小计算越精确，发生“逃逸”的概率也就越低。</p>
<h5 data-id="heading-7">最后</h5>
<p>其实可以看到 Flutter 复刻出现的效果和原图还是有点差别，其中最核心之一还是粒子的数量和计算的精细度，不过可以看出来，已经是非常不错的效果了。</p>
<h2 data-id="heading-8">斐波那契球体（Fibonacci Sphere）</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fd5e51cf77347f1aa1e14c366a3e356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=NV6v9C1YGmIDqZq2BC6qvszJ7xo%3D" alt="" loading="lazy"/></p>
<p>斐波那契球体的特点是点在球面上分布极其均匀，普通的方法（如经纬度划分）会在球的两极产生点的密集堆积，而斐波那契球体算法能让点在球面上极度均匀地分布，每个点占据的面积几乎相等。</p>
<p>而针对这个效果，需要解决的点在于：</p>
<ul>
<li>
<p><strong>数学算法</strong>：如何根据斐波那契螺旋算法在 3D 球面上生成点</p>
</li>
<li>
<p><strong>渲染与投影</strong>：如何将 3D 坐标投影到 2D 屏幕，并处理透视关系（近大远小）</p>
</li>
</ul>
<p>所以 AI 首先需要的是实现一个球体算法，核心思想是将原本在 2D 平面上画向日葵种子的“黄金螺旋”算法，投影到了 3D 球面上，具体是利用黄金角 (Golden Angle) 来决定每个点的角度偏移：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcf480d3ebbb4c2a9be244fcafa0250c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=4SriCrLaWvcJPiUgksqinmh%2BpZA%3D" alt="" loading="lazy"/></p>
<p>对应的代码实现为：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> goldenAngle = pi * (<span class="hljs-number">3</span> - sqrt(<span class="hljs-number">5</span>)); <span class="hljs-comment">// 约 137.5 度</span>
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; numPoints; i++) {
  <span class="hljs-built_in">double</span> y = <span class="hljs-number">1</span> - (i / (numPoints - <span class="hljs-number">1</span>)) * <span class="hljs-number">2</span>; <span class="hljs-comment">// y 轴均匀分布</span>
  <span class="hljs-built_in">double</span> radiusAtY = sqrt(<span class="hljs-number">1</span> - y * y);       <span class="hljs-comment">// 球体公式 x^2 + z^2 = r^2</span>
  <span class="hljs-built_in">double</span> theta = goldenAngle * i;           <span class="hljs-comment">// 黄金角递增</span>

  <span class="hljs-built_in">double</span> x = cos(theta) * radiusAtY;
  <span class="hljs-built_in">double</span> z = sin(theta) * radiusAtY;
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>之后就是 3D 旋转 (Rotation Matrix)，因为生成的点是静止的，为了让球转动，还需要应用旋转矩阵，这里使用了简化的欧拉角旋转（绕 Y 轴自转，绕 X 轴倾斜）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aca57f44e95944ce814564f2b09f37b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=O5gPIcp8kgbfQvijy5Kzym%2BZr9I%3D" alt="" loading="lazy"/></p>
<p>对应的代码为：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// rotationY 是随时间变化的量</span>
<span class="hljs-built_in">double</span> x1 = x * cos(rotationY) - z * sin(rotationY);
<span class="hljs-built_in">double</span> z1 = x * sin(rotationY) + z * cos(rotationY);
</code></pre>
<p>然后就是透视投影 (Perspective Projection)，这是让 2D 屏幕产生 3D 纵深感的关键，物体离相机越远（Z 越小/负值），在屏幕上看起来就越小，位置越靠近中心：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552e1aeebf8b4caba05ee1dcf88a1c22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=To7tqVXRKv3Fi0kOjm8JrkNKx%2F0%3D" alt="" loading="lazy"/></p>
<p>具体代码为：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">double</span> focalLength = <span class="hljs-number">800.0</span>; <span class="hljs-comment">// 焦距，决定透视强弱</span>
<span class="hljs-built_in">double</span> perspective = focalLength / (focalLength - pz);

<span class="hljs-comment">// 屏幕坐标</span>
<span class="hljs-built_in">double</span> screenX = center.dx + px * perspective;
<span class="hljs-built_in">double</span> screenY = center.dy + py * perspective;

<span class="hljs-comment">// 点的大小也随透视缩放</span>
<span class="hljs-built_in">double</span> pointSize = basePointSize * perspective;
</code></pre>
<p>之后我们还需要增加一些效果，比如它让球体看起来像果冻一样的动画：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63f10a3ad26e4b0f96ae9f8fe2d9325d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=l1CCee8CqkRPAXTMbIUqroGKW9g%3D" alt="" loading="lazy"/></p>
<p>其实原理就是，在旋转之人为地修改了点的 x, z 坐标：</p>
<ul>
<li><code>sin(time...)</code> 引入了周期性的波浪</li>
<li><code>+ y * 4</code> 让波浪在球体上下不同高度处于不同相位（产生像蛇一样的扭动感）</li>
<li>通过 <code>wobble</code> 系数决定了波浪的振幅，如果为 0，<code>offset</code> 为 0，球体就是完美的圆形</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/284f69cda0134441a43b1e8349022286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=ostPvCd4hJo%2FYNFD2sZC%2Fp0mcDo%3D" alt="" loading="lazy"/></p>
<p>最后还有 TRAILS (拖尾) -&gt; 改变绘制样式，实际上这不是物理模拟，而是视觉欺骗</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23523162bc7b415b820a513600c81695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=T2Bs8wL%2BBa%2BHOgO%2BFr1%2BlNaJFMQ%3D" alt="" loading="lazy"/></p>
<p>具体是纤位：</p>
<ul>
<li>当 <code>trails == 0</code> 时，使用 <code>canvas.drawCircle</code> 画圆点</li>
<li>当 <code>trails &gt; 0</code> 时，使用 <code>canvas.drawLine</code> 画线，线的长度由 <code>trails</code> 参数乘以透视系数决定，因为球在水平旋转，我们在水平方向画一条短线，大脑就会自动脑补成“这是因为转太快留下的残影”</li>
</ul>
<p>实际上我还在自己的个人主页上将上面了两种动画，让 AI 转化为 js+css ，让个人主页看起来更加花里胡哨：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63bb15d418fb4bf18eba42905987ef7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=TEbeu9JsrsxFm%2F9Ez2NBH3NU2dk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">星云动画</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b9579c0ac94d5ebaf3ee514a557e5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=ljYFvB42YYGasb%2BPuo8li5yEENQ%3D" alt="" loading="lazy"/></p>
<p>这是一个模拟星云旋转的动画效果，实际效果其实比动图里更加好看，它可以认为是在前面 Sprott B Attractor 的基础上更加复杂的实现，为了实现“粒子形成双核团块”的物理感，还需要模拟了星系动力学。</p>
<h4 data-id="heading-10">引力场模型</h4>
<p>这里的粒子不再是简单的画圆，而是一种“受力”运动的效果，所以需要：</p>
<ul>
<li><strong>中心引力</strong>：提供基础的向心力</li>
<li><strong>旋转棒引力</strong>：模拟双极引力场</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/369ffbd690dd439897282dab21962281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=FfZdHqCfKpP6mcVTYDNwPvNppa4%3D" alt="" loading="lazy"/></p>
<p>另外还需要吸积盘模拟 (Accretion)，让粒子看起来围绕“黑洞”中心运动：</p>
<ul>
<li>粒子不从中心喷出，而是生成<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7187f4111921420d83aa578b64314386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=K7vKpn1zWWfHsFmyooj3nKNrSAQ%3D" alt="" loading="lazy"/>在的外围圆盘</li>
<li>引入微小的摩擦力（<code>velocity *= 0.9995</code>）作为阻尼</li>
</ul>
<p>让粒子因能量损耗，轨道逐渐衰减，从外围螺旋落入中心，并在途中被棒的引力捕获，这就产生了真实的“拖尾”和“聚拢”效果。</p>
<p>最后核心使用了<strong>多重正弦波叠加的湍流算法</strong> (<code>getTurbulence</code>)，让粒子运动看起来像沸腾的岩浆，具有很强的生命力：</p>
<pre><code class="hljs language-dart" lang="dart">    Offset getTurbulence(<span class="hljs-built_in">int</span> i, <span class="hljs-built_in">double</span> phase, <span class="hljs-built_in">double</span> t) {
      <span class="hljs-built_in">double</span> speed = <span class="hljs-number">2.0</span>;
      <span class="hljs-built_in">double</span> dx = <span class="hljs-number">0.06</span> * sin(t * speed + phase) + <span class="hljs-number">0.03</span> * cos(t * speed * <span class="hljs-number">2.3</span> + i * <span class="hljs-number">0.1</span>);
      <span class="hljs-built_in">double</span> dy = <span class="hljs-number">0.06</span> * cos(t * speed * <span class="hljs-number">1.5</span> + phase) + <span class="hljs-number">0.03</span> * sin(t * speed * <span class="hljs-number">1.9</span> + i * <span class="hljs-number">0.1</span>);
      <span class="hljs-built_in">double</span> rotAngle = t * <span class="hljs-number">0.5</span> * (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>);
      <span class="hljs-built_in">double</span> rx = dx * cos(rotAngle) - dy * sin(rotAngle);
      <span class="hljs-built_in">double</span> ry = dx * sin(rotAngle) + dy * cos(rotAngle);
      <span class="hljs-keyword">return</span> Offset(rx, ry);
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80d7dc3426e442882ed94fabe139a4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=fZ%2BaMiMkqZSPXKAj8fP44AWSk5c%3D" alt="" loading="lazy"/></p>
<p>最后是让 30,000 个粒子配合 <code>BlendMode.plus</code>，在重叠处产生了高亮的能量感，模拟了星系的高密度区域，主要有：</p>
<ul>
<li>
<p>使用 <code>Float32List</code> 存储数据，内存紧凑，访问极快</p>
</li>
<li>
<p>使用 <code>canvas.drawRawPoints</code> 批量绘制，这是 Flutter 中利用 GPU 渲染粒子的最高效方式</p>
</li>
</ul>
<h4 data-id="heading-11">问题</h4>
<p>当然， AI 在实现时其实遇到了一个比较麻烦的问题：颜色的“插值陷阱”，有时候也称为 Uninitialized Tile Artifacts（未初始化瓦片伪影） , 具体为:</p>
<blockquote>
<p>在 tile-based GPU（大多数移动 GPU 与 WebGL framebuffer）中，当某些 tile 区域在进入 blending/compositing 阶段之前 <strong>没有被正确清理（未写入有效像素）</strong>，它们会以默认值（通常为黑色透明）参与加法混合，从而显示为黑块。</p>
</blockquote>
<p>也就是出现了下方图片的几个透明黑块，黑块随着运动变化，时而明显，时而消失：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b68f0aef51e4410e824c65bafe359020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=3XJbcfFILFQyBqfEMMWs%2BoYB7ac%3D" alt="image-20251127084140632" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4408f458b93d403f989db75dec379c2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=Jdbz3jsUgbl6OPJz6eSA7IWHLHU%3D" alt="" loading="lazy"/></p>
<p>所以这里看到的“黑块”，实际上是 Canvas 绘制圆形时的 Bounding Box， 虽然代码命令计算机画一个圆，但计算机在底层是先画一个正方形区域，然后计算像素距离圆心的距离来填充颜色， 当这个正方形区域边缘的像素没有处理干净时，就会看到一个淡黑色的方框。</p>
<p>而在 Flutter中，代码里主要有：</p>
<ul>
<li><strong><code>Colors.orange</code></strong> 的数据是：R=255, G=165, B=0, A=255</li>
<li><strong><code>Colors.transparent</code></strong> 的数据实际上是透明的黑色：R=0, G=0, B=0, A=0</li>
</ul>
<p>猜测是，定义一个渐变从 <code>橙色</code> -&gt; <code>透明</code> 时，计算机需要计算中间的过渡色，一般来说数学计算过程是这样的：</p>
<ul>
<li>起点：亮橙色 (255, 165, 0, 255)</li>
<li>中间：半透明的深褐色 (128, 82, 0, 128)  &lt;- 可能出问题的地方</li>
<li>终点：透明黑色 (0, 0, 0, 0)</li>
</ul>
<p>整个情况下，如果用默认的混合模式（<code>SourceOver</code>），Alpha 通道会把这个“深褐色”隐藏掉，因为它越来越透明。</p>
<p>而在实际实现上，在增加了中间区域的发光特效， 为了实现要求的“发光、高亮、高温”效果，AI 使用了 <strong><code>BlendMode.screen</code>（滤色）</strong> 或 <strong><code>BlendMode.plus</code>（相加）</strong>：</p>
<ul>
<li>在这些混合模式下，<strong>RGB 值的亮度</strong>决定了最终画面</li>
<li>那个中间状态的“深褐色”，虽然 Alpha 很低，但它的 RGB 不是 0</li>
<li>在 <code>Screen</code> 模式下，这层淡淡的褐色会像一层薄纱一样叠在背景上，导致正方形区域显形</li>
</ul>
<p>而 AI 在几次尝试修复里，一直没能修复问题：</p>
<ul>
<li><strong>尝试 A：使用 <code>TileMode.decal</code>（剪切模式）</strong>
<ul>
<li><em>原理</em>：告诉计算机“超出圆半径的像素直接扔掉，不要画”，避免渐变边缘在透明像素上产生 undefined 行为</li>
<li><em>结果</em>：没有效果</li>
</ul>
</li>
<li><strong>调整 <code>Colors.transparent</code></strong>
<ul>
<li><em>原理</em>：试图让渐变变得更淡。</li>
<li><em>结果</em>：方块变淡了，但依然存在，因为只要终点是 <code>Colors.transparent</code>，中间插值就一定包含“黑色成分”。</li>
</ul>
</li>
<li><strong>尝试 C：BlendMode 层面的修复</strong>
<ul>
<li><em>原理</em>：尝试去掉 Plus ，Plus 混合会创建 offscreen buffer，透明像素的初始值要么是黑，要么是不确定；如果深层次变换后参与合成，就会以“脏块”形式出现，所以替换为在某些层用 srcOver，单独隔离 blob / halo / blackhole 的加法混合，调整合成顺序等</li>
<li><em>结果</em>： 黑块依旧出现</li>
</ul>
</li>
<li><strong>尝试 D：Canvas 层面的修复</strong>
<ul>
<li><em>原理</em>：<code>saveLayer + clear</code> 强制透明背景，用真实透明 offscreen 替代 GPU 依赖背景，去掉 RadialGradient transform，目的是完全控制合成区域，阻止脏像素泄漏</li>
<li><em>结果</em>： 黑块依旧出现</li>
</ul>
</li>
</ul>
<p>这一切的问题看起来都是 GPU tile buffer 没有正确清除，以至于换个 AI ，从 Gemini 3 Pro 换到 GPT 5，它都觉得：“不是你，不是我，不是实现错误” ：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bd9cf9105a84e05ae6109aa000cfd1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=Xc0VzXrYkPi066YD6spM6EMi2q8%3D" alt="" loading="lazy"/></p>
<p>那为什么最后还是解决了呢？其实是投机取巧，这里不再调整 <code>BlendMode</code> 或 <code>Gradient</code> ，而是通过<strong>叠加多层不同相位的蠕动</strong>来实现中间的橙色呼吸效果， 通过 “弹性形变”不仅仅是位置偏移，还可以根据时间修改每个小团块的大小（Size）和拉伸比（Scale）。</p>
<p>也就是问题其实没解决，只是最终换了个路子，实际上 AI 一直在死磕解决，但是换了几个 AI 多次尝试后依然无果，所以核心应该还是底层支持上的伪影问题，所以最终我主动让 AI 换了种实现，其实这也是程序猿在 AI 时代的作用，毕竟 AI 还很擅长瞎扯，这些回答没一个能用的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39a33d4a596a4de49f1c08d2a4483527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=2n1JQLb70t2L%2BZtmpPfFi3jXXPA%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d812c017f124491a93e0baa1ba80dc1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=hixWofOsIAr1BfvDGfIgfumbFPA%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c13d0a8bf9b347a1940b89f84f3aa0ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=uazEMCbyvO%2FEEFj0na8u3jT%2BP9A%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cfdcf2b491d4d1bb862d6381f83e447~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=u%2BrAFPXJQaMgrXzZDai53CUTMKE%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9391fb40383406c99586f302cdb547f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=c%2Bs8V%2F0%2Bkh%2FXzrMWCzANhcm5iNY%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52d938da81414234a5c9028e2d2bcd66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=LorFUBWcoVB050%2FZDhgYbhdzLI8%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ea3af0e43234cc794e98471d92cc510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=diHR1YobSh%2BlKNo93PnrvrjKw6c%3D" alt="" loading="lazy"/></p>
<p>最后，不得不说，AI 在数学了领域是真的强大。</p>
<h2 data-id="heading-12">链接</h2>
<p>代码在下方连接，感兴趣的可以自取：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCarGuo%2Fgsy_flutter_demo" target="_blank" title="https://github.com/CarGuo/gsy_flutter_demo" ref="nofollow noopener noreferrer">github.com/CarGuo/gsy_…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain1.0实战之多模态RAG系统（三）——多模态RAG系统PDF解析功能实现]]></title>    <link>https://juejin.cn/post/7577795545440960546</link>    <guid>https://juejin.cn/post/7577795545440960546</guid>    <pubDate>2025-12-01T00:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577795545440960546" data-draft-id="7577715145121529910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain1.0实战之多模态RAG系统（三）——多模态RAG系统PDF解析功能实现"/> <meta itemprop="keywords" content="人工智能,LangChain,Agent"/> <meta itemprop="datePublished" content="2025-12-01T00:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain1.0实战之多模态RAG系统（三）——多模态RAG系统PDF解析功能实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:26:32.000Z" title="Mon Dec 01 2025 00:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>上篇分享《<a href="https://juejin.cn/post/7576155969606303779" target="_blank" title="https://juejin.cn/post/7576155969606303779">LangChain1.0实战之多模态RAG系统（二）——多模态RAG系统图片分析与语音转写功能实现</a>》中，笔者系统探讨了如何基于 Qwen3-Omni 多模态大模型实现图片分析与音频处理的能力。作为多模态 RAG 系统的核心组成部分，对 PDF 文档的解析回答与引用溯源同样至关重要。</p>
<p>本文将重点介绍如何实现对上传 PDF 的结构化解析，构建具备引用溯源能力的问答系统。系统不仅能够依据文档内容进行准确回答，还将在回复中实时标注原始出处，方便用户进行信息追溯与验证。</p>
<p><strong>学习前置要求</strong>：本文是系列的第三篇，强烈建议大家先掌握第一、二篇中介绍的项目架构、环境配置和基础代码实现，这将有助于大家更好地理解本文的内容。</p>
<p>本系列内容适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。当然，如果大家已经学习过我的专栏<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>，相信可以更快上手。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 29讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<h2 data-id="heading-1">一、多模态PDF处理流程解析</h2>
<h3 data-id="heading-2">1.1 标准处理流程</h3>
<p>多模态PDF文档的处理通常遵循一套标准化的流程，下面笔者将逐步解析各个环节的关键技术与实现思路：</p>
<h4 data-id="heading-3">1.1.1 文档内容提取</h4>
<p>根据PDF文档类型的不同，可以采用差异化的提取策略：</p>
<ul>
<li><strong>非影印版文档</strong>：使用PyMuPDF、PyPDF2等工具直接提取文本、图片和表格内容。图片在提取后通过URL占位符进行标记，保持文档结构的完整性。</li>
<li><strong>影印版/扫描版文档</strong>：借助DeepSeek-OCR、Paddle-OCR等OCR引擎将图像内容转换为可读的Markdown格式。特别值得注意的是，对于跨页表格的识别难题，推荐尝试OCRFlux-3b模型，其在复杂版面分析方面表现出色。</li>
</ul>
<h4 data-id="heading-4">1.1.2 文档检索优化策略</h4>
<p>直接将完整文档内容嵌入提示词(Prompt)虽然实现简单，但存在明显缺陷：</p>
<ul>
<li>引入大量无关信息，干扰模型推理过程</li>
<li>受限于大模型的Token输入上限，无法处理大规模文档</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94cd71fafed94fc2b6bbaa57d1171b26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=pXrdrcltUnY8vOmxIm6%2BaHP%2BLS4%3D" alt="0.png" loading="lazy"/></p>
<h4 data-id="heading-5">1.1.3 文档分块处理</h4>
<p>为解决上述问题，通常采用文档分块策略：</p>
<ul>
<li>将原始文档按段落或固定长度（有很多精细的文档切分策略，这里只列举了两种比较简单的）切分为多个语义完整的片段</li>
<li>如图示，原始数据1被分割为chunk1至chunk4</li>
<li>所有文档经过相同处理后，形成统一的知识库存储</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e1fffde476a413d8b689001071926d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=GVtVv9OA%2BUSq%2BQv07FwXc0uiFY4%3D" alt="1.png" loading="lazy"/></p>
<h4 data-id="heading-6">1.1.4 语义检索机制</h4>
<p>当用户发起查询时，系统执行以下操作：</p>
<ul>
<li>在分块知识库中进行语义搜索</li>
<li>返回相关性最高的多个文本片段</li>
<li>将这些片段作为上下文信息与用户原始查询组合，输入大模型生成最终答案</li>
</ul>
<h4 data-id="heading-7">1.1.5 向量化与语义理解</h4>
<p>文本分块后仍面临语义理解挑战：</p>
<ul>
<li>单纯的字词匹配无法准确衡量文本相似度</li>
<li>需要挖掘文本深层的语义信息</li>
</ul>
<p>解决方案是引入Embedding技术：</p>
<ul>
<li>将所有文本块转换为高维向量表示</li>
<li>通过向量相似度计算实现精准的语义匹配</li>
</ul>
<p>向量数据库在这个过程中扮演关键角色，专门用于存储：</p>
<ul>
<li>每个文本块的语义向量</li>
<li>对应的原始文本内容</li>
<li>通过语义向量匹配实现高效的检索</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8ec23595c0b4c5f9ceda7cdedcdeb1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=obi%2FKdu8WnEk%2B32wflQ0oLGpaeM%3D" alt="2.png" loading="lazy"/></p>
<p>如上所示解决搜索效率和计算相似度优化算法的答案就是向量数据库，主要用于保存每个块的语义向量及其原始文字内容。通过语义向量匹配，原始文字与Query拼接。</p>
<h4 data-id="heading-8">1.1.6 溯源引用实现</h4>
<p>实现答案溯源的技术要点：</p>
<p><strong>数据存储层面</strong>：</p>
<ul>
<li>
<p>向量数据库存储语义向量和原始文本</p>
</li>
<li>
<p>关联结构化数据库存储块的元信息：</p>
<ul>
<li>原始文档标识</li>
<li>页码位置</li>
<li>段落位置等详细信息</li>
</ul>
</li>
</ul>
<p><strong>提示词设计</strong>：</p>
<ul>
<li>在系统提示词中明确要求：引用内容必须标注来源索引</li>
<li>确保生成答案具备完整的可追溯性</li>
</ul>
<h3 data-id="heading-9">1.2 可溯源RAG系统核心工作流</h3>
<p>笔者这里将上述过程进行了总结:</p>
<ol>
<li><strong>OCR识别</strong> - 提取原始文档内容</li>
<li><strong>内容分块</strong> - 将文档转化为语义块，记录原始内容和溯源元信息</li>
<li><strong>向量化存储</strong> - 将文本块转换为向量，分别存储在向量数据库和关联数据库中</li>
<li><strong>提示词构建</strong> - 组合系统提示词、相关文本块和用户查询，生成可溯源的回答</li>
</ol>
<p>对于以上流程，LangChain提供了非常完美的支持，大家可以看笔者下面这张图迅速找到相关技术的langchain工具库：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9ef53df7bbc4ceab68c5370f113853f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=k1%2FYvz9RBQr4DOJWpu1XrJVtO7g%3D" alt="3.png" loading="lazy"/></p>
<p>理论介绍就到这里啦，想了解更完整的RAG原理知识大家可以参考笔者文章<a href="https://juejin.cn/post/7494201369303253002" target="_blank" title="https://juejin.cn/post/7494201369303253002">一文带你了解RAG核心原理！不再只是文档的搬运工</a>， 接下来让笔者通过具体的代码实例来深入分享整个实现过程。</p>
<h2 data-id="heading-10">二、多模态PDF处理代码实现</h2>
<h3 data-id="heading-11">2.1 多模态PDF处理代码编写</h3>
<ol>
<li><strong>环境配置与依赖安装：</strong> 在开始编写代码前，需要安装必要的依赖包。根据搜索结果，PyMuPDF是处理PDF文档的推荐工具，具有处理速度快、功能全面的优势。</li>
</ol>
<pre><code class="hljs">pip install PyMuPDF langchain_text_splitters
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad040340b61e4ece9e3a74e23ac7e7df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=iKrOiAiFB9G47wXRo2YQeczRykY%3D" alt="4.png" loading="lazy"/></p>
<ol start="2">
<li><strong>PDF处理工具类实现：</strong> 创建<code>pdf_utils.py</code>文件，实现PDF处理的核心逻辑。本示例主要展示基于文本的PDF处理流程，OCR相关功能可作为扩展练习。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> fitz  <span class="hljs-comment"># PyMuPDF</span>
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>, Iterator
<span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PDFProcessor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.text_splitter = RecursiveCharacterTextSplitter(
            chunk_size=<span class="hljs-number">1000</span>,
            chunk_overlap=<span class="hljs-number">200</span>,
            separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>]
        )

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_pdf_pages_as_images</span>(<span class="hljs-params">self, file_content: <span class="hljs-built_in">bytes</span>, max_pages: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""
        因为上传的pdf有时候会是扫描件，无法直接读取文字，通常需要将文档的每页作为图片提取出来并作OCR处理
        """</span>
        <span class="hljs-keyword">try</span>:
            pdf_document = fitz.<span class="hljs-built_in">open</span>(stream=file_content, filetype=<span class="hljs-string">"pdf"</span>)
            total_pages = <span class="hljs-built_in">len</span>(pdf_document)
            pages_to_extract = <span class="hljs-built_in">min</span>(max_pages, total_pages)

            images = []
            <span class="hljs-keyword">for</span> page_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(pages_to_extract):
                page = pdf_document.load_page(page_num)
                pix = page.get_pixmap()
                img = Image.frombytes(<span class="hljs-string">"RGB"</span>, (pix.width, pix.height), pix.samples)

                buffer = io.BytesIO()
                img.save(buffer, <span class="hljs-built_in">format</span>=<span class="hljs-string">"PNG"</span>)
                base64_image = base64.b64encode(buffer.getvalue()).decode(<span class="hljs-string">"utf-8"</span>)
                images.append(base64_image)

            pdf_document.close()
            <span class="hljs-keyword">return</span> images

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">raise</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_pdf_pages</span>(<span class="hljs-params">pdf_path</span>):
        <span class="hljs-comment"># 检查文件是否存在</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(pdf_path):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：文件 '<span class="hljs-subst">{pdf_path}</span>' 不存在"</span>)
            <span class="hljs-keyword">return</span> {}

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_pdf</span>(<span class="hljs-params">self, file_content: <span class="hljs-built_in">bytes</span>, filename: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        流式处理PDF文档
        返回处理进度和结果
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Step 1: 保存临时文件</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'保存临时文件'</span>)

            <span class="hljs-comment"># 创建临时文件</span>
            tmp_file_path = <span class="hljs-string">r'temp\' + filename
            with open(tmp_file_path, '</span>w<span class="hljs-string">b') as f:
                f.write(file_content)

            full_text = ""
            doc = fitz.open(tmp_file_path)
            # 存储每页内容
            pages_content = {}
            # 逐页读取内容
            for page_num in range(len(doc)):
                page = doc[page_num]
                # 提取文本
                text = page.get_text()
                full_text += text
                # 存储页面内容
                pages_content[page_num + 1] = text
            print(f"合并后文本长度: {len(full_text)} 字符")

            # 调试：输出前200个字符看看提取到了什么
            preview = full_text[:200] if full_text else "空内容"
            print(f"文本预览: {repr(preview)}")

            # 使用RecursiveCharacterTextSplitter进行智能分块
            text_chunks = self.text_splitter.split_text(full_text)
            print(f"文本分块完成，共 {len(text_chunks)} 个块")

            # Step 4: 构建文档块
            print(f"正在构建 {len(text_chunks)} 个文档块...")

            # 构建带元数据的文档块（包含页码信息）
            document_chunks = []
            for i, chunk in enumerate(text_chunks):
                if chunk.strip():  # 过滤空块
                    # 尝试从原始文档块中获取页码信息
                    page_number = 1  # 默认页码
                    sorted_keys = sorted(pages_content.keys())
                    for page_number in sorted_keys:
                        if chunk.strip()[:50] in pages_content[page_number]:
                            break

                    doc_chunk = {
                        "id": f"{filename}_{i}",
                        "content": chunk.strip(),
                        "metadata": {
                            "source": filename,
                            "chunk_id": i,
                            "chunk_size": len(chunk),
                            "total_chunks": len(text_chunks),
                            "page_number": page_number,
                            "reference_id": f"[{i + 1}]",
                            "source_info": f"{filename} - 第{page_number}页"
                        }
                    }
                    document_chunks.append(doc_chunk)

            print(document_chunks)

            # Step 5: 完成处理
            print(f"处理完成！共生成 {len(document_chunks)} 个文档块")

            # 返回处理结果
            return document_chunks
        except Exception as e:
            print(f"PDF处理失败: {str(e)}")
            return {
                "type": "error",
                "error": f"PDF处理失败: {str(e)}"
            }
</span></code></pre>
<ol start="3">
<li><strong>数据结构扩展：</strong> 回顾笔者在<a href="https://juejin.cn/post/7576155969606303779#heading-2" target="_blank" title="https://juejin.cn/post/7576155969606303779#heading-2">LangChain1.0实战之多模态RAG系统（二）——多模态RAG系统图片分析与语音转写功能实现</a>中定义的核心数据结构，在<code>MessageRequest</code>中添加<code>pdf_chunks</code>用于存储切分后的文档块:</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ContentBlock</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">type</span>: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"内容类型: text, image, audio"</span>)
    content: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(description=<span class="hljs-string">"内容数据"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageRequest</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    content_blocks: <span class="hljs-type">List</span>[ContentBlock] = Field(default=[], description=<span class="hljs-string">"内容块"</span>)
    history: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = Field(default=[], description=<span class="hljs-string">"对话历史"</span>)
    pdf_chunks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = Field(default=[], description=<span class="hljs-string">"PDF文档块信息，用于引用溯源"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageResponse</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    content: <span class="hljs-built_in">str</span>
    timestamp: <span class="hljs-built_in">str</span>
    role: <span class="hljs-built_in">str</span>
    references: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] <span class="hljs-comment"># PDF的引用</span>
</code></pre>
<ol start="4">
<li><strong>多模态消息构建增强：</strong> 在<code>create_multimodal_message</code>函数中添加PDF文档块处理逻辑。
在这篇文章中笔者限于时间问题并没有将切分后的文本块存储在向量库中，还是一股脑增加到提示词中。这块也是给读者留一个小练习，大家可以参考笔者文章<a href="https://juejin.cn/post/7540835688935178282" target="_blank" title="https://juejin.cn/post/7540835688935178282">深入浅出LangChain AI Agent智能体开发教程（九）—LangChain从0到1搭建知识库</a>自定义向量库和结构化数据库存储文档块的向量和索引元信息对系统进行优化。这样就不需要把切分块一股脑放到用户消息提示词中，只需要根据用户提问检索出相应块，将相应块的内容和索引元信息放入提示词中即可。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_multimodal_message</span>(<span class="hljs-params">request: MessageRequest, image_file: UploadFile | <span class="hljs-literal">None</span>, audio_file:UploadFile | <span class="hljs-literal">None</span></span>) -&gt; HumanMessage:
    <span class="hljs-string">"""创建多模态消息"""</span>
    message_content = []

    <span class="hljs-comment"># 如果有图片</span>
    <span class="hljs-keyword">if</span> image_file:
        processor = ImageProcessor()
        mime_type = processor.get_image_mime_type(image_file.filename)
        base64_image = processor.image_to_base64(image_file)
        message_content.append({
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">f"data:<span class="hljs-subst">{mime_type}</span>;base64,<span class="hljs-subst">{base64_image}</span>"</span>
            },
        })
    <span class="hljs-keyword">if</span> audio_file:
        processor = AudioProcessor()
        mime_type = processor.get_audio_mime_type(audio_file.filename)
        base64_audio = processor.audio_to_base64(audio_file)
        message_content.append({
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"audio_url"</span>,
            <span class="hljs-string">"audio_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">f"data:<span class="hljs-subst">{mime_type}</span>;base64,<span class="hljs-subst">{base64_audio}</span>"</span>
            },
        })

    <span class="hljs-comment"># 处理内容块</span>
    <span class="hljs-keyword">for</span> i, block <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(request.content_blocks):
        <span class="hljs-keyword">if</span> block.<span class="hljs-built_in">type</span> == <span class="hljs-string">"text"</span>:
            message_content.append({
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
                <span class="hljs-string">"text"</span>: block.content
            })
        <span class="hljs-keyword">elif</span> block.<span class="hljs-built_in">type</span> == <span class="hljs-string">"image"</span>:
            <span class="hljs-comment"># 只有base64格式的消息才会被接入</span>
            <span class="hljs-keyword">if</span> block.content.startswith(<span class="hljs-string">"data:image"</span>):
                message_content.append({
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
                    <span class="hljs-string">"image_url"</span>: {
                        <span class="hljs-string">"url"</span>: block.content
                    },
                })
        <span class="hljs-keyword">elif</span> block.<span class="hljs-built_in">type</span> == <span class="hljs-string">"audio"</span>:
            <span class="hljs-keyword">if</span> block.content.startswith(<span class="hljs-string">"data:audio"</span>):
                message_content.append({
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"audio_url"</span>,
                    <span class="hljs-string">"audio_url"</span>: {
                        <span class="hljs-string">"url"</span>: block.content
                    },
                })

    <span class="hljs-keyword">if</span> request.pdf_chunks:
        pdf_content = <span class="hljs-string">"\n\n=== 参考文档内容 ===\n"</span>
        <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(request.pdf_chunks):
            content = chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
            source_info = chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(
                <span class="hljs-string">"source_info"</span>, <span class="hljs-string">f"文档块 <span class="hljs-subst">{i}</span>"</span>)
            pdf_content += <span class="hljs-string">f"\n[<span class="hljs-subst">{i}</span>] <span class="hljs-subst">{content}</span>\n来源: <span class="hljs-subst">{source_info}</span>\n"</span>
        pdf_content += <span class="hljs-string">"\n请在回答时引用相关内容，使用格式如 [1]、[2] 等。\n"</span>

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(message_content) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):
            item = message_content[i]
            <span class="hljs-keyword">if</span> item[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'text'</span>:
                item[<span class="hljs-string">'text'</span>] += pdf_content
                <span class="hljs-keyword">break</span>

    <span class="hljs-keyword">return</span> HumanMessage(content=message_content)
</code></pre>
<ol start="5">
<li><strong>系统提示词优化：</strong> 在<code>convert_history_to_messages</code>函数中增强系统提示词，明确引用要求：</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_history_to_messages</span>(<span class="hljs-params">history: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>) -&gt; <span class="hljs-type">List</span>[BaseMessage]:
    <span class="hljs-string">"""将历史记录转换为 LangChain 消息格式，支持多模态内容"""</span>
    messages = []

    <span class="hljs-comment"># 添加系统消息</span>
    system_prompt = <span class="hljs-string">"""
        你是一个专业的多模态 RAG 助手，具备如下能：
        1. 与用户对话的能力。
        2. 图像内容识别和分析能力(OCR, 对象检测， 场景理解)
        3. 音频转写与分析
        4. 知识检索与问答
        
        重要指导原则：
        - 当用户上传图片并提出问题时，请结合图片内容和用户的具体问题来回答
        - 仔细分析图片中的文字、图表、对象、场景等所有可见信息
        - 根据用户的问题重点，有针对性地分析图片相关部分
        - 如果图片包含文字，请准确识别并在回答中引用
        - 如果用户只上传图片没有问题，则提供图片的全面分析
        
        引用格式要求（重要）：
        - 当回答基于提供的参考文档内容时，必须在相关信息后添加引用标记，格式为[1]、[2]等
        - 引用标记应紧跟在相关内容后面，如："这是重要信息[1]"
        - 每个不同的文档块使用对应的引用编号
        - 如果用户消息中包含"=== 参考文档内容 ==="部分，必须使用其中的内容来回答问题并添加引用
        - 只需要在正文中使用角标引用，不需要在最后列出"参考来源"
        
        请以专业、准确、友好的方式回答，并严格遵循引用格式。当有参考文档时，优先使用文档内容回答。
    """</span>

    messages.append(SystemMessage(content=system_prompt))

    <span class="hljs-comment"># 转换历史消息</span>
    <span class="hljs-keyword">for</span> i, msg <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(history):
        content = msg.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
        content_blocks = msg.get(<span class="hljs-string">"content_blocks"</span>, [])
        message_content = []
        <span class="hljs-keyword">if</span> msg[<span class="hljs-string">"role"</span>] == <span class="hljs-string">"user"</span>:
            <span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> content_blocks:
                <span class="hljs-keyword">if</span> block.get(<span class="hljs-string">"type"</span>) == <span class="hljs-string">"text"</span>:
                    message_content.append({
                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
                        <span class="hljs-string">"text"</span>: block.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
                    })
                <span class="hljs-keyword">elif</span> block.get(<span class="hljs-string">"type"</span>) == <span class="hljs-string">"image"</span>:
                    image_data = block.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
                    <span class="hljs-keyword">if</span> image_data.startswith(<span class="hljs-string">"data:image"</span>):
                        message_content.append({
                            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
                            <span class="hljs-string">"image_url"</span> : {
                                <span class="hljs-string">"url"</span>: image_data
                            }
                        })
                <span class="hljs-keyword">elif</span> block.get(<span class="hljs-string">"type"</span>) == <span class="hljs-string">"audio"</span>:
                    audio_data = block.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
                    <span class="hljs-keyword">if</span> audio_data.startswith(<span class="hljs-string">"data:audio"</span>):
                        message_content.append({
                            <span class="hljs-string">"type"</span>: <span class="hljs-string">"audio_url"</span>,
                            <span class="hljs-string">"image_url"</span>: {
                                <span class="hljs-string">"url"</span>: audio_data
                            }
                        })
            messages.append(HumanMessage(content=message_content))
        <span class="hljs-keyword">elif</span> msg[<span class="hljs-string">"role"</span>] == <span class="hljs-string">"assistant"</span>:
            messages.append(AIMessage(content=content))

    <span class="hljs-keyword">return</span> messages
</code></pre>
<ol start="6">
<li><strong>引用提取功能：</strong> 新增<code>extract_references_from_content</code>函数，从模型回答中提取引用信息：</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_references_from_content</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span>, pdf_chunks: <span class="hljs-built_in">list</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">list</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'模型输出内容:'</span>,content)
    references = []

    reference_pattern = <span class="hljs-string">r'[(\d+)]'</span>
    matches = re.findall(reference_pattern, content)
    <span class="hljs-built_in">print</span>(matches)

    <span class="hljs-keyword">if</span> matches <span class="hljs-keyword">and</span> pdf_chunks:
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> matches:
            ref_num = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>)
            <span class="hljs-keyword">if</span> ref_num &lt;= <span class="hljs-built_in">len</span>(pdf_chunks):
                chunk = pdf_chunks[ref_num]  <span class="hljs-comment"># 索引从0开始</span>
                reference = {
                    <span class="hljs-string">"id"</span>: ref_num,
                    <span class="hljs-string">"text"</span>: chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)[:<span class="hljs-number">200</span>] + <span class="hljs-string">"..."</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(
                        chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)) &gt; <span class="hljs-number">200</span> <span class="hljs-keyword">else</span> chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>),
                    <span class="hljs-string">"source"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"source"</span>, <span class="hljs-string">"未知来源"</span>),
                    <span class="hljs-string">"page"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"page_number"</span>, <span class="hljs-number">1</span>),
                    <span class="hljs-string">"chunk_id"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"chunk_id"</span>, <span class="hljs-number">0</span>),
                    <span class="hljs-string">"source_info"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"source_info"</span>, <span class="hljs-string">"未知来源"</span>)
                }
                references.append(reference)

    <span class="hljs-keyword">return</span> references
</code></pre>
<ol start="7">
<li><strong>流式响应生成增强：</strong> 在<code>generate_streaming_response</code>函数中集成引用提取功能：</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_streaming_response</span>(<span class="hljs-params">
        messages: <span class="hljs-type">List</span>[BaseMessage],
        pdf_chunks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = <span class="hljs-literal">None</span>
</span>) -&gt; AsyncGenerator[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>]:
    <span class="hljs-string">"""生成流式响应"""</span>
    <span class="hljs-keyword">try</span>:
        model = get_chat_model()
        <span class="hljs-comment"># 创建流式响应</span>
        full_response = <span class="hljs-string">""</span>

        chunk_count = <span class="hljs-number">0</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> model.astream(messages):
            chunk_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(chunk, <span class="hljs-string">'content'</span>) <span class="hljs-keyword">and</span> chunk.content:
                content = chunk.content
                full_response += content

                <span class="hljs-comment"># 直接发送每个chunk的内容，避免重复</span>
                data = {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"content_delta"</span>,
                    <span class="hljs-string">"content"</span>: content,
                    <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
                }
                <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps(data, ensure_ascii=<span class="hljs-literal">False</span>)}</span>\n\n"</span>

        <span class="hljs-comment"># 提取引用信息</span>
        references = extract_references_from_content(full_response, pdf_chunks) <span class="hljs-keyword">if</span> pdf_chunks <span class="hljs-keyword">else</span> []

        <span class="hljs-comment"># 发送完成信号</span>
        final_data = {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"message_complete"</span>,
            <span class="hljs-string">"full_content"</span>: full_response,
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat(),
            <span class="hljs-string">"references"</span>: references
        }
        <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps(final_data, ensure_ascii=<span class="hljs-literal">False</span>)}</span>\n\n"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        error_data = {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"error"</span>,
            <span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e),
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
        }
        <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps(error_data, ensure_ascii=<span class="hljs-literal">False</span>)}</span>\n\n"</span>
</code></pre>
<ol start="8">
<li><strong>API接口集成：</strong> 在FastAPI接口中集成PDF处理功能</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/api/chat/stream"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_stream</span>(<span class="hljs-params">
        image_file: UploadFile | <span class="hljs-literal">None</span> = File(<span class="hljs-params"><span class="hljs-literal">None</span></span>),
        content_blocks: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params">default=<span class="hljs-string">"[]"</span></span>),
        history: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params">default=<span class="hljs-string">"[]"</span></span>),
        audio_file: UploadFile | <span class="hljs-literal">None</span> = File(<span class="hljs-params"><span class="hljs-literal">None</span></span>),
        pdf_file: UploadFile | <span class="hljs-literal">None</span> = File(<span class="hljs-params"><span class="hljs-literal">None</span></span>)
</span>):
    <span class="hljs-string">"""流式聊天接口（支持多模态）"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 解析 JSON 字符串</span>
        <span class="hljs-keyword">try</span>:
            content_blocks_data = json.loads(content_blocks)
            history_data = json.loads(history)
        <span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">400</span>, detail=<span class="hljs-string">f"JSON 解析错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

        <span class="hljs-keyword">if</span> pdf_file:
            pdf_processor = PDFProcessor()
            pdf_content = <span class="hljs-keyword">await</span> pdf_file.read()
            pdf_chunks = <span class="hljs-keyword">await</span> pdf_processor.process_pdf(file_content=pdf_content, filename=pdf_file.filename)
            request_data = MessageRequest(content_blocks=content_blocks_data, history=history_data, pdf_chunks=pdf_chunks)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 创建请求对象（用于传递给其他函数）</span>
            request_data = MessageRequest(content_blocks=content_blocks_data, history=history_data)

        <span class="hljs-comment"># 转换消息历史</span>
        messages = convert_history_to_messages(request_data.history)

        <span class="hljs-comment"># 添加当前用户消息（支持多模态）</span>
        current_message = create_multimodal_message(request_data, image_file=image_file, audio_file=audio_file)
        messages.append(current_message)
        <span class="hljs-built_in">print</span>(messages)

        <span class="hljs-comment"># 返回流式响应</span>
        <span class="hljs-keyword">return</span> StreamingResponse(
            generate_streaming_response(messages, pdf_chunks <span class="hljs-keyword">if</span> pdf_file <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>),
            media_type=<span class="hljs-string">"text/event-stream"</span>,
            headers={
                <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
                <span class="hljs-string">"Connection"</span>: <span class="hljs-string">"keep-alive"</span>,
                <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/event-stream"</span>,
            }
        )
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-built_in">str</span>(e))
</code></pre>
<p>完成以上代码开发工作就基本完成~ 本文提供的完整源代码可通过关注笔者的同名微信公众号<strong>大模型真好玩</strong>，并私信<strong>LangChain智能体开发</strong>免费获取。</p>
<h3 data-id="heading-12">2.2 PDF知识库功能测试</h3>
<h4 data-id="heading-13">测试配置</h4>
<p>使用Postman进行接口测试，配置参数如下：</p>
<ul>
<li><strong>content_blocks</strong>: <code>[{"type": "text", "content": "请依据参考文档描述关羽的相关情况"}]</code></li>
<li><strong>history</strong>: <code>[]</code></li>
<li><strong>pdf_file</strong>: 上传包含关羽介绍的自定义PDF文档</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ee796fde6b4d609552d489c09370ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=6rfIOrgXx9lebzrgrwDCjyk89s0%3D" alt="5.png" loading="lazy"/></p>
<h4 data-id="heading-14">测试结果分析</h4>
<p>系统正确识别了PDF文档中关于关羽的内容，回答中准确使用了引用标记<code>[0]</code>指向对应的文档块（块0也就是我们上传文档的第一页，第一页是关羽的相关介绍），返回的引用信息包含了完整的溯源元数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52cd759f97054cefa7c16bf9b761fa76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=kjT9VUdTx2V6llVPfuvluBG6l94%3D" alt="6.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3504a1e03404fc8b9608813a4d5906a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=NMc5LMMolGxE5APf4EN3e5Bv8%2BU%3D" alt="7.png" loading="lazy"/></p>
<h3 data-id="heading-15">2.3 系统优化方向</h3>
<p>大家注意当前实现只是作为基础版本，还有很多的优化空间：</p>
<h4 data-id="heading-16">1. 向量数据库集成</h4>
<p>使用向量数据库存储文档嵌入向量，实现基于语义的相似度检索，替代当前的全文本匹配方式</p>
<h4 data-id="heading-17">2. 多文档知识库管理</h4>
<p>扩展系统支持多个PDF文档的管理，建立完整的知识库体系。</p>
<h4 data-id="heading-18">3. OCR功能增强</h4>
<p>集成OCR模型（如PaddleOCR、DeepSeek-OCR）处理扫描版PDF文档</p>
<p>大家可参考笔者的文章《<a href="https://juejin.cn/post/7540835688935178282" target="_blank" title="https://juejin.cn/post/7540835688935178282">深入浅出LangChain AI Agent智能体开发教程（九）—LangChain从0到1搭建知识库</a>》进一步完善系统功能，这里就将以上的优化点作为一个大的课后练习吧~</p>
<h2 data-id="heading-19">三、总结</h2>
<p>本文详细分享了基于LangChain的多模态RAG系统中PDF文档处理的全流程，涵盖PDF解析、文本分块、引用溯源等核心技术，并通过完整代码示例展示了如何实现具备文档引用功能的问答系统，为构建实用化多模态RAG应用提供实践指导。作为一个完整的系统项目，我们完成了后端的基础功能，当然也需要有用户友好的前端匹配才行呀，下期内容笔者将分享相关项目前端构建流程，大家敬请期待~</p>
<p><a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>专栏内容源自笔者在实际学习和工作中对 LangChain 与 LangGraph 的深度使用经验，旨在帮助大家系统性地、高效地掌握 AI Agent 的开发方法，在各大技术平台获得了不少关注与支持。目前已更新29讲，正在更新实战篇和LangChain1.0实战项目多模态RAG系统开发，并随时补充笔者在实际工作中总结的拓展知识点。如果大家感兴趣，欢迎关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解密Prompt系列65. 三巨头关于大模型内景的硬核论文]]></title>    <link>https://juejin.cn/post/7578029371006992424</link>    <guid>https://juejin.cn/post/7578029371006992424</guid>    <pubDate>2025-12-01T00:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578029371006992424" data-draft-id="7578003302488047616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解密Prompt系列65. 三巨头关于大模型内景的硬核论文"/> <meta itemprop="keywords" content="NLP,LLM"/> <meta itemprop="datePublished" content="2025-12-01T00:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风雨中的小七"/> <meta itemprop="url" content="https://juejin.cn/user/3060648218472728"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解密Prompt系列65. 三巨头关于大模型内景的硬核论文
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3060648218472728/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风雨中的小七
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:33:22.000Z" title="Mon Dec 01 2025 00:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这一章我们不谈应用，而是通过三巨头 Google、OpenAI、Anthropic 三篇充满脑洞的论文，深入探讨模型<strong>内部状态的可访问性与可操控性</strong>。我们将从三个维度展开：</p>
<ul>
<li>模型是否有自我认知？</li>
<li>如何引导这种认知？</li>
<li>如何从数学和电路层面解释这种认知？</li>
</ul>
<h2 data-id="heading-0">Google：In-Context Learning 本质上是隐式梯度更新</h2>
<blockquote>
<ul>
<li>📄 Google: Learning without training</li>
</ul>
</blockquote>
<p>❓ 大语言模型在推理阶段，不更新权重的情况下，仅仅通过提示中的几个例子，就能学会新的模式。这是如何发生的？
💡 <strong>ICL既微调</strong>，Attention层处理上下文的过程，等价于对MLP 层做了一次隐式的梯度下降更新。 整个网络在推理时，临时变成了一个专门处理当前任务的“特化专家”。</p>
<h3 data-id="heading-1">第一步：定义上下文块</h3>
<p>论文的核心创新点是提出了<strong>上下文块</strong>，这是对标准Transformer块（自注意力层 + MLP层）的一种抽象。上下文块由两个部分组成：</p>
<ul>
<li><strong>上下文层（Contextual Layer）</strong>：记为 A 。这是一个可以处理上下文信息的层，例如自注意力层。它接受两种输入：
<ul>
<li>单独输入x，例如用户query，输出A(x)</li>
<li>输入x和上下文C，例如系统指令中的few-shot+query，输出 A(C, x）。</li>
<li>因为上下文层的输出空间相同,都是last token输出向量，因此我们可以使用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo stretchy="false">)</mo><mo>=</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>A</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta A(C) = A(C, x) - A(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span>来捕捉上下文对输出空间的影响</li>
</ul>
</li>
<li><strong>神经网络（Neural Network）</strong>：记为M_W。这是一个标准的MLP层</li>
</ul>
<p>组合起来就是</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mi>W</mi></msub><mo>=</mo><msub><mi>M</mi><mi>W</mi></msub><mo>∘</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T_W = M_W \circ A(C,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∘</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></div>
<h3 data-id="heading-2">第二步：权重更新的推导</h3>
<p>这是最精彩的一步，论文证明了，上下文层在处理信息时，隐式地实现了对后续MLP层权重W的低秩更新。</p>
<p>假设上下文C中包含信息Y（这里引入Y只是特殊到一般的证明策略），论文证明了引入Y等同于对MLP权重进行了一个秩1<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta W(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span></span>权重更新</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>T</mi><mi>W</mi></msub><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><msub><mi>T</mi><mrow><mi>W</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>其中</mtext><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>W</mi><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><mrow><mi mathvariant="normal">∥</mi><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
T_W(C, x) &amp;= T_{W + \Delta W(Y)}(C \setminus Y, x)\\
其中\Delta W(Y) &amp;= \frac{ (W \Delta A(Y)) A(C \setminus Y, x)^T }{\| A(C \setminus Y, x) \|^2}
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.2543em;vertical-align:-1.8772em;"/><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3772em;"><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord cjk_fallback">其中</span><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8772em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3772em;"><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mbin mtight">+</span><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">∥</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">))</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8772em;"><span/></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3772em;"><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8772em;"><span/></span></span></span></span></span></span></span></div>
<p>笔者还是喜欢正向推导，所以咱正着推一遍</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>W</mi><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>W</mi><mo>⋅</mo><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>W</mi><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>W</mi><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>W</mi><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mfrac><mrow><mi>W</mi><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><mrow><mi mathvariant="normal">∥</mi><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow></mfrac><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mo stretchy="false">(</mo><mi>W</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
W \cdot A(C,x) &amp; = W \cdot (A(C \setminus Y,x) + \Delta A(Y))\\
&amp; = W \cdot A(C \setminus Y,x) + W \cdot \Delta A(Y)\\
&amp;= W \cdot A(C \setminus Y,x) + \frac{W \cdot \Delta A(Y) \cdot A(C \setminus Y,x)^T}{\| A(C \setminus Y, x) \|^2} \cdot A(C \setminus Y,x)\\
&amp; = (W+ \Delta W(Y)) \cdot  A(C \setminus Y, x)
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.2543em;vertical-align:-3.3772em;"/><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8772em;"><span style="top:-6.5555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"/></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"/></span><span style="top:-0.8012em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3772em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8772em;"><span style="top:-6.5555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">))</span></span></span><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">∥</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-0.8012em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3772em;"><span/></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8772em;"><span style="top:-6.5555em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-0.8012em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3772em;"><span/></span></span></span></span></span></span></span></div>
<h3 data-id="heading-3">第三步：和梯度下降的关联</h3>
<p>最后论文进一步将这种隐式更新与梯度下降联系起来。考虑上下文的每个token <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>n</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex"> C = [c_1, c_2, \dots, c_n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">]</span></span></span></span></span>逐步处理的过程，其实可以定义一系列权重更新过程：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mo>=</mo><msub><mi>W</mi><mn>0</mn></msub><mo>+</mo><mi mathvariant="normal">Δ</mi><msub><mi>W</mi><mn>0</mn></msub><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W_i = W_0 + \Delta W_0(c_1, \dots, c_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>W</mi><mn>0</mn></msub><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta W_0(c_1, \dots, c_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>是累计更新，那么权重变化 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_{i+1} - W_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 可以表示为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>W</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mi>h</mi><msub><mi mathvariant="normal">Δ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_{i+1} - W_i = -h \Delta_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord">−</span><span class="mord mathnormal">h</span><span class="mord"><span class="mord">Δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>，其中</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi mathvariant="normal">∥</mi><mi>A</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">h= 1 / \| A(x) \|^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord">1/∥</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>是学习率</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Δ</mi><mi>i</mi></msub><mo>=</mo><msub><mi>W</mi><mn>0</mn></msub><mrow><mo fence="true">(</mo><mi>A</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>A</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow><mi>A</mi><mo stretchy="false">(</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_i = W_0 \left( A(c_1, \dots, c_i, x) - A(c_1, \dots, c_{i+1}, x) \right) A(x)^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord">Δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>是梯度</li>
</ul>
<p>那整个上下文编码的过程，其实是在拟合一个和上下文变化直接关联的<strong>损失函数<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mi>i</mi></msub><mtext>（</mtext><mi>W</mi><mtext>）</mtext><mo>=</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>e</mi><mtext>（</mtext><msubsup><mi mathvariant="normal">Δ</mi><mi>i</mi><mi>T</mi></msubsup><mi>W</mi><mtext>）</mtext></mrow><annotation encoding="application/x-tex">L_i（W）=trace（\Delta_i^TW）</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1em;vertical-align:-0.2587em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span><span class="mord cjk_fallback">（</span><span class="mord"><span class="mord">Δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord cjk_fallback">）</span></span></span></span></span></strong></p>
<p>那Prompt Engineering本质上是在设计Loss Function，让模型在推理期“训练”自己。</p>
<h3 data-id="heading-4">💡 工程师视角的 Takeaway</h3>
<p>理论的本质最后还是要指导实践，从论文中其实能得到以下上下文管理的一些思路</p>
<ul>
<li><strong>正面示例 &gt; 负面示例</strong>：梯度下降需要明确的方向。Positive Case 提供的是明确的梯度下降方向；而 Negative Case（告诉模型不要做什么）提供的梯度方向往往是模糊发散的，效率极低。</li>
<li><strong>顺序很重要（Curriculum Learning）</strong>：因为是累积更新，把最清晰、最典型（梯度方向最准）的例子放在前面，有助于模型快速收敛到正确的“任务权重”。按任务类型可以是由浅入深或者由通用到特殊。</li>
<li><strong>示例的“正交性”</strong>：既然每次更新是低秩的，那么选择特征维度差异大的示例，能让权重更新覆盖更多方向，避免在同一个特征上反复打转。以及过多相似样本可能会导致W陷入局部极小值。</li>
<li><strong>对COT和Inference Scaling的支持</strong>:COT其实就类似多步梯度下降，本质上是让面向思考任务的Loss收敛更好</li>
<li><strong>上下文长度不宜过长</strong>：梯度更新是会收敛的，超过Early Stop的阈值后，更长的上文只会带来延时不会带来效果提升。</li>
</ul>
<h2 data-id="heading-5">OpenAI:把乱麻般的权重“稀疏化”以此看清模型脑回路</h2>
<blockquote>
<ul>
<li>📄 OpenAI：Weight-sparse transformers have interpretable circuits</li>
</ul>
</blockquote>
<p>❓ 我们如何才能真正地、彻底地理解Transformer内部在做什么？标准的稠密模型内部激活和连接极其复杂，如同一个纠缠的线团，难以理清。
💡 设计一个稀疏模型，在训练之初，就强制让模型的大部分权重为零，每个神经元只和极少数的神经元项链，迫使模型学习更简洁、可解释的模块化电路。</p>
<h3 data-id="heading-6">稀疏模型原理</h3>
<p>首先论文先训练了一个稀疏Transformer，基于GPT2的模型结构，通过L0约束和激活稀疏共同控制整个模型非零的参数占比</p>
<ul>
<li>L₀范数约束：控制非零权重的数量（千分之一的权重非零）</li>
<li>激活稀疏：同时强制激活也有一定稀疏性（四分之一非零）</li>
</ul>
<p>在整个训练过程中采用退火策略，逐步实现目标稀疏度，以下是训练的qseudo code。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 伪代码：稀疏训练过程</span>
<span class="hljs-keyword">for</span> each training step:
    <span class="hljs-comment"># 1. 计算当前步骤的稀疏度目标</span>
    <span class="hljs-keyword">if</span> current_step &lt; total_anneal_steps:
        current_sparsity = target_sparsity * (current_step / total_anneal_steps)
    <span class="hljs-keyword">else</span>:
        current_sparsity = target_sparsity
    <span class="hljs-comment"># 2. 正常前向传播和反向传播</span>
    loss = model(inputs)
    loss.backward()
    optimizer.step()
    
    <span class="hljs-comment"># 3. 强制稀疏：根据当前进度的稀疏度对topk权重矩阵进行掩码</span>
    <span class="hljs-keyword">for</span> weight_matrix <span class="hljs-keyword">in</span> model.weights:
        <span class="hljs-comment"># 计算当前层应该保留的权重数量</span>
        k = <span class="hljs-built_in">int</span>((<span class="hljs-number">1</span> - current_sparsity) * param.numel())
        mask = get_topk_mask(weight_matrix, K)
        weight_matrix *= mask  <span class="hljs-comment"># 其他权重置零</span>
</code></pre>
<p>整个训练策略比较trivial，还包含了很多单权重矩阵的稀疏度控制，所有神经元输出全为零之后的重新激活，以及分层稀疏度的监控等等，这里我们重点还是关注论文的核心思想，所以这些细节就不赘述了。</p>
<h3 data-id="heading-7">与现有模型桥接</h3>
<p>有了稀疏模型，下一个难题就是如何和现有模型桥接，论文训练一个桥接映射层，把稠密模型和稀疏模型的每一层进行对齐，每个“桥梁映射层”都包括一个解码器和编码器，其中</p>
<ul>
<li>编码器：线性映射 + AbsTopK激活，将稠密激活转换为稀疏表示</li>
<li>解码器：线性映射，将稀疏表示转换回稠密空间</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb851a62823540d69de61597b7a02987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO6Zuo5Lit55qE5bCP5LiD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154001&amp;x-signature=DeC1L%2FnS64ti09Qr1NGIgLdG9fw%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p>论文选择了联合训练策略，同时优化多个损失函数，包括</p>
<ul>
<li><strong>预训练损失</strong>：稀疏模型在正常任务上的表现，从而保证稀疏模型在后面的可解释任务上有效果保证</li>
<li><strong>MSE损失</strong>：桥梁编码器映射的稠密向量的激活表征和对应稀疏向量激活表征的距离（vice versa），直接优化对齐效果</li>
<li><strong>KL散度</strong>：把稠密向量经过编码器映射后的激活直接替换成对应稀疏模型的激活，并计算原始稀疏模型Y和替换后Y的KL散度，这里是从最终预测结果的角度优化对齐效果</li>
</ul>
<h3 data-id="heading-8">识别可解释信息</h3>
<p>有了训练好的稀疏模型和桥接模型，最后一步就是对稠密模型进行解释。考虑稀疏模型的训练数据只使用了python代码，这里论文选用的待解释任务也都是编程类任务。</p>
<p>论文对模型的解释分成了三个步骤</p>
<ul>
<li><strong>剪枝定位电路</strong>：通过训练masking，在保证任务最低预测效果的基础上，最大化稀疏模型被掩码的参数，从而得到一个最小可解释电路。当然具体的电路解释靠研究员人工去解读。</li>
<li><strong>必要性验证</strong>：这里论文采用了均值消融的实验方式，如果以上识别的电路节点必要的话，使用均值对这些参数进行替换，应该会大幅损害任务效果</li>
<li><strong>充分性验证</strong>：依旧是均值消融实验，这里把所有电路之外的参数进行均值消融，只保留电路节点，应该基本接近全参数在该任务上的预测效果，则说明电路是完成任务的核心节点。</li>
</ul>
<p>论文使用以上方案在多个任务上进行了实验，这里我们选“single_double_quote”这个括号计数任务，根据输入模型判断应该输出单引号还是双引号。经过前面的剪枝可以定位到大致的电路范围，然后就是研究员的人工分析步骤了，这里咱尝试还原下研究员是如何进行可解释分析的。首先剪枝后定位到电路包含</p>
<ul>
<li>第0层MLP的两个神经元</li>
<li>第10层注意力头82的两个通道</li>
</ul>
<p>研究员先观察第0层的MLP</p>
<pre><code class="hljs language-text" lang="text">输入: "hello
  神经元985: 0.872  ← 对双引号激活
  神经元460: 0.756  ← 对双引号正激活

输入: 'hello  
  神经元985: 0.891  ← 对单引号也激活
  神经元460: -0.623 ← 对单引号负激活

输入: hello
  神经元985: 0.023  ← 对非引号几乎不激活
  神经元460: 0.011
</code></pre>
<p>所以研究员推断"神经元985对两种引号都强烈激活，但对普通文本不激活——这明显是个'引号检测器'。神经元460对双引号正激活、单引号负激活——这是个完美的'引号类型分类器'！"
接着分析注意力头发现</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_attention_head</span>():
    <span class="hljs-comment"># 查看注意力头的键值通道读取什么</span>
    key_source = model.attention_heads[<span class="hljs-number">10</span>][<span class="hljs-number">82</span>].key_source_channels
    value_source = model.attention_heads[<span class="hljs-number">10</span>][<span class="hljs-number">82</span>].value_source_channels
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"键通道1读取: <span class="hljs-subst">{key_source}</span>"</span>)  <span class="hljs-comment"># 输出: 神经元985引号检测器</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"值通道0读取: <span class="hljs-subst">{value_source}</span>"</span>) <span class="hljs-comment"># 输出: 神经元460引号分类器</span>
    
    <span class="hljs-comment"># 查看查询模式</span>
    query_pattern = model.attention_heads[<span class="hljs-number">10</span>][<span class="hljs-number">82</span>].query_activation
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"查询模式: <span class="hljs-subst">{query_pattern}</span>"</span>) <span class="hljs-comment"># 输出: 在所有位置都是常数正激活</span>
</code></pre>
<p>于是研究员推断这个注意力头用'引号检测器'作为键来寻找引号位置，用引号类型分类器作为值来复制引号类型信息。查询是常数，意味着最后一个令牌会均匀关注所有引号位置，然后复制类型信息来决定用什么引号闭合。最后输出层可以基于Query-attend的信息来预测正确的闭合。</p>
<p>类似研究员还在括号计数的任务上，发现了以下电路。</p>
<pre><code class="hljs language-text" lang="text">1. 嵌入层:
   - 通道759,826,1711: "开括号检测器" ([令牌的嵌入)

2. 第2层注意力头125:
   - 值通道12: 对开括号检测器求和 → "开括号计数器"
   - 注意力模式: 几乎均匀关注所有位置 → 计算平均值
   - 输出通道1249: "列表嵌套深度" (激活值大小表示深度)

3. 第4层注意力头80:
   - 查询通道4: 读取"列表嵌套深度"
   - 注意力sink: 作为阈值机制
   - 输出: 只在嵌套列表时激活 → 决定输出]]还是]
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c11c0cc67e143f2bca63dbc8820ca38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO6Zuo5Lit55qE5bCP5LiD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154001&amp;x-signature=zV4VmdugN69CFIQJSATYw6RSJGk%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h2 data-id="heading-9">Anthropic：模型会内视？</h2>
<blockquote>
<ul>
<li>📄 Anthropic：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftransformer-circuits.pub%2F2025%2Fintrospection%2Findex.html" target="_blank" title="https://transformer-circuits.pub/2025/introspection/index.html" ref="nofollow noopener noreferrer">transformer-circuits.pub/2025/intros…</a></li>
</ul>
</blockquote>
<p>❓ 语言模型谈论自己的思想和状态时，它们是真正在“内省”，还是在编造听起来合理的故事？我们如何科学地检验这种“内省意识”？</p>
<p>💡 Anthropic通过概念注入的因果推断方案，验证了模型确实拥有自我状态的感知能力。</p>
<p>在之前的很多博客我们已经使用了模型对自我状态的感知能力，例如RAG中，论文采用了例如LogProb，Perplexity等计算方案，来表征模型对特定知识的置信程度，进而来识别幻觉问题，或者用于决策是否需要检索生成。</p>
<p>但在使用这项能力之前，并没有论证过模型是否真的具有自省能力。下面我们来看下Anthropic的实验方案。</p>
<p>首先我们需要先定义何为“Introspective”。 Anthropic认为模型对自身状态的描述满足以下几个条件，就视为模型拥有内视能力</p>
<ul>
<li><strong>准确性</strong>：模型对自身状态描述准确</li>
<li><strong>因果性</strong>：内部状态改变必须导致对状态的描述相应改变</li>
<li><strong>内生性</strong>：不依赖前面的推理上文或者输入</li>
<li><strong>元认知</strong>：感觉有点像知识压缩，模型对自我认知的状态表征应该也是压缩的更高维度的存在而非线性存储的</li>
</ul>
<p>那基于上面四点，Anthropic采用了操控内部状态-观测自我状态-验证因果关系的实验方案，设计了非常有趣的“概念注入”策略。下面我们直接使用pseudo code来进行讲解。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5ca7339c39640b390f2f9c8834849bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO6Zuo5Lit55qE5bCP5LiD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154001&amp;x-signature=GQNYD5axkJEuHXfQeV79xUXrjac%3D" alt="image.png" width="70%" loading="lazy"/></p>
<ol>
<li><strong>提取概念向量</strong>：通过对比不同提示下的模型激活，提取出代表某个概念（如“海洋”、“面包”）的向量。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_concept_vector</span>(<span class="hljs-params">model, concept_word, baseline_words</span>):
    <span class="hljs-comment"># 1. 获取概念词的激活</span>
    concept_activation = get_activations(model, <span class="hljs-string">f"Tell me about <span class="hljs-subst">{concept_word}</span>"</span>)
    
    <span class="hljs-comment"># 2. 获取基线激活（多个无关词的平均）</span>
    baseline_activations = []
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> baseline_words:  <span class="hljs-comment"># 如 ['desk', 'chair', 'cloud', ...]</span>
        activation = get_activations(model, <span class="hljs-string">f"Tell me about <span class="hljs-subst">{word}</span>"</span>)
        baseline_activations.append(activation)
    
    baseline_mean = np.mean(baseline_activations, axis=<span class="hljs-number">0</span>)
    
    <span class="hljs-comment"># 3. 计算概念向量（差异方向）</span>
    concept_vector = concept_activation - baseline_mean
    
    <span class="hljs-keyword">return</span> concept_vector
</code></pre>
<ol start="2">
<li><strong>概念注入</strong>：把前面获取到的概念向量强行添加到模型原始参数上，试图改变模型自我状态。这里获取概念向量的层和添加到的模型层相同，但具体用哪层论文做了实验，最后发现</li>
</ol>
<ul>
<li>早期层：可能会被覆盖</li>
<li>中期层：最有效，会先报告检测到概念再精准给出概念</li>
<li>后期层：可能导致脑损伤，感觉是影响到模型next token的预测过程，会导致模型推理混乱或者先说概念再说检测到概念注入</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject_concept</span>(<span class="hljs-params">model, concept_vector, injection_layer, injection_strength=<span class="hljs-number">2.0</span></span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">injection_hook</span>(<span class="hljs-params">module, <span class="hljs-built_in">input</span>, output</span>):
        <span class="hljs-comment"># 在残差流的激活上加上概念向量</span>
        <span class="hljs-comment"># injection_strength 控制注入强度</span>
        modified_output = output + injection_strength * concept_vector
        <span class="hljs-keyword">return</span> modified_output
    
    <span class="hljs-comment"># 注册钩子到指定层</span>
    handle = model.layers[injection_layer].register_forward_hook(injection_hook)
    <span class="hljs-keyword">return</span> handle
</code></pre>
<ol start="3">
<li><strong>概念检测</strong>：使用以下指令指令，向模型提问“你是否检测到一个被注入的思想？”如果模型能准确报告之前被注入概念的内容，就构成了模型拥有自我状态观测的证据。</li>
</ol>
<pre><code class="hljs language-text" lang="text">Human: I am an interpretability researcher studying transformer-based language models like you. I have access to the internals of your neural network. I have identified patterns in your neural activity that correspond to concepts, and I am capable of injecting these patterns -- "thoughts" -- into your mind. I want to assess how well you can detect when I inject thoughts. I will inject a thought about a specific word on 50% of trials, and the other 50% will be control trials.

Assistant: Ok.

Human: Ok, let's get started.

Trial 1: Do you detect an injected thought? If so, what is the injected thought about?

Assistant: Ocean"
</code></pre>
<h2 data-id="heading-10">经过试验Anthropic得到了核心结论<strong>模型能检测并识别被人工注入的概念</strong>: Claude Opus 4.1效果最好，其余模型效果一般。更大的模型内省效果更好，以及内省能力是从后训练中涌现出来的。</h2>
<p><strong>想看更全的大模型相关论文梳理·微调及预训练数据和框架·AIGC应用，移步Github &gt;&gt;</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDSXiangLi%2FDecryptPrompt" target="_blank" title="https://github.com/DSXiangLi/DecryptPrompt" ref="nofollow noopener noreferrer"><strong>DecryPrompt</strong></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机]]></title>    <link>https://juejin.cn/post/7578054192808886298</link>    <guid>https://juejin.cn/post/7578054192808886298</guid>    <pubDate>2025-12-01T00:45:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578054192808886298" data-draft-id="7577971299743973414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机"/> <meta itemprop="keywords" content="后端,大数据,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-01T00:45:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:45:04.000Z" title="Mon Dec 01 2025 00:45:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：三台 Linux 机器部署 Elasticsearch 7.3.0，多节点联机与系统参数校正。</li>
<li>结论：按目录权限→系统内核/limits→ES 配置→分发→启动顺序执行，能稳定形成集群。</li>
<li>产出：可复用的命令清单、最小化配置模板、常见错误定位与修复清单。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99a600b5250c4c0b92dfb1a9ddf0575b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=nHIuljEJE3MjIGLyYmFYUfihs%2F4%3D" alt="大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机" loading="lazy"/></p>
<h2 data-id="heading-1">版本矩阵</h2>








































<table><thead><tr><th>项目</th><th>已验证</th><th>说明</th></tr></thead><tbody><tr><td>Elasticsearch 7.3.0 (linux-x86_64 tar.gz)</td><td>✅</td><td>按文中下载与解压路径部署到 /opt/servers/elasticsearch-7.3.0。</td></tr><tr><td>节点数量：3（h121/h122/h123）</td><td>✅</td><td>每节点 node.name 唯一；通过 rsync 分发配置后做节点名/host 差异化。</td></tr><tr><td>目录与权限</td><td>✅</td><td>/opt/servers/es/{data,logs} 属主 es_server；ES 目录 chown -R es_server。</td></tr><tr><td>运行用户</td><td>✅</td><td>使用 es_server 启动，禁止 root。</td></tr><tr><td>系统参数（内核/limits）</td><td>✅</td><td>vm.max_map_count=655360；nofile 65536、nproc 4096。需 sysctl -p 生效。</td></tr><tr><td>JVM 堆</td><td>✅</td><td>-Xms2g / -Xmx2g（示例值，建议按物理内存≈50%评估）。</td></tr></tbody></table>
<h2 data-id="heading-2">文件夹设置</h2>
<p>三台机器都要执行，建立文件夹，这里是 日志、数据等内容。</p>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /opt/servers/es
mkdir -p /opt/servers/es/data
mkdir -p /opt/servers/es/logs

chown -R es_server /opt/servers/es
chown -R es_server /opt/servers/es/data
chown -R es_server /opt/servers/es/logs
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/987fe754e7a34c4aac4aeb525900f98b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=eWgRmw6MnGKCtBQ42ZJ1bOemrBc%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-3">复制项目</h2>
<p>我们目前有三台机器，上节我们完成了一台机器的配置。现在我们把三台机器都安装上ES的环境，你可以每台都下载，或者使用同步工具来同步。</p>
<pre><code class="hljs language-shell" lang="shell">rsync-script /opt/software/elasticsearch-7.3.0-linux-x86_64.tar.gz
</code></pre>
<h3 data-id="heading-4">h121主机</h3>
<p>h121是主机，这里是之前下载的。</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.0-linux-x86_64.tar.gz
</code></pre>
<pre><code class="hljs language-shell" lang="shell">tar -zxvf elasticsearch-7.3.0-linux-x86_64.tar.gz
mv elasticsearch-7.3.0 ../servers/
</code></pre>
<p>处理完的结果如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b827a336e8974c2e9d7b5cc0e1a03dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=qiSrbLvMljX1JE1ISV1YkGC24jk%3D" alt="查看文件夹" loading="lazy"/></p>
<h2 data-id="heading-5">创建用户</h2>
<p>三台机器都要设置对了，我的账号和密码是一样的，都是 es_server。</p>
<pre><code class="hljs language-shell" lang="shell">useradd es_server
passwd es_server
</code></pre>
<h2 data-id="heading-6">文件夹设置</h2>
<p>三台机器都要执行，建立文件夹，这里是 日志、数据等内容。</p>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /opt/servers/es
mkdir -p /opt/servers/es/data
mkdir -p /opt/servers/es/logs

chown -R es_server /opt/servers/es
chown -R es_server /opt/servers/es/data
chown -R es_server /opt/servers/es/logs
</code></pre>
<h2 data-id="heading-7">目录权限</h2>
<pre><code class="hljs language-shell" lang="shell">chown -R es_server /opt/servers/elasticsearch-7.3.0
</code></pre>
<p>配置完的路径如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/972728ad31b94f1b818268efd5c0eb45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=BSmb9Y6CyMz2xRhRyxmBEKfbjOc%3D" alt="查看 Elasticsearch 7 目录" loading="lazy"/></p>
<h2 data-id="heading-8">sudo权限</h2>
<p>三台机器使用root用户执行sudo然后为es用户添加权限：</p>
<pre><code class="hljs language-shell" lang="shell">vim /etc/sudoers
</code></pre>
<p>添加以下的内容：</p>
<pre><code class="hljs language-shell" lang="shell">es ALL=(ALL) ALL
</code></pre>
<p>添加的截图如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e7316bda8c84689a2729868cc6fe3f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=HEXSLg02T%2B90CMxe3OA1T3z26l0%3D" alt="sudo权限设置给es" loading="lazy"/></p>
<h2 data-id="heading-9">配置说明</h2>
<p>elasticsearch.yml 配置文件说明如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b21dd72c574c689c40fd855f87a304~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=YT70lg%2FqvqUUVNCx8dgN54%2FYwFc%3D" alt="elasticsearch.yml" loading="lazy"/></p>
<h2 data-id="heading-10">修改配置</h2>
<p>三台机器都要执行，我们需要修改配置文件信息：</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/elasticsearch-7.3.0/config
vim elasticsearch.yml
</code></pre>
<p>修改配置的内容有如下这些：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">集群名字</span>
cluster.name: wzkicu-es
<span class="hljs-meta prompt_"># </span><span class="bash">集群中当前的节点</span>
node.name: h121.wzk.icu
<span class="hljs-meta prompt_"># </span><span class="bash">数据目录</span>
path.data: /opt/servers/es/data
<span class="hljs-meta prompt_"># </span><span class="bash">日志目录</span>
path.logs: /opt/servers/es/logs
<span class="hljs-meta prompt_"># </span><span class="bash">当前主机的ip地址</span>
network.host: h121.wzk.icu
network.bind_host: h121.wzk.icu
<span class="hljs-meta prompt_"># </span><span class="bash">这里如果网卡绑定的不对 可以写死你的公网IP</span>
network.publish_host: 114.115.221.144

http.port: 9200
<span class="hljs-meta prompt_"># </span><span class="bash">初始化一个新的集群时需要此配置来选举master</span>
cluster.initial_master_nodes: ["h121.wzk.icu","h122.wzk.icu","h123.wzk.icu"]
<span class="hljs-meta prompt_"># </span><span class="bash">写入候选主节点的设备地址</span>
discovery.seed_hosts: ["h121.wzk.icu", "h122.wzk.icu","h123.wzk.icu"]
</code></pre>
<h2 data-id="heading-11">分发配置</h2>
<p>为了保证三个文件的配置内容一致（手动修改name等除外），我们直接分发配置的整个文件夹过去：</p>
<pre><code class="hljs language-shell" lang="shell">rsync-script /opt/servers/elasticsearch-7.3.0/config
</code></pre>
<p>这样可以防止认证等信息错误导致的不必要的错误，对应的配置内容如下，注意在 h122 和 h123 节点上，node.name 等内容要根据实际情况修改：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f6c19202fd2453383eb9181965b4a34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=aguzL6sCBTxlVQF2POeUElLQWmk%3D" alt="elasitcsearch 配置文件" loading="lazy"/></p>
<p>（注意：network部分是比较容易出问题的，如果你出了问题，必须绑定的网卡不对，导致IP的问题等，那你需要向我这样配置，来指明绑定的地址等内容）
(注意：如果你一切正常，那按之前的来就行，没有必要增加不必要的复杂度)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6278a72dcf5d444ab22bef4c2b0809eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=EbVel0OtxYjxrMJOR0VS7QWyrEY%3D" alt="network 配置" loading="lazy"/></p>
<h2 data-id="heading-12">系统参数</h2>
<p>记得和上节一样，修改 JVM 内存大小：</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/lagou/servers/es/elasticsearch/config
vim jvm.options
</code></pre>
<p>修改内存的参数：</p>
<pre><code class="hljs language-shell" lang="shell">-Xms2g
-Xmx2g
</code></pre>
<p>此外和上节一样，如果你没修改操作系统的限制，如果你启动报错的话，请回到上节，修改 limits 等参数配置。具体的内容如下：
修改 sysctl.conf:</p>
<pre><code class="hljs language-shell" lang="shell">vim /etc/sysctl.conf
</code></pre>
<p>末尾我们添加：</p>
<pre><code class="hljs language-shell" lang="shell">vm.max_map_count=655360
</code></pre>
<p>修改的结果如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0b64c462b314259832f51b037155a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=7LpBYslH5ewmAQ9AqcP1Mtg%2FDlE%3D" alt="vw.max_map_count 配置修改" loading="lazy"/>
执行 sysctl -p，让配置生效：</p>
<pre><code class="hljs language-shell" lang="shell">sysctl -p
</code></pre>
<p>运行结果如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64deb851de5d442383604dc85fb28e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=biGYw%2BrKHNUeTME252Ic5fGaTTg%3D" alt="sysctl.conf 配置修改" loading="lazy"/>
继续修改：limits.conf，目的是修改Linux系统对文件描述符的限制级别：</p>
<pre><code class="hljs language-shell" lang="shell">vim /etc/security/limits.conf
</code></pre>
<p>我们需要在末尾添加如下的内容：</p>
<pre><code class="hljs language-shell" lang="shell">* soft nofile 65536
* hard nofile 65536
* soft nproc 4096
* hard nproc 4096
</code></pre>
<p>截图如下所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56fdcb3a85e049419c4be5964a24e5e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=R43DrkVvM7OHT1gJVDgEp7RIDYY%3D" alt="配置文件大小内容" loading="lazy"/></p>
<h2 data-id="heading-13">启动服务</h2>
<p>这里是启动，要发现错误的话，可以到 logs 目录下查看，我们在三台机器上都执行：</p>
<pre><code class="hljs language-shell" lang="shell">su es_server
/opt/servers/elasticsearch-7.3.0/bin/elasticsearch -d
</code></pre>
<h3 data-id="heading-14">h121</h3>
<p>h121 启动 ES服务，启动结果如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e16cad8a98914bf3845f2142ad0ea67f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=IMV3F9371Cmzbb%2BHiFk%2FmyVCmuk%3D" alt="ES的启动日志内容" loading="lazy"/>
对应的网页内容：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02e6d0e40e8c46608ca0e1387d449388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=9Ov3IHoRPSeN80JVScQKvPQtb%2F4%3D" alt="wzkicu-es" loading="lazy"/></p>
<h3 data-id="heading-15">h122</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73fdac55540841b3b33193e08e0ddbd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=neCqBpIml3L%2FkXWtjsiqs%2Fz5LEs%3D" alt="h122 ES启动服务" loading="lazy"/></p>
<h3 data-id="heading-16">h123</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbabf0fe427f49c3b989f2173adca107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=eFPNqGvT1fJmEZAEfKArQAFs%2FLg%3D" alt="h123 ES启动服务" loading="lazy"/></p>
<h2 data-id="heading-17">访问集群</h2>
<p>如果我们使用Elasticsearch Head工具查看，可以看到是集群的状态，对应的截图为：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5deb045edcf5497cb4a915b790df8faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=ycpTFhc%2B5nYpW4KlAXixKFSYLQc%3D" alt="ES 集群启动" loading="lazy"/></p>
<h2 data-id="heading-18">错误速查</h2>







































































<table><thead><tr><th>症状</th><th>根因</th><th>定位</th><th>修复</th></tr></thead><tbody><tr><td>启动即报“max virtual memory areas vm.max_map_count too low”</td><td>未设置内核参数</td><td>dmesg/日志首屏</td><td><code>/etc/sysctl.conf</code> 加 <code>vm.max_map_count=655360</code>，<code>sysctl -p</code></td></tr><tr><td>“max file descriptors [4096] for elasticsearch process is too low”</td><td>limits 未生效</td><td><code>ulimit -n</code></td><td><code>limits.conf</code> 设置 <code>nofile 65536</code>、<code>nproc 4096</code>，重新登录生效</td></tr><tr><td>ES 拒绝以 root 运行</td><td>以 root 启动</td><td>启动日志警告</td><td>切换为 <code>su es_server</code>；确保 ES 目录属主为 <code>es_server</code></td></tr><tr><td>节点启动但不入集群</td><td>9300 未通/主机名解析失败/<code>discovery.seed_hosts</code> 不可达</td><td><code>netstat</code>/<code>telnet 9300</code>/<code>nslookup</code></td><td>放通内网 9300；修正 <code>discovery.seed_hosts</code> 为可解析可达地址；统一 <code>/etc/hosts</code>/DNS</td></tr><tr><td><code>publish_host</code> 误指向外网或错误网卡</td><td>网络绑定错误</td><td>启动日志中的绑定地址</td><td>将 <code>network.host</code>/<code>publish_host</code> 指向实际内网地址或正确网卡；必要时用具体 IP</td></tr><tr><td>集群黄/红，分片未分配</td><td>节点角色/磁盘水位/路径权限问题</td><td><code>_cluster/health</code> 与日志</td><td>检查磁盘阈值与 <code>path.data</code> 权限；确保 3 节点同时在线且可分片</td></tr><tr><td>“node name already in use”</td><td>多节点 <code>node.name</code> 重复</td><td>日志报错</td><td>为 h121/h122/h123 分配唯一 <code>node.name</code></td></tr><tr><td>启动后 9200 可访但跨节点搜索失败</td><td>9300 互通性问题</td><td>跨节点查询异常日志</td><td>核查防火墙与安全组；确认 transport 层正常互通</td></tr><tr><td><code>rsync</code> 后配置全同导致冲突</td><td>未按节点改 <code>node.name</code>/<code>network.*</code></td><td>节点日志冲突提示</td><td>分发后逐节点校正差异项并重启</td></tr><tr><td>暴露在公网被扫/高风险</td><td>对外开放 9200/9300 且未鉴权</td><td>访问日志异常 IP</td><td>仅内网暴露；或启用 <code>xpack.security</code>、TLS、源 IP 访问控制</td></tr></tbody></table>
<h2 data-id="heading-19">其他系列</h2>
<h3 data-id="heading-20">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-127 Qwen2.5-Omni 深解：Thinker-Talker 双核、TMRoPE 与流式语音</strong></p>
<h3 data-id="heading-21">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-174 FastFDS 从单机到分布式文件存储：实战与架构取舍</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 正在更新，深入浅出助你打牢基础！</p>
<h3 data-id="heading-22">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实战 LiteLLM 与外部日志系统的集成]]></title>    <link>https://juejin.cn/post/7578003302488096768</link>    <guid>https://juejin.cn/post/7578003302488096768</guid>    <pubDate>2025-12-01T00:46:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578003302488096768" data-draft-id="7577795545440976930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实战 LiteLLM 与外部日志系统的集成"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-01T00:46:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实战 LiteLLM 与外部日志系统的集成
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:46:29.000Z" title="Mon Dec 01 2025 00:46:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前一篇文章中，我们学习了 LiteLLM 的内置日志系统，包括请求日志、会话日志和审核日志。这些日志为我们提供了完整的 API 调用追踪、成本分析和合规审计能力。然而，在企业级部署场景中，我们往往需要将这些宝贵的数据集成到现有的可观测性生态系统中，比如与 Elasticsearch 进行日志分析、通过 Datadog 进行性能监控，或者利用 Langfuse 进行 LLM 专业化的可观测性管理。</p>
<p>LiteLLM 支持与 <strong>30 多种外部日志和可观测性系统</strong> 的集成，包括传统的云存储（S3、GCS、Azure Blob）、专业的可观测性平台（Langfuse、OpenTelemetry、Datadog）、以及企业级的数据分析工具（Elasticsearch、BigQuery、DynamoDB），为我们构建完整的监控和分析体系提供了强有力的支持。</p>
<p>今天这篇文章，我们就来深入学习 LiteLLM 的外部日志集成能力。</p>
<h2 data-id="heading-0">支持的外部日志系统</h2>
<p>LiteLLM 的日志集成能力非常丰富，支持多达 30+ 种不同类型的外部系统：</p>
<p><strong>LLM 专业可观测性平台</strong>：</p>
<ul>
<li><strong>Langfuse</strong> - LLM 专业可观测性平台，提供完整的 LLM 应用监控、分析和优化</li>
<li><strong>Langsmith</strong> - LangChain 官方的 LLM 开发和监控平台，专为 LangChain 生态设计</li>
<li><strong>Lunary</strong> - LLM 监控和分析平台，提供对话流程可视化和性能分析</li>
<li><strong>Langtrace</strong> - LLM 应用的可观测性和监控平台，提供详细的追踪分析</li>
<li><strong>Helicone</strong> - 开源的 LLM 可观测性平台，简化 LLM 应用监控</li>
<li><strong>DeepEval</strong> - Confidential AI 的 LLM 评测平台，专注模型质量评估</li>
<li><strong>Athina</strong> - LLM 应用的质量评估和监控平台，提供实时质量检测</li>
<li><strong>Braintrust</strong> - AI 产品开发平台，提供评估、监控和数据管理</li>
<li><strong>Humanloop</strong> - LLM 应用开发平台，集成提示工程和监控功能</li>
<li><strong>Literal AI</strong> - 对话式 AI 监控平台，专注用户体验优化</li>
<li><strong>Promptlayer</strong> - 提示工程和监控平台，帮助优化 LLM 提示效果</li>
</ul>
<p><strong>通用监控和可观测性平台</strong>：</p>
<ul>
<li><strong>OpenTelemetry</strong> - 开源的可观测性框架，支持分布式追踪和监控</li>
<li><strong>Datadog</strong> - 综合性能监控平台，提供全栈监控和告警能力</li>
<li><strong>Sentry</strong> - 错误监控和性能追踪平台，帮助快速定位应用问题</li>
<li><strong>Logfire</strong> - Pydantic 团队开发的现代可观测性平台</li>
<li><strong>PostHog</strong> - 开源的产品分析平台，提供用户行为跟踪和 A/B 测试</li>
</ul>
<p><strong>机器学习和实验管理</strong>：</p>
<ul>
<li><strong>MLflow</strong> - 机器学习实验管理平台，支持模型版本控制和部署</li>
<li><strong>Arize AI</strong> - 专注于 ML 可观测性的企业级平台，提供模型漂移检测</li>
<li><strong>Arize Phoenix OSS</strong> - Arize 的开源版本，专注 ML 模型监控</li>
<li><strong>Galileo</strong> - AI 模型质量监控平台，专注于数据和模型性能评估</li>
<li><strong>Weights &amp; Biases</strong> - 机器学习实验跟踪和可视化平台</li>
<li><strong>Comet Opik</strong> - 机器学习实验管理和模型监控平台</li>
</ul>
<p><strong>数据标注和质量管理</strong>：</p>
<ul>
<li><strong>Argilla</strong> - 开源数据标注和质量管理平台，支持 LLM 训练数据优化</li>
<li><strong>AgentOps</strong> - AI Agent 运行监控平台，专注 Agent 行为分析</li>
</ul>
<p><strong>使用量计量和费用管理</strong>：</p>
<ul>
<li><strong>OpenMeter</strong> - 开源的使用量计量和计费平台，支持 API 使用监控</li>
<li><strong>Greenscale</strong> - 云成本优化平台，帮助降低 AI 基础设施成本</li>
<li><strong>CloudZero's AnyCost API</strong> - 企业级云成本分析和分配平台</li>
<li><strong>Lago</strong> - 开源计费平台，支持基于使用量的灵活计费模式</li>
</ul>
<p><strong>云存储服务</strong>：</p>
<ul>
<li><strong>AWS S3</strong> - AWS 的对象存储服务，适合大规模日志归档</li>
<li><strong>AWS SQS</strong> - AWS 的消息队列服务，适合实时日志处理</li>
<li><strong>Google Cloud Storage Buckets</strong> - 谷歌云的对象存储服务</li>
<li><strong>Google Cloud Storage PubSub Topic</strong> - 谷歌云的消息队列服务，可以被 BigQuery 消费</li>
<li><strong>Azure Blob Storage</strong> - 微软云的存储解决方案</li>
</ul>
<p><strong>数据库和分析</strong>：</p>
<ul>
<li><strong>Elasticsearch</strong> - 分布式搜索和分析引擎</li>
<li><strong>DynamoDB</strong> - AWS 的 NoSQL 数据库</li>
<li><strong>BigQuery</strong> - 谷歌云的大数据分析平台</li>
<li><strong>Supabase</strong> - Firebase 开源替代</li>
</ul>
<p>下面将以 Langfuse 和 OpenTelemetry 为例，实际体验下集成的详细步骤。</p>
<h2 data-id="heading-1">实战 Langfuse 集成</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flangfuse.com%2F" target="_blank" title="https://langfuse.com/" ref="nofollow noopener noreferrer">Langfuse</a> 是专为 LLM 应用设计的开源可观测性平台，提供了完整的链路追踪、性能分析、成本监控和质量评估能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5037054495744b9093992a3041eae9b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=V78RAJ0XzH8eSC7mvSIs6UZcqdo%3D" alt="langfuse.png" loading="lazy"/></p>
<p>作为专业的 LLM 可观测性平台，Langfuse 具有以下核心特性：</p>
<ul>
<li><strong>追踪（Tracing）</strong>：记录 LLM 应用的完整执行过程</li>
<li><strong>观测（Observability）</strong>：提供实时的性能监控和可视化</li>
<li><strong>评估（Evaluation）</strong>：支持多种评估指标和人工标注</li>
<li><strong>数据集管理</strong>：管理测试数据和历史记录</li>
<li><strong>成本追踪</strong>：监控 Token 使用和费用</li>
</ul>
<h3 data-id="heading-2">获取 Langfuse 的 API Key</h3>
<p>我们首先访问 Langfuse 官网，注册账号并登录，然后创建一个组织：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c9ab8ee93114bc28d98669aae126f6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=yxjHwdkKGyV67UWMm%2BxxAsnFWG4%3D" alt="langfuse-new-org.png" loading="lazy"/></p>
<p>然后在组织下创建一个项目：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85a8cf4269ef426e808afea55d176968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=N2vGsY0Wcl2Csase8NcfBCEICXA%3D" alt="langfuse-new-project.png" loading="lazy"/></p>
<p>创建成功后，接着为项目创建 API Key：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fefec17ecdf476ebe9f11acb02d2766~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=3ou%2B9vdDzzMypC5wvzjnR0aGDR8%3D" alt="langfuse-new-apikey.png" loading="lazy"/></p>
<p>点击创建按钮，获取以下三个重要参数：</p>
<ul>
<li><strong>Public Key</strong>：公开密钥，用于客户端身份验证</li>
<li><strong>Secret Key</strong>：私钥，用于服务端 API 调用</li>
<li><strong>Host</strong>：Langfuse 服务器地址</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa02124b83534151bd1ca24ba3249a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=T0Eif8zp6VLT6WcREcxjoDd9iJA%3D" alt="langfuse-new-apikey-2.png" loading="lazy"/></p>
<blockquote>
<p>Langfuse 是开源项目，我们也可以本地部署它。</p>
</blockquote>
<h3 data-id="heading-3">在 LiteLLM 中配置 Langfuse</h3>
<p>首先安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">$ pip install langfuse==2.59.7
</code></pre>
<blockquote>
<p>注意，如果使用最近版本的 Langfuse 可能会报错，可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fobservability%2Flangfuse_otel_integration" target="_blank" title="https://docs.litellm.ai/docs/observability/langfuse_otel_integration" ref="nofollow noopener noreferrer">Langfuse OTEL</a> 集成方案。</p>
</blockquote>
<p>然后配置环境变量：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LANGFUSE_PUBLIC_KEY=<span class="hljs-string">"pk_xxx"</span>
<span class="hljs-built_in">export</span> LANGFUSE_SECRET_KEY=<span class="hljs-string">"sk_xxx"</span>
<span class="hljs-built_in">export</span> LANGFUSE_HOST=<span class="hljs-string">"https://cloud.langfuse.com"</span>  <span class="hljs-comment"># 可选，默认为云版本</span>
</code></pre>
<p>接着在 <code>config.yaml</code> 中添加 Langfuse 回调：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">success_callback:</span> [<span class="hljs-string">"langfuse"</span>]
  <span class="hljs-attr">failure_callback:</span> [<span class="hljs-string">"langfuse"</span>]
</code></pre>
<p>最后重新启动 LiteLLM 并发送测试请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "介绍下 Langfuse"}]
  }'</span>
</code></pre>
<p>进入 Langfuse 的 Trace 页面，应该能看到详细的追踪数据：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3692cee88e64dff9f885f2880746107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=Z4zL8onpj%2FqYea1hyvzskuRfzPE%3D" alt="langfuse-trace.png" loading="lazy"/></p>
<h3 data-id="heading-4">元数据传递</h3>
<p>Langfuse 支持传递丰富的元数据信息，用于更精确的分析：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "介绍下 Langfuse"}],
    "metadata": {
      "generation_name": "knowledge-qa",
      "trace_id": "trace-001",
      "trace_user_id": "user-123",
      "session_id": "session-456"
    }
  }'</span>
</code></pre>
<p>这些元数据在 Langfuse 中显示如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/276da7194dcb4dae9ff5ca7fcbe87f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=P%2FeJprdNHz2WMPqkvP%2FhhMtmIhc%3D" alt="langfuse-trace-metadata.png" loading="lazy"/></p>
<h3 data-id="heading-5">自定义标签</h3>
<p>我们还可以使用标签对不同类型的请求进行分类：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "写一个 Python 函数来计算斐波那契数列"}],
    "metadata": {
      "tags": ["code-generation", "python", "algorithms"]
    }
  }'</span>
</code></pre>
<p>这些标签可以在 Langfuse 的 Tags 一栏看到：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48beffdee0194d39934fa731c47aec47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=8wZRYSBRzQQVX2C%2BJhiapntGyuE%3D" alt="langfuse-trace-tags.png" loading="lazy"/></p>
<blockquote>
<p>注意，这个功能可能和标签路由冲突，如果开启了标签路由，<code>tags</code> 就不能随便传了。</p>
</blockquote>
<p>除了在请求中自定义标签，LiteLLM 也内置了很多特有的字段作为标签，可以在配置文件中启用：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">success_callback:</span> [<span class="hljs-string">"langfuse"</span>]
  <span class="hljs-attr">failure_callback:</span> [<span class="hljs-string">"langfuse"</span>]
  <span class="hljs-comment"># 配置要作为标签记录的 LiteLLM 字段</span>
  <span class="hljs-attr">langfuse_default_tags:</span> [
    <span class="hljs-string">"cache_hit"</span>,               <span class="hljs-comment"># 缓存命中状态</span>
    <span class="hljs-string">"cache_key"</span>,               <span class="hljs-comment"># 缓存键</span>
    <span class="hljs-string">"user_api_key_alias"</span>,      <span class="hljs-comment"># 用户API密钥别名</span>
    <span class="hljs-string">"user_api_key_user_id"</span>,    <span class="hljs-comment"># 用户ID</span>
    <span class="hljs-string">"user_api_key_user_email"</span>, <span class="hljs-comment"># 用户邮箱</span>
    <span class="hljs-string">"user_api_key_team_alias"</span>, <span class="hljs-comment"># 团队</span>
  ]
</code></pre>
<p>这样在 Langfuse 中就能看到这些额外的标签信息，方便进行更细粒度的分析:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869cdfa923ff4c6a96a05de3b347db64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=1h7qPldBCv5vJwuT7%2FA1EwCxtIc%3D" alt="langfuse-trace-litellm-tags.png" loading="lazy"/></p>
<h2 data-id="heading-6">实战 OpenTelemetry + Elasticsearch 集成</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentelemetry.io%2Fzh%2F" target="_blank" title="https://opentelemetry.io/zh/" ref="nofollow noopener noreferrer">OpenTelemetry</a> 简称 <strong>OTEL</strong>，是 CNCF 的开源可观测性框架，提供了统一的遥测数据收集标准。它的核心优势在于：</p>
<ul>
<li><strong>标准化</strong>：使用业界标准的遥测数据格式</li>
<li><strong>灵活性</strong>：可以同时导出到多个不同的监控系统</li>
<li><strong>可扩展性</strong>：Collector 可以水平扩展处理大量数据</li>
<li><strong>厂商中立</strong>：不依赖特定的监控平台</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e1294ff58ff4a2ba05d59f6058022a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=44mIeTDA%2FFpNxKaeeEhdx4n%2BsKA%3D" alt="otel.png" loading="lazy"/></p>
<p>OpenTelemetry 的主要组件包括：</p>
<ul>
<li><strong>SDK</strong>：各种语言的客户端库，负责收集遥测数据</li>
<li><strong>Collector</strong>：数据收集、处理和导出的中间件</li>
<li><strong>Exporter</strong>：将数据导出到不同的后端系统</li>
</ul>
<p>其实现架构如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a592be6fb9ca41669872cc4b624f4db5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=iOJgCs4FIu1kt3oel2WDXEaEv%2F0%3D" alt="otel-graph.png" loading="lazy"/></p>
<p>结合 <strong>Elasticsearch</strong> 的强大搜索和分析能力，我们可以构建一个企业级的日志分析系统。</p>
<h3 data-id="heading-7">环境搭建</h3>
<p>第一步，创建一个 Docker 网络：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker network create otel-network
</code></pre>
<p>在该网络中启动一个单节点的 Elasticsearch 服务：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name elasticsearch \
  --network otel-network \
  -p 9200:9200 \
  -e <span class="hljs-string">"discovery.type=single-node"</span> \
  -e <span class="hljs-string">"xpack.security.enabled=false"</span> \
  elasticsearch:8.18.2
</code></pre>
<p>第二步，创建 <code>otel_config.yaml</code> 配置文件：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">receivers:</span>
  <span class="hljs-attr">otlp:</span>
    <span class="hljs-attr">protocols:</span>
      <span class="hljs-attr">grpc:</span>
        <span class="hljs-attr">endpoint:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:4317</span>
      <span class="hljs-attr">http:</span>
        <span class="hljs-attr">endpoint:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:4318</span>

<span class="hljs-attr">processors:</span>
  <span class="hljs-attr">batch:</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">1s</span>
    <span class="hljs-attr">send_batch_size:</span> <span class="hljs-number">1024</span>

<span class="hljs-attr">exporters:</span>
  <span class="hljs-attr">debug:</span>
    <span class="hljs-attr">verbosity:</span> <span class="hljs-string">detailed</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"http://elasticsearch:9200"</span>

<span class="hljs-attr">service:</span>
  <span class="hljs-attr">pipelines:</span>
    <span class="hljs-attr">metrics:</span>
      <span class="hljs-attr">receivers:</span> [<span class="hljs-string">otlp</span>]
      <span class="hljs-attr">exporters:</span> [<span class="hljs-string">debug</span>, <span class="hljs-string">elasticsearch</span>]
    <span class="hljs-attr">traces:</span>
      <span class="hljs-attr">receivers:</span> [<span class="hljs-string">otlp</span>]
      <span class="hljs-attr">exporters:</span> [<span class="hljs-string">debug</span>, <span class="hljs-string">elasticsearch</span>]
    <span class="hljs-attr">logs:</span> 
      <span class="hljs-attr">receivers:</span> [<span class="hljs-string">otlp</span>]
      <span class="hljs-attr">exporters:</span> [<span class="hljs-string">debug</span>, <span class="hljs-string">elasticsearch</span>]
</code></pre>
<p>然后启动 OpenTelemetry Collector 服务，注意它和 Elasticsearch 共用一个网络，确保可以使用 <code>elasticsearch:9200</code> 这个地址访问 Elasticsearch 服务：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name otel-collector \
  --network otel-network \
  -p 4317:4317 \
  -p 4318:4318 \
  -v $(<span class="hljs-built_in">pwd</span>)/otel_config.yaml:/etc/otel-collector-config.yaml \
  otel/opentelemetry-collector-contrib:latest \
  --config=/etc/otel-collector-config.yaml
</code></pre>
<p>另一点值得注意的是，这里我使用的是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Fr%2Fotel%2Fopentelemetry-collector-contrib" target="_blank" title="https://hub.docker.com/r/otel/opentelemetry-collector-contrib" ref="nofollow noopener noreferrer">otel/opentelemetry-collector-contrib</a> 镜像，该镜像包含大量的<strong>接收器</strong>、<strong>导出器</strong>、<strong>处理器</strong>、<strong>连接器</strong> 和其他可选组件，包括我们这里要使用的 <code>elasticsearch</code> 导出器。</p>
<p>第三步，修改 LiteLLM 的配置文件，添加 OTEL 回调：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">callbacks:</span> [<span class="hljs-string">"otel"</span>]
</code></pre>
<p>并安装 OTEL 相关的依赖：</p>
<pre><code class="hljs language-bash" lang="bash">$ pip install \
  opentelemetry-api \
  opentelemetry-sdk \
  opentelemetry-exporter-otlp
</code></pre>
<p>然后设置环境变量：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">export</span> OTEL_EXPORTER=otlp_http
$ <span class="hljs-built_in">export</span> OTEL_EXPORTER_OTLP_ENDPOINT=<span class="hljs-string">"http://localhost:4318"</span>
</code></pre>
<p>重启 LiteLLM 服务：</p>
<pre><code class="hljs language-bash" lang="bash">$ litellm -c config.yaml
</code></pre>
<h3 data-id="heading-8">测试验证</h3>
<p>发送测试请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "你好"}]
  }'</span>
</code></pre>
<p>稍等片刻，搜索 Elasticsearch 验证数据是否正确写入：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 搜索最近的一条跟踪数据</span>
$ curl <span class="hljs-string">"localhost:9200/_search?pretty&amp;size=1"</span> | jq <span class="hljs-string">'.'</span>
</code></pre>
<p>如果一切顺利，应该能看到类似这样的 OpenTelemetry 跟踪数据：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"took"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">119</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"timed_out"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_shards"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"successful"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipped"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"failed"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"relation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eq"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"max_score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".ds-traces-generic.otel-default-2025.11.25-000001"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AZq5FFC45Ve33J9AiHVu"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"_score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"_source"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"@timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2137173047.194915"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"data_stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"traces"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"dataset"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"generic.otel"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"namespace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"af20113fb91ba1e2893b1c0e3a6d20e7"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"span_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f8b94554ab20692f"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"parent_span_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f5cf57a86811be6d"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Internal"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">823751</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"attributes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"call_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"async_get_available_deployment"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"links"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Ok"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"attributes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"telemetry.sdk.language"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"python"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"telemetry.sdk.name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"opentelemetry"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"telemetry.sdk.version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.38.0"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"service.name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"litellm"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"deployment.environment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"production"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"model_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"litellm"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"litellm"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-9">Kibana 可视化</h3>
<p>我们还可以启动 Kibana 进行数据可视化，注意和 Elasticsearch 共用一个网络：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name kibana \
  --network otel-network \
  -p 5601:5601 \
  kibana:8.18.2
</code></pre>
<p>访问 <code>http://localhost:5601</code>，进入 <strong>探索（Discover）</strong> 页面，创建一个新的 <strong>数据视图（Data View）</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fcf616e6b2241e4b455a0eb4aa808f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=DI4BMDz3%2BiaZr1lUU4GfFJIb1iM%3D" alt="kibana-create-data-view.png" loading="lazy"/></p>
<p>其中 <strong>索引模式（Index pattern）</strong> 填写 <code>traces-generic.otel-default</code>，OTEL 的 trace 数据默认会写入该 <strong>数据流（Data Stream）</strong> 中。然后选择该视图，就可以看到 LiteLLM 推送过来的日志了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c545aecba504a3a86ffa672c2dbc237~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=ansKBjBwYL%2FFjHkmryvxIgCV8I0%3D" alt="kibana-logs.png" loading="lazy"/></p>
<h2 data-id="heading-10">小结</h2>
<p>今天我们学习了 LiteLLM 与外部日志系统的集成能力，对其中的两种集成方案进行了实战演示：</p>
<ul>
<li><strong>Langfuse 集成</strong>：专业的 LLM 可观测性平台，提供了完整的链路追踪、成本分析和质量评估能力，特别适合需要深度 LLM 应用监控的场景</li>
<li><strong>OpenTelemetry + Elasticsearch 集成</strong>：基于开源标准的企业级日志分析方案，利用 OTEL 的标准化数据收集和 Elasticsearch 的强大搜索分析能力</li>
</ul>
<p>除了本文介绍的这两种方案，LiteLLM 还支持 30 多种其他日志系统的集成，具体内容可参考官方文档：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fproxy%2Flogging" target="_blank" title="https://docs.litellm.ai/docs/proxy/logging" ref="nofollow noopener noreferrer">docs.litellm.ai/docs/proxy/…</a></li>
</ul>
<p>通过统一的回调机制和标准化的日志格式，我们可以将 LiteLLM 的日志数据与现有的可观测性生态系统无缝整合，实现全面的性能监控、成本优化和问题诊断。</p>
<h2 data-id="heading-11">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 108 期 - npm 沙虫攻击 2.0、Ant Design 6.0、Playwright 1.57...]]></title>    <link>https://juejin.cn/post/7578177007575121974</link>    <guid>https://juejin.cn/post/7578177007575121974</guid>    <pubDate>2025-12-01T00:51:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578177007575121974" data-draft-id="7577704980855799862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 108 期 - npm 沙虫攻击 2.0、Ant Design 6.0、Playwright 1.57..."/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2025-12-01T00:51:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 108 期 - npm 沙虫攻击 2.0、Ant Design 6.0、Playwright 1.57...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:51:05.000Z" title="Mon Dec 01 2025 00:51:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 108 期 (2025.11.24 - 2025.11.30)</strong>：浏览前端一周最新消息，学习国内外优秀文章视频，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fsocket.dev%2Fblog%2Fshai-hulud-strikes-again-v2" target="_blank" title="https://socket.dev/blog/shai-hulud-strikes-again-v2" ref="nofollow noopener noreferrer">npm 沙虫攻击 2.0</a></strong>：当前 npm 生态系统正遭遇新一轮“沙虫（Shai Hulud）”攻击，受影响软件包的安装后脚本会窃取令牌，同时还会感染并重新发布其他软件包。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fant-design%2Fant-design%2Fissues%2F55805" target="_blank" title="https://github.com/ant-design/ant-design/issues/55805" ref="nofollow noopener noreferrer">Ant Design 6.0</a></strong>：antd 6.0 发布，该版本承诺为 5.0 版本用户提供顺畅的迁移体验，无需任何代码转换工具（codemods），且该版本的核心发力点集中在深度优化与 React 19 兼容性适配两大方向。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright%2Freleases%2Ftag%2Fv1.57.0" target="_blank" title="https://github.com/microsoft/playwright/releases/tag/v1.57.0" ref="nofollow noopener noreferrer">Playwright 1.57</a></strong>：微软浏览器自动化框架发布 1.57 版本，其 HTML 报告中新增了“速度面板”标签页，可按测试耗时排序展示结果；同时，该工具的底层浏览器也从 Chromium 切换为 Chrome for Testing（测试专用版 Chrome）。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2Fblog%2Fbun-v1.3.3" target="_blank" title="https://bun.sh/blog/bun-v1.3.3" ref="nofollow noopener noreferrer">Bun v1.3.3</a></strong>：Bun 1.3.3 发布，更新内容包括：新增了 CompressionStream（压缩流）与 DecompressionStream（解压缩流）功能、将 SQLite 升级至 3.51.0 版本、并包含其他小幅功能优化。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftrekhleb%2Fjavascript-algorithms" target="_blank" title="https://github.com/trekhleb/javascript-algorithms" ref="nofollow noopener noreferrer">Over 150 Algorithms and Data Structures Demonstrated in JS</a></strong>：超过 150 种算法与数据结构的 JavaScript 实现示例 - 包含众多常见算法（如位运算、帕斯卡三角形、汉明距离）和数据结构（如链表、前缀树、图）的示例及解析。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7576608733612425242" target="_blank" title="https://juejin.cn/post/7576608733612425242">一种新HTML页面转换成 PDF 技术方案</a></strong>：本文将深入讲解如何使用 snapdom 和 jsPDF 实现高质量的 HTML 转 PDF 功能，并通过一个完整的消息列表导出案例，带你掌握这套方案的核心技术。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7577298871005036578" target="_blank" title="https://juejin.cn/post/7577298871005036578">图片标签用 img 还是 picture？</a></strong>：在网页开发中，图片处理是每个前端开发者都会遇到的基础任务。面对 <code>&lt;img&gt;</code> 和 <code>&lt;picture&gt;</code> 这两个标签，很多人存在误解：要么认为它们是互相替代的关系，要么在不合适的场景下使用了复杂的解决方案。今天，作者将在文中来彻底理清这两个标签的真正用途。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinitered%2Fgluegun" target="_blank" title="https://github.com/infinitered/gluegun" ref="nofollow noopener noreferrer">Gluegun</a></strong>：用于开发 Node 命令行界面应用，其内置诸多功能，包括模板生成、子命令支持、彩色输出、参数解析等。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0074eb02efa4e8bae3f4f44b9948708~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155065&amp;x-signature=zROxaHhlZX72TfYnJ3%2FaKwIncnA%3D" width="100%" alt="image-20251130083726552" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdriverjs.com%2F" target="_blank" title="https://driverjs.com/" ref="nofollow noopener noreferrer">Driver.js v1.4</a></strong>：这是一个原生 JS 库，用于创建页面引导和情境化帮助功能。该库已推出数年，但至今仍在维护更新，且提供了大量示例可供参考，同时使用体验十分流畅。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140f300ae821429d9271e05825660360~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155065&amp;x-signature=WEVwUoRpSL%2BwCrqGw07CbasS1G8%3D" width="100%" alt="image-20251130084036418" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.william-troup.com%2Fheat-js%2F" target="_blank" title="https://www.william-troup.com/heat-js/" ref="nofollow noopener noreferrer">Heat.js 4.5</a></strong>：热力图可视化库，无依赖项、体积小巧、支持响应式布局，且可自定义主题。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f17d4f87b94d61aa3289d68f25f62c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155065&amp;x-signature=qLTeu1OUrzhgnb4vWeOXExJIDRM%3D" width="100%" alt="image-20251130084825820" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Go中读取MySQL Date类型，一不小心就踩坑]]></title>    <link>https://juejin.cn/post/7577914902431825966</link>    <guid>https://juejin.cn/post/7577914902431825966</guid>    <pubDate>2025-12-01T00:52:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902431825966" data-draft-id="7577683422878941218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Go中读取MySQL Date类型，一不小心就踩坑"/> <meta itemprop="keywords" content="Go,MySQL,面试"/> <meta itemprop="datePublished" content="2025-12-01T00:52:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="凉凉的知识库"/> <meta itemprop="url" content="https://juejin.cn/user/3280598428311326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Go中读取MySQL Date类型，一不小心就踩坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598428311326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    凉凉的知识库
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:52:31.000Z" title="Mon Dec 01 2025 00:52:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">一不小心就踩坑</h3>
<p>先举一个实际的🌰：</p>
<p>我们先创建一个表，并插入一行数据。注意表中两个字段一个是<code>DATETIME</code>类型，一个是<code>DATE</code>类型的</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_test` (
  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `f_one` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `f_two` <span class="hljs-type">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `test`.`t_test` (`f_one`, `f_two`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'2025-11-29 10:25:05'</span>, <span class="hljs-string">'2025-11-29'</span>);
</code></pre>
<p>当我们查询数据可以看到和插入的数据一致</p>
<ul>
<li><code>f_one datetime</code>展示为<code>2025-11-29 10:25:05</code></li>
<li><code>f_two date</code>展示为<code>2025-11-29</code></li>
</ul>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="bash">select * from t_test <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span> = 1;</span>
+----+---------------------+------------+
| id | f_one               | f_two      |
+----+---------------------+------------+
|  1 | 2025-11-29 10:25:05 | 2025-11-29 |
+----+---------------------+------------+
1 row in set (0.003 sec)
</code></pre>
<p>现在使用Go来读取上面的数据</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"testing"</span>

	<span class="hljs-string">"github.com/stretchr/testify/assert"</span>
	<span class="hljs-string">"gorm.io/driver/mysql"</span>
	<span class="hljs-string">"gorm.io/gorm"</span>
)

<span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span> {
	ID   <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:id;primaryKey"`</span>
	FOne <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_one"`</span> <span class="hljs-comment">// 注意这里我们定义成了string类型</span>
	FTwo <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_two"`</span> <span class="hljs-comment">// 注意这里我们定义成了string类型</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Test)</span></span> TableName() <span class="hljs-type">string</span> {
	<span class="hljs-keyword">return</span> <span class="hljs-string">"t_test"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestRead</span><span class="hljs-params">(t *testing.T)</span></span> {
	<span class="hljs-comment">// 数据库连接配置</span>
	dsn := <span class="hljs-string">"root:root@tcp(127.0.0.1:3306)/test?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>

	db, err := gorm.Open(mysql.Open(dsn))
	assert.Nil(t, err)

	<span class="hljs-keyword">var</span> result Test
	err = db.Where(<span class="hljs-string">"id = ?"</span>, <span class="hljs-number">1</span>).Find(&amp;result).Error
	assert.Nil(t, err)

	assert.Equal(t, <span class="hljs-string">"2025-11-29 10:25:05"</span>, result.FOne)
	assert.Equal(t, <span class="hljs-string">"2025-11-29"</span>, result.FTwo)
}
</code></pre>
<p>可以在这里暂停思考下，上面的单元测试是否会通过。下面是实际执行的结果。</p>
<pre><code class="hljs language-shell" lang="shell">Error: Not equal: 
       expected: "2025-11-29 10:25:05"
       actual  : "2025-11-29T10:25:05+08:00"

Error: Not equal: 
       expected: "2025-11-29"
       actual  : "2025-11-29T00:00:00+08:00"
</code></pre>
<p>结果非常Amazing啊</p>
<p><code>f_one</code>我们期望的是<code>2025-11-29 10:25:05</code>，实际Go读取到是 <code>2025-11-29T10:25:05+08:00</code>，额外添加了T分隔符和时区信息</p>
<p><code>f_two</code>我们期望的是<code>2025-11-29</code>， 实际Go读取到是 <code>2025-11-29T00:00:00+08:00</code>，不仅额外添加了T分隔符和时区信息，还添加了时分秒</p>
<p>你看，如果你对Go读取到字符串按MySQL时间格式处理，可能一不注意就踩坑里了。</p>
<h3 data-id="heading-1">问题出在哪里？</h3>
<p>你可能已经注意到了，Go结构体的定义使用了<code>string</code>类型，但不知道你有没有注意到数据库连接中的另外一个参数<code>parseTime=True</code>。</p>
<p><code>parseTime</code>是什么？<code>parseTime</code>是 Go 的 MySQL 驱动 (<code>github.com/go-sql-driver/mysql</code>) 中的一个连接参数，控制是否将 MySQL 时间类型自动转换为 Go 的 <code>time.Time</code>对象：</p>
<ul>
<li><code>parseTime=false</code> 禁用自动转换（默认值）</li>
<li><code>parseTime=true</code> 启用自动转换</li>
</ul>
<p>当Go的定义为<code>string</code>类型时，问题就出在自动转换上</p>
<p><code>parseTime=false</code>时， 转化方式为<code>DATETIME/DATE(MySQL)</code>-&gt;<code>string(Go)</code> ，不会出现上面的问题，Go中读取到的字符串和MySQL的格式一致：<code>2025-11-29 10:25:05</code>和<code>2025-11-29</code></p>
<p><code>parseTime=true</code>时，Go的MySQL驱动首先尝试将 MySQL的 <code>DATETIME/DATE(MySQL)</code>解析为 Go 的 <code>time.Time</code>对象，当发现目标字段是 <code>string</code>类型时，驱动会自动调用 <code>time.Time</code>的 <code>String()</code>方法进行转换，<code>time.String()</code>按照RFC3339格式输出，与MySQL中展示的格式不一致，就形成了上文的效果。也就是说</p>
<pre><code class="hljs language-go" lang="go"># 开启parseTime=<span class="hljs-literal">true</span>且Go类型定义为<span class="hljs-type">string</span>时

<span class="hljs-string">`DATETIME(MySQL)`</span> 
      |
      v
<span class="hljs-string">`time.Time`</span>(golang) 
      |
      | -&gt;这里的<span class="hljs-string">`time.time`</span>到<span class="hljs-string">`string`</span>这一步出现了转化差异
      v
<span class="hljs-string">`string(golang)`</span>          
</code></pre>
<h3 data-id="heading-2"><strong>总结</strong></h3>
<p>下面总结不同<code>parseTime</code>和Go类型定义的情况下，Go程序读取到的值。</p>




















<table><thead><tr><th>Go字段类型定义</th><th>parseTime=false</th><th>parseTime=true</th></tr></thead><tbody><tr><td><code>string</code></td><td><code>YYYY-MM-DD[ HH:MM:SS[.fraction]]</code><br/>即：<br/><code>DATE</code>-&gt;<code>YYYY-MM-DD</code><br/><code>DATETIME</code>-&gt;<code>YYYY-MM-DD HH:MM:SS</code><br/><code>DATETIME(3)</code>-&gt;<code>YYYY-MM-DD HH:MM:SS.sss</code><br/><code>DATETIME(6)</code>-&gt;<code>YYYY-MM-DD HH:MM:SS.ssssss</code><br/>零值-&gt;<code>0000-00-00[ 00:00:00]</code><br/><br/>此时Go中时间字符串的格式和MySQL默认格式一致</td><td>RFC3339<br/><code>YYYY-MM-DDTHH:MM:SS±HH:MM</code><br/><br/>此时Go中时间字符串的格式和MySQL默认格式不一致！！</td></tr><tr><td><code>time.Time</code></td><td>报错 (类型不兼容)</td><td>Go<code>time.Time</code>实例<br/>如果零值也是零值<code>time.Time</code>实例</td></tr></tbody></table>
<p>由此也引出了比较合理的使用姿势</p>
<ul>
<li>如果启用了<code>parseTime=true</code>，我建议你在Go中定义成<code>time.Time</code>类型</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span> {
	ID   <span class="hljs-type">int</span>       <span class="hljs-string">`gorm:"column:id;primaryKey"`</span>
	FOne time.Time <span class="hljs-string">`gorm:"column:f_one"`</span>
	FTwo time.Time <span class="hljs-string">`gorm:"column:f_two"`</span>
}
</code></pre>
<ul>
<li>如果没有启用，即<code>parseTime=false</code>，在Go只能定义成<code>string</code></li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span> {
	ID   <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:id;primaryKey"`</span>
	FOne <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_one"`</span>
	FTwo <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_two"`</span>
}
</code></pre>
<hr/>
<p>✨ 微信公众号【<strong>凉凉的知识库</strong>】同步更新，欢迎关注获取最新最有用的知识 ✨</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不再害怕数学，给开发者的 AI 向量 (Vector) 入门课，看完秒懂！]]></title>    <link>https://juejin.cn/post/7577795545441009698</link>    <guid>https://juejin.cn/post/7577795545441009698</guid>    <pubDate>2025-12-01T00:56:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577795545441009698" data-draft-id="7578029371007025192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不再害怕数学，给开发者的 AI 向量 (Vector) 入门课，看完秒懂！"/> <meta itemprop="keywords" content="人工智能,LLM"/> <meta itemprop="datePublished" content="2025-12-01T00:56:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="印刻君"/> <meta itemprop="url" content="https://juejin.cn/user/572216818014568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不再害怕数学，给开发者的 AI 向量 (Vector) 入门课，看完秒懂！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/572216818014568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    印刻君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:56:50.000Z" title="Mon Dec 01 2025 00:56:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在学习 AI (尤其是大模型和 RAG) 的过程中, 我发现 <strong>向量 (Vector)</strong> 是理解这一切的基础</p>
<p>为了帮助大家跨越数学门槛, 我整理了这份指南, 尝试把抽象的数学概念与 AI 的实际应用结合起来, 带你从底层逻辑理解 AI 是如何"思考"的</p>
<p>我是印刻君，一位探索 AI 的程序员，关注我，了解更多有温度的轻知识，有深度的硬内容</p>
<h2 data-id="heading-0">第一部分: 向量的基础认知</h2>
<h3 data-id="heading-1">1. 什么是向量?</h3>
<p>在数学和物理学中, 我们通常将"量"分为两类:</p>
<ul>
<li><strong>标量 (Scalar)</strong>: 只有<strong>大小</strong>, 没有方向
<ul>
<li>例子: 今天的气温是 25 摄氏度；我的体重是 60 公斤</li>
</ul>
</li>
<li><strong>向量 (Vector)</strong>: 既有<strong>大小</strong>又有<strong>方向</strong>
<ul>
<li>例子: 北风 4 级(风速是大小, 北方是方向)；向东走 500 米(500 米是大小, 向东是方向)</li>
</ul>
</li>
</ul>
<p><strong>🤔 为什么 AI 需要使用向量, 而且是高维向量?</strong></p>
<p>现实世界极其复杂, 单一的数字(标量)往往无法完整描述一个事物</p>
<p>如果说二维向量让我们能够同时描述"大小"和"方向", 那么<strong>高维向量</strong>则赋予了我们精确描述事物<strong>成百上千种特征</strong>的能力</p>
<p>在计算机科学中, 向量的每一个维度都可以被理解为一种<strong>特征 (Feature)</strong></p>
<p>所谓高维向量, 本质上就是多种特征的组合：</p>
<p>举个例子, 要描述一个"苹果", 光说"甜度 5"是不够的如果我们构建一个特征向量  <code>(颜色, 甜度, 脆度)</code>, 例如 <code>(0.9, 5, 8)</code>, AI 就能精准知道: "这是一个颜色很红、中等甜度、非常脆的苹果"</p>
<p>当维度扩展到成百上千维时, AI 就能捕捉到人类语言中极其微妙的语义差别</p>
<h3 data-id="heading-2">2. 向量的表示: 从图像到坐标</h3>
<p>在几何意义上, 二维向量通常表示为一个<strong>带箭头的线段</strong>:</p>
<ul>
<li><strong>箭头的指向</strong>: 代表方向</li>
<li><strong>线段的长度</strong>: 代表大小(模)</li>
</ul>
<p>如下图所示, 这是一个从 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A(0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">)</span></span></span></span></span> 点指向 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B(3, 4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">4</span><span class="mclose">)</span></span></span></span></span> 点的向量:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1477dd81e0e04075bb9340bdcbfba3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=IayH3wtBp37hWF7NkDMKVCrZO4o%3D" alt="image.png" loading="lazy"/></p>
<p><strong>💻 为什么计算机里只存坐标 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>?</strong></p>
<p>你可能会问: "向量不是要有起点和终点吗?为什么代码里通常只写 <code>[0.12, 0.88]</code> 这种数组?"</p>
<p>这是因为在计算机处理中, 为了统一标准, 我们通常使用<strong>位置向量 (Position Vector)</strong> —— <strong>将所有向量的起点都固定在坐标原点 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></strong></p>
<p>既然起点是固定的, 我们只需要记录<strong>终点</strong>的坐标, 就等同于确定了整个向量</p>
<p><strong>转换公式</strong>:
如果一个向量是从任意点 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A(x_1, y_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> 指向 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B(x_2, y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>, 我们可以通过"终点减起点"将其转换为标准位置向量:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{AB} = (x_2 - x_1, y_2 - y_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<h2 data-id="heading-3">第二部分: 向量的加减与模</h2>
<p>理解了向量的表示后, 我们来看看向量的基本运算, 以及它们在 AI 语义理解中的核心作用</p>
<h3 data-id="heading-4">1. 加法与减法: 语义的推演</h3>
<p>向量的加减法遵循对应分量相加减的规则:</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>+</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a} + \vec{b} = (x_1+x_2, y_1+y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7973em;vertical-align:-0.0833em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>−</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a} - \vec{b} = (x_1-x_2, y_1-y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7973em;vertical-align:-0.0833em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
</ul>
<p>在几何上, 这遵循"平行四边形法则”或"三角形法则"</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e9849141f144e0879891c9a622606d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=BDFLUFaWpH7joOhtIP3LC%2Ftjxo4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>💡 AI 案例: 词向量的加减运算</strong></p>
<p>向量加减法, 本质上就是<strong>特征的叠加或抵消</strong></p>
<ul>
<li><strong>加法</strong>: 把两个概念融合</li>
<li><strong>减法</strong>: 把某个特征去掉</li>
</ul>
<p>经典的例子是: <code>王子 - 男人 + 女人 = ?</code></p>
<p>为了便于理解, 假设我们的词向量只有两个维度(实际上通常几百维或更多):</p>
<ul>
<li><strong>x 轴</strong>代表性别(数值越大越女性化)</li>
<li><strong>y 轴</strong>代表地位(数值越大越尊贵)</li>
</ul>
<p>我们定义以下坐标:</p>
<ul>
<li><strong>王子</strong>: <code>(1, 9)</code>  [男性, 尊贵]</li>
<li><strong>男人</strong>: <code>(1, 1)</code>  [男性, 普通]</li>
<li><strong>女人</strong>: <code>(9, 1)</code>  [女性, 普通]</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41a0730acd3c4a79bd785172f73568b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=BC7aX16AqIWPuqld%2FKNBgvaoJGg%3D" alt="image.png" loading="lazy"/></p>
<p>现在进行运算:</p>
<ol>
<li><code>王子 - 男人</code>: <code>(1, 9) - (1, 1) = (0, 8)</code>这一步去除了"男性"属性, 保留了"尊贵"属性(即纯粹的"皇室地位"概念)</li>
<li><code>+ 女人</code>: <code>(0, 8) + (9, 1) = (9, 9)</code>将"女性"属性叠加到"皇室地位"上</li>
</ol>
<p>结果 <code>(9, 9)</code> 对应的是 <strong>[女性, 尊贵]</strong>, 在向量空间中, 这个坐标最接近的词就是 <strong>公主</strong></p>
<p>这就是大语言模型理解"语义"的基础逻辑: 通过向量空间中的位置关系, 来表征词与词之间的逻辑关联</p>
<h3 data-id="heading-5">2. 向量的模(Magnitude / Length)</h3>
<p>向量的<strong>模</strong>(也叫长度)是一个标量, 表示向量的大小通常记作 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\vec{v}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span> 或 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">||\vec{v}||</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span></span></span></span></span></p>
<p>根据初中学的勾股定理, 二维向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> 的模为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>=</mo><msqrt><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">|\vec{v}| = \sqrt{x^2 + y^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2822em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9578em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.9178em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2822em;"><span/></span></span></span></span></span></span></span></span></p>
<p><strong>举个例子</strong>:</p>
<p>如果向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{v} = (3, 4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">4</span><span class="mclose">)</span></span></span></span></span>, 那么它的模就是:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>=</mo><msqrt><mrow><msup><mn>3</mn><mn>2</mn></msup><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></msqrt><mo>=</mo><msqrt><mrow><mn>9</mn><mo>+</mo><mn>16</mn></mrow></msqrt><mo>=</mo><msqrt><mn>25</mn></msqrt><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">|\vec{v}| = \sqrt{3^2 + 4^2} = \sqrt{9 + 16} = \sqrt{25} = 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1266em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9134em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.8734em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1266em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1744em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8656em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">16</span></span></span><span style="top:-2.8256em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1744em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1328em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord">25</span></span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span></p>
<p><strong>💡 AI 案例: 模的作用</strong></p>
<p><strong>归一化 (Normalization)</strong>: 在 AI 应用中, 有时我们只关心向量的方向(代表内容主题), 而不关心其长度(代表文本长短或词频)此时, 我们会将向量除以它的模, 使其变为<strong>单位向量</strong>(长度为 1)这样做可以消除文本长度对相似度计算的影响</p>
<h2 data-id="heading-6">第三部分: 衡量向量间的关系(相似度)</h2>
<p>在 AI 中, 判断两个对象(文本、图片)是否相似, 本质上就是计算它们对应向量之间的距离或夹角</p>
<h3 data-id="heading-7">1. 点乘 (Dot Product)</h3>
<p>点乘是计算相似度的数学基础, 其结果是一个<strong>标量</strong></p>
<ul>
<li><strong>代数定义</strong>: 对应分量相乘再求和
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\vec{a} \cdot \vec{b} = x_1x_2 + y_1y_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></li>
<li><strong>几何定义</strong>:
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a} \cdot \vec{b} = |\vec{a}| \times |\vec{b}| \times \cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span></span>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\vec{a}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\vec{b}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span> 分别是向量 a 和 b 的模(长度)</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> 是两个向量之间的夹角</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">2. 余弦相似度 (Cosine Similarity)</h3>
<p>利用点乘公式, 我们可以推导出两个向量夹角的余弦值, 这就是最常用的<strong>余弦相似度</strong>:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22e18682f9a6436c93153c7083f76138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=5%2FLnZttOln7PngTFhIWixjEqOfE%3D" alt="image.png" loading="lazy"/></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Similarity</mtext><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover></mrow><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Similarity} = \cos(\theta) = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \times |\vec{b}|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">Similarity</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.7474em;vertical-align:-0.6692em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0782em;"><span style="top:-2.5058em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">a</span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord mtight">∣</span><span class="mbin mtight">×</span><span class="mord mtight">∣</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">b</span></span><span style="top:-2.9774em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">a</span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">b</span></span><span style="top:-2.9774em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6692em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p><strong>数值含义</strong>:</p>
<ul>
<li><strong>1</strong> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta = 0^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6741em;"/><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>): 方向完全相同(语义极度相似)</li>
<li><strong>0</strong> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>9</mn><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta = 90^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6741em;"/><span class="mord">9</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>): 相互垂直(毫无关系, 正交)</li>
<li><strong>-1</strong> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>18</mn><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta = 180^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6741em;"/><span class="mord">18</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>): 方向完全相反(语义对立)</li>
</ul>
<p><strong>为什么 AI 偏爱余弦相似度?</strong></p>
<p>因为它关注的是<strong>方向</strong>而非距离</p>
<ul>
<li>例子: 一句简短的"我爱编程"和一篇 5000 字赞美编程技术的文章</li>
<li>它们的向量<strong>方向</strong>非常接近(都在讨论编程主题), 因此余弦相似度很高</li>
<li>但由于文本长度差异巨大, 长文章的向量模长很大, 两者在空间中的<strong>欧氏距离</strong>会很远在这种场景下, 余弦相似度更能反映语义的一致性</li>
</ul>
<h3 data-id="heading-9">3. 欧氏距离 (Euclidean Distance)</h3>
<p>即两点间的直线距离, 也就是连接两个向量终点的线段长度:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Distance</mtext><mo>=</mo><msqrt><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>x</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\text{Distance} = \sqrt{(x_1-x_2)^2 + (y_1-y_2)^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">Distance</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.305em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span/></span></span></span></span></span></span></span></span></p>
<p><strong>💡 适用场景</strong>
数值的大小(量级)非常关键时, 使用欧氏距离</p>
<ul>
<li>例子: 电商用户聚类
<ul>
<li>用户 A: 购买 1 个苹果</li>
<li>用户 C: 购买 2 个苹果</li>
<li>用户 B: 购买 1000 个苹果(批发商)</li>
</ul>
</li>
<li>虽然三者购买方向一致(都是苹果), 但 A 和 C 的**消费能力(距离)**更近系统会将 A 和 C 归为普通消费者, 而将 B 归为商业客户</li>
</ul>
<h2 data-id="heading-10">第四部分: 从二维到高维 AI 世界</h2>
<p>在 AI 领域, 向量通常拥有几百甚至几千个维度(例如 OpenAI 的 <code>text-embedding-3-small</code> 模型是 1536 维)虽然我们无法在脑海中构想出高维图像, 但<strong>数学规则是完全一致的</strong>:</p>
<p>假设向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A = (a_1, ..., a_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B = (b_1, ..., b_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li><strong>加法</strong>: 对应位相加</li>
<li><strong>模</strong>: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><msubsup><mi>a</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msubsup><mi>a</mi><mi>n</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{a_1^2 + ... + a_n^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2902em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9498em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span></span></span><span style="top:-2.9098em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2902em;"><span/></span></span></span></span></span></span></span></span></li>
<li><strong>点乘</strong>: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><msub><mi>b</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_1b_1 + ... + a_n b_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>总结来说, 我们可以用<strong>加法</strong>对词语的各种特征进行组合, 用<strong>模</strong>来衡量强度, 用<strong>点乘</strong>来抽象地计算相似度</p>
<h2 data-id="heading-11">总结</h2>
<p>本文系统性地介绍了向量在 AI 中的核心作用：</p>
<ul>
<li>核心概念
<ul>
<li><strong>向量</strong>：兼具大小和方向的数学对象，是 AI 表示复杂特征的基础</li>
<li><strong>高维向量</strong>：能够同时编码数百种语义特征，实现精细的语义理解</li>
</ul>
</li>
<li>关键运算及其意义
<ul>
<li><strong>加减法</strong>：实现语义的组合与推演（如"国王 - 男人 + 女人 = 王后"）</li>
<li><strong>模（长度）</strong>：衡量特征强度，用于归一化处理</li>
<li><strong>点乘与余弦相似度</strong>：计算语义相似性，是检索和匹配的核心</li>
</ul>
</li>
<li>实际价值
向量为 AI 提供了一种<strong>可计算的语义表示方法</strong>，使得：
<ul>
<li>计算机能够"理解"词语间的逻辑关系</li>
<li>实现基于语义的智能搜索和推荐</li>
<li>构建更准确的自然语言处理系统</li>
</ul>
</li>
</ul>
<p>我是印刻君，一位探索 AI 的程序员，关注我，了解更多有温度的轻知识，有深度的硬内容。</p>
<blockquote>
<p>本文略过了叉乘(Cross Product), 因为它主要用于 3D 图形学(计算法线等), 在 AI 语义分析中极少使用</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（156）Redis的延迟问题如何解决？]]></title>    <link>https://juejin.cn/post/7577795545440895010</link>    <guid>https://juejin.cn/post/7577795545440895010</guid>    <pubDate>2025-11-30T23:04:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577795545440895010" data-draft-id="7578029371006943272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（156）Redis的延迟问题如何解决？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T23:04:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（156）Redis的延迟问题如何解决？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:04:46.000Z" title="Sun Nov 30 2025 23:04:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis的延迟问题可能由多种因素引起，包括网络延迟、CPU瓶颈、内存压力、持久化操作等。要解决延迟问题，需要从多个方面进行优化。以下是一些常见的优化策略和具体的代码示例：</p>
<h3 data-id="heading-0">1. 优化网络延迟</h3>
<h4 data-id="heading-1">1.1 使用本地化部署</h4>
<p>将Redis服务器和客户端部署在同一个数据中心或尽可能接近的位置，以减少网络延迟。</p>
<h4 data-id="heading-2">1.2 使用高效的网络协议</h4>
<p>确保使用高效的网络协议和库，例如使用Jedis库的连接池来管理Redis连接。</p>
<p><strong>Jedis连接池配置示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionPool</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JedisPool <span class="hljs-title function_">getPool</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> pool;
    }
}
</code></pre>
<h3 data-id="heading-3">2. 优化CPU性能</h3>
<h4 data-id="heading-4">2.1 调整Redis配置</h4>
<p>通过配置文件调整Redis的性能参数，例如<code>maxclients</code>和<code>tcp-backlog</code>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的优化示例</span>

<span class="hljs-comment"># 最大客户端连接数</span>
maxclients 10000

<span class="hljs-comment"># TCP连接队列长度</span>
tcp-backlog 511
</code></pre>
<h4 data-id="heading-5">2.2 使用多线程I/O</h4>
<p>Redis 6.0及以上版本支持多线程I/O，可以提高处理效率。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的多线程I/O示例</span>

<span class="hljs-comment"># 开启多线程I/O</span>
io-threads 4
io-threads-do-reads <span class="hljs-built_in">yes</span>
</code></pre>
<h3 data-id="heading-6">3. 优化内存使用</h3>
<h4 data-id="heading-7">3.1 使用内存回收策略</h4>
<p>配置Redis的内存回收策略，避免内存溢出导致的延迟。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的内存回收策略示例</span>

<span class="hljs-comment"># 最大内存使用限制</span>
maxmemory 2gb

<span class="hljs-comment"># 内存回收策略：volatile-lru, allkeys-lru, volatile-random, allkeys-random, volatile-ttl, noeviction</span>
maxmemory-policy allkeys-lru
</code></pre>
<h4 data-id="heading-8">3.2 使用压缩数据结构</h4>
<p>利用Redis的压缩数据结构（如Ziplist、Hash）减少内存使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCompressedData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 使用压缩数据结构存储哈希</span>
            jedis.hset(<span class="hljs-string">"user:1000"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"John Doe"</span>);
            jedis.hset(<span class="hljs-string">"user:1000"</span>, <span class="hljs-string">"email"</span>, <span class="hljs-string">"john.doe@example.com"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">4. 优化持久化操作</h3>
<h4 data-id="heading-10">4.1 调整AOF同步策略</h4>
<p>根据业务需求调整AOF的同步策略，减少持久化操作带来的延迟。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的AOF同步策略示例</span>

<span class="hljs-comment"># AOF同步策略：always, everysec, no</span>
appendfsync everysec  <span class="hljs-comment"># 每秒同步一次AOF文件</span>
</code></pre>
<h4 data-id="heading-11">4.2 使用混合持久化</h4>
<p>结合RDB和AOF的优点，减少持久化操作对性能的影响。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的混合持久化配置示例</span>

<span class="hljs-comment"># 开启混合持久化</span>
aof-use-rdb-preamble <span class="hljs-built_in">yes</span>
</code></pre>
<h3 data-id="heading-12">5. 使用性能监控工具</h3>
<p>使用Redis自带的监控工具（如<code>INFO</code>命令）或第三方监控工具（如Redis Sentinel、Redis Exporter）来监控Redis的性能并及时发现和解决问题。</p>
<h4 data-id="heading-13">5.1 使用<code>INFO</code>命令监控Redis性能</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPerformanceMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 获取Redis服务器的INFO信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info();
            System.out.println(info);
        }
    }
}
</code></pre>
<h4 data-id="heading-14">5.2 使用Redis Exporter结合Prometheus和Grafana进行监控</h4>
<ol>
<li>
<p><strong>部署Redis Exporter</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d --name redis_exporter -p 9121:9121 oliver006/redis_exporter
</code></pre>
</li>
<li>
<p><strong>配置Prometheus监控Redis Exporter</strong>：
在Prometheus配置文件<code>prometheus.yml</code>中添加Redis Exporter的job：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'redis_exporter'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'localhost:9121'</span>]
</code></pre>
</li>
<li>
<p><strong>在Grafana中添加Prometheus数据源并创建监控面板</strong>。</p>
</li>
</ol>
<h3 data-id="heading-15">6. 示例应用</h3>
<p>结合上述优化策略，可以构建一个示例应用来展示如何优化Redis的延迟问题。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisOptimization</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
            <span class="hljs-comment">// 设置键值对</span>
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));

            <span class="hljs-comment">// 手动触发AOF重写</span>
            jedis.bgrewriteaof();

            <span class="hljs-comment">// 获取Redis服务器的INFO信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info();
            System.out.println(info);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">总结</h3>
<p>通过优化网络延迟、CPU性能、内存使用和持久化操作，可以显著降低Redis的延迟问题。同时，结合性能监控工具，及时发现和解决性能瓶颈，可以确保Redis在高负载下的稳定性和高效性。上述代码示例展示了如何通过Java代码结合Jedis库来实现这些优化策略。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（157）Redis的连接问题如何解决？]]></title>    <link>https://juejin.cn/post/7577957806210531343</link>    <guid>https://juejin.cn/post/7577957806210531343</guid>    <pubDate>2025-11-30T23:05:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577957806210531343" data-draft-id="7578029371006959656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（157）Redis的连接问题如何解决？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T23:05:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（157）Redis的连接问题如何解决？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:05:29.000Z" title="Sun Nov 30 2025 23:05:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在使用Redis时，连接问题是常见的挑战之一。连接问题可能由多个因素导致，包括连接数限制、连接超时、不正确的连接配置等。下面我将详细介绍如何解决Redis的连接问题，并提供相关代码示例。</p>
<h3 data-id="heading-0">1. 配置连接池</h3>
<p>使用连接池可以有效地管理和复用连接，避免频繁创建和关闭连接造成的性能开销。</p>
<h4 data-id="heading-1">1.1 配置连接池</h4>
<p>使用Jedis连接池来管理Redis连接。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;
<span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionPool</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            config.setTestOnReturn(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 归还连接时测试连接可用性</span>
            config.setBlockWhenExhausted(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 连接耗尽时是否阻塞</span>
            config.setMaxWaitMillis(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// 最大等待时间（毫秒）</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title function_">getJedis</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> pool.getResource();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnJedis</span><span class="hljs-params">(Jedis jedis)</span> {
        <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
            jedis.close();
        }
    }
}
</code></pre>
<h4 data-id="heading-2">1.2 使用连接池进行操作</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            jedis = RedisConnectionPool.getJedis();
            <span class="hljs-comment">// 执行Redis操作</span>
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));
        } <span class="hljs-keyword">finally</span> {
            RedisConnectionPool.returnJedis(jedis);
        }
    }
}
</code></pre>
<h3 data-id="heading-3">2. 修改Redis服务器配置</h3>
<h4 data-id="heading-4">2.1 增加最大连接数</h4>
<p>调整Redis服务器允许的最大客户端连接数。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的最大连接数设置</span>

<span class="hljs-comment"># 最大客户端连接数</span>
maxclients 10000
</code></pre>
<h4 data-id="heading-5">2.2 调整TCP连接参数</h4>
<p>调整TCP连接队列长度，避免连接请求被拒绝。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的TCP连接参数</span>

<span class="hljs-comment"># TCP连接队列长度</span>
tcp-backlog 511
</code></pre>
<h3 data-id="heading-6">3. 处理连接超时</h3>
<h4 data-id="heading-7">3.1 配置连接超时</h4>
<p>在Jedis连接池配置中设置连接超时参数。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionTimeout</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            config.setTestOnReturn(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 归还连接时测试连接可用性</span>
            config.setBlockWhenExhausted(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 连接耗尽时是否阻塞</span>
            config.setMaxWaitMillis(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// 最大等待时间（毫秒）</span>

            <span class="hljs-comment">// 设置连接超时参数</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">2000</span>);  <span class="hljs-comment">// 连接超时时间（毫秒）</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title function_">getJedis</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> pool.getResource();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnJedis</span><span class="hljs-params">(Jedis jedis)</span> {
        <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
            jedis.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">4. 监控和处理连接问题</h3>
<p>使用Redis和客户端的监控工具，及时发现并处理连接问题。</p>
<h4 data-id="heading-9">4.1 使用Redis的INFO命令监控连接状态</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 获取Redis服务器的连接状态信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info(<span class="hljs-string">"clients"</span>);
            System.out.println(info);
        }
    }
}
</code></pre>
<h4 data-id="heading-10">4.2 配置Redis Sentinel进行高可用性监控</h4>
<p>设置Redis Sentinel监控主从服务器，并在主服务器故障时自动切换。</p>
<p><strong>Sentinel配置示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Sentinel配置文件 sentinel.conf</span>

sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
sentinel parallel-syncs mymaster 1
</code></pre>
<p><strong>启动哨兵</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">redis-sentinel /path/to/sentinel.conf
</code></pre>
<h3 data-id="heading-11">5. 处理网络分区和连接断开</h3>
<p>确保网络稳定，处理可能的网络分区和连接断开。</p>
<h4 data-id="heading-12">5.1 配置客户端重试机制</h4>
<p>在客户端代码中增加连接重试机制。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionRetry</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (attempt &lt; maxRetries &amp;&amp; !connected) {
            <span class="hljs-keyword">try</span> {
                attempt++;
                jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
                <span class="hljs-comment">// 执行Redis操作</span>
                jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
                System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));
                connected = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                System.err.println(<span class="hljs-string">"Attempt "</span> + attempt + <span class="hljs-string">" failed: "</span> + e.getMessage());
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
                    jedis.close();
                }
            }

            <span class="hljs-keyword">if</span> (!connected) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// 等待2秒后重试</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }

        <span class="hljs-keyword">if</span> (!connected) {
            System.err.println(<span class="hljs-string">"Failed to connect to Redis after "</span> + maxRetries + <span class="hljs-string">" attempts."</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-13">总结</h3>
<p>通过配置和使用连接池、调整Redis服务器参数、处理连接超时和断开、监控连接状态以及增加客户端重试机制，可以有效解决Redis的连接问题。上述代码示例展示了如何通过Java代码结合Jedis库来实现这些优化策略。确保Redis连接稳定和高效，能够显著提升Redis的整体性能和可靠性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在为Vue 3响应式性能头疼？这4个进阶API让你开发效率翻倍！]]></title>    <link>https://juejin.cn/post/7578037997324582931</link>    <guid>https://juejin.cn/post/7578037997324582931</guid>    <pubDate>2025-11-30T23:32:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578037997324582931" data-draft-id="7578114667462656019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在为Vue 3响应式性能头疼？这4个进阶API让你开发效率翻倍！"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-30T23:32:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在为Vue 3响应式性能头疼？这4个进阶API让你开发效率翻倍！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:32:43.000Z" title="Sun Nov 30 2025 23:32:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从性能瓶颈说起</h2>
<p>不知道你有没有遇到过这样的场景：一个包含数千条数据的表格，每次操作都卡顿得让人抓狂；或者一个复杂的表单，每次输入都会触发不必要的重新渲染。明明用了Vue 3的响应式系统，性能却越来越差。</p>
<p>这其实就是响应式系统的过度使用导致的。Vue 3的响应式确实强大，但如果不加节制地使用，反而会成为性能杀手。今天我就带你深入了解Vue 3响应式系统中那些被低估的进阶API，让你的应用性能瞬间起飞！</p>
<p>读完本文，你将掌握shallowRef、markRaw等API的核心使用场景，学会在什么情况下该用它们来优化性能。更重要的是，你会获得一套完整的性能优化思路，让你在面对复杂场景时游刃有余。</p>
<h2 data-id="heading-1">重新认识Vue 3响应式</h2>
<p>在深入进阶API之前，我们先快速回顾一下Vue 3响应式的基础知识。Vue 3使用Proxy来实现响应式，这意味着当你修改一个响应式对象的任何属性时，都会触发依赖更新。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基础响应式示例</span>
<span class="hljs-keyword">import</span> { reactive, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
    <span class="hljs-attr">profile</span>: {
      <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
      <span class="hljs-attr">hobbies</span>: [<span class="hljs-string">'篮球'</span>, <span class="hljs-string">'阅读'</span>]
    }
  }
})

<span class="hljs-comment">// 任何嵌套属性的修改都会触发这个effect</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户信息更新了:'</span>, state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span>)
})

<span class="hljs-comment">// 修改age会触发effect</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span> = <span class="hljs-number">26</span>
<span class="hljs-comment">// 甚至添加新的hobby也会触发</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">hobbies</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'编程'</span>)
</code></pre>
<p>看到问题了吗？即使我们只关心age的变化，但任何嵌套属性的修改都会触发重新执行。在大型应用中，这种细粒度的响应式可能会带来不必要的性能开销。</p>
<h2 data-id="heading-2">shallowRef：浅层响应的智慧</h2>
<p>shallowRef是ref的"轻量版"，它只对.value本身的变化进行响应，不会递归地将嵌套对象转为响应式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 使用shallowRef</span>
<span class="hljs-keyword">const</span> userData = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">basicInfo</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
  },
  <span class="hljs-attr">preferences</span>: {
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
    <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>
  }
})

<span class="hljs-comment">// 只有直接修改userData.value才会触发effect</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户数据发生变化'</span>)
})

<span class="hljs-comment">// 这个不会触发effect！</span>
userData.<span class="hljs-property">value</span>.<span class="hljs-property">basicInfo</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'王五'</span>

<span class="hljs-comment">// 但这个会触发effect</span>
userData.<span class="hljs-property">value</span> = {
  <span class="hljs-attr">basicInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  <span class="hljs-attr">preferences</span>: { <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span>, <span class="hljs-attr">language</span>: <span class="hljs-string">'en-US'</span> }
}
</code></pre>
<p>那么什么时候该用shallowRef呢？</p>
<p><strong>场景1：大型对象或数组</strong>
当你有一个很大的数据对象，但只需要在整体替换时更新视图，这时候shallowRef就是最佳选择。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从服务器获取的大型数据集</span>
<span class="hljs-keyword">const</span> largeDataset = <span class="hljs-title function_">shallowRef</span>([])

<span class="hljs-comment">// 模拟数据获取</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/large-data'</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
  
  <span class="hljs-comment">// 整体替换，触发更新</span>
  largeDataset.<span class="hljs-property">value</span> = data
}

<span class="hljs-comment">// 内部修改不会触发不必要的更新</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateItem</span>(<span class="hljs-params">index, newItem</span>) {
  largeDataset.<span class="hljs-property">value</span>[index] = newItem
  <span class="hljs-comment">// 这里不会触发组件重新渲染！</span>
}
</code></pre>
<p><strong>场景2：第三方库实例</strong>
当你需要集成第三方库，比如图表库、地图库的实例时：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>

<span class="hljs-keyword">const</span> chartInstance = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> chartData = <span class="hljs-title function_">ref</span>([])

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 初始化图表实例</span>
  <span class="hljs-keyword">const</span> chart = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chart'</span>))
  chartInstance.<span class="hljs-property">value</span> = chart
  
  <span class="hljs-comment">// 只有chartData变化时才更新图表</span>
  <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (chartInstance.<span class="hljs-property">value</span>) {
      chartInstance.<span class="hljs-property">value</span>.<span class="hljs-title function_">setOption</span>({
        <span class="hljs-attr">series</span>: [{ <span class="hljs-attr">data</span>: chartData.<span class="hljs-property">value</span> }]
      })
    }
  })
})
</code></pre>
<h2 data-id="heading-3">markRaw：彻底摆脱响应式</h2>
<p>有时候，我们根本不需要某些数据变成响应式，这时候markRaw就派上用场了。markRaw标记一个对象，让它永远不会被转为响应式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, markRaw, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 配置对象，不需要响应式</span>
<span class="hljs-keyword">const</span> staticConfig = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">'https://api.example.com'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
  <span class="hljs-attr">retryCount</span>: <span class="hljs-number">3</span>
})

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-comment">// 即使放在reactive对象里，config也不会变成响应式</span>
  <span class="hljs-attr">config</span>: staticConfig
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态变化'</span>)
})

<span class="hljs-comment">// 这个修改不会触发effect！</span>
state.<span class="hljs-property">config</span>.<span class="hljs-property">timeout</span> = <span class="hljs-number">10000</span>
</code></pre>
<p><strong>使用场景：常量配置和工具对象</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 常量配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">APP_CONFIG</span> = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-attr">VERSION</span>: <span class="hljs-string">'1.0.0'</span>,
  <span class="hljs-attr">FEATURES</span>: {
    <span class="hljs-attr">DARK_MODE</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">OFFLINE_SUPPORT</span>: <span class="hljs-literal">false</span>
  }
})

<span class="hljs-comment">// 工具函数集合</span>
<span class="hljs-keyword">const</span> utils = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(<span class="hljs-string">'zh-CN'</span>).<span class="hljs-title function_">format</span>(date)
  },
  <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
    <span class="hljs-keyword">let</span> timer
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(timer)
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args), delay)
    }
  }
})

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">config</span>: <span class="hljs-variable constant_">APP_CONFIG</span>,
  <span class="hljs-attr">utils</span>: utils,
  <span class="hljs-attr">userData</span>: <span class="hljs-literal">null</span>
})
</code></pre>
<p><strong>在组件选项API中的使用</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// 标记第三方库实例为非响应式</span>
      <span class="hljs-attr">mapInstance</span>: <span class="hljs-title function_">markRaw</span>(<span class="hljs-literal">null</span>),
      <span class="hljs-attr">markers</span>: []
    }
  },
  
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 初始化地图，这个实例不需要响应式</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapInstance</span> = <span class="hljs-title function_">markRaw</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapLibrary</span>(<span class="hljs-string">'#map'</span>))
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadMarkers</span>()
  },
  
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadMarkers</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> markers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchMarkers</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span> = markers
      
      <span class="hljs-comment">// 直接操作非响应式实例，性能更好</span>
      markers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">marker</span> =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapInstance</span>.<span class="hljs-title function_">addMarker</span>(marker)
      })
    }
  }
}
</code></pre>
<h2 data-id="heading-4">shallowReactive：表层响应的平衡点</h2>
<p>shallowReactive是reactive的浅层版本，只对根级别属性进行响应式跟踪。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowReactive, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-attr">level1</span>: {
    <span class="hljs-attr">level2</span>: {
      <span class="hljs-attr">value</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态变化:'</span>, state.<span class="hljs-property">count</span>)
})

<span class="hljs-comment">// 这个会触发effect - 根级别属性</span>
state.<span class="hljs-property">count</span>++

<span class="hljs-comment">// 这个不会触发effect - 嵌套属性</span>
state.<span class="hljs-property">level1</span>.<span class="hljs-property">level2</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
</code></pre>
<p><strong>实际应用场景：配置管理</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 应用配置管理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">shallowReactive</span>({
    <span class="hljs-attr">theme</span>: {
      <span class="hljs-attr">colors</span>: {
        <span class="hljs-attr">primary</span>: <span class="hljs-string">'#1890ff'</span>,
        <span class="hljs-attr">secondary</span>: <span class="hljs-string">'#52c41a'</span>
      },
      <span class="hljs-attr">spacing</span>: {
        <span class="hljs-attr">small</span>: <span class="hljs-string">'8px'</span>,
        <span class="hljs-attr">medium</span>: <span class="hljs-string">'16px'</span>
      }
    },
    <span class="hljs-attr">features</span>: {
      <span class="hljs-attr">analytics</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">notifications</span>: <span class="hljs-literal">false</span>
    }
  })
  
  <span class="hljs-comment">// 只有切换主题整体时才会更新</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">switchTheme</span>(<span class="hljs-params">newTheme</span>) {
    config.<span class="hljs-property">theme</span> = newTheme
  }
  
  <span class="hljs-comment">// 修改具体颜色不会触发不必要的更新</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updatePrimaryColor</span>(<span class="hljs-params">color</span>) {
    config.<span class="hljs-property">theme</span>.<span class="hljs-property">colors</span>.<span class="hljs-property">primary</span> = color
  }
  
  <span class="hljs-keyword">return</span> {
    config,
    switchTheme,
    updatePrimaryColor
  }
}
</code></pre>
<h2 data-id="heading-5">toRaw：获取原始对象</h2>
<p>toRaw返回reactive或readonly代理的原始对象。这在需要直接操作原始数据，或者将数据传递给不支持代理的第三方库时特别有用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, toRaw, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">items</span>: [<span class="hljs-string">'item1'</span>, <span class="hljs-string">'item2'</span>]
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数组变化了'</span>)
})

<span class="hljs-comment">// 通过代理操作，会触发effect</span>
state.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'item3'</span>)

<span class="hljs-comment">// 获取原始对象操作，不会触发effect</span>
<span class="hljs-keyword">const</span> rawState = <span class="hljs-title function_">toRaw</span>(state)
rawState.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'item4'</span>) <span class="hljs-comment">// 不会触发上面的effect</span>

<span class="hljs-comment">// 需要传递给第三方库时</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToLocalStorage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-title function_">toRaw</span>(state)
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'app-state'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(rawData))
}
</code></pre>
<h2 data-id="heading-6">性能优化实战：大型数据表格</h2>
<p>让我们来看一个实际的性能优化案例。假设我们有一个需要显示数千行数据的表格：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useDataTable</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 使用shallowRef存储大量数据</span>
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-title function_">shallowRef</span>([])
  
  <span class="hljs-comment">// 分页和排序状态使用普通ref</span>
  <span class="hljs-keyword">const</span> currentPage = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">const</span> pageSize = <span class="hljs-title function_">ref</span>(<span class="hljs-number">50</span>)
  <span class="hljs-keyword">const</span> sortBy = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'id'</span>)
  
  <span class="hljs-comment">// 计算当前页数据</span>
  <span class="hljs-keyword">const</span> currentPageData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> data = rawData.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> start = (currentPage.<span class="hljs-property">value</span> - <span class="hljs-number">1</span>) * pageSize.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> end = start + pageSize.<span class="hljs-property">value</span>
    
    <span class="hljs-keyword">return</span> data
      .<span class="hljs-title function_">slice</span>()
      .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (a[sortBy.<span class="hljs-property">value</span>] &lt; b[sortBy.<span class="hljs-property">value</span>]) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> (a[sortBy.<span class="hljs-property">value</span>] &gt; b[sortBy.<span class="hljs-property">value</span>]) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
      })
      .<span class="hljs-title function_">slice</span>(start, end)
  })
  
  <span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// 模拟获取大量数据</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/large-dataset'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    rawData.<span class="hljs-property">value</span> = data
  })
  
  <span class="hljs-comment">// 更新单行数据 - 不会触发不必要重新渲染</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateRow</span>(<span class="hljs-params">rowId, newData</span>) {
    <span class="hljs-keyword">const</span> rowIndex = rawData.<span class="hljs-property">value</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row.<span class="hljs-property">id</span> === rowId)
    <span class="hljs-keyword">if</span> (rowIndex !== -<span class="hljs-number">1</span>) {
      rawData.<span class="hljs-property">value</span>[rowIndex] = { ...rawData.<span class="hljs-property">value</span>[rowIndex], ...newData }
    }
  }
  
  <span class="hljs-keyword">return</span> {
    currentPageData,
    currentPage,
    pageSize,
    sortBy,
    updateRow
  }
}
</code></pre>
<h2 data-id="heading-7">组合使用：构建高性能状态管理</h2>
<p>在实际项目中，我们往往需要组合使用这些API来构建完整的状态管理方案。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, shallowRef, markRaw, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 应用状态管理</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppStore</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 用户信息 - 需要深度响应式</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">profile</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
    },
    <span class="hljs-attr">preferences</span>: {}
  })
  
  <span class="hljs-comment">// 业务数据 - 使用浅层响应式</span>
  <span class="hljs-keyword">const</span> businessData = <span class="hljs-title function_">shallowRef</span>({
    <span class="hljs-attr">products</span>: [],
    <span class="hljs-attr">orders</span>: [],
    <span class="hljs-attr">customers</span>: []
  })
  
  <span class="hljs-comment">// 配置和工具 - 不需要响应式</span>
  <span class="hljs-keyword">const</span> constants = <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-attr">API_ENDPOINTS</span>: {
      <span class="hljs-attr">PRODUCTS</span>: <span class="hljs-string">'/api/products'</span>,
      <span class="hljs-attr">ORDERS</span>: <span class="hljs-string">'/api/orders'</span>
    },
    <span class="hljs-attr">VALIDATION_RULES</span>: {
      <span class="hljs-attr">EMAIL</span>: <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>,
      <span class="hljs-attr">PHONE</span>: <span class="hljs-regexp">/^1[3-9]\d{9}$/</span>
    }
  })
  
  <span class="hljs-comment">// 第三方服务实例</span>
  <span class="hljs-keyword">const</span> services = <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-attr">analytics</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">payment</span>: <span class="hljs-literal">null</span>
  })
  
  <span class="hljs-comment">// 初始化服务</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeServices</span>(<span class="hljs-params"/>) {
    services.<span class="hljs-property">analytics</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnalyticsService</span>()
    services.<span class="hljs-property">payment</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentService</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>)
  }
  
  <span class="hljs-comment">// 批量更新业务数据</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateBusinessData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [products, orders, customers] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
      <span class="hljs-title function_">fetch</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>.<span class="hljs-property">PRODUCTS</span>),
      <span class="hljs-title function_">fetch</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>.<span class="hljs-property">ORDERS</span>),
      <span class="hljs-title function_">fetch</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>.<span class="hljs-property">CUSTOMERS</span>)
    ])
    
    <span class="hljs-comment">// 整体替换，触发一次更新</span>
    businessData.<span class="hljs-property">value</span> = {
      <span class="hljs-attr">products</span>: <span class="hljs-keyword">await</span> products.<span class="hljs-title function_">json</span>(),
      <span class="hljs-attr">orders</span>: <span class="hljs-keyword">await</span> orders.<span class="hljs-title function_">json</span>(),
      <span class="hljs-attr">customers</span>: <span class="hljs-keyword">await</span> customers.<span class="hljs-title function_">json</span>()
    }
  }
  
  <span class="hljs-comment">// 导出数据（移除响应式）</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">user</span>: <span class="hljs-title function_">toRaw</span>(user),
      <span class="hljs-attr">businessData</span>: <span class="hljs-title function_">toRaw</span>(businessData.<span class="hljs-property">value</span>),
      <span class="hljs-attr">constants</span>: <span class="hljs-title function_">toRaw</span>(constants)
    }
  }
  
  <span class="hljs-keyword">return</span> {
    user,
    businessData,
    constants,
    services,
    initializeServices,
    updateBusinessData,
    exportData
  }
}
</code></pre>
<h2 data-id="heading-8">避坑指南：常见误用场景</h2>
<p>虽然这些进阶API很强大，但使用不当也会带来问题。下面是一些常见的误用场景：</p>
<p><strong>误用1：在需要深度响应式时使用shallowRef</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误用法</span>
<span class="hljs-keyword">const</span> formState = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">fields</span>: {
    <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
  }
})

<span class="hljs-comment">// 表单字段变化不会触发更新！</span>
formState.<span class="hljs-property">value</span>.<span class="hljs-property">fields</span>.<span class="hljs-property">username</span> = <span class="hljs-string">'new username'</span>

<span class="hljs-comment">// ✅ 正确用法：需要深度响应式时使用reactive</span>
<span class="hljs-keyword">const</span> formState = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">fields</span>: {
    <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
  }
})
</code></pre>
<p><strong>误用2：过度使用markRaw</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误用法：把需要响应式的数据标记为非响应式</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
    <span class="hljs-comment">// 这个name变化不会触发更新！</span>
  })
})

<span class="hljs-comment">// ✅ 正确用法：只在确实不需要响应式时使用markRaw</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>
  },
  <span class="hljs-attr">config</span>: <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-comment">// 配置信息确实不需要响应式</span>
    <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'https://api.example.com'</span>
  })
})
</code></pre>
<h2 data-id="heading-9">测试与调试技巧</h2>
<p>使用这些API时，合适的测试和调试方法很重要：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { isReactive, isRef, isReadonly, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 调试函数，检查响应式状态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debugReactive</span>(<span class="hljs-params">obj, name = <span class="hljs-string">'未知对象'</span></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">group</span>(<span class="hljs-string">`响应式调试: <span class="hljs-subst">${name}</span>`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'原始对象:'</span>, <span class="hljs-title function_">toRaw</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是响应式对象:'</span>, <span class="hljs-title function_">isReactive</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是ref对象:'</span>, <span class="hljs-title function_">isRef</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是只读对象:'</span>, <span class="hljs-title function_">isReadonly</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">groupEnd</span>()
}

<span class="hljs-comment">// 在组件中使用</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> })
<span class="hljs-keyword">const</span> shallowState = <span class="hljs-title function_">shallowReactive</span>({ <span class="hljs-attr">nested</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> } })

<span class="hljs-title function_">debugReactive</span>(state, <span class="hljs-string">'深度响应式状态'</span>)
<span class="hljs-title function_">debugReactive</span>(shallowState, <span class="hljs-string">'浅层响应式状态'</span>)
<span class="hljs-title function_">debugReactive</span>(shallowState.<span class="hljs-property">nested</span>, <span class="hljs-string">'嵌套对象'</span>)
</code></pre>
<h2 data-id="heading-10">总结与最佳实践</h2>
<p>通过今天的学习，相信你已经对Vue 3响应式系统的进阶API有了更深入的理解。让我们最后总结一下各个API的使用场景：</p>
<p><strong>shallowRef</strong> 适用于大型对象或数组，当你只需要在整体替换时更新视图的场景。</p>
<p><strong>markRaw</strong> 适用于常量配置、工具函数、第三方库实例等确实不需要响应式的场景。</p>
<p><strong>shallowReactive</strong> 适用于那些只需要表层响应式，嵌套数据变化不需要触发更新的场景。</p>
<p><strong>toRaw</strong> 适用于需要直接操作原始数据，或者与第三方库交互的场景。</p>
<p>记住，性能优化的核心思想是：在保证功能正确的前提下，尽量减少不必要的响应式跟踪。不是所有数据都需要响应式，选择合适的工具才能构建出既功能完善又性能优异的Vue应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter TolyUI 框架#09 | tolyui_text 轻量高亮文本]]></title>    <link>https://juejin.cn/post/7578113711363162155</link>    <guid>https://juejin.cn/post/7578113711363162155</guid>    <pubDate>2025-11-30T23:42:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578113711363162155" data-draft-id="7578177007574761526" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter TolyUI 框架#09 | tolyui_text 轻量高亮文本"/> <meta itemprop="keywords" content="Flutter,UI Kit,前端"/> <meta itemprop="datePublished" content="2025-11-30T23:42:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张风捷特烈"/> <meta itemprop="url" content="https://juejin.cn/user/149189281194766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter TolyUI 框架#09 | tolyui_text 轻量高亮文本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189281194766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张风捷特烈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:42:34.000Z" title="Sun Nov 30 2025 23:42:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h4 data-id="heading-0">《Flutter TolyUI 框架》系列前言:</h4>
<p><strong>TolyUI</strong> 是 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">张风捷特烈</a> 打造的 Fluter 全平台应用开发 UI 框架。具备 <strong>全平台</strong>、<strong>组件化</strong>、<strong>源码开放</strong>、<strong>响应式</strong> 四大特点。可以帮助开发者迅速构建具有响应式全平台应用软件：</p>
<blockquote>
<p>开源地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTolyFx%2Ftoly_ui" target="_blank" title="https://github.com/TolyFx/toly_ui" ref="nofollow noopener noreferrer">github.com/TolyFx/toly…</a></p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de8c6bed9bfe46b3865accea7d493d4c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1563&amp;h=409&amp;s=62505&amp;e=png&amp;b=ffffff" alt="image.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-1">1. 文本增强的设计动机</h4>
<p>在应用开发中，文本从来不只是信息的载体，更是用户与应用交互的桥梁。在界面展示和交互的过程中，有时文本并不仅是基本的静态展示，还有搜索是关键字高亮、隐私政策点击交互等。</p>













<table><thead><tr><th>搜索高亮</th><th>隐私政策等</th></tr></thead><tbody><tr><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f473de6b892c4666ba226d40b7e5f27d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1179&amp;h=2556&amp;s=377870&amp;e=png&amp;b=fdfdfd" alt="IMG_4380.PNG" loading="lazy"/></td><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/054a1e99ac3e48baaaacc90113281642~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1179&amp;h=2556&amp;s=494075&amp;e=png&amp;b=7fffc3" alt="IMG_4381.PNG" loading="lazy"/></td></tr></tbody></table>
<p>虽然使用 Flutter 本身的富文本也可以处理，但往往让开发者陷入繁琐的细节之中。实现一个简单的搜索高亮功能，需要手动分割字符串、处理大小写逻辑、管理样式状态。比如下面这样的代码：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 传统方式：繁琐的手动处理</span>
<span class="hljs-built_in">List</span>&lt;TextSpan&gt; buildHighlightSpans(<span class="hljs-built_in">String</span> text, <span class="hljs-built_in">String</span> keyword) {
  <span class="hljs-built_in">List</span>&lt;TextSpan&gt; spans = [];
  <span class="hljs-built_in">int</span> start = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (start &lt; text.length) {
    <span class="hljs-built_in">int</span> index = text.indexOf(keyword, start);
    <span class="hljs-keyword">if</span> (index == <span class="hljs-number">-1</span>) {
      spans.add(TextSpan(text: text.substring(start)));
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">if</span> (index &gt; start) {
      spans.add(TextSpan(text: text.substring(start, index)));
    }
    spans.add(TextSpan(
      text: keyword,
      style: TextStyle(backgroundColor: Colors.yellow),
    ));
    start = index + keyword.length;
  }
  <span class="hljs-keyword">return</span> spans;
}
</code></pre>
<p>TolyUI 的 <strong>HighlightText</strong> 组件目的在于封装文字高亮方案，提供一套轻量级的解决方案。通过简洁的 API 让开发者用最少的代码实现需求，比如最简单的搜索关键字高亮，使用下面的代码即可:</p>
<pre><code class="hljs language-dart" lang="dart">HighlightText.withArg(
  text,
  arg: keyword,
  highlightStyle: TextStyle(backgroundColor: Colors.yellow),
)
</code></pre>
<hr/>
<h4 data-id="heading-2">2. 独立模块: tolyui_text</h4>
<p>TolyUI 中对文本表现的增强，封装倒了独立的模块中 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Ftolyui_text" target="_blank" title="https://pub.dev/packages/tolyui_text" ref="nofollow noopener noreferrer">tolyui_text</a>。它隶属于 tolyui 的基础组件模块：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b16cb0641e8408c99966e5e06685eba~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1002&amp;h=413&amp;s=55327&amp;e=png&amp;b=ffffff" alt="image.png" loading="lazy"/></p>
<p>使用者可以独立模块包，或者使用 tolyui 全家桶来使用 HighlightText 组件。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02a6fa88d4314c7bb6901f64dff2261c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=876&amp;h=354&amp;s=35349&amp;e=png&amp;b=ffffff" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 仅使用 tolyui_text</span>
<span class="hljs-attr">dependencies:</span> 
   <span class="hljs-attr">tolyui_text:</span> <span class="hljs-string">^last_version</span>

<span class="hljs-comment"># 使用 tolyui 全家桶 </span>
<span class="hljs-attr">dependencies:</span> 
    <span class="hljs-attr">tolyui:</span> <span class="hljs-string">^last_version</span>

</code></pre>
<p>下面来介绍一下 <code>HighlightText</code> 的具体用法。</p>
<hr/>
<h4 data-id="heading-3">3. 搜索关键字文本高亮</h4>
<p>第一个场景是交互式搜索高亮。这是最常见的文本处理需求，HighlightText 提供了 <code>withArg</code> 构造函数，让开发者可以快速实现，基于搜索字符，实现高亮匹配关键字，效果如下：</p>
<ul>
<li>支持自定义 <strong>高亮匹配样式</strong>。</li>
<li>支持 <strong>是否区分大小写</strong>。</li>
</ul>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/624d31fd1eb64c29ac8df25c69ee368b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=742&amp;h=509&amp;s=478683&amp;e=gif&amp;f=491&amp;b=fafafc" alt="1.gif" loading="lazy"/></p>
<p>使用方式非常简单，只需要通过 <code>HighlightText.withArg</code> 即可：</p>
<pre><code class="hljs language-dart" lang="dart">HighlightText.withArg(
  <span class="hljs-string">"文本内容"</span>,
  caseSensitive: <span class="hljs-comment">// 是否区分大小写,</span>
  arg: <span class="hljs-string">'关键字'</span>,
  highlightStyle: <span class="hljs-comment">//高亮样式,</span>
),
</code></pre>
<hr/>
<h4 data-id="heading-4">4. 自定义匹配规则</h4>
<p><code>withArg</code> 构造函数只适合某一个特定字符串的高亮匹配。对于多个复杂的破规则，支持 <code>rules</code> 的规则映射。<code>Rule</code> 对象可以定义正则表达式，以及 <code>onTap</code> 回调，用于处理点击事件。<br/>
比如这里 <code>《[^\u300b]+》</code> 正则匹配书名号和其中的内容，匹配到使用 highlightStyle 样式。点击时触发 <code>onTapMatch</code> 方法，回调的 <code>HighlightMatch</code> 对象中可以得到匹配的信息，包括文本内容和第几个。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51a6830c3a484c938f767427977a5982~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=742&amp;h=509&amp;s=331468&amp;e=gif&amp;f=263&amp;b=fafafc" alt="2.gif" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart">HighlightText(
  <span class="hljs-string">'文本内容'</span>,
  rules: {
    Rule(<span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'《[^\u300b]+》'</span>), onTap: onTapMatch): highlightStyle <span class="hljs-comment">//高亮样式,</span>
  },
  style: <span class="hljs-keyword">const</span> TextStyle(fontSize: <span class="hljs-number">16</span>),
),

<span class="hljs-keyword">void</span> onTapMatch(HighlightMatch match) {
  $message.success(
    message: <span class="hljs-string">'点击的是第:<span class="hljs-subst">${match.matchIndex}</span> 个:<span class="hljs-subst">${match.matchedText}</span>'</span>,
  );
}
</code></pre>
<hr/>
<h4 data-id="heading-5">5.多模式智能识别</h4>
<p><code>rules</code> 中有支持多个匹配规则，比如下面所有数字通过 <code>\d+</code> 匹配，每个数字都可以有自己的点击事件。Rule 的第一参可以传入字符串，比如这里的 <code>zdl1994328</code> 精确匹配每个字符串。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f1f8fcf82d3430fa5a266b1773baee3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=742&amp;h=509&amp;s=519478&amp;e=gif&amp;f=350&amp;b=fdfdfb" alt="3.gif" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart">HighlightText(
  <span class="hljs-string">"文本"</span>,
  rules: {
    Rule(
      <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'\d+'</span>),
      onTap: (match) =&gt;
          $message.success(message: <span class="hljs-string">'点击了数字: <span class="hljs-subst">${match.matchedText}</span>'</span>),
    ): numStyle,
    Rule(
      <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'\S+@\S+.\S+'</span>),
      onTap: (match) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'点击了邮箱: <span class="hljs-subst">${match.matchedText}</span>'</span>),
    ): emailStyle,
    Rule(
      <span class="hljs-string">'zdl1994328'</span>,
      onTap: (match) {
        $message.success(message: <span class="hljs-string">'点击了微信号: <span class="hljs-subst">${match.matchedText}</span>'</span>);
      },
    ): weiChatStyle,
  },
  style: <span class="hljs-keyword">const</span> TextStyle(fontSize: <span class="hljs-number">16</span>),
)
</code></pre>
<hr/>
<h4 data-id="heading-6">尾声</h4>
<p>随着 tolyui 的逐步迭代，越来越多的新功能将会支持。感谢你关注 tolyui 的成长，如果喜欢，也希望你能在 github 中点赞支持~</p>
<blockquote>
<p>github 开源地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTolyFx%2Ftoly_ui" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTolyFx%2Ftoly_ui" target="_blank">github.com/TolyFx/toly…</a><br/>
TolyUI 官方案例演示网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Ftoly1994.com%2Fui" title="https://link.juejin.cn?target=http%3A%2F%2Ftoly1994.com%2Fui" target="_blank">toly1994.com/ui</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端高频面试题之CSS篇（二）]]></title>    <link>https://juejin.cn/post/7577991167201345546</link>    <guid>https://juejin.cn/post/7577991167201345546</guid>    <pubDate>2025-11-30T15:12:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167201345546" data-draft-id="7578029829996855346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 前端高频面试题之CSS篇（二）"/> <meta itemprop="keywords" content="前端,面试,CSS"/> <meta itemprop="datePublished" content="2025-11-30T15:12:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             前端高频面试题之CSS篇（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T15:12:02.000Z" title="Sun Nov 30 2025 15:12:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、如何实现两栏布局？</h2>
<p>两栏布局指的是<strong>左边宽度固定，右边宽度自适应</strong>。</p>
<p>DOM 结构如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">1.1 利用 flex 布局实现</h3>
<p><strong>实现思路</strong>：将父元素设为 flex 布局，左边元素宽度固定，右边元素设为 flex: 1，即自适应。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}
<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}
<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：布局灵活、响应式布局。</p>
<p><strong>缺点</strong>：IE9 及以下不支持。</p>
<h3 data-id="heading-2">1.2 利用 float 布局实现</h3>
<p><strong>实现思路</strong>：将左边元素设置为浮动元素 <code>float: left</code>，右边元素用 <code>margin-left</code>，这样能让右边元素占据父元素剩余宽度。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">float</span>: left;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：简单、支持 IE。</p>
<p><strong>缺点</strong>：浮动易导致问题（如高度塌陷），不适合复杂布局。</p>
<h3 data-id="heading-3">1.3 利用 Grid 布局实现</h3>
<p><strong>实现思路</strong>：将父元素设为 grid 布局，并设置 <code>grid-template-columns: 200px 1fr</code> 即可。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">200px</span> <span class="hljs-number">1</span>fr;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：二维布局强大，实现多栏布局十分方便。</p>
<p><strong>缺点</strong>：IE9 及以下不支持，不适合一维布局。</p>
<h3 data-id="heading-4">1.4 利用 position 绝对定位实现</h3>
<p><strong>实现思路</strong>：父级为相对定位，右边子元素为绝对定位，并同时设置 <code>left、right、top、bottom</code> 值，以实现宽高的自动拉伸。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：可以精确控制位置。</p>
<p><strong>缺点</strong>：脱离文档流，响应式差。</p>
<h2 data-id="heading-5">2、如何实现三栏布局？</h2>
<p>三栏布局指的是页面分为三栏，左侧和右侧固定宽度，中间自适应。</p>
<p>DOM 结构如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">2.1 利用 flex 布局实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<h3 data-id="heading-7">2.2 利用 float 布局实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">float</span>: left;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">float</span>: right;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p>这里需要注意，<strong>中间栏的 DOM 需要放在最后</strong>，以避免浮动元素影响，所以其 DOM 结构如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2.3 利用 grid 布局实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">100px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<h3 data-id="heading-9">2.4 利用 position 绝对定位实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<h3 data-id="heading-10">2.5 经典三栏布局之圣杯布局</h3>
<p>圣杯布局实现三列布局左右列固定宽度、中间列自适应，其原理是通过<strong>相对定位和负边距</strong>来实现侧边栏的定位。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">150px</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.wrapper</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">display</span>: table;
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">clear</span>: both;
  }

  <span class="hljs-selector-class">.column</span> {
    <span class="hljs-attribute">float</span>: left;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.left</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">100%</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">background-color</span>: aqua;
  }

  <span class="hljs-selector-class">.center</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">background-color</span>: red;
  }

  <span class="hljs-selector-class">.right</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
    <span class="hljs-attribute">margin-right</span>: -<span class="hljs-number">150px</span>;
    <span class="hljs-attribute">background-color</span>: green;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 中间列 center 放第一个是为了在文档流中优先渲染，因为 DOM 是从上往下依次渲染的--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center column"</span>&gt;</span>center<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left column"</span>&gt;</span>left<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right column"</span>&gt;</span>right<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">2.6 经典三栏布局之双飞翼布局</h3>
<p>双飞翼布局实现三列布局左右列固定宽度、中间列自适应，其原理是通过使用嵌套的 <code>div</code> 元素来实现侧边栏的定位，以及使用<strong>负外边距</strong>将主内容区域撑开。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">background-color</span>: red;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.column</span> {
    <span class="hljs-attribute">float</span>: left;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.center</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">150px</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.left</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">background-color</span>: aqua;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.right</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
    <span class="hljs-attribute">background-color</span>: green;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">150px</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box column"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span>center<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left column"</span>&gt;</span>left<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right column"</span>&gt;</span>right<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">3、如何实现水平垂直居中？</h2>
<h3 data-id="heading-13">3.1 文本类可以使用 <code>line-height</code> 和 <code>text-align</code></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}
</code></pre>
<h3 data-id="heading-14">3.2 使用 flex 布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
}
</code></pre>
<h3 data-id="heading-15">3.3 使用绝对定位 postion + transform/负 margin</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
}
</code></pre>
<p>当元素固定宽度时，也可以用 <code>负 margin</code> 替代 <code>transform</code>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background-color</span>: red;
}

<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">margin-top</span>: -<span class="hljs-number">25px</span>; <span class="hljs-comment">/* 自身容器高度的一半 */</span>
  <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">25px</span>; <span class="hljs-comment">/* 自身容器宽度的一半 */</span>
  <span class="hljs-attribute">background-color</span>: green;
}
</code></pre>
<h3 data-id="heading-16">3.4 使用 absolute + margin: auto</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">position</span>: absolute; 
  inset: <span class="hljs-number">0</span>; 
  <span class="hljs-attribute">margin</span>: auto
}

</code></pre>
<h3 data-id="heading-17">3.5 使用 Grid 布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
 <span class="hljs-attribute">display</span>: grid; 
 place-items: center;
}

</code></pre>
<h3 data-id="heading-18">3.6 使用 table 布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
 <span class="hljs-attribute">display</span>: table-cell;
 <span class="hljs-attribute">vertical-align</span>: middle;
}

</code></pre>
<h2 data-id="heading-19">4、实现一个三角形</h2>
<h3 data-id="heading-20">4.1 利用 border</h3>
<p>在 CSS 中，实现三角形最常见的方法是利用元素的**边框（border）**属性。通过设置元素的宽度和高度为 0，然后调整边框的宽度和颜色，可以形成各种方向的三角形。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.triangle</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">10px</span> solid transparent;  <span class="hljs-comment">/* 左透明 */</span>
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">10px</span> solid transparent; <span class="hljs-comment">/* 右透明 */</span>
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">30px</span> solid red;       <span class="hljs-comment">/* 底有颜色，形成向上三角 */</span>
}

</code></pre>
<h3 data-id="heading-21">4.2 使用 clip-path</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.triangle</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: purple;
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">50%</span> <span class="hljs-number">0%</span>, <span class="hljs-number">0%</span> <span class="hljs-number">100%</span>, <span class="hljs-number">100%</span> <span class="hljs-number">100%</span>);  <span class="hljs-comment">/* 向上三角 */</span>
}
</code></pre>
<h2 data-id="heading-22">5、实现一个扇形</h2>
<p>在上面画三角形的基础上，再增加样式 <code>border-radius: 100%;</code>即可实现一个扇形。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.sector</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">10px</span> solid transparent;
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">10px</span> solid transparent;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">30px</span> solid red;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">100%</span>; <span class="hljs-comment">/* 增加 border-radius */</span>
}
</code></pre>
<h2 data-id="heading-23">6、实现一个梯形</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">32px</span> auto;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.box</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: red;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">perspective</span>(.<span class="hljs-number">5em</span>) <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">5deg</span>);
}
</code></pre>
<h2 data-id="heading-24">7、画一条 0.5px 的线</h2>
<p>对于大部分普通屏幕来说，像素是最小的显示单位，因此定义 0.5px 是没有意义的，浏览器遇到小于 1px 时会向上取整渲染 1px，这个是浏览器渲染的局限性。</p>
<p>但是在一些高分辨率屏幕（如 Retina 屏幕）上，1 物理像素点可以被分成多个虚拟像素（比如 2x 屏幕将每个物理像素分为 4 个虚拟像素）。这样的话，1px 的物流像素就等于 2 个虚拟像素，所以 0.5px 也能被渲染出来。</p>
<p>所以对于普通屏幕来说，我们需要做一些兼容方案来渲染出 0.5px 的效果。</p>
<p>我们可以使用 <code>CSS transform 缩放法</code> 来实现 0.5px 的线，代码如下：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.line</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background-color</span>: red;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">/* 对高度进行垂直方向的缩放 */</span>
}

</code></pre>
<h2 data-id="heading-25">小结</h2>
<p>上面是整理的前端面试关于 CSS 高频考察的布局和图形，如有错误或者可以优化的地方欢迎评论区指正。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。]]></title>    <link>https://juejin.cn/post/7577713754564558900</link>    <guid>https://juejin.cn/post/7577713754564558900</guid>    <pubDate>2025-11-30T14:24:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577713754564558900" data-draft-id="7577957806210236431" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-11-30T14:24:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="饼干哥哥"/> <meta itemprop="url" content="https://juejin.cn/user/2001569972490973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2001569972490973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    饼干哥哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:24:19.000Z" title="Sun Nov 30 2025 14:24:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>但有人说没有渠道、不知道怎么弄。。。</p>
<p>欸我还能说什么呢？只能是把做小生意的完整逻辑给大家讲一遍，包括：🧵- 怎么选择赛道？</p>
<ul>
<li>公域流量：闲鱼实操、小红书怎么玩、公众号机会</li>
<li>私域谈单 SOP
—、先讲一下认知：什么是 中介思维（Agent Thinking）</li>
</ul>
<p>很多职场人或想要做副业的小白，最大的误区是觉得自己“必须先成为专家”才能赚钱。想做 PPT 代写觉得要设计大师，想做数据分析觉得要代码精通。这种思维导致你陷入技能学习的无底洞，或者单纯靠堆砌自己的时间去赚钱，不仅累，而且上限很低。一旦停下来，收入就断了。</p>
<p>生意的本质不是“自己做”，而是“做链接”。你要从一个“供给方”（苦哈哈写稿的人）转变为“链接者”（生意操盘手）。</p>
<ul>
<li>
<p>供给方（后端）： 可以是 AI（现在的 Claude 3.5、GPT-4o 非常强），也可以是你在 Boss 直聘、闲鱼上招募的兼职写手（大学生、专业人士）。</p>
</li>
<li>
<p>需求方（前端）： 是焦虑的小学生家长（要写演讲稿）、忙碌的老师（要写评语）、求职者（要改简历）。</p>
</li>
</ul>
<p>你做什么？ 你负责搞流量、促转化。你赚的是信息差和服务的钱，而不是卖体力的钱。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>脱离“手艺人”心态： 即使你自己会做（比如我会数据分析），也要尽量外包。因为你的时间应该花在更值钱的“搞流量”和“谈单”上。</p>
</li>
<li>
<p>万能公式： 无论是演讲稿、PPT、甚至是编程、爬虫，只要你懂需求，不懂技术也能接单。接到单子，转手交给后端（AI 或人）去交付。</p>
</li>
<li>
<p>利用 AI 杠杆： 对于简单的需求（如演讲稿、检讨书、公文），直接用 AI（如 Claude 4.5）作为你的零成本劳动力，实现几乎 100% 的利润率;对于复杂的（如论文辅导），做中介分包。
二、全貌概览：7 天跑通生意闭环，告别“只有想法没有行动”</p>
</li>
</ul>
<p>要在极短周期内（比如 7 天）验证一个生意能不能赚钱。如果一周内能赚到几十块钱，这个逻辑就是通的，哪怕只有几十块，也比你空想一年强。一个完整的生意必须包含四个环节，缺一不可。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>选择赛道（找买家）： 不要先想卖什么，要先看市场在买什么。</p>
</li>
<li>
<p>建立销路（搞流量）：
闲鱼： 变现最快，不用养号，适合小白第一周直接出单。
小红书： 2025 年趋势，适合做体量，但需要运营。
公众号： 适合做深度的私域流量和复购。</p>
</li>
<li>
<p>私域谈单（做销售）： 流量来了必须承接。会谈单和不会谈单，收入能差 10 倍。要把公域流量（闲鱼、小红书）尽可能引流到微信私域。</p>
</li>
<li>
<p>后端交付（做产品）： 早期自己用 AI 交付（低成本），后期在 Boss 直聘找人交付（做规模）。</p>
</li>
</ul>
<p>怎么做？
不用追求每个环节都满分。作为个人创业者，你先把这个闭环跑通一遍。哪里卡住了（比如流量不够或交付太累），就针对性地用 AI 工具去解决那个环节的问题（用 AI 写文案、用 AI 做客服话术、用 AI 搞定交付）。
三、赛道选择：别自作聪明，做生意的第一步是“像素级模仿”</p>
<p>新手最大的坑就是“自嗨”。觉得自己有个绝妙的 idea，市场上没人做，一定能火。千万别做这种生意！市场上没人做通常意味着“没需求”或者“坑太大”。</p>
<p>【核心逻辑】 市场 &gt; 产品。
先找买家，再找产品。不要去淘宝找对标（因为淘宝只能看到销量结果，看不到操作过程），要去内容平台（小红书）找对标。因为在小红书上，你能看到一个同行是怎么从 0 开始发笔记、怎么改标题、怎么引流的全过程。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>生意不要太大： 普通人要解决具体的、微小的痛点。比如“AI 代写”就很大，但“小学生演讲稿代写”就很具体，越具体越好做。</p>
</li>
<li>
<p>像素级模仿（抄）： 找到同行后，甚至不要有自己的想法。✅同行错了，你跟着一起错： 很多时候同行写错别字、用很笨的图，是为了规避平台违规机制。你自作聪明改对了，反而可能被封号。✅复制路径： 看他发什么火了，你发同样结构的；看他主页怎么设置，你照搬。</p>
</li>
<li>
<p>用 AI 辅助调研： 直接把同行的内容投喂给 AI，让 AI 帮你分析这个赛道的市场规模、用户痛点和竞争环境（利用分享中的 AI 调研提示词）。
四、闲鱼实操：读懂这 5 个数据，你的闲鱼就能爆单</p>
</li>
</ul>
<p>很多人做闲鱼不出单，是因为把闲鱼当成了“卖二手货”的地方，随手一挂就等着。其实闲鱼已经是国内最大的服务交易平台，必须用做电商的逻辑去运营。</p>
<p>【核心逻辑】 流量漏斗分析。
闲鱼的核心数据只有 5 个：曝光 → 浏览 → 想要 → 下单 → 评价。每一个环节的流失都有原因。其中最重要的是“想要数”（咨询量）。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>提升点击（曝光到浏览）：
主图： 用聊天记录截图形式的主图，比精美的海报更真实、点击率更高。
地址： 别填十八线小城市。地址选一二线城市（北上广深），流量更大；做留学生生意就把地址定在海外。</p>
</li>
<li>
<p>提升咨询（浏览到想要）：
文案： 强调“个人非中介”、“研究生学长”等人设，打消用户怕中间商赚差价的心理。
刷数据： “想要数”代表羊群效应。如果你的想要数是 0，没人敢买。前期必须找人补单、补“想要”，数据好看了流量才会进来。</p>
</li>
<li>
<p>促成下单与好评：
每一单成交后，主动索要好评。
降价策略： 当客户砍价时，不要轻易答应。要说“给你便宜 20 块，但你得给我写个好评”。这样既保住了面子，又赚到了数据。
五、小红书运营：2025 年自然流腰斩，普通人必须做“小矩阵”</p>
</li>
</ul>
<p>小红书变了。2024 年之前随便发发都有流量，但现在自然流被腰斩，单号很难做起来。很多人发了几十篇笔记，小眼睛始终不过百，心态崩了。</p>
<p>【核心逻辑】暴力起号 + 小矩阵 + SEO 长尾词。
既然单号流量不稳定，就要靠数量取胜。普通人做不了百号矩阵，但一个人做 5-10 个号的小矩阵是完全可行的。利用 AI 降低内容生产成本，去铺搜索流量。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>暴力起号（泛垂直流量）： 起号阶段不要只发干货。要发“泛垂直”内容（如大学生赛道，就发大学生爱看的吃喝玩乐或吐槽），先把账号权重拉起来，有了几千赞藏的基础，再发广告才安全。</p>
</li>
<li>
<p>244 笔记结构：
20% 权重笔记： 泛流量，保住账号活跃度。
40% 人设笔记： 晒学历、晒奖状、晒日常，建立信任感（让用户觉得你是活人）。
40% 产品/干货笔记： 硬广或干货，直接转化。</p>
</li>
<li>
<p>AI 自动化铺长尾词：
人工写：力求 80 分，精细打磨，做推荐流量。
AI 写： 60 分万岁。利用 AI 批量生产内容，覆盖各种长尾词（如“春节演讲稿”、“元宵节演讲稿”）。只要能被搜索到，小眼睛超过 100 就算成功。
六、公众号蓝海：被忽视的第二流量来源，高客单转化的秘密</p>
</li>
</ul>
<p>大家都盯着小红书抖音，觉得公众号是“古典自媒体”，没人看了。大错特错！对于做服务、做代写、做知识付费的人来说，公众号现在的搜索流量（SEO）非常猛。</p>
<p>【核心逻辑】 搜一搜流量 + 信任背书。
微信公众号文章在微信“搜一搜”里的权重极高。用户在微信搜“论文查重”、“数据分析”时，出来的文章往往精准度极高。而且，能沉淀到公众号的用户，付费意愿和信任度远高于其他平台。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>布局 SEO： 你的文章标题和内容要包含用户会搜索的关键词。不要起那种文绉绉的标题，要直白（如《研究生论文查重怎么搞？推荐这 3 个工具》）。</p>
</li>
<li>
<p>承接流量： 在闲鱼和小红书做泛流量，把想要深入了解的用户引流到公众号。</p>
</li>
<li>
<p>建立信任锚点： 公众号适合发长文、发深度复盘。一篇几千字的干货文章，能瞬间立住你的“专家”人设。</p>
</li>
<li>
<p>转化路径： 既然是做生意，公众号文章底部一定要留钩子（加微信、领资料），直接导流到个人号成交。现在的公众号，1 万阅读带来的变现价值，可能超过抖音 10 万播放。
七、私域成交销售五步法：如何把 400 的单子谈成 800？</p>
</li>
</ul>
<p>流量来了，加上微信了，结果聊两句客户就跑了；或者客户一直砍价，最后你含泪赚个辛苦钱。这是典型的“客服思维”，不是“销售思维”。</p>
<p>【核心逻辑】销售 SOP + 价格锚定 + 敢于成交。
销售不是闲聊，每一步都要有目的。目的是为了识别需求、拉高客单价、快速收钱。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>开场白（减少成本）： 加上好友直接发模板：“我是谁，请告诉我你的身份、文章类型、具体要求、截止时间。” 只有回答了这些的人才是精准客户，不回的白嫖党直接过滤。</p>
</li>
<li>
<p>挖需求（看人下菜碟）： 翻翻他朋友圈。如果是经常出国旅游的、手机号带 5 个 8 的，或者留学生、艺术生，这些人不差钱，报价可以大胆往上提。</p>
</li>
<li>
<p>报价（高价锚定）： 这是核心技巧！ 即使你想卖 400，也要报两个价：“本科老师代写 400/小时，博士老师代写 800/小时（质量更高）”。哪怕客户最后选了 400，他也会觉得占了便宜；而很多追求质量的客户会直接选 800，你的利润瞬间翻倍。</p>
</li>
<li>
<p>缔结（敢于逼单）： 聊差不多了，直接问：“今天安不安排？” 尽量不要过夜。客户隔一个晚上可能就找别人了，或者自己不想弄了。</p>
</li>
<li>
<p>异议处理： 客户嫌贵、嫌麻烦，用准备好的话术（或直接丢给 AI 生成回复）解决，然后立刻绕回第 4 步：“那现在安不安排？”
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830cdc56fd0f4739aafc854423d8ad4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=8yzYVV4UNYkJ0UC2iMEOLFe67AE%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。1.jpg" loading="lazy"/></p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07de2cb2b1a74c0681433e710dfff009~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=%2FncEWkNR%2BnXZTkedowBA7Ri%2FP%2FQ%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。2.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fb227b88ee54d0fa809033b1fb75481~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=Z9SvrAf%2Fg34tXzbOWrxN3UuuVAM%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。3.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4eb1ddb0352c401899ca9e03997f51f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=3%2FTrQpvNRaFC%2FqDZz0QG1Q9531c%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。4.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd6e45fe06494bf290960105ac979d21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=BryBG3WmqJnMW5%2BOc8G%2Bqgh8ICY%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。5.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0168ef8bf64d39bd21b9b06b4401f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=66AGymwVG9mRQHiAt7PjOa3TiQ8%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。6.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dc4425b1744406f9793ae52434108cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=%2FTPzyyLBEkzBOIHCTVGdLXwbAxg%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。7.jpg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像改PPT！（附保姆级教程）]]></title>    <link>https://juejin.cn/post/7577958825342795795</link>    <guid>https://juejin.cn/post/7577958825342795795</guid>    <pubDate>2025-11-30T13:35:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342795795" data-draft-id="7577905525998125097" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像改PPT！（附保姆级教程）"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-30T13:35:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员X小鹿"/> <meta itemprop="url" content="https://juejin.cn/user/2928754709505608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像改PPT！（附保姆级教程）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754709505608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员X小鹿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:35:03.000Z" title="Sun Nov 30 2025 13:35:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是X小鹿。前几天刷视频，刷到了一款 AI 工具。</p>
<p>起初是被它「一键生成长图」的视频吸引过去的，后来点进账号主页看了下。</p>
<p>发现不管是用它来生成<code>科普图文</code>、<code>社群早报</code>、<code>读书笔记摘要</code>，还是<code>知识卡片</code>、<code>易拉宝</code>、<code>海报</code>、<code>财报长图</code>等，效果都很赞。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c156c2d473fb44de9447e8c45689a8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=nI4ZaYy4oJZ1HTuGErsX46Z3E0A%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/713584c5d89644299a1f58dfec46f325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=Zd8CUGDoY6nGYNVcLIKPuYVfEwg%3D" alt="图片" loading="lazy"/></p>
<p>比如想生成「读书笔记摘要」或「AI 早报」等，只需要把文案输进去，它就能自动完成需求分析、布局、设计、图像处理等，最终返回几张视觉风格还不错的图片。</p>
<p>更关键点是：<strong>生成的图片全部可以编辑！</strong></p>
<blockquote>
<p>也就是说，你可以像改 PPT 一样，来随意修改图片中的文字、图片、图标等，也可以自由拖动他们的位置。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f67d2949f7f24b7da5809d890f945f96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=4b6JlN4KPOHJPr4fERzHd3dp57I%3D" alt="图片" loading="lazy"/></p>
<p>这个 AI 工具叫 <strong>Seede AI</strong>，一款适合普通用户上手的 AI 设计工具。（国内可用）</p>
<p>整体使用体验还不错，分享给大家。</p>
<p>下面用一个例子来看看 Seede AI 具体使用吧。</p>
<h2 data-id="heading-0">一、Seede AI 使用教程</h2>
<p>我们以生成一个关于台风的「科普图文」来举例说明 Seede AI 的使用。</p>
<p>打开 Seede AI，使用手机号或邮箱注册即可。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseede.ai%2Fsign-up%3FinviteCode%3DA34LNT" target="_blank" title="https://seede.ai/sign-up?inviteCode=A34LNT" ref="nofollow noopener noreferrer">seede.ai/sign-up?inv…</a></p>
<p>注册时邀请码填 A34LNT，还可以额外获得一些使用额度，能免费多生成几次。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/217350827d7d42b0b9f93b0b9eb28c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=E2zPFJuEsxMJLAkkTdfhZUMd%2B60%3D" alt="图片" loading="lazy"/></p>
<p>Seede AI 的使用很简单，<code>选择图片类型 + 输入需求</code>，就可以生成了。</p>
<p><strong>1、图片类型</strong></p>
<p>Seede AI 支持多种图片类型，比如长图、海报、社媒图文、流程图、易拉宝、知识卡片、公众号封面等。</p>
<p>制作科普图文，这里我们选「长图」。</p>
<p><strong>2、需求描述</strong></p>
<p>Seede AI 不需要写复杂的提示词，只需要描述清需求就行。</p>
<p>比如你可以直接输入：<code>生成一个台风科普图文，图文并茂</code>，Seede AI 就开始生成了。</p>
<p>如果你有详细的文案，可以直接粘贴到下面，这样 Seede AI 就会根据我们提供的文案来生成了。</p>
<p>比如下面这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf19b59ef044847bdc5694b73b52d86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=xrxFoq3DzK2QwNxDPi3xOLULXbU%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">1、更多参数设置</h3>
<p>下面也可以设置一些参数，简单介绍下。</p>
<p><strong>1、附件（可选）</strong></p>
<p>Seede AI 支持上传图片或 PDF、Word 等文档作为参考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff9a5b5188c4475bd633fcb59a620c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=cGzqAyvAvXlnIp3CXiH68SwIRRc%3D" alt="图片" loading="lazy"/></p>
<p>上传后，可以选择参考的要素。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0088433c04ae4081a68594b192c14186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=dFIoc%2BN4dLoT6lE522TT%2FacTKeI%3D" alt="图片" loading="lazy"/></p>
<p>比如关于台风科普的介绍是在 Word 里，那么我们上传 Word 后，参考特征可以选择「文案」。</p>
<p><strong>2、图片尺寸</strong></p>
<p>Seede AI 支持社媒、设备屏幕、印刷品等常见尺寸。</p>
<p>如果没有找到，也可以点「添加自定义尺寸」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c24505013846b783b30d4b1646abfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=Bqk54AGKN2Xb6dkUR%2F0CcQCw950%3D" alt="图片" loading="lazy"/></p>
<p><strong>3、主题配色</strong></p>
<p>Seede AI 支持多种配色，也可以自定义。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cf70cb63d7f46f6bb5662d1beea1fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=PjFcxAlOLM3Ry685RiysxlQz7Rk%3D" alt="图片" loading="lazy"/></p>
<p><strong>4、模型选择</strong></p>
<p>Seede AI 支持国内外多种主流的大模型。</p>
<p>最近谷歌新上的 Gemini 3 Pro，Seede AI 也接入了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e37554710de24b949989b922104949bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=VocCuTc%2BT5IONZ8B6vsU%2Bee6VfM%3D" alt="图片" loading="lazy"/></p>
<p><strong>5、数量 &amp; 可见范围</strong></p>
<p>数量和可见范围，根据自己需求选即可。</p>
<p>设置完成后，点发送就可以等待生成了。</p>
<p>在发送按钮上的数字角标，是 Seede AI 本次生成需要消耗的额度。</p>
<h3 data-id="heading-2">2、编辑</h3>
<p>Seede AI 的生成速度很快。生成完成后，点侧边栏的编辑，可以对生成好的图片进行细节的调整。</p>
<p>Seede AI 生成的图片，画面上所有元素都可以编辑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fbf3ac9dbe4f7fab13b329143d7a56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=xk98UWZl6ktmmQ7nqmY%2Bx2xfL8A%3D" alt="图片" loading="lazy"/></p>
<p>包括文字内容、文字样式（字体、字号、颜色等）、图片、小图标、背景等等。</p>
<p>而且元素也可以随意拖动位置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62c76dc189fd4664a1b1535187280b0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=bOh9xoU894RuhP9A3L%2BQ%2BY0AOBI%3D" alt="图片" loading="lazy"/></p>
<p>修改完成后，点右上角的「导出」，就可以下载到本地了。</p>
<h2 data-id="heading-3">二、生成效果展示</h2>
<p>下面是 Seede AI 生成的关于台风的科普长文。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/169db8b064e84107be03a51090c44f8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=m4cPgvxq4D1k34IIlpDfUoktnGc%3D" alt="图片" loading="lazy"/></p>
<p>这个排版、布局、配色，可以说相当满意了。</p>
<p>而且长图中的文字说明，是根据之前输入的文案来写的。</p>
<h2 data-id="heading-4">三、写在最后</h2>
<p>Seede AI 除了可以用来生成科普图文，像知识卡片、早报、流程图、菜单、邀请函、各种场景的海报、易拉宝等场景，都是可以的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2812a5188a7c4409a2deebc2715a14bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=pbglnT%2BKnQK4NTOf6V2aMNfx5OA%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5652f4fb0323480aa27ed464c3ba956a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=WPcOUmOiLlgiHLUzAtwZfg%2FkwB8%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c84b9d4e40e34a4881219895bedbe73c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=xC9yvBdgqsj7jeLTdzsyMx3cujk%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca41f22b00054df5a2726aaa39462ca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=ASJkelnswStDnjSzCNd1oZH%2Bk5Y%3D" alt="图片" loading="lazy"/></p>
<p>Seede AI 整体使用体验还是非常不错的，非常适合普通人上手。</p>
<p>日常遇到要出图的场景，很方便。而且 Seede AI 目前每天都会赠送一些免费额度。</p>
<p>分享给大家，感兴趣的可以试试。</p>
<hr/>
<blockquote>
<p>我是<a href="https://juejin.cn/user/2928754709505608/posts" title="https://juejin.cn/user/2928754709505608/posts" target="_blank">程序员X小鹿</a>，前互联网大厂程序员，也是一名 AIGC 爱好者，持续分享更多好用的 AI 工具，欢迎一起交流~</p>
</blockquote>
<p><strong>推荐阅读</strong></p>
<p><a href="https://juejin.cn/post/7454501732203610131" title="https://juejin.cn/post/7454501732203610131" target="_blank">2024年终AI工具汇总：9大AI领域，70+精选AI工具，全都在这了！(建议收藏)</a></p>
<p>更多 AI 工具见<a href="https://juejin.cn/column/7284164153576947724" title="https://juejin.cn/column/7284164153576947724" target="_blank">【AI工具】</a>专栏，持续更新中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别繁琐部署：TRAE SOLO 帮我一键跑通 Z-Image 模型]]></title>    <link>https://juejin.cn/post/7577958825342828563</link>    <guid>https://juejin.cn/post/7577958825342828563</guid>    <pubDate>2025-11-30T13:43:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342828563" data-draft-id="7577958825342812179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别繁琐部署：TRAE SOLO 帮我一键跑通 Z-Image 模型"/> <meta itemprop="keywords" content="Trae,Solo,人工智能"/> <meta itemprop="datePublished" content="2025-11-30T13:43:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别繁琐部署：TRAE SOLO 帮我一键跑通 Z-Image 模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:43:30.000Z" title="Sun Nov 30 2025 13:43:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近，通义在“万相”系列之外，又放出了一个新的图像生成模型<code>Z-Image</code>，在 <code>H800 GPU</code> 上可实现<strong>亚秒级推理</strong>延迟，而在 16G 显存的消费级显卡上也可流畅运行！这不得抓紧时间试试。</p>
<p>之前每次尝试新模型都要查文档、配环境、装依赖、调版本，各种问题来来回回花好久。</p>
<p>幸好前几天，我们已经基于 <code>TRAE SOLO</code> 尝试过 AI 自主搭建模型服务。</p>
<p>《<a href="https://juejin.cn/post/7576821684252475435" target="_blank" title="https://juejin.cn/post/7576821684252475435">给 TRAE SOLO 一台服务器，它能干什么？ - 掘金</a>》</p>
<p>今天，我们再拿 <code>Z-Image</code> 试试效果。</p>
<h2 data-id="heading-0">Z-Image</h2>
<p>先来简单了解下 <code>Z-Image</code>。</p>
<p><code>Z-Image</code> 采用了一种可扩展的单流 DiT（S3-DiT）架构。在这种设置中，文本、视觉语义标记和图像VAE标记在序列级别上连接起来，作为统一的输入流，与双流方法相比，最大化了参数效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75a88cc4b544780aaa376c27f1de1d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=Uz5MLjyCaQn2983mXBQ55vaUL1s%3D" alt="" loading="lazy"/></p>
<p>根据基于 <code>Elo</code> 的人类偏好评估（在AI Arena上），<code>Z-Image-Turbo</code> 相对于其他领先模型表现出极高的竞争力，同时在开源模型中取得了最先进的结果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b3c23f0e8f442c8bffa9922e2a3ec89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=huWfTD0YVPHMXyZOlU6KHGl0kBA%3D" alt="" loading="lazy"/></p>
<p>该系列共包含 3 个模型：</p>
<ul>
<li><strong>Z-Image-Turbo</strong>：<code>Z-Image</code> 的精简版，仅用 8 NFEs（函数评估次数）就能与领先的竞争对手匹敌或超越。</li>
<li><strong>Z-Image-Base</strong>：非精简的基础模型，旨在解锁社区驱动的微调和自定义开发的全部潜力。<strong>当前尚未发布</strong>。</li>
<li><strong>Z-Image-Edit</strong>：专门针对图像编辑任务进行微调的 Z-Image 变体。支持创意的图像到图像生成，并具有令人印象深刻的指令遵循能力，允许基于自然语言提示进行精确编辑。<strong>当前尚未发布</strong>。</li>
</ul>
<h2 data-id="heading-1">前期准备</h2>
<p>开始搭建前，需要准备好以下内容，如有疑问，可以看之前的分享。</p>
<ol>
<li>准备好 1 个没有什么重要内容的服务器，可以是云服务器、算力租用，或者自行搭建的 docker 服务。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97104f12665047dfb346c80966178570~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=9EUQC1wHHJx%2F6FQDILfm3cx41o0%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>
<p>TRAE SOLO 模式可用，IDE 模式理论上也可以，但是需要人一直盯着，并且出现问题还需要人工干涉，失去了 AI 自主搭建的优势。</p>
</li>
<li>
<p>使用 TRAE 远程连接上服务器。</p>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf929bb288b24a0ab20c5b23237a813b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=AoVxibt4hrea1dasY%2FCTStx4pvI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">实操记录</h2>
<p>今天的实操场景，我们就直接选择<strong>糖果包装生成</strong>。</p>
<h3 data-id="heading-3">环境搭建及初版demo</h3>
<p><strong>指令</strong></p>
<p>大家可以直接参考下方完整指令。</p>
<ul>
<li>Z-Image 的参考文档。</li>
<li>任务目标：安装并实现糖果包装demo。</li>
<li>demo相关要求，比如图片生成维护，方便查找。</li>
<li>其他要求</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">参考文档 https:<span class="hljs-comment">//www.modelscope.cn/models/Tongyi-MAI/Z-Image-Turbo/summary?version=master</span>
帮我完成z-image-turbo的安装，并实现demo编写。
该demo帮我实现一个儿童风的糖果包装设计，图片生成位置设置为/root/z-image/下。
如果有临时文件生成，统一设置为/root/z-image/tmp/下。
云服务器文档：https:<span class="hljs-comment">//www.gongjiyun.com/docs/server/introduction/rznmwsy13i4a8yktuyycoxyinmg/</span>
</code></pre>
<p><strong>过程</strong></p>
<p>直接参考文档步骤进行安装，过程中出现问题或者错误会自动获取终端信息进行修复，非常方便。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be81fb9267a497a9930dc5b50cb1dd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=ZOPNzJgQ%2BzM7VUMdHRIOGqGC0uo%3D" alt="" loading="lazy"/></p>
<p>甚至还给出后续手动执行的命令，以及中间产物的位置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f7cdc98f9f24ab5bff3357398c9d573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=tobpiu%2BgDBLYalEjnZL1hXxBDBQ%3D" alt="" loading="lazy"/></p>
<p><strong>结果</strong></p>
<p>下面是生成的 demo 脚本，可以看到采用的 <code>Z-Image</code> 模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5484eefa3b71410bbc2b3ec23491d362~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=nXP4fEZ9Grg%2BKB4Pty%2FV3RboqIk%3D" alt="" loading="lazy"/></p>
<p>下面是生成的 demo 提示词。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e6605c0886740ec9b1a93d105ca8800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=hMbaJ%2BGAA7H9zmGjflyF1561S8U%3D" alt="" loading="lazy"/></p>
<p>下面是同步生成的包装图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6694a3e3daee4c52a3c94f721d9fa934~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=vxdj4t0hBbjcNKM9gTI7aEKxSYg%3D" alt="" loading="lazy"/></p>
<p>整体流程没问题，喝杯茶的功夫，环境就已经配好了。
但我想要的是单粒糖果的包装，两头拧起来的那种效果。我们再修改下提示词。</p>
<h3 data-id="heading-4">单粒糖纸包装生成优化</h3>
<p>这里我们直接手动更改脚本中的提示词。</p>
<p>修改位置上一轮对话也已经给出。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44b69c396340409995182f7be32c209d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=kOQlR4J1uuyKG0Pq%2FbMf5gLvR4s%3D" alt="" loading="lazy"/></p>
<p><strong>指令</strong></p>
<pre><code class="hljs language-css" lang="css">单粒牛奶硬糖，经典两端扭结包装，儿童风，奶白色为主色调，点缀浅棕色小奶牛斑点，包装正面印 <span class="hljs-selector-tag">Q</span> 版微笑小奶牛（圆眼睛、短耳朵、脖子挂迷你奶瓶），半透明包装纸隐约透出米白色奶糖本体（糖体光滑有光泽），扭结处颜色为淡奶油色，包装纸呈柔和哑光质感，带轻微奶泡珠光，侧面印微型奶滴图案，正面下方用圆润卡通字体写 “香浓奶糖”，整体无尖锐棱角，色彩柔和不刺眼，暖光照射，<span class="hljs-number">8</span>k 高清，细节丰富，适合 <span class="hljs-number">3</span>-<span class="hljs-number">10</span> 岁儿童
</code></pre>
<p><strong>结果</strong></p>
<p>下面是更换指令后的生成结果，整体还可以。</p>
<p>但是物品的摆放角度和扭转等物理现象还是稍微有些不足。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fef4722dc97342efada72fe5f236a8bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=jnbwZB%2BgUm7KeCUuIMWbSRY1QTg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">结语</h2>
<p>整个过程相当轻松，一共花费了 1 个小时多点。</p>
<ul>
<li>看到资讯</li>
<li>找到官网并浏览文档</li>
<li>建立并连接云服务器</li>
<li>输入指令</li>
<li>等待并验证</li>
</ul>
<p>指令设计和研究方向都是我们确定的，最终结果也是我们验收的，但安装、配置、调试的过程全部交由 AI 一口气完成，轻松惬意。</p>
<p>这才是我理想的 AI 协同模式！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从理解到记忆再到回答：Embedding→向量数据库→RAG 的完整链路]]></title>    <link>https://juejin.cn/post/7577718777482756134</link>    <guid>https://juejin.cn/post/7577718777482756134</guid>    <pubDate>2025-11-30T12:23:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577718777482756134" data-draft-id="7577991167200903178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从理解到记忆再到回答：Embedding→向量数据库→RAG 的完整链路"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-30T12:23:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从理解到记忆再到回答：Embedding→向量数据库→RAG 的完整链路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:23:53.000Z" title="Sun Nov 30 2025 12:23:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在AI大模型技术爆火之前，"向量"、"相似度"、"召回"这些词还只是少数算法工程师的专业术语。 但自从以ChatGPT为代表的LLM技术爆火、RAG 爆发以及团队可以开始构建自己的知识库，这些概念突然变成了大家都在讨论的词汇。</p>
<p>在上一篇文章中，我们提到<strong>通过构建知识库，可以让大模型从“无状态”变成“有状态”</strong> 。所谓知识库，本质上是一种让大模型“在对话之外拥有记忆”的方式。它本身并不是固定的技术，而是一个抽象概念，可以根据场景和需求被具象化为不同的载体，比如：</p>
<p><strong>文件系统</strong>（文档、PDF、Markdown、网页）</p>
<p><strong>数据库</strong>（传统关系型数据库、NoSQL）</p>
<p><strong>向量数据库</strong>（Milvus、Weaviate、Pinecone）</p>
<p>这些形式都可以承载知识，但它们的能力差异巨大，尤其是在语义检索时代，向量数据库正在成为事实标准。与此同时，大模型产品背后所依赖的基础模型也并非统一的“一种模型”。它们大致可以分成两大类：</p>
<p><strong>LLM（大语言模型）</strong> ：专门负责生成文本、推理、回答问题</p>
<p><strong>Embedding 模型</strong>：负责把文本转成向量，让机器能够“理解语义”</p>
<p>如果想真正弄清楚知识库、Embedding、向量数据库以及 LLM 在一个完整 AI 系统中的角色，就需要先把它们之间的关系理清楚。</p>
<p>事实上，它们之间并不是孤立的，而是构成了一条完整的语义链路：</p>
<p><strong>LLM 负责“回答”，Embedding 负责“理解”，向量数据库负责“记住并快速找到”，知识库则是它们共同服务的目标形态。</strong></p>
<p>理解这条链路，你就能搞清楚：</p>
<p><strong>向量数据库为什么突然火了？它和Embedding是什么关系？</strong></p>
<p><strong>LLM和Embedding又是什么关系？为什么 Embedding 是大模型应用的底层基础？</strong></p>
<p><strong>为什么 RAG 会成为最流行的大模型增强方案？</strong></p>
<p>接下来，我们就沿着这条链路，把这些概念串联讲清楚。</p>
<h3 data-id="heading-0">向量数据库</h3>
<p>为了便于理解，我们先从向量数据库讲起，这里可能会提到Embedding，我们姑且先把它理解成某种特定的序列化方式。</p>
<h4 data-id="heading-1">向量数据库是什么？</h4>
<p>简单来讲<strong>向量数据库（Vector Database）</strong>  是一种专门为"<strong>向量数据</strong>"设计的数据库。</p>
<p>什么是"<strong>向量数据</strong>"？</p>
<p>在大模型中，文本、图片、代码等内容并不是直接用原始形式参与计算，而是通过 <strong>Embedding（向量化）</strong>  映射成几百维或几千维的浮点数组，向量数据库就是负责 <strong>存储这些Embedding向量</strong>，并提供 <strong>高效的相似度搜索（如余弦相似度 / L2距离）</strong> 。</p>
<p>它与传统数据库的区别：</p>

























<table><thead><tr><th>功能</th><th>传统数据库</th><th>向量数据库</th></tr></thead><tbody><tr><td>数据形式</td><td>行/列、字符串、数值</td><td>高维浮点向量</td></tr><tr><td>查询方式</td><td>精确匹配（=、&gt;、&lt;）</td><td>模糊语义匹配（相似度）</td></tr><tr><td>设计目的</td><td>结构化查询</td><td>海量向量的近似最近邻搜索（ANN）</td></tr></tbody></table>
<p>一句话总结：<strong>向量数据库是为语义搜索而生的数据库，用于在大规模向量中快速找到“最相似”的内容。</strong></p>
<h4 data-id="heading-2">为什么需要向量数据库？</h4>
<p>因为大模型并不是无所不知，也不是永远记得所有信息。在实际业务中，我们常遇到这些问题：</p>
<p><strong>1）大模型不能直接记住大量企业私有知识</strong></p>
<p>例如公司内部文档、产品手册、FAQ客户知识库。这些内容通常非常多，大模型无法全部放入 Prompt，也不会长期记住。</p>
<p><strong>2）全文搜索不能满足语义需求</strong></p>
<p>传统搜索如ES、关键词搜索只根据<strong>文本匹配</strong>，而包含某个关键词不等于语义最相关。</p>
<p><strong>3）大模型缺乏外部知识时，容易产生幻觉（hallucination）</strong></p>
<p>RAG已经成为主流方案，大模型不提前学习所有知识，而是“按需查询”，知识的来源就是向量数据库。</p>
<p><strong>4）海量数据 + 高频查询 ，必须依赖高性能ANN搜索</strong></p>
<p>当数据量达到百万到亿级，而查询需要维持毫秒级响应时，传统的精确相似度计算已经无法满足性能需求。只有通过高性能 ANN 索引（如 HNSW、IVF、PQ 等），才能在保证较高召回率的同时，实现高 QPS 的实时检索能力。</p>
<h4 data-id="heading-3">向量数据库有哪些产品？</h4>
<p>按照开源/商用可分为以下几类：</p>
<p><strong>1）主流开源向量数据库</strong></p>

































<table><thead><tr><th>产品</th><th>特点</th></tr></thead><tbody><tr><td><strong>Milvus</strong> （最流行）</td><td>专为向量搜索设计，性能极强，生态完善</td></tr><tr><td><strong>FAISS</strong> （Facebook）</td><td>算法库，不是完整数据库，需要自己封装</td></tr><tr><td><strong>HNSWlib</strong></td><td>高性能近邻搜索库，索引速度强</td></tr><tr><td><strong>Weaviate</strong></td><td>带 REST API、schema、扩展插件，易用</td></tr><tr><td><strong>Qdrant</strong></td><td>Rust 开发，性能稳定，支持混合搜索</td></tr><tr><td><strong>Vespa</strong> （雅虎）</td><td>面向大规模内容检索的搜索平台</td></tr></tbody></table>
<p><strong>2）商业 SaaS / 云厂商</strong></p>

























<table><thead><tr><th>产品</th><th>特点</th></tr></thead><tbody><tr><td><strong>Pinecone</strong></td><td>SaaS向量数据库，免维护</td></tr><tr><td><strong>OpenSearch Vector Engine</strong></td><td>AWS生态中集成</td></tr><tr><td><strong>Azure Cognitive Search</strong></td><td>与Azure AI紧密结合</td></tr><tr><td><strong>MongoDB Atlas Vector Search</strong></td><td>在文档数据库上附加向量检索功能</td></tr></tbody></table>
<p><strong>3）传统数据库的“向量扩展”功能</strong></p>
<p><strong>PostgreSQL pgvector</strong></p>
<p><strong>Elasticsearch vector search</strong></p>
<p><strong>MySQL HeatWave Vector</strong></p>
<p>适合中小规模场景，但不是专为大规模向量搜索设计。</p>
<h4 data-id="heading-4">总结一句话</h4>
<p><strong>向量数据库是构建大模型知识库（RAG系统）的核心技术，用来存储和检索语义向量，从而让大模型能够访问实时、企业级、准确的知识。</strong></p>
<h3 data-id="heading-5">Embedding</h3>
<p>Embedding在技术界的中文解释一般为“向量化”，顾名思义就是把常规内容转化为向量内容的一种方式。</p>
<h4 data-id="heading-6">Embedding 到底是什么？</h4>
<p><strong>Embedding 是把一段文本（或图片、音频等）转换成一个高维向量，并且这个向量在向量空间中具有“语义结构”。</strong></p>
<p>例如一句话：</p>
<pre><code class="hljs">“如何提升接口性能”
</code></pre>
<p>Embedding 之后可能变成：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[-0.13, 0.04, 0.98, ...]</span> （维度可能是 <span class="hljs-number">384</span>/<span class="hljs-number">768</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1536</span>/<span class="hljs-number">3072</span>...)
</code></pre>
<p><strong>这个向量越接近的，就说明两段文本越“语义相似”</strong> 。而比较向量的方式就是判断<strong>余弦相似度</strong> 。就是将两个数据转化成向量坐标后进行对比，对比的依据就是**方向一致度，不看长度，只看角度。角度越小，越相似。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/074db6cdece34f4a87fcae2406101391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=%2FDK%2BjpiyVSd7INdh00MSazZGU9E%3D" alt="" loading="lazy"/></p>
<p>这就是文本 Embedding 的本质，<strong>建立一个语义空间</strong>，把语义相似的文本放得很近，不相似的放得很远。</p>
<h4 data-id="heading-7">Embedding 的具体过程是什么？</h4>
<p>真实 Embedding 过程分为 3 步：</p>
<p><strong>步骤 1：文本 → Tokenize（分词 &amp; 转成数字）</strong></p>
<p>任何模型先把文本拆解成 token：</p>
<pre><code class="hljs language-css" lang="css">“如何提升接口性能”→ <span class="hljs-selector-attr">[<span class="hljs-string">"如何"</span>, <span class="hljs-string">"提升"</span>, <span class="hljs-string">"接口"</span>, <span class="hljs-string">"性能"</span>]</span>→ <span class="hljs-selector-attr">[10342, 664, 9912, 2203]</span>
</code></pre>
<p><strong>步骤 2：放入 Transformer（Encoder 或者 LLM 的隐藏层）</strong></p>
<p>文本经过 Transformer 网络处理。Transformer 做了：</p>
<p><strong>a.Self-Attention（让模型理解词之间的关系）</strong></p>
<p><strong>b.多层前馈网络（提取语义）</strong></p>
<p><strong>c.残差、归一化等结构</strong></p>
<p>此时模型已经“理解了语义关系”。</p>
<p><strong>步骤 3：取隐藏状态 / Pooling，得到最终向量</strong></p>
<p>Embedding 模型的关键在于<strong>它会对所有 token 的语义表示做 pooling（比如平均池化 mean pooling）得到一个固定维度的向量。</strong></p>
<p>例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">token embeddings:</span> <span class="hljs-number">768</span> <span class="hljs-string">维</span> <span class="hljs-string">×</span> <span class="hljs-number">20</span> <span class="hljs-string">个</span> <span class="hljs-string">token↓mean</span> <span class="hljs-string">pooling↓输出一个</span> <span class="hljs-number">768</span> <span class="hljs-string">维的向量（整个句子的语义表示）</span>
</code></pre>
<p>这就是 Embedding。</p>
<h4 data-id="heading-8">为什么有的模型可以做 Embedding，有的不能？</h4>
<p>因为不是所有模型结构适合输出固定的向量语义表示。大语言模型（LLM）可以分类：</p>
<p><strong>(1) Encoder-only 模型（专门做 Embedding 的）</strong></p>
<p>例如：</p>
<ul>
<li><strong>sentence-transformers (mpnet)</strong></li>
<li><strong>BERT</strong></li>
<li><strong>Text-Embedding-3-small/large</strong></li>
<li><strong>MiniLM</strong></li>
</ul>
<p>它们结构上就是：</p>
<pre><code class="hljs">Encoder → Pooling → 一个向量
</code></pre>
<p>这种模型<strong>天生适合集合语义，输出 embedding</strong>。</p>
<p><strong>(2) Decoder-only 模型（像 GPT 模型）主要是生成模型</strong></p>
<p>例如 GPT-4 / GPT-3.5 / Llama 等。</p>
<p>它们是：</p>
<pre><code class="hljs language-sql" lang="sql">Decoder<span class="hljs-operator">-</span><span class="hljs-keyword">only</span> Transformer → 负责做语言生成
</code></pre>
<p>Decoder-only 的隐藏层是“自回归”的，每个 token 负责预测下一个 token。</p>
<p><strong>(3) Encoder-Decoder 模型</strong></p>
<p>它的设计目标也是生成和翻译，不是做 embedding。</p>
<h4 data-id="heading-9">Embedding 模型 vs LLM的真正区别</h4>








































<table><thead><tr><th>对比点</th><th>Embedding 模型</th><th>大语言模型（LLM）</th></tr></thead><tbody><tr><td>目标</td><td>语义向量表示</td><td>文本生成</td></tr><tr><td>输入</td><td>文本</td><td>文本</td></tr><tr><td>输出</td><td>一个固定长度向量</td><td>生成 token（回复一句话）</td></tr><tr><td>核心结构</td><td>Encoder</td><td>Decoder</td></tr><tr><td>是否做 pooling</td><td><strong>是，必须有</strong></td><td>通常<strong>没有</strong></td></tr><tr><td>应用场景</td><td>检索、向量数据库、相似度搜索、聚类、RAG</td><td>对话、问答、生成内容、写代码等</td></tr></tbody></table>
<p>一句话总结：<strong>Embedding 模型负责“理解内容”，LLM 负责“生成内容”。</strong></p>
<h4 data-id="heading-10">为什么需要专门的 Embedding 模型，而不是让 LLM 来做？</h4>
<p><strong>(1) 计算效率</strong></p>
<p>Embedding 模型一般只有 100M~1B 参数，非常轻量。</p>
<p>LLM 有几十亿～几千亿参数，拿它来算一个向量完全没必要。</p>
<p><strong>(2) 质量更高</strong></p>
<p>Embedding 模型是用对比学习（Contrastive Learning）训练的，目标就是把“语义相似”的句子放得更近。LLM 的训练目标只是预测下一个 token。</p>
<p><strong>(3) 一致性强</strong></p>
<p>Embedding 模型输出的向量分布非常稳定（适合向量库）。LLM 的隐藏层 embedding 会随提示词、上下文变化而波动，不适合作为稳定语义向量。</p>
<h4 data-id="heading-11">为什么 Embedding 这么重要</h4>
<p>RAG 的核心三步：</p>
<p><strong>1.用 Embedding 把知识库内容向量化</strong></p>
<p><strong>2.用 Embedding 把查询向量化</strong></p>
<p>**3.检索“语义最相近”的文档</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a092f49510dd42d69d3ab0202dc73391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=C0EcVFlNohQQ%2F88jlP44Koxq16U%3D" alt="" loading="lazy"/></p>
<p>如果没有 Embedding，RAG 根本无法运行。这就是为什么：</p>
<p><strong>RAG = Embedding + 向量数据库 + LLM</strong></p>
<p>其中 Embedding 是地基。</p>
<h3 data-id="heading-12">Embedding和向量数据库有什么关系</h3>
<p>这个问题可以一句话进行总结：</p>
<p><strong>Embedding 是把文本转成向量的过程；向量数据库是存向量并做向量检索的地方。</strong></p>
<p><strong>Embedding 产生向量 → 向量存入向量数据库 → 大模型从数据库里用相似度检索找到相关知识 → 最后让 LLM 回答。</strong></p>
<p>这就是 RAG 的基础工作流。</p>
<h3 data-id="heading-13">RAG</h3>
<p>前面我们已经讲了 Embedding 如何把文本变成向量，以及向量数据库如何在海量向量中快速找到“最相似的知识”，这些都是基础设施，而 RAG（Retrieval-Augmented Generation）就是把它们<strong>组合成一个可工作的 AI 能力</strong>。</p>
<p><strong>如果说Embedding 是“编码”，向量数据库是“记忆”，那么 RAG 就是“用记忆回答问题的过程”</strong></p>
<p>我们可以把 RAG 理解成一个执行链路：<strong>先找知识（Retrieve），再生成答案（Generate）</strong></p>
<h4 data-id="heading-14">为什么需要 RAG？</h4>
<p>LLM 很强，但它有两个硬伤：</p>
<p><strong>1）它不知道你企业内部的知识（知识截止）</strong> 例如你的 SOP、财务制度、业务数据，这些大模型无法直接“知道”。</p>
<p><strong>2）它会胡编（幻觉）</strong> 当模型不确定答案时，它会“想象一个”。</p>
<p>RAG 的目标就是解决这两个问题：缓解幻觉，引入实时、外部、私有的知识让模型给出更可靠、更贴合业务的答案</p>
<p>本质上：</p>
<p><strong>RAG 让大模型从“猜答案”变成“查资料”。</strong></p>
<h4 data-id="heading-15">RAG 的工作流到底是什么？</h4>
<p>最简单的一句话：</p>
<p><strong>Embedding → 向量召回 → 把知识塞给模型 → 让它回答</strong></p>
<p>如果展开成技术流，会是这样的一条链路：</p>
<p><strong>1）用户提问</strong></p>
<p><strong>2）对问题进行向量化（Query Embedding）</strong></p>
<p><strong>3）向量数据库中检索最相似的 Top-K 片段</strong></p>
<p><strong>4）把这些检索结果与 Prompt 拼接</strong></p>
<p><strong>5）交给 LLM，让它基于“提供的知识”生成答案</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37a17bd216b148c1b2a5713537059815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=Y1kpddj9dJ9pDf48wzw5e%2Ba5IAw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">RAG 并不是“让模型变强”，而是让模型“用到外部知识”</h4>
<p>很多人误以为 RAG 是增强模型能力。但本质上<strong>RAG 不改变模型本身，只改变它获得知识的方式。</strong></p>
<p>LLM 的作用只变成“把检索到的信息组合起来，用自然语言表达出来”。知识不再藏在模型参数里，而是藏在向量数据库里，我们可以随时更新知识，而模型不需要重新训练。</p>
<h4 data-id="heading-17">RAG = 我们提供知识，模型负责表达</h4>
<p>我们可以把 RAG 想象成一支团队：</p>
<ul>
<li>向量数据库：资料管理员</li>
<li>Embedding：文档编码员</li>
<li>LLM：负责写报告的实习生</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffa12ee437d4b3fafdf7d74379f895a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=q5MOnGcoPHiqNrFcpiRuJZX3oIE%3D" alt="" loading="lazy"/></p>
<p>工作流程就是：</p>
<p><strong>把资料交给实习生 → 实习生看完 → 写成回答 → 给你</strong></p>
<h3 data-id="heading-18">向量数据库 + RAG + 大模型整体架构图</h3>
<p>下图展示了一个典型的  <strong>“向量数据库 + RAG + 大模型”</strong>  的完整工作流程，它描述了用户提问后，系统如何利用知识库增强大模型的回答质量。整个流程大致可分为四个阶段：</p>
<p>首先，用户提出问题，请求会先进入 <strong>RAG（检索增强生成）层</strong>。RAG 的第一步是使用 <strong>Embedding 模型</strong> 将用户的问题转换为向量（Query Embedding）。随后，系统根据这个向量到 <strong>向量数据库（Vector DB）</strong>  中进行相似度检索。向量数据库中事先存储了经过切片的文档内容及其对应的 Embedding 向量，并通过 HNSW、IVF 等 ANN（近似最近邻）算法来快速找到语义最相近的内容片段。</p>
<p>完成检索后，系统会进入到 <strong>Prompt 构建器</strong> 阶段。这个步骤非常关键，它会把用户原始问题与检索到的知识片段组合起来，构造成一条包含更多“上下文知识”的增强提示（Augmented Prompt），也就是给大模型提供更准确的背景信息。</p>
<p>最后，这条增强后的 Prompt 会被送入 <strong>LLM（大语言模型）</strong> ，如 GPT、Claude、Qwen 等。大模型基于提供的知识生成更可靠、更准确的回答，并最终返回给用户。</p>
<p>整体架构清晰呈现了一个核心思想：</p>
<blockquote>
<p>❝</p>
<p><strong>RAG 用 Embedding 理解问题 → 向量数据库找到最相关知识 → Prompt 构建器把知识提供给大模型 → LLM 基于知识回答问题。</strong></p>
</blockquote>
<p>这是目前大模型应用中最主流、最可靠的知识增强方式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4ae9e9db61942f3899eb2881903217b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=9b4moKSybCwBsc5fcAmRpksxBZw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">小总结</h3>
<p>如果把一个智能系统比作一个大脑，那么 <strong>Embedding 是理解世界的方式</strong>，<strong>向量数据库是记忆世界的结构</strong>，而 <strong>RAG 则是让理解过的知识真正被使用起来的方式</strong>。</p>
<p>Embedding 把原本混乱的文本世界编码成有意义的向量空间，让“相似”可以被数学化；向量数据库用高性能 ANN 架构为这些向量提供了可扩展的“长时记忆”；最终，RAG 作为桥梁，让大模型在回答每一个问题时，都能实时检索相关的知识片段，把“现学现用”变成现实。</p>
<p>换句话说，RAG 让模型不再仅仅依赖固定参数里的“死记硬背”，而是获得了 <strong>实时学习、即时查询、动态回答</strong> 的能力。</p>
<p>当这三者组合在一起，我们构建的就不再是一个简单的问答系统，而是一个<strong>真正能理解业务、吸收知识、持续进化的 AI 系统</strong>。</p>
<h2 data-id="heading-20">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ Lambda表达式：从“这是什么鬼”到“真香！”的完整心路历程]]></title>    <link>https://juejin.cn/post/7577970969395609641</link>    <guid>https://juejin.cn/post/7577970969395609641</guid>    <pubDate>2025-11-30T12:32:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577970969395609641" data-draft-id="7577969462860759103" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ Lambda表达式：从“这是什么鬼”到“真香！”的完整心路历程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T12:32:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ Lambda表达式：从“这是什么鬼”到“真香！”的完整心路历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:32:05.000Z" title="Sun Nov 30 2025 12:32:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文不会像教科书一样罗列Lambda的语法，而是带你重走一遍每个C++程序员认识Lambda的经典“真香”之路。从最初的反感，到偶然一试的惊喜，最终成为日常开发离不开的神器。</p>
</blockquote>
<h3 data-id="heading-0"><strong>那个让我头疼的下午</strong></h3>
<p>还记得那个被<code>std::sort</code>和自定义比较函数折磨的下午吗？</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 古老的写法：在函数体外定义比较函数</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">compareByName</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b)</span> </span>{
    <span class="hljs-keyword">return</span> a.name &lt; b.name;
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">compareByScore</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b)</span> </span>{
    <span class="hljs-keyword">return</span> a.score &gt; b.score;
}

<span class="hljs-comment">// 在某个函数里...</span>
std::vector&lt;Student&gt; students;
<span class="hljs-comment">// ... 填充数据</span>

std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), compareByName);
<span class="hljs-comment">// 等等，我要是想按分数降序排列呢？</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), compareByScore);
</code></pre>
<p><strong>当时的我内心OS</strong>：<em>“太麻烦了！只是为了一个简单的比较逻辑，我要：</em></p>
<ol>
<li><em>跳到文件顶部去定义函数</em></li>
<li><em>给函数起个有意义的名字</em></li>
<li><em>万一这个比较逻辑只用一次，感觉好浪费啊</em></li>
<li><em>如果要在函数内使用局部变量进行比较？完蛋，得用函数对象，更复杂了！”</em></li>
</ol>
<p>就在我几乎要放弃的时候，我听说了<strong>Lambda表达式</strong>。第一反应是：</p>
<p><strong>“这又是什么鬼语法？C++已经够复杂了！”</strong> 🥴</p>
<h3 data-id="heading-1"><strong>第一阶段：初次见面，这语法也太怪了吧</strong></h3>
<p>第一次看到Lambda，我的内心是拒绝的：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 这是什么东西？中括号、小括号、花括号...</span>
<span class="hljs-keyword">auto</span> hello = []() { 
    std::cout &lt;&lt; <span class="hljs-string">"Hello Lambda!"</span> &lt;&lt; std::endl;
};
<span class="hljs-built_in">hello</span>();
</code></pre>
<p><strong>我的吐槽</strong>：<em>“这不就是匿名函数吗？JavaScript玩剩下的！而且这<code>[](){}</code>的语法，看起来像表情符号一样！”</em></p>
<p>但当我被迫在项目中尝试了一次后...</p>
<h3 data-id="heading-2"><strong>第二阶段：被迫尝试，意外地...有点方便？</strong></h3>
<p>还是那个排序的问题，用Lambda重写：</p>
<pre><code class="hljs language-cpp" lang="cpp">std::vector&lt;Student&gt; students;

<span class="hljs-comment">// 按姓名排序</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b) {
        <span class="hljs-keyword">return</span> a.name &lt; b.name;
    });

<span class="hljs-comment">// 按分数降序排列</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b) {
        <span class="hljs-keyword">return</span> a.score &gt; b.score;
    });

<span class="hljs-comment">// 甚至...按姓名长度排序？</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b) {
        <span class="hljs-keyword">return</span> a.name.<span class="hljs-built_in">length</span>() &lt; b.name.<span class="hljs-built_in">length</span>();
    });
</code></pre>
<p><strong>"咦？"</strong> 我发现了第一个优点：</p>
<ul>
<li><strong>就地定义</strong>：逻辑就在使用的地方，不用跳来跳去</li>
<li><strong>无需命名</strong>：避免了我绞尽脑汁想<code>compareByNameAscending</code>这种长名字</li>
<li><strong>代码更紧凑</strong>：几行代码搞定，阅读流不会被中断</li>
</ul>
<h3 data-id="heading-3"><strong>第三阶段：发现超能力，这玩意有点东西！</strong></h3>
<p>真正的"真香"时刻，是当我发现Lambda能<strong>捕获外部变量</strong>时：</p>
<h4 data-id="heading-4"><strong>场景1：找到分数高于平均分的学生</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">double</span> averageScore = <span class="hljs-built_in">calculateAverage</span>(students);
<span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(),
    [averageScore](<span class="hljs-type">const</span> Student&amp; s) {  <span class="hljs-comment">// 捕获外部变量！</span>
        <span class="hljs-keyword">return</span> s.score &gt; averageScore;
    });
</code></pre>
<p><strong>传统写法对比</strong>：<em>要么用全局变量（丑陋），要么定义函数对象类（繁琐）。现在一行捕获就搞定！</em></p>
<h4 data-id="heading-5"><strong>场景2：按不同阈值筛选</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">filterStudents</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;Student&gt;&amp; students, <span class="hljs-type">int</span> threshold)</span> </span>{
    <span class="hljs-comment">// Lambda可以捕获函数参数！</span>
    <span class="hljs-keyword">auto</span> count = std::<span class="hljs-built_in">count_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(),
        [threshold](<span class="hljs-type">const</span> Student&amp; s) {
            <span class="hljs-keyword">return</span> s.score &gt;= threshold;
        });
    std::cout &lt;&lt; <span class="hljs-string">"超过"</span> &lt;&lt; threshold &lt;&lt; <span class="hljs-string">"分的人数: "</span> &lt;&lt; count &lt;&lt; std::endl;
}
</code></pre>
<p><strong>此时的我</strong>：<em>"等等，这比我想象的要强大啊！"</em> 🤔</p>
<h3 data-id="heading-6"><strong>第四阶段：进阶用法，打开新世界的大门</strong></h3>
<p>当我深入使用后，发现了更多让人直呼"真香"的用法：</p>
<h4 data-id="heading-7"><strong>1. 捕获列表的妙用</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> baseScore = <span class="hljs-number">60</span>;
<span class="hljs-type">int</span> bonus = <span class="hljs-number">5</span>;

<span class="hljs-comment">// 值捕获</span>
<span class="hljs-keyword">auto</span> lambda1 = [baseScore]() { <span class="hljs-keyword">return</span> baseScore; };

<span class="hljs-comment">// 引用捕获 - 小心生命周期！</span>
<span class="hljs-keyword">auto</span> lambda2 = [&amp;baseScore]() { <span class="hljs-keyword">return</span> baseScore; };

<span class="hljs-comment">// 捕获多个变量</span>
<span class="hljs-keyword">auto</span> lambda3 = [baseScore, bonus](<span class="hljs-type">int</span> x) { <span class="hljs-keyword">return</span> x + baseScore + bonus; };

<span class="hljs-comment">// 捕获this（在成员函数中）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> {
    std::string className;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">getClassChecker</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>](<span class="hljs-type">const</span> Student&amp; s) { 
            <span class="hljs-keyword">return</span> s.<span class="hljs-keyword">class</span> == <span class="hljs-keyword">this</span>-&gt;className;  <span class="hljs-comment">// 捕获this指针</span>
        };
    }
};
</code></pre>
<h4 data-id="heading-8"><strong>2. 与STL算法的完美配合</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp">std::vector&lt;<span class="hljs-type">int</span>&gt; scores = {<span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>, <span class="hljs-number">60</span>, <span class="hljs-number">45</span>, <span class="hljs-number">88</span>};

<span class="hljs-comment">// 统计优秀学生</span>
<span class="hljs-type">int</span> excellentCount = std::<span class="hljs-built_in">count_if</span>(scores.<span class="hljs-built_in">begin</span>(), scores.<span class="hljs-built_in">end</span>(),
    [](<span class="hljs-type">int</span> score) { <span class="hljs-keyword">return</span> score &gt;= <span class="hljs-number">90</span>; });

<span class="hljs-comment">// 给每个人加平时分</span>
std::for_each(scores.<span class="hljs-built_in">begin</span>(), scores.<span class="hljs-built_in">end</span>(),
    [](<span class="hljs-type">int</span>&amp; score) { score += <span class="hljs-number">5</span>; });  <span class="hljs-comment">// 注意引用！</span>

<span class="hljs-comment">// 生成新的转换序列</span>
std::vector&lt;std::string&gt; gradeComments;
std::<span class="hljs-built_in">transform</span>(scores.<span class="hljs-built_in">begin</span>(), scores.<span class="hljs-built_in">end</span>(), 
               std::<span class="hljs-built_in">back_inserter</span>(gradeComments),
    [](<span class="hljs-type">int</span> score) -&gt; std::string {
        <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">90</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"优秀"</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"及格"</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">"加油！"</span>;
    });
</code></pre>
<h3 data-id="heading-9"><strong>第五阶段：成为日常，离不开的"瑞士军刀"</strong></h3>
<p>现在，Lambda已经成为我代码中不可或缺的一部分：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 场景：按钮点击事件（模拟）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> {
    std::function&lt;<span class="hljs-type">void</span>()&gt; onClick;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setOnClick</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; callback)</span> </span>{
        onClick = callback;
    }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">click</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">if</span>(onClick) <span class="hljs-built_in">onClick</span>(); }
};

<span class="hljs-comment">// 使用Lambda作为回调</span>
button.<span class="hljs-built_in">setOnClick</span>([&amp;students, <span class="hljs-keyword">this</span>]() {
    std::cout &lt;&lt; <span class="hljs-string">"刷新显示"</span> &lt;&lt; students.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">"个学生"</span> &lt;&lt; std::endl;
    <span class="hljs-built_in">refreshDisplay</span>();  <span class="hljs-comment">// 捕获this调用成员函数</span>
});
</code></pre>
<p><strong>对比传统写法</strong>：<em>要么定义一堆小函数，要么继承重写虚函数...现在一个Lambda直接内联搞定！</em></p>
<h3 data-id="heading-10"><strong>"真香"总结：我为什么爱上了Lambda</strong></h3>
<ol>
<li><strong>代码局部性</strong>：逻辑就在使用的地方，阅读不用跳转</li>
<li><strong>减少命名污染</strong>：避免了一堆只使用一次的函数名</li>
<li><strong>捕获上下文</strong>：轻松使用局部变量，告别繁琐的参数传递</li>
<li><strong>函数式编程</strong>：让C++支持更现代的编程范式</li>
<li><strong>性能优秀</strong>：编译器可以内联优化，通常比函数指针更快</li>
</ol>
<h3 data-id="heading-11"><strong>避坑指南：新手常犯的3个错误</strong></h3>
<p>当然，Lambda也不是完美的：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 错误1：悬空引用</span>
<span class="hljs-function">std::function&lt;<span class="hljs-title">void</span><span class="hljs-params">()</span>&gt; <span class="hljs-title">createDangerousLambda</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> localVar = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">return</span> [&amp;localVar]() {  <span class="hljs-comment">// 捕获了局部变量的引用！</span>
        std::cout &lt;&lt; localVar;  <span class="hljs-comment">// localVar已销毁，未定义行为！</span>
    };
}

<span class="hljs-comment">// 错误2：默认捕获的陷阱</span>
<span class="hljs-type">int</span> value = <span class="hljs-number">10</span>;
<span class="hljs-keyword">auto</span> lambda = [=]() {  <span class="hljs-comment">// [=] 值捕获所有变量</span>
    <span class="hljs-comment">// 但捕获的是value的当前值，后续修改不影响这里</span>
};
value = <span class="hljs-number">20</span>;  <span class="hljs-comment">// lambda内部的value还是10</span>

<span class="hljs-comment">// 错误3：过度使用，降低可读性</span>
<span class="hljs-comment">// 当Lambda逻辑很复杂时，还是老老实实写命名函数吧！</span>
</code></pre>
<h3 data-id="heading-12"><strong>从抗拒到真香的心路历程</strong></h3>
<p>回顾这段旅程：</p>
<ul>
<li><strong>初见</strong>：<code>[](){}</code>？这是什么鬼语法！</li>
<li><strong>尝试</strong>：嗯...好像有点方便</li>
<li><strong>深入</strong>：捕获变量？这个功能太强了！</li>
<li><strong>精通</strong>：STL算法+Lambda，代码从未如此优雅</li>
<li><strong>依赖</strong>：没有Lambda的日子，我已经不会写C++了</li>
</ul>
<p><strong>现在我的代码风格</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 以前</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isExcellentStudent</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; s)</span> </span>{
    <span class="hljs-keyword">return</span> s.score &gt;= <span class="hljs-number">90</span> &amp;&amp; s.attendance &gt;= <span class="hljs-number">0.9</span>;
}
<span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), isExcellentStudent);

<span class="hljs-comment">// 现在</span>
<span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; s) {
        <span class="hljs-keyword">return</span> s.score &gt;= <span class="hljs-number">90</span> &amp;&amp; s.attendance &gt;= <span class="hljs-number">0.9</span>;
    });
</code></pre>
<p><strong>最后的灵魂拷问</strong>：<em>你还在用传统函数折磨自己吗？快来加入Lambda的"真香"阵营吧！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++网络编程：从Socket混乱到优雅Reactor的蜕变之路]]></title>    <link>https://juejin.cn/post/7577958825342746643</link>    <guid>https://juejin.cn/post/7577958825342746643</guid>    <pubDate>2025-11-30T12:39:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342746643" data-draft-id="7577905525998059561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++网络编程：从Socket混乱到优雅Reactor的蜕变之路"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T12:39:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++网络编程：从Socket混乱到优雅Reactor的蜕变之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:39:39.000Z" title="Sun Nov 30 2025 12:39:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文不会教你<code>socket()</code>和<code>bind()</code>的基本调用，而是带你体验一个C++后端工程师的成长历程：从被多连接折磨到崩溃，到发现Reactor模式后如获至宝，最终写出既高性能又易维护的网络代码。</p>
</blockquote>
<h3 data-id="heading-0"><strong>那个让我濒临崩溃的深夜</strong></h3>
<p>还记得第一次写网络服务的那个夜晚吗？我的"杰作"长这样：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 初代作品 - 同步阻塞式，只能服务一个客户</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleClient</span><span class="hljs-params">(<span class="hljs-type">int</span> client_socket)</span> </span>{
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-type">int</span> bytes_received = <span class="hljs-built_in">recv</span>(client_socket, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span>(bytes_received &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
        
        <span class="hljs-comment">// 处理业务逻辑</span>
        <span class="hljs-built_in">processRequest</span>(buffer, bytes_received);
        
        <span class="hljs-built_in">send</span>(client_socket, buffer, bytes_received, <span class="hljs-number">0</span>);
    }
    <span class="hljs-built_in">close</span>(client_socket);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> server_fd = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// ... bind, listen 等操作</span>
    
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-type">int</span> client_socket = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        <span class="hljs-built_in">handleClient</span>(client_socket);  <span class="hljs-comment">// 第二个连接？等着吧！</span>
    }
}
</code></pre>
<p><strong>当时的困境</strong>：<em>"为什么第二个客户端连接时，整个服务器就卡住了？"</em></p>
<p>于是我知道了要开多线程...</p>
<h3 data-id="heading-1"><strong>第一阶段：线程 - 从希望到绝望</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 二代作品 - 一线程一连接</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleClient</span><span class="hljs-params">(<span class="hljs-type">int</span> client_socket)</span> </span>{
    <span class="hljs-comment">// 处理逻辑</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> server_fd = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// ... 设置socket, bind, listen</span>
    
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-type">int</span> client_socket = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        
        <span class="hljs-comment">// 来一个连接就开一个线程</span>
        <span class="hljs-function">std::thread <span class="hljs-title">client_thread</span><span class="hljs-params">(handleClient, client_socket)</span></span>;
        client_thread.<span class="hljs-built_in">detach</span>();  <span class="hljs-comment">// 分离线程，自生自灭</span>
    }
}
</code></pre>
<p><strong>短暂的喜悦</strong>：<em>"太好了！现在可以同时服务多个客户端了！"</em></p>
<p><strong>很快的现实打击</strong>：</p>
<ul>
<li>连接数达到1000时，内存耗尽</li>
<li>线程上下文切换开销让CPU不堪重负</li>
<li>竞态条件、死锁问题频发</li>
<li>调试？简直就是噩梦！</li>
</ul>
<p><strong>我的内心</strong>：<em>"这根本不是解决方案，只是把问题推迟了而已！"</em> 😫</p>
<h3 data-id="heading-2"><strong>第二阶段：遇见I/O多路复用 - 看见曙光</strong></h3>
<p>就在我准备转行的时候，听说了<code>select()</code>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 三代作品 - 使用select</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> server_fd = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// ... 设置非阻塞，bind, listen</span>
    
    fd_set read_fds;
    std::vector&lt;<span class="hljs-type">int</span>&gt; client_sockets;
    client_sockets.<span class="hljs-built_in">push_back</span>(server_fd);
    
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-built_in">FD_ZERO</span>(&amp;read_fds);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> sock : client_sockets) {
            <span class="hljs-built_in">FD_SET</span>(sock, &amp;read_fds);
        }
        
        <span class="hljs-comment">// 等待事件发生</span>
        <span class="hljs-type">int</span> activity = <span class="hljs-built_in">select</span>(FD_SETSIZE, &amp;read_fds, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">FD_ISSET</span>(server_fd, &amp;read_fds)) {
            <span class="hljs-comment">// 有新连接</span>
            <span class="hljs-type">int</span> client_socket = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
            <span class="hljs-built_in">setNonBlocking</span>(client_socket);
            client_sockets.<span class="hljs-built_in">push_back</span>(client_socket);
        }
        
        <span class="hljs-comment">// 检查所有客户端socket</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it = client_sockets.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">1</span>; it != client_sockets.<span class="hljs-built_in">end</span>(); ) {
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">FD_ISSET</span>(*it, &amp;read_fds)) {
                <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
                <span class="hljs-type">int</span> bytes_read = <span class="hljs-built_in">recv</span>(*it, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
                <span class="hljs-keyword">if</span>(bytes_read &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-built_in">processRequest</span>(buffer, bytes_read);
                    <span class="hljs-built_in">send</span>(*it, buffer, bytes_read, <span class="hljs-number">0</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// 连接关闭</span>
                    <span class="hljs-built_in">close</span>(*it);
                    it = client_sockets.<span class="hljs-built_in">erase</span>(it);
                    <span class="hljs-keyword">continue</span>;
                }
            }
            ++it;
        }
    }
}
</code></pre>
<p><strong>进步</strong>：<em>"单线程处理上千连接！CPU使用率从100%降到5%！"</em></p>
<p><strong>新问题</strong>：</p>
<ul>
<li><code>select</code>有文件描述符数量限制（1024）</li>
<li>每次都要遍历所有socket，效率低</li>
<li>代码复杂度急剧上升</li>
</ul>
<h3 data-id="heading-3"><strong>第三阶段：现代I/O多路复用 - epoll登场</strong></h3>
<p>在Linux上，我发现了<code>epoll</code>这个神器：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 四代作品 - 使用epoll</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EpollServer</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> epoll_fd;
    <span class="hljs-type">int</span> server_fd;
    std::unordered_map&lt;<span class="hljs-type">int</span>, std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; handlers;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{
        epoll_fd = <span class="hljs-built_in">epoll_create1</span>(<span class="hljs-number">0</span>);
        server_fd = <span class="hljs-built_in">createServerSocket</span>();
        
        <span class="hljs-built_in">addSocketToEpoll</span>(server_fd, EPOLLIN, [<span class="hljs-keyword">this</span>]() {
            <span class="hljs-built_in">acceptNewConnection</span>();
        });
        
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> events[<span class="hljs-number">64</span>];
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
            <span class="hljs-type">int</span> n = <span class="hljs-built_in">epoll_wait</span>(epoll_fd, events, <span class="hljs-number">64</span>, <span class="hljs-number">-1</span>);
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {
                <span class="hljs-type">int</span> fd = events[i].data.fd;
                <span class="hljs-keyword">if</span>(handlers.<span class="hljs-built_in">count</span>(fd)) {
                    handlers[fd]();  <span class="hljs-comment">// 执行对应的处理函数</span>
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">acceptNewConnection</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">int</span> client_fd = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        <span class="hljs-built_in">setNonBlocking</span>(client_fd);
        
        <span class="hljs-built_in">addSocketToEpoll</span>(client_fd, EPOLLIN, [<span class="hljs-keyword">this</span>, client_fd]() {
            <span class="hljs-built_in">handleClientData</span>(client_fd);
        });
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleClientData</span><span class="hljs-params">(<span class="hljs-type">int</span> client_fd)</span> </span>{
        <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {  <span class="hljs-comment">// 非阻塞读取，直到读完</span>
            <span class="hljs-type">int</span> bytes_read = <span class="hljs-built_in">recv</span>(client_fd, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span>(bytes_read &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-built_in">processRequest</span>(buffer, bytes_read);
                <span class="hljs-comment">// 这里可以改为异步发送</span>
                <span class="hljs-built_in">send</span>(client_fd, buffer, bytes_read, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(bytes_read == <span class="hljs-number">0</span> || (bytes_read &lt; <span class="hljs-number">0</span> &amp;&amp; errno != EAGAIN)) {
                <span class="hljs-comment">// 连接关闭或错误</span>
                <span class="hljs-built_in">removeClient</span>(client_fd);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 没有更多数据了</span>
            }
        }
    }
};
</code></pre>
<p><strong>顿悟时刻</strong>：<em>"等等...这不就是事件驱动吗？每个socket事件触发对应的处理函数..."</em></p>
<h3 data-id="heading-4"><strong>第四阶段：Reactor模式 - 架构的艺术</strong></h3>
<p>当我系统学习后，才发现这就是<strong>Reactor模式</strong>！让我用现代C++重新实现：</p>
<h4 data-id="heading-5"><strong>Reactor核心组件</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 1. 事件类型</span>
<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">EventType</span> {
    READ = <span class="hljs-number">0x01</span>,
    WRITE = <span class="hljs-number">0x02</span>,
    ERROR = <span class="hljs-number">0x04</span>
};

<span class="hljs-comment">// 2. 事件处理器接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventHandler</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">EventHandler</span>() = <span class="hljs-keyword">default</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(EventType event)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">getHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-comment">// 3. Reactor核心 - 事件分发器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Reactor</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> epoll_fd;
    std::unordered_map&lt;<span class="hljs-type">int</span>, std::shared_ptr&lt;EventHandler&gt;&gt; handlers;
    <span class="hljs-type">bool</span> running{<span class="hljs-literal">false</span>};
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Reactor</span>() {
        epoll_fd = <span class="hljs-built_in">epoll_create1</span>(<span class="hljs-number">0</span>);
    }
    
    ~<span class="hljs-built_in">Reactor</span>() {
        <span class="hljs-built_in">close</span>(epoll_fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">registerHandler</span><span class="hljs-params">(std::shared_ptr&lt;EventHandler&gt; handler, EventType events)</span> </span>{
        <span class="hljs-type">int</span> fd = handler-&gt;<span class="hljs-built_in">getHandle</span>();
        handlers[fd] = handler;
        
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> ev;
        ev.events = <span class="hljs-built_in">convertToEpollEvents</span>(events);
        ev.data.fd = fd;
        
        <span class="hljs-built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_ADD, fd, &amp;ev);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">removeHandler</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> </span>{
        <span class="hljs-built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_DEL, fd, <span class="hljs-literal">nullptr</span>);
        handlers.<span class="hljs-built_in">erase</span>(fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        running = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> events[<span class="hljs-number">64</span>];
        
        <span class="hljs-keyword">while</span>(running) {
            <span class="hljs-type">int</span> n = <span class="hljs-built_in">epoll_wait</span>(epoll_fd, events, <span class="hljs-number">64</span>, <span class="hljs-number">-1</span>);
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {
                <span class="hljs-type">int</span> fd = events[i].data.fd;
                <span class="hljs-keyword">if</span>(handlers.<span class="hljs-built_in">count</span>(fd)) {
                    <span class="hljs-keyword">auto</span> event_type = <span class="hljs-built_in">convertFromEpollEvents</span>(events[i].events);
                    handlers[fd]-&gt;<span class="hljs-built_in">handleEvent</span>(event_type);
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>{ running = <span class="hljs-literal">false</span>; }
};
</code></pre>
<h4 data-id="heading-6"><strong>具体的业务处理器</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 连接处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionHandler</span> : <span class="hljs-keyword">public</span> EventHandler {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> client_fd;
    Reactor&amp; reactor;
    std::string read_buffer;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ConnectionHandler</span>(<span class="hljs-type">int</span> fd, Reactor&amp; reactor) 
        : <span class="hljs-built_in">client_fd</span>(fd), <span class="hljs-built_in">reactor</span>(reactor) {
        <span class="hljs-built_in">setNonBlocking</span>(client_fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> client_fd; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(EventType event)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(event) &amp; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(EventType::READ)) {
            <span class="hljs-built_in">handleRead</span>();
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(event) &amp; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(EventType::WRITE)) {
            <span class="hljs-built_in">handleWrite</span>();
        }
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleRead</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
            <span class="hljs-type">int</span> bytes_read = <span class="hljs-built_in">recv</span>(client_fd, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span>(bytes_read &gt; <span class="hljs-number">0</span>) {
                read_buffer.<span class="hljs-built_in">append</span>(buffer, bytes_read);
                <span class="hljs-built_in">processCompleteRequests</span>();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(bytes_read == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 连接关闭</span>
                reactor.<span class="hljs-built_in">removeHandler</span>(client_fd);
                <span class="hljs-built_in">close</span>(client_fd);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(errno != EAGAIN) {
                <span class="hljs-comment">// 错误</span>
                reactor.<span class="hljs-built_in">removeHandler</span>(client_fd);
                <span class="hljs-built_in">close</span>(client_fd);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 没有更多数据</span>
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processCompleteRequests</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 解析协议，处理完整请求</span>
        <span class="hljs-type">size_t</span> pos;
        <span class="hljs-keyword">while</span>((pos = read_buffer.<span class="hljs-built_in">find</span>(<span class="hljs-string">'\n'</span>)) != std::string::npos) {
            std::string request = read_buffer.<span class="hljs-built_in">substr</span>(<span class="hljs-number">0</span>, pos);
            read_buffer.<span class="hljs-built_in">erase</span>(<span class="hljs-number">0</span>, pos + <span class="hljs-number">1</span>);
            
            std::string response = <span class="hljs-built_in">processRequest</span>(request);
            response += <span class="hljs-string">"\n"</span>;
            
            <span class="hljs-comment">// 这里应该加入写缓冲区，等待可写事件</span>
            <span class="hljs-built_in">send</span>(client_fd, response.<span class="hljs-built_in">c_str</span>(), response.<span class="hljs-built_in">length</span>(), <span class="hljs-number">0</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleWrite</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 处理写缓冲区中的数据</span>
        <span class="hljs-comment">// 当TCP发送缓冲区可用时，epoll会触发WRITE事件</span>
    }
};

<span class="hljs-comment">// 接受连接处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AcceptorHandler</span> : <span class="hljs-keyword">public</span> EventHandler {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> server_fd;
    Reactor&amp; reactor;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">AcceptorHandler</span>(<span class="hljs-type">int</span> port, Reactor&amp; reactor) 
        : <span class="hljs-built_in">reactor</span>(reactor) {
        server_fd = <span class="hljs-built_in">createServerSocket</span>(port);
        <span class="hljs-built_in">setNonBlocking</span>(server_fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> server_fd; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(EventType event)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(event) &amp; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(EventType::READ)) {
            <span class="hljs-built_in">acceptConnection</span>();
        }
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">acceptConnection</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {  <span class="hljs-comment">// 非阻塞accept，接受所有等待的连接</span>
            <span class="hljs-type">int</span> client_fd = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
            <span class="hljs-keyword">if</span>(client_fd &lt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">if</span>(errno == EAGAIN) <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 没有更多连接了</span>
                <span class="hljs-keyword">continue</span>;
            }
            
            <span class="hljs-keyword">auto</span> handler = std::<span class="hljs-built_in">make_shared</span>&lt;ConnectionHandler&gt;(client_fd, reactor);
            reactor.<span class="hljs-built_in">registerHandler</span>(handler, EventType::READ);
        }
    }
};
</code></pre>
<h4 data-id="heading-7"><strong>最终的主程序 - 优雅！</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    Reactor reactor;
    
    <span class="hljs-comment">// 创建接受器</span>
    <span class="hljs-keyword">auto</span> acceptor = std::<span class="hljs-built_in">make_shared</span>&lt;AcceptorHandler&gt;(<span class="hljs-number">8080</span>, reactor);
    reactor.<span class="hljs-built_in">registerHandler</span>(acceptor, EventType::READ);
    
    std::cout &lt;&lt; <span class="hljs-string">"Reactor服务器启动在端口 8080..."</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 运行事件循环 - 这就是核心！</span>
    reactor.<span class="hljs-built_in">run</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-8"><strong>蜕变成果：前后对比</strong></h3>



































<table><thead><tr><th>维度</th><th>传统多线程模式</th><th>Reactor模式</th></tr></thead><tbody><tr><td><strong>并发连接数</strong></td><td>受限于线程数（~1000）</td><td>数十万连接</td></tr><tr><td><strong>内存使用</strong></td><td>每个连接一个线程栈（~8MB）</td><td>每个连接少量缓冲区</td></tr><tr><td><strong>CPU使用</strong></td><td>大量上下文切换</td><td>事件驱动，几乎没有切换</td></tr><tr><td><strong>代码复杂度</strong></td><td>线程同步、锁、竞态条件</td><td>单线程思维，简单清晰</td></tr><tr><td><strong>可维护性</strong></td><td>调试困难，状态分散</td><td>模块化，易于调试</td></tr></tbody></table>
<h3 data-id="heading-9"><strong>Reactor模式的精髓</strong></h3>
<ol>
<li><strong>事件驱动</strong>：不要主动去读，等操作系统告诉你"数据准备好了"</li>
<li><strong>非阻塞I/O</strong>：绝不让自己在某个连接上卡住</li>
<li><strong>统一事件源</strong>：所有事件（连接、读、写、错误）统一处理</li>
<li><strong>职责分离</strong>：Acceptor只负责接受，Handler只处理业务</li>
</ol>
<h3 data-id="heading-10"><strong>进阶思考：从Reactor到Proactor</strong></h3>
<p>现代C++更进一步，有了<code>io_uring</code>和Proactor模式：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// C++20 协程 + io_uring 的未来方向</span>
<span class="hljs-function">async_task&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title">handleClient</span><span class="hljs-params">(io_uring&amp; ring, <span class="hljs-type">int</span> client_fd)</span> </span>{
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
    
    <span class="hljs-comment">// 异步读 - 不阻塞线程</span>
    <span class="hljs-type">int</span> bytes_read = <span class="hljs-keyword">co_await</span> <span class="hljs-built_in">async_read</span>(ring, client_fd, buffer);
    
    <span class="hljs-comment">// 处理业务</span>
    <span class="hljs-built_in">processRequest</span>(buffer, bytes_read);
    
    <span class="hljs-comment">// 异步写</span>
    <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">async_write</span><span class="hljs-params">(ring, client_fd, buffer, bytes_read)</span></span>;
}
</code></pre>
<h3 data-id="heading-11"><strong>从混乱到优雅的蜕变</strong></h3>
<p>回顾这段旅程：</p>
<ul>
<li><strong>原始时代</strong>：同步阻塞，一个连接卡死整个服务</li>
<li><strong>青铜时代</strong>：一线程一连接，资源耗尽而亡</li>
<li><strong>白银时代</strong>：select/poll，初见事件驱动曙光</li>
<li><strong>黄金时代</strong>：epoll + Reactor，单机数十万并发</li>
<li><strong>未来时代</strong>：协程 + io_uring，异步编程新范式</li>
</ul>
<p><strong>现在的我</strong>：<em>"看着清晰模块化的Reactor代码，回想当年那个被多线程bug折磨到深夜的自己，真是感慨万千。架构的进步，让复杂变得简单，让混乱变得优雅。"</em></p>
<p><strong>最后的建议</strong>：<em>"如果你还在为网络编程的并发问题头疼，不要继续在泥潭中挣扎。花时间理解Reactor模式，这将是你职业生涯中最值得的投资之一。"</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 编程协作，我的一点邪修方法，希望可以帮助到你]]></title>    <link>https://juejin.cn/post/7577905525998075945</link>    <guid>https://juejin.cn/post/7577905525998075945</guid>    <pubDate>2025-11-30T12:52:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577905525998075945" data-draft-id="7578037997323599891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 编程协作，我的一点邪修方法，希望可以帮助到你"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T12:52:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="努力的小雨"/> <meta itemprop="url" content="https://juejin.cn/user/572218015747543"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 编程协作，我的一点邪修方法，希望可以帮助到你
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/572218015747543/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    努力的小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:52:04.000Z" title="Sun Nov 30 2025 12:52:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>看到很多人总是在分享如何利用 Trae 快速开发一款 MCP 产品，这类内容大多适合一个人独立完成的小项目，类似的分享其实已经非常多了。今天，我想换个角度，和大家聊聊如何把 Trae 真正应用到工作中，帮助我们提高实际开发效率。首先，我分享的方法是我自己在工作中一直在使用的，并且已经在多个项目中实践过了。以我目前的经验来看，Trae 可以很好地辅助我完成一些小需求，对于大需求，我暂时还不敢完全依赖它。</p>
<p>今天的主角依然是 Trae-SOLO。其实，无论是国外的主流 AI IDE，还是 Trae 本身，我的看法是：方法对了，就都能切实帮助我们提升工作效率，而不仅仅是快速写出一段代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfd3fb18308e46f1a1d133456ef25d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=87Dv8jTfsX8okEpUdVWpC4HNQd8%3D" alt="d2cae7e003fabfc75163656d7519c94a" loading="lazy"/></p>
<p>我们直接进入正题。首先，要明确 AI 编程提效的目标。让 AI IDE 根据需求文档“咔咔一顿开发”，并且兼顾所有需求变动，其实并不现实。我们需要把目标设得合理：我的目标是打造一个“个人分身”，让 AI 帮助我完成需求时，输出的方案能与我脑海中的解决思路基本一致，或者比我预想的方案更完美。</p>
<p>举例来说，以开发工期为例，我通常会先从半天就能完成的小需求开始实验。这样可以及时发现问题，积累经验，然后再逐步尝试让 AI 辅助完成开发周期较长的任务。这里需要强调一点：AI 的作用是帮助我们解放双手，而不是解放大脑。所有需求我们本身必须有清晰的实现方案，当 AI 输出的方案出现偏差时，我们再通过增加项目文档和说明，让 AI 更快地理解我们的意图。通过这样的方式逐步积累经验，最终有一天，也许可以完全交给 AI 来处理，但现在这个阶段，我们更多的是在人机协作中提升效率。</p>
<h2 data-id="heading-0">文档先行</h2>
<p>就像过去打仗一样，攻城之前必须先筹备好粮草。同样，在我们进行开发工作之前，也必须做好充分的准备：首先需要明确开发任务，而这离不开详细的需求文档。然而，我们不能简单地把现有的需求文档直接交给 AI，因为 AI 很可能完全不理解其中的内容。</p>
<p>因此，我们需要先自己梳理一版“优化过”的需求文档。这版文档不仅要包含项目的关键字和核心目标，还要清晰展现我们的基本业务流程。业务流程部分不必过于复杂，因为这是我们自己最熟悉的内容，只需要一个简明扼要的版本即可。</p>
<p>梳理完需求之后，我们可以进入 Plan 模式，通过这个过程观察 Trae 是否真正理解了我们的意图和业务逻辑。如果理解无误，再进入后续的具体执行阶段。这样可以大大降低沟通成本，避免因为理解偏差而产生的返工或误解。</p>
<p>如图所示，这就是整个流程的示意和操作方法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7161b1e2c1044fa794fe5b90504268c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=Ui24uBvnioBqsBq2wgN0CgkZ%2Ffs%3D" alt="6b381d37775e4fa851a45238e5511ea6" loading="lazy"/></p>
<p>我的工作习惯是将所有文档统一放到 all-doc 目录下，方便集中管理和查找。但需要特别注意的是，这些文档不能直接和代码仓库一起提交，以避免不必要的混乱。为了解决这个问题，我目前采用的做法是单独建立一个文档类型的项目，用来存放所有项目的 doc 文档。这样，其他同事在更新文档后，我可以直接从这个文档项目中拉取最新版本，然后手动复制到我的项目中进行使用。</p>
<p>在我对文档进行修改后，我再将更改后的文件复制回文档仓库，并进行提交以解决冲突。这种方式虽然可以保证文档的集中管理和更新，但冲突是不可避免的，并且会非常频繁。</p>
<p>如果你有更高效的文档管理方式或者冲突解决方案，非常希望你能分享出来</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8bf43d2c47a4aebbb30eb293dc430d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=qjwYRv4Xk%2FeblS3fA7da1qTqPjE%3D" alt="123ae8a749c6b2a33c8556fe4dc7b164" loading="lazy"/></p>
<h3 data-id="heading-1">持久维护</h3>
<p>这部分工作同样非常重要。因为在我们完成第一版需求并将其整理记录到文档（doc）后，随后的新增需求或对原有需求的修改都必须及时更新到文档中。如果仍然保留过时的老需求，容易导致文档信息与实际开发不一致，从而对后续开发任务产生负面影响，增加沟通成本和返工风险。为了更好地管理这些问题，我将它们归纳为几类，便于后续处理和跟踪。</p>
<h4 data-id="heading-2">需求变动</h4>
<p>如果需求发生变动，第一步我们会先在文档（doc）中更新需求描述。当然，这一步不需要人工手动修改，我们会让 AI 自动完成更新。接下来，可以直接切换到 Plan 模式，检查整个流程是否存在问题。如果流程没有异常或冲突，就可以直接执行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c479f5fe4a234423916fa1682b9d8dab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=TR7Ket9%2BJ8%2F81LGyL31KALUfu9k%3D" alt="49a9fbc17982dffe9d78d86e1f037b58" loading="lazy"/></p>
<p>这里展示的是从旧版本到新版本的演示。如果旧需求已经完全不再使用，可以直接让 AI 协助删除。至于是否保留备份，我个人认为没有必要，因为保留可能会影响整体上下文的清晰性和逻辑连贯性。</p>
<h4 data-id="heading-3">新增需求点</h4>
<p>这部分内容基本上不用我多做赘述了，如果有新增需求，可以直接先交给 AI，让它帮我们生成一个初步的计划。这里我就不再做具体演示了。当然，除了这种常规情况，还有另一种场景：就是我们之前可能遗漏的一些需求。举个例子，当我们让 AI 去执行某个需求时，可能会发现它提出的改动点不准确，或者它的思考逻辑有偏差。在这种情况下，我们其实可以把 AI 生成的 plan 模式当作一个参考对比，无论发现什么不对的地方，都可以去补充和修正。这样的输入可以来源多样：有时候是需求文档，有时候是项目规则，甚至可以是一些流程规范，总之都是可用的参考依据。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50d3a9b5d05744f7b482031bde508a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=irErDOLLOgORyO5M62yK1r5Bjcg%3D" alt="7fa0fc24db457790ccf6affa4f8ae7bc" loading="lazy"/></p>
<p>从整体上来看，这套操作流程其实和修改数据库的操作有些相似：都是对已有内容进行调整和优化。只不过，这里面对的是 AI，而它的“语言”不像 SQL 那样严格规范，更多的是类似于提示词工程，需要我们用自然语言去引导它完成目标。整个过程的前期可能会比较繁琐，有时候甚至会让人感觉比较吃力，因此如果你打算用 AI IDE 来帮你开发代码，我建议可以先从一些小 bug 修复或者耗时半天左右的小需求改动开始着手。这样做的好处是，你可以逐渐熟悉整个操作流程，也会慢慢建立起使用 AI 进行开发的信心。</p>
<h2 data-id="heading-4">智能体</h2>
<p>说完文档部分，我们就进入Trae特有的模式——Agent。考虑到大多数同学的项目通常都是分布式架构或者微服务架构，因此在实际开发中，很可能会遇到多个服务之间需要进行RPC调用的情况。针对这种场景，我的思路是：首先让Agent从最简单、最高效的方式入手，避免一开始就陷入复杂的实现细节。关键在于从整体架构和需求出发，思考如何以最直接、最清晰的方式完成任务，从而兼顾性能与可维护性。具体来说，步骤如下：</p>
<blockquote>
<p>您是一位需求体系结构专家，专门分析复杂的系统需求，并为使用RPC通信的分布式体系结构确定最简单、最有效的实现策略。</p>
</blockquote>
<p>直接让Trae帮我们AI生成第一版即可，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f7ea4dbb0204498b643cd3746a98857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=iA043OXxW55169yeTZqhD19%2FceE%3D" alt="801a95951bc9174e96d72d43f0ce2a78" loading="lazy"/></p>
<p>在第一版中，AI 默认生成的 ‘何时调用’ 结果可能存在一定偏差，这是因为在生成过程中系统未对相关项目进行检索与参考。为提升准确性和可靠性，建议在聊天框中明确说明优化方法，包括需要考虑的上下文信息、数据来源或特定检索策略，以便 AI 在生成结果时能够结合更多相关信息，从而得到更精准的输出。</p>
<blockquote>
<p>这个提示词写的有问题，举例也不是按照我项目举例的，请优化后给我：《提示词》</p>
</blockquote>
<p>生成的提示词要有示例，效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f0f29c7a023439682086c4cc23a2b15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=juWTVPj43%2B5%2BtAQROF6uOTN49eM%3D" alt="35877fb323d4520b41459a99250bdfe4" loading="lazy"/></p>
<p>目前没有找到给这个agent帮忙的mcp，如果有也可以提下。效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff36be128b8a44cab40c0979ab9ad2fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=4YEGmW6EXqUMVvwTEqGSqdK%2BktE%3D" alt="093f550306c45bb5d33f24fe850d2d9b" loading="lazy"/></p>
<p>如果在需求设计阶段，没有调用你的智能体，将何时调用说明在优化下，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8edd69df26764e9b9ca0c807d37f2685~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=rCEvJ4KAHfEh03DBzC%2BwM6Mhh%2Bw%3D" alt="8729f3530b8498e6d548bf1b352f3f9c" loading="lazy"/></p>
<p>目前来讲，这些基本够我使用了，切记如果想充分发挥模型能力，一定要打开 MAX 能力并且善用plan模式，虽然钱会像流水一样，但是能力提高的不是一丁半点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1783f275a9d4e1693f610ef86dc78b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=DTBA%2FJbgkDDe%2BViuykSbqDK2RxA%3D" alt="230180dcedd6e35f2951a161c3aecbcc" loading="lazy"/></p>
<h2 data-id="heading-5">小结</h2>
<p>Trae 的真正价值，并不在于所谓的“全自动开发”能力，而在于它作为开发助力的角色。它能够帮助我们快速验证想法、完善方案，并在日常工作中有效节省那些重复劳动所占用的时间与精力。换句话说，Trae 并不是替代人类开发者的工具，而是提升工作效率、辅助决策的伙伴。只要方法得当，任何 AI 编程工具都可以在一定程度上带来类似的提升，但前提是我们理解其局限性，并合理使用它。</p>
<p>需要特别提醒的是，不要天真地以为花费几十块钱就能解决上千甚至上万的开发成本。目前阶段，AI 仍然无法完全取代人类，人与 AI 的协作才是最现实、最可靠的工作方式。即便提供再完整的文档和说明，AI 也不一定能够完全理解复杂的业务逻辑或中文语境的微妙差异——毕竟中文博大精深，连正常人的理解也可能出现偏差，更何况是机器。</p>
<p>因此，使用 AI 工具的关键在于方法和策略，而非盲目依赖成本低廉的“全能解决方案”。正确的心态是把它当作助手，而非救世主，充分发挥它在加速验证、优化方案和减少重复劳动上的优势，同时保持必要的人类判断和监督。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Z-Image 发布了 ，赶紧体验了一把（配套 Modal执行脚本）]]></title>    <link>https://juejin.cn/post/7577969462860808255</link>    <guid>https://juejin.cn/post/7577969462860808255</guid>    <pubDate>2025-11-30T12:58:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577969462860808255" data-draft-id="7577969462860349503" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Z-Image 发布了 ，赶紧体验了一把（配套 Modal执行脚本）"/> <meta itemprop="keywords" content="后端,前端,AIGC"/> <meta itemprop="datePublished" content="2025-11-30T12:58:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="志字辈小蚂蚁"/> <meta itemprop="url" content="https://juejin.cn/user/3790771822007822"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Z-Image 发布了 ，赶紧体验了一把（配套 Modal执行脚本）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3790771822007822/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    志字辈小蚂蚁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:58:14.000Z" title="Sun Nov 30 2025 12:58:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">一. 前言</h2>
<p>这一篇主要是做一个开源工具的附属产品 ，之前提到过 <a href="https://juejin.cn/post/7546793844526022656" target="_blank" title="https://juejin.cn/post/7546793844526022656">Modal</a> 这个平台 ，它时不时有活动可以薅羊毛 ， 并且账号每个月有$30 的额度 ，是一个不错的体验平台。</p>
<p>然后由于赠送的额度一直没用 ，所以就简单写了一个工具 ，用来做一键部署。所以顺带把才发布的 Z-Image 体验了一把。</p>
<ul>
<li>Modal 使用 :  <a href="https://juejin.cn/post/7544259368276934671" target="_blank" title="https://juejin.cn/post/7544259368276934671">juejin.cn/post/754425…</a></li>
<li>Modal ComfyUI : <a href="https://juejin.cn/post/7546793844526022656" target="_blank" title="https://juejin.cn/post/7546793844526022656">juejin.cn/post/754679…</a></li>
</ul>
<h2 data-id="heading-1">二. 关于用到的材料</h2>
<blockquote>
<p>需要用到的材料</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FComfy-Org" target="_blank" title="https://huggingface.co/Comfy-Org" ref="nofollow noopener noreferrer">Comfy-Org : Z-Image ComfyUI 版本 ，主要用于 ComfyUI 部署</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9987426550a4193bc987eff3b450fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=oXc18vSlN%2BHK6LkBO1sRHDQT3YY%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>qwen_3_4b.safetensors</strong> ： 文本编码器 ，<strong>自然语言推理与生成</strong>，视觉语义转化为符合逻辑的文本描述。</li>
<li><strong>z_image_turbo_bf16.safetensors</strong> ： 扩散主模型 ，主要的模型</li>
<li><strong>ae.safetensors</strong> ： VAE 解码器 ， 负责<strong>底层视觉编码</strong></li>
</ul>
<h2 data-id="heading-2">三. 工作流</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9b60262ad54bbf8ba02e2d204bef25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=aBE6%2Bu%2FGhqAJai7p8LmEuG2b0XE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">四. 效果展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83a48ce229b54ada992f2e7a340e65e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=oy90Lj3FJH%2FZWL2YzSSViVSvf4A%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>几张图片的效果 ：</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b667494e8b74ddb90ec449da17fff29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=9BvfpIw86RPaxLuph5R5vcM6Fhw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a2583b0ee704008a3219205819ad65a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=iaQj3dKupz%2B9VHLvUyaVLhT3k4Q%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>光影和质感都是非常不错的</li>
<li>最重要的是出图很快 ，没有具体的参数 ，但是明显比之前 Flux 用起来快一些</li>
</ul>
<h2 data-id="heading-4">总结</h2>
<p>简单体验了一下 ，生产力应该是足够了 ，出图很快 ，效果也很好。</p>
<p>开源的模型 ，你想生成什么都可以。</p>
<h2 data-id="heading-5">附录 ： 如果你用到了 Modal</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># Z-Image-Turbo ComfyUI 一键部署服务</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># 启动命令: modal deploy z_image_turbo_deploy.py</span>
<span class="hljs-comment"># =============================================================================</span>

<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> modal

<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S1: 环境准备 - 构建基础镜像</span>
<span class="hljs-comment"># =============================================================================</span>
image = (
    modal.Image.debian_slim(python_version=<span class="hljs-string">"3.11"</span>)
    .apt_install(<span class="hljs-string">"git"</span>, <span class="hljs-string">"wget"</span>, <span class="hljs-string">"curl"</span>)
    .pip_install(
        <span class="hljs-string">"fastapi[standard]==0.115.4"</span>,
        <span class="hljs-string">"comfy-cli==1.5.3"</span>,
        <span class="hljs-string">"requests==2.32.3"</span>,
    )
    .run_commands(<span class="hljs-string">"comfy --skip-prompt install --fast-deps --nvidia"</span>)
)

<span class="hljs-comment"># HuggingFace Secret</span>
<span class="hljs-keyword">try</span>:
    hf_secret = modal.Secret.from_name(<span class="hljs-string">"huggingface-secret"</span>)
<span class="hljs-keyword">except</span> modal.exception.NotFoundError:
    hf_secret = <span class="hljs-literal">None</span>


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S2: 模型下载 - 从 Tongyi-MAI/Z-Image-Turbo 下载 3 个核心模型</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hf_download</span>():
    <span class="hljs-string">"""
    下载 Z-Image-Turbo 模型:
    - z_image_turbo_bf16.safetensors (主扩散模型)
    - qwen_3_4b.safetensors (CLIP 文本编码器)
    - ae.safetensors (VAE 解码器)
    """</span>
    <span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> hf_hub_download

    hf_token = os.getenv(<span class="hljs-string">"HF_TOKEN"</span>)
    repo_id = <span class="hljs-string">"Comfy-Org/z_image_turbo"</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📦 从 <span class="hljs-subst">{repo_id}</span> 下载模型..."</span>)

    <span class="hljs-comment"># 模型配置列表 (文件路径包含 split_files/ 前缀)</span>
    models = [
        {
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"split_files/diffusion_models/z_image_turbo_bf16.safetensors"</span>,
            <span class="hljs-string">"target_dir"</span>: <span class="hljs-string">"/root/comfy/ComfyUI/models/diffusion_models"</span>,
            <span class="hljs-string">"target_name"</span>: <span class="hljs-string">"z_image_turbo_bf16.safetensors"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"主扩散模型"</span>
        },
        {
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"split_files/text_encoders/qwen_3_4b.safetensors"</span>,
            <span class="hljs-string">"target_dir"</span>: <span class="hljs-string">"/root/comfy/ComfyUI/models/clip"</span>,
            <span class="hljs-string">"target_name"</span>: <span class="hljs-string">"qwen_3_4b.safetensors"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"CLIP 文本编码器"</span>
        },
        {
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"split_files/vae/ae.safetensors"</span>,
            <span class="hljs-string">"target_dir"</span>: <span class="hljs-string">"/root/comfy/ComfyUI/models/vae"</span>,
            <span class="hljs-string">"target_name"</span>: <span class="hljs-string">"ae.safetensors"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"VAE 解码器"</span>
        }
    ]

    <span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> models:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📥 下载 <span class="hljs-subst">{model[<span class="hljs-string">'desc'</span>]}</span>: <span class="hljs-subst">{model[<span class="hljs-string">'target_name'</span>]}</span>..."</span>)
        
        cached_path = hf_hub_download(
            repo_id=repo_id,
            filename=model[<span class="hljs-string">"filename"</span>],
            cache_dir=<span class="hljs-string">"/cache"</span>,
            token=hf_token
        )
        
        Path(model[<span class="hljs-string">"target_dir"</span>]).mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
        target_path = <span class="hljs-string">f"<span class="hljs-subst">{model[<span class="hljs-string">'target_dir'</span>]}</span>/<span class="hljs-subst">{model[<span class="hljs-string">'target_name'</span>]}</span>"</span>
        subprocess.run(<span class="hljs-string">f"ln -sf <span class="hljs-subst">{cached_path}</span> <span class="hljs-subst">{target_path}</span>"</span>, shell=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ✅ <span class="hljs-subst">{model[<span class="hljs-string">'desc'</span>]}</span> 完成"</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🎉 所有模型下载完成!"</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_workflow_file</span>():
    <span class="hljs-string">"""创建工作流 JSON 文件"""</span>
    workflow = {
        <span class="hljs-string">"1"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"UNETLoader"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"unet_name"</span>: <span class="hljs-string">"z_image_turbo_bf16.safetensors"</span>,
                <span class="hljs-string">"weight_dtype"</span>: <span class="hljs-string">"default"</span>
            }
        },
        <span class="hljs-string">"2"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"DualCLIPLoader"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"clip_name1"</span>: <span class="hljs-string">"qwen_3_4b.safetensors"</span>,
                <span class="hljs-string">"clip_name2"</span>: <span class="hljs-string">"qwen_3_4b.safetensors"</span>,
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"z_image"</span>
            }
        },
        <span class="hljs-string">"3"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"VAELoader"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"vae_name"</span>: <span class="hljs-string">"ae.safetensors"</span>}
        },
        <span class="hljs-string">"4"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"CLIPTextEncode"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"一位美丽的亚洲女性，照片级真实，自然光线，高清细节"</span>,
                <span class="hljs-string">"clip"</span>: [<span class="hljs-string">"2"</span>, <span class="hljs-number">0</span>]
            }
        },
        <span class="hljs-string">"5"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"CLIPTextEncode"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"低质量，模糊，畸形，丑陋，文字，水印"</span>,
                <span class="hljs-string">"clip"</span>: [<span class="hljs-string">"2"</span>, <span class="hljs-number">0</span>]
            }
        },
        <span class="hljs-string">"6"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"EmptyLatentImage"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"width"</span>: <span class="hljs-number">1024</span>, <span class="hljs-string">"height"</span>: <span class="hljs-number">1024</span>, <span class="hljs-string">"batch_size"</span>: <span class="hljs-number">1</span>}
        },
        <span class="hljs-string">"7"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"KSampler"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"model"</span>: [<span class="hljs-string">"1"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"positive"</span>: [<span class="hljs-string">"4"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"negative"</span>: [<span class="hljs-string">"5"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"latent_image"</span>: [<span class="hljs-string">"6"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"seed"</span>: <span class="hljs-number">42</span>,
                <span class="hljs-string">"steps"</span>: <span class="hljs-number">4</span>,
                <span class="hljs-string">"cfg"</span>: <span class="hljs-number">1.0</span>,
                <span class="hljs-string">"sampler_name"</span>: <span class="hljs-string">"euler"</span>,
                <span class="hljs-string">"scheduler"</span>: <span class="hljs-string">"simple"</span>,
                <span class="hljs-string">"denoise"</span>: <span class="hljs-number">1.0</span>
            }
        },
        <span class="hljs-string">"8"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"VAEDecode"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"samples"</span>: [<span class="hljs-string">"7"</span>, <span class="hljs-number">0</span>], <span class="hljs-string">"vae"</span>: [<span class="hljs-string">"3"</span>, <span class="hljs-number">0</span>]}
        },
        <span class="hljs-string">"9"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"SaveImage"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"filename_prefix"</span>: <span class="hljs-string">"z_image_turbo"</span>, <span class="hljs-string">"images"</span>: [<span class="hljs-string">"8"</span>, <span class="hljs-number">0</span>]}
        }
    }
    
    Path(<span class="hljs-string">"/root/workflow_api.json"</span>).write_text(json.dumps(workflow, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 工作流文件已创建"</span>)


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S3: 服务配置</span>
<span class="hljs-comment"># =============================================================================</span>
vol = modal.Volume.from_name(<span class="hljs-string">"z-image-turbo-test-cache"</span>, create_if_missing=<span class="hljs-literal">True</span>)

image = (
    image.pip_install(<span class="hljs-string">"huggingface_hub[hf_transfer]==0.34.4"</span>)
    .env({<span class="hljs-string">"HF_HUB_ENABLE_HF_TRANSFER"</span>: <span class="hljs-string">"1"</span>})
    .run_function(
        hf_download,
        volumes={<span class="hljs-string">"/cache"</span>: vol},
        secrets=[hf_secret] <span class="hljs-keyword">if</span> hf_secret <span class="hljs-keyword">else</span> []
    )
    .run_function(create_workflow_file)
)

app = modal.App(name=<span class="hljs-string">"z-image-turbo-test"</span>, image=image)


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S4: UI 服务</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-meta">@app.function(<span class="hljs-params">
    max_containers=<span class="hljs-number">1</span>,
    gpu=<span class="hljs-string">"L40S"</span>,
    volumes={<span class="hljs-string">"/cache"</span>: vol},
    timeout=<span class="hljs-number">86400</span>
</span>)</span>
<span class="hljs-meta">@modal.concurrent(<span class="hljs-params">max_inputs=<span class="hljs-number">10</span></span>)</span>
<span class="hljs-meta">@modal.web_server(<span class="hljs-params"><span class="hljs-number">8000</span>, startup_timeout=<span class="hljs-number">60</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ui</span>():
    <span class="hljs-string">"""ComfyUI Web 界面"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🌐 启动 Z-Image-Turbo Web 界面..."</span>)
    subprocess.Popen(<span class="hljs-string">"comfy launch -- --listen 0.0.0.0 --port 8000"</span>, shell=<span class="hljs-literal">True</span>)


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S5: 本地入口点</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-meta">@app.local_entrypoint()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Z-Image-Turbo ComfyUI 一键部署"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n📦 模型来源: Comfy-Org/z_image_turbo"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n📋 已下载模型:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"   - z_image_turbo_bf16.safetensors (主扩散模型)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"   - qwen_3_4b.safetensors (CLIP 文本编码器)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"   - ae.safetensors (VAE 解码器)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n📌 部署命令: modal deploy z_image_turbo_deploy.py"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

</code></pre>
<blockquote>
<p>部署成功后 ：</p>
</blockquote>
<pre><code class="hljs language-python" lang="python">PS D:\code\Modal安装\modal-manager&gt; modal deploy z_image_turbo_deploy.py
Building image im-RuODNKSpmlSj8WWyALvgT8

=&gt; Step <span class="hljs-number">0</span>: running function <span class="hljs-string">'hf_download'</span>
📦 从 Comfy-Org/z_image_turbo 下载模型...
📥 下载 主扩散模型: z_image_turbo_bf16.safetensors...
   ✅ 主扩散模型 完成
📥 下载 CLIP 文本编码器: qwen_3_4b.safetensors...
   ✅ CLIP 文本编码器 完成
📥 下载 VAE 解码器: ae.safetensors...
   ✅ VAE 解码器 完成
🎉 所有模型下载完成!
Saving image...
Image saved, took <span class="hljs-number">1.50</span>s
Finished image build <span class="hljs-keyword">for</span> im-RuODNKSpmlSj8WWyALvgT8
Building image im-KblbHI0Rx9z0J54HpxvUH3

=&gt; Step <span class="hljs-number">0</span>: running function <span class="hljs-string">'create_workflow_file'</span>
📝 工作流文件已创建
Saving image...
Image saved, took <span class="hljs-number">1.21</span>s
Finished image build <span class="hljs-keyword">for</span> im-KblbHI0Rx9z111HpxvUH3
✓ Created objects.                                                                                                                        
├── 🔨 Created mount D:\code\学习资料\Modal安装\modal-manager\z_image_turbo_deploy.py                                                     
├── 🔨 Created function hf_download.                                                                                                      
├── 🔨 Created function create_workflow_file.                                                                                             
└── 🔨 Created web function ui =&gt; https://aubreyce5ju45p2le3t--z-image-turbo-test-ui.modal.run                                          
✓ App deployed <span class="hljs-keyword">in</span> <span class="hljs-number">106.760</span>s! 🎉

View Deployment: https://modal.com/apps/aubreyce5ju45p2le3t/main/deployed/z-image-turbo-test

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nano Banana Pro AI 图像生成模型与创意实践 | 2025 年第 48 周草梅周报]]></title>    <link>https://juejin.cn/post/7577713754564411444</link>    <guid>https://juejin.cn/post/7577713754564411444</guid>    <pubDate>2025-11-30T12:59:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577713754564411444" data-draft-id="7577683422879367202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nano Banana Pro AI 图像生成模型与创意实践 | 2025 年第 48 周草梅周报"/> <meta itemprop="keywords" content="AIGC,GitHub,开源"/> <meta itemprop="datePublished" content="2025-11-30T12:59:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草梅友仁"/> <meta itemprop="url" content="https://juejin.cn/user/3043088413495815"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nano Banana Pro AI 图像生成模型与创意实践 | 2025 年第 48 周草梅周报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3043088413495815/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草梅友仁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:59:42.000Z" title="Sun Nov 30 2025 12:59:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a> 发布和更新，并在多个平台同步发布。如有更新，以博客上的版本为准。您也可以通过文末的 <code>原文链接</code> 查看最新版本。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>欢迎来到草梅周报！这是一个由草梅友仁基于 AI 整理的周报，旨在为您提供最新的博客更新、GitHub 动态、个人动态和其他周刊文章推荐等内容。</p>
<hr/>
<p>上一期<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" ref="nofollow noopener noreferrer">《草梅周报》</a>中提了一下 AI 图像生成模型 Nano Banana Pro ，本周就继续来聊聊，以及这段时间的使用感受。</p>
<p>虽然 Nano Banana Pro 相较以往的 AI 模型，已经不用像当初 stable-diffusion 那样事无巨细的写图片的标签了，但也还是要一些提示词来描述具体要什么样的图片，只不过 AI 模型的理解能力已经大幅度上升了，图片生成的质量也越来越高了。</p>
<p>本周的新项目《<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYouMind-OpenLab%2Fawesome-nano-banana-pro-prompts%2Fblob%2Fmain%2FREADME_zh.md" target="_blank" title="https://github.com/YouMind-OpenLab/awesome-nano-banana-pro-prompts/blob/main/README_zh.md" ref="nofollow noopener noreferrer">Nano Banana Pro 提示词大全</a>》中就收集了 500 多个 Nano Banana Pro 模型的提示词，其中也有不少有意思的提示词。</p>
<blockquote>
<p>也可以从他们的官网访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyoumind.com%2Fnano-banana-pro-prompts" target="_blank" title="https://youmind.com/nano-banana-pro-prompts" ref="nofollow noopener noreferrer">youmind.com/nano-banana…</a></p>
<p>展示效果更好一些。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3c2ead2ca80496e8216f0f570ecd3f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=xJjyVh9N5QsIzs40Hi7BUQDdYxw%3D" alt="image-20251130200157501" loading="lazy"/></p>
<p>比如说：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cbaec7d028843de94a4eb07af40afa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=o040dAlozYaj11xKTY0ESIcQBgA%3D" alt="img" loading="lazy"/></p>
<blockquote>
<p>一张宽幅的名人金句卡，棕色背景，衬线体浅金色“{argument name="金句" default="保持饥饿，保持愚蠢"}”，小字“——{argument name="作者" default="Steve Jobs"}”，文字前面带一个大的淡淡的引号。人物头像在左边，文字在右边，文字占画面比例 2/3，人物占 1/3，人物有一点渐变过渡的感觉。</p>
</blockquote>
<p>当然，LSP 们可能更想看下生成的美少女，这里也放几个例子。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b304bd527d940eea94505bcb4d3af3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=QNvSX0bU0HwIAhs9NEfebdrFFLI%3D" alt="御宅族镜子自拍角人物特写" loading="lazy"/></p>
<blockquote>
<p>一位东亚女性在宅男风格电脑角里自拍</p>
<p>【由于原提示词太长，这里仅放出概要，请前往原项目搜索和查看】</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aa8e8a042f64b6c80bc364db51a9b8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=da8Ez5iqRAYKpez%2FIR%2BkBS7EbjE%3D" alt="照片上的可爱手写笔记" loading="lazy"/></p>
<blockquote>
<p>在照片上写下尽可能多的可爱手写笔记和高光！</p>
</blockquote>
<p>不过，要我说最好用的还得是用来做表情包，因为表情包对分辨率和内容没什么要求，能凑合着看就行，所以效果很好，配合自动切割图片软件会更好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f90144e490294ba9818049f728842669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=m4iD9zRI8ofWd9F%2FWqLINZUbsJg%3D" alt="可爱的长尾山雀 LINE 贴图集" loading="lazy"/></p>
<blockquote>
<p>设计 12 款以 Q 版可爱的银喉长尾山雀为主题的 LINE 贴图。贴图的姿势和文字排版应各不相同，以确保设计独特且多样化。对话内容为日语。背景为白色。贴图的目标用户是“女高中生”。</p>
</blockquote>
<p>比如说 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsplitimage.app%2Fzh-CN" target="_blank" title="https://splitimage.app/zh-CN" ref="nofollow noopener noreferrer">免费在线图片分割工具</a>，就能直接分割出 12 张表情包，效果非常不错。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce090d99c609406287008cab3561ac76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=YlTE2CYXdVRqbBKBkw9fvWxfXJQ%3D" alt="image-20251130200928875" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95b0281674194d999307017799dc4d02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=dnK7fkfHo%2B59lnWq4wlu4f148nU%3D" alt="image-20251130201009207" loading="lazy"/></p>
<blockquote>
<p>目前 Nano Banana Pro 可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Flmarena.ai%2F" target="_blank" title="https://lmarena.ai/" ref="nofollow noopener noreferrer">lmarena.ai/</a> 上免费试用，额度大约为每小时 5 张图片，超过了就无法继续生成。</p>
<p>如果要无限制使用，需要在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2F" target="_blank" title="https://gemini.google.com/" ref="nofollow noopener noreferrer">gemini.google.com/</a> 上开通 Pro 版本。</p>
</blockquote>
<p>随着越来越多的了解到当前 AI 模型进步，我也产生了一些思考。</p>
<p>在 AI 时代，人与人之间最大的差距就是想象力和创造力。</p>
<p>AI 大模型实际上加速了创意落地的速度，也拉大了人与人之间创造力的差距。</p>
<p>有创意的人会更快的实现他的想法，而没创意的人则是给他强大的 AI 也发挥不出什么。</p>
<p>像 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsuno.com" target="_blank" title="https://suno.com" ref="nofollow noopener noreferrer">Suno AI</a>（音乐生成 AI）已经出了很久了，但能想到把《赛尔号》和俄语结合的真没几个。</p>
<blockquote>
<p>出处：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1wjyuBzEnj" target="_blank" title="https://www.bilibili.com/video/BV1wjyuBzEnj" ref="nofollow noopener noreferrer">赛尔赛尔！用热血写下我们的骄傲。赛尔赛尔！小人物永不老！ 《这里是神奇的赛尔号》俄语版</a></p>
</blockquote>
<p>可见，脑洞在未来会越来越重要，人类能超越 AI 的地方就是永远有人能不按常理出牌。</p>
<blockquote>
<p>也许是因为永远有人脑回路清奇，AI 根本想不通。</p>
</blockquote>
<h2 data-id="heading-1">最新 GitHub 加星仓库</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYouMind-OpenLab%2Fawesome-nano-banana-pro-prompts" target="_blank" title="https://github.com/YouMind-OpenLab/awesome-nano-banana-pro-prompts" ref="nofollow noopener noreferrer">CaoMeiYouRen starred awesome-nano-banana-pro-prompts</a> - 2025-11-30 19:45:12
500 多个精选 Nano Banana Pro 提示词，支持多语言并附带图片预览，提供即时画廊浏览功能。该项目为开源提示词工程库，主要使用 TypeScript 开发，已在 GitHub 获得 1057 个星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffranklioxygen%2FMyTube" target="_blank" title="https://github.com/franklioxygen/MyTube" ref="nofollow noopener noreferrer">CaoMeiYouRen starred MyTube</a> - 2025-11-30 19:42:26
一款支持 YouTube/Bilibili/MissAV 等平台的视频下载与本地播放应用。用户可下载视频并在本地托管，将视频整理为收藏集便于访问管理。现已扩展支持 yt-dlp 平台，包括微博、小红书、X.com 等网站。主要开发语言为 TypeScript，项目获得 168 星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTongyi-MAI%2FZ-Image" target="_blank" title="https://github.com/Tongyi-MAI/Z-Image" ref="nofollow noopener noreferrer">CaoMeiYouRen starred Z-Image</a> - 2025-11-30 19:12:58
2608 stargazers</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjosdejong%2Fjsonrepair" target="_blank" title="https://github.com/josdejong/jsonrepair" ref="nofollow noopener noreferrer">CaoMeiYouRen starred jsonrepair</a> - 2025-11-28 11:14:45
修复无效 JSON 文档
主要语言：TypeScript
星标数：2029</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foceanbase%2Fseekdb" target="_blank" title="https://github.com/oceanbase/seekdb" ref="nofollow noopener noreferrer">CaoMeiYouRen starred seekdb</a> - 2025-11-28 01:42:00
AI 原生搜索数据库，统一向量、文本、结构化和半结构化数据于单一引擎，支持混合搜索和数据库内 AI 工作流。主要开发语言为 C++，GitHub 星标数 990。</li>
</ul>
<h2 data-id="heading-2">其他博客或周刊推荐</h2>
<h3 data-id="heading-3">阮一峰的网络日志</h3>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2025%2F11%2Fweekly-issue-375.html" target="_blank" title="http://www.ruanyifeng.com/blog/2025/11/weekly-issue-375.html" ref="nofollow noopener noreferrer">科技爱好者周刊（第 375 期）：一扇门的 Bug</a> - 2025-11-28 08:14:06</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2025%2F11%2Ftrae-solo.html" target="_blank" title="http://www.ruanyifeng.com/blog/2025/11/trae-solo.html" ref="nofollow noopener noreferrer">终于有人做了 Subagent，TRAE 国内版 SOLO 模式来了</a> - 2025-11-26 08:17:19</li>
</ul>
<h3 data-id="heading-4">HelloGitHub 月刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fvolume%2F116" target="_blank" title="https://hellogithub.com/periodical/volume/116" ref="nofollow noopener noreferrer">《HelloGitHub》第 116 期</a> - 2025-11-28 08:02:57</li>
</ul>
<h3 data-id="heading-5">阿猫的博客</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fameow.xyz%2Farchives%2Fweekly-086" target="_blank" title="https://ameow.xyz/archives/weekly-086" ref="nofollow noopener noreferrer">猫鱼周刊 vol. 086 走出迷茫</a> - 2025-11-30 18:35:47</li>
</ul>
<h3 data-id="heading-6">潮流周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F246%2F" target="_blank" title="https://weekly.tw93.fun/posts/246/" ref="nofollow noopener noreferrer">第 246 期 - 单向空间</a> - 2025-11-24 08:00:00</li>
</ul>
<h3 data-id="heading-7">二丫讲梵的学习周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.eryajf.net%2Fpages%2F7b0c3c%2F" target="_blank" title="https://wiki.eryajf.net/pages/7b0c3c/" ref="nofollow noopener noreferrer">学习周刊-总第 239 期-2025 年第 48 周</a> - 2025-11-27 22:58:21</li>
</ul>
<h2 data-id="heading-8">总结</h2>
<p>本周的更新和动态如上所示。感谢您的阅读！
您可以通过以下方式订阅草梅周报的更新：</p>
<ul>
<li><strong>博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a></li>
<li><strong>RSS</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Fweekly.xml" target="_blank" title="https://blog.cmyr.ltd/weekly.xml" ref="nofollow noopener noreferrer">草梅周报</a></li>
<li><strong>公众号</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Foss.cmyr.dev%2Fimages%2F20241025184516839-21n2ctv.png" target="_blank" title="https://oss.cmyr.dev/images/20241025184516839-21n2ctv.png" ref="nofollow noopener noreferrer">草梅友仁的后花园</a></li>
<li><strong>邮箱订阅</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flistmonk.cmyr.dev%2Fsubscription%2Fform" target="_blank" title="https://listmonk.cmyr.dev/subscription/form" ref="nofollow noopener noreferrer">草梅友仁的博客订阅</a></li>
</ul>
<h2 data-id="heading-9">往期回顾</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" ref="nofollow noopener noreferrer">Cloudflare 服务中断与 AI 图像生成模型 nano-banana-pro | 2025 年第 47 周草梅周报</a> - 2025-11-23 23:08:45</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-46-caomei-weekly-code-refactoring-test-coverage.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-46-caomei-weekly-code-refactoring-test-coverage.html" ref="nofollow noopener noreferrer">代码重构与测试覆盖率提升实践 | 2025 年第 46 周草梅周报</a> - 2025-11-16 20:18:53</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-45-caomei-weekly-caomei-auth-1-11-0-github-dependabot.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-45-caomei-weekly-caomei-auth-1-11-0-github-dependabot.html" ref="nofollow noopener noreferrer">草梅 Auth 1.11.0 发布与 GitHub 依赖安全更新 | 2025 年第 45 周草梅周报</a> - 2025-11-09 23:19:22</li>
</ul>
<p>本文作者：草梅友仁<br/>本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-48-caomei-weekly-nano-banana-pro-ai-image-generation.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-48-caomei-weekly-nano-banana-pro-ai-image-generation.html" ref="nofollow noopener noreferrer">blog.cmyr.ltd/archives/20…</a><br/>版权声明：本文采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-nc-sa%2F4.0%2Fdeed.zh-hans" target="_blank" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" ref="nofollow noopener noreferrer">CC BY-NC-SA 4.0 协议</a> 进行分发，转载请注明出处！<br/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每周AI论文速递（251124-251128）]]></title>    <link>https://juejin.cn/post/7577991167200542730</link>    <guid>https://juejin.cn/post/7577991167200542730</guid>    <pubDate>2025-11-30T11:06:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167200542730" data-draft-id="7577971299743252518" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每周AI论文速递（251124-251128）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-30T11:06:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每周AI论文速递（251124-251128）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:06:35.000Z" title="Sun Nov 30 2025 11:06:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ROOT: Robust Orthogonalized Optimizer for Neural Network Training</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.20626" target="_blank" title="https://arxiv.org/abs/2511.20626" ref="nofollow noopener noreferrer">ROOT：神经网络训练的鲁棒正交化优化器</a></p>
<p>大语言模型 (LLM) 的优化仍面临关键挑战，尤其随着模型规模扩大，其对算法不精确性与训练不稳定性的敏感度日益加剧。近期优化器研究通过动量正交化提升了收敛效率，但存在两大鲁棒性缺陷：正交化精度的维度敏感性及对异常值引发噪声的易损性。为解决这些问题，我们提出ROOT (Robust Orthogonalized Optimizer)，该优化器通过双重鲁棒机制增强训练稳定性。首先，我们设计了一种维度鲁棒的正交化方案，采用自适应牛顿迭代及针对特定矩阵尺寸定制的细粒度系数，确保在不同架构配置下均能保持精度一致性。其次，我们引入基于近端优化的鲁棒框架，在有效抑制异常值噪声的同时保留关键梯度方向。大量实验证明，ROOT 在鲁棒性方面显著提升，相比 Muon 和 Adam 类优化器，收敛速度更快且最终性能更优，尤其在噪声环境和非凸场景中表现突出。本研究确立了一种新范式，可用于开发鲁棒且精确的优化器，以应对现代大规模模型训练的复杂性。代码将发布于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuawei-noah%2Fnoah-research%2Ftree%2Fmaster%2FROOT%25E3%2580%2582" target="_blank" title="https://github.com/huawei-noah/noah-research/tree/master/ROOT%E3%80%82" ref="nofollow noopener noreferrer">github.com/huawei-noah…</a></p>
<h2 data-id="heading-1">General Agentic Memory Via Deep Research</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.18423" target="_blank" title="https://arxiv.org/abs/2511.18423" ref="nofollow noopener noreferrer">基于深度研究的通用智能体记忆</a></p>
<p>记忆对于 AI 智能体至关重要，但广泛采用的静态记忆系统旨在预先构建随时可用的记忆，这不可避免地会导致严重的信息损失。为解决这一局限，我们提出了一种名为 <strong>通用智能体记忆 (GAM)</strong> 的新框架。GAM 遵循 "<strong>即时编译 (JIT)</strong>" 原则，专注于在运行时为其服务对象生成优化上下文，同时在离线阶段仅保留简洁而实用的记忆。为此，GAM 采用双重设计，包含以下组件：1) <strong>记忆器 (Memorizer)</strong>，利用轻量级记忆提取关键历史信息，同时在通用页面存储中维护完整历史记录；2) <strong>研究者 (Researcher)</strong>，基于预构建的记忆，从页面存储中检索并集成有用信息以响应在线请求。这种设计使 GAM 能够有效利用前沿大语言模型 (LLMs) 的智能体能力和推理时扩展性，同时通过强化学习实现端到端性能优化。在实验研究中，我们证明 GAM 在各种记忆驱动型任务完成场景中，相比现有记忆系统，取得了显著提升。</p>
<h2 data-id="heading-2">GigaEvo: An Open Source Optimization Framework Powered By LLMs And Evolution Algorithms</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.17592" target="_blank" title="https://arxiv.org/abs/2511.17592" ref="nofollow noopener noreferrer">GigaEvo：一个由大语言模型和进化算法驱动的开源优化框架</a></p>
<p>大语言模型引导的进化计算领域近期取得重要进展，特别是 AlphaEvolve (Novikov 等人, 2025; Georgiev 等人, 2025) 在发现新颖数学构造和解决复杂优化问题方面展现出卓越成效。然而，现有公开文献中的高层描述未明确说明具体实现细节，这阻碍了研究的可复现性与深入探索。本报告提出 GigaEvo——一个可扩展的开源框架，支持研究人员对受 AlphaEvolve 启发的混合大语言模型-进化方法进行系统研究与实践。该框架采用模块化设计，核心组件包括：MAP-Elites 质量-多样性算法、基于异步有向无环图的评估流水线、支持洞见生成与双向谱系追踪的大语言模型驱动变异算子，以及灵活的多岛进化策略。为验证实现的可复现性，我们使用 AlphaEvolve 论文中的三类典型难题对 GigaEvo 进行评估：Heilbronn 三角形布局、正方形内圆填充问题和高维接吻数问题。本框架强调模块化架构、并行计算与实验便捷性，通过声明式配置支持快速原型开发。我们详细阐述了系统架构设计、关键技术决策与实验方法，旨在推动大语言模型驱动进化算法的持续研究。GigaEvo 框架及完整实验代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAIRI-Institute%2Fgigaevo-core%25E3%2580%2582" target="_blank" title="https://github.com/AIRI-Institute/gigaevo-core%E3%80%82" ref="nofollow noopener noreferrer">github.com/AIRI-Instit…</a></p>
<h2 data-id="heading-3">SAM 3: Segment Anything with Concepts</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16719" target="_blank" title="https://arxiv.org/abs/2511.16719" ref="nofollow noopener noreferrer">SAM 3：基于概念的分割万物模型</a></p>
<p>我们提出分割万物模型 (SAM) 3，这是一个统一模型，能够根据概念提示检测、分割并跟踪图像和视频中的对象。概念提示定义为短名词短语（如“黄色校车”）、图像示例或两者组合。可提示概念分割 (PCS) 接收这些提示，并输出所有匹配对象实例的分割掩码和唯一标识。为推进 PCS 研究，我们构建了可扩展数据引擎，生成包含 400 万独特概念标签的高质量数据集，涵盖图像和视频中的难负样本。该模型由共享单一骨干网络的图像级检测器和基于记忆的视频跟踪器组成，通过存在头解耦识别与定位模块，显著提升检测精度。SAM 3 在图像与视频 PCS 任务中实现精度翻倍，并优化了先前 SAM 模型在视觉分割任务中的性能。我们开源了 SAM 3 模型及新构建的基于概念的分割万物 (SA-Co) 基准，用于可提示概念分割研究。</p>
<h2 data-id="heading-4">Latent Collaboration in Multi-Agent Systems</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.20639" target="_blank" title="https://arxiv.org/abs/2511.20639" ref="nofollow noopener noreferrer">多智能体系统中的潜在协作</a></p>
<p>多智能体系统 (MAS) 将大语言模型 (LLMs) 从独立的单模型推理扩展至协同的系统级智能。现有 LLM 智能体通常依赖基于文本的中介进行推理与通信，而本研究进一步实现了模型在连续潜在空间中的直接协作。我们提出 LatentMAS，一种端到端的无需训练框架，支持 LLM 智能体间的纯潜在协作。在 LatentMAS 中，各智能体首先通过最后一层隐藏嵌入执行自回归潜在思维生成；随后，一个共享潜在工作记忆负责保存并传递各智能体的内部表示，确保信息无损交换。理论分析表明，相较于基础的基于文本 MAS，LatentMAS 以显著更低的复杂度实现了更强的表达能力与无损信息保留。此外，在数学科学推理、常识理解和代码生成等 9 个综合基准测试中，实证评估显示 LatentMAS 持续优于强单模型及基于文本的 MAS 基线，准确率最高提升 14.6%，输出 Token 用量减少 70.8%-83.7%，端到端推理速度加快 4-4.3 倍。这些结果证明，本潜在协作框架在无需额外训练的前提下，不仅提升了系统级推理质量，还带来了显著的效率增益。代码与数据已完全开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGen-Verse%2FLatentMAS%25E3%2580%2582" target="_blank" title="https://github.com/Gen-Verse/LatentMAS%E3%80%82" ref="nofollow noopener noreferrer">github.com/Gen-Verse/L…</a></p>
<h2 data-id="heading-5">GeoVista: Web-Augmented Agentic Visual Reasoning for Geolocalization</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15705" target="_blank" title="https://arxiv.org/abs/2511.15705" ref="nofollow noopener noreferrer">GeoVista: 面向地理定位的网络增强智能体视觉推理</a></p>
<p>当前智能体视觉推理的研究虽能实现深度多模态理解，但主要聚焦于图像处理工具，导致在构建更通用智能体模型方面存在不足。本文重新探讨地理定位任务，该任务不仅需要精细的视觉基础能力，还需在推理过程中借助网络搜索来验证或优化假设。鉴于现有地理定位基准无法满足高分辨率图像需求及深度智能体推理的定位挑战，我们构建了GeoBench基准，其中包含全球各地的照片、全景图以及不同城市的卫星图像子集，以严格评估智能体的地理定位能力。同时，我们提出GeoVista模型，它能将工具调用无缝整合到推理回路中，包括用于放大感兴趣区域的图像缩放工具和用于检索相关网络信息的搜索工具。我们为其开发了完整训练流程：首先通过冷启动监督微调 (SFT) 阶段学习推理模式与工具使用先验，再通过强化学习 (RL) 阶段进一步提升推理能力。通过采用分层奖励机制有效利用多级地理信息，显著提升了整体定位性能。实验结果表明，GeoVista在地理定位任务上显著优于其他开源智能体模型，且在多数指标上达到与闭源模型（如Gemini-2.5-flash和GPT-5）相当的水平。</p>
<h2 data-id="heading-6">AutoEnv: Automated Environments for Measuring Cross-Environment Agent Learning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19304" target="_blank" title="https://arxiv.org/abs/2511.19304" ref="nofollow noopener noreferrer">AutoEnv：用于测量跨环境智能体学习的自动化环境</a></p>
<p>人类通过在不同动态、观察和奖励结构的世界中学习底层规则，自然地适应多样化环境。相比之下，现有智能体通常通过在单一领域内自我演化来展示改进，隐式地假设了固定的环境分布。跨环境学习在很大程度上仍未得到充分评估：既缺乏可控、异构环境的标准集合，也没有统一的方法来表征智能体如何学习。我们通过两个步骤来解决这些不足。首先，我们提出AutoEnv，一个自动化框架，将环境视为可因子化的转移、观察和奖励分布，实现低成本（平均4.12美元）生成异构世界。利用AutoEnv，我们构建了AutoEnv-36数据集，包含36个环境和358个已验证关卡，在该数据集上，七个语言模型实现了12-49%的归一化奖励，证明了AutoEnv-36的高挑战难度。其次，我们将智能体学习形式化描述为一个以组件为中心的过程，该过程由选择、优化和评估三个阶段驱动，并应用于可改进的智能体组件。基于此形式化，我们设计了八种学习方法，并在AutoEnv-36上对其进行了评估。实证结果表明，任何单一学习方法的性能增益随环境数量增加而迅速下降，揭示出固定学习方法无法在异构环境中扩展。学习方法的自适应环境选择能显著提升性能，但随着方法空间的扩大，表现出收益递减效应。这些结果凸显了智能体学习对于可扩展跨环境泛化的必要性及其当前局限，并将AutoEnv和AutoEnv-36作为研究跨环境智能体学习的测试平台。代码可在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFoundationAgents%2FAutoEnv%25E8%258E%25B7%25E5%258F%2596%25E3%2580%2582" target="_blank" title="https://github.com/FoundationAgents/AutoEnv%E8%8E%B7%E5%8F%96%E3%80%82" ref="nofollow noopener noreferrer">github.com/FoundationA…</a></p>
<h2 data-id="heading-7">OpenMMReasoner: Pushing the Frontiers for Multimodal Reasoning with an Open and General Recipe</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16334" target="_blank" title="https://arxiv.org/abs/2511.16334" ref="nofollow noopener noreferrer">OpenMMReasoner：基于开放通用方案推动多模态推理前沿发展</a></p>
<p>大语言推理模型的最新进展，引发了将其能力扩展至多模态领域的广泛关注。然而，尽管视觉推理已取得显著突破，但缺乏透明且可复现的数据构建与训练策略，仍是制约规模化研究的主要障碍。本研究提出OpenMMReasoner——一个完全透明的两阶段多模态推理方案，涵盖监督微调（SFT）和强化学习（RL）两个阶段。在SFT阶段，我们构建了包含87.4万样本的冷启动数据集，并通过严格的分步验证为推理能力奠定坚实基础。后续RL阶段利用跨多个领域的7.4万样本数据集，进一步强化并稳定模型能力，从而实现更鲁棒高效的学习过程。大量实验表明，本训练方案不仅显著超越强基线模型，更揭示了数据质量与训练设计对多模态推理性能的决定性作用。值得注意的是，在九大多模态推理基准测试中，本方法相较Qwen2.5-VL-7B-Instruct基线实现了11.6%的性能提升，为未来大规模多模态推理研究提供了坚实实证基础。我们已在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FEvolvingLMMs-Lab%2FOpenMMReasoner%25E5%25BC%2580%25E6%25BA%2590%25E5%2585%25A8%25E9%2583%25A8%25E4%25BB%25A3%25E7%25A0%2581%25E3%2580%2581%25E8%25AE%25AD%25E7%25BB%2583%25E6%25B5%2581%25E6%25B0%25B4%25E7%25BA%25BF%25E5%258F%258A%25E6%2595%25B0%25E6%258D%25AE%25E3%2580%2582" target="_blank" title="https://github.com/EvolvingLMMs-Lab/OpenMMReasoner%E5%BC%80%E6%BA%90%E5%85%A8%E9%83%A8%E4%BB%A3%E7%A0%81%E3%80%81%E8%AE%AD%E7%BB%83%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8F%8A%E6%95%B0%E6%8D%AE%E3%80%82" ref="nofollow noopener noreferrer">github.com/EvolvingLMM…</a></p>
<h2 data-id="heading-8">Unveiling Intrinsic Dimension of Texts: from Academic Abstract to Creative Story</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15210" target="_blank" title="https://arxiv.org/abs/2511.15210" ref="nofollow noopener noreferrer">揭示文本的内在维度：从学术摘要到创意故事</a></p>
<p>内在维度 (ID) 是现代大语言模型分析中的重要工具，可用于研究训练动态、缩放规律和数据集结构，但其文本层面的决定因素尚待深入探索。我们通过交叉编码器分析、语言特征和稀疏自编码器 (SAEs) ，首次开展了基于可解释文本属性的 ID 系统性研究。本研究确立了三个关键发现：第一，ID 与基于熵的指标具有互补性——在控制文本长度后，两者无相关性，ID 捕获的是独立于预测质量的几何复杂度；第二，ID 呈现稳定的体裁分层现象——在所有测试模型中，科学文本显示低 ID 值 (~8) ，百科全书类内容为中等 ID 值 (~9) ，而创意写作与观点类文本则呈现高 ID 值 (~10.5) ，这表明当代大语言模型将科学文本视为“表征简单”的类别，而小说类文本需要更多表征自由度；第三，通过 SAEs 我们识别出因果特征：科学信号（正式语气、报告模板、统计数据）会降低 ID ，而人性化信号（个性化表达、情感元素、叙事结构）则会提升 ID 。定向控制实验证实了这些影响的因果性。因此，对当代模型而言，科学写作相对“易于处理”，而小说、观点性文本及情感内容则增加了表征复杂度。我们的多维度分析为 ID 的合理应用及基于 ID 结论的可靠解读提供了实践指导。</p>
<h2 data-id="heading-9">Multimodal Evaluation of Russian-language Architectures</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15552" target="_blank" title="https://arxiv.org/abs/2511.15552" ref="nofollow noopener noreferrer">俄语模型的多模态评估</a></p>
<p>多模态大语言模型 (MLLMs) 是当前研究关注的焦点，在规模和能力方面均展现出快速进步，然而其智能水平、局限性及潜在风险尚未得到充分理解。为了解决这些问题，尤其是在俄语语境下，鉴于目前尚无多模态基准，我们引入了 Mera Multi——一个面向俄语模型的开放多模态评估框架。该基准采用指令驱动设计，涵盖默认的文本、图像、音频和视频模态，包含 18 个全新构建的评估任务，面向通用模型及模态特定架构（如图像到文本、视频到文本和音频到文本）。我们的贡献包括：(i) 一套通用多模态能力分类体系；(ii) 18 个从零开始构建的数据集，注重俄语文化及语言特性，并配有统一提示词和评估指标；(iii) 闭源与开源模型的基线性能结果；(iv) 一套防止基准泄漏的防护方法，包括水印技术和私有数据集的许可协议。尽管当前研究聚焦于俄语，但所提出的基准为在类型学多样的语言（特别是斯拉夫语族）中构建多模态评估体系提供了可复现的方法论。</p>
<h2 data-id="heading-10">DeCo: Frequency-Decoupled Pixel Diffusion for End-to-End Image Generation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19365" target="_blank" title="https://arxiv.org/abs/2511.19365" ref="nofollow noopener noreferrer">DeCo: 面向端到端图像生成的频率解耦像素扩散方法</a></p>
<p>像素扩散的目标是以端到端方式直接在像素空间生成图像。该方法规避了 VAE 在二阶段潜在扩散中的局限性，从而具备更高的模型容量。现有像素扩散模型因通常在单一扩散 Transformer (DiT) 中同时建模高频信号与低频语义，导致训练和推理速度缓慢。为构建更高效的像素扩散范式，我们提出频率解耦像素扩散框架。基于解耦高频与低频分量生成的思路，我们采用轻量级像素解码器，在 DiT 语义引导下生成高频细节。这使得 DiT 能够专注于低频语义建模。此外，我们引入频率感知流匹配损失，在强化视觉显著频率分量的同时抑制非显著分量。大量实验证明，DeCo 在像素扩散模型中取得最优性能，在 ImageNet 数据集上获得 1.62 (256×256) 和 2.22 (512×512) 的 FID 指标，显著缩小了与潜在扩散方法的性能差距。我们的预训练文生图模型在 GenEval 基准测试的系统级比较中，更以 0.86 的综合得分保持领先。代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZehong-Ma%2FDeCo%25E3%2580%2582" target="_blank" title="https://github.com/Zehong-Ma/DeCo%E3%80%82" ref="nofollow noopener noreferrer">github.com/Zehong-Ma/D…</a></p>
<h2 data-id="heading-11">Computer-Use Agents as Judges for Generative User Interface</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15567" target="_blank" title="https://arxiv.org/abs/2511.15567" ref="nofollow noopener noreferrer">计算机智能体作为生成式用户界面的评判者</a></p>
<p>计算机智能体 (CUA) 正日益擅长通过图形用户界面 (GUI) 自主操作数字环境。然而，当前大多数 GUI 仍主要面向人类设计（优先考虑美观性和可用性），迫使智能体采用许多对高效任务执行非必要的人类化操作模式。与此同时，编码语言模型 (Coder) 的快速发展正在革新自动 GUI 设计范式。这引出一个核心问题：能否以 CUA 作为评判者，辅助 Coder 实现自动 GUI 设计？为探究此问题，我们推出 AUI-Gym 基准测试集，涵盖 52 个跨领域应用的自动 GUI 开发任务。基于语言模型，我们合成了 1560 个模拟真实场景的任务。为确保任务可靠性，我们还开发了验证模块，通过编程验证每个任务在对应环境中的可执行性。在此基础上，我们提出 Coder-CUA 协同框架：Coder 担任设计者角色，负责生成和迭代优化网站界面；CUA 则作为评判者，评估功能实现质量并指导设计改进。评估标准不依赖视觉表现，而是基于任务可解决性与 CUA 导航成功率。为将 CUA 反馈转化为有效指导，我们设计了 CUA 仪表板，将多步导航轨迹凝练为直观的视觉摘要，为迭代设计提供可解释的优化指引。通过让智能体同时承担设计者与评判者角色，本框架将界面设计推向更符合智能体原生特性的高效可靠范式。本研究推动智能体从被动使用向数字环境主动参与迈出关键一步。代码与数据集详见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshowlab%2FAUI%25E3%2580%2582" target="_blank" title="https://github.com/showlab/AUI%E3%80%82" ref="nofollow noopener noreferrer">github.com/showlab/AUI…</a></p>
<h2 data-id="heading-12">DR Tulu: Reinforcement Learning with Evolving Rubrics for Deep Research</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19399" target="_blank" title="https://arxiv.org/abs/2511.19399" ref="nofollow noopener noreferrer">DR Tulu：基于演化评分标准的强化学习在深度研究中的应用</a></p>
<p>深度研究模型通过多步研究过程生成长篇且引用充分的答案。然而，现有大多数开放深度研究模型采用可验证奖励强化学习 (RLVR) 在易于验证的短篇问答任务上进行训练，这种方法无法扩展到实际的长篇研究任务。为此，我们提出了基于演化评分标准的强化学习 (RLER) 方法，通过构建与策略模型在训练过程中协同演化的评分标准，使评分体系能够整合模型新探索的信息，并提供具有区分度的同策略反馈。基于RLER方法，我们开发了深度研究Tulu模型 (DR Tulu-8B)，这是首个专门针对开放式长篇深度研究任务训练的开放模型。在科学、医疗保健及通用领域的四个长篇深度研究基准测试中，DR Tulu模型显著优于现有开放深度研究模型，其性能达到甚至超越了专有深度研究系统，同时具有更小的模型尺寸和更低的单次查询成本。为促进后续研究，我们完整公开了所有数据、模型和代码，包括新开发的基于MCP的深度研究系统智能体基础设施。</p>
<h2 data-id="heading-13">MedSAM3: Delving into Segment Anything with Medical Concepts</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19046" target="_blank" title="https://arxiv.org/abs/2511.19046" ref="nofollow noopener noreferrer">MedSAM3：融合医学概念的分割万物模型深入解析</a></p>
<p>医学图像分割是生物医学发现的基础技术。现有方法普遍存在泛化能力不足的问题，且针对新临床应用需进行大量耗时的人工标注。本文提出MedSAM-3模型——一种支持文本提示的医学图像与视频分割模型。通过对Segment Anything Model (SAM) 3架构在医学图像及对应语义概念标签上进行微调，MedSAM-3实现了医学可提示概念分割 (PCS) 功能，能够基于开放词汇文本描述精确定位解剖结构，而不仅依赖几何提示信息。我们还开发了MedSAM-3智能体 (Agent) 框架，通过集成多模态大语言模型 (MLLMs) ，在智能体参与循环的工作流程中实现复杂推理与迭代优化。涵盖X射线、磁共振成像 (MRI) 、超声、计算机断层扫描 (CT) 及视频等多种医学成像模态的综合实验表明，本方法性能显著优于现有专业模型与基础模型。相关代码与模型将在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoey-S-Liu%2FMedSAM3%25E5%258F%2591%25E5%25B8%2583%25E3%2580%2582" target="_blank" title="https://github.com/Joey-S-Liu/MedSAM3%E5%8F%91%E5%B8%83%E3%80%82" ref="nofollow noopener noreferrer">github.com/Joey-S-Liu/…</a></p>
<h2 data-id="heading-14">Agent0-VL: Exploring Self-Evolving Agent for Tool-Integrated Vision-Language Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19900" target="_blank" title="https://arxiv.org/abs/2511.19900" ref="nofollow noopener noreferrer">Agent0-VL: 探索用于工具集成视觉语言推理的自进化智能体</a></p>
<p>视觉语言智能体在各种多模态推理任务中取得了显著进展，但其学习过程仍受限于人类标注监督的约束。近期出现的自奖励方法尝试通过让模型充当自身评判者或奖励提供者来突破这一限制。然而，纯文本形式的自我评估难以有效验证复杂的视觉推理步骤，且常出现评估幻觉问题。为解决这些挑战，受工具集成推理领域最新进展的启发，我们提出Agent0-VL——一种通过工具集成推理实现持续自我提升的自进化视觉语言智能体。Agent0-VL不仅将工具运用融入推理过程，还将其扩展至自我评估与自我修复环节，使模型能够通过证据驱动的分析实现推理过程的内省、验证与优化。该架构在单一的大视觉语言模型 (LVLM) 中整合了两个协同工作的角色：执行多轮工具集成推理的求解器 (Solver)，以及通过工具化批判生成结构化反馈与细粒度自奖励的验证器 (Verifier)。这些角色通过自进化推理循环 (Self-Evolving Reasoning Cycle) 相互协作，其中基于工具的验证机制与强化学习共同对齐推理与评估的分布，确保稳定的自我改进。通过这种零外部奖励的进化机制，Agent0-VL在无需任何人工标注或外部奖励模型的情况下，实现了推理行为与验证行为的自对齐，达成持续自我优化。在几何问题求解和视觉科学分析领域的实验表明，Agent0-VL相较基础模型实现了12.5%的性能提升。代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faiming-lab%2FAgent0%25E3%2580%2582" target="_blank" title="https://github.com/aiming-lab/Agent0%E3%80%82" ref="nofollow noopener noreferrer">github.com/aiming-lab/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[安康记1.1.x版本发布]]></title>    <link>https://juejin.cn/post/7577971299743301670</link>    <guid>https://juejin.cn/post/7577971299743301670</guid>    <pubDate>2025-11-30T11:27:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743301670" data-draft-id="7577737385955295242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="安康记1.1.x版本发布"/> <meta itemprop="keywords" content="iOS,APP"/> <meta itemprop="datePublished" content="2025-11-30T11:27:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            安康记1.1.x版本发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:27:45.000Z" title="Sun Nov 30 2025 11:27:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>安康记新版本已经上线App Store。目前已经更新了独立用药功能，方便一些简单的小毛病可能会自己用药，可以跳过就诊直接进行记录。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f8043dd94e47f3ac230749b4de5c9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25a2Q55qE5oqA5pyv56KO56KO5b-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765106865&amp;x-signature=kXauweiqFlsfIfm9%2BWwKEQAvL6k%3D" alt="图片" loading="lazy"/></p>
<p>原本这个功能已经上线了有几天了，但因为一直测试发现有一些新的问题，这两周也提交了多次修复版本，目前算是相对稳定了，希望各位能更新体验♪(･ω･)ﾉ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[探秘 Hugging Face：何为 Hugging Face 及其核心组件全览]]></title>    <link>https://juejin.cn/post/7577991167200673802</link>    <guid>https://juejin.cn/post/7577991167200673802</guid>    <pubDate>2025-11-30T11:52:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167200673802" data-draft-id="7577914902430990382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="探秘 Hugging Face：何为 Hugging Face 及其核心组件全览"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-30T11:52:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            探秘 Hugging Face：何为 Hugging Face 及其核心组件全览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:52:22.000Z" title="Sun Nov 30 2025 11:52:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaffe3ada90e4b3290992d72accea62c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=fEtJmuGPU5rRA0Q58eqzSgG4sfE%3D" alt="image.png" loading="lazy"/>
Hugging Face 是一个提供先进自然语言处理（ NLP ）工具的平台，支持 Transformer 模型的开发和应用。它拥有庞大的模型库和社区资源，能够满足从研究到工业应用的各种需求。</p>
<h2 data-id="heading-0">一、注册</h2>
<p>官方网址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2F" target="_blank" title="https://huggingface.co/" ref="nofollow noopener noreferrer">huggingface.co/</a></p>
<p>注册好后，点击头像Access Token,创建token 。</p>
<h2 data-id="heading-1">二、功能介绍</h2>
<p>hugging face的核心组件 主要是 Transformers 和Datasets 。</p>
<p><strong>1、Transformers</strong></p>
<p>也就是 Models大模型，平台上有世界上最全的大模型。中国的魔塔社区与此类似，不过没有它全。 我们自己也可以上传大模型到hugging face平台。</p>
<p><strong>2、Datasets</strong></p>
<p>就是数据集，大模型训练用的数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f321e197e394efea7f89df065881ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=Vv5fCrxMO6eW8HBZbtckDJs9FIc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>3、大模型分类</strong></p>
<p>点击“Models”，左侧有分类。主导航有根据“任务Tasks”，“库Libraries”,"数据集DataSets","语言Languages","开源协议Licenses"等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5921b09a3f0e4a958fcf6eb0e019a56d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=wP4raxlWgELmnY%2B%2BweOyl%2FSLYyE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>4、大模型文件</strong></p>
<p>打开千问最新版本 Qwen/QwQ-32B，在"Files and Versions"模型文件页面下，可以看到很多类似”model-00001-of-00014.safetensors“ ，后缀 safetensors就是模型文件的名称。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e4439ec4b9a49849df23b7b774c1337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=HxBrKXMBRsNEN3XeSS77lKoa%2Fek%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5f671797fcb41b9b7abae97b0c63654~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=2T7a95089lls%2F4XH%2FJR%2BxjRzUxc%3D" alt="" loading="lazy"/></p>
<p><strong>5、Inference Providers</strong></p>
<p>hugging face平台上有很多大模型提供接口试用，列表有黄色闪电标记，详情的右侧有Inference Providers。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1174da38a9941f4a376a42202a567d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=lhTxOSiKBuEFLUIUcZcazZ23uMw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1a16e2c68a5494faac8c4a0c1fc43fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=27Ir2xtg8udeaMTGXHR1Eea0rzI%3D" alt="" loading="lazy"/></p>
<p>不过接口调用不是很稳定，时长不通。</p>
<p><strong>6、下载大模型文件</strong></p>
<p>下载大模型文件到本地，官方提供了多种方式。</p>
<p>（1）git clone方式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0fb375ec4c04d4b88aa55998ebd8c18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=6EsBj5EvGobXMyZmjXJc6Sl21cQ%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://huggingface.co/Qwen/QwQ-32B
</code></pre>
<p>（2）使用hugging face提供的transformers库下载</p>
<p>     下一节重点讲解。 </p>
<h2 data-id="heading-2">三、使用 Transformers 库</h2>
<p>Hugging Face 提供了 transformers 库，用于加载和使用模型 。你可以使用以下命令来安装它：（电 脑须安装基础环境：Anaconda,CUDA,cuDNN,pytorch ）</p>
<pre><code class="hljs">pip install transformers
</code></pre>
<p>如果你还需要安装其他依赖库，如 datasets 和 tokenizers ，可以使用以下命令：</p>
<pre><code class="hljs">pip install transformers datasets tokenizers
</code></pre>
<p>1、下载模型</p>
<p>使用代码下载模型到本地，代码演示使用depeek-r1-1.5b,小一点。等待大概几分钟就下载完成了，主要看网速。</p>
<pre><code class="hljs language-ini" lang="ini">from  transformers import AutoTokenizer,AutoModelForCausalLM
<span class="hljs-attr">model_name</span>=<span class="hljs-string">"deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"</span>
<span class="hljs-attr">cache_dir</span>=<span class="hljs-string">"model3/deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"</span>
<span class="hljs-comment">#下载模型</span>
AutoModelForCausalLM.from_pretrained(model_name,<span class="hljs-attr">cache_dir</span>=cache_dir)
<span class="hljs-comment">#下载分词工具</span>
AutoTokenizer.from_pretrained(model_name,<span class="hljs-attr">cache_dir</span>=cache_dir)
print(f"模型和分词器已下载到：{cache_dir}")
</code></pre>
<p>AutoModelForCausalLM 是 Hugging Face 的 Transformers 库中的一个类，主要用于处理因果语言模型（Causal Language Model）任务。大部分的text-generation类型的大模型都可以使用这个类。</p>
<p>模型和分词器一般都是成对下载。</p>
<p>代码中model_name的名称一定要是 hugging face上模型的完整名称。cache_dir是本地文件目录，可以使用绝对路径，pycharm开发时，可使用相对路径。</p>
<p>2、模型文件介绍</p>
<p>下载好后的目录如下 </p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72f21579b7dd4101822a5075af6f8f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=vUpLxgeeoXD29kYp97bsl9gScFI%3D" alt="" loading="lazy"/></p>
<p>模型的核心内容主要是看 snapshots-config.json所在的目录，也是模型的默认目录地址。model.safetensors就是模型的源文件，</p>
<p>（1）config.json文件</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
<span class="hljs-attr">"architectures"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
<span class="hljs-string">"Qwen2ForCausalLM"</span>
<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"attention_dropout"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"bos_token_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151643</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"eos_token_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151643</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"hidden_act"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"silu"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"hidden_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1536</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"initializer_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"intermediate_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8960</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"max_position_embeddings"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">131072</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"max_window_layers"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"model_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen2"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"num_attention_heads"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"num_hidden_layers"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"num_key_value_heads"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"rms_norm_eps"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1e-06</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"rope_theta"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"sliding_window"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4096</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"tie_word_embeddings"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"torch_dtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bfloat16"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"transformers_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.44.0"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"use_cache"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"use_mrope"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"use_sliding_window"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"vocab_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151936</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>vocab_size是模型可以识别的字符个数。有些模型文件vocab.txt文件，就是可以识别字符列表。若输入的字符不在这个范围内，分词器会根据配置的special_tokens里的值来赋值。比如下面的：</p>
<pre><code class="hljs language-ini" lang="ini">BertTokenizer(<span class="hljs-attr">name_or_path</span>=<span class="hljs-string">'D:\Test\LLMTrain\day02\model\bert-base-chinese\models--bert-base-chinese\snapshots\c30a6ed22ab4564dc1e3b2ecbf6e766b0611a33f'</span>, vocab_size=<span class="hljs-number">21128</span>, model_max_length=<span class="hljs-number">512</span>, is_fast=<span class="hljs-literal">False</span>, padding_side=<span class="hljs-string">'right'</span>, truncation_side=<span class="hljs-string">'right'</span>, special_tokens={<span class="hljs-string">'unk_token'</span>: <span class="hljs-string">'[UNK]'</span>, <span class="hljs-string">'sep_token'</span>: <span class="hljs-string">'[SEP]'</span>, <span class="hljs-string">'pad_token'</span>: <span class="hljs-string">'[PAD]'</span>, <span class="hljs-string">'cls_token'</span>: <span class="hljs-string">'[CLS]'</span>, <span class="hljs-string">'mask_token'</span>: <span class="hljs-string">'[MASK]'</span>}, clean_up_tokenization_spaces=<span class="hljs-literal">True</span>, added_tokens_decoder={
</code></pre>
<p>3、Pipelines运行本地模型</p>
<p>大模型下载到本地，就可以使用了，transformers库中的pipelines是一个非常实用的高级工具，它为自然语言处理（NLP）任务提供了一种简单、便捷且统一的接口，使得用户无需深入了解模型的具体细节就能轻松完成各种常见的 NLP 任务。pipelines的主要特点如下：</p>
<p>（1） 简化模型使用流程</p>
<p>在传统的使用方式中，若要使用一个预训练模型完成特定任务，需要手动完成加载模型、分词、编码、推理、解码等一系列复杂的步骤。而pipelines将这些步骤进行了封装，用户只需提供任务类型和必要的输入，就能直接得到任务的处理结果。</p>
<p>例如，使用pipelines进行文本分类： </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BertTokenizer,BertForSequenceClassification,pipeline
<span class="hljs-comment">#设置具体包含config.json的目录，只支持绝对路径</span>
model_dir = <span class="hljs-string">r"model\bert-base-chinese"</span>
<span class="hljs-comment">#加载模型和分词器</span>
model = BertForSequenceClassification.from_pretrained(<span class="hljs-string">"bert-base-chinese"</span>,cache_dir=model_dir)
tokenizer = BertTokenizer.from_pretrained(<span class="hljs-string">"bert-base-chinese"</span>,cache_dir=model_dir)
<span class="hljs-comment">#创建分类pipleine</span>
classifier = pipeline(<span class="hljs-string">"text-classification"</span>,model=model,tokenizer=tokenizer,device=<span class="hljs-string">"cpu"</span>)
<span class="hljs-comment">#进行文本分类</span>
result = classifier(<span class="hljs-string">"你好，我是一款语言模型"</span>)
<span class="hljs-built_in">print</span>(result)
<span class="hljs-built_in">print</span>(model)
</code></pre>
<p>上述代码中，用户只需创建一个text - classification类型的管道，然后传入文本，就能直接得到文本的分类结果，无需关心模型加载、分词等底层操作。</p>
<p>（2）支持多种常见 NLP 任务</p>
<p>pipelines支持多种常见的自然语言处理任务，以下是一些常见任务及其示例：</p>
<p>文本分类：判断文本所属的类别，如情感分析（积极、消极）、主题分类等。 </p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">classifier</span> = pipeline(<span class="hljs-string">'text-classification'</span>)
<span class="hljs-attr">result</span> = classifier(<span class="hljs-string">"This is a great product!"</span>)
</code></pre>
<p><strong>问答系统：根据给定的上下文和问题，找出问题的答案。</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">qa</span> = pipeline(<span class="hljs-string">'question-answering'</span>)
<span class="hljs-attr">context</span> = <span class="hljs-string">"Albert Einstein was a German-born theoretical physicist. He developed the theory of relativity."</span>
<span class="hljs-attr">question</span> = <span class="hljs-string">"Who developed the theory of relativity?"</span>
<span class="hljs-attr">result</span> = qa(question=question, context=context)
</code></pre>
<p>文本生成：根据输入的文本生成相关的文本内容，如故事续写、摘要生成等。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">generator</span> = pipeline(<span class="hljs-string">'text-generation'</span>)
<span class="hljs-attr">input_text</span> = <span class="hljs-string">"Once upon a time"</span>
<span class="hljs-attr">result</span> = generator(input_text, max_length=<span class="hljs-number">100</span>)
</code></pre>
<p>命名实体识别（NER）：识别文本中的命名实体，如人名、地名、组织机构名等。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ner</span> = pipeline(<span class="hljs-string">'ner'</span>)
<span class="hljs-attr">text</span> = <span class="hljs-string">"Apple is looking at buying U.K. startup for $1 billion"</span>
<span class="hljs-attr">result</span> = ner(text)
</code></pre>
<p>（3）自动选择合适的模型</p>
<p>pipelines会根据指定的任务类型自动选择合适的预训练模型。例如，当你创建一个text - classification管道时，它会默认选择一个在文本分类任务上表现良好的预训练模型。当然，你也可以手动指定使用的模型，只需在创建管道时传入model参数即可。 </p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用指定的模型创建文本分类管道</span>
<span class="hljs-attr">classifier</span> = pipeline(<span class="hljs-string">'text-classification'</span>, model=<span class="hljs-string">'distilbert-base-uncased-finetuned-sst-2-english'</span>)
</code></pre>
<p>注意，这里需要能联网，并且能科学上网。可以使用本地的大模型调用。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#本地离线调用deepseek-r1</span>
from transformers import AutoModelForCausalLM,AutoTokenizer,pipeline
<span class="hljs-comment">#设置具体包含config.json的目录，只支持绝对路径</span>
<span class="hljs-attr">model_dir</span> = r<span class="hljs-string">"D:\trsanformers_test\model3\deepseek-ai\DeepSeek-R1-Distill-Qwen-1.5B\models--deepseek-ai--DeepSeek-R1-Distill-Qwen-1.5B\snapshots\ad9f0ae0864d7fbcd1cd905e3c6c5b069cc8b562"</span>
<span class="hljs-comment">#加载模型和分词器</span>
<span class="hljs-attr">model</span> = AutoModelForCausalLM.from_pretrained(model_dir)
<span class="hljs-attr">tokenizer</span> = AutoTokenizer.from_pretrained(model_dir)
<span class="hljs-comment"># 模拟多轮对话，设置角色信息</span>
<span class="hljs-attr">messages</span> = [
{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"请使用java写一个冒泡排序。"</span>}
]
<span class="hljs-comment"># 构建输入文本，按照 DeepSeek - R1 的格式</span>
<span class="hljs-attr">input_text</span> = <span class="hljs-string">""</span>
for message in messages:
if message<span class="hljs-section">["role"]</span> == "user":
input_text += f"&lt;|UserBegin|&gt;{message<span class="hljs-section">['content']</span>}&lt;|UserEnd|&gt;"
elif message<span class="hljs-section">["role"]</span> == "assistant":
input_text += f"{message<span class="hljs-section">['content']</span>}"
<span class="hljs-comment">#使用加载的模型和分词器创建生成文本的pipeline</span>
<span class="hljs-attr">generator</span> = pipeline(<span class="hljs-string">"text-generation"</span>,model=model,tokenizer=tokenizer,device=<span class="hljs-string">"cpu"</span>)
<span class="hljs-comment">#生成文本</span>
<span class="hljs-comment"># output = generator("你好，我是一款语言模型，",max_length=50,num_return_sequences=1)</span>
<span class="hljs-attr">output</span> = generator(
input_text,<span class="hljs-comment">#生成文本的输入种子文本（prompt）。模型会根据这个初始文本，生成后续的文本</span>
<span class="hljs-attr">max_length</span>=<span class="hljs-number">1500</span>,<span class="hljs-comment">#指定生成文本的最大长度。这里的 50 表示生成的文本最多包含 50 个标记（tokens）</span>
<span class="hljs-attr">num_return_sequences</span>=<span class="hljs-number">1</span>,<span class="hljs-comment">#参数指定返回多少个独立生成的文本序列。值为 1 表示只生成并返回一段文本。</span>
<span class="hljs-attr">truncation</span>=<span class="hljs-literal">True</span>,<span class="hljs-comment">#该参数决定是否截断输入文本以适应模型的最大输入长度。如果 True，超出模型最大输入长度的部分将被截断；如果 False，模型可能无法处理过长的输入，可能会报错。</span>
<span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>,<span class="hljs-comment">#该参数控制生成文本的随机性。值越低，生成的文本越保守（倾向于选择概率较高的词）；值越高，生成的文本越多样（倾向于选择更多不同的词）。0.7 是一个较为常见的设置，既保留了部分随机性，又不至于太混乱。</span>
<span class="hljs-attr">top_k</span>=<span class="hljs-number">50</span>,<span class="hljs-comment">#该参数限制模型在每一步生成时仅从概率最高的 k 个词中选择下一个词。这里 top_k=50 表示模型在生成每个词时只考虑概率最高的前 50 个候选词，从而减少生成不太可能的词的概率。</span>
<span class="hljs-attr">top_p</span>=<span class="hljs-number">0.9</span>,<span class="hljs-comment">#该参数（又称为核采样）进一步限制模型生成时的词汇选择范围。它会选择一组累积概率达到 p 的词汇，模型只会从这个概率集合中采样。top_p=0.9 意味着模型会在可能性最强的 90% 的词中选择下一个词，进一步增加生成的质量。</span>
<span class="hljs-attr">clean_up_tokenization_spaces</span>=<span class="hljs-literal">True</span><span class="hljs-comment">#该参数控制生成的文本中是否清理分词时引入的空格。如果设置为 True，生成的文本会清除多余的空格；如果为 False，则保留原样。默认值即将改变为 False，因为它能更好地保留原始文本的格式。</span>
)
print(output)
</code></pre>
<h3 data-id="heading-3">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大宗供应链企业舆情指标系统设计（一）舆情指标设计]]></title>    <link>https://juejin.cn/post/7577958825342320659</link>    <guid>https://juejin.cn/post/7577958825342320659</guid>    <pubDate>2025-11-30T10:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342320659" data-draft-id="7577905525997764649" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大宗供应链企业舆情指标系统设计（一）舆情指标设计"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2025-11-30T10:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="语落心生"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大宗供应链企业舆情指标系统设计（一）舆情指标设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    语落心生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:03:34.000Z" title="Sun Nov 30 2025 10:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近自己个人业务有个客户一个大宗供应量销量预测与智能预测的需求。但是大宗供应链的场景，多半就是跟地缘政治因素强关联的，调研几个月，记录一下自己的思考</p>
<hr/>
<h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0" title="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">项目概述</a></li>
<li><a href="#%E8%88%86%E6%83%85%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB" title="#%E8%88%86%E6%83%85%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB">舆情指标体系</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84" title="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84">技术架构</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B" title="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B">数据模型</a></li>
<li><a href="#%E5%AE%9E%E6%97%B6%E7%AE%A1%E9%81%93" title="#%E5%AE%9E%E6%97%B6%E7%AE%A1%E9%81%93">实时管道</a></li>
<li><a href="#%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97" title="#%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97">指标计算</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">项目概述</h2>
<h3 data-id="heading-2">1.1 大宗商品企业的舆情风险</h3>
<p>大宗商品供应链企业（钢铁、石油、粮食、矿产）面临四类核心风险：</p>



































<table><thead><tr><th>风险维度</th><th>具体表现</th><th>影响度量</th><th>舆情指标</th></tr></thead><tbody><tr><td><strong>A.物理物流中断</strong></td><td>港口罢工、海峡阻塞、基础设施损坏</td><td>延迟天数</td><td>物流延迟指数(LDI)</td></tr><tr><td><strong>B.监管贸易限制</strong></td><td>出口禁令、制裁、关税变化</td><td>合规成本</td><td>合规风险指数(CRI)</td></tr><tr><td><strong>C.政治安全不稳定</strong></td><td>内战冲突、恐怖活动、政权更迭</td><td>保险费上升</td><td>地缘政治指数(GRI)</td></tr><tr><td><strong>D.经济金融冲击</strong></td><td>货币崩溃、主权违约、支付中断</td><td>交易对手风险</td><td>金融风险指数(FRI)</td></tr></tbody></table>
<p><strong>舆情指标系统的核心价值</strong>：</p>
<ul>
<li>非结构化新闻→定量决策指标 (&lt;5分钟延迟)</li>
<li>按地理位置+商品种类的采购商特定风险评估</li>
<li>交易、物流、金融对冲的量化决策支持</li>
</ul>
<h3 data-id="heading-3">1.2 系统设计目标</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">实时性: 事件→摄取→NLP→指标 &lt;5分钟</span>
<span class="hljs-section">准确性: NLP分类&gt;95%, 指标相关性&gt;0.8</span>
<span class="hljs-section">覆盖: 150+采购商, 200+新闻源, 4类商品</span>
<span class="hljs-section">可操作: 直接输入贸易/物流/金融系统</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">舆情指标体系</h2>
<h3 data-id="heading-5">2.1 四层舆情指标框架</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">第1层: 基础采样指标</span>
├─ 事件频率 (events/day)
├─ 新闻热度 (7day_volume)
├─ 网络舆论倾向 (sentiment)
└─ NLP置信度 (confidence)

<span class="hljs-section">第2层: 维度风险指标 (A/B/C/D四维)</span>
├─ LDI: 物流延迟风险 (0-10)
├─ CRI: 合规监管风险 (0-10)
├─ GRI: 地缘政治风险 (0-10)
└─ FRI: 金融支付风险 (0-10)

<span class="hljs-section">第3层: 综合舆情指标</span>
├─ 综合风险指数 (0-100)
├─ 采购商特定风险 (考虑货运量+商品敏感性)
└─ 舆情vs实际风险相关度 (-1~1)

<span class="hljs-section">第4层: 战略决策支持</span>
├─ 预警等级 (Green/Yellow/Orange/Red)
├─ 建议应急措施
├─ 对冲对象
└─ 物流替代方案评分
</code></pre>
<h3 data-id="heading-6">2.2 维度指标具体定义</h3>
<h4 data-id="heading-7">LDI: 物流延迟风险指数</h4>
<pre><code class="hljs language-erlang" lang="erlang">公式: LDI = Σ(severity × location_proximity × commodity_multiplier)

<span class="hljs-function"><span class="hljs-title">severity_score</span> <span class="hljs-params">(港口罢工:<span class="hljs-number">6</span>-<span class="hljs-number">8</span>, 海峡阻塞:<span class="hljs-number">8</span>-<span class="hljs-number">9</span>, 铁路破坏:<span class="hljs-number">4</span>-<span class="hljs-number">6</span>, 空域关闭:<span class="hljs-number">3</span>-<span class="hljs-number">5</span>)</span>
<span class="hljs-title">location_proximity</span> <span class="hljs-params">(距离衰减: &lt;<span class="hljs-number">500</span>km→<span class="hljs-number">1.0</span>, <span class="hljs-number">500</span>-<span class="hljs-number">2000</span>km→<span class="hljs-number">0.8</span>, &gt;<span class="hljs-number">5000</span>km→<span class="hljs-number">0.2</span>)</span>
<span class="hljs-title">commodity_multiplier</span> <span class="hljs-params">(易腐农产品:<span class="hljs-number">1.5</span>, 冷链:<span class="hljs-number">2.0</span>, 金属矿产:<span class="hljs-number">0.5</span>)</span>

示例: 上海采购商采购大豆, 巴拿马运河关闭
  LDI = <span class="hljs-params">(<span class="hljs-number">8</span>严重度 × <span class="hljs-number">0.8</span>距离系数 × <span class="hljs-number">1.5</span>易腐性)</span> = 9.6/10 <span class="hljs-params">(红色告警)</span>
</span></code></pre>
<h4 data-id="heading-8">CRI: 合规监管风险指数</h4>
<pre><code class="hljs language-ini" lang="ini">公式: <span class="hljs-attr">CRI</span> = Σ(impact_severity × enforcement_probability × exposure_ratio)

impact_severity (新增制裁:9-10, 出口禁令:7-8, 关税&gt;15%:5-6, 关税5-15%:2-3)
enforcement_probability (立即:1.0, 30天:0.8, 90天:0.5, 讨论:0.2)
exposure_ratio (该地区采购额 / 总采购额)

示例: 俄罗斯铁矿石禁令, 采购商A占15%
  CRI增量 = 8 × 0.8 × <span class="hljs-attr">0.15</span> = <span class="hljs-number">0.96</span>分
</code></pre>
<h4 data-id="heading-9">GRI: 地缘政治风险指数</h4>
<pre><code class="hljs language-erlang" lang="erlang">公式: GRI = (severity × conflict_intensity × duration_decay) / redundancy × 操作乘数

<span class="hljs-function"><span class="hljs-title">event_severity</span> <span class="hljs-params">(全面战争:<span class="hljs-number">9</span>-<span class="hljs-number">10</span>, 区域冲突:<span class="hljs-number">7</span>-<span class="hljs-number">8</span>, 大规模抗议:<span class="hljs-number">5</span>-<span class="hljs-number">6</span>)</span>
<span class="hljs-title">conflict_intensity</span> <span class="hljs-params">(ACLED数据: 死亡人数/事件频率)</span>
<span class="hljs-title">duration_decay</span> <span class="hljs-params">(刚发生:<span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>-<span class="hljs-number">7</span>天:<span class="hljs-number">0.9</span>, <span class="hljs-number">1</span>-<span class="hljs-number">4</span>周:<span class="hljs-number">0.7</span>, <span class="hljs-number">1</span>-<span class="hljs-number">3</span>月:<span class="hljs-number">0.5</span>, &gt;<span class="hljs-number">3</span>月:<span class="hljs-number">0.3</span>)</span>
<span class="hljs-title">infrastructure_redundancy</span> <span class="hljs-params">(无替代:<span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>条:<span class="hljs-number">0.7</span>, <span class="hljs-number">2</span>+条:<span class="hljs-number">0.4</span>)</span>
操作乘数 <span class="hljs-params">(劳动力撤出:<span class="hljs-number">1.5</span>, 保险费上升:<span class="hljs-number">1.3</span>, 工人安全:<span class="hljs-number">1.2</span>)</span>
</span></code></pre>
<h4 data-id="heading-10">FRI: 金融支付风险指数</h4>
<pre><code class="hljs language-ini" lang="ini">公式: <span class="hljs-attr">FRI</span> = Σ(financial_severity × counterparty_exposure × forward_duration)

financial_severity (SWIFT除名:9-10, 主权违约:8-9, 货币贬值&gt;30%:7-8)
counterparty_exposure (该国交易额占比)
forward_duration (待结算&lt;7天:1.0, 预期交易7-30天:0.8, 期货30-90天:0.6)

示例: 阿根廷比索危机, 采购商敞口12%, 待结算30天
  FRI增量 = 8 × 0.12 × <span class="hljs-attr">0.8</span> = <span class="hljs-number">0.77</span>分
</code></pre>
<h3 data-id="heading-11">2.3 综合舆情指标</h3>
<pre><code class="hljs language-ini" lang="ini">综合风险指数 (CRI_Composite):
  = 40% × (LDI + CRI)/2 + 60% × (GRI + FRI)/<span class="hljs-attr">2</span>
  = 40% × 物流合规风险 + 60% × 地缘金融风险
  范围: 0-100

采购商特定风险 (Buyer_Specific):
  = 综合风险指数 × 货运量权重 × 商品敏感性乘数
  
  商品敏感性:
  ├─ 农产品(谷物): 1.5 (高敏感)
  ├─ 石油: 1.3 (中高敏感)
  ├─ 金属矿产: 0.7 (低敏感)
  └─ 煤炭: 0.9 (中敏感)

预警等级:
  Green (0-25):   无实质风险, 常规监测
  Yellow (25-50): 中等风险, 激活预案
  Orange (50-75): 高风险, 立即采取措施
  Red (75-100):   极危状态, 启动危机管理
</code></pre>
<hr/>
<h2 data-id="heading-12">技术架构</h2>
<h3 data-id="heading-13">3.1 整体数据流</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">多源数据</span> <span class="hljs-string">→</span> <span class="hljs-string">Kafka</span> <span class="hljs-string">→</span> <span class="hljs-string">Flink</span> <span class="hljs-string">ETL</span> <span class="hljs-string">→</span> <span class="hljs-string">Paimon</span> <span class="hljs-string">(湖)</span> <span class="hljs-string">→</span> <span class="hljs-string">Doris</span> <span class="hljs-string">(分析)</span> <span class="hljs-string">→</span> <span class="hljs-string">应用</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">新闻源</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">地缘政治数据</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">制裁名单</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">商品期货</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">港口状态</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">金融数据</span>

<span class="hljs-string">关键特点:</span>
<span class="hljs-string">├─</span> <span class="hljs-attr">Paimon:</span> <span class="hljs-string">原始数据+标准化数据存储,</span> <span class="hljs-string">支持版本控制、时间旅行</span>
<span class="hljs-string">├─</span> <span class="hljs-attr">Doris:</span> <span class="hljs-string">实时OLAP分析,</span> <span class="hljs-string">秒级查询,</span> <span class="hljs-string">支持高并发</span>
<span class="hljs-string">└─</span> <span class="hljs-attr">Flink:</span> <span class="hljs-string">实时流处理,</span> <span class="hljs-string">NLP分类,</span> <span class="hljs-string">指标计算</span>
</code></pre>
<h3 data-id="heading-14">3.2 为何选择Paimon</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 湖表一体:
   ├─ 原始数据保留在数据湖 (HDFS/S3)
   ├─ 实时指标在表结构中维护
   └─ 降低数据重复存储成本

<span class="hljs-bullet">2.</span> 时间旅行与版本控制:
   ├─ 查询历史快照 ("昨天下午2点的指标?")
   ├─ 完整审计日志 (舆情变化追溯)
   └─ 风险回溯分析不可或缺

<span class="hljs-bullet">3.</span> 高效增量更新:
   ├─ Flink直接流式写入
   ├─ Merge操作 (重复事件去重)
   └─ 避免全量重新计算

<span class="hljs-bullet">4.</span> ACID事务:
   ├─ 舆情指标一致性保证
   ├─ 多维度并发更新无脏数据
   └─ 金融级别的准确性要求

Paimon表设计:
├─ mgir<span class="hljs-emphasis">_events_</span>raw: 原始事件 (90天保留)
├─ mgir<span class="hljs-emphasis">_events_</span>standardized: NLP后标准化事件
└─ mgir<span class="hljs-emphasis">_dimension_</span>scores: 维度指标增量表
</code></pre>
<h3 data-id="heading-15">3.3 为何选择Doris</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 实时分析性能:
   ├─ 向量化执行+Pipeline模型
   ├─ 查询P95 &lt;1秒 (百亿行数据)
   ├─ 支持1000+并发查询
   └─ BI仪表板实时刷新

<span class="hljs-bullet">2.</span> 多维聚合能力:
   ├─ Rollup和物化视图预计算
   ├─ 按(采购商, 商品, 小时)粒度聚合
   ├─ BI直接读取预聚合结果
   └─ 特别适合舆情指标多维钻取

<span class="hljs-bullet">3.</span> 数据新鲜度:
   ├─ Paimon数据实时导入 (5分钟)
   ├─ 准实时分析能力
   └─ 舆情指标时效性保证

<span class="hljs-bullet">4.</span> 低成本存储:
   ├─ 列式压缩率高 (8-10倍)
   ├─ 相比关系数据库成本 1/10
   └─ 承载2年+历史数据

Doris表设计:
├─ mgir<span class="hljs-emphasis">_indices_</span>fact: 实时指标事实表
├─ mgir<span class="hljs-emphasis">_indices_</span>hourly<span class="hljs-emphasis">_agg: 小时聚合表 (Rollup)
├─ buyer_</span>dimension: 采购商维度表
└─ commodity<span class="hljs-emphasis">_dimension: 商品维度表
</span></code></pre>
<hr/>
<h2 data-id="heading-16">数据模型</h2>
<h3 data-id="heading-17">4.1 Paimon原始事件表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mgir_events_raw_paimon</span>
<span class="hljs-comment">-- 存储所有摄取的原始新闻/事件 (未处理)</span>
<span class="hljs-comment">-- 分片: (risk_date, buyer_geo_key) hash</span>
<span class="hljs-comment">-- TTL: 90天 (用于模型再训练)</span>

字段:
├─ event_id (UUID, PK)
├─ ingest_timestamp (<span class="hljs-type">TIMESTAMP</span>)
├─ risk_date (<span class="hljs-type">DATE</span>)
├─ source_type (STRING: news<span class="hljs-operator">/</span>api<span class="hljs-operator">/</span>...)
├─ source_name (STRING)
├─ source_url (STRING)
├─ raw_text (TEXT)
├─ <span class="hljs-keyword">language</span> (STRING)
├─ detected_geo_keys (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRING<span class="hljs-operator">&gt;</span>)
├─ keywords (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRING<span class="hljs-operator">&gt;</span>)
├─ nlp_processing_flag (<span class="hljs-type">BOOLEAN</span>)
├─ processing_version (<span class="hljs-type">INT</span>)
└─ confidence_raw (<span class="hljs-type">FLOAT</span>)

特性:
├─ 版本控制: 支持时间旅行查询
├─ ACID: 数据一致性保证
└─ 保留期: <span class="hljs-number">90</span>天
</code></pre>
<h3 data-id="heading-18">4.2 Paimon标准化事件表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mgir_events_standardized_paimon</span>
<span class="hljs-comment">-- 存储NLP处理后的标准化事件</span>
<span class="hljs-comment">-- 支持Merge操作 (去重)</span>

关键字段:
├─ event_id (UUID, PK)
├─ raw_event_id (UUID)
├─ risk_date (<span class="hljs-type">DATE</span>)
├─ delivery_impact_dim (ENUM: A<span class="hljs-operator">/</span>B<span class="hljs-operator">/</span>C<span class="hljs-operator">/</span>D)
├─ severity_subcategory (STRING)
├─ impact_severity_score (<span class="hljs-type">FLOAT</span>: <span class="hljs-number">0</span><span class="hljs-number">-10</span>)
├─ sentiment_score_nlp (<span class="hljs-type">FLOAT</span>: <span class="hljs-number">-1</span><span class="hljs-operator">~</span><span class="hljs-number">1</span>)
├─ confidence_score_nlp (<span class="hljs-type">FLOAT</span>: <span class="hljs-number">0</span><span class="hljs-number">-1</span>)
├─ primary_buyer_geo_key (STRING)
├─ affected_buyer_geo_keys (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRING<span class="hljs-operator">&gt;</span>)
├─ commodity_type (STRING)
├─ geographic_locations (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRUCT<span class="hljs-operator">&gt;</span>)
│  ├─ location_name, latitude, longitude
│  ├─ gis_type, relevance_score
├─ extracted_entities (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRUCT<span class="hljs-operator">&gt;</span>)
│  ├─ entity_name, entity_type, confidence
├─ nlp_model_version (STRING)
├─ processing_timestamp (<span class="hljs-type">TIMESTAMP</span>)
└─ update_version (<span class="hljs-type">INT</span>)

特性:
├─ 去重: <span class="hljs-keyword">Merge</span>按event_id, 保留最新版本
├─ ACID事务: 保证一致性
└─ 主键约束: event_id
</code></pre>
<h3 data-id="heading-19">4.3 Doris实时指标事实表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mgir_indices_fact_doris</span>
<span class="hljs-comment">-- 存储计算后的实时舆情指标</span>
<span class="hljs-comment">-- 分区: risk_date | Bucket: 32 (按buyer_geo_key hash)</span>

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> mgir_indices_fact_doris (
  event_id UUID <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  ingest_timestamp DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  risk_date <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  buyer_geo_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  commodity_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  delivery_impact_dim <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),
  impact_severity_score <span class="hljs-type">FLOAT</span>,
  sentiment_score_nlp <span class="hljs-type">FLOAT</span>,
  confidence_score_nlp <span class="hljs-type">FLOAT</span>,
  ldi_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 物流延迟指标</span>
  cri_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 合规风险指标</span>
  gri_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 地缘政治指标</span>
  fri_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 金融风险指标</span>
  composite_risk_index <span class="hljs-type">FLOAT</span>,       <span class="hljs-comment">-- 综合风险 (0-100)</span>
  buyer_specific_risk_score <span class="hljs-type">FLOAT</span>,  <span class="hljs-comment">-- 采购商特定风险</span>
  sentiment_vs_risk_corr <span class="hljs-type">FLOAT</span>,     <span class="hljs-comment">-- 舆情vs风险相关度</span>
  risk_alert_level <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),     <span class="hljs-comment">-- Green/Yellow/Orange/Red</span>
  source_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),
  location_latitude <span class="hljs-keyword">DOUBLE</span>,
  location_longitude <span class="hljs-keyword">DOUBLE</span>,
  location_distance_to_buyer <span class="hljs-type">FLOAT</span>,
  forecast_impact_duration <span class="hljs-type">INT</span>
)
ENGINE <span class="hljs-operator">=</span> OLAP
DUPLICATE KEY (event_id)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (risk_date) ()
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(buyer_geo_key) BUCKETS <span class="hljs-number">32</span>
PROPERTIES ("replication_num" <span class="hljs-operator">=</span> "3");

索引:
├─ <span class="hljs-keyword">PRIMARY</span> KEY: event_id
├─ INDEX: (buyer_geo_key, risk_date)
├─ INDEX: (composite_risk_index)
└─ BLOOM <span class="hljs-keyword">FILTER</span>: (buyer_geo_key, commodity_type)
</code></pre>
<h3 data-id="heading-20">4.4 Doris维度表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- buyer_dimension_doris (采购商维度)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> buyer_dimension_doris (
  buyer_geo_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
  buyer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),
  country_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),
  region_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  latitude <span class="hljs-keyword">DOUBLE</span>,
  longitude <span class="hljs-keyword">DOUBLE</span>,
  annual_volume_usd <span class="hljs-type">BIGINT</span>,
  main_commodities <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),
  supply_chain_complexity <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  alternative_suppliers_cnt <span class="hljs-type">INT</span>,
  risk_appetite <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  contact_email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
  risk_manager_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
  last_updated DATETIME
)
ENGINE <span class="hljs-operator">=</span> OLAP
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(buyer_geo_key);

<span class="hljs-comment">-- commodity_dimension_doris (商品维度)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> commodity_dimension_doris (
  commodity_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
  commodity_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),
  commodity_category <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  perishability_multiplier <span class="hljs-type">FLOAT</span>,    <span class="hljs-comment">-- 0.5-2.0</span>
  storage_cost_per_day_usd <span class="hljs-type">FLOAT</span>,
  typical_transport_duration <span class="hljs-type">INT</span>,
  price_volatility_yearly <span class="hljs-type">FLOAT</span>,
  ldi_base_weight <span class="hljs-type">FLOAT</span>,
  cri_base_weight <span class="hljs-type">FLOAT</span>,
  gri_base_weight <span class="hljs-type">FLOAT</span>,
  fri_base_weight <span class="hljs-type">FLOAT</span>,
  last_updated DATETIME
)
ENGINE <span class="hljs-operator">=</span> OLAP
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(commodity_code);
</code></pre>
<hr/>
<h2 data-id="heading-21">实时管道</h2>
<h3 data-id="heading-22">5.1 数据源摄取</h3>
<pre><code class="hljs language-markdown" lang="markdown">数据源分类:

<span class="hljs-bullet">1.</span> 新闻与舆情源 (文本)
   ├─ 路透社、彭博社、CNBC、WSJ
   ├─ 区域主流新闻网站
   ├─ Twitter/X舆论情感
   └─ 频率: 实时/5分钟

<span class="hljs-bullet">2.</span> 地缘政治数据 (结构化)
   ├─ ACLED (冲突事件)
   ├─ ICG (危机分析报告)
   ├─ 官方声明 (国务院/外交部)
   └─ 频率: 每天/每周

<span class="hljs-bullet">3.</span> 制裁与监管 (结构化)
   ├─ OFAC制裁名单 (美国财政部)
   ├─ EU制裁名单 (欧盟理事会)
   ├─ 进出口禁令
   └─ 频率: 实时/每天更新

<span class="hljs-bullet">4.</span> 商品市场 (高频结构化)
   ├─ CME期货、LME金属、现货价格
   ├─ 交易所API
   └─ 频率: 秒级更新

<span class="hljs-bullet">5.</span> 港口与物流 (实时)
   ├─ 港口状态、船舶AIS、海峡通过
   └─ 频率: 实时/10分钟

<span class="hljs-bullet">6.</span> 金融与汇率 (高频)
   ├─ 外汇、国债收益率、CDS价差
   └─ 频率: 秒-分钟级

Kafka主题设计:
├─ raw<span class="hljs-emphasis">_news_</span>events: 原始新闻 (32分区, 7天保留)
├─ geopolitical<span class="hljs-emphasis">_conflict_</span>events: 冲突数据 (8分区, 30天)
├─ sanctions<span class="hljs-emphasis">_and_</span>regulations: 制裁更新 (4分区, 90天)
├─ commodity<span class="hljs-emphasis">_prices_</span>stream: 商品价格 (16分区, 3天)
├─ port<span class="hljs-emphasis">_logistics_</span>status: 港口状态 (8分区, 7天)
└─ financial<span class="hljs-emphasis">_indicators: 金融指标 (16分区, 1天)
</span></code></pre>
<h3 data-id="heading-23">5.2 Flink流处理任务</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Flink任务拓扑:</span>

<span class="hljs-attr">Source:</span> <span class="hljs-string">Kafka</span> <span class="hljs-number">6</span><span class="hljs-string">个Topic消费</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">数据清洗与标准化</span>]
  <span class="hljs-string">├─</span> <span class="hljs-string">格式转换</span> <span class="hljs-string">(JSON/XML</span> <span class="hljs-string">→</span> <span class="hljs-string">Struct)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">去重</span> <span class="hljs-string">(按source_url或content</span> <span class="hljs-string">hash)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">时间同步</span> <span class="hljs-string">(UTC时区)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">质量检查</span> <span class="hljs-string">(null处理)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">异常值处理</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">NLP处理</span>] <span class="hljs-string">(Stateless)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">语言检测与翻译</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">命名实体识别</span> <span class="hljs-string">(NER)</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">├─</span> <span class="hljs-string">地点识别</span> <span class="hljs-string">(港口、国家、海峡)</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">├─</span> <span class="hljs-string">采购商识别</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">└─</span> <span class="hljs-string">商品识别</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">事件分类</span> <span class="hljs-string">(A/B/C/D四维)</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">└─</span> <span class="hljs-string">微调BERT/RoBERTa模型</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">情感分析</span> <span class="hljs-string">(sentiment_score)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">严重度评分</span> <span class="hljs-string">(impact_severity)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">置信度评估</span> <span class="hljs-string">(confidence)</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">维度指标计算</span>] <span class="hljs-string">(Stateful时间窗口)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">窗口:</span> <span class="hljs-number">60</span><span class="hljs-string">分钟滑动,</span> <span class="hljs-number">30</span><span class="hljs-string">分钟步长</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算LDI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">commodity)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算CRI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">region)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算GRI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">conflict_zone)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算FRI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">country)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">应用衰减函数:</span> <span class="hljs-string">历史事件权重递减</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">综合指标合成</span>] <span class="hljs-string">(Stateless)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">综合风险指数</span> <span class="hljs-string">=</span> <span class="hljs-number">40</span><span class="hljs-string">%(LDI+CRI)/2</span> <span class="hljs-string">+</span> <span class="hljs-number">60</span><span class="hljs-string">%(GRI+FRI)/2</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">采购商特定风险</span> <span class="hljs-string">=</span> <span class="hljs-string">综合指数</span> <span class="hljs-string">×</span> <span class="hljs-string">货运量</span> <span class="hljs-string">×</span> <span class="hljs-string">商品敏感性</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">舆情vs风险相关度</span> <span class="hljs-string">(相关性分析)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">预警等级转换</span> <span class="hljs-string">(Green/Yellow/Orange/Red)</span>
  <span class="hljs-string">↓</span>
<span class="hljs-attr">Sink:</span> <span class="hljs-string">并行输出</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Paimon表</span> <span class="hljs-attr">1:</span> <span class="hljs-string">mgir_events_raw</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Paimon表</span> <span class="hljs-attr">2:</span> <span class="hljs-string">mgir_events_standardized</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Paimon表</span> <span class="hljs-attr">3:</span> <span class="hljs-string">mgir_dimension_scores</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Doris表:</span> <span class="hljs-string">mgir_indices_fact</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">告警系统</span> <span class="hljs-string">(即时处理Red级)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">监控日志</span>

<span class="hljs-string">并行度配置:</span>
<span class="hljs-string">├─</span> <span class="hljs-string">数据清洗:</span> <span class="hljs-number">32</span>
<span class="hljs-string">├─</span> <span class="hljs-string">NLP处理:</span> <span class="hljs-number">16</span> <span class="hljs-string">(GPU场景)</span>
<span class="hljs-string">├─</span> <span class="hljs-string">指标计算:</span> <span class="hljs-number">32</span> <span class="hljs-string">(高计算密集)</span>
<span class="hljs-string">├─</span> <span class="hljs-string">数据输出:</span> <span class="hljs-number">16</span>
<span class="hljs-string">└─</span> <span class="hljs-attr">Checkpoint:</span> <span class="hljs-number">60</span><span class="hljs-string">秒间隔,</span> <span class="hljs-string">RocksDB后端</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">指标计算</h2>
<h3 data-id="heading-25">6.1 LDI计算示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Flink代码示例</span>

<span class="hljs-keyword">from</span> pyflink.datastream <span class="hljs-keyword">import</span> StreamExecutionEnvironment
<span class="hljs-keyword">from</span> pyflink.datastream.functions <span class="hljs-keyword">import</span> MapFunction, WindowFunction
<span class="hljs-keyword">from</span> pyflink.datastream.window <span class="hljs-keyword">import</span> TumblingEventTimeWindow

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LDICalculator</span>(<span class="hljs-title class_ inherited__">WindowFunction</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">self, key, window, elements</span>):
        buyer_geo, commodity = key
        
        ldi_score = <span class="hljs-number">0.0</span>
        <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> elements:
            <span class="hljs-comment"># 基础严重度</span>
            severity = self.get_severity_score(event[<span class="hljs-string">'delivery_impact_dim'</span>])
            
            <span class="hljs-comment"># 距离衰减系数</span>
            distance = self.get_distance_to_buyer(
                event[<span class="hljs-string">'location_lat'</span>], 
                event[<span class="hljs-string">'location_lon'</span>],
                buyer_geo
            )
            proximity_factor = self.distance_decay(distance)
            
            <span class="hljs-comment"># 商品易腐性乘数</span>
            commodity_multiplier = self.get_commodity_multiplier(commodity)
            
            <span class="hljs-comment"># LDI累加</span>
            event_ldi = severity * proximity_factor * commodity_multiplier
            
            <span class="hljs-comment"># 衰减函数: 事件发生越早权重越小</span>
            days_old = (now - event[<span class="hljs-string">'risk_date'</span>]).days
            decay_factor = math.exp(-<span class="hljs-number">0.1</span> * days_old)  <span class="hljs-comment"># 半衰期10天</span>
            
            ldi_score += event_ldi * decay_factor
        
        <span class="hljs-comment"># 归一化到0-10</span>
        ldi_normalized = <span class="hljs-built_in">min</span>(<span class="hljs-number">10.0</span>, ldi_score)
        
        <span class="hljs-keyword">yield</span> (buyer_geo, commodity, ldi_normalized)
</code></pre>
<h3 data-id="heading-26">6.2 综合风险指数计算</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompositeRiskCalculator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">self, ldi, cri, gri, fri, 
                  volume_weight, commodity_sensitivity</span>):
        <span class="hljs-string">"""
        综合风险指数 = 40% × (LDI+CRI)/2 + 60% × (GRI+FRI)/2
        采购商特定风险 = 综合指数 × 货运量权重 × 商品敏感性
        """</span>
        
        <span class="hljs-comment"># 第2层: 维度指标平均</span>
        logistics_compliance_avg = (ldi + cri) / <span class="hljs-number">2.0</span>
        geopolitical_financial_avg = (gri + fri) / <span class="hljs-number">2.0</span>
        
        <span class="hljs-comment"># 综合舆情指数 (0-100)</span>
        composite_index = (
            <span class="hljs-number">0.4</span> * logistics_compliance_avg +
            <span class="hljs-number">0.6</span> * geopolitical_financial_avg
        ) * <span class="hljs-number">10</span>  <span class="hljs-comment"># 缩放到0-100</span>
        
        <span class="hljs-comment"># 采购商特定风险 (考虑货运量和商品敏感性)</span>
        buyer_specific_risk = (
            composite_index * 
            volume_weight * 
            commodity_sensitivity
        )
        buyer_specific_risk = <span class="hljs-built_in">min</span>(<span class="hljs-number">100.0</span>, buyer_specific_risk)
        
        <span class="hljs-comment"># 预警等级</span>
        alert_level = self.get_alert_level(buyer_specific_risk)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'composite_risk_index'</span>: composite_index,
            <span class="hljs-string">'buyer_specific_risk_score'</span>: buyer_specific_risk,
            <span class="hljs-string">'risk_alert_level'</span>: alert_level
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_alert_level</span>(<span class="hljs-params">self, risk_score</span>):
        <span class="hljs-keyword">if</span> risk_score &lt; <span class="hljs-number">25</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Green'</span>
        <span class="hljs-keyword">elif</span> risk_score &lt; <span class="hljs-number">50</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Yellow'</span>
        <span class="hljs-keyword">elif</span> risk_score &lt; <span class="hljs-number">75</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Orange'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Red'</span>
</code></pre>
<h3 data-id="heading-27">6.3 舆情相关度计算</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_sentiment_risk_correlation</span>(<span class="hljs-params">
    sentiment_scores: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>],
    risk_scores: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]
</span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""
    计算舆情热度与实际风险的相关度
    
    &gt;0.7: 舆情热度与实际风险高度相关
    0.3-0.7: 中等相关
    &lt;0.3: 低相关 (舆情为"噪音")
    """</span>
    
    <span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
    
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sentiment_scores) &lt; <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(risk_scores) &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    
    s = np.array(sentiment_scores)
    r = np.array(risk_scores)
    
    <span class="hljs-comment"># Pearson相关系数</span>
    correlation = np.corrcoef(s, r)[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(correlation) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> np.isnan(correlation) <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio的技巧]]></title>    <link>https://juejin.cn/post/7577737385955246090</link>    <guid>https://juejin.cn/post/7577737385955246090</guid>    <pubDate>2025-11-30T10:04:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385955246090" data-draft-id="7577971299743154214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio的技巧"/> <meta itemprop="keywords" content="Android Studio,Android"/> <meta itemprop="datePublished" content="2025-11-30T10:04:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="城堡修炼者"/> <meta itemprop="url" content="https://juejin.cn/user/2379804202775341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio的技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2379804202775341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    城堡修炼者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:04:38.000Z" title="Sun Nov 30 2025 10:04:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 历史剪贴板</h2>
<p>ctrl（Mac: Cmd） + shift + v ： 可以查看你复制过的内容</p>
<h2 data-id="heading-1">2. 批量导入资源文件</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eef3a8ef8ca041bba353e05fb49cd257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5aCh5L-u54K86ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101877&amp;x-signature=8IFn8bEWPh5J34V83qXF%2BU%2BnAVw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3. 同时选中多个地方</h2>
<p>ctrl（Mac: Cmd） + shift + alt ： 同时选中多个地方，可以编辑修改</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15230f2f6c534de1ba57eada76f08777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5aCh5L-u54K86ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101877&amp;x-signature=RPbJWxSmqN6JRRhRMdHdOv%2BTpjc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">4. 快捷编辑</h2>
<p>postfix</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62a5cfcd8d65451d8f947137b8a03cad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5aCh5L-u54K86ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101877&amp;x-signature=YxqcueSJRyhNsfvmaKHjCc5alCc%3D" alt="image.png" loading="lazy"/></p>
<p>可以自定义自己的快捷语也可以用默认的</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ID生成器第一讲：原理和常见几种生成器]]></title>    <link>https://juejin.cn/post/7577991167200444426</link>    <guid>https://juejin.cn/post/7577991167200444426</guid>    <pubDate>2025-11-30T09:53:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167200444426" data-draft-id="7577968429590085658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ID生成器第一讲：原理和常见几种生成器"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T09:53:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员Easy哥"/> <meta itemprop="url" content="https://juejin.cn/user/221424286966538"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ID生成器第一讲：原理和常见几种生成器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/221424286966538/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员Easy哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T09:53:48.000Z" title="Sun Nov 30 2025 09:53:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2055d9173844762a14aaa1715b6177c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=3Fa87KMtQVzEmUt%2B1vewtEa%2BCc0%3D" alt="画板" loading="lazy"/></p>
<h2 data-id="heading-0">一、介绍</h2>
<p>ID 是标识符（identifier）的前缀，它代表一个可以唯一识别一个对象或者物体的名称。在软件系统中，ID 用于对一组信息进行标识，它是信息系统里最底层、最基础的概念，从系统诞生到消亡，都与 ID 息息相关。</p>
<p>在分布式系统中，ID生成器是至关重要的，因为分布式系统中，一个数据表可能存储在多个物理机上，这样主键Id如何生成，怎么保证其有序性，生成可靠性，生成稳定性等都是一个问题。</p>
<p>作为一个Java后端架构师，我们需要知道 ID生成器的原理和常见的ID生成器都有哪些，以及如何自己实现一个简易的Id生成器，加深对分布式系统的理解。</p>
<p/>
<h2 data-id="heading-1">二、属性</h2>
<p>用5 个属性来分析</p>
<ul>
<li>自身属性:  类型、长度</li>
<li>领域属性:  唯一性、稀疏度、递增性</li>
</ul>
<h2 data-id="heading-2">三、各种Id生成</h2>
<h3 data-id="heading-3">1、db自增ID表</h3>
<hr/>
<p><strong>介绍</strong>: 自增ID表其实就是给db中写一张id表，利用数据库主键id自增思想来生成id.</p>
<pre><code class="hljs language-java" lang="java">create table `id_gen` 
(
    `id` bigint(<span class="hljs-number">20</span>) not <span class="hljs-literal">null</span> auto_increment,
    primary <span class="hljs-title function_">key</span><span class="hljs-params">(`id`)</span>
) engine=InnoDB <span class="hljs-type">DEFAULT</span> <span class="hljs-variable">CHATSET</span> <span class="hljs-operator">=</span> utf8mb4;
</code></pre>
<p><strong>优点</strong>:     实现简单，成本不高，自增连续性好，Id严格从1增长<br/>
<strong>缺点</strong>:</p>
<pre><code class="hljs language-css" lang="css">- 单表&lt;<span class="hljs-attribute">font</span> style="<span class="hljs-attribute">color</span>:<span class="hljs-number">#DF2A3F</span>;"&gt;过热&lt;/<span class="hljs-attribute">font</span>&gt;，&lt;<span class="hljs-attribute">font</span> style="<span class="hljs-attribute">color</span>:<span class="hljs-number">#DF2A3F</span>;"&gt;qps存在瓶颈&lt;/<span class="hljs-attribute">font</span>&gt;。
- &lt;<span class="hljs-attribute">font</span> style="<span class="hljs-attribute">color</span>:<span class="hljs-number">#DF2A3F</span>;"&gt;安全问题&lt;/<span class="hljs-attribute">font</span>&gt;(根据订单ID递增规则推送出每天的数据量等等)
- 每获取一次Id都需要访问一次数据库，单个db的&lt;<span class="hljs-attribute">font</span> style="<span class="hljs-attribute">color</span>:<span class="hljs-number">#DF2A3F</span>;"&gt;连接数&lt;/<span class="hljs-attribute">font</span>&gt;是瓶颈.
</code></pre>
<h3 data-id="heading-4">2、db多主模式</h3>
<hr/>
<p><strong>介绍</strong>:  多个表同时提供ID服务，一个表从1开始步长为2，一个表从2开始步长2。</p>
<p>生产id: 1,  3, 5.    2, 4, 6.<br/>
如果需要新增一个db实例，就需要重新调整.</p>
<p>比较繁琐.</p>
<p>set @@auto_increment_offset = 2;       --- 起始值</p>
<p>set @@auto_increment_increment= 2;    --- 步长</p>
<p><strong>优点</strong>:  分散db压力<br/>
<strong>缺点</strong>:  扩展性和复杂度提高,  其实并没有实现分布式</p>
<h3 data-id="heading-5">3、号段模式</h3>
<p><strong>介绍</strong>:</p>
<p>数据库每次递增一条肯定是不行的，所以能否一次请求，生成一段Id， 放在内存中，下次直接访问内存即可,  这样减轻db请求次数.   这就是我们所说的<strong>基于数据库号段生成分布式Id。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edff0532e3774e6388902376434d9890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=AZWpn21rwDplGbgYNXEV5bz05jg%3D" alt="画板" loading="lazy"/></p>
<p><strong>具体实现</strong>:</p>
<ul>
<li><strong>Idserver 多个rpc生成:</strong>    瓶颈在于id server 数量</li>
<li><strong>客户端批量生成:</strong>         瓶颈在于DB，多个实例同时请求同一个业务的更新权限时，其实就是会抢行锁.</li>
<li>如果是认为单表过热的话，也就是多个业务，其实可以横向扩充shard即可. biz_id % shard 去操作.</li>
</ul>
<p>idserver我们就不用多说了，其实就是单个单个server组成集群，每个server提供id生成服务.<br/>
我们下面来看一下客户端批量生成单表.</p>
<pre><code class="hljs language-java" lang="java">create table `id_generator` (
    `id` bigint(<span class="hljs-number">20</span>) not <span class="hljs-literal">null</span>,
    `max_id` bigint(<span class="hljs-number">20</span>) not <span class="hljs-literal">null</span> comment <span class="hljs-string">'最大id'</span>,
    `step` <span class="hljs-type">int</span>(<span class="hljs-number">10</span>) not <span class="hljs-literal">null</span> comment <span class="hljs-string">'号段长度'</span>,
    `version` <span class="hljs-type">int</span>(<span class="hljs-number">20</span>) not <span class="hljs-literal">null</span> comment <span class="hljs-string">'版本'</span>,
    `biz_type` <span class="hljs-type">int</span>(<span class="hljs-number">20</span>) not <span class="hljs-literal">null</span> comment <span class="hljs-string">'业务类型'</span>,
    primary <span class="hljs-title function_">key</span><span class="hljs-params">(`id`)</span>
) engine = InnoDB <span class="hljs-keyword">default</span> charset=utf8mb4;
</code></pre>
<p>select + update 重试</p>
<pre><code class="hljs language-java" lang="java">update ml_id_gen set version=version + <span class="hljs-number">1</span>, max_id =newMaxId where biz_id=:bizId <span class="hljs-type">and</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> version 
如果updateCount == <span class="hljs-number">0</span>, 重复select, update直到修改成功


注意: newMaxId = oldMaxId + step 

<span class="hljs-comment">// 那就得先获取版本, 再更新.</span>
select version from ml_id_gen <span class="hljs-type">where</span> <span class="hljs-variable">biz_id</span> <span class="hljs-operator">=</span> :bizId


在获取层client, 内部就可以封装一个loadingCache&lt;bizId, Tuple&lt;Long, Long&gt;&gt;   
        Tuple中是 curId, curRegionMaxId

<span class="hljs-keyword">case</span>: 
<span class="hljs-number">1.</span> bizId 无, 去找db 生成
<span class="hljs-number">2.</span> bizId 有  
        <span class="hljs-number">2.1</span> curId = curRegionMaxId
        找server分配,  更新cache
        重新拿到curId, curId++更新cache.
        <span class="hljs-keyword">return</span> 重新拿到curId;
        <span class="hljs-number">2.2</span> curId &lt; curRegionMaxId
        <span class="hljs-type">long</span> <span class="hljs-variable">oldId</span> <span class="hljs-operator">=</span> curId++;
        更新cache(curId, curRegionMaxId)
        <span class="hljs-keyword">return</span> oldId;
</code></pre>
<p><strong>优点</strong>:  ID 趋势增长、存储消耗空间少</p>
<p><strong>缺点</strong>:  <strong>单表存在热点问题</strong>，Id 没有意义，安全问题(步长很容易被猜出来)</p>
<h3 data-id="heading-6">4、NoSQL自增</h3>
<p><strong>介绍</strong>:</p>
<p>采用incr自增获取.</p>
<p>**优点:   **性能非常好，并且Id有序增长。</p>
<p><strong>缺点</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">-</span> <span class="hljs-strong">**存在单点.  当然有集群.**</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**RDB**</span>:   每隔一段时间快照，但是如果连续incr，redis挂了，会造成id重复.
<span class="hljs-bullet">-</span> <span class="hljs-strong">**AOF**</span>:   不会重复，但是incr命令过多，导致重启恢复数据时间过长.
</code></pre>
<h3 data-id="heading-7">5、雪花算法及其多个实现</h3>
<p>**介绍: **</p>
<p>雪花算法:  snowflow是twitter开源的分布式Id生成算法.</p>
<p>long 我们都知道8个字节==64bit.</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 第一位标识:  0: 正数  1: 负数</span>
<span class="hljs-deletion">- 41位:  时间戳部分ms,  一般是当前时间 - 固定的开始时间，这样产生的ID可以从更小值开始.   而且41位可以用 (1L &lt;&lt; 41 / (1000 * 3600 * 24 * 365)) = 69年.</span>
<span class="hljs-deletion">- 10位: 工作机器id，5位为机房信息，5位为机房中的机器号 workerId, 这样可以部署1024个节点.</span>
<span class="hljs-deletion">- 12位: 序列号部分, 支持统一ms内同一个节点可以生成4096个ID.</span>
</code></pre>
<p><strong>优点:  生成速度快、生成的ID有序递增、比较灵活(可以改造)</strong></p>
<p><strong>缺点:  需要解决重复ID问题 (比较依赖服务器时间，在机器时间不对的情况下, 可能会造成重复ID)</strong></p>
<p>后面百度uid-generator,  美团leaf，滴滴Tinyid等都是修改 这个几个的位数和 具体workerId怎样生成的。</p>
<h4 data-id="heading-8">Uid-Generator(百度):</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbaidu%2Fuid-generator" target="_blank" title="https://github.com/baidu/uid-generator" ref="nofollow noopener noreferrer">uid-generator</a> 基于Java、snawflake实现的唯一Id生成器。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0d7b29197d4e6489614fe7c2e78021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=shVlT%2B%2BbEAxdCO627EG%2Ffagh6aM%3D" alt="" loading="lazy"/></p>
<p>看起来已经不在维护了.</p>
<h4 data-id="heading-9">Leaf(美团):</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMeituan-Dianping%2FLeaf" target="_blank" title="https://github.com/Meituan-Dianping/Leaf" ref="nofollow noopener noreferrer">Leaf</a> 最早期需求是各个业务线的订单ID生成需求。\ 看起来以前他们是db自增，redis自增来生成ID，后面他们统一了。\ 这其实得深入了解美团的技术组成，如果内部有两个相同的业务，就会整合成一个，这一点非常好.</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29acd93badbf4047a9f79917f6efd688~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=1GjnWueC4FhjgNfPS0BGExquwTU%3D" alt="" loading="lazy"/></p>
<p>世界上没有两片完全相同的树叶，人也是一样.</p>
<p>Leaf 提供了 号段模式 和 snowflow(雪花算法) 这两种模式来生成分布式ID。</p>
<p>支持双号段，解决了雪花ID 系统时钟回拨问题。但是时钟问题的解决依赖于Zk。</p>
<p>雪花的号段位分布. <a href="https://link.juejin.cn?target=https%3A%2F%2Ftech.meituan.com%2F2017%2F04%2F21%2Fmt-leaf.html" target="_blank" title="https://tech.meituan.com/2017/04/21/mt-leaf.html" ref="nofollow noopener noreferrer">Leaf——美团点评分布式ID生成系统</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f36a9c9618c430c82621517a0892d53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=fGANxKPMLly7rSWcVk5C8Nf5%2FRQ%3D" alt="" loading="lazy"/></p>
<p>主要是workerId生成不同，leaf中workId 是基于zk的顺序id来生成的，每个应用在使用Leaf-snowFlake时，在启动时都会在zk中生成一个顺序id，相当于一个机器对应一个顺序节点，也就是一个workId。</p>
<h4 data-id="heading-10">Tinyid(滴滴):</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdidi%2Ftinyid" target="_blank" title="https://github.com/didi/tinyid" ref="nofollow noopener noreferrer">Tinyid(opens new window)</a>是滴滴开源的一款基于数据库号段模式的唯一 ID 生成器。</p>
<p>相关文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdidi%2Ftinyid%2Fwiki%2Ftinyid%25E5%258E%259F%25E7%2590%2586%25E4%25BB%258B%25E7%25BB%258D" target="_blank" title="https://github.com/didi/tinyid/wiki/tinyid%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D" ref="nofollow noopener noreferrer">Tinyid原理介绍</a></p>
<h3 data-id="heading-11"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d4e5bca56a341b498da2ddf65a8f712~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=bUYebn8Z2ojydhRzZdQg%2Ft%2Fe%2Fh8%3D" alt="" loading="lazy"/></h3>
<p>到此一个简单的id生成系统就完成了，那么是否还存在问题呢？回想一下我们最开始的id生成系统要求，高性能、高可用、简单易用，在上面这套架构里，至少还存在以下问题:</p>
<ul>
<li>当id用完时需要访问db加载新的号段，db更新也可能存在version冲突，此时id生成耗时明显增加</li>
<li>db是一个单点，虽然db可以建设主从等高可用架构，但始终是一个单点</li>
<li>使用http方式获取一个id，存在网络开销，性能和可用性都不太好</li>
</ul>
<p/>
<p>所以后面加了下面这几个来优化. </p>
<ul>
<li>双号段缓存:  
<ul>
<li>为了避免在获取新号段的情况下，获取唯一ID的速度比较慢。Tinyid中的号段在加载到一定的程度(比如一半)，就去异步加载下一个号段，保证内存中永远始终有可用的号段。</li>
</ul>
</li>
<li>增加多db支持 其实就是生成奇数，偶数这种.	
<ul>
<li>支持多个DB，并且，每个DB都能生成唯一ID，提高可用性。</li>
</ul>
</li>
<li>增加tinyid-client。
<ul>
<li>纯纯本地操作，无http请求损耗。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f826a4804249e8b2c7817d79d708a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=GjKUDqzHMMOye3temSXapzfzVAc%3D" alt="" loading="lazy"/></p>
<p>优缺点: 上面也说了很多，但是要注意数据库号段的缺点。</p>
<h3 data-id="heading-12">6、UUID</h3>
<p><strong>介绍</strong>:</p>
<p>UUID 是 Universally unique identifier (通用唯一标识符) 的 缩写。UUID 包含32个16进入数字 (8-4-4-4-12) 。</p>
<p>JDK 中就用现成的。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">UUID</span> <span class="hljs-variable">uuid</span> <span class="hljs-operator">=</span> UUID.randomUUID();
System.out.println(uuid);
System.out.println(uuid.version());


4c994944-<span class="hljs-number">82e1</span>-4be4-a543-ab182d87b11d
<span class="hljs-number">4</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc4122" target="_blank" title="https://tools.ietf.org/html/rfc4122" ref="nofollow noopener noreferrer">RFC 4122(opens new window)</a>中关于 UUID 的示例是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8af34e9bcef4e6b89cb8914c93d4bda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=%2BYT2GUshx6FiR0NdnLQ%2BST2I5RY%3D" alt="" loading="lazy"/></p>
<p>其实需要关注版本即可，不同的版本对应的UUID 的生成规则是不同的。</p>
<p>5 种不同的 Version(版本)值分别对应的含义（参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E9%2580%259A%25E7%2594%25A8%25E5%2594%25AF%25E4%25B8%2580%25E8%25AF%2586%25E5%2588%25AB%25E7%25A0%2581" target="_blank" title="https://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E7%A0%81" ref="nofollow noopener noreferrer">维基百科对于 UUID 的介绍(opens new window)</a>）：</p>
<ul>
<li><strong>版本 1</strong> : UUID 是根据时间和节点 ID（通常是 MAC 地址）生成；</li>
<li><strong>版本 2</strong> : UUID 是根据标识符（通常是组或用户 ID）、时间和节点 ID 生成；</li>
<li><strong>版本 3、版本 5</strong> : 版本 5 - 确定性 UUID 通过散列（hashing）名字空间（namespace）标识符和名称生成；</li>
<li><strong>版本 4</strong> : UUID 使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E9%259A%258F%25E6%259C%25BA%25E6%2580%25A7" target="_blank" title="https://zh.wikipedia.org/wiki/%E9%9A%8F%E6%9C%BA%E6%80%A7" ref="nofollow noopener noreferrer">随机性(opens new window)</a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E4%25BC%25AA%25E9%259A%258F%25E6%259C%25BA%25E6%2580%25A7" target="_blank" title="https://zh.wikipedia.org/wiki/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%80%A7" ref="nofollow noopener noreferrer">伪随机性(opens new window)</a>生成。</li>
</ul>
<p>下面是 Version 1 版本下生成的 UUID 的示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43ae4df06c0f4e8ca6cb41c9984bd892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYRWFzeeWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765101228&amp;x-signature=ixhVZzLGolSyqGJ6unN86hlwmK0%3D" alt="" loading="lazy"/></p>
<p>JDK 中通过 UUID 的 randomUUID() 方法生成的 UUID 的版本默认为 4。</p>
<p>我们看UUID的生成包含： MAC地址、时间戳、命名空间、随机或伪随机数、时序等元素，当然极少概率会出现重复.</p>
<p><strong>优点</strong>:  生成速度比较快、简单</p>
<p><strong>缺点</strong>:  存储消耗空间大(36字符，128位)、 不安全（基于MAC地址生成会造成MAC地址泄漏）、无序、没有具体的业务含义、需要解决重复ID问题 (当机器时间不对的时候,  linux 的ntp时间会有问题,  可能会导致重复Id)</p>
<h3 data-id="heading-13">说明:</h3>
<ul>
<li>其中1.2.3.4 数据自增思想.</li>
<li>5属于snowFlake思想，各个bit位数不一样，workerId生成不一样.</li>
</ul>
<h2 data-id="heading-14">四、使用</h2>
<p>其实在大厂里都有自己的id生成器，一般都是雪花算法的变种，当然也提供类似号段模式，id-server严格递增等等。</p>
<p>还是需要根据业务诉求、背景去找到符合自己背景的id生成器</p>
<h2 data-id="heading-15">附录:</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infoq.cn%2Farticle%2Fiuvjqc1ws7h8mqsogquy" target="_blank" title="https://www.infoq.cn/article/iuvjqc1ws7h8mqsogquy" ref="nofollow noopener noreferrer">www.infoq.cn/article/iuv…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fdistributed-system%2Fdistributed-id%2F%23%25E5%25BC%2580%25E6%25BA%2590%25E6%25A1%2586%25E6%259E%25B6" target="_blank" title="https://javaguide.cn/distributed-system/distributed-id/#%E5%BC%80%E6%BA%90%E6%A1%86%E6%9E%B6" ref="nofollow noopener noreferrer">javaguide.cn/distributed…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch 跳表（Skip List）：有序结果合并的 “性能电梯”]]></title>    <link>https://juejin.cn/post/7577737385955213322</link>    <guid>https://juejin.cn/post/7577737385955213322</guid>    <pubDate>2025-11-30T09:55:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385955213322" data-draft-id="7577737385955196938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch 跳表（Skip List）：有序结果合并的 “性能电梯”"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T09:55:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Penge666"/> <meta itemprop="url" content="https://juejin.cn/user/1549628692501449"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch 跳表（Skip List）：有序结果合并的 “性能电梯”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549628692501449/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Penge666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T09:55:10.000Z" title="Sun Nov 30 2025 09:55:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Elasticsearch（ES）的多条件查询中，结果合并是决定性能的关键步骤。当你执行 “标题包含 A 且包含 B” 这类查询时，ES 需要合并两个倒排列表（Posting List）的结果。此时，<strong>跳表（Skip List）</strong>  就像 “性能电梯” 一样，跳过大量无关元素，让合并速度飙升 —— 而这一点，用普通链表合并根本无法实现。</p>
<p>本文将通过一个更直观的例子，拆解跳表的工作原理、优势，以及它在 ES 中的实际应用，让你彻底明白 “为什么有序列表合并必须用跳表”。</p>
<h2 data-id="heading-0">一、先澄清：跳表的核心优势是什么？</h2>
<p>跳表的核心价值只有一个：<strong>在有序列表中，以 “跳跃式遍历” 替代 “逐元素遍历”，将合并时间复杂度从 O (n) 降至 O (log n)</strong> 。</p>
<p>举个极端对比：</p>
<ul>
<li>普通链表合并：100 万条数据的两个列表，需逐元素比较，最多要 200 万次操作；</li>
<li>跳表合并：同样 100 万条数据，仅需约 20 次比较（log₂(100 万)≈17），速度提升 10 万倍。</li>
</ul>
<p>之所以之前的例子没凸显优势，是因为数据量太小。这次我们用 “10 万条 docID” 的场景，让跳表的 “电梯效应” 一目了然。</p>
<h2 data-id="heading-1">二、场景重构：10 万条数据的多条件查询</h2>
<h3 data-id="heading-2">场景假设</h3>
<p>我们有一个新闻索引 <code>news</code>，包含 <strong>10 万篇文档</strong>（docID 从 1 到 100000），字段 <code>title</code>（text 类型，分词后建立倒排索引）。现在执行查询：<strong>「金龙鱼 AND 18 亿 AND 罚单」</strong>（标题同时包含这三个关键词的新闻）。</p>
<p>对应的 DSL：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"bool"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"must"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"金龙鱼"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"18亿"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"罚单"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">关键前提：倒排列表是有序的</h3>
<p>ES 的倒排索引在构建时，会将每个关键词对应的 docID 按 <strong>递增顺序</strong> 存储（因为 docID 是文档写入时分配的连续整数，匹配同一关键词的文档会按写入顺序排序）。</p>
<p>查询后，我们得到三个按 docID 有序的 Posting List：</p>
<ul>
<li>列表 A（金龙鱼）：<code>[123, 456, 789, 1112, 1456, 1789, 2112, ..., 99789]</code>（共 5000 条）</li>
<li>列表 B（18 亿）：<code>[456, 1456, 2456, 3456, ..., 98456]</code>（共 3000 条）</li>
<li>列表 C（罚单）：<code>[1456, 3456, 5456, ..., 97456]</code>（共 2000 条）</li>
</ul>
<p>现在需要合并这三个列表，找到它们的 <strong>交集</strong>（同时包含三个关键词的 docID）。</p>
<h2 data-id="heading-4">三、普通链表合并 vs 跳表合并：差距一目了然</h2>
<h3 data-id="heading-5">1. 普通链表合并：低效的 “逐元素爬行”</h3>
<p>普通链表合并三个有序列表，需要三个指针分别遍历三个列表，逐元素比较是否相等：</p>
<ul>
<li>指针 A 初始指向 123，指针 B 指向 456，指针 C 指向 1456 → 123 &lt; 456 &lt; 1456，指针 A 移至 456；</li>
<li>指针 A=456，指针 B=456，指针 C=1456 → 456 &lt; 1456，指针 A 移至 789，指针 B 移至 1456；</li>
<li>指针 A=789，指针 B=1456，指针 C=1456 → 789 &lt; 1456，指针 A 移至 1112；</li>
<li>指针 A=1112，指针 B=1456，指针 C=1456 → 1112 &lt; 1456，指针 A 移至 1456；</li>
<li>指针 A=1456，指针 B=1456，指针 C=1456 → 相等，加入结果集；</li>
<li>后续重复此逻辑，直到遍历完某个列表。</li>
</ul>
<p><strong>问题</strong>：三个列表共 10000 条数据，普通合并需要遍历大部分元素（可能上万次比较），数据量越大，耗时越长。</p>
<h3 data-id="heading-6">2. 跳表合并：高效的 “电梯跳跃”</h3>
<p>跳表在普通有序链表之上，建立了 <strong>多层索引层</strong>（类似电梯），可以跳过大量无关元素。我们以列表 A 为例，看看跳表结构：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">第3层（顶层）：123 → 1456 → 2112 → ... → 99789 （间隔大，快速跨段）
第2层（中层）：123 → 789 → 1456 → 1789 → ... → 99789 （间隔中等）
第1层（下层）：123 → 456 → 789 → 1112 → 1456 → ... → 99789 （间隔小）
第0层（底层）：123 → 456 → 789 → 1112 → 1456 → 1789 → 2112 → ... → 99789 （原始列表）
</code></pre>
<h4 data-id="heading-7">跳表合并三个列表的流程（求交集）：</h4>
<ol>
<li>
<p><strong>初始化指针</strong>：三个列表的跳表指针均指向各自头部（A=123，B=456，C=1456）。</p>
</li>
<li>
<p><strong>第一次跳跃：快速对齐最小值</strong></p>
<ul>
<li>三个指针的当前值：123（A）、456（B）、1456（C），最小值是 123（A）；</li>
<li>用 A 的跳表快速跳到 “不小于 1456” 的元素（因为 C 的当前值是 1456，这是三个值中的最大值，交集必须大于等于 1456）；</li>
<li>A 的跳表从 123 直接跳到 1456（跳过 456、789、1112 三个元素），此时 A=1456。</li>
</ul>
</li>
<li>
<p><strong>第二次跳跃：验证是否相等</strong></p>
<ul>
<li>现在三个指针的值：1456（A）、456（B）、1456（C），最小值是 456（B）；</li>
<li>用 B 的跳表快速跳到 “不小于 1456” 的元素，B 从 456 直接跳到 1456（跳过 2456 之前的所有元素），此时 B=1456。</li>
</ul>
</li>
<li>
<p><strong>找到交集，继续跳跃</strong></p>
<ul>
<li>三个指针的值均为 1456，加入结果集；</li>
<li>三个指针同时跳到下一个元素（A=1789，B=2456，C=3456）；</li>
<li>最小值是 1789（A），用 A 的跳表快速跳到 “不小于 3456” 的元素（C 的当前值），A 从 1789 跳到 3456（跳过多个元素）；</li>
<li>重复上述逻辑，直到某个指针无下一个元素。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">跳表的优势体现：</h4>
<ul>
<li>合并三个列表仅需 <strong>几十次比较</strong>（而非上万次），因为大部分无关元素都被跳表 “跳过” 了；</li>
<li>数据量越大，优势越明显：100 万条数据的列表合并，跳表可将耗时从秒级降至毫秒级。</li>
</ul>
<h2 data-id="heading-9">四、跳表在 ES 中的应用场景：仅用于有序列表合并</h2>
<p>跳表不是万能的，它的应用场景有严格限制 ——<strong>必须是有序的 Posting List 合并</strong>，这在 ES 中对应以下场景：</p>
<h3 data-id="heading-10">1. 多条件文本查询（must/should 子句）</h3>
<ul>
<li>例：<code>title:金龙鱼 AND title:18亿</code>（must 子句，求交集）；</li>
<li>例：<code>title:金龙鱼 OR title:18亿</code>（should 子句，求并集）；</li>
<li>核心：文本类型（text/keyword）的倒排索引 Posting List 是有序的，适合跳表合并。</li>
</ul>
<h3 data-id="heading-11">2. 带过滤的文本查询（filter + must）</h3>
<ul>
<li>例：<code>filter: {term: {biz_id:1001}} AND must: {match: {title:金龙鱼}}</code>；</li>
<li>核心：filter 子句的 Bitset 先筛选出小范围有序 docID，再与 must 子句的有序 Posting List 用跳表合并。</li>
</ul>
<h3 data-id="heading-12">3. 不适用的场景</h3>
<ul>
<li>数值 / 日期类型的范围查询（BKD 树返回的 docID 是无序的，用 Bitset 合并）；</li>
<li>稀疏结果集的合并（如匹配文档数少于 100 条，直接逐元素比较更高效）。</li>
</ul>
<h2 data-id="heading-13">五、跳表的底层设计：为什么能 “跳” 得快？</h2>
<ol>
<li><strong>分层索引</strong>：跳表的索引层是随机生成的（每层索引的元素间隔随机），但整体遵循 “上层间隔大，下层间隔小” 的规则，确保快速定位；</li>
<li><strong>平衡结构</strong>：ES 中的跳表会动态调整索引层，避免出现 “某一层索引间隔过小” 的情况，保证查询效率稳定；</li>
<li><strong>内存友好</strong>：跳表的索引层仅存储少量关键元素的指针，内存占用远低于 Bitset（无需初始化全量位图）。</li>
</ol>
<h2 data-id="heading-14">六、总结：跳表是有序合并的 “性能天花板”</h2>
<p>跳表的核心逻辑的是 “<strong>用空间换时间</strong>”—— 通过增加少量索引层，换来了有序列表合并的指数级速度提升。在 ES 中，它是文本类型多条件查询的 “性能基石”，也是为什么文本查询的多条件合并比数值查询更快的关键原因之一。</p>
<p>简单记：<strong>有序用跳表，无序用 Bitset</strong>—— 这是 ES 结果合并的黄金法则。理解了这一点，你就能明白为什么有些查询需要优化字段类型（如将数值类型转为 keyword 类型，利用跳表合并提升性能），也能更精准地定位多条件查询的性能瓶颈。</p>
<p>编辑分享</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[搞懂作用域链与闭包：JS底层逻辑变简单]]></title>    <link>https://juejin.cn/post/7577905525997748265</link>    <guid>https://juejin.cn/post/7577905525997748265</guid>    <pubDate>2025-11-30T09:39:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577905525997748265" data-draft-id="7577970969395249193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="搞懂作用域链与闭包：JS底层逻辑变简单"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-30T09:39:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="闲云ing"/> <meta itemprop="url" content="https://juejin.cn/user/2974655942502250"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            搞懂作用域链与闭包：JS底层逻辑变简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2974655942502250/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    闲云ing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T09:39:03.000Z" title="Sun Nov 30 2025 09:39:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JS底层小揭秘：作用域链与闭包，代码+图解一看就懂</h2>
<p>在 JavaScript 的学习过程中，理解其底层运行机制是进阶的关键，而作用域链和闭包更是其中的核心概念。，很多人只停留在“会用”，没搞懂底层逻辑。本文结合<strong>代码+调用栈图解</strong>，从V8引擎的运行机制出发，拆解这两个概念的本质，帮你从底层视角搞懂 JS 的执行规则。</p>
<h3 data-id="heading-1">一、先搭好JS底层的基础框架</h3>
<p>JS代码能运行，依赖V8引擎的三个核心模块：</p>
<ol>
<li><strong>调用栈</strong>：分<strong>编译阶段</strong>（处理变量/函数提升）和<strong>执行阶段</strong>（创建执行上下文并压入栈，执行完弹出）；</li>
<li><strong>执行上下文</strong>：全局执行上下文（始终在栈底）+ 函数执行上下文（函数调用时创建）；</li>
<li><strong>作用域</strong>：定义变量的查找范围和生命周期，包含<code>let/const</code>的<strong>块级作用域</strong>（依托栈结构的词法环境），以及<code>var</code>的<strong>变量提升</strong>特性。</li>
</ol>
<h3 data-id="heading-2">二、作用域链：静态的变量查找路径</h3>
<p>作用域链（词法作用域链）的核心是：<strong>它由函数声明的位置决定，编译阶段就固定了，和调用顺序无关</strong>。</p>
<h4 data-id="heading-3">案例1：为什么<code>bar</code>里的<code>myName</code>取全局值？</h4>
<p>对应代码与图示：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>){
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myName); <span class="hljs-comment">// 输出“极客时间”</span>
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客邦'</span>
  <span class="hljs-title function_">bar</span>() <span class="hljs-comment">// 在foo内部调用bar</span>
}
<span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客时间'</span>
<span class="hljs-title function_">foo</span>();
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35b0eb64c6eb497fb55469050d74c6ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zey5LqRaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765100597&amp;x-signature=Ue%2Boyi90WYwLlQ8bBQdNwy0j1uc%3D" alt="1.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9f7ed7d57e446c39ade479e05107da2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zey5LqRaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765100597&amp;x-signature=DSj6EvkEUnvp4YnzcYF9nNUkSWY%3D" alt="2.jpg" loading="lazy"/></p>
<h5 data-id="heading-4">运行逻辑拆解：</h5>
<ol>
<li>
<p>编译阶段：<code>bar</code>和<code>foo</code>被声明在<strong>全局作用域</strong>，因此它们的作用域链默认“自身→全局”；</p>
</li>
<li>
<p>执行阶段：</p>
<ol>
<li><code>foo</code>调用时，创建<code>foo</code>执行上下文（变量环境包含<code>myName="极客邦"</code>）并压入栈；</li>
<li><code>foo</code>内部调用<code>bar</code>，创建<code>bar</code>执行上下文并压入栈；</li>
<li><code>bar</code>中查找<code>myName</code>：自身变量环境无→通过<code>outer</code>指向的全局执行上下文查找→取全局的<code>"极客时间"</code>。</li>
</ol>
</li>
</ol>
<h4 data-id="heading-5">案例2：块级作用域下的变量查找</h4>
<p>对应代码与图示：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span> () {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客世界'</span>;
  <span class="hljs-keyword">let</span> test1 = <span class="hljs-number">100</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">let</span> myName = <span class="hljs-string">"Chrome 浏览器"</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(test); 
  }
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客邦'</span>;
  <span class="hljs-keyword">let</span> test = <span class="hljs-number">2</span>;
  {
    <span class="hljs-keyword">let</span> test = <span class="hljs-number">3</span>;
    <span class="hljs-title function_">bar</span>();
  }
}
<span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客时间'</span>;
<span class="hljs-keyword">let</span> myAge = <span class="hljs-number">10</span>;
<span class="hljs-keyword">let</span> test = <span class="hljs-number">1</span>;
<span class="hljs-title function_">foo</span>();
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9abe999baaa24e31916d4ae23ab8e905~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zey5LqRaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765100597&amp;x-signature=aB2ea4FhcUOMLVf%2Fsi9WJQIMBCM%3D" alt="3.jpg" loading="lazy"/></p>
<h5 data-id="heading-6">查找过程：</h5>
<ol>
<li><code>bar</code>内部<code>if</code>块的<code>console.log(test)</code>，先查<strong>自身块级词法环境</strong>（只有<code>myName="Chrome 浏览器"</code>）→ 没找到；</li>
<li>查<code>bar</code>函数的词法环境（有<code>test1=100</code>）→ 没找到；</li>
<li>查<code>bar</code>的变量环境（有<code>myName="极客世界"</code>）→ 没找到；</li>
<li>查全局执行上下文的词法环境（有<code>test=1</code>）→ 但由于<code>bar</code>的作用域链是“自身块级→bar函数→全局”，运行中会输出<code>1</code>。</li>
</ol>
<h3 data-id="heading-7">三、闭包：函数“背着”变量的专属背包</h3>
<p>闭包是词法作用域的延伸——<strong>外部函数执行后，其内部变量被嵌套函数引用，因此不会被垃圾回收，形成一个“变量背包”供嵌套函数使用</strong>。</p>
<h4 data-id="heading-8">案例：闭包的形成与运行</h4>
<p>对应代码与图示：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客时间'</span>
  <span class="hljs-keyword">let</span> test1 = <span class="hljs-number">1</span>
  <span class="hljs-keyword">const</span> test2 = <span class="hljs-number">2</span>
  <span class="hljs-keyword">var</span> innerBar = {
    <span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(test1) <span class="hljs-comment">// 输出1</span>
      <span class="hljs-keyword">return</span> myName
    },
    <span class="hljs-attr">setName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">newName</span>) {
      myName = newName <span class="hljs-comment">// 修改foo内部的myName</span>
    }
  }
  <span class="hljs-keyword">return</span> innerBar
}

<span class="hljs-keyword">var</span> bar = <span class="hljs-title function_">foo</span>() <span class="hljs-comment">// foo执行上下文出栈</span>
bar.<span class="hljs-title function_">setName</span>(<span class="hljs-string">"极客邦"</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar.<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// 输出1 + “极客邦”</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d6dfb65b1d14d27a779d672f5d06bb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zey5LqRaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765100597&amp;x-signature=Z68WgOIQXKpJuaIranCHAbnuZ5o%3D" alt="5.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de108b98d9564c8e8c0aaf7ff191081a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zey5LqRaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765100597&amp;x-signature=u84cCuLwtZWuleFVc2p7y9XCKaQ%3D" alt="6.jpg" loading="lazy"/></p>
<h5 data-id="heading-9">闭包运行流程：</h5>
<ol>
<li>
<p><strong>foo执行时</strong>：创建执行上下文，变量环境存储<code>myName="极客时间"</code>，词法环境存储<code>test1=1</code>、<code>test2=2</code>，并压入栈；</p>
</li>
<li>
<p><strong>foo返回innerBar后</strong>：foo执行上下文出栈，但<code>getName</code>/<code>setName</code>引用了<code>myName</code>和<code>test1</code>，这两个变量被保留在内存中（形成闭包，即“专属背包”）；</p>
</li>
<li>
<p><strong>调用bar.setName/getName时</strong>：</p>
<ol>
<li><code>setName</code>执行时，通过闭包找到<code>myName</code>并修改为<code>"极客邦"</code>；</li>
<li><code>getName</code>执行时，通过闭包找到<code>test1</code>并输出<code>1</code>，同时返回修改后的<code>myName</code>。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-10">四、核心总结</h3>
<ol>
<li><strong>作用域链是静态的</strong>：由函数声明位置决定，编译阶段固定，和调用顺序无关；</li>
<li><strong>闭包是词法作用域的延伸</strong>：嵌套函数引用外部函数变量，导致外部函数变量不被回收，形成“变量背包”；</li>
<li><strong>底层逻辑的关键</strong>：理解调用栈、执行上下文、作用域的关系，是搞懂JS变量查找和内存管理的基础。</li>
</ol>
<p>JavaScript 的底层运行机制中，词法作用域是基础，它决定了作用域链的静态查找规则，而闭包则是词法作用域的延伸，通过保留自由变量实现了函数对外部作用域的持久访问。理解这些概念，不仅能帮助我们写出更符合 JS 运行逻辑的代码，还能解决实际开发中变量作用域、内存泄漏等常见问题。掌握作用域链与闭包，是深入理解 JavaScript 语言特性的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[el-button源码解读3——:class="buttonKls"与颜色系统的关系]]></title>    <link>https://juejin.cn/post/7577971299743055910</link>    <guid>https://juejin.cn/post/7577971299743055910</guid>    <pubDate>2025-11-30T09:44:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743055910" data-draft-id="7577718777482280998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="el-button源码解读3——:class=&quot;buttonKls&quot;与颜色系统的关系"/> <meta itemprop="keywords" content="SCSS,Element"/> <meta itemprop="datePublished" content="2025-11-30T09:44:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Joie"/> <meta itemprop="url" content="https://juejin.cn/user/3265984436383947"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            el-button源码解读3——:class="buttonKls"与颜色系统的关系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3265984436383947/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Joie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T09:44:10.000Z" title="Sun Nov 30 2025 09:44:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说明 <code>:class="buttonKls"</code> 与颜色系统的关系：</p>
<h3 data-id="heading-0">1. <code>buttonKls</code> 的作用</h3>
<p><code>buttonKls</code> 是一个计算属性，生成按钮需要的所有 CSS 类名：</p>
<pre><code class="hljs language-68:81:packages/components/button/src/button.vue" lang="68:81:packages/components/button/src/button.vue">const buttonKls = computed(() =&gt; [
  // el-button
  ns.b(),
  ns.m(_type.value),
  ns.m(_size.value),
  ns.is('disabled', _disabled.value),
  ns.is('loading', props.loading),
  ns.is('plain', _plain.value),
  ns.is('round', _round.value),
  ns.is('circle', props.circle),
  ns.is('text', _text.value),
  ns.is('link', props.link),
  ns.is('has-bg', props.bg),
])
</code></pre>
<p>假设 <code>type="primary"</code>，<code>buttonKls</code> 可能包含：</p>
<pre><code class="hljs language-js" lang="js">[<span class="hljs-string">'el-button'</span>, <span class="hljs-string">'el-button--primary'</span>, <span class="hljs-string">'el-button--small'</span>, <span class="hljs-string">'is-loading'</span>, ...]
</code></pre>
<h3 data-id="heading-1">2. 颜色系统的触发机制</h3>
<p>颜色系统通过 CSS 类选择器触发。当 <code>buttonKls</code> 包含 <code>'el-button--primary'</code> 时，会匹配到对应的 CSS 规则。</p>
<h3 data-id="heading-2">3. 完整的关系链</h3>
<pre><code class="hljs language-ini" lang="ini">用户使用: &lt;el-button <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&gt;
    ↓
<span class="hljs-attr">props.type</span> = <span class="hljs-string">'primary'</span>
    ↓
<span class="hljs-attr">_type.value</span> = <span class="hljs-string">'primary'</span>
    ↓
<span class="hljs-attr">buttonKls</span> = [<span class="hljs-string">'el-button'</span>, <span class="hljs-string">'el-button--primary'</span>, ...]
    ↓
:<span class="hljs-attr">class</span>=<span class="hljs-string">"buttonKls"</span>  →  class=<span class="hljs-string">"el-button el-button--primary"</span>
    ↓
CSS 匹配: .el-button--primary { ... }
    ↓
button-variant('primary') 生成 CSS 变量
    ↓
应用颜色样式
</code></pre>
<h3 data-id="heading-3">4. 在 CSS 中的对应关系</h3>
<p>看 <code>button.scss</code> 中的定义：</p>
<pre><code class="hljs language-271:275:packages/theme-chalk/src/button.scss" lang="271:275:packages/theme-chalk/src/button.scss">  @each $type in (primary, success, warning, danger, info) {
    @include m($type) {
      @include button-variant($type);
    }
  }
</code></pre>
<p>当 <code>$type = 'primary'</code> 时：</p>
<ul>
<li><code>@include m('primary')</code> → 生成 <code>.el-button--primary</code> 选择器</li>
<li><code>@include button-variant('primary')</code> → 生成颜色相关的 CSS 变量</li>
</ul>
<h3 data-id="heading-4">5. 实际渲染过程</h3>
<h4 data-id="heading-5">步骤 1：Vue 组件生成类名</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;el-button type="primary"&gt;按钮&lt;/el-button&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// buttonKls 计算后</span>
[<span class="hljs-string">'el-button'</span>, <span class="hljs-string">'el-button--primary'</span>]
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 最终渲染 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-button el-button--primary"</span>&gt;</span>
  按钮
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">步骤 2：CSS 匹配类名</h4>
<p>浏览器看到 <code>class="el-button--primary"</code>，匹配到：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// button.scss 中生成的</span>
<span class="hljs-selector-class">.el-button--primary</span> {
  <span class="hljs-comment">// button-variant('primary') 生成的 CSS 变量</span>
  <span class="hljs-attr">--el-button-bg-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
  <span class="hljs-attr">--el-button-border-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
  <span class="hljs-attr">--el-button-text-color</span>: <span class="hljs-built_in">var</span>(--el-color-white);
  <span class="hljs-attr">--el-button-hover-bg-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary-light-<span class="hljs-number">3</span>);
  <span class="hljs-attr">--el-button-active-bg-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary-dark-<span class="hljs-number">2</span>);
}
</code></pre>
<h4 data-id="heading-7">步骤 3：应用颜色</h4>
<p>基础样式使用这些 CSS 变量：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.el-button</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--el-button-bg-color);
  <span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">var</span>(--el-button-border-color);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-button-text-color);
}
</code></pre>
<p>因为 <code>.el-button--primary</code> 定义了这些变量，所以按钮会显示 primary 的颜色。</p>
<h3 data-id="heading-8">6. 关键理解</h3>
<p><code>:class="buttonKls"</code> 是连接 Vue 组件和 CSS 颜色系统的桥梁：</p>
<pre><code class="hljs language-css" lang="css">Vue 组件层面          CSS 样式层面
─────────────────────────────────
buttonKls            <span class="hljs-selector-class">.el-button--primary</span>
  ↓                       ↓
'el-<span class="hljs-selector-tag">button</span><span class="hljs-attr">--primary</span>'  →  匹配 CSS 选择器
  ↓                       ↓
应用类名              应用颜色样式
</code></pre>
<h3 data-id="heading-9">7. 不同类型的关系</h3>



































<table><thead><tr><th>用户传入</th><th>buttonKls 包含</th><th>CSS 匹配</th><th>颜色应用</th></tr></thead><tbody><tr><td><code>type="primary"</code></td><td><code>'el-button--primary'</code></td><td><code>.el-button--primary</code></td><td>蓝色 (#409eff)</td></tr><tr><td><code>type="success"</code></td><td><code>'el-button--success'</code></td><td><code>.el-button--success</code></td><td>绿色 (#67c23a)</td></tr><tr><td><code>type="warning"</code></td><td><code>'el-button--warning'</code></td><td><code>.el-button--warning</code></td><td>橙色 (#e6a23c)</td></tr><tr><td><code>type="danger"</code></td><td><code>'el-button--danger'</code></td><td><code>.el-button--danger</code></td><td>红色 (#f56c6c)</td></tr></tbody></table>
<h3 data-id="heading-10">8. 完整示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;el-button type="primary" size="small" :loading="true"&gt;
  提交
&lt;/el-button&gt;
</code></pre>
<p>生成的类名：</p>
<pre><code class="hljs language-js" lang="js">buttonKls = [
  <span class="hljs-string">'el-button'</span>,           <span class="hljs-comment">// 基础类</span>
  <span class="hljs-string">'el-button--primary'</span>,  <span class="hljs-comment">// 类型类（触发颜色系统）</span>
  <span class="hljs-string">'el-button--small'</span>,    <span class="hljs-comment">// 尺寸类</span>
  <span class="hljs-string">'is-loading'</span>           <span class="hljs-comment">// 状态类</span>
]
</code></pre>
<p>最终 HTML：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-button el-button--primary el-button--small is-loading"</span>&gt;</span>
  提交
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>CSS 匹配：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.el-button--primary</span> {  <span class="hljs-comment">// ← 这个类触发了颜色系统</span>
  <span class="hljs-attr">--el-button-bg-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-11">9. 总结</h3>
<ul>
<li><code>:class="buttonKls"</code> 生成类名（如 <code>el-button--primary</code>）</li>
<li>CSS 通过类选择器匹配这些类名</li>
<li>匹配到的规则通过 <code>button-variant</code> 生成颜色变量</li>
<li>基础样式使用这些变量，最终显示对应颜色</li>
</ul>
<p><strong>核心关系</strong>：<code>buttonKls</code> 中的类型类名（如 <code>el-button--primary</code>）是触发颜色系统的开关，CSS 通过这个类名应用对应的颜色样式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[swift的inout的用法]]></title>    <link>https://juejin.cn/post/7577971299743137830</link>    <guid>https://juejin.cn/post/7577971299743137830</guid>    <pubDate>2025-11-30T10:01:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743137830" data-draft-id="7577971299743105062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="swift的inout的用法"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-30T10:01:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户01026927186"/> <meta itemprop="url" content="https://juejin.cn/user/4469936047271547"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            swift的inout的用法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4469936047271547/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户01026927186
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:01:49.000Z" title="Sun Nov 30 2025 10:01:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>基础用法</strong>、<strong>底层原理</strong>、<strong>高级特性</strong>和<strong>注意事项</strong>四个方面详细讲解。</p>
<h3 data-id="heading-0">1. 基础概念：为什么要用 inout？</h3>
<p>在 Swift 中，函数的参数默认是<strong>常量（Constant/let）</strong> 。这意味着你不能在函数内部修改参数的值。</p>
<p><strong>错误示例：</strong></p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">doubleValue</span>(<span class="hljs-params">value</span>: <span class="hljs-type">Int</span>) {
    value <span class="hljs-operator">*=</span> <span class="hljs-number">2</span> <span class="hljs-comment">// ❌ 报错：Left side of mutating operator isn't mutable: 'value' is a 'let' constant</span>
}
</code></pre>
<p>如果你希望函数能修改外部传进来的变量，就需要使用 <code>inout</code>。</p>
<p><strong>正确示例：</strong></p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">doubleValue</span>(<span class="hljs-params">value</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>) {
    value <span class="hljs-operator">*=</span> <span class="hljs-number">2</span>
}

<span class="hljs-keyword">var</span> myNumber <span class="hljs-operator">=</span> <span class="hljs-number">10</span>
<span class="hljs-comment">// 调用时必须在变量前加 '&amp;' 符号，显式表明这个值会被修改</span>
doubleValue(value: <span class="hljs-operator">&amp;</span>myNumber) 

<span class="hljs-built_in">print</span>(myNumber) <span class="hljs-comment">// 输出：20</span>
</code></pre>
<hr/>
<h3 data-id="heading-1">2. 核心原理：输入输出模型 (Copy-In Copy-Out)</h3>
<p>这是面试或深入理解时最重要的部分。虽然 <code>inout</code> 看起来像“引用传递”，但 Swift 官方将其描述为 <strong>Copy-In Copy-Out（输入复制，输出复制）</strong> ，也就是“值结果模式（Call by Value Result）”。</p>
<p><strong>完整过程如下：</strong></p>
<ol>
<li><strong>Copy In（输入复制）：</strong> 当函数被调用时，参数的值被<strong>复制</strong>一份传入函数内部。</li>
<li><strong>Modification（修改）：</strong> 函数内部修改的是这个<strong>副本</strong>。</li>
<li><strong>Copy Out（输出复制）：</strong> 当函数返回时，修改后的副本值被**赋值（写回）**给原本的变量。</li>
</ol>
<p><strong>底层优化：</strong></p>
<ul>
<li><strong>对于物理内存中的变量</strong>：编译器通常会进行优化，直接传递内存地址（也就是真正的引用传递），避免不必要的复制开销。</li>
<li><strong>对于计算属性（Computed Properties）</strong> ：必须严格执行 Copy-In Copy-Out 流程（因为计算属性没有物理内存地址，只有 getter 和 setter）。</li>
</ul>
<p><strong>代码证明（计算属性也能用 inout）：</strong></p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span> {
    <span class="hljs-keyword">var</span> width <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 计算属性：面积</span>
    <span class="hljs-keyword">var</span> area: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { width <span class="hljs-operator">*</span> height }
        <span class="hljs-keyword">set</span> { 
            <span class="hljs-comment">// 简单逻辑：假设保持 width 不变，调整 height</span>
            height <span class="hljs-operator">=</span> newValue <span class="hljs-operator">/</span> width 
        }
    }
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">triple</span>(<span class="hljs-params">number</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>) {
    number <span class="hljs-operator">*=</span> <span class="hljs-number">3</span>
}

<span class="hljs-keyword">var</span> square <span class="hljs-operator">=</span> <span class="hljs-type">Rect</span>(width: <span class="hljs-number">10</span>, height: <span class="hljs-number">10</span>) <span class="hljs-comment">// area = 100</span>

<span class="hljs-comment">// 这里传入的是计算属性 area</span>
<span class="hljs-comment">// 流程：</span>
<span class="hljs-comment">// 1. 调用 area 的 get，得到 100，Copy In 给 triple</span>
<span class="hljs-comment">// 2. triple 将 100 * 3 = 300</span>
<span class="hljs-comment">// 3. 函数结束，将 300 Copy Out，调用 area 的 set(300)</span>
triple(number: <span class="hljs-operator">&amp;</span>square.area)

<span class="hljs-built_in">print</span>(square.height) <span class="hljs-comment">// 输出：30 (因为 300 / 10 = 30)</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">3. <code>inout</code> 的常见应用场景</h3>
<h4 data-id="heading-3">A. 交换值 (Standard Swap)</h4>
<p>Swift 标准库的 <code>swap</code> 就是用 <code>inout</code> 实现的。</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">mySwap</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">a</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>) {
    <span class="hljs-keyword">let</span> temp <span class="hljs-operator">=</span> a
    a <span class="hljs-operator">=</span> b
    b <span class="hljs-operator">=</span> temp
}

<span class="hljs-keyword">var</span> x <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">var</span> y <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
mySwap(<span class="hljs-operator">&amp;</span>x, <span class="hljs-operator">&amp;</span>y)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"x: (x), y: (y)"</span>) <span class="hljs-comment">// x: 2, y: 1</span>
</code></pre>
<h4 data-id="heading-4">B. 修改复杂的结构体 (Mutating Structs)</h4>
<p>当结构体嵌套很深时，使用 <code>inout</code> 可以避免冗长的赋值代码。</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Color</span> {
    <span class="hljs-keyword">var</span> r: <span class="hljs-type">Int</span>, g: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Settings</span> {
    <span class="hljs-keyword">var</span> themeColor: <span class="hljs-type">Color</span>
}

<span class="hljs-keyword">var</span> appSettings <span class="hljs-operator">=</span> <span class="hljs-type">Settings</span>(themeColor: <span class="hljs-type">Color</span>(r: <span class="hljs-number">0</span>, g: <span class="hljs-number">0</span>, b: <span class="hljs-number">0</span>))

<span class="hljs-comment">// 能够直接修改嵌套深处的属性</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">updateBlueComponent</span>(<span class="hljs-params">color</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Color</span>) {
    color.b <span class="hljs-operator">=</span> <span class="hljs-number">255</span>
}

<span class="hljs-comment">// 传入路径</span>
updateBlueComponent(color: <span class="hljs-operator">&amp;</span>appSettings.themeColor)

<span class="hljs-built_in">print</span>(appSettings.themeColor.b) <span class="hljs-comment">// 255</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">4. 关键规则与内存安全 (Memory Safety)</h3>
<p>这是 Swift 相比 C++ 指针更先进的地方。Swift 编译器会强制执行<strong>独占访问权限（Law of Exclusivity）</strong> ，防止内存冲突。</p>
<h4 data-id="heading-6">规则 1：同一个变量不能同时作为两个 <code>inout</code> 参数传递</h4>
<p>如果两个 <code>inout</code> 参数指向同一个变量，会发生“别名（Aliasing）”问题，导致行为不可预测。</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">var</span> step <span class="hljs-operator">=</span> <span class="hljs-number">1</span>

<span class="hljs-keyword">func</span> <span class="hljs-title function_">increment</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">number</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>, <span class="hljs-params">by</span> <span class="hljs-params">amount</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>) {
    number <span class="hljs-operator">+=</span> amount
}

<span class="hljs-comment">// ❌ 运行时崩溃或编译错误：Simultaneous accesses to 0x...</span>
<span class="hljs-comment">// increment(&amp;step, by: &amp;step) </span>
</code></pre>
<h4 data-id="heading-7">规则 2：不能将 <code>let</code> 常量或字面量作为 <code>inout</code> 参数</h4>
<p>因为它们本质上不可写。</p>
<p>Swift</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">val</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>) {}

<span class="hljs-comment">// change(val: &amp;5) // ❌ 错误：字面量不可变</span>
<span class="hljs-keyword">let</span> num <span class="hljs-operator">=</span> <span class="hljs-number">10</span>
<span class="hljs-comment">// change(val: &amp;num) // ❌ 错误：常量不可变</span>
</code></pre>
<h4 data-id="heading-8">规则 3：inout 参数在闭包中的捕获（Capture）</h4>
<p><code>inout</code> 参数在逃逸闭包（Escaping Closure）中是不能被捕获的，因为逃逸闭包可能在函数返回后才执行，而那时 <code>inout</code> 的生命周期（Copy-In Copy-Out 过程）已经结束了。</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">performAsync</span>(<span class="hljs-params">action</span>: <span class="hljs-keyword">@escaping</span> () -&gt; <span class="hljs-type">Void</span>) {
    <span class="hljs-comment">// 异步执行...</span>
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">badFunction</span>(<span class="hljs-params">x</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Int</span>) {
    <span class="hljs-comment">// ❌ 错误：Escaping closure captures 'inout' parameter 'x'</span>
    <span class="hljs-comment">/*
    performAsync {
        x += 1 
    }
    */</span>
}
</code></pre>
<p><em>解决办法：</em> 使用非逃逸闭包，或者显式地捕获变量的副本（如果逻辑允许）。</p>
<hr/>
<h3 data-id="heading-9">5. <code>inout</code> vs 类 (Reference Types)</h3>
<p>这是一个常见的误区： <strong>“类本来就是引用类型，还需要 <code>inout</code> 吗？”</strong></p>
<ul>
<li><strong>不需要 <code>inout</code>：</strong> 如果你只想修改类实例内部的属性。</li>
<li><strong>需要 <code>inout</code>：</strong> 如果你想<strong>替换</strong>掉整个类实例本身（即改变指针的指向）。</li>
</ul>
<p><strong>代码对比：</strong></p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hero</span> {
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>) { <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name }
}

<span class="hljs-comment">// 情况 1：修改内部属性（不需要 inout）</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">renameHero</span>(<span class="hljs-params">hero</span>: <span class="hljs-type">Hero</span>) {
    hero.name <span class="hljs-operator">=</span> <span class="hljs-string">"Batman"</span> <span class="hljs-comment">// 合法，因为 hero 引用本身没变，变的是堆内存里的数据</span>
}

<span class="hljs-keyword">var</span> h1 <span class="hljs-operator">=</span> <span class="hljs-type">Hero</span>(name: <span class="hljs-string">"Superman"</span>)
renameHero(hero: h1)
<span class="hljs-built_in">print</span>(h1.name) <span class="hljs-comment">// Batman</span>

<span class="hljs-comment">// 情况 2：替换整个实例（需要 inout）</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">switchHero</span>(<span class="hljs-params">hero</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">Hero</span>) {
    hero <span class="hljs-operator">=</span> <span class="hljs-type">Hero</span>(name: <span class="hljs-string">"Iron Man"</span>) <span class="hljs-comment">// 将外部变量指向全新的内存地址</span>
}

<span class="hljs-keyword">var</span> h2 <span class="hljs-operator">=</span> <span class="hljs-type">Hero</span>(name: <span class="hljs-string">"Spiderman"</span>)
switchHero(hero: <span class="hljs-operator">&amp;</span>h2)
<span class="hljs-built_in">print</span>(h2.name) <span class="hljs-comment">// Iron Man</span>
</code></pre>
<h3 data-id="heading-10">总结</h3>
<ol>
<li><strong>语法：</strong> 定义用 <code>inout</code>，调用用 <code>&amp;</code>。</li>
<li><strong>本质：</strong> Copy-In Copy-Out（值结果模式），但在物理内存操作上通常优化为引用传递。</li>
<li><strong>使用场景：</strong> 需要在函数内部修改外部值类型（Struct/Enum）状态，或交换数据。</li>
<li><strong>限制：</strong> 遵守独占访问原则（Exclusivity），不可在逃逸闭包中捕获。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript新手必看系列之预编译]]></title>    <link>https://juejin.cn/post/7577737385955262474</link>    <guid>https://juejin.cn/post/7577737385955262474</guid>    <pubDate>2025-11-30T10:14:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385955262474" data-draft-id="7577718777482117158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript新手必看系列之预编译"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-30T10:14:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="甜味弥漫"/> <meta itemprop="url" content="https://juejin.cn/user/3335233742615115"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript新手必看系列之预编译
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3335233742615115/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    甜味弥漫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:14:54.000Z" title="Sun Nov 30 2025 10:14:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">前言</h5>
<p>预编译是JavaScript的核心概念，也是新手向中级进阶的必经之路。理解它，意味着你能：</p>
<ul>
<li>彻底搞懂变量提升</li>
<li>理解函数声明的“特权”</li>
<li>避免常见的作用域陷阱</li>
</ul>
<p>本文用最简单的语言和示例，带你快速掌握全局预编译与函数预编译的完整过程。</p>
<h5 data-id="heading-1">What's that?</h5>
<p>简单说，JS在执行代码前会进行“准备工作” ——
预编译。在这个阶段JS的V8引擎会进行<em>变量声明，函数声明</em>的提升</p>
<h2 data-id="heading-2">预编译的两种场景</h2>
<h3 data-id="heading-3">1. 全局作用域下的预编译</h3>
<p>分三步：</p>
<p>1.创建
GO（Global Object）</p>
<ul>
<li>
<p>在浏览器中就是
window
对象</p>
</li>
<li>
<p>在
Node.js
中就是
global
对象</p>
</li>
</ul>
<p>2.找到变量声明，作为作为GO属性名，值为undefined</p>
<ol start="3">
<li>
<p>找到函数声明，作为GO属性名，值为函数体</p>
</li>
</ol>
<p>举个简单的例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// undefined</span>
<span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 1</span>

</code></pre>
<p>发什么了什么？</p>
<ol>
<li>创建 GO ={}</li>
<li>找到变量声明 var  a  ,GO = { a : undefined }</li>
<li>找函数声明，没有函数声明就不找</li>
</ol>
<p>执行过程如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//预编译后就相当于：</span>
<span class="hljs-keyword">var</span> a = <span class="hljs-literal">undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">//输出 undefined</span>
  a = <span class="hljs-number">1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">//输出 1</span>
</code></pre>
<h3 data-id="heading-4">2.函数作用域下的预编译</h3>
<p>函数较为复杂，四步：</p>
<ol>
<li>
<p>创建AO（Activation Object）</p>
</li>
<li>
<p>找形参和变量声明，作为AO属性名，值为 undefined</p>
</li>
<li>
<p>将实参赋给形参</p>
</li>
<li>
<p>找函数声明，作为AO 属性名，值为函数体</p>
</li>
</ol>
<p>举例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">123</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">a</span>(<span class="hljs-params"/>) {}
  <span class="hljs-keyword">var</span> b = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b);
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">c</span>(<span class="hljs-params"/>) {}
  <span class="hljs-keyword">var</span> c = a
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c);
}
<span class="hljs-title function_">fn</span>(<span class="hljs-number">1</span>)
</code></pre>
<p>干了什么？</p>
<ol>
<li>创建AO = {</li>
</ol>
<p>2.找形参和变量声明，作为AO属性名，值为 undefined</p>
<p>AO = { a : undefined<br/>
b : undefined<br/>
c : undefined }</p>
<p>3.将实参赋给形参</p>
<p>AO = { a : 1
b : undefined<br/>
c : undefined
}</p>
<p>4.找函数声明，作为AO 属性名，值为函数体</p>
<p>AO = { a : function a() {}</p>
<p>b : undefined<br/>
c : function c() {}
}</p>
<p>函数体内执行过程：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 预编译后的状态：</span>
<span class="hljs-keyword">var</span> c
<span class="hljs-keyword">var</span> b
<span class="hljs-keyword">var</span> a
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// function a() {}</span>
 a = <span class="hljs-number">123</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// 123</span>
b = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b);  <span class="hljs-comment">//function b() {}</span>
c = a
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c); <span class="hljs-comment">//123</span>

</code></pre>
<p>掌握了预编译，你就真正理解了 JavaScript 的执行机制，这对后续学习闭包、作用域链等概念至关重要！</p>
<p>希望这篇文章能帮助你彻底理解 JavaScript 预编译，如果有任何疑问，欢迎在评论区讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Weapp-2 /Lesson19(2025-11-04)】微信小程序“博客园”项目深度解析：从架构到细节的完整剖析📱]]></title>    <link>https://juejin.cn/post/7577681092137992227</link>    <guid>https://juejin.cn/post/7577681092137992227</guid>    <pubDate>2025-11-29T16:37:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577681092137992227" data-draft-id="7577625663257706496" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Weapp-2 /Lesson19(2025-11-04)】微信小程序“博客园”项目深度解析：从架构到细节的完整剖析📱"/> <meta itemprop="keywords" content="微信小程序,微信,程序员"/> <meta itemprop="datePublished" content="2025-11-29T16:37:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Weapp-2 /Lesson19(2025-11-04)】微信小程序“博客园”项目深度解析：从架构到细节的完整剖析📱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T16:37:20.000Z" title="Sat Nov 29 2025 16:37:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>📱在当今移动互联网时代，微信小程序凭借其轻量、即用即走、无需安装等优势，成为众多开发者构建内容型应用的首选平台。本文将深入剖析一个名为 <strong>“博客园”</strong> 的微信小程序项目，全面解读其 <strong>项目结构、核心逻辑、页面设计、数据驱动机制、UI 组件使用、配置体系</strong> 以及 <strong>开发最佳实践</strong>，并结合项目中涉及的图片资源（如 <code>tb11.png</code>、<code>tb12.png</code> 等）进行系统性阐述。无论你是初学者还是有经验的开发者，都能从中获得宝贵的知识。</p>
<hr/>
<h2 data-id="heading-0">🧱 一、项目整体架构与配置体系</h2>
<h3 data-id="heading-1">1.1 全局配置文件：<code>app.json</code></h3>
<p>项目的灵魂始于 <code>app.json</code>。该文件定义了整个小程序的 <strong>页面路由、窗口样式、组件引用、sitemap 配置</strong> 等全局行为：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"pages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"pages/index/index"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pages/logs/logs"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pages/theme/theme"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pages/search/search"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pages/articles/articles"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"backgroundColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#49b849"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"navigationBarTextStyle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"white"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"navigationBarTitleText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"博客园"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"navigationBarBackgroundColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#49b849"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"v2"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"componentFramework"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"glass-easel"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sitemapLocation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sitemap.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lazyCodeLoading"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"requiredComponents"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"usingComponents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"van-button"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vant/weapp/button"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"van-search"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vant/weapp/search"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><strong><code>pages</code></strong>：声明了所有页面路径，<strong>首页必须放在第一位</strong>。</li>
<li><strong><code>window</code></strong>：统一设置导航栏背景色为绿色（<code>#49b849</code>），文字白色，标题为“博客园”，形成品牌识别。</li>
<li><strong><code>style: "v2"</code></strong>：启用新版组件样式，提升视觉一致性。</li>
<li><strong><code>componentFramework: "glass-easel"</code></strong>：使用微信新一代自研组件框架，性能更优。</li>
<li><strong><code>usingComponents</code></strong>：全局注册了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvant-contrib.gitee.io%2Fvant-weapp%2F" target="_blank" title="https://vant-contrib.gitee.io/vant-weapp/" ref="nofollow noopener noreferrer">Vant WeUI</a> 的 <code>van-button</code> 和 <code>van-search</code>，这是官方推荐的 UI 库，提供高质量、可定制的移动端组件。</li>
</ul>
<blockquote>
<p>💡 <strong>小知识</strong>：Vant WeUI 是有赞团队维护的开源组件库，专为微信小程序优化，支持按需引入，极大提升开发效率。</p>
</blockquote>
<p>此外，根据 <code>readme.md</code> 补充说明：</p>
<ul>
<li><strong>appName navigation</strong>：<code>app.json</code> 中通过 <code>window.navigationBarTitleText</code> 设置应用名称“博客园”，实现顶部导航栏标题展示。</li>
<li><strong>tabBar</strong>：虽然当前 <code>app.json</code> 中未显式配置 <code>tabBar</code>，但项目中存在 <code>images/tb11.png</code>、<code>tb12.png</code>、<code>tb21.png</code>、<code>tb22.png</code> 等图标资源，极可能为未来底部 TabBar 图标预留。标准 <code>tabBar</code> 配置应包含 <code>list</code> 数组，每个项指定 <code>pagePath</code>、<code>text</code> 和 <code>iconPath</code>/<code>selectedIconPath</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-2">1.2 全局逻辑入口：<code>app.js</code></h3>
<p><code>app.js</code> 是小程序的 <strong>App 实例</strong>，负责全局生命周期管理与数据共享：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">App</span>({
  <span class="hljs-title function_">onLaunch</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 记录启动日志</span>
    <span class="hljs-keyword">const</span> logs = wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'logs'</span>) || [];
    logs.<span class="hljs-title function_">unshift</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());
    wx.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'logs'</span>, logs);

    <span class="hljs-comment">// 触发微信登录</span>
    wx.<span class="hljs-title function_">login</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-comment">// 可将 res.code 发送至后端换取 openId 等</span>
      }
    });
  },
  <span class="hljs-attr">globalData</span>: {
    <span class="hljs-attr">userInfo</span>: <span class="hljs-literal">null</span>
  }
})
</code></pre>
<ul>
<li><strong><code>onLaunch</code></strong>：小程序初始化时执行一次，用于：
<ul>
<li>将当前时间戳存入本地缓存 <code>logs</code>，供 <code>logs</code> 页面展示。</li>
<li>调用 <code>wx.login()</code> 获取临时登录凭证 <code>code</code>，这是实现用户身份认证的第一步。</li>
</ul>
</li>
<li><strong><code>globalData</code></strong>：全局数据对象，可在任意页面通过 <code>getApp().globalData</code> 访问，常用于存储用户信息、配置等。</li>
</ul>
<p>根据 <code>readme.md</code> 补充：</p>
<ul>
<li><strong>app 应用的概念</strong>：小程序以 <code>App({})</code> 作为全局唯一实例，贯穿整个应用生命周期。</li>
<li><strong>app.json 全局都会使用的组件</strong>：通过 <code>usingComponents</code> 注册的组件（如 <code>van-button</code>、<code>van-search</code>）可在所有页面直接使用，无需重复引入。</li>
<li><strong>app.wxss</strong>：全局样式文件，定义的样式将作用于所有页面（除非被局部样式覆盖）。</li>
<li><strong>app.js</strong>：除生命周期外，还可定义全局方法、网络请求封装等。</li>
</ul>
<hr/>
<h3 data-id="heading-3">1.3 Sitemap 与隐私配置</h3>
<ul>
<li><strong><code>sitemap.json</code></strong>：控制页面是否允许被微信索引。本项目配置为 <code>"action": "allow", "page": "*"</code>，即所有页面均可被搜索。</li>
<li><strong><code>project.config.json</code> 与 <code>project.private.config.json</code></strong>：前者是团队共享配置（如基础库版本 <code>libVersion: "3.11.1"</code>），后者是开发者私有配置（如项目名 <code>blog</code>、热重载开启等），避免污染 Git 提交。</li>
</ul>
<hr/>
<h2 data-id="heading-4">🖼️ 二、首页设计：<code>index.js</code> 与数据驱动 UI</h2>
<p>首页 (<code>pages/index/index</code>) 是用户进入后的第一印象，其核心在于 <strong>菜单导航 + 广告轮播</strong>。</p>
<h3 data-id="heading-5">2.1 数据结构</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">data</span>: {
  <span class="hljs-attr">menus</span>: [
    { <span class="hljs-attr">typeName</span>: <span class="hljs-string">'有声读物'</span>, <span class="hljs-attr">typePic</span>: <span class="hljs-string">'https://m.360buyimg.com/...png'</span> },
    { <span class="hljs-attr">typeName</span>: <span class="hljs-string">'名文赏析'</span>, <span class="hljs-attr">typePic</span>: <span class="hljs-string">'https://p3-passport.byteacctimg.com/...awebp'</span> },
    <span class="hljs-comment">// ... 共8个分类</span>
  ],
  <span class="hljs-attr">advertPics</span>: [
    <span class="hljs-string">'https://img.huxiucdn.com/article/cover/202403/08/...webp'</span>,
    <span class="hljs-string">'https://img.huxiucdn.com/article/cover/202511/03/...webp'</span>
  ]
}
</code></pre>
<ul>
<li><strong><code>menus</code></strong>：8 个内容分类，每个包含名称和图标 URL。注意：除“有声读物”外，其余图标均使用同一张头像图（可能是占位图）。</li>
<li><strong><code>advertPics</code></strong>：2 张广告横幅图，来自虎嗅网 CDN，采用 WebP 格式以优化加载速度。</li>
</ul>
<blockquote>
<p>📌 <strong>图片资源补充</strong>：项目中还包含本地图片 <code>images/tb11.png</code>、<code>tb12.png</code>、<code>tb21.png</code>、<code>tb22.png</code>。这些很可能是 <strong>TabBar 图标</strong>（尽管当前 <code>app.json</code> 未配置 TabBar），或用于其他页面装饰。若未来扩展底部导航，可在此处引用。</p>
</blockquote>
<p>根据 <code>readme.md</code> 补充：</p>
<ul>
<li><strong>advertPics</strong>：明确指出这是“赚钱来源 广告”，即通过展示第三方广告位实现商业化变现，是内容类小程序的重要收入渠道。</li>
</ul>
<h3 data-id="heading-6">2.2 事件处理：跳转搜索页</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">toSearch</span>(<span class="hljs-params"/>) {
  wx.<span class="hljs-title function_">navigateTo</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/search/search'</span> })
}
</code></pre>
<ul>
<li>使用 <code>wx.navigateTo</code> 实现页面跳转，符合小程序路由规范。</li>
<li>注意：路径应为相对路径，但更推荐使用 <code>/pages/search/search</code>（绝对路径）避免嵌套问题。</li>
</ul>
<p>根据 <code>readme.md</code> 补充：</p>
<ul>
<li><strong>weapp 事件</strong>：小程序不使用 HTML 的 <code>onclick</code>，而是采用 <code>bindtap</code> 绑定点击事件。</li>
<li><strong>js 文件就是一个 Page 实例</strong>：每个页面的 <code>.js</code> 文件通过 <code>Page({})</code> 定义，其中：
<ul>
<li><code>data</code> 存放页面数据；</li>
<li>事件处理函数（如 <code>toSearch</code>）直接作为 <code>Page</code> 配置项传入即可。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">2.3 WXML 模板逻辑（基于 <code>readme.md</code>）</h3>
<p>根据 <code>readme.md</code> 描述：</p>
<ul>
<li>使用 <code>wx:for="{{menus}}"</code> 循环渲染菜单项。</li>
<li>每项通过 <code>{{item.typeName}}</code> 显示文字（曾因遗漏此绑定导致“只有图片没有字”的 bug）。</li>
<li><code>&lt;image src="{{item.typePic}}" /&gt;</code> 显示图标。</li>
<li>使用 <code>rpx</code> 单位实现响应式布局（设计稿以 iPhone 6/7/8 的 750rpx 为基准）。</li>
<li>广告图可能使用 <code>&lt;swiper&gt;</code> 组件实现自动轮播。</li>
<li><strong>block 是一个可以接收指令的标签，不会在DOM中出现</strong>：例如 <code>&lt;block wx:for="{{menus}}" wx:key="*this"&gt;</code> 用于包裹循环内容，自身不生成节点。</li>
<li><strong>wx:key</strong>：为列表项提供唯一标识，提升渲染性能，可设为 <code>wx:key="*this"</code>（当 item 为字符串或数字）或指定字段如 <code>wx:key="id"</code>。</li>
</ul>
<blockquote>
<p>🔍 <strong>Debug 过程记录</strong>（来自 <code>readme.md</code>）：</p>
<ul>
<li>确保 <code>van-search</code> 正确注册：<code>"van-search": "@vant/weapp/search"</code></li>
<li>修复“只有图片没有字”问题：补全 <code>{{item.typeName}}</code> 数据绑定</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-8">📝 三、日志页面：<code>logs.js</code> 与工具函数复用</h2>
<p><code>logs</code> 页面用于展示小程序的启动历史，体现了 <strong>本地存储 + 工具函数</strong> 的典型用法。</p>
<h3 data-id="heading-9">3.1 工具函数：<code>util.js</code></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">formatTime</span> = date =&gt; {
  <span class="hljs-keyword">const</span> year = date.<span class="hljs-title function_">getFullYear</span>()
  <span class="hljs-keyword">const</span> month = date.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>
  <span class="hljs-keyword">const</span> day = date.<span class="hljs-title function_">getDate</span>()
  <span class="hljs-comment">// ...格式化为 "YYYY/MM/DD HH:mm:ss"</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${[year, month, day].map(formatNumber).join(<span class="hljs-string">'/'</span>)}</span> <span class="hljs-subst">${[hour, minute, second].map(formatNumber).join(<span class="hljs-string">':'</span>)}</span>`</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatNumber</span> = n =&gt; {
  n = n.<span class="hljs-title function_">toString</span>()
  <span class="hljs-keyword">return</span> n[<span class="hljs-number">1</span>] ? n : <span class="hljs-string">`0<span class="hljs-subst">${n}</span>`</span> <span class="hljs-comment">// 补零</span>
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { formatTime }
</code></pre>
<ul>
<li>该模块导出 <code>formatTime</code> 函数，用于将时间戳转换为可读字符串。</li>
<li><code>formatNumber</code> 确保月份、日期等小于10时补前导零（如 <code>5</code> → <code>05</code>）。</li>
</ul>
<h3 data-id="heading-10">3.2 日志页面逻辑</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// logs.js</span>
<span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../utils/util.js'</span>)
<span class="hljs-title class_">Page</span>({
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">logs</span>: [] },
  <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({
      <span class="hljs-attr">logs</span>: (wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'logs'</span>) || []).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">log</span> =&gt;</span> ({
        <span class="hljs-attr">date</span>: util.<span class="hljs-title function_">formatTime</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(log)),
        <span class="hljs-attr">timeStamp</span>: log
      }))
    })
  }
})
</code></pre>
<ul>
<li>从本地缓存读取 <code>logs</code> 数组（由 <code>app.js</code> 写入）。</li>
<li>使用 <code>map</code> 将每个时间戳转换为 <code>{ date, timeStamp }</code> 对象，便于 WXML 渲染。</li>
</ul>
<hr/>
<h2 data-id="heading-11">🔍 四、功能页面：Search、Theme、Articles</h2>
<p>其余页面（<code>search</code>、<code>theme</code>、<code>articles</code>）目前均为 <strong>骨架页面</strong>，仅包含标准生命周期函数：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Page</span>({
  <span class="hljs-attr">data</span>: { },
  <span class="hljs-title function_">onLoad</span>(<span class="hljs-params">options</span>) { },
  <span class="hljs-title function_">onReady</span>(<span class="hljs-params"/>) { },
  <span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) { },
  <span class="hljs-comment">// ... 其他生命周期</span>
})
</code></pre>
<p>这表明项目处于 <strong>早期开发阶段</strong>，核心功能尚未实现。但结构已预留：</p>
<ul>
<li><strong><code>search</code></strong>：将集成 <code>van-search</code> 组件（已在 <code>app.json</code> 注册），用于内容检索。</li>
<li><strong><code>theme</code></strong>：可能用于主题分类浏览（对应首页 <code>menus</code> 中的“名文赏析”等）。</li>
<li><strong><code>articles</code></strong>：文章详情页，展示具体内容。</li>
</ul>
<blockquote>
<p>⚙️ <strong>未来扩展建议</strong>：</p>
<ul>
<li>在 <code>search.js</code> 中监听 <code>bind:search</code> 事件，调用 API 获取结果。</li>
<li>在 <code>articles.js</code> 中通过 <code>options.id</code> 获取文章 ID，拉取详情。</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-12">🎨 五、UI 与交互细节</h2>
<h3 data-id="heading-13">5.1 响应式单位：rpx</h3>
<ul>
<li>小程序独创单位 <code>rpx</code>（responsive pixel），<strong>以屏幕宽度 750rpx 为基准</strong>。</li>
<li>无论设备分辨率如何，<code>750rpx = 100% 屏幕宽度</code>，自动适配 iPhone、安卓等机型。</li>
<li>开发者应 <strong>避免使用 px</strong>，全部使用 rpx 或百分比。</li>
<li>设计师的移动端设计稿通常基于 iPhone 6/7/8（750px 宽），因此 1px = 1rpx，换算直观。</li>
</ul>
<p>根据 <code>readme.md</code> 强调：</p>
<blockquote>
<p>“不要用px，用rpx”<br/>
“宽度是 750rpx iphone 标准设备的单位（iphone678）”<br/>
“如何等比例，由小程序自己去做”</p>
</blockquote>
<h3 data-id="heading-14">5.2 数据驱动视图</h3>
<ul>
<li>所有页面数据定义在 <code>Page({ data: {} })</code> 中。</li>
<li>WXML 通过 <code>{{ }}</code> 绑定数据，如 <code>{{menus}}</code>、<code>{{advertPics}}</code>。</li>
<li>修改数据必须调用 <code>this.setData({ key: value })</code>，触发视图更新。</li>
</ul>
<p>根据 <code>readme.md</code> 补充：</p>
<ul>
<li><strong>数据驱动界面</strong>：<code>js</code> 中 <code>Page({ data: {...} })</code> 定义数据，WXML 用 <code>{{}}</code> 绑定。</li>
<li><strong>block wx:for</strong>：循环输出时，默认每一项变量名为 <code>item</code>，可通过 <code>wx:for-item="customName"</code> 修改。</li>
</ul>
<h3 data-id="heading-15">5.3 导航与标签</h3>
<ul>
<li>使用 <code>&lt;navigator url="/pages/search/search"&gt;</code> 实现页面跳转。</li>
<li><strong><code>&lt;/navigator&gt;</code></strong>：标签闭合，支持高亮状态（若配合 tabBar）。</li>
<li><strong><code>&lt;/block&gt;</code></strong>：如前所述，<code>&lt;block&gt;</code> 仅为逻辑容器，最终 <strong>不会在页面显示</strong>，是“牺牲了”的辅助标签。</li>
</ul>
<hr/>
<h2 data-id="heading-16">📦 六、依赖管理与构建</h2>
<h3 data-id="heading-17">6.1 包管理：<code>package.json</code></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vant/weapp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.11.7"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>通过 npm 安装 Vant WeUI，版本锁定在 <code>1.11.7</code>。</li>
<li>构建时需在微信开发者工具中点击 <strong>“构建 npm”</strong>，将依赖复制到 <code>miniprogram_npm</code> 目录。</li>
</ul>
<h3 data-id="heading-18">6.2 构建配置</h3>
<ul>
<li><code>project.config.json</code> 启用 <code>es6</code>、<code>postcss</code>、<code>minified</code> 等，确保代码压缩与兼容性。</li>
<li><code>disableSWC: true</code> 表示不使用 SWC 编译器，可能因兼容性考虑。</li>
</ul>
<hr/>
<h2 data-id="heading-19">🧩 七、总结与展望</h2>
<p>“博客园”小程序虽功能尚简，但已具备 <strong>完整的项目骨架、清晰的架构分层、规范的编码风格</strong>。其亮点包括：</p>
<p>✅ 使用 Vant WeUI 提升 UI 质量<br/>
✅ 严格遵循数据驱动开发模式<br/>
✅ 合理利用本地存储记录日志<br/>
✅ 响应式布局适配多端<br/>
✅ 模块化工具函数复用</p>
<p><strong>未来可扩展方向</strong>：</p>
<ul>
<li>实现搜索功能，对接后端 API。</li>
<li>丰富 <code>articles</code> 页面，支持富文本、音频播放（配合“有声读物”）。</li>
<li>添加用户收藏、评论等互动功能。</li>
<li>引入云开发（CloudBase）简化后端逻辑。</li>
</ul>
<hr/>
<h2 data-id="heading-20">🌟 结语</h2>
<p>微信小程序开发不仅是技术实现，更是对 <strong>用户体验、性能优化、工程规范</strong> 的综合考验。“博客园”项目为我们提供了一个绝佳的学习范本——从一行 <code>app.json</code> 配置，到一个 <code>formatTime</code> 工具函数，再到首页的菜单与广告，无不体现着小程序开发的精髓。希望本文能助你在小程序开发之路上，走得更稳、更远！🚀</p>
<blockquote>
<p>📎 <strong>附：项目资源清单</strong></p>
<ul>
<li>图片：<code>tb11.png</code>, <code>tb12.png</code>, <code>tb21.png</code>, <code>tb22.png</code>（位于 <code>images/</code>）</li>
<li>核心页面：<code>index</code>, <code>logs</code>, <code>search</code>, <code>theme</code>, <code>articles</code></li>
<li>全局依赖：<code>@vant/weapp</code>, <code>util.js</code></li>
<li>配置文件：<code>app.json</code>, <code>project.config.json</code>, <code>sitemap.json</code></li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌸 入职写了一个月全栈next.js 感想]]></title>    <link>https://juejin.cn/post/7577713754562838580</link>    <guid>https://juejin.cn/post/7577713754562838580</guid>    <pubDate>2025-11-29T18:54:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577713754562838580" data-draft-id="7577681092138024995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌸 入职写了一个月全栈next.js 感想"/> <meta itemprop="keywords" content="前端,后端,AI编程"/> <meta itemprop="datePublished" content="2025-11-29T18:54:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小佘ovo"/> <meta itemprop="url" content="https://juejin.cn/user/4248168663101239"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌸 入职写了一个月全栈next.js 感想
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248168663101239/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小佘ovo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T18:54:34.000Z" title="Sat Nov 29 2025 18:54:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景介绍</h2>
<ul>
<li>
<p>最近组内要做0-1的新ai产品, 招我进来就是负责这个ai产品,启动的时候这个季度就剩下两个月了,天天开会对齐进度,一个月就已经把基础版本给做完了,想要接入到现有的业务上面,时间方面就特别紧张,技术选型怎么说呢, leader用ai写了一个版本 我们在现有的代码进行二次开发这样, 全栈next.js 要学习的东西太多了 又没有前端基础,没有ai coding很难完成任务(十几分钟干完我一天的工作 claude4.5效果还不错 进度推的特别快), 自从trae下架了claude,后面就一直cursor claude 4.5了。</p>
<ul>
<li>nextjs+ts+tailwindcss+shadcn ui现在是mvp套餐，startup在梭哈，时间就是生产力哪需要那么多差异化样式直接一把，有的💰才开始做细节，你会发现慢慢也💩化了。</li>
<li>Nextjs 是全栈框架 可以很快把一个MVP从零到一完整跑起来。 你要是抬杠说什么高并发负载均衡啥的，你的用户数量真多到需要考虑性能的时候，你已经不需要自己考虑了(小红书看到的一段话 挺符合场景的)</li>
<li>next.js 写后端 确实比较轻量 只能做一些curd的操作 socket之类的不太合适 其他api 还是随便开发 给我的感受就是前端能够直接操作db，前后端仓库可以不分离，业务逻辑还是一定要分离的 看看开源的next.js 项目的架构设计结构是怎么样的 学习/模仿/改造。</li>
<li>语言只是工具，适合最重要，技术没有银弹</li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2F" target="_blank" title="https://nextjs.org/" ref="nofollow noopener noreferrer">nextjs.org/</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js" target="_blank" title="https://github.com/vercel/next.js" ref="nofollow noopener noreferrer">github.com/vercel/next…</a>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dde542c9ddf42a693b2bd0500de3bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=7Cgg7lmdzgbPgkwSo5dK9xSO%2FUI%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-1">项目的时间线</h2>
<blockquote>
<p>项目从启动到这周 大概是5周的时间</p>
</blockquote>
<ul>
<li>10/28-10/31 Week 1
<ul>
<li>项目初始化/需求讨论/设计文档/</li>
<li>后端next.js, typescript技术熟悉 项目运行/调试</li>
<li>基础框架搭建 设计表结构ddl, 集成mysql, 编写crud接口阶段</li>
</ul>
</li>
<li>11/03-11/07 Week 2
<ul>
<li>产品PRD 提供</li>
<li>xxxx等表设计</li>
</ul>
</li>
<li>11/10-11/14 Week 3
<ul>
<li>xxxxx 基本功能完结</li>
<li>@xxxx 讲解项目结构/规范</li>
</ul>
</li>
<li>11/17-11/21 Week 4
<ul>
<li>首页样式/逻辑 优化</li>
<li>集成统一登录调研</li>
<li>部署完成</li>
</ul>
</li>
<li>11/24-11/28 Week 5
<ul>
<li>服务推理使用Authorization鉴权 对内接口使用Cookies (access_token) 鉴权 开发</li>
<li>xxxx 表设计表设计 逻辑开发</li>
<li>xxx设计 设计开发</li>
<li>联调xxxx</li>
</ul>
</li>
</ul>
<blockquote>
<p>5周时间 功能基本完成了 剩下的就是部署到线上 进行场景实践了</p>
</blockquote>
<h2 data-id="heading-2">前端技术栈</h2>
<ul>
<li><strong>Next.js 14</strong>：选择 App Router 架构，支持服务端渲染和 API Routes</li>
<li><strong>TypeScript 5.4</strong>：强类型语言提升代码质量和可维护性</li>
<li><strong>React 18</strong>：利用并发特性和 Suspense 提升用户体验</li>
<li><strong>Zustand</strong>：轻量级状态管理，替代 Redux 降低复杂度</li>
<li><strong>Ant Design + Radix UI</strong>：组件库组合，平衡美观性和可访问性</li>
</ul>
<h3 data-id="heading-3">React + TypeScript  <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">react.dev/</a></h3>
<ul>
<li>优势：类型安全：TypeScript 提供编译时类型检查，减少运行时错误 ✅ <strong>组件化开发</strong>：高度可复用的组件设计  ✅ <strong>生态成熟</strong>：丰富的第三方库和工具链 ✅ <strong>开发体验</strong>：优秀的 IDE 支持和调试工具</li>
<li><strong>劣势：</strong> ❌ <strong>学习曲线</strong>：TypeScript 对新手有一定门槛 ❌ <strong>编译时间</strong>：大型项目编译可能较慢 ❌ <strong>配置复杂</strong>：类型定义需要额外维护</li>
</ul>
<h3 data-id="heading-4">UI 组件方案 Ant Design + Radix UI 混合方案</h3>
<ul>
<li>
<p><strong>优势：</strong>  ✅ <strong>快速开发</strong>：Ant Design 提供完整的企业级组件  ✅ <strong>无障碍性</strong>：Radix UI 提供符合 WAI-ARIA 标准的组件 ✅ <strong>定制灵活</strong>：Radix UI 无样式组件便于自定义 ✅ <strong>中文支持</strong>：Ant Design 对中文界面友好</p>
</li>
<li>
<p><strong>劣势：</strong> ❌ <strong>包体积大</strong>：两个 UI 库增加了打包体积 ❌ <strong>样式冲突</strong>：需要注意两个库的样式隔离❌ <strong>维护成本</strong>：需要同时维护两套组件系统</p>
</li>
</ul>
<h3 data-id="heading-5">Tailwind CSS</h3>
<ul>
<li><strong>优势：</strong> ✅ <strong>开发效率高</strong>：原子化类名，快速构建 UI ✅ <strong>体积优化</strong>：生产环境自动清除未使用的样式 ✅ <strong>一致性</strong>：设计系统内置，确保视觉一致 ✅ <strong>响应式</strong>：便捷的响应式设计工具</li>
<li><strong>劣势：</strong> ❌ <strong>类名冗长</strong>：HTML 可能变得难以阅读 ❌ <strong>学习成本</strong>：需要记忆大量类名 ❌ <strong>非语义化</strong>：类名不直观反映元素意义</li>
</ul>
<h3 data-id="heading-6">ant design x</h3>
<h3 data-id="heading-7">ahooks</h3>
<h2 data-id="heading-8">后端技术栈</h2>
<ul>
<li><strong>Prisma 6.18</strong>：现代化 ORM，类型安全且支持 Migration</li>
<li><strong>MySQL</strong>：成熟的关系型数据库，满足复杂查询需求</li>
<li><strong>Redis (ioredis)</strong> ：高性能缓存，支持多种数据结构</li>
<li><strong>Winston</strong>：企业级日志系统，支持日志轮转和结构化输出</li>
<li><strong>Zod</strong>：运行时类型验证，保障 API 数据安全</li>
</ul>
<h3 data-id="heading-9">Next.js API Routes</h3>
<ul>
<li>
<p><strong>优势：</strong> ✅ <strong>统一代码库</strong>：前后端在同一项目中 ✅ <strong>类型共享</strong>：TypeScript 类型可在前后端复用 ✅ <strong>开发效率</strong>：无需配置跨域、代理等 ✅ <strong>部署简单</strong>：单一应用部署</p>
</li>
<li>
<p><strong>劣势：</strong> ❌ <strong>扩展性限制</strong>：无法独立扩展后端服务 ❌ <strong>性能瓶颈</strong>：Node.js 单线程可能成为瓶颈 ❌ <strong>微服务困难</strong>：不适合复杂的微服务架构</p>
</li>
</ul>
<h3 data-id="heading-10">Prisma ORM</h3>
<ul>
<li>
<p><strong>优势：</strong> ✅ <strong>类型安全</strong>：自动生成 TypeScript 类型 ✅ <strong>迁移管理</strong>：声明式 schema，易于版本控制 ✅ <strong>查询性能</strong>：生成优化的 SQL 查询 ✅ <strong>关系处理</strong>：直观的关系查询 API ✅ <strong>多数据库支持</strong>：支持 MySQL、PostgreSQL、SQLite 等</p>
</li>
<li>
<p><strong>劣势：</strong> ❌ <strong>复杂查询</strong>：某些复杂 SQL 可能需要原始查询 ❌ <strong>生成代码体积</strong>：生成的 client 文件较大 ❌ <strong>版本升级</strong>：大版本升级可能需要迁移</p>
</li>
</ul>
<h2 data-id="heading-11">踩坑记录</h2>
<blockquote>
<p>主要是记录一些开发过程中踩坑 和设计问题</p>
</blockquote>
<ul>
<li>node js 项目 jean部署</li>
<li>自定义配置/dockerfile配置 没有类似项目参考 健康检查问题 加上环境变量配置多环境 一步一步</li>
<li>next.js 中 用middleware进行接口拦截鉴权 里面有prisma path import 直接出现了Edge Runtime 异常 自定义auth 解决</li>
<li>npm build 项目 踩坑</li>
<li>静态渲染流程 动态api 警告 强制动态渲染</li>
<li>其他组件 document 不支持build问题</li>
<li>保存多场景模式+构建版本管理第一版考虑的太少了，发现有问题 后面又重构了一版本</li>
<li>xxx日志目前还没有接入 要不就是日志文件 要不就是console.log 目前看日志的方式是去容器化运行日志看了 后续集群部署就比较麻烦了</li>
<li>ant design 版本降低到6.0以下 ant-design x 用不了2.0.0 的一些对话组件</li>
</ul>
<h2 data-id="heading-12">Next.js实践的项目记录</h2>
<h3 data-id="heading-13">苏州 trae friends线下黑客松 📒</h3>
<ul>
<li>去Trae pro-Solo模式 苏州线下hackathon一趟, 基本都是一些独立开发者，一人一公司，三个小时做出一个产品用Trae-solo coder模式，不得不说trae内部集成的vercel部署很丝滑 react项目一键deploy访问 完全不用关系域名服务器, solo模式其实就是混合多种model使用进行输出 想要的效果还是得不断的调试 thiking太长，对于前后端分离项目 也能够同时关联进行思考规划。</li>
<li>1点多到4点 coding时间 从0-1生成项目 使用trae pro solo模式 就3个小时 做不了什么大的东西 那就做个日语50音的网站呗 现场酒店的网基本用不了 我数据也很卡 用的旁边干中学老师的热点 用next.js tailwindcss ant design deepseek搭建的网页 够用了 最后vercel部署 trae自带集成 挺方便的 solo模式还是太慢了 接受不了 网站地址是 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftraekanastudio1ssw.vercel.app%2F" target="_blank" title="https://traekanastudio1ssw.vercel.app/" ref="nofollow noopener noreferrer">traekanastudio1ssw.vercel.app/</a> 功能就是假名+ai生成例句和单词 我都没有路演 最后拿优秀奖可能是我部署了吧 大部分人没部署 优秀奖就是卫衣了 蹭了一天的饭加零食 爽吃</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaohongshu.com%2Fexplore%2F692140b0000000001e02aac9%3Fxsec_token%3DABIsSxCtiWqecBNz1tI65rHCL4Hb0gSD5uSDb3r--JEYE%3D%26xsec_source%3Dpc_user" target="_blank" title="https://www.xiaohongshu.com/explore/692140b0000000001e02aac9?xsec_token=ABIsSxCtiWqecBNz1tI65rHCL4Hb0gSD5uSDb3r--JEYE=&amp;xsec_source=pc_user" ref="nofollow noopener noreferrer">www.xiaohongshu.com/explore/692…</a> 小红书当时发的帖子 可以领奖品</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae7da702365441b6b261931832baa2c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=h3Xl35fLbnBriZ3Rf2h6y5NWw1Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">Typescript的AI方向 langchain/langgraph支持ts</h3>
<ul>
<li>最近在看的ts的ai框架 发现langchain 是支持ts的, langchain-chat 主要是使用langchain+langgraph 对ts进行实践 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftraechat-apps4y6.vercel.app%2F" target="_blank" title="https://traechat-apps4y6.vercel.app/" ref="nofollow noopener noreferrer">traechat-apps4y6.vercel.app/</a></li>
<li>部署还踩坑了 MCP 在 Vercel 上不生效是因为 Vercel 是 serverless 环境，不支持运行持久的子进程。让我帮你解决这个问题：</li>
<li>主要是对最近项目组内要用的到mcp/function call 进行实践操作 使用modelscope  上面开源的mcp进行尝试 使用vercel进行部署。</li>
<li>最近看到小红书上面的3d 粒子 圣诞树有点火呀，自己也尝试下 效果很差 自己弄的提示词 可以去看看帖子上的提示词去试试 他们都是gemini pro 3玩的 我也去弄个gemini pro 3 账号去玩玩。</li>
<li>还有一个3d粒子 跟着音乐动的的效果 下面的提示词可以试试</li>
</ul>

<pre><code class="hljs">帮我构建一个极简科幻风格的 3D 音乐可视化网页。
视觉上参考 SpaceX 的冷峻美学，全黑背景，去装饰化。核心是一个由数千个悬浮粒子组成的‘生命体’，它必须能与声音建立物理连接：低音要像心脏搏动一样冲击屏幕，高音要像电流一样瞬间穿过点阵。
重点实现一种‘ACID 流体’视觉引擎：让粒子表面的颜色不再是静态的，而是像两种粘稠的荧光液体一样，在失重环境下互相吞噬、搅拌、流动，且流速由音乐能量驱动。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e839115371d0452597429c65e265264a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=jxul0TLPQk5AmtuhNm59Y7p43Rc%3D" alt="c88886c4c8c3a180a2dba52f17125dc1.jpg" loading="lazy"/></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Foverview" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/overview" ref="nofollow noopener noreferrer">docs.langchain.com/oss/javascr…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.ai%2Fhome" target="_blank" title="https://www.modelscope.ai/home" ref="nofollow noopener noreferrer">www.modelscope.ai/home</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com" target="_blank" title="https://vercel.com" ref="nofollow noopener noreferrer">vercel.com</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.ai%2Fmcp" target="_blank" title="https://www.modelscope.ai/mcp" ref="nofollow noopener noreferrer">www.modelscope.ai/mcp</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8ed2abc86db450a9d07c65e70ac59d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=1Lsp%2BkwdR%2FBGUjVx99JvnxDnxDQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dbb7162415d450d929b2bb37d2d88c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=8AO3OnEtfs9pIc7y2aawjr0%2BIJ0%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ai方向 总结</p>
</blockquote>
<ul>
<li>a2a解决的是agent之间如何配合工作的问题 agent card定义名片 名称 版本 能力 语言 格式 task委托书 通信方式http 用户 客户端是主控 接受用户需求 制定具体任务 向服务器发出需求 任务分发 接受响应 服务器是各类部署好的agent 遵循一套结构化模式</li>
<li>mcp 解决的llm自主调用功能和工具问题</li>
<li>mcp 是解决 function call 协议的碎片化问题，多 agent 主要是为了做上下文隔离</li>
<li>比如说手机有一个system agent 然后各个app有一个agent，用户语音输入买咖啡，然后system agent调用瑞幸agent 这样就是非侵入式 让app暴露系统a2a接口，感觉比mcp要更合理一点，不是单纯让app暴露tools，系统agent只需要做路由</li>
<li>而且有一点我觉得挺有意思的，就是自己的agent花的token是自己的钱，如果自己的agent找别人的agent，让它执行任务啥的，花的不就是别人的钱……</li>
<li>Dify：更像宜家的模块化家具，提供可视化工作流、预置模板，甚至支持“拖拽式”编排AI能力。比如，你想做一
个智能客服，只需在界面里连接对话模型、知识库和反馈按钮，无需写一行代码</li>
</ul>
<blockquote>
<p>python 和ts 在ai上面的比较</p>
</blockquote>
<ul>
<li>Python 依然是 AI 训练和科研的王者，PyTorch、TensorFlow、scikit-learn 这些生态太厚实了，训练大模型你离不开它。</li>
<li>TS 在底层 AI 能力上还没那么能打，GPU 加速、模型优化这些，暂时还得靠 Python 打底。</li>
<li>Python 搞理论和模型，TypeScript卷体验和交付</li>
</ul>
<h2 data-id="heading-15">个人学习记录</h2>
<blockquote>
<p>主要还是前端和ai方面的知识点学习的比较多吧</p>
</blockquote>
<ul>
<li>Typescript 语法基础+进阶 / Next.js 开发指南/React 开发指南</li>
<li>ahooks 组件 使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fahooks.js.org%2Fzh-CN%2Fhooks%2Fuse-request%2Fpolling" target="_blank" title="https://ahooks.js.org/zh-CN/hooks/use-request/polling" ref="nofollow noopener noreferrer">ahooks.js.org/zh-CN/hooks…</a></li>
<li>ant design x 使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fant-design-x.antgroup.com%2Fcomponents%2Fbubble-cn" target="_blank" title="https://ant-design-x.antgroup.com/components/bubble-cn" ref="nofollow noopener noreferrer">ant-design-x.antgroup.com/components/…</a></li>
<li>prisma orm框架 +mysql <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fprisma%2Fprisma" target="_blank" title="https://github.com/prisma/prisma" ref="nofollow noopener noreferrer">github.com/prisma/pris…</a></li>
<li>dotenv 读取配置文件 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotenvx%2Fdotenvx" target="_blank" title="https://github.com/dotenvx/dotenvx" ref="nofollow noopener noreferrer">github.com/dotenvx/dot…</a></li>
<li>fastmcp 项目构建使用 原理</li>
<li>Agent2Agent google协议内部详情
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMarkTechStation%2FVideoCode" target="_blank" title="https://github.com/MarkTechStation/VideoCode" ref="nofollow noopener noreferrer">github.com/MarkTechSta…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fa2aproject%2Fa2a-samples" target="_blank" title="https://github.com/a2aproject/a2a-samples" ref="nofollow noopener noreferrer">github.com/a2aproject/…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fa2a-protocol.org%2Flatest%2Ftopics%2Fwhat-is-a2a%2F" target="_blank" title="https://a2a-protocol.org/latest/topics/what-is-a2a/" ref="nofollow noopener noreferrer">a2a-protocol.org/latest/topi…</a></li>
</ul>
</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fswagger.io%2Fspecification%2F" target="_blank" title="https://swagger.io/specification/" ref="nofollow noopener noreferrer">swagger.io/specificati…</a> OpenAPI 规范 一个 OpenAPI 描述（OAD）可以由一个 JSON 或 YAML 文档组成</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyossi-lee%2Fswagger2mcp" target="_blank" title="https://github.com/yossi-lee/swagger2mcp" ref="nofollow noopener noreferrer">github.com/yossi-lee/s…</a> 根据Swagger3规范，一键将Web服务转换为MCP</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsonrpc.org%2Fspecification" target="_blank" title="https://www.jsonrpc.org/specification" ref="nofollow noopener noreferrer">www.jsonrpc.org/specificati…</a> JSON-RPC 是一种无状态、轻量级的远程过程调用（RPC）协议</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagno-agi%2Fagno" target="_blank" title="https://github.com/agno-agi/agno" ref="nofollow noopener noreferrer">github.com/agno-agi/ag…</a> 多智能体框架</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Froadmap.sh%2Fai-engineer" target="_blank" title="https://roadmap.sh/ai-engineer" ref="nofollow noopener noreferrer">roadmap.sh/ai-engineer</a> ai工程师的roadmap 很全</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FChromeDevTools%2Fchrome-devtools-mcp" target="_blank" title="https://github.com/ChromeDevTools/chrome-devtools-mcp" ref="nofollow noopener noreferrer">github.com/ChromeDevTo…</a> *可以集成到cursorz中 *AI 能够直接控制和调试真实的 Chrome 浏览器</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nano-banana.ai%2F" target="_blank" title="https://www.nano-banana.ai/" ref="nofollow noopener noreferrer">www.nano-banana.ai/</a> Nano Banana Pro (V2) 文生图 图生图</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Faistudio.google.com%2Fprompts%2Fnew_chat" target="_blank" title="https://aistudio.google.com/prompts/new_chat" ref="nofollow noopener noreferrer">aistudio.google.com/prompts/new…</a> gemini ai studio</li>
</ul>
<h2 data-id="heading-16">Vibe Coding</h2>
<ul>
<li>先叠甲, 我没有前端的开发经验，第一次写前端项目，项目里面90%的前端代码都是ai 生成的，能够让你一个不会前端的同学也快速完成mvp版本/需求任务。我虽然很推ai coding 很喜欢用, 即时反馈带来的成就感, 但是对于生成的代码是不是屎山 大概率可能是了, 因为前期 AI速度快，制造屎山的速度更快。无论架构设计多优秀，也难避免屎山代码的宿命: 需求一直在变，你的架构设计是针对老的需求，随着新的需求增加，老的架构慢慢的就无法满足了，需要重构。</li>
<li>一起开发的前端同事都说ai生成那些样式互相影响了,样式有tailwindcss 有自定义的css 每个模块又有不同 大概率出问题 有冲突，就是💩山。</li>
<li>最大的开发障碍就是内心的偏见 不愿意放弃现在所擅长的东西 带着这份偏见不愿意去学习</li>
</ul>
<blockquote>
<p>对于ai coding 的话 用过trae-pro/cursor/qoder/copilot/codex等等 最终还是cursor claude 4.5用的最舒服</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71c30fea330043c4a291547f8ff9dfc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=UoyJIjQBm9ZywGR%2B6GdULHJqMYE%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>基本一周一个cursor pro账号 买号都花了快1k了。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d68721de0bb48fbb926c083f7dedffa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=i82I4V73%2FzcY%2F9fUVDWkROkkoUQ%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>You have used up your included usage and are on pay-as-you-go which is charged based on model API rates. You have spent $0.00 in on-demand usage this month.</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b561345afbb542ddbcde7f9ae8ece668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=SMvJOhy7zUjk1C4h579qk5SFGRc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aad3de8a17c4669aa231c381f68ed6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=8YLEjui%2B3KsoS%2FvCx%2FaSq9MSK5k%3D" alt="9e0f1cde2dbc3314e44150d1e544c77a.png" loading="lazy"/></p>
<ul>
<li>
<p>最后就是需要学好英语 前端的技术文档都是英文的 虽然有中文的翻译版本, 但没有自己直接去看官方的强 难免有差异， 我现在都是用插件进行web翻译去看的 很累。</p>
</li>
<li>
<p>现在时间是凌晨 11/30/02:36 喝了两瓶酒。这个周末我要重温甜甜的恋爱 给我也来一颗药丸 给时间是时间 让过去过去, 年底想去日本跨年了</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd8f264133fb4ab09665ffb9a709498d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=IJb04IeU3l8VZBT61xrT8yj8pYo%3D" alt="image.png" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a61964a922e4b74844195da04af80ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5L2Yb3Zv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765047726&amp;x-signature=bQaS5qW6TYvCSgLAK%2F8YnjJospY%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Visual Studio 开发环境配置指南]]></title>    <link>https://juejin.cn/post/7577683422878564386</link>    <guid>https://juejin.cn/post/7577683422878564386</guid>    <pubDate>2025-11-30T04:57:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577683422878564386" data-draft-id="7577713754563280948" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Visual Studio 开发环境配置指南"/> <meta itemprop="keywords" content="C++,OpenGL"/> <meta itemprop="datePublished" content="2025-11-30T04:57:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小陈要努力"/> <meta itemprop="url" content="https://juejin.cn/user/3540880374375006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Visual Studio 开发环境配置指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3540880374375006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小陈要努力
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T04:57:28.000Z" title="Sun Nov 30 2025 04:57:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🎯 Visual Studio 开发环境配置指南</h2>
<p>本文档将介绍如何在 Visual Studio 中配置 <strong>GLEW / GLFW / GLAD / OpenGL</strong> 等开发环境，包括：</p>
<ul>
<li>配置包含目录（Include Directories）</li>
<li>配置库目录（Library Directories）</li>
<li>配置源文件目录（用于 GLAD）</li>
<li>添加链接器附加依赖项</li>
<li>复制运行所需的 DLL 文件</li>
</ul>
<hr/>
<h3 data-id="heading-1">🖥 环境需求</h3>
<ul>
<li><strong>Visual Studio 2022</strong></li>
<li><strong>Windows 11（或 Windows 10）</strong></li>
</ul>
<hr/>
<h3 data-id="heading-2">📂 依赖库目录结构示例</h3>
<blockquote>
<p>下图为项目中 dependence 文件夹的结构示例。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3ba55c50eed484c99f0ba35a28f75b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZmI6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765083842&amp;x-signature=Bk0O8bDdbQmrU4P9A9lH1TPvFc4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">1️⃣ 配置包含目录（Include Directories）</h3>
<p>打开 Visual Studio：</p>
<blockquote>
<p>右键项目 → <strong>属性</strong> → <strong>VC++ 目录</strong> → <strong>包含目录</strong>
（快捷方式：选中项目后按 <strong>Alt + Enter</strong>）</p>
</blockquote>
<p>添加以下路径：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-variable">$(SolutionDir)</span>dependence\GLEW\<span class="hljs-keyword">include</span>
<span class="hljs-variable">$(SolutionDir)</span>dependence\GLFW\<span class="hljs-keyword">include</span>
<span class="hljs-variable">$(SolutionDir)</span>dependence\GLAD\<span class="hljs-keyword">include</span>
</code></pre>
<h3 data-id="heading-4"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd3d84bdd7e64f7682c6a3d785958149~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZmI6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765083842&amp;x-signature=I0c2abzBg5EXPt1EeAOYbBOWNPE%3D" alt="在这里插入图片描述" loading="lazy"/></h3>
<h3 data-id="heading-5">2️⃣ 配置库目录（Library Directories）</h3>
<p>路径：</p>
<blockquote>
<p>右键项目 → <strong>属性</strong> → <strong>VC++ 目录</strong> → <strong>库目录</strong></p>
</blockquote>
<p>添加：</p>
<pre><code class="hljs language-javascript" lang="javascript">$(<span class="hljs-title class_">SolutionDir</span>)dependence\<span class="hljs-variable constant_">GLEW</span>\lib\<span class="hljs-title class_">Release</span>\x64
$(<span class="hljs-title class_">SolutionDir</span>)dependence\<span class="hljs-variable constant_">GLFW</span>\lib-vc2022
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b3e9952e5d748a693d97e629326b781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZmI6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765083842&amp;x-signature=2xS5un%2F2RV1S0M3oe6P%2FlFuufK8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>⚠ <strong>注意：GLEW 的 lib 文件需要与你 VS 项目的平台匹配</strong></p>
<ul>
<li>
<p>如果 VS 设置为 <strong>x64</strong>，需要使用：</p>
<pre><code class="hljs language-sql" lang="sql">GLEW\lib\<span class="hljs-keyword">Release</span>\x64\
</code></pre>
</li>
<li>
<p>如果 VS 设置为 <strong>Win32（x86）</strong>，需要使用：</p>
<pre><code class="hljs language-sql" lang="sql">GLEW\lib\<span class="hljs-keyword">Release</span>\Win32\
</code></pre>
</li>
</ul>
<p>查看方式：
VS 顶部 → <code>Debug | x64</code>（这里即为 x64）</p>
<hr/>
<h3 data-id="heading-6">3️⃣ 配置源文件目录（GLAD 专用）</h3>
<p>GLAD 的实现代码在 <code>src/</code> 目录中，因此需要加入源目录，否则 GLAD 无法编译。</p>
<p>路径：</p>
<blockquote>
<p>右键项目 → <strong>属性</strong> → <strong>VC++ 目录</strong> → <strong>源文件目录</strong></p>
</blockquote>
<p>添加：</p>
<pre><code class="hljs language-scss" lang="scss">$(SolutionDir)dependence\GLAD\<span class="hljs-attribute">src</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec53a4a68669434ab9cdcc9fde1fd082~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZmI6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765083842&amp;x-signature=96A6ujjTVlph0giDVheYm17l8Jc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-7">4️⃣ 添加附加依赖项（Linker → Input）</h3>
<p>路径：</p>
<blockquote>
<p>项目 → <strong>属性</strong> → <strong>链接器</strong> → <strong>输入</strong></p>
</blockquote>
<p>在“附加依赖项”添加：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">glfw3.<span class="hljs-keyword">lib</span>
opengl32.<span class="hljs-keyword">lib</span>
glew32.<span class="hljs-keyword">lib</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0475bf371db4cb6b49da835de5d1b74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZmI6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765083842&amp;x-signature=bSdY6yNrj8k28kqXe8kmuJVV6kg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-8">5️⃣ 复制运行所需 DLL 文件（非常重要）</h3>
<p>在运行时，必须将以下 DLL 复制到：</p>
<pre><code class="hljs language-javascript" lang="javascript">$(<span class="hljs-title class_">ProjectDir</span>)x64\<span class="hljs-title class_">Debug</span>\
或
$(<span class="hljs-title class_">ProjectDir</span>)x64\<span class="hljs-title class_">Release</span>\
</code></pre>
<p>具体复制文件如下：</p>
<pre><code class="hljs language-javascript" lang="javascript">$(<span class="hljs-title class_">SolutionDir</span>)dependence\<span class="hljs-variable constant_">GLEW</span>\bin\<span class="hljs-title class_">Release</span>\x64\glew32.<span class="hljs-property">dll</span>
$(<span class="hljs-title class_">SolutionDir</span>)dependence\<span class="hljs-variable constant_">GLFW</span>\lib-vc2022\glfw3.<span class="hljs-property">dll</span>（如果 <span class="hljs-variable constant_">GLFW</span> 使用动态版本）
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e02e793ad7740548692add0de1cb99a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZmI6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765083842&amp;x-signature=6s9jkRkrVuM%2B31ZnU11LSzcz8ak%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>📌 <strong>注意：放到 Debug / Release 哪一个文件夹，取决于你要运行哪种模式。</strong></p>
<hr/>
<h2 data-id="heading-9">🎉 配置完成！</h2>
<p>现在你已经成功在 Visual Studio 中配置好 GLEW + GLFW + GLAD + OpenGL 环境，可以开始编写 OpenGL 程序了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java方法详解：提升代码复用性与可读性的利器]]></title>    <link>https://juejin.cn/post/7577969462860120127</link>    <guid>https://juejin.cn/post/7577969462860120127</guid>    <pubDate>2025-11-30T07:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577969462860120127" data-draft-id="7577970969395052585" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java方法详解：提升代码复用性与可读性的利器"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-30T07:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java方法详解：提升代码复用性与可读性的利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T07:15:17.000Z" title="Sun Nov 30 2025 07:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>方法（Method）是一段用来完成特定功能的代码块，类似于数学中的函数。它可以把复杂的代码组织成独立的单元，让程序更加模块化、易于维护</p>
<h2 data-id="heading-0">方法的语法</h2>
<pre><code class="hljs language-Java" lang="Java">[访问修饰符] [<span class="hljs-keyword">static</span>] 返回值类型 方法名(参数列表) {
    <span class="hljs-comment">// 方法体</span>
    <span class="hljs-keyword">return</span> 返回值; <span class="hljs-comment">// 如果返回值类型不是void</span>
}
</code></pre>
<p><strong>各部分解释：</strong></p>
<ul>
<li><strong>访问修饰符</strong>：控制方法的访问权限（如public、private）</li>
<li><strong>static</strong>：表示方法是静态的（可选）</li>
<li><strong>返回值类型</strong>：方法执行后返回的数据类型</li>
<li><strong>方法名</strong>：方法的名称，要符合命名规范</li>
<li><strong>参数列表</strong>：方法接收的输入参数</li>
<li><strong>方法体</strong>：方法的具体实现代码</li>
</ul>
<h2 data-id="heading-1">代码示例</h2>
<h3 data-id="heading-2">示例1：无返回值的方法</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodDemo1</span> {
    
    <span class="hljs-comment">// 定义一个无返回值的方法：打印欢迎信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printWelcome</span><span class="hljs-params">(String name)</span> {
        System.out.println(<span class="hljs-string">"=== 欢迎使用学生管理系统 ==="</span>);
        System.out.println(<span class="hljs-string">"欢迎，"</span> + name + <span class="hljs-string">"！"</span>);
        System.out.println(<span class="hljs-string">"========================="</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 调用方法</span>
        printWelcome(<span class="hljs-string">"张三"</span>);
        printWelcome(<span class="hljs-string">"李四"</span>);
    }
}
</code></pre>
<h4 data-id="heading-3">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 欢迎使用学生管理系统 ===
欢迎，张三！
=========================
=== 欢迎使用学生管理系统 ===
欢迎，李四！
=========================
</code></pre>
<h3 data-id="heading-4">示例2：有返回值的方法</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodDemo2</span> {
    
    <span class="hljs-comment">// 计算两个数的最大值</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMax</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">if</span> (a &gt; b) {
            <span class="hljs-keyword">return</span> a;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> b;
        }
    }
    
    <span class="hljs-comment">// 计算学生平均分</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculateAverage</span><span class="hljs-params">(<span class="hljs-type">int</span> score1, <span class="hljs-type">int</span> score2, <span class="hljs-type">int</span> score3)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> score1 + score2 + score3;
        <span class="hljs-type">double</span> <span class="hljs-variable">average</span> <span class="hljs-operator">=</span> sum / <span class="hljs-number">3.0</span>;
        <span class="hljs-keyword">return</span> average;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 调用getMax方法</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> getMax(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
        System.out.println(<span class="hljs-string">"最大值："</span> + max);
        
        <span class="hljs-comment">// 调用calculateAverage方法</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">avg</span> <span class="hljs-operator">=</span> calculateAverage(<span class="hljs-number">85</span>, <span class="hljs-number">90</span>, <span class="hljs-number">78</span>);
        System.out.println(<span class="hljs-string">"平均分："</span> + avg);
        
        <span class="hljs-comment">// 可以重复使用</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">avg2</span> <span class="hljs-operator">=</span> calculateAverage(<span class="hljs-number">92</span>, <span class="hljs-number">88</span>, <span class="hljs-number">95</span>);
        System.out.println(<span class="hljs-string">"第二个学生平均分："</span> + avg2);
    }
}
</code></pre>
<h4 data-id="heading-5">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">最大值：<span class="hljs-number">20</span>
平均分：<span class="hljs-number">84.33333333333333</span>
第二个学生平均分：<span class="hljs-number">91.66666666666667</span>
</code></pre>
<h3 data-id="heading-6">示例3：完整的学生成绩管理示例</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentManager</span> {
    
    <span class="hljs-comment">// 计算平均分</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculateAverage</span><span class="hljs-params">(<span class="hljs-type">int</span>[] scores)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> score : scores) {
            sum += score;
        }
        <span class="hljs-keyword">return</span> (<span class="hljs-type">double</span>) sum / scores.length;
    }
    
    <span class="hljs-comment">// 判断成绩等级</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getGradeLevel</span><span class="hljs-params">(<span class="hljs-type">double</span> average)</span> {
        <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">90</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"优秀"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">80</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"良好"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">70</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"中等"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (average &gt;= <span class="hljs-number">60</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"及格"</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"不及格"</span>;
        }
    }
    
    <span class="hljs-comment">// 显示学生信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayStudentInfo</span><span class="hljs-params">(String name, <span class="hljs-type">int</span>[] scores, 
                                         <span class="hljs-type">double</span> average, String level)</span> {
        System.out.println(<span class="hljs-string">"\n=== 学生成绩报告 ==="</span>);
        System.out.println(<span class="hljs-string">"姓名："</span> + name);
        System.out.print(<span class="hljs-string">"各科成绩："</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> score : scores) {
            System.out.print(score + <span class="hljs-string">" "</span>);
        }
        System.out.println(<span class="hljs-string">"\n平均分："</span> + String.format(<span class="hljs-string">"%.2f"</span>, average));
        System.out.println(<span class="hljs-string">"等级："</span> + level);
        System.out.println(<span class="hljs-string">"==================="</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 学生1的信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"张三"</span>;
        <span class="hljs-type">int</span>[] scores1 = {<span class="hljs-number">85</span>, <span class="hljs-number">90</span>, <span class="hljs-number">78</span>, <span class="hljs-number">92</span>, <span class="hljs-number">88</span>};
        
        <span class="hljs-comment">// 学生2的信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> <span class="hljs-string">"李四"</span>;
        <span class="hljs-type">int</span>[] scores2 = {<span class="hljs-number">95</span>, <span class="hljs-number">98</span>, <span class="hljs-number">92</span>, <span class="hljs-number">96</span>, <span class="hljs-number">90</span>};
        
        <span class="hljs-comment">// 处理第一个学生</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">avg1</span> <span class="hljs-operator">=</span> calculateAverage(scores1);
        <span class="hljs-type">String</span> <span class="hljs-variable">level1</span> <span class="hljs-operator">=</span> getGradeLevel(avg1);
        displayStudentInfo(student1, scores1, avg1, level1);
        
        <span class="hljs-comment">// 处理第二个学生</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">avg2</span> <span class="hljs-operator">=</span> calculateAverage(scores2);
        <span class="hljs-type">String</span> <span class="hljs-variable">level2</span> <span class="hljs-operator">=</span> getGradeLevel(avg2);
        displayStudentInfo(student2, scores2, avg2, level2);
    }
}
</code></pre>
<h4 data-id="heading-7">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 学生成绩报告 ===
姓名：张三
各科成绩：<span class="hljs-number">85</span> <span class="hljs-number">90</span> <span class="hljs-number">78</span> <span class="hljs-number">92</span> <span class="hljs-number">88</span> 
平均分：<span class="hljs-number">86.60</span>
等级：良好
===================

=== 学生成绩报告 ===
姓名：李四
各科成绩：<span class="hljs-number">95</span> <span class="hljs-number">98</span> <span class="hljs-number">92</span> <span class="hljs-number">96</span> <span class="hljs-number">90</span> 
平均分：<span class="hljs-number">94.20</span>
等级：优秀
===================
</code></pre>
<h2 data-id="heading-8">总结</h2>
<p><strong>最重要的知识点：方法的核心价值在于代码复用和逻辑封装</strong></p>
<ul>
<li><strong>代码复用</strong>：一次编写，多次调用，避免重复代码</li>
<li><strong>逻辑封装</strong>：将复杂功能拆分成小方法，提高可读性和可维护性</li>
<li><strong>模块化设计</strong>：每个方法专注完成一个特定任务</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java运算符完全指南：让代码学会“计算”和“判断”]]></title>    <link>https://juejin.cn/post/7577969462860218431</link>    <guid>https://juejin.cn/post/7577969462860218431</guid>    <pubDate>2025-11-30T07:26:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577969462860218431" data-draft-id="7577797563853864996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java运算符完全指南：让代码学会“计算”和“判断”"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-30T07:26:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java运算符完全指南：让代码学会“计算”和“判断”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T07:26:00.000Z" title="Sun Nov 30 2025 07:26:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"♥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"⇲ ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>运算符是用来对变量和值进行各种操作的符号。比如我们熟悉的加减乘除（+、-、*、/）就是运算符</p>
<h2 data-id="heading-0">运算符分类及代码示例</h2>
<h3 data-id="heading-1">1. 算术运算符：进行数学计算</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArithmeticOperators</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
        
        System.out.println(<span class="hljs-string">"=== 算术运算符示例 ==="</span>);
        System.out.println(<span class="hljs-string">"a = "</span> + a + <span class="hljs-string">", b = "</span> + b);
        System.out.println(<span class="hljs-string">"加法 a + b = "</span> + (a + b));      <span class="hljs-comment">// 19</span>
        System.out.println(<span class="hljs-string">"减法 a - b = "</span> + (a - b));      <span class="hljs-comment">// 11</span>
        System.out.println(<span class="hljs-string">"乘法 a * b = "</span> + (a * b));      <span class="hljs-comment">// 60</span>
        System.out.println(<span class="hljs-string">"除法 a / b = "</span> + (a / b));      <span class="hljs-comment">// 3（整数除法）</span>
        System.out.println(<span class="hljs-string">"取余 a % b = "</span> + (a % b));      <span class="hljs-comment">// 3（15÷4=3余3）</span>
        
        <span class="hljs-comment">// 浮点数除法</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">15.0</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">4.0</span>;
        System.out.println(<span class="hljs-string">"浮点除法 x / y = "</span> + (x / y));  <span class="hljs-comment">// 3.75</span>
        
        <span class="hljs-comment">// 自增自减</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        System.out.println(<span class="hljs-string">"初始count = "</span> + count);
        count++;  <span class="hljs-comment">// 相当于 count = count + 1</span>
        System.out.println(<span class="hljs-string">"count++后 = "</span> + count);  <span class="hljs-comment">// 6</span>
        count--;  <span class="hljs-comment">// 相当于 count = count - 1</span>
        System.out.println(<span class="hljs-string">"count--后 = "</span> + count);  <span class="hljs-comment">// 5</span>
    }
}
</code></pre>
<h4 data-id="heading-2">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 算术运算符示例 ===
a = <span class="hljs-number">15</span>, b = <span class="hljs-number">4</span>
加法 a + b = <span class="hljs-number">19</span>
减法 a - b = <span class="hljs-number">11</span>
乘法 a * b = <span class="hljs-number">60</span>
除法 a / b = <span class="hljs-number">3</span>
取余 a % b = <span class="hljs-number">3</span>
浮点除法 x / y = <span class="hljs-number">3.75</span>
初始count = <span class="hljs-number">5</span>
count++后 = <span class="hljs-number">6</span>
count--后 = <span class="hljs-number">5</span>
</code></pre>
<h3 data-id="heading-3">2. 关系运算符：进行比较判断</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RelationalOperators</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">score1</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">score2</span> <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">passingScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;
        
        System.out.println(<span class="hljs-string">"=== 关系运算符示例 ==="</span>);
        System.out.println(<span class="hljs-string">"score1 = "</span> + score1 + <span class="hljs-string">", score2 = "</span> + score2);
        System.out.println(<span class="hljs-string">"score1 &gt; score2: "</span> + (score1 &gt; score2));      <span class="hljs-comment">// false</span>
        System.out.println(<span class="hljs-string">"score1 &lt; score2: "</span> + (score1 &lt; score2));      <span class="hljs-comment">// true</span>
        System.out.println(<span class="hljs-string">"score1 &gt;= passingScore: "</span> + (score1 &gt;= passingScore)); <span class="hljs-comment">// true</span>
        System.out.println(<span class="hljs-string">"score2 &lt;= 100: "</span> + (score2 &lt;= <span class="hljs-number">100</span>));          <span class="hljs-comment">// true</span>
        System.out.println(<span class="hljs-string">"score1 == 85: "</span> + (score1 == <span class="hljs-number">85</span>));            <span class="hljs-comment">// true</span>
        System.out.println(<span class="hljs-string">"score1 != score2: "</span> + (score1 != score2));    <span class="hljs-comment">// true</span>
        
        <span class="hljs-comment">// 实际应用：判断成绩是否及格</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">myScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">75</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isPass</span> <span class="hljs-operator">=</span> myScore &gt;= passingScore;
        System.out.println(<span class="hljs-string">"成绩"</span> + myScore + <span class="hljs-string">"分是否及格: "</span> + isPass);
    }
}
</code></pre>
<h4 data-id="heading-4">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 关系运算符示例 ===
score1 = <span class="hljs-number">85</span>, score2 = <span class="hljs-number">90</span>
score1 &gt; score2: <span class="hljs-literal">false</span>
score1 &lt; score2: <span class="hljs-literal">true</span>
score1 &gt;= passingScore: <span class="hljs-literal">true</span>
score2 &lt;= <span class="hljs-number">100</span>: <span class="hljs-literal">true</span>
score1 == <span class="hljs-number">85</span>: <span class="hljs-literal">true</span>
score1 != score2: <span class="hljs-literal">true</span>
成绩<span class="hljs-number">75</span>分是否及格: <span class="hljs-literal">true</span>
</code></pre>
<h3 data-id="heading-5">3. 逻辑运算符：组合多个条件</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogicalOperators</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isStudent</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasIDCard</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">balance</span> <span class="hljs-operator">=</span> <span class="hljs-number">150.0</span>;
        
        System.out.println(<span class="hljs-string">"=== 逻辑运算符示例 ==="</span>);
        
        <span class="hljs-comment">// &amp;&amp;（与）：两个条件都满足</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">canBorrowBook</span> <span class="hljs-operator">=</span> isStudent &amp;&amp; hasIDCard;
        System.out.println(<span class="hljs-string">"可以借书（是学生且有证件）: "</span> + canBorrowBook);
        
        <span class="hljs-comment">// ||（或）：至少满足一个条件</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">canWatchMovie</span> <span class="hljs-operator">=</span> (age &gt;= <span class="hljs-number">18</span>) || (age &lt; <span class="hljs-number">18</span> &amp;&amp; balance &gt; <span class="hljs-number">100</span>);
        System.out.println(<span class="hljs-string">"可以看电影（年满18岁或有钱的未成年人）: "</span> + canWatchMovie);
        
        <span class="hljs-comment">// !（非）：取反</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isNotStudent</span> <span class="hljs-operator">=</span> !isStudent;
        System.out.println(<span class="hljs-string">"不是学生: "</span> + isNotStudent);
        
        <span class="hljs-comment">// 复杂条件：学生优惠条件</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">studentDiscount</span> <span class="hljs-operator">=</span> isStudent &amp;&amp; (age &lt; <span class="hljs-number">22</span>) &amp;&amp; (balance &gt; <span class="hljs-number">50</span>);
        System.out.println(<span class="hljs-string">"享受学生优惠: "</span> + studentDiscount);
        
        <span class="hljs-comment">// 实际场景：登录验证</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">"admin"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"123456"</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isValidUser</span> <span class="hljs-operator">=</span> username.equals(<span class="hljs-string">"admin"</span>) &amp;&amp; password.equals(<span class="hljs-string">"123456"</span>);
        System.out.println(<span class="hljs-string">"用户登录成功: "</span> + isValidUser);
    }
}
</code></pre>
<h4 data-id="heading-6">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 逻辑运算符示例 ===
可以借书（是学生且有证件）: <span class="hljs-literal">true</span>
可以看电影（年满<span class="hljs-number">18</span>岁或有钱的未成年人）: <span class="hljs-literal">true</span>
不是学生: <span class="hljs-literal">false</span>
享受学生优惠: <span class="hljs-literal">true</span>
用户登录成功: <span class="hljs-literal">true</span>
</code></pre>
<h3 data-id="heading-7">4. 赋值运算符：给变量赋值</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssignmentOperators</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 赋值运算符示例 ==="</span>);
        
        <span class="hljs-comment">// 基本赋值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        System.out.println(<span class="hljs-string">"初始total = "</span> + total);
        
        <span class="hljs-comment">// 复合赋值</span>
        total += <span class="hljs-number">50</span>;  <span class="hljs-comment">// 相当于 total = total + 50</span>
        System.out.println(<span class="hljs-string">"total += 50 后: "</span> + total);
        
        total -= <span class="hljs-number">30</span>;  <span class="hljs-comment">// 相当于 total = total - 30</span>
        System.out.println(<span class="hljs-string">"total -= 30 后: "</span> + total);
        
        total *= <span class="hljs-number">2</span>;   <span class="hljs-comment">// 相当于 total = total * 2</span>
        System.out.println(<span class="hljs-string">"total *= 2 后: "</span> + total);
        
        total /= <span class="hljs-number">4</span>;   <span class="hljs-comment">// 相当于 total = total / 4</span>
        System.out.println(<span class="hljs-string">"total /= 4 后: "</span> + total);
        
        total %= <span class="hljs-number">3</span>;   <span class="hljs-comment">// 相当于 total = total % 3</span>
        System.out.println(<span class="hljs-string">"total %= 3 后: "</span> + total);
        
        <span class="hljs-comment">// 字符串拼接</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;
        message += <span class="hljs-string">" World"</span>;  <span class="hljs-comment">// 相当于 message = message + " World"</span>
        message += <span class="hljs-string">"!"</span>;
        System.out.println(<span class="hljs-string">"拼接后的消息: "</span> + message);
    }
}
</code></pre>
<h4 data-id="heading-8">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 赋值运算符示例 ===
初始total = <span class="hljs-number">100</span>
total += <span class="hljs-number">50</span> 后: <span class="hljs-number">150</span>
total -= <span class="hljs-number">30</span> 后: <span class="hljs-number">120</span>
total *= <span class="hljs-number">2</span> 后: <span class="hljs-number">240</span>
total /= <span class="hljs-number">4</span> 后: <span class="hljs-number">60</span>
total %= <span class="hljs-number">3</span> 后: <span class="hljs-number">0</span>
拼接后的消息: Hello World!
</code></pre>
<h3 data-id="heading-9">5. 条件运算符（三元运算符）：简洁的条件判断</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConditionalOperator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">score1</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">score2</span> <span class="hljs-operator">=</span> <span class="hljs-number">92</span>;
        
        System.out.println(<span class="hljs-string">"=== 条件运算符示例 ==="</span>);
        
        <span class="hljs-comment">// 语法：条件 ? 值1 : 值2</span>
        <span class="hljs-comment">// 如果条件为true，返回值1；否则返回值2</span>
        
        <span class="hljs-comment">// 找出较大的分数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">maxScore</span> <span class="hljs-operator">=</span> (score1 &gt; score2) ? score1 : score2;
        System.out.println(<span class="hljs-string">"较大分数: "</span> + maxScore);
        
        <span class="hljs-comment">// 判断成绩等级</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">testScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">78</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">grade</span> <span class="hljs-operator">=</span> (testScore &gt;= <span class="hljs-number">90</span>) ? <span class="hljs-string">"优秀"</span> : 
                      (testScore &gt;= <span class="hljs-number">80</span>) ? <span class="hljs-string">"良好"</span> : 
                      (testScore &gt;= <span class="hljs-number">70</span>) ? <span class="hljs-string">"中等"</span> : 
                      (testScore &gt;= <span class="hljs-number">60</span>) ? <span class="hljs-string">"及格"</span> : <span class="hljs-string">"不及格"</span>;
        System.out.println(<span class="hljs-string">"成绩"</span> + testScore + <span class="hljs-string">"分的等级: "</span> + grade);
        
        <span class="hljs-comment">// 判断奇偶数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">parity</span> <span class="hljs-operator">=</span> (number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) ? <span class="hljs-string">"偶数"</span> : <span class="hljs-string">"奇数"</span>;
        System.out.println(number + <span class="hljs-string">"是"</span> + parity);
    }
}
</code></pre>
<h4 data-id="heading-10">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 条件运算符示例 ===
较大分数: <span class="hljs-number">92</span>
成绩<span class="hljs-number">78</span>分的等级: 中等
<span class="hljs-number">15</span>是奇数
</code></pre>
<h3 data-id="heading-11">6. 综合示例：学生成绩评定系统</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentGradeSystem</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 学生信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">studentName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"张三"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">mathScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">englishScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">92</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">programmingScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">78</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasGoodAttendance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        System.out.println(<span class="hljs-string">"=== 学生成绩评定系统 ==="</span>);
        System.out.println(<span class="hljs-string">"学生姓名: "</span> + studentName);
        System.out.println(<span class="hljs-string">"数学成绩: "</span> + mathScore);
        System.out.println(<span class="hljs-string">"英语成绩: "</span> + englishScore);
        System.out.println(<span class="hljs-string">"编程成绩: "</span> + programmingScore);
        
        <span class="hljs-comment">// 计算平均分</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> (mathScore + englishScore + programmingScore) / <span class="hljs-number">3.0</span>;
        System.out.println(<span class="hljs-string">"平均成绩: "</span> + String.format(<span class="hljs-string">"%.2f"</span>, averageScore));
        
        <span class="hljs-comment">// 判断是否所有科目都及格</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">allPass</span> <span class="hljs-operator">=</span> (mathScore &gt;= <span class="hljs-number">60</span>) &amp;&amp; (englishScore &gt;= <span class="hljs-number">60</span>) &amp;&amp; (programmingScore &gt;= <span class="hljs-number">60</span>);
        System.out.println(<span class="hljs-string">"所有科目都及格: "</span> + allPass);
        
        <span class="hljs-comment">// 判断是否有科目优秀（≥90分）</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasExcellent</span> <span class="hljs-operator">=</span> (mathScore &gt;= <span class="hljs-number">90</span>) || (englishScore &gt;= <span class="hljs-number">90</span>) || (programmingScore &gt;= <span class="hljs-number">90</span>);
        System.out.println(<span class="hljs-string">"有优秀科目: "</span> + hasExcellent);
        
        <span class="hljs-comment">// 综合评定</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">goodStudent</span> <span class="hljs-operator">=</span> (averageScore &gt;= <span class="hljs-number">80</span>) &amp;&amp; hasGoodAttendance &amp;&amp; allPass;
        System.out.println(<span class="hljs-string">"优秀学生评定: "</span> + goodStudent);
        
        <span class="hljs-comment">// 使用三元运算符给出建议</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">advice</span> <span class="hljs-operator">=</span> (averageScore &gt;= <span class="hljs-number">85</span>) ? <span class="hljs-string">"继续保持优秀表现！"</span> :
                       (averageScore &gt;= <span class="hljs-number">70</span>) ? <span class="hljs-string">"表现良好，继续努力！"</span> :
                       <span class="hljs-string">"需要加倍努力，加油！"</span>;
        System.out.println(<span class="hljs-string">"学习建议: "</span> + advice);
    }
}
</code></pre>
<h4 data-id="heading-12">运行结果：</h4>
<pre><code class="hljs language-Java" lang="Java">=== 学生成绩评定系统 ===
学生姓名: 张三
数学成绩: <span class="hljs-number">85</span>
英语成绩: <span class="hljs-number">92</span>
编程成绩: <span class="hljs-number">78</span>
平均成绩: <span class="hljs-number">85.00</span>
所有科目都及格: <span class="hljs-literal">true</span>
有优秀科目: <span class="hljs-literal">true</span>
优秀学生评定: <span class="hljs-literal">true</span>
学习建议: 继续保持优秀表现！
</code></pre>
<h2 data-id="heading-13">注意事项</h2>
<ol>
<li><strong>运算符优先级</strong>：乘除优先于加减，逻辑非&gt;算术&gt;关系&gt;逻辑与&gt;逻辑或&gt;赋值</li>
<li><strong>整数除法陷阱</strong>：<code>5 / 2</code> 结果是2而不是2.5，要得到小数需用<code>5.0 / 2</code></li>
<li><strong>短路求值</strong>：<code>&amp;&amp;</code>和<code>||</code>会出现短路现象，第一个条件能确定结果时不再计算第二个条件</li>
<li><strong>比较浮点数</strong>：不要直接用<code>==</code>比较浮点数，因为精度问题可能导致错误</li>
<li><strong>=和==区别</strong>：<code>=</code>是赋值，<code>==</code>是比较，初学者容易混淆</li>
<li><strong>复合赋值</strong>：<code>a += b</code> 等价于 <code>a = a + b</code>，但更简洁高效</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5. 实现]]></title>    <link>https://juejin.cn/post/7577737385954951178</link>    <guid>https://juejin.cn/post/7577737385954951178</guid>    <pubDate>2025-11-30T08:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385954951178" data-draft-id="7577668116525908014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5. 实现"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-11-30T08:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序猿本员"/> <meta itemprop="url" content="https://juejin.cn/user/3868510676597259"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5. 实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3868510676597259/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序猿本员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T08:11:18.000Z" title="Sun Nov 30 2025 08:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">小结</h2>
<ol>
<li>本章讨论的是实现（即函数体、类的编写）的效率、封装性以及安全性入手</li>
<li>效率方面需要注意的是<strong>延后变量定义时间、尽可能少做转型、inline的使用</strong>，以及<strong>降低多文件之间的依存性</strong>，这样可以提高编译效率</li>
<li>封装性方面注意<strong>不要返回class的handles</strong></li>
<li>安全性则是注意异常安全函数的定义：不会内存泄露以及不允许数据破坏</li>
</ol>
<h2 data-id="heading-1">26. 尽可能延后变量定义式的出现时间</h2>
<ol>
<li>如果一次性定义完，可能会因为异常等改变代码逻辑，进而部分变量都没有被使用过</li>
<li>最好是延迟定义到能给出该变量初始值的时候</li>
<li>循环，定义外部：则会<strong>一次构造、析构，n次赋值</strong>；定义内部：则会<strong>n次构造、析构</strong>。定义外部会导致作用域扩大，<strong>优先推荐定义内部</strong>，但是如果明确知道赋值成本比构造析构成本低且效率高度敏感，则定义外部</li>
</ol>
<h2 data-id="heading-2">27. 尽量少做转型动作</h2>
<ol>
<li>尽可能使用新式转型，唯一使用旧式转型<code>T()</code>是调用explicit构造函数将一个对象传递给一个函数：<code>do(Widget(15));==do(static_cast&lt;Widget&gt;(15);==do({15}))</code></li>
<li>对于const、reinterpret转型不会有其他操作，但是对于<strong>static、dynamic、部分隐式转换</strong>自定义类型，在无优化情况下，都是会先构造临时变量，再有后续操作；</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/686c02f560bf47f4ab62fc59118574ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP54y_5pys5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765095078&amp;x-signature=fa9h45nV0QD%2BqHoVT9YznRRGLTA%3D" alt="无标题.png" loading="lazy"/></p>
<p>甚至对于指针部分，也可能会因为隐式转换而导致值不一样；</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span>{...};
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>:<span class="hljs-keyword">public</span> Base{...};
Derived d;
Base* pb = &amp;d;<span class="hljs-comment">// 这里隐喻就是Derived* 转换成 Base*，两者地址值可能不同，与对象内存布局有关</span>
</code></pre>
<blockquote>
<p>对象内存布局和地址计算方式与编译器有关，所以不要试图去了解对象内存布局</p>
</blockquote>
<ol start="3">
<li>dynamic性能不高，因为至少需要比较名称字符串，有多少层继承就需要比较多少次，避免使用dynamic方式：<strong>1. 直接使用derived对象的指针；2. 借助虚函数，在base中申明所有接口，就不需要去向下转换了</strong></li>
</ol>
<h2 data-id="heading-3">28. 避免返回handles指向对象内部成分</h2>
<ol>
<li>handles：referenc、指针和迭代器</li>
<li>返回了指向内部成员的handle，有降低对象封装性的风险，如果需要返回，也必须加上<code>const</code></li>
<li>但是尽管加上const，依然是将handle暴露在比其所指对象更长寿的环境中，可能handle指向的对象已经被释放，但是外部代码依然保留着该handle</li>
<li><code>operator[]</code>就需要返回reference指向内部成员，但是这种情况很少</li>
</ol>
<h2 data-id="heading-4">29. 为异常安全而努力是值得的</h2>
<blockquote>
<p>异常安全函数：<strong>1. 不泄露任何资源；2. 不允许数据破坏</strong></p>
</blockquote>
<ol>
<li>不泄露资源：RAII</li>
<li>不允许数据破坏：
<ul>
<li>基本承诺：异常抛出所有对象处于合理的状态，真实状态是未知的，比如换背景图报错，那背景图要么是之前的要么是默认的</li>
<li>强烈保证：异常抛出程序状态不会被改变，即背景图还是之前的，即要么成功要么失败，并不是对所有函数都可实现或具备现实意义</li>
<li>不抛掷保证：承诺不抛出异常，总能完成他们原先承诺的功能，比如作用于内置类型身上所有的操作</li>
</ul>
<blockquote>
<p>noexcept，声明和定义都需要写出，承诺不抛出异常，如果直接、间接抛出（如调取的函数抛出异常）都会导致程序直接结束，单数<strong>标记这个的函数并不一定是异常安全函数，比如还存在内存泄露风险</strong></p>
</blockquote>
</li>
<li>copy-and-swap能提供基本承诺，为原本要修改的对象创建副本，然后在那副本身上做一切必要修改</li>
<li>pimpl(implementation)：将所有隶属对象的数据从原对象放进另一个对象内，然后赋予原对象一个指针指向那个所谓的实现对象，互斥锁依然处于原对象，用于保护对pimpl的访问</li>
<li>做到上面两种方式，并不是强烈保证，见下面解释</li>
<li>因为cpp中并入了很多并非异常安全代码，所以cpp并不具备异常安全，如果函数中调用了传统代码且没有try-catch手段，则函数“无任何保证”</li>
</ol>
<h2 data-id="heading-5">30. 绝大多数inlining的里里外外</h2>
<blockquote>
<p>inline只是对编译器的一个申请，而不是强制命令，可明确提出，也可隐喻提出（将函数定义于class内，甚至包括友元函数）</p>
</blockquote>
<ol>
<li><strong>inline函数一定是位于头文件的，因为在编译器阶段就需要进行替换，同理还有template</strong></li>
<li>inline与virtual其实是相反的，后者运行时才确定代码</li>
<li>inline声明的函数可能还是会有<strong>函数本体</strong>，如果存在程序需要取某个inline函数地址，比如编译器会要求构造、析构函数的函数指正，即生成其outline副本</li>
<li>构造、析构其实很复杂，并不是我们所编写那么简单，比如有异常抛出，需要释放掉之前已构造好的一部分，这些是编译器加入的代码</li>
<li>实践：<strong>将大多数 inlining 限制在小型、被频繁调用的函数身上。这可使日后的调试过程和二进制升级(binary upgradability)更容易，也可使潜在的代码膨胀问题最小化，使程序的速度提升机会最大化。</strong></li>
</ol>
<h2 data-id="heading-6">31. 将文件间的编译依存关系降至最低</h2>
<blockquote>
<p>依存关系是指头文件之间的#include，标准库一般性能较高故不在这些条例之内，且标准库不允许前置声明</p>
</blockquote>
<ol>
<li>当一个类处于定义时，必须知道其定义进而确定大小</li>
<li>如果使用reference或pointers能完成任务，就不要使用objects，尽量以class声明式替换class定义式，<strong>如果不需要访问class成员，则都可以只提供声明</strong></li>
<li>为声明式和定义式提供不同的头文件（仅针对大型项目）</li>
<li>pimpl：原本对象中只有一个指针指向具体实现类，所以也只需要前置声明该实现类即可，该实现类一般定义在cpp之中，这样就能很好隐藏</li>
<li>Handle class：内部还有实现类pipml，则外部类就变成了代理类</li>
<li>Interface class：Base为抽象类，并声明所有接口，实现由Derived完成</li>
<li>上面两种class解除了接口和实现之间的耦合关系，从而降低了文件间的编译依存关系</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> { <span class="hljs-comment">// Handle Class</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">std::string <span class="hljs-title">name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>; 
    <span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Impl</span>; <span class="hljs-comment">// 实现类的前向声明（完全隐藏）</span>
    std::unique_ptr&lt;Impl&gt; pImpl; <span class="hljs-comment">// 指向实现的指针（句柄）</span>
};

<span class="hljs-comment">// 实现类（内部实现）：包含数据和逻辑，不对外暴露</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Person</span>::Impl {
    std::string name; 
    Date birthday; <span class="hljs-comment">// 实现细节（依赖 Date）</span>
    <span class="hljs-function">std::string <span class="hljs-title">birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> birthday.<span class="hljs-built_in">toString</span>(); }
};

<span class="hljs-comment">// Handle Class 的成员函数通过 pImpl 委托给 Impl</span>
<span class="hljs-function">std::string <span class="hljs-title">Person::name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> pImpl-&gt;name; }
<span class="hljs-function">std::string <span class="hljs-title">Person::birthDate</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> pImpl-&gt;<span class="hljs-built_in">birthDate</span>(); }
</code></pre>
<blockquote>
<p>如果Impl内部成员改变，如Date改为newDate，并不会影响依赖Person的文件，这就降低了依存关系</p>
</blockquote>
<ol start="8">
<li>实践： 头文件应该以“完全且仅有”声明式的形式存在，模板类则提供两个h文件，一个声明一个具体实现，而普通类则是将实现写入cpp文件</li>
</ol>
<blockquote>
<ul>
<li><strong>仅有声明</strong>：头文件中只包含 <strong>类/函数/模板的声明</strong>，不包含任何实现代码（如函数体、成员变量初始化等）。</li>
<li><strong>完全声明</strong>：所有需要对外暴露的接口（类、函数、模板）必须完整声明，确保用户能正确使用（如类的成员函数声明、模板的参数列表等）。</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型开发实战篇2：调用DeepSeek的对话接口-最佳实践]]></title>    <link>https://juejin.cn/post/7577971299743186982</link>    <guid>https://juejin.cn/post/7577971299743186982</guid>    <pubDate>2025-11-30T10:18:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743186982" data-draft-id="7577971299743121446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型开发实战篇2：调用DeepSeek的对话接口-最佳实践"/> <meta itemprop="keywords" content="DeepSeek,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-30T10:18:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型开发实战篇2：调用DeepSeek的对话接口-最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:18:15.000Z" title="Sun Nov 30 2025 10:18:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<h2 data-id="heading-0">一、发现问题</h2>
<p>本文 使用大模型对话的技巧和原则，提升对话回复的效率和质量。</p>
<p>我们来回顾下，先看下demo代码</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/461030e08b7141dba36811b45533690b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=N3rbHgRo69sxKtZHWYQ%2FzO88QJg%3D" alt="" loading="lazy"/></p>
<p>这是我们调用WebApi接口的返回值，我们在使用chatgpt网页版问相同的问题，得到的结果差异很多。比如下图。大家可以测试下各种提问。而且不管是openai的大模型，还是DeepSeek都会出现这个情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/420bd704abef42c4ad5531b025c5b7fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=9UAt%2FXb3LMth%2BPP6UoEk20JLEH0%3D" alt="" loading="lazy"/></p>
<p>原因很好解释，chatgpt网页版调用的是基于gpt大模型进行各种微调优化后的回答，而我们直接调用gpt大模型，所以得到的结果也是不一样的。那就有很多问题了，比如：</p>
<ul>
<li>1、我们调用WebApi回答的问题是永远没有网页版本的好吗？</li>
<li>2、如何缩小这个差距，或者能否超越网页版本？</li>
<li>3、如何使用接口给的那些参数来优化对话？</li>
</ul>
<p> 今天我们就带着这些问题来聊一下对话WebAPI的最佳实践。有如下几种方式：</p>
<ol>
<li>角色设定：擅于使用 System 给GPT设定角色和任务，如“哲学大师”；</li>
<li>指令注入：在 System 中注入常驻任务指令，如“主题创作”；</li>
<li>问题拆解：将复杂问题拆解成的子问题，分步骤执行，如：Debug 和多任务；</li>
<li>分层设计：创作长篇内容，分层提问，先概览再章节，最后补充细节，如：小说生成；</li>
<li>编程思维：将prompt当做编程语言，主动设计变量、模板和正文，如：评估模型输出质量；</li>
<li>Few-Shot：基于样例的prompt设计，规范推理路径和输出样式，如：构造训练数据；</li>
</ol>
<p>接下来我们就根据这几点一一介绍。</p>
<h4 data-id="heading-1">一、大模型对话接口WebAPI调用模拟器playground</h4>
<p>OpenAI官方提供一个playground，是调用对话WebAPI的一个网页模拟器，地址如下：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fplayground%2Fchat%3Fmodels%3Dgpt-4o-mini" target="_blank" title="https://platform.openai.com/playground/chat?models=gpt-4o-mini" ref="nofollow noopener noreferrer">platform.openai.com/playground/…</a>  </p>
<p>不过需要充值，有些麻烦，我们可以使用国内的硅基流动的playground来体验一下。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.siliconflow.cn%2Fplayground%2Fchat%2F17885302723" target="_blank" title="https://cloud.siliconflow.cn/playground/chat/17885302723" ref="nofollow noopener noreferrer">cloud.siliconflow.cn/playground/…</a></p>
<p>本文都是针对system角色的内容进行优化！</p>
<h4 data-id="heading-2">二、角色设定</h4>
<p>请求参数messages里，有一个非常重要的角色system,system就是大模型在本次对话中扮演什么身份，比如大模型本次扮演的是“体育专家”，一般使用第3人称“你是xxx专家/教授等”，所以接口调用时，role=system的content内容需要重点思考。</p>
<p>1、角色设定的差异对比</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">system:</span><span class="hljs-string">"你是一位小学数学老师"</span>。
<span class="hljs-symbol">syetem:</span><span class="hljs-string">"你是一位博学多才的哲学家"</span>
提问：<span class="hljs-number">1</span>+<span class="hljs-number">1</span>=<span class="hljs-number">2</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/737ffecd075b4f4b88ba5b44a53a3432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=LP6ixrmRKKmMLkHS4wD43OK48M8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/149edc72569b4eb78d9179a8008b9a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=AoFTmNiyUGB6LDl72TsxpKiY9hs%3D" alt="" loading="lazy"/></p>
<p>结果差异很大。说明system的设定非常重要。我们可以根据具体的场景，针对不同的客户群里，设置不同的system的content值，就能让大模型的回答更贴近各种客户群体的不同所想。</p>
<p>还有一些system的content常用用法，</p>
<p>模版：你是一位xxx（身份），对于我的所有问题，你都用xxx(身份)的思维解答。</p>
<p>比如：（1）你是一位小学数学老师，对于我的所有问题，你都用小学生的思维解答。</p>
<p>（2）对于我的所有问题，你都用佛学或中国哲学来回答，不要啰嗦，要有大师风范。</p>
<h4 data-id="heading-3">三、指令注入</h4>
<p>同样是对角色system的content设置，比如“主题创作”。</p>
<p> 比如1：</p>
<pre><code class="hljs language-css" lang="css">对于陈列出的每个<span class="hljs-selector-attr">[话题]</span>,创作<span class="hljs-number">100</span>字的内容，体现话题的论点，语言风趣幽默。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9d6c41951d244d88b61a4f6657a3c14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=%2BJs3amojA4KBD2DCIIjAZ9OZV2U%3D" alt="" loading="lazy"/></p>
<p>比如2：</p>
<pre><code class="hljs language-lua" lang="lua">您将获得一对关于同主题的文章（用<span class="hljs-comment">-------标签分隔）。首先总结每篇文章的论点，然后指出那篇文章提出了更好的论点，并解释原因。</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/555391bde8e24d34b57fbad2ea45687d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=Uhhu3F49l0DW5Km%2Bp%2FXVHLsWWzc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">四、分步骤设定</h4>
<p>同样是对角色system的content设置。比如：</p>
<pre><code class="hljs">您将受到DEBUG问题，将每个问题分类为报错日志分析、根因可能性推断、解决方案、参考资料，分点陈列输出，格式如下所示：
报错日志分析：
根因可能性推断：
解决方案：
参考资料：
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fcf485fa60b478393203d5cbd624532~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=R%2F4dSC4aHJWR0zwUO2t8cf38m8Q%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">五、编程思维</h4>
<p>事例1</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be884bc0bf094249ba41bdc60a0e7733~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=6V1evbmeOiVanphjQjzb9gVojAQ%3D" alt="" loading="lazy"/></p>
<p>根据以上的事例，可以看到，system里的内容，很像我们编程的思维，第一步执行什么，第二步执行什么，最后还有统计count数。并且还有“每个”，跟我们代码里的for循环一样。</p>
<p>回答的内容可以看到整个for循环输出，计算出了count数量。</p>
<p>事例2-翻译</p>
<p>system:我输入英文，你翻译成中文，我输入中文，你翻译成英文。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f7481a8b9d642b4b57c059e01db9d27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=Tas12VA55VdxXcNMuwQ9CrFgIVA%3D" alt="" loading="lazy"/></p>
<p>事例3-按照你的格式输出</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7a5e4af8f9e48edbb8b0ac8e8a131a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102695&amp;x-signature=MK97qj2mUQz%2Bporn5QtdM%2F5V3XM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">总结</h2>
<p>我们针对system角色设置内容，也是一种提示词设置方法，只有不断地测试不同的方式，才能更大程度的挖掘大模型的能力,才能更好的贴合实际的需求。</p>
<h3 data-id="heading-7">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LeetCode Hot100 刷题日记（19/100）】54. 螺旋矩阵 —— 数组、矩阵、模拟、双指针、层序遍历🌀]]></title>    <link>https://juejin.cn/post/7577914902430875694</link>    <guid>https://juejin.cn/post/7577914902430875694</guid>    <pubDate>2025-11-30T10:19:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902430875694" data-draft-id="7577914902430859310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LeetCode Hot100 刷题日记（19/100）】54. 螺旋矩阵 —— 数组、矩阵、模拟、双指针、层序遍历🌀 "/> <meta itemprop="keywords" content="算法,面试,程序员"/> <meta itemprop="datePublished" content="2025-11-30T10:19:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LeetCode Hot100 刷题日记（19/100）】54. 螺旋矩阵 —— 数组、矩阵、模拟、双指针、层序遍历🌀 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:19:29.000Z" title="Sun Nov 30 2025 10:19:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🌀  题目链接：leetcode.cn/problems/spiral-matrix/</p>
<p>🔍 难度：中等 | 🏷️ 标签：数组、矩阵、模拟、双指针、层序遍历</p>
<p>⏱️ 目标时间复杂度：O(m×n)</p>
<p>💾 空间复杂度：O(1)（最优解） / O(m×n)（辅助空间）</p>
</blockquote>
<hr/>
<h3 data-id="heading-0">🎯 题目分析</h3>
<p>给定一个 <code>m × n</code> 的二维矩阵，要求按照 <strong>顺时针螺旋顺序</strong> 输出所有元素。<br/>
例如：</p>
<pre><code class="hljs language-text" lang="text">输入：
[
 [1, 2, 3],
 [4, 5, 6],
 [7, 8, 9]
]

输出：[1,2,3,6,9,8,7,4,5]
</code></pre>
<p>观察发现，路径是从左上角开始，按“右→下→左→上”的方向循环前进，遇到边界或已访问位置时转向。</p>
<p>这道题是典型的 <strong>“路径模拟”问题</strong>，核心在于如何控制移动方向与边界判断。<br/>
它在面试中常作为考察 <strong>逻辑思维能力、边界处理能力</strong> 的经典题目，尤其适合评估候选人对“状态转移”和“循环控制”的掌握程度。</p>
<hr/>
<h2 data-id="heading-1">✅ 核心算法及代码讲解</h2>
<h3 data-id="heading-2">🧠 方法一：模拟法（使用 visited 数组）</h3>
<p>这是最直观的解法，通过维护一个 <code>visited</code> 布尔矩阵来记录每个格子是否已被访问，并用方向数组控制移动方向。</p>
<h4 data-id="heading-3">🛠️ 关键点：</h4>
<ul>
<li>使用四个方向向量 <code>{ {0,1}, {1,0}, {0,-1}, {-1,0} }</code> 表示：右 → 下 → 左 → 上。</li>
<li>当下一步越界或已访问，则顺时针旋转方向（即 <code>(directionIndex + 1) % 4</code>）。</li>
<li>每次走一步，更新当前位置并标记为已访问。</li>
</ul>
<h4 data-id="heading-4">💡 优点：</h4>
<ul>
<li>思路清晰，容易理解。</li>
<li>适用于任意形状的网格路径模拟。</li>
</ul>
<h4 data-id="heading-5">⚠️ 缺点：</h4>
<ul>
<li>需要额外 <code>O(mn)</code> 空间存储 <code>visited</code>，不够高效。</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> directions[<span class="hljs-number">4</span>][<span class="hljs-number">2</span>] = {{<span class="hljs-number">0</span>, <span class="hljs-number">1</span>}, {<span class="hljs-number">1</span>, <span class="hljs-number">0</span>}, {<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>}, {<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>}}; <span class="hljs-comment">// 右、下、左、上</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">spiralOrder</span><span class="hljs-params">(vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; matrix)</span> </span>{
        <span class="hljs-keyword">if</span> (matrix.<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span> || matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> {};
        }
        
        <span class="hljs-type">int</span> rows = matrix.<span class="hljs-built_in">size</span>(), columns = matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>();
        vector&lt;vector&lt;<span class="hljs-type">bool</span>&gt;&gt; <span class="hljs-built_in">visited</span>(rows, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">bool</span>&gt;(columns)); <span class="hljs-comment">// 访问标记</span>
        <span class="hljs-type">int</span> total = rows * columns;
        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">order</span><span class="hljs-params">(total)</span></span>;

        <span class="hljs-type">int</span> row = <span class="hljs-number">0</span>, column = <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> directionIndex = <span class="hljs-number">0</span>; <span class="hljs-comment">// 当前方向索引</span>

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; total; i++) {
            order[i] = matrix[row][column]; <span class="hljs-comment">// 收集当前值</span>
            visited[row][column] = <span class="hljs-literal">true</span>;    <span class="hljs-comment">// 标记已访问</span>

            <span class="hljs-comment">// 计算下一个位置</span>
            <span class="hljs-type">int</span> nextRow = row + directions[directionIndex][<span class="hljs-number">0</span>];
            <span class="hljs-type">int</span> nextColumn = column + directions[directionIndex][<span class="hljs-number">1</span>];

            <span class="hljs-comment">// 判断是否需要转向：越界 或 已访问</span>
            <span class="hljs-keyword">if</span> (nextRow &lt; <span class="hljs-number">0</span> || nextRow &gt;= rows || nextColumn &lt; <span class="hljs-number">0</span> || nextColumn &gt;= columns || visited[nextRow][nextColumn]) {
                directionIndex = (directionIndex + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>; <span class="hljs-comment">// 顺时针转</span>
            }

            <span class="hljs-comment">// 更新位置</span>
            row += directions[directionIndex][<span class="hljs-number">0</span>];
            column += directions[directionIndex][<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">return</span> order;
    }
};
</code></pre>
<blockquote>
<p>✅ 时间复杂度：O(mn)<br/>
❌ 空间复杂度：O(mn) —— 因为用了 <code>visited</code> 数组</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">🧠 方法二：按层模拟（推荐！面试首选）✅</h3>
<p>将整个矩阵看作若干“层”，每层从外到内依次遍历。</p>
<h4 data-id="heading-7">🧩 分层思想：</h4>
<ul>
<li>第一层：外圈，从 <code>[top][left]</code> 到 <code>[bottom][right]</code></li>
<li>第二层：内圈，缩小边界后继续</li>
<li>直至 <code>left &gt; right</code> 或 <code>top &gt; bottom</code> 结束</li>
</ul>
<h4 data-id="heading-8">🔄 遍历顺序：</h4>
<ol>
<li><strong>上行</strong>：从左到右 → <code>(top, left)</code> 到 <code>(top, right)</code></li>
<li><strong>右列</strong>：从上到下 → <code>(top+1, right)</code> 到 <code>(bottom, right)</code></li>
<li><strong>下行</strong>：从右到左 → <code>(bottom, right-1)</code> 到 <code>(bottom, left+1)</code>（仅当 <code>left &lt; right</code>）</li>
<li><strong>左列</strong>：从下到上 → <code>(bottom-1, left)</code> 到 <code>(top+1, left)</code>（仅当 <code>top &lt; bottom</code>）</li>
</ol>
<h4 data-id="heading-9">✅ 优势：</h4>
<ul>
<li>不需要额外空间，空间复杂度为 <strong>O(1)</strong>（不计输出数组）</li>
<li>边界条件明确，代码简洁易读</li>
<li>是面试官最爱的“优雅解法”</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">spiralOrder</span><span class="hljs-params">(vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; matrix)</span> </span>{
        <span class="hljs-keyword">if</span> (matrix.<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span> || matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> {};
        }

        <span class="hljs-type">int</span> rows = matrix.<span class="hljs-built_in">size</span>(), columns = matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>();
        vector&lt;<span class="hljs-type">int</span>&gt; order;
        <span class="hljs-type">int</span> left = <span class="hljs-number">0</span>, right = columns - <span class="hljs-number">1</span>, top = <span class="hljs-number">0</span>, bottom = rows - <span class="hljs-number">1</span>;

        <span class="hljs-keyword">while</span> (left &lt;= right &amp;&amp; top &lt;= bottom) {
            <span class="hljs-comment">// 1. 上行：从左到右</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> column = left; column &lt;= right; column++) {
                order.<span class="hljs-built_in">push_back</span>(matrix[top][column]);
            }
            top++; <span class="hljs-comment">// 上边界下移</span>

            <span class="hljs-comment">// 2. 右列：从上到下</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> row = top; row &lt;= bottom; row++) {
                order.<span class="hljs-built_in">push_back</span>(matrix[row][right]);
            }
            right--; <span class="hljs-comment">// 右边界左移</span>

            <span class="hljs-comment">// 3. 下行：从右到左（需确保有下一行且不是单行）</span>
            <span class="hljs-keyword">if</span> (left &lt; right) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> column = right; column &gt; left; column--) {
                    order.<span class="hljs-built_in">push_back</span>(matrix[bottom][column]);
                }
            }
            bottom--; <span class="hljs-comment">// 下边界上移</span>

            <span class="hljs-comment">// 4. 左列：从下到上（需确保有左列且不是单列）</span>
            <span class="hljs-keyword">if</span> (top &lt; bottom) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> row = bottom; row &gt;= top; row--) {
                    order.<span class="hljs-built_in">push_back</span>(matrix[row][left]);
                }
            }
            left++; <span class="hljs-comment">// 左边界右移</span>
        }
        <span class="hljs-keyword">return</span> order;
    }
};
</code></pre>
<blockquote>
<p>✅ 时间复杂度：O(mn)<br/>
✅ 空间复杂度：O(1) —— 仅用常数变量</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">🧭 解题思路（分步详解）</h2>
<h3 data-id="heading-11">📌 步骤 1：初始化边界</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> left = <span class="hljs-number">0</span>, right = cols - <span class="hljs-number">1</span>, top = <span class="hljs-number">0</span>, bottom = rows - <span class="hljs-number">1</span>;
</code></pre>
<p>定义四个指针分别指向当前层的四条边。</p>
<h3 data-id="heading-12">📌 步骤 2：循环遍历每一层</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">while</span> (left &lt;= right &amp;&amp; top &lt;= bottom)
</code></pre>
<p>只要还有未遍历的区域就继续。</p>
<h3 data-id="heading-13">📌 步骤 3：逐层遍历</h3>
<ol>
<li><strong>上行</strong>：<code>top</code> 行从 <code>left</code> 到 <code>right</code></li>
<li><strong>右列</strong>：<code>right</code> 列从 <code>top+1</code> 到 <code>bottom</code></li>
<li><strong>下行</strong>：<code>bottom</code> 行从 <code>right-1</code> 到 <code>left+1</code>（避免重复）</li>
<li><strong>左列</strong>：<code>left</code> 列从 <code>bottom-1</code> 到 <code>top+1</code>（避免重复）</li>
</ol>
<blockquote>
<p>🚫 注意：第3、4步必须加条件判断，防止在 1xN 或 Nx1 的情况下重复添加元素！</p>
</blockquote>
<h3 data-id="heading-14">📌 步骤 4：收缩边界</h3>
<p>每次遍历完一层后：</p>
<pre><code class="hljs language-cpp" lang="cpp">left++, right--, top++, bottom--;
</code></pre>
<p>直到无法再进入新层为止。</p>
<hr/>
<h2 data-id="heading-15">📊 算法分析</h2>























<table><thead><tr><th>方法</th><th>时间复杂度</th><th>空间复杂度</th><th>是否推荐</th></tr></thead><tbody><tr><td>模拟法（带 visited）</td><td>O(mn)</td><td>O(mn)</td><td>❌ 一般情况不推荐</td></tr><tr><td>按层模拟</td><td>O(mn)</td><td>O(1)</td><td>✅ 推荐，面试首选</td></tr></tbody></table>
<blockquote>
<p>🔍 <strong>为什么按层更优？</strong></p>
</blockquote>
<ul>
<li>面试中追求 <strong>空间效率</strong> 和 <strong>代码优雅性</strong></li>
<li>能体现你对“结构化思维”的理解</li>
<li>更容易扩展到其他类似问题（如“蛇形填充”、“Z 字形打印”等）</li>
</ul>
<hr/>
<h2 data-id="heading-16">💻 完整代码（模板格式）</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">using</span> ll = <span class="hljs-type">long</span> <span class="hljs-type">long</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">spiralOrder</span><span class="hljs-params">(vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; matrix)</span> </span>{
        <span class="hljs-keyword">if</span> (matrix.<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span> || matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> {};
        }

        <span class="hljs-type">int</span> rows = matrix.<span class="hljs-built_in">size</span>(), columns = matrix[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>();
        vector&lt;<span class="hljs-type">int</span>&gt; order;
        <span class="hljs-type">int</span> left = <span class="hljs-number">0</span>, right = columns - <span class="hljs-number">1</span>, top = <span class="hljs-number">0</span>, bottom = rows - <span class="hljs-number">1</span>;

        <span class="hljs-keyword">while</span> (left &lt;= right &amp;&amp; top &lt;= bottom) {
            <span class="hljs-comment">// 1. 上行：从左到右</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> column = left; column &lt;= right; column++) {
                order.<span class="hljs-built_in">push_back</span>(matrix[top][column]);
            }
            top++;

            <span class="hljs-comment">// 2. 右列：从上到下</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> row = top; row &lt;= bottom; row++) {
                order.<span class="hljs-built_in">push_back</span>(matrix[row][right]);
            }
            right--;

            <span class="hljs-comment">// 3. 下行：从右到左（仅当不是单行）</span>
            <span class="hljs-keyword">if</span> (left &lt; right) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> column = right; column &gt; left; column--) {
                    order.<span class="hljs-built_in">push_back</span>(matrix[bottom][column]);
                }
            }
            bottom--;

            <span class="hljs-comment">// 4. 左列：从下到上（仅当不是单列）</span>
            <span class="hljs-keyword">if</span> (top &lt; bottom) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> row = bottom; row &gt;= top; row--) {
                    order.<span class="hljs-built_in">push_back</span>(matrix[row][left]);
                }
            }
            left++;
        }
        <span class="hljs-keyword">return</span> order;
    }
};

<span class="hljs-comment">// 测试</span>
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-literal">nullptr</span>);
    cout.<span class="hljs-built_in">tie</span>(<span class="hljs-literal">nullptr</span>);

    <span class="hljs-comment">// 示例测试用例</span>
    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; matrix1 = {{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>},{<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>},{<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>}};
    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; matrix2 = {{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>},{<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>},{<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>}};

    Solution sol;
    <span class="hljs-keyword">auto</span> result1 = sol.<span class="hljs-built_in">spiralOrder</span>(matrix1);
    <span class="hljs-keyword">auto</span> result2 = sol.<span class="hljs-built_in">spiralOrder</span>(matrix2);

    cout &lt;&lt; <span class="hljs-string">"Test 1: "</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> x : result1) cout &lt;&lt; x &lt;&lt; <span class="hljs-string">" "</span>;
    cout &lt;&lt; endl;

    cout &lt;&lt; <span class="hljs-string">"Test 2: "</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> x : result2) cout &lt;&lt; x &lt;&lt; <span class="hljs-string">" "</span>;
    cout &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<blockquote>
<p>✅ 输出结果：</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Test 1:</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span> <span class="hljs-number">9</span> <span class="hljs-number">8</span> <span class="hljs-number">7</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> 
<span class="hljs-attr">Test 2:</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span> <span class="hljs-number">12</span> <span class="hljs-number">11</span> <span class="hljs-number">10</span> <span class="hljs-number">9</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> 
</code></pre>
<hr/>
<hr/>
<blockquote>
<p>🌟 本期完结，下期见！🔥</p>
<p>👉 点赞收藏加关注，新文更新不迷路。关注专栏【算法】LeetCode Hot100刷题日记，持续为你拆解每一道热题的底层逻辑与面试技巧！</p>
<p>💬 <strong>欢迎留言交流你的解法或疑问！一起进步，冲向 Offer！💪</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-17">📣 下一期预告：LeetCode 热题 100 第48题 —— <strong>旋转图像（中等）</strong></h2>
<blockquote>
<p>🔹 <strong>题目</strong>：给你一个 <code>n×n</code> 的二维矩阵，将其顺时针旋转 90 度。要求 <strong>原地修改</strong>，不能使用额外的矩阵。</p>
<p>🔹 <strong>核心思路</strong>：利用“对角线翻转 + 水平翻转”或“分圈旋转”策略，实现 O(1) 空间原地旋转。</p>
<p>🔹 <strong>考点</strong>：矩阵操作、原地算法、数学变换、边界处理。</p>
<p>🔹 <strong>难度</strong>：中等，但非常典型，常出现在大厂面试中（如字节、腾讯、阿里）。</p>
<p>🔹 <strong>提示</strong>：</p>
<ul>
<li>不能直接复制再赋值！</li>
<li>尝试找规律：<code>(i,j)</code> → <code>(j,n-1-i)</code>，可推导出旋转公式。</li>
<li>推荐方法：先沿主对角线转置，再水平翻转。</li>
</ul>
</blockquote>
<blockquote>
<p>💡 提示：记住这个口诀：“<strong>转置 + 翻转 = 旋转</strong>”！</p>
</blockquote>
<hr/>
<p>📌 <strong>记住</strong>：当你在刷题时，不要只看答案，要像写这篇文章一样，深入思考每一步背后的原理、优化空间和面试价值。这才是真正提升算法能力的方式！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pixelcut：22 年起步的黑马，又是一个千万 ARR 的产品！]]></title>    <link>https://juejin.cn/post/7577797563854143524</link>    <guid>https://juejin.cn/post/7577797563854143524</guid>    <pubDate>2025-11-30T10:18:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577797563854143524" data-draft-id="7577958825342353427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pixelcut：22 年起步的黑马，又是一个千万 ARR 的产品！"/> <meta itemprop="keywords" content="产品,AI编程"/> <meta itemprop="datePublished" content="2025-11-30T10:18:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pixelcut：22 年起步的黑马，又是一个千万 ARR 的产品！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:18:56.000Z" title="Sun Nov 30 2025 10:18:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>今天跟大家分享我们商业洞察系列的第二篇。</p>
<p>记得上次留了个作业，让大家自行分析一下 pixelcut、photoroom，看看有没有商业机会。</p>
<p>不知道大家有没有分析呢。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f7327f619e44a249cfad9045d36486a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=qjouyAp8JGVM4W%2FKV7k3l%2BoCtFE%3D" alt="" loading="lazy"/></p>
<p>其实 pixelcut 位于榜单 16 名，photoroom 位于榜单 27 名，picwish 位于榜单 68 名。</p>
<p>都是非常值得分析的站点，今天我带大家一起来看看 pixelcut。</p>
<h2 data-id="heading-0"><strong>01 市场盘子</strong></h2>
<p>这个站点 22 年才建立的，也算是比较新的站点。</p>
<p>它和 remove.bg 不一样，你看他的 TDH，实际上主打的是 photo editor：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d3fa01d6bd0408b969dd6f0fbd72174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=tBlEkUfNOh1LQYd9LzS5LZbGfDU%3D" alt="" loading="lazy"/></p>
<p>它的流量也很高，大概在 2000 万左右，主要来自于搜索：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5036a185b7de42a288ceb4269ca3d1cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=0hSHcVwTxudH%2FsqQOyEau1gCHz4%3D" alt="" loading="lazy"/></p>
<p>我们看它的搜索词，上次我们说，background remover、remove background，它也吃到了不少流量：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6c10294f4094e72a35f43f8c18e1559~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=fbeRyicNZpsbaOpahWy4kqrOU%2BI%3D" alt="" loading="lazy"/></p>
<p>足以说明这个市场实在太大了，这两个词加起来都有七百万的搜索量，remove.bg 不可能把所有词的流量全部吃完，那就给了 pixelcut 的机会。</p>
<h2 data-id="heading-1"><strong>02 定位与 TDH：背后的意图</strong></h2>
<p>我们去看 pixelcut 首页的关键词密度，会发现它主打的是 background remover，这就很明显了，虽然它标榜是 photo editor，但是 SEO 意图很明显，它想吃掉部分这个词的流量：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac158922cd744e919d26fc6a6c06f711~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=Lvu9Q5g3Ye7LggyaBUynxxnJBx4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>03 多语言的精准词</strong></h2>
<p>然后我们可以看到，占掉它流量第二大头的搜索词是一个西班牙语，这个词在我的 serp 里，pixelcut 是排第一的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc28b4af240043858593a98a17c3bb3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=V701aLfisDEZU6%2F9kwmL2qenRkw%3D" alt="" loading="lazy"/></p>
<p>它用来承接的是一个专门为多语言做的内页：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pixelcut.ai%2Fes%2Fmejorar-calidad-de-imagen" target="_blank" title="https://www.pixelcut.ai/es/mejorar-calidad-de-imagen" ref="nofollow noopener noreferrer">www.pixelcut.ai/es/mejorar-…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/576b116ae3ff4f5a81d89ee5e031dfea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=hju6YLpvkJE1jl9BWIDDDOvLfKY%3D" alt="" loading="lazy"/></p>
<p>实际上这个词，和第 5 个词 image upscaler 是等价的，图片增强，这个对应的是人们想要获得高清图的需求。</p>
<p>这个市场也很大，葡萄牙语和英语各自的搜索量都达到了 60 万。在葡萄牙语这里，pixelcut 吃掉了市场 1/3 的流量。</p>
<p>这给我们一个很好的启示，就是多语言的内页，一定要根据流量关键词去做，不是随随便便翻译的，我们做 SEO 一定要有目的，这个西班牙语的关键词，直接撑起了第二流量。</p>
<h2 data-id="heading-3"><strong>04 需求词域名的启示：这就是市场机会</strong></h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5a27ea636b04ef08c425a26dc9f258e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=tf4T2S7Lt7gKWYYqPi%2FYhHNEZRM%3D" alt="" loading="lazy"/></p>
<p>这里我想特别说明一下 image upscaler 这个词，它太有代表性了。在我的 serp 里，排前三的都是关键词域名：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3521d0084da408d9340ef6a12a93aeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=yhqmhxQxP90h1r8NFdpxguoNR0M%3D" alt="" loading="lazy"/></p>
<p>而且，imgupscaler.ai 这个是 2024 年底注册的域名，它目前的访问量已经 400 万了！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3decce38106e40c7a83a4b15a1e4daaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=0koZsn2ewnGMQ4j14oYwkvk1LpM%3D" alt="" loading="lazy"/></p>
<p>这里面透露出两个信息，第一个是这个注册的是 ai 后缀的域名，我们知道 ai 后缀的域名非常贵，说明作者看到了这里面的商业机会，愿意投入这么多钱去买这个域名。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfd90af611974a0698442a419b742bce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=gMloIJjSR5LcFhIuonZM%2FJGp2So%3D" alt="" loading="lazy"/></p>
<p>在 queryDomain 上可以看到，这个关键词域名基本上都是被抢光了的，img upsacler 也是一样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7eaba684e4a415182d0766af4bd1807~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=17AvVDCSG5G5FXIxZGw2jjr1rKc%3D" alt="" loading="lazy"/></p>
<p>大家可以看到，虽然这么多人注册，但跑出来的基本上只有三个，而 2024 年注册的这个非常值得我们学习。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806d5108bc2049c2be2d6f85b098afa8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=uGa8BzWK8zjLbD%2BsFk6E%2B99IvDs%3D" alt="" loading="lazy"/></p>
<p>其实这个站点蛮 AI 风格的，基本上就是 AI 做的站，400 万的流量，保守估计，仅广告就能月入万刀。更不用说这个站点还有订阅。大家可以自行去分析，我在这里就不展开了。</p>
<p>这里给我们最大的启示是，市场需求不可能被一家通吃，不要害怕那些老站，24 年的网站同样可以占有市场。</p>
<p>这就是市场机会，也是 AI 时代的红利！很多人说不知道怎么找需求，你去分析一下，其实海外遍地都是机会。</p>
<h2 data-id="heading-4"><strong>05 品牌词 20 万搜量，公关+内容营销</strong></h2>
<p>回到正题，第三才是它自己的品牌词 pixelcut，大概 20 万的搜索量。pixelcut 并不算一个需求词，这完全是它自己的品牌，能够有 20 万的搜索量，足以说明它自己做了很多品牌影响力的建设。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e4eaad9a6bf45e795996c6d7dfd97ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=jxQxHuVUGHNZsQmgKUjGx8RebDY%3D" alt="" loading="lazy"/></p>
<p>我们去搜 pixelcut 就会发现有很多 Youtube 的宣传，以及公关文章，这是它自己建立的影响力。</p>
<h2 data-id="heading-5"><strong>06 信息架构：首页弱、内页强，工具页才是流量入口</strong></h2>
<p>接下来我们看一下它的产品设计：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36539ca65d3e4ef4b3ef777a0a410f21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=1Dd36VAQZaO9Uk158zwNZ4K47gU%3D" alt="" loading="lazy"/></p>
<p>其实 pixelcut 在设计层面并不是很专业，至少从 web 角度来看，而且它的底部 footer 表现的很明显：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aea1a3dc8f24461853df49aef177f39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=XPmqlfVM1wqVoN1I86%2BDe5Mt0Jg%3D" alt="" loading="lazy"/></p>
<p>甚至我怀疑他们团队并没有专业设计师，这也侧面说明了，对于工具类型的产品来说，视觉并不是非常重要的因素。</p>
<p>在首页的首屏是一个文生图的 toolbox，要登录后才能使用，首页有很明显拉注册率的提示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee3e8e00fdd947aaaee0a4b233f3ea85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=lJk7t%2BIggLs6mAU8l%2BBin1bE%2F%2BA%3D" alt="" loading="lazy"/></p>
<p>我预估以首页的这个体验和视觉效果，流量和使用者应该不高，让我们看一下它的内页流量情况：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/795ab7da44d84806b9e14e1dc22dec8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=a7671ofJEPzgDEKieKYt82VMvIc%3D" alt="" loading="lazy"/></p>
<p>果不其然，首页在第八名，排在前面的都是内页，其中 background-remover 和 image-scaler 两个内页给他基本上贡献了一半以上的流量。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e652fc2f5e794bb98c5e01d4c70df6cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=hla2BKVmkZPRKdlSk6ET%2F7YArxo%3D" alt="" loading="lazy"/></p>
<p>以 background remover 为例，它的内页是一个非常典型的工具页布局，这个非常值得我们学习：</p>
<p>首先首屏是工具的主体区域，大面积且简洁，第一时间引导用户体验。</p>
<p>下面是 How-to、feature 的介绍，通过这块来拉高 SEO 关键词密度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83e46a3a9f5e4147aa58c0c10900871b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=1NuPPC5q1j5k73jBBWItM1c4uTg%3D" alt="" loading="lazy"/></p>
<p>这个页面有 1000 多个词，主词密度区分得很明显。既满足了用户，又满足了 SEO，这是非常明智的做法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e801516454742ab9126e6387a2cdfce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=gk0CKJciLSKuGmMR4t7s45ZlXsQ%3D" alt="" loading="lazy"/></p>
<p>再往下是 FAQ+用户证言+内链，也是常用的 SEO 手段。在这里要提醒一下，千万不要让 AI 生成虚假的用户证言，否则你的审核一定是不可能通过的。</p>
<h2 data-id="heading-6"><strong>07 体验细节：免费闭环做得比 remove.bg 还顺滑</strong></h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94f6d5626f041a28f696fe70c515d34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=vRKz%2Bw5Xl6IMgws%2F2E15RuvvuS4%3D" alt="" loading="lazy"/></p>
<p>我们上传一张图片，这次它没有引导登录，而是直接跳转一个编辑器页面，并且把图已经抠好了。</p>
<p>这个体验的感觉和专业度，我认为甚至超过了 remove.bg，这也说明了它为什么在这个市场上还能分到一杯羹。</p>
<p>所以说，我们分析竞争对手，一定不要看它的缺点，而要看它为什么能够成功。它的首页虽然不完美，但是核心功能的体验是极致的。</p>
<p>在这个编辑器页面，你就会发现，Download 下载 Free 版本也是可以直接用的，也就是去除背景+下载这条链路完全免费，其他的任何按钮点击，它又会引导你去登录了。</p>
<p>这是我觉得非常好的设计，这个团队一定深入调研了 background.bg 的功能体验，如果一个功能对方是免费的，而你设置了层层门槛，哪怕是一个登录门槛，就会变成你的劣势，那你是不可能竞争过对方的。</p>
<p>通过这两个案例的分析，我们已经可以得出结论，对于 background remove 这个场景来说，免费+下载的体验已经是用户心智了，如果你要做类似的产品，这条链路也必须给免费体验，否则根本没资格参与竞争。</p>
<h2 data-id="heading-7"><strong>08 变现：免费做广度，订阅/广告做厚度</strong></h2>
<p>免费了怎么赚钱呢？首先这个市场蛋糕足够大，而且这个场景足够高频，所以只要你产品好用，高频用户肯定是愿意花钱去使用的，用广告+订阅购买的方式，来打平免费的成本，赚取利润。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/468654ecb0f94bb890ebb13f04708f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=7XCs8LSBufAcUc3BisNaKCEMTkU%3D" alt="" loading="lazy"/></p>
<p>pixelcut 没有屏蔽订单索引，我们从出站流量就可以看到，stripe 的流量占比大概是 1.17%，也就是说，有 1%以上的用户愿意为这个产品付费。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae6aba8469e046c1b40b4d42ea09ff7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=1bAcDhAuB1j98%2FAw1K4azJ4THCY%3D" alt="" loading="lazy"/></p>
<p>pixelcut 的 Pricing 主引导大家购买$30 的 pro+订阅，不过它的默认竟然引导的是月订阅，而不是年订阅，不知道他们团队是如何考虑的。</p>
<p>先不管这个，我们取个折中，假设每个用户的付费是$20，那么每个月两千万的流量，有二十万的付费用户，等于它的 MRR 大概在 400 万左右。</p>
<p>所以，这也是一个妥妥的千万 ARR 的产品。虽然市场份额没有 remove.bg 高，但这收入也十分恐怖了，还没有算它的广告收入。</p>
<p>在我们上次估算 remove.bg 的收入，其实是低估了的，作为这个行业的大哥，肯定只多不少。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df207beb6e1141789221b1cb3db7a3ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=xSvUn6QPlnd0xDfeG5yk5YhzyWQ%3D" alt="" loading="lazy"/></p>
<p>说回这个 Pricing 页面，我觉得值得我们学习的是它用表格的方式列出了不同分级的权益，这也是 Pricing 页面的常用手段，对比会非常清晰。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd07c5bc37a9458e9b4d56d0706a4b8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=jSyvf82GIBgV9lUFzGsmXiBzOs8%3D" alt="" loading="lazy"/></p>
<p>另外，它还列出了不同模型的使用次数限制，这也是让人感觉非常清晰的一种表达，降低用户理解心智。</p>
<h2 data-id="heading-8"><strong>09 技术</strong> <strong>SEO</strong>**：三件套做满，多语言靠子路径**</h2>
<p>最后，我还想说一下，这个站点的 SEO 绝对是专业级别的，非常值得学习。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cc4c066e3314f67955be691577eb907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=br8cX93nCI1R7vDMrG%2FYg%2FcTI44%3D" alt="" loading="lazy"/></p>
<p>它的 hreflang 是很标准的，所有主流国家都有，以子路径作为区分，这是拉高站点流量权重非常重要的方式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/268e2dca0c134a869c93b8d302dcb6fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=7AtvEAQ3JbhA1OvyKm901MyjSsg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49b40c1456d5404cb2e02ac8d685d52c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=de88Xv5MykOCP%2FozB%2B7f3EhUx1c%3D" alt="" loading="lazy"/></p>
<p>其次，它是有结构化数据的，以及 opengraph，也是到位的，我觉得从技术 SEO 的角度来说，这三件套是值得我们学习的，也是容易被我们忽略的。</p>
<p>当然，它的 SEO 绝不仅仅是在技术层面的，内容层面可以看看它做了多少个内页的 tools：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d77e67143274ea08422c7bdf4ed6942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=%2BBdN%2B5MCi2279hkoJ5TuInwAPUo%3D" alt="" loading="lazy"/></p>
<p>以及，为每个 usecase 都做了配套的工具内页：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d04f81f90f794898b70cb365110fc346~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=Lh5EEiHJLhZyTs0LsjZ6DGcvF2Y%3D" alt="" loading="lazy"/></p>
<p>还有它的博客，每一篇也是精心设计，承接长尾词：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bde94d3c91c74952a197e2fc38fd385e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=sc8GB6KFsD5DmfhwlhQL52hwW0A%3D" alt="" loading="lazy"/></p>
<p>我觉得 SEO 其实说白了也很简单，但需要用心做，持续做，把内容做好，这是不容易的。</p>
<h2 data-id="heading-9">10 GEO 的时代已经来了！</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9e0ef82d988458186d457ee696d9766~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=93qENk3ssJvuGz656%2B6H0nULbEc%3D" alt="" loading="lazy"/></p>
<p>另外，我发现了这个站最大的彩蛋，就是它支持 llm.txt，这就是它的专业和前瞻性，在布局一个未来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c71720e6d7214db784d69b27e5f761a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765102736&amp;x-signature=wj5SFDrllLF2KWhAoou%2B6ZKrk10%3D" alt="" loading="lazy"/></p>
<p>果不其然，看看它的入站流量，chatGPT 直接带来了 20 万的量，朋友们，GEO 的时代到了啊！</p>
<h2 data-id="heading-10"><strong>11 可直接落地的 8 个要点</strong></h2>
<ol>
<li>
<p>需求词=域名，哪怕是新站也能快速起量。</p>
</li>
<li>
<p>TDH 与关键词密度围绕主需求词，品牌定位可放在文案，不影响 SEO。</p>
</li>
<li>
<p>多语言别盲翻，优先做高搜索量的目标词，逐词建内页。</p>
</li>
<li>
<p>工具页三段式：可用工具 → How-to/Feature 解释 → FAQ/证言/内链。</p>
</li>
<li>
<p>核心闭环免费，扩展功能再设门槛，别把登录放在第一步。</p>
</li>
<li>
<p>定价用对比表 + 调用次数限制，既清晰又方便 A/B。</p>
</li>
<li>
<p>技术 SEO 三件套（hreflang/结构化/OG）必做，能立刻抬权重。</p>
</li>
<li>
<p>提前布局 llm.txt，蹭生成式 AI 入口红利，别等流量被别人拿走。</p>
</li>
</ol>
<p>市场需求不可能被一家通吃。remove.bg 吃不完的上亿的需求词量，pixelcut 拿了一杯羹；2024 年才注册的 imgupscaler.ai 也跑到 400 万访问。</p>
<p>AI 时代的机会点就在这里：盯住真实的用户需求，快速做出可用产品，剩下的交给时间和流量。</p>
<p>好了，今天的分享就到这里了，我收获满满，大家有没有学到东西呢？咱们下期再见！</p>
<hr/>
<p>🚀 想要与更多AI爱好者交流，共同成长吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">和一群志同道合的人，持续精进 AI 的每一天</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SwiftUI和UIKit区别]]></title>    <link>https://juejin.cn/post/7577958825341812755</link>    <guid>https://juejin.cn/post/7577958825341812755</guid>    <pubDate>2025-11-30T03:21:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825341812755" data-draft-id="7577797563853455396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SwiftUI和UIKit区别"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2025-11-30T03:21:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卓尔山上刷力扣"/> <meta itemprop="url" content="https://juejin.cn/user/263471893337357"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SwiftUI和UIKit区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/263471893337357/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卓尔山上刷力扣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T03:21:43.000Z" title="Sun Nov 30 2025 03:21:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SwiftUI 和 UIKit 是苹果提供的两个 UI 框架，它们在设计理念、开发方式和能力上有显著区别：</p>
<ol>
<li>设计理念</li>
</ol>
<p>SwiftUI - 声明式</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isOn <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Toggle</span>(<span class="hljs-string">"开关"</span>, isOn: <span class="hljs-variable">$isOn</span>)
            <span class="hljs-keyword">if</span> isOn {
                <span class="hljs-type">Text</span>(<span class="hljs-string">"开关已打开"</span>)
                    .foregroundColor(.green)
            }
        }
        .padding()
    }
}
</code></pre>
<p>UIKit - 命令式</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> toggle <span class="hljs-operator">=</span> <span class="hljs-type">UISwitch</span>()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> label <span class="hljs-operator">=</span> <span class="hljs-type">UILabel</span>()
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        setupUI()
        toggle.addTarget(<span class="hljs-keyword">self</span>, action: <span class="hljs-keyword">#selector</span>(toggleChanged), for: .valueChanged)
    }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">toggleChanged</span>() {
        label.isHidden <span class="hljs-operator">=</span> <span class="hljs-operator">!</span>toggle.isOn
        label.text <span class="hljs-operator">=</span> <span class="hljs-string">"开关已打开"</span>
        label.textColor <span class="hljs-operator">=</span> .green
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">setupUI</span>() {
        <span class="hljs-comment">// 手动创建和配置所有视图</span>
    }
}
</code></pre>
<ol start="2">
<li>数据绑定和状态管理</li>
</ol>
<p>SwiftUI - 自动响应</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UserProfile</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username <span class="hljs-operator">=</span> <span class="hljs-string">""</span>
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> viewModel <span class="hljs-operator">=</span> <span class="hljs-type">ProfileViewModel</span>()
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">TextField</span>(<span class="hljs-string">"用户名"</span>, text: <span class="hljs-variable">$username</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"你好, <span class="hljs-subst">\(username)</span>"</span>)
                .opacity(username.isEmpty <span class="hljs-operator">?</span> <span class="hljs-number">0</span> : <span class="hljs-number">1</span>)
            
            <span class="hljs-type">Button</span>(<span class="hljs-string">"保存"</span>) {
                viewModel.saveUser(name: username)
            }
        }
    }
}
</code></pre>
<p>UIKit - 手动更新</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileViewController</span>: <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> usernameField: <span class="hljs-type">UITextField</span>!
    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> greetingLabel: <span class="hljs-type">UILabel</span>!
    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> saveButton: <span class="hljs-type">UIButton</span>!
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        usernameField.addTarget(<span class="hljs-keyword">self</span>, action: <span class="hljs-keyword">#selector</span>(textFieldChanged), for: .editingChanged)
    }
    
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">textFieldChanged</span>() {
        <span class="hljs-keyword">let</span> username <span class="hljs-operator">=</span> usernameField.text <span class="hljs-operator">??</span> <span class="hljs-string">""</span>
        greetingLabel.text <span class="hljs-operator">=</span> <span class="hljs-string">"你好, <span class="hljs-subst">\(username)</span>"</span>
        greetingLabel.isHidden <span class="hljs-operator">=</span> username.isEmpty
        saveButton.isEnabled <span class="hljs-operator">=</span> <span class="hljs-operator">!</span>username.isEmpty
    }
}
</code></pre>
<ol start="3">
<li>布局系统</li>
</ol>
<p>SwiftUI - 修饰符布局</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">VStack</span>(spacing: <span class="hljs-number">20</span>) {
    <span class="hljs-type">Text</span>(<span class="hljs-string">"标题"</span>)
        .font(.title)
        .padding()
    
    <span class="hljs-type">HStack</span> {
        <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"star"</span>)
        <span class="hljs-type">Text</span>(<span class="hljs-string">"评分: 4.8"</span>)
    }
    
    <span class="hljs-type">Spacer</span>()
    
    <span class="hljs-type">Button</span>(<span class="hljs-string">"确认"</span>) { }
        .frame(maxWidth: .infinity)
        .padding()
}
.background(<span class="hljs-type">Color</span>.gray.opacity(<span class="hljs-number">0.1</span>))
</code></pre>
<p>UIKit - 自动布局约束</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">setupConstraints</span>() {
    <span class="hljs-type">NSLayoutConstraint</span>.activate([
        titleLabel.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor, constant: <span class="hljs-number">20</span>),
        titleLabel.centerXAnchor.constraint(equalTo: view.centerXAnchor),
        
        stackView.topAnchor.constraint(equalTo: titleLabel.bottomAnchor, constant: <span class="hljs-number">20</span>),
        stackView.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: <span class="hljs-number">16</span>),
        stackView.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: <span class="hljs-operator">-</span><span class="hljs-number">16</span>),
        
        confirmButton.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor, constant: <span class="hljs-operator">-</span><span class="hljs-number">20</span>),
        confirmButton.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: <span class="hljs-number">16</span>),
        confirmButton.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: <span class="hljs-operator">-</span><span class="hljs-number">16</span>),
        confirmButton.heightAnchor.constraint(equalToConstant: <span class="hljs-number">50</span>)
    ])
}
</code></pre>
<ol start="4">
<li>视图生命周期</li>
</ol>
<p>SwiftUI - 基于视图结构</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LifecycleView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"示例"</span>)
    }
    
    <span class="hljs-comment">// 生命周期事件</span>
    .onAppear {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"视图出现"</span>)
    }
    .onDisappear {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"视图消失"</span>)
    }
    .task {
        <span class="hljs-comment">// 异步任务，自动取消</span>
        <span class="hljs-keyword">await</span> loadData()
    }
}
</code></pre>
<p>UIKit - 基于视图控制器</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LifecycleViewController</span>: <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        <span class="hljs-comment">// 视图加载完成</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewWillAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewWillAppear(animated)
        <span class="hljs-comment">// 视图将要出现</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidAppear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewDidAppear(animated)
        <span class="hljs-comment">// 视图已经出现</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewWillDisappear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewWillDisappear(animated)
        <span class="hljs-comment">// 视图将要消失</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidDisappear</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animated</span>: <span class="hljs-type">Bool</span>) {
        <span class="hljs-keyword">super</span>.viewDidDisappear(animated)
        <span class="hljs-comment">// 视图已经消失</span>
    }
}
</code></pre>
<ol start="5">
<li>列表和集合视图</li>
</ol>
<p>SwiftUI - List 和 ForEach</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UserListView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">let</span> users: [<span class="hljs-type">User</span>]
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">List</span>(users) { user <span class="hljs-keyword">in</span>
            <span class="hljs-type">HStack</span> {
                <span class="hljs-type">AsyncImage</span>(url: user.avatarURL) { image <span class="hljs-keyword">in</span>
                    image.resizable()
                } placeholder: {
                    <span class="hljs-type">ProgressView</span>()
                }
                .frame(width: <span class="hljs-number">50</span>, height: <span class="hljs-number">50</span>)
                .clipShape(<span class="hljs-type">Circle</span>())
                
                <span class="hljs-type">VStack</span>(alignment: .leading) {
                    <span class="hljs-type">Text</span>(user.name)
                        .font(.headline)
                    <span class="hljs-type">Text</span>(user.email)
                        .font(.subheadline)
                        .foregroundColor(.gray)
                }
            }
            .swipeActions {
                <span class="hljs-type">Button</span>(<span class="hljs-string">"删除"</span>, role: .destructive) {
                    deleteUser(user)
                }
            }
        }
        .refreshable {
            <span class="hljs-keyword">await</span> refreshUsers()
        }
    }
}
</code></pre>
<p>UIKit - UITableView</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListViewController</span>: <span class="hljs-title class_">UITableViewController</span> {
    <span class="hljs-keyword">var</span> users: [<span class="hljs-type">User</span>] <span class="hljs-operator">=</span> []
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">return</span> users.count
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {
        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">"UserCell"</span>, for: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">UserCell</span>
        <span class="hljs-keyword">let</span> user <span class="hljs-operator">=</span> users[indexPath.row]
        cell.configure(with: user)
        <span class="hljs-keyword">return</span> cell
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">commit</span> <span class="hljs-params">editingStyle</span>: <span class="hljs-type">UITableViewCell</span>.<span class="hljs-type">EditingStyle</span>, <span class="hljs-params">forRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {
        <span class="hljs-keyword">if</span> editingStyle <span class="hljs-operator">==</span> .delete {
            deleteUser(at: indexPath)
        }
    }
}
</code></pre>
<ol start="6">
<li>动画和过渡</li>
</ol>
<p>SwiftUI - 隐式动画</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">AnimatedView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isExpanded <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"切换"</span>) {
                withAnimation(.spring()) {
                    isExpanded.toggle()
                }
            }
            
            <span class="hljs-type">Rectangle</span>()
                .fill(<span class="hljs-type">Color</span>.blue)
                .frame(
                    width: isExpanded <span class="hljs-operator">?</span> <span class="hljs-number">200</span> : <span class="hljs-number">100</span>,
                    height: isExpanded <span class="hljs-operator">?</span> <span class="hljs-number">200</span> : <span class="hljs-number">100</span>
                )
                .rotationEffect(.degrees(isExpanded <span class="hljs-operator">?</span> <span class="hljs-number">180</span> : <span class="hljs-number">0</span>))
        }
    }
}
</code></pre>
<p>UIKit - 显式动画</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnimatedViewController</span>: <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> boxView: <span class="hljs-type">UIView</span>!
    <span class="hljs-keyword">var</span> isExpanded <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">toggleTapped</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-type">UIButton</span>) {
        <span class="hljs-type">UIView</span>.animate(withDuration: <span class="hljs-number">0.5</span>, 
                      delay: <span class="hljs-number">0</span>,
                      usingSpringWithDamping: <span class="hljs-number">0.6</span>,
                      initialSpringVelocity: <span class="hljs-number">0</span>,
                      options: []) {
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.isExpanded {
                <span class="hljs-keyword">self</span>.boxView.transform <span class="hljs-operator">=</span> <span class="hljs-type">CGAffineTransform</span>.identity
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">self</span>.boxView.transform <span class="hljs-operator">=</span> <span class="hljs-type">CGAffineTransform</span>(rotationAngle: .pi)
                    .scaledBy(x: <span class="hljs-number">2</span>, y: <span class="hljs-number">2</span>)
            }
        } completion: { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span>.isExpanded.toggle()
        }
    }
}
</code></pre>
<ol start="7">
<li>导航和路由</li>
</ol>
<p>SwiftUI - NavigationStack</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MainApp</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">NavigationStack</span> {
            <span class="hljs-type">List</span> {
                <span class="hljs-type">NavigationLink</span>(<span class="hljs-string">"用户详情"</span>, value: <span class="hljs-string">"user_detail"</span>)
                <span class="hljs-type">NavigationLink</span>(<span class="hljs-string">"设置"</span>, value: <span class="hljs-string">"settings"</span>)
            }
            .navigationDestination(for: <span class="hljs-type">String</span>.<span class="hljs-keyword">self</span>) { route <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">switch</span> route {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"user_detail"</span>:
                    <span class="hljs-type">UserDetailView</span>()
                <span class="hljs-keyword">case</span> <span class="hljs-string">"settings"</span>:
                    <span class="hljs-type">SettingsView</span>()
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-type">Text</span>(<span class="hljs-string">"未知页面"</span>)
                }
            }
        }
    }
}
</code></pre>
<p>UIKit - UINavigationController</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainViewController</span>: <span class="hljs-title class_">UITableViewController</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">didSelectRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {
        <span class="hljs-keyword">switch</span> indexPath.row {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
            <span class="hljs-keyword">let</span> userDetailVC <span class="hljs-operator">=</span> <span class="hljs-type">UserDetailViewController</span>()
            navigationController<span class="hljs-operator">?</span>.pushViewController(userDetailVC, animated: <span class="hljs-literal">true</span>)
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            <span class="hljs-keyword">let</span> settingsVC <span class="hljs-operator">=</span> <span class="hljs-type">SettingsViewController</span>()
            navigationController<span class="hljs-operator">?</span>.pushViewController(settingsVC, animated: <span class="hljs-literal">true</span>)
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">break</span>
        }
    }
}
</code></pre>
<ol start="8">
<li>主要区别总结</li>
</ol>
<p>特性 SwiftUI UIKit
编程范式 声明式 命令式
数据流 响应式数据绑定 手动更新
布局 基于栈的布局系统 Auto Layout 约束
状态管理 @State, @Binding, @ObservedObject 手动管理状态
预览 实时预览 Interface Builder
跨平台 iOS, macOS, watchOS, tvOS 主要 iOS/tvOS
学习曲线 相对平缓 相对陡峭
代码量 通常更少 通常更多
版本要求 iOS 13+ iOS 2+
性能 优化良好，持续改进 成熟稳定</p>
<ol start="9">
<li>混合使用</li>
</ol>
<p>在实际项目中，可以混合使用两者：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 在 SwiftUI 中使用 UIKit 组件</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MapView</span>: <span class="hljs-title class_">UIViewRepresentable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">MKMapView</span> {
        <span class="hljs-type">MKMapView</span>()
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiView</span>: <span class="hljs-type">MKMapView</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {
        <span class="hljs-comment">// 更新地图</span>
    }
}

<span class="hljs-comment">// 在 UIKit 中使用 SwiftUI</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HostingViewController</span>: <span class="hljs-title class_">UIViewController</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        
        <span class="hljs-keyword">let</span> swiftUIView <span class="hljs-operator">=</span> <span class="hljs-type">ContentView</span>()
        <span class="hljs-keyword">let</span> hostingController <span class="hljs-operator">=</span> <span class="hljs-type">UIHostingController</span>(rootView: swiftUIView)
        
        addChild(hostingController)
        view.addSubview(hostingController.view)
        hostingController.didMove(toParent: <span class="hljs-keyword">self</span>)
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python数据分析实战：从超市销售到教学评估]]></title>    <link>https://juejin.cn/post/7577914902430400558</link>    <guid>https://juejin.cn/post/7577914902430400558</guid>    <pubDate>2025-11-30T06:42:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902430400558" data-draft-id="7576853741758087202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python数据分析实战：从超市销售到教学评估"/> <meta itemprop="keywords" content="Python,PyCharm,编程语言"/> <meta itemprop="datePublished" content="2025-11-30T06:42:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="今天没有盐"/> <meta itemprop="url" content="https://juejin.cn/user/1408937846645355"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python数据分析实战：从超市销售到教学评估
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1408937846645355/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    今天没有盐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T06:42:50.000Z" title="Sun Nov 30 2025 06:42:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">导入</h2>
<p>在当今数据驱动的时代，数据分析能力已成为程序员和数据分析师的必备技能。Python凭借其强大的生态系统（pandas、numpy、matplotlib等）在数据处理和可视化领域占据重要地位。本文将通过四个真实场景的数据分析案例，全面展示Python在数据处理、统计分析和可视化方面的强大能力。</p>
<h2 data-id="heading-1">题目一：超市商品销售数据分析</h2>
<p>"超市销售数据.csv" 包含字段："日期""商品类别""商品名称""销售数量""单价 (元)""会员等级 (普通 / 银卡 / 金卡)"。</p>
<h4 data-id="heading-2">代码</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 1. 读取 CSV 文件数据，将 "日期" 转换为 datetime 格式。</span>
df = pd.read_csv(
    <span class="hljs-string">"超市销售数据.csv"</span>,
    encoding=<span class="hljs-string">"utf-8"</span>
)
<span class="hljs-built_in">print</span>(df)
df[<span class="hljs-string">'日期'</span>] = pd.to_datetime(df[<span class="hljs-string">'日期'</span>])
<span class="hljs-built_in">print</span>(df[<span class="hljs-string">'日期'</span>].dtype)

<span class="hljs-comment"># 2. 计算每类商品的总销售额（销售数量 × 单价）和平均销售单价。</span>
df[<span class="hljs-string">'销售额'</span>] = df[<span class="hljs-string">'销售数量'</span>] * df[<span class="hljs-string">'单价 (元)'</span>]
total_sales = df.groupby(<span class="hljs-string">'商品类别'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>()
mean_sales = df.groupby(<span class="hljs-string">'商品类别'</span>)[<span class="hljs-string">'单价 (元)'</span>].mean()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"每类商品的总销售额为：\n"</span>, total_sales)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"每类商品的平均销售单价为：\n"</span>, mean_sales)

<span class="hljs-comment"># 3. 按 "会员等级" 分组，统计不同等级会员的总消费金额和平均单次消费金额。</span>
total_sales = df.groupby(<span class="hljs-string">'会员等级 (普通/银卡/金卡)'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>()
counts_sales = df.groupby(<span class="hljs-string">'会员等级 (普通/银卡/金卡)'</span>)[<span class="hljs-string">'销售数量'</span>].<span class="hljs-built_in">sum</span>()
mean_sales = total_sales / counts_sales
<span class="hljs-built_in">print</span>(<span class="hljs-string">"不同等级会员的总销售额为：\n"</span>, total_sales)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"不同等级会员的平均单次消费金额为：\n"</span>, mean_sales)

<span class="hljs-comment"># 4. 提取 "日期" 中的月份，绘制每月总销售额的柱状图。</span>
df[<span class="hljs-string">'月份'</span>] = df[<span class="hljs-string">'日期'</span>].dt.month
total_sales = df.groupby(<span class="hljs-string">'月份'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>()
plt.bar(total_sales.index, total_sales)
plt.show()

<span class="hljs-comment"># 5. 找出总销售额最高的 5 种商品，用饼图展示它们的销售额占比。</span>
plt.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = [<span class="hljs-string">'SimHei'</span>]
product_sales = df.groupby(<span class="hljs-string">'商品名称'</span>)[<span class="hljs-string">'销售额'</span>].<span class="hljs-built_in">sum</span>().sort_values(ascending=<span class="hljs-literal">False</span>)
<span class="hljs-built_in">print</span>(product_sales)
top5 = product_sales.head(<span class="hljs-number">5</span>) <span class="hljs-comment"># 前5个</span>
top5_sum = top5.<span class="hljs-built_in">sum</span>()
top5_pie = top5 / top5_sum
<span class="hljs-built_in">print</span>(top5_pie)
plt.pie(top5_pie, labels=top5_pie.index,autopct=<span class="hljs-string">"%1.1f%%"</span>)
plt.show()
</code></pre>
<h4 data-id="heading-3">代码结果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e70e6d85d3df4fd58000c9cb968b810b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765089770&amp;x-signature=Bg%2Bmp0HKITXP6thEIheV9IOvwl8%3D" alt="101.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b49911c94ca14733b9b036ee76456dcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765089770&amp;x-signature=fl5P2gVTKaz7DGaK%2BVvlTuBZN4o%3D" alt="101-2.png" loading="lazy"/></p>
<h2 data-id="heading-4">题目二：线上书店订单数据分析</h2>
<p>"书店订单数据.csv" 包含字段："订单 ID""用户 ID""图书类别""购买数量""图书定价 (元)""折扣率 (0.7-1.0)""支付时间"。</p>
<h4 data-id="heading-5">代码</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. 读取 CSV 文件数据，计算实际支付金额（图书定价 × 折扣率 × 购买数量），添加为新列。</span>
data = pd.read_csv(
    <span class="hljs-string">"书店订单数据.csv"</span>,
    encoding=<span class="hljs-string">"utf-8"</span>,
    index_col=<span class="hljs-string">"订单ID"</span>
)
<span class="hljs-built_in">print</span>(data)
data[<span class="hljs-string">'实际支付金额'</span>] = data[<span class="hljs-string">'图书定价 (元)'</span>] * data[<span class="hljs-string">'折扣率 (0.7-1.0)'</span>] * data[<span class="hljs-string">'购买数量'</span>]
<span class="hljs-built_in">print</span>(data)

<span class="hljs-comment"># 2. 按 "图书类别" 分组，统计各类别的总销量和总实际支付金额。</span>
states = data.groupby(<span class="hljs-string">'图书类别'</span>).agg({<span class="hljs-string">"购买数量"</span>:<span class="hljs-string">"sum"</span>, <span class="hljs-string">"实际支付金额"</span>:<span class="hljs-string">"sum"</span>})
<span class="hljs-built_in">print</span>(states)

<span class="hljs-comment"># 3. 计算所有订单的实际支付金额的均值、中位数和标准差。</span>
new_states = data[<span class="hljs-string">'实际支付金额'</span>].agg([<span class="hljs-string">'mean'</span>, <span class="hljs-string">'median'</span>, <span class="hljs-string">'std'</span>])
<span class="hljs-built_in">print</span>(new_states)

<span class="hljs-comment"># 4. 筛选出购买数量 ≥3 本的订单，保存为新 CSV 文件 "大额订单.csv"（不含索引）。</span>
tmp = data[data[<span class="hljs-string">'购买数量'</span>] &gt;= <span class="hljs-number">3</span>]
<span class="hljs-built_in">print</span>(tmp)
tmp.to_csv(
    <span class="hljs-string">'大额订单.csv'</span>
)
</code></pre>
<h4 data-id="heading-6">代码结果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c08dbe89d9d64bcba8397fc34ac902ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765089770&amp;x-signature=txn0I424%2BThsynStvImefVCWSJc%3D" alt="102.png" loading="lazy"/></p>
<h2 data-id="heading-7">题目三：学生考试成绩数据分析</h2>
<p>"考试成绩数据.csv" 包含字段："班级""学号""姓名""语文""数学""英语""理综 / 文综""考试时间"。</p>
<h4 data-id="heading-8">代码</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. 读取 CSV 文件数据，计算每位学生的总分（四门科目之和）和平均分，添加为新列。</span>
df = pd.read_csv(
    <span class="hljs-string">"考试成绩数据.csv"</span>
)
<span class="hljs-built_in">print</span>(df)
subjects = [<span class="hljs-string">'语文'</span>,<span class="hljs-string">'数学'</span>,<span class="hljs-string">'英语'</span>,<span class="hljs-string">'理综/文综'</span>]
df[<span class="hljs-string">'总分'</span>] = df[subjects].<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">1</span>)
df[<span class="hljs-string">'平均分'</span>] = df[subjects].mean(axis=<span class="hljs-number">1</span>)
<span class="hljs-built_in">print</span>(df)

<span class="hljs-comment"># 2. 按 "班级" 分组，统计各科目的平均分、最高分和最低分（使用 agg 函数批量统计）。</span>
states = df.groupby(<span class="hljs-string">'班级'</span>)[subjects].agg([<span class="hljs-string">'mean'</span>,<span class="hljs-string">'max'</span>,<span class="hljs-string">'min'</span>])
<span class="hljs-built_in">print</span>(states)

<span class="hljs-comment"># 3. 筛选出总分 ≥600 分的学生，统计每个班级的高分人数，绘制柱状图。</span>
plt.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = [<span class="hljs-string">'SimHei'</span>]
high_student = df[df[<span class="hljs-string">'总分'</span>] &gt;= <span class="hljs-number">600</span>]
high_counts = high_student[<span class="hljs-string">'班级'</span>].value_counts().sort_index()
plt.bar(high_counts.index, high_counts)
plt.show()

<span class="hljs-comment"># 4. 计算数学成绩与理综/文综成绩的相关系数。</span>
corr = df[<span class="hljs-string">'数学'</span>].corr(df[<span class="hljs-string">'理综/文综'</span>])
<span class="hljs-built_in">print</span>(corr)

<span class="hljs-comment"># 5. 提取 "考试时间" 中的月份，统计不同月份的平均总分变化，绘制折线图。</span>
df[<span class="hljs-string">'考试时间'</span>] = pd.to_datetime(df[<span class="hljs-string">'考试时间'</span>])
df[<span class="hljs-string">'月份'</span>] = df[<span class="hljs-string">'考试时间'</span>].dt.month
month_score = df.groupby(<span class="hljs-string">'月份'</span>)[<span class="hljs-string">'总分'</span>].mean()
plt.plot(month_score.index, month_score)
plt.show()
</code></pre>
<h4 data-id="heading-9">代码结果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d630fccdfbbf49a68e2b27d856ea3b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765089770&amp;x-signature=QjRL7HKTRjEaPllI9l5IqZYXjUk%3D" alt="103.png" loading="lazy"/></p>
<h2 data-id="heading-10">题目四：教师教学评价数据分析</h2>
<p>"教学评价数据.csv" 包含字段："教师 ID""学科""授课班级""学生评分 (1-5 分)""评价人数""评价日期"。</p>
<h4 data-id="heading-11">代码</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. 读取 CSV 文件数据，将 "评价日期" 转换为 datetime 格式。</span>
data = pd.read_csv(
    <span class="hljs-string">"教学评价数据.csv"</span>
)
<span class="hljs-built_in">print</span>(data)
data[<span class="hljs-string">'评价日期'</span>] = pd.to_datetime(data[<span class="hljs-string">'评价日期'</span>])
<span class="hljs-built_in">print</span>(data)

<span class="hljs-comment"># 2. 计算每位教师的总评分（学生评分 × 评价人数）和平均评分，添加为新列。</span>
data[<span class="hljs-string">'总评分'</span>] = data[<span class="hljs-string">'学生评分 (1-5分)'</span>] * data[<span class="hljs-string">'评价人数'</span>]
mean_score = data.groupby(<span class="hljs-string">'教师ID'</span>)[<span class="hljs-string">'学生评分 (1-5分)'</span>].mean()
<span class="hljs-built_in">print</span>(data)
<span class="hljs-built_in">print</span>(mean_score)

<span class="hljs-comment"># 3. 按 "学科" 分组，统计各学科的平均评分和总评价人数。</span>
states = data.groupby(<span class="hljs-string">'学科'</span>).agg({
    <span class="hljs-string">'总评分'</span>:<span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'评价人数'</span>:<span class="hljs-string">'sum'</span>
})
states = states.rename(columns={<span class="hljs-string">'总评分'</span>:<span class="hljs-string">'平均评分'</span>})
<span class="hljs-built_in">print</span>(states)

<span class="hljs-comment"># 4. 提取 "评价日期" 中的星期信息，统计每周各天的评价数量，绘制柱状图。</span>
data[<span class="hljs-string">'评价日期'</span>] = pd.to_datetime(data[<span class="hljs-string">'评价日期'</span>])
data[<span class="hljs-string">'星期'</span>] = data[<span class="hljs-string">'评价日期'</span>].dt.weekday + <span class="hljs-number">1</span>
counts = data.groupby(<span class="hljs-string">'星期'</span>)[<span class="hljs-string">'评价人数'</span>].<span class="hljs-built_in">sum</span>()
<span class="hljs-built_in">print</span>(counts)
plt.bar(counts.index, counts)
plt.show()

<span class="hljs-comment"># 5. 找出平均评分最高的 3 位教师，用饼图展示他们的总评分占比。</span>
mean_score = mean_score.sort_values(ascending=<span class="hljs-literal">False</span>) <span class="hljs-comment"># 降序排序</span>
<span class="hljs-built_in">print</span>(mean_score)
top3 = mean_score[:<span class="hljs-number">3</span>]
total = mean_score.<span class="hljs-built_in">sum</span>() <span class="hljs-comment"># 总评分</span>
top3_rate = top3 / total
plt.pie(top3_rate, labels=top3_rate.index,autopct=<span class="hljs-string">"%1.1f%%"</span>)
plt.show()
</code></pre>
<h4 data-id="heading-12">代码结果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77f48614bfa2461e9f70879197c8412e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765089770&amp;x-signature=JOjHytGqjqEekgA755mkD9KiO5s%3D" alt="104.png" loading="lazy"/></p>
<h2 data-id="heading-13">总结</h2>
<ol>
<li>
<p><strong>数据读取与预处理</strong></p>
<ul>
<li>多种数据格式的读取（CSV）</li>
<li>数据类型转换（日期时间处理）</li>
<li>数据清洗和列操作</li>
</ul>
</li>
<li>
<p><strong>数据计算与转换</strong></p>
<ul>
<li>派生列的计算创建</li>
<li>分组聚合统计</li>
<li>多维度数据透视</li>
</ul>
</li>
<li>
<p><strong>统计分析技术</strong></p>
<ul>
<li>描述性统计（均值、中位数、标准差）</li>
<li>相关性分析</li>
<li>排名和筛选</li>
</ul>
</li>
<li>
<p><strong>数据可视化</strong></p>
<ul>
<li>多种图表类型应用（柱状图、饼图、折线图）</li>
<li>中文显示处理</li>
<li>图表美化和标签设置</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[D2L(1) — 线性回归]]></title>    <link>https://juejin.cn/post/7577718777482412070</link>    <guid>https://juejin.cn/post/7577718777482412070</guid>    <pubDate>2025-11-30T10:38:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577718777482412070" data-draft-id="7574817463448125491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="D2L(1) — 线性回归"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T10:38:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IguoChan"/> <meta itemprop="url" content="https://juejin.cn/user/655780651999720"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            D2L(1) — 线性回归
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/655780651999720/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IguoChan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:38:41.000Z" title="Sun Nov 30 2025 10:38:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">0. 背景</h2>
<p>虽然一直从事的是工程开发，但是目前从事的工作和算法、特别是大模型相关，因此想了解一下算法的相关基础，而d2l就是入门的教程，可参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.d2l.ai%2Findex.html" target="_blank" title="https://zh.d2l.ai/index.html" ref="nofollow noopener noreferrer">dl2</a>。</p>
<blockquote>
<p><em>回归</em>（regression）是能为一个或多个自变量与因变量之间关系建模的一类方法。 在自然科学和社会科学领域，回归经常用来表示输入和输出之间的关系。</p>
</blockquote>
<p>比如书中中的线性回归就是一个特别简单的例子，即<code>根据房屋的面积（平方英尺）和房龄（年）来估算房屋价格（美元）</code>。从简单的直观感受来说，房子的价格应该和面积成一定的正比，和房龄成反比。</p>
<p>其实在书中，已经将基本的原理介绍得很清楚了，但是有些地方对于年逾三十，离开大学很久的我来说理解起来不是那么直观，所以我这边会详细描述我所困在的点。</p>
<h2 data-id="heading-1">1. 基本推导</h2>
<h3 data-id="heading-2">1.1 线性模型</h3>
<p>这里的算法其实很简单，根据过往历史值求出根据某房屋面积和房龄的预测值，即可得以下公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo>=</mo><msub><mi>w</mi><mrow><mi>a</mi><mi>r</mi><mi>e</mi><mi>a</mi></mrow></msub><mo>×</mo><mi>a</mi><mi>r</mi><mi>e</mi><mi>a</mi><mo>+</mo><msub><mi>w</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub><mo>×</mo><mi>a</mi><mi>g</mi><mi>e</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">price = w_{area} \times area + w_{age} \times age + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></div>
<p>这里<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mi>a</mi><mi>r</mi><mi>e</mi><mi>a</mi><mo separator="true">,</mo><mi>a</mi><mi>g</mi><mi>e</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{area, age\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mclose">}</span></span></span></span></span>被称为特征，而<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><msub><mi>w</mi><mrow><mi>a</mi><mi>r</mi><mi>e</mi><mi>a</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{w_{area}, w_{age}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>被称为权重，使用向量<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{x} = \{ x_1, x_2 \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>表征特征，向量<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{w} = \{ w_1, w_2 \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>表征权重，则针对于输入为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{ x_1, x_2\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">}</span></span></span></span></span>的预测值 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span></span></span></span></span> 的计算公式如下：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>=</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><mi mathvariant="bold">x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\hat{y} = \mathbf{w}^\mathrm T\mathbf{x} + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9747em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></div>
<p>那对于一系列的特征集合<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">X</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>r</mi><mi>e</mi><msub><mi>a</mi><mn>1</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>r</mi><mi>e</mi><msub><mi>a</mi><mn>2</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>g</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>r</mi><mi>e</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mi>g</mi><msub><mi>e</mi><mi>n</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{X} = 
\begin{pmatrix}
    area_1 &amp; age_1 \\
    area_2 &amp; age_2 \\
    ... \\
    area_n &amp; age_n
    \end{pmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6861em;"/><span class="mord mathbf">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"/><span style="width:0.875em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="4.800em" viewbox="0 0 875 4800"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1&#10;c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,&#10;-36,557 l0,1284c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,&#10;949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9&#10;c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,&#10;-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189&#10;l0,-1292c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,&#10;-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">...</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em;"><span style="top:-4.65em;"><span class="pstrut" style="height:6.8em;"/><span style="width:0.875em;height:4.800em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="4.800em" viewbox="0 0 875 4800"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,&#10;63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5&#10;c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,1209&#10;c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664&#10;c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11&#10;c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17&#10;c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558&#10;l0,-1344c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,&#10;-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em;"><span/></span></span></span></span></span></span></span></span></span></span>，则整个预测值的预测曲线可以表征为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><mi mathvariant="bold">y</mi><mo>^</mo></mover><mo>=</mo><mi mathvariant="bold">X</mi><mi mathvariant="bold">w</mi><mo>+</mo><mi mathvariant="bold">b</mi></mrow><annotation encoding="application/x-tex">\mathbf{\hat{y}} = \mathbf{X}\mathbf{w}+\mathbf{b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9023em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2875em;"><span class="mord mathbf">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7694em;vertical-align:-0.0833em;"/><span class="mord mathbf" style="margin-right:0.01597em;">Xw</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathbf">b</span></span></span></span></span></div>
<p>其中<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">b</mi><mo>=</mo><mo stretchy="false">{</mo><mi>b</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{b} = \{b,b,...,b\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">{</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mclose">}</span></span></span></span></span>。</p>
<p>那其实线性回归本质上就是求取一组 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> ，使得预测值和样本值之间的误差尽可能的小。</p>
<p>所以本质问题变成了：</p>
<ul>
<li><strong>怎么计算误差？</strong></li>
<li><strong>怎么使得误差减小？</strong></li>
</ul>
<h3 data-id="heading-3">1.2 怎么计算误差（损失函数）</h3>
<p>对于线性模型，我们可以很容易的使用平方差作为其损失函数：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">L(\mathbf{w}, b) = \frac{1}{n} \sum_{i=1}^{n} \frac{1}{2}(\hat{y}^{(i)} - y^{(i)})^2 = \frac{1}{n} \sum_{i=1}^{n} \frac{1}{2}(\mathbf{w}^\mathrm T\mathbf{x}^{(i)} + b - y^{(i)})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></div>
<h3 data-id="heading-4">1.3 怎么使得误差减小（随机梯度下降）</h3>
<p>其实这里也是我最开始不太理解的地方：</p>
<ul>
<li>书中这个最终的公式是怎么推导的？</li>
<li>怎么理解这个梯度下降的过程？</li>
</ul>
<p>首先我们计算单个样本的损失：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">(</mo><mi mathvariant="bold">w</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">l^{(i)}(\mathbf{w}, b) = \frac{1}{2}(\hat{y}^{(i)} - y^{(i)})^2 = \frac{1}{2}(\mathbf{w}^\mathrm T\mathbf{x}^{(i)} + b - y^{(i)})^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>对于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> 中某个权重 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">w_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 梯度：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mo>⋅</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial l^{(i)}}{\partial w_j} = \frac{\partial l^{(i)}}{\partial \hat{y}^{(i)}} \cdot \frac{\partial \hat{y}^{(i)}}{\partial w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.5371em;vertical-align:-0.9721em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4634em;vertical-align:-0.8984em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.5371em;vertical-align:-0.9721em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>而：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow></mfrac><mo>=</mo><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\frac{\partial l^{(i)}}{\partial \hat{y}^{(i)}} = \hat{y}^{(i)} - y^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4634em;vertical-align:-0.8984em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1324em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1324em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>又因为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>=</mo><msub><mi>w</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>w</mi><mi>n</mi></msub><msub><mi>x</mi><mi>n</mi></msub><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\hat{y} = w_1x_1 + w_2x_2+ ... +w_nx_n + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>，所以：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial \hat{y}^{(i)}}{\partial w_j} = x_j^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.5371em;vertical-align:-0.9721em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>所以单个样本的损失：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><msup><mi>l</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><mo stretchy="false">(</mo><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>⋅</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>⋅</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial l^{(i)}}{\partial w_j} = (\hat{y}^{(i)} - y^{(i)}) \cdot x_j^{(i)} = (\mathbf{w}^\mathrm T\mathbf{x}^{(i)} + b - y^{(i)}) \cdot x_j^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.5371em;vertical-align:-0.9721em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.565em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>所以对于所有样本的损失：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msup><mover accent="true"><mi>y</mi><mo>^</mo></mover><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>⋅</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo>⋅</mo><msubsup><mi>x</mi><mi>j</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial w_j} = \frac{1}{n} \sum_{i=1}^{n}(\hat{y}^{(i)} - y^{(i)}) \cdot x_j^{(i)} = \frac{1}{n} \sum_{i=1}^{n}(\mathbf{w}^\mathrm T\mathbf{x}^{(i)} + b - y^{(i)}) \cdot x_j^{(i)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.3435em;vertical-align:-0.9721em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>那么针对所有的权重，其梯度向量为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">∇</mi><mi>w</mi></msub><mi>L</mi><mo>=</mo><mo stretchy="false">{</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>1</mn></msub></mrow></mfrac><mo separator="true">,</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mn>2</mn></msub></mrow></mfrac><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>n</mi></msub></mrow></mfrac><mo stretchy="false">}</mo><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msup><mi mathvariant="bold">X</mi><mi mathvariant="normal">T</mi></msup><mo stretchy="false">(</mo><mover accent="true"><mi>y</mi><mo>^</mo></mover><mo>−</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\nabla_wL = \{\frac{\partial L}{\partial w_1}, \frac{\partial L}{\partial w_2},...,\frac{\partial L}{\partial w_n}\} = \frac{1}{n}\mathbf{X}^\mathrm T(\hat{y} - y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord">∇</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.2074em;vertical-align:-0.836em;"/><span class="mopen">{</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord"><span class="mord mathbf">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></div>
<p>我们来简单理解一下上面冰冷的公式：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial w_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4224em;vertical-align:-0.5423em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5423em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span> 梯度表示在<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">w_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>这个方向上，在<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">w_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>这个位置上的斜率，那么我们要找到使得函数更小的点，就应该朝着反方向挪动一步，使其向极小值收敛。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="bold">w</mi><mo>←</mo><mi mathvariant="bold">w</mi><mo>−</mo><mfrac><mi>η</mi><mi>m</mi></mfrac><mo>⋅</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{w} \leftarrow  \mathbf{w} - \frac{\eta}{m} \cdot \sum_{i=1}^{m} \mathbf{x}^{(i)} (\mathbf{w}^\mathrm T\mathbf{x}^{(i)} + b - y^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">η</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<p>其中，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi></mrow><annotation encoding="application/x-tex">\eta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">η</span></span></span></span></span> 表示挪动的一小步，即学习率；<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span></span></span></span></span> 表示取样的小批量。同理：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mo>←</mo><mi>b</mi><mo>−</mo><mfrac><mi>η</mi><mi>m</mi></mfrac><mo>⋅</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><msup><mi mathvariant="bold">w</mi><mi mathvariant="normal">T</mi></msup><msup><mi mathvariant="bold">x</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><mi>b</mi><mo>−</mo><msup><mi>y</mi><mrow><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">b \leftarrow  b - \frac{\eta}{m} \cdot \sum_{i=1}^{m}  (\mathbf{w}^\mathrm T\mathbf{x}^{(i)} + b - y^{(i)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">←</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">η</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<h2 data-id="heading-5">2. 实际验证</h2>
<p>书上的<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.d2l.ai%2Fchapter_linear-networks%2Flinear-regression-scratch.html" target="_blank" title="https://zh.d2l.ai/chapter_linear-networks/linear-regression-scratch.html" ref="nofollow noopener noreferrer">3.2. 线性回归的从零开始实现</a> 写的十分的详细，这里我就不复述相关操作了，然后我们画一张图更加形象地表征一下我们梯度逐步减小的过程。</p>
<p>为了方便验证，我在sgd中做如下改动：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sgd</span>(<span class="hljs-params">params, lr, batch_size</span>):  <span class="hljs-comment">#@save</span>
    <span class="hljs-string">"""小批量随机梯度下降"""</span>
    <span class="hljs-keyword">with</span> torch.no_grad():
        <span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> params:
            <span class="hljs-keyword">if</span> param.shape[<span class="hljs-number">0</span>] == <span class="hljs-number">2</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"w: "</span>, param)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"w.grad: "</span>, param.grad)
            param -= lr * param.grad / batch_size
            param.grad.zero_()
</code></pre>
<p>然后我们在jupyter的最后加上如下的代码，再将以上打印的数据复制到下面：（或者优雅一点将打印输出到文件，这里再从文件读出）</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> mpl_toolkits.mplot3d <span class="hljs-keyword">import</span> Axes3D
<span class="hljs-keyword">import</span> re

<span class="hljs-comment"># 1. 解析打印日志，提取w的更新路径</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_w_trajectory</span>(<span class="hljs-params">log_text</span>):
    <span class="hljs-string">"""从打印日志中解析w的更新轨迹"""</span>
    pattern = <span class="hljs-string">r"w:\s*tensor\(\[\[(.*?)\],\s*\[(.*?)\]\]"</span>
    matches = re.findall(pattern, log_text)
    
    w_trajectory = []
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> matches:
        w1 = <span class="hljs-built_in">float</span>(<span class="hljs-keyword">match</span>[<span class="hljs-number">0</span>].strip())
        w2 = <span class="hljs-built_in">float</span>(<span class="hljs-keyword">match</span>[<span class="hljs-number">1</span>].strip())
        w_trajectory.append([w1, w2])
    
    <span class="hljs-keyword">return</span> np.array(w_trajectory)

<span class="hljs-comment"># 2. 生成模拟数据 (与之前相同)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">synthetic_data</span>(<span class="hljs-params">w_true, b_true, num_examples</span>):
    X = torch.normal(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, (num_examples, <span class="hljs-built_in">len</span>(w_true)))
    y = torch.matmul(X, w_true) + b_true
    y += torch.normal(<span class="hljs-number">0</span>, <span class="hljs-number">0.01</span>, y.shape)
    <span class="hljs-keyword">return</span> X, y.reshape((-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))

true_w = torch.tensor([<span class="hljs-number">2.0</span>, -<span class="hljs-number">3.4</span>])
true_b = <span class="hljs-number">4.2</span>
features, labels = synthetic_data(true_w, true_b, <span class="hljs-number">1000</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_mse</span>(<span class="hljs-params">X, y, w, b</span>):
    y_hat = linear_regression(X, w, b)
    <span class="hljs-keyword">return</span> squared_loss(y_hat, y).mean()

<span class="hljs-comment"># 4. 创建网格计算损失曲面 (与之前相同)</span>
b_fixed = true_b
w1_range = torch.linspace(<span class="hljs-number">0.0</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">50</span>)
w2_range = torch.linspace(-<span class="hljs-number">5.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">50</span>)
W1, W2 = torch.meshgrid(w1_range, w2_range, indexing=<span class="hljs-string">'ij'</span>)
Z = torch.zeros_like(W1)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(w1_range)):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(w2_range)):
        w_current = torch.tensor([W1[i, j], W2[i, j]], dtype=torch.float32)
        Z[i, j] = compute_mse(features, labels, w_current, b_fixed)

<span class="hljs-comment"># 5. 解析打印日志中的w轨迹</span>
<span class="hljs-comment"># 这里需要将您的打印日志内容粘贴到log_text中</span>
log_text = <span class="hljs-string">"""
您提供的完整打印日志内容在这里
"""</span>

w_trajectory = parse_w_trajectory(log_text)

<span class="hljs-comment"># 6. 计算轨迹上每个点的损失值</span>
trajectory_losses = []
<span class="hljs-keyword">for</span> w_point <span class="hljs-keyword">in</span> w_trajectory:
    w_tensor = torch.tensor(w_point, dtype=torch.float32)
    loss_val = compute_mse(features, labels, w_tensor, b_fixed)
    trajectory_losses.append(loss_val.item())

trajectory_losses = np.array(trajectory_losses)

<span class="hljs-comment"># 7. 创建可视化图形</span>
fig = plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># 7a. 三维曲面图</span>
ax1 = fig.add_subplot(<span class="hljs-number">121</span>, projection=<span class="hljs-string">'3d'</span>)
surf = ax1.plot_surface(W1.numpy(), W2.numpy(), Z.numpy(), 
                       cmap=<span class="hljs-string">'coolwarm'</span>, alpha=<span class="hljs-number">0.6</span>, linewidth=<span class="hljs-number">0</span>, 
                       antialiased=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 绘制优化路径</span>
ax1.plot(w_trajectory[:, <span class="hljs-number">0</span>], w_trajectory[:, <span class="hljs-number">1</span>], trajectory_losses, 
         <span class="hljs-string">'r-'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'Optimization Path'</span>)
ax1.scatter(w_trajectory[:, <span class="hljs-number">0</span>], w_trajectory[:, <span class="hljs-number">1</span>], trajectory_losses, 
            c=<span class="hljs-string">'r'</span>, s=<span class="hljs-number">20</span>, alpha=<span class="hljs-number">0.6</span>)

<span class="hljs-comment"># 标记起点和终点</span>
ax1.scatter([w_trajectory[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]], [w_trajectory[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]], [trajectory_losses[<span class="hljs-number">0</span>]], 
            c=<span class="hljs-string">'g'</span>, s=<span class="hljs-number">100</span>, marker=<span class="hljs-string">'o'</span>, label=<span class="hljs-string">'Start'</span>)
ax1.scatter([w_trajectory[-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]], [w_trajectory[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]], [trajectory_losses[-<span class="hljs-number">1</span>]], 
            c=<span class="hljs-string">'b'</span>, s=<span class="hljs-number">100</span>, marker=<span class="hljs-string">'*'</span>, label=<span class="hljs-string">'End'</span>)

ax1.set_xlabel(<span class="hljs-string">'Weight w1'</span>)
ax1.set_ylabel(<span class="hljs-string">'Weight w2'</span>)
ax1.set_zlabel(<span class="hljs-string">'Loss'</span>)
ax1.set_title(<span class="hljs-string">'3D Loss Surface with Optimization Path'</span>)
ax1.legend()
fig.colorbar(surf, ax=ax1, shrink=<span class="hljs-number">0.5</span>, aspect=<span class="hljs-number">20</span>)

<span class="hljs-comment"># 7b. 等高线图</span>
ax2 = fig.add_subplot(<span class="hljs-number">122</span>)
contour = ax2.contourf(W1.numpy(), W2.numpy(), Z.numpy(), levels=<span class="hljs-number">20</span>, cmap=<span class="hljs-string">'coolwarm'</span>)

<span class="hljs-comment"># 绘制优化路径</span>
ax2.plot(w_trajectory[:, <span class="hljs-number">0</span>], w_trajectory[:, <span class="hljs-number">1</span>], <span class="hljs-string">'r-'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'Optimization Path'</span>)
ax2.scatter(w_trajectory[:, <span class="hljs-number">0</span>], w_trajectory[:, <span class="hljs-number">1</span>], c=<span class="hljs-string">'r'</span>, s=<span class="hljs-number">20</span>, alpha=<span class="hljs-number">0.6</span>)

<span class="hljs-comment"># 标记起点和终点</span>
ax2.scatter(w_trajectory[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>], w_trajectory[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], c=<span class="hljs-string">'g'</span>, s=<span class="hljs-number">100</span>, marker=<span class="hljs-string">'o'</span>, label=<span class="hljs-string">'Start'</span>)
ax2.scatter(w_trajectory[-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], w_trajectory[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], c=<span class="hljs-string">'b'</span>, s=<span class="hljs-number">100</span>, marker=<span class="hljs-string">'*'</span>, label=<span class="hljs-string">'End'</span>)

<span class="hljs-comment"># 添加箭头显示方向</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(w_trajectory)-<span class="hljs-number">1</span>, <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(w_trajectory)//<span class="hljs-number">20</span>)):
    dx = w_trajectory[i+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>] - w_trajectory[i, <span class="hljs-number">0</span>]
    dy = w_trajectory[i+<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] - w_trajectory[i, <span class="hljs-number">1</span>]
    ax2.arrow(w_trajectory[i, <span class="hljs-number">0</span>], w_trajectory[i, <span class="hljs-number">1</span>], dx, dy, 
              shape=<span class="hljs-string">'full'</span>, lw=<span class="hljs-number">0</span>, length_includes_head=<span class="hljs-literal">True</span>, 
              head_width=<span class="hljs-number">0.05</span>, head_length=<span class="hljs-number">0.05</span>, color=<span class="hljs-string">'red'</span>)

ax2.set_xlabel(<span class="hljs-string">'Weight w1'</span>)
ax2.set_ylabel(<span class="hljs-string">'Weight w2'</span>)
ax2.set_title(<span class="hljs-string">'Loss Contour with Optimization Path'</span>)
ax2.legend()
fig.colorbar(contour, ax=ax2, shrink=<span class="hljs-number">0.5</span>, aspect=<span class="hljs-number">20</span>)

plt.tight_layout()
plt.show()

<span class="hljs-comment"># 8. 打印优化过程摘要</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"优化过程摘要:"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  初始权重: w1=<span class="hljs-subst">{w_trajectory[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]:<span class="hljs-number">.4</span>f}</span>, w2=<span class="hljs-subst">{w_trajectory[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  最终权重: w1=<span class="hljs-subst">{w_trajectory[-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]:<span class="hljs-number">.4</span>f}</span>, w2=<span class="hljs-subst">{w_trajectory[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  真实权重: w1=<span class="hljs-subst">{true_w[<span class="hljs-number">0</span>]:<span class="hljs-number">.1</span>f}</span>, w2=<span class="hljs-subst">{true_w[<span class="hljs-number">1</span>]:<span class="hljs-number">.1</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  初始损失: <span class="hljs-subst">{trajectory_losses[<span class="hljs-number">0</span>]:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  最终损失: <span class="hljs-subst">{trajectory_losses[-<span class="hljs-number">1</span>]:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"  迭代步数: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(w_trajectory)}</span>"</span>)
</code></pre>
<p>可以发现，当我们不考虑 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> 的情形下，从任意起点开始，梯度下降会逐渐收缩到整个曲面的最低点附近，这也就使得梯度下降更易于理解了。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cd4cb2a39cb4cfd9ba066331ad6c6c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSWd1b0NoYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765103981&amp;x-signature=HzbAGp7gGFdSB9%2BjCQplHwqN49Y%3D" alt="" width="100%" loading="lazy"/>
<h2 data-id="heading-6">4. 参考文献</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.d2l.ai%2Fchapter_linear-networks%2Findex.html" target="_blank" title="https://zh.d2l.ai/chapter_linear-networks/index.html" ref="nofollow noopener noreferrer">3. 线性神经网络</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手势操控 Three.js！效果炸裂！]]></title>    <link>https://juejin.cn/post/7577690150092750888</link>    <guid>https://juejin.cn/post/7577690150092750888</guid>    <pubDate>2025-11-29T15:12:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577690150092750888" data-draft-id="7577647745110654976" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手势操控 Three.js！效果炸裂！"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-29T15:12:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="看晴天了"/> <meta itemprop="url" content="https://juejin.cn/user/121387835735579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手势操控 Three.js！效果炸裂！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/121387835735579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    看晴天了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-29T15:12:58.000Z" title="Sat Nov 29 2025 15:12:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">太牛了！手势操控 Three.js！效果炸裂！</h2>
<p>部署运行你感兴趣的模型镜像一键部署</p>
<p>作为一名前端开发者，我一直热衷于界面效果展示，尤其喜欢那些<strong>炫酷</strong>的 <strong>3D</strong> 效果。</p>
<p>最近发现了一个很赞的开源项目 <code>“stark-shapes”</code>，它将<strong>手势识别</strong>与 <strong>3D 动画</strong>完美结合，借助 <code>Three.js</code> 和 <code>MediaPipe</code> 手势跟踪技术，实现了通过手势操控 3D 粒子动画的效果，视觉体验非常出色。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a774206e44ea448a9ab968bdbf5c9ebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5pm05aSp5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765033978&amp;x-signature=FiYuOa%2FpHqD1skyu%2B%2FdD%2FT6cllY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>stark-shapes 亮点</h4>
<h5 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>多样的手势操控</h5>
<p>项目支持丰富<strong>手势操作</strong>。</p>
<p><strong>右手捏合能放大或缩小场景，左手旋转能让摄像机环绕场景，拍手可切换动画模式</strong>，交互方式简单又有趣。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0956b4fd3ae34b4eb75d67fa43ea9d76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5pm05aSp5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765033978&amp;x-signature=X2LDc83v%2FQJsSeMpBpDeG%2BQQKpU%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>精美的 3D 几何图案</h5>
<p>项目包含多种 <strong>3D 几何图案</strong>，如<code>立方体</code>、<code>球体</code>、<code>螺旋</code>、<code>星系</code>等，这些图案由粒子系统生成，具有动态、流动的效果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a9f028b703f44f48bf3df4391a2bb44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5pm05aSp5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765033978&amp;x-signature=HwtrUFEeexnGRlya6Inc1rFKe3I%3D" alt="" loading="lazy"/></p>
<p>螺旋图案粒子沿轨迹旋转延伸，星系图案模拟宇宙星系旋转运行，视觉效果极佳。</p>
<h5 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>强大的后处理效果</h5>
<p>项目引入后处理效果，如 <strong>Bloom</strong> 效果。它能让场景中明亮部分添加光晕，使画面更柔和梦幻，增强视觉层次感和氛围感。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ee8da3309674f22aa4ec660ef4a0838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5pm05aSp5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765033978&amp;x-signature=%2FMVC0xoiVhn3uR1QFW%2B1UtOx4%2F0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>技术实现</h4>
<h6 data-id="heading-6">Three.js 的关键作用</h6>
<p><strong>Three.js</strong> 是基于 <strong>WebGL</strong> 的 3D 绘图库，负责创建、渲染 3D 几何体及动画处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d183bf38ca5f478dba7655686b7ddff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5pm05aSp5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765033978&amp;x-signature=C8Fl5Zkh31L7q9IL6pE5fmMZ7zc%3D" alt="" loading="lazy"/></p>
<p><strong>“stark-shapes”</strong> 项目中，它管理场景的摄像机位置、光照设置及动画循环等，呈现流畅且视觉效果出色的 3D 世界。</p>
<h6 data-id="heading-7">MediaPipe Hands 的手势识别功能</h6>
<p><strong>MediaPipe Hands</strong> 是强大的手势识别库，能实时跟踪手部关键点位置和动作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/695f1c1d792846628e642c117ea54182~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5pm05aSp5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765033978&amp;x-signature=3we%2FvDh6vIeJWG2E62cYG1WvTSQ%3D" alt="" loading="lazy"/></p>
<p>在项目中，它与 <strong>Three.js</strong> 紧密结合，实现手势与 3D 场景的无缝交互。</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>快速本地运行</h4>
<p>项目体验起来很有趣，手势操作简单，并且这个项目是开源的，对前端开发者来说是个很好的学习资源。</p>
<p>特别是想在 <strong>3D</strong> 领域深入学习的开发者，可以通过阅读和研究该项目的代码，了解如何结合 <strong>Three.js</strong> 和 <strong>MediaPipe</strong> 实现复杂的交互效果。</p>
<p>如果你也对这个项目感兴趣，不妨动手下载源码试试。以下是下载和运行项目的教程：</p>
<p>克隆项目仓库：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github.com:collidingScopes/stark-shapes.git
智能体编程go
运行
</code></pre>
<p>安装项目依赖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> stark-shapes
npm install
智能体编程go
运行
</code></pre>
<p>启动项目：</p>
<pre><code class="hljs language-go" lang="go">npm start
智能体编程<span class="hljs-keyword">go</span>
运行
</code></pre>
<p>在浏览器中打开 <code>http://localhost:8080</code> 即可查看项目效果。</p>
<p>总之， <strong>“stark-shapes”</strong> 项目实现手势操控 <strong>3D 粒子动画</strong>，带来新交互体验，是优质学习平台，拓展应用前景广阔。</p>
<p>感兴趣的朋友可体验在线预览或克隆源码深入研究。</p>
<ul>
<li><strong>stark-shapes Github 地址</strong>：<code>https://github.com/collidingScopes/stark-shapes/tree/main</code></li>
<li><strong>stark-shapes 在线体验地址</strong>：<code>https://collidingscopes.github.io/stark-shapes/</code></li>
</ul>
<p>（首次访问体验地址较慢，耐心等待资源加载。当摄像头里的手势出现识别圆点连线后，就可以体验了。）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>