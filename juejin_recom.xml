<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Swift 协议（Protocol）指南（二）：关联类型、Self 约束与泛型递归，一次彻底搞懂]]></title>    <link>https://juejin.cn/post/7570271574348333065</link>    <guid>https://juejin.cn/post/7570271574348333065</guid>    <pubDate>2025-11-10T00:07:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570271574348333065" data-draft-id="7554225547145461798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 协议（Protocol）指南（二）：关联类型、Self 约束与泛型递归，一次彻底搞懂"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-10T00:07:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 协议（Protocol）指南（二）：关联类型、Self 约束与泛型递归，一次彻底搞懂
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:07:19.000Z" title="Mon Nov 10 2025 00:07:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么“关联类型”是协议的分水岭</h2>
<p>在上面，我们接触的协议都属于“无关联类型协议”——编译期无需知道协议里的泛型占位符具体是什么。</p>
<p>一旦协议里出现了 <code>associatedtype</code>，它就不再是普通类型，而变成了协议泛型：只能当作约束使用，不能当作变量/参数/返回值类型直接出现。</p>
<h2 data-id="heading-1">关联类型基础语法</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Container</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Item</span>                     <span class="hljs-comment">// ① 声明一个占位符</span>
    <span class="hljs-keyword">var</span> count: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">append</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">Item</span>)      <span class="hljs-comment">// ② 在方法里使用占位符</span>
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">index</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Item</span> { <span class="hljs-keyword">get</span> }   <span class="hljs-comment">// ③ 在下标里使用占位符</span>
}
</code></pre>
<p>实现者决定真实类型</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">IntStack</span>: <span class="hljs-title class_">Container</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> items <span class="hljs-operator">=</span> [<span class="hljs-type">Int</span>]()
    <span class="hljs-keyword">typealias</span> <span class="hljs-type">Item</span> <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>      <span class="hljs-comment">// 可省略，编译器自动推断</span>
    
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">append</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">Int</span>) { items.append(item) }
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">index</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> { items[index] }
    <span class="hljs-keyword">var</span> count: <span class="hljs-type">Int</span> { items.count }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">StringQueue</span>: <span class="hljs-title class_">Container</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> items <span class="hljs-operator">=</span> [<span class="hljs-type">String</span>]()
    <span class="hljs-comment">// 不写 typealias，编译器也能从 append 参数推断 Item == String</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">append</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">String</span>) { items.append(item) }
    <span class="hljs-keyword">subscript</span>(<span class="hljs-params">index</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">String</span> { items[index] }
    <span class="hljs-keyword">var</span> count: <span class="hljs-type">Int</span> { items.count }
}
</code></pre>
<h2 data-id="heading-2">带约束的关联类型</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//  继承Container，只接收Item是Numeric的类型</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">SummableContainer</span>: <span class="hljs-title class_">Container</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Item</span>: <span class="hljs-title class_">Numeric</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">total</span>() -&gt; <span class="hljs-type">Item</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">SummableContainer</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">total</span>() -&gt; <span class="hljs-type">Item</span> {
        <span class="hljs-keyword">var</span> sum: <span class="hljs-type">Item</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span>count { sum <span class="hljs-operator">=</span> sum <span class="hljs-operator">+</span> <span class="hljs-keyword">self</span>[i] }
        <span class="hljs-keyword">return</span> sum
    }
}
</code></pre>
<p>使用</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">IntStack</span>: <span class="hljs-title class_">SummableContainer</span> {}   <span class="hljs-comment">// Int 符合 Numeric，自动获得 total()</span>
<span class="hljs-keyword">var</span> s <span class="hljs-operator">=</span> <span class="hljs-type">IntStack</span>()
s.append(<span class="hljs-number">1</span>)
s.append(<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(s.total()) <span class="hljs-comment">// 3</span>
</code></pre>
<h2 data-id="heading-3">Self 出现在协议里：返回自身类型的需求</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Copyable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">copy</span>() -&gt; <span class="hljs-keyword">Self</span>        <span class="hljs-comment">// 要求返回“真实类型”本身</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>: <span class="hljs-title class_">Copyable</span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-operator">=</span> <span class="hljs-string">""</span>
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>() {}         <span class="hljs-comment">// 必须保证子类也能初始化</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">copy</span>() -&gt; <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> new <span class="hljs-operator">=</span> <span class="hljs-keyword">Self</span>()       <span class="hljs-comment">// Self 在运行期代表真实动态类型</span>
        new.name <span class="hljs-operator">=</span> name
        <span class="hljs-keyword">return</span> new
    }
}

<span class="hljs-keyword">let</span> husky <span class="hljs-operator">=</span> <span class="hljs-type">Dog</span>()
husky.name <span class="hljs-operator">=</span> <span class="hljs-string">"Husky"</span>
<span class="hljs-keyword">let</span> another <span class="hljs-operator">=</span> husky.copy()     <span class="hljs-comment">// 类型推断为 Dog</span>
</code></pre>
<p>注意</p>
<ul>
<li><code>Self</code> 只能出现在“协议内”或“协议扩展”中，不能出现在普通结构体/类的方法签名里。</li>
<li>如果协议用 <code>associatedtype</code>，<code>Self</code> 就是该类型的别名。</li>
</ul>
<h2 data-id="heading-4">泛型递归约束：where 子句的魔法</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Value</span>
    <span class="hljs-keyword">var</span> value: <span class="hljs-type">Value</span> { <span class="hljs-keyword">get</span> }
    <span class="hljs-keyword">var</span> children: [<span class="hljs-keyword">Self</span>] { <span class="hljs-keyword">get</span> }        <span class="hljs-comment">// 递归引用自身</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Node</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Value</span>: <span class="hljs-title class_">Numeric</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">sumTree</span>() -&gt; <span class="hljs-type">Value</span> {
        value <span class="hljs-operator">+</span> children.reduce(<span class="hljs-number">0</span>) { <span class="hljs-variable">$0</span> <span class="hljs-operator">+</span> <span class="hljs-variable">$1</span>.sumTree() }
    }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">IntNode</span>: <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">let</span> value: <span class="hljs-type">Int</span>
    <span class="hljs-keyword">let</span> children: [<span class="hljs-type">IntNode</span>]
}

<span class="hljs-keyword">let</span> tree <span class="hljs-operator">=</span> <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">10</span>, children: [
    <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">3</span>, children: []),
    <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">5</span>, children: [
        <span class="hljs-type">IntNode</span>(value: <span class="hljs-number">1</span>, children: [])
    ])
])
<span class="hljs-built_in">print</span>(tree.sumTree())  <span class="hljs-comment">// 10+3+5+1 = 19</span>
</code></pre>
<h2 data-id="heading-5">真实案例：Swift 标准库里的 Sequence</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Sequence</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Iterator</span>: <span class="hljs-type">IteratorProtocol</span> <span class="hljs-keyword">where</span> <span class="hljs-type">Iterator</span>.<span class="hljs-type">Element</span> <span class="hljs-operator">==</span> <span class="hljs-type">Element</span>
    
    __consuming <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIterator</span>() -&gt; <span class="hljs-type">Iterator</span>
}

<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">IteratorProtocol</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Element</span>?
}
</code></pre>
<p>自定义序列</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Fibonacci</span>: <span class="hljs-title class_">Sequence</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Iterator</span>: <span class="hljs-title class_">IteratorProtocol</span> {
        <span class="hljs-keyword">var</span> a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, b <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Int</span>? {
            <span class="hljs-keyword">let</span> next <span class="hljs-operator">=</span> a
            a <span class="hljs-operator">=</span> b
            b <span class="hljs-operator">=</span> next <span class="hljs-operator">+</span> a
            <span class="hljs-keyword">return</span> next
        }
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIterator</span>() -&gt; <span class="hljs-type">Iterator</span> { <span class="hljs-type">Iterator</span>() }
}

<span class="hljs-keyword">for</span> (i, n) <span class="hljs-keyword">in</span> <span class="hljs-type">Fibonacci</span>().enumerated().prefix(<span class="hljs-number">10</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"F<span class="hljs-subst">\(i)</span> = <span class="hljs-subst">\(n)</span>"</span>)
}
</code></pre>
<h2 data-id="heading-6">类型擦除（Type Erasure）：解决“关联类型协议不能当返回类型”</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feed</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Item</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Item</span>?
}

<span class="hljs-comment">// 1. 包装类擦除具体 Item 类型</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">AnyFeed</span>&lt;<span class="hljs-title class_">Item</span>&gt;: <span class="hljs-title class_">Feed</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _next: () -&gt; <span class="hljs-type">Item</span>?
    <span class="hljs-keyword">init</span>&lt;<span class="hljs-type">F</span>: <span class="hljs-type">Feed</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">real</span>: <span class="hljs-type">F</span>) <span class="hljs-keyword">where</span> <span class="hljs-type">F</span>.<span class="hljs-type">Item</span> <span class="hljs-operator">==</span> <span class="hljs-type">Item</span> {
        _next <span class="hljs-operator">=</span> { real.next() }
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Item</span>? { _next() }
}

<span class="hljs-comment">// 2. 使用处不再出现关联类型</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIntFeed</span>() -&gt; <span class="hljs-type">AnyFeed</span>&lt;<span class="hljs-type">Int</span>&gt; {
    <span class="hljs-keyword">let</span> fib <span class="hljs-operator">=</span> <span class="hljs-type">Fibonacci</span>().makeIterator()
    <span class="hljs-keyword">return</span> <span class="hljs-type">AnyFeed</span>(<span class="hljs-type">IteratorFeed</span>(fib))
}
</code></pre>
<p>标准库已有</p>
<ul>
<li><code>AnySequence&lt;Element&gt;</code></li>
<li><code>AnyPublisher&lt;Output, Failure&gt;</code> (Combine)</li>
<li><code>AnyView</code> (SwiftUI)</li>
</ul>
<h2 data-id="heading-7">实战技巧清单</h2>





























<table><thead><tr><th>技巧场景</th><th>具体实现技巧</th></tr></thead><tbody><tr><td>想返回“某个遵守协议的对象”</td><td>用泛型 <code>&lt;T: Protocol&gt;</code> 或 <code>some Protocol</code></td></tr><tr><td>协议中定义 <code>associatedtype</code></td><td>仅能作为类型约束，无法直接当作变量类型；需通过“类型擦除”后暴露</td></tr><tr><td>要求子类必须实现指定初始化器</td><td>协议中声明 <code>init()</code>，类侧配合写 <code>required init()</code></td></tr><tr><td>让扩展方法仅对满足部分约束的类型可见</td><td>使用 <code>where</code> 子句，例如 <code>extension Container where Item: Comparable</code></td></tr><tr><td>禁止类型隐式标记为 <code>Sendable</code></td><td>声明 <code>struct File: ~Sendable</code>，或通过 <code>@available(*, unavailable) extension File: Sendable</code> 禁用</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis性能翻倍的5个冷门优化技巧，90%的开发者都不知道第3个！]]></title>    <link>https://juejin.cn/post/7570394530315517952</link>    <guid>https://juejin.cn/post/7570394530315517952</guid>    <pubDate>2025-11-10T00:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570394530315517952" data-draft-id="7570394530315501568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis性能翻倍的5个冷门优化技巧，90%的开发者都不知道第3个！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-10T00:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis性能翻倍的5个冷门优化技巧，90%的开发者都不知道第3个！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:16:24.000Z" title="Mon Nov 10 2025 00:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis性能翻倍的5个冷门优化技巧，90%的开发者都不知道第3个！</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Redis作为当今最流行的内存数据库之一，以其高性能、低延迟的特性被广泛应用于缓存、消息队列、实时分析等场景。然而，在实际生产环境中，许多开发者仅仅使用了Redis的基础功能，却忽视了那些能够显著提升性能的冷门优化技巧。本文将深入剖析5个鲜为人知但效果显著的Redis优化技术，涵盖内存管理、网络通信、数据结构选择等多个维度。这些技巧不仅经过了大规模生产环境的验证，而且其中第三个技巧（与内存碎片整理相关）更是被90%的开发者所忽略的关键优化点。</p>
<h2 data-id="heading-2">主体内容</h2>
<h3 data-id="heading-3">1. Pipeline批处理的艺术：突破RTT限制</h3>
<p>大多数开发者都知道Redis支持Pipeline技术，但很少有人真正理解其底层原理和最佳实践。</p>
<p><strong>深度解析：</strong></p>
<ul>
<li>Redis采用单线程模型处理命令，每个命令都需要经历"发送-&gt;处理-&gt;返回"的完整过程</li>
<li>传统模式下N次操作需要消耗N次RTT（Round Trip Time）</li>
<li>Pipeline通过批量发送命令可将N次RTT降低为1次</li>
</ul>
<p><strong>进阶技巧：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误示范：虽然使用了pipeline但未合理控制批次大小</span>
pipe = r.pipeline()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):
    pipe.<span class="hljs-built_in">set</span>(<span class="hljs-string">f'key_<span class="hljs-subst">{i}</span>'</span>, i)
pipe.execute()

<span class="hljs-comment"># 正确做法：每1000条命令执行一次提交</span>
batch_size = <span class="hljs-number">1000</span>
pipe = r.pipeline()
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):
    pipe.<span class="hljs-built_in">set</span>(<span class="hljs-string">f'key_<span class="hljs-subst">{i}</span>'</span>, i)
    <span class="hljs-keyword">if</span> i % batch_size == <span class="hljs-number">0</span>:
        pipe.execute()
        pipe = r.pipeline()
</code></pre>
<p><strong>性能影响：</strong></p>
<ul>
<li>在本地测试中（PING延迟1ms），10万次SET操作：
<ul>
<li>普通模式：约100秒</li>
<li>Pipeline批处理（batch=1000）：约0.3秒</li>
</ul>
</li>
<li><strong>注意事项</strong>：
<ol>
<li>单个Pipeline不宜包含过多命令（建议不超过10MB）</li>
<li>Cluster模式下需保证所有key在同一slot</li>
</ol>
</li>
</ul>
<h3 data-id="heading-4">2. HASHTABLE的秘密：调整hash-max-ziplist-entries</h3>
<p>Redis的Hash类型内部有两种编码格式：ziplist和hashtable。这个看似简单的配置项hash-max-ziplist-entries对内存和性能有着巨大影响。</p>
<p><strong>底层机制对比：</strong></p>

























<table><thead><tr><th/><th>ziplist</th><th>hashtable</th></tr></thead><tbody><tr><td><strong>内存效率</strong></td><td>极高（连续内存）</td><td>较低（指针开销）</td></tr><tr><td><strong>查询复杂度</strong></td><td>O(N)</td><td>O(1)</td></tr><tr><td><strong>写入效率</strong></td><td>O(N)需要重分配</td><td>O(1)</td></tr></tbody></table>
<p><strong>优化策略：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># redis.conf关键配置：</span>
hash-max-ziplist-entries 512 <span class="hljs-comment"># default:512</span>
hash-max-ziplist-value 64     <span class="hljs-comment"># default:64</span>
</code></pre>
<p><strong>实际案例：</strong>
存储100万个field-value对（每个field和value约10字节）：</p>
<ul>
<li>hash-max-ziplist-entries=512 → 实际占用58MB</li>
<li>hash-max-ziplist-entries=1024 → 占用54MB（↓7%）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 无法跨项目读取源码怎么办？MCP Easy Code Reader 帮你解决！]]></title>    <link>https://juejin.cn/post/7570405675432935424</link>    <guid>https://juejin.cn/post/7570405675432935424</guid>    <pubDate>2025-11-10T00:17:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570405675432935424" data-draft-id="7569909335908761609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 无法跨项目读取源码怎么办？MCP Easy Code Reader 帮你解决！"/> <meta itemprop="keywords" content="后端,Cursor,MCP"/> <meta itemprop="datePublished" content="2025-11-10T00:17:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="方圆想当图灵"/> <meta itemprop="url" content="https://juejin.cn/user/386633160473101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 无法跨项目读取源码怎么办？MCP Easy Code Reader 帮你解决！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386633160473101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    方圆想当图灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:17:35.000Z" title="Mon Nov 10 2025 00:17:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是 <strong>方圆</strong>。本篇文章主要介绍 MCP Server <strong>Easy Code Reader</strong>，它可以帮助你在使用 Cursor/VSCode/IDEA 编写代码时，根据调用链路将多个项目或 Jar 包中相关的代码读取到上下文中，供 Code Agent 帮我们分析逻辑和编写代码，而无需再手动将源码复制到对话框中发送给 AI，提高 Code Agent 准确度和编码效率。MCP 已发布 Github 和 MCP.so，欢迎大家前往下载使用：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFangYuan33%2Feasy-code-reader" target="_blank" title="https://github.com/FangYuan33/easy-code-reader" ref="nofollow noopener noreferrer">Github: easy-code-reader</a>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFangYuan33%2Feasy-code-reader" target="_blank" title="https://github.com/FangYuan33/easy-code-reader" ref="nofollow noopener noreferrer">github.com/FangYuan33/…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fserver%2Feasy-code-reader%2FFangYuan33" target="_blank" title="https://mcp.so/server/easy-code-reader/FangYuan33" ref="nofollow noopener noreferrer">MCP.so: Easy Code Reader</a>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fserver%2Feasy-code-reader%2FFangYuan33" target="_blank" title="https://mcp.so/server/easy-code-reader/FangYuan33" ref="nofollow noopener noreferrer">mcp.so/server/easy…</a></li>
</ul>
<p>在介绍如何接入 Easy Code Reader 之前，我们先来看看它到底能做什么：</p>
<h3 data-id="heading-0">Easy Code Reader 最佳实践</h3>
<p>Easy Code Reader 特别适合与 Claude、ChatGPT 等大模型配合使用，接下来以 Copilot Code Agent 结合 Claude4.5 模型为例，介绍一些最佳实践：</p>
<h4 data-id="heading-1">1. 跨项目调用，根据调用链路分析源码</h4>
<p>在比较复杂的项目中一般会拆分多个微服务，某些功能的实现可能会跨多个项目调用，如果靠人梳理相关逻辑会比较耗时，所以可以将涉及的代码 clone 到本地后使用 Easy Code Reader MCP 并结合 Code Agent 进行分析。接下来我们以 Nacos 项目为例，假设我们想了解 Nacos 的服务注册功能是如何实现的，可以按照以下步骤操作：</p>
<p>首先，比如我们创建了一个 Nacos Client 客户端，在这段逻辑中执行服务注册：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Main.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NacosException, InterruptedException {
        logger.info(<span class="hljs-string">"开始初始化 Nacos 客户端..."</span>);

        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        properties.put(PropertyKeyConst.SERVER_ADDR, <span class="hljs-string">"127.0.0.1:8848"</span>);
        properties.put(PropertyKeyConst.NAMESPACE, <span class="hljs-string">"7430d8fe-99ce-4b20-866e-ed021a0652c9"</span>);

        <span class="hljs-type">NamingService</span> <span class="hljs-variable">namingService</span> <span class="hljs-operator">=</span> NacosFactory.createNamingService(properties);

        System.out.println(<span class="hljs-string">"=== 注册服务实例 ==="</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 注册一个服务实例</span>
            namingService.registerInstance(<span class="hljs-string">"test-service0"</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">8080</span>);
            <span class="hljs-comment">// 添加事件监听器</span>
            namingService.subscribe(<span class="hljs-string">"test-service"</span>, event -&gt; {
                System.out.println(<span class="hljs-string">"服务实例变化: "</span> + event);
            });
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"服务注册失败(预期，因为服务器可能未启动): "</span> + e.getMessage());
        }

        TimeUnit.HOURS.sleep(<span class="hljs-number">3</span>);
    }
}
</code></pre>
<p>因为我们创建 Nacos Client 执行服务注册时是由 Nacos 提供的 SDK 直接调用 <code>NamingService#registerInstance</code> 方法实现的，我们并不清楚底层是如何实现的，如果我们想要了解实现细节，那么可以将 Nacos 的源码 Clone 下来，并使用 Easy Code Reader 读取相关源码，下面是一个示例 Prompt：</p>
<pre><code class="hljs language-text" lang="text">你是一位 Java 专家，请你帮我分析 #file:Main.java 中 namingService.registerInstance 方法的逻辑，这段逻辑的实现在本地项目的 nacos 中，所以你需要在 nacos 读取一系列相关的源码才能了解它的核心逻辑，读取 nacos 项目的代码你可以借助 easy-code-reader MCP，其中包含你可以获取项目信息、项目中所有的文件信息和某个文件的工具
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be97ddfbf9741beb2a970d0add5d12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763338655&amp;x-signature=hiPhDk3mwqTYbacklY54fi9ZaFM%3D" alt="img.png" loading="lazy"/></p>
<p>如图所示，它会不断地根据源码调用链路，读取相关源码并进行分析，最终我们就能了解服务注册的实现细节，会使用到 MCP Easy Code Reader 提供的多个工具 <code>list_all_project</code>、<code>list_project_files</code> 和 <code>read_project_code</code>， 具体调用细节图示如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/199bdefe268e44239bf176494d5e5629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763338655&amp;x-signature=e9VAX3ie4iuQbGdSEKLAUCoUFSw%3D" alt="image.png" loading="lazy"/></p>
<p>最终得到分析结果，节省很多时间：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6272d0af8547a7a8904df6ab85419d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763338655&amp;x-signature=MvLdEkmA%2BM4%2FlxPDL274s46oymo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">2. 阅读 jar 包源码，根据源码完成代码编写</h4>
<p>在使用第三方或其他外部依赖时，Copilot 或其他 Code Agent 并不能直接读取 jar 包中的源码，往往需要我们将源码内容手动复制到提示词中才能完成，费时费力。在 Easy Code Reader 中提供了 <code>read_jar_source</code> 工具来读取 jar 包中的源码，帮我们完成开发实现。我们还是以如下代码为例，现在我想实现多个服务实例的注册，但是我又不了解 <code>NamingService</code> 的实现，便可以借助 <code>read_jar_source</code> 来完成：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Main.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NacosException, InterruptedException {
        logger.info(<span class="hljs-string">"开始初始化 Nacos 客户端..."</span>);

        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        properties.put(PropertyKeyConst.SERVER_ADDR, <span class="hljs-string">"127.0.0.1:8848"</span>);
        properties.put(PropertyKeyConst.NAMESPACE, <span class="hljs-string">"7430d8fe-99ce-4b20-866e-ed021a0652c9"</span>);

        <span class="hljs-type">NamingService</span> <span class="hljs-variable">namingService</span> <span class="hljs-operator">=</span> NacosFactory.createNamingService(properties);

        System.out.println(<span class="hljs-string">"=== 注册服务实例 ==="</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 注册一个服务实例</span>
            namingService.registerInstance(<span class="hljs-string">"test-service0"</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">8080</span>);
            <span class="hljs-comment">// 添加事件监听器</span>
            namingService.subscribe(<span class="hljs-string">"test-service"</span>, event -&gt; {
                System.out.println(<span class="hljs-string">"服务实例变化: "</span> + event);
            });
            <span class="hljs-comment">// 注册多个服务实例</span>

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"服务注册失败(预期，因为服务器可能未启动): "</span> + e.getMessage());
        }

        TimeUnit.HOURS.sleep(<span class="hljs-number">3</span>);
    }
}
</code></pre>
<pre><code class="hljs language-text" lang="text">你是一位 Java 技术专家，精通 Nacos 框架，请你帮我在 #file:Main.java 中完成注册多个服务实例的逻辑，在编写代码前，你需要先使用 easy-code-reader 的 read_jar_source 工具读取 com.alibaba.nacos.api.naming.NamingService 的源码信息来了解注册多个服务实例的方法
</code></pre>
<p>处理过程如下所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5660f4ee0073455cb83fed66a7dd0658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pa55ZyG5oOz5b2T5Zu-54G1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763338655&amp;x-signature=Ph%2BClULMBry0SlDT8lBXS0tfCEM%3D" alt="image.png" loading="lazy"/></p>
<p>这样我们便能够快速地了解 <code>NamingService</code> 的实现细节，从而完成代码编写工作，节省了大量时间。</p>
<h4 data-id="heading-3">3. 跨项目阅读源码，根据源码完成本项目实现</h4>
<p>在大型项目中，某些功能的实现可能会跨多个模块或微服务，如果部分逻辑已经实现并且后续其他应用的逻辑需要依赖这部分逻辑时，可以借助 Easy Code Reader 读取相关模块的源码，帮助我们更好地理解和实现当前项目的功能，示例 Prompt 如下：</p>
<pre><code class="hljs language-text" lang="text">你是一位 Java 技术专家，现在我要实现 XXX 的业务逻辑，这部分逻辑的实现需要调用本地项目 A 中 XXX 的接口及其实现，请你借助 MCP easy-code-reader 来帮我读取 A 项目中的源码，并帮我实现 XXX 的业务逻辑
</code></pre>
<p>当然除了这三种应用场景以外，还可以使用 Easy Code Reader 完成以下事项：</p>
<ul>
<li><strong>异常问题快速溯源</strong>：如果有异常信息是外部 jar 包依赖中抛出来的，可以使用 <code>read_jar_source</code> 工具根据异常堆栈日志快速定位异常点</li>
<li><strong>依赖升级影响评估（旧/新版本差异核对）</strong>：同样是使用 <code>read_jar_source</code> 工具来完成新旧版本的实现差异，评估升级影响</li>
<li><strong>业务代码逻辑评审</strong>：如果业务逻辑开发实现在多个项目中，可以借助读取本地项目代码的工具 <code>list_all_project</code>、<code>list_project_files</code> 和 <code>read_project_code</code>，来分析新增的逻辑是否满足业务要求</li>
<li><strong>新人快速上手多个微服务</strong>：借助读取本地项目代码的工具，可以根据接口调用链路快速理清微服务项目代码之间的关系，提高上手速度</li>
</ul>
<hr/>
<p>既然它有这么多的应用场景，那么我们该如何接入 Easy Code Reader 呢？下面我们来介绍一下接入步骤：</p>
<p><a id="user-content-quick-start-uvx" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-4">快速接入（方法一）：使用 uvx（推荐 - 开箱即用）</h3>
<p>它的环境要求如下：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv" target="_blank" title="https://github.com/astral-sh/uv" ref="nofollow noopener noreferrer">uv</a> - Python 包和项目管理工具</li>
<li>Python 3.10 或更高版本</li>
<li>Java Development Kit (JDK) - 用于运行反编译器，要求至少 Java 8</li>
</ul>
<p>如果您还没有安装 uv，可以通过以下方式快速安装：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux</span>
curl -LsSf https://astral.sh/uv/install.sh | sh

<span class="hljs-comment"># Windows</span>
powershell -c <span class="hljs-string">"irm https://astral.sh/uv/install.ps1 | iex"</span>

<span class="hljs-comment"># 或使用 pip</span>
pip install uv
</code></pre>
<p>或者参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv" target="_blank" title="https://github.com/astral-sh/uv" ref="nofollow noopener noreferrer">uv 官网</a> 进行安装，并配置 uv 的安装路径添加到系统 PATH 中，以便可以直接使用 <code>uvx</code> 命令。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv" target="_blank" title="https://github.com/astral-sh/uv" ref="nofollow noopener noreferrer">uv</a> 是一个极快的 Python 包和项目管理工具。使用 <code>uvx</code> 可以无需预先安装，直接运行，参考以下 MCP 客户端配置：</p>
<ul>
<li><code>--maven-repo</code>: 指定 Maven 仓库路径，将 <code>/custom/path/to/maven/repository</code> 内容替换为本地 Maven 仓库路径即可，不配置默认使用 <strong>MAVEN_HOME</strong> 目录或 <code>~/.m2/repository</code></li>
<li><code>--project-dir</code>: 指定本地项目目录路径，将 <code>/path/to/projects</code> 替换为实际保存所有项目的路径</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"easy-code-reader"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"easy-code-reader"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--maven-repo"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/custom/path/to/maven/repository"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--project-dir"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/path/to/projects"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>将以上内容配置好后，AI 助手即可通过 MCP 协议调用 Easy Code Reader 提供的工具，完成多项目、多依赖的 Java 源代码读取工作。</p>
<h3 data-id="heading-5">快速接入（方法二）：使用 uv 安装到本地（不推荐）</h3>
<p>如果使用 <strong>快速接入（方法一）</strong> 安装运行失败，那么可以采用直接安装到本地的方法，运行如下命令：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install easy-code-reader
</code></pre>
<p>安装成功后，执行以下命令获取安装目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">which</span> easy-code-reader
</code></pre>
<p>比如，输出结果是：/Users/fangyuan/.local/bin/easy-code-reader，那么需要按照如下方式配置 MCP 客户端：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"easy-code-reader"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/Users/fangyuan/.local/bin/easy-code-reader"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"--maven-repo"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/custom/path/to/maven/repository"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--project-dir"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/path/to/projects"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>一般这样操作都能完成安装，后续如果有版本更新，可以通过以下命令进行升级：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install --upgrade easy-code-reader
</code></pre>
<h3 data-id="heading-6">常见问题</h3>
<h4 data-id="heading-7">Q1: spawn uvx ENOENT spawn uvx ENOENT</h4>
<p>uv 命令未找到，确保已正确安装 uv 并将其路径添加到系统 PATH 中，参考 <a href="#quick-start-uvx" title="#quick-start-uvx">快速接入（方法一）</a>，并尝试重启 IDE 后再启动 MCP Server。</p>
<hr/>
<p>以上内容就是 MCP Easy Code Reader 的介绍和接入方法，接下来的内容主要介绍一下它的实现原理，感兴趣的朋友可以继续往下看。</p>
<h3 data-id="heading-8">Easy Code Reader 实现原理</h3>
<p>其实编写一个 MCP Server 并不复杂，大家可以参考这篇 Github 上的文章 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FliaokongVFX%2FMCP-Chinese-Getting-Started-Guide" target="_blank" title="https://github.com/liaokongVFX/MCP-Chinese-Getting-Started-Guide" ref="nofollow noopener noreferrer">Model Context Protocol(MCP) 编程极速入门</a>。Easy Code Reader 通过 Python 语言实现，它提供了 4 个主要工具来协同完成源码读取工作：</p>
<ol>
<li><code>list_all_project</code>: <strong>列出所有本地项目</strong>，这个工具能将配置的项目目录 <code>--project-dir</code> 下所有的文件夹都读取出来，每个文件夹代表一个项目，这样 Code Agent 便能根据项目名称来选择需要读取的项目</li>
<li><code>list_project_files</code>: <strong>列出指定项目中的所有文件名</strong>，这个工具能将指定项目下的所有源码文件名都读取出来，Code Agent 便能根据调用链路选择需要读取的文件</li>
<li><code>read_project_code</code>: <strong>读取指定项目中的某个文件源码</strong>，通过以上两个工具，Code Agent 能够定位到需要读取的文件，然后使用这个工具将源码内容读取出来，供 Code Agent 进行分析</li>
<li><code>read_jar_source</code>: <strong>读取指定 jar 包中的某个类源码</strong>，如果调用链路中有外部 jar 包依赖的话，Code Agent 便可以使用这个工具将 jar 包中的源码读取出来，供分析和编写代码</li>
</ol>
<p>这四个工具协同工作，便能实现跨项目、多依赖的源码读取工作，帮助 Code Agent 更好地理解代码逻辑，从而提高代码编写效率和准确度，以下是 MCP Tool 实现的技术细节：</p>
<h4 data-id="heading-9">list_all_project</h4>
<p>列举项目目录下所有的项目文件夹名称。</p>
<p><strong>用途：</strong></p>
<ul>
<li>查看所有可用的项目</li>
<li>当输入不完整的项目名时，帮助推理出最接近的项目名</li>
<li>验证项目是否存在</li>
<li>支持项目名称模糊匹配，快速查找特定项目</li>
</ul>
<p><strong>参数：</strong></p>
<ul>
<li><code>project_dir</code> (可选): 项目目录路径，如未提供则使用启动时配置的路径</li>
<li><code>project_name_pattern</code> (可选): 项目名称模糊匹配模式（不区分大小写），用于过滤项目列表
<ul>
<li>支持左右模糊匹配，例如 <code>nacos</code> 将匹配包含 <code>nacos</code>、<code>Nacos</code>、<code>NACOS</code> 的项目名</li>
<li>⚠️ <strong>使用建议</strong>：如果匹配模式过于严格可能导致遗漏目标项目</li>
<li>💡 <strong>最佳实践</strong>：若未找到预期结果，建议不传此参数重新查询完整列表</li>
</ul>
</li>
</ul>
<p><strong>智能提示机制：</strong></p>
<ul>
<li>当使用 <code>project_name_pattern</code> 但未匹配到项目时，返回结果会包含提示信息</li>
<li>建议 AI 助手在未找到预期项目时，不传 <code>project_name_pattern</code> 参数重新查询</li>
<li>有效减少因过度过滤导致的查询失败</li>
</ul>
<p><strong>示例 1 - 列出所有项目：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例 2 - 使用项目名称模糊匹配：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"spring"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回格式：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/path/to/projects"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"project_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"spring"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total_projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"spring-boot"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"spring-cloud-demo"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"已使用项目名称模式 'spring' 进行过滤。如果未找到预期的项目，可能是模式匹配过于严格。建议：不传入 project_name_pattern 参数重新调用 list_all_project 工具查看完整项目列表。"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total_all_projects"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>提示信息说明：</strong></p>
<ul>
<li>当使用 <code>project_name_pattern</code> 但未匹配到任何项目时，<code>hint</code> 字段会提示模式可能过于严格，并显示总项目数 <code>total_all_projects</code></li>
<li>当使用 <code>project_name_pattern</code> 且有匹配结果时，<code>hint</code> 字段会提醒如果结果不符合预期可以不传参数重新查询，同时显示总项目数</li>
<li>这个智能提示机制帮助 AI 助手更好地调整查询策略，避免因过度过滤错过目标项目</li>
</ul>
<h4 data-id="heading-10">list_project_files</h4>
<p>列出 Java 项目中的源代码文件和配置文件路径。</p>
<p><strong>用途：</strong></p>
<ul>
<li>了解项目结构和文件组织</li>
<li>查找特定的类或配置文件</li>
<li>分析类之间的关系和依赖</li>
<li>当项目文件过多时，聚焦特定模块</li>
<li>支持文件名模糊匹配，快速定位目标文件</li>
</ul>
<p><strong>支持两种模式：</strong></p>
<ol>
<li><strong>全项目模式</strong>（不指定 <code>sub_path</code>）：列出整个项目的所有文件</li>
<li><strong>聚焦模式</strong>（指定 <code>sub_path</code>）：只列出指定子目录下的文件</li>
</ol>
<p><strong>参数：</strong></p>
<ul>
<li><code>project_name</code> (必需): 项目名称，例如 <code>nacos</code></li>
<li><code>sub_path</code> (可选): 指定项目内的子目录路径，例如 <code>core</code> 或 <code>address/src/main/java</code></li>
<li><code>file_name_pattern</code> (可选): 文件名模糊匹配模式（不区分大小写），用于进一步过滤文件列表
<ul>
<li>支持左右模糊匹配，例如 <code>Service</code> 将匹配包含 <code>service</code>、<code>Service</code>、<code>SERVICE</code> 的文件名</li>
<li>⚠️ <strong>使用建议</strong>：如果匹配模式过于严格可能导致遗漏目标文件</li>
<li>💡 <strong>最佳实践</strong>：若未找到预期结果，建议不传此参数重新查询完整列表</li>
</ul>
</li>
<li><code>project_dir</code> (可选): 项目所在的父目录路径，如未提供则使用启动时配置的路径</li>
</ul>
<p><strong>自动过滤内容：</strong></p>
<ul>
<li>✅ 包含：Java 源代码 (.java)、配置文件 (.xml, .properties, .yaml, .json 等)、构建脚本、文档</li>
<li>❌ 排除：测试目录 (<code>src/test</code>)、编译产物 (<code>target</code>, <code>build</code>)、IDE 配置、版本控制文件</li>
</ul>
<p><strong>智能提示机制：</strong></p>
<ul>
<li>当使用 <code>file_name_pattern</code> 但未匹配到文件时，返回结果会包含提示信息</li>
<li>建议 AI 助手在未找到预期文件时，不传 <code>file_name_pattern</code> 参数重新查询</li>
<li>有效减少因过度过滤导致的查询失败</li>
</ul>
<p><strong>示例 1 - 列出整个项目：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例 2 - 只列出 core 模块：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sub_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"core"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例 3 - 使用文件名模糊匹配：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Service"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回格式：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"project_dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/path/to/projects/nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"search_scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"core"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_name_pattern"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Service"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"total_files"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"core/src/main/java/com/alibaba/nacos/core/service/NacosService.java"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"api/src/main/java/com/alibaba/nacos/api/naming/NamingService.java"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"..."</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"已使用文件名模式 'Service' 进行过滤。如果未找到预期的文件，可能是模式匹配过于严格。建议：不传入 file_name_pattern 参数重新调用 list_project_files 工具查看完整文件列表。"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>提示信息说明：</strong></p>
<ul>
<li>当使用 <code>file_name_pattern</code> 但未匹配到任何文件时，<code>hint</code> 字段会提示模式可能过于严格</li>
<li>当使用 <code>file_name_pattern</code> 且有匹配结果时，<code>hint</code> 字段会提醒如果结果不符合预期可以不传参数重新查询</li>
<li>这个智能提示机制帮助 AI 助手更好地调整查询策略，避免因过度过滤错过目标文件</li>
</ul>
<h4 data-id="heading-11">read_project_code</h4>
<p>从本地项目目录中读取指定文件的源代码或配置文件内容。</p>
<p><strong>用途：</strong></p>
<ul>
<li>读取具体类或文件的完整源代码</li>
<li>查看配置文件内容（pom.xml、application.yml、application.properties 等）</li>
<li>读取项目文档（README.md、SQL 脚本等）</li>
<li>支持多模块 Maven/Gradle 项目</li>
<li>自动搜索常见的源代码和配置文件路径</li>
</ul>
<p><strong>参数：</strong></p>
<ul>
<li><code>project_name</code> (必需): 项目名称，例如 <code>my-project</code></li>
<li><code>file_path</code> (必需): 文件标识符：可以是完全限定的 Java 类名或文件相对路径
<ul>
<li>Java 类名格式：<code>com.example.MyClass</code> (自动查找对应的 .java 文件)</li>
<li>相对路径格式：<code>src/main/java/com/example/MyClass.java</code></li>
<li>模块相对路径：<code>core/src/main/java/com/example/MyClass.java</code></li>
<li>配置文件路径：<code>src/main/resources/application.yml</code>、<code>pom.xml</code></li>
<li>文档文件：<code>README.md</code>、<code>docs/setup.md</code></li>
</ul>
</li>
<li><code>project_dir</code> (可选): 项目目录路径，如未提供则使用启动时配置的路径</li>
</ul>
<p><strong>支持的文件类型：</strong></p>
<ul>
<li>Java 源代码 (.java)</li>
<li>配置文件 (.xml, .properties, .yaml, .yml, .json, .conf, .config)</li>
<li>构建脚本 (.gradle, .gradle.kts, pom.xml)</li>
<li>文档文件 (.md, .txt)</li>
<li>SQL 脚本 (.sql)</li>
<li>Shell 脚本 (.sh, .bat)</li>
</ul>
<p><strong>自动搜索路径：</strong></p>
<ul>
<li>对于 Java 类名：<code>src/main/java/{class_path}.java</code>、<code>src/{class_path}.java</code>、<code>{class_path}.java</code></li>
<li>对于配置文件：项目根目录、<code>src/main/resources/</code>、<code>src/</code>、<code>config/</code> 及子模块</li>
<li>支持多模块项目中的子模块路径</li>
</ul>
<p><strong>推荐工作流程：</strong></p>
<ol>
<li>使用 <code>list_all_project</code> 确认项目存在</li>
<li>使用 <code>list_project_files</code>（建议带 <code>file_name_pattern</code> 参数）查看文件列表</li>
<li>使用本工具读取具体文件内容</li>
</ol>
<p><strong>示例 1 - 使用类名读取 Java 源代码：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.service.UserService"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例 2 - 使用相对路径读取 Java 文件：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nacos"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"address/src/main/java/com/alibaba/nacos/address/component/AddressServerGeneratorManager.java"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例 3 - 读取配置文件：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/resources/application.yml"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>示例 4 - 读取项目根目录的文件：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pom.xml"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回格式：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"project_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-spring-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"class_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.service.UserService"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/path/to/projects/my-spring-app/src/main/java/com/example/service/UserService.java"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package com.example.service;\n\nimport ...\n\npublic class UserService {\n    // ...\n}"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-12">read_jar_source</h4>
<p>从 Maven 依赖中读取 Java 类的源代码（优先从 sources jar，否则反编译）。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>group_id</code> (必需): Maven group ID，例如 <code>org.springframework</code></li>
<li><code>artifact_id</code> (必需): Maven artifact ID，例如 <code>spring-core</code></li>
<li><code>version</code> (必需): Maven version，例如 <code>5.3.21</code></li>
<li><code>class_name</code> (必需): 完全限定的类名，例如 <code>org.springframework.core.SpringVersion</code></li>
<li><code>prefer_sources</code> (可选，默认 <code>true</code>): 优先使用 sources jar 而不是反编译</li>
</ul>
<p><strong>工作原理：</strong></p>
<ol>
<li>首先尝试从 <code>-sources.jar</code> 中提取源代码（如果 <code>prefer_sources=true</code>）</li>
<li>如果 sources jar 不存在或提取失败，自动回退到反编译主 JAR 文件</li>
<li>支持 SNAPSHOT 版本的智能处理</li>
</ol>
<p><strong>智能错误提示：</strong></p>
<p>当 JAR 文件未找到时，工具会提供详细的排查建议：</p>
<ul>
<li>提示可能的原因（依赖未安装、Maven 坐标错误）</li>
<li>建议使用 <code>read_project_code</code> 工具读取项目的 <code>pom.xml</code> 文件</li>
<li>指导在 <code>&lt;dependencies&gt;</code> 部分核对正确的 Maven 坐标</li>
<li>提示确认坐标后重新调用工具</li>
<li>说明可能需要执行 Maven 构建命令安装依赖</li>
</ul>
<p>这个智能提示机制特别适合与 AI 助手配合使用，能有效减少因 Maven 坐标错误导致的重复尝试。</p>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"group_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"artifact_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"spring-core"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.3.21"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"class_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework.core.SpringVersion"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回格式：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"class_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework.core.SpringVersion"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"artifact"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"org.springframework:spring-core:5.3.21"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"source_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sources.jar"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package org.springframework.core;\n\npublic class SpringVersion {\n    // ...\n}"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>source_type 字段说明：</strong></p>
<p><code>source_type</code> 字段标识源码的来源，帮助 AI 助手了解代码的可靠性和新鲜度：</p>
<ul>
<li><code>"sources.jar"</code>: 从 Maven 的 sources JAR 文件中提取（最可靠，与发布版本完全一致）</li>
<li><code>"decompiled"</code>: 通过反编译器新反编译生成（可能存在反编译不完整的情况）</li>
<li><code>"decompiled_cache"</code>: 从之前反编译的缓存中读取（避免重复反编译，提升性能）</li>
</ul>
<p>💡 <strong>使用建议</strong>：</p>
<ul>
<li><code>sources.jar</code> 来源的代码最准确，可直接作为分析依据</li>
<li><code>decompiled</code> 来源的代码可能会有语法糖恢复、泛型擦除等反编译特征</li>
<li><code>decompiled_cache</code> 与 <code>decompiled</code> 质量相同，只是从缓存读取以提升效率</li>
</ul>
<h5 data-id="heading-13">反编译器选择与缓存机制</h5>
<p><code>read_jar_source</code> 工具支持多个反编译器，并根据 Java 版本自动选择最合适的：</p>




















<table><thead><tr><th>Java 版本</th><th>推荐反编译器</th><th>说明</th></tr></thead><tbody><tr><td>8 - 20</td><td>CFR</td><td>自动使用 <strong>CFR</strong> 反编译器（兼容 Java 8+），已包含在包中：<code>src/easy_code_reader/decompilers/cfr.jar</code></td></tr><tr><td>21+</td><td>Fernflower</td><td>自动使用 <strong>Fernflower</strong> 反编译器（IntelliJ IDEA 使用的反编译器），已包含在包中：<code>src/easy_code_reader/decompilers/fernflower.jar</code></td></tr></tbody></table>
<p>反编译后的文件会被缓存在 JAR 包所在目录的 <code>easy-code-reader/</code> 子目录中，例如：</p>
<p>如果 JAR 包位置为：</p>
<pre><code class="hljs language-bash" lang="bash">~/.m2/repository/org/springframework/spring-core/5.3.21/spring-core-5.3.21.jar
</code></pre>
<p>反编译后的源文件将存储在：</p>
<pre><code class="hljs language-bash" lang="bash">~/.m2/repository/org/springframework/spring-core/5.3.21/easy-code-reader/spring-core-5.3.21.jar
</code></pre>
<p>缓存文件本身也是一个 JAR 格式的压缩包，包含所有反编译后的 <code>.java</code> 文件，这样可以避免重复反编译相同的 JAR 包，提高性能。但 <strong>针对 SNAPSHOT 版本需要特殊处理：</strong> 因为 Maven 针对快照版本会生成带时间戳的 JAR（如 <code>artifact-1.0.0-20251030.085053-1.jar</code>），Easy Code Reader 会自动查找最新的带时间戳版本进行反编译，并且以缓存以 <code>artifact-1.0.0-20251030.085053-1.jar</code> 名称存储，提供版本判断的依据，当检测到新版本时，会自动清理旧的 SNAPSHOT 缓存，生成新的缓存文件。</p>
<hr/>
<h3 data-id="heading-14">巨人的肩膀</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp.so%2Fserver%2Feasy-code-reader%2FFangYuan33" target="_blank" title="https://mcp.so/server/easy-code-reader/FangYuan33" ref="nofollow noopener noreferrer">MCP.so: Easy Code Reader</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFangYuan33%2Feasy-code-reader" target="_blank" title="https://github.com/FangYuan33/easy-code-reader" ref="nofollow noopener noreferrer">Github: easy-code-reader</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsalitaba%2Fmaven-decoder-mcp" target="_blank" title="https://github.com/salitaba/maven-decoder-mcp" ref="nofollow noopener noreferrer">Github: maven-decoder-mcp</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJetBrains%2Ffernflower" target="_blank" title="https://github.com/JetBrains/fernflower" ref="nofollow noopener noreferrer">Github: fernflower</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重温 Java 21 之作用域值]]></title>    <link>https://juejin.cn/post/7569910533509906451</link>    <guid>https://juejin.cn/post/7569910533509906451</guid>    <pubDate>2025-11-10T00:21:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569910533509906451" data-draft-id="7569946369990443071" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重温 Java 21 之作用域值"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-10T00:21:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重温 Java 21 之作用域值
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:21:28.000Z" title="Mon Nov 10 2025 00:21:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>作用域值（Scoped Values）</strong> 是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.openjdk.org%2Fdisplay%2Floom" target="_blank" title="https://wiki.openjdk.org/display/loom" ref="nofollow noopener noreferrer">Loom</a> 项目提出的另一个重要特性，它提供了一种隐式方法参数的形式，允许在大型程序的各个部分之间安全地共享数据，而无需将它们作为显式参数添加到调用链中的每个方法中。作用域值通常是作为一个公共静态字段，因此可以从任何方法中访问到。如果多个线程使用相同的作用域值，则从每个线程的角度来看，它可能包含不同的值。</p>
<p>如果您熟悉 <strong>线程本地变量（thread-local variables）</strong>，这听起来会很熟悉，事实上，作用域值正是为了解决使用线程本地变量时可能遇到的一些问题，在某些情况下可以将其作为线程本地变量的现代替代品。</p>
<h2 data-id="heading-0">一个例子</h2>
<p>在 Web 应用开发中，一个经典的场景是获取当前已登录的用户信息，下面的代码模拟了大概的流程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemo</span> {
    
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {

    <span class="hljs-comment">// 从 request 中获取用户信息</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> getUserFromRequest();
    
    <span class="hljs-comment">// 查询用户详情</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>().getUserInfo(userId);
    System.out.println(userInfo);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getUserFromRequest</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"admin"</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String userId)</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRepository</span>().getUserInfo(userId);
    }
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String userId)</span> {
      <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s:%s"</span>, userId, userId);
    }
  }
}
</code></pre>
<p>在接收到请求时，首先对用户进行身份验证，然后得到用户信息，这个信息可能被很多地方使用。在这里我们使用方法参数将用户信息传递到其他要使用的地方，可以看到，<code>userId</code> 参数从 <code>UserDemo</code> 传到 <code>UserService</code> 又传到 <code>UserRepository</code>。</p>
<p>在一个复杂的应用程序中，请求的处理可能会延伸到数百个方法，这时，我们需要为每一个方法添加 <code>userId</code> 参数，将用户传递到最底层需要用户信息的方法中。很显然，额外的 <code>userId</code> 参数会使我们的代码很快变得混乱，因为大多数方法不需要用户信息，甚至可能有一些方法出于安全原因根本不应该能够访问用户。如果在调用堆栈的某个深处我们还需要用户的 IP 地址怎么办？那么我们将不得不再添加一个 <code>ip</code> 参数，然后通过无数的方法传递它。</p>
<h2 data-id="heading-1">使用 <code>ThreadLocal</code> 线程本地变量</h2>
<p>解决这一问题的传统方法是使用 <code>ThreadLocal</code>，它是线程本地变量，只要线程不销毁，我们随时可以获取 <code>ThreadLocal</code> 中的变量值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemoThreadLocal</span> {
    
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;String&gt; USER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
  
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    
    <span class="hljs-comment">// 从 request 中获取用户信息</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> getUserFromRequest();
    USER.set(userId);

    <span class="hljs-comment">// 查询用户详情</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>().getUserInfo();
    System.out.println(userInfo);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getUserFromRequest</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"admin"</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRepository</span>().getUserInfo();
    }
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
      <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> USER.get();
      <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s:%s"</span>, userId, userId);
    }
  }
}
</code></pre>
<p>这里我们定义了一个名为 <code>USER</code> 的 <code>ThreadLocal</code> 全局变量，获取完用户信息之后将其存入 <code>USER</code> 中，然后在 <code>UserRepository</code> 中直接从 <code>USER</code> 中获取。尽管看起来像普通变量，但线程本地变量的特点是每个线程都有一个独立实例，它的值取决于哪个线程调用其 <code>get</code> 或 <code>set</code> 方法来读取或写入其值。使用线程本地变量，可以方便地在调用堆栈上的方法之间共享数据，而无需使用方法参数。</p>
<blockquote>
<p>注意，<code>ThreadLocal</code> 只能在单个线程中共享数据，如果内部方法中创建了新线程，我们可以使用 <code>InheritableThreadLocal</code>，它是 <code>ThreadLocal</code> 的子类，主要用于子线程创建时自动继承父线程的 <code>ThreadLocal</code> 变量，方便必要信息的进一步传递。</p>
</blockquote>
<h2 data-id="heading-2">使用 <code>ScopedValue</code> 作用域值</h2>
<p>不幸的是，线程本地变量存在许多设计缺陷，无法避免：</p>
<ul>
<li><strong>不受限制的可变性（Unconstrained mutability）</strong> - 线程本地变量都是可变的，它的值可以随意被更改，任何能够调用线程本地变量的 <code>get</code> 方法的代码都可以随时调用该变量的 <code>set</code> 方法；但是往往更常见的需求是从一个方法向其他方法简单的单向数据传输，就像上面的示例一样；对线程本地变量的任意修改可能导致类似意大利面条的数据流以及难以察觉的错误；</li>
<li><strong>无限寿命（Unbounded lifetime）</strong> - 一旦线程本地变量通过 <code>set</code> 方法设值，这个值将在线程的整个生命周期中被保留，直到调用 <code>remove</code> 方法，不幸的是，开发人员经常忘记调用 <code>remove</code> 方法；如果使用了线程池，如果没有正确清除线程本地变量，可能会将一个线程的变量意外地泄漏到另一个不相关的线程中，导致潜在地安全漏洞；此外，忘记清理线程局部变量还可能导致内存泄露；</li>
<li><strong>昂贵的继承（Expensive inheritance）</strong> - 当使用大量线程时，我们通常会使用 <code>InheritableThreadLocal</code> 让子线程自动继承父线程的线程本地变量，子线程无法共享父线程使用的存储空间，这会显著增加程序的内存占用；特别是在虚拟线程推出之后，这个问题变得更为显著，因为虚拟线程足够廉价，程序中可能会创建成千上万的虚拟线程，如果一百万个虚拟线程中的每一个都有自己的线程局部变量副本，很快就会出现内存不足的问题。</li>
</ul>
<p><strong>作用域值（Scoped Values）</strong> 就是为解决这些问题而诞生的新概念。</p>
<ul>
<li>首先，作用域值是不可变的，它的值无法更改，单向的数据传输使得代码流程更清晰；</li>
<li>另外，作用域值只在有限范围内使用，用完立即释放，不存在忘记清理的问题，所以也不会导致内存泄露；</li>
<li>最后，作用域值更轻量，由于它是不可变的，所以父线程和子线程可以复用一个实例，再多的虚拟线程也不会有内存不足的问题。</li>
</ul>
<p>下面用 <code>ScopedValue</code> 对上面的代码进行重写：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemoScopedValue</span> {
    
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> ScopedValue&lt;String&gt; USER = ScopedValue.newInstance();

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-comment">// 从 request 中获取用户信息</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> getUserFromRequest();
    ScopedValue.where(USER, userId)
      .run(() -&gt; {
        <span class="hljs-comment">// 查询用户详情</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>().getUserInfo();
        System.out.println(userInfo);
      });
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getUserFromRequest</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"admin"</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRepository</span>().getUserInfo();
    }
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
      <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> USER.get();
      <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s:%s"</span>, userId, userId);
    }
  }
}
</code></pre>
<p>我们首先调用 <code>ScopedValue.where(USER, userId)</code>，它用于将作用域值和某个对象进行绑定，然后调用 <code>run()</code> 方法，它接受一个 lambda 表达式，从该表达式直接或间接调用的任何方法都可以通过 <code>get()</code> 方法读取作用域值。</p>
<p>作用域值仅在 <code>run()</code> 调用的生命周期内有效，在 <code>run()</code> 方法完成后，绑定将被销毁。这种有界的生命周期，使得数据从调用方传输到被调用方（直接和间接）的单向传输一目了然。</p>
<h2 data-id="heading-3">作用域值的重绑定</h2>
<p>上面说过，作用域值是不可变的，没有任何方法可以更改作用域值，但是我们可以重新绑定作用域值：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ScopedValue&lt;String&gt; X = ScopedValue.newInstance();

<span class="hljs-keyword">void</span> <span class="hljs-title function_">foo</span><span class="hljs-params">()</span> {
  ScopedValue.where(X, <span class="hljs-string">"hello"</span>).run(() -&gt; bar());
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">bar</span><span class="hljs-params">()</span> {
  System.out.println(X.get()); <span class="hljs-comment">// prints hello</span>
  ScopedValue.where(X, <span class="hljs-string">"goodbye"</span>).run(() -&gt; baz());
  System.out.println(X.get()); <span class="hljs-comment">// prints hello</span>
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">baz</span><span class="hljs-params">()</span> {
  System.out.println(X.get()); <span class="hljs-comment">// prints goodbye</span>
}
</code></pre>
<p>在这个例子中，<code>foo()</code> 方法将作用域值 <code>X</code> 绑定为 <code>hello</code>，所以在 <code>bar()</code> 方法中使用 <code>X.get()</code> 获得的是 <code>hello</code>；但是接下来，我们重新将 <code>X</code> 绑定为 <code>goodbye</code>，再去调用 <code>baz()</code> 方法，这时在 <code>baz()</code> 方法中使用 <code>X.get()</code> 得到的就是 <code>goodbye</code> 了；不过值得注意的是，当 <code>baz()</code> 方法结束后，重新回到 <code>bar()</code> 方法，使用 <code>X.get()</code> 获得的仍然是 <code>hello</code>，说明作用域值并没有被修改。</p>
<h2 data-id="heading-4">作用域值的线程继承</h2>
<p>在使用 <code>ThreadLocal</code> 的时候，我们通常会使用 <code>InheritableThreadLocal</code> 让子线程自动继承父线程的线程本地变量，那么作用域值如何实现线程继承呢？可惜的是，并不存在 <code>InheritableScopedValue</code> 这样的类，Java 21 提供了另一种解决方案：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F428" target="_blank" title="https://openjdk.org/jeps/428" ref="nofollow noopener noreferrer">结构化并发 API（JEP 428）</a>。</p>
<p><code>StructuredTaskScope</code> 是结构化并发中的核心类，它的使用方法如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
  Supplier&lt;String&gt; user = scope.fork(() -&gt; USER.get());
  scope.join().throwIfFailed();
  System.out.println(<span class="hljs-string">"task scope: "</span> + user.get());
} <span class="hljs-keyword">catch</span> (Exception ex) {
}
</code></pre>
<p>其中 <code>scope.fork()</code> 方法用于创建子线程，父线程中的作用域值会自动被 <code>StructuredTaskScope</code> 创建的子线程继承，子线程中的代码可以使用父线程中为作用域值建立的绑定，而几乎没有额外开销。与线程局部变量不同，父线程的作用域值绑定不会被复制到子线程中，因此它的性能更高，也不会消耗过多的内存。</p>
<p>子线程的作用域值绑定的生命周期由 <code>StructuredTaskScope</code> 提供的 <code>fork/join</code> 模型控制，<code>scope.join()</code> 等待子线程结束，当线程结束后绑定就会自动销毁，避免了使用线程本地变量时出现无限生命周期的问题。</p>
<p>结构化并发也是 Java 21 中的一项重要特性，我们将在后面的笔记中继续学习它的知识。</p>
<h2 data-id="heading-5">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战——Python实用工具与库：Matplotlib数据可视化]]></title>    <link>https://juejin.cn/post/7570268773333270555</link>    <guid>https://juejin.cn/post/7570268773333270555</guid>    <pubDate>2025-11-10T00:23:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570268773333270555" data-draft-id="7570299986530058267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战——Python实用工具与库：Matplotlib数据可视化"/> <meta itemprop="keywords" content="Python,后端,前端"/> <meta itemprop="datePublished" content="2025-11-10T00:23:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战——Python实用工具与库：Matplotlib数据可视化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:23:09.000Z" title="Mon Nov 10 2025 00:23:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在数据分析中，<strong>数据可视化</strong> 是最直观、最具洞察力的环节。它能让复杂的数字和趋势以图形化的方式呈现，从而帮助我们更好地理解数据。
在Python生态中，<strong>Matplotlib</strong> 是最基础、最经典的可视化库，被广泛用于科学绘图、报告展示与仪表盘开发。
本篇博客将带你快速掌握Matplotlib的使用方法，从基础绘图到多图布局，再到美化技巧，轻松实现数据的可视化展示。</p>
</blockquote>
<hr/>
<h3 data-id="heading-0">一、Matplotlib简介</h3>
<p><strong>Matplotlib</strong> 是Python的二维绘图库，可以创建各种静态、动态和交互式图表。
它常与 <strong>Pandas</strong> 和 <strong>Numpy</strong> 配合使用，用于数据分析、科研和可视化报告。</p>
<p>Matplotlib的特点：</p>
<ul>
<li>支持折线图、柱状图、饼图、散点图等多种类型；</li>
<li>可高度自定义图形样式；</li>
<li>可输出为PNG、SVG、PDF等格式；</li>
<li>与Jupyter Notebook兼容性极佳。</li>
</ul>
<hr/>
<h3 data-id="heading-1">二、安装与导入</h3>
<pre><code class="hljs language-bash" lang="bash">pip install matplotlib
</code></pre>
<p>导入常规写法：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
</code></pre>
<hr/>
<h3 data-id="heading-2">三、绘制第一个图表</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

x = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
y = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>]

plt.plot(x, y)
plt.title(<span class="hljs-string">"销售趋势图"</span>)
plt.xlabel(<span class="hljs-string">"月份"</span>)
plt.ylabel(<span class="hljs-string">"销售额"</span>)
plt.show()
</code></pre>
<p>这段代码绘制了一条简单的折线图。
<code>plt.plot()</code> 用于画折线，<code>plt.show()</code> 用于显示图形。</p>
<hr/>
<h3 data-id="heading-3">四、图表类型速览</h3>
<h4 data-id="heading-4">1. 折线图（Line Chart）</h4>
<p>适合展示趋势变化。</p>
<pre><code class="hljs language-python" lang="python">plt.plot(x, y, marker=<span class="hljs-string">'o'</span>, color=<span class="hljs-string">'blue'</span>, linestyle=<span class="hljs-string">'--'</span>, label=<span class="hljs-string">"销售额"</span>)
plt.legend()
plt.show()
</code></pre>
<h4 data-id="heading-5">2. 柱状图（Bar Chart）</h4>
<p>适合展示分类数据对比。</p>
<pre><code class="hljs language-python" lang="python">categories = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>, <span class="hljs-string">"葡萄"</span>]
sales = [<span class="hljs-number">80</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">90</span>]

plt.bar(categories, sales, color=<span class="hljs-string">"skyblue"</span>)
plt.title(<span class="hljs-string">"水果销售对比"</span>)
plt.xlabel(<span class="hljs-string">"水果"</span>)
plt.ylabel(<span class="hljs-string">"销量"</span>)
plt.show()
</code></pre>
<h4 data-id="heading-6">3. 饼图（Pie Chart）</h4>
<p>适合展示比例分布。</p>
<pre><code class="hljs language-python" lang="python">labels = [<span class="hljs-string">'A产品'</span>, <span class="hljs-string">'B产品'</span>, <span class="hljs-string">'C产品'</span>]
sizes = [<span class="hljs-number">40</span>, <span class="hljs-number">35</span>, <span class="hljs-number">25</span>]

plt.pie(sizes, labels=labels, autopct=<span class="hljs-string">'%1.1f%%'</span>, startangle=<span class="hljs-number">90</span>)
plt.title(<span class="hljs-string">"产品市场占比"</span>)
plt.show()
</code></pre>
<h4 data-id="heading-7">4. 散点图（Scatter Plot）</h4>
<p>适合展示数据分布和相关性。</p>
<pre><code class="hljs language-python" lang="python">x = np.random.rand(<span class="hljs-number">50</span>)
y = np.random.rand(<span class="hljs-number">50</span>)

plt.scatter(x, y, color=<span class="hljs-string">'green'</span>)
plt.title(<span class="hljs-string">"散点分布示例"</span>)
plt.show()
</code></pre>
<hr/>
<h3 data-id="heading-8">五、自定义图表样式</h3>
<p>Matplotlib提供丰富的样式控制，让图表更专业美观。</p>
<pre><code class="hljs language-python" lang="python">plt.plot(x, y, color=<span class="hljs-string">'red'</span>, linewidth=<span class="hljs-number">2</span>, marker=<span class="hljs-string">'o'</span>, markersize=<span class="hljs-number">6</span>)
plt.grid(<span class="hljs-literal">True</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>)
plt.title(<span class="hljs-string">"趋势线示例"</span>, fontsize=<span class="hljs-number">14</span>)
plt.xlabel(<span class="hljs-string">"时间（月）"</span>, fontsize=<span class="hljs-number">12</span>)
plt.ylabel(<span class="hljs-string">"增长率(%)"</span>, fontsize=<span class="hljs-number">12</span>)
plt.show()
</code></pre>
<hr/>
<h3 data-id="heading-9">六、在同一图中绘制多条曲线</h3>
<pre><code class="hljs language-python" lang="python">x = np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)
y1 = x * <span class="hljs-number">2</span>
y2 = x ** <span class="hljs-number">2</span>

plt.plot(x, y1, label=<span class="hljs-string">"线性增长"</span>, color=<span class="hljs-string">'blue'</span>)
plt.plot(x, y2, label=<span class="hljs-string">"平方增长"</span>, color=<span class="hljs-string">'orange'</span>)
plt.legend()
plt.title(<span class="hljs-string">"不同增长趋势对比"</span>)
plt.show()
</code></pre>
<hr/>
<h3 data-id="heading-10">七、子图布局（subplot）</h3>
<p>当需要展示多个图表时，可以使用subplot创建多图布局。</p>
<pre><code class="hljs language-python" lang="python">x = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
y1 = np.sin(x)
y2 = np.cos(x)

plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
plt.plot(x, y1, color=<span class="hljs-string">'red'</span>)
plt.title(<span class="hljs-string">"正弦函数"</span>)

plt.subplot(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
plt.plot(x, y2, color=<span class="hljs-string">'blue'</span>)
plt.title(<span class="hljs-string">"余弦函数"</span>)

plt.tight_layout()
plt.show()
</code></pre>
<hr/>
<h3 data-id="heading-11">八、结合Pandas快速绘图</h3>
<p>Pandas内置了Matplotlib接口，可直接对DataFrame绘图。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

data = {
    <span class="hljs-string">"月份"</span>: [<span class="hljs-string">"1月"</span>, <span class="hljs-string">"2月"</span>, <span class="hljs-string">"3月"</span>, <span class="hljs-string">"4月"</span>, <span class="hljs-string">"5月"</span>],
    <span class="hljs-string">"销售额"</span>: [<span class="hljs-number">100</span>, <span class="hljs-number">150</span>, <span class="hljs-number">120</span>, <span class="hljs-number">180</span>, <span class="hljs-number">200</span>],
    <span class="hljs-string">"利润"</span>: [<span class="hljs-number">30</span>, <span class="hljs-number">50</span>, <span class="hljs-number">40</span>, <span class="hljs-number">70</span>, <span class="hljs-number">90</span>]
}
df = pd.DataFrame(data)

df.plot(x=<span class="hljs-string">"月份"</span>, y=[<span class="hljs-string">"销售额"</span>, <span class="hljs-string">"利润"</span>], kind=<span class="hljs-string">"bar"</span>)
plt.title(<span class="hljs-string">"销售与利润分析"</span>)
plt.show()
</code></pre>
<hr/>
<h3 data-id="heading-12">九、实战：绘制年度销售趋势图</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

data = {
    <span class="hljs-string">"月份"</span>: <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">13</span>),
    <span class="hljs-string">"销售额"</span>: [<span class="hljs-number">320</span>, <span class="hljs-number">450</span>, <span class="hljs-number">500</span>, <span class="hljs-number">610</span>, <span class="hljs-number">720</span>, <span class="hljs-number">830</span>, <span class="hljs-number">900</span>, <span class="hljs-number">870</span>, <span class="hljs-number">790</span>, <span class="hljs-number">660</span>, <span class="hljs-number">550</span>, <span class="hljs-number">430</span>]
}

df = pd.DataFrame(data)

plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))
plt.plot(df[<span class="hljs-string">"月份"</span>], df[<span class="hljs-string">"销售额"</span>], color=<span class="hljs-string">'orange'</span>, marker=<span class="hljs-string">'o'</span>, linewidth=<span class="hljs-number">2</span>)
plt.title(<span class="hljs-string">"2024年度销售趋势"</span>)
plt.xlabel(<span class="hljs-string">"月份"</span>)
plt.ylabel(<span class="hljs-string">"销售额(万元)"</span>)
plt.grid(<span class="hljs-literal">True</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.6</span>)
plt.show()
</code></pre>
<p>输出的折线图能直观展示全年销售走势，为企业决策提供直观依据。</p>
<hr/>
<h3 data-id="heading-13">十、小结</h3>
<p>通过本篇文章，你已经掌握了：</p>
<ul>
<li>Matplotlib的基本绘图方法</li>
<li>折线图、柱状图、饼图、散点图等常见图表</li>
<li>图表美化与多图布局</li>
<li>Pandas结合Matplotlib的快速绘图方法</li>
<li>实战案例：年度销售趋势分析</li>
</ul>
<p>Matplotlib的强大在于它的可扩展性与灵活性。
当你熟练掌握它后，可以进一步学习 <strong>Seaborn</strong> 和 <strong>Plotly</strong> 等高级可视化库，构建更专业、更美观的数据展示界面。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战 - Python实用工具与库 - requests 与 BeautifulSoup]]></title>    <link>https://juejin.cn/post/7570201730992111642</link>    <guid>https://juejin.cn/post/7570201730992111642</guid>    <pubDate>2025-11-10T00:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570201730992111642" data-draft-id="7570271574348382217" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战 - Python实用工具与库 - requests 与 BeautifulSoup"/> <meta itemprop="keywords" content="后端,前端,Python"/> <meta itemprop="datePublished" content="2025-11-10T00:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战 - Python实用工具与库 - requests 与 BeautifulSoup
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:23:31.000Z" title="Mon Nov 10 2025 00:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在进行数据采集（网页爬虫）时，常用的两个强大工具是 <strong>requests</strong>（用于网络请求）和 <strong>BeautifulSoup</strong>（用于网页解析）。本节我们将学习如何使用这两个库高效地从网页获取并提取数据。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、requests 库：网络请求的利器</h2>
<h3 data-id="heading-1">1. requests 简介</h3>
<p><code>requests</code> 是 Python 最常用的 HTTP 请求库，用于发送各种网络请求（GET、POST、PUT、DELETE 等）。相比内置的 <code>urllib</code>，它更加简单易用。</p>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pip install requests
</code></pre>
<h3 data-id="heading-2">2. 发送请求</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># 发送 GET 请求</span>
response = requests.get(<span class="hljs-string">"https://jsonplaceholder.typicode.com/posts/1"</span>)

<span class="hljs-comment"># 打印响应内容</span>
<span class="hljs-built_in">print</span>(response.status_code)  <span class="hljs-comment"># 状态码，如 200 表示成功</span>
<span class="hljs-built_in">print</span>(response.text)         <span class="hljs-comment"># 响应的文本内容</span>
<span class="hljs-built_in">print</span>(response.json())       <span class="hljs-comment"># 如果是 JSON 数据，可直接转成字典</span>
</code></pre>
<h3 data-id="heading-3">3. 发送 POST 请求</h3>
<pre><code class="hljs language-python" lang="python">data = {<span class="hljs-string">"title"</span>: <span class="hljs-string">"Python"</span>, <span class="hljs-string">"body"</span>: <span class="hljs-string">"requests demo"</span>, <span class="hljs-string">"userId"</span>: <span class="hljs-number">1</span>}
response = requests.post(<span class="hljs-string">"https://jsonplaceholder.typicode.com/posts"</span>, json=data)
<span class="hljs-built_in">print</span>(response.json())
</code></pre>
<h3 data-id="heading-4">4. 自定义请求头与参数</h3>
<pre><code class="hljs language-python" lang="python">headers = {<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0"</span>}
params = {<span class="hljs-string">"q"</span>: <span class="hljs-string">"python"</span>}
response = requests.get(<span class="hljs-string">"https://www.google.com/search"</span>, headers=headers, params=params)
<span class="hljs-built_in">print</span>(response.url)
</code></pre>
<h3 data-id="heading-5">5. 处理异常</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    response = requests.get(<span class="hljs-string">"https://example.com"</span>, timeout=<span class="hljs-number">5</span>)
    response.raise_for_status()  <span class="hljs-comment"># 检查响应是否为 200</span>
<span class="hljs-keyword">except</span> requests.RequestException <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"请求出错："</span>, e)
</code></pre>
<hr/>
<h2 data-id="heading-6">二、BeautifulSoup：HTML 解析神器</h2>
<h3 data-id="heading-7">1. BeautifulSoup 简介</h3>
<p>BeautifulSoup 是一个强大的 HTML/XML 解析库，可以轻松提取网页中的指定数据。</p>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pip install beautifulsoup4 lxml
</code></pre>
<h3 data-id="heading-8">2. 基本使用</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

html = <span class="hljs-string">"""
&lt;html&gt;&lt;head&gt;&lt;title&gt;Python 教程&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;欢迎学习 BeautifulSoup&lt;/h1&gt;&lt;p class='desc'&gt;这是一个爬虫示例&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
"""</span>

soup = BeautifulSoup(html, <span class="hljs-string">"lxml"</span>)
<span class="hljs-built_in">print</span>(soup.title.text)   <span class="hljs-comment"># 输出：Python 教程</span>
<span class="hljs-built_in">print</span>(soup.h1.text)      <span class="hljs-comment"># 输出：欢迎学习 BeautifulSoup</span>
<span class="hljs-built_in">print</span>(soup.find(<span class="hljs-string">"p"</span>, class_=<span class="hljs-string">"desc"</span>).text)  <span class="hljs-comment"># 输出：这是一个爬虫示例</span>
</code></pre>
<h3 data-id="heading-9">3. 常见的解析方法</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查找第一个匹配的标签</span>
<span class="hljs-built_in">print</span>(soup.find(<span class="hljs-string">"p"</span>))

<span class="hljs-comment"># 查找所有匹配的标签</span>
<span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">"p"</span>):
    <span class="hljs-built_in">print</span>(p.text)

<span class="hljs-comment"># 使用 CSS 选择器</span>
<span class="hljs-built_in">print</span>(soup.select_one(<span class="hljs-string">"p.desc"</span>).text)
<span class="hljs-built_in">print</span>([a.text <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> soup.select(<span class="hljs-string">"a.link"</span>)])
</code></pre>
<hr/>
<h2 data-id="heading-10">三、requests + BeautifulSoup 实战示例：爬取网页标题</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

url = <span class="hljs-string">"https://quotes.toscrape.com/"</span>
headers = {<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0"</span>}

response = requests.get(url, headers=headers)
soup = BeautifulSoup(response.text, <span class="hljs-string">"lxml"</span>)

quotes = soup.find_all(<span class="hljs-string">"span"</span>, class_=<span class="hljs-string">"text"</span>)
authors = soup.find_all(<span class="hljs-string">"small"</span>, class_=<span class="hljs-string">"author"</span>)

<span class="hljs-keyword">for</span> quote, author <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(quotes, authors):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{author.text}</span>: <span class="hljs-subst">{quote.text}</span>"</span>)
</code></pre>
<p>运行结果（示例）：</p>
<pre><code class="hljs language-dart" lang="dart">Albert Einstein: “The world <span class="hljs-keyword">as</span> we have created it <span class="hljs-keyword">is</span> a process of our thinking.”
J.K. Rowling: “It <span class="hljs-keyword">is</span> our choices that <span class="hljs-keyword">show</span> what we truly are, far more than our abilities.”
</code></pre>
<hr/>
<h2 data-id="heading-11">四、扩展：延伸应用</h2>
<ol>
<li>
<p><strong>结合 pandas</strong>
将提取的数据保存为 CSV 文件：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.DataFrame({<span class="hljs-string">"author"</span>: [a.text <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> authors], <span class="hljs-string">"quote"</span>: [q.text <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> quotes]})
df.to_csv(<span class="hljs-string">"quotes.csv"</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
</li>
<li>
<p><strong>加入时间延迟与代理</strong>（防止被封 IP）</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
time.sleep(random.uniform(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-12">总结</h2>




















<table><thead><tr><th>模块</th><th>功能</th><th>常用方法</th></tr></thead><tbody><tr><td><strong>requests</strong></td><td>发送 HTTP 请求</td><td><code>get()</code>, <code>post()</code>, <code>headers</code>, <code>params</code>, <code>json()</code></td></tr><tr><td><strong>BeautifulSoup</strong></td><td>解析 HTML/XML 文档</td><td><code>find()</code>, <code>find_all()</code>, <code>select()</code>, <code>.text</code></td></tr></tbody></table>
<p>这两个库是 Python 爬虫开发的入门组合，通过它们可以快速实现网页数据的采集与清洗。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用阿里AI模型去除背景噪音：单文件40行代码实现]]></title>    <link>https://juejin.cn/post/7570299986530074651</link>    <guid>https://juejin.cn/post/7570299986530074651</guid>    <pubDate>2025-11-10T00:30:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570299986530074651" data-draft-id="7569976345931153459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用阿里AI模型去除背景噪音：单文件40行代码实现"/> <meta itemprop="keywords" content="阿里巴巴,Python,FFmpeg"/> <meta itemprop="datePublished" content="2025-11-10T00:30:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mortimer"/> <meta itemprop="url" content="https://juejin.cn/user/4441682704623992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用阿里AI模型去除背景噪音：单文件40行代码实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682704623992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mortimer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:30:09.000Z" title="Mon Nov 10 2025 00:30:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>是否曾为录音中的背景噪音而烦恼？上次介绍过使用ffmpeg一行命令进行降噪，虽然非常简单，但效果可能不尽如人意。</p>
<p>今天，再介绍一种更专业、更强大的降噪方案——利用阿里达摩院的AI大模型 <code>speech_zipenhancer_ans_multiloss_16k_base</code>。别担心复杂的环境配置和编程知识！你只需要准备两个小工具和一份py文件，就能通过一个简单的命令，自动完成所有降噪工作。</p>
<p>下面，让我们一步步开始吧！</p>
<h2 data-id="heading-0">准备工作（若已存在uv和ffmepg可跳过该步）</h2>
<p>在开始之前，我们需要获取两个小工具：<code>uv</code> 和 <code>ffmpeg</code>。它们是实现自动配置和音视频处理的关键。</p>
<h3 data-id="heading-1"><strong>步骤 1：获取 uv</strong></h3>
<p><code>uv</code> 是一个轻量级的 Python 包管理工具，它能帮助我们自动下载和配置阿里降噪模型所需的各种库，省去手动安装的麻烦。</p>
<ul>
<li>
<p><strong>下载地址：</strong>
Windows 版 <code>uv.exe</code> 请从这里下载：
<code>https://github.com/astral-sh/uv/releases/download/0.9.8/uv-x86_64-pc-windows-msvc.zip</code></p>
</li>
<li>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p>点击上述链接下载压缩包。</p>
</li>
<li>
<p>解压下载的 <code>uv-x86_64-pc-windows-msvc.zip</code> 文件，你会看到 <code>uv.exe</code> 以及同目录下的另外两个 <code>.exe</code> 文件。</p>
</li>
<li>
<p>在电脑的<strong>任意文件夹</strong>的地址栏（就是显示文件路径的地方，如下图所示）中，输入 <code>%userprofile%\.local\bin</code> 后按回车键。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65954bc1ffdf42778928697a15ca806e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339408&amp;x-signature=z3GXHU1UDVZF3pgVrEg%2BB3XANwA%3D" alt="在文件地址栏输入特定路径" loading="lazy"/></p>
</li>
<li>
<p>将刚才解压出来的 <code>uv.exe</code> 等三个文件，<strong>全部复制粘贴</strong>到这个新打开的文件夹中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0db7c057b184366a2d050bb32059a83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339408&amp;x-signature=k901GjfjntIQFRgPd8Xiz2BFdSo%3D" alt="将uv.exe文件粘贴到指定路径" loading="lazy"/></p>
</li>
</ol>
</li>
<li>
<p><strong>小贴士：</strong> 这样做是为了让你的电脑能够在任何地方直接识别并运行 <code>uv</code> 命令，而无需每次都指定它的完整路径，非常方便！</p>
</li>
<li>
<p><em>MacOS上直接执行<code>wget -qO- https://astral.sh/uv/install.sh | sh</code>一步完成安装</em></p>
</li>
</ul>
<h3 data-id="heading-2"><strong>步骤 2：获取 ffmpeg</strong></h3>
<p><code>ffmpeg</code> 是一个功能强大的音视频处理工具，使用它来将视频转为降噪模型所需的固定音频格式。</p>
<ul>
<li>
<p><strong>下载地址：</strong>
Windows请从这里下载 <code>ffmpeg</code> 的完整版本：
<code>https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-full.7z</code></p>
<p><em>MacOS上直接执行 <code>brew install ffmpeg</code> 一步安装</em></p>
</li>
<li>
<p><strong>操作步骤：</strong></p>
<ol>
<li>点击上述链接下载 <code>ffmpeg-release-full.7z</code> 压缩包。</li>
<li>解压下载的文件。解压后，你会看到一个名为 <code>ffmpeg-x.x.x-full_build</code> 的文件夹（<code>x.x.x</code> 代表版本号）。</li>
<li>进入这个文件夹，找到 <code>bin</code> 子文件夹，里面有一个 <code>ffmpeg.exe</code> 文件。</li>
<li>将这个 <code>ffmpeg.exe</code> 文件<strong>复制</strong>到你刚才放置 <code>uv.exe</code> 的<strong>同一个目录中</strong>（即 <code>%userprofile%\.local\bin</code> 文件夹）。</li>
</ol>
</li>
<li>
<p><strong>恭喜！</strong> 最麻烦的准备工作已经完成。这两个工具只需这样设置一次，以后就能永久使用了。</p>
</li>
</ul>
<h2 data-id="heading-3">保存降噪代码到 <code>ans.py</code> 文件</h2>
<p>降噪的全部逻辑都包含在下面这段代码中，按下面方式复制粘贴代码。</p>
<ol>
<li>在你的电脑上，选择一个你喜欢的文件夹来存放这个降噪程序（例如，你可以在 <code>D</code> 盘下新建一个 <code>aitools</code> 文件夹）。</li>
<li>在这个文件夹中，新建一个文本文件，并将其命名为 <code>ans.py</code>。
*   <strong>特别注意：</strong> 确保文件后缀是 <code>.py</code> 而不是 <code>.txt</code>！如果你不确定，可以在文件管理器中点击“查看”选项卡，然后勾选“文件扩展名”，这样你就能清楚地看到和修改文件后缀了。</li>
<li>将下面的所有代码完整复制，然后粘贴到你刚刚创建的 <code>ans.py</code> 文件中。</li>
<li>保存 <code>ans.py</code> 文件。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># /// script</span>
<span class="hljs-comment"># requires-python = "==3.10.*"</span>
<span class="hljs-comment"># dependencies = [</span>
<span class="hljs-comment">#   "modelscope",</span>
<span class="hljs-comment">#   "datasets==3.0.*",</span>
<span class="hljs-comment">#   "torch",</span>
<span class="hljs-comment">#   "pillow",</span>
<span class="hljs-comment">#   "addict",</span>
<span class="hljs-comment">#   "simplejson",</span>
<span class="hljs-comment">#   "librosa",</span>
<span class="hljs-comment">#   "soundfile",</span>
<span class="hljs-comment">#   "sortedcontainers",</span>
<span class="hljs-comment"># ]</span>
<span class="hljs-comment"># [[tool.uv.index]]</span>
<span class="hljs-comment"># url = "https://pypi.tuna.tsinghua.edu.cn/simple"</span>
<span class="hljs-comment"># ///</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">'Loading....'</span>)
<span class="hljs-keyword">import</span> sys,subprocess,os,logging,warnings
warnings.filterwarnings(<span class="hljs-string">"ignore"</span>, category=UserWarning)
os.environ[<span class="hljs-string">'MODELSCOPE_LOG_LEVEL'</span>]=<span class="hljs-built_in">str</span>(logging.ERROR)
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> modelscope.pipelines <span class="hljs-keyword">import</span> pipeline
<span class="hljs-keyword">from</span> modelscope.utils.constant <span class="hljs-keyword">import</span> Tasks
<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">2</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n 错误：请在命令后面提供要处理的音频或视频文件路径！\n正确用法：uv run ans.py \"你的文件路径\"\n技巧：可以直接将文件拖拽到命令行窗口中。"</span>);sys.exit(<span class="hljs-number">1</span>)
ROOT = Path(os.getcwd());TMP_DIR = ROOT / <span class="hljs-string">"tmp"</span>;TMP_DIR.mkdir(exist_ok=<span class="hljs-literal">True</span>)
filepath = Path(sys.argv[<span class="hljs-number">1</span>])
file_wav =  TMP_DIR/<span class="hljs-string">f"<span class="hljs-subst">{filepath.stem}</span>.wav"</span>
out_wav =  ROOT/<span class="hljs-string">f"<span class="hljs-subst">{filepath.stem}</span>-ans.wav"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'======开始降噪======='</span>)
<span class="hljs-keyword">try</span>:
    subprocess.run(  [<span class="hljs-string">"ffmpeg"</span>, <span class="hljs-string">"-y"</span>, <span class="hljs-string">"-i"</span>, <span class="hljs-built_in">str</span>(filepath), <span class="hljs-string">"-c:a"</span>, <span class="hljs-string">"pcm_s16le"</span>, <span class="hljs-string">"-ac"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"-ar"</span>, <span class="hljs-string">"16000"</span>, <span class="hljs-built_in">str</span>(file_wav)],  check=<span class="hljs-literal">True</span>,  capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span> )
<span class="hljs-keyword">except</span> subprocess.CalledProcessError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n 错误：FFmpeg 转换失败！请检查文件路径是否正确，或文件本身是否损坏。\nFFmpeg 错误信息: <span class="hljs-subst">{e.stderr}</span>"</span>);sys.exit(<span class="hljs-number">1</span>)
ans = pipeline(Tasks.acoustic_noise_suppression, model=<span class="hljs-string">'iic/speech_zipenhancer_ans_multiloss_16k_base'</span>, disable_update=<span class="hljs-literal">True</span>, disable_log=<span class="hljs-literal">True</span>)
ans( <span class="hljs-built_in">str</span>(file_wav), output_path=<span class="hljs-built_in">str</span>(out_wav))
Path(file_wav).unlink(missing_ok=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'======降噪完毕，降噪后文件是: <span class="hljs-subst">{out_wav}</span>'</span>)

</code></pre>
<h2 data-id="heading-4">运行降噪程序</h2>
<p>现在，是时候让我们的降噪程序大显身手了！</p>
<ol>
<li><strong>打开命令行窗口：</strong> 找到你存放 <code>ans.py</code> 文件的文件夹（例如 <code>D:\aitools</code>）。在文件夹的地址栏中（显示文件路径的地方），<strong>清空</strong>现有内容，输入 <code>cmd</code>，然后按回车键。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3b2a6cb2b34a1aaa811bf600467b6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339408&amp;x-signature=A61XPn0hEtHDO9qFpQe7bITCNq0%3D" alt="在文件夹地址栏输入cmd" loading="lazy"/></p>
<p>这会在当前文件夹中快速打开一个命令行窗口。</p>
<ol start="2">
<li>
<p><strong>输入命令：</strong> 在打开的命令行窗口中，输入以下命令：
<code>uv run ans.py </code>
（<code>ans.py</code> 后面有一个空格！）</p>
</li>
<li>
<p><strong>指定要降噪的文件：</strong> 在 <code>uv run ans.py </code> 后面，你需要告诉程序哪个文件需要降噪。你可以选择以下两种方式：</p>
<ul>
<li><strong>方式一（推荐）：直接拖拽。</strong> 将你想要降噪的音频或视频文件（例如 <code>我的噪音录音.mp4</code>）直接拖拽到命令行窗口中。文件的完整路径会自动显示在命令后面。</li>
<li><strong>方式二：手动输入路径。</strong> 手动输入文件的完整路径。<strong>如果文件路径中包含空格，请务必用双引号把整个路径括起来</strong>，例如：<code>uv run ans.py "D:\我的视频\吵闹的录音.mp4"</code>。</li>
</ul>
</li>
<li>
<p><strong>执行命令：</strong> 输入或拖拽完成后，按下回车键，程序就开始执行了！</p>
</li>
</ol>
<h2 data-id="heading-5">查看降噪结果</h2>
<p>程序运行完毕后，你会在 <code>ans.py</code> 文件所在的同一个文件夹中，找到一个名为 <code>[你的原文件名]-ans.wav</code> 的新文件。这个文件就是降噪后的音频了！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db5637a065754c6f9c237d1bed92f0f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763339408&amp;x-signature=lkeYepfO9lFfmiB9IoVkkfkiAck%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>第一次运行程序时，<code>uv</code> 会自动下载并配置阿里降噪模型所需的各种库和模型文件。这可能需要一些时间（根据你的网络速度而定），请耐心等待。下载完成后，后续再次运行就会快很多了！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 协议（Protocol）指南（三）：Primary Associated Type、some/any 与泛型式协议实战]]></title>    <link>https://juejin.cn/post/7570271574348447753</link>    <guid>https://juejin.cn/post/7570271574348447753</guid>    <pubDate>2025-11-10T00:30:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570271574348447753" data-draft-id="7554198278955712538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 协议（Protocol）指南（三）：Primary Associated Type、some/any 与泛型式协议实战"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-10T00:30:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 协议（Protocol）指南（三）：Primary Associated Type、some/any 与泛型式协议实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:30:22.000Z" title="Mon Nov 10 2025 00:30:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么 Swift 5.7 再次“颠覆”协议</h2>
<p>在 Swift 5.7 之前，带关联类型的协议只能当约束 <code>&lt;T: Sequence&gt;</code>，不能当类型 <code>Sequence</code>。</p>
<p>这导致两个老大难：</p>
<ol>
<li>声明变量/参数/返回值时，必须再包一层类型擦除（<code>AnySequence&lt;Int&gt;</code>）。</li>
<li>泛型函数无法“一眼看出”序列里到底是什么元素。</li>
</ol>
<p>Swift 5.7 一次性给出三把新钥匙：</p>

























<table><thead><tr><th>特性</th><th>关键词</th><th>解决痛点</th></tr></thead><tbody><tr><td>主要关联类型</td><td><code>protocol Sequence&lt;Element&gt;</code></td><td>把最常用的关联类型“提级”到协议名上</td></tr><tr><td>不透明参数</td><td><code>some Sequence&lt;Int&gt;</code></td><td>直接当参数类型，编译期确定，零运行时开销</td></tr><tr><td>存在性类型</td><td><code>any Sequence&lt;Int&gt;</code></td><td>真·变量类型，运行时盒子，语法终于可读</td></tr></tbody></table>
<h2 data-id="heading-1">Primary Associated Type：把“泛型参数”搬到协议头上</h2>
<ol>
<li>标准库示例</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// Swift 5.7 标准库定义</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Sequence</span>&lt;<span class="hljs-title class_">Element</span>&gt; {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Iterator</span>: <span class="hljs-type">IteratorProtocol</span> <span class="hljs-keyword">where</span> <span class="hljs-type">Iterator</span>.<span class="hljs-type">Element</span> <span class="hljs-operator">==</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIterator</span>() -&gt; <span class="hljs-type">Iterator</span>
}
</code></pre>
<p><code>Element</code> 被写到协议名后面，成为主要关联类型。</p>
<p>于是我们可以像泛型结构体一样，直接写：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">sum</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">numbers</span>: <span class="hljs-keyword">some</span> <span class="hljs-type">Sequence</span>&lt;<span class="hljs-type">Int</span>&gt;) -&gt; <span class="hljs-type">Int</span> {   <span class="hljs-comment">// ① 参数类型</span>
    numbers.reduce(<span class="hljs-number">0</span>, <span class="hljs-operator">+</span>)
}

<span class="hljs-keyword">let</span> total <span class="hljs-operator">=</span> sum([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] <span class="hljs-operator">+</span> [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>])            <span class="hljs-comment">// ② 数组拼接也适用</span>
</code></pre>
<ol start="2">
<li>为自己协议添加“主关联类型”</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feed</span>&lt;<span class="hljs-title class_">Element</span>&gt; {          <span class="hljs-comment">// ① 把最常用的关联类型提出来</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Element</span>?
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">IteratorFeed</span>: <span class="hljs-title class_">Feed</span> {
    <span class="hljs-keyword">var</span> a <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, b <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Int</span>? {
        <span class="hljs-keyword">let</span> next <span class="hljs-operator">=</span> a
        a <span class="hljs-operator">=</span> b
        b <span class="hljs-operator">=</span> next <span class="hljs-operator">+</span> a
        <span class="hljs-keyword">return</span> next
    }
}

<span class="hljs-comment">// ② 立刻享受 some/any 语法</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">makeIntFeed</span>() -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">Feed</span>&lt;<span class="hljs-type">Int</span>&gt; {
    <span class="hljs-type">IteratorFeed</span>()
}

<span class="hljs-keyword">var</span> feeds: [<span class="hljs-keyword">any</span> <span class="hljs-type">Feed</span>&lt;<span class="hljs-type">Int</span>&gt;] <span class="hljs-operator">=</span> []   <span class="hljs-comment">// ③ 数组里放不同实现，无需再包 AnyFeed</span>
</code></pre>
<p>规则</p>
<ul>
<li>只能把一个或多个 <code>associatedtype</code> 声明为“主要”，不强制全部。</li>
<li>主要关联类型顺序不影响使用，但建议按“常用度”排序。</li>
<li>一旦声明，协议就获得“泛型形参”资格，可直接写 <code>Feed&lt;Int&gt;</code>。</li>
</ul>
<h2 data-id="heading-2">some vs. any：一句话区分</h2>



































<table><thead><tr><th>维度</th><th><code>some P</code></th><th><code>any P</code></th></tr></thead><tbody><tr><td>语义</td><td>编译期确定的<strong>某个</strong>具体类型</td><td>运行时存在的<strong>任何</strong>具体类型</td></tr><tr><td>内存布局</td><td>无间接寻址，内联存储</td><td>存在性容器（Box），通过指针引用</td></tr><tr><td>主要用法</td><td>返回值、泛型约束</td><td>变量、集合元素、函数参数</td></tr><tr><td>性能</td><td>零额外开销</td><td>轻微运行时开销（Box管理）</td></tr><tr><td>使用限制</td><td>不能用于<code>var</code>/集合类型声明</td><td>无显式限制</td></tr></tbody></table>
<p>示例对比</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feed</span>&lt;<span class="hljs-title class_">Element</span>&gt; {          <span class="hljs-comment">// ① 把最常用的关联类型提出来</span>
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Element</span>?
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">IteratorFeed</span>&lt;<span class="hljs-title class_">Iterator</span>: <span class="hljs-title class_">IteratorProtocol</span>&gt;: <span class="hljs-title class_">Feed</span>  {
    <span class="hljs-keyword">var</span> iterator: <span class="hljs-type">Iterator</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">iterator</span>: <span class="hljs-type">Iterator</span>) {
        <span class="hljs-keyword">self</span>.iterator <span class="hljs-operator">=</span> iterator
    }
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">next</span>() -&gt; <span class="hljs-type">Iterator</span>.<span class="hljs-type">Element</span>? {
        iterator.next()
    }
}

<span class="hljs-comment">// 1. 返回值：编译期就知道真实类型</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">uniqueElements</span>&lt;<span class="hljs-type">S</span>: <span class="hljs-type">Sequence</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">seq</span>: <span class="hljs-type">S</span>) -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">Sequence</span>&lt;<span class="hljs-type">S</span>.<span class="hljs-type">Element</span>&gt;
<span class="hljs-keyword">where</span> <span class="hljs-type">S</span>.<span class="hljs-type">Element</span>: <span class="hljs-type">Hashable</span> &amp; <span class="hljs-type">Comparable</span> {
    <span class="hljs-type">Set</span>(seq).sorted()
}

<span class="hljs-comment">// 2. 数组：运行期才知道真实类型</span>
<span class="hljs-keyword">var</span> parsers: [<span class="hljs-keyword">any</span> <span class="hljs-type">Feed</span>&lt;<span class="hljs-type">Int</span>&gt;] <span class="hljs-operator">=</span> [
    <span class="hljs-type">IteratorFeed</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].makeIterator()),
    <span class="hljs-type">IteratorFeed</span>(<span class="hljs-built_in">stride</span>(from: <span class="hljs-number">0</span>, to: <span class="hljs-number">10</span>, by: <span class="hljs-number">2</span>).makeIterator())
]
</code></pre>
<h2 data-id="heading-3">实战：一行代码写“泛型” SwiftUI View</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Charts

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ChartView</span>&lt;<span class="hljs-title class_">Data</span>: <span class="hljs-title class_">RandomAccessCollection</span>&gt;: <span class="hljs-title class_">View</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Data</span>.<span class="hljs-title class_">Element</span> == <span class="hljs-title class_">Double</span> {
    <span class="hljs-keyword">let</span> data: <span class="hljs-type">Data</span>
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-comment">// 老写法：调用方必须写冗长泛型参数</span>
    }
}

<span class="hljs-comment">// ✅ 新写法：直接不透明返回，调用方无感知</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">makeChart</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">data</span>: <span class="hljs-keyword">some</span> <span class="hljs-type">RandomAccessCollection</span>&lt;<span class="hljs-type">Double</span>&gt;) -&gt; <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
    
    <span class="hljs-type">Chart</span> {
        <span class="hljs-type">ForEach</span>(data.enumerated(), id: \.offset) { idx,value <span class="hljs-keyword">in</span>
            <span class="hljs-type">LineMark</span>(x: .value(<span class="hljs-string">"x"</span>, idx), y: .value(<span class="hljs-string">"y"</span>, value))
        }
    }
}
</code></pre>
<h2 data-id="heading-4">迁移旧代码：把 AnySequence 换成 any Sequence</h2>





















<table><thead><tr><th>旧代码</th><th>新代码</th></tr></thead><tbody><tr><td><code>AnySequence&lt;Int&gt;</code></td><td><code>any Sequence&lt;Int&gt;</code></td></tr><tr><td><code>AnyPublisher&lt;Int, Never&gt;</code></td><td><code>any Publisher&lt;Int, Never&gt;</code></td></tr><tr><td><code>AnyView</code></td><td><code>any View</code>（iOS 17+ 可用，仍需权衡性能）</td></tr></tbody></table>
<p>步骤</p>
<ol>
<li>在协议名后加 <code>&lt;Element&gt;</code>。</li>
<li>把 <code>eraseToAnyPublisher()</code> / <code>AnySequence(...)</code> 改成 <code>any Sequence&lt;Int&gt;</code>。</li>
<li>若返回值无需运行时多态，直接用 <code>some Sequence&lt;Int&gt;</code> 获得零开销。</li>
</ol>
<h2 data-id="heading-5">性能与二进制大小小贴士</h2>
<ul>
<li><code>some P&lt;T&gt;</code> 完全静态派发，零额外内存。</li>
<li><code>any P&lt;T&gt;</code> 引入存在性容器，16 字节 inline + 外挂堆（若值过大）。</li>
<li>滥用 <code>any</code> 会让二进制出现大量“协议见证表”，release 模式下编译器会优化，但debug 增量编译可能变慢。</li>
<li>对 SwiftUI <code>body</code> 这种超高频调用，优先 <code>some View</code>；只在需要运行时异构数组时才用 <code>any View</code>。</li>
</ul>
<h2 data-id="heading-6">总结</h2>

























<table><thead><tr><th>关键词</th><th>适用场景</th><th>记忆口诀</th></tr></thead><tbody><tr><td><code>protocol P&lt;Element&gt;</code></td><td>给自己协议“提级”</td><td>“协议也能带泛参”</td></tr><tr><td><code>some P&lt;T&gt;</code></td><td>返回值、泛型约束</td><td>“编译期就确定”</td></tr><tr><td><code>any P&lt;T&gt;</code></td><td>变量、数组、字典</td><td>“运行期多态盒子”</td></tr></tbody></table>
<p>一句话总结</p>
<p>Swift 5.7 让协议第一次真正拥有了“泛型形参”能力：</p>
<ul>
<li>写库的人：给协议加 <code>&lt;Element&gt;</code>，调用方立刻享受 <code>some/any</code> 语法糖。</li>
<li>写业务的人：用 <code>some Sequence&lt;Int&gt;</code> 替代冗长泛型约束，用 <code>any Sequence&lt;Int&gt;</code> 替代 <code>AnySequence</code>，代码短一半、可读性翻倍。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 2.x 和 3.x 的核心区别，这些变化你必须知道]]></title>    <link>https://juejin.cn/post/7570191839593332799</link>    <guid>https://juejin.cn/post/7570191839593332799</guid>    <pubDate>2025-11-10T00:34:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570191839593332799" data-draft-id="7564573165705216015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 2.x 和 3.x 的核心区别，这些变化你必须知道"/> <meta itemprop="keywords" content="后端,Java,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-10T00:34:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 2.x 和 3.x 的核心区别，这些变化你必须知道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:34:08.000Z" title="Mon Nov 10 2025 00:34:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>大家好，我是大华！有很多朋友不知道<code>Springboot2.x和3.x</code>有什么区别，用着感觉都差不多。其实3.x是一个重大版本升级。</p>
<h4 data-id="heading-1">为什么 Spring Boot 3.x 这么重要？</h4>
<p>因为它不仅仅是加了几个新功能，而是<strong>整个技术地基都变了</strong>。</p>
<p>下面我们举几个例子来了解一下。</p>
<hr/>
<h3 data-id="heading-2">1. 包名的更新：<code>javax</code> → <code>jakarta</code></h3>
<p>这是2.x升级到3.x时，<strong>改动最大的地方</strong>。</p>
<h4 data-id="heading-3">Spring Boot 2.x（老代码）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">// getter/setter</span>
}
</code></pre>
<h4 data-id="heading-4">Spring Boot 3.x（新代码）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> jakarta.persistence.Entity;  <span class="hljs-comment">// 注意：javax → jakarta</span>
<span class="hljs-keyword">import</span> jakarta.persistence.Id;
<span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest; <span class="hljs-comment">// 同样变了</span>

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-comment">// getter/setter</span>
}
</code></pre>
<p><strong>划重点</strong>：</p>
<ul>
<li>所有 <code>javax.*</code> 都要改成 <code>jakarta.*</code>！</li>
<li>如果你用的是 JPA、Servlet、Validation 等技术，<strong>几乎每个 Java 文件都要改</strong>。</li>
<li>建议使用 IDE 的全局替换功能，但要小心第三方库是否支持。</li>
</ul>
<hr/>
<h3 data-id="heading-5">2. 安全配置</h3>
<p>Spring Boot 3.x 默认使用 <strong>Spring Security 6</strong>，配置方式大变。</p>
<h4 data-id="heading-6">Spring Boot 2.x 配置方式</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            .authorizeRequests()
                .antMatchers(<span class="hljs-string">"/public/**"</span>).permitAll()
                .anyRequest().authenticated()
            .and()
            .formLogin();
    }
}
</code></pre>
<p>注意：<code>WebSecurityConfigurerAdapter</code>在<code>Spring Security 6</code>中<strong>已被废弃</strong>！</p>
<h4 data-id="heading-7">Spring Boot 3.x 推荐方式（使用 Lambda DSL）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">filterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            .authorizeHttpRequests(authz -&gt; authz
                .requestMatchers(<span class="hljs-string">"/public/**"</span>).permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form -&gt; form
                .loginPage(<span class="hljs-string">"/login"</span>)
                .permitAll()
            );
        <span class="hljs-keyword">return</span> http.build();
    }
}
</code></pre>
<p><strong>好处</strong>：</p>
<ul>
<li>更函数式，代码更清晰。</li>
<li>不用继承，更灵活。</li>
<li>编译时就能发现错误，而不是运行时报错。</li>
</ul>
<hr/>
<h3 data-id="heading-8">3. 原生镜像（GraalVM）</h3>
<p>Spring Boot 3.x 原生支持 GraalVM，可以把 Java 应用编译成<strong>原生可执行文件</strong>。</p>
<h4 data-id="heading-9">如何启用原生镜像？</h4>
<p>在 <code>pom.xml</code> 中加入插件：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p>然后运行：</p>
<pre><code class="hljs language-bash" lang="bash">./mvnw -Pnative native:compile
</code></pre>
<p>编译完成后，你会得到一个<strong>不依赖 JVM 的可执行文件</strong>，比如 <code>myapp</code>。</p>
<p>运行它：</p>
<pre><code class="hljs language-bash" lang="bash">./myapp
</code></pre>
<p>你会发现：</p>
<ul>
<li>启动时间：从 5 秒 → <strong>0.1 秒</strong></li>
<li>内存占用：从 300MB → <strong>50MB</strong></li>
</ul>
<p>特别适合：Serverless、微服务、边缘计算等资源敏感场景。</p>
<hr/>
<h3 data-id="heading-10">4. 云原生支持：Liveness 和 Readiness</h3>
<p>Spring Boot 3.x 的健康检查更专业，适合 Kubernetes。</p>
<h4 data-id="heading-11">配置 <code>application.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,info,liveness,readiness</span>
</code></pre>
<h4 data-id="heading-12">访问新端点</h4>
<ul>
<li><code>GET /actuator/health/liveness</code> → 检查应用是否“活着”（是否崩溃）</li>
<li><code>GET /actuator/health/readiness</code> → 检查应用是否“就绪”（是否可以接收流量）</li>
</ul>
<p>K8s 可以用这两个接口做更精准的健康检查，避免误杀或误导流。</p>
<hr/>
<h3 data-id="heading-13">那我现在该升级吗？</h3>
<p>看情况！分两种：</p>
<h4 data-id="heading-14">推荐升级的情况：</h4>
<ul>
<li><strong>新项目</strong>：直接上 Spring Boot 3.x + Java 17！</li>
<li><strong>想玩原生镜像</strong>：追求极致性能和启动速度。</li>
<li><strong>云原生项目</strong>：用 K8s、微服务架构。</li>
</ul>
<h4 data-id="heading-15">暂缓升级的情况：</h4>
<ul>
<li><strong>还在用 Java 8</strong>：必须先升级 JDK。</li>
<li><strong>依赖老旧库</strong>：比如某些中间件 SDK 还不支持 <code>jakarta</code>。</li>
<li><strong>项目稳定，无大改动</strong>：可以等下次大版本迭代时再升级。</li>
</ul>
<hr/>
<h3 data-id="heading-16">总结对比表</h3>








































<table><thead><tr><th>特性</th><th>Spring Boot 2.x</th><th>Spring Boot 3.x</th></tr></thead><tbody><tr><td><strong>最低 Java 版本</strong></td><td>Java 8</td><td><strong>Java 17</strong></td></tr><tr><td><strong>包名</strong></td><td><code>javax.*</code></td><td><code>jakarta.*</code></td></tr><tr><td><strong>原生镜像</strong></td><td>不支持</td><td><strong>原生支持</strong></td></tr><tr><td><strong>Spring Security</strong></td><td>继承 <code>WebSecurityConfigurerAdapter</code></td><td>使用 <strong>DSL 配置</strong></td></tr><tr><td><strong>云原生支持</strong></td><td><code>/health</code></td><td><code>/liveness</code>, <code>/readiness</code></td></tr><tr><td><strong>未来支持</strong></td><td>逐渐停止</td><td><strong>主推版本</strong></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">最后一句话</h3>
<p>SpringBoot3.x不是可选项，而是<strong>Java 开发现代化的必经之路</strong>。</p>
<p>早点了解，早点准备，别等到公司要求升级时，你还在问“<code>javax</code>和<code>jakarta</code>有啥区别？”</p>
<p>另外<code>SpringBoot4.x</code>很快就发布正式版了，可以关注一下。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-18">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">《这20条SQL优化方案，让你的数据库查询速度提升10倍》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fy-GJ26kl0-yT6hE3fy2KjQ" target="_blank" title="https://mp.weixin.qq.com/s/y-GJ26kl0-yT6hE3fy2KjQ" ref="nofollow noopener noreferrer">《MySQL 为什么不推荐用雪花ID 和 UUID 做主键？》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1Th3DuMqYpt4Xg5hEywIww" target="_blank" title="https://mp.weixin.qq.com/s/1Th3DuMqYpt4Xg5hEywIww" ref="nofollow noopener noreferrer">《用html写了个超好用的网页主题切换插件》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfSMv8b_2Z-kozaBeiCgqrA" target="_blank" title="https://mp.weixin.qq.com/s/fSMv8b_2Z-kozaBeiCgqrA" ref="nofollow noopener noreferrer">《SpringBoot3+Vue3实现的数据库文档工具》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[等 AI 编程普及后，我该何去何从？]]></title>    <link>https://juejin.cn/post/7570187256105664518</link>    <guid>https://juejin.cn/post/7570187256105664518</guid>    <pubDate>2025-11-10T00:40:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570187256105664518" data-draft-id="7563981206673768475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="等 AI 编程普及后，我该何去何从？"/> <meta itemprop="keywords" content="AI编程,人工智能"/> <meta itemprop="datePublished" content="2025-11-10T00:40:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端双越老师"/> <meta itemprop="url" content="https://juejin.cn/user/1714893868765373"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            等 AI 编程普及后，我该何去何从？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893868765373/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端双越老师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:40:40.000Z" title="Mon Nov 10 2025 00:40:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是双越。前百度 滴滴 资深前端工程师，慕课网金牌讲师，PMP。我的代表作有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wangeditor.com%2F" target="_blank" title="https://www.wangeditor.com/" ref="nofollow noopener noreferrer">wangEditor</a> 开源 web 富文本编辑器，GitHub 18k star，npm 周下载量 20k</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.huashuiai.com%2F" target="_blank" title="https://www.huashuiai.com/" ref="nofollow noopener noreferrer">划水AI</a> Node 全栈 AIGC 知识库，包括 AI 写作、多人协同编辑。复杂业务，真实上线。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshipai.com%2F" target="_blank" title="https://www.mianshipai.com/" ref="nofollow noopener noreferrer">前端面试派</a> 系统专业的面试导航，刷题，写简历，看面试技巧，内推工作。开源免费。</li>
</ul>
<blockquote>
<p>我在正在开发一个 AI Agent 智能体项目【<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhitalk.chat%2F" target="_blank" title="https://zhitalk.chat/" ref="nofollow noopener noreferrer">智语</a>】一个智能面试官，可以优化简历、模拟面试、解答题目等。有兴趣的同学可以围观、学习。</p>
</blockquote>
<h2 data-id="heading-0">开始</h2>
<p>前几天有个同学和我聊天，说自从使用 AI 编程以后，感觉 AI 写代码比自己写的都好，自己会的这点东西还不如 AI 会的多，感觉很焦虑，都不知道接下来该往哪块学习了，没有了方向。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/052586f8abc041b086ab99215f32e0f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340039&amp;x-signature=hLm8Y%2B%2F8XvJ9gTlTy4XjmCE3aps%3D" alt="image.png" loading="lazy"/></p>
<p>他让我帮忙分析一下这个话题。我这几天没事儿就在想这个事情，想的东西很多，乱七八糟的，正好写篇文章梳理一下思路。</p>
<h2 data-id="heading-1">明确范围，减少争论</h2>
<p>本文聊的话题是一个大众话题，是针对绝大部分开发人员（尤其前端开发人员）的话题，大家都是普通开发者，每天做着普通的工作，都会被 AI 编程所影响。</p>
<p>如果你列举某个小众领域，很难，AI 搞不定。或者一个项目某一两个功能，很难， AI 搞不定。这种情况肯定存在，而且会持续存在，但它是小众的，不适用于大部分人。如果你正好在这种小众领域中，那恭喜你 AI 编程暂时对你影响不大。但你可千万别失业，因为失业了再找工作，小众领域的职位可没那么多。</p>
<p>最近 2 年，我每周都有几次 1v1 简历优化和模拟面试，聊过不知道多少人，能真正做过有难度项目的屈指可数，大部分都是增删改查。看网络上评论区这么热闹，人均架构师，动不动就并发量、大数据，其实实际工作啥样大家都知道。这就像知乎、脉脉人均年薪百万一样，实际大部分人的工资 1-2w 一个月，我接触的这些人，能超过 2w 的就是前几名了。</p>
<p>以 Cursor 为代表的 AI 编程工具，已经非常普及了，关键它们还都收费！！！所有大众的、收费的产品，只要不是强制的，它就一定是能解决实际问题，带来实际价值的。</p>
<p>免费的垃圾有的是，例如加 xxx 免费领取 20G 学习资料，下载了也是空占硬盘。但收费的、而且每个月持续收费的，一定不会是垃圾。</p>
<p>所以不要用一些小众的案例来否定 AI 编程的价值和趋势。</p>
<p>还有，本文讨论的是一个未来趋势，不是现在、今天或今年。不过这个未来也不会太遥远，我估计 2-3 年 AI 编程工具就会全面普及，即新手入门写第一行 <code>Hello world</code> 就都用 AI 写。</p>
<h2 data-id="heading-2">面试的变化</h2>
<p>10 多年之前，国内刚开始有前端这个岗位，还是 jQuery 的时代。那时候面试经常考 DOM API ，例如 DOM 节点 attr 和 Prop 的区别、如何防止 XSS 攻击等。还经常考浏览器兼容性问题，因为那时候 IE 浏览器还大量存在。</p>
<p>再后来，Vue React 普及以后，就不再问 DOM API 的问题了。DOM API 依然存在，但早已经被 Vue React 等框架给封装的密不透风，你日常开发几乎用不到 DOM API 。</p>
<p>前几年面试经常考八股文，这是因为当年招聘市场需要大量的前端开发人员，只要能干活就可以来，要求不那么高。</p>
<p>大厂喜欢考算法、考源码，这是因为大厂开的工资高，要统一、流程性的去筛选最优秀的程序员。算法和源码就是最低成本的筛选方式。基本上一道算法题，就可以屏蔽掉 99% 的培训班出厂人员。</p>
<p>现在考的最多的是场景题，就是给你一个需求，让你去设计甚至直接写代码。因为现在市场需求少，预算低，企业更加务实，尽量低成本招聘能干活的人。</p>
<p>我大胆猜测，AI 编程普及以后，面试的过程和重点会逐步发生变化，会更多考察场景题，更注重思考能力、设计能力和 AI 应用的技巧。例如一场面试可能就一个题：使用 AI 编程实现一个 xxx app ，具体有 xxx 需求。等 AI 写完以后让你解释核心代码和流程，讲解设计和实现的思路。然后再给你加一些需求，让你继续用 AI 修改。在这个设计、编码、解释、修改的整个过程中，去观察这个候选人的工作能力。</p>
<p>而且，不会再区分前后端，有 AI 的加持可以打破技术栈的界限。甚至可以直接一键即成 Supabase 数据库、一键发布到 Vercel 等这种服务。真正的全栈、全能。</p>
<p>如果我是一个老板，我要招聘程序员，我觉得用这种方式非常有效。尤其对于中小企业，以及大厂的小团队。</p>
<h2 data-id="heading-3">AI 编程擅长做什么</h2>
<p>AI 编程能做的事情非常多，而且做的又快又好，所以才会让这么多人付费。</p>
<p>第一，对于描述明确的需求，常规的开发任务，它都能很好的完成任务，代码质量相当于中级程序员，有 AI 辅助我们都不用在记什么 API 和语法了</p>
<p>第二，它写的非常快，几百行代码、创建多个文件，都可以在 1 分钟之内写完，这是人工达不到的速度。</p>
<p>第三，在你的规范和要求下，它可以很好的考虑到代码的安全性、稳定性和兼容性，而且时刻坚决执行，人工很难时时刻刻想到这么全面</p>
<p>第三，AI 非常擅长解读陌生代码，解释陌生的 API ，当你拿到一个新的代码库，配合 AI 编程可以快速掌握。如果纯人工去解读、去查询，即便是有经验的老程序员，也得耗费大量精力去查询、梳理、总结。</p>
<p>第四，当你要开发新功能时，AI 可以很好的帮助你梳理设计步骤和思路，Cursor 就有一个 plan mode 它先帮你制定计划，你觉得不合适可以修改它的计划，然后再按照计划去开发</p>
<p>（暂时想到这么多，如果其他欢迎评论区来补充、分享）</p>
<p>我说这些好处的真正目的是：<strong>我们要避其锋芒，不要和 AI 的长处硬刚，在这方面碳基生物刚不过硅基物种</strong>。</p>
<p>现在大家手机里都有计算器，你乘法除法计算多快，能有计算器快吗？你夜观天象经验在足，不如看一眼天气预报。</p>
<p>AI 擅长做什么，我们就不要去和它争，也不要觉得 AI 会的你不会，感觉自己一无是处、能力退化了。AI 再厉害也需要人工来驾驶它。</p>
<p>我们要做 AI 的主人，去学习高效使用它，我们要凌驾于它之上，去做它不擅长的事情。</p>
<h2 data-id="heading-4">AI 编程不擅长的</h2>
<p>当前 AI 最大的毛病就是“一本正经的胡说八道”，它搞错了它也会按照这个方向来，你不纠正，它就会一直找着这个这个方向走下去。在 AI 的世界里，没有南墙。</p>
<p>因为 LLM 背后的原理就是：预测下一个词。你不管它，它就会一直预测下去，反正它有海量的数据。</p>
<h3 data-id="heading-5">需求明确</h3>
<p>写到这里我想到一个段子。会去程序员业余去做外包，甲方老板说：你就给我做一个淘宝就行，就照着淘宝做。</p>
<p>你是程序员，老板让你做个淘宝，需求就这一句话，你知道做啥吗？根本没法做。淘宝太庞大了，你想实现哪些功能，要写出明确的需求，最好还有界面和原型图。这样才能继续设计、开发。</p>
<p>所以有经验的程序员会再去和老板沟通，或者派一个需求专员和老板沟通，把需求确定下来。</p>
<p>人，在遇到不懂的地方时，会去咨询、查询、沟通，如果过程不顺利会被卡住，执行不下去。此时你如果继续强制压迫他，他就会产生逆反心理、摆烂、躺平、辞职。</p>
<p>但是 AI 不会这样。默认情况下，AI 会一本正经的胡说八道，它就没有不懂的时候。它搞错了它也会按照这个方向来。你自己不手握方向盘时会开沟里，越陷越深。</p>
<p>所以，我们给 AI 写需求一定要清晰明了，说专业一点就是 prompt engineering 提示词工程，要能去通过正确的 prompt 引导 AI 给出正确的答案。</p>
<p>这个说来简单，其实对于绝大部分程序员都是一个挑战，程序员真的不擅长沟通。</p>
<p>例如，有太多同学给我提问题，无论是现在 vx 聊天提问，还是之前在 GitHub issue 提问，就写一句话“我代码报错了...” 其他啥信息都没有。你说的我都看不懂，AI 能看懂才怪呢。</p>
<p>再例如，我 1v1 模拟面试，让他介绍一下自己的项目，太多人磕磕巴巴想一句说一句，最后也说不到重点上。自己做过的项目都说不清楚，那让你设计一个新项目，你就能描述清楚？</p>
<h3 data-id="heading-6">技术栈管理</h3>
<p>AI 啥都会，但你的项目不能啥都用。你需要根据自己的情况选择合适的技术栈，以及选择合适的工具。</p>
<p>要开发一个前端项目，你需要选择 Vue React 等框架，选择 Vite webpack 等打包工具，选择一个合适的 UI 组件库。如果开发一些特定的功能，如编辑器、表格、地图等，你也需要自己确定使用哪些第三方插件。</p>
<p>你可以让 AI 帮你选择，帮你对比第三方插件的优缺点，但你依然需要具备良好的判断能力。因为 AI 会出错，而且会沿着错误继续走。</p>
<p>所以，你需要掌握前端、全栈等你的核心技术栈，知道这个技术栈相关的知识体系。在 AI 加持下你不用了解太细节，但你得有广度和视野。你要清楚用什么技术能实现什么功能，你要有自己的方向，你要去“驾驶”AI按照这个技术方案走。否则，完全让 AI 自由发挥是很容易乱套的。</p>
<h3 data-id="heading-7">架构拆分</h3>
<p>如果你要设计开发一个大型项目，直接让 AI 帮你开始做，这几乎是不可能的。大型项目你没法一下子描述清楚需求，直接让 AI 开始的话，AI 很容易自由发挥，最终失控。</p>
<p>大型项目，在明确需求的基础上，首先应该做架构拆分，模块拆分。把一个系统拆分为不同的模块，一个模块拆分为不同的页面或者组件，每个部分之间都规定好接口，解藕。这个过程可以让 AI 帮助你设计和分析，但决定权还是在你。</p>
<p>完成设计以后，对于每个模块或功能的内部，再让 AI 去开发。即便 AI 可能会把代码写的很乱，但没关系，只要模块之间还遵守设计时的接口约定，模块内部乱了没关系。</p>
<p>即 AI 可以更多的帮你做具体的功能实现，这种需求转化为架构的工作，AI 只能辅助，判断权还是在你。对于大型项目，你无法从 0 就交给 AI 去做。</p>
<h2 data-id="heading-8">技术越进步，对人的要求就越“高级”</h2>
<p>没错技术更新，对人的要求就会越高级。这个高级的意思是：<strong>更高一个层级</strong>，并不一定要求越高。</p>
<p>马车时代司机会赶车就行，汽车时代司机就得考驾照、懂交通规则、驾驶汽车、甚至要会维修汽车。</p>
<p>卓别林时代工人拿着大钳子，现代工厂里，工人都是操作机械手臂。</p>
<p>电脑刚出来的时候，打字员就是高级技工。</p>
<p>编程刚出现的时候，CPU 指令、寄存器、内存都需要人工编码来管理。</p>
<p>互联网刚发展时，会做页面，会增删改查就行，DOM 操作得熟练。</p>
<p>Vue React 刚出来时，会用 Vue 写网页就行，DOM 操作要求不高了。</p>
<p>AI 编程普及以后，又会有什么变化呢？ 欢迎留言评论。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 105 期 - npm 安全性加强、Storybook 10、htmx 4.0 Alpha 1...]]></title>    <link>https://juejin.cn/post/7569946369990590527</link>    <guid>https://juejin.cn/post/7569946369990590527</guid>    <pubDate>2025-11-10T00:47:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569946369990590527" data-draft-id="7569871848793784339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 105 期 - npm 安全性加强、Storybook 10、htmx 4.0 Alpha 1..."/> <meta itemprop="keywords" content="前端,NPM,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T00:47:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 105 期 - npm 安全性加强、Storybook 10、htmx 4.0 Alpha 1...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T00:47:58.000Z" title="Mon Nov 10 2025 00:47:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 105 期 (2025.11.03 - 2025.11.09)</strong>：浏览前端一周最新消息，学习国内外优秀文章视频，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.blog%2Fchangelog%2F2025-11-05-npm-security-update-classic-token-creation-disabled-and-granular-token-changes%2F" target="_blank" title="https://github.blog/changelog/2025-11-05-npm-security-update-classic-token-creation-disabled-and-granular-token-changes/" ref="nofollow noopener noreferrer">npm 安全性加强</a></strong>：目前 npm 传统令牌（classic tokens）已无法新建，但现有令牌最迟将持续生效至 2026 年 2 月 3 日，你需要将传统令牌升级为细粒度访问令牌（fine-grained access tokens）。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstorybook.js.org%2Fblog%2Fstorybook-10%2F" target="_blank" title="https://storybook.js.org/blog/storybook-10/" ref="nofollow noopener noreferrer">Storybook 10</a></strong>：Storybook 10 发布，该版本正式告别 CommonJS 格式，目前仅支持 ESM 格式，并因此大幅降低了体积。此外，该版本还包含以下新特性：与 Vitest 团队合作开发的全新模块自动模拟方案、对 Next.js 16 和 Vitest 4 的支持，以及 Storybook 组件故事格式（CSF）的升级版本。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fhtmx.org%2Fessays%2Fthe-fetchening%2F" target="_blank" title="https://htmx.org/essays/the-fetchening/" ref="nofollow noopener noreferrer">htmx 4.0 Alpha 1</a></strong>：htmx 框架从未计划推出 v3 版本，那 v4 版本又会如何呢。htmx 4.0（代号“The fetch () ening”）将以三大核心重构为主要目标，在保留核心功能的同时优化体验、新增特性，且采用渐进式升级策略。核心变更包括：底层请求机制替换（<code>fetch</code> 替换 <code>XMLHttpRequest</code>）、属性继承显式化和历史记录机制简化。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.polarsignals.com%2Fblog%2Fposts%2F2025%2F11%2F04%2Fjavascript-source-maps-internals" target="_blank" title="https://www.polarsignals.com/blog/posts/2025/11/04/javascript-source-maps-internals" ref="nofollow noopener noreferrer">The Inner Workings of JavaScript Source Maps</a></strong>：JavaScript 源映射（Source Maps）的内部工作原理 - 深入解析 JavaScript 源映射（Source Maps）的底层工作原理，并通过示例展示其各个组成部分如何协同运作。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Falfy.blog%2F2025%2F10%2F31%2Fyour-url-is-your-state.html" target="_blank" title="https://alfy.blog/2025/10/31/your-url-is-your-state.html" ref="nofollow noopener noreferrer">Your URL Is Your State</a></strong>：URL 即状态 - 文中探讨了利用 URL 各类组成部分表示状态所具备的“被忽视的价值”与简洁性。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7569076041957883945" target="_blank" title="https://juejin.cn/post/7569076041957883945">前端人必看的 node_modules 瘦身秘籍：从臃肿到轻盈，Umi 项目依赖优化实战</a></strong>：文章基于 Umi 框架特性，提供一套可落地的完整优化方案，从分析到执行，一步步将 node_modules 体积控制在合理范围。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fimage-dimensions" target="_blank" title="https://github.com/sindresorhus/image-dimensions" ref="nofollow noopener noreferrer">image-dimensions</a></strong>：获取图片的尺寸信息，可在浏览器、Node.js、Bun、Deno 环境中运行。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63da76b54a1e4964861f2cc0c7ac5f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340478&amp;x-signature=wIv4HO5f3mKdihpzxGLcs14Q2dE%3D" width="100%" alt="image-20251109075135237" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Freact-syntax-highlighter.github.io%2Freact-syntax-highlighter%2Fdemo%2F" target="_blank" title="https://react-syntax-highlighter.github.io/react-syntax-highlighter/demo/" ref="nofollow noopener noreferrer">React Syntax Highlighter</a></strong>：一款 React 代码语法高亮组件。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3199b7c0dd5e4f9a88f56960bfad7d70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340478&amp;x-signature=ww9cTtgE7JYY5d6dNL%2FIJA%2BA6CE%3D" width="100%" alt="image-20251109075500378" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falephpi%2FTexo" target="_blank" title="https://github.com/alephpi/Texo" ref="nofollow noopener noreferrer">Texo</a></strong>：开源的数学公式 OCR 引擎，通过前端加载模型，将数学公式的截图转成 LaTex 语法。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f732d0def7804b6a9799a3028f49376e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763340478&amp;x-signature=P3vu4llfzqGI9S%2BusirjGCt%2Fb5o%3D" width="100%" alt="image-20251109084341917" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 协议（Protocol）指南（四）：协议扩展（Protocol Extension）——让“协议”自己也有默认实现]]></title>    <link>https://juejin.cn/post/7570268773333434395</link>    <guid>https://juejin.cn/post/7570268773333434395</guid>    <pubDate>2025-11-10T01:00:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570268773333434395" data-draft-id="7553952804924784674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 协议（Protocol）指南（四）：协议扩展（Protocol Extension）——让“协议”自己也有默认实现"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-10T01:00:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 协议（Protocol）指南（四）：协议扩展（Protocol Extension）——让“协议”自己也有默认实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T01:00:35.000Z" title="Mon Nov 10 2025 01:00:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么要有“协议扩展”</h2>
<ol>
<li>
<p>协议只能“声明”要求，不能“实现”要求</p>
<p>在 Swift 2 之前，协议类似 Java 的 Interface：</p>
<ul>
<li>只能写方法签名，不能写大括号实现。</li>
<li>所有遵守者必须自己抄一遍模板代码，导致大量重复。</li>
</ul>
</li>
<li>
<p>协议扩展的到来（Swift 2+）</p>
<p>官方给协议本身也增加了 extension 语法，允许：</p>
<ul>
<li>提供默认实现（default implementation）</li>
<li>追加新的计算属性 / 方法 / 下标 / 关联类型约束</li>
</ul>
<p>于是“协议 + 扩展”合二为一，既能约束，又能给代码。</p>
</li>
<li>
<p>与“基类”相比的优势</p>
<ul>
<li>多继承效果：一个类型可同时遵守多条带默认实现的协议。</li>
<li>值类型可用：struct/enum 也能享受默认实现，而它们没有继承。</li>
<li>Retroactive：即使第三方类型，只要让它遵守协议即可注入功能。</li>
<li>可拆分：把“接口”与“实现”彻底分离，各模块按需依赖。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">语法速览</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> 某能力 {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">foo</span>()          <span class="hljs-comment">// 声明：遵守者“可以”自己实现</span>
}
<span class="hljs-keyword">extension</span> 某能力 {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">foo</span>() { <span class="hljs-built_in">print</span>(<span class="hljs-string">"默认 foo"</span>) }  <span class="hljs-comment">// 默认实现</span>
}
</code></pre>
<p>调用优先级（谁赢？）</p>
<p><code>类型自身实现 &gt; 协议扩展实现 &gt; 父类实现</code></p>
<p>也就是说：</p>
<ul>
<li>如果类型自己写了 foo，就用自己的；</li>
<li>如果没写，就用协议扩展的；</li>
<li>如果多个协议都提供了默认实现，则类型必须提供多个协议中相同方法的实现</li>
</ul>
<h3 data-id="heading-2">4 大能力拆解</h3>
<ol>
<li>提供默认实现（最常用）</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">TextDescribable</span> {
    <span class="hljs-keyword">var</span> text: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">TextDescribable</span> {
    <span class="hljs-comment">// 80% 的场景只需要这个实现</span>
    <span class="hljs-keyword">var</span> text: <span class="hljs-type">String</span> { <span class="hljs-type">String</span>(describing: <span class="hljs-keyword">self</span>) }
}

<span class="hljs-comment">// 结构体什么都不用做就获得了 text</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span>: <span class="hljs-title class_">TextDescribable</span> {
    <span class="hljs-keyword">let</span> x, y: <span class="hljs-type">Double</span>
}
<span class="hljs-keyword">let</span> p <span class="hljs-operator">=</span> <span class="hljs-type">Point</span>(x: <span class="hljs-number">1</span>, y: <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(p.text)   <span class="hljs-comment">// "Point(x: 1.0, y: 2.0)"</span>
</code></pre>
<ol start="2">
<li>追加新功能（协议自己“加私货”）</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">CollectionPlus</span> {}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">CollectionPlus</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Self</span>: <span class="hljs-title class_">Collection</span> {
    <span class="hljs-comment">/// 任何 Collection 一键转 JSON 数组字符串</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">jsonString</span>() -&gt; <span class="hljs-type">String</span>? {
        <span class="hljs-keyword">guard</span>
            <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> <span class="hljs-type">JSONSerialization</span>.data(withJSONObject: <span class="hljs-type">Array</span>(<span class="hljs-keyword">self</span>), options: [])
        <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> }
        <span class="hljs-keyword">return</span> <span class="hljs-type">String</span>(data: data, encoding: .utf8)
    }
}

<span class="hljs-comment">// 让数组自动获得能力</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Array</span>: <span class="hljs-title class_">CollectionPlus</span> {}
<span class="hljs-built_in">print</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>].jsonString())  <span class="hljs-comment">// Optional("[1,2,3]")</span>
</code></pre>
<p>要点：</p>
<ul>
<li><code>where Self: Collection</code> 把能力限制在“真正遍历得到元素”的类型上，避免 <code>String</code> 等也误闯。</li>
<li>这种“协议 + where”组合又称“条件扩展”，是 POP 的精髓。</li>
</ul>
<ol start="3">
<li>多协议冲突与消除歧义</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>()
}
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">B</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>()
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"A"</span>)
    }
}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">B</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"B"</span>)
    }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">C</span>: <span class="hljs-title class_">A</span>, <span class="hljs-title class_">B</span> {
    <span class="hljs-comment">// 有同名的方法，必须在这里实现</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"C"</span>)
    }
}

<span class="hljs-keyword">let</span> c <span class="hljs-operator">=</span> <span class="hljs-type">C</span>()
c.play()
<span class="hljs-comment">// 这里不管怎样as，都会调用C中的实现</span>
(c <span class="hljs-keyword">as</span> <span class="hljs-type">A</span>).play()   <span class="hljs-comment">// A</span>
(c <span class="hljs-keyword">as</span> <span class="hljs-type">B</span>).play()   <span class="hljs-comment">// B</span>
</code></pre>
<p>结论：</p>
<ul>
<li>协议扩展不会“重载”，只会“冲突”。</li>
<li>在设计 SDK 时，尽量给方法加前缀，或把能力拆成更细粒度协议。</li>
</ul>
<ol start="4">
<li>扩展协议本身也能“关联类型”约束</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Summable</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Element</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">reduce</span>() -&gt; <span class="hljs-type">Element</span>
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Summable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Element</span>: <span class="hljs-title class_">Numeric</span> {
    <span class="hljs-comment">// 只有 Element 遵守 Numeric 才给默认实现</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">reduce</span>() -&gt; <span class="hljs-type">Element</span> { <span class="hljs-number">0</span> }
}
</code></pre>
<p>利用这套机制，我们可以把“算法”写成协议，再根据不同关联类型分发不同默认实现。</p>
<h2 data-id="heading-3">实战 3 段式：“接口 → 默认实现 → 具体类型”</h2>
<p>场景：做一个日志组件，既能本地 <code>print</code>，也能远程上报，还能一键关闭。</p>
<ol>
<li>定义接口</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">log</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">msg</span>: <span class="hljs-type">String</span>, <span class="hljs-params">file</span>: <span class="hljs-type">String</span>, <span class="hljs-params">line</span>: <span class="hljs-type">Int</span>)
}
</code></pre>
<ol start="2">
<li>提供默认实现（99% 模块只需要打印）</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">log</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">msg</span>: <span class="hljs-type">String</span>,
             <span class="hljs-params">file</span>: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#fileID</span>,
             <span class="hljs-params">line</span>: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#line</span>) {
        <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🪵<span class="hljs-subst">\(file)</span>:<span class="hljs-subst">\(line)</span> | <span class="hljs-subst">\(msg)</span>"</span>)
        <span class="hljs-keyword">#endif</span>
    }
}
</code></pre>
<ol start="3">
<li>任意类型一键获得日志能力</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkManager</span>: <span class="hljs-title class_">Logger</span> {}   <span class="hljs-comment">// 空实现即可</span>
<span class="hljs-type">NetworkManager</span>().log(<span class="hljs-string">"请求接口 /user/info"</span>)
</code></pre>
<p>如果想“远程上报”怎么办？</p>
<p>——只在自己类型里重新实现 <code>log()</code>，默认实现就被覆盖，其他模块不受影响。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteLog</span>: <span class="hljs-title class_">Logger</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">log</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">msg</span>: <span class="hljs-type">String</span>, <span class="hljs-params">file</span>: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#file</span>, <span class="hljs-params">line</span>: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#line</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"假装这里上报到了远端"</span>)
    }
}
<span class="hljs-type">RemoteLog</span>().log(<span class="hljs-string">"any message"</span>)
</code></pre>
<h3 data-id="heading-4">与泛型结合：写出“算法级别”的复用</h3>
<p>例子：给一个“能比较”的数组追加“最大 N 个”方法</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">TopNable</span> {}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">TopNable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Self</span>: <span class="hljs-title class_">Sequence</span>, <span class="hljs-title class_">Self</span>.<span class="hljs-title class_">Element</span>: <span class="hljs-title class_">Comparable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">topN</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">n</span>: <span class="hljs-type">Int</span>) -&gt; [<span class="hljs-keyword">Self</span>.<span class="hljs-type">Element</span>] {
        <span class="hljs-keyword">let</span> sorted <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.sorted(by: <span class="hljs-operator">&gt;</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-type">Array</span>(sorted.prefix(n))
    }
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Array</span>: <span class="hljs-title class_">TopNable</span> {}
<span class="hljs-built_in">print</span>([<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">9</span>].topN(<span class="hljs-number">3</span>))   <span class="hljs-comment">// [9, 7, 3]</span>
</code></pre>
<ul>
<li>没有创建基类，也没有改动 Array 源码。</li>
<li>任何 <code>Sequence</code> + <code>Comparable</code> 的类型都能一键获得 <code>topN</code> 能力。</li>
<li>想换算法？只改协议扩展一处即可。</li>
</ul>
<h3 data-id="heading-5">协议扩展不能做的事</h3>
<ol>
<li>
<p>不能给协议新增“存储属性”</p>
<p>只能写计算属性，原因与类型扩展一样：无法分配内存。</p>
</li>
<li>
<p>不能给协议写 <code>deinit</code> / 存储型观察器</p>
<p>协议本身没有生命周期。</p>
</li>
<li>
<p>不能“强制”让遵守者失去默认实现</p>
<p>一旦提供了默认实现，遵守者永远“隐式”拥有它；想强制其重写，只能把默认实现删掉。</p>
</li>
<li>
<p>不能防止“菱形冲突”</p>
<p>多协议默认实现冲突时，必须重新实现冲突的方法</p>
</li>
</ol>
<h3 data-id="heading-6">工作流 checklist：如何设计一套“POP 组件”</h3>
<ol>
<li>先写最小协议，只放“必须”约束。</li>
<li>再写协议扩展，给通用能力提供默认实现。</li>
<li>用 <code>where</code> 做条件扩展，把算法拆成“高内聚”的小协议。</li>
<li>给可能冲突的方法加前缀，或拆成更细粒度协议。</li>
<li>值类型优先（struct/enum），避免继承树。</li>
<li>单元测试：针对“协议 + 默认实现”写测试，任何遵守者自动受益。</li>
<li>文档：在协议头上写注释，Xcode 会自动带到所有遵守者，无需重复写。</li>
</ol>
<h3 data-id="heading-7">总结</h3>
<ul>
<li>协议扩展 = 协议（约束） + 扩展（实现），是 Swift 对“接口编程”的终极回答。</li>
<li>它让“多继承”在值类型世界成为可能，同时保持静态派度、无运行时开销。</li>
<li>掌握“默认实现 + where 约束”两件套，就能把“算法”从类型身上剥离出来，真正做到“写一次，到处复用”。</li>
<li>牢记冲突规则与优先级，设计 SDK 时留好“消除歧义”的逃生舱。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[“提升效率”论正确吗？上限及上限之后]]></title>    <link>https://juejin.cn/post/7569977160276328491</link>    <guid>https://juejin.cn/post/7569977160276328491</guid>    <pubDate>2025-11-10T01:01:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569977160276328491" data-draft-id="7570191839593381951" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="“提升效率”论正确吗？上限及上限之后"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-10T01:01:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Juchecar"/> <meta itemprop="url" content="https://juejin.cn/user/284133851925070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            “提升效率”论正确吗？上限及上限之后
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/284133851925070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Juchecar
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T01:01:23.000Z" title="Mon Nov 10 2025 01:01:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>问：人类进化或者科技发展，最终都是为了“提升效率”吗？那效率提升有无上限？到达后，会怎样？</p>
<p>这是一个非常深刻且引人深思的问题，它触及了人类文明发展的核心驱动力和终极边界。我们可以从几个层面来探讨。</p>
<h3 data-id="heading-0">第一部分：最终都是为了“提升效率”吗？</h3>
<p>这个说法在很大程度上是正确的，但并非全部。我们可以将其看作一个强大的“底层逻辑”和“主要结果”，但并非唯一的终极目的。</p>
<p><strong>1. 进化：效率是生存的硬道理</strong>
在生物进化中，“效率”体现在<strong>能量和生存策略</strong>上。</p>
<ul>
<li><strong>能量效率</strong>：哪个生物能更有效地获取能量（食物）、并降低消耗（如更优的体温调节、更节能的运动方式），它就能在生存竞争中占据优势，留下更多后代。人类进化出直立行走、发达的大脑，都极大地提升了能量利用效率和信息处理效率。</li>
<li><strong>策略效率</strong>：社会性合作、工具使用、语言的出现，都是提升生存和繁衍“效率”的革命性创新。它们让人类能以更低的成本（个体风险、学习时间）获得更大的收益（狩猎成功率、知识传承）。</li>
</ul>
<p>所以，从进化的结果看，<strong>自然选择偏爱那些在特定环境中“生存繁衍效率”更高的性状</strong>。在这个意义上，进化确实是在“提升效率”。</p>
<p><strong>2. 科技发展：效率是核心驱动力</strong>
科技史几乎就是一部效率提升史。</p>
<ul>
<li><strong>农业革命</strong>：驯化动植物，提升了食物生产的效率，让人口得以稳定增长。</li>
<li><strong>工业革命</strong>：蒸汽机、电力，提升了物质生产和运输的效率。</li>
<li><strong>信息革命</strong>：计算机和互联网，提升了信息处理和传播的效率。</li>
</ul>
<p>每一次科技飞跃，都让人类用更少的体力、时间、资源，完成更多、更复杂的工作。我们追求科技，本质上是为了<strong>克服生存和发展的限制</strong>，而克服限制最直接的体现就是效率的提升——更快、更高、更强。</p>
<p><strong>3. 但，并非全部目的</strong>
如果只说效率，就显得有些冰冷和工具化。人类还有一些更深层的追求，这些追求有时甚至会“牺牲”短期效率：</p>
<ul>
<li><strong>意义与幸福</strong>：我们发展艺术、哲学、宗教，探索宇宙，这些活动不一定直接提升物质生产效率，但它们满足了我们对<strong>意义、美和精神满足</strong>的追求。</li>
<li><strong>公平与正义</strong>：一个纯粹追求效率的社会可能是极度不平等的。我们建立社会福利、推行普惠教育，有时会牺牲一部分经济效率，以换取更大的<strong>社会公平和稳定</strong>。</li>
<li><strong>体验与探索</strong>：纯粹的求知欲和探索欲（例如攀登珠峰、探索深海和太空）驱动着我们去做一些“没有直接效用”的事情。</li>
</ul>
<p><strong>小结</strong>：可以说，<strong>“提升效率”是人类在物质世界生存和发展的底层逻辑和强大引擎</strong>。但在效率之上，我们还有更复杂的精神世界和社会结构追求，这些追求定义了“效率”为之服务的最终目的——或许是全体人类的福祉，或许是个人生命的充盈。</p>
<hr/>
<h3 data-id="heading-1">第二部分：效率提升有无上限？</h3>
<p>这是一个更富科幻色彩的问题。答案是：<strong>在不同的领域，上限是不同的，但理论上存在一些根本性的、物理规律设定的“硬上限”。</strong></p>
<p><strong>1. 物理学的上限</strong></p>
<ul>
<li><strong>光速</strong>：信息、物质和能量传递的终极速度上限。我们永远无法实现超光速通信和旅行，这意味着宇宙尺度的协作效率存在天花板。</li>
<li><strong>热力学第二定律</strong>：能量转换必然有损耗（熵增）。任何机器、计算机的效率都不可能达到100%。永动机是不可能的。</li>
<li><strong>量子极限</strong>：在微观层面，海森堡不确定性原理等量子规律，为计算的精度和能耗设定了理论下限。例如，擦除一个比特的信息都会产生热量。</li>
</ul>
<p><strong>2. 生物学的上限</strong></p>
<ul>
<li><strong>人类身体和大脑</strong>：我们自身的生物结构是一个瓶颈。神经信号的传导速度、大脑的信息处理带宽、身体的脆弱性，都限制了“人机系统”的最终效率。除非我们彻底改造自身（后人类主义），否则这个生物载体本身就有其性能极限。</li>
</ul>
<p><strong>3. 信息处理的上限</strong></p>
<ul>
<li><strong>布雷默曼极限</strong>：由一个质量为M的物体构成的计算机，其每秒处理的信息比特数上限约为 2 × 10^47 比特/秒/千克。这是由量子力学和相对论共同决定的。</li>
<li><strong>兰道尔极限</strong>：在绝对零度以上，每处理一比特信息所需的最小能量。虽然我们现在离这个极限还很远，但它是一个理论上的终点。</li>
</ul>
<p><strong>4. 复杂系统的上限</strong></p>
<ul>
<li><strong>收益递减定律</strong>：在大多数领域，效率提升到一定程度后，再提升一点点所需的成本（资金、时间、复杂度）会急剧增加。例如，将CPU速度从4GHz提升到5GHz的难度和发热量，远大于从2GHz提升到3GHz。</li>
<li><strong>协调成本</strong>：系统越复杂、越高效，其内部子系统之间的协调成本就越高。当一个系统庞大到一定程度时，其内耗可能会抵消掉效率提升带来的收益。这就像管理一个巨型公司，沟通和决策的成本会变得极其高昂。</li>
</ul>
<hr/>
<h3 data-id="heading-2">第三部分：到达上限后，会怎样？</h3>
<p>如果（在某个特定领域）我们真的触及了效率的硬上限，那将意味着一个范式的彻底转变。人类社会和文明可能会进入一个全新的形态：</p>
<p><strong>1. 从“增量优化”转向“模式转变”</strong>
当无法在原有路径上做得更快时，智慧就会转向思考“是否还有完全不同的做法”。</p>
<ul>
<li><strong>例子</strong>：当硅基芯片的物理极限到来时，我们转向研究量子计算、生物计算、神经形态计算。这不是在“优化”旧电脑，而是在创造一种全新的“计算”概念。</li>
</ul>
<p><strong>2. “效率”不再是核心指标，其他价值将凸显</strong>
当物质生产和信息处理的效率达到极致并趋于免费时，经济的基石和人类奋斗的目标会发生改变。</p>
<ul>
<li><strong>注意力经济转向体验经济</strong>：最稀缺的不再是信息或商品，而是<strong>人类的注意力、时间和独一无二的体验</strong>。艺术、创作、人际关系、深度体验的价值会空前提升。</li>
<li><strong>内卷的终结与“神人”的出现</strong>：在纯粹效率的赛道走到头后，竞争可能会转向其他维度，比如创造力、美学、哲学思辨。或者，通过生物科技和AI，一部分“后人类”可能会突破旧有的生物学上限，开启新的进化赛道，从而与未改造的人类产生巨大鸿沟。</li>
</ul>
<p><strong>3. 静态的“乌托邦”或“反乌托邦”？</strong></p>
<ul>
<li><strong>乌托邦愿景</strong>：在一个能源近乎无限、物质极大丰富、所有体力与脑力劳动均由机器代劳的社会里，人类可能从“劳动者”转变为“生活者”，专注于娱乐、艺术、科学探索和精神的自我实现。这类似于马克思所说的共产主义社会。</li>
<li><strong>反乌托邦风险</strong>：如果效率的极致提升伴随着极度的不平等，社会可能分裂为一个拥有超级效率（通过AI和科技）的极小精英阶层，和一个庞大的、无所事事的“无用阶级”。这会带来严重的社会和政治问题。</li>
</ul>
<p><strong>4. 终极问题：意义的回归</strong>
当生存和生产的效率问题被彻底解决后，那个最古老、最根本的问题将再次摆在台前：<strong>“我们存在的意义是什么？”</strong></p>
<p>如果不再需要为了生存而奋斗，人类将为何而活？答案可能在于：</p>
<ul>
<li><strong>对内的探索</strong>：深入挖掘意识、情感和潜能的奥秘。</li>
<li><strong>对外的探索</strong>：即使光速是极限，我们依然可以倾尽文明之力，向星辰大海进发，将生命的火种和意识播撒出去。</li>
<li><strong>创造的永恒</strong>：将文明的全部精力投入到艺术、文化和知识的创造中，试图在宇宙中留下属于“人类”的独特印记。</li>
</ul>
<h3 data-id="heading-3">总结</h3>
<p>人类进化和科技发展的主旋律是<strong>提升生存与发展的效率</strong>，但这并非唯一目的。效率的提升在物理规律和系统复杂性上<strong>存在理论上限</strong>。当我们无限接近或到达某些上限时，文明将发生根本性的范式转变，从追求“如何做得更快”转向思考“我们为何而做”，届时，<strong>人类或许才能真正开始书写属于自己的、超越生存斗争的文明篇章。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（114）Redis的集群模式如何搭建？]]></title>    <link>https://juejin.cn/post/7570405675432837120</link>    <guid>https://juejin.cn/post/7570405675432837120</guid>    <pubDate>2025-11-09T23:07:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570405675432837120" data-draft-id="7570394530315321344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（114）Redis的集群模式如何搭建？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T23:07:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（114）Redis的集群模式如何搭建？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:07:02.000Z" title="Sun Nov 09 2025 23:07:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 集群（Redis Cluster）是一种分布式解决方案，用于在多个 Redis 节点之间自动分配数据。Redis 集群提供了自动分片、数据冗余以及高可用性特性。下面是搭建 Redis 集群的详细步骤以及相关代码示例。</p>
<h3 data-id="heading-0">1. 准备工作</h3>
<p>首先，确保你已经安装了 Redis，并且能够启动 Redis 实例。你可以在本地机器或多台服务器上搭建 Redis 集群环境。</p>
<h3 data-id="heading-1">2. 创建 Redis 配置文件</h3>
<p>假设我们要在一台机器上创建 6 个 Redis 实例（3 个主节点 + 3 个从节点）。</p>
<h4 data-id="heading-2">创建目录结构</h4>
<p>在你的工作目录下创建 6 个子目录，每个子目录表示一个 Redis 实例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p redis-cluster/7000
<span class="hljs-built_in">mkdir</span> -p redis-cluster/7001
<span class="hljs-built_in">mkdir</span> -p redis-cluster/7002
<span class="hljs-built_in">mkdir</span> -p redis-cluster/7003
<span class="hljs-built_in">mkdir</span> -p redis-cluster/7004
<span class="hljs-built_in">mkdir</span> -p redis-cluster/7005
</code></pre>
<h4 data-id="heading-3">创建配置文件</h4>
<p>在每个子目录下创建 Redis 配置文件 <code>redis.conf</code>，每个配置文件内容类似，只需修改端口和节点配置。以下是 <code>redis-cluster/7000/redis.conf</code> 的示例：</p>
<pre><code class="hljs language-conf" lang="conf">port 7000
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes
dir ./
</code></pre>
<p>将上述配置文件复制到其他目录，并根据端口号做相应修改。</p>
<h3 data-id="heading-4">3. 启动 Redis 实例</h3>
<p>使用以下命令启动每个 Redis 实例:</p>
<pre><code class="hljs language-bash" lang="bash">redis-server redis-cluster/7000/redis.conf
redis-server redis-cluster/7001/redis.conf
redis-server redis-cluster/7002/redis.conf
redis-server redis-cluster/7003/redis.conf
redis-server redis-cluster/7004/redis.conf
redis-server redis-cluster/7005/redis.conf
</code></pre>
<h3 data-id="heading-5">4. 创建 Redis 集群</h3>
<p>使用 <code>redis-cli</code> 工具来创建集群。首先进入 <code>redis-cli</code>，然后执行集群创建命令：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 --cluster-replicas 1
</code></pre>
<p><code>--cluster-replicas 1</code> 表示每个主节点有一个从节点。</p>
<h3 data-id="heading-6">5. 验证集群</h3>
<h4 data-id="heading-7">检查集群状态</h4>
<p>使用以下命令检查集群状态：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -c -p 7000 cluster info
</code></pre>
<h4 data-id="heading-8">查看集群节点</h4>
<pre><code class="hljs language-bash" lang="bash">redis-cli -c -p 7000 cluster nodes
</code></pre>
<h3 data-id="heading-9">6. Java 示例代码</h3>
<p>使用 Jedis 库在 Java 中连接 Redis 集群。</p>
<h4 data-id="heading-10">添加 Jedis 依赖</h4>
<p>在你的 <code>pom.xml</code> 文件中添加 Jedis 依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">连接 Redis 集群并进行操作</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.HostAndPort;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisCluster;

<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisClusterExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Set&lt;HostAndPort&gt; jedisClusterNodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        jedisClusterNodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7000</span>));
        jedisClusterNodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7001</span>));
        jedisClusterNodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7002</span>));
        jedisClusterNodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7003</span>));
        jedisClusterNodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7004</span>));
        jedisClusterNodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7005</span>));

        <span class="hljs-keyword">try</span> (<span class="hljs-type">JedisCluster</span> <span class="hljs-variable">jedisCluster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(jedisClusterNodes)) {
            <span class="hljs-comment">// 写入数据</span>
            jedisCluster.set(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>);
            jedisCluster.set(<span class="hljs-string">"key2"</span>, <span class="hljs-string">"value2"</span>);

            <span class="hljs-comment">// 读取数据</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">value1</span> <span class="hljs-operator">=</span> jedisCluster.get(<span class="hljs-string">"key1"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> jedisCluster.get(<span class="hljs-string">"key2"</span>);

            System.out.println(<span class="hljs-string">"key1: "</span> + value1);
            System.out.println(<span class="hljs-string">"key2: "</span> + value2);
        }
    }
}
</code></pre>
<h3 data-id="heading-12">7. 高级配置和优化</h3>
<h4 data-id="heading-13">配置 Redis 集群的通信</h4>
<p>在生产环境中，建议配置 Redis 集群的通信方式以提高安全性和性能。可以在 <code>redis.conf</code> 文件中添加以下参数：</p>
<pre><code class="hljs language-conf" lang="conf"># 绑定 IP 地址
bind 0.0.0.0

# 设置密码
requirepass your_password
masterauth your_password

# 设置最大客户端连接数
maxclients 10000

# 设置内存限制
maxmemory 4gb
</code></pre>
<h4 data-id="heading-14">配置持久化</h4>
<p>为了确保数据的持久性，可以配置 RDB 和 AOF：</p>
<pre><code class="hljs language-conf" lang="conf"># 启用 RDB 持久化
save 900 1
save 300 10
save 60 10000

# 启用 AOF 持久化
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
</code></pre>
<h3 data-id="heading-15">8. Redis Cluster 的故障转移和高可用性</h3>
<p>Redis 集群通过分片和复制提供了高可用性。当一个主节点发生故障时，相应的从节点会自动提升为主节点，确保集群的可用性。</p>
<h4 data-id="heading-16">检查故障转移</h4>
<p>可以通过以下命令检查集群的故障转移情况：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -c -p 7000 cluster failover
</code></pre>
<h4 data-id="heading-17">模拟节点故障</h4>
<p>通过关闭一个主节点来模拟节点故障：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -p 7000 shutdown
</code></pre>
<p>然后检查新的主节点：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli -p 7001 cluster nodes
</code></pre>
<h3 data-id="heading-18">9. Redis 集群的扩展</h3>
<h4 data-id="heading-19">扩展集群</h4>
<p>可以使用 <code>redis-cli</code> 工具扩展集群，添加新的节点并重新分配槽：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000
redis-cli --cluster reshard 127.0.0.1:7000
</code></pre>
<p><code>add-node</code> 用于添加新的节点，<code>reshard</code> 用于重新分配槽。</p>
<h3 data-id="heading-20">总结</h3>
<p>Redis 集群模式通过分片和复制提供了高可用性和可扩展性。在实际生产环境中，合理配置和管理 Redis 集群，可以实现高性能的分布式缓存系统。通过上述步骤和代码示例，可以轻松搭建和使用 Redis 集群。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（115）Redis的性能优化有哪些方法？]]></title>    <link>https://juejin.cn/post/7570306250027335732</link>    <guid>https://juejin.cn/post/7570306250027335732</guid>    <pubDate>2025-11-09T23:07:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570306250027335732" data-draft-id="7570306250027319348" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（115）Redis的性能优化有哪些方法？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T23:07:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（115）Redis的性能优化有哪些方法？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:07:55.000Z" title="Sun Nov 09 2025 23:07:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 是一个高性能的内存数据库，但在实际应用中，合理的配置和优化可以进一步提升其性能。以下是一些常见的 Redis 性能优化方法，并结合具体配置和代码示例进行详细讲解。</p>
<h3 data-id="heading-0">1. 配置优化</h3>
<h4 data-id="heading-1">增加最大客户端连接数</h4>
<p>默认情况下，Redis 的最大客户端连接数为 10000。可以在 <code>redis.conf</code> 文件中增加该值：</p>
<pre><code class="hljs language-conf" lang="conf">maxclients 20000
</code></pre>
<h4 data-id="heading-2">优化内存使用</h4>
<p>Redis 默认使用内存分配器 jemalloc，这通常是最优选择，但也可以选择其他内存分配器如 tcmalloc。确保内存分配器的配置正确：</p>
<pre><code class="hljs language-conf" lang="conf">malloc-lib /usr/lib/libjemalloc.so
</code></pre>
<h4 data-id="heading-3">设置合理的最大内存使用限制</h4>
<p>限制 Redis 使用的最大内存，防止 Redis 因为内存不足而崩溃：</p>
<pre><code class="hljs language-conf" lang="conf">maxmemory 4gb
maxmemory-policy volatile-lru
</code></pre>
<p><code>volatile-lru</code> 策略表示当内存达到上限时，移除最近最少使用的键（仅限于设定了过期时间的键）。</p>
<h3 data-id="heading-4">2. 持久化优化</h3>
<h4 data-id="heading-5">优化 RDB 持久化</h4>
<p>如果你的应用对数据持久性要求不高，可以调整 RDB 持久化频率，以减少对性能的影响：</p>
<pre><code class="hljs language-conf" lang="conf">save 900 1
save 300 10
save 60 10000
</code></pre>
<h4 data-id="heading-6">优化 AOF 持久化</h4>
<p>对于 AOF 持久化，可以选择不同的同步频率：</p>
<pre><code class="hljs language-conf" lang="conf">appendonly yes
appendfsync everysec
</code></pre>
<p><code>everysec</code> 表示每秒同步一次，这是性能和数据安全的平衡点。</p>
<h3 data-id="heading-7">3. 网络优化</h3>
<h4 data-id="heading-8">减少网络延迟</h4>
<p>可以通过开启 TCP keepalive 来减少因网络不稳定导致的连接问题：</p>
<pre><code class="hljs language-conf" lang="conf">tcp-keepalive 60
</code></pre>
<h4 data-id="heading-9">使用二进制协议</h4>
<p>对于大多数 Redis 客户端，默认使用文本协议，可以改为使用更高效的二进制协议。</p>
<h3 data-id="heading-10">4. 数据结构优化</h3>
<h4 data-id="heading-11">使用适当的数据结构</h4>
<p>选择合适的数据结构可以显著提高性能。例如：</p>
<ul>
<li>对于计数器使用 <code>INCR</code> 或 <code>DECR</code>。</li>
<li>对于经常变动的小集合使用 <code>HASH</code>。</li>
<li>对于有序集合使用 <code>ZSET</code>。</li>
</ul>
<h3 data-id="heading-12">5. 分片与集群</h3>
<h4 data-id="heading-13">使用 Redis 集群</h4>
<p>通过 Redis 集群实现数据分片和负载均衡，可以显著提高大规模数据和高并发场景下的性能。</p>
<h3 data-id="heading-14">6. 缓存策略</h3>
<h4 data-id="heading-15">设置合理的缓存过期时间</h4>
<p>合理设置键的过期时间，可以有效回收内存并提高缓存命中率：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Jedis 示例</span>
jedis.setex(<span class="hljs-string">"key"</span>, <span class="hljs-number">3600</span>, <span class="hljs-string">"value"</span>); <span class="hljs-comment">// 设置键 "key" 1小时后过期</span>
</code></pre>
<h3 data-id="heading-16">7. Lua 脚本优化</h3>
<p>使用 Lua 脚本将多个操作封装为一个原子操作，减少网络往返：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Jedis 示例</span>
<span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"return redis.call('set', KEYS[1], ARGV[1])"</span>;
jedis.eval(script, <span class="hljs-number">1</span>, <span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
</code></pre>
<h3 data-id="heading-17">8. 性能监控与调整</h3>
<h4 data-id="heading-18">使用 Redis 自带的监控命令</h4>
<p>定期使用以下命令来监控 Redis 性能：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看 Redis 服务器信息和统计</span>
redis-cli info

<span class="hljs-comment"># 查看实时操作</span>
redis-cli monitor
</code></pre>
<h4 data-id="heading-19">使用外部监控工具</h4>
<p>可以使用 Redis 专用的监控工具，如 RedisInsight, Prometheus + Grafana 等，实时监控 Redis 性能并及时调整。</p>
<h3 data-id="heading-20">9. 优化客户端代码</h3>
<h4 data-id="heading-21">使用连接池</h4>
<p>避免频繁创建和销毁连接，使用连接池保持长连接：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;

<span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">poolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
poolConfig.setMaxTotal(<span class="hljs-number">50</span>);
<span class="hljs-type">JedisPool</span> <span class="hljs-variable">jedisPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(poolConfig, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);

<span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource()) {
    jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
}
</code></pre>
<h4 data-id="heading-22">批量操作</h4>
<p>尽量使用批量操作减少网络往返：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Pipeline;

<span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource()) {
    <span class="hljs-type">Pipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> jedis.pipelined();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        pipeline.set(<span class="hljs-string">"key"</span> + i, <span class="hljs-string">"value"</span> + i);
    }
    pipeline.sync();
}
</code></pre>
<h3 data-id="heading-23">10. 使用 Redis 6.x 新特性</h3>
<p>Redis 6.x 引入了一些新的特性和优化，可以进一步提升性能：</p>
<ul>
<li>
<p><strong>多线程 IO</strong>：可以在 <code>redis.conf</code> 中启用多线程 IO 以提升性能：</p>
<pre><code class="hljs language-conf" lang="conf">io-threads-do-reads yes
io-threads 4
</code></pre>
</li>
<li>
<p><strong>ACL（访问控制列表）</strong>：Redis 6.x 引入了更细粒度的访问控制，可以基于用户和命令进行权限控制：</p>
<pre><code class="hljs language-conf" lang="conf">user default on &gt;password ~* +@all
</code></pre>
</li>
</ul>
<h3 data-id="heading-24">11. 延迟优化</h3>
<h4 data-id="heading-25">客户端与服务器的网络延迟</h4>
<p>确保客户端和 Redis 服务器之间的网络延迟尽可能低，比如部署在同一数据中心或者使用低延迟网络。</p>
<h4 data-id="heading-26">使用本地缓存</h4>
<p>在客户端侧实现本地缓存（如 Guava Cache 或 Caffeine），减少对 Redis 的频繁访问：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.github.benmanes.caffeine.cache.Cache;
<span class="hljs-keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;

Cache&lt;String, String&gt; cache = Caffeine.newBuilder()
    .maximumSize(<span class="hljs-number">1000</span>)
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
    .build();

<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValue</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-keyword">return</span> cache.get(key, k -&gt; jedis.get(k));
}
</code></pre>
<h3 data-id="heading-27">12. 读写分离</h3>
<p>在高并发场景下，可以通过主从复制实现读写分离，主节点负责写，从节点负责读，提高性能：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisShardInfo;

<span class="hljs-type">JedisShardInfo</span> <span class="hljs-variable">master</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisShardInfo</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
<span class="hljs-type">JedisShardInfo</span> <span class="hljs-variable">slave</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisShardInfo</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>);

<span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedisMaster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(master);
     <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedisSlave</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(slave)) {
    <span class="hljs-comment">// 写操作</span>
    jedisMaster.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);

    <span class="hljs-comment">// 读操作</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedisSlave.get(<span class="hljs-string">"key"</span>);
    System.out.println(value);
}
</code></pre>
<h3 data-id="heading-28">总结</h3>
<p>Redis 的性能优化涉及到多个方面，包括配置优化、内存管理、持久化、网络优化、数据结构选择、分片与集群、缓存策略、Lua 脚本、监控与调整、客户端优化以及使用特定的 Redis 新特性。通过合理的配置和优化措施，可以显著提升 Redis 的性能，满足不同业务场景下的需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🏮一眼就会🗂️大文件分片上传，白送前后端全套功法]]></title>    <link>https://juejin.cn/post/7570268773333205019</link>    <guid>https://juejin.cn/post/7570268773333205019</guid>    <pubDate>2025-11-09T23:09:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570268773333205019" data-draft-id="7568706594881683466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🏮一眼就会🗂️大文件分片上传，白送前后端全套功法"/> <meta itemprop="keywords" content="Node.js,JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2025-11-09T23:09:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="vilan_微澜"/> <meta itemprop="url" content="https://juejin.cn/user/2225067267199320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🏮一眼就会🗂️大文件分片上传，白送前后端全套功法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067267199320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    vilan_微澜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:09:25.000Z" title="Sun Nov 09 2025 23:09:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"🦄";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"🐳";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"🐄";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"🦥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"🦩";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"🐧";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"❝"}.markdown-body blockquote:after{right:10px;bottom:0;content:"❞"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"· "}.markdown-body strong:after{content:" ·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>快看！前方好像有什么人在争吵。</p>
<p>我这个文件上传了这么多，怎么又要重新开始上传啊？</p>
<p>我这个网页怎么又卡住了。</p>
<p>切图仔快来看看！</p>
<p><strong>啊啊啊！</strong> 前方突然传来一声尖叫，只见一个年轻人“颤颤巍巍”地从工位上站起，指着他后方的同事，随后大喊一声：“你不要再叫我切图仔啦！”</p>
<p>话音刚落，只见后方同事表现出一副嗤之以鼻的样子，随后带着一丝轻蔑，对着那个年轻人又撂下一句：“切图仔！”。</p>
<p>随即，那个年轻人全身都在颤抖，仿佛就要......</p>
<h2 data-id="heading-0">引言</h2>
<p>开始学习。</p>
<p>下文将带你打通从前端文件分片、文件哈希计算、<code>Web Worker</code>用法、文件断点续传和秒传，到后端分片接收、文件合并的完整技术链条。</p>
<p><strong>后端</strong>基于 <strong>Node.js + Express</strong> 框架，使用 <strong>formidable</strong> 库高效处理分片数据，最终将分片合并为完整文件。</p>
<p><strong>前端</strong>采用 <strong>Vue 3 + TS + Vite</strong> 构建，使用 <strong>Naive UI</strong> 写个好看点的上传进度监控界面，并利用 <strong>Web Worker</strong> 线程计算文件哈希。</p>
<p><strong>关键词：</strong> 文件分片、文件秒传、断点续传、上传进度、文件hash、Web Worker、Node.js</p>
<h2 data-id="heading-1">实现原理图解</h2>
<p>下面<strong>两张图</strong>展示了从<strong>前端</strong>上传文件分片到<strong>后端</strong>解析分片数据并写入文件、合并分片文件的<strong>全套功法</strong>。</p>
<h3 data-id="heading-2">前端实现图解</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7398d3f7c7e43349c2106ff954bb2ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763334565&amp;x-signature=zHkGQun4d29ifSBascCKQhVIrc8%3D" alt="前端.png" loading="lazy"/></p>
<h3 data-id="heading-3">后端实现图解</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39b1ad33662f4a1597ac084d99f70a6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763334565&amp;x-signature=GVLVNjy8PGNOWvdv6Ks6m8P3niE%3D" alt="无标题-2025-11-08-2359.png" loading="lazy"/></p>
<p>看完图解大概理解实现流程就可以上手写代码了</p>
<h2 data-id="heading-4">前端实现代码</h2>
<p>首先我们的目的是封装一个提供大文件上传功能的函数，由于函数中又涉及到页面的一些<strong>响应式状态</strong>，比如上传进度，那么我们姑且就叫它为<code>hook</code>函数吧，然后把它命名为<code>useBigFileUpload.ts</code></p>
<p>下面先把需要用到的<strong>属性和类型</strong>先写上，其他方法后面再逐步完善。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> axios, { <span class="hljs-keyword">type</span> <span class="hljs-title class_">AxiosProgressEvent</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">AxiosResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> { createDiscreteApi } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { computed, markRaw, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">"http://localhost:3000"</span>;

<span class="hljs-comment">// axios实例化</span>
<span class="hljs-keyword">const</span> http = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: baseUrl,
});

<span class="hljs-keyword">const</span> { message } = <span class="hljs-title function_">createDiscreteApi</span>([<span class="hljs-string">"message"</span>]);

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = {
  <span class="hljs-attr">chunkSize</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ChunkRequestQueue</span> = {
  <span class="hljs-attr">promise</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">AxiosResponse</span>&gt;;
  <span class="hljs-attr">abortController</span>: <span class="hljs-title class_">AbortController</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Chunk</span> = {
  <span class="hljs-comment">// 切片数据</span>
  <span class="hljs-attr">chunk</span>: <span class="hljs-title class_">Blob</span>;
  <span class="hljs-comment">// 当前切片索引</span>
  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// 切片文件名</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// 总大小</span>
  <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// 已上传大小</span>
  <span class="hljs-attr">uploaded</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// 请求总进度</span>
  <span class="hljs-attr">requestSize</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">// 是否完成上传</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-comment">// 上传进度</span>
  <span class="hljs-attr">progress</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useBigFileUpload</span> = (<span class="hljs-params">
  props: Props = {
    chunkSize: <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1</span>,
  }
</span>) =&gt; {

  <span class="hljs-comment">// 当前计算hash进度</span>
  <span class="hljs-keyword">const</span> hashProgress = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// 是否暂停了上传</span>
  <span class="hljs-keyword">const</span> isPuase = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// 当前上传的文件</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">fileTarget</span>: <span class="hljs-title class_">File</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// 文件哈希值+文件后缀名</span>
  <span class="hljs-keyword">let</span> fileHash = <span class="hljs-string">""</span>;

  <span class="hljs-comment">// 当前上传切片数组</span>
  <span class="hljs-keyword">const</span> chunks = ref&lt;<span class="hljs-title class_">Chunk</span>[]&gt;([]);

  <span class="hljs-comment">// 当前上传请求队列</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">chunkReqQueueList</span>: <span class="hljs-title class_">ChunkRequestQueue</span>[] = [];

  <span class="hljs-comment">// 当前上传完成的切片/总切片数</span>
  <span class="hljs-keyword">const</span> percentage = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> chunkSize = chunks.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (chunkSize === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">const</span> conpletedChunks = chunks.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> chunk.<span class="hljs-property">completed</span>);
    <span class="hljs-keyword">return</span> (conpletedChunks.<span class="hljs-property">length</span> / chunkSize) * <span class="hljs-number">100</span>;
  });

  <span class="hljs-keyword">return</span> {
    percentage,
    chunks,
    isPuase,
    hashProgress,
  };
};

</code></pre>
<h3 data-id="heading-5">文件切片</h3>
<p>创建<code>createChunks</code>方法，对大文件进行切片</p>
<pre><code class="hljs language-ts" lang="ts"> <span class="hljs-comment">// 创建切片，切片大小可根据自身需求调整</span>
  <span class="hljs-keyword">const</span> createChunks = (
    <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>,
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-built_in">number</span> = props.<span class="hljs-property">chunkSize</span>
  ): <span class="hljs-title class_">Blob</span>[] =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">chunks</span>: <span class="hljs-title class_">Blob</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; file.<span class="hljs-property">size</span>; i += chunkSize, j++) {
      chunks.<span class="hljs-title function_">push</span>(file.<span class="hljs-title function_">slice</span>(i, i + chunkSize));
    }
    <span class="hljs-keyword">return</span> chunks;
  };
</code></pre>
<p>通过分片计算文件<code>hash</code>值，其中有两种计算类型：</p>
<p>1.<strong>抽样分片计算</strong>。通过抽取文件的一部分分片进行一部分文件内容的hash值计算，这种方法可以节省计算耗时。</p>
<p>2.<strong>全量分片计算</strong>。通过所有分片计算完整的文件内容hash值，这个方法计算的值会比较准确，但是计算耗时相对多一些。</p>
<p>下面我们<strong>采用</strong>的是<strong>第二种</strong>方法进行计算。</p>
<h3 data-id="heading-6">文件hash计算</h3>
<p>在你的项目的utils工具包中创建<code>file-hash.work.js</code>文件，计算文件内容hash值的<code>Web Worker</code>方法</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 在 utils/workers/file-hash.work.js 中</span>
<span class="hljs-comment">// 引入 SparkMD5 计算文件内容hash</span>
<span class="hljs-comment">// importScripts('/spark-md5@3.0.2/spark-md5.min.js');</span>
importScripts(<span class="hljs-string">'https://cdn.jsdelivr.net/npm/spark-md5@3.0.2/spark-md5.min.js'</span>);

self.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// 从主线程接收分片数据</span>
  <span class="hljs-keyword">const</span> { chunks } = e.<span class="hljs-property">data</span>;
  <span class="hljs-comment">// 创建 SparkMD5 实例</span>
  <span class="hljs-keyword">const</span> spark = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparkMD5</span>.<span class="hljs-title class_">ArrayBuffer</span>();

  <span class="hljs-comment">// 读取切片</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readChunk</span>(<span class="hljs-params">index</span>) {
    <span class="hljs-keyword">if</span> (index &gt;= chunks.<span class="hljs-property">length</span>) {
      <span class="hljs-comment">// 所有分片处理完毕，计算最终哈希</span>
      <span class="hljs-keyword">const</span> hash = spark.<span class="hljs-title function_">end</span>();
      <span class="hljs-comment">// 向主线程发送最终计算的哈希值</span>
      self.<span class="hljs-title function_">postMessage</span>({ index, hash });
      <span class="hljs-comment">// 所有分片处理完毕，关闭worker</span>
      self.<span class="hljs-title function_">close</span>();
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 创建 FileReader 实例, 用于读取分片数据</span>
    <span class="hljs-keyword">const</span> fileReader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
    <span class="hljs-comment">// 读取分片数据</span>
    fileReader.<span class="hljs-title function_">readAsArrayBuffer</span>(chunks[index]);
    <span class="hljs-comment">// 分片数据加载完成事件监听</span>
    fileReader.<span class="hljs-property">onload</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-comment">// 追加到 SparkMD5 实例</span>
      spark.<span class="hljs-title function_">append</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>);
      <span class="hljs-comment">// 向主线程发送计算进度索引</span>
      self.<span class="hljs-title function_">postMessage</span>({ index });
      <span class="hljs-comment">// 读取下一个分片</span>
      <span class="hljs-title function_">readChunk</span>(index + <span class="hljs-number">1</span>);
    };
  }
  <span class="hljs-comment">// 从索引0开始读取分片</span>
  <span class="hljs-title function_">readChunk</span>(<span class="hljs-number">0</span>);
};
</code></pre>
<p>在<code>utils</code>文件夹下写好<code>worker</code>工具函数后，继续在<code>useBigFileUpload</code>函数当中添加<code>getHashWorker</code>方法异步获取文件<code>hash</code>值。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 计算文件哈希值
 * <span class="hljs-doctag">@param</span> tempChunks 切片数组
 * <span class="hljs-doctag">@returns</span> 文件哈希值
 */</span>
<span class="hljs-keyword">const</span> getHashWorker = <span class="hljs-keyword">async</span> (<span class="hljs-attr">tempChunks</span>: <span class="hljs-title class_">Blob</span>[]): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; =&gt; {
  hashProgress.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-comment">// 导入worker线程，计算文件哈希值</span>
    <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(
      <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">"../utils/workers/file-hash.work.js"</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
    );
    <span class="hljs-comment">// 向worker线程发送消息，计算文件哈希值</span>
    worker.<span class="hljs-title function_">postMessage</span>({
      <span class="hljs-attr">chunks</span>: tempChunks,
    });
    <span class="hljs-comment">// 监听worker线程消息，获取计算文件哈希值结果</span>
    worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { index, hash } = e.<span class="hljs-property">data</span>;
      <span class="hljs-comment">// 计算当前计算hash进度</span>
      <span class="hljs-keyword">if</span> (tempChunks.<span class="hljs-property">length</span>) {
        hashProgress.<span class="hljs-property">value</span> = (index / tempChunks.<span class="hljs-property">length</span>) * <span class="hljs-number">100</span>;
      }
      <span class="hljs-keyword">if</span> (hash) {
        <span class="hljs-comment">// 完成计算哈希值</span>
        <span class="hljs-title function_">resolve</span>(hash);
      }
    };
  });
};
</code></pre>
<p>拿到hash值后就可以通过该值查询服务器是否存在该文件，来实现大文件秒传</p>
<h3 data-id="heading-7">文件秒传</h3>
<p>通过<code>hash</code>查询服务器是否<strong>存在该文件</strong>，前端根据返回结果判断是否需要进行文件上传，已存在则直接显示上传完成，否则接着下面进行分片上传。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 检查文件是否已经上传
 * <span class="hljs-doctag">@param</span> fileHash 文件哈希值
 * <span class="hljs-doctag">@returns</span> 检查结果
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkFileApi</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">fileHash: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 通过文件hash检查是否已经上传了该文件</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> http.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/check/file?fileHash=<span class="hljs-subst">${fileHash}</span>`</span>);
  <span class="hljs-comment">// 返回检查结果</span>
  <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>.<span class="hljs-property">hasExist</span>
}
</code></pre>
<h3 data-id="heading-8">文件断点续传</h3>
<p>主要是通过检查服务器是否已经<strong>存在该分片</strong>，并返回查询结果，前端根据查询结果判断是否需要调用分片上传请求方法。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 检查切片是否已经上传
 * <span class="hljs-doctag">@param</span> chunkName 切片名
 * <span class="hljs-doctag">@returns</span> 检查结果
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkChunkApi</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">chunkName: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// 创建中断请求器</span>
  <span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

  <span class="hljs-comment">// 发生请求前先验证切片是否已经上传</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">AxiosResponse</span>&lt;{
    <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">hasExist</span>: <span class="hljs-built_in">boolean</span>;
  }&gt; = <span class="hljs-keyword">await</span> http.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/chunk/check?chunkName=<span class="hljs-subst">${chunkName}</span>`</span>, {
    <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>,
  });

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">res</span>: res,
    abortController,
  }
};
</code></pre>
<h3 data-id="heading-9">分片上传请求</h3>
<p>创建开始分片上传请求方法<code>uploadChunkApi</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 上传切片
 * <span class="hljs-doctag">@param</span> data 切片数据
 * <span class="hljs-doctag">@returns</span> ChunkRequestQueue 上传请求对象
 */</span>
<span class="hljs-keyword">const</span> uploadChunkApi = (<span class="hljs-attr">data</span>: <span class="hljs-title class_">Chunk</span>): <span class="hljs-function"><span class="hljs-params">ChunkRequestQueue</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> { name, index, chunk } = data;
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"chunk"</span>, chunk);

  <span class="hljs-comment">// 创建中断请求器</span>
  <span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

  <span class="hljs-keyword">const</span> promise = http.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/chunk?chunkName=<span class="hljs-subst">${name}</span>`</span>, formData, {
    <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>,
    <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progressEvent: AxiosProgressEvent</span>) =&gt;</span> {
      <span class="hljs-comment">// 计算上传进度</span>
      <span class="hljs-keyword">if</span> (
        chunks.<span class="hljs-property">value</span>[index] &amp;&amp;
        progressEvent.<span class="hljs-property">total</span> &amp;&amp;
        progressEvent.<span class="hljs-property">progress</span>
      ) {
        <span class="hljs-comment">// 记录当前上传切片请求进度。</span>
        <span class="hljs-comment">// 注意，由于网络请求具有额外开销，上传进度可能会和切片大小不一样</span>
        chunks.<span class="hljs-property">value</span>[index].<span class="hljs-property">uploaded</span> = progressEvent.<span class="hljs-property">loaded</span>;
        <span class="hljs-comment">// 记录当前上传切片请求总大小</span>
        <span class="hljs-comment">// 注意，由于网络请求具有额外开销，上传进度可能会和切片大小不一样</span>
        chunks.<span class="hljs-property">value</span>[index].<span class="hljs-property">requestSize</span> = progressEvent.<span class="hljs-property">total</span>;
        <span class="hljs-comment">// 计算上传进度</span>
        chunks.<span class="hljs-property">value</span>[index].<span class="hljs-property">progress</span> = progressEvent.<span class="hljs-property">progress</span>;
      }
    },
  });

  <span class="hljs-keyword">return</span> {
    promise,
    abortController,
  };
};
</code></pre>
<p>在发送分片上传<code>http</code>请求的方法中，监听了<code>axios</code>的<code>onUploadProgress</code>回调方法，在该方法里面可以拿到请求的完成进度，其中记录了<code>AxiosProgressEvent</code>的3个属性：<code>uploaded</code>、<code>total</code>、<code>progress</code>。主要是<code>progress</code>页面显示上传进度需要，其他如果页面不需要显示，可有可无吧。</p>
<p>最后把当前请求的<code>promise</code>对象和中断请求的<code>abortController</code>对象返回，放入请求队列当中。</p>
<p>当需要暂停上传时，可以使用<code>abortController</code>进行中断请求。</p>
<h3 data-id="heading-10">分片合并请求</h3>
<p>创建合并切片请求方法<code>mergeChunksApi</code>，当请求队列中的分片都成功上传后，调用该方法并携带<code>fileHash</code>文件标识，用于服务器找到该文件分片所在位置，合并成功后，文件即上传完成。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 合并切片
 * <span class="hljs-doctag">@param</span> fileHash 文件哈希值
 * <span class="hljs-doctag">@returns</span> 合并结果
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">mergeChunksApi</span> = (<span class="hljs-params">fileHash: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> http.<span class="hljs-title function_">post</span>(<span class="hljs-string">`/merge-chunk`</span>, {
    fileHash,
  });
};
</code></pre>
<h3 data-id="heading-11">开始上传文件</h3>
<p>上面的准备工作就绪后，就可以创建上传文件方法了。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 开始上传
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">file</span>
 * <span class="hljs-doctag">@param</span> resume 是否恢复上传
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startUpload</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">file: File, resume: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!file) {
    message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"请先选择文件!"</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 恢复上传不用重新创建切片，延续之前的切片进度</span>
  <span class="hljs-keyword">if</span> (!resume) {
    <span class="hljs-comment">// 保存文件，用于后续恢复上传</span>
    fileTarget = file;
    <span class="hljs-comment">// 重置暂停状态，避免重复上传时暂停状态为true导致问题</span>
    isPuase.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// 创建切片</span>
    <span class="hljs-keyword">const</span> tempChunks = <span class="hljs-title function_">createChunks</span>(file);
    <span class="hljs-comment">// 计算文件哈希值，并拼接文件后缀名</span>
    fileHash =
      (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getHashWorker</span>(tempChunks)) + <span class="hljs-string">"."</span> + file.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>).<span class="hljs-title function_">pop</span>();
    <span class="hljs-comment">// 构建切片对象数组</span>
    chunks.<span class="hljs-property">value</span> = tempChunks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">chunk, i</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">name</span>: <span class="hljs-title function_">buildChunkName</span>(fileHash, i),
        <span class="hljs-attr">chunk</span>: <span class="hljs-title function_">markRaw</span>(chunk),
        <span class="hljs-attr">index</span>: i,
        <span class="hljs-attr">size</span>: props.<span class="hljs-property">chunkSize</span>,
        <span class="hljs-attr">uploaded</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">requestSize</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span>,
        <span class="hljs-keyword">get</span> <span class="hljs-title function_">completed</span>() {
          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> === <span class="hljs-number">1</span>;
        },
      };
    });
  }

  <span class="hljs-comment">// 通过文件hash检查是否已经上传了该文件</span>
  <span class="hljs-keyword">const</span> hasExist = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkFileApi</span>(fileHash);
  <span class="hljs-keyword">if</span> (hasExist) {
    message.<span class="hljs-title function_">warning</span>(<span class="hljs-string">"文件已存在，无需重复上传"</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 如果是暂停后恢复上传时，过滤出未上传完成的切片</span>
  <span class="hljs-keyword">const</span> waitUploadChunks = chunks.<span class="hljs-property">value</span>
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> !chunk.<span class="hljs-property">completed</span>;
    });

  <span class="hljs-comment">// 遍历未完成上传的切片</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; waitUploadChunks.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> chunk = waitUploadChunks[i] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Chunk</span>;
    <span class="hljs-keyword">const</span> name = chunk.<span class="hljs-property">name</span>;

    <span class="hljs-comment">// 创建中断请求器</span>
    <span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

    <span class="hljs-comment">// 发生请求前先验证切片是否已经上传</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">AxiosResponse</span>&lt;{
      <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
      <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-attr">hasExist</span>: <span class="hljs-built_in">boolean</span>;
    }&gt; = <span class="hljs-keyword">await</span> http.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/chunk/check?chunkName=<span class="hljs-subst">${name}</span>`</span>, {
      <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>,
    });

    <span class="hljs-comment">// 暂停了直接退出for循环，且不再执行for循环后面的代码</span>
    <span class="hljs-keyword">if</span> (isPuase.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span>.<span class="hljs-property">hasExist</span>) {
      chunkReqQueueList[i] = {
        <span class="hljs-comment">// 返回校验结果</span>
        <span class="hljs-attr">promise</span>: <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(res),
        <span class="hljs-comment">// 校验切片是否存在中断器</span>
        abortController,
      };
      chunk.<span class="hljs-property">progress</span> = <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 切片不存在，继续上传</span>
      chunkReqQueueList[i] = <span class="hljs-title function_">uploadChunkApi</span>(chunk);
    }
  }

  <span class="hljs-keyword">if</span> (chunkReqQueueList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      chunkReqQueueList.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">promise</span>)
    );

    <span class="hljs-comment">// 合并切片</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">mergeChunksApi</span>(fileHash);
  }
};
</code></pre>
<p><strong>buildChunkName方法</strong></p>
<p>构建和服务器达成约定的分片名称，服务器可通过<code>-</code>分割获取分片所属文件；在合并分片时可根据<code>index</code>索引进行排序合并，保证文件的完整性。</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">/**
   * 构建切片名
   * <span class="hljs-doctag">@param</span> hash 文件哈希值
   * <span class="hljs-doctag">@param</span> index 切片索引
   * <span class="hljs-doctag">@returns</span> 切片名
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">buildChunkName</span> = (<span class="hljs-params">hash: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${hash}</span>-<span class="hljs-subst">${index}</span>`</span>;
  };
</code></pre>
<p>在开始上传的<code>startUpload</code>方法中具有两种情况，分别为<strong>开始上传</strong>和<strong>恢复上传</strong>。</p>
<p>开始上传时，执行完整的步骤；在恢复上传时，可根据开始上传时的状态，过滤出未上传的分片<code>waitUploadChunks</code>数组，再发送分片上传请求，避免不必要的性能损耗。</p>
<h3 data-id="heading-12">暂停上传文件</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 暂停切片上传</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pauseUpload</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!isPuase.<span class="hljs-property">value</span>) {
    isPuase.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
    chunkReqQueueList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (req.<span class="hljs-property">abortController</span>) {
        req.<span class="hljs-property">abortController</span>.<span class="hljs-title function_">abort</span>(<span class="hljs-string">"用户取消上传!"</span>);
      }
    });
    <span class="hljs-comment">// 清空上传队列</span>
    chunkReqQueueList = [];
  } <span class="hljs-keyword">else</span> {
    message.<span class="hljs-title function_">warning</span>(<span class="hljs-string">"文件已暂停上传！"</span>);
  }
};
</code></pre>
<h3 data-id="heading-13">恢复上传文件</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 恢复切片上传</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">resumeUpload</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (fileTarget &amp;&amp; isPuase.<span class="hljs-property">value</span>) {
    isPuase.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-title function_">startUpload</span>(fileTarget, <span class="hljs-literal">true</span>);
  } <span class="hljs-keyword">else</span> {
    message.<span class="hljs-title function_">warning</span>(<span class="hljs-string">"文件正在上传中！"</span>);
  }
};
</code></pre>
<h3 data-id="heading-14">ui页面构建(用法)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bafc8e9c01864aed9f677bd5f85b4cdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763334565&amp;x-signature=xNvdsKCB7dwNgCifvCaPx3yzzz0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-15">BigFileUpload.vue</h4>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"upload-file"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-upload</span> @<span class="hljs-attr">before-upload</span>=<span class="hljs-string">"onUpload"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span>&gt;</span>上传文件<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">n-upload</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>文件内容hash计算进度：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-progress</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"line"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"green"</span> <span class="hljs-attr">:percentage</span>=<span class="hljs-string">"hashProgress"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"percentage section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>上传进度：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-progress</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"line"</span> <span class="hljs-attr">:percentage</span>=<span class="hljs-string">"progress"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>操作：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"default"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onPause"</span>&gt;</span>暂停<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onResume"</span>&gt;</span>继续<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-tag</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"error"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isPuase"</span>&gt;</span>已暂停<span class="hljs-tag">&lt;/<span class="hljs-name">n-tag</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chunk-list"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>分片上传列表<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ChunkDetail</span>
        <span class="hljs-attr">:list</span>=<span class="hljs-string">"chunks"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ChunkDetail</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NUpload</span>, <span class="hljs-title class_">NButton</span>, useMessage, <span class="hljs-title class_">NProgress</span>, <span class="hljs-title class_">NTag</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">UploadFileInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { useBigFileUpload } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/hooks/useBigFileUpload"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChunkDetail</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./ChunkDetail.vue"</span>;
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">const</span> {
  percentage,
  startUpload,
  pauseUpload,
  resumeUpload,
  chunks,
  isPuase,
  hashProgress
} = <span class="hljs-title function_">useBigFileUpload</span>();
<span class="hljs-keyword">const</span> message = <span class="hljs-title function_">useMessage</span>();

<span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(percentage.<span class="hljs-property">value</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>))
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onUpload</span> = (<span class="hljs-params">data: {
  file: UploadFileInfo;
  fileList: <span class="hljs-built_in">Array</span>&lt;UploadFileInfo&gt;;
  event?: Event;
}</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  <span class="hljs-keyword">const</span> file = data.<span class="hljs-property">file</span>.<span class="hljs-property">file</span>;
  <span class="hljs-keyword">if</span> (!file) {
    message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"请选择文件!"</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-title function_">startUpload</span>(file);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onPause</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">pauseUpload</span>();
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onResume</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">resumeUpload</span>();
};

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.upload-file</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-selector-class">.actions</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.chunk-list</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">600px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}
<span class="hljs-selector-class">.section</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</span></code></pre>
<h4 data-id="heading-16">ChunkDetail.vue</h4>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chunk"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-table</span> <span class="hljs-attr">:bordered</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">:single-line</span>=<span class="hljs-string">"false"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>索引<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>分片大小(byte)<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>请求总大小(byte)<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>已上传(byte)<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>上传进度<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>是否完成<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"data in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"data.index"</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.index }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.size}}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.requestSize }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ data.uploaded }}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{{ (data.progress * 100).toFixed(2) }}%<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-tag</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"data.completed"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span>是<span class="hljs-tag">&lt;/<span class="hljs-name">n-tag</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-tag</span> <span class="hljs-attr">v-else</span>&gt;</span>否<span class="hljs-tag">&lt;/<span class="hljs-name">n-tag</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">n-table</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NTable</span>, <span class="hljs-title class_">NTag</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">Chunk</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/hooks/useBigFileUpload"</span>;

defineProps&lt;{
  <span class="hljs-attr">list</span>: <span class="hljs-title class_">Chunk</span>[];
}&gt;();

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-17">后端实现代码</h2>
<h3 data-id="heading-18">文件上传目录示例</h3>
<blockquote>
<p>temp: 解析分片数据写入的临时目录，写入的分片可能不完整；</p>
<p>chunks: 写入完成的分片文件目录；</p>
<p>upload: 分片合并完成的文件目录；</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bff382a156b4def836c9f59007ecd54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763334565&amp;x-signature=gMqevJCkyN07uoPJYqjSxkEq4pk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-19">查询文件是否存在接口</h3>
<p>在<code>upload</code>文件夹下，通过文件hash查询，是否存在该hash文件名的文件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af95c2a86d204461abc4fbb9ff1c3d42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763334565&amp;x-signature=hBfZQuQnxihsM%2Fy9DbPlMVZDyi8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 查询mergeDir目录下是否存在上传的文件</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/check/file'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> fileHash = req.<span class="hljs-property">query</span>.<span class="hljs-property">fileHash</span>;
  <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(mergeDir, fileHash);
  <span class="hljs-keyword">const</span> hasExistFile = fs.<span class="hljs-title function_">existsSync</span>(filePath);
  <span class="hljs-keyword">if</span> (hasExistFile) {
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'文件已存在'</span>,
      <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">true</span>
    })
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'文件不存在'</span>,
      <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">false</span>
    })
  }
})
</code></pre>
<h3 data-id="heading-20">查询分片是否存在接口</h3>
<p>在<code>chunks</code>目录下的文件<code>hash</code>所属目录下，查询是否存在该<strong>hash索引</strong>的分片。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd26b4674cb8455bb4f8e4dfe6d86ea7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmlsYW5f5b6u5r6c:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763334565&amp;x-signature=3JgMLO8R%2FbxX0e6KsXEfeJ%2Bx7J4%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 验证切片是否已存在接口</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/chunk/check'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {

  <span class="hljs-comment">// 切片文件名称</span>
  <span class="hljs-keyword">const</span> chunkName = req.<span class="hljs-property">query</span>.<span class="hljs-property">chunkName</span>

  <span class="hljs-comment">// 从切片文件名称中提取文件hash</span>
  <span class="hljs-keyword">const</span> fileHash = <span class="hljs-title function_">extractFileHash</span>(chunkName);

  <span class="hljs-comment">// 待合并的分片目录路径</span>
  <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(chunkDir, fileHash, chunkName);

  <span class="hljs-comment">// 检查当前切片文件是否已经存在</span>
  <span class="hljs-keyword">const</span> hasExistFile = fs.<span class="hljs-title function_">existsSync</span>(chunkPath);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hasExistFile'</span>, hasExistFile, chunkPath);
  <span class="hljs-keyword">if</span> (hasExistFile) {
    <span class="hljs-comment">// 直接响应。不再执行后续中间件，如后面的回调upload.single('chunk')、切片上传成功回调</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'切片已存在，跳过该切片上传'</span>,
      <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">return</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 切片不存在</span>
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'切片不存在，继续上传'</span>, <span class="hljs-attr">hasExist</span>: <span class="hljs-literal">false</span> })
  }
  <span class="hljs-keyword">return</span> hasExistFile
})
</code></pre>
<h3 data-id="heading-21">分片上传接口</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 从分片名称提取文件hash</span>
<span class="hljs-comment">// 如：chunkName: 91a509c780df16d509e69d604292e870.mp4-0</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">extractFileHash</span>(<span class="hljs-params">chunkName</span>) {
  <span class="hljs-keyword">return</span> chunkName.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>)[<span class="hljs-number">0</span>];
}

<span class="hljs-comment">// 分片存放路径</span>
<span class="hljs-keyword">const</span> chunkDir = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'chunks'</span>);

<span class="hljs-comment">// 处理分片文件上传。</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/chunk'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {

  <span class="hljs-keyword">const</span> chunkName = req.<span class="hljs-property">query</span>.<span class="hljs-property">chunkName</span>;

  <span class="hljs-keyword">const</span> fileHash = <span class="hljs-title function_">extractFileHash</span>(chunkName);

  <span class="hljs-comment">// 判断当前目录没有temp文件夹，则创建</span>
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-string">'./temp'</span>)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(<span class="hljs-string">'./temp'</span>, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }

  <span class="hljs-comment">// 使用formidable解析表单数据</span>
  <span class="hljs-keyword">const</span> form = <span class="hljs-title function_">formidable</span>({
    <span class="hljs-attr">uploadDir</span>: <span class="hljs-string">'./temp'</span>, <span class="hljs-comment">// 临时存储路径</span>
    <span class="hljs-attr">keepExtensions</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">filename</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> chunkName
    }
  });

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 解析表单数据，并把分片写入临时目录中</span>
    <span class="hljs-keyword">const</span> [fields, files] = <span class="hljs-keyword">await</span> form.<span class="hljs-title function_">parse</span>(req);
    <span class="hljs-keyword">const</span> chunkFile = files.<span class="hljs-property">chunk</span>[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(chunkDir)) {
      fs.<span class="hljs-title function_">mkdirSync</span>(chunkDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
    }
    <span class="hljs-comment">// 将临时文件移动到 chunkDir 目录</span>
    <span class="hljs-keyword">const</span> fileHashDir = path.<span class="hljs-title function_">join</span>(chunkDir, fileHash);
    <span class="hljs-keyword">const</span> targetPath = path.<span class="hljs-title function_">join</span>(fileHashDir, chunkName);
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(fileHashDir)) {
      fs.<span class="hljs-title function_">mkdirSync</span>(fileHashDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
    }
    fs.<span class="hljs-title function_">renameSync</span>(chunkFile.<span class="hljs-property">filepath</span>, targetPath)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">msg</span>: <span class="hljs-string">'分片上传失败'</span>, <span class="hljs-attr">error</span>: error });
  }

  res.<span class="hljs-title function_">send</span>({
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'分片上传成功'</span>,
    <span class="hljs-attr">file</span>: req.<span class="hljs-property">file</span>
  });
});
</code></pre>
<h3 data-id="heading-22">合并分片接口</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 合并切片</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/merge-chunk'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileHash } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">if</span> (!fileHash) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'缺少fileHash参数'</span> });
  }
  <span class="hljs-comment">// 合并后的文件路径，如果不存在则创建该目录</span>
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(mergeDir)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(mergeDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }
  <span class="hljs-keyword">const</span> mergeFilePath = path.<span class="hljs-title function_">join</span>(mergeDir, fileHash);
  <span class="hljs-keyword">const</span> chunkHashDir = path.<span class="hljs-title function_">join</span>(chunkDir, fileHash);

  <span class="hljs-comment">// 读取目录下所有切片文件，按 index 排序</span>
  <span class="hljs-keyword">const</span> chunkFilenames = fs.<span class="hljs-title function_">readdirSync</span>(chunkHashDir)
    <span class="hljs-comment">// 按 index 排序</span>
    .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> indexA = <span class="hljs-built_in">parseInt</span>(a.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>).<span class="hljs-title function_">pop</span>(), <span class="hljs-number">10</span>);
      <span class="hljs-keyword">const</span> indexB = <span class="hljs-built_in">parseInt</span>(b.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>).<span class="hljs-title function_">pop</span>(), <span class="hljs-number">10</span>);
      <span class="hljs-keyword">return</span> indexA - indexB;
    });

  <span class="hljs-comment">// 创建可写流，合并切片</span>
  <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(mergeFilePath);
  <span class="hljs-keyword">let</span> mergedSize = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunkname <span class="hljs-keyword">of</span> chunkFilenames) {
      <span class="hljs-comment">// 创建可读流，读取切片</span>
      <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(chunkHashDir, chunkname);
      <span class="hljs-comment">// 读取切片</span>
      <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(chunkPath);
      <span class="hljs-comment">// 写入合并后的文件</span>
      writeStream.<span class="hljs-title function_">write</span>(data);
      <span class="hljs-comment">// 累加合并后的文件大小</span>
      mergedSize += data.<span class="hljs-property">length</span>;
      <span class="hljs-comment">// 删除已合并的切片</span>
      fs.<span class="hljs-title function_">unlinkSync</span>(chunkPath);
    }
    <span class="hljs-comment">// 删除空目录</span>
    fs.<span class="hljs-title function_">rmdirSync</span>(chunkHashDir);
    <span class="hljs-comment">// 合并完成后关闭流</span>
    writeStream.<span class="hljs-title function_">end</span>();
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'合并失败!'</span>, <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> });
  }

  res.<span class="hljs-title function_">send</span>({
    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'文件合并成功'</span>,
    <span class="hljs-attr">file</span>: {
      fileHash,
      <span class="hljs-attr">size</span>: mergedSize,
      <span class="hljs-attr">path</span>: mergeFilePath,
      chunkFilenames
    }
  });
});
</code></pre>
<h2 data-id="heading-23">总结</h2>
<p>本文使用文件对象的<code>slice</code>方法对大文件进行分片，使用<code>SparkMD5</code>对文件内容进行<code>hash</code>计算，并把计算过程执行在<code>Web Worker</code>线程当中，避免阻塞主线程；</p>
<p>实现<strong>分片上传</strong>的<strong>核心</strong>是使用文件<code>hash</code>和分片<strong>索引</strong>，对分片名称进行<strong>标识</strong>和<strong>排序</strong>，方便后端查找和排序分片，最后合并分片为一个完整的文件。</p>
<h2 data-id="heading-24">前后端完整源码</h2>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjava6688%2Fbig-file-upload" target="_blank" title="https://github.com/java6688/big-file-upload" ref="nofollow noopener noreferrer">大文件上传示例代码</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零到一：这篇JavaScript指南让你成为独立开发者]]></title>    <link>https://juejin.cn/post/7570187256105517062</link>    <guid>https://juejin.cn/post/7570187256105517062</guid>    <pubDate>2025-11-09T23:30:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570187256105517062" data-draft-id="7570162686580015146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零到一：这篇JavaScript指南让你成为独立开发者"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T23:30:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零到一：这篇JavaScript指南让你成为独立开发者
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:30:56.000Z" title="Sun Nov 09 2025 23:30:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是曾经看着满屏的代码感到无从下手？或者跟着教程做项目时总是一头雾水？别担心，今天这篇文章就是为你准备的。学完这篇内容，你就能真正理解JavaScript的精髓，独立开发出属于自己的应用。</p>
<p>我会带你从最基础的概念开始，一步步构建完整的应用思维。不用担心自己是新手，我会用最通俗易懂的方式讲解每个关键点。读完这篇文章，你将获得完整的JavaScript开发能力，能够独立设计和实现前端应用。</p>
<h2 data-id="heading-0">JavaScript的核心概念</h2>
<p>让我们先来理解JavaScript的几个核心概念。很多人学不会编程，就是因为一开始被各种术语吓住了。其实编程就像学做菜，先搞清楚油盐酱醋是干什么的，再学炒菜就简单了。</p>
<p>变量就像厨房里的调料瓶，用来存放各种数据。在JavaScript中，我们常用let和const来声明变量。看这个例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// let用于声明可以改变的变量</span>
<span class="hljs-keyword">let</span> userName = <span class="hljs-string">'小明'</span>;
userName = <span class="hljs-string">'小红'</span>; <span class="hljs-comment">// 这样可以改变</span>

<span class="hljs-comment">// const用于声明不变的常量</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_USERS</span> = <span class="hljs-number">100</span>;
<span class="hljs-comment">// MAX_USERS = 200; 这样会报错，因为常量不能重新赋值</span>
</code></pre>
<p>函数就像是预制的调味料组合，一次调配，多次使用。理解函数是独立开发的第一步：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个简单的函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greetUser</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`你好，<span class="hljs-subst">${name}</span>！欢迎使用我们的应用。`</span>;
}

<span class="hljs-comment">// 使用函数</span>
<span class="hljs-keyword">const</span> greeting = <span class="hljs-title function_">greetUser</span>(<span class="hljs-string">'张三'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeting); <span class="hljs-comment">// 输出：你好，张三！欢迎使用我们的应用。</span>
</code></pre>
<p>对象和数组让我们能够组织更复杂的数据。想象你要开发一个待办事项应用，就需要用这些结构来存储任务数据：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用对象表示一个任务</span>
<span class="hljs-keyword">const</span> task = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">'学习JavaScript'</span>,
    <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">dueDate</span>: <span class="hljs-string">'2024-12-31'</span>
};

<span class="hljs-comment">// 用数组存储多个任务</span>
<span class="hljs-keyword">const</span> taskList = [
    task,
    {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'写项目文档'</span>,
        <span class="hljs-attr">completed</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">dueDate</span>: <span class="hljs-string">'2024-11-15'</span>
    }
];
</code></pre>
<h2 data-id="heading-1">现代JavaScript开发必备技能</h2>
<p>掌握了基础概念，接下来要了解现代JavaScript开发的必备技能。这些是你能独立开发应用的基石。</p>
<p>异步编程是必须掌握的重点。现在的应用都需要与服务器通信，理解Promise和async/await至关重要：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟从服务器获取数据</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserData</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span> (userId === <span class="hljs-number">1</span>) {
                <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">reject</span>(<span class="hljs-string">'用户不存在'</span>);
            }
        }, <span class="hljs-number">1000</span>);
    });
}

<span class="hljs-comment">// 使用async/await处理异步操作</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">displayUserInfo</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'正在加载用户信息...'</span>);
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>(userId);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`用户姓名：<span class="hljs-subst">${user.name}</span>，年龄：<span class="hljs-subst">${user.age}</span>`</span>);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'出错啦：'</span>, error);
    }
}

<span class="hljs-comment">// 调用函数</span>
<span class="hljs-title function_">displayUserInfo</span>(<span class="hljs-number">1</span>);
</code></pre>
<p>DOM操作让JavaScript能够与网页交互。这是前端开发的核心能力：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建新的任务元素并添加到页面</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addTaskToDOM</span>(<span class="hljs-params">task</span>) {
    <span class="hljs-comment">// 创建任务容器</span>
    <span class="hljs-keyword">const</span> taskElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    taskElement.<span class="hljs-property">className</span> = <span class="hljs-string">'task-item'</span>;
    taskElement.<span class="hljs-property">id</span> = <span class="hljs-string">`task-<span class="hljs-subst">${task.id}</span>`</span>;
    
    <span class="hljs-comment">// 设置任务内容</span>
    taskElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;input type="checkbox" <span class="hljs-subst">${task.completed ? <span class="hljs-string">'checked'</span> : <span class="hljs-string">''</span>}</span>&gt;
        &lt;span class="task-title"&gt;<span class="hljs-subst">${task.title}</span>&lt;/span&gt;
        &lt;span class="due-date"&gt;<span class="hljs-subst">${task.dueDate}</span>&lt;/span&gt;
        &lt;button class="delete-btn"&gt;删除&lt;/button&gt;
    `</span>;
    
    <span class="hljs-comment">// 添加到任务列表</span>
    <span class="hljs-keyword">const</span> taskList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'task-list'</span>);
    taskList.<span class="hljs-title function_">appendChild</span>(taskElement);
    
    <span class="hljs-comment">// 添加删除功能</span>
    <span class="hljs-keyword">const</span> deleteBtn = taskElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.delete-btn'</span>);
    deleteBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        taskElement.<span class="hljs-title function_">remove</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`删除了任务：<span class="hljs-subst">${task.title}</span>`</span>);
    });
}
</code></pre>
<h2 data-id="heading-2">构建完整的待办事项应用</h2>
<p>现在让我们把这些知识点串联起来，构建一个完整的待办事项应用。这个例子会涵盖数据管理、用户交互、本地存储等核心概念。</p>
<p>首先，我们需要一个应用状态管理器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoApp</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTasks</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentId</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? 
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...<span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span>)) + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">// 从本地存储加载任务</span>
    <span class="hljs-title function_">loadTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> saved = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'todoTasks'</span>);
        <span class="hljs-keyword">return</span> saved ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(saved) : [];
    }
    
    <span class="hljs-comment">// 保存任务到本地存储</span>
    <span class="hljs-title function_">saveTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'todoTasks'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>));
    }
    
    <span class="hljs-comment">// 添加新任务</span>
    <span class="hljs-title function_">addTask</span>(<span class="hljs-params">title, dueDate</span>) {
        <span class="hljs-keyword">const</span> newTask = {
            <span class="hljs-attr">id</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentId</span>++,
            <span class="hljs-attr">title</span>: title,
            <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">dueDate</span>: dueDate,
            <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">push</span>(newTask);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
        <span class="hljs-keyword">return</span> newTask;
    }
    
    <span class="hljs-comment">// 切换任务完成状态</span>
    <span class="hljs-title function_">toggleTask</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === id);
        <span class="hljs-keyword">if</span> (task) {
            task.<span class="hljs-property">completed</span> = !task.<span class="hljs-property">completed</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
        }
    }
    
    <span class="hljs-comment">// 删除任务</span>
    <span class="hljs-title function_">deleteTask</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> !== id);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
    }
    
    <span class="hljs-comment">// 获取所有任务</span>
    <span class="hljs-title function_">getAllTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>;
    }
    
    <span class="hljs-comment">// 获取未完成的任务</span>
    <span class="hljs-title function_">getActiveTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> !t.<span class="hljs-property">completed</span>);
    }
    
    <span class="hljs-comment">// 获取已完成的任务</span>
    <span class="hljs-title function_">getCompletedTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">completed</span>);
    }
}
</code></pre>
<p>接下来是用户界面控制器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoUI</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">app</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span> = app;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initializeEventListeners</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
    }
    
    <span class="hljs-comment">// 初始化事件监听</span>
    <span class="hljs-title function_">initializeEventListeners</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> addButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'add-task-btn'</span>);
        <span class="hljs-keyword">const</span> taskInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'new-task-input'</span>);
        <span class="hljs-keyword">const</span> dueDateInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'due-date-input'</span>);
        
        addButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleAddTask</span>(taskInput, dueDateInput);
        });
        
        taskInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keypress'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleAddTask</span>(taskInput, dueDateInput);
            }
        });
    }
    
    <span class="hljs-comment">// 处理添加任务</span>
    <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">taskInput, dueDateInput</span>) {
        <span class="hljs-keyword">const</span> title = taskInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
        <span class="hljs-keyword">const</span> dueDate = dueDateInput.<span class="hljs-property">value</span>;
        
        <span class="hljs-keyword">if</span> (title) {
            <span class="hljs-keyword">const</span> newTask = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">addTask</span>(title, dueDate);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
            taskInput.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
            dueDateInput.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
            
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`添加了新任务："<span class="hljs-subst">${title}</span>"`</span>);
        }
    }
    
    <span class="hljs-comment">// 渲染任务列表</span>
    <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> taskList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'task-list'</span>);
        taskList.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
        
        <span class="hljs-keyword">const</span> tasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getAllTasks</span>();
        
        tasks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> taskElement = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createTaskElement</span>(task);
            taskList.<span class="hljs-title function_">appendChild</span>(taskElement);
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStats</span>();
    }
    
    <span class="hljs-comment">// 创建任务元素</span>
    <span class="hljs-title function_">createTaskElement</span>(<span class="hljs-params">task</span>) {
        <span class="hljs-keyword">const</span> taskElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
        taskElement.<span class="hljs-property">className</span> = <span class="hljs-string">`task-item <span class="hljs-subst">${task.completed ? <span class="hljs-string">'completed'</span> : <span class="hljs-string">''</span>}</span>`</span>;
        taskElement.<span class="hljs-property">id</span> = <span class="hljs-string">`task-<span class="hljs-subst">${task.id}</span>`</span>;
        
        taskElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="task-content"&gt;
                &lt;input type="checkbox" <span class="hljs-subst">${task.completed ? <span class="hljs-string">'checked'</span> : <span class="hljs-string">''</span>}</span> 
                    class="task-checkbox"&gt;
                &lt;span class="task-title"&gt;<span class="hljs-subst">${task.title}</span>&lt;/span&gt;
                <span class="hljs-subst">${task.dueDate ? <span class="hljs-string">`&lt;span class="due-date"&gt;截止：<span class="hljs-subst">${task.dueDate}</span>&lt;/span&gt;`</span> : <span class="hljs-string">''</span>}</span>
            &lt;/div&gt;
            &lt;button class="delete-btn"&gt;删除&lt;/button&gt;
        `</span>;
        
        <span class="hljs-comment">// 添加复选框事件</span>
        <span class="hljs-keyword">const</span> checkbox = taskElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.task-checkbox'</span>);
        checkbox.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">toggleTask</span>(task.<span class="hljs-property">id</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
        });
        
        <span class="hljs-comment">// 添加删除按钮事件</span>
        <span class="hljs-keyword">const</span> deleteBtn = taskElement.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.delete-btn'</span>);
        deleteBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">deleteTask</span>(task.<span class="hljs-property">id</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
        });
        
        <span class="hljs-keyword">return</span> taskElement;
    }
    
    <span class="hljs-comment">// 更新统计信息</span>
    <span class="hljs-title function_">updateStats</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> totalTasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getAllTasks</span>().<span class="hljs-property">length</span>;
        <span class="hljs-keyword">const</span> activeTasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getActiveTasks</span>().<span class="hljs-property">length</span>;
        <span class="hljs-keyword">const</span> completedTasks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">app</span>.<span class="hljs-title function_">getCompletedTasks</span>().<span class="hljs-property">length</span>;
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`总任务：<span class="hljs-subst">${totalTasks}</span>，待完成：<span class="hljs-subst">${activeTasks}</span>，已完成：<span class="hljs-subst">${completedTasks}</span>`</span>);
    }
}
</code></pre>
<p>最后是应用的初始化代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 应用启动函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeApp</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 创建应用实例</span>
    <span class="hljs-keyword">const</span> todoApp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoApp</span>();
    <span class="hljs-keyword">const</span> todoUI = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoUI</span>(todoApp);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'待办事项应用已启动！'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前任务数量：'</span>, todoApp.<span class="hljs-title function_">getAllTasks</span>().<span class="hljs-property">length</span>);
    
    <span class="hljs-keyword">return</span> { todoApp, todoUI };
}

<span class="hljs-comment">// 当页面加载完成后启动应用</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, initializeApp);
</code></pre>
<h2 data-id="heading-3">进阶技巧和最佳实践</h2>
<p>当你能够独立完成基础应用后，这些进阶技巧会让你的代码更加专业和可维护。</p>
<p>模块化是现代JavaScript开发的重要概念。我们可以使用ES6模块来组织代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/dateHelper.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">dateString</span>) {
    <span class="hljs-keyword">const</span> options = { <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>, <span class="hljs-attr">month</span>: <span class="hljs-string">'short'</span>, <span class="hljs-attr">day</span>: <span class="hljs-string">'numeric'</span> };
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(dateString).<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">'zh-CN'</span>, options);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isOverdue</span>(<span class="hljs-params">dueDate</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(dueDate) &lt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
}

<span class="hljs-comment">// 在另一个文件中导入使用</span>
<span class="hljs-keyword">import</span> { formatDate, isOverdue } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/dateHelper.js'</span>;

<span class="hljs-keyword">const</span> dueDate = <span class="hljs-string">'2024-12-31'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`格式化日期：<span class="hljs-subst">${formatDate(dueDate)}</span>`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`是否过期：<span class="hljs-subst">${isOverdue(dueDate)}</span>`</span>);
</code></pre>
<p>错误处理是专业开发者的标志。学会优雅地处理各种异常情况：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataValidator</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">validateTask</span>(<span class="hljs-params">task</span>) {
        <span class="hljs-keyword">const</span> errors = [];
        
        <span class="hljs-keyword">if</span> (!task.<span class="hljs-property">title</span> || task.<span class="hljs-property">title</span>.<span class="hljs-title function_">trim</span>().<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">'任务标题不能为空'</span>);
        }
        
        <span class="hljs-keyword">if</span> (task.<span class="hljs-property">title</span> &amp;&amp; task.<span class="hljs-property">title</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100</span>) {
            errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">'任务标题不能超过100个字符'</span>);
        }
        
        <span class="hljs-keyword">if</span> (task.<span class="hljs-property">dueDate</span> &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(task.<span class="hljs-property">dueDate</span>) &lt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) {
            errors.<span class="hljs-title function_">push</span>(<span class="hljs-string">'截止日期不能是过去的时间'</span>);
        }
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">isValid</span>: errors.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
            <span class="hljs-attr">errors</span>: errors
        };
    }
}

<span class="hljs-comment">// 使用验证器</span>
<span class="hljs-keyword">const</span> newTask = {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'学习JavaScript高级技巧'</span>,
    <span class="hljs-attr">dueDate</span>: <span class="hljs-string">'2024-12-31'</span>
};

<span class="hljs-keyword">const</span> validation = <span class="hljs-title class_">DataValidator</span>.<span class="hljs-title function_">validateTask</span>(newTask);
<span class="hljs-keyword">if</span> (!validation.<span class="hljs-property">isValid</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'验证失败：'</span>, validation.<span class="hljs-property">errors</span>);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'任务数据有效，可以保存'</span>);
}
</code></pre>
<p>性能优化让你的应用更加流畅。这里有一些实用的优化技巧：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用防抖优化搜索功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) {
    <span class="hljs-keyword">let</span> timeout;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executedFunction</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">later</span> = (<span class="hljs-params"/>) =&gt; {
            <span class="hljs-built_in">clearTimeout</span>(timeout);
            <span class="hljs-title function_">func</span>(...args);
        };
        <span class="hljs-built_in">clearTimeout</span>(timeout);
        timeout = <span class="hljs-built_in">setTimeout</span>(later, wait);
    };
}

<span class="hljs-comment">// 搜索任务</span>
<span class="hljs-keyword">const</span> searchTasks = <span class="hljs-title function_">debounce</span>(<span class="hljs-function">(<span class="hljs-params">searchTerm</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> filteredTasks = todoApp.<span class="hljs-title function_">getAllTasks</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span>
        task.<span class="hljs-property">title</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(searchTerm.<span class="hljs-title function_">toLowerCase</span>())
    );
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`找到 <span class="hljs-subst">${filteredTasks.length}</span> 个匹配的任务`</span>);
}, <span class="hljs-number">300</span>);

<span class="hljs-comment">// 在输入框中使用</span>
<span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'search-input'</span>);
searchInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">searchTasks</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
});
</code></pre>
<h2 data-id="heading-4">从学习到实战的转变</h2>
<p>很多人学完基础知识后，不知道如何开始真正的项目开发。这里给你一个清晰的路径。</p>
<p>首先选择适合的练习项目。从简单到复杂，逐步提升：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 项目难度分级</span>
<span class="hljs-keyword">const</span> projectRoadmap = [
    {
        <span class="hljs-attr">level</span>: <span class="hljs-string">'初级'</span>,
        <span class="hljs-attr">projects</span>: [
            <span class="hljs-string">'个人博客页面'</span>,
            <span class="hljs-string">'计算器应用'</span>,
            <span class="hljs-string">'天气查询小工具'</span>,
            <span class="hljs-string">'简单的游戏（如井字棋）'</span>
        ],
        <span class="hljs-attr">skills</span>: [<span class="hljs-string">'基础DOM操作'</span>, <span class="hljs-string">'事件处理'</span>, <span class="hljs-string">'条件判断'</span>]
    },
    {
        <span class="hljs-attr">level</span>: <span class="hljs-string">'中级'</span>,
        <span class="hljs-attr">projects</span>: [
            <span class="hljs-string">'待办事项应用（带本地存储）'</span>,
            <span class="hljs-string">'记账应用'</span>,
            <span class="hljs-string">'图片画廊'</span>,
            <span class="hljs-string">'API数据展示应用'</span>
        ],
        <span class="hljs-attr">skills</span>: [<span class="hljs-string">'异步编程'</span>, <span class="hljs-string">'本地存储'</span>, <span class="hljs-string">'模块化'</span>, <span class="hljs-string">'错误处理'</span>]
    },
    {
        <span class="hljs-attr">level</span>: <span class="hljs-string">'高级'</span>,
        <span class="hljs-attr">projects</span>: [
            <span class="hljs-string">'实时聊天应用'</span>,
            <span class="hljs-string">'任务管理系统'</span>,
            <span class="hljs-string">'数据可视化仪表板'</span>,
            <span class="hljs-string">'小型电商网站'</span>
        ],
        <span class="hljs-attr">skills</span>: [<span class="hljs-string">'框架使用'</span>, <span class="hljs-string">'状态管理'</span>, <span class="hljs-string">'性能优化'</span>, <span class="hljs-string">'测试'</span>]
    }
];
</code></pre>
<p>学会阅读文档和查找资料。这是独立开发者最重要的能力：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟解决问题的过程</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">solveProblem</span>(<span class="hljs-params">problemDescription</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'问题：'</span>, problemDescription);
    
    <span class="hljs-comment">// 第一步：分析问题</span>
    <span class="hljs-keyword">const</span> analysis = <span class="hljs-title function_">analyzeProblem</span>(problemDescription);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'问题分析：'</span>, analysis);
    
    <span class="hljs-comment">// 第二步：查找相关资料</span>
    <span class="hljs-keyword">const</span> resources = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchResources</span>(analysis.<span class="hljs-property">keywords</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'相关资源：'</span>, resources);
    
    <span class="hljs-comment">// 第三步：尝试解决方案</span>
    <span class="hljs-keyword">const</span> solution = <span class="hljs-title function_">trySolutions</span>(resources);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'解决方案：'</span>, solution);
    
    <span class="hljs-comment">// 第四步：总结学习</span>
    <span class="hljs-keyword">const</span> learnings = <span class="hljs-title function_">summarizeLearnings</span>(problemDescription, solution);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'学习总结：'</span>, learnings);
    
    <span class="hljs-keyword">return</span> solution;
}
</code></pre>
<p>建立自己的代码库和工具集。这会大大提高你的开发效率：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 个人工具函数库</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DevUtils</span> {
    <span class="hljs-comment">// 深度复制对象</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
    }
    
    <span class="hljs-comment">// 生成随机ID</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">generateId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>);
    }
    
    <span class="hljs-comment">// 格式化文件大小</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">formatFileSize</span>(<span class="hljs-params">bytes</span>) {
        <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'Bytes'</span>, <span class="hljs-string">'KB'</span>, <span class="hljs-string">'MB'</span>, <span class="hljs-string">'GB'</span>];
        <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'0 Bytes'</span>;
        <span class="hljs-keyword">const</span> i = <span class="hljs-built_in">parseInt</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1024</span>)));
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">1024</span>, i), <span class="hljs-number">2</span>) + <span class="hljs-string">' '</span> + sizes[i];
    }
    
    <span class="hljs-comment">// 等待指定时间</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));
    }
}

<span class="hljs-comment">// 使用工具函数</span>
<span class="hljs-keyword">const</span> originalObject = { <span class="hljs-attr">name</span>: <span class="hljs-string">'测试'</span>, <span class="hljs-attr">data</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] };
<span class="hljs-keyword">const</span> clonedObject = <span class="hljs-title class_">DevUtils</span>.<span class="hljs-title function_">deepClone</span>(originalObject);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'克隆的对象：'</span>, clonedObject);
</code></pre>
<h2 data-id="heading-5">持续学习和进步</h2>
<p>编程是一个需要持续学习的领域。建立好的学习习惯会让你走得更远。</p>
<p>制定合理的学习计划：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 周学习计划示例</span>
<span class="hljs-keyword">const</span> weeklyLearningPlan = {
    <span class="hljs-attr">monday</span>: {
        <span class="hljs-attr">focus</span>: <span class="hljs-string">'新技术探索'</span>,
        <span class="hljs-attr">tasks</span>: [
            <span class="hljs-string">'阅读一篇技术文章'</span>,
            <span class="hljs-string">'尝试一个新的JavaScript特性'</span>,
            <span class="hljs-string">'写一个小demo验证理解'</span>
        ],
        <span class="hljs-attr">time</span>: <span class="hljs-string">'1-2小时'</span>
    },
    <span class="hljs-attr">wednesday</span>: {
        <span class="hljs-attr">focus</span>: <span class="hljs-string">'项目实践'</span>,
        <span class="hljs-attr">tasks</span>: [
            <span class="hljs-string">'在个人项目上工作'</span>,
            <span class="hljs-string">'重构旧代码'</span>,
            <span class="hljs-string">'添加新功能'</span>
        ],
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2-3小时'</span>
    },
    <span class="hljs-attr">friday</span>: {
        <span class="hljs-attr">focus</span>: <span class="hljs-string">'总结和复习'</span>,
        <span class="hljs-attr">tasks</span>: [
            <span class="hljs-string">'整理本周学习笔记'</span>,
            <span class="hljs-string">'回顾遇到的问题和解决方案'</span>,
            <span class="hljs-string">'规划下周学习内容'</span>
        ],
        <span class="hljs-attr">time</span>: <span class="hljs-string">'1小时'</span>
    }
};
</code></pre>
<p>参与开源项目和编程社区：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 参与开源的建议步骤</span>
<span class="hljs-keyword">const</span> openSourceGuide = {
    <span class="hljs-attr">step1</span>: <span class="hljs-string">'寻找感兴趣的项目'</span>,
    <span class="hljs-attr">criteria</span>: [
        <span class="hljs-string">'有清晰的文档'</span>,
        <span class="hljs-string">'有活跃的维护者'</span>,
        <span class="hljs-string">'有good first issue标签'</span>
    ],
    
    <span class="hljs-attr">step2</span>: <span class="hljs-string">'理解项目结构'</span>,
    <span class="hljs-attr">actions</span>: [
        <span class="hljs-string">'阅读README和贡献指南'</span>,
        <span class="hljs-string">'在本地运行项目'</span>,
        <span class="hljs-string">'查看现有代码风格'</span>
    ],
    
    <span class="hljs-attr">step3</span>: <span class="hljs-string">'从小处着手'</span>,
    <span class="hljs-attr">suggestions</span>: [
        <span class="hljs-string">'修复文档错误'</span>,
        <span class="hljs-string">'解决简单的bug'</span>,
        <span class="hljs-string">'添加测试用例'</span>
    ],
    
    <span class="hljs-attr">step4</span>: <span class="hljs-string">'提交贡献'</span>,
    <span class="hljs-attr">tips</span>: [
        <span class="hljs-string">'遵循项目规范'</span>,
        <span class="hljs-string">'编写清晰的提交信息'</span>,
        <span class="hljs-string">'耐心等待代码审查'</span>
    ]
};
</code></pre>
<h2 data-id="heading-6">真正的独立开发之路</h2>
<p>读完这篇文章，你已经掌握了从零开始独立开发JavaScript应用的核心知识和技能。从基础语法到完整应用架构，从代码编写到问题解决，你现在具备了独立探索和创造的能力。</p>
<p>记住，成为真正的独立开发者不在于记住所有API，而在于培养解决问题的能力。当你遇到未知的挑战时，能够冷静分析、寻找资源、尝试方案，这才是最宝贵的技能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift TaskGroup 结果顺序踩坑指南：为什么返回顺序和创建顺序不一致，以及最通用的修复办法]]></title>    <link>https://juejin.cn/post/7570201730992013338</link>    <guid>https://juejin.cn/post/7570201730992013338</guid>    <pubDate>2025-11-09T23:39:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570201730992013338" data-draft-id="7569547022925217843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift TaskGroup 结果顺序踩坑指南：为什么返回顺序和创建顺序不一致，以及最通用的修复办法"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-09T23:39:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift TaskGroup 结果顺序踩坑指南：为什么返回顺序和创建顺序不一致，以及最通用的修复办法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:39:00.000Z" title="Sun Nov 09 2025 23:39:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">现象：看起来“随机”的结果顺序</h2>
<p>在 Swift 并发模型里，<code>withTaskGroup</code> 让我们可以一次性启动多个子任务并发执行。</p>
<p>很多初学者第一次写出的代码类似下面这样</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation

<span class="hljs-comment">/// 模拟网络请求：根据 id 返回字符串，耗时 0~4 秒随机</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">id</span>: <span class="hljs-type">Int</span>) <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">String</span> {
    <span class="hljs-comment">// 让任务随机“卡”一会儿</span>
    <span class="hljs-keyword">try!</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(for: .seconds(<span class="hljs-type">Int</span>.random(in: <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-number">5</span>)))
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Result for <span class="hljs-subst">\(id)</span>"</span>
}

<span class="hljs-keyword">let</span> results <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> withTaskGroup(of: <span class="hljs-type">String</span>.<span class="hljs-keyword">self</span>) { group <span class="hljs-keyword">in</span>
    <span class="hljs-comment">// 1. 把 0~5 共 6 个任务依次放进组里</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">...</span><span class="hljs-number">5</span> {
        group.addTask {
            <span class="hljs-keyword">await</span> fetchData(id: i)
        }
    }
    
    <span class="hljs-comment">// 2. 按任务完成顺序收集结果</span>
    <span class="hljs-keyword">var</span> temp <span class="hljs-operator">=</span> [<span class="hljs-type">String</span>]()
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> value <span class="hljs-keyword">in</span> group {
        temp.append(value)
    }
    <span class="hljs-keyword">return</span> temp
}

<span class="hljs-built_in">print</span>(results) 
<span class="hljs-comment">// 实际打印可能：["Result for 1", "Result for 5", "Result for 0", "Result for 2", "Result for 3", "Result for 4"]</span>
</code></pre>
<p>运行后发现：</p>
<ul>
<li>数组里字符串的下标和 <code>for i in 0...5</code> 的循环顺序毫无关系。</li>
<li>哪个子任务先结束，哪个就排在前面——完全符合并发语义，却不符合“人类直觉”。</li>
</ul>
<h2 data-id="heading-1">根本原因</h2>
<p>TaskGroup 的 <code>addTask</code> 只是把任务扔进并发调度器，调度器按可用线程/协程资源自由执行。</p>
<p><code>for await ... in group</code> 则是按完成顺序逐个给出结果。</p>
<p>因此“创建顺序”与“完成顺序”天然解耦，这是设计使然，不是 bug。</p>
<h2 data-id="heading-2">最通用、可扩展的修复思路</h2>
<p>把“能用来排序的元数据”和“真正的结果”一起带回来。最常见的就是“下标/序号”本身。</p>
<p>修改后的核心代码：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> ordered <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> withTaskGroup(of: (<span class="hljs-type">Int</span>, <span class="hljs-type">String</span>).<span class="hljs-keyword">self</span>) { group <span class="hljs-keyword">in</span>
    <span class="hljs-comment">// 1. 返回元组：(原始下标, 业务结果)</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">...</span><span class="hljs-number">5</span> {
        group.addTask {
            <span class="hljs-keyword">let</span> value <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> fetchData(id: i)
            <span class="hljs-keyword">return</span> (i, value)   <span class="hljs-comment">// 关键：把序号带回来</span>
        }
    }
    
    <span class="hljs-comment">// 2. 先收集到字典（或临时数组）</span>
    <span class="hljs-keyword">var</span> dict <span class="hljs-operator">=</span> [<span class="hljs-type">Int</span>: <span class="hljs-type">String</span>]()
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (index, value) <span class="hljs-keyword">in</span> group {
        dict[index] <span class="hljs-operator">=</span> value
    }
    
    <span class="hljs-comment">// 3. 按原始序号排序</span>
    <span class="hljs-keyword">return</span> dict
        .sorted(by: { <span class="hljs-variable">$0</span>.key <span class="hljs-operator">&lt;</span> <span class="hljs-variable">$1</span>.key })
        .map(\.value)
}

<span class="hljs-built_in">print</span>(ordered) 
<span class="hljs-comment">// 保证是 ["Result for 0", "Result for 1", ... "Result for 5"]</span>
</code></pre>
<h2 data-id="heading-3">知识点再梳理</h2>
<ol>
<li><code>withTaskGroup(of:)</code> 的 <code>of</code> 参数决定子任务返回类型。</li>
<li><code>addTask</code> 闭包内部可以捕获外部常量，因此能拿到循环变量 <code>i</code>。</li>
<li><code>for await</code> 迭代的是完成顺序；想恢复“创建顺序”必须自带排序键。</li>
<li>如果业务需要“部分结果优先返回”，可以改用 <code>AsyncSequence</code> 的 <code>merge()</code> 或 <code>TaskGroup</code> + <code>AsyncChannel</code></li>
</ol>
<h2 data-id="heading-4">完整可运行 Demo</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation

<span class="hljs-comment">/// 模拟网络请求</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">id</span>: <span class="hljs-type">Int</span>) <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">String</span> {
    <span class="hljs-keyword">let</span> milliseconds <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>.random(in: <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-number">5_000</span>)
    <span class="hljs-keyword">try!</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(for: .milliseconds(milliseconds))
    <span class="hljs-keyword">return</span> <span class="hljs-string">"结果-<span class="hljs-subst">\(id)</span>"</span>
}

<span class="hljs-comment">/// 保证顺序的并行抓取函数</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchAll</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">String</span>] {
    <span class="hljs-keyword">await</span> withTaskGroup(of: (<span class="hljs-type">Int</span>, <span class="hljs-type">String</span>).<span class="hljs-keyword">self</span>) { group <span class="hljs-keyword">in</span>
        <span class="hljs-comment">// 1. 添加任务</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">...</span><span class="hljs-number">5</span> {
            group.addTask {
                <span class="hljs-keyword">let</span> value <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> fetchData(id: i)
                <span class="hljs-keyword">return</span> (i, value)
            }
        }
        
        <span class="hljs-comment">// 2. 收集</span>
        <span class="hljs-keyword">var</span> dict <span class="hljs-operator">=</span> [<span class="hljs-type">Int</span>: <span class="hljs-type">String</span>](minimumCapacity: <span class="hljs-number">6</span>)
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (index, value) <span class="hljs-keyword">in</span> group {
            dict[index] <span class="hljs-operator">=</span> value
        }
        
        <span class="hljs-comment">// 3. 排序</span>
        <span class="hljs-keyword">return</span> dict
            .sorted(by: { <span class="hljs-variable">$0</span>.key <span class="hljs-operator">&lt;</span> <span class="hljs-variable">$1</span>.key })
            .map(\.value)
    }
}

<span class="hljs-type">Task</span> {
    <span class="hljs-keyword">let</span> list <span class="hljs-operator">=</span> <span class="hljs-keyword">await</span> fetchAll()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"最终顺序："</span>, list)
}
</code></pre>
<h2 data-id="heading-5">总结与扩展场景</h2>
<ol>
<li>只要“对外表现需要有序”，就一定把序号带回来；这是并发到顺序的通用模式，不限于 Swift。</li>
<li>如果子任务量巨大，占内存太多，可以把“结果”换成磁盘缓存 URL 或数据库主键，排序后再分批读取。</li>
<li>当顺序敏感且需要增量刷新 UI 时，改用 <code>AsyncSequence</code> 并按序号插入 <code>List</code>/<code>UITableView</code> 数据源，用户体验更好。</li>
<li>若业务允许“先出来先展示”，就无需任何额外工作，直接用 <code>for await</code> 流式消费，反而性能最佳。</li>
</ol>
<p>牢记：并发世界里，顺序不是默认，而是额外成本。想清楚“是否真的需要顺序”，再决定要不要买单。</p>
<h2 data-id="heading-6">学习资料</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.swiftwithvincent.com%2Fblog%2Fdont-make-this-mistake-with-a-taskgroup" target="_blank" title="https://www.swiftwithvincent.com/blog/dont-make-this-mistake-with-a-taskgroup" ref="nofollow noopener noreferrer">www.swiftwithvincent.com/blog/dont-m…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET 路由机制深入解析：从传统路由到 Endpoint Routing]]></title>    <link>https://juejin.cn/post/7570394530315370496</link>    <guid>https://juejin.cn/post/7570394530315370496</guid>    <pubDate>2025-11-09T23:39:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570394530315370496" data-draft-id="7570341520550674447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET 路由机制深入解析：从传统路由到 Endpoint Routing"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-09T23:39:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET 路由机制深入解析：从传统路由到 Endpoint Routing
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:39:52.000Z" title="Sun Nov 09 2025 23:39:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>路由是 <code>ASP.NET Core</code> 的核心基础设施，负责将 <code>HTTP</code> 请求映射到对应的处理程序（如控制器方法）。它决定了 <code>URL</code> 如何与应用程序代码交互，是现代 <code>Web</code> 开发的关键组件。</p>
<p>在 <code>ASP.NET Core</code> 中，路由系统解决了以下问题：</p>
<ul>
<li>
<p><code>URL</code> 映射：将用户友好的 <code>URL</code> 映射到具体的处理程序。</p>
</li>
<li>
<p>灵活性：支持多种路由配置（如 <code>RESTful</code> 路径、动态参数）。</p>
</li>
<li>
<p>性能优化：高效解析请求，快速定位处理逻辑。</p>
</li>
<li>
<p>可扩展性：通过中间件和自定义路由约束扩展功能。</p>
</li>
<li>
<p>异步支持：与 <code>async/await</code> 无缝集成，适合现代 <code>Web</code> 应用。</p>
</li>
</ul>
<h4 data-id="heading-1">主要功能</h4>
<ul>
<li>
<p>基于约定的路由（<code>Convention-based Routing</code>）：</p>
<ul>
<li>
<p>使用模板（如 "<code>{controller}/{action}/{id?}</code>"）定义路由规则。</p>
</li>
<li>
<p>适合传统 <code>MVC</code> 应用。</p>
</li>
</ul>
</li>
<li>
<p>特性路由（<code>Attribute Routing</code>）：</p>
<ul>
<li>
<p>通过 <code>[Route]</code> 特性直接在控制器或动作上定义路由。</p>
</li>
<li>
<p>适合 <code>RESTful API</code> 和复杂 <code>URL</code> 模式。</p>
</li>
</ul>
</li>
<li>
<p>参数绑定：</p>
<ul>
<li>
<p>支持路由参数（如 <code>{id}</code>）、查询字符串、请求体等。</p>
</li>
<li>
<p>支持可选参数、默认值和约束。</p>
</li>
</ul>
</li>
<li>
<p>中间件集成：</p>
<ul>
<li>
<p>通过 <code>UseRouting</code> 和 <code>UseEndpoints</code> 中间件处理路由。</p>
</li>
<li>
<p>支持自定义路由中间件。</p>
</li>
</ul>
</li>
<li>
<p>路由约束：</p>
<ul>
<li>
<p>限制路由参数（如 <code>int、guid、regex</code>）。</p>
</li>
<li>
<p>提高性能和安全性。</p>
</li>
</ul>
</li>
<li>
<p>区域支持（<code>Areas</code>）：</p>
<ul>
<li>将控制器分组到不同区域（如 <code>Admin、User</code>）。</li>
</ul>
</li>
<li>
<p>动态路由：</p>
<ul>
<li>支持动态生成路由（如基于数据库配置）。</li>
</ul>
</li>
<li>
<p>端点路由：</p>
<ul>
<li>统一管理 <code>MVC、Razor Pages</code> 和 <code>SignalR</code> 的路由。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">核心概念</h3>

































<table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td><strong>路由模板</strong></td><td>由文字、参数（<code>{id}</code>）、可选参数（<code>{id?}</code>）、默认值、约束组成的字符串</td></tr><tr><td><strong>路由参数</strong></td><td>路径中的占位符，匹配 URL 段并绑定到 Action 方法参数</td></tr><tr><td><strong>路由数据</strong></td><td>匹配结果的键值对集合，可在中间件或 Controller 中通过 <code>RouteData</code> 访问</td></tr><tr><td><strong>路由约束</strong></td><td>通过类型（<code>int</code>、<code>guid</code>）、正则（<code>regex(...)</code>）等限制参数匹配规则</td></tr><tr><td><strong>默认值</strong></td><td>当 URL 中未提供参数时使用的值</td></tr><tr><td><strong>终结点（Endpoint）</strong></td><td>最终与请求匹配并执行的代码单元，如 MVC Action、Razor Page、Minimal API</td></tr></tbody></table>
<h3 data-id="heading-3">配置方式</h3>
<h4 data-id="heading-4">启用 Endpoint Routing</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Program.cs （.NET 6+ Minimal Hosting）</span>
<span class="hljs-keyword">var</span> builder = WebApplication.CreateBuilder(args);
builder.Services.AddControllers();   <span class="hljs-comment">// MVC / API</span>

<span class="hljs-keyword">var</span> app = builder.Build();
app.UseRouting();                     <span class="hljs-comment">// 启动路由中间件</span>

app.UseAuthorization();               <span class="hljs-comment">// 授权、认证等</span>

app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapControllers();       <span class="hljs-comment">// 特性路由 + 约定路由</span>
    endpoints.MapRazorPages();        <span class="hljs-comment">// Razor Pages</span>
    endpoints.MapHub&lt;ChatHub&gt;(<span class="hljs-string">"/hub"</span>); <span class="hljs-comment">// SignalR</span>
    <span class="hljs-comment">// endpoints.MapGet("/ping", () =&gt; "pong"); // Minimal API</span>
});
app.Run();
</code></pre>
<h4 data-id="heading-5">约定路由（Conventional Routing）</h4>
<pre><code class="hljs language-csharp" lang="csharp">builder.Services.AddControllersWithViews();
<span class="hljs-comment">// ...</span>
app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapControllerRoute(
        name: <span class="hljs-string">"default"</span>,
        pattern: <span class="hljs-string">"{controller=Home}/{action=Index}/{id?}"</span>);

    endpoints.MapAreaControllerRoute(
        name: <span class="hljs-string">"admin"</span>,
        areaName: <span class="hljs-string">"Admin"</span>,
        pattern: <span class="hljs-string">"Admin/{controller=Dashboard}/{action=Index}/{id?}"</span>);
});
</code></pre>
<ul>
<li>
<p><code>pattern</code>：路由模板，包含默认值（<code>=Home</code>）和可选参数（?）。</p>
</li>
<li>
<p>在 <code>Controller</code> 中可不标注任何特性，直接按约定匹配 <code>URL</code>。</p>
</li>
</ul>
<h4 data-id="heading-6">特性路由（Attribute Routing）</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProductsController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet</span>]                     <span class="hljs-comment">// GET api/products</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetAll</span>()</span> { … }

    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"{id:int}"</span>)</span>]        <span class="hljs-comment">// GET api/products/5，且 id 必须是整数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Get</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> id</span>)</span> { … }

    [<span class="hljs-meta">HttpPost(<span class="hljs-string">"batch/{type?}"</span>)</span>]   <span class="hljs-comment">// POST api/products/batch 或 api/products/batch/special</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">CreateBatch</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>? type</span>)</span> { … }
}
</code></pre>
<ul>
<li>
<p><code>[Route]、[HttpGet]、[HttpPost]</code> 等特性定义路由模板、方法限制。</p>
</li>
<li>
<p>支持在控制器和方法级别混用，覆盖或叠加。</p>
</li>
</ul>
<h3 data-id="heading-7">路由模板详解</h3>
<h4 data-id="heading-8">模板语法元素</h4>













































<table><thead><tr><th>语法</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>字面值</td><td><code>api/products</code></td><td>固定匹配的路径段</td></tr><tr><td>参数 <code>{param}</code></td><td><code>{controller}</code></td><td>捕获值并绑定到参数</td></tr><tr><td>可选参数 <code>{id?}</code></td><td><code>{id?}</code></td><td>参数可选</td></tr><tr><td>默认值 <code>{id=5}</code></td><td><code>{page=1} </code></td><td>未提供时的默认值</td></tr><tr><td>约束 <code>{id:int}</code></td><td><code>{id:min(1)}</code></td><td>限制参数格式</td></tr><tr><td>通配符 <code>*</code></td><td><code>{*slug}</code></td><td>捕获剩余路径</td></tr><tr><td>命名空间</td><td><code>[Namespace("Admin")]</code></td><td>控制器命名空间约束</td></tr></tbody></table>
<h4 data-id="heading-9">路由约束类型</h4>



































<table><thead><tr><th>约束</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>类型约束</td><td><code>{id:int}</code></td><td>必须是整数</td></tr><tr><td>范围约束</td><td><code>{age:range(18,99)}</code></td><td>值在指定范围内</td></tr><tr><td>正则表达式</td><td><code>{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}</code></td><td>匹配正则模式</td></tr><tr><td>必需值</td><td><code>{name:required}</code></td><td>必须提供非空值</td></tr><tr><td>自定义约束</td><td><code>{code:validProductCode}</code></td><td>实现 <code>IRouteConstraint</code> 接口</td></tr></tbody></table>
<h3 data-id="heading-10">高级特性</h3>
<h4 data-id="heading-11">动态路由</h4>
<p>基于数据库动态生成路由：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Routing;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DynamicRouteController</span> : <span class="hljs-title">ControllerBase</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; _routes = <span class="hljs-keyword">new</span>()
    {
        { <span class="hljs-string">"page1"</span>, <span class="hljs-string">"Content for Page 1"</span> },
        { <span class="hljs-string">"page2"</span>, <span class="hljs-string">"Content for Page 2"</span> }
    };

    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"{key}"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetDynamic</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> key</span>)</span>
    {
        <span class="hljs-keyword">if</span> (_routes.TryGetValue(key, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> content))
            <span class="hljs-keyword">return</span> Ok(content);
        <span class="hljs-keyword">return</span> NotFound();
    }
}

<span class="hljs-keyword">var</span> builder = WebApplication.CreateBuilder(args);
builder.Services.AddControllers();
<span class="hljs-keyword">var</span> app = builder.Build();
app.UseRouting();
app.UseEndpoints(endpoints =&gt; endpoints.MapControllers());
app.Run();
</code></pre>
<h4 data-id="heading-12">多路由规则</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"v2/[controller]"</span>)</span>] <span class="hljs-comment">// 支持多个路由</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProductsController</span> : <span class="hljs-title">ControllerBase</span>
{
    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"all"</span>)</span>]
    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"list"</span>)</span>] <span class="hljs-comment">// 多个路径映射同一方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">ListProducts</span>()</span> { <span class="hljs-comment">/*...*/</span> }
}
</code></pre>
<h4 data-id="heading-13">路由参数转换</h4>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Route(<span class="hljs-string">"products/{id:guid}"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetProductById</span>(<span class="hljs-params">Guid id</span>)</span> { <span class="hljs-comment">/*...*/</span> }

[<span class="hljs-meta">Route(<span class="hljs-string">"products/{slug:slugify}"</span>)</span>] <span class="hljs-comment">// 自定义 SlugConstraint</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetProductBySlug</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> slug</span>)</span> { <span class="hljs-comment">/*...*/</span> }
</code></pre>
<h4 data-id="heading-14">端点元数据（Endpoint Metadata）</h4>
<p>通过 <code>WithMetadata(...)</code> 或在特性上添加自定义属性，可为终结点附加元数据，在中间件中读取以执行额外逻辑（例如权限校验、文档生成）。</p>
<h4 data-id="heading-15">路由优先级（Order）</h4>
<p>特性路由和约定路由都可设置 <code>Order</code> 属性，高优先级先匹配：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Route(<span class="hljs-string">"special"</span>, Order = 1)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">Special</span>()</span> { … }

[<span class="hljs-meta">Route(<span class="hljs-string">"{**catchAll}"</span>, Order = 100)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">CatchAll</span>()</span> { … }
</code></pre>
<h4 data-id="heading-16">端点过滤器（Endpoint Filter，.NET 7+）</h4>
<p>在 <code>Minimal APIs</code> 或 <code>Controller</code> 上，可注册 <code>Endpoint Filter</code> 以在终结点执行前后插入逻辑，相当于细粒度中间件。</p>
<h4 data-id="heading-17">最小 API 路由</h4>
<pre><code class="hljs language-csharp" lang="csharp">app.MapGet(<span class="hljs-string">"/weather/{day:datetime}"</span>, (DateTime day) =&gt;
    <span class="hljs-string">$"Weather for <span class="hljs-subst">{day:yyyy-MM-dd}</span>"</span>);
</code></pre>
<ul>
<li>
<p>直接在 <code>WebApplication</code> 上映射，既是特性路由也是约定路由的简化版。</p>
</li>
<li>
<p>支持参数绑定、依赖注入、请求处理器委托等。</p>
</li>
</ul>
<h4 data-id="heading-18">自定义路由约束</h4>
<p>实现 <code>IRouteConstraint</code> 接口，注册到路由选项中，即可在模板里使用自定义约束</p>
<h3 data-id="heading-19">路由诊断与调试</h3>
<h4 data-id="heading-20">路由信息中间件</h4>
<pre><code class="hljs language-csharp" lang="csharp">app.UseEndpoints(endpoints =&gt; { <span class="hljs-comment">/*...*/</span> });

<span class="hljs-comment">// 添加诊断中间件</span>
app.Use(<span class="hljs-keyword">async</span> (context, next) =&gt;
{
    <span class="hljs-keyword">var</span> endpoint = context.GetEndpoint();
    <span class="hljs-keyword">if</span> (endpoint != <span class="hljs-literal">null</span>)
    {
        Console.WriteLine(<span class="hljs-string">$"Endpoint: <span class="hljs-subst">{endpoint.DisplayName}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"RoutePattern: <span class="hljs-subst">{endpoint.Metadata.GetMetadata&lt;RoutePattern&gt;()}</span>"</span>);
    }
    <span class="hljs-keyword">await</span> next();
});
</code></pre>
<h3 data-id="heading-21">优缺点</h3>
<p>优点</p>
<ul>
<li>
<p>灵活性：支持约定路由和特性路由，适应多种场景。</p>
</li>
<li>
<p>性能高：基于端点路由，匹配速度快。</p>
</li>
<li>
<p>异步友好：支持 <code>async/await</code>，适合现代 <code>Web</code>。</p>
</li>
<li>
<p>可扩展：支持自定义约束、中间件和动态路由。</p>
</li>
<li>
<p><code>DI</code> 集成：与 <code>ASP.NET Core DI</code> 无缝结合。</p>
</li>
</ul>
<p>缺点</p>
<ul>
<li>
<p>配置复杂：复杂路由规则需仔细设计，避免冲突。</p>
</li>
<li>
<p>学习曲线：特性路由和约束需要熟悉语法。</p>
</li>
<li>
<p>调试难度：路由冲突或错误需调试工具（如日志）。</p>
</li>
<li>
<p>进程内限制：路由配置不跨实例，需结合外部配置。</p>
</li>
</ul>
<h3 data-id="heading-22">资源和文档</h3>
<ul>
<li>
<p>官方文档：</p>
<ul>
<li>
<p><code>Microsoft Learn</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Faspnet%2Fcore%2Ffundamentals%2Frouting" target="_blank" title="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/routing" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/aspne…</a></p>
</li>
<li>
<p><code>ASP.NET Core MVC</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Faspnet%2Fcore%2Fmvc%2Fcontrollers%2Frouting" target="_blank" title="https://learn.microsoft.com/en-us/aspnet/core/mvc/controllers/routing" ref="nofollow noopener noreferrer">learn.microsoft.com/en-us/aspne…</a></p>
</li>
</ul>
</li>
<li>
<p><code>NuGet</code> 包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nuget.org%2Fpackages%2FMicrosoft.AspNetCore.Mvc.Core" target="_blank" title="https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.Core" ref="nofollow noopener noreferrer">www.nuget.org/packages/Mi…</a></p>
</li>
<li>
<p><code>GitHub</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnet%2Faspnetcore" target="_blank" title="https://github.com/dotnet/aspnetcore" ref="nofollow noopener noreferrer">github.com/dotnet/aspn…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 协议（Protocol）指南（一）：从语法到实战]]></title>    <link>https://juejin.cn/post/7570299986530009115</link>    <guid>https://juejin.cn/post/7570299986530009115</guid>    <pubDate>2025-11-09T23:54:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570299986530009115" data-draft-id="7554003417887735842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 协议（Protocol）指南（一）：从语法到实战"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-09T23:54:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 协议（Protocol）指南（一）：从语法到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:54:33.000Z" title="Sun Nov 09 2025 23:54:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础语法：一份“合同”长什么样</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 定义协议：只声明，不实现</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">FullyNamed</span> {
    <span class="hljs-comment">// 只要可读，不要求可写</span>
    <span class="hljs-keyword">var</span> fullName: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-comment">// 2. 遵守协议：编译器会强制兑现</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Person</span>: <span class="hljs-title class_">FullyNamed</span> {
    <span class="hljs-comment">// 存储属性即可满足</span>
    <span class="hljs-keyword">var</span> fullName: <span class="hljs-type">String</span>           
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Starship</span>: <span class="hljs-title class_">FullyNamed</span> {
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">prefix</span>: <span class="hljs-type">String</span>?
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">name</span>: <span class="hljs-type">String</span>, <span class="hljs-params">prefix</span>: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>) {
        <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> name
        <span class="hljs-keyword">self</span>.prefix <span class="hljs-operator">=</span> <span class="hljs-keyword">prefix</span>
    }
    <span class="hljs-comment">// 计算属性同样可以满足协议</span>
    <span class="hljs-keyword">var</span> fullName: <span class="hljs-type">String</span> {
        (<span class="hljs-keyword">prefix</span> <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> <span class="hljs-operator">?</span> <span class="hljs-keyword">prefix</span><span class="hljs-operator">!</span> <span class="hljs-operator">+</span> <span class="hljs-string">" "</span> : <span class="hljs-string">""</span>) <span class="hljs-operator">+</span> name
    }
}
</code></pre>
<p>知识点小结</p>
<ul>
<li>协议不分存储/计算属性，只关心“名字+类型+读写权限”。</li>
<li>协议不能规定默认值、不能要求存储/计算属性二选一。</li>
</ul>
<h2 data-id="heading-1">方法需求与变体方法（mutating）</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Togglable</span> {
    <span class="hljs-comment">// 允许修改值类型自身</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">toggle</span>()          
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OnOffSwitch</span>: <span class="hljs-title class_">Togglable</span> {
    <span class="hljs-keyword">case</span> off, on
    <span class="hljs-comment">// enum 必须标记 mutating</span>
    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">toggle</span>() {        
        <span class="hljs-keyword">self</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-operator">==</span> .off <span class="hljs-operator">?</span> .on : .off
    }
}

<span class="hljs-keyword">var</span> s <span class="hljs-operator">=</span> <span class="hljs-type">OnOffSwitch</span>.off
s.toggle() <span class="hljs-comment">// on</span>
</code></pre>
<p>Tips</p>
<ul>
<li>class 实现 mutating 方法时不需要写 <code>mutating</code>（引用类型默认可变）。</li>
<li>协议里的 <code>init</code> 需求，在 class 实现时必须写 <code>required</code>，保证子类也能履约。</li>
</ul>
<h2 data-id="heading-2">协议里的初始化器 &amp; 可失败初始化器</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">SomeProtocol</span> {
    <span class="hljs-keyword">init</span>(<span class="hljs-params">param</span>: <span class="hljs-type">Int</span>)          <span class="hljs-comment">// 非可失败</span>
    <span class="hljs-keyword">init?</span>(<span class="hljs-params">failParam</span>: <span class="hljs-type">Double</span>)  <span class="hljs-comment">// 可失败</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>: <span class="hljs-title class_">SomeProtocol</span> {
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>(<span class="hljs-params">param</span>: <span class="hljs-type">Int</span>) {}          <span class="hljs-comment">// 必须写 required</span>
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">init?</span>(<span class="hljs-params">failParam</span>: <span class="hljs-type">Double</span>) {}  <span class="hljs-comment">// 可失败版本也要 required</span>
}
</code></pre>
<h2 data-id="heading-3">协议作为类型：面向接口编程</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> things: [<span class="hljs-type">TextRepresentable</span>] <span class="hljs-operator">=</span> [game, d12, simonTheHamster]
<span class="hljs-keyword">for</span> thing <span class="hljs-keyword">in</span> things {
    <span class="hljs-built_in">print</span>(thing.textualDescription)   <span class="hljs-comment">// 统一调用，无需关心真实类型</span>
}
</code></pre>
<p>三种“协议类型”场景</p>
<ol>
<li>泛型约束 <code>&lt;T: SomeProtocol&gt;</code></li>
<li>不透明类型 <code>some SomeProtocol</code>（编译期确定，调用方看不到具体类型）</li>
<li>装箱协议类型（Existential）<code>any SomeProtocol</code>（运行时决定，有微小性能开销）</li>
</ol>
<h2 data-id="heading-4">委托（Delegation）模式实战</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 定义协议（嵌套在类内部）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiceGame</span> {
    <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> delegate: <span class="hljs-type">Delegate</span>?   <span class="hljs-comment">// 弱引用防循环引用</span>
    <span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Delegate</span>: <span class="hljs-title class_">AnyObject</span> { <span class="hljs-comment">// 类专属协议</span>
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidStart</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>)
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">game</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>, <span class="hljs-params">didEndRound</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">winner</span>: <span class="hljs-type">Int</span>?)
        <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidEnd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>)
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>(<span class="hljs-params">rounds</span>: <span class="hljs-type">Int</span>) {
        (<span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span>rounds).forEach { i <span class="hljs-keyword">in</span>
            delegate<span class="hljs-operator">?</span>.gameDidStart(<span class="hljs-keyword">self</span>)
            delegate<span class="hljs-operator">?</span>.game(<span class="hljs-keyword">self</span>, didEndRound: i, winner: i)
            delegate<span class="hljs-operator">?</span>.gameDidEnd(<span class="hljs-keyword">self</span>)
        }
    }
}

<span class="hljs-comment">// 2. 任何类都能当“记录员”</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiceGameTracker</span>: <span class="hljs-title class_">DiceGame</span>.<span class="hljs-title class_">Delegate</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidStart</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始新游戏"</span>) }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">game</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>, <span class="hljs-params">didEndRound</span> <span class="hljs-params">r</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">winner</span>: <span class="hljs-type">Int</span>?) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"第<span class="hljs-subst">\(r)</span>轮 winner=<span class="hljs-subst">\(winner <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)</span>"</span>)
    }
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">gameDidEnd</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">game</span>: <span class="hljs-type">DiceGame</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-string">"游戏结束"</span>) }
}

<span class="hljs-comment">// 3. 运行</span>
<span class="hljs-keyword">let</span> game <span class="hljs-operator">=</span> <span class="hljs-type">DiceGame</span>()
<span class="hljs-keyword">let</span> gameTracker <span class="hljs-operator">=</span> <span class="hljs-type">DiceGameTracker</span>()
game.delegate <span class="hljs-operator">=</span> gameTracker
game.play(rounds: <span class="hljs-number">3</span>)
</code></pre>
<h2 data-id="heading-5">协议扩展：给协议“写实现”</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">RandomNumberGenerator</span> {}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">RandomNumberGenerator</span> {
    <span class="hljs-comment">// 所有遵守者自动获得</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">randomBool</span>() -&gt; <span class="hljs-type">Bool</span> {          
        random() <span class="hljs-operator">&gt;</span> <span class="hljs-number">0.5</span>
    }
}

<span class="hljs-comment">// 默认实现 + where 约束</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Collection</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Element</span>: <span class="hljs-title class_">Equatable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">allEqual</span>() -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> first <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.first <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.allSatisfy { <span class="hljs-variable">$0</span> <span class="hljs-operator">==</span> first }
    }
}
</code></pre>
<p>好处</p>
<ul>
<li>避免重复代码；</li>
<li>允许“协议+约束”泛型算法；</li>
<li>提供默认实现后，类型可再自定义覆盖。</li>
</ul>
<h2 data-id="heading-6">协议继承与协议组合</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">TextRepresentable</span> {}
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Named</span> {
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Aged</span> {
    <span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> }
}
<span class="hljs-comment">// 继承TextRepresentable</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">PrettyTextRepresentable</span>: <span class="hljs-title class_">TextRepresentable</span> {
    <span class="hljs-keyword">var</span> pretty: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">birthday</span>(<span class="hljs-params">person</span>: <span class="hljs-type">Named</span> &amp; <span class="hljs-type">Aged</span>) {   <span class="hljs-comment">// 同时遵守两个协议</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Happy <span class="hljs-subst">\(person.age)</span>, <span class="hljs-subst">\(person.name)</span>!"</span>)
}
</code></pre>
<h2 data-id="heading-7">可选协议需求（仅兼容 Objective-C）</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@objc</span> <span class="hljs-keyword">protocol</span> <span class="hljs-title class_">CounterDataSource</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params">forCount</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-keyword">var</span> fixedInc: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> }
}
</code></pre>
<ul>
<li>必须 <code>@objc &amp; class</code> 才能用；</li>
<li>调用时用可选链 <code>dataSource?.increment?(forCount: 5)</code>。</li>
</ul>
<h2 data-id="heading-8">隐式合成与条件一致性</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">TextRepresentable</span> {
    <span class="hljs-keyword">var</span> textualDescription: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }
}

<span class="hljs-comment">// 1. 编译器自动帮你实现 Equatable / Hashable / Comparable</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point3D</span>: <span class="hljs-title class_">Equatable</span> {          <span class="hljs-comment">// 不自己写 == 也行</span>
    <span class="hljs-keyword">var</span> x, y, z: <span class="hljs-type">Double</span>
}

<span class="hljs-comment">// 2. 条件一致性：给泛型类型“按需”加协议</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Array</span>: <span class="hljs-title class_">TextRepresentable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Element</span>: <span class="hljs-title class_">TextRepresentable</span> {
    <span class="hljs-keyword">var</span> textualDescription: <span class="hljs-type">String</span> {
        <span class="hljs-string">"["</span> <span class="hljs-operator">+</span> map(\.textualDescription).joined(separator: <span class="hljs-string">", "</span>) <span class="hljs-operator">+</span> <span class="hljs-string">"]"</span>
    }
}
</code></pre>
<h2 data-id="heading-9">检查与转换协议类型</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">for</span> object <span class="hljs-keyword">in</span> objects {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> areaObj <span class="hljs-operator">=</span> object <span class="hljs-keyword">as?</span> <span class="hljs-type">HasArea</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"面积=<span class="hljs-subst">\(areaObj.area)</span>"</span>)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"没有面积属性"</span>)
    }
}
</code></pre>
<h2 data-id="heading-10">实战技巧 &amp; 常见坑</h2>
<ol>
<li>性能：
<ul>
<li>Existential（装箱协议）有微小间接调用开销，热点代码可改泛型 <code>&lt;T: Protocol&gt;</code> 或 <code>some Protocol</code>。</li>
</ul>
</li>
<li>关联类型：
<ul>
<li>带 <code>associatedtype</code> 的协议只能当泛型约束，不能直接当变量类型（后续文章展开）。</li>
</ul>
</li>
<li>循环引用：
<ul>
<li>委托一定用 <code>weak</code> + 类专属协议 <code>: AnyObject</code>。</li>
</ul>
</li>
<li>协议粒度：
<ul>
<li>小功能拆小协议，再 <code>&amp;</code> 组合，比“胖协议”更灵活。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[某多多大厂面试相关计算机网络知识点总结]]></title>    <link>https://juejin.cn/post/7569946369990410303</link>    <guid>https://juejin.cn/post/7569946369990410303</guid>    <pubDate>2025-11-09T23:54:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569946369990410303" data-draft-id="7569821690772996138" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="某多多大厂面试相关计算机网络知识点总结"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-11-09T23:54:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            某多多大厂面试相关计算机网络知识点总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:54:32.000Z" title="Sun Nov 09 2025 23:54:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在电商平台如某多多的开发和架构中，计算机网络是保障系统高效通信和数据交换的关键技术。面试中，计算机网络相关的基础知识也是评估候选人技术水平的重要部分。本文将总结计算机网络中的一些核心概念，并回答面试中可能涉及的问题。</p>
<hr/>
<h4 data-id="heading-0"><strong>计算机网络面试问题解答</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00749a1af4ab48358c4196f5cc8ef5ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337272&amp;x-signature=jZrudUwLhw6bOgDvl4qkWvUjbeQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<h5 data-id="heading-1">1. <strong>三次握手（TCP连接建立）</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9695f77ce0994171ade6a69d1fa6508e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337272&amp;x-signature=CkSMwWw2wc9S%2FjJWoWN3sZSnykU%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h5>
<ul>
<li>
<p><strong>第一次握手</strong>：客户端发送一个 <strong>SYN</strong>（同步）标志位的报文段，请求建立连接。该报文段包含客户端的初始序列号。<br/>
</p>
</li>
<li>
<p><strong>第二次握手</strong>：服务器接收到客户端的 <strong>SYN</strong> 后，发送一个 <strong>SYN-ACK</strong>（同步确认）报文段，确认收到客户端的请求，同时也发送自己的初始序列号。</p>
</li>
<li>
<p><strong>第三次握手</strong>：客户端接收到服务器的 <strong>SYN-ACK</strong> 后，再发送一个 <strong>ACK</strong>（确认）报文段，确认连接建立。此时，双方的连接就建立起来了，通信可以开始。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8577161999d4595ab9f3f86d6e2bdfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337272&amp;x-signature=y8NF8x5ntxLfS%2BlvO43uML2SUfw%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
</ul>
<p><strong>总结</strong>：三次握手确保双方的接收和发送都能正常工作，并且能够同步各自的序列号。</p>
<hr/>
<h5 data-id="heading-2">2. <strong>四次分手（TCP连接断开）</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e77a36d6f917420081c1c41699752254~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337272&amp;x-signature=wmy5iAzroM8eOyiUoyib4At3WNc%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h5>
<ul>
<li>
<p><strong>第一次分手</strong>：主动关闭连接的一方发送 <strong>FIN</strong>（结束）报文段，表示该方数据已经发送完毕，准备断开连接。</p>
</li>
<li>
<p><strong>第二次分手</strong>：接收方确认收到 <strong>FIN</strong> 后，发送 <strong>ACK</strong> 确认报文段，表示已准备关闭自己的连接。</p>
</li>
<li>
<p><strong>第三次分手</strong>：接收方如果没有数据需要发送，则发送 <strong>FIN</strong> 报文段，表示准备断开连接。</p>
</li>
<li>
<p><strong>第四次分手</strong>：主动关闭连接的一方确认收到 <strong>FIN</strong> 后，发送 <strong>ACK</strong> 确认报文段，连接完全关闭。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02f6fd08e91740d692d85d8043253ef3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337272&amp;x-signature=cldcITXWGi%2FUaO%2FJ1SV436BeHCo%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
</ul>
<p><strong>总结</strong>：四次分手的过程确保了双方都能够确认断开连接，避免数据丢失。</p>
<hr/>
<h5 data-id="heading-3">3. <strong>TCP 拥塞控制算法</strong></h5>
<p>TCP 拥塞控制通过控制发送窗口的大小来避免网络过载，常见的算法包括：<br/>
</p>
<ul>
<li><strong>慢启动</strong>：从一个小的窗口大小开始，每收到一个确认包就将窗口大小加倍，直到网络出现拥塞。</li>
<li><strong>拥塞避免</strong>：当窗口大小达到阈值后，窗口大小的增加变得更加平缓，以避免过度拥塞。</li>
<li><strong>快速重传和快速恢复</strong>：当检测到数据包丢失时，立即重传丢失的包并调整拥塞窗口。</li>
</ul>
<p><strong>总结</strong>：TCP 拥塞控制算法通过动态调整窗口大小，确保了在网络负载变化时能保持稳定的数据传输。</p>
<hr/>
<h5 data-id="heading-4">4. <strong>TCP 和 UDP 的区别</strong></h5>
<ul>
<li>
<p><strong>TCP</strong>：<br/>
- 面向连接、可靠的协议，保证数据传输的完整性。<br/>
- 采用三次握手建立连接，四次分手断开连接。<br/>
- 适用于要求高可靠性的场景，如文件传输、网页浏览。</p>
</li>
<li>
<p><strong>UDP</strong>：<br/>
- 无连接、不可靠的协议，无法保证数据的顺序和完整性。<br/>
- 适用于实时性要求高、对丢包容忍度大的场景，如视频流、在线游戏。</p>
</li>
</ul>
<p><strong>总结</strong>：TCP 提供可靠的通信保证，适用于需要确保数据传输完整性的应用；而 UDP 更注重速度和效率，适用于对实时性要求较高的应用。</p>
<hr/>
<h5 data-id="heading-5">5. <strong>HTTPS的实现</strong></h5>
<ul>
<li>
<p><strong>加密通信</strong>：HTTPS 使用 <strong>SSL/TLS</strong> 协议对 HTTP 请求和响应进行加密，确保数据在传输过程中不会被窃取或篡改。<br/>
</p>
</li>
<li>
<p><strong>身份验证</strong>：服务器通过数字证书来验证身份，防止中间人攻击。客户端会验证证书是否由受信任的机构颁发。</p>
</li>
<li>
<p><strong>数据完整性</strong>：SSL/TLS 协议提供消息认证码（MAC）机制，确保数据在传输过程中不被篡改。</p>
</li>
</ul>
<p><strong>总结</strong>：HTTPS 通过加密、身份验证和数据完整性保证了通信的安全性，常用于保护敏感信息的传输，如银行交易和个人信息。</p>
<hr/>
<h5 data-id="heading-6">6. <strong>Cookie 和 Session</strong></h5>
<ul>
<li><strong>Cookie</strong>：<br/>
- 存储在客户端，浏览器每次请求时会自动发送给服务器。<br/>
- 可以存储会话信息、用户偏好等数据，但存在安全风险（如 XSS 攻击）。<br/>
</li>
<li><strong>Session</strong>：<br/>
- 存储在服务器端，客户端通过 Cookie 存储 Session ID 以识别会话。<br/>
- 更加安全，能够避免敏感信息泄露，因为数据存储在服务器上。</li>
</ul>
<p><strong>总结</strong>：Cookie 存储在客户端，适合存储简单的数据；Session 存储在服务器端，适合存储敏感或大量的数据。</p>
<hr/>
<h5 data-id="heading-7">7. <strong>网络七层模型</strong></h5>
<ul>
<li><strong>物理层</strong>：负责物理连接和信号传输。</li>
<li><strong>数据链路层</strong>：提供点对点的链路管理，负责帧的传输。</li>
<li><strong>网络层</strong>：负责数据包的路由选择和寻址（如 IP）。</li>
<li><strong>传输层</strong>：提供端到端的传输服务（如 TCP、UDP）。</li>
<li><strong>会话层</strong>：管理会话的建立、维持和终止。</li>
<li><strong>表示层</strong>：数据的格式化、加密和解密。</li>
<li><strong>应用层</strong>：直接为用户提供服务（如 HTTP、FTP）。</li>
</ul>
<p><strong>总结</strong>：七层模型用于标准化网络通信过程，不同层次负责不同的网络功能，帮助协议的实现和兼容。</p>
<hr/>
<h5 data-id="heading-8">8. <strong>IP 寻址流程</strong></h5>
<p>IP 寻址流程包括以下步骤：</p>
<ul>
<li><strong>源主机</strong>：源主机根据目标 IP 地址判断是否在本地网络内。</li>
<li><strong>路由选择</strong>：如果目标 IP 不在本地网络，源主机将数据包发送给默认网关（路由器），路由器根据路由表进行转发。</li>
<li><strong>目标主机</strong>：目标主机接收到数据包，根据目标 IP 地址对数据进行处理。</li>
</ul>
<p><strong>总结</strong>：IP 地址决定了数据包如何在网络中进行转发，从源主机到目标主机的路径选择依赖于路由器的路由表。</p>
<hr/>
<h5 data-id="heading-9">9. <strong>HTTP 如何保持连接</strong></h5>
<p>HTTP 默认是无连接的，但可以通过以下方式保持连接：</p>
<ul>
<li><strong>HTTP/1.1</strong>：启用了 <strong>持久连接</strong>（Connection: keep-alive），即在一次 TCP 连接中可以发送多个 HTTP 请求和响应。</li>
<li><strong>HTTP/2</strong>：使用多路复用技术，使多个请求/响应可以共享一个连接，提高了性能。</li>
</ul>
<p><strong>总结</strong>：通过持久连接和多路复用，HTTP 实现了在同一 TCP 连接上多次请求/响应的传输。</p>
<hr/>
<h5 data-id="heading-10">10. <strong>如果不用 HTTP，如何保持连接</strong></h5>
<p>可以使用其他协议保持连接：</p>
<ul>
<li><strong>WebSocket</strong>：提供全双工通信，可以保持客户端与服务器之间的连接，适合实时应用。</li>
<li><strong>RPC（远程过程调用）</strong>：客户端与服务器之间通过定义好的协议进行通信，保持连接用于调用远程服务。</li>
</ul>
<p><strong>总结</strong>：WebSocket 和 RPC 都可以用于保持客户端与服务器之间的长期连接，适用于实时通讯或服务调用。</p>
<hr/>
<h5 data-id="heading-11">11. <strong>Cookie 和 Token 的区别</strong></h5>
<ul>
<li>
<p><strong>Cookie</strong>：<br/>
- 存储在客户端，用于保存会话状态，通常由浏览器自动发送。<br/>
- 存储敏感信息时，可能面临 XSS 或 CSRF 攻击。</p>
</li>
<li>
<p><strong>Token</strong>：<br/>
- 一般用于认证，存储在客户端（如 localStorage）或请求头中。<br/>
- 更加灵活，适用于跨域认证、移动端应用等场景。</p>
</li>
</ul>
<p><strong>总结</strong>：Token 更适用于现代 Web 应用的认证和授权，而 Cookie 更多用于浏览器端的会话管理。</p>
<hr/>
<h5 data-id="heading-12">12. <strong>RPC、HTTP 和消息队列三者区别</strong></h5>
<ul>
<li><strong>RPC（远程过程调用）</strong>：用于不同计算机之间的通信，通过直接调用远程函数来实现。</li>
<li><strong>HTTP</strong>：主要用于 Web 请求和响应，适用于请求-响应模型。</li>
<li><strong>消息队列</strong>：用于异步通信，将消息发送到队列，由消费者异步处理，适合解耦和流量削峰。</li>
</ul>
<p><strong>总结</strong>：RPC 适合同步调用，HTTP 适合请求-响应模式，消息队列适用于解耦和异步处理。</p>
<hr/>
<h5 data-id="heading-13">13. <strong>访问一个网站的过程</strong></h5>
<ol>
<li><strong>DNS 解析</strong>：浏览器通过 DNS 查找目标网站的 IP 地址。</li>
<li><strong>建立连接</strong>：浏览器与服务器建立 TCP 连接（通过三次握手）。</li>
<li><strong>发送请求</strong>：浏览器发送 HTTP 请求。</li>
<li><strong>服务器响应</strong>：服务器处理请求并返回 HTTP 响应。</li>
<li><strong>浏览器渲染</strong>：浏览器根据响应的数据渲染页面。</li>
<li><strong>关闭连接</strong>：通过</li>
</ol>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot实现隐式参数注入]]></title>    <link>https://juejin.cn/post/7570187256105533446</link>    <guid>https://juejin.cn/post/7570187256105533446</guid>    <pubDate>2025-11-09T23:55:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570187256105533446" data-draft-id="7569920331118854184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot实现隐式参数注入"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T23:55:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot实现隐式参数注入
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:55:57.000Z" title="Sun Nov 09 2025 23:55:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：一个痛点</h2>
<p>想象一下这样的场景：用户请求带着 JWT Token 进入你的系统，Filter 层面解析 Token 得到用户 ID，接下来需要：</p>
<ul>
<li>在 Controller 层获取用户信息</li>
<li>在 Service 层进行权限验证</li>
<li>在某些业务逻辑中记录操作日志</li>
</ul>
<p>每一个环节都需要知道"当前用户是谁"，看看目前常用的解决方案。</p>
<h4 data-id="heading-1">传统方案的"缺陷"</h4>
<p><strong>方案一：ThreadLocal</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 看起来很"Hack"</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Long&gt; currentUser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
</code></pre>
<ul>
<li><strong>线程安全问题</strong>：在异步环境下可能出现数据错乱</li>
<li><strong>内存泄漏风险</strong>：ThreadLocal 使用不当可能导致内存泄漏</li>
<li><strong>代码可读性差</strong>：隐式的数据传递方式让代码逻辑变得难以追踪</li>
</ul>
<p><strong>方案二：HttpServletRequest.setAttribute()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 看起来很"丑"</span>
<span class="hljs-meta">@GetMapping("/me")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getMyProfile</span><span class="hljs-params">(HttpServletRequest request)</span> {
    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) request.getAttribute(<span class="hljs-string">"currentUserId"</span>);
    <span class="hljs-keyword">return</span> userService.getById(userId);
}
</code></pre>
<ul>
<li><strong>类型不安全</strong>：需要手动进行类型转换，容易出现 ClassCastException</li>
<li><strong>代码冗余</strong>：每个需要用户信息的 Controller 都要重复相同的逻辑</li>
<li><strong>违反了 Controller 的"纯净性"</strong>：引入了 Servlet API 依赖</li>
<li><strong>字符串魔法值</strong>：属性名称容易写错，编译时无法检查</li>
</ul>
<h2 data-id="heading-2">Spring MVC：HandlerMethodArgumentResolver</h2>
<p>Spring MVC 提供了一个解决方案：<strong>自定义参数解析器（HandlerMethodArgumentResolver）</strong>。</p>
<p>这个设计模式体现了 Spring 框架一贯的"约定优于配置"的理念。它不要求我们改变 Filter 层面的实现，而是在参数解析这个环节做文章，通过扩展框架的能力来解决问题。</p>
<h4 data-id="heading-3">设计思路</h4>
<p>Spring MVC 的 HandlerMethodArgumentResolver 机制实际上是一种"适配器模式"的应用。它将不同来源的参数（Request 参数、Path 变量、Header 信息、Session 数据等）统一适配成 Controller 方法可以直接使用的形式。</p>
<p>这种设计的巧妙之处在于：</p>
<ul>
<li><strong>职责分离</strong>：Filter 负责认证和设置状态，Resolver 负责参数转换</li>
<li><strong>可扩展性</strong>：可以轻松添加新的参数解析逻辑</li>
<li><strong>无侵入性</strong>：不影响现有的代码结构</li>
</ul>
<p>这个方案的核心思想是：<strong>将 request.getAttribute() 操作，封装成类型安全的方法参数</strong>。</p>
<h4 data-id="heading-4">核心实现</h4>
<h5 data-id="heading-5">第一步：创建自定义注解</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.PARAMETER)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> CurrentUser {
}
</code></pre>
<h5 data-id="heading-6">第二步：实现参数解析器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-comment">// 只解析被 @CurrentUser 标记的参数</span>
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentUser.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 从 request 中获取之前设置的用户ID</span>
        <span class="hljs-keyword">return</span> webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);
    }
}
</code></pre>
<h5 data-id="heading-7">第三步：注册解析器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CurrentUserArgumentResolver currentUserArgumentResolver;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addArgumentResolvers</span><span class="hljs-params">(List&lt;HandlerMethodArgumentResolver&gt; resolvers)</span> {
        resolvers.add(currentUserArgumentResolver);
    }
}
</code></pre>
<h2 data-id="heading-8">方案示例</h2>
<h4 data-id="heading-9">Filter 层面</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JwtService jwtService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request,
                                   HttpServletResponse response,
                                   FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException {

        <span class="hljs-type">String</span> <span class="hljs-variable">authorizationHeader</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"Authorization"</span>);

        <span class="hljs-keyword">if</span> (authorizationHeader != <span class="hljs-literal">null</span> &amp;&amp; authorizationHeader.startsWith(<span class="hljs-string">"Bearer "</span>)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> authorizationHeader.substring(<span class="hljs-number">7</span>);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> jwtService.extractUserId(token);
                <span class="hljs-comment">// 标准：使用 request.setAttribute 设置</span>
                request.setAttribute(<span class="hljs-string">"currentUserId"</span>, userId);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-comment">// token 无效，继续执行后续逻辑</span>
            }
        }

        filterChain.doFilter(request, response);
    }
}
</code></pre>
<h4 data-id="heading-10">Controller 层面</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@GetMapping("/me")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">getCurrentUser</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId)</span> {
        <span class="hljs-comment">// userId 被"魔法般"地自动注入了！</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findById(userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(user);
    }

    <span class="hljs-meta">@PutMapping("/me")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">updateCurrentUser</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId,
                                                 <span class="hljs-meta">@RequestBody</span> UserUpdateRequest request)</span> {
        <span class="hljs-comment">// 每个 Controller 方法都可以直接使用 @CurrentUser</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">updatedUser</span> <span class="hljs-operator">=</span> userService.updateUser(userId, request);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedUser);
    }

    <span class="hljs-meta">@GetMapping("/permissions")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Permission&gt;&gt; <span class="hljs-title function_">getUserPermissions</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId)</span> {
        <span class="hljs-comment">// 完全类型安全，无需手动类型转换</span>
        List&lt;Permission&gt; permissions = userService.getUserPermissions(userId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(permissions);
    }
}
</code></pre>
<h2 data-id="heading-11">原理解析</h2>
<h4 data-id="heading-12">HandlerMethodArgumentResolver 工作流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[HTTP请求] --&gt; B[Filter链]
    B --&gt; C[DispatcherServlet]
    C --&gt; D[HandlerMapping]
    D --&gt; E[HandlerAdapter]
    E --&gt; F[HandlerMethodArgumentResolver]
    F --&gt; G{supportsParameter?}
    G --&gt;|Yes| H[resolveArgument]
    G --&gt;|No| I[使用默认解析器]
    H --&gt; J[参数注入]
    I --&gt; J
    J --&gt; K[Controller方法执行]
</code></pre>
<p>在这个流程中，Spring MVC 会按照注册的顺序遍历所有的 HandlerMethodArgumentResolver，对于每个需要解析的参数，都会调用 <code>supportsParameter()</code> 方法判断是否支持，如果支持则调用 <code>resolveArgument()</code> 方法进行实际的参数解析。</p>
<h4 data-id="heading-13">方案优势</h4>
<p>这个方案的优势不仅体现在代码层面，更重要的是它符合软件工程的多个重要原则：</p>
<p><strong>1. 类型安全</strong>：编译时检查，避免运行时类型转换错误。当你错误地将 <code>@CurrentUser Long</code> 写成 <code>@CurrentUser String</code> 时，编译器会立刻提醒你。</p>
<p><strong>2. 代码简洁</strong>：Controller 方法专注于业务逻辑。不再需要每次都写 <code>request.getAttribute()</code> 的样板代码，让业务逻辑更加清晰。</p>
<p><strong>3. 可测试性</strong>：Mock 变得简单直接。在单元测试中，你只需要模拟参数值，而不需要构建整个 HttpServletRequest 对象。</p>
<p><strong>4. 可维护性</strong>：统一的用户信息获取方式。当需要修改用户信息的获取逻辑时，只需要修改 Resolver，而不需要修改每个 Controller 方法。</p>
<p><strong>5. 扩展性</strong>：轻松支持更多用户相关属性。通过修改 Resolver 的逻辑，可以支持返回 User 对象、用户权限、用户偏好设置等复杂信息。</p>
<p><strong>6. 关注点分离</strong>：Filter 专注于认证逻辑，Resolver 专注于参数解析，Controller 专注于业务逻辑，各司其职，代码结构更加清晰。</p>
<h2 data-id="heading-14">进阶用法：传递完整用户对象</h2>
<p>在真实的项目中，我们往往需要的不仅仅是用户 ID，而是完整的用户信息、权限数据、或者用户偏好设置。HandlerMethodArgumentResolver 的强大之处就在于它可以智能地根据参数类型返回不同的对象。</p>
<h4 data-id="heading-15">扩展解析器支持复杂对象</h4>
<p>这里的核心思想是<strong>根据 Controller 方法的参数类型动态决定返回什么对象</strong>，这样可以最大程度地提高代码的灵活性和复用性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentUser.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {

        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);

        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 或者抛出异常</span>
        }

        <span class="hljs-comment">// 根据参数类型决定返回什么</span>
        Class&lt;?&gt; parameterType = parameter.getParameterType();

        <span class="hljs-keyword">if</span> (parameterType == Long.class || parameterType == <span class="hljs-type">long</span>.class) {
            <span class="hljs-keyword">return</span> userId;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterType == User.class) {
            <span class="hljs-keyword">return</span> userService.findById(userId);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterType == UserProfile.class) {
            <span class="hljs-keyword">return</span> userService.getUserProfile(userId);
        }

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Unsupported parameter type: "</span> + parameterType);
    }
}
</code></pre>
<h4 data-id="heading-16">Controller 中的多种用法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedUserController</span> {

    <span class="hljs-meta">@GetMapping("/user/id")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">getUserId</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-string">"User ID: "</span> + userId);
    }

    <span class="hljs-meta">@GetMapping("/user/info")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> User user)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok(user);
    }

    <span class="hljs-meta">@GetMapping("/user/profile")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;UserProfile&gt; <span class="hljs-title function_">getUserProfile</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> UserProfile profile)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.ok(profile);
    }
}
</code></pre>
<h2 data-id="heading-17">实战技巧与注意事项</h2>
<p>在实际项目中使用 HandlerMethodArgumentResolver 时，还需要考虑一些实际的工程问题。下面是一些常见的场景和解决方案。</p>
<h4 data-id="heading-18">1. 异常处理</h4>
<p>在用户未登录或者 Token 无效的情况下，我们需要优雅地处理异常情况，而不是让系统抛出难以理解的错误信息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);

        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"用户未登录"</span>);
        }

        <span class="hljs-keyword">return</span> userId;
    }
}

<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {

    <span class="hljs-meta">@ExceptionHandler(UnauthorizedException.class)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">handleUnauthorized</span><span class="hljs-params">(UnauthorizedException e)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">401</span>).body(e.getMessage());
    }
}
</code></pre>
<h4 data-id="heading-19">2. 与 Spring Security 集成</h4>
<p>在许多企业级应用中，我们使用 Spring Security 进行认证和授权。如何将 Spring Security 的用户信息与我们的自定义 Resolver 结合使用是一个常见问题。</p>
<p>Spring Security 提供了 <code>SecurityContextHolder</code> 来存储当前用户的认证信息，我们可以直接从中获取用户详情，然后转换成我们需要的格式。这种集成方式的优势是可以复用 Spring Security 的完整认证体系，包括各种认证方式（JWT、OAuth2、Session 等）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();

        <span class="hljs-keyword">if</span> (authentication != <span class="hljs-literal">null</span> &amp;&amp; authentication.isAuthenticated()) {
            <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> (UserDetails) authentication.getPrincipal();
            <span class="hljs-keyword">return</span> Long.parseLong(userDetails.getUsername()); <span class="hljs-comment">// 假设username存储的是userId</span>
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-20">3. 多租户场景</h4>
<p>在 SaaS 应用中，多租户是一个常见的需求。除了当前用户信息，我们还需要知道当前租户的信息。通过创建多个自定义注解和对应的 Resolver，我们可以轻松实现这种需求。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.PARAMETER)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> CurrentTenant {
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentTenantArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentTenant.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> webRequest.getAttribute(<span class="hljs-string">"currentTenantId"</span>, WebRequest.SCOPE_REQUEST);
    }
}

<span class="hljs-meta">@GetMapping("/tenant/data")</span>
<span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Data&gt;&gt; <span class="hljs-title function_">getTenantData</span><span class="hljs-params">(<span class="hljs-meta">@CurrentUser</span> Long userId,
                                               <span class="hljs-meta">@CurrentTenant</span> Long tenantId)</span> {
    <span class="hljs-comment">// 同时获取当前用户和租户信息</span>
    List&lt;Data&gt; data = dataService.findByUserAndTenant(userId, tenantId);
    <span class="hljs-keyword">return</span> ResponseEntity.ok(data);
}
</code></pre>
<h2 data-id="heading-21">总结</h2>
<p>通过 Spring MVC 的 HandlerMethodArgumentResolver我们实现了一个可以"跨 Filter 与 Controller 传参"的技术实现方案。将底层 Servlet API 的 request.getAttribute() 操作抽象为编译时类型安全的方法参数注入，实现了框架层面的参数解析适配，既保持了架构的纯净性，又提供了强大的扩展能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[调用服务出现网络错误的问题排查与解决]]></title>    <link>https://juejin.cn/post/7569977160276049963</link>    <guid>https://juejin.cn/post/7569977160276049963</guid>    <pubDate>2025-11-09T23:55:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569977160276049963" data-draft-id="7570162686579736618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="调用服务出现网络错误的问题排查与解决"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-11-09T23:55:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            调用服务出现网络错误的问题排查与解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T23:55:18.000Z" title="Sun Nov 09 2025 23:55:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在分布式系统和微服务架构中，服务之间的调用是常见的操作。然而，有时在调用某个外部服务时，可能会遇到网络错误或连接失败的情况。这类问题可能与网络环境、域名解析、DNS 配置等因素相关，给服务的稳定性和可用性带来影响。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/072de9b1228948288bedaa73ebed80b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=D38McjLmmzvgPjnQyV6FZ1bp%2F%2BY%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p>本文将介绍如何排查和解决调用服务时出现网络错误的问题，最终通过 <code>ping</code> 命令确认错误接口的域名，并通过本地 <code>hosts</code> 文件检查和修改解析，解决了因 DNS 配置问题引起的服务调用失败。</p>
<h4 data-id="heading-0">1. <strong>问题背景</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a94ba702513147a2a6e39cc677e30fa8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=njyQBlX7gUTnFXRgVKZwaRq1tKI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p>在调用某个外部服务时，应用程序报错，提示无法访问目标服务，或者出现网络连接超时的情况。通常情况下，这种问题可能由多种原因引起，包括：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061f796a645343e798a3c210b5ddb243~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=UbXJSpPDiYj0ciL1Lrep9CI6Ueo%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li>服务端不可达（如服务崩溃、网络故障等）</li>
<li>本地网络环境问题</li>
<li>DNS 配置错误（域名解析问题）</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfca1412a2aa4eb8a35d4d7f9424dfba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=9lVmjMZbTMIGGBuMnRyFbWT0%2B5M%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p>在这种情况下，我们需要通过逐步排查来定位问题的根源。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b984f5425cf94933b32ed012039fca2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=gY06%2B753GE%2FnNSG734GSlhTHpKo%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<h4 data-id="heading-1">2. <strong>排查步骤</strong></h4>
<h5 data-id="heading-2">2.1 <strong>检查服务是否可访问</strong></h5>
<p>首先，确认目标服务是否可用。常见的服务访问问题包括服务宕机、网络不可达等。我们可以通过以下几种方法进行检查：</p>
<ul>
<li><strong>检查服务是否在运行</strong>：通过访问服务所在服务器的管理界面或监控工具，确认服务是否正常运行。</li>
<li><strong>检查服务日志</strong>：如果服务在运行，但调用仍失败，可以查看服务的日志，找出是否有异常或错误信息。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/466d743068024d8e9998794abd149092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=xaxC9UO7TJ%2BtvMly7HN2Sq4pvYQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</li>
</ul>
<h5 data-id="heading-3">2.2 <strong>确认目标服务的 IP 地址</strong></h5>
<p>有时候服务可能由于负载均衡、DNS 变动等原因，导致域名解析的 IP 地址发生变化。因此，我们需要通过 <code>ping</code> 或 <code>nslookup</code> 命令，手动确认目标服务的 IP 地址。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b1da638bf46450eace47a6d7bdab8a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=8spQtc1Hdwv8yaLC%2FxK%2BBJWmfKM%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p><strong>步骤：</strong></p>
<ol>
<li><strong>使用 <code>ping</code> 命令确认目标服务是否能够解析到正确的 IP 地址</strong>：<br/>
<br/>
<code>bash      ping service.example.com![](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51bc34719d0c40cca4f5a21e115821c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=mvMeFk1nSrEwUTvpeCtyOev54DI%3D)![](&lt;&gt; "点击并拖拽以移动")​编辑      </code></li>
</ol>
<p>   如果 <code>ping</code> 命令返回网络错误，可能是因为目标服务的域名无法解析，或者网络连接存在问题。</p>
<ol start="2">
<li><strong>使用 <code>nslookup</code> 或 <code>dig</code> 命令检查域名解析的结果</strong>：<br/>
<br/>
<code>bash      nslookup service.example.com      </code></li>
</ol>
<p>   通过这些命令，我们可以查看域名解析到的 IP 地址，确认是否与服务实际部署的 IP 地址一致。</p>
<h5 data-id="heading-4">2.3 <strong>检查本地 DNS 配置与缓存</strong></h5>
<p>如果通过 <code>ping</code> 命令发现域名解析返回的是错误的 IP 地址，问题很可能出在本地的 DNS 配置或缓存上。此时，我们需要检查本地的 DNS 配置以及操作系统中的 DNS 缓存。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcd1d2c59f6d4dd1be2c2bfcea1b80d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=EY2Gb7eOBUL09%2FC97oQ2Y0Iaqq0%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ol>
<li><strong>清理 DNS 缓存（Windows）</strong>：</li>
</ol>
<p>   在 Windows 系统中，DNS 缓存可能会导致域名解析到错误的 IP 地址。使用以下命令清除 DNS 缓存：</p>
<p>   <code>bash      ipconfig /flushdns      </code></p>
<ol start="2">
<li><strong>检查本地 <code>hosts</code> 文件</strong>：</li>
</ol>
<p>   在 Windows 或 Linux 系统中，<code>hosts</code> 文件可以手动设置域名解析规则。如果该文件配置了错误的 IP 地址，可能会导致服务调用失败。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21000b0c5c5749a0bf44c97b9b2f8737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=i1%2Bo8AEGxd5OuMjvTCxW8SycXoM%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p>   - <strong>Windows</strong>：在 <code>C:\Windows\System32\drivers\etc\hosts</code> 中查看。<br/>
- <strong>Linux/Mac</strong>：在 <code>/etc/hosts</code> 中查看。</p>
<p>   打开 <code>hosts</code> 文件，确认是否存在针对目标服务域名的解析条目。如果存在解析到错误的 IP 地址，直接修改为正确的 IP 地址。</p>
<p>   例如，如果 <code>hosts</code> 文件中存在如下内容：</p>
<p>   <code>bash      182.168.1.10 service.example.com      </code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/534e55b73d09429ba8888d605c9127aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=OzUTPUYK7%2FhGcAppzber8%2BdpfNs%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p>   而服务的真实 IP 地址应为 <code>112.0.113.5</code>，则需要将 <code>182.168.1.10</code> 修改为正确的 IP 地址。</p>
<h5 data-id="heading-5">2.4 <strong>检查网络连接是否被防火墙或安全组阻挡</strong></h5>
<p>有时，服务所在的服务器可能存在防火墙或安全组规则，限制了外部访问。这时需要检查目标服务器是否允许从当前客户端的 IP 地址发起连接。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8111dd5c8015457891c1025d211d9adf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=sEQKRjGrTS58EfGWbS4oVL3quz4%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li><strong>检查服务器防火墙配置</strong>：确认防火墙没有阻止对外部服务端口的访问。</li>
<li><strong>检查安全组配置（云服务器）</strong>：如果服务部署在云环境中（如 AWS、阿里云等），需要检查安全组设置，确认目标端口是否对外开放。</li>
</ul>
<h5 data-id="heading-6">2.5 <strong>重试服务调用</strong></h5>
<p>如果以上步骤都确认没有问题，但服务依然无法访问，建议尝试以下操作：</p>
<ul>
<li><strong>尝试重新启动应用程序</strong>：有时应用程序可能因为内部连接池或网络延迟等问题导致服务无法连接。重启应用程序可以帮助恢复正常连接。</li>
<li><strong>等待 DNS 刷新</strong>：有时 DNS 配置更新后需要一些时间来生效。可以等待几分钟后再次尝试访问。</li>
</ul>
<h4 data-id="heading-7">3. <strong>解决方案：修改 <code>hosts</code> 文件</strong></h4>
<p>经过上述排查，我们发现问题源于本地 <code>hosts</code> 文件中针对目标域名的错误解析。具体的解决方案如下：</p>
<ol>
<li>
<p>打开本地 <code>hosts</code> 文件：<br/>
- <strong>Windows</strong>：在 <code>C:\Windows\System32\drivers\etc\hosts</code> 中编辑。<br/>
- <strong>Linux/Mac</strong>：在 <code>/etc/hosts</code> 中编辑。</p>
</li>
<li>
<p>在 <code>hosts</code> 文件中找到该域名的解析条目，注销之前的 IP 地址和域名映射。假设目标服务正确的 IP 地址是 <code>203.0.113.5</code>，则修改如下：添加#</p>
</li>
</ol>
<p>   <code>bash      #203.0.113.5 service.example.com      </code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2777db9d079a40fdad662b838a350d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763337317&amp;x-signature=djnHqwVPKbKVLRIxMSPSNT%2FmNrk%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ol start="3">
<li>
<p>保存并关闭文件后，清理 DNS 缓存（如上文所述）。</p>
</li>
<li>
<p>再次使用 <code>ping</code> 命令确认是否能够解析到正确的 IP 地址：</p>
</li>
</ol>
<p>   <code>bash      ping service.example.com      </code></p>
<p>返回的是正确的IP地址,完美解决</p>
<ol start="5">
<li>最后，再次尝试访问服务，确认问题是否解决。</li>
</ol>
<h4 data-id="heading-8">4. <strong>总结</strong></h4>
<p>网络错误在分布式架构中是常见的，解决这类问题需要逐步排查。通过本次排查，我们发现目标服务的域名解析出了问题，而根本原因是本地 <code>hosts</code> 文件中的错误配置。通过修改 <code>hosts</code> 文件并清理 DNS 缓存，我们成功解决了问题。</p>
<p>在排查这类网络问题时，可以按照以下步骤进行：</p>
<ol>
<li>使用 <code>ping</code> 和 <code>nslookup</code> 检查域名解析。</li>
<li>清理 DNS 缓存，检查并修改本地 <code>hosts</code> 文件。</li>
<li>检查防火墙和安全组配置。</li>
<li>重试服务调用，确保配置更新生效。</li>
</ol>
<p>通过这些方法，能够有效解决大多数网络连接问题，提高服务的可靠性和稳定性。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio + Gemini：重塑安卓 AI 开发新范式]]></title>    <link>https://juejin.cn/post/7570260758061170723</link>    <guid>https://juejin.cn/post/7570260758061170723</guid>    <pubDate>2025-11-09T18:18:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570260758061170723" data-draft-id="7570306250027106356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio + Gemini：重塑安卓 AI 开发新范式"/> <meta itemprop="keywords" content="Android Studio,Android,AI编程"/> <meta itemprop="datePublished" content="2025-11-09T18:18:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fundroid"/> <meta itemprop="url" content="https://juejin.cn/user/3931509309842872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio + Gemini：重塑安卓 AI 开发新范式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3931509309842872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fundroid
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T18:18:54.000Z" title="Sun Nov 09 2025 18:18:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{line-height:2.1;font-weight:400;font-size:16px;color:#333;font-family:-apple-system,BlinkMacSystemFont,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:all;padding-left:0;padding-right:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:2.1;margin-top:64px;margin-bottom:24px;padding:0 32px}.markdown-body h1{font-size:24px;margin-bottom:5px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-size:16px}.markdown-body p{line-height:inherit;margin-top:32px;margin-bottom:32px;letter-spacing:.5px;padding:0 32px}.markdown-body img{display:block;max-width:100%}.markdown-body hr{border:none;height:.5px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,transparent,rgba(0,0,0,.25),transparent)}.markdown-body code{word-break:break-word;border-radius:4px;overflow-x:auto;background-color:#f5f6f9;font-size:14px;padding:6px 8px;margin:0 4px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;margin:30px 0}.markdown-body pre&gt;code{font-size:13px;padding:32px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background-color:#f5f6f9}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{font-size:15px;width:auto;max-width:100%;overflow:auto;border:none;min-width:100%}.markdown-body thead{background:#f6f6f6;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{font-size:15px;border:1px solid #e8e8e8;border-radius:4px!important;padding:12px;transition:all .5s}.markdown-body td:hover,.markdown-body th:hover{background-color:#f0f0f0;color:#1171ee}.markdown-body blockquote{color:#0a0c10!important;padding:18px 32px;margin:22px 0;border-left:3px solid #0c8;background-color:rgba(0,204,136,.1)!important;border-radius:3px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;padding:0;font-size:15px;line-height:2}.markdown-body ol,.markdown-body ul{padding-left:0;margin-left:0;list-style:none}.markdown-body ol li,.markdown-body ul li{font-size:15px;padding:6px 24px;background-color:#f6eeff;border:1px solid #dec6fb;margin:5px;border-radius:4px;transition:all .3s}.markdown-body ol li:hover,.markdown-body ul li:hover{background-color:#ecdffb}.markdown-body ol li:active,.markdown-body ul li:active{background-color:#dec6fb}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{font-size:15px;padding:6px 24px;background-color:#f6eeff;box-shadow:inset 0 0 2px #dec6fb;margin:5px;border-radius:4px}.markdown-body ol li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul{margin-top:0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 AI 技术飞速渗透各行各业的今天，AI Coding 已成为提升开发效率的核心驱动力。作为安卓开发的核心工具，Android Studio 与谷歌自研大模型 Gemini 的深度融合，正将安卓开发带入全新的 AI 赋能时代。</p>
<h2 data-id="heading-0">Gemini 加持，Android Studio 变身比肩 Cursor 的 AI 编程工具</h2>
<p>当前 Android 端开发面临的工具迁移困境，难以像前端、后端那样顺利迁移到 Cursor、Winsurf 等基于 VS Code 的 AI 编程工具。安卓开发离不开 Android Studio 的专属工具链，从 Gradle 编译系统到 Logcat 日志分析，再到 Compose 的实时预览功能，这些深度贴合安卓开发场景的工具，是其他 IDE 难以替代的。而 Gemini 作为谷歌原生大模型，与 Android Studio 的集成并非简单的功能叠加，而是基于安卓生态的深度协同。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33182bf7821d4e478c126e7b5687d3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=sxp%2Ftc4dXtuwEP5rdChWdLgxx6o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>谷歌内部数据早已验证了这种协同的强大威力：通过将 AI 深度集成到开发流程，传统开发任务完成时间提效 40%，增量代码迭代效率提升近 60%，新人理解存量代码的速度提升 56%，单测编写时间压缩 53%。目前为止，谷歌 50% 的代码来自 AI 智能补全，其中 23% 来自 Android Studio。如今谷歌将这一成熟的 AI 开发方案开放给整个安卓生态，旨在通过 Android Studio + Gemini 的组合，解决移动端 AI Coding 普及滞后的痛点，让每一位安卓开发者都能享受到 AI 带来的效率革命。</p>
<h2 data-id="heading-1">全流程赋能：从设计到上线的 AI 加持</h2>
<p>Android Studio + Gemini 的核心优势在于对安卓开发全流程的深度覆盖与精准赋能。从最初的设计稿解析到最终的上线测试与问题排查，AI 能力贯穿始终，让开发过程中的每个环节都实现效率跃迁。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bbb23d77a334fe4ace2cc09a1d23ab6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=zGqPaW0xxgxFxW0VamJGXqf5do0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-2">对话式交互：打破知识壁垒</h2>
<p>Android Studio 为开发者提供了嵌入式的 AI 对话窗口，成为随时可用的 “开发顾问”。无论是询问 “如何添加相机功能” 这类通用问题，还是将原生 View 代码翻译成 Compose，亦或是通过 “@” 指定项项目文件追提问，都能通过自然语言交互快速得到答案。更强大的是其多模态交互能力 —— 上传设计稿可直接生成对应代码，上传架构图能自动搭建基础框架，甚至可以上传技术文档截图，让 AI 帮忙解读核心内容，极大降低了技术学习和需求落地的门槛。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca25719de175462eb8626b1fd197bd70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=14Ot%2FsH%2FqJ1X%2BVqMJqgnePbAmEY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>为了让对话更精准高效，系统还提供了双重提示词支持：IDE 内的 Prompt Library 可自定义常用提示词，外部的 Prompt Gallery 则提供了各领域的优质模板，而 Rules 功能能设置全局开发范式，让 AI 始终遵循项目指定的语言、框架规范，避免无效沟通。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed014982c05c438e9a058d1fb8b110ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=%2BmNyh%2F2I5DRo00hriQXQwOYNqwk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-3">编码过程：AI 成为 “得力助手”</h2>
<p>Code with Gemini 将 AI 能力深度融入编码核心环节，解决了开发者最头疼的一系列问题。代码补全功能不再局限于语法层面的简单提示，而是基于上下文逻辑的智能推演，能预判开发者的编码意图并提供完整代码片段；代码转换功能支持对存量代码进行定向优化，无论是简化冗余代码、提取公共方法，还是统一变量命名规范，都能一键完成，从根源上提升代码质量。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5101ca275aa4f2e8110a379d61411b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=oymMYhQV2baJm3x9IebNBwc%2FMeM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>针对编码中的 “细节痛点”，AI 也给出了完美解决方案：自动生成 Git Commit Message，告别 “写提交信息难” 的困扰；一键生成函数或类的文档注释，既有利于团队协作，也为后续 AI 分析提供了更好的基础。</p>
<p>对于 Compose 开发而言，Preview 代码的编写往往耗时耗力 —— 为了让 Preview 正常运行，开发者需要手动 Mock 上下文、配置参数，久而久之便会放弃编写 Preview，影响 UI 开发效率。而 Gemini 可对指定的 Composable 组件一键生成 Preview 代码，自动处理上下文依赖和参数配置，让开发者无需手动操作就能实现 UI 实时预览。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d23cb2a9a24b4e8c04d0eccc35ea2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=PYHhTCIPITZwVxRjrb%2FTql4qiTk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-4">多模态能力：打通设计与开发的鸿沟</h2>
<p>多模态是 Gemini 的核心优势之一，也为安卓开发带来了全新可能。通过上传设计稿，AI 不仅能生成对应的布局代码，还能精准识别设计中的颜色值、字体字号等细节。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17407c05a3ee4d8b8524cd090708c444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=bYf%2B1e%2By6g5eEmU5Sg5rXgdVpwU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>更值得一提的是，由于 Gemini 与安卓生态的深度协同，生成的代码并非简单的布局复刻，而是遵循安卓开发的最佳实践 —— 比如识别到导航栏设计时，会自动使用 Navigation 组件而非传统布局；识别到列表展示需求时，会优先选择 Lazy Layout 或 RecyclerView，这种 “懂设计更懂安卓开发” 的能力，是其他第三方 AI 工具难以企及的。</p>
<p>多模态能力让 “设计即代码” 成为现实：开发者只需手绘一张 UI 草稿，AI 就能快速转化为可运行的代码原型，原本需要两小时的计算器开发任务，如今几分钟就能完成基础搭建。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dc034679ec84a8d83ee6adf20b832a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=81kuhYji519wQT0J98vxyaA1pLI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在 UI 迭代阶段，开发者能在 Compose Preview 界面通过自然语言指令调整 UI，比如 “增大文字间距”“对齐组件”，Geimini 与 Compose 的深度集成让 UI 的精细化调整变得直观高效。</p>
<h2 data-id="heading-5">智能体模式：实现复杂任务的自动化</h2>
<p>Agent 智能体功能的加入，让 Android Studio + Gemini 从 “辅助工具” 升级为 “自动化助手”。与传统的单次对话不同，Agent 能理解高层次目标并拆解为具体步骤，自主完成跨文件、跨工程的复杂操作。比如让 AI “清理项目中所有硬编码字符串”，它会自动搜索全项目的硬编码内容，创建字符串资源文件，然后批量替换；要实现夜间模式，AI 能自主新增主题、修改配置，完成全项目的主题替换。</p>
<p>智能体让 AI 的活动范围跳出了对话框之外，比如项目初始化阶段，Create with AI 功能让项目搭建变得简单高效。开发者只需用自然语言描述项目需求，比如 “创建一个基于 Compose 的新闻 APP，包含首页列表、详情页、收藏功能”，AI 就会自动生成项目结构、配置依赖、搭建基础框架，甚至会创建核心页面的模板代码，让开发者无需从零开始搭建项目，快速进入功能开发阶段。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48dcb5add45a4d70b4710ea626457075~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=XJSVV8YDu6JPMr9S6sqXgBkx4HM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>而面对安卓开发者最头疼的 Gradle 版本升级问题，Agent 的表现同样出色 —— 它会自动分析项目当前的依赖关系、主流的依赖版本，结合谷歌的官方推荐，制定最优的升级方案，过程中如果遇到依赖冲突、编译失败等问题，会自主调整依赖版本、修改配置文件，直至项目成功编译通过，极大节省了开发者排查问题的时间。</p>
<p>此外，Agent 还支持添加三方 MCP Server 以本地或远程方式添加，扩充 Agent 的能力范围，比如通过 Figma MCP Server，可以实现 Figma 设计稿到代码的一键生成。而 Agent.md 文件则为团队协作提供了便利，开发者可在其中指定项目的编码规范、架构要求、命名规则等，该文件会随项目 Git 仓库一起同步，确保团队所有成员使用 Agent 时都遵循统一标准，避免因个人习惯差异导致的代码不规范问题。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa878e66850141b5b1ab94f9ad03702e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=y275jTLBM2fte%2BPKBMLIcKKp0zs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-6">质量保障：AI 守护开发全周期</h2>
<p>开发效率提升的同时，代码质量也不能掉队。Android Studio + Gemini 在质量保障环节同样表现出色：Logcat 窗口中出现错误时，点击 “Ask Gemini” 按钮，AI 会自动分析错误堆栈并提供解决方案；与 APP Quality Insights 集成后，还能同步线上 Crash 数据，帮助开发者快速定位并修复线上问题。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caef1f467426484d8cd56bdc4f470ac3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=yx1hiyM%2B%2F55Pl%2BSzEUqFKTu67sQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在测试环节，AI 的加入让测试工作更高效、更全面。对于单元测试，开发者只需选中目标类或方法，AI 就能自动生成对应的单元测试脚手架，包含测试用例设计、断言逻辑等，开发者只需补充核心业务逻辑的测试内容，就能完成单元测试编写，大幅降低了单元测试的编写成本。</p>
<p>而对于 UI 测试，传统的测试方案往往面临用例编写复杂、稳定性差、维护成本高的问题，一旦 UI 发生变动，测试用例就会失效。对此 Journeys 测试框架则带来了革命性的突破，它是一款纯 AI 驱动的测试工具，支持用自然语言编写测试用例。开发者只需基于 UI 操作描述测试步骤和预期结果，AI 就会自动解析指令，模拟用户操作流程，最后根据预期结果进行断言判断。这种 “自然语言驱动” 的测试方式，不仅降低了测试用例的编写门槛，还提升了用例的稳定性和可读性 —— 即使 UI 发生小幅变动，AI 也能通过多模态识别定位组件，避免用例失效。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/910b32f5b3a3495fa66226acd478b616~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnVuZHJvaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763317133&amp;x-signature=StcUdrUTyk1NgGYARMgNBbafdp0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>谷歌地图团队已在内部通过 Journeys 进行测试实践，极大提升了测试效率，尤其对于地图这类 UI 组件复杂的应用，效果更为显著。</p>
<h2 data-id="heading-7">结语：拥抱 AI，重塑安卓开发未来</h2>
<p>Android Studio + Gemini 的组合，不仅是工具的升级，更是安卓开发模式的革新。它通过全流程的 AI 赋能，让开发者从繁琐的重复劳动中解放出来，将更多精力投入到创意设计和核心逻辑开发中。从设计稿到代码的快速转化，从编码优化到测试自动化，AI 能力的深度融入正在重新定义安卓开发的效率边界和质量标准。</p>
<p>对于安卓开发者而言，拥抱 Android Studio + Gemini 已不是选择题，而是顺应技术趋势的必然选择。在这场 AI 驱动的开发革命中，尽早掌握这一工具组合，就能在竞争中占据先机，用技术创新打造更优质的安卓应用，共同推动安卓生态的持续发展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[动态监听DOM元素高度变化]]></title>    <link>https://juejin.cn/post/7570201730991783962</link>    <guid>https://juejin.cn/post/7570201730991783962</guid>    <pubDate>2025-11-09T15:15:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570201730991783962" data-draft-id="7569945160870264878" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="动态监听DOM元素高度变化"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T15:15:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            动态监听DOM元素高度变化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:15:48.000Z" title="Sun Nov 09 2025 15:15:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是<strong>前端架构师</strong>，关注微信公众号【<strong>程序员大卫</strong>】，免费领取精品前端资料。</p>
<h2 data-id="heading-0">背景</h2>
<p>在前端开发中，监听DOM元素的高度变化有时候是一个常见需求，尤其是在做响应式设计或需要根据内容变化调整布局时。常见的解决方案有两种，一种是使用现代浏览器支持的 <code>ResizeObserver</code>，另一种是通过兼容性更强的 iframe 技术来实现，适用于老款手机和IE浏览器。</p>
<h2 data-id="heading-1">1. ResizeObserver</h2>
<p><code>ResizeObserver</code> 是现代浏览器提供的一种监听元素尺寸变化的 API。它可以监听任意元素的大小变化，并在变化时触发回调函数，适合处理 DOM 元素高度变化的情况。</p>
<h3 data-id="heading-2">示例代码：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 选择你想要监听的 DOM 元素</span>
<span class="hljs-keyword">const</span> targetElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.target'</span>);

<span class="hljs-comment">// 创建 ResizeObserver 实例，并传入回调函数</span>
<span class="hljs-keyword">const</span> resizeObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function"><span class="hljs-params">entries</span> =&gt;</span> {
    <span class="hljs-comment">// entries 是一个包含被监听元素的数组</span>
    entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
        <span class="hljs-comment">// 获取目标元素的当前高度</span>
        <span class="hljs-keyword">const</span> height = entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'元素的当前高度:'</span>, height);
    });
});

<span class="hljs-comment">// 开始监听目标元素的尺寸变化</span>
resizeObserver.<span class="hljs-title function_">observe</span>(targetElement);
</code></pre>
<h3 data-id="heading-3">使用说明：</h3>
<ul>
<li><code>ResizeObserver</code> 会监听目标元素的大小变化，并返回一个 <code>entries</code> 数组，其中每一项代表一个被观察的元素。</li>
<li><code>entry.contentRect</code> 是一个包含元素尺寸信息的矩形对象，<code>height</code> 属性即为元素的高度。</li>
<li>这个方法对于现代浏览器（Chrome、Firefox、Safari 等）都有效，支持程度较高。</li>
</ul>
<h2 data-id="heading-4">2. Iframe</h2>
<p>对于一些老款浏览器（如 IE 浏览器）或者需要兼容更多设备的情况，我们可以采用 iframe 技术来实现动态监听容器的高度变化。通过嵌入一个隐藏的 iframe 元素，可以监听 iframe 元素的 <code>resize</code> 事件来间接判断容器的高度。</p>
<h3 data-id="heading-5">示例代码（纯 HTML 实现）：</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>动态监听DOM元素高度变化 - iframe 示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>; <span class="hljs-comment">/* 初始高度 */</span>
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
        }
        <span class="hljs-selector-class">.resize-iframe</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"resize-iframe"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"about:blank"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.container'</span>);
        <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.resize-iframe'</span>);

        <span class="hljs-comment">// 监听 iframe 的 resize 事件</span>
        iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
            <span class="hljs-comment">// 获取容器的当前高度</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'容器的当前高度:'</span>, container.<span class="hljs-property">offsetHeight</span>);
        });

        <span class="hljs-comment">// 为了演示，在容器的高度变化时触发 resize 事件</span>
        <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
            container.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span> + <span class="hljs-string">'px'</span>;  <span class="hljs-comment">// 随机调整容器高度</span>
        }, <span class="hljs-number">2000</span>);  <span class="hljs-comment">// 每2秒调整一次高度</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">使用说明：</h3>
<ul>
<li>这个方法通过将一个隐藏的 iframe 嵌套到目标容器内，利用 iframe 的 <code>resize</code> 事件来检测容器的高度变化。</li>
<li>由于 <code>iframe</code> 的 <code>resize</code> 事件会在容器的尺寸发生变化时触发，因此我们可以在事件回调中获取容器的最新高度。</li>
<li>此方法的兼容性更广，可以支持老旧浏览器，如 IE 浏览器。</li>
</ul>
<h2 data-id="heading-7">总结</h2>
<p>通过这两种方法，我们可以动态监听 DOM 元素的高度变化，选择适合的方案可以保证跨浏览器和设备的兼容性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能体颠覆教育行业调研报告：英语、编程、语文、数学学科应用分析]]></title>    <link>https://juejin.cn/post/7570197010885361710</link>    <guid>https://juejin.cn/post/7570197010885361710</guid>    <pubDate>2025-11-09T15:02:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570197010885361710" data-draft-id="7570243451724775451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能体颠覆教育行业调研报告：英语、编程、语文、数学学科应用分析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T15:02:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能体颠覆教育行业调研报告：英语、编程、语文、数学学科应用分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:02:07.000Z" title="Sun Nov 09 2025 15:02:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读35分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>教育行业正经历着自印刷术发明以来最深刻的结构性变革，其核心驱动力来自人工智能技术的突破性进展。传统教育模式长期面临的个性化不足、资源分配不均等痛点，在智能体技术的冲击下迎来系统性重构的契机。数据显示，我国初一新生数学能力标准差高达 23.7 分，这种显著的个体差异与"一刀切"的教学模式形成尖锐矛盾，导致 30% 的学生出现"消化不良"，25% 的学生产生"知识饥渴"[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>]。与之形成鲜明对比的是，智慧中心教育平台通过自适应诊断系统，能在 72 小时内完成新生数学能力的全方位评估，使用该平台个性化学习方案的学生，在有理数运算模块的掌握速度比传统教学快 40%，错误率下降 57%[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>]。这种实证数据的强烈反差，直观揭示了智能体技术对教育效率提升的革命性意义。</p>
<p><strong>核心写作原则</strong>：本报告严格遵循"真实可靠"的实证研究标准，所有数据引用均标注可验证来源，关键政策文件链接指向教育部官网公开资源，学科应用案例均来自可追溯的平台实践报告，确保研究结论建立在坚实的事实基础之上。</p>
<p>从政策维度看，智能教育已成为国家战略布局的核心领域。教育部出台《中小学人工智能通识教育指南（2025 年版）》和《中小学生成式人工智能使用指南（2025 年版）》，从顶层设计层面规范 AI 教育应用的发展方向[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7545373719712940570%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7545373719712940570/?upstream_biz=doubao" ref="nofollow noopener noreferrer">2</a>]。习近平总书记明确指出："教育数字化是我国开辟教育发展新赛道和塑造教育发展新优势的重要突破口。"《教育强国建设规划纲要（2024—2035 年）》进一步提出实施国家教育数字化战略，促进人工智能助力教育变革[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>]。这种政策支持体系为智能体技术在教育领域的深度应用提供了制度保障，推动其从实验性阶段转向嵌入核心学习基础设施[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7545373719712940570%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7545373719712940570/?upstream_biz=doubao" ref="nofollow noopener noreferrer">2</a>]。</p>
<p>产业层面呈现爆发式增长态势，中国智慧教育市场规模 2023 年已达 7200 亿元，预计 2025 年将突破 1.2 万亿元，年复合增长率达 14.5%[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>]。市场繁荣的背后是技术能力的实质性突破，2025 年 GPT-5 等高级 AI 模型的出现标志着教育领域的关键转折点，AI 驱动的学习平台已从实验性附加工具演变为能够提供个性化、情境感知辅导的复杂智能体[<a href="https://link.juejin.cn?target=https%3A%2F%2Fai2.work%2Feconomics%2Fai-market-ai-driven-learning-boosts-scores-2025%2F" target="_blank" title="https://ai2.work/economics/ai-market-ai-driven-learning-boosts-scores-2025/" ref="nofollow noopener noreferrer">5</a>]。这种技术跃迁使得"因材施教"的教育理想具备了规模化实现的可能，如睿诺思教育集团自主研发的"启慧"智慧教育平台，整合顶尖 AI 算法工程师与教育专家资源，历时两年耗资数十亿，旨在弥合地域鸿沟、消解资源壁垒[<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>]。</p>
<p>本报告将通过"技术-学科-挑战-趋势"的四维分析框架，系统解构智能体技术重塑教育行业的内在逻辑与实现路径。在技术维度，重点剖析生成式 AI、多模态交互等核心技术对教育场景的适应性改造；在学科应用层面，将分别对英语、编程、语文、数学四门核心学科的智能体解决方案进行实证分析，包括英语智能教学平台提升互动性的具体机制、数学 3D 动态模型对抽象概念理解的促进效应等[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fyuntongliangda%2Farticle%2Fdetails%2F147495222" target="_blank" title="https://blog.csdn.net/yuntongliangda/article/details/147495222" ref="nofollow noopener noreferrer">7</a>]；在挑战部分，深入探讨数据隐私、算法偏见等伦理风险；最后基于联合国教科文组织《教育 2030 行动框架》等国际视野，前瞻智能教育的未来发展方向[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0912%2F6124010042011230.shtm" target="_blank" title="https://m.book118.com/html/2025/0912/6124010042011230.shtm" ref="nofollow noopener noreferrer">8</a>]。通过这种多维度、实证化的研究路径，本报告力图全面呈现智能体技术如何重新定义教与学的本质，为教育工作者、政策制定者和技术开发者提供兼具战略高度与实践价值的决策参考。</p>
<p>全球范围内，人工智能已成为推动教育变革的核心驱动力。联合国教科文组织强调利用 AI 技术促进教育公平与质量提升，美国将"AI 与教育"列为国家重点领域，欧盟则聚焦伦理规范与风险防控[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0912%2F6124010042011230.shtm" target="_blank" title="https://m.book118.com/html/2025/0912/6124010042011230.shtm" ref="nofollow noopener noreferrer">8</a>]。在这一全球浪潮下，我国教育体系正经历从数字化到智能化的深刻转型，国家智慧教育公共服务平台注册用户数已突破 1.63 亿，浏览量达 608 亿，成为教育数字化转型的集大成者[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>]。当技术变革与政策引导形成合力，教育行业正站在历史性转折点上，智能体不仅是教学工具的革新，更将重构教育的底层逻辑与价值形态，最终实现从"教育 1.0"到"教育 4.0"的范式革命。</p>
<h2 data-id="heading-0">全球及中国智能教育市场发展现状</h2>
<p>全球智能教育市场正经历爆发式增长，形成以技术迭代与需求扩张双轮驱动的发展格局。根据 "AI in Education Global Market Report 2024" 数据，全球 AI 教育市场规模预计将从 2023 年的 39.9 亿美元增长至 2024 年的 55.7 亿美元，复合年增长率（CAGR）高达 39.7%，到 2028 年将进一步达到 211.3 亿美元[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.shurl.cc%2F90301cca26d0b6452aa62384ca72a5b0" target="_blank" title="http://www.shurl.cc/90301cca26d0b6452aa62384ca72a5b0" ref="nofollow noopener noreferrer">9</a>]。另据 Precedence Research 预测，2025 年市场规模将达到 70 - 75.7 亿美元区间，2034 年更将攀升至 1123 亿美元，长期复合年增长率维持在 36% 以上[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_53105865%2Farticle%2Fdetails%2F149060705" target="_blank" title="https://blog.csdn.net/weixin_53105865/article/details/149060705" ref="nofollow noopener noreferrer">10</a>]。这一增长态势主要得益于智能手机用户规模的持续扩张，2022 年全球智能手机订阅量已达 64.2 亿，预计 2028 年将增长至 77.4 亿，为移动教育应用提供了广阔的用户基础[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.shurl.cc%2F90301cca26d0b6452aa62384ca72a5b0" target="_blank" title="http://www.shurl.cc/90301cca26d0b6452aa62384ca72a5b0" ref="nofollow noopener noreferrer">9</a>]。
从市场结构看，企业培训领域占比超过 45%，成为全球 AI 教育市场最大的细分板块；技术部署方面，云平台凭借 59 - 72% 的市场份额主导行业技术架构[<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentiveaiq.com%2Fblog%2Fhow-big-is-the-edtech-ai-market-in-2025" target="_blank" title="https://agentiveaiq.com/blog/how-big-is-the-edtech-ai-market-in-2025" ref="nofollow noopener noreferrer">11</a>]。应用渗透层面，教育行业已成为生成式 AI 应用率最高的领域，86% 的教育机构已启用相关技术，美国学生 AI 使用率较去年提升 26 个百分点，教育工作者应用率增长 21 个百分点[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Feducation%2Fblog%2F2025%2F08%2Fai-in-education-report-insights-to-support-teaching-and-learning%2F" target="_blank" title="https://www.microsoft.com/en-us/education/blog/2025/08/ai-in-education-report-insights-to-support-teaching-and-learning/" ref="nofollow noopener noreferrer">12</a>]。
中国市场在全球格局中表现尤为突出，呈现政策引导与市场驱动协同发展的特征。规模方面，中国智慧教育市场从 2017 年的 4542 亿元增长至 2022 年的 10157 亿元，预计 2025 年将突破 9000 亿元，2030 年有望达到 1.8 万亿元，长期增速保持在 12% 左右[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fmguba.eastmoney.com%2Fmguba%2Farticle%2F0%2F1530642118" target="_blank" title="https://mguba.eastmoney.com/mguba/article/0/1530642118" ref="nofollow noopener noreferrer">13</a>]。政策层面，九部门《关于加快推进教育数字化的意见》提出 "集成化、智能化、国际化" 的 "3I" 发展理念，强调人工智能教育大模型与教学深度融合，国家智慧教育平台 2.0 智能版已上线 "AI 学习" 专栏，整合智能交互、知识图谱等技术优化教学测评与资源搜索功能[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fedu.people.com.cn%2Fn1%2F2025%2F0417%2Fc1006-40461775.html" target="_blank" title="https://edu.people.com.cn/n1/2025/0417/c1006-40461775.html" ref="nofollow noopener noreferrer">14</a>]。</p>
<p><strong>中国智能教育市场增长轨迹（2017 - 2030）</strong>
2017 年：4542 亿元 → 2022 年：10157 亿元 → 2025 年（预测）：9000 亿元 → 2030 年（预测）：1.8 万亿元，长期复合增长率约 12%[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fmguba.eastmoney.com%2Fmguba%2Farticle%2F0%2F1530642118" target="_blank" title="https://mguba.eastmoney.com/mguba/article/0/1530642118" ref="nofollow noopener noreferrer">13</a>]。</p>
<p>产业支撑体系已形成多元主体协同布局的生态格局。科大讯飞(行情002230,诊股)、鸥玛软件(行情301185,诊股)等上市公司通过技术研发构建核心竞争力，互联网巨头如阿里云课堂、腾讯教育进行全生态链布局，猿辅导、作业帮等垂直领域独角兽则聚焦差异化场景[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>]。基础设施建设方面，全国 17 个省份已建成省级教育数据中心，其中山东教育数据中心部署国家统建系统及省级业务平台 10 个，包含子系统 90 余个，为智能教育应用提供底层支撑[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>]。典型案例显示，希沃课堂智能反馈系统已覆盖全国超 1000 所学校，累计生成超 75000 份课堂分析报告，印证了技术落地的规模化效应[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seewo.com%2Farticle%2Fdetail%2F2669" target="_blank" title="https://www.seewo.com/article/detail/2669" ref="nofollow noopener noreferrer">15</a>]。</p>
<p>区域实践层面，宁夏回族自治区将省级平台与国家平台工具整合为 "大工具箱"，开发推广智慧学伴、智能助教等数字工具，成为政策落地的区域典范[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moe.gov.cn%2Fjyb_xwfb%2Fs6192%2Fs222%2Fmoe_1762%2F202503%2Ft20250331_1185653.html" target="_blank" title="https://www.moe.gov.cn/jyb_xwfb/s6192/s222/moe_1762/202503/t20250331_1185653.html" ref="nofollow noopener noreferrer">16</a>]。这种 "政策-技术-产业" 的三维驱动模式，正推动中国智能教育市场从工具应用向生态重构演进，为全球教育智能化转型提供实践样本。</p>
<h2 data-id="heading-1">智能体在学科教育中的应用分析</h2>
<h3 data-id="heading-2">英语学科：从标准化教学到个性化语言能力培养</h3>
<p>智能体技术正通过资源整合、数据驱动和互动形式三大维度重构英语教学范式。智能教学平台已实现文本、音频、视频等多元资源的系统化整合，如国家开放大学与科大讯飞合作开发的《学位英语》课程，通过知识图谱拆解200个知识点，配套141个AI虚拟人课件和844分钟虚拟资源，构建起动态更新的立体化学习资源库[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm2.people.cn%2Fnews%2Fdefault.html%3Fs%3DM18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ%3D%3D%26from%3Dsohu" target="_blank" title="http://m2.people.cn/news/default.html?s=M18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ==&amp;from=sohu" ref="nofollow noopener noreferrer">17</a>]。这种资源整合能力在基础教学场景中显现显著价值，例如通过AR语音朗读评分系统对《登鹳雀楼》等诗词的英文朗诵进行实时发音矫正，将语言学习与文化理解深度融合[<a href="https://link.juejin.cn?target=http%3A%2F%2Fxueshu.qikan.com.cn%2Fpreview%2F1%2F71%2F4669255" target="_blank" title="http://xueshu.qikan.com.cn/preview/1/71/4669255" ref="nofollow noopener noreferrer">18</a>]。</p>
<p>数据驱动的个性化学习构成智能教学的核心引擎。AI系统通过分析学习行为数据实现精准分层教学，如JBoltAI系统可根据自然拼读掌握情况动态调整练习难度，针对"th"清浊音混淆等高频错误生成专项强化训练[<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt.jxnews.com.cn%2Fnews%2F2811888%3Fapp%3Dsry" target="_blank" title="https://tt.jxnews.com.cn/news/2811888?app=sry" ref="nofollow noopener noreferrer">19</a>]；"爱种子"平台则通过语音测评快速定位发音问题，为不同水平学生推荐适配的听说任务[<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt.jxnews.com.cn%2Fnews%2F2811888%3Fapp%3Dsry" target="_blank" title="https://tt.jxnews.com.cn/news/2811888?app=sry" ref="nofollow noopener noreferrer">19</a>]。上海交通大学开发的AI数字人智能对话系统更进一步，通过微信小程序为四千余名学生提供一对一发音辅导，其自适应难度模式能匹配不同水平学习者，系统涵盖情景对话、自由交谈、朗读测评等模块，学生跟读文本后可获得即时反馈与AI打分，教师后台则能实时追踪学习进度与对话记录[<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.sjtu.edu.cn%2Fztzl_aijyzl%2F20250611%2F211580.html" target="_blank" title="https://news.sjtu.edu.cn/ztzl_aijyzl/20250611/211580.html" ref="nofollow noopener noreferrer">20</a>]。</p>
<p>互动教学形式的革新显著提升学习沉浸感与参与度。AI聊天机器人可模拟购物、节日问候等真实场景进行实时对话，通过ASR技术纠正发音偏差；在读写教学中，能围绕"Jobs and Hobbies"等主题生成分级阅读材料和思维导图式写作支架[<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt.jxnews.com.cn%2Fnews%2F2811888%3Fapp%3Dsry" target="_blank" title="https://tt.jxnews.com.cn/news/2811888?app=sry" ref="nofollow noopener noreferrer">19</a>]。跨文化交流能力培养成为新突破点，部分平台已实现国际学习者语言合作任务功能，通过跨文化讨论模块和文化背景视频资源，帮助学生理解语言使用的语境性，其讨论模块使用频次与语言得体性评分呈正相关[<a href="https://link.juejin.cn?target=http%3A%2F%2Fxueshu.qikan.com.cn%2Fpreview%2F1%2F71%2F4669255" target="_blank" title="http://xueshu.qikan.com.cn/preview/1/71/4669255" ref="nofollow noopener noreferrer">18</a>]。生成式AI工具还能激发学习者的理想二语自我想象与国际姿态，研究表明这些因素对非正式数字英语学习活动具有显著促进作用[<a href="https://link.juejin.cn?target=https%3A%2F%2Feric.ed.gov%2F%3Fq%3Dsource%253a%2522Journal%2Bof%2BEducational%2BTechnology%2522%26ff1%3DsouJournal%2Bof%2BEducational%2BTechnology%2BSystems" target="_blank" title="https://eric.ed.gov/?q=source%3a%22Journal+of+Educational+Technology%22&amp;ff1=souJournal+of+Educational+Technology+Systems" ref="nofollow noopener noreferrer">21</a>]。</p>
<p>教学实践数据印证了智能体技术的应用成效。流程优化方面，AI工具使词汇拼写、语法填空等客观题批改效率提升60%，教师备课时间缩短40%[<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt.jxnews.com.cn%2Fnews%2F2811888%3Fapp%3Dsry" target="_blank" title="https://tt.jxnews.com.cn/news/2811888?app=sry" ref="nofollow noopener noreferrer">19</a>]。实证研究显示，经过3个月AI辅助教学，实验班学生口语proficiency和交际意愿(WTC)显著高于传统班级；一学期实验后，综合成绩平均分高出8.3分，其中口语和写作模块分别提升10.5分和9.2分[<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt.jxnews.com.cn%2Fnews%2F2811888%3Fapp%3Dsry" target="_blank" title="https://tt.jxnews.com.cn/news/2811888?app=sry" ref="nofollow noopener noreferrer">19</a>]。这种"技术功能-教学场景-效果验证"的闭环体系，正在推动英语教育从标准化知识传授向个性化语言能力培养的范式转型。</p>
<p><strong>核心技术路径</strong></p>
<ul>
<li>精准分层：通过自然语言处理技术定位发音、语法薄弱点，生成个性化强化方案- 语境创设：利用虚拟场景构建真实交际环境，ASR技术实现实时语音纠错- 流程优化：AI自动批改客观题并生成错题分析，教师干预聚焦高阶能力培养</li>
</ul>
<p>智能体技术在英语教学中的深度应用，不仅体现在工具层面的效率提升，更重构了"以学习者为中心"的教育生态。从国家开放大学的知识图谱课程到上海交大的AI数字人口语教练，技术赋能正使个性化语言教育从精英特权转变为普惠资源，为培养具备跨文化沟通能力的国际化人才提供全新可能。</p>
<h3 data-id="heading-3">数学学科：从抽象概念到可视化思维培养</h3>
<h4 data-id="heading-4">传统数学教育的结构性矛盾</h4>
<p>传统数学教育"一刀切"模式面临显著的结构性矛盾，某市教育质量监测数据显示，初一新生数学能力标准差达23.7分，30%学生存在"消化不良"问题，25%学生处于"知识饥渴"状态[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>]。这种矛盾在抽象概念教学中尤为突出，如函数图像动态变化规律、立体几何空间关系等内容，长期依赖静态板书和二维图示，导致63%的学生反馈"难以将抽象概念与现实情境建立联系"[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7538723061894218283%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7538723061894218283/?upstream_biz=doubao" ref="nofollow noopener noreferrer">22</a>]。</p>
<h4 data-id="heading-5">智能体的可视化解决方案</h4>
<p>智慧中心平台构建了"实时预警-动态建模-精准干预"的闭环教学流程。以"一元一次方程"教学为例，系统通过3D模型将抽象等量关系转化为可操作的动态平衡场景，学生可拖拽虚拟砝码观察等式两边的变化关系[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>]。在立体几何教学中，AR技术让学生能"握在手中"旋转观察几何体，空间想象力培养效率提升80%；VR虚拟实验室则支持实时切割正方体操作，直观呈现三角形、六边形等不同截面的形成过程[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">23</a>]。</p>
<p>针对函数教学的痛点，智能系统设计了参数调节交互界面，学生通过滑动条改变函数参数时，图像会同步动态更新，配合切线斜率实时计算演示，使导数的几何意义从抽象定义转化为可观察的动态过程[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7538723061894218283%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7538723061894218283/?upstream_biz=doubao" ref="nofollow noopener noreferrer">22</a>]。球体体积公式推导中，3D动画模拟"球体分割为无数小圆锥体"的积累过程，让"4/3πr³"的数学表达获得具象解释[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7538723061894218283%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7538723061894218283/?upstream_biz=doubao" ref="nofollow noopener noreferrer">22</a>]。</p>
<h4 data-id="heading-6">实证效果与数据支撑</h4>
<p>基于palmyra-mini模型的对照实验显示，AI辅助教学组在8周内实现代数运算错误减少41%，几何证明错误减少37%，成绩提升幅度（13.8分）是传统教学组（5.7分）的2.4倍[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fgitblog_00429%2Farticle%2Fdetails%2F152018725" target="_blank" title="https://blog.csdn.net/gitblog_00429/article/details/152018725" ref="nofollow noopener noreferrer">24</a>]。更广泛的教学实践表明，智能导学系统使学生数学抽象能力测评得分提升23.7%，"正比例和反比例"单元测试优秀率从45%增至70%[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">23</a>]。</p>
<p><strong>核心成效数据对比</strong></p>
<ul>
<li>解题效率：相同难度试卷完成时间缩短22% [<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fgitblog_00429%2Farticle%2Fdetails%2F152018725" target="_blank" title="https://blog.csdn.net/gitblog_00429/article/details/152018725" ref="nofollow noopener noreferrer">24</a>]- 课堂参与：主动提问频次提升67%，参与度从58%增至89% [<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">23</a>]- 概念理解：63%学生反馈"AI动态实验让抽象概念变得可触摸" [<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">23</a>]- 长期提分：2025年高中数学智能辅导平均提分35-40分，函数模块提升率达42% [<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.renrendoc.com%2Fpaper%2F481467283.html" target="_blank" title="https://m.renrendoc.com/paper/481467283.html" ref="nofollow noopener noreferrer">25</a>]</li>
</ul>
<p>北京朝阳区中学的实践案例显示，智能系统通过多模态交互捕捉学生思维轨迹，对逻辑漏洞提供即时引导。其分层教学策略使基础层学生通过几何画板理解定理形成过程，应用层学生开展探究式学习，拓展层学生解决跨学科测量问题，实现个性化能力提升[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">23</a>]。这种"可视化+精准化"的教学范式，正在重塑数学教育从知识传授到思维培养的核心路径。</p>
<h3 data-id="heading-7">语文学科：从知识灌输到核心素养培育</h3>
<p>智能体在语文学科的应用正推动教学范式从知识灌输向核心素养培育转型，其价值集中体现在"教-学-评"全流程的智能化重构。在教学端，智能备课系统通过知识图谱技术实现教学内容的结构化呈现，如针对《植物妈妈有办法》开发的生字关联网络，能自动梳理"旅、洼、啪"等汉字的偏旁部首关联，并结合往届学生错题数据标注"洼"与"娃"的混淆点，使教师讲解时间压缩50%，释放更多精力开展探究式教学[<a href="https://link.juejin.cn?target=https%3A%2F%2Fggrb.ggnews.com.cn%2Fhtml%2F2025-06%2F04%2Fcontent_27338_18582335.htm" target="_blank" title="https://ggrb.ggnews.com.cn/html/2025-06/04/content_27338_18582335.htm" ref="nofollow noopener noreferrer">26</a>]。沉浸式课堂则通过多模态交互深化学习体验，在《曹冲称象》教学中，3D建模还原的称象场景允许学生拖拽虚拟石块模拟"等量替换"过程，配合AI表情识别系统（当15%以上学生分心时自动触发互动），使知识点吸收率显著提升[<a href="https://link.juejin.cn?target=https%3A%2F%2Fggrb.ggnews.com.cn%2Fhtml%2F2025-06%2F04%2Fcontent_27338_18582335.htm" target="_blank" title="https://ggrb.ggnews.com.cn/html/2025-06/04/content_27338_18582335.htm" ref="nofollow noopener noreferrer">26</a>]。</p>
<p>学习环节的智能化体现在分层教学的精准实施。基于学生错题数据构建的个性化学习图谱，能为识字薄弱学生推送"偏旁拆解游戏"，为阅读理解困难者提供"句子排序训练"[<a href="https://link.juejin.cn?target=https%3A%2F%2Fggrb.ggnews.com.cn%2Fhtml%2F2025-06%2F04%2Fcontent_27338_18582335.htm" target="_blank" title="https://ggrb.ggnews.com.cn/html/2025-06/04/content_27338_18582335.htm" ref="nofollow noopener noreferrer">26</a>]。北京师范大学开发的古诗文学习平台通过AI意境画生成技术，将《山居秋暝》诗句转化为"明月松间照，清泉石上流"的动态画面，使85%的学生反馈"更愿意主动学习古诗文"，古诗理解测试平均分提高15.7分[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。而讯飞语阅系统通过分析阅读速度、停顿位置等微观行为生成能力图谱，经一学期训练使学生阅读理解正确率从68%提升至82%，远超对照组5%的进步幅度[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。</p>
<p>评价体系的革新尤为显著。海淀区第二实验小学引入的智能作文批改系统，通过92%的错误检出率实现精准标注，如提示"此处比喻不够贴切"等具体修改建议，使学生作文修改次数平均增加2.3次，语言错误率下降42%[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。贵港地区试点数据显示，使用AI作文批改的班级在"看图写话"项目中优秀率达47%，较对照班高出28个百分点，一名原本仅能写出5句话的学生，通过系统的句式推荐和词汇拓展，三个月内可完成200字结构完整的短文[<a href="https://link.juejin.cn?target=https%3A%2F%2Fggrb.ggnews.com.cn%2Fhtml%2F2025-06%2F04%2Fcontent_27338_18582335.htm" target="_blank" title="https://ggrb.ggnews.com.cn/html/2025-06/04/content_27338_18582335.htm" ref="nofollow noopener noreferrer">26</a>]。教师角色也随之转变，AI将批改时间缩短75%后，教师得以聚焦高阶思维指导，如北京某中学"小冰诗人"系统中，学生与"AI李白"探讨"天生我材必有用"的创作心境，教师则引导学生对比虚拟对话与历史文献的差异[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。</p>
<p><strong>技术-人文平衡的实践路径</strong>：在《登鹳雀楼》等古诗文教学中，需建立"AI初评+教师复评"双轨机制。AI可检测朗读的语音标准度与情感基调，教师则深入解读"欲穷千里目"蕴含的人生哲思，避免算法对审美感知和创造性思维的误判。北京师范大学吴娟教授指出，这种模式既保留了AI的效率优势，又确保了人文教育的温度[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fqzrb.gxqzxw.com%2Fpad%2Fcontent%2F202507%2F02%2Fcontent_53308.html" target="_blank" title="https://qzrb.gxqzxw.com/pad/content/202507/02/content_53308.html" ref="nofollow noopener noreferrer">28</a>]。</p>
<p>数据驱动的教学改进需要警惕"唯数据论"倾向。某区"AI+语文"教师培训使85%的教师能独立设计分层教学任务，但同时也需认识到AI在情感体验解读上的局限性——如诗歌鉴赏中的复杂意境和作文中的独特创意，仍依赖教师的专业判断[<a href="https://link.juejin.cn?target=https%3A%2F%2Fggrb.ggnews.com.cn%2Fhtml%2F2025-06%2F04%2Fcontent_27338_18582335.htm" target="_blank" title="https://ggrb.ggnews.com.cn/html/2025-06/04/content_27338_18582335.htm" ref="nofollow noopener noreferrer">26</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fqzrb.gxqzxw.com%2Fpad%2Fcontent%2F202507%2F02%2Fcontent_53308.html" target="_blank" title="https://qzrb.gxqzxw.com/pad/content/202507/02/content_53308.html" ref="nofollow noopener noreferrer">28</a>]。未来语文教育的智能化发展，将是技术赋能与人文关怀的深度融合，最终实现从"教会知识"到"培育素养"的质变。</p>
<h3 data-id="heading-8">编程学科：从工具操作到计算思维培养</h3>
<p>编程教育正经历从技术工具操作向计算思维培养的范式转变，智能体通过“跨学科工具-思维培养-教学效率”三维框架重构教学实践。以豆包AI编程为代表的低代码平台，已在语文《望岳》互动页面生成、数学PhET风格模拟实验开发等场景中展现出跨学科融合能力，其可视化编程界面使教师无需深入掌握代码语法即可快速开发教学工具，显著降低技术门槛[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.zxxk.com%2Farticle%2F1047385.html" target="_blank" title="https://m.zxxk.com/article/1047385.html" ref="nofollow noopener noreferrer">29</a>]。例如，语文教师可借助该平台将杜甫《望岳》诗句拆解为逻辑模块，通过拖拽组件实现“会当凌绝顶”诗句的动态呈现效果，学生在调整页面背景参数（如泰山云海的透明度变化）过程中，潜移默化地理解条件判断与循环逻辑的应用。</p>
<p><strong>计算思维迁移典型案例</strong>：数学PhET模拟实验中，学生通过调整抛物线参数（a/b/c值）观察函数图像变化，这种“输入-处理-输出”的逻辑训练，可迁移至物理运动轨迹分析、化学反应速率模拟等多学科场景[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.zxxk.com%2Farticle%2F1047385.html" target="_blank" title="https://m.zxxk.com/article/1047385.html" ref="nofollow noopener noreferrer">29</a>]。教师反馈显示，尽管背景图片修改等细节仍需手动调整CSS代码，但互动功能开发效率提升达60%以上，实现“技术为思维培养服务”的核心目标。</p>
<p>智能体驱动的教学模式创新呈现多元路径。北京邮电大学“码上”平台采用32B规模的Qwen2.5-Coder模型，通过分析学生代码与流程图数据构建知识图谱，实现编程问题的精准诊断——当学生调试排序算法时，系统不直接提供标准答案，而是通过提示“尝试将冒泡法的比较条件从&gt;改为&gt;=”引导自主探索[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm2.people.cn%2Fnews%2Fdefault.html%3Fs%3DM18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ%3D%3D%26from%3Dsohu" target="_blank" title="http://m2.people.cn/news/default.html?s=M18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ==&amp;from=sohu" ref="nofollow noopener noreferrer">17</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.uestc.edu.cn%2F%3FId%3D95777%26n%3DUestcNews.Front.DocumentV2.ArticlePage" target="_blank" title="https://news.uestc.edu.cn/?Id=95777&amp;n=UestcNews.Front.DocumentV2.ArticlePage" ref="nofollow noopener noreferrer">30</a>]。无锡市春城实验小学则开创“反向学习编程”模式，学生用自然语言描述“机械狗迷宫寻路”任务，Cursor软件自动生成Python代码，教师再引导学生从代码反推“if-else条件判断”等抽象概念，这种“实践-抽象-再实践”的闭环使四年级学生独立完成率提升至78%[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jse.edu.cn%2Fstudio%2Findex.php%3Fr%3Dstudio%2Fpost%2Fview%26sid%3D204%26id%3D85705" target="_blank" title="https://www.jse.edu.cn/studio/index.php?r=studio/post/view&amp;sid=204&amp;id=85705" ref="nofollow noopener noreferrer">31</a>]。</p>
<p>产业实践与AI工具的结合正在突破课堂边界。宁夏乡村小学通过“机器人指令执行”游戏渗透算法思想，学生在模拟快递蜂巢系统编程中理解队列与栈的应用；DeepSeek-V2等国产大模型凭借优异的中文理解能力，支持校本化课程开发，如编程猫平台引入AI后，学生平均项目完成时间缩短42%[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jse.edu.cn%2Fstudio%2Findex.php%3Fr%3Dstudio%2Fpost%2Fview%26sid%3D204%26id%3D85705" target="_blank" title="https://www.jse.edu.cn/studio/index.php?r=studio/post/view&amp;sid=204&amp;id=85705" ref="nofollow noopener noreferrer">31</a>]。但需警惕技术依赖风险——潘晔教授团队构建的“教师-学生-AI协同飞轮”模式强调，AI助教应作为思维引导者而非代码生成器，通过上传专业书籍构建领域知识库，在学生提问时以“变量命名是否符合单一职责原则”等提示促进深度思考[<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.uestc.edu.cn%2F%3FId%3D95777%26n%3DUestcNews.Front.DocumentV2.ArticlePage" target="_blank" title="https://news.uestc.edu.cn/?Id=95777&amp;n=UestcNews.Front.DocumentV2.ArticlePage" ref="nofollow noopener noreferrer">30</a>]。</p>
<p>当前阶段的核心挑战在于平衡技术赋能与思维培养的关系。一方面，低代码平台需优化背景修改等高频需求的自动化程度，减少教师技术负担；另一方面，需建立“AI使用梯度”评价体系，从初期的代码生成辅助，逐步过渡到算法优化建议，最终实现计算思维的独立迁移。正如“赤壁之战”互动剧情页开发所揭示的，技术落地的价值不在于完美无缺的工具，而在于教师能否借助智能体将历史事件的因果关系转化为可交互的逻辑流程图，让学生在调整“风向参数”的决策中培养系统性思维[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.zxxk.com%2Farticle%2F1047385.html" target="_blank" title="https://m.zxxk.com/article/1047385.html" ref="nofollow noopener noreferrer">29</a>]。这种“工具服务于思维”的教育哲学，正是智能体重塑编程教育的核心要义。</p>
<h2 data-id="heading-9">智能体教育应用的技术驱动与核心能力</h2>
<p>智能体教育应用的技术架构遵循"基础技术-平台支撑-应用落地"三层逻辑体系，形成完整的技术驱动链条。在上游技术供给层，多模型协同与智能管线成为核心架构模式，整合了Whisper语音识别、GPT/BERT语义分析、EmotionNet情感识别、TextGCN篇章结构分析等AI模型，构建起覆盖教材解析、知识点抽取、多模态内容生成的全流程自动化处理能力[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fyuntongliangda%2Farticle%2Fdetails%2F147495222" target="_blank" title="https://blog.csdn.net/yuntongliangda/article/details/147495222" ref="nofollow noopener noreferrer">7</a>]。大语言模型展现出突出性能，如GPT-5融合高级推理与自适应对话记忆，Qwen2.5-Coder通过本地部署优化运行效率，讯飞星火大模型在中文语言理解与数学能力方面超越GPT-4，而基于palmyra-mini等模型开发的智能教学助手，能够依据课堂反馈与错题类型自动推送梯度匹配的学习资源[<a href="https://link.juejin.cn?target=https%3A%2F%2Fai2.work%2Feconomics%2Fai-market-ai-driven-learning-boosts-scores-2025%2F" target="_blank" title="https://ai2.work/economics/ai-market-ai-driven-learning-boosts-scores-2025/" ref="nofollow noopener noreferrer">5</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm2.people.cn%2Fnews%2Fdefault.html%3Fs%3DM18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ%3D%3D%26from%3Dsohu" target="_blank" title="http://m2.people.cn/news/default.html?s=M18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ==&amp;from=sohu" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">3</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.uestc.edu.cn%2F%3FId%3D95777%26n%3DUestcNews.Front.DocumentV2.ArticlePage" target="_blank" title="https://news.uestc.edu.cn/?Id=95777&amp;n=UestcNews.Front.DocumentV2.ArticlePage" ref="nofollow noopener noreferrer">4</a>]。轻量化模型部署技术（TinyBERT、MobileNetV3）与离线语音包的应用，有效解决了低端设备与弱网环境下的使用痛点[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fyuntongliangda%2Farticle%2Fdetails%2F147495222" target="_blank" title="https://blog.csdn.net/yuntongliangda/article/details/147495222" ref="nofollow noopener noreferrer">7</a>]。</p>
<p>平台支撑层通过知识图谱与自适应算法实现精准教学干预。智慧中心教育平台整合2000万条学习行为数据，构建数学能力雷达图等可视化工具，结合交替自回归知识追踪（AAKT）技术，利用学生先前练习数据预测学习表现，精确识别思维断点[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.gdedu123.com%2Fgd%2F686482.html" target="_blank" title="http://www.gdedu123.com/gd/686482.html" ref="nofollow noopener noreferrer">1</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Faudyxiao001%2Farticle%2Fdetails%2F147516954" target="_blank" title="https://blog.csdn.net/audyxiao001/article/details/147516954" ref="nofollow noopener noreferrer">32</a>]。"启慧"平台的AI学习伴侣"小慧"基于多模态预训练模型，融合教育知识图谱与持续学习机制，动态生成个性化学习路径图谱[<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>]。CZI知识图谱将课程标准与学习科学研究映射为机器可读格式，为教学法落地提供结构化支撑，而六维智能匹配系统（基础知识掌握度、解题速度等维度）使师资匹配准确率达82%[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.renrendoc.com%2Fpaper%2F481467283.html" target="_blank" title="https://m.renrendoc.com/paper/481467283.html" ref="nofollow noopener noreferrer">25</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fchanzuckerberg.com%2Fblog%2Fasu-gsv-2025-ai-edtech%2F" target="_blank" title="https://chanzuckerberg.com/blog/asu-gsv-2025-ai-edtech/" ref="nofollow noopener noreferrer">33</a>]。</p>
<p>应用落地层呈现多模态交互与数据驱动决策的深度融合。沉浸式教学场景通过3D建模与VR技术显著降低认知负荷，如苏州大学360智慧教室中，医学院学生借助VR眼镜观摩手术直播并进行三维动态学习[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>]。教育机器人模拟器RoblockLLy提升STEM兴趣，培养计算思维技能，而多模态生成管线实现从知识点抽取到个性化资源适配的全流程自动化[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fyuntongliangda%2Farticle%2Fdetails%2F147495222" target="_blank" title="https://blog.csdn.net/yuntongliangda/article/details/147495222" ref="nofollow noopener noreferrer">7</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Faudyxiao001%2Farticle%2Fdetails%2F147516954" target="_blank" title="https://blog.csdn.net/audyxiao001/article/details/147516954" ref="nofollow noopener noreferrer">32</a>]。数据治理方面，宁夏教育大数据中心集约化建设2700万条有效数据，"观澜"全景数据驾驶舱整合全维度学习数据，支持资源调配与课程设置决策，国家开放大学则利用知识图谱绘制学习者诊断画像，构建虚拟教师教学场景[<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moe.gov.cn%2Fjyb_xwfb%2Fs6192%2Fs222%2Fmoe_1762%2F202503%2Ft20250331_1185653.html" target="_blank" title="https://www.moe.gov.cn/jyb_xwfb/s6192/s222/moe_1762/202503/t20250331_1185653.html" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm2.people.cn%2Fnews%2Fdefault.html%3Fs%3DM18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ%3D%3D%26from%3Dsohu" target="_blank" title="http://m2.people.cn/news/default.html?s=M18zXzIxMDYzMDY0XzQwNDJfMTcxNTA1MjQyOQ==&amp;from=sohu" ref="nofollow noopener noreferrer">3</a>]。</p>
<p>教育智能体的核心突破在于技术原理与教学场景的深度耦合。超长上下文窗口支持多步骤数学题解析，语音识别与情感识别技术实现拟人化鼓励式交互，课堂数据实时采集分析系统（如希沃教学大模型）通过学情热力图辅助教师反思[<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seewo.com%2Farticle%2Fdetail%2F2669" target="_blank" title="https://www.seewo.com/article/detail/2669" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7560220927951143467%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7560220927951143467/?upstream_biz=doubao" ref="nofollow noopener noreferrer">3</a>]。这种技术赋能不仅体现在工具层面，更推动教育范式从标准化向个性化转变，如AI-Human互动自我调节学习模型所示，AI通过个性化路径规划与实时反馈提升学生自主学习能力，印证了技术与教育背景、教学法结合的必要性[<a href="https://link.juejin.cn?target=https%3A%2F%2Fchanzuckerberg.com%2Fblog%2Fasu-gsv-2025-ai-edtech%2F" target="_blank" title="https://chanzuckerberg.com/blog/asu-gsv-2025-ai-edtech/" ref="nofollow noopener noreferrer">33</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fieta.zjnu.edu.cn%2F2025%2F0617%2Fc10681a522279%2Fpage.htm" target="_blank" title="https://ieta.zjnu.edu.cn/2025/0617/c10681a522279/page.htm" ref="nofollow noopener noreferrer">34</a>]。当前产业链已形成上游技术供给（AI算法、硬件设备）、中游平台服务（SaaS系统、内容开发）、下游应用场景（K12、高等教育等）的完整生态，为智能体教育应用的规模化落地奠定基础[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.renrendoc.com%2Fpaper%2F481267468.html" target="_blank" title="https://m.renrendoc.com/paper/481267468.html" ref="nofollow noopener noreferrer">35</a>]。</p>
<p><strong>技术架构核心特征</strong>：多模型协同（Whisper+GPT/BERT+EmotionNet）、轻量化部署（TinyBERT/MobileNetV3）、知识图谱驱动（CZI标准映射/六维能力模型）、多模态交互（VR手术模拟/情感识别），形成从数据采集到个性化干预的闭环体系，支持弱网环境与隐私保护要求下的规模化应用。</p>
<h2 data-id="heading-10">智能体教育应用的挑战与伦理风险</h2>
<p>智能体教育应用在快速发展的同时，面临着技术、伦理与系统层面的多重挑战。构建"技术-人文-系统"三维分析框架，可系统解构这些复合型风险，并为制定应对策略提供理论基础。</p>
<h3 data-id="heading-11">技术层面：实施成本与能力鸿沟的双重制约</h3>
<p>技术落地面临基础设施与人力资源的双重瓶颈。智能教学平台对网络条件要求苛刻，部分农村及偏远地区学校因带宽不足难以支撑常态化应用[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>]。硬件投入外，持续维护成本构成长期负担，导致部分学校陷入"重采购、轻运维"的困境[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7545373719712940570%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7545373719712940570/?upstream_biz=doubao" ref="nofollow noopener noreferrer">2</a>]。教师数字素养缺口尤为突出，中小学教师普遍存在技术应用能力不足与教学整合障碍，尽管相关研究已构建包含情境创设、动态可视化、个性化辅导、互动增强四个模块的培训框架，但全国范围内教师AI工具伦理评估知识仍显匮乏[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gaejournal.org%2F" target="_blank" title="https://www.gaejournal.org/" ref="nofollow noopener noreferrer">36</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Feric.ed.gov%2F%3Fq%3DAi%2Bin%2Beducation%26ff1%3DsouEducation%2Band%2BInformation%2BTechnologies%26pg%3D5" target="_blank" title="https://eric.ed.gov/?q=Ai+in+education&amp;ff1=souEducation+and+Information+Technologies&amp;pg=5" ref="nofollow noopener noreferrer">37</a>]。</p>
<h3 data-id="heading-12">伦理层面：认知外包与价值离散的风险叠加</h3>
<p>生成式AI的滥用正在重塑教育生态的脆弱平衡。实证研究显示，过度依赖AI完成作业的学生独立解题能力下降17%，GPT Base等直接输出答案的模型加剧了"认知外包"现象，而GPT Tutor通过启发式引导设计可显著降低此类风险[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sohu.com%2Fa%2F858783318_120975090" target="_blank" title="https://www.sohu.com/a/858783318_120975090" ref="nofollow noopener noreferrer">38</a>]。语文等学科面临特殊挑战，AI难以准确评判情感体验与创造性思维等主观性内容，需建立"AI初评+教师复评"双轨机制保障教学质量[<a href="https://link.juejin.cn?target=https%3A%2F%2Fqzrb.gxqzxw.com%2Fpad%2Fcontent%2F202507%2F02%2Fcontent_53308.html" target="_blank" title="https://qzrb.gxqzxw.com/pad/content/202507/02/content_53308.html" ref="nofollow noopener noreferrer">28</a>]。更深层的风险在于教育主体权威消解，历史教学中AI文本生成机制可能与主流价值导向产生冲突，算法偏见或隐私泄露事件亦时有发生[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gaejournal.org%2F" target="_blank" title="https://www.gaejournal.org/" ref="nofollow noopener noreferrer">36</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fsimfero.eu%2Fknowledge-base%2Fmonthly-research-roundup-ai-in-education-june-2025%2F" target="_blank" title="https://simfero.eu/knowledge-base/monthly-research-roundup-ai-in-education-june-2025/" ref="nofollow noopener noreferrer">39</a>]。</p>
<h3 data-id="heading-13">系统层面：数字鸿沟与治理滞后的结构性矛盾</h3>
<p>教育公平在智能时代呈现新形态。城乡生均教育经费差距达1.5倍，硬件接入"硬鸿沟"加速弥合的同时，数字素养、信息筛选能力等"软鸿沟"差异持续扩大[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>]。宁夏通过《关于进一步提升乡村中小学数字化发展水平的指导意见》从"建、用、管"全流程缩小城乡差距，为全国提供了政策范本[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moe.gov.cn%2Fjyb_xwfb%2Fs6192%2Fs222%2Fmoe_1762%2F202503%2Ft20250331_1185653.html" target="_blank" title="https://www.moe.gov.cn/jyb_xwfb/s6192/s222/moe_1762/202503/t20250331_1185653.html" ref="nofollow noopener noreferrer">16</a>]。行业协同机制尚未成熟，上游技术商与下游教育机构需求错配，数据孤岛现象导致个性化服务能力不足，亟需建立跨主体的资源共享平台[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.renrendoc.com%2Fpaper%2F481267468.html" target="_blank" title="https://m.renrendoc.com/paper/481267468.html" ref="nofollow noopener noreferrer">35</a>]。</p>
<p><strong>风险警示</strong>：当前教育类App隐私合规检测通过率仅68%，人脸识别、情绪监控等技术在课堂管理中的滥用已引发隐私争议。建议建立独立数据伦理委员会，对智能教育产品实施全生命周期伦理评估[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7545373719712940570%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7545373719712940570/?upstream_biz=doubao" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">3</a>]。</p>
<p>平衡技术工具性与教育本质性成为核心命题。智能体应用必须坚持"辅助"定位，通过社交情感学习内容设计强化师生互动，在提升教学效率的同时守护教育的人文内核[<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>]。这要求教育工作者从知识传授者转型为AI协作导师，在掌握技术工具的同时保持对教育本质的深刻认知。</p>
<h3 data-id="heading-14">应对策略的三维协同路径</h3>
<p>技术层面需创新"最后一公里"解决方案，针对薄弱学校开发低带宽适配版本；伦理层面应建立算法偏见审查制度，优先采购GPT Tutor类引导式模型；系统层面可借鉴睿诺思"数字公民素养普及计划"，构建覆盖城乡的数字能力培养体系[<a href="https://link.juejin.cn?target=https%3A%2F%2Fweixin.rnsvip.com%2Findex.php%3Fa%3Dshow%26id%3D3006%26m%3DArticle" target="_blank" title="https://weixin.rnsvip.com/index.php?a=show&amp;id=3006&amp;m=Article" ref="nofollow noopener noreferrer">6</a>]。唯有技术创新、伦理规范与制度保障三管齐下，方能推动智能体教育应用健康可持续发展。</p>
<h2 data-id="heading-15">未来趋势与政策建议</h2>
<p>以“政策导向-技术演进-教育生态”为逻辑主线，结合教育部等九部门《关于加快推进教育数字化的意见》中“人工智能教育大模型与教学深度融合”的核心要求，智能体在教育领域的应用将呈现三大趋势演进。情感计算技术的突破将显著提升AI对学生认知状态的识别精度，例如在语文阅读教学中实现情感反馈的动态调整，通过多模态数据融合捕捉学习者的困惑点与情感波动[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。增强现实（AR）与虚拟现实（VR）技术将重构学科场景体验，如将《山居秋暝》等古诗文意境转化为沉浸式三维空间，使抽象的文学意象与数学几何概念可视化呈现[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。区块链技术的应用则为学习成果认证提供了可信基础设施，可构建不可篡改的编程能力成长轨迹等个性化档案，实现跨学段学习数据的安全追溯[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>][<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7527659819625382450%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7527659819625382450/?upstream_biz=doubao" ref="nofollow noopener noreferrer">27</a>]。
技术演进的深层驱动源于教育需求的变革。未来三到五年，“代理式AI”（Agentic AI）将推动超个性化学习落地，通过动态知识图谱构建（预计2026年实现千万级知识点关联）和无代码化平台（如Agentive AIQ）降低技术门槛，实现教育服务的规模化与精准化[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_53105865%2Farticle%2Fdetails%2F149060705" target="_blank" title="https://blog.csdn.net/weixin_53105865/article/details/149060705" ref="nofollow noopener noreferrer">10</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentiveaiq.com%2Fblog%2Fhow-big-is-the-edtech-ai-market-in-2025" target="_blank" title="https://agentiveaiq.com/blog/how-big-is-the-edtech-ai-market-in-2025" ref="nofollow noopener noreferrer">11</a>]。教育元宇宙的加速建设将进一步拓展学习边界，计划2028年前建成300个国家级虚拟教研室，结合具备情绪识别能力的教育机器人（2027年渗透率或达65%），构建虚实融合的新型教育生态[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">4</a>]。</p>
<p>政策建议需聚焦“技术-人才-生态”三维协同，构建与智能教育发展相适应的支撑体系。在技术层面，加快教育大模型国产化进程，推广“智海—三乐”模型等国产解决方案，推动高校-企业联合开发学科专用模型，如编程教育领域的本土化AI助教与MechDog机器人硬件结合方案[<a href="https://link.juejin.cn?target=https%3A%2F%2Fhudong.moe.gov.cn%2Fjyb_xwfb%2Fs5147%2F202504%2Ft20250417_1187747.html" target="_blank" title="https://hudong.moe.gov.cn/jyb_xwfb/s5147/202504/t20250417_1187747.html" ref="nofollow noopener noreferrer">3</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.book118.com%2Fhtml%2F2025%2F0817%2F5222214322012312.shtm" target="_blank" title="https://m.book118.com/html/2025/0817/5222214322012312.shtm" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jse.edu.cn%2Fstudio%2Findex.php%3Fr%3Dstudio%2Fpost%2Fview%26sid%3D204%26id%3D85705" target="_blank" title="https://www.jse.edu.cn/studio/index.php?r=studio/post/view&amp;sid=204&amp;id=85705" ref="nofollow noopener noreferrer">3</a>]。人才培养方面，需建立教师AI素养“测-评-训”三位一体培育机制，借鉴宁夏“三年一周期”计划经验，开展“智能备课系统实操工作坊”等场景化培训，将教育者角色转变为“AI协调者”[<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_53105865%2Farticle%2Fdetails%2F149060705" target="_blank" title="https://blog.csdn.net/weixin_53105865/article/details/149060705" ref="nofollow noopener noreferrer">10</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moe.gov.cn%2Fjyb_xwfb%2Fs6192%2Fs222%2Fmoe_1762%2F202503%2Ft20250331_1185653.html" target="_blank" title="https://www.moe.gov.cn/jyb_xwfb/s6192/s222/moe_1762/202503/t20250331_1185653.html" ref="nofollow noopener noreferrer">16</a>]。生态构建上，应完善“教育+元宇宙”虚拟实验室建设标准，落实《中小学人工智能通识教育指南（2025年版）》的分层设计要求，对经济薄弱地区提供专项经费支持，形成政府引导、学校主导、企业参与的协同治理格局[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7545373719712940570%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7545373719712940570/?upstream_biz=doubao" ref="nofollow noopener noreferrer">2</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gov.cn%2Flianbo%2Fbumen%2F202505%2Fcontent_7023810.htm" target="_blank" title="https://www.gov.cn/lianbo/bumen/202505/content_7023810.htm" ref="nofollow noopener noreferrer">40</a>]。
<strong>政策落地关键路径</strong></p>
<ul>
<li>技术协同：推动AI算法与教育场景深度融合，突破数据安全与隐私保护技术[<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.renrendoc.com%2Fpaper%2F481267468.html" target="_blank" title="https://m.renrendoc.com/paper/481267468.html" ref="nofollow noopener noreferrer">35</a>]- 数据协同：构建省市县校四级贯通的智慧教研体系，实现教学质量动态分析[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moe.gov.cn%2Fjyb_xwfb%2Fs6192%2Fs222%2Fmoe_1762%2F202503%2Ft20250331_1185653.html" target="_blank" title="https://www.moe.gov.cn/jyb_xwfb/s6192/s222/moe_1762/202503/t20250331_1185653.html" ref="nofollow noopener noreferrer">16</a>]- 主体协同：建立科学的AI教学审核机制，企业需摒弃过度营销，回归教育本质[<a href="https://link.juejin.cn?target=http%3A%2F%2Fm.toutiao.com%2Fgroup%2F7545373719712940570%2F%3Fupstream_biz%3Ddoubao" target="_blank" title="http://m.toutiao.com/group/7545373719712940570/?upstream_biz=doubao" ref="nofollow noopener noreferrer">2</a>]</li>
</ul>
<p>需特别注意的是，智能教育发展必须坚守教育公平底线。政策实施中应细化配套措施，禁止小学阶段学生独自使用开放式AI生成功能，初中阶段限定逻辑分析场景，高中阶段侧重探究性学习引导，通过分层管控确保技术应用的安全性与适切性[<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gov.cn%2Flianbo%2Fbumen%2F202505%2Fcontent_7023810.htm" target="_blank" title="https://www.gov.cn/lianbo/bumen/202505/content_7023810.htm" ref="nofollow noopener noreferrer">40</a>][<a href="https://link.juejin.cn?target=https%3A%2F%2Fm.baike.com%2Fwiki%2F%25E4%25B8%25AD%25E5%25B0%258F%25E5%25AD%25A6%25E7%2594%259F%25E6%2588%2590%25E5%25BC%258F%25E4%25BA%25BA%25E5%25B7%25A5%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%25BF%25E7%2594%25A8%25E6%258C%2587%25E5%258D%2597%25EF%25BC%25882025%25E5%25B9%25B4%25E7%2589%2588%25EF%25BC%2589%2F7503740708949246003" target="_blank" title="https://m.baike.com/wiki/%E4%B8%AD%E5%B0%8F%E5%AD%A6%E7%94%9F%E6%88%90%E5%BC%8F%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%EF%BC%882025%E5%B9%B4%E7%89%88%EF%BC%89/7503740708949246003" ref="nofollow noopener noreferrer">41</a>]。教育部将打造国家智慧教育平台2.0智能版，接入国产通用大模型，完善“AI试验场”建设，为趋势落地提供国家级基础设施支撑[<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.moe.gov.cn%2Ffbh%2Flive%2F2025%2F56808%2Fmtbd%2F202504%2Ft20250417_1187722.html" target="_blank" title="http://www.moe.gov.cn/fbh/live/2025/56808/mtbd/202504/t20250417_1187722.html" ref="nofollow noopener noreferrer">42</a>]。</p>
<p>（政策依据：教育部等九部门《关于加快推进教育数字化的意见》<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.moe.gov.cn%2Fsrcsite%2FA16%2Fs3342%2F202501%2Ft20250115_1081232.html%25EF%25BC%2589" target="_blank" title="http://www.moe.gov.cn/srcsite/A16/s3342/202501/t20250115_1081232.html%EF%BC%89" ref="nofollow noopener noreferrer">www.moe.gov.cn/srcsite/A16…</a></p>
<h2 data-id="heading-16">智能体颠覆教育的机遇与平衡之道</h2>
<p>智能体对教育的“颠覆”具有双重内涵：既是教学模式从“一刀切”到个性化的革新，如自适应AI tutors通过实时调整课程难度与节奏，使欧洲五国中学生课堂参与度提升67%；也是优质资源普惠化的推进，国家智慧教育平台通过慕课西部行计划已服务西部学生5.9亿人次，海南乡村学校“同步课堂”保障25万学生开齐课程。这种变革重塑了教育生态——云南山区小学通过“启慧”平台实现统考平均分提升30%，上海AI数字人系统获97%学生认可为课堂有效延伸，印证了技术作为“教学增强器”的价值。</p>
<p>但技术应用需坚守“工具服务于育人”底线。AI永远不能替代教师核心角色，正如语文教学中“AI初评+教师复评”机制对情感表达的把控，或数学教学中动态可视化技术需配合教师对抽象思维的引导。重庆博雅小学案例显示，智能反馈系统助力教师获市区竞赛一等奖，学生学业指标位列区域前列，证明技术赋能需以教师主导为前提。</p>
<p><strong>平衡路径三原则</strong></p>
<ul>
<li><strong>定位边界</strong>：AI承担机械性任务（如英语发音评分、数学题自动批改），教师聚焦育人本质（情感培养、价值观塑造）- <strong>协同机制</strong>：建立“政府规范+学校实践+企业研发”协同体系，如宁夏全域应用国家智慧教育平台的模式- <strong>人文锚点</strong>：通过“技术赋能+人文引领”融合，实现《中国教育现代化2035》中因材施教的规模化愿景</li>
</ul>
<p>未来教育形态将是人类智慧与AI优势的深度融合。当教师从知识传授者转型为“成长教练”，学生通过个性化路径获得学习掌控感，课堂形态向翻转式、项目式多样化发展，智能体才能真正推动教育公平与质量的双重提升，最终实现“以技术革新教育，以人文守护初心”的可持续发展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[草梅 Auth 1.11.0 发布与 GitHub 依赖安全更新 | 2025 年第 45 周草梅周报]]></title>    <link>https://juejin.cn/post/7570243451724939291</link>    <guid>https://juejin.cn/post/7570243451724939291</guid>    <pubDate>2025-11-09T15:44:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570243451724939291" data-draft-id="7570243451724922907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="草梅 Auth 1.11.0 发布与 GitHub 依赖安全更新 | 2025 年第 45 周草梅周报"/> <meta itemprop="keywords" content="GitHub,开源,AI编程"/> <meta itemprop="datePublished" content="2025-11-09T15:44:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草梅友仁"/> <meta itemprop="url" content="https://juejin.cn/user/3043088413495815"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            草梅 Auth 1.11.0 发布与 GitHub 依赖安全更新 | 2025 年第 45 周草梅周报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3043088413495815/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草梅友仁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:44:58.000Z" title="Sun Nov 09 2025 15:44:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a> 发布和更新，并在多个平台同步发布。如有更新，以博客上的版本为准。您也可以通过文末的 <code>原文链接</code> 查看最新版本。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>欢迎来到草梅周报！这是一个由草梅友仁基于 AI 整理的周报，旨在为您提供最新的博客更新、GitHub 动态、个人动态和其他周刊文章推荐等内容。</p>
<hr/>
<p>本周依旧在开发 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fcaomei-auth" target="_blank" title="https://github.com/CaoMeiYouRen/caomei-auth" ref="nofollow noopener noreferrer">草梅 Auth</a> 中。</p>
<blockquote>
<p>你也可以直接访问官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fauth.cmyr.dev%2F" target="_blank" title="https://auth.cmyr.dev/" ref="nofollow noopener noreferrer">auth.cmyr.dev/</a>
Demo 站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fauth-demo.cmyr.dev%2F" target="_blank" title="https://auth-demo.cmyr.dev/" ref="nofollow noopener noreferrer">auth-demo.cmyr.dev/</a>
文档地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fauth-docs.cmyr.dev%2F" target="_blank" title="https://auth-docs.cmyr.dev/" ref="nofollow noopener noreferrer">auth-docs.cmyr.dev/</a></p>
</blockquote>
<p>本周 草梅 Auth 发布了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fcaomei-auth%2Freleases%2Ftag%2Fv1.11.0" target="_blank" title="https://github.com/CaoMeiYouRen/caomei-auth/releases/tag/v1.11.0" ref="nofollow noopener noreferrer">1.11.0</a> 版本。</p>
<p><img src="https://oss.cmyr.dev/images/20251109225945031.png" alt="image-20251109225725739" loading="lazy"/></p>
<p>本周的主要改动是添加了 Facebook 登录支持，增加了暗色模式的切换按钮。</p>
<p>除此之外也添加了一部分测试用例，后续还会继续补充。</p>
<p>如果想了解如何部署和使用项目，可以参考文档的内容，也欢迎补充文档缺失的内容。</p>
<p>如果你对草梅 Auth 感兴趣，欢迎参与开发和测试。</p>
<hr/>
<p><img src="https://oss.cmyr.dev/images/20251109230723838.png" alt="image-20251109230723757" loading="lazy"/></p>
<p>本周处理了一些项目中存在的依赖安全漏洞，是由 Dependabot 提醒的。</p>
<p><img src="https://oss.cmyr.dev/images/20251109231011986.png" alt="image-20251109231011940" loading="lazy"/></p>
<p>虽然借助 Dependabot ，也能自动更新依赖，不过有一些间接依赖就没那么好处理，往往需要添加覆盖原有版本的依赖选项的配置，比如 pnpm 中的 <code>overrides</code>字段，就是用来指定覆盖版本的。</p>
<p>不过我也得吐槽下，GitHub 默认的这个 <code>Dependabot alerts</code> 面板实际上没那么好查看具体的漏洞信息，还得每条点开，于是我就干脆写了个 n8n 工作流，生成一份 markdown 文件，用于集中报告 Dependabot alerts 详情，为修复做指导。</p>
<p><img src="https://oss.cmyr.dev/images/20251109231323436.png" alt="image-20251109231216615" loading="lazy"/></p>
<p>当然，如果进一步优化的话，应该扔给 AI 来自动修复，这样会更节约时间一点。</p>
<h2 data-id="heading-1">GitHub Release</h2>
<h3 data-id="heading-2">rss-impact-server</h3>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Frss-impact-server%2Freleases%2Ftag%2Fv1.17.1" target="_blank" title="https://github.com/CaoMeiYouRen/rss-impact-server/releases/tag/v1.17.1" ref="nofollow noopener noreferrer">v1.17.1</a> - 2025-11-08 20:12:01</h4>
<p>摘要:</p>
<p>主要修复内容：</p>
<ul>
<li>通知功能：新增基于 isRemotePush 参数的远程推送字段条件验证，确保远程推送操作的正确性</li>
</ul>
<p>本次更新为小版本修复，主要针对通知功能中的远程推送验证逻辑进行了完善。通过添加 isRemotePush 字段的条件验证，提升了系统在远程推送场景下的稳定性和可靠性。</p>
<h3 data-id="heading-4">push-all-in-one</h3>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fpush-all-in-one%2Freleases%2Ftag%2Fv4.5.0" target="_blank" title="https://github.com/CaoMeiYouRen/push-all-in-one/releases/tag/v4.5.0" ref="nofollow noopener noreferrer">v4.5.0</a> - 2025-11-06 23:42:39</h4>
<p>摘要:</p>
<p>新增功能：</p>
<ul>
<li>添加了 push-all-in-cloud 服务推送功能</li>
</ul>
<h3 data-id="heading-6">caomei-auth</h3>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fcaomei-auth%2Freleases%2Ftag%2Fv1.11.0" target="_blank" title="https://github.com/CaoMeiYouRen/caomei-auth/releases/tag/v1.11.0" ref="nofollow noopener noreferrer">v1.11.0</a> - 2025-11-08 20:08:06</h4>
<p>摘要:
版本 1.11.0 更新摘要 (2025-11-08)</p>
<p>新功能：</p>
<ol>
<li>认证模块新增 Facebook 登录支持及相关配置</li>
<li>主题模块增加系统偏好设置的暗色模式同步功能</li>
<li>主题模块新增暗色模式支持及主题切换功能</li>
</ol>
<p>Bug 修复：</p>
<ol>
<li>样式模块优化暗色模式样式，统一媒体查询格式</li>
</ol>
<h3 data-id="heading-8">picgo-plugin-optimization</h3>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fpicgo-plugin-optimization%2Freleases%2Ftag%2Fv1.0.1" target="_blank" title="https://github.com/CaoMeiYouRen/picgo-plugin-optimization/releases/tag/v1.0.1" ref="nofollow noopener noreferrer">v1.0.1</a> - 2025-11-07 20:23:09</h4>
<p>摘要:
版本 1.0.1 (2025-11-07) 摘要：</p>
<p>主要更新内容：</p>
<p>Bug 修复：</p>
<ul>
<li>优化了 PNG 图片压缩级别的计算逻辑，修复了相关 bug</li>
</ul>
<p>本次更新主要针对 PNG 图片处理进行了优化，改进了压缩级别的计算方式，提升了插件处理 PNG 图片的性能和效果。</p>
<h2 data-id="heading-10">最新 GitHub 加星仓库</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDrewThomasson%2Febook2audiobook" target="_blank" title="https://github.com/DrewThomasson/ebook2audiobook" ref="nofollow noopener noreferrer">CaoMeiYouRen starred ebook2audiobook</a> - 2025-11-07 15:35:12
该文本介绍了一个基于 Python 的音频书籍生成工具，具有语音克隆功能并支持 1107 多种语言。项目在 GitHub 上获得了 15017 个星标，表明其受欢迎程度。核心功能包括将电子书转换为有声读物和高质量的语音克隆技术。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F666ghj%2FBettaFish" target="_blank" title="https://github.com/666ghj/BettaFish" ref="nofollow noopener noreferrer">CaoMeiYouRen starred BettaFish</a> - 2025-11-05 01:08:31
微舆是一款基于 Python 开发的多 Agent 舆情分析工具，旨在提供客观全面的舆情分析服务。该工具完全从零开发，不依赖任何现有框架，具备打破信息壁垒、还原真实舆情、预测发展趋势等功能。目前该项目已在 GitHub 上获得 23698 颗星标，显示出较高的社区关注度。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJStone2934%2FLiveGalGame" target="_blank" title="https://github.com/JStone2934/LiveGalGame" ref="nofollow noopener noreferrer">CaoMeiYouRen starred LiveGalGame</a> - 2025-11-03 18:04:26
一款基于 Kotlin 开发的创新应用，能够为与美少女的对话添加类似 GalGame 的交互体验。该应用提供选项选择和字幕显示功能，模拟视觉小说游戏中的对话系统。项目在 GitHub 上获得 1592 个星标，显示其受欢迎程度。开发者选择 Kotlin 作为主要编程语言，适合 Android 平台开发。应用旨在增强聊天互动性，为用户提供游戏化的交流体验。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzymk9%2Fyolov5_anime" target="_blank" title="https://github.com/zymk9/yolov5_anime" ref="nofollow noopener noreferrer">CaoMeiYouRen starred yolov5_anime</a> - 2025-11-03 14:17:34
基于 YOLOv5 的动漫人脸检测工具，使用 Python 开发，获得 105 星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1adrianb%2Fface-alignment" target="_blank" title="https://github.com/1adrianb/face-alignment" ref="nofollow noopener noreferrer">CaoMeiYouRen starred face-alignment</a> - 2025-11-03 14:17:33
基于 PyTorch 开发的 2D 和 3D 面部对齐库，主要使用 Python 语言编写，已获得 7415 个星标。</li>
</ul>
<h2 data-id="heading-11">其他博客或周刊推荐</h2>
<h3 data-id="heading-12">阮一峰的网络日志</h3>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2025%2F11%2Fweekly-issue-372.html" target="_blank" title="http://www.ruanyifeng.com/blog/2025/11/weekly-issue-372.html" ref="nofollow noopener noreferrer">科技爱好者周刊（第 372 期）：软件界面如何设计</a> - 2025-11-07 08:14:38</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2025%2F11%2Fminimax-m2.html" target="_blank" title="http://www.ruanyifeng.com/blog/2025/11/minimax-m2.html" ref="nofollow noopener noreferrer">大模型比拼：MiniMax M2 vs GLM 4.6 vs Claude Sonnet 4.5</a> - 2025-11-04 08:21:31</li>
</ul>
<h3 data-id="heading-13">潮流周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F244%2F" target="_blank" title="https://weekly.tw93.fun/posts/244/" ref="nofollow noopener noreferrer">第 244 期 - 飞机飞过</a> - 2025-11-10 08:00:00</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F243%2F" target="_blank" title="https://weekly.tw93.fun/posts/243/" ref="nofollow noopener noreferrer">第 243 期 - 森泊不错</a> - 2025-11-03 08:00:00</li>
</ul>
<h3 data-id="heading-14">二丫讲梵的学习周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.eryajf.net%2Fpages%2Fff912f%2F" target="_blank" title="https://wiki.eryajf.net/pages/ff912f/" ref="nofollow noopener noreferrer">学习周刊-总第 236 期-2025 年第 45 周</a> - 2025-11-06 20:41:08</li>
</ul>
<h2 data-id="heading-15">总结</h2>
<p>本周的更新和动态如上所示。感谢您的阅读！
您可以通过以下方式订阅草梅周报的更新：</p>
<ul>
<li><strong>博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a></li>
<li><strong>RSS</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Fweekly.xml" target="_blank" title="https://blog.cmyr.ltd/weekly.xml" ref="nofollow noopener noreferrer">草梅周报</a></li>
<li><strong>公众号</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Foss.cmyr.dev%2Fimages%2F20241025184516839-21n2ctv.png" target="_blank" title="https://oss.cmyr.dev/images/20241025184516839-21n2ctv.png" ref="nofollow noopener noreferrer">草梅友仁的后花园</a></li>
<li><strong>邮箱订阅</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flistmonk.cmyr.dev%2Fsubscription%2Fform" target="_blank" title="https://listmonk.cmyr.dev/subscription/form" ref="nofollow noopener noreferrer">草梅友仁的博客订阅</a></li>
</ul>
<h2 data-id="heading-16">往期回顾</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-44-caomei-weekly-rss-impact-1-17-0-docker-migration.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-44-caomei-weekly-rss-impact-1-17-0-docker-migration.html" ref="nofollow noopener noreferrer">RSS Impact 1.17.0 发布与 Docker 服务器迁移经验 | 2025 年第 44 周草梅周报</a> - 2025-11-02 19:03:26</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-43-caomei-weekly-npm-security-update-and-thousand-stars-sandbox.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-43-caomei-weekly-npm-security-update-and-thousand-stars-sandbox.html" ref="nofollow noopener noreferrer">Npm 安全更新与千星沙箱 | 2025 年第 43 周草梅周报</a> - 2025-10-26 21:10:36</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-42-caomei-weekly-caomei-auth-1-10-1-browser-auto-tool.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-42-caomei-weekly-caomei-auth-1-10-1-browser-auto-tool.html" ref="nofollow noopener noreferrer">草梅 Auth 1.10.1 发布与浏览器自动化工具 | 2025 年第 42 周草梅周报</a> - 2025-10-19 22:13:55</li>
</ul>
<p>本文作者：草梅友仁<br/>本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-45-caomei-weekly-caomei-auth-1-11-0-github-dependabot.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-45-caomei-weekly-caomei-auth-1-11-0-github-dependabot.html" ref="nofollow noopener noreferrer">blog.cmyr.ltd/archives/20…</a><br/>版权声明：本文采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-nc-sa%2F4.0%2Fdeed.zh-hans" target="_blank" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" ref="nofollow noopener noreferrer">CC BY-NC-SA 4.0 协议</a> 进行分发，转载请注明出处！<br/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[删一个却少俩：Antd Tag 多节点同时消失的原因]]></title>    <link>https://juejin.cn/post/7570268773333073947</link>    <guid>https://juejin.cn/post/7570268773333073947</guid>    <pubDate>2025-11-09T15:48:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570268773333073947" data-draft-id="7569976345931022387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="删一个却少俩：Antd Tag 多节点同时消失的原因"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-09T15:48:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="顺凡"/> <meta itemprop="url" content="https://juejin.cn/user/2788017221153015"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            删一个却少俩：Antd Tag 多节点同时消失的原因
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017221153015/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    顺凡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:48:05.000Z" title="Sun Nov 09 2025 15:48:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">删一个却少俩：Antd Tag 多节点同时消失的原因</h2>
<h3 data-id="heading-1">需求</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6998ad4d6b1f4301a10a1ef8c1705998~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=emQOPAkT5osXyRiW0qtMQWRDyb4%3D" alt="image.png" loading="lazy"/></p>
<p>一个表单的小需求，能填写多个福利，最多十个，福利名称允许重复，和<a href="https://link.juejin.cn?target=https%3A%2F%2Fant.design%2Fcomponents%2Ftag-cn%23tag-demo-control" target="_blank" title="https://ant.design/components/tag-cn#tag-demo-control" ref="nofollow noopener noreferrer">官方的动态添加和删除示例</a>交互一模一样，只是官方示例不支持 tag 内容重复，使用的 tag 内容作为 key</p>
<p>我复制丢给 AI，下掉去重，限制个数，好！满足需求了，key 值怎么办不能用重复的，拼个索引吧，最后主要代码如下，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9833951839b84b30be341ee723feb636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=5JigkuOQucTPcuKvuscwuW4hw2o%3D" alt="image.png" loading="lazy"/></p>
<p>反问一下：你觉得这会有什么问题，能达到删一个少俩的效果吗🤔？？？</p>
<h3 data-id="heading-2">问题</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/131fd1a6ec6f4b618a4e420ebbd753f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=K%2B2UqHwHygeb9LyIxNDrtFRGwLQ%3D" alt="image.png" loading="lazy"/></p>
<p>大家应该都知道用 index 作为 key，会有一些问题，对于我这个需求的影响是，点击第一个福利删除操作，实际移除的是最后一个福利的节点，我觉得在这个需求是可以接受的，在没有动画前提下也体感不到，所以我并没有改这个代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d60254120f4454b937cf40f4bb563d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=hu8JXnKGRMZbVn%2BVeAYLIzFplAA%3D" alt="image.png" loading="lazy"/></p>
<p>但是实际测试的效果的是，<strong>最后一个福利的节点没了，第一个福利节点也没了</strong>，我！！！</p>
<p>这啥情况，这不对呀，根据 <a href="https://juejin.cn/post/7118580620195790855" target="_blank" title="https://juejin.cn/post/7118580620195790855">React Diff 算法的原理</a>吧啦吧啦...他不应该是这样然后...他咋能...</p>
<h3 data-id="heading-3">原因</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffa835de756e41da95b1161fbdb2a7d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=QVsyHNzG8zGC%2FnH5CGGPLbN9fiE%3D" alt="image.png" loading="lazy"/></p>
<p>开始 debug，打开控制台 command + shif + p，搜索并进入 react-dom.development.js 文件，搜索 reconcileChildrenArray 方法，打上断点</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a22f03b2a294467a543c381fd6c6bae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=fMLv1iBKFcusiY0JUq7AmwuquI4%3D" alt="image.png" loading="lazy"/></p>
<p>React Diff 的处理也没问题呀，被标记删除的是最后一个节点，第一个节点也被正确复用了，什么情况？难道后面的代码出了问题，我就讲断点就放到了 commitRoot 方法，先看了 root.finishedWork 发现也是正确的，后面继续执行了几下，想找出问题出在哪...就突然觉的这个福利节点是不是真没被删除，但是被隐藏掉了，我就切换到了元素控制台，还真是我去！！！这为啥多了个 ant-tag-hidden 的类</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e0192406f8f4ae0afcf9ca4466e2afd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=ncezqd0OUq19R7LiiYPT6olVdRs%3D" alt="image.png" loading="lazy"/></p>
<p>看了下 Antd Tag 代码，还真有这个设计，给被移除项加 ant-tag-hidden，加上索引 key 复用导致出现“多节点同时消失”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8242539c45204d48923b6dd973956038~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG65Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763308084&amp;x-signature=4jXPc6NSdSIS%2BDAsDIcNZaGjyNI%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[云原生技术栈中的核心组件（如Kubernetes、Docker）具体是如何协同工作的？]]></title>    <link>https://juejin.cn/post/7570162686579785770</link>    <guid>https://juejin.cn/post/7570162686579785770</guid>    <pubDate>2025-11-09T14:08:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570162686579785770" data-draft-id="7569910533509529619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="云原生技术栈中的核心组件（如Kubernetes、Docker）具体是如何协同工作的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T14:08:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            云原生技术栈中的核心组件（如Kubernetes、Docker）具体是如何协同工作的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:08:20.000Z" title="Sun Nov 09 2025 14:08:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>云原生技术栈中的各个核心组件就像一个专业的团队，各司其职又紧密协同，共同支撑起庞大应用的稳定运行。要理解它们如何协同工作，关键在于把握两个核心层次：<strong>容器层（Docker）</strong> 和<strong>编排调度层（Kubernetes及其生态）</strong> 。</p>
<p>为了让你快速建立整体印象，下表清晰地展示了各核心组件在云原生体系中的角色与协同关系。</p>



































<table><thead><tr><th>组件类别</th><th>核心组件示例</th><th>核心职责</th><th>类比说明</th></tr></thead><tbody><tr><td><strong>容器运行时</strong></td><td><strong>Docker</strong></td><td>应用打包、隔离、运行，提供最小可执行单元</td><td><strong>集装箱</strong>：标准化封装应用及其所有依赖</td></tr><tr><td><strong>编排调度平台</strong></td><td><strong>Kubernetes</strong></td><td>集群管理、调度、服务发现、弹性伸缩、自愈</td><td><strong>超级调度中心</strong>：管理所有集装箱的运输、存放和维护</td></tr><tr><td><strong>网络治理层</strong></td><td><strong>Istio</strong>(服务网格)</td><td>服务间通信的精细化管理（流量路由、安全、可观测性）</td><td><strong>空中交通管制系统</strong>：精密指挥每架飞机的航线与通信</td></tr><tr><td><strong>运维支撑体系</strong></td><td><strong>Prometheus, Argo CD</strong></td><td>监控、持续交付（CI/CD）、自动化运维</td><td><strong>后勤保障系统</strong>：负责监控设备状态、自动化补给与调度</td></tr></tbody></table>
<h3 data-id="heading-0">🔄 核心协同工作流程</h3>
<p>了解了各自角色后，我们来看看它们是如何具体配合来完成一次应用部署与管理的。这个流程可以比作一个高度自动化的智能物流系统。</p>
<ol>
<li>
<p><strong>应用打包与注册（制造与登记集装箱）</strong></p>
<ul>
<li>你编写好应用代码后，使用 <strong>Dockerfile</strong>定义一个镜像的构建规则。这个过程就像是制作集装箱的图纸。</li>
<li>通过 <code>docker build</code>命令，Docker 引擎会根据 Dockerfile 将你的应用及其依赖打包成一个不可变的 <strong>Docker 镜像</strong>。这个镜像就是一个标准的“集装箱”。</li>
<li>接着，使用 <code>docker push</code>将镜像上传到镜像仓库（如 Docker Hub、Harbor）。这相当于将造好的集装箱登记到全球统一的货柜编码系统，方便后续调度中心随时取用。</li>
</ul>
</li>
<li>
<p><strong>定义期望状态与调度部署（下达运输指令与启动物流）</strong></p>
<ul>
<li>你不再需要手动到每台服务器上启动容器，而是通过编写 Kubernetes 的配置文件（如 <strong>Deployment、Service</strong>等 YAML 文件），向 Kubernetes 集群“声明”你期望的应用状态：例如，需要运行 3 个副本，并通过某个端口对外提供服务。</li>
<li>使用 <code>kubectl apply</code>命令将这份“声明”提交给 Kubernetes。Kubernetes 的 <strong>API Server</strong>接收到指令后，<strong>Scheduler</strong>组件会智能地选择集群中最合适的节点（Worker Node），并通知该节点上的 <strong>kubelet</strong>（节点代理）去执行。</li>
<li><strong>kubelet</strong>接到指令后，会从镜像仓库拉取指定的 Docker 镜像，并调用本地的 <strong>Docker 引擎</strong>或符合标准的其他容器运行时（如 containerd）来创建并启动容器。</li>
</ul>
</li>
<li>
<p><strong>运行时的持续管理与治理（物流系统的自动化运维）</strong></p>
<ul>
<li><strong>服务发现与负载均衡</strong>：Kubernetes 的 <strong>Service</strong>资源会为你的多个应用实例（Pod）提供一个稳定的访问入口，并自动将流量负载均衡到各个健康的容器实例上。</li>
<li><strong>弹性伸缩（HPA）</strong> ：当监控系统（如 Prometheus）发现应用容器的 CPU 使用率或自定义业务指标超过阈值时，Kubernetes 的 <strong>Horizontal Pod Autoscaler（HPA）</strong> 会自动增加 Pod 的副本数量，以应对流量高峰；在流量低谷时自动缩减，节约资源。</li>
<li><strong>高级流量治理（服务网格）</strong> ：对于更复杂的通信需求，例如金丝雀发布（逐步将用户流量切换到新版本）、熔断、重试等，<strong>服务网格（如 Istio）</strong> 会发挥作用。它会以 <strong>Sidecar</strong>模式在您的应用容器旁自动注入一个轻量级网络代理，接管所有进出容器的流量，实现精细化的控制，而无需修改应用代码。</li>
<li><strong>自愈与高可用</strong>：Kubernetes 持续监控集群状态。如果某个节点故障或容器异常退出，<strong>ReplicaSet</strong>控制器会立即检测到实际状态与期望状态不符，并自动在健康的节点上重新创建新的容器实例，确保应用始终可用。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">💎 总结</h3>
<p>简单来说，<strong>Docker 提供了应用的标准化包装和运行时隔离，是云原生的基石</strong>；而 <strong>Kubernetes 则在此基础上，提供了大规模、自动化、智能化的集群管理能力，是云原生的大脑和中枢神经系统</strong>。其他组件如服务网格、CI/CD工具等，则是在这个坚实基础上，为特定场景（如网络治理、自动化交付）添加的专业能力模块。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenStack在混合云架构中通常扮演什么角色？]]></title>    <link>https://juejin.cn/post/7569910533509578771</link>    <guid>https://juejin.cn/post/7569910533509578771</guid>    <pubDate>2025-11-09T14:10:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569910533509578771" data-draft-id="7570162686579802154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenStack在混合云架构中通常扮演什么角色？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T14:10:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenStack在混合云架构中通常扮演什么角色？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:10:11.000Z" title="Sun Nov 09 2025 14:10:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在混合云架构中，OpenStack最核心的角色是作为私有云部分的管理与控制中心。它像一个“总调度室”，帮助企业统一管理本地的计算、存储和网络资源，并凭借其开放的API与外部公有云（如阿里云、AWS）协同工作，共同构成一个灵活、高效且安全的混合环境。</p>
<p>下表清晰地概括了OpenStack在混合云中的核心角色及其带来的关键价值。</p>






























<table><thead><tr><th align="left">角色维度</th><th align="left">核心职责</th><th align="left">带来的关键价值</th></tr></thead><tbody><tr><td align="left">私有云的核心管理者</td><td align="left">通过计算（Nova）、存储（Cinder/Swift）、网络（Neutron）等模块，池化和调度本地数据中心的物理资源，提供与公有云体验一致的IaaS（基础设施即服务）服务。</td><td align="left">安全可控：保障企业对敏感数据和关键应用的控制力，满足合规性要求。</td></tr><tr><td align="left">混合环境的统一连接点</td><td align="left">提供标准化的API接口，与公有云（如阿里云、AWS）对接，实现跨云资源的协同管理和编排。</td><td align="left">避免供应商锁定：开放的API使企业能灵活选择不同的公有云服务商，保持议价能力和架构灵活性。</td></tr><tr><td align="left">工作负载的智能调度器</td><td align="left">根据预设策略（如成本、性能），自动将应用在私有云和公有云之间进行分发或扩展（云爆发）。</td><td align="left">成本优化与弹性：利用公有云应对流量高峰，避免私有云资源过度投资，实现按需付费。</td></tr><tr><td align="left">跨云服务的集成底座</td><td align="left">提供统一的身份认证（Keystone）、监控和运维界面，简化混合云环境的管理复杂度。</td><td align="left">运维一致性：通过统一的控制平面管理异构资源，提升运营效率，降低学习成本。</td></tr></tbody></table>
<h3 data-id="heading-0">🔄 关键实现技术</h3>
<p>要实现上述角色，OpenStack依赖几项关键技术来确保混合云的无缝集成：</p>
<p>•   跨云网络互联：通过SDN（软件定义网络）技术，如使用VPN隧道或SD-WAN专线，将私有云网络与公有云VPC（虚拟私有云）安全地连通，并优化跨云数据传输的延迟和带宽。</p>
<p>•   统一身份认证：OpenStack的Keystone模块可以与企业现有的身份系统（如LDAP/AD）集成，实现跨云环境的单点登录和统一的访问控制策略，这是安全管理的基石。</p>
<p>•   数据同步与容灾：存储组件（如Cinder）支持跨云的数据复制策略，帮助企业实现数据的异地备份和灾难恢复，以满足严格的业务连续性指标（RTO/RPO）。</p>
<h3 data-id="heading-1">🛠️ 典型应用场景</h3>
<p>OpenStack混合云的价值在以下场景中尤为突出：
•   应对突发流量：电商平台在“双11”等大促期间，将核心交易系统置于私有云，而将商品浏览、图片服务等非核心业务扩展到公有云，以保障核心业务的稳定并控制成本。</p>
<p>•   实现跨云容灾：金融机构可以在两个地域的数据中心部署OpenStack私有云，或者利用公有云作为灾备中心，当一方故障时，关键业务能快速切换，保障业务连续性。</p>
<p>•   支撑AI/科研计算：将训练数据和安全要求高的模型开发放在私有云，在需要大规模并行计算进行模型训练或推理时，弹性使用公有云的GPU资源，实现高效计算。</p>
<h3 data-id="heading-2">💎 核心价值总结</h3>
<p>总而言之，OpenStack赋予企业在混合云架构中的主导权和控制力。它让企业能够构建一个以自身业务需求为核心、灵活调配、安全且经济高效的IT基础架构，是数字化转型过程中的关键引擎。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每日一个计算机小知识：ICMP]]></title>    <link>https://juejin.cn/post/7569959427879600138</link>    <guid>https://juejin.cn/post/7569959427879600138</guid>    <pubDate>2025-11-09T14:10:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569959427879600138" data-draft-id="7569976345931251763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每日一个计算机小知识：ICMP"/> <meta itemprop="keywords" content="后端,网络协议"/> <meta itemprop="datePublished" content="2025-11-09T14:10:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="人人都是码农"/> <meta itemprop="url" content="https://juejin.cn/user/2365804754776718"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每日一个计算机小知识：ICMP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804754776718/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    人人都是码农
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:10:20.000Z" title="Sun Nov 09 2025 14:10:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每日分享一个有趣的计算机小知识，今日话题：<strong>ICMP</strong></p>
<p>ICMP是Internet Control Message Protocol 的缩写，互联网控制消息协议 。它是TCP/IP协议族的一个子协议，用于在IP主机和路由器之间传递差错报告、网络拥塞控制和诊断信息。</p>
<p>1981年4月，美国人乔恩·波斯特尔Jon Postel（互联网发展初期的关键人物之一，编写了大量的RFC文档，在互联网协议的制定和标准化方面发挥了至关重要的作用），编写了ICMP的第一个标准草案RFC 777，初步提出了ICMP的基本概念和功能框架。同年9月，由Jon Postel编写的RFC 792正式发布，对ICMP协议的基本框架进行了定义，确立了其作为TCP/IP协议族中网络层控制协议的地位。</p>
<p>1983年，美国人迈克尔·穆伊斯Mike Muuss开发了基于ICMP协议的网络诊断工具Ping，用于测试网络连接和测量网络延迟。我们在开发中经常会用Ping命令来检查网络通不通（Linux和Windows中均支持），这个Ping的过程实际上就是ICMP协议的工作过程（除了Ping还有跟踪路由的Tracert命令也是基于ICMP协议的）。</p>
<p>Ping命令的核心原理就是利用ICMP协议的Echo Request（请求）和Echo Reply（应答）报文，通过“发送请求-接收应答”的简单交互，测试两台主机间的网络连通性、延迟和丢包率。其执行过程可分为如下6步：</p>
<p><strong>1. 输入ping命令</strong></p>
<p>用户在终端输入ping 目的设备的IP地址，操作系统接触发ICMP协议模块工作。</p>
<p><strong>2. 构造Echo Request报文</strong></p>
<p>ICMP模块生成Echo Request报文，报文中会包含两个关键字段：请求标识符和序列号。</p>
<p><strong>3. 封装成IP数据包</strong></p>
<p>ICMP请求报文本身无法直接传输，需被封装到IP数据包中。IP数据包的源IP设为当前用户的IP，目标IP设为目的设备的IP，且会将IP首部的协议字段设为1（表示该IP包承载的是ICMP协议数据）。</p>
<p><strong>4. 网络层转发</strong></p>
<p>发送Echo Request报文的数量可以设置，缺省时默认发送5个，封装好的IP数据包通过网关（如家用路由器）进入网络，路由器根据目标IP查询路由表，逐层转发数据包，最终送达目的设备。</p>
<p><strong>5. 回复Echo Reply报文</strong></p>
<p>目的设备的IP层收到数据包后，根据协议字段为1识别为ICMP协议，ICMP模块根据Echo Request请求生成对应的Echo Reply应答报文，再将应答报文封装成IP数据包，按原路径反向回复给用户。</p>
<p><strong>6. 用户端接收应答</strong></p>
<p>用户电脑收到Echo Reply数据包后交给ICMP模块，计算请求发送到应答接收的时间（即延迟），同时统计成功收到的应答数与发送的请求数，得出丢包率，然后终端会显示每一次请求的延迟、TTL（生存时间）等信息。如果网络不通（如路由故障、目的设备禁用ICMP等）用户电脑会超时未收到应答，终端就会显示Request timed out请求超时。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5eeb482ae064769b810a769967618a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq65Lq66YO95piv56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763302219&amp;x-signature=7NVu1ot68R8oUNUkdChvtQKDV04%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ICMP属于网络层协议，是同属网络层的IP协议的重要辅助协议，它有自己独立的协议规范和功能，只是借助IP协议的传输能力来实现自身功能（ICMP报文需要封装在IP数据报中传输），其协议逻辑和功能实现是独立的。它和传输层的UDP协议一样是无连接协议，无确认和重传机制，所以是不可靠的，不过ICMP并不用于传输数据。</p>
<p>IP协议的核心作用是在不同网络之间路由数据包，实现端到端的数据包传输，但是IP协议并不提供可靠传输，如果IP数据包因目标不可达、超时等原因丢失，IP协议并不能通知源主机是否丢包以及丢包的原因，也无法探测网络连通性、无法调节网络拥塞、无法引导路由优化…这些问题就需要ICMP协议来解决。</p>
<p>形象点比喻：IP是负责送货的快递员，只负责把包裹送出去，ICMP则是客服+导航，负责通知送货结果（丢件/送不到）、确认收货方是否在家，以及指引更优送货路线。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每日一个计算机小知识：IGMP]]></title>    <link>https://juejin.cn/post/7570243451724660763</link>    <guid>https://juejin.cn/post/7570243451724660763</guid>    <pubDate>2025-11-09T14:16:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570243451724660763" data-draft-id="7569959427879616522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每日一个计算机小知识：IGMP"/> <meta itemprop="keywords" content="后端,网络协议"/> <meta itemprop="datePublished" content="2025-11-09T14:16:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="人人都是码农"/> <meta itemprop="url" content="https://juejin.cn/user/2365804754776718"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每日一个计算机小知识：IGMP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804754776718/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    人人都是码农
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:16:57.000Z" title="Sun Nov 09 2025 14:16:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每日分享一个有趣的计算机小知识，今日话题：IGMP</p>
<p>IGMP是Internet Group Management Protocol的缩写，互联网组管理协议，它是TCP/IP协议族中负责IP组播成员管理的一个子协议。和<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIxNjg0MDA4NQ%3D%3D%26mid%3D2247484637%26idx%3D1%26sn%3D99077ef42514625cb994c68aaac14e2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzIxNjg0MDA4NQ==&amp;mid=2247484637&amp;idx=1&amp;sn=99077ef42514625cb994c68aaac14e2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ICMP协议</a>一样都是基于IP的网络协议，且都运行在OSI模型的网络层，它有如下3个版本：</p>
<h4 data-id="heading-0">IGMPv1</h4>
<p>1989年，RFC 1112第一次详细定义了IGMP协议规范，提供了基本的查询和响应机制，主机能够通知路由器加入多播组，但缺乏对主机离开多播组的通知机制。</p>
<h4 data-id="heading-1">IGMPv2</h4>
<p>1997年，IGMP版本2规范发布RFC 2236，增加了主机离开组的通知机制，减少了不必要的成员报告消息，并改进了路由器的查询机制，使得多播管理更加灵活和高效。</p>
<h4 data-id="heading-2">IGMPv3</h4>
<p>2002年，IGMP版本3规范发布RFC 3376，支持源特定组播（SSM，Source-Specific Multicast），允许主机指定要接收或屏蔽的源IP，进一步提高了多播通信的灵活性和安全性。</p>
<p>ICMP主要用于局域网（LAN）中，主要功能就是让主机能够向本地路由器报告它们希望接收的多播流，从而实现数据的高效传输，优化带宽使用。</p>
<p>对于多播不理解的，我们可以先来看下常见的网络数据传输方式：</p>
<h4 data-id="heading-3">1. 单播 Unicast</h4>
<p>一对一传输，一个发送方只能将数据传递给一个指定的接收方。若有多个接收方，发送方需重复发送相同数据，接收方越多，发送端压力越大，适用于个人化、点对点的交互场景，比如浏览网页、微信聊天、下载文件、在线购物下单等。</p>
<h4 data-id="heading-4">2. 广播 Broadcast</h4>
<p>一对所有传输，发送方只需发送一份数据，数据会自动扩散到当前网段内的所有设备，所有设备强制接收。多用于局域网内的通用通知或查询，比如ARP协议地址解析、路由器DHCP自动分配IP地址等。</p>
<h4 data-id="heading-5">3. 组播/多播 Multicast</h4>
<p>一对多传输，仅支持特定网络内传输，发送方仅发送1份数据，数据会精准传输给所有“主动加入组播组”的接收方，未加入的设备则收不到。不管有多少个接收方，发送方始终只需发送1份数据，带宽利用率高。适用于多用户获取相同内容的场景，比如IPTV直播、企业视频会议、股市实时行情推送、在线课堂等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8089bf0200e41d8b8be95cdf6b75488~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq65Lq66YO95piv56CB5Yac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763302617&amp;x-signature=xo2UQE%2Fq9W65DcnA9ReooBU2O74%3D" alt="图片" loading="lazy"/></p>
<p>IGMP协议需将报文封装在IP数据包中传输（IP协议版本号为2），主要分为查询报文和报告报文2类：</p>
<h4 data-id="heading-6">查询报文 Query</h4>
<p>由组播路由器发送，用于询问网段内是否有设备加入特定组播组，如：通用查询General Query（用于询问所有设备加入了哪些组）、特定组查询Group-Specific Query（指定某一组播组，询问还有没有设备在接收当前组的数据流）、特定源特定组查询报文Group-Source-Specific Query（针对某一个组播组+某几个特定源IP，向终端询问是否还需要从这些源接收这个组播组的数据，仅IGMPv3支持）。</p>
<h4 data-id="heading-7">报告报文 Report</h4>
<p>由终端主机发送，用于上报主机自己的组播成员身份，如：成员报告报文Membership Report（终端主动告知路由器加入或继续订阅某个组播组）、离开组报文Leave Group（仅IGMPv2/3支持，终端主动告知路由器不再需要某组播组的数据）。</p>
<p>在没有IGMP时，要1对多传输只能将多播流量发送到整个网络，浪费带宽资源。而通过IGMP协议，路由器只会向需要接收多播流量的主机转发数据，从而显著提升网络效率，减少不必要的带宽占用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何统一前端项目的 Node 版本和包管理器？]]></title>    <link>https://juejin.cn/post/7570243451724693531</link>    <guid>https://juejin.cn/post/7570243451724693531</guid>    <pubDate>2025-11-09T14:20:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570243451724693531" data-draft-id="7570201730991669274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何统一前端项目的 Node 版本和包管理器？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-09T14:20:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何统一前端项目的 Node 版本和包管理器？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:20:37.000Z" title="Sun Nov 09 2025 14:20:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是<strong>前端架构师</strong>，关注微信公众号【<strong>程序员大卫</strong>】：</p>
<ul>
<li>回复 <strong>[面试]</strong> ：免费领取“前端面试大全2025(Vue,React等)”</li>
<li>回复 <strong>[架构师]</strong> ：免费领取“前端精品架构师资料”</li>
<li>回复 <strong>[书]</strong> ：免费领取“前端精品电子书”</li>
<li>回复 <strong>[软件]</strong> ：免费领取“Window和Mac精品安装软件”</li>
</ul>
<p>在使用 <code>pnpm</code> 时，可以通过 <code>.npmrc</code> 或 <code>engines</code> 字段来锁定 Node.js 的版本。下面是几种常见的方法：</p>
<h3 data-id="heading-0">1. 使用 <code>.npmrc</code> 文件锁定 Node 版本</h3>
<p>你可以在项目根目录下的 <code>.npmrc</code> 文件中指定 Node.js 的版本：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">engine-strict</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>这将强制在安装依赖时遵守 <code>package.json</code> 中的 <code>engines</code> 配置。</p>
<h3 data-id="heading-1">2. 使用 <code>engines</code> 字段</h3>
<p>在你的 <code>package.json</code> 中，可以通过 <code>engines</code> 字段来锁定 Node.js 的版本范围。例如：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"engines"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&gt;=16.0.0 &lt;18.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样，<code>pnpm</code> 会检查当前 Node.js 版本是否符合这个范围。如果不符合，会报错提示。</p>
<h3 data-id="heading-2">3. 使用 <code>pnpm env use</code> 来指定 Node 版本</h3>
<p>如果你希望在项目中使用特定版本的 Node.js，可以通过 <code>pnpm env use</code> 命令指定 Node 版本。例如：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">env</span> use --global 16
</code></pre>
<p>这样会全局使用 Node.js 16.x 版本。</p>
<p>你也可以使用 <code>pnpm env use &lt;version&gt;</code> 来安装并切换到你指定的 Node.js 版本。</p>
<h3 data-id="heading-3">4. 使用 <code>volta</code> 或 <code>nvm</code> 等工具（外部工具）</h3>
<p>虽然 <code>pnpm</code> 本身没有直接提供锁定 Node.js 版本的机制，但你可以通过工具如 <code>volta</code> 或 <code>nvm</code> 来管理 Node.js 版本，并确保每次切换到项目目录时，自动使用指定的 Node 版本。</p>
<h4 data-id="heading-4">使用 <code>volta</code>:</h4>
<p>安装并使用 <code>volta</code> 可以自动化这个过程，确保在项目中使用的 Node.js 版本与指定的版本一致。首先，你需要安装 Volta：</p>
<pre><code class="hljs language-bash" lang="bash">curl https://get.volta.sh | bash
</code></pre>
<p>然后，你可以使用 <code>volta pin</code> 来锁定 Node 版本：</p>
<pre><code class="hljs language-bash" lang="bash">volta pin node@16
</code></pre>
<p>这样，<code>volta</code> 会在项目中使用 Node.js 16.x 版本。</p>
<h3 data-id="heading-5">总结</h3>
<ul>
<li><code>.npmrc</code> 中设置 <code>engine-strict</code> 可确保安装时遵守 <code>engines</code> 设置。</li>
<li><code>package.json</code> 中的 <code>engines</code> 字段可以指定 Node.js 版本范围。</li>
<li><code>pnpm env use</code> 用于切换和锁定 Node.js 版本。</li>
<li>使用外部工具如 <code>volta</code> 或 <code>nvm</code> 管理 Node 版本也是常见的做法。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[进入职场第二课—融入]]></title>    <link>https://juejin.cn/post/7570213477950177332</link>    <guid>https://juejin.cn/post/7570213477950177332</guid>    <pubDate>2025-11-09T14:47:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570213477950177332" data-draft-id="7570260758060744739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="进入职场第二课—融入"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-09T14:47:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="老李说技术"/> <meta itemprop="url" content="https://juejin.cn/user/624178336632407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            进入职场第二课—融入
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624178336632407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    老李说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:47:13.000Z" title="Sun Nov 09 2025 14:47:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>经过观察后要做的第二件事一定是融入，大白话来说，就是经过观察，结论是想要留下来，接下来要顺利融入，适应这家公司、这个团队，安全度过新手期。融入和观察一样，都属于入职后的第一阶段，从完全陌生到逐渐熟悉。《易经》乾卦中的“潜龙勿用”，其实说的就是这两件事相加——观察是完全接收输入之后判断，而融入则是在观察的基础上，开始主动输出。</p>
<p>经过新手期的观察，你已经对业务，团队，成员，以及现状，有了充分的认识，那么融入，就是需要我们根据这些信息，走的更顺，更稳。</p>
<p>通过以下 4 个关键动作，快速完成从“局外人”到“团队一份子”的蜕变。</p>
<h3 data-id="heading-0">一、顺着领导的脾气干：先成为他“预期中”的靠谱下属</h3>
<p>你的直属领导，也就是你的老板，是你想要融入这个团队必须搞定的人。他不认可你，不看好你，可能连试用期都过不了，更别提融入这个团队了。</p>
<p>观察出来领导的脾气，顺着这个脾气干，就是你获得领导认可的关键。看看他喜欢的下属是怎么工作的，他们之间又是怎么配合的，很快你就会有答案，照着学，千万别犹豫。</p>
<p>我的前领导曾说：“我不要求你一开始多厉害，但得让我看到你在‘努力契合’——这种态度比能力更重要。” 比如他爱早会同步进度，就别总等周报才汇报；他重视数据支撑，汇报时就多带具体案例和结果；他习惯简洁沟通，就别用长篇大论消耗他的时间。</p>
<h3 data-id="heading-1">​二、和关键同事建立信任：他们是你的“隐形导师”​</h3>
<p>无论你是职场老鸟，还是应届新人，入职之后，你的老板都会给你制定试用期计划。这个计划涉及的工作内容，你可能有经验，也可能什么都不懂——除非你的上一家公司是现在这家公司的竞争对手，业务做的够大、够接近，否则你都得有一个学习上手的过程。</p>
<p>这个过程一般包含两件事：看代码、看资料、学业务，问老人。这个“老人”指的是懂业务的同时，也是对你来说的关键同事——是你不能得罪，必须要建立信任的人。因为他告诉你多一点，你就会少走很多弯路，避开很多雷区；他告诉你少一点，你就惨了，自己费很大的劲不说，还会踩很多值钱的坑。</p>
<p>请他吃个饭拜拜码头，时不时买杯咖啡——伸手不打笑脸人。不需要刻意讨好，真诚 + 分寸感就够了：一句“前辈，这个问题我实在搞不懂，能耽误您 10 分钟吗？”配上认真记笔记的态度，事后反馈“按您说的做，果然少走了弯路”，就能快速拉近距离。</p>
<h3 data-id="heading-2">三、完成本职工作：“好”永远比“快”重要</h3>
<p>所有老板都希望你做的又快又好，但这句话还有后半句：如果让老板在快和好里面只能选一个，所有老板都会选好，而不会选快。快一定是建立在好的基础上，如果做不好，达不到要求，交付之后频频出问题，天天被客户投诉，没有一个老板想要这样的结果。他们宁愿你慢慢做，做好了再交付。</p>
<p>对你来说，本职工作一定要做好，试用期计划里的内容也一定要实现。切记，是完成本职工作，而不是快速的完成。这个阶段快没有任何好处——职场想发展的好，走得稳，走得远，这一点必须学会。比谁做题做得快，比谁背课文背得快，比谁回答问题反应快，这都是还在上小学、初中的学生在比的东西，职场里没人关注这个。</p>
<h3 data-id="heading-3">四、适应公司的已有气场：先“入乡随俗”，再谈改变*</h3>
<p>每个公司都有自己的气场，作为新人，你只能收起自己的锋芒。原因很简单，你还没有做出任何成绩。平时加不加班，考勤严不严格，流程繁不繁琐，氛围活不活跃，搞清楚这些之后，加入他们，照着做，千万别特立独行。</p>
<p>公司开会多，你就跟着开，听听大家都是什么套路；说事情总是发邮件，不直接说，你也跟着发，措辞照着写的好的学；办公区随处可见口号横幅、价值观标语，其他员工什么态度，你也什么态度；如果公司组织学习价值观的话，你就好好认真听。</p>
<h2 data-id="heading-4">写在最后：潜龙勿用，是为了更好地“见龙在田”</h2>
<p>其实融入并不难，把上面这 4 个动作做个七七八八，大概率都不会有啥问题。融入之后，恭喜你，你也就顺利度过了新手期。</p>
<p>再提醒一下，“潜龙勿用”就是龙还潜在水下，还不到你施展才华的时候。别露头，攒着劲，别着急，找出新公司的规律，按这个规律办事，就是顺势而为。</p>
<p>记住：观察是“找出规律”，融入是“学会按规律办事”——二者叠加，就是《易经》里“潜龙勿用”的完整含义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯CSS&JS实现：丝滑渐变过渡的动态导航栏]]></title>    <link>https://juejin.cn/post/7570243451724726299</link>    <guid>https://juejin.cn/post/7570243451724726299</guid>    <pubDate>2025-11-09T14:48:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570243451724726299" data-draft-id="7570243451724627995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯CSS&amp;JS实现：丝滑渐变过渡的动态导航栏"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-09T14:48:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一诺滚雪球"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯CSS&amp;JS实现：丝滑渐变过渡的动态导航栏
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一诺滚雪球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T14:48:18.000Z" title="Sun Nov 09 2025 14:48:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在前端开发中，通常实现的导航栏切换时没有添加交互效果，今天就从0到1实现一个美观且交互流畅的导航栏。</p>
<p>直接看效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a14905729de471599df7f5cef3f90f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763305123&amp;x-signature=aG9JfTgsywgDAG88p4Gn%2FZcVgB4%3D" alt="tab-ezgif.com-video-to-gif-converter.gif" loading="lazy"/></p>
<h2 data-id="heading-1">1.导航栏实现思路</h2>
<p>实现的导航栏需要具备<strong>丝滑过渡动画</strong>，切换选项时，指示器通过自定义贝塞尔曲线（cubic-bezier(0.68, -0.55, 0.265, 1.55)）实现灵动过渡效果。</p>
<h2 data-id="heading-2">2. 案例代码</h2>
<p>下面逐部分拆解代码，带你理解每个模块的作用。</p>
<h3 data-id="heading-3">2.1 模板结构</h3>
<p>代码如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-container"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 渐变指示器：核心动画元素 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"indicatorStyle"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 导航容器：包裹所有导航项 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 循环渲染导航项 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(tab, index) in tabs"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span> 
        <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span> 
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: activeTab === index }"</span>
        @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTab(index)"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ tab.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<ul>
<li><strong>层级关系</strong>：nav-container 作为最外层容器，内部包含 indicator（指示器）和 nav（导航项容器），通过 z-index 控制层级（指示器 z=0，导航项 z=2）</li>
<li><strong>激活状态</strong>：通过 :class="{ active: activeTab === index }" 控制选中项的文字颜色（白色）</li>
</ul>
<h3 data-id="heading-4">2.2 逻辑处理</h3>
<p>主要控制交互与动画效果。</p>
<p>代码如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 1. 导航数据：可根据需求扩展（如添加路由地址、图标等）</span>
<span class="hljs-keyword">const</span> tabs = [
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">0</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'分类'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'购物车'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">'我的'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> }
]
<span class="hljs-comment">// 2. 选中项状态：用 ref 定义响应式变量</span>
<span class="hljs-keyword">const</span> activeTab = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">// 3. 指示器样式计算：用 computed 实时更新位置和宽度</span>
<span class="hljs-keyword">const</span> indicatorStyle = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-comment">// 左偏移量：选中项索引 * (100% / 导航项数量)</span>
  <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${activeTab.value * (<span class="hljs-number">100</span> / tabs.length)}</span>%`</span>,
  <span class="hljs-comment">// 宽度：均分导航栏（100% / 导航项数量）</span>
  <span class="hljs-attr">width</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-number">100</span> / tabs.length}</span>%`</span>
}))
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2.3 实现视觉与动画</h3>
<p>核心代码如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 渐变指示器：核心视觉元素 */</span>
<span class="hljs-selector-class">.indicator</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#4facfe</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#00f2fe</span> <span class="hljs-number">100%</span>); <span class="hljs-comment">/* 蓝青渐变 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">35px</span>; <span class="hljs-comment">/* 与容器圆角一致：避免棱角 */</span>
  <span class="hljs-comment">/* 自定义过渡曲线：让动画更灵动（非匀速） */</span>
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.68</span>, -<span class="hljs-number">0.55</span>, <span class="hljs-number">0.265</span>, <span class="hljs-number">1.55</span>);
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 指示器在最下层 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">3. 导航栏优化</h2>
<p>基础版本已实现核心功能，下面分享几个实用的优化方向，满足更多场景需求。</p>
<h3 data-id="heading-7">3.1 添加 hover 效果：增强交互反馈</h3>
<p>在 .nav-item 中添加 hover 样式，让未选中项也有交互反馈：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.nav-item</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-class">.active</span>) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4facfe</span>; <span class="hljs-comment">/* hover 时文字变浅蓝 */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>); <span class="hljs-comment">/* 轻微放大：增强感知 */</span>
}
</code></pre>
<h3 data-id="heading-8">3.2 支持路由跳转：适配单页应用</h3>
<ol>
<li>先引入 Vue Router：</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
</code></pre>
<p>2.  在 tabs 数组中添加路由地址：</p>

<pre><code class="hljs language-lua" lang="lua">const tabs = [
  { label: <span class="hljs-string">'首页'</span>, value: <span class="hljs-number">1</span>, <span class="hljs-built_in">path</span>: <span class="hljs-string">'/'</span> },
  { label: <span class="hljs-string">'分类'</span>, value: <span class="hljs-number">2</span>, <span class="hljs-built_in">path</span>: <span class="hljs-string">'/category'</span> },
  { label: <span class="hljs-string">'购物车'</span>, value: <span class="hljs-number">3</span>, <span class="hljs-built_in">path</span>: <span class="hljs-string">'/cart'</span> },
  { label: <span class="hljs-string">'我的'</span>, value: <span class="hljs-number">4</span>, <span class="hljs-built_in">path</span>: <span class="hljs-string">'/mine'</span> }
]
</code></pre>
<p>3.  修改 changeTab 方法，实现路由跳转：</p>

<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">changeTab</span> = (index) =&gt; {
  <span class="hljs-attr">activeTab.value</span> = index
  router.push({ path: tabs<span class="hljs-section">[index]</span>.path })
}
</code></pre>
<h3 data-id="heading-9">3.3 自定义指示器样式</h3>
<p>代码中注释了 “下划线样式” 的指示器，若不需要渐变背景，可替换为：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.indicator</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: auto;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 下划线靠底部 */</span>
  <span class="hljs-attribute">height</span>: auto;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#4facfe</span>; <span class="hljs-comment">/* 下划线颜色 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 取消圆角 */</span>
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease; <span class="hljs-comment">/* 简化过渡曲线 */</span>
}
</code></pre>
<h3 data-id="heading-10">3.4 支持触摸滑动</h3>
<p>若需要在移动端支持 “触摸滑动切换”，可结合 touchstart 和 touchend 事件，计算滑动距离来判断是否切换导航项，核心逻辑如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 记录触摸起始位置</span>
<span class="hljs-keyword">const</span> startX = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">// 触摸开始</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTouchStart</span> = (<span class="hljs-params">e</span>) =&gt; {
  startX.<span class="hljs-property">value</span> = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>
}
<span class="hljs-comment">// 触摸结束</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTouchEnd</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-keyword">const</span> endX = e.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>
  <span class="hljs-keyword">const</span> diffX = endX - startX.<span class="hljs-property">value</span>
  
  <span class="hljs-comment">// 滑动距离超过 50px 才切换（避免误触）</span>
  <span class="hljs-keyword">if</span> (diffX &gt; <span class="hljs-number">50</span> &amp;&amp; activeTab.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>) {
    activeTab.<span class="hljs-property">value</span>--
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (diffX &lt; -<span class="hljs-number">50</span> &amp;&amp; activeTab.<span class="hljs-property">value</span> &lt; tabs.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
    activeTab.<span class="hljs-property">value</span>++
  }
}
<span class="hljs-comment">// 在模板中添加触摸事件</span>
&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"nav"</span> <span class="hljs-meta">@touchstart</span>=<span class="hljs-string">"handleTouchStart"</span> <span class="hljs-meta">@touchend</span>=<span class="hljs-string">"handleTouchEnd"</span>&gt;
  &lt;!-- 导航项 --&gt;
&lt;/div&gt;
</code></pre>
<h2 data-id="heading-11">4. 完整代码</h2>
<p>完整代码如下（可直接复制使用）：</p>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"indicatorStyle"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
          <span class="hljs-attr">class</span>=<span class="hljs-string">"nav"</span> 
          @<span class="hljs-attr">touchstart</span>=<span class="hljs-string">"handleTouchStart"</span> 
          @<span class="hljs-attr">touchend</span>=<span class="hljs-string">"handleTouchEnd"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
            <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(tab, index) in tabs"</span> 
            <span class="hljs-attr">:key</span>=<span class="hljs-string">"tab.value"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span> 
            <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: activeTab === index }"</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTab(index)"</span>
          &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ tab.label }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
    <span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
    <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
    <span class="hljs-comment">// 导航数据（支持路由）</span>
    <span class="hljs-keyword">const</span> tabs = [
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'首页'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span> },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'分类'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/category'</span> },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'购物车'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/cart'</span> },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'我的'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/mine'</span> }
    ]
    <span class="hljs-keyword">const</span> activeTab = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">const</span> startX = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
    <span class="hljs-comment">// 指示器样式</span>
    <span class="hljs-keyword">const</span> indicatorStyle = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
      <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${activeTab.value * (<span class="hljs-number">100</span> / tabs.length)}</span>%`</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-number">100</span> / tabs.length}</span>%`</span>
    }))
    <span class="hljs-comment">// 切换导航（含路由跳转）</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">changeTab</span> = (<span class="hljs-params">index</span>) =&gt; {
      activeTab.<span class="hljs-property">value</span> = index
      router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">path</span>: tabs[index].<span class="hljs-property">path</span> })
    }
    <span class="hljs-comment">// 触摸滑动逻辑（移动端适配）</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTouchStart</span> = (<span class="hljs-params">e</span>) =&gt; {
      startX.<span class="hljs-property">value</span> = e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>
    }
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTouchEnd</span> = (<span class="hljs-params">e</span>) =&gt; {
      <span class="hljs-keyword">const</span> endX = e.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>
      <span class="hljs-keyword">const</span> diffX = endX - startX.<span class="hljs-property">value</span>
      <span class="hljs-keyword">if</span> (diffX &gt; <span class="hljs-number">50</span> &amp;&amp; activeTab.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>) {
        activeTab.<span class="hljs-property">value</span>--
        router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">path</span>: tabs[activeTab.<span class="hljs-property">value</span>].<span class="hljs-property">path</span> })
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (diffX &lt; -<span class="hljs-number">50</span> &amp;&amp; activeTab.<span class="hljs-property">value</span> &lt; tabs.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
        activeTab.<span class="hljs-property">value</span>++
        router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">path</span>: tabs[activeTab.<span class="hljs-property">value</span>].<span class="hljs-property">path</span> })
      }
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.nav-container</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>; <span class="hljs-comment">/* 缩小宽度，避免贴边 */</span>
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> auto; <span class="hljs-comment">/* 居中显示 */</span>
      <span class="hljs-attribute">height</span>: <span class="hljs-number">44px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">35px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.08</span>);
      <span class="hljs-attribute">overflow</span>: hidden;
    }
    <span class="hljs-selector-class">.nav</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
    }
    <span class="hljs-selector-class">.nav-item</span> {
      <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#555</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>;
    }
    <span class="hljs-selector-class">.nav-item</span><span class="hljs-selector-class">.active</span> {
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    }
    <span class="hljs-selector-class">.nav-item</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-class">.active</span>) {
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#4facfe</span>;
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
    }
    <span class="hljs-selector-class">.indicator</span> {
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff9a9e</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#fecfef</span> <span class="hljs-number">100%</span>); 
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">35px</span>;
      <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.68</span>, -<span class="hljs-number">0.55</span>, <span class="hljs-number">0.265</span>, <span class="hljs-number">1.55</span>);
      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">0</span>;
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">5. 总结</h2>
<p>最后总结一下：导航栏实现的核心思路就是是通过动态计算指示器样式，配合<strong>transition</strong>实现动画效果。</p>
<p>如有错误，请指正O^O!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《C语言点滴》——笑着入门，扎实成长]]></title>    <link>https://juejin.cn/post/7570299986529746971</link>    <guid>https://juejin.cn/post/7570299986529746971</guid>    <pubDate>2025-11-09T15:00:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570299986529746971" data-draft-id="7570201730991734810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《C语言点滴》——笑着入门，扎实成长"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T15:00:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《C语言点滴》——笑着入门，扎实成长
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:00:11.000Z" title="Sun Nov 09 2025 15:00:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：赵岩（哈尔滨工业大学计算机系教师）<br/>
出版社：人民邮电出版社<br/>
出版时间：2013 年 10 月<br/>
ISBN：978-7-115-32198-5</p>
<p>一、为什么推荐“零基础”读者先读它<br/>
C 语言语法简单，却“贴近机器”，初学者常被指针、数组越界、格式串错误等问题绊倒。作者把课堂里学生最容易“卡壳”的几十个知识点拆成 14 章，每章只讲一件事：<br/>
第 1 章用“程序员职场段子”当开胃菜，先让你笑出来；第 2～13 章把数据类型、运算符、控制流、函数、数组、指针、结构体、文件、调试等“硬骨头”挨个敲碎；第 14 章给出继续进阶的路线与书单，相当于“结业辅导员”。</p>
<p>二、写作风格：把“枯燥”写成“脱口秀”<br/>
书里随处可见的“赵氏吐槽”——<br/>
“如果你把 &amp; 写成 *，编译器不会生气，它只会静静地看着你跑飞。”<br/>
“指针就像快递小哥，地址写错，包裹就送到别人家。”<br/>
编辑读完调侃：“作者从小被笑话，于是决定写本书，边逗你边把钱挣了。”<br/>
这种轻松口吻把学习曲线拉平，让零基础读者也能“笑着读完”。</p>
<p>三、内容设计：正面拆解，少即是多<br/>
不同于《C 陷阱与缺陷》的“错误案例大合集”，本书习惯先给出正确范式，再用 1～2 段最精简的代码把原理跑通；遇到指针、数组等重难点，则不惜篇幅画内存示意图，一步一步跟踪变量值的变化。<br/>
每章末尾会“贴心”地引用 K&amp;R、C FAQ、C 标准库等经典资料，告诉你“学完了该往哪儿钻”。</p>
<p>四、读者反馈与适读人群<br/>
豆瓣、CSDN 上的读者用一句话总结：<br/>
“可以当小说看的 C 语言教材。”<br/>
适合：</p>
<ol>
<li>完全零基础、想先建立“能跑起来的”程序思维；</li>
<li>被国内高校教材“劝退”后，需要重新找回自信；</li>
<li>已经会写代码，却总感觉“根基不牢”，需要补细节。</li>
</ol>
<p>五、阅读路线图<br/>
阶段 1：把《C 语言点滴》通读一遍，跟着敲完书中 40 余个示例——你不再惧怕指针和 malloc。<br/>
阶段 2：回头刷《C 程序设计语言》（K&amp;R），这时你会发现曾经“高冷”的 K&amp;R 突然亲切起来。<br/>
阶段 3：根据第 14 章的指引，选择《C 和指针》《C 陷阱与缺陷》《Expert C Programming》继续深耕。</p>
<p>六、小结<br/>
如果你第一次学 C，却不想“从入门到放弃”，把《C 语言点滴》放在手边。它像一位幽默的学长：先递给你一杯奶茶，再把最难啃的概念掰开揉碎，最后拍拍肩膀告诉你——<br/>
“别怕，继续往前走，幸福就会跟在你尾巴上。”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webpack 老项目的优化实践]]></title>    <link>https://juejin.cn/post/7569976345931350067</link>    <guid>https://juejin.cn/post/7569976345931350067</guid>    <pubDate>2025-11-09T15:00:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569976345931350067" data-draft-id="7570243451724759067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Webpack 老项目的优化实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-09T15:00:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Webpack 老项目的优化实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T15:00:05.000Z" title="Sun Nov 09 2025 15:00:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是<strong>前端架构师</strong>，关注微信公众号【<strong>程序员大卫</strong>】,免费领取精品前端资料。</p>
<h2 data-id="heading-0">背景</h2>
<p>我将分享一些我在公司项目中实际操作的优化方法，最终使得项目的首屏加载速度显著提升。以下是优化前后的对比。</p>
<h3 data-id="heading-1">性能对比：</h3>




















<table><thead><tr><th><strong>指标</strong></th><th><strong>优化前</strong></th><th><strong>优化后</strong></th></tr></thead><tbody><tr><td>JS 文件大小</td><td>32MB</td><td>4MB</td></tr><tr><td>首屏加载时间</td><td>12秒</td><td>2秒</td></tr></tbody></table>
<p>从上面的对比可以看到，优化后项目加载速度有了质的飞跃，首屏加载时间从 11 秒降到了 1 秒，JS 文件的体积也减少了 80%以上。</p>
<h2 data-id="heading-2">优化步骤解析</h2>
<p>接下来，我会详细讲解我在项目中实施的优化措施。</p>
<h3 data-id="heading-3">1. 分析打包体积，找出性能瓶颈</h3>
<p>通过使用 <code>webpack-bundle-analyzer</code> 插件，我们可以直观地查看项目打包后各个文件的体积分布，并发现哪些模块占用了过多的空间。比如，<code>element-plus</code>、<code>echarts</code> 等文件的体积非常庞大，这些文件直接影响了加载速度和构建时间。</p>
<p>可以使用按需加载 <code>element-plus</code> 组件，<code>echarts</code> 不要全局引入，按模块需要引入。</p>
<p>安装 <code>webpack-bundle-analyzer</code> 插件：</p>
<pre><code class="hljs language-bash" lang="bash">npm install webpack-bundle-analyzer -D
</code></pre>
<p>配置 <code>webpack</code> 以启用分析：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">BundleAnalyzerPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-bundle-analyzer'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">configureWebpack</span>: {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span>()  <span class="hljs-comment">// 用于展示各个模块的大小和依赖关系</span>
    ]
  }
};
</code></pre>
<h3 data-id="heading-4">2. 使用cdn加载第三方js</h3>
<p>使用 CDN 加速是常见的优化方式，它能显著减少项目的打包体积、提高页面加载速度并减少服务器带宽压力。</p>
<h4 data-id="heading-5">1. 将 CDN 资源提取到配置文件中</h4>
<p>首先，你可以将 CDN 配置提取到一个独立的文件中（如 <code>cdn-config.js</code>），并在 <code>vue.config.js</code> 中动态加载。这种方式更灵活且易于维护，尤其是当项目有多个环境（开发、测试、生产）时。</p>
<p><strong><code>cdn-config.js</code> 示例：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">vue</span>: <span class="hljs-string">'https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js'</span>,
  <span class="hljs-string">'element-ui'</span>: <span class="hljs-string">'https://cdn.jsdelivr.net/npm/element-ui@2.15.0/lib/index.js'</span>,
  <span class="hljs-attr">echarts</span>: <span class="hljs-string">'https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js'</span>,
  <span class="hljs-attr">css</span>: {
    <span class="hljs-string">'element-ui'</span>: <span class="hljs-string">'https://cdn.jsdelivr.net/npm/element-ui@2.15.0/lib/theme-chalk/index.min.css'</span>,
  },
};
</code></pre>
<h4 data-id="heading-6">2. 动态加载 CDN 链接</h4>
<p>然后，在 <code>vue.config.js</code> 中动态加载这些 CDN 配置，并通过 <code>chainWebpack</code> 插入到 HTML 中。这种方式可以减少硬编码，提高可维护性，并且更灵活地切换 CDN。</p>
<p><strong><code>vue.config.js</code> 示例：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cdn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./cdn-config.js'</span>);
<span class="hljs-keyword">const</span> isProduction = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">configureWebpack</span>: {
    <span class="hljs-attr">externals</span>: isProduction ? {
      <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>,
      <span class="hljs-string">'element-ui'</span>: <span class="hljs-string">'ELEMENT'</span>,
      <span class="hljs-attr">echarts</span>: <span class="hljs-string">'echarts'</span>
    } : {}
  },
  <span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'html'</span>).<span class="hljs-title function_">tap</span>(<span class="hljs-function"><span class="hljs-params">args</span> =&gt;</span> {
      args[<span class="hljs-number">0</span>].<span class="hljs-property">cdn</span> = {
        <span class="hljs-attr">js</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(cdn).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> url.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.js'</span>)),
        <span class="hljs-attr">css</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(cdn.<span class="hljs-property">css</span> || {})
      };
      <span class="hljs-keyword">return</span> args;
    });
  }
};
</code></pre>
<h4 data-id="heading-7">3. 在 HTML 模板中插入 CDN 资源</h4>
<p>在 <code>index.html</code> 中，我们使用 <code>html-webpack-plugin</code> 插入 CDN 资源。通过 <code>htmlWebpackPlugin.options.cdn</code> 动态注入这些资源，使得 HTML 模板更加灵活，且无需硬编码每个 CDN 资源。</p>
<p><strong><code>index.html</code> 示例：</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Webpack CDN Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 动态插入 CSS --&gt;</span>
  &lt;% for (var css of htmlWebpackPlugin.options.cdn.css) { %&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;%= css %&gt;"</span>&gt;</span>
  &lt;% } %&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 动态插入 JS --&gt;</span>
  &lt;% for (var js of htmlWebpackPlugin.options.cdn.js) { %&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"&lt;%= js %&gt;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  &lt;% } %&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">4. 版本控制和 CDN 服务选择</h4>
<p>使用 <code>jsdelivr</code> 或 <code>unpkg</code> 这种公共 CDN 服务时，注意加上版本号，以确保兼容性。如果项目中有多个依赖项需要加载，最好选择那些稳定且提供长期支持的 CDN 服务，避免因为 CDN 服务问题导致的资源加载失败。</p>
<h4 data-id="heading-9">5. fallback 机制（备用方案）</h4>
<p>为了保证 CDN 加载失败时，页面能正常工作，你可以为 CDN 资源提供一个 fallback 机制。当 CDN 资源无法加载时，可以从本地文件或其他备份源加载。</p>
<p>例如，在 HTML 中加一个简单的 fallback：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;script src="/path/to/local/vue.min.js"&gt;&lt;\/script&gt;'</span>);
  }
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">ELEMENT</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;script src="/path/to/local/element-ui.js"&gt;&lt;\/script&gt;'</span>);
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">3. 懒加载优化</h3>
<p>对于一些不常用的库或功能，我们可以通过懒加载来避免它们在首次加载时被下载。例如，<code>Table2Excel</code> 和 <code>exceljs</code> 只是某些功能的依赖，并不会在页面加载时立刻用到。我们采用了 <code>import()</code> 异步加载这些模块。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">download</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'table2excel.js'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">Table2Excel</span>) =&gt;</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Table2Excel</span>.<span class="hljs-title function_">default</span>(<span class="hljs-string">'#table'</span>).<span class="hljs-title function_">export</span>(<span class="hljs-string">'filename'</span>);
  });
}
</code></pre>
<p>通过这种方式，只有在需要时才会加载 <code>Table2Excel</code> 和 <code>exceljs</code>，有效减轻了首次加载的压力。</p>
<h3 data-id="heading-11">4. 压缩并优化 Moment.js</h3>
<p><code>Moment.js</code> 是一个常用的时间处理库，但它的体积较大。我们通过忽略掉不必要的语言包，减少了它的体积。</p>
<p>在 <code>vue.config.js</code> 中配置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'ignore'</span>)
      .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">IgnorePlugin</span>(<span class="hljs-regexp">/^\.\/locale$/</span>, <span class="hljs-regexp">/moment$/</span>));  <span class="hljs-comment">// 忽略 moment 的其他语言包</span>
  }
};
</code></pre>
<p>然后在 <code>main.js</code> 中手动引入所需的语言包：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">'moment'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'moment/locale/zh-cn'</span>;  <span class="hljs-comment">// 只引入中文语言包</span>
moment.<span class="hljs-title function_">locale</span>(<span class="hljs-string">'zh-cn'</span>);
</code></pre>
<p>这种做法将 <code>Moment.js</code> 的体积从几百 KB 降低到了 174KB。</p>
<h3 data-id="heading-12">5. Gzip 压缩文件</h3>
<p>最后，为了进一步减小文件体积并提高加载速度，我们使用了 <code>compression-webpack-plugin</code> 插件对 JS 和 CSS 文件进行 Gzip 压缩。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">CompressionPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'compression-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (isProduction) {
      config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'compressionPlugin'</span>).<span class="hljs-title function_">use</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionPlugin</span>({
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(js|css)$/</span>,  <span class="hljs-comment">// 只压缩 JS 和 CSS 文件</span>
        <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span>,     <span class="hljs-comment">// 压缩大于 10KB 的文件</span>
        <span class="hljs-attr">minRatio</span>: <span class="hljs-number">0.8</span>,        <span class="hljs-comment">// 压缩比率</span>
        <span class="hljs-attr">deleteOriginalAssets</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 删除原始文件</span>
      }));
    }
  }
};
</code></pre>
<p>经过这些优化，项目的打包文件大小从 3MB 减少到 860KB，加载速度得到了显著提升。</p>
<blockquote>
<p>服务器端也得配置 nginx 开启静态压缩</p>
</blockquote>
<h3 data-id="heading-13">总结</h3>
<p>这些看似简单的优化方法，在实际应用中却能带来显著的性能提升。虽然这些优化技术不是什么新鲜事，但要在实际项目中实施却需要一定的时间和精力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端跨标签页通信方案（上）]]></title>    <link>https://juejin.cn/post/7569945160870068270</link>    <guid>https://juejin.cn/post/7569945160870068270</guid>    <pubDate>2025-11-09T13:08:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569945160870068270" data-draft-id="7553119425118912512" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端跨标签页通信方案（上）"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T13:08:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="168169"/> <meta itemprop="url" content="https://juejin.cn/user/2541726614191528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端跨标签页通信方案（上）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726614191528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    168169
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:08:38.000Z" title="Sun Nov 09 2025 13:08:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>前情</strong></h2>
<p>平时开发很少有接触到有什么需求需要实现跨标签页通信，但最近因为一些变故，不得不重新开始找工作了，其中就有面试官问到一道题，跨标签页怎么实现数据通信，我当时只答出二种，面试完后特意重新查资料，因此有些文章</p>
<h2 data-id="heading-1"><strong>localStorage / sessionStorage</strong></h2>
<p>利用<code>localStorage</code>的存储事件实现通信，当一个标签页修改<code>localStorage</code>时，其他同源标签页会触发<code>storage</code>事件</p>
<p>关键代码如下：</p>
<p>标签页1</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>page0-localStorage<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"setCacheBtn"</span>&gt;</span>设置本地缓存<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'setCacheBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'message'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'greeting'</span>,
        <span class="hljs-comment">// 这里为了保证通信每次生效，每次都设置不同的值</span>
        <span class="hljs-attr">content</span>: <span class="hljs-string">'Hello from page0.html'</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
      }));
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>标签页2</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>page1-localStorage<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'message'</span>) {
        <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(e.<span class="hljs-property">newValue</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Received:page1.html'</span>, data);
      }
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>动图演示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f40a77955cc443da437d47db7292022~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763298518&amp;x-signature=n5EtUHa8XY08%2F7njNVwBOGq73pg%3D" alt="20250923_193504.gif" loading="lazy"/></p>
<p><strong>提醒：</strong></p>
<ul>
<li>同源标签才有效</li>
<li>设置不同的本地存储值才有效，如果设置的是同一个缓存值是不会生效的</li>
<li>兼容性非常nice，可以大胆使用了，国内一些浏览器从can i use查不到，但兼容性是没啥问题的</li>
<li>sessionStorage仅在同一标签页的不同 iframe 间有效，不适用于不同标签页</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa4498c839d142969190eec9a402faeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763298518&amp;x-signature=zGgszvvHWwc9M%2BPxs58H7IJfIS8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>BroadcastChannel</strong></h2>
<p>专门用于同源标签页通信的 API，创建一个频道后，所有加入该频道的页面都能收到消息</p>
<p>关键代码如下:</p>
<p>标签页1</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>BroadcastChannel0<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>BroadcastChannel0<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"communication"</span>&gt;</span>BroadcastChannel0.html 发送消息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 所有页面都创建相同名称的频道</span>
    <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'my_channel'</span>);

    <span class="hljs-comment">// 发送消息</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'communication'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      channel.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'update'</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">'new content from BroadcastChannel0.html'</span> });
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>标签页2</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>BroadcastChannel1<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>BroadcastChannel1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 所有页面都创建相同名称的频道</span>
    <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'my_channel'</span>);

    <span class="hljs-comment">// 接收消息</span>
    channel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Received:BroadcastChannel1.html'</span>, e.<span class="hljs-property">data</span>);
    };
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>演示动图如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87f8ad2389db40ca9426ad93656ea931~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763298518&amp;x-signature=O00Ye7U8pkMByUesjARN6xLGbHw%3D" alt="20250923_200047.gif" loading="lazy"/></p>
<p><strong>提醒：</strong></p>
<ul>
<li>要通信的标签记得都初始化BroadcastChannel，一定记得使用相同的名称</li>
<li>查询来看除IE外可以大但使用了</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a152c1412da4bd180d00cd6d7cad081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763298518&amp;x-signature=tcEPQs9C%2FvT%2FgP%2FUb0F0PANFxyc%3D" alt="image 1.png" loading="lazy"/></p>
<h2 data-id="heading-3">小结</h2>
<p>这二种是我面试的时候答出来的，第二种我只是模糊记得跟面试官模棱二可的说了说，面试馆给了正面的回应，呵呵……，此文暂时写这么多，下篇继续探索其它方式……</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[读懂 Pin，一次搞清 Rust 最难的指针]]></title>    <link>https://juejin.cn/post/7569976345930956851</link>    <guid>https://juejin.cn/post/7569976345930956851</guid>    <pubDate>2025-11-09T12:34:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569976345930956851" data-draft-id="7569976345930924083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="读懂 Pin，一次搞清 Rust 最难的指针"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2025-11-09T12:34:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大鱼七成饱"/> <meta itemprop="url" content="https://juejin.cn/user/3017475369480509"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            读懂 Pin，一次搞清 Rust 最难的指针
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3017475369480509/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大鱼七成饱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T12:34:12.000Z" title="Sun Nov 09 2025 12:34:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>这是Rust九九八十一难第13篇，介绍下pin指针。pin指针跟Future紧密相关，也算是多线程部分第三篇。关于这块，之前看了几篇文章，有评论这块难以理解，我也同感。忘记谁说的了，如果不能简单明了的描述某个东西，说明自己还没真正掌握。本篇尝试用简单方式整理Pin相关的知识，有问题请留言。</p>
<h2 data-id="heading-1">一、基本概念</h2>
<p>入门pin，先要知道四个概念：pin，Unpin和!Upin,以及rust的move。通过这些概念的对比，理解pin的边界，在哪些范围发生作用。</p>
<h3 data-id="heading-2">1、<code>Pin&lt;T&gt;</code> 到底是什么</h3>
<h3 data-id="heading-3">Pin是个智能指针包装器。比如:</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">pinned</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(&amp;x);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Pinned: {:?}"</span>, pinned);<span class="hljs-comment">//Pinned: 10</span>
}
</code></pre>
<ul>
<li>它包裹了一个类型 <code>T</code>（通常是放在<strong>堆上</strong>的，如 <code>Box&lt;T&gt;</code>），对 <strong>!Unpin 类型</strong> ， 编译器会在语法层面阻止移动。</li>
<li>简单说就是可以拿到 <code>&amp;T</code> 或 <code>&amp;mut T</code>，但保证不会把整个 <code>T</code> 移到别的内存位置。</li>
</ul>
<h3 data-id="heading-4">2、Unpin是什么？</h3>
<p><code>Unpin</code> 是一个 <strong>标记 trait</strong>，表示该类型可以安全地被移动。</p>
<ul>
<li>
<p>大多数普通类型（如 <code>i32</code>, <code>String</code>, <code>Vec&lt;T&gt;</code>）<strong>默认实现</strong>了 <code>Unpin</code>；</p>
</li>
<li>
<p>但一些类型（如 <code>Future</code>、自引用结构）<strong>不会自动实现</strong>。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">need_unpin</span>&lt;T: Unpin&gt;(x: T) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"可以安全移动"</span>);
}
</code></pre>
<p>如果某类型没有 <code>Unpin</code>，那么它就 <strong>必须被固定（pinned）</strong> 才能安全使用。</p>
</li>
</ul>
<h3 data-id="heading-5">3、!Unpin是什么</h3>
<p><strong><code>!Unpin</code></strong> 就是 <strong>没有实现 <code>Unpin</code> 的类型</strong>，表示类型 <strong>不能随意移动</strong>。<code>!Unpin</code> 并不是 Rust 的语法，而是“没有实现 Unpin 的类型”的意思。Rust 默认会自动为大部分类型实现 <code>Unpin</code>，只有少数类型（自引用、Future、PhantomPinned）才是 <code>!Unpin</code></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::marker::PhantomPinned;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
    _pin: PhantomPinned, <span class="hljs-comment">// 表示 !Unpin</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 普通类型 Unpin</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(x);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">moved_px</span> = px; <span class="hljs-comment">// ✅ 可以移动</span>

    <span class="hljs-comment">// 自引用类型 !Unpin</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">y</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef {
        data: <span class="hljs-string">"hello"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        ptr: std::ptr::<span class="hljs-title function_ invoke__">null</span>(),
        _pin: PhantomPinned,
    });
    <span class="hljs-comment">// let moved_y = y; // ❌ 编译报错，不可移动</span>
}
</code></pre>
<p>Unpin 类型 → 钉住也能搬，!Unpin 类型 → 钉住后无法搬。换句话**!Unpin 的作用是“固定对象的地址”，而不是搬动堆上的数据**，如下图：</p>
<pre><code class="hljs language-lua" lang="lua">Stack                     Heap
+<span class="hljs-comment">-------+                 +--------+</span>
| a     | <span class="hljs-comment">--------------&gt; | "hello"|</span>
| Box   |                 +<span class="hljs-comment">--------+</span>
+<span class="hljs-comment">-------+</span>
!Unpin 阻止 a 被 move
</code></pre>
<ul>
<li>
<p><code>a</code>（栈上的 Box）被 Pin ， 栈上的地址不能被移动，堆上的 <code>"hello"</code> 数据不受影响</p>
</li>
<li>
<p>Pin 作用在 <strong>栈上的对象地址</strong>，确保内部指针不会悬空</p>
</li>
</ul>
<h3 data-id="heading-6">4、Pin、Unpin和!Unpin三者对比</h3>

























<table><thead><tr><th>类型</th><th>Pin 是否生效</th><th>说明</th></tr></thead><tbody><tr><td>Unpin</td><td>❌ 不生效（透明）</td><td>移动仍然允许，安全无问题</td></tr><tr><td>!Unpin</td><td>✅ 生效</td><td>栈上值被固定，移动会编译报错，保护内部引用安全</td></tr><tr><td>Copy 类型</td><td>❌ 不生效</td><td>move 其实是复制，Pin 对它无意义</td></tr></tbody></table>
<p><strong><code>Pin</code> 是动作，“把对象钉住”，<code>Unpin</code> / <code>!Unpin</code> 决定钉住后能否移动。</strong></p>
<h3 data-id="heading-7">5、Pin与move的关系</h3>

































<table><thead><tr><th>类型</th><th>Copy？</th><th>Unpin？</th><th>Pin 后移动？</th><th>Pin 作用</th></tr></thead><tbody><tr><td>i32 / bool / f64</td><td>✅</td><td>✅</td><td>✅ 可以移动</td><td>不起作用（透明）</td></tr><tr><td>String / Vec / Box</td><td>❌</td><td>✅</td><td>✅ 可以移动</td><td>对 Unpin 类型不起作用</td></tr><tr><td>自引用 / Future</td><td>❌</td><td>❌</td><td>❌ 禁止移动</td><td>Pin 生效，保护内部引用</td></tr></tbody></table>
<p><strong>Pin 的实际意义只针对 !Unpin （Pin&lt;T: !Unpin&gt;）类型</strong>，Copy 或 Unpin 类型( String、Vec、Box) 标记了 Pin（Pin&lt;T: Unpin&gt;），本质上不起作用。</p>
<h2 data-id="heading-8">二、核心API使用入门</h2>
<p>上一章节确定了边界，这一章看下Pin的api怎么用。</p>
<h3 data-id="heading-9">示例1：Pin&lt;Box&gt;</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Data</span> {
    value: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
  
  	<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">boxed</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">123</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">pinned</span> = Pin::<span class="hljs-title function_ invoke__">new</span>(boxed);

    <span class="hljs-comment">// i32 是 Unpin，所以可以安全取出</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">inner</span> = Pin::<span class="hljs-title function_ invoke__">into_inner</span>(pinned); 
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, inner);
   
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = Data {
        value: <span class="hljs-string">"hello"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    };

    <span class="hljs-comment">// 普通 Box，可以自由移动</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">boxed</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(data);

    <span class="hljs-comment">// Pin&lt;Box&lt;T&gt;&gt;：禁止移动内部 T</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">pinned</span>: Pin&lt;<span class="hljs-type">Box</span>&lt;Data&gt;&gt; = Pin::<span class="hljs-title function_ invoke__">new</span>(boxed);

    <span class="hljs-comment">// 安全访问字段</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Value = {}"</span>, pinned.value);

    <span class="hljs-comment">// 尝试移动 pinned（编译失败），内部值（Data）被移动出原来的内存地址，原先地址上的那块堆内存变成空的，违反了pin的约束</span>
    <span class="hljs-comment">// let moved = *pinned; // ❌</span>
}
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li><code>Pin&lt;Box&lt;T&gt;&gt;</code> 保证 <code>T</code> 在堆上的地址不会改变；仍然可以修改内容，但不能“移走”整个结构体。</li>
<li>Pin::new()：对 <code>!Unpin</code> 类型（例如自引用结构体），不能直接用这个函数。编译器会强制你使用 <code>unsafe { Pin::new_unchecked(...) }</code>。</li>
<li>如果想只有当类型是 <code>Unpin</code>（可安全移动）时才能用into_inner。</li>
</ul>
<h3 data-id="heading-10">示例2：自引用结构体（<code>Pin</code> 的典型场景）</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::ptr::NonNull;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: <span class="hljs-type">Option</span>&lt;NonNull&lt;<span class="hljs-type">String</span>&gt;&gt;,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">SelfRef</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(txt: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> SelfRef {
        SelfRef {
            data: txt.<span class="hljs-title function_ invoke__">to_string</span>(),
            ptr: <span class="hljs-literal">None</span>,
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">init</span>(<span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> SelfRef&gt;) {
        <span class="hljs-comment">// 安全地拿到内部可变引用</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">this</span> = <span class="hljs-keyword">unsafe</span> { <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">get_unchecked_mut</span>() };
        <span class="hljs-comment">// 设置指针指向自己字段</span>
        this.ptr = <span class="hljs-title function_ invoke__">Some</span>(NonNull::<span class="hljs-title function_ invoke__">from</span>(&amp;this.data));
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">print</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"self.data = {}"</span>, <span class="hljs-keyword">self</span>.data);
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(ptr) = <span class="hljs-keyword">self</span>.ptr {
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ptr -&gt; {}"</span>, ptr.<span class="hljs-title function_ invoke__">as_ref</span>());
            }
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">s</span> = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"Rust Pin!"</span>));
    s.<span class="hljs-title function_ invoke__">as_mut</span>().<span class="hljs-title function_ invoke__">init</span>();  <span class="hljs-comment">// 初始化自引用</span>
    s.<span class="hljs-title function_ invoke__">print</span>();          <span class="hljs-comment">// ✅ OK：data 没被移动</span>
}
</code></pre>
<h3 data-id="heading-11">示例 3：在异步任务中（<code>Future</code> 的典型应用）</h3>
<p><code>async fn</code> 生成的状态机其实是 <strong>自引用结构体</strong>。 <code>Pin</code> 在运行时保护它不被移动。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::future::Future;
<span class="hljs-keyword">use</span> std::task::{Context, Poll};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyFuture</span> {
    counter: <span class="hljs-type">u8</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Future</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MyFuture</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Output</span> = <span class="hljs-type">u8</span>;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">poll</span>(<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">Self</span>&gt;, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-symbol">'_</span>&gt;) <span class="hljs-punctuation">-&gt;</span> Poll&lt;<span class="hljs-keyword">Self</span>::Output&gt; {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.counter &lt; <span class="hljs-number">3</span> {
            <span class="hljs-keyword">self</span>.counter += <span class="hljs-number">1</span>;
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Counting: {}"</span>, <span class="hljs-keyword">self</span>.counter);
            Poll::Pending
        } <span class="hljs-keyword">else</span> {
            Poll::<span class="hljs-title function_ invoke__">Ready</span>(<span class="hljs-keyword">self</span>.counter)
        }
    }
}

<span class="hljs-meta">#[tokio::main]</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = MyFuture { counter: <span class="hljs-number">0</span> }.<span class="hljs-keyword">await</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Done: {}"</span>, result);
}
</code></pre>
<p><code>Pin</code> 确保 <code>MyFuture</code> 内部状态（如引用）不会在 <code>.await</code> 期间被移动。这就是为什么 <code>async</code> 语法能安全地处理复杂状态。</p>
<h3 data-id="heading-12">示例4：unsafe</h3>
<h4 data-id="heading-13">a) Pin::new_unchecked</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">x</span> = SelfRef { ... }; <span class="hljs-comment">// !Unpin 类型</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span> = <span class="hljs-keyword">unsafe</span> { Pin::<span class="hljs-title function_ invoke__">new_unchecked</span>(&amp;<span class="hljs-keyword">mut</span> x) };
</code></pre>
<ul>
<li><strong>为什么 unsafe</strong>：
<ul>
<li>编译器不能保证后续不会移动 <code>x</code></li>
<li>需要开发者保证 <code>x</code> 在生命周期内不会移动</li>
</ul>
</li>
<li>Pin::new_unchecked：必须 <strong>100% 确保</strong> 这个值不会在 pinned 后被移动，一般只在底层框架（如 tokio、futures）或自引用实现中用，业务代码一般不用。</li>
</ul>
<h4 data-id="heading-14">b) Pin::get_unchecked_mut</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">px</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> SelfRef&gt; = Pin::<span class="hljs-title function_ invoke__">new</span>(&amp;<span class="hljs-keyword">mut</span> x);

<span class="hljs-keyword">unsafe</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mut_ref</span>: &amp;<span class="hljs-keyword">mut</span> SelfRef = Pin::<span class="hljs-title function_ invoke__">get_unchecked_mut</span>(px.<span class="hljs-title function_ invoke__">as_mut</span>());
    mut_ref.ptr = &amp;<span class="hljs-keyword">mut</span> mut_ref.data; <span class="hljs-comment">// 自引用赋值</span>
}
</code></pre>
<ul>
<li>get_unchecked_mut()：不安全适用任何类型，跳过移动安全检查，手动保证 pinned 值不会移动</li>
</ul>
<h4 data-id="heading-15">c)  into_inner 堆上对象拆回原类型（!Unpin 类型不可行）</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span>: Pin&lt;<span class="hljs-type">Box</span>&lt;SelfRef&gt;&gt; = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef { ... });
<span class="hljs-comment">// let b: Box&lt;SelfRef&gt; = Pin::into_inner(px); // ❌ 不安全，编译禁止</span>
</code></pre>
<ul>
<li>对 Unpin 类型安全，可以拆回 Box</li>
<li>对 !Unpin 类型，拆回 Box 需要 unsafe 并自己保证移动不会破坏安全（一般不推荐）</li>
</ul>
<h2 data-id="heading-16">三、为什么要自引用</h2>
<p>pin指针常用场景是自引用，这里聊聊自引用是啥，为什么有自引用。</p>
<h3 data-id="heading-17">1、对比方法访问和内部引用</h3>
<p>假设我们有一个字符串字段 <code>data</code>，想访问前两个字符：</p>
<h4 data-id="heading-18">a、方法访问（推荐做法）</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyStruct</span> {
    data: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">MyStruct</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">slice</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-type">str</span> {
        &amp;<span class="hljs-keyword">self</span>.data[<span class="hljs-number">0</span>..<span class="hljs-number">2</span>] <span class="hljs-comment">// 每次调用都生成切片</span>
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = MyStruct { data: <span class="hljs-string">"Hello"</span>.<span class="hljs-title function_ invoke__">into</span>() };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, s.<span class="hljs-title function_ invoke__">slice</span>()); <span class="hljs-comment">// "He"</span>
}
</code></pre>
<ul>
<li>
<p>优点：
Rust borrow checker 安全，没有悬空指针，简单、可维护</p>
</li>
<li>
<p>缺点：
每次调用都会生成一个切片（非常轻量级，但在<strong>高性能/大量数据</strong>场景下可能产生微小开销）</p>
</li>
</ul>
<h4 data-id="heading-19">b、内部引用（self_ref / slice 指向 data）</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    slice: *<span class="hljs-keyword">const</span> <span class="hljs-type">str</span>, <span class="hljs-comment">// 内部指针</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">SelfRef</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(txt: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">s</span> = SelfRef {
            data: txt.<span class="hljs-title function_ invoke__">to_string</span>(),
            slice: std::ptr::<span class="hljs-title function_ invoke__">null</span>(),
        };
        s.slice = &amp;s.data[<span class="hljs-number">0</span>..<span class="hljs-number">2</span>] <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">str</span>; <span class="hljs-comment">// 指向 data</span>
        s
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_slice</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-type">str</span> {
        <span class="hljs-keyword">unsafe</span> { &amp;*<span class="hljs-keyword">self</span>.slice }
    }
}
</code></pre>
<ul>
<li>
<p>优点：</p>
<ul>
<li><strong>零拷贝</strong>：切片预先计算好，访问不需要每次切分</li>
<li>可用于<strong>异步/自引用结构</strong>，避免在 Future 状态机 poll 时重复生成切片</li>
</ul>
</li>
<li>
<p>缺点：</p>
<ul>
<li>必须使用 <strong>Pin</strong> 或堆分配保证 <code>data</code> 地址不变</li>
<li>使用裸指针，需要 <code>unsafe</code>，风险大</li>
<li>程序复杂度高，可维护性差</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">2、自引用场景</h3>
<h4 data-id="heading-21">a、零拷贝解析</h4>
<p>HTTP、JSON、CSV、文本流等大量数据处理，想存储对 buffer 的切片，而不是复制字符串。那内部引用可以直接保存 slice，避免每次 <code>data[0..n]</code> 生成新切片</p>
<h4 data-id="heading-22">b、异步状态机 / Future 自引用</h4>
<p>状态机字段之间可能互相引用Poll 时不希望重新计算 slice 或临时变量</p>
<h4 data-id="heading-23">c、高性能图结构 / AI / Tensor</h4>
<p>节点存指针指向数据的一部分，而不是每次生成新对象</p>
<h3 data-id="heading-24">3、不加pin的有什么问题</h3>
<p>假设2的场景没加pin，Rust 编译器在面对“直接自引用”，通常会：</p>
<ul>
<li>
<p>如果是安全引用（<code>&amp;str</code>），<strong>直接拒绝编译</strong>；</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">BadRef</span>&lt;<span class="hljs-symbol">'a</span>&gt; {
    data: <span class="hljs-type">String</span>,
    slice: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-type">str</span>, <span class="hljs-comment">// 引用自身字段</span>
}

<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">'a</span>&gt; BadRef&lt;<span class="hljs-symbol">'a</span>&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(txt: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = txt.<span class="hljs-title function_ invoke__">to_string</span>();
        <span class="hljs-keyword">Self</span> {
            data: s,
            slice: &amp;s, <span class="hljs-comment">// ❌ 编译错误</span>
        }
    }
}
</code></pre>
<pre><code class="hljs language-swift" lang="swift">error[<span class="hljs-type">E0505</span>]: cannot move out of `s` because it <span class="hljs-keyword">is</span> borrowed
 <span class="hljs-operator">--&gt;</span> src<span class="hljs-operator">/</span>main.rs:<span class="hljs-number">9</span>:<span class="hljs-number">13</span>
  <span class="hljs-operator">|</span>
<span class="hljs-number">8</span> <span class="hljs-operator">|</span>         <span class="hljs-keyword">let</span> s <span class="hljs-operator">=</span> txt.to_string();
  <span class="hljs-operator">|</span>             <span class="hljs-operator">-</span> binding `s` declared here
<span class="hljs-number">9</span> <span class="hljs-operator">|</span>         <span class="hljs-keyword">Self</span> { data: s, slice: <span class="hljs-operator">&amp;</span>s }
  <span class="hljs-operator">|</span>                    <span class="hljs-operator">^</span> move out of `s` occurs here
  <span class="hljs-operator">|</span>                    <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>                    borrow later used here
</code></pre>
<p>Rust 检测到 <code>&amp;s</code> 引用了局部变量 <code>s</code>，但又 move 了它（所有权转移），这违反了生命周期规则。</p>
</li>
<li>
<p>如果用裸指针（<code>*const T</code>），<strong>编译能过但属于未定义行为（UB）</strong>。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::ptr;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">SelfRef</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(s: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(s);
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ptr</span> = &amp;data <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>;
        <span class="hljs-keyword">Self</span> { data, ptr }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">print</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-comment">// 访问 ptr 指向的旧地址</span>
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ptr -&gt; {}"</span>, &amp;*<span class="hljs-keyword">self</span>.ptr);
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = SelfRef::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">y</span> = x; <span class="hljs-comment">// move 发生</span>
    <span class="hljs-comment">// 此时 y.ptr 仍指向 x.data 的旧地址（已被 drop）</span>

    y.<span class="hljs-title function_ invoke__">print</span>(); <span class="hljs-comment">// ❌ UB: 访问已释放内存</span>
}
</code></pre>
<p>interrupted by signal 11:SIGSEGV，或者出现乱码，因为 <code>b.slice</code> 指向了 <code>a.data</code> 的旧位置。有的rust版本可能不崩，有点随机，所以是未定义行为。</p>
</li>
</ul>
<h2 data-id="heading-25">四、Pin具体是怎么固定的</h2>
<p><code>Pin</code> 本身不保证对象真的“不会被移动”，它只是 <strong>在类型系统层面限制移动</strong>,依赖于“不能获取 <code>&amp;mut T</code> 原始引用：</p>
<ul>
<li>对于 <code>Pin&lt;Box&lt;T&gt;&gt;</code>，堆上分配 + 无法替换指针 = 地址稳定</li>
<li>对于 <code>Pin&lt;&amp;mut T&gt;</code>，编译器禁止 <code>T</code> 被 <code>mem::replace()</code> 或 <code>move</code></li>
</ul>
<h3 data-id="heading-26">1、PhantomPinned + !Unpin</h3>
<p>Rust 编译器通过 <strong>类型系统约束</strong>固定内部指针。<code>PhantomPinned</code> 用来标记一个类型 <strong>不可移动</strong>。默认情况下，所有类型都实现 <code>Unpin</code>：</p>
<ul>
<li>
<p><code>Unpin</code> 意味着可以安全移动。</p>
</li>
<li>
<p>自引用类型必须显式禁用 <code>Unpin</code>（通过 <code>PhantomPinned</code>）。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::marker::PhantomPinned;
<span class="hljs-keyword">use</span> std::pin::Pin;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
    _pin: PhantomPinned, <span class="hljs-comment">// 禁止移动</span>
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-27">2、Pin 的 API 层约束</h3>
<p>Pin的核心api定义：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span>&lt;T: ?<span class="hljs-built_in">Sized</span>&gt; Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt; {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">as_mut</span>(<span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt;) <span class="hljs-punctuation">-&gt;</span> Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt; { ... }
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_unchecked_mut</span>(<span class="hljs-keyword">self</span>: Pin&lt;&amp;<span class="hljs-keyword">mut</span> T&gt;) <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-keyword">mut</span> T { ... }
}
</code></pre>
<ul>
<li>
<p><code>as_mut</code>  安全获取可变引用，但仍然被 Pin 约束。</p>
</li>
<li>
<p><code>get_unchecked_mut</code> 是 <strong>unsafe</strong>的，允许手动移动内部字段，但风险自担。</p>
</li>
<li>
<p>编译器只允许安全 API 移动外部包裹指针，但内部 T 地址固定。</p>
</li>
</ul>
<h3 data-id="heading-28">3、阻止move的例子</h3>
<p>堆上移动禁止的例子，Pin在编译期就会阻止</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::pin::Pin;
<span class="hljs-keyword">use</span> std::marker::PhantomPinned;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SelfRef</span> {
    data: <span class="hljs-type">String</span>,
    ptr: *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>,
    _pin: PhantomPinned, <span class="hljs-comment">// !Unpin，禁止移动</span>
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 堆上创建 SelfRef 并 Pin</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">boxed</span>: Pin&lt;<span class="hljs-type">Box</span>&lt;SelfRef&gt;&gt; = <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(SelfRef {
        data: <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>),
        ptr: std::ptr::<span class="hljs-title function_ invoke__">null</span>(),
        _pin: PhantomPinned,
    });

    <span class="hljs-comment">// 初始化内部自引用指针</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ptr</span> = &amp;boxed.data <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">String</span>;
    <span class="hljs-keyword">unsafe</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mut_ref</span> = Pin::<span class="hljs-title function_ invoke__">as_mut</span>(&amp;<span class="hljs-keyword">mut</span> boxed);
        Pin::<span class="hljs-title function_ invoke__">get_unchecked_mut</span>(mut_ref).ptr = ptr;
    }

    <span class="hljs-comment">// ❌ 尝试 move 内部 SelfRef 会报错</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">moved</span> = *boxed; <span class="hljs-comment">// error: cannot move out of `*boxed` because it is pinned</span>

    <span class="hljs-comment">// // 但是 Box 本身可以移动</span>
    <span class="hljs-comment">// let moved_boxed = boxed; // ✅ Box 可移动，但堆上地址固定</span>
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// println!("data via pinned: {}", unsafe { &amp;*moved_boxed.ptr });</span>
}


</code></pre>
<p>原理：</p>
<ul>
<li>Box 是智能指针，移动 Box 只移动指针，不移动堆数据，如下图，堆没变；</li>
<li>Pin API 保证 T 在堆上的内存地址不会改变。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ec66390241147e7ae27470b0ba78730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6bG85LiD5oiQ6aWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296451&amp;x-signature=VtRzzPTncRIR7%2FnDbHQDNlteSt8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-29">五、为什么 <code>Future</code> 要有 Pin 设计</h2>
<h3 data-id="heading-30">1、future自引用</h3>
<p>一个 <code>async fn</code> 编译后其实会生成一个<strong>状态机结构体</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">foo</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-title function_ invoke__">bar</span>(&amp;s).<span class="hljs-keyword">await</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{s}"</span>);
}
</code></pre>
<p>编译器大致会生成：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">FooFuture</span> {
    State0,                        <span class="hljs-comment">// 初始状态</span>
    State1 { s: <span class="hljs-type">String</span>, bar_fut: BarFuture&lt;<span class="hljs-symbol">'_</span>&gt; },  <span class="hljs-comment">// await 之后</span>
    Done,
}
</code></pre>
<p>每次 <code>.poll()</code> 时，<code>Future</code> 会被推进到下一个状态。</p>
<p>在 <code>State1</code> 中，<code>bar_fut</code> 持有一个对 <code>s</code> 的引用：<code>BarFuture&lt;'_&gt; // 生命周期依赖 FooFuture::s</code></p>
<p>这意味着整个 <code>FooFuture</code> 结构体内部出现了**自引用（self-referential）**关系：</p>
<pre><code class="hljs language-rust" lang="rust">FooFuture
 ├─ s: <span class="hljs-type">String</span>
 └─ bar_fut: BarFuture&lt;<span class="hljs-symbol">'s</span>&gt;
              ↑
              └── 引用了 s
</code></pre>
<h3 data-id="heading-31">2、Future何时被移动</h3>
<p>当 Future 被运行（比如通过 <code>tokio::spawn</code>、<code>block_on</code>）时，执行器会做这样的事：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">fut</span> = <span class="hljs-title function_ invoke__">foo</span>();          <span class="hljs-comment">// 创建 Future</span>
executor.<span class="hljs-title function_ invoke__">spawn</span>(fut);      <span class="hljs-comment">// 把 Future 移进任务队列（Move #1）</span>
</code></pre>
<p>在任务系统中，执行器通常会：</p>
<ul>
<li>把 <code>fut</code> 移进某个堆上分配的任务结构体；</li>
<li>再从任务结构体中取出 <code>Pin&lt;&amp;mut fut&gt;</code> 去调用 <code>poll()</code>。</li>
</ul>
<p>这样，<strong>在被 poll 之前，它已经被 move 过一次了。</strong></p>
<p>更隐蔽的情况:</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">fut</span> = <span class="hljs-title function_ invoke__">foo</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">f1</span> = <span class="hljs-keyword">async</span> { fut.<span class="hljs-keyword">await</span> };
</code></pre>
<p><code>fut</code> 被嵌入另一个 Future <code>f1</code> 中。 <code>f1</code> 也会被 executor 再次移动。 也就是说 <code>fut</code> 可能经历：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-title function_ invoke__">foo</span>() <span class="hljs-punctuation">-&gt;</span> 创建 Future
   ↓ <span class="hljs-keyword">move</span>
<span class="hljs-keyword">async</span> { fut.<span class="hljs-keyword">await</span> } <span class="hljs-punctuation">-&gt;</span> 另一个 Future 包装
   ↓ <span class="hljs-keyword">move</span>
executor.<span class="hljs-title function_ invoke__">spawn</span>() <span class="hljs-punctuation">-&gt;</span> 放入任务
   ↓ <span class="hljs-keyword">move</span>
<span class="hljs-title function_ invoke__">poll</span>() <span class="hljs-punctuation">-&gt;</span> 固定到堆上
</code></pre>
<p>如果 <code>FooFuture</code> 在 poll 过程中被 <strong>移动 (move)</strong>，那么 <code>s</code> 在内存中的地址就变了。
但 <code>bar_fut</code> 仍然保存着旧地址的引用，则<strong>引用失效，属于UB（未定义行为）！</strong>。</p>
<p>所以Rust通过Pin来固定Future内存位置</p>
<h3 data-id="heading-32">3、流程如下</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71d1b2e2fae34a98b71845636c8f6573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6bG85LiD5oiQ6aWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296451&amp;x-signature=TQ44aG1DJbNBgDEW8PsmfpLREyk%3D" alt="" loading="lazy"/></p>
<p>说明：</p>
<ul>
<li>当写一个 <code>async fn foo() { … }</code> 或 <code>async { … }</code>，Rust 编译器把它转成一个状态机 struct，其字段包括局部变量、状态标记、可能的 Waker 等。</li>
<li>如果这个状态机 <strong>在 await 点之后</strong> 还持有对自身结构体内部字段（例如 <code>&amp;mut self.field</code>、或 <code>&amp;self.field</code>）的引用，那么它就是一个 <strong>自引用 Future</strong>。也就是说，它存储了指向自身内容的引用。</li>
<li>若这种 Future 被移动（即地址变化），那么这些内部引用就变成悬垂引用，可能引起 UB。</li>
<li>因此，为了安全，Rust 要求：若一个 Future 有可能是自引用的（即生成器状态机可能这样），那么它必须 <strong>先固定住地址（pinned）</strong>，再被 <code>poll</code>。这就是为什么 <code>poll(self: Pin&lt;&amp;mut Self&gt;, …)</code> 而不是 <code>&amp;mut Self</code>。<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F72769316%2Fwhy-do-futures-use-pins-in-rust%3Futm_source%3Dchatgpt.com" target="_blank" title="https://stackoverflow.com/questions/72769316/why-do-futures-use-pins-in-rust?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">stackoverflow.com/questions/7…</a></li>
<li>在 <code>Pin&lt;&amp;mut Self&gt;</code> 的约束下，类型系统禁止你再偷偷将 Self 移动。只有当 Self 类型实现了 <code>Unpin</code> （表示“即便被 Pin 包装，也可安全移动”）时，才允许“解除固定”的操作。</li>
<li>总结来说，在 poll 期间，保证 Future 所表示的内存位置不会改变**，从而底层状态机字段中的“self-引用”依然有效。</li>
</ul>
<h2 data-id="heading-33">六、总结</h2>
<p>Pin主要保证 !Unpin 类型在内存中的地址固定，比如自引用类型、异步 Future 类型（async/await 内部状态机）、底层异步 I/O 驱动（如 Tokio 内部 task、io_uring buffer）。理解起来有点复杂，对普通类型或短生命周期变量没必要使用，除非是明确的需求。如果用的话，能用安全 API 就不用 unsafe；只能 unsafe 的地方，要保证对象绝对不动。</p>
<p>如果觉得有用，请点个关注吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[云原生，与云计算、云服务的区别与联系]]></title>    <link>https://juejin.cn/post/7569977160275771435</link>    <guid>https://juejin.cn/post/7569977160275771435</guid>    <pubDate>2025-11-09T13:12:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569977160275771435" data-draft-id="7569910533509464083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="云原生，与云计算、云服务的区别与联系"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-09T13:12:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            云原生，与云计算、云服务的区别与联系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:12:47.000Z" title="Sun Nov 09 2025 13:12:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>为了帮助你快速理解云原生、云计算和云服务的关系与区别，我先用一个表格来汇总它们的核心特征。</p>



































<table><thead><tr><th>维度</th><th><strong>云计算</strong></th><th><strong>云服务</strong></th><th><strong>云原生</strong></th></tr></thead><tbody><tr><td><strong>核心定位</strong></td><td>一种<strong>基础范式与商业模式</strong>，提供按需使用的计算资源池</td><td>云计算的<strong>产品形态和交付方式</strong></td><td>一套<strong>构建和运行应用的方法论与技术集合</strong></td></tr><tr><td><strong>关键特征/模式</strong></td><td>资源池化、按需自助、快速弹性、网络访问</td><td><strong>IaaS, PaaS, SaaS</strong>等分层服务模式</td><td><strong>容器、微服务、DevOps、不可变基础设施、声明式API</strong></td></tr><tr><td><strong>核心价值</strong></td><td>像使用水电气一样<strong>按需使用IT资源</strong>，降低IT成本与运维复杂性</td><td>将IT能力作为<strong>即开即用的服务</strong>提供，简化获取过程</td><td>让应用<strong>天生具备弹性、韧性，易于频繁变更与管理</strong>，最大化释放云价值</td></tr><tr><td><strong>形象比喻</strong></td><td><strong>电厂</strong>（发电能力）</td><td><strong>供电服务</strong>（220V插座/专属电路）</td><td><strong>高效用电的整套方案</strong>（节能家电、智能配电）</td></tr></tbody></table>
<h3 data-id="heading-0">☁️ 理解云计算</h3>
<p>云计算是一种<strong>颠覆性的计算模式</strong>。它通过网络（主要是互联网）将庞大的计算资源（如服务器、存储、数据库、网络、软件等）整合成可配置的资源池，让你能够像使用水和电一样，按需使用、按量付费 。</p>
<p>它的核心价值在于：</p>
<ul>
<li><strong>降低门槛</strong>：你无需自建昂贵的数据中心，极大降低了初始投资和运维成本 。</li>
<li><strong>弹性伸缩</strong>：可根据业务高峰和低谷动态调整资源，避免资源闲置或不足 。</li>
<li><strong>高可靠性</strong>：云服务商通常在全球布局多个数据中心，保障服务的连续性和数据安全 。</li>
</ul>
<h3 data-id="heading-1">🔌 认识云服务</h3>
<p>云服务是云计算理念的<strong>具体产品和商业实现</strong>。它明确了云计算资源是如何以一种标准化的方式交付给用户的。通常分为三个层次 ：</p>
<ul>
<li><strong>IaaS</strong>：提供最基础的计算、网络、存储资源。这就像你租用了一间毛坯房，里面的装修和家具（操作系统、应用程序）需要自己负责。例如<strong>阿里云的ECS云服务器</strong>、亚马逊的AWS 。</li>
<li><strong>PaaS</strong>：除了基础设施，还提供了操作系统、数据库、开发工具等平台软件。这相当于租用了一间精装公寓，你可以直接布置家居（开发部署自己的应用）。例如<strong>百度云的应用引擎BAE</strong>。</li>
<li><strong>SaaS</strong>：直接提供可使用的应用软件。这就像直接入住酒店，所有设施服务一应俱全，开箱即用。例如<strong>钉钉、企业微信</strong>等 。</li>
</ul>
<h3 data-id="heading-2">🚀 掌握云原生</h3>
<p>云原生是一套<strong>最佳实践和方法论</strong>，指导我们如何<strong>充分利用云计算的优势来设计、开发和部署应用</strong>。它回答的是“如何更好地在云上构建和运行应用”这个问题 。</p>
<p>它的技术基石包括：</p>
<ul>
<li><strong>容器化</strong>：实现应用及其依赖的标准化打包和隔离，确保环境一致性 。</li>
<li><strong>微服务</strong>：将大型单体应用拆分为一组小型、松耦合的服务，每个服务可独立开发、部署和扩展 。</li>
<li><strong>DevOps</strong>：结合文化、实践与工具，促进开发与运维团队紧密协作，实现持续集成和持续交付 。</li>
<li><strong>声明式API与不可变基础设施</strong>：通过描述“期望的状态”来管理系统和基础设施，使系统更加健壮和易于维护 。</li>
</ul>
<h3 data-id="heading-3">🔗 三者关联</h3>
<p>简单来说，<strong>云计算是基础和理念，云服务是产品和交付，云原生则是方法和路径</strong>。</p>
<ul>
<li>企业通过<strong>云服务</strong>的形式来消费<strong>云计算</strong>的巨大能力。</li>
<li>而采用<strong>云原生</strong>的架构和方式来开发部署应用，才能最充分地释放<strong>云计算</strong>的潜力，用好<strong>云服务</strong>。</li>
</ul>
<p>可以理解为，云计算提供了“电厂”般的强大算力；云服务是为你接通电力的“标准插座”；而云原生则是一套“高效利用电能的现代家电和智能家居方案”，让你不仅能用上电，还能用得智能、高效、可靠。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从傅里叶变换到 RoPE：解构位置编码的数学灵魂]]></title>    <link>https://juejin.cn/post/7570247858869927988</link>    <guid>https://juejin.cn/post/7570247858869927988</guid>    <pubDate>2025-11-09T13:13:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570247858869927988" data-draft-id="7570213477950013492" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从傅里叶变换到 RoPE：解构位置编码的数学灵魂"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-09T13:13:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mwq30123"/> <meta itemprop="url" content="https://juejin.cn/user/3403743729030686"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从傅里叶变换到 RoPE：解构位置编码的数学灵魂
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743729030686/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mwq30123
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:13:25.000Z" title="Sun Nov 09 2025 13:13:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从傅里叶变换到 RoPE：解构位置编码的数学灵魂</h2>
<p>旋转位置编码 (RoPE) 的天才之处，并不仅仅在于它使用了 <code>sin</code> 和 <code>cos</code> 函数。它真正的革命性在于，它将<strong>傅里叶变换的“时移定理”</strong> （Time-Shift Theorem）从一个分析工具，转变成了 Transformer 注意力机制的<strong>内建架构</strong>。</p>
<p>与原始 Transformer 将位置信息“相加”不同，RoPE 通过“旋转”（即复数乘法）来注入位置。这种设计在数学上<strong>强行保证</strong>了注意力分数<strong>只</strong>依赖于词符间的<strong>相对位置 (m-n)</strong> ，从而从根本上解决了绝对位置编码的诸多弊端。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5a77ae64499486fac68369f997f2153~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbXdxMzAxMjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763298805&amp;x-signature=p9U%2B9c2jcqxtVfzOyFmwV79z5Lc%3D" alt="傅里叶变换.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">1. 问题的根源：注意力机制的“位置色盲”</h3>
<p>Transformer 的核心——自注意力机制（Self-Attention）——天生具有“置换不变性”。这意味着，对于模型来说，<code>["我", "打", "你"]</code> 和 <code>["你", "打", "我"]</code> 在计算注意力时是完全等价的，因为它只关心词符之间的“内容”互动，而不关心它们的“顺序”。</p>
<p>为了解决这个“位置色盲”，我们必须以某种方式将“位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span></span></span></span></span>”和“位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">n</span></span></span></span></span>”的信息注入模型。</p>
<h4 data-id="heading-2">1.1 原始方案：加性的绝对编码 (APE)</h4>
<p>原始论文《Attention Is All You Need》提出了一种精妙的方案：</p>
<ol>
<li>为每个绝对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">pos</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span></span> 计算一个基于多频率 <code>sin/cos</code> 的向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">PE_{pos}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>。</li>
<li>将这个位置向量**“加”**到词嵌入向量上：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>X</mi><mrow><mi>w</mi><mi>o</mi><mi>r</mi><mi>d</mi></mrow></msub><mo>+</mo><mi>P</mi><msub><mi>E</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{final} = X_{word} + PE_{pos}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ina</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>。</li>
</ol>
<p>这个方案（我们称之为 APE）是有效的，但它把一个难题留给了模型：</p>
<ul>
<li>模型看到的是一个“混合”向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{final}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ina</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>。</li>
<li>它必须**自行“学习”**如何从 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{final}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ina</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 中解耦出词义 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mi>w</mi><mi>o</mi><mi>r</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{word}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">or</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 和位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">PE_{pos}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>。</li>
<li>更重要的是，它必须**“学习”<strong>出 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><msub><mi>X</mi><mi>m</mi></msub><mo>+</mo><mi>P</mi><msub><mi>E</mi><mi>m</mi></msub><mo separator="true">,</mo><msub><mi>X</mi><mi>n</mi></msub><mo>+</mo><mi>P</mi><msub><mi>E</mi><mi>n</mi></msub><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle X_m + PE_m, X_n + PE_n \rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span></span></span></span></span> 这个复杂的点积中蕴含的“相对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(m-n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>”信息。这是一种</strong>间接且低效**的方式。</li>
<li>它在训练中只见过 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">PE_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 到 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mn>4095</mn></msub></mrow><annotation encoding="application/x-tex">PE_{4095}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4095</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>，当 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mn>5000</mn></msub></mrow><annotation encoding="application/x-tex">PE_{5000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 出现时，模型会彻底“崩溃”，因为它从未见过这个位置的编码，导致<strong>外推性 (Extrapolation) 极差</strong>。</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. 傅里叶变换的启示：时移即“相旋”</h3>
<p>为了找到更好的方案，我们必须回到信号处理的本源——傅里叶变换。</p>
<p>傅里叶变换的核心思想是：任何时域信号 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> 都可以分解为不同频率 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>ω</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\omega)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mclose">)</span></span></span></span></span> 的 <code>sin</code> 和 <code>cos</code> 波的叠加。</p>
<p>而在所有特性中， <strong>“时移定理” (Shift Theorem)</strong> 是我们的关键：</p>
<blockquote>
<p>时移定理（简易版）：</p>
<p>一个信号在时域的平移 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t+n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>，对应到频域上是一个相位的旋转。</p>
</blockquote>
<p>让我们用最纯粹的数学形式（复数）来表达：</p>
<ol>
<li>
<p>一个单一频率 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi></mrow><annotation encoding="application/x-tex">\omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span></span></span></span></span> 的波，在时间 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord mathnormal">t</span></span></span></span></span> 的“编码”是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>ω</mi><mi>t</mi></mrow></msup></mrow><annotation encoding="application/x-tex">f(t) = e^{i\omega t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8247em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">iω</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span></span></span></span>。</p>
</li>
<li>
<p>那么，在时间 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">t+n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"/><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">n</span></span></span></span></span>（即平移了 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">n</span></span></span></span></span>）的“编码”是什么？</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>ω</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>ω</mi><mi>t</mi></mrow></msup><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>ω</mi><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">f(t+n) = e^{i\omega(t+n)} = e^{i\omega t} \cdot e^{i\omega n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">iω</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8247em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">iω</span><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8247em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">iωn</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
</li>
<li>
<p>我们得到了一个惊人的公式： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t+n) = f(t) \cdot f(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> （注：这里 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>ω</mi><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">f(n) = e^{i\omega n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8247em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">iωn</span></span></span></span></span></span></span></span></span></span></span></span></span>）</p>
</li>
</ol>
<p>这个公式告诉我们： <strong>“平移后”的编码 = “原始编码” 乘以 “平移量对应的旋转因子”</strong> 。</p>
<p>这种关系是<strong>乘性的 (Multiplicative)</strong> ，而不是加性的。</p>
<hr/>
<h3 data-id="heading-4">3. RoPE：将“时移定理”注入注意力</h3>
<p>RoPE 的设计者（苏剑林）敏锐地抓住了这个点。我们希望注意力 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Attention(m, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> 只依赖于相对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(m-n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>。我们如何利用上述的“乘性”关系呢？</p>
<h4 data-id="heading-5">3.1 目标重设</h4>
<p>我们不再将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">PE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span></span></span></span></span>“加”到 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span> 上。我们定义一种新的 Query 和 Key，它们是位置的函数。</p>
<p>我们希望： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><msub><mi>q</mi><mi>m</mi></msub><mo separator="true">,</mo><msub><mi>k</mi><mi>n</mi></msub><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle q_m, k_n \rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span></span></span></span></span> 能够只由 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">q, k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(m-n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> 决定。</p>
<h4 data-id="heading-6">3.2 傅里叶“旋转”的实现</h4>
<p>RoPE 正是傅里叶时移定理的直接应用。为了简化，我们暂时使用复数（RoPE 的实际实现就是 2D 旋转，与复数乘法等价）。</p>
<p>RoPE 将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">d</span></span></span></span></span> 维向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span> 分解为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">d/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">d</span><span class="mord">/2</span></span></span></span></span> 个复数 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">q_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>。对每一个复数（代表一个特定的频率 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>）：</p>
<ol>
<li>
<p>定义 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">q_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>（Query 在位置 m）： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>m</mi></msub><mo>=</mo><msub><mi>q</mi><mi>j</mi></msub><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>m</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">q_m = q_j \cdot e^{im\theta_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7306em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8491em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">im</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> （这就是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> 乘以 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></span>）</p>
</li>
<li>
<p>定义 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">k_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>（Key 在位置 n）：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>n</mi></msub><mo>=</mo><msub><mi>k</mi><mi>j</mi></msub><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>n</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">k_n = k_j \cdot e^{in\theta_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8491em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> （这就是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span> 乘以 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>）</p>
</li>
</ol>
<p>现在，让我们计算 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>q</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">q_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">k_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 之间的（复数）点积，这对应于注意力分数：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>Attention</mtext><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>∝</mo><msub><mi>q</mi><mi>m</mi></msub><mo>⋅</mo><msubsup><mi>k</mi><mi>n</mi><mo>∗</mo></msubsup><mspace width="1em"/><mo stretchy="false">(</mo><mtext>* 表示共轭</mtext><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mo stretchy="false">(</mo><msub><mi>q</mi><mi>j</mi></msub><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>m</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><msub><mi>k</mi><mi>j</mi></msub><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>n</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup><msup><mo stretchy="false">)</mo><mo>∗</mo></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mo stretchy="false">(</mo><msub><mi>q</mi><mi>j</mi></msub><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>m</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><msubsup><mi>k</mi><mi>j</mi><mo>∗</mo></msubsup><mo>⋅</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>i</mi><mi>n</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mo stretchy="false">(</mo><msub><mi>q</mi><mi>j</mi></msub><mo>⋅</mo><msubsup><mi>k</mi><mi>j</mi><mo>∗</mo></msubsup><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><msup><mi>e</mi><mrow><mi>i</mi><mi>m</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup><mo>⋅</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>i</mi><mi>n</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mo stretchy="false">(</mo><msub><mi>q</mi><mi>j</mi></msub><mo>⋅</mo><msubsup><mi>k</mi><mi>j</mi><mo>∗</mo></msubsup><mo stretchy="false">)</mo><mo>⋅</mo><msup><mi>e</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\text{Attention}(m, n) &amp;\propto q_m \cdot k_n^* \quad (\text{* 表示共轭}) \\
&amp;= (q_j \cdot e^{i m \theta_j}) \cdot (k_j \cdot e^{i n \theta_j})^* \\
&amp;= (q_j \cdot e^{i m \theta_j}) \cdot (k_j^* \cdot e^{-i n \theta_j}) \\
&amp;= (q_j \cdot k_j^*) \cdot (e^{i m \theta_j} \cdot e^{-i n \theta_j}) \\
&amp;= (q_j \cdot k_j^*) \cdot e^{i (m - n) \theta_j}
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.8446em;vertical-align:-3.6723em;"/><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.1723em;"><span style="top:-6.3323em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span><span style="top:-4.7732em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span><span style="top:-3.2141em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span><span style="top:-1.6319em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span><span style="top:-0.0108em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.6723em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.1723em;"><span style="top:-6.3323em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∝</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-2.453em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:1em;"/><span class="mopen">(</span><span class="mord text"><span class="mord">* </span><span class="mord cjk_fallback">表示共轭</span></span><span class="mclose">)</span></span></span><span style="top:-4.7732em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">im</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2141em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">im</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-2.453em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">in</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-1.6319em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-2.453em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">im</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">in</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-0.0108em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-2.453em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.6723em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p><strong>这就是 RoPE 的魔法所在！</strong></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>q</mi><mi>j</mi></msub><mo>⋅</mo><msubsup><mi>k</mi><mi>j</mi><mo>∗</mo></msubsup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(q_j \cdot k_j^*)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1448em;vertical-align:-0.3948em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6887em;"><span style="top:-2.4413em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>：这部分只与<strong>内容 (content)</strong> 有关。</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo><msub><mi>θ</mi><mi>j</mi></msub></mrow></msup></mrow><annotation encoding="application/x-tex">e^{i(m-n)\theta_j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">n</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>：这部分只与<strong>相对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(m-n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></strong> 有关。</li>
</ul>
<p>RoPE 通过<strong>乘性（旋转）<strong>操作，<strong>在数学上</strong>将内容和相对位置</strong>完美地解耦</strong>了。</p>
<h4 data-id="heading-7">3.3 频率的多尺度（类比“进制”）</h4>
<p>在 RoPE 中，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 的值（即频率）也不是单一的，而是采用了和 APE 类似的多尺度设计：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub><mo>=</mo><mn>1000</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>2</mn><mi>j</mi><mi mathvariant="normal">/</mi><mi>d</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\theta_j = 10000^{-2j/d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.938em;"/><span class="mord">1000</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mord mtight">/</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<ul>
<li><strong>低 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> 维度：</strong> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 值大，频率<strong>高</strong>（旋转快，像时钟的“秒针”），捕捉精细的短程相对位置。</li>
<li><strong>高 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> 维度：</strong> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> 值小，频率<strong>低</strong>（旋转慢，像时钟的“时针”），捕捉粗粒度的长程相对位置。</li>
</ul>
<p>用不同的“位”或“频率”来捕捉不同尺度的信息。</p>
<hr/>
<h3 data-id="heading-8">4. 结论：加法 vs 乘法</h3>








































<table><thead><tr><th><strong>特性</strong></th><th><strong>原始 APE (加法)</strong></th><th><strong>RoPE (乘法/旋转)</strong></th></tr></thead><tbody><tr><td><strong>集成方式</strong></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>+</mo><mi>P</mi><msub><mi>E</mi><mrow><mi>a</mi><mi>b</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X + PE_{abs}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ab</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>m</mi></msub><mo>⋅</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">R_m \cdot q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>n</mi></msub><mo>⋅</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">R_n \cdot k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span></span></td></tr><tr><td><strong>数学原理</strong></td><td>线性叠加</td><td>傅里叶时移定理（复数乘法）</td></tr><tr><td><strong>模型负担</strong></td><td>必须**“学习”**出相对位置</td><td>相对位置**“内建”**于数学结构</td></tr><tr><td><strong>编码对象</strong></td><td>绝对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span></span></span></span></span></td><td>绝对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">n</span></span></span></span></span></td></tr><tr><td><strong>解码结果</strong></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><msub><mi>q</mi><mi>m</mi></msub><mo separator="true">,</mo><msub><mi>k</mi><mi>n</mi></msub><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle q_m, k_n \rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span></span></span></span></span> 中<strong>混杂</strong>着绝对和相对信息</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><msub><mi>q</mi><mi>m</mi></msub><mo separator="true">,</mo><msub><mi>k</mi><mi>n</mi></msub><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle q_m, k_n \rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span></span></span></span></span> 中<strong>只包含</strong>相对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(m-n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></td></tr><tr><td><strong>外推性</strong></td><td>极差</td><td>较好（为位置内插 PI 提供了基础）</td></tr></tbody></table>
<p><strong>总结：</strong></p>
<p>RoPE 与傅里叶变换的联系，远不止于“都用了 <code>sin/cos</code>”。</p>
<p>RoPE 是一种架构上的飞跃：它不再满足于给模型提供“绝对位置”的线索（加法 APE），而是利用傅里ye变换最核心的“时移-相旋”特性，<strong>将相对位置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(m-n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span> 的计算，变成了注意力机制的内生本能</strong>。这是一种远比加法更优雅、更符合数学原理的解决方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch 避坑指南：我在项目中总结的 14 条实用经验]]></title>    <link>https://juejin.cn/post/7569959427879567370</link>    <guid>https://juejin.cn/post/7569959427879567370</guid>    <pubDate>2025-11-09T13:45:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569959427879567370" data-draft-id="7567249547006607387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch 避坑指南：我在项目中总结的 14 条实用经验"/> <meta itemprop="keywords" content="Elasticsearch,后端,性能优化"/> <meta itemprop="datePublished" content="2025-11-09T13:45:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="红尘旅人"/> <meta itemprop="url" content="https://juejin.cn/user/3485898277388519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch 避坑指南：我在项目中总结的 14 条实用经验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485898277388519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    红尘旅人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:45:03.000Z" title="Sun Nov 09 2025 13:45:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>刚开始接触 Elasticsearch 时，我觉得它就像个黑盒子——数据往里一扔，查询语句一写，结果就出来了。直到负责公司核心业务的搜索模块后，我才发现这个黑盒子里面藏着无数需要注意的细节。</p>
</blockquote>
<hr/>
<p>今天就把我在实际项目中积累的 ES 使用经验分享给大家，主要从<strong>索引设计</strong>、<strong>字段类型</strong>、<strong>查询优化</strong>、<strong>集群管理</strong>和<strong>架构设计</strong>这几个方面来展开。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed326ed06d3f41ec9c1ee1010da01c42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qi5bCY5peF5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763300702&amp;x-signature=kA3%2FCjHgK3B0Ze8upiBaoF5nBzE%3D" alt="20251102-4.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">索引设计：从基础到进阶</h2>
<h3 data-id="heading-1">1. 索引别名（alias）：为变更留条后路</h3>
<p>刚开始做项目时，我习惯直接用索引名。直到有一次需要修改字段类型，才发现 <strong>ES 不支持直接修改映射，也不支持修改主分片数</strong>，必须重建索引。（**新增字段是可以的）</p>
<p><strong>解决方案很简单</strong>：使用<strong>索引别名</strong>。业务代码中永远使用别名，重建索引时只需要切换别名的指向，整个过程用户无感知。</p>
<p>这就好比给索引起了个"外号"，里面怎么换内容都不影响外面的人称呼它。</p>
<h3 data-id="heading-2">2. Routing 路由：让查询更精准</h3>
<p>在做 <strong>SaaS 电商系统</strong>时，我发现查询某个商家的订单数据特别慢。原来，<strong>默认情况下ES根据文档ID的哈希值分配分片</strong>，导致同一个商家的数据分散在不同分片上。</p>
<p><strong>优化方案</strong>：使用商家 ID 作为 <strong>routing key</strong>，存储和查询数据时指定routing key。这样，同一个商家的所有数据都会存储在同一个分片上。</p>
<p><strong>效果对比</strong>：</p>
<ul>
<li>优化前：查询要扫描所有分片（比如3个分片都要查）</li>
<li>优化后：只需要查1个分片</li>
<li><strong>结果</strong>：查询速度直接翻倍，资源消耗还更少</li>
</ul>
<h3 data-id="heading-3">3. 分片拆分：应对数据增长</h3>
<p>当单个索引数据量持续增长时，单纯增加分片数并不是最佳方案。</p>
<p><strong>我的经验是</strong>：</p>
<ul>
<li><strong>业务索引</strong>：单个分片控制在 10-30GB</li>
<li><strong>搜索索引</strong>：10GB 以内更合适</li>
<li><strong>日志索引</strong>：可以放宽到 20-50GB</li>
</ul>
<p>对于 SaaS 系统，ES单索引数据较大，且存在“超级大商户”，导致数据倾斜严重时，可以按<strong>商家ID%64取模</strong>进行索引拆分，比如 <code>orders_001</code> 到 <code>orders_064</code>，每个索引包含部分商家的数据，然后再根据商户ID指定routing key。</p>
<blockquote>
<p>请根据<strong>业务数据量</strong>和<strong>业务要求</strong>，选择最适合的<strong>分片拆分规则</strong> 和<strong>routing key路由算法</strong>，同时不要因为拆分不合理，导致ES节点中存在大量分片。</p>
<p>ES默认<strong>单节点分片最大值为1000</strong>(7.0版本后)，可以参考ES官方建议，<strong>堆内存分片数量</strong>维持大约<strong>1:20</strong>的比例</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">字段类型：选择比努力重要</h2>
<h3 data-id="heading-5">4. Text vs Keyword：理解它们的本质区别</h3>
<p>曾经有个坑：用户手机号用 <strong>text 类型</strong>存储，结果搜索完整的手机号却搜不到。原来 text 类型会被分词，<code>13800138000</code> 可能被拆成 <code>138</code>、<code>0013</code>、<code>8000</code> 等片段。</p>
<p><strong>正确做法</strong>：</p>
<ul>
<li>需要分词搜索的用 <strong>text</strong>（如商品描述）</li>
<li>需要精确匹配的用 <strong>keyword</strong>（如订单号、手机号），适合 <strong>term、terms</strong> 等精确查询</li>
<li><strong>效果</strong>：keyword 类型的 term 查询速度更快，存储空间更小</li>
</ul>
<h3 data-id="heading-6">5. 多字段映射（multi-fields）：按需使用不浪费</h3>
<p>ES 默认会为 text 字段创建 keyword 子字段，但这并不总是必要的。</p>
<p><strong>我的选择</strong>：</p>
<ul>
<li>确定字段需要<strong>精确匹配和聚合</strong>时：启用 <strong>multi-fields</strong></li>
<li>只用于全文搜索时：禁用 multi-fields</li>
<li><strong>好处</strong>：节省存储空间，提升写入速度</li>
</ul>
<h3 data-id="heading-7">6. 排序字段：选对类型提升性能</h3>
<p>用 keyword 字段做数值排序是个常见误区。比如价格排序，<code>100</code> 会排在 <code>99</code> 前面，因为它是按字符串顺序比较的。</p>
<p><strong>推荐做法</strong>：</p>
<ul>
<li>数值排序：用 <strong>long、integer</strong> 类型</li>
<li>时间排序：用 <strong>date</strong> 类型</li>
<li><strong>提升效果</strong>：排序速度提升明显，内存占用也更少</li>
</ul>
<hr/>
<h2 data-id="heading-8">查询优化：平衡速度与精度</h2>
<h3 data-id="heading-9">7. 模糊查询：了解正确的打开方式</h3>
<p>在 <strong>ES 7.9 之前</strong>，<strong>wildcard 查询</strong>是个性能陷阱。它基于正则表达式引擎，前导通配符会导致全量词项扫描。</p>
<p><strong>现在的方案</strong>：</p>
<ul>
<li><strong>ES7.9+</strong>：使用 <strong>wildcard 字段类型</strong></li>
<li><strong>优势</strong>：底层使用优化的 <strong>n-gram</strong> + <strong>二进制 doc value</strong> 机制，性能提升显著</li>
</ul>
<blockquote>
<p>提示：ES7.9前后版本wildcard的具体介绍，可以参考我的上一篇文章</p>
<p><a href="https://juejin.cn/post/7567581946144522291" target="_blank" title="https://juejin.cn/post/7567581946144522291">《与产品经理的“模糊”对决：Elasticsearch实现MySQL LIKE '%xxx%'》</a></p>
</blockquote>
<h3 data-id="heading-10">8. 分页查询：避免深度分页的坑</h3>
<p>产品经理曾要求实现"无限滚动"，我展示了深度分页的性能数据后，大家达成共识：<strong>业务层面避免深度分页才是根本解决方案</strong>。就像淘宝、Google 这样的大厂，也都对分页做了限制，这不仅是技术考量，更是用户体验的最优选择。</p>
<p><strong>技术方案</strong>（仅在确实无法避免时考虑）：</p>
<ul>
<li><strong>浅分页</strong>：使用 <code>from/size</code>，适合前几页的常规分页</li>
<li><strong>Scroll</strong>：适合大数据量导出，但需要维护 scroll_id 和历史快照，对服务器资源消耗较大</li>
<li><strong>search_after</strong>：基于上一页最后一条记录进行分页，但无法跳转任意页面，且频繁查询会增加服务器压力</li>
</ul>
<p>需要强调的是，这些技术方案都存在各自的局限性，<strong>业务设计上的规避始终是最佳选择</strong>。</p>
<hr/>
<h2 data-id="heading-11">集群管理：保障稳定运行</h2>
<h3 data-id="heading-12">9. 索引生命周期：自动化运维</h3>
<p>日志数据的特点是源源不断，如果不加管理，磁盘很快就会被撑满。</p>
<p><strong>我的做法</strong>：</p>
<ul>
<li>按天创建索引（如 log_20231201）</li>
<li>设置保留策略（保留7天或30天）</li>
<li>结合模板自动化管理</li>
</ul>
<h3 data-id="heading-13">10. 准实时性：理解刷新机制</h3>
<p>很多新手会困惑：为什么数据写入后不能立即搜索？</p>
<p><strong>原理</strong>：<strong>ES 默认 1 秒刷新一次索引</strong>，这是为了在实时性和写入性能之间取得平衡。</p>
<p><strong>调整建议</strong>：</p>
<ul>
<li>实时性要求高：保持 1s</li>
<li>写入量大：适当调大 refresh_interval</li>
</ul>
<blockquote>
<p><strong>补充说明</strong>：如果需要更新后立即能查询到，通常有两种方案：</p>
<ol>
<li>让前端直接展示刚提交的数据，等下一次调用接口时再查询 ES</li>
<li>更新完后，前端延迟 1.5 秒后再查询</li>
</ol>
<p><strong>关键点</strong>：业务需求不一定都要后端实现，可以结合前端一起考虑解决方案。</p>
</blockquote>
<h3 data-id="heading-14">11. 内存配置：32G 限制的真相</h3>
<p>为什么 ES 官方建议不要超过 32G 内存？</p>
<p><strong>技术原因</strong>：Java 的<strong>压缩指针技术</strong>在 32G 以内有效，超过这个限制会浪费大量内存。</p>
<p><strong>实践建议</strong>：单个节点配置约50%内存，留出部分给操作系统。</p>
<hr/>
<h2 data-id="heading-15">架构设计：合理的分工协作</h2>
<h3 data-id="heading-16">12. ES 与数据库：各司其职</h3>
<p>曾经试图在 ES 里存储完整的业务数据，结果遇到<strong>数据一致性</strong>问题。</p>
<p><strong>现在的方案</strong>：</p>
<ul>
<li><strong>ES</strong>：存储搜索条件和文档 ID</li>
<li><strong>数据库</strong>：存储完整业务数据</li>
<li><strong>查询</strong>：ES 找 ID，数据库取详情</li>
</ul>
<p><strong>好处</strong>：既享受 ES 的搜索能力，又保证数据的强一致性。</p>
<h3 data-id="heading-17">13. 嵌套对象：保持数据关联性</h3>
<p>处理商品规格这类数组数据时，用普通的 <strong>object 类型</strong>会导致数据扁平化，破坏对象间的关联。</p>
<p><strong>解决方案</strong>：使用 <strong>nested 类型</strong>，保持数组内对象的独立性，确保查询结果的准确性。</p>
<h3 data-id="heading-18">14. 副本配置：读写平衡的艺术</h3>
<p>副本可以提升查询能力，但也不是越多越好。</p>
<p><strong>经验值</strong>：</p>
<ul>
<li>大多数场景：<strong>1 个副本</strong>足够</li>
<li>高查询压力：可适当增加</li>
<li><strong>注意</strong>：副本越多，写入压力越大</li>
</ul>
<hr/>
<h2 data-id="heading-19">写在最后</h2>
<p>这些经验都是在解决实际问题中慢慢积累的。就像修路一样，开始可能只是简单铺平，随着车流量的增加，需要不断优化——设置红绿灯、划分车道、建立立交桥。使用 ES 也是同样的道理，随着业务的发展，需要不断调整和优化。</p>
<p>最大的体会是：<strong>理解原理比记住命令更重要</strong>。只有明白了为什么这样设计，才能在遇到新问题时找到合适的解决方案。</p>
<blockquote>
<p>如果有人问我："ES 怎么才能用得更好？"我的回答是："先理解业务场景，再选择技术方案。就像我们之前做的模糊搜索，不是简单地用 wildcard，而是根据 ES 版本选择最优解。"</p>
</blockquote>
<p><strong>技术的价值不在于多复杂，而在于能否优雅地解决实际问题。与大家共勉。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[美团CatPaw：代码“撸”得飞起，AI帮你轻松实现！]]></title>    <link>https://juejin.cn/post/7570197010885247022</link>    <guid>https://juejin.cn/post/7570197010885247022</guid>    <pubDate>2025-11-09T13:53:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570197010885247022" data-draft-id="7569976345931218995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="美团CatPaw：代码“撸”得飞起，AI帮你轻松实现！"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-09T13:53:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            美团CatPaw：代码“撸”得飞起，AI帮你轻松实现！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:53:55.000Z" title="Sun Nov 09 2025 13:53:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是你们的老朋友，混迹AI编程圈多年的观察者。最近，美团在AI编程领域又搞出了大动作，推出了一款名为<strong>CatPaw</strong>的AI集成开发环境（IDE）。这可不是一般的代码辅助工具，它简直是冲着彻底改变开发者工作流去的！今天，我就带大家深入盘盘这个号称“智能伙伴”的CatPaw，看看它到底有何魔力。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-09_21.45.02-1024x513.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-09_21.45.02-1024x513.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2edaf0df414445b98409e428d3be0946~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301235&amp;x-signature=9iHi8ehw5ENKRHfc2fBfKpEAKrQ%3D" alt="iShot_2025-11-09_21.45.02" loading="lazy"/></a></p>
<h3 data-id="heading-0">🐱 CatPaw：你的代码“智能伙伴”究竟是何方神圣？</h3>
<p>想象一下，你的IDE不再是冰冷的编辑器，而是一个能理解你意图、预测你需求、甚至能与你对话的智能助手。这就是CatPaw的核心愿景。它不仅是一个AI驱动的IDE，更被设计成每一位开发者的“智能伙伴”，旨在让大家从繁琐中解脱，专注于代码的灵魂——创新与实现。</p>
<p>为了让大家快速抓住重点，我整理了CatPaw的几大“杀手锏”：</p>
<h4 data-id="heading-1">一、四大绝招，提升效率不止一点点</h4>
<ol>
<li>
<p><strong>代码补全：神来之笔，无需等待</strong> 这可不是简单的字符联想，CatPaw的实时代码补全能力，是基于你当前的编码上下文进行深度理解，智能预测你可能需要的整行代码，甚至是一个完整的函数。当你按下 <code>Tab</code> 键的那一刻，就像有位资深前辈在你耳边低语，帮你瞬间完成“神来之笔”，效率直接拉满。</p>
</li>
<li>
<p><strong>问答生码：你的编程私教，随叫随到</strong> 还在为某个算法逻辑绞尽脑汁？或者对一个陌生的API感到困惑？CatPaw内置的AI助手，允许你直接用自然语言提问。无论是寻求代码片段、解释复杂概念，还是探讨解决方案，它都能即时给出回应，无需切换窗口，一个“AI编程私教”就这么随时待命。</p>
</li>
<li>
<p><strong>预览调试：前端开发者的福音，所见即所得</strong> 对于前端开发者来说， CatPaw简直是“梦中情IDE”。它内置了浏览器，支持前端代码的实时渲染和调试。这意味着你修改一行CSS，就能立刻看到效果，甚至能直接将页面元素“甩”给AI，让它帮你分析并优化，真正实现“所见即所得”的开发体验。</p>
</li>
<li>
<p><strong>项目级分析：从宏观到微观，洞察一切</strong> 这功能可就厉害了。CatPaw能够自动扫描并理解整个代码库，不仅仅是文件，而是整个项目的结构、模块依赖、潜在的重构点，甚至是潜藏的bug。特别是对于新加入项目的成员，它能像一位经验丰富的架构师，帮你快速掌握项目全貌，给出全局性的优化建议。</p>
</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-09_21.44.50-1024x659.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-09_21.44.50-1024x659.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fe7a4545f6b456687c6a0e661ff8e92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301235&amp;x-signature=UeeJ%2BM6%2B5Fgv6Y0WcZcWIE4vCIQ%3D" alt="iShot_2025-11-09_21.44.50" loading="lazy"/></a></p>
<h4 data-id="heading-2">二、深挖技术腹地：LongCat与ReAct的黑科技</h4>
<p>CatPaw之所以能有这些强大的功能，离不开美团在底层模型上的硬核实力。</p>
<p>它的核心驱动力来源于美团自研的<strong>LongCat大模型</strong>。这可不是一个泛泛而谈的模型，它是一个参数量高达5600亿的混合专家模型，支持128K tokens的超长上下文。想象一下，这意味着AI可以“读懂”你项目里更多的代码，拥有更强的“记忆力”去理解你的编码意图。LongCat还创新性地采用了“零计算专家”机制和“快捷连接MoE”架构，简单来说，就是它能智能地识别代码中的简单部分，避免不必要的计算，同时优化计算和通信的效率，从而在保证高性能的同时，大幅降低算力消耗，提升推理速度——据称单用户生成速度能超过100 tokens/s。</p>
<p>而在交互层面，CatPaw采用了<strong>ReAct框架</strong>，这让AI在多轮对话中能够保持上下文的连贯性，让你的“编程私教”越聊越懂你，对话体验自然流畅。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-09_21.44.45-1024x597.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-09_21.44.45-1024x597.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb582c8465b64939a5f01cf8f60dbc85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301235&amp;x-signature=lAI1A1SYjGjaWqeQTwN2nkn3ao4%3D" alt="iShot_2025-11-09_21.44.45" loading="lazy"/></a></p>
<h4 data-id="heading-3">三、双生花？CatPaw与NoCode，美团的两盘大棋</h4>
<p>值得一提的是，CatPaw并非美团在AI编程领域的首次尝试。早在2025年6月，美团就推出了名为<strong>NoCode</strong>的AI编程智能体。但它们俩定位截然不同，可以说是美团在AI编程领域下的两盘精妙大棋：</p>
<ul>
<li><strong>CatPaw</strong>：定位是面向<strong>专业开发者</strong>的集成开发环境，它深入到编码的每一个细节，提供更深度的集成和智能辅助，让专业程序员如虎添翼。</li>
<li><strong>NoCode</strong>：则更偏向“<strong>氛围编程</strong>”，主要面向产品经理、运营人员等<strong>非专业程序员</strong>。通过简单的自然语言对话，他们就能快速生成应用，极大地降低了编程门槛。</li>
</ul>
<p>尽管目标用户不同，但它们都共享着美团自研的LongCat大模型这个强大基因。据美团研发负责人透露，在内部，这两款工具已经共同支持了美团超过90%的工程师使用AI编程，每周约有50%的新代码是靠AI生成的——这组数据，足以证明美团在AI编程领域的决心和成果。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-09_21.44.21.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-09_21.44.21.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/325c256df2fc46fb83111c7bf6fc2f1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301235&amp;x-signature=vT75kfpgT9RnH8lw7vV8xpDAZi8%3D" alt="iShot_2025-11-09_21.44.21" loading="lazy"/></a></p>
<h4 data-id="heading-4">四、如何“撸”到CatPaw？你的专属体验指南</h4>
<p>如果你已经心痒难耐，想立马体验这款黑科技，美团也提供了便捷的尝鲜路径：</p>
<ol>
<li><strong>下载安装</strong>：目前CatPaw已在macOS 10.15及以上平台上线，你可以访问官方网站（<a href="https://link.juejin.cn?target=https%3A%2F%2Fcatpaw.meituan.com%2F%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD%25E5%25AE%2589%25E8%25A3%2585%25E5%258C%2585%25E3%2580%2582%25E5%25BD%2593%25E7%2584%25B6%25EF%25BC%258CWindows%25E7%2589%2588%25E6%259C%25AC%25E7%259A%2584%25E5%25BC%2580%25E5%258F%2591%25E8%2580%2585%25E4%25BB%25AC%25E4%25B9%259F%25E4%25B8%258D%25E8%25A6%2581%25E7%259D%2580%25E6%2580%25A5%25EF%25BC%258C%25E7%25BE%258E%25E5%259B%25A2%25E6%2589%25BF%25E8%25AF%25BAWindows%25E7%2589%2588%25E6%259C%25AC%25E5%258D%25B3%25E5%25B0%2586%25E6%258E%25A8%25E5%2587%25BA" target="_blank" title="https://catpaw.meituan.com/%EF%BC%89%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85%E3%80%82%E5%BD%93%E7%84%B6%EF%BC%8CWindows%E7%89%88%E6%9C%AC%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85%E4%BB%AC%E4%B9%9F%E4%B8%8D%E8%A6%81%E7%9D%80%E6%80%A5%EF%BC%8C%E7%BE%8E%E5%9B%A2%E6%89%BF%E8%AF%BAWindows%E7%89%88%E6%9C%AC%E5%8D%B3%E5%B0%86%E6%8E%A8%E5%87%BA" ref="nofollow noopener noreferrer">catpaw.meituan.com/）下载安装包。当然，W…</a>。</li>
<li><strong>注册与额度</strong>：新用户通过手机号或邮箱注册后，即可获得<strong>500次免费对话额度</strong>。每次与AI的交互都会消耗一次额度，用完后，可在设置页提交续充申请。目前来看，它仍处于免费使用阶段。</li>
<li><strong>无缝迁移</strong>：首次启动，CatPaw支持导入VS Code或Cursor等主流IDE的现有配置，让你能够实现零成本的切换，几乎感受不到迁移的阵痛。</li>
</ol>
<h3 data-id="heading-5">写在最后：AI编程的浪潮，你准备好了吗？</h3>
<p>美团CatPaw的推出，不仅仅是一个工具的更新，更是美团“AI at Work”战略的一个缩影，它在实打实地重塑着开发流程。从内部数据来看，高达50%的AI代码生成占比和超过80%的周活跃率，都预示着AI辅助编程已经从“辅助”走向了“主导”地位。</p>
<p>所以，美团CatPaw，到底值不值得一试？我想，答案不言而喻。在这个AI编程的浪潮中，抓住先行者的机会，也许，你与代码效率的下一个飞跃，就从CatPaw开始。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[孩子的名字有救了]]></title>    <link>https://juejin.cn/post/7569976345931235379</link>    <guid>https://juejin.cn/post/7569976345931235379</guid>    <pubDate>2025-11-09T13:57:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569976345931235379" data-draft-id="7569909335909138441" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="孩子的名字有救了"/> <meta itemprop="keywords" content="TypeScript,AI编程,微信小程序"/> <meta itemprop="datePublished" content="2025-11-09T13:57:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fthux"/> <meta itemprop="url" content="https://juejin.cn/user/3526889033182685"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            孩子的名字有救了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889033182685/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fthux
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:57:27.000Z" title="Sun Nov 09 2025 13:57:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">开发经历</h3>
<p>在孩子出生前很早起名字就排上了日程，当时起名字用到了各种AI，各种修改提示词，每天一有时间就点开AI，让AI吐N个名字出来，这种情况陆陆续续持续了好几个月，但始终还是没有满意的名字。后来还是回到了随机生成这条看天意的路上。看到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fholynova%2Fgushi_namer" target="_blank" title="https://github.com/holynova/gushi_namer" ref="nofollow noopener noreferrer">gushi_namer</a> 项目后，为了便于查看，我就做了一个丑陋不堪的 <code>mvp</code> 微信小程序（名语屋的原型），基于这个原型，我最终选中了6个名字（3男3女），然后和家里的领导请示，经领导批示，最终敲定了1男1女两个名字。而其中的一个名字，正是我孩子的正式名字。</p>
<p>从我确认了孩子的正式名字后，就想把这个原型整成正式的小程序（也许也有想要靠随机来起名字的同学），但是因为各种事情的耽搁，几个月后小程序才正式上线——名语屋。作为一个没有审美的搬砖工人，<code>UI</code> 页面基本上全部由 <code>Gemini</code> 生成。具体的链接可查看<a href="#UI%E7%94%9F%E6%88%90" title="#UI%E7%94%9F%E6%88%90">UI生成部分</a>。</p>
<p>最后，希望每个兄弟姐妹叔叔阿姨都能给自己的孩子取到心怡的名字。</p>
<h2 data-id="heading-1">名语屋</h2>
<blockquote>
<p>起名小程序</p>
</blockquote>
<p>从诗经、楚辞、唐诗宋词、乐府诗集、古诗三百首、著名楚辞等古典文籍中起名字</p>
<p align="center">
  <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a0eb0426f8344a681aae77f13aa560f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=1DAyvqKYNCIANcgf%2BOssC0a62zQ%3D" alt="小程序码" loading="lazy"/>
</p>
<h3 data-id="heading-2">特别感谢</h3>
<p>数据源来自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fholynova%2Fgushi_namer" target="_blank" title="https://github.com/holynova/gushi_namer" ref="nofollow noopener noreferrer">gushi_namer</a>。</p>
<h3 data-id="heading-3">仓库地址</h3>
<blockquote>
<ul>
<li>github 仓库地址 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffthux%2Fnomely" target="_blank" title="https://github.com/fthux/nomely" ref="nofollow noopener noreferrer">github.com/fthux/nomel…</a>。</li>
<li>gitee 仓库地址 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ffthux%2Fnomely" target="_blank" title="https://gitee.com/fthux/nomely" ref="nofollow noopener noreferrer">gitee.com/fthux/nomel…</a>。</li>
</ul>
</blockquote>
<h3 data-id="heading-4">UI生成</h3>
<p><code>UI</code> 页面基本上全部由 <code>Gemini</code> 生成，小程序版本做了一些小的UI调整和适配，完整的 <code>Gemini APP</code> 实现可访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fai.studio%2Fapps%2Fdrive%2F1P7XoluwC5s7CL1xeVv8NeXWjTQ_OwvHf" target="_blank" title="https://ai.studio/apps/drive/1P7XoluwC5s7CL1xeVv8NeXWjTQ_OwvHf" ref="nofollow noopener noreferrer">Google AI Studio</a>。贴几张 <code>Gemini</code> 生成的 <code>UI</code> 和小程序实现的 <code>UI</code>：</p>
<h4 data-id="heading-5"><code>Gemini</code> 实现</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbd6ae8212ad4192ad8c4f19410a82dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=UzyTTBTEbjCpJp1sHa9HNLUogo0%3D" alt="screenshot1.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8436234d6e2842fea295a8b4518ac0a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=91V8qewl3VSxtHhsFJpBf3MiRuc%3D" alt="screenshot2.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aaed1f5c0c1421e816a12959bbba5ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=8RO07k33DNbxa4vY44VCe09kNmc%3D" alt="screenshot3.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3808eeae52e6425aa232136c22641993~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=kMbzFGCzHn77uAew%2FmvBdr%2FqfeI%3D" alt="screenshot4.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c49a290d284c31be3e7c4456e8f138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=slRvYN7F3f6oHYn0MWHeexuOiDw%3D" alt="screenshot5.png" loading="lazy"/></p>
<h4 data-id="heading-6">小程序实现</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d333487041644c88efc0d6080ee1781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=Pcx1EuQWgsEwiCCNfxK6IQSOQfM%3D" alt="screenshot6.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/283778387a864c579a54907d2e09c3ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=dPkT%2BC8CHPJOm6MR8%2FRgNUR2qTc%3D" alt="screenshot7.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee374e5b98084fecb7a16c47539a83c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=7yCGUu3t7W5BxDug5jAinLVSTHg%3D" alt="screenshot8.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e261ce7278b44508dfa17a4c6346a3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=EpKeNDhD%2BOS2dmzAHAyulFVHN3o%3D" alt="screenshot9.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b01cef5d4a8541af8e9ef4ceed1e3246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnRodXg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763301528&amp;x-signature=%2F6ae%2FRarueMBcFxsDbRGfsbSC6g%3D" alt="screenshot10.jpg" loading="lazy"/></p>
<h3 data-id="heading-7">名字的意义</h3>
<blockquote>
<p>注：该部分文案由AI生成</p>
</blockquote>
<ul>
<li>一名之立，旬月踟蹰”。名字，是父母赠予孩子的第一份厚礼。我们深知其重，故潜心于诗、骚、词、赋的浩瀚文海，为您精心撷取文采斐然、寓意深远的灵感，愿每个名字都承载着经典与祝福。</li>
<li>为避常用名之普遍，并追求音律与字形之美，我们专选双字为名。与您的姓氏结合，构成和谐的三字姓名，既独特不易重复，又蕴含悠长的文化意境。</li>
</ul>
<h3 data-id="heading-8">Q&amp;A</h3>
<blockquote>
<p>注：该部分文案由AI生成</p>
</blockquote>
<ul>
<li>
<p>Question
为什么不直接用 AI 生成名字，而是让我自己挑选？</p>
</li>
<li>
<p>Answer
我们认为，AI 最强大的地方在于“博学”，而非“创造”。借助AI的能力，我们可以从浩如烟海的古典文籍中精准地检索和匹配相关的诗句，这大大提升了效率。然而，名字是情感与期望的载体，最终的选择应源自人心的触动。我们为您呈现这些蕴含美意的“璞玉”，由您亲自雕琢、赋予其独特的生命力。这既保证了名字的文化底蕴，又保留了起名过程中最宝贵的人文温度。</p>
</li>
<li>
<p>Question
为什么建议使用“姓+双字名”的组合？</p>
</li>
<li>
<p>Answer
在当代，单字名（如“李昂”）虽然简洁，但重名率相对较高。双字名（如“李思源”）不仅能有效降低重名的可能性，也为名字的音律和谐与寓意深度提供了更广阔的空间。三个字的组合在汉语发音中往往更具节奏感，读来朗朗上口，也更能承载父母对孩子的美好祝愿。</p>
</li>
<li>
<p>Question
随机“换一批”的方式会不会很麻烦？</p>
</li>
<li>
<p>Answer
我们理解您可能觉得这需要花费更多时间，但这正是我们设计的初衷。起名是一次充满喜悦的探索之旅，而非一项追求效率的任务。“换一批”的功能就像在书海中随手翻阅，每一次点击都可能带来一次与美好名字的“不期而遇”。我们相信，这个为孩子寻觅专属印记的过程本身就充满意义，而花费的时间，终将化为名字里沉甸甸的爱与祝福。</p>
</li>
<li>
<p>Question
未来会加入更多的古典文籍吗？</p>
</li>
<li>
<p>Answer
当然会！我们正持续不断地扩充我们的灵感文库，计划未来会囊括更多朝代、更多体裁的经典之作。我们的目标是打造一个最全面、最富诗意的古典文学起名宝库，陪伴每一个家庭完成这项神圣而美好的使命。敬请期待！</p>
</li>
<li>
<p>Question
可以指定生成男孩或女孩的名字吗？</p>
</li>
<li>
<p>Answer
我们特意未加入严格的性别筛选功能，原因在于中国古典文学中的许多优美词汇本身是中性的，其意境的“刚”与“柔”往往取决于搭配和个人的解读。例如，“清川”既可形容男子的俊朗，亦可描绘女子的澄澈。我们鼓励您超越固有的性别标签，用心感受每个名字背后的音韵与意象，为您未来的“他”或“她”选择一个最能触动您心弦的佳名。真正的专属，往往诞生于这份不设限的探索之中。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 拖拉对比组件，换装图片前后对比必备]]></title>    <link>https://juejin.cn/post/7570197010885034030</link>    <guid>https://juejin.cn/post/7570197010885034030</guid>    <pubDate>2025-11-09T12:28:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570197010885034030" data-draft-id="7568699551101075508" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 拖拉对比组件，换装图片前后对比必备"/> <meta itemprop="keywords" content="Flutter,前端,开源"/> <meta itemprop="datePublished" content="2025-11-09T12:28:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LinXunFeng"/> <meta itemprop="url" content="https://juejin.cn/user/1820446984512392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 拖拉对比组件，换装图片前后对比必备
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446984512392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LinXunFeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T12:28:38.000Z" title="Sun Nov 09 2025 12:28:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>欢迎关注微信公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" title="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" ref="nofollow noopener noreferrer">FSA全栈行动</a> 👋</p>
</blockquote>
<h2 data-id="heading-0">一、前言</h2>
<p>最近一个需求，需要在 <code>photo_view</code> 中实现拖拉对比两张图片的功能，要求不影响左右翻页及缩放手势。</p>
<p>其中前后图片上需要显示一些额外的信息，所以更准确来说，要对比的是两个视图，而不单单只是图片。</p>
<p>市面上几个现有的组件库，要么只能传入 <code>Image</code>，要么只允许全屏拖拽，且无法满足我们高自定义的需要，所以我自己做了一个。</p>
<p>相应的 <code>Demo</code> 可科学上网后在线体验:
<a href="https://link.juejin.cn?target=https%3A%2F%2Flinxunfeng.github.io%2Fflutter_compare_slider%2F" target="_blank" title="https://linxunfeng.github.io/flutter_compare_slider/" ref="nofollow noopener noreferrer">linxunfeng.github.io/flutter_com…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e582ebd2385247bdbfb966509bcdc5c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296117&amp;x-signature=b6xhOjYJqMvCSsqTxQRu%2BLK7nRo%3D" alt="" loading="lazy"/></p>
<p>OK，接下来我们就来看看具体使用</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLinXunFeng%2Fflutter_compare_slider" target="_blank" title="https://github.com/LinXunFeng/flutter_compare_slider" ref="nofollow noopener noreferrer">github.com/LinXunFeng/…</a></p>
<h2 data-id="heading-1">二、使用</h2>
<p>添加依赖</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">compare_slider:</span> <span class="hljs-string">latest_version</span>
</code></pre>
<p>导入</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:compare_slider/compare_slider.dart'</span>;
</code></pre>
<p>使用</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">double</span> value = <span class="hljs-number">0.5</span>;
<span class="hljs-built_in">double</span> thickness = <span class="hljs-number">1</span>;
<span class="hljs-built_in">bool</span> dragOnlyOnSlider = <span class="hljs-keyword">true</span>;

CompareSlider(
  <span class="hljs-comment">// 当前值 [0, 1]</span>
  value: value,
  <span class="hljs-comment">// 是否只允许在滑块区域拖拽</span>
  dragOnlyOnSlider: dragOnlyOnSlider,
  <span class="hljs-comment">// 原图视图（接收类型为 Widget，不局限于图片）</span>
  before: _buildImageView(isBefore: <span class="hljs-keyword">true</span>),
  <span class="hljs-comment">// 换装后的视图</span>
  after: _buildImageView(isBefore: <span class="hljs-keyword">false</span>),
  <span class="hljs-comment">// 分割线厚度</span>
  thickness: thickness,
  <span class="hljs-comment">// 拖拽的滑块和分割线</span>
  thumb: _buildThumb(),
  <span class="hljs-comment">// 滑块值改变时触发的回调</span>
  onValueChanged: (<span class="hljs-built_in">double</span> value) {
    <span class="hljs-keyword">this</span>.value = value;
    setState(() {});
  },
);
</code></pre>
<p>分割线与滑块</p>
<pre><code class="hljs language-dart" lang="dart">Widget _buildThumb() {
  <span class="hljs-keyword">return</span> Stack(
    clipBehavior: Clip.none,
    alignment: Alignment.center,
    children: [
      <span class="hljs-comment">// 分割线</span>
      _buildSliderLine(),
      <span class="hljs-comment">// 滑块</span>
      Positioned(
        left: -(thumbSize - thickness) / <span class="hljs-number">2</span>,
        child: _buildSliderThumb(),
      ),
    ],
  );
}

Widget _buildSliderLine() {
  <span class="hljs-keyword">return</span> Container(
    width: thickness,
    color: Colors.white.withValues(alpha: <span class="hljs-number">0.5</span>),
  );
}
</code></pre>
<p><code>thickness</code> 是分割线的宽度，传入用于提前计算其偏移量。</p>
<p><code>dragOnlyOnSlider</code> 默认为 <code>false</code>，即全区域拖动，如果设置为 <code>true</code>，则默认情况下，交互区域为 <code>_buildSliderLine()</code> 视图。</p>
<p>有时分割线的宽度较小，而你想扩大交互范围时，则可以通过 <code>extraHitTestArea</code> 来实现，结合 <code>debugHitTestAreaColor</code> 可清晰知道交互范围，如文章顶部动图中半透明红色。</p>
<p>为了不影响 <code>photo_view</code> 的缩放手势，可以在开始触摸滑块时（<code>onSliderThumbTouchBegin</code> 回调）禁用手势，在结束触摸滑块时（<code>onSliderThumbTouchEnd</code> 回调）恢复手势即可。</p>
<h2 data-id="heading-2">三、最后</h2>
<p>好了，开源不易，如果你也觉得这个库好用，请不吝给个 <code>Star</code>  👍 ，并多多支持！</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLinXunFeng%2Fflutter_compare_slider" target="_blank" title="https://github.com/LinXunFeng/flutter_compare_slider" ref="nofollow noopener noreferrer">github.com/LinXunFeng/…</a></strong></p>
<p>本篇到此结束，感谢大家的支持，我们下次再见！ 👋</p>
<blockquote>
<p>如果文章对您有所帮助, 请不吝点击关注一下我的微信公众号：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" title="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" target="_blank">FSA全栈行动</a>, 这将是对我最大的激励. 公众号不仅有 <code>iOS</code> 技术，还有 <code>Android</code>，<code>Flutter</code>，<code>Python</code> 等文章, 可能有你想要了解的技能知识点哦~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[最小信息表达：从误解到深层理解的五个关键点]]></title>    <link>https://juejin.cn/post/7569959427879174154</link>    <guid>https://juejin.cn/post/7569959427879174154</guid>    <pubDate>2025-11-09T11:35:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569959427879174154" data-draft-id="7570201730991308826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="最小信息表达：从误解到深层理解的五个关键点"/> <meta itemprop="keywords" content="后端,架构"/> <meta itemprop="datePublished" content="2025-11-09T11:35:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            最小信息表达：从误解到深层理解的五个关键点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T11:35:43.000Z" title="Sun Nov 09 2025 11:35:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Kimi K2 Thinking的智商有了明显提高，虽然还是错误理解不断，但讲解关键点之后它表现出相当程度的总结能力。</p>
</blockquote>
<p>初次接触"最小信息表达"原则时，很容易觉得它不过是又一个"高内聚低耦合"式的抽象口号。但当我们真正尝试将其应用到日常设计中，会发现这个概念远比看起来复杂。在讨论和实践中，我注意到自己和同行们反复陷入几个典型的认知误区——急于下结论，却忽略了概念背后的深层含义。</p>
<p>这篇文章试图梳理五个最常见的误判。如果你对"最小信息表达"的原始论述感兴趣，可先阅读<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1opDaIqojYVxRY3UEZBz1A" target="_blank" title="https://mp.weixin.qq.com/s/1opDaIqojYVxRY3UEZBz1A" ref="nofollow noopener noreferrer">《最小信息表达：软件框架设计的第一性原理》</a>，再回到这里看实践中的理解偏差如何产生。</p>
<hr/>
<h2 data-id="heading-0"><strong>误判一：把"信息方向"和"技术寿命"混为一谈</strong></h2>
<p><strong>最初想法</strong>：我觉得<code>@BizQuery</code>就算比<code>@GET</code>更贴近业务，可技术总在变，过几年它一样会变成过时包袱。</p>
<p><strong>问题所在</strong>：我错把<strong>时间维度</strong>（技术会不会过时）当成判断标准，却漏掉了更关键的<strong>空间维度</strong>（信息指向哪里）。</p>
<p><strong>底层逻辑</strong>：<code>@BizQuery</code>的价值不在于技术寿命，而在于它<strong>指向业务语义自身</strong>（内向），而非外部技术实现（外向）。即使通信方式颠覆，"查询"（无副作用、只读）这个本体论区分依然成立。它如同数学中的"质数"概念——不因为计算工具改变而改变。</p>
<p><strong>修正后的理解</strong>：判断是不是本质复杂性，别问"它会不会变"，要问"它指向哪"。指向问题域内部的，是跟业务共生的<strong>本质信息</strong>；指向解决方案外部的，是选型带来的<strong>偶发信息</strong>。这个方向性判据，是把设计从"技术驱动"拉回"业务驱动"的关键。</p>
<hr/>
<h2 data-id="heading-1"><strong>误判二：把"数学同构"当成"工程可逆"</strong></h2>
<p><strong>最初想法</strong>：我质疑"最小表达唯一性"，觉得同一业务能建构成过程或事件两种范式，且都能做到最小，转换成本很高，所以唯一性站不住脚。</p>
<p><strong>问题所在</strong>：我混淆了<strong>数学层面的同构</strong>（范畴论中函子的存在）和<strong>工程层面的便利性</strong>（转换成本能不能接受）。这是抽象洁癖的通病——在理论层面看到一致性，却选择性忽略实现层面的摩擦。</p>
<p><strong>底层逻辑</strong>：在<strong>给定范式P</strong>和<strong>判定准则C</strong>的前提下，最小表达唯一。范式选择本身是L+1层的<strong>战略决策</strong>，不是L层能推迟的细节。CDC和Flink-SQL的工业实践证明：<strong>当范式差异足够结构化时，抽象层G能把转换成本压到零</strong>，使范式选择从"架构锚点"降级为"生成器配置"。</p>
<p><strong>修正后的理解</strong>：唯一性不是静止不变的属性，而是<strong>生成器成熟度</strong>的函数。当CDC出现前，"数据库变更→事件流"是重写级工作；CDC出来后，它变成可逆的自动转换。判断一个差异是"本质"还是"偶发"，不应依赖思辨，而应看<strong>ROI</strong>：是否存在G，使<code>G(范式₁,模型) ↔ G(范式₂,模型)</code>的成本低于手动重写？存在，差异就 reversible；不存在，就是战略锚点。</p>
<hr/>
<h2 data-id="heading-2"><strong>误判三：以为"弱化上下文"等于扔掉IoC</strong></h2>
<p><strong>最初想法</strong>：我把"弱化上下文"理解成"所有依赖都得手写传递"，觉得这跟IoC的自动装配对着干。</p>
<p><strong>问题所在</strong>：我混了<strong>显式依赖</strong>和<strong>显式传递</strong>。IoC的<code>@Inject</code>本身就在显式声明依赖，只是<strong>装配过程</strong>由框架接管。我错把它跟"富上下文定位器"（比如<code>RequestContextHolder.getBean()</code>）当成一回事。</p>
<p><strong>底层逻辑</strong>：弱化上下文要求的是<strong>双重显式契约</strong>：</p>
<ul>
<li><strong>服务依赖</strong>：用IoC注入（<code>@Inject IAuthDao</code>），声明"我需要什么能力"</li>
<li><strong>环境依赖</strong>：用方法参数传递（<code>IExecutionContext</code>），声明"我在什么环境下执行"</li>
</ul>
<p>IoC和弱化上下文<strong>互相补位</strong>：前者管"能力装配"，后者管"元信息传递"。<code>IExecutionContext</code>之所以"弱化"，就因为它<strong>不含<code>getService()</code>这类方法</strong>，退化成纯数据容器。这是把依赖方向从"外向拉取框架服务"扭转为"内向接收调用者信息"的核心。</p>
<p><strong>修正后的理解</strong>：偶发复杂性的根源不在"是否自动装配"，而在"<strong>信息指向哪</strong>"。<code>@Inject IAuthDao</code>指向<strong>业务接口</strong>，是本质；<code>RequestContextHolder.getBean()</code>指向<strong>框架容器</strong>，是偶发。弱化上下文不是抛弃自动化，而是<strong>把自动化的触发器从"主动拉取"改成"被动接收"</strong>。</p>
<hr/>
<h2 data-id="heading-3"><strong>误判四：高估Δ的万能性，低估范式转换的刚性</strong></h2>
<p><strong>最初想法</strong>：我以为Δ能搞定一切演化，包括范式迁移。</p>
<p><strong>问题所在</strong>：我把可逆计算的"差量叠加"泛化成"任意变换"，忽略了Δ的<strong>代数结构限制</strong>——它擅长<strong>增删改</strong>，不擅长<strong>重写代数规则</strong>。这相当于觉得导数的线性组合能解所有微分方程。</p>
<p><strong>底层逻辑</strong>：Δ的边界很明确：<strong>处理偶发复杂性（定制、扩展、适配），不处理范式转换（重构核心代数）</strong>。从ACID到BASE，得重写补偿逻辑（Saga），这不是Δ能自动生成的——因为BASE的"最终一致性"是<strong>与ACID不兼容的语义契约</strong>，它改变了业务不变量的定义方式。</p>
<p><strong>修正后的理解</strong>：Δ和生成器G的<strong>分工不同</strong>：</p>
<ul>
<li><strong>G</strong>：处理<strong>结构化差异</strong>（过程↔事件溯源，因为状态转移图能映射成两种代码模式）</li>
<li><strong>Δ</strong>：处理<strong>非结构化噪音</strong>（客户A要字段X，客户B要字段Y）</li>
</ul>
<p>范式差异能<strong>完全形式化</strong>时，G能补上；差异涉及<strong>业务语义重定义</strong>时，得人工重构。这区分了"<strong>可逆的计算</strong>"和"<strong>可逆的演化</strong>"：前者自动，后者需要设计决策。</p>
<hr/>
<h2 data-id="heading-4"><strong>误判五：把语言工作台当成项目级成本包袱</strong></h2>
<p><strong>最初想法</strong>：看到Nop平台20万行代码，我第一反应是"这哪是轻量原则，分明是沉重负担"，怀疑它的经济性。</p>
<p><strong>问题所在</strong>：我陷在<strong>企业成本中心</strong>的短视里，把工作台当成"单个项目的脚手架"，完全没意识到这是<strong>行业级公共品</strong>。这是对新制度经济学里<strong>公共品溢出效应</strong>的无知。</p>
<p><strong>底层逻辑</strong>：语言工作台不是<strong>成本</strong>，而是<strong>战略基础设施投资</strong>，价值遵循<strong>网络效应</strong>而非线性折旧：</p>
<ol>
<li>
<p><strong>知识网络效应</strong>：每个组织贡献的DSL（比如"金融衍生品合约DSL"）变成可复用的领域词汇。Workbench一旦成为行业公地，DSL开发成本从<code>O(n)</code>线性增长降到<code>O(log n)</code>亚线性——新DSL能直接复用语法组件、调试器、IDE插件。这就像<strong>Maven Central</strong>，但粒度细化到<strong>语言构造本身</strong>。</p>
</li>
<li>
<p><strong>工具链网络效应</strong>：Workbench存在后，所有基于它的DSL<strong>自动获得完整工具链</strong>（调试、重构、版本管理）。这彻底解决了传统DSL"每做一个就得重做工具"的痛点。20万行代码的<strong>摊销对象是整个行业</strong>，不是某个项目。</p>
</li>
<li>
<p><strong>人才网络效应</strong>：Workbench成为标准后，开发者能力从"精通框架X"转向"精通构造DSL"。这种元能力<strong>跨项目、跨公司复用</strong>，带来抽象层级的永久跃迁。这正是从"汇编专家"到"高级语言程序员"的历史重演。</p>
</li>
</ol>
<p><strong>修正后的理解</strong>：语言工作台的经济学本质，是把<strong>企业内部的偶发复杂性</strong>，通过<strong>行业级基础设施</strong>，转化为<strong>可复用的本质复杂性</strong>。这不是负担，而是<strong>对全产业交易成本的结构性降低</strong>。就像<strong>云厂商投资虚拟化技术</strong>，单个企业扛不住，但社会总成本因共享而最优。</p>
<hr/>
<h2 data-id="heading-5"><strong>这些误判的根源：为什么我们总是想得太简单</strong></h2>
<p>回头一看，所有误判都源于一个共同习惯——<strong>总想在一个时间点上把事情看死</strong>。我们急于在静态层面划分"本质"和"偶发"，却忘了：</p>
<ul>
<li><strong>技术会变</strong>：今天的战略锚点，明天可能因Flink-SQL这类技术降格为配置项</li>
<li><strong>抽象会嵌套</strong>：范式选择在本层是本质，在上一层就是偶发</li>
<li><strong>熵是动态的</strong>：最小化不是一次设计，是持续的熵预算管控</li>
<li><strong>成本要分摊</strong>：算成本不该按项目，得按行业生态算总账</li>
</ul>
<p>作者提出的"<strong>分形分解+可逆计算+熵监控+公共品投资</strong>"这套组合拳，就是为了打破这种静态思维。软件设计不是雕冰雕，而是养生命体——DNA（DSL）要稳定，表现型（Δ）要能适应环境变化，进化靠<strong>生态基础设施</strong>持续供给养分。</p>
<hr/>
<h2 data-id="heading-6"><strong>理论的实际价值：一套可检验的框架</strong></h2>
<p>这套理论不是只能谈不能用的空泛哲学，它具备<strong>可证伪性</strong>：</p>
<ul>
<li><strong>核心判据</strong>：信息指向方向（业务内向 vs 技术外向）</li>
<li><strong>推导结论</strong>：SOLID统一解释、范式可延迟条件、Δ边界定理、基础设施网络效应</li>
<li><strong>实践验证</strong>：Nop平台作为可运行实例</li>
<li><strong>度量方式</strong>：熵监控提供可证伪性（拒绝重构导致系统崩溃，理论预测失败）</li>
</ul>
<p>它跟那些无法验证的"最佳实践清单"有本质区别，提供了一个<strong>从哲学到数学再到工程</strong>的闭环。我的误判暴露了翻译损耗——<strong>抽象概念需要具体判据支撑</strong>，否则就沦为各说各话。</p>
<hr/>
<h2 data-id="heading-7"><strong>对工程师的实际意义</strong></h2>
<ol>
<li><strong>检查信息方向</strong>：每写一行代码，先问"它指向业务还是技术？"</li>
<li><strong>投资生成器</strong>：重复三次以上的模式，想想值不值得建生成器G</li>
<li><strong>设置熵预算</strong>：给核心模块定个熵值上限，超标就触发重构审查</li>
<li><strong>接受范式锚点</strong>：对ACID/BASE、读写分离这类战略决策，别妄图万能抽象</li>
<li><strong>分离IoC与上下文</strong>：IoC管能力装配，上下文传纯数据</li>
<li><strong>共建Workbench</strong>：别每个团队都造DSL，<strong>像共建Linux内核那样共建行业级Workbench</strong></li>
</ol>
<hr/>
<h2 data-id="heading-8"><strong>写在最后：理论是地图，不是终点</strong></h2>
<p>这场对话让我明白：这套理论的价值不在给标准答案，而在<strong>提可检验的问题</strong>。它把软件设计从"凭感觉"变成"可计算"，让每个决策都能推演、度量、验证。</p>
<p>我的误判，恰似软件工程本身——<strong>抽象和具象之间、理想和现实之间、数学和代码之间，总有鸿沟</strong>。好理论就是帮我们在鸿沟上架桥的脚手架。桥稳不稳，不在于它永存，而在于它能否<strong>指引我们抵达更清晰的认知彼岸</strong>。</p>
<p>CDC和Flink已经证明：<strong>当范式差异足够大时，聪明人会在中间建抽象层，而非在应用层硬编码</strong>。这套理论最硬的预言，就是<strong>技术演化的这个方向</strong>：<strong>从框架臃肿走向语言精炼，从企业重复造轮走向行业共建公地</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webpack：从构建流程到性能优化的深度探索]]></title>    <link>https://juejin.cn/post/7569960869960368174</link>    <guid>https://juejin.cn/post/7569960869960368174</guid>    <pubDate>2025-11-09T12:35:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569960869960368174" data-draft-id="7570201730991505434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Webpack：从构建流程到性能优化的深度探索"/> <meta itemprop="keywords" content="Webpack,前端工程化,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T12:35:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="answerball"/> <meta itemprop="url" content="https://juejin.cn/user/209320781557531"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Webpack：从构建流程到性能优化的深度探索
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/209320781557531/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    answerball
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T12:35:37.000Z" title="Sun Nov 09 2025 12:35:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p><strong>引言：为什么我们需要构建工具？</strong></p>
<p>想象一下，你正在开发一个复杂的前端应用，有几十个JavaScript文件、几十个CSS文件、各种图片和字体资源。如果手动管理这些文件的依赖关系、合并、压缩，那将是一场噩梦。这就是Webpack等构建工具诞生的原因——它们像一位细心的管家，帮我们打理前端项目中的各种资源，让开发变得高效而愉快。</p>
<p>作为前端开发领域最流行的构建工具之一，Webpack已经成为了现代Web开发不可或缺的一部分。本文将带你深入探索Webpack的构建机制，并分享一系列提升开发效率的实用技巧。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a3c1fcfc332450c8738452b7fcd9f3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYW5zd2VyYmFsbA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296537&amp;x-signature=fs9CxMtzbLXdGwebCmHIQ8%2BpNkg%3D" alt="image.png" width="50%" loading="lazy"/></p>
<h2 data-id="heading-0">一、Webpack构建流程：一场精心编排的演出</h2>
<p>Webpack的构建过程就像一场精心编排的演出，每个环节都有明确的职责和顺序。让我们揭开这场演出的幕后秘密。</p>
<h3 data-id="heading-1">1.1 初始化阶段：准备舞台</h3>
<p>一切始于参数初始化。Webpack会从配置文件（通常是webpack.config.js）和Shell命令中读取参数，然后合并这些参数，得出最终的配置。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.config.js 示例</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>
  },
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>
};
</code></pre>
<p>在这个阶段，Webpack会初始化Compiler对象——这是整个构建过程的大脑，负责调度和执行各个构建任务。同时，所有配置的插件会被加载，并注册到对应的事件钩子上。</p>
<h3 data-id="heading-2">1.2 编译阶段：演员就位</h3>
<p>编译阶段是构建过程的核心，它又可以分为几个关键步骤：</p>
<p><strong>确定入口</strong></p>
<p>Webpack从配置的entry开始，像侦探一样追踪每一个依赖。假设我们的入口文件是这样的：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/index.js</span>
<span class="hljs-keyword">import</span> { utils } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles.css'</span>;

utils.<span class="hljs-title function_">sayHello</span>();
</code></pre>
<p>Webpack会先处理index.js，然后发现它依赖utils.js和styles.css，接着去处理这些文件，再发现这些文件的依赖...如此递归下去，最终形成一个完整的依赖图。</p>
<p><strong>编译模块</strong></p>
<p>对于每个模块，Webpack会根据配置的loader对其进行"翻译"。比如，对于CSS文件，css-loader会处理其中的@import和url()，style-loader则会将CSS注入到DOM中。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack配置中的loader部分</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>]
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">use</span>: <span class="hljs-string">'babel-loader'</span>
      }
    ]
  }
};
</code></pre>
<p>这个过程就像把各种语言的书籍（不同类型的模块）翻译成统一的语言（JavaScript），让浏览器这个"读者"能够理解。</p>
<p><strong>完成模块编译</strong></p>
<p>经过loader的处理，每个模块都被转换成了浏览器能够理解的形式，同时Webpack也清晰地掌握了模块之间的依赖关系。</p>
<h3 data-id="heading-3">1.3 输出阶段：演出开始</h3>
<p><strong>输出资源</strong></p>
<p>Webpack会将相关的模块分组到不同的chunk中。比如，通过splitChunks优化，可以将第三方库单独打包：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">cacheGroups</span>: {
        <span class="hljs-attr">vendor</span>: {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>,
          <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>
        }
      }
    }
  }
};
</code></pre>
<p>每个chunk最终会被转换成单独的文件，加入到输出列表中。这时，插件还有最后一次机会修改输出内容。</p>
<p><strong>输出完成</strong></p>
<p>最后，Webpack根据配置的输出路径和文件名，将文件写入到文件系统中。至此，构建过程圆满完成。</p>
<h3 data-id="heading-4">1.4 插件系统：演出的特效团队</h3>
<p>Webpack的插件系统就像演出的特效团队，在特定时刻为演出增添亮点。插件通过监听Webpack在生命周期中广播的各种事件，在合适的时机执行自定义逻辑。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 一个简单的插件示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'构建完成，准备输出资源！'</span>);
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">MyPlugin</span>;
</code></pre>
<h2 data-id="heading-5">二、提升开发效率：Webpack的好帮手</h2>
<p>在了解了Webpack的构建流程后，让我们看看如何通过各种工具和技巧提升开发效率。</p>
<h3 data-id="heading-6">2.1 可视化工具：让构建过程一目了然</h3>
<p><strong>webpack-dashboard：构建仪表盘</strong></p>
<p>传统的命令行输出信息有限且不够直观。webpack-dashboard提供了一个全新的终端可视化界面，让你对构建状态、资源大小、错误信息等一目了然。</p>
<p>安装和使用非常简单：</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev webpack-dashboard
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DashboardPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-dashboard/plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...其他配置</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">DashboardPlugin</span>()
  ]
};
</code></pre>
<p><strong>speed-measure-webpack-plugin：性能分析专家</strong></p>
<p>这个插件可以测量各个loader和插件的耗时，帮你找出构建过程中的性能瓶颈。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">SpeedMeasurePlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"speed-measure-webpack-plugin"</span>);
<span class="hljs-keyword">const</span> smp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeedMeasurePlugin</span>();

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = smp.<span class="hljs-title function_">wrap</span>({
  <span class="hljs-comment">// 原来的webpack配置</span>
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>] <span class="hljs-comment">// 这里会显示每个loader的耗时</span>
      }
    ]
  }
});
</code></pre>
<h3 data-id="heading-7">2.2 配置管理：让配置更清晰</h3>
<p><strong>webpack-merge：配置合并利器</strong></p>
<p>在大型项目中，我们通常需要针对不同环境（开发、测试、生产）使用不同的配置。webpack-merge可以帮助我们提取公共配置，避免重复代码。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { merge } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>);

<span class="hljs-comment">// 公共配置</span>
<span class="hljs-keyword">const</span> commonConfig = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [{
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
      <span class="hljs-attr">use</span>: <span class="hljs-string">'babel-loader'</span>
    }]
  }
};

<span class="hljs-comment">// 开发环境配置</span>
<span class="hljs-keyword">const</span> devConfig = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>,
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'cheap-module-source-map'</span>
};

<span class="hljs-comment">// 生产环境配置  </span>
<span class="hljs-keyword">const</span> prodConfig = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'source-map'</span>
};

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (env === <span class="hljs-string">'production'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(commonConfig, prodConfig);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(commonConfig, devConfig);
};
</code></pre>
<h3 data-id="heading-8">2.3 热更新：开发者的福音</h3>
<p><strong>HotModuleReplacementPlugin</strong></p>
<p>热模块替换（HMR）是开发过程中极其有用的功能。它允许在运行时更新各种模块，而无需进行完全刷新，这意味着你可以在不丢失应用状态的情况下看到代码更改的效果。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...其他配置</span>
  <span class="hljs-attr">devServer</span>: {
    <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启热更新</span>
    <span class="hljs-attr">contentBase</span>: <span class="hljs-string">'./dist'</span>
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">HotModuleReplacementPlugin</span>()
  ]
};
</code></pre>
<p>对于CSS，HMR体验尤为出色 - 样式更改会立即反映在页面上。对于JavaScript，你可能需要手动处理模块更新：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>.<span class="hljs-property">hot</span>) {
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">accept</span>(<span class="hljs-string">'./myModule'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 模块更新后的回调</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'myModule更新了！'</span>);
  });
}
</code></pre>
<h2 data-id="heading-9">三、文件指纹：精准控制缓存策略</h2>
<p>文件指纹是打包后输出文件名的后缀，用于控制浏览器缓存，是性能优化中的重要一环。</p>
<h3 data-id="heading-10">3.1 三种文件指纹策略</h3>
<p><strong>Hash：项目级别</strong></p>
<p>Hash与整个项目构建相关，只要项目文件有修改，整个项目构建的hash值就会改变。这种策略比较"粗放"，任何文件改动都会导致所有输出文件的hash变化。</p>
<p><strong>ChunkHash：代码块级别</strong></p>
<p>ChunkHash与webpack打包的chunk相关，不同的entry会生成不同的chunkhash。这种方式更为精准，只有属于同一chunk的文件发生变化时，该chunk的hash才会改变。</p>
<p><strong>ContentHash：内容级别</strong></p>
<p>ContentHash根据文件内容来定义hash，文件内容不变，contenthash就不变。这是最精确的缓存控制策略，特别适用于CSS等资源文件。</p>
<h3 data-id="heading-11">3.2 实战文件指纹配置</h3>
<p><strong>JavaScript的文件指纹</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: {
    <span class="hljs-attr">app</span>: <span class="hljs-string">'./src/app.js'</span>,
    <span class="hljs-attr">search</span>: <span class="hljs-string">'./src/search.js'</span>
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[chunkhash:8].js'</span> <span class="hljs-comment">// 使用8位chunkhash</span>
  }
};
</code></pre>
<p>这样会生成类似app-a1b2c3d4.js和search-e5f6g7h8.js的文件。</p>
<p><strong>CSS的文件指纹</strong></p>
<p>CSS的文件指纹需要借助MiniCssExtractPlugin：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: {
    <span class="hljs-attr">app</span>: <span class="hljs-string">'./src/app.js'</span>,
    <span class="hljs-attr">search</span>: <span class="hljs-string">'./src/search.js'</span>
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[chunkhash:8].js'</span>
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [
          <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-comment">// 使用MiniCssExtractPlugin的loader</span>
          <span class="hljs-string">'css-loader'</span>
        ]
      }
    ]
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[contenthash:8].css'</span> <span class="hljs-comment">// 使用8位contenthash</span>
    })
  ]
};
</code></pre>
<p><strong>图片资源的文件指纹</strong></p>
<p>对于图片等静态资源，我们通常使用file-loader或url-loader来处理：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>,
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>)
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|svg|jpg|gif)$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'file-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-string">'images/[name]-[hash:8].[ext]'</span> <span class="hljs-comment">// 图片使用hash</span>
            }
          }
        ]
      }
    ]
  }
};
</code></pre>
<p>file-loader提供了丰富的占位符：</p>
<ul>
<li><code>[name]</code>：文件原名</li>
<li><code>[path]</code>：文件相对路径</li>
<li><code>[folder]</code>：文件所在文件夹</li>
<li><code>[hash]</code>：文件内容hash</li>
<li><code>[contenthash]</code>：内容hash（与hash通常相同）</li>
</ul>
<h2 data-id="heading-12">四、构建性能优化：让打包速度飞起来</h2>
<p>随着项目规模的增长，构建时间可能会成为开发效率的瓶颈。下面是一些实用的优化策略。</p>
<h3 data-id="heading-13">4.1 使用最新工具</h3>
<p>始终使用最新版本的Webpack和Node.js。每个新版本通常都会带来性能改进和新特性。Webpack 5相比Webpack 4在构建性能上有显著提升。</p>
<h3 data-id="heading-14">4.2 多进程构建</h3>
<p><strong>thread-loader</strong></p>
<p>将这个loader放在其他loader之前，其后的loader就会在单独的worker池中运行，充分利用多核CPU的优势。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'thread-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">workers</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 开启2个worker</span>
            }
          },
          <span class="hljs-string">'babel-loader'</span>
        ]
      }
    ]
  }
};
</code></pre>
<p>注意：thread-loader有一定启动开销，在小型项目中可能不太划算。</p>
<h3 data-id="heading-15">4.3 优化压缩过程</h3>
<p><strong>并行压缩JavaScript</strong></p>
<p>使用TerserWebpackPlugin开启多进程并行压缩：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'terser-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">minimizer</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({
        <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启多进程</span>
        <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启缓存</span>
      })
    ]
  }
};
</code></pre>
<p><strong>CSS压缩和提取</strong></p>
<p>使用MiniCssExtractPlugin配合优化器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CssMinimizerPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'css-minimizer-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-string">'css-loader'</span>]
      }
    ]
  },
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">minimizer</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>()
    ]
  },
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>()]
};
</code></pre>
<h3 data-id="heading-16">4.4 图片优化</h3>
<p>使用image-webpack-loader自动压缩图片：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(jpe?g|png|gif|svg)$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'file-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-string">'images/[name]-[hash:8].[ext]'</span>
            }
          },
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'image-webpack-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">mozjpeg</span>: {
                <span class="hljs-attr">progressive</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">quality</span>: <span class="hljs-number">65</span>
              },
              <span class="hljs-attr">optipng</span>: {
                <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>
              },
              <span class="hljs-attr">pngquant</span>: {
                <span class="hljs-attr">quality</span>: [<span class="hljs-number">0.65</span>, <span class="hljs-number">0.90</span>],
                <span class="hljs-attr">speed</span>: <span class="hljs-number">4</span>
              }
            }
          }
        ]
      }
    ]
  }
};
</code></pre>
<h3 data-id="heading-17">4.5 缩小打包作用域</h3>
<p>通过精确配置，减少Webpack的搜索范围，可以显著提升构建速度。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-comment">// 明确告诉webpack搜索哪些目录</span>
    <span class="hljs-attr">modules</span>: [path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'node_modules'</span>)],
    <span class="hljs-comment">// 使用别名减少查找过程</span>
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>)
    },
    <span class="hljs-comment">// 减少尝试的扩展名</span>
    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.json'</span>]
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-comment">// 只对src目录下的js文件使用babel-loader</span>
        <span class="hljs-attr">include</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
        <span class="hljs-attr">use</span>: <span class="hljs-string">'babel-loader'</span>
      }
    ]
  }
};
</code></pre>
<h3 data-id="heading-18">4.6 提取公共资源</h3>
<p><strong>分离第三方库</strong></p>
<p>将不常变动的第三方库单独打包，可以利用浏览器缓存：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">cacheGroups</span>: {
        <span class="hljs-attr">vendor</span>: {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>,
          <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>
        }
      }
    }
  }
};
</code></pre>
<p><strong>使用CDN</strong></p>
<p>通过externals配置，将一些大型库排除在打包之外，通过CDN引入：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">externals</span>: {
    <span class="hljs-attr">react</span>: <span class="hljs-string">'React'</span>,
    <span class="hljs-string">'react-dom'</span>: <span class="hljs-string">'ReactDOM'</span>
  }
};
</code></pre>
<p>然后在HTML中通过script标签引入CDN资源。</p>
<h3 data-id="heading-19">4.7 充分利用缓存</h3>
<p>缓存是提升二次构建速度的利器。</p>
<p><strong>babel-loader缓存</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">use</span>: {
          <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-loader'</span>,
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启babel缓存</span>
          }
        }
      }
    ]
  }
};
</code></pre>
<p><strong>持久化缓存</strong></p>
<p>Webpack 5提供了内置的持久化缓存：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">cache</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'filesystem'</span> <span class="hljs-comment">// 使用文件系统缓存</span>
  }
};
</code></pre>
<p>对于Webpack 4，可以使用hard-source-webpack-plugin：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hard-source-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span>()]
};
</code></pre>
<h3 data-id="heading-20">4.8 Tree Shaking：消除无用代码</h3>
<p>Tree Shaking就像园丁修剪树木一样，去除代码中未被使用的部分，让最终打包体积更小。</p>
<p>ES6模块系统是Tree Shaking的基础，因为ES6模块是静态的，可以在编译时确定依赖关系。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">square</span>(<span class="hljs-params">x</span>) {
  <span class="hljs-keyword">return</span> x * x;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cube</span>(<span class="hljs-params">x</span>) {
  <span class="hljs-keyword">return</span> x * x * x;
}

<span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> { cube } <span class="hljs-keyword">from</span> <span class="hljs-string">'./math.js'</span>; <span class="hljs-comment">// 只引入了cube</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">cube</span>(<span class="hljs-number">5</span>));
</code></pre>
<p>在这个例子中，square函数不会被包含在最终的bundle中。</p>
<p>确保在package.json中设置sideEffects属性，帮助Webpack识别哪些文件有副作用：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"*.css"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"*.scss"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-21">五、自定义Loader和Plugin：扩展Webpack能力</h2>
<p>当Webpack内置功能无法满足需求时，我们可以通过编写自定义loader和plugin来扩展其能力。</p>
<h3 data-id="heading-22">5.1 编写Loader：模块转换器</h3>
<p>Loader就像一个翻译官，负责将各种类型的模块"翻译"成Webpack能够理解的JavaScript。</p>
<p><strong>Loader开发原则</strong></p>
<ul>
<li>单一职责：每个loader只做一件事</li>
<li>链式调用：loader支持链式调用，前一个loader的输出作为后一个loader的输入</li>
<li>模块化：确保loader输出的是JavaScript模块</li>
<li>无状态：在多次构建之间，loader不应该保留状态</li>
</ul>
<p><strong>一个简单的Loader示例</strong></p>
<p>假设我们要开发一个简单的markdown loader：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) {
  <span class="hljs-comment">// 获取loader的配置选项</span>
  <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOptions</span>();
  
  <span class="hljs-comment">// 使用marked解析markdown</span>
  <span class="hljs-keyword">const</span> html = <span class="hljs-title function_">marked</span>(source, options);
  
  <span class="hljs-comment">// 返回JavaScript模块</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`module.exports = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(html)}</span>`</span>;
};
</code></pre>
<p>使用这个loader：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.md$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'markdown-loader.js'</span>),
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">true</span>
            }
          }
        ]
      }
    ]
  }
};
</code></pre>
<p><strong>Loader工具库</strong></p>
<p>官方提供的loader-utils和schema-utils可以简化loader开发：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { getOptions } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'loader-utils'</span>);
<span class="hljs-keyword">const</span> { validate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'schema-utils'</span>);

<span class="hljs-keyword">const</span> schema = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-attr">test</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'boolean'</span>
    }
  }
};

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) {
  <span class="hljs-keyword">const</span> options = <span class="hljs-title function_">getOptions</span>(<span class="hljs-variable language_">this</span>);
  
  <span class="hljs-comment">// 验证options是否符合schema</span>
  <span class="hljs-title function_">validate</span>(schema, options, <span class="hljs-string">'Example Loader'</span>);
  
  <span class="hljs-comment">// loader逻辑...</span>
  <span class="hljs-keyword">return</span> source;
};
</code></pre>
<h3 data-id="heading-23">5.2 编写Plugin：构建过程增强器</h3>
<p>如果说Loader处理的是单个模块，那么Plugin则是在整个构建过程中起作用，可以监听Webpack构建生命周期中的事件，在合适的时机执行自定义逻辑。</p>
<p><strong>Plugin基本结构</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    <span class="hljs-comment">// 注册钩子</span>
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">someHook</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
      <span class="hljs-comment">// 插件逻辑</span>
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">MyPlugin</span>;
</code></pre>
<p><strong>一个实用的Plugin示例</strong></p>
<p>让我们创建一个在构建完成后显示构建信息的插件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuildInfoPlugin</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options || {};
  }

  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'BuildInfoPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">stats</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { compilation } = stats;
      <span class="hljs-keyword">const</span> { outputOptions } = compilation;
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🎉 构建完成！'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📁 输出目录: <span class="hljs-subst">${outputOptions.path}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 文件数量: <span class="hljs-subst">${compilation.assets.length}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`⏱ 构建时间: <span class="hljs-subst">${stats.endTime - stats.startTime}</span>ms`</span>);
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">showAssets</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📄 生成文件:'</span>);
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">assetName</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> asset = compilation.<span class="hljs-property">assets</span>[assetName];
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${assetName}</span> (<span class="hljs-subst">${asset.size()}</span> bytes)`</span>);
        });
      }
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">BuildInfoPlugin</span>;
</code></pre>
<p>使用这个插件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">BuildInfoPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./build-info-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuildInfoPlugin</span>({
      <span class="hljs-attr">showAssets</span>: <span class="hljs-literal">true</span>
    })
  ]
};
</code></pre>
<p><strong>理解Compiler和Compilation</strong></p>
<p>在Plugin开发中，有两个核心概念需要理解：</p>
<ul>
<li>compiler：代表了配置完备的Webpack环境，从启动到关闭的整个生命周期</li>
<li>compilation：代表了一次单一的构建，包含了当前的模块资源、编译生成资源、变化的文件等信息</li>
</ul>
<p><strong>常用的钩子时机</strong></p>
<ul>
<li>entryOption：处理entry配置</li>
<li>compile：开始编译</li>
<li>emit：生成资源到output目录之前</li>
<li>done：编译完成</li>
</ul>
<h2 data-id="heading-24">结语</h2>
<p>Webpack作为现代前端开发的基石，其重要性不言而喻。通过深入了解其构建流程、掌握性能优化技巧、甚至能够编写自定义的loader和plugin，我们不仅能够提升开发效率，还能更好地应对复杂项目的构建需求。</p>
<p>记住，Webpack配置没有绝对的"最佳实践"，最适合项目需求的配置就是最好的配置。希望本文能帮助你在Webpack的学习和使用道路上走得更远，让构建工具真正成为提升开发体验的利器，而不是令人头疼的负担。</p>
<p>构建愉快！</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/310f9fafebf248d2bcd0e307983f15d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYW5zd2VyYmFsbA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296537&amp;x-signature=hd5FmxDyvnYgqcpe4eXd1FJ9zhg%3D" alt="image.png" width="50%" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python数据可视化：从零开始教你绘制精美雷达图]]></title>    <link>https://juejin.cn/post/7570162891142217743</link>    <guid>https://juejin.cn/post/7570162891142217743</guid>    <pubDate>2025-11-09T11:51:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570162891142217743" data-draft-id="7569987064689410082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python数据可视化：从零开始教你绘制精美雷达图"/> <meta itemprop="keywords" content="前端,Python"/> <meta itemprop="datePublished" content="2025-11-09T11:51:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python数据可视化：从零开始教你绘制精美雷达图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T11:51:35.000Z" title="Sun Nov 09 2025 11:51:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">安装必要的库</h2>
<p>我们需要安装两个核心的 Python 库：<code>matplotlib</code> 用于绘图，<code>numpy</code> 用于高效的数值计算：</p>
<pre><code class="hljs language-bash" lang="bash">pip install matplotlib numpy
</code></pre>
<h2 data-id="heading-1">绘制雷达图的核心逻辑</h2>
<p>创建雷达图的过程可以清晰地分解为以下几步，理解了这些步骤，你就能自如地应对各种定制化需求：</p>
<ol>
<li><strong>数据准备</strong>：确定雷达图需要展示的几个维度（标签），以及每个对象在这些维度上的具体数值。</li>
<li><strong>创建极坐标画布</strong>：雷达图并非画在常规的直角坐标系上，而是画在一个圆形布局的<strong>极坐标系 (Polar Coordinates)</strong> 上。</li>
<li><strong>计算角度</strong>：根据维度的数量，将 360 度的圆进行等分，确定每个维度轴线所在的角度。</li>
<li><strong>闭合图形</strong>：为了让雷达图形成一个封闭的多边形，我们需要在数据和角度列表的末尾，额外补充上第一个点的数据和角度。</li>
<li><strong>绘图与美化</strong>：在坐标系上绘制数据点连线、填充颜色、添加网格、标签、图例和标题，使图表变得完整且易于解读。</li>
</ol>
<h2 data-id="heading-2">示例代码</h2>
<p>现在，让我们用具体的代码来实现一个“篮球运动员能力对比”的雷达图。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_table_tennis_radar_chart</span>():
    <span class="hljs-string">"""
    创建一个专门用于展示乒乓球运动员六维能力数据的雷达图。
    """</span>
    <span class="hljs-comment"># 解决中文显示问题</span>
    plt.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = [<span class="hljs-string">'SimHei'</span>]
    plt.rcParams[<span class="hljs-string">'axes.unicode_minus'</span>] = <span class="hljs-literal">False</span>

    <span class="hljs-comment"># 1. 定义六个维度的标签</span>
    labels = np.array([<span class="hljs-string">'力量'</span>, <span class="hljs-string">'速度'</span>, <span class="hljs-string">'技巧'</span>, <span class="hljs-string">'防守'</span>, <span class="hljs-string">'发球'</span>, <span class="hljs-string">'经验'</span>])
    n_labels = <span class="hljs-built_in">len</span>(labels)

    <span class="hljs-comment"># 2. 准备运动员的数据 (这里是假设的示例数据)</span>
    <span class="hljs-comment"># “六边形战士”的数据，各项能力非常均衡且顶尖</span>
    hex_warrior_stats = [<span class="hljs-number">98</span>, <span class="hljs-number">95</span>, <span class="hljs-number">99</span>, <span class="hljs-number">92</span>, <span class="hljs-number">96</span>, <span class="hljs-number">100</span>]
    <span class="hljs-comment"># “进攻型选手”的数据，力量和速度突出，防守相对是短板</span>
    attacker_stats = [<span class="hljs-number">100</span>, <span class="hljs-number">98</span>, <span class="hljs-number">85</span>, <span class="hljs-number">75</span>, <span class="hljs-number">90</span>, <span class="hljs-number">80</span>]

    <span class="hljs-comment"># 3. 计算角度 (360度/6)</span>
    angles = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">2</span> * np.pi, n_labels, endpoint=<span class="hljs-literal">False</span>)

    <span class="hljs-comment"># 4. 闭合图形数据</span>
    hex_warrior_stats_closed = np.concatenate((hex_warrior_stats, [hex_warrior_stats[<span class="hljs-number">0</span>]]))
    attacker_stats_closed = np.concatenate((attacker_stats, [attacker_stats[<span class="hljs-number">0</span>]]))
    angles_closed = np.concatenate((angles, [angles[<span class="hljs-number">0</span>]]))

    <span class="hljs-comment"># 5. 绘图</span>
    fig, ax = plt.subplots(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>), subplot_kw=<span class="hljs-built_in">dict</span>(polar=<span class="hljs-literal">True</span>))

    <span class="hljs-comment"># 设置坐标轴范围</span>
    ax.set_ylim(<span class="hljs-number">0</span>, <span class="hljs-number">105</span>)

    <span class="hljs-comment"># 绘制“六边形战士”</span>
    ax.plot(angles_closed, hex_warrior_stats_closed, <span class="hljs-string">'o-'</span>, color=<span class="hljs-string">'gold'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'“六边形战士”'</span>)
    ax.fill(angles_closed, hex_warrior_stats_closed, <span class="hljs-string">'gold'</span>, alpha=<span class="hljs-number">0.25</span>)

    <span class="hljs-comment"># 绘制“进攻型选手”</span>
    ax.plot(angles_closed, attacker_stats_closed, <span class="hljs-string">'o-'</span>, color=<span class="hljs-string">'red'</span>, linewidth=<span class="hljs-number">2</span>, label=<span class="hljs-string">'进攻型选手'</span>)
    ax.fill(angles_closed, attacker_stats_closed, <span class="hljs-string">'red'</span>, alpha=<span class="hljs-number">0.25</span>)

    <span class="hljs-comment"># 6. 美化图表</span>
    <span class="hljs-comment"># 设置维度标签</span>
    ax.set_thetagrids(angles * <span class="hljs-number">180</span> / np.pi, labels, fontsize=<span class="hljs-number">14</span>)

    <span class="hljs-comment"># 设置半径刻度标签</span>
    ax.set_rlabel_position(<span class="hljs-number">0</span>)
    ax.set_yticklabels([<span class="hljs-string">''</span>, <span class="hljs-string">'20'</span>, <span class="hljs-string">'40'</span>, <span class="hljs-string">'60'</span>, <span class="hljs-string">'80'</span>, <span class="hljs-string">'100'</span>], color=<span class="hljs-string">"grey"</span>, size=<span class="hljs-number">10</span>)

    <span class="hljs-comment"># 添加标题和图例</span>
    plt.title(<span class="hljs-string">'乒乓球运动员能力对比雷达图'</span>, size=<span class="hljs-number">22</span>, color=<span class="hljs-string">'black'</span>, y=<span class="hljs-number">1.1</span>)
    plt.legend(loc=<span class="hljs-string">'best'</span>, bbox_to_anchor=(<span class="hljs-number">1.1</span>, <span class="hljs-number">1.1</span>), fontsize=<span class="hljs-number">12</span>)

    <span class="hljs-comment"># 显示网格</span>
    ax.grid(<span class="hljs-literal">True</span>, linestyle=<span class="hljs-string">'--'</span>, linewidth=<span class="hljs-number">0.5</span>, color=<span class="hljs-string">'gray'</span>)
    
    <span class="hljs-comment"># 显示图表</span>
    plt.show()

<span class="hljs-comment"># --- 主程序入口 ---</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    create_table_tennis_radar_chart()

</code></pre>
<p><strong>解析：</strong></p>
<ol>
<li><strong><code>plt.rcParams</code> 设置</strong>：这两行是为了确保 Matplotlib 可以正确显示中文字符。如果你不设置，图表中的中文可能会显示为方框。你需要确保你的系统中有 <code>SimHei</code> (黑体) 或其他中文字体。</li>
<li><strong><code>np.linspace(0, 2 * np.pi, n_labels, endpoint=False)</code></strong>：这是创建角度数组的核心。它在 0 到 360 度（<code>2*np.pi</code>）之间，生成 <code>n_labels</code> 个等分的角度值。<code>endpoint=False</code>参数是关键，它避免了 360 度和 0 度重合。</li>
<li><strong><code>np.concatenate()</code></strong>：这个 NumPy 函数用于连接数组。我们用它将第一个数据点和第一个角度值拼接到数组的末尾，从而实现图形的闭合。</li>
<li><strong><code>subplot_kw=dict(polar=True)</code></strong>：在创建子图（<code>ax</code>）时，这个参数告诉 Matplotlib：“我想要的不是普通的直角坐标系，而是一个极坐标系”。</li>
<li><strong><code>ax.plot()</code> 和 <code>ax.fill()</code></strong>：<code>plot</code> 负责画出数据的轮廓线，而 <code>fill</code> 则为这个轮廓区域填充上带有一定透明度（<code>alpha</code>）的颜色，使得重叠区域也能清晰可见。</li>
<li><strong><code>ax.set_thetagrids()</code></strong>：这个函数专门用于在极坐标上设置角度网格线（也就是我们的维度轴）的位置和显示的标签。它需要将弧度制的 <code>angles</code> 转换为角度制 (<code>angles * 180 / np.pi</code>)。</li>
</ol>
<h2 data-id="heading-3">效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10aaa8b00d294dc782105344ffe322da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Ob6Zi0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763293895&amp;x-signature=0J%2FQ36R5yUT%2B8KfxW2hMM40ubQk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">结语</h2>
<p><strong>点个赞，关注我获取更多实用 Python 技术干货！如果觉得有用，记得收藏本文！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[提升页面质感：CSS 重复格子背景的实用技巧]]></title>    <link>https://juejin.cn/post/7569904733717233683</link>    <guid>https://juejin.cn/post/7569904733717233683</guid>    <pubDate>2025-11-08T13:36:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569904733717233683" data-draft-id="7569904733717200915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="提升页面质感：CSS 重复格子背景的实用技巧"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-08T13:36:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="elvinnn"/> <meta itemprop="url" content="https://juejin.cn/user/3685218705479655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            提升页面质感：CSS 重复格子背景的实用技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3685218705479655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    elvinnn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-08T13:36:31.000Z" title="Sat Nov 08 2025 13:36:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">重复格子背景</h2>
<p>最近发现不少开发类的网站都在首页使用上了重复格子的背景，例如下图中左侧以 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.relay.app%2F" target="_blank" title="https://www.relay.app/" ref="nofollow noopener noreferrer">relay.app</a> 为例子的截图。</p>
<p>这种背景主要是为了在现在大量留白的设计风格下，避免页面过于空旷，增加一些视觉上的丰富性，不然就会如下图中右侧的截图那样在去掉背景后略显单调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa77e2c23c3843f7a7fd06e986be9e5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWx2aW5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763213791&amp;x-signature=Dmkn7YgpO41EqYPao8adgu1qN6c%3D" alt="背景有无效果对比" loading="lazy"/></p>
<p>接下来具体讲一讲如何用 CSS 实现这种重复格子背景，主要有两种方法：</p>
<ul>
<li>局部格子图片 + 背景重复</li>
<li>CSS 渐变 + 背景重复（推荐）</li>
</ul>
<h3 data-id="heading-1">方法一：局部格子图片 + 背景重复</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.relay.app%2F" target="_blank" title="https://www.relay.app/" ref="nofollow noopener noreferrer">relay.app</a> 使用的就是这种方法，这应该是最常见也是最容易想到的方法，就是先准备一张格子图片，例如：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5517052d65e24a4fb4647cb6799c099b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWx2aW5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763213791&amp;x-signature=6eoqNwhWqxTiSaP5S7FFYDremmA%3D" alt="格子图片" loading="lazy"/></p>
<p>然后通过 <code>background</code> 相关属性进行设置即可，关键在于：</p>
<ul>
<li><code>background-repeat</code> 需要设置为 <code>repeat</code>，保证图片的重复。</li>
<li><code>background-size</code> 可用于调整背景中格子的密度。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">https://framerusercontent.com/images/9c47fOR3CNoSsEtr6IEYJoKM.svg?width=126&amp;height=126</span>);
<span class="hljs-attribute">background-size</span>: <span class="hljs-number">63px</span> auto;
<span class="hljs-attribute">background-repeat</span>: repeat;
<span class="hljs-attribute">background-position</span>: left top;
</code></pre>
<p>下面是一个前端组件使用后的效果示例 (访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Felvinn.wiki%2Fcss%2Fbox-background.html" target="_blank" title="https://elvinn.wiki/css/box-background.html" ref="nofollow noopener noreferrer">我的博客</a> 可以进行交互式体验）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d559a2ed3cf487f93280030b9bea588~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWx2aW5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763213791&amp;x-signature=xroPCRgIcllINNCHNHdZMfzM7cs%3D" alt="SVG 图片实现效果" loading="lazy"/></p>
<h3 data-id="heading-2">方法二：CSS 渐变 + 背景重复（推荐）</h3>
<p>我们还可以通过 CSS 渐变来替代方法一中依赖的外部图片资源，从而实现更快的加载和更灵活的控制，一个简单的例子如下：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">background-image</span>:
    <span class="hljs-built_in">linear-gradient</span>(to right, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">59</span>, <span class="hljs-number">130</span>, <span class="hljs-number">246</span>, <span class="hljs-number">0.08</span>) <span class="hljs-number">1px</span>, transparent <span class="hljs-number">1px</span>),
    <span class="hljs-built_in">linear-gradient</span>(to bottom, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">59</span>, <span class="hljs-number">130</span>, <span class="hljs-number">246</span>, <span class="hljs-number">0.08</span>) <span class="hljs-number">1px</span>, transparent <span class="hljs-number">1px</span>);
<span class="hljs-attribute">background-size</span>: <span class="hljs-number">40px</span> <span class="hljs-number">40px</span>;
<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">3deg</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
</code></pre>
<p>代码的关键在于：</p>
<ul>
<li>通过 <code>linear-gradient</code> 创建一个只有1px宽度的渐变条，颜色为 <code>rgba(59, 130, 246, 0.08)</code> 的部分占 1px，其余部分透明，<code>to right</code> 控制竖向的线条，<code>to bottom</code> 控制横向的线条。</li>
<li>通过 <code>background-size</code> 控制格子的大小。</li>
<li>通过 <code>transform</code> 可以制造倾斜的效果，更加有趣一些。</li>
</ul>
<p>下面是一个前端组件使用后的效果示例 (访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Felvinn.wiki%2Fcss%2Fbox-background.html" target="_blank" title="https://elvinn.wiki/css/box-background.html" ref="nofollow noopener noreferrer">我的博客</a> 可以进行交互式体验）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14545005ee3c4020a5baf94de8bd7ae0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWx2aW5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763213791&amp;x-signature=87xjkKA1gYCDCwcqMmebEeVk0rQ%3D" alt="CSS 渐变实现效果" loading="lazy"/></p>
<p>我最近开发的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjtool.dev%2F" target="_blank" title="https://jtool.dev/" ref="nofollow noopener noreferrer">JTool.dev</a> 首页就是通过方法二实现的效果，也欢迎大家体验：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/091a65b11138430fb49297b84e369aae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWx2aW5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763213791&amp;x-signature=LzbTxNKu%2B1LTTrYDcPpBanSSsUU%3D" alt="JTool.dev 首页截图" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>