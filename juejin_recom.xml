<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ğŸ”¥Angularå¼€å‘è€…çœ‹è¿‡æ¥ï¼šä¸æ­¢äºVueï¼ŒMateChatæ™ºèƒ½åŒ–UIåº“ç°å·²å…¨é¢æ”¯æŒAngularï¼]]></title>    <link>https://juejin.cn/post/7573593395798605870</link>    <guid>https://juejin.cn/post/7573593395798605870</guid>    <pubDate>2025-11-18T03:51:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573593395798605870" data-draft-id="7573506713866797107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥Angularå¼€å‘è€…çœ‹è¿‡æ¥ï¼šä¸æ­¢äºVueï¼ŒMateChatæ™ºèƒ½åŒ–UIåº“ç°å·²å…¨é¢æ”¯æŒAngularï¼"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½,Angular.js"/> <meta itemprop="datePublished" content="2025-11-18T03:51:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DevUIå›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/712139267650141"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥Angularå¼€å‘è€…çœ‹è¿‡æ¥ï¼šä¸æ­¢äºVueï¼ŒMateChatæ™ºèƒ½åŒ–UIåº“ç°å·²å…¨é¢æ”¯æŒAngularï¼
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/6930890095402844163/posts" data-v-d326b38e=""><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6975547f58f744ae8fa9c79ba0a60c3b~tplv-k3u1fbpfcp-watermark.image" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/6930890095402844163/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="DevUIå›¢é˜Ÿ" class="title" data-v-d326b38e="">DevUIå›¢é˜Ÿ</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-11-18T03:51:55.000Z" title="Tue Nov 18 2025 03:51:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-11-18
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                é˜…è¯»11åˆ†é’Ÿ
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        å…³æ³¨
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              å‰ç«¯è§£å†³æ–¹æ¡ˆé›† @åä¸º
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>DevUIå›¢é˜Ÿé‡ç£…æ¨å‡º~MateChat/AngularÂ V20.1.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒ</p>
<p>æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FDevCloudFE%2FMateChat%2Foverview" target="_blank" title="https://gitcode.com/DevCloudFE/MateChat/overview" ref="nofollow noopener noreferrer">gitcode.com/DevCloudFE/â€¦</a></p>
<p>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmatechat.gitcode.com" target="_blank" title="https://matechat.gitcode.com" ref="nofollow noopener noreferrer">matechat.gitcode.com</a></p>
</blockquote>
<p>ä»Šå¤©ç»™å¤§å®¶æ¨èä¸€æ¬¾ä¸“ä¸ºAngularç”Ÿæ€æ‰“é€ çš„æ™ºèƒ½å¯¹è¯UIåº“â€”â€”<strong>MateChat/Angular</strong>ï¼ä½œä¸ºMateChatè·¨æ¡†æ¶ç³»åˆ—çš„å…¨æ–°æˆå‘˜ï¼Œå…¶Vueç‰ˆæœ¬è‡ªå¼€æºæ¥ï¼Œåœ¨GitCodeæ”¶è·1.7k+æ˜Ÿæ ‡ï¼Œç§¯ç´¯äº†è¿‘åƒæ¡ç”¨æˆ·issueåé¦ˆä¸PRè´¡çŒ®ï¼Œæˆä¸ºä¼—å¤šå‰ç«¯å›¢é˜Ÿå¼€å‘AIå¯¹è¯åº”ç”¨çš„é¦–é€‰ç»„ä»¶åº“ä¹‹ä¸€ã€‚å¦‚ä»ŠAngularç‰ˆæœ¬æ­£å¼ä¸Šçº¿ï¼Œä¸ä»…å»¶ç»­äº†Vueç‰ˆçš„ä¼˜ç§€åŸºå› ï¼Œæ›´å®ç°äº†è·¨æ¡†æ¶ä½“éªŒä¸€è‡´æ€§ï¼Œå¼€ç®±å³ç”¨çš„ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼Œè®©Angularå¼€å‘è€…ä¹Ÿèƒ½å¿«é€Ÿæ­å»ºèµ·ç”Ÿäº§çº§åˆ«çš„AIå¯¹è¯åº”ç”¨ã€‚</p>
<h2 data-id="heading-0">MateChat ç®€ä»‹</h2>
<blockquote>
<p>MateChat è®¾è®¡ç†å¿µï¼š<strong>ä½“éªŒæ— è¾¹ç•Œ ä¸šåŠ¡æ— ä¾µå®³</strong></p>
</blockquote>
<p>ä½œä¸ºDevUIå›¢é˜Ÿé‡ç£…æ¨å‡ºçš„å¼€æºé¡¹ç›®ï¼ŒMateChatè‡´åŠ›äºæ„å»ºä¸åŒä¸šåŠ¡åœºæ™¯ä¸‹é«˜ä¸€è‡´æ€§çš„GenAIä½“éªŒç³»ç»Ÿè¯­è¨€ï¼ŒåŒæ—¶åŒ¹é…å„ç§å·¥å…·/å¹³å°çš„åŸç”Ÿä¸šåŠ¡åœºæ™¯å’Œç•Œé¢ç‰¹å¾ï¼Œ æä¾›æ›´é€‚åˆç ”å‘å·¥å…·é¢†åŸŸçš„å¯¹è¯ç»„ä»¶ï¼Œæ‰“é€ æµç•…äº²å’Œã€è·¨ç•Œä¸€è‡´ã€æ˜“å­¦æ˜“ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œä»¥åŠæ˜“æ¥å…¥ã€æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±•çš„å¼€å‘ä½“éªŒã€‚</p>
<p>MateChatä¸ºæ‚¨æä¾›äº†å¿«é€Ÿæ­å»ºç½‘ç«™æ™ºèƒ½åŒ–åœºæ™¯çš„AIè§£å†³æ–¹æ¡ˆï¼Œæ— è®ºæ‚¨æ˜¯åˆåˆ›ä¼ä¸šï¼Œè¿˜æ˜¯å·²ç»æˆç†Ÿçš„å…¬å¸ï¼Œå€ŸåŠ©MateChatï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°è‡ªå®šä¹‰çš„AIåŠ©æ‰‹ï¼Œè¿…é€Ÿæå‡ç½‘ç«™çš„äº’åŠ¨æ€§ä¸ç”¨æˆ·ä½“éªŒã€‚</p>
<h2 data-id="heading-1">ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹©MateChat/Angularï¼Ÿ</h2>
<p>ä½œä¸ºé¢å‘æ™ºèƒ½åŒ–åœºæ™¯çš„ç»„ä»¶åº“ï¼Œå®ƒè§£å†³äº†ä¼ ç»ŸUIåº“åœ¨AIå¯¹è¯åœºæ™¯ä¸‹çš„ã€Œæ°´åœŸä¸æœã€ï¼š</p>
<ul>
<li><strong>å¤©ç”Ÿé€‚é… Angular ç”Ÿæ€</strong>ï¼šä¸æ˜¯é€šç”¨ UI åº“å¥—å£³é€‚é… Angularï¼Œè€Œæ˜¯AngularåŸç”Ÿå¼€å‘ï¼ŒåŸºäºè·¨æ¡†æ¶ç»„ä»¶æ¶æ„è®¾è®¡å¯¹æ ¸å¿ƒé€»è¾‘çš„å¤ç”¨</li>
<li><strong>è·¨æ¡†æ¶ã€Œæ— ç¼è¡”æ¥ã€ï¼Œå¤šç«¯å›¢é˜Ÿç‹‚å–œ</strong>ï¼šä¸<code>MateChat/Vue</code>ç‰ˆæœ¬å®ç°UIæ ·å¼ã€APIè®¾è®¡ã€åŠŸèƒ½ç‰¹æ€§é«˜åº¦ç»Ÿä¸€ï¼Œå¤šæ¡†æ¶é¡¹ç›®å¼€å‘æ— éœ€é‡æ–°é€‚é…ï¼Œé™ä½å›¢é˜Ÿåä½œæˆæœ¬ã€‚</li>
<li><strong>åœºæ™¯åŒ–ç»„ä»¶è®¾è®¡</strong>ï¼šæ‹’ç»é€šç”¨ç»„ä»¶å †ç Œï¼Œ<code>Bubble</code>ã€<code>Input</code>ã€<code>MarkdownCard</code>ä¸‰å¤§æ ¸å¿ƒç»„ä»¶å®Œç¾åŒ¹é…å¯¹è¯æµåœºæ™¯ï¼Œæ”¯æŒæµå¼å¢é‡DOMæ¸²æŸ“ã€æ‰“å­—æœºæ•ˆæœåŠæ·±åº¦æ€è€ƒï¼Œå¤æ‚æ ¼å¼å†…å®¹ä¹Ÿèƒ½æµç•…å±•ç¤ºï¼›bubbleç»„ä»¶æ”¯æŒå¤´åƒã€å¯¹é½æ–¹å¼æ§åˆ¶ï¼Œinputç»„ä»¶é€‚é…å¯¹è¯è¾“å…¥åœºæ™¯ï¼Œæ•´ä½“å®Œç¾åŒ¹é…å¯¹è¯æµéœ€æ±‚ã€‚</li>
<li><strong>å¤šä¸»é¢˜ä¸æ‰©å±•æ€§</strong>ï¼šæ— ç¼å¯¹æ¥DevUIä¸»é¢˜ç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰é…è‰²ï¼›ç»„ä»¶APIè®¾è®¡çµæ´»ï¼Œå¯å¿«é€Ÿé€‚é…ä¸åŒä¸šåŠ¡éœ€æ±‚ã€‚</li>
<li><strong>æµå¼å“åº”å‹å¥½</strong>ï¼šå¤©ç„¶æ”¯æŒå¤§æ¨¡å‹æµå¼è¿”å›ï¼Œæ— éœ€é¢å¤–å°è£…ï¼Œè½»æ¾å®ç°ã€Œæ‰“å­—æœºã€æ•ˆæœã€‚</li>
<li><strong>ç¤¾åŒºå…œåº•ï¼ŒæŒç»­æ¼”è¿›</strong>: MateChatå›¢é˜Ÿç»´æŠ¤ï¼Œæ–‡æ¡£å®æ—¶æ›´æ–°ã€bug ä¿®å¤ä¸æ‹–æ²“ï¼Œä¸Vueç‰ˆæœ¬åŒæ­¥æ¼”è¿›</li>
</ul>
<p>äº†è§£æ›´å¤šè¯·è®¿é—®MateChatç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmatechat.gitcode.com%2Fuse-guide-ng%2Fintroduction.html" title="https://matechat.gitcode.com/use-guide-ng/introduction.html" target="_blank" ref="nofollow noopener noreferrer">MateChat</a></p>
<h2 data-id="heading-2">ğŸ§© MateChat è·¨æ¡†æ¶ç»„ä»¶æ¶æ„ï¼šä» Vue åˆ° Angularï¼Œæˆ‘ä»¬å¦‚ä½•å®ç°åŸç”Ÿçº§ç»„ä»¶å¤ç”¨ï¼Ÿ</h2>
<p>åœ¨å‰ç«¯å›¢é˜Ÿè§„æ¨¡æ‰©å¤§çš„è¿‡ç¨‹ä¸­ï¼Œã€ŒæŠ€æœ¯æ ˆç¢ç‰‡åŒ–ã€å¸¦æ¥çš„ä»£ç å¤ç”¨éš¾é¢˜å‡ ä¹æ˜¯ç»•ä¸å¼€çš„åã€‚æˆ‘ä»¬å›¢é˜Ÿä¹Ÿä¸ä¾‹å¤–ï¼šæ—©æœŸåŸºäº Vue å¼€å‘äº† MateChat ç»„ä»¶åº“ï¼Œæ”¯æ’‘äº†å¤šä¸ªä¸šåŠ¡çº¿ï¼›ä½†éšç€æ–°ä¸šåŠ¡å¼•å…¥ Angular æŠ€æœ¯æ ˆï¼Œé‡å¤å¼€å‘ç›¸ä¼¼ç»„ä»¶ã€ç»´æŠ¤å¤šå¥—é€»è¾‘çš„æˆæœ¬æ€¥å‰§ä¸Šå‡ â€”â€”UI ä¸ä¸€è‡´ã€åŠŸèƒ½ä¸åŒæ­¥ã€å›¢é˜Ÿåä½œæ•ˆç‡ä½ï¼Œè¿™äº›é—®é¢˜é€æ¸æˆä¸ºä¸šåŠ¡è¿­ä»£çš„ç»Šè„šçŸ³ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å†³å®šæ„å»ºã€Œè·¨æ¡†æ¶ç»„ä»¶æ¶æ„ã€ï¼Œåœ¨ MateChat/Vue çš„åŸºç¡€ä¸Šå¼€å‘ MateChat/Angular ç»„ä»¶åº“ã€‚ä½†æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±æ˜ç¡®ï¼š<strong>ä¸åš â€œå¥—å£³é€‚é…â€ï¼Œè€Œæ˜¯è¿½æ±‚åŸç”Ÿä½“éªŒä¸æ ¸å¿ƒé€»è¾‘å¤ç”¨çš„å¹³è¡¡</strong>ã€‚ç°åœ¨ MateChat/Angular å·²æ­£å¼è½åœ°ï¼Œä»Šå¤©å°±æ¥èŠèŠè¿™å¥—æ¶æ„çš„è®¾è®¡æ€è·¯ä¸å®ç°ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-3">1. ä¸ºä»€ä¹ˆä¸é€‰ â€œå¥—å£³â€ï¼ŸèŠèŠè·¨æ¡†æ¶ç»„ä»¶çš„æœ¬è´¨éœ€æ±‚</h3>
<p>åœ¨å†³å®šåš Angular ç‰ˆæœ¬å‰ï¼Œæˆ‘ä»¬è°ƒç ”äº†å¸‚é¢ä¸Šå¸¸è§çš„è·¨æ¡†æ¶æ–¹æ¡ˆï¼Œå‘ç°å¾ˆå¤šå¤šæ¡†æ¶ UI åº“é‡‡ç”¨ â€œæ ¸å¿ƒé€»è¾‘ + æ¡†æ¶æ¡¥æ¥å±‚â€ çš„å¥—å£³æ¨¡å¼ï¼ˆæ¯”å¦‚ç”¨ Vue æ ¸å¿ƒåŒ…äº¦æˆ–æ˜¯Svelteå¼€å‘ç»„ä»¶ï¼Œå†é€šè¿‡æ¡¥æ¥å·¥å…·é€‚é… Angularï¼‰ã€‚ä½†è¿™ç§æ¨¡å¼åœ¨ä¼ä¸šçº§åœºæ™¯ä¸‹æœ‰æ˜æ˜¾çŸ­æ¿ï¼š</p>
<ul>
<li><strong>æ¡†æ¶ç”Ÿæ€å‰²è£‚</strong>ï¼šAngular æœ‰è‡ªå·±çš„ä¾èµ–æ³¨å…¥ã€å˜æ›´æ£€æµ‹ã€æŒ‡ä»¤ç³»ç»Ÿç­‰ç‰¹æ€§ï¼Œå¥—å£³æ¨¡å¼å¾ˆéš¾è´´åˆè¿™äº›åŸç”Ÿèƒ½åŠ›ï¼Œå¯¼è‡´ç»„ä»¶åœ¨ Angular é¡¹ç›®ä¸­æ˜¾å¾— â€œæ ¼æ ¼ä¸å…¥â€ï¼›</li>
<li><strong>æ€§èƒ½æŸè€—</strong>ï¼šæ¡¥æ¥å±‚ä¼šå¢åŠ é¢å¤–çš„æ¸²æŸ“é“¾è·¯å’ŒçŠ¶æ€åŒæ­¥æˆæœ¬ï¼Œåœ¨å¤æ‚ç»„ä»¶ï¼ˆå¦‚è¡¨æ ¼ã€è¡¨å•ï¼‰ä¸­è¡¨ç°å°¤ä¸ºæ˜æ˜¾ï¼›</li>
<li><strong>API è®¾è®¡å¦¥å</strong>ï¼šä¸ºäº†å…¼å®¹å¤šæ¡†æ¶ï¼ŒAPI å¾€å¾€ä¼šå–å„æ¡†æ¶çš„ â€œäº¤é›†â€ï¼Œéš¾ä»¥åˆ©ç”¨ç›®æ ‡æ¡†æ¶çš„ç‰¹æ€§ï¼ˆæ¯”å¦‚ Angular çš„åŒå‘ç»‘å®šè¯­æ³•ç³–<code>[(ngModel)]</code>ï¼‰ã€‚</li>
</ul>
<p>å¯¹æˆ‘ä»¬è€Œè¨€ï¼Œè·¨æ¡†æ¶ç»„ä»¶çš„æ ¸å¿ƒéœ€æ±‚æ˜¯ <strong>â€œä½“éªŒä¸€è‡´ã€å¤ç”¨é«˜æ•ˆã€ç”Ÿæ€èåˆâ€</strong>â€”â€” æ—¢è¦æœ‰ç»Ÿä¸€çš„ UI å’ŒåŠŸèƒ½ï¼Œåˆè¦è®©æ¯ä¸ªæ¡†æ¶çš„å¼€å‘è€…ç”¨å¾— â€œé¡ºæ‰‹â€ï¼Œè¿˜è¦èƒ½å¤§å¹…é™ä½ç»´æŠ¤æˆæœ¬ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©äº†å¦ä¸€æ¡è·¯ï¼š<strong>æ ¸å¿ƒé€»è¾‘ä¸æ¡†æ¶è§£è€¦ï¼Œä¸ºæ¯ä¸ªæ¡†æ¶å¼€å‘åŸç”Ÿé€‚é…å±‚</strong>ã€‚</p>
<h3 data-id="heading-4">2. â€œæ ¸å¿ƒå±‚ + é€‚é…å±‚â€ çš„åˆ†å±‚è®¾è®¡æ¶æ„</h3>
<p>MateChat/Angular çš„ç»„ä»¶å®Œå…¨åŸºäº Angular çš„æœ€ä½³å®è·µå¼€å‘ï¼Œè€Œéç®€å•ç§»æ¤ Vue çš„å®ç°ã€‚å¯¹ Angular å¼€å‘è€…æ¥è¯´ï¼Œä½¿ç”¨ MateChat ç»„ä»¶å°±åƒç”¨å®˜æ–¹ç»„ä»¶ä¸€æ ·è‡ªç„¶ï¼Œæ— éœ€é¢å¤–å­¦ä¹ æˆæœ¬ã€‚</p>
<p>åœ¨è·¨æ¡†æ¶æ¶æ„çš„è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬æ·±å—äº†semi designã€Tinyã€Headlessç­‰ç»„ä»¶åº“æ¶æ„å¯å‘ï¼Œå…¶ â€œæ ¸å¿ƒé€»è¾‘æŠ½è±¡ä¸æ¡†æ¶é€‚é…åˆ†ç¦»â€ çš„æ€è·¯ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†é‡è¦çš„å‚è€ƒã€‚ç«™åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œç»“åˆå›¢é˜Ÿçš„ä¼ä¸šçº§åœºæ™¯éœ€æ±‚ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ç»†åŒ–å‡ºäº†MateChatçš„åˆ†å±‚æ¶æ„æ¨¡å‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c5376817a074b99b58c2b3f4a6afda4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2VUnlm6LpmJ8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042714&amp;x-signature=JU8OIGlfYgBd1HP69rT6Uv9uWGE%3D" alt="image.png" loading="lazy"/></p>
<p>åŸºäºè¿™å¥—è·¨æ¡†æ¶æ¶æ„è½åœ°ï¼Œç»™å›¢é˜Ÿå¸¦æ¥çš„æ”¹å˜æ˜¯æ˜¾è‘—çš„ï¼š</p>
<ul>
<li><strong>è·¨æ¡†æ¶ä¸€è‡´æ€§</strong>ï¼šä» UI åˆ° API çš„ â€œæ— ç¼è¡”æ¥â€ï¼Œæ‰€æœ‰æ¡†æ¶ç»„ä»¶<code>å…±äº«åŒä¸€å¥— CSS å˜é‡å’Œæ ·å¼æ–‡ä»¶</code>ï¼ˆé€šè¿‡ SCSS æ¨¡å—åŒ–ç®¡ç†ï¼‰ï¼Œç¡®ä¿é¢œè‰²ã€é—´è·ã€åŠ¨ç”»åœ¨ä¸åŒæ¡†æ¶ä¸­è¡¨ç°ä¸€è‡´ï¼Œç”¨æˆ·åœ¨ä¸åŒæŠ€æœ¯æ ˆå¼€å‘çš„é¡µé¢ä¸­ï¼Œä¸ä¼šæ„Ÿå—åˆ°ç»„ä»¶äº¤äº’çš„å·®å¼‚ã€‚</li>
<li><strong>API è®¾è®¡å¯¹é½</strong>ï¼šç»„ä»¶çš„å±æ€§ã€äº‹ä»¶ã€æ–¹æ³•å°½å¯èƒ½ä¿æŒåŒåã€‚ä¾‹å¦‚ Vue çš„<code>&lt;mc-input @change="handleChange" /&gt;</code>å’Œ Angular çš„<code>&lt;mc-input (change)="handleChange($event)" /&gt;</code>ï¼Œå¼€å‘è€…åˆ‡æ¢æ¡†æ¶æ—¶å‡ ä¹ä¸ç”¨æ”¹ä»£ç ï¼›</li>
<li><strong>åä½œæˆæœ¬é™ä½</strong>ï¼šå¤šæŠ€æœ¯æ ˆå›¢é˜Ÿæ— éœ€ä¸ºç»„ä»¶é€‚é…åå¤æ²Ÿé€šï¼Œè®¾è®¡ç¨¿â†’ç»„ä»¶å®ç°çš„é“¾è·¯ç»Ÿä¸€ï¼›</li>
<li><strong>ç»´æŠ¤æ•ˆç‡æå‡</strong>ï¼šæ ¸å¿ƒé€»è¾‘ bug ä¿®å¤<code>ä¸€æ¬¡åˆ°ä½</code>ï¼Œé¿å…å¤šæ¡†æ¶é‡å¤æ”¹ä»£ç ï¼Œ<code>æ ¸å¿ƒä»£ç å¤ç”¨ç‡70%ä»¥ä¸Š</code>ï¼›</li>
<li><strong>æŠ€æœ¯ç”Ÿæ€å…¼å®¹</strong>ï¼šåç»­å¦‚æœå¼•å…¥ Reactã€Svelte ç­‰æ–°æ¡†æ¶ï¼Œåªéœ€å¼€å‘è½»é‡é€‚é…å±‚ï¼ˆé¢„ä¼°å·¥ä½œé‡<code>ä»…ä¸ºä»é›¶å¼€å‘çš„ 30%</code>ï¼‰ï¼›</li>
</ul>
<p>å¯¹å¤§å‹ä¼ä¸šæ¥è¯´ï¼Œè¿™ç§æ¶æ„å°¤å…¶æœ‰ä»·å€¼ â€”â€” å®ƒæ—¢å°Šé‡äº†ä¸šåŠ¡å¯¹æŠ€æœ¯æ ˆçš„çµæ´»é€‰æ‹©ï¼Œåˆé€šè¿‡ â€œæ ¸å¿ƒå¤ç”¨â€ å®ˆä½äº†ç ”å‘æ•ˆç‡å’Œäº§å“ä½“éªŒçš„åº•çº¿ã€‚å¦‚æœä½ ä¹Ÿåœ¨é¢ä¸´å¤šæŠ€æœ¯æ ˆç»„ä»¶å¤ç”¨çš„éš¾é¢˜ï¼Œå¸Œæœ›è¿™å¥—æ¶æ„èƒ½ç»™ä½ å¸¦æ¥ä¸€äº›å¯å‘ã€‚æ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµä½ çš„ç»éªŒï½</p>
<h2 data-id="heading-5">ğŸš€ å¿«é€Ÿä¸Šæ‰‹</h2>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå®æ“æ­¥éª¤â€”â€”ä»ç¯å¢ƒæ­å»ºåˆ°ç®€æ˜“å¯¹è¯ç•Œé¢å®ç°ï¼Œå…¨ç¨‹ä¸è¶…è¿‡10åˆ†é’Ÿï¼Œå³ä½¿æ˜¯Angularæ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚</p>
<h3 data-id="heading-6">1. å®‰è£…</h3>
<p>å…ˆåˆå§‹åŒ–Angularé¡¹ç›®ï¼ˆå·²æœ‰é¡¹ç›®å¯è·³è¿‡æ­¤æ­¥ï¼Œæ”¯æŒAngular20ç‰ˆæœ¬ï¼‰ï¼Œå†å®‰è£…<code>@mateChat/ng</code> ï¼š</p>
<pre><code class="hljs language-java" lang="java">npm install -g <span class="hljs-meta">@angular</span>/cli<span class="hljs-meta">@latest</span>
ng <span class="hljs-keyword">new</span> <span class="hljs-title class_">matechat</span>-demo
npm i <span class="hljs-meta">@matechat</span>/ng
</code></pre>
<h3 data-id="heading-7">2. å¼•å…¥</h3>
<p>åœ¨<code>app.ts</code>æ–‡ä»¶ä¸­å¼•å…¥æ¨¡å—ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CommonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/common"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BubbleModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@matechat/ng"</span>;

<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">"app-root"</span>,
  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">CommonModule</span>, <span class="hljs-title class_">BubbleModule</span>],
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">"./app.component.html"</span>,
  <span class="hljs-attr">styleUrl</span>: <span class="hljs-string">"./app.component.css"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppComponent</span> {}
</code></pre>
<h3 data-id="heading-8">3. ä½¿ç”¨</h3>
<p>åœ¨<code>app.html</code>æ–‡ä»¶ä¸­ä½¿ç”¨ MateChat ç»„ä»¶ï¼Œå¦‚ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">mc-bubble</span> [<span class="hljs-attr">content</span>]=<span class="hljs-string">"'Hello, MateChat'"</span> [<span class="hljs-attr">avatarConfig</span>]=<span class="hljs-string">"{ name: 'matechat' }"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mc-bubble</span>&gt;</span>
</code></pre>
<p>åœ¨æ¨¡æ¿ä¸­ç»„åˆBubbleã€Inputã€MarkdownCardç»„ä»¶ï¼Œå³å¯å®ç°ç®€å•çš„å¯¹è¯ç•Œé¢æ­å»ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/188167e8e94243bdaaf11138ad71cb1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2VUnlm6LpmJ8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042714&amp;x-signature=chJ4PiSAMvj3JJ5UPfEdYxRTrTY%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨app.htmlä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mc-layout"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-header"</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">"'MateChat'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://matechat.gitcode.com/logo.svg"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>MateChat<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    @if (newPage) {
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"welcom-page"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-wrapper"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mc-introduction"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mc-introduction-logo-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://matechat.gitcode.com/logo2x.svg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"MateChat"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mc-introduction-title"</span>&gt;</span>MateChat<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mc-introduction-description"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>MateChat å¯ä»¥è¾…åŠ©ç ”å‘äººå‘˜ç¼–ç ã€æŸ¥è¯¢çŸ¥è¯†å’Œç›¸å…³ä½œä¸šä¿¡æ¯ã€ç¼–å†™æ–‡æ¡£ç­‰ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              ä½œä¸ºAIæ¨¡å‹ï¼ŒMateChat æä¾›çš„ç­”æ¡ˆå¯èƒ½ä¸æ€»æ˜¯ç¡®å®šæˆ–å‡†ç¡®çš„ï¼Œä½†æ‚¨çš„åé¦ˆå¯ä»¥å¸®åŠ© MateChat
              åšçš„æ›´å¥½ã€‚
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"guess-question"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"guess-title"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>çŒœä½ æƒ³é—®<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"guess-content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let item of questionList"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"onSubmit(item)"</span>&gt;</span>{{ item }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    } @else {
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-list"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let msg of messages"</span>&gt;</span>
        @if (msg.from === 'user') {
        <span class="hljs-tag">&lt;<span class="hljs-name">mc-bubble</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-bubble"</span> [<span class="hljs-attr">align</span>]=<span class="hljs-string">"'right'"</span> [<span class="hljs-attr">content</span>]=<span class="hljs-string">"msg.content"</span> [<span class="hljs-attr">avatarConfig</span>]=<span class="hljs-string">"avatarConfig"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mc-bubble</span>&gt;</span>
        } @else if (msg.from === 'model') {
        <span class="hljs-tag">&lt;<span class="hljs-name">mc-bubble</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"model-bubble"</span> [<span class="hljs-attr">align</span>]=<span class="hljs-string">"'left'"</span> [<span class="hljs-attr">loading</span>]=<span class="hljs-string">"msg.loading"</span> [<span class="hljs-attr">avatarConfig</span>]=<span class="hljs-string">"modelAvatar"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">mc-markdown-card</span> [<span class="hljs-attr">content</span>]=<span class="hljs-string">"msg.content"</span> [<span class="hljs-attr">enableMermaid</span>]=<span class="hljs-string">"true"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mc-markdown-card</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">mc-bubble</span>&gt;</span>
        }
      <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    }
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-footer"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mc-input</span> (<span class="hljs-attr">submit</span>)=<span class="hljs-string">"onSubmit($event)"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">mc-input</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"statement-box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>å†…å®¹ç”±AIç”Ÿæˆï¼Œæ— æ³•ç¡®ä¿å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ï¼Œä»…ä¾›å‚è€ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>åœ¨app.tsä¸­ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CommonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BubbleModule</span>, <span class="hljs-title class_">InputModule</span>, <span class="hljs-title class_">MarkdownCardModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@matechat/ng'</span>;
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">CommonModule</span>, <span class="hljs-title class_">BubbleModule</span>, <span class="hljs-title class_">InputModule</span>, <span class="hljs-title class_">MarkdownCardModule</span>],
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./app.html'</span>,
  <span class="hljs-attr">styleUrl</span>: <span class="hljs-string">'./app.scss'</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
  inputValue = <span class="hljs-string">''</span>;
  <span class="hljs-attr">messages</span>: <span class="hljs-built_in">any</span> = [];
  newPage = <span class="hljs-literal">true</span>;
  questionList = [
    <span class="hljs-string">'å¸®æˆ‘å†™ä¸€ç¯‡æ–‡ç« '</span>,
    <span class="hljs-string">'ä½ å¯ä»¥å¸®æˆ‘åšäº›ä»€ä¹ˆï¼Ÿ'</span>,
    <span class="hljs-string">'å¸®æˆ‘å†™ä¸€ä¸ªå¿«é€Ÿæ’åº'</span>,
    <span class="hljs-string">'ä½¿ç”¨ js æ ¼å¼åŒ–æ—¶é—´'</span>,
  ];
  avatarConfig = {
    <span class="hljs-attr">imgSrc</span>: <span class="hljs-string">'https://matechat.gitcode.com/png/demo/userAvatar.svg'</span>,
  };
  modelAvatar = {
    <span class="hljs-attr">imgSrc</span>: <span class="hljs-string">'https://matechat.gitcode.com/logo.svg'</span>,
  };

  onSubmit = <span class="hljs-function">(<span class="hljs-params">evt: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">newPage</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputValue</span> = <span class="hljs-string">''</span>;
    <span class="hljs-comment">// ç”¨æˆ·å‘é€æ¶ˆæ¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">from</span>: <span class="hljs-string">'user'</span>,
      <span class="hljs-attr">content</span>: evt,
    });
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ¨¡å‹è¿”å›æ¶ˆæ¯</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">from</span>: <span class="hljs-string">'model'</span>,
        <span class="hljs-attr">content</span>: evt,
      });
    }, <span class="hljs-number">200</span>);
  };
}
</code></pre>
<p>åœ¨å°†æ¨¡æ¿åº”ç”¨ä¸­çš„app.cssä¿®æ”¹æˆ<code>app.scss</code>ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">::ng-deep body {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-text, <span class="hljs-number">#252b3a</span>);
}

<span class="hljs-selector-class">.mc-layout</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(
    to bottom,
    <span class="hljs-number">#d0c9ff</span> <span class="hljs-number">0%</span>,
    <span class="hljs-number">#e6d6f0</span> <span class="hljs-number">8%</span>,
    <span class="hljs-number">#f1dbea</span> <span class="hljs-number">12%</span>,
    <span class="hljs-number">#c8dcfb</span> <span class="hljs-number">40%</span>,
    <span class="hljs-number">#abc6f6</span> <span class="hljs-number">60%</span>,
    <span class="hljs-number">#87aefe</span> <span class="hljs-number">90%</span>
  );
}

::ng-deep body[ui-theme=<span class="hljs-string">'galaxy-theme'</span>] .mc-layout {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--devui-global-bg, <span class="hljs-number">#f6f6f8</span>);

  <span class="hljs-selector-class">.chat-container</span> {
    <span class="hljs-attribute">background</span>: transparent;
    <span class="hljs-attribute">border</span>: none;
  }
}

<span class="hljs-selector-class">.chat-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.welcom-page</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">overflow</span>: auto;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">24px</span>;
}

<span class="hljs-selector-class">.guess-title</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-text, <span class="hljs-number">#252b3a</span>);
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
}

<span class="hljs-selector-class">.guess-content</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">flex-wrap</span>: wrap;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.mc-introduction-logo-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.mc-introduction-description</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-text, <span class="hljs-number">#252b3a</span>);
}

<span class="hljs-selector-class">.mc-introduction-title</span> {
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">700</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-text, <span class="hljs-number">#252b3a</span>);
}

<span class="hljs-selector-class">.guess-question</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--devui-base-bg, <span class="hljs-number">#ffffff</span>);
}

<span class="hljs-selector-class">.guess-question-title</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">700</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-text, <span class="hljs-number">#252b3a</span>);
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
}

<span class="hljs-selector-class">.guess-question</span> <span class="hljs-selector-tag">span</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-built_in">var</span>(--devui-font-size, <span class="hljs-number">12px</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-aide-text, <span class="hljs-number">#71757f</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">var</span>(--devui-border-radius-full, <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--devui-dividing-line, <span class="hljs-number">#f2f2f3</span>);
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.content-wrapper</span> {
  <span class="hljs-attribute">margin</span>: auto <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.chat-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">180deg</span>, <span class="hljs-number">#fffffff2</span>, <span class="hljs-number">#f8fafff2</span> <span class="hljs-number">99%</span>);
}

<span class="hljs-selector-class">.chat-header</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;

  <span class="hljs-selector-tag">img</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">32px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  }

  <span class="hljs-selector-tag">span</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-text, <span class="hljs-number">#252b3a</span>);
  }
}

<span class="hljs-selector-class">.mc-introduction</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.chat-list</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">overflow</span>: auto;

  <span class="hljs-selector-class">.user-bubble</span>,
  <span class="hljs-selector-class">.model-bubble</span> {
    <span class="hljs-attribute">display</span>: block;
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">8px</span>;
  }
}

<span class="hljs-selector-class">.chat-footer</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">12px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-class">.statement-box</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--devui-aide-text, <span class="hljs-number">#71757f</span>);
  <span class="hljs-attribute">text-align</span>: center;
}

</code></pre>
<p>å‚æ•°ä¸Šè¿°ä»£ç ï¼Œæ­¤å¤„ä½ å·²ç»å¯ä»¥æ­èµ·ä¸€ä¸ªåŸºç¡€çš„æ™ºèƒ½å¯¹è¯ç•Œé¢äº†ï¼Œå¦‚æœä½ éœ€è¦æ›´å¤šä¸°å¯Œçš„ä¸»é¢˜æ ·å¼ï¼Œæˆ–è€…å¯¹æ¥çœŸå®å¤§æ¨¡å‹ï¼Œå¯ä»¥å‚è€ƒç¬¬ 4ã€5 ç‚¹è¿›è¡Œä½¿ç”¨ã€‚</p>
<h3 data-id="heading-9">4. ä¸»é¢˜åŒ–</h3>
<p>åœ¨<code>main.ts</code>ä¸­åˆå§‹åŒ–ä¸»é¢˜ï¼Œæ›´å¤šç”¨æ³•å¯å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmatechat.gitcode.com%2Fuse-guide%2Ftheme.html" target="_blank" title="https://matechat.gitcode.com/use-guide/theme.html" ref="nofollow noopener noreferrer">devui-theme</a></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { bootstrapApplication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;
<span class="hljs-keyword">import</span> { appConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app/app.config'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">App</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app/app'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeServiceInit</span>, infinityTheme, galaxyTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">'devui-theme'</span>;

<span class="hljs-title class_">ThemeServiceInit</span>(
  {
    <span class="hljs-string">'galaxy-theme'</span>: galaxyTheme, <span class="hljs-comment">// æš—é»‘ä¸»é¢˜</span>
    <span class="hljs-string">'infinity-theme'</span>: infinityTheme,
  },
  <span class="hljs-string">'galaxy-theme'</span>
);
<span class="hljs-title function_">bootstrapApplication</span>(<span class="hljs-title class_">App</span>, appConfig).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));

</code></pre>
<p>åŸºç¡€æ•ˆæœå¦‚ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯MarkdownCardç»„ä»¶çš„ä¸»é¢˜éœ€è¦ä¸»åŠ¨ä¼ å…¥ï¼Œæ›´å¤šç”¨æ³•è¯·å‚è€ƒå®˜ç½‘æ¼”ç¤ºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40630866cec24418a1fe9aa0fabad87e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2VUnlm6LpmJ8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042714&amp;x-signature=X6J3%2B8p0iPcFQB1SMluv29MIbNM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">5. å¯¹æ¥æ¨¡å‹æœåŠ¡</h3>
<p>åœ¨æ­å»ºå®Œæˆé¡µé¢åï¼Œå¯ä»¥å¼€å§‹å¯¹æ¥æ¨¡å‹æœåŠ¡ï¼Œå¦‚Â <code>DeepSeek</code>ã€<code>ChatGPT</code>Â ç­‰ä¼˜ç§€å¤§æ¨¡å‹ï¼Œåœ¨æ³¨å†Œå¹¶ç”Ÿæˆå¯¹åº”æ¨¡å‹çš„è°ƒç”¨API_Keyåï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼š</p>
<ol>
<li>é€šè¿‡ npm å®‰è£… openai:</li>
</ol>

<pre><code class="hljs">npm install openai
</code></pre>
<p>2.  ä½¿ç”¨OpenAIåˆå§‹åŒ–å¹¶è°ƒç”¨æ¨¡å‹æ¥å£ï¼Œå¦‚ä¸‹ä¸ºä¸€æ®µä»£ç ç¤ºä¾‹ï¼š</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ¨¡å‹APIKey</span>
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ¨¡å‹APIåœ°å€</span>
  <span class="hljs-attr">dangerouslyAllowBrowser</span>: <span class="hljs-literal">true</span>,
});

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = (<span class="hljs-params">ques</span>) =&gt; {
  <span class="hljs-keyword">const</span> completion = <span class="hljs-keyword">await</span> client.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">'my-model'</span>, <span class="hljs-comment">// æ›¿æ¢ä¸ºè‡ªå·±çš„modelåç§°</span>
    <span class="hljs-attr">messages</span>: [
      { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: ques },
    ],
    <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ä¸º true åˆ™å¼€å¯æ¥å£çš„æµå¼è¿”å›</span>
  });

  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> completion) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'content: '</span>, chunk.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">delta</span>?.<span class="hljs-property">content</span> || <span class="hljs-string">''</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'chatId: '</span>, chunk.<span class="hljs-property">id</span>);
  }
}
</code></pre>
<p>é‚£ä¹ˆå‚è€ƒä»¥ä¸Šæ­¥éª¤ï¼Œã€å¿«é€Ÿå¼€å§‹ã€‘ä¸­ç¤ºä¾‹å¯è°ƒæ•´ä¸‹ä»£ç ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">onSubmit</span> = (evt) =&gt; {
  <span class="hljs-attr">this.newPage</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  <span class="hljs-attr">this.inputValue</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
  // ç”¨æˆ·å‘é€æ¶ˆæ¯
  this.messages.push({
    from: 'user',
    content: evt,
  })<span class="hljs-comment">;</span>
  setTimeout(() =&gt; {
    // æ¨¡å‹è¿”å›æ¶ˆæ¯
    this.messages.push({
      from: 'model',
      content: evt,
    })<span class="hljs-comment">;</span>
  }, 200)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> OpenAI from <span class="hljs-string">'openai'</span>;

client = new OpenAI({
  apiKey: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ¨¡å‹APIKey</span>
  baseURL: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ¨¡å‹APIåœ°å€</span>
  dangerouslyAllowBrowser: <span class="hljs-literal">true</span>,
});

 onSubmit = async (evt) =&gt; {
  <span class="hljs-keyword">this</span>.newPage = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">this</span>.inputValue = <span class="hljs-string">''</span>;
  <span class="hljs-comment">// ç”¨æˆ·å‘é€æ¶ˆæ¯</span>
  <span class="hljs-keyword">this</span>.messages.push({
    from: <span class="hljs-string">'user'</span>,
    content: evt,
    avatarConfig: { name: <span class="hljs-string">'user'</span> },
  });

  <span class="hljs-keyword">this</span>.fetchData(evt);
};

fetchData = async (ques) =&gt; {
  <span class="hljs-keyword">this</span>.messages.push({
    from: <span class="hljs-string">'model'</span>,
    content: <span class="hljs-string">''</span>,
    avatarConfig: { name: <span class="hljs-string">'model'</span> },
    id: <span class="hljs-string">''</span>,
    loading: <span class="hljs-literal">true</span>,
  });
  <span class="hljs-keyword">const</span> completion = await <span class="hljs-keyword">this</span>.client.chat.completions.create({
    model: <span class="hljs-string">'my-model'</span>, <span class="hljs-comment">// æ›¿æ¢ä¸ºè‡ªå·±çš„modelåç§°</span>
    messages: [{ role: <span class="hljs-string">'user'</span>, content: ques }],
    stream: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ä¸º true åˆ™å¼€å¯æ¥å£çš„æµå¼è¿”å›</span>
  });
  <span class="hljs-keyword">for</span> await (<span class="hljs-keyword">const</span> chunk of completion) {
    <span class="hljs-keyword">this</span>.messages[<span class="hljs-keyword">this</span>.messages.length - <span class="hljs-number">1</span>].loading = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">const</span> content = chunk.choices[<span class="hljs-number">0</span>]?.delta?.content || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">const</span> chatId = chunk.id;
    <span class="hljs-keyword">this</span>.messages[<span class="hljs-keyword">this</span>.messages.length - <span class="hljs-number">1</span>].content += content;
    <span class="hljs-keyword">this</span>.messages[<span class="hljs-keyword">this</span>.messages.length - <span class="hljs-number">1</span>].id = chatId;
  }
};
</code></pre>
<p>å®Œæˆæ¨¡å‹APIåœ°å€ä¸APIKeyå¡«å……å¹¶é…ç½®modelåç§°åï¼Œå³æ‹¥æœ‰äº†ä¸€ä¸ªå¯¹æ¥å¤§æ¨¡å‹çš„ç®€å•åº”ç”¨ã€‚å¦‚æœä½ æƒ³è¦å‚è€ƒæ›´å®Œæ•´çš„é¡µé¢ç¤ºä¾‹ï¼Œå¯å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fmatechat.gitcode.com%2Fvue-starter%2F" target="_blank" title="https://matechat.gitcode.com/vue-starter/" ref="nofollow noopener noreferrer">æ¼”ç¤ºåœºæ™¯</a>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7aee3d913ef24c7f937319f7fc8ed1c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2VUnlm6LpmJ8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042714&amp;x-signature=SKeqrnp4dkLg5kOSKxhpM%2Ft%2BwLQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">ğŸ“ æå‡ºæ„è§&amp;å»ºè®®</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40matechat%2Fng%23-%25E6%258F%2590%25E5%2587%25BA%25E6%2584%258F%25E8%25A7%2581%25E5%25BB%25BA%25E8%25AE%25AE" target="_blank" title="https://www.npmjs.com/package/@matechat/ng#-%E6%8F%90%E5%87%BA%E6%84%8F%E8%A7%81%E5%BB%BA%E8%AE%AE" ref="nofollow noopener noreferrer"/></p>
<p>æˆ‘ä»¬éå¸¸æ¬¢è¿æ‚¨çš„å»ºè®®ï¼Œæ‚¨çš„æ¯ä¸€ä¸ªæƒ³æ³•éƒ½å¯èƒ½å¸®åŠ©æˆ‘ä»¬æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•å…³äºåŠŸèƒ½æ”¹è¿›ã€ç‰¹æ€§æ–°å¢ã€æ–‡æ¡£è¡¥å……æˆ–è€…å…¶ä»–æ–¹é¢çš„å»ºè®®ï¼Œéšæ—¶åœ¨Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FDevCloudFE%2FMateChat%2Fissues" target="_blank" title="https://gitcode.com/DevCloudFE/MateChat/issues" ref="nofollow noopener noreferrer">issues</a>Â æäº¤ã€‚</p>
<h2 data-id="heading-12">ğŸ”§ æœ¬åœ°å¼€å‘</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40matechat%2Fng%23-%25E6%259C%25AC%25E5%259C%25B0%25E5%25BC%2580%25E5%258F%2591" target="_blank" title="https://www.npmjs.com/package/@matechat/ng#-%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-scss" lang="scss">git clone git<span class="hljs-keyword">@gitcode</span>.<span class="hljs-attribute">com</span>:DevCloudFE/MateChat.git
cd matechat
pnpm i
pnpm run <span class="hljs-attribute">docs</span>:dev
</code></pre>
<h2 data-id="heading-13">ğŸ“… ç‰¹æ€§è§„åˆ’</h2>
<p>ç›®å‰ MateChat å·²æ”¯æŒ Vue å’Œ Angularï¼Œåç»­æˆ‘ä»¬ä¹Ÿå°†æ¨å‡ºReactç‰ˆæœ¬ï¼Œä½ å¯åœ¨è¿™é‡Œæ›´å¤šäº†è§£æˆ‘ä»¬çš„è®¡åˆ’ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FDevCloudFE%2FMateChat%2Fissues" target="_blank" title="https://gitcode.com/DevCloudFE/MateChat/issues" ref="nofollow noopener noreferrer">MateChat ç‰¹æ€§è®¡åˆ’</a></p>
<h2 data-id="heading-14">ğŸ† è´¡çŒ®è€…è£èª‰</h2>
<p>æ„Ÿè°¢æœ¬æœŸè¿™äº›ä¼˜ç§€çš„è´¡çŒ®è€…ï¼ˆGitCode IDï¼‰ï¼š</p>
<ul>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fliuguolin" target="_blank" title="https://gitcode.com/liuguolin" ref="nofollow noopener noreferrer">@liuguolin</a></strong> â€”â€” æ–°å¢@matechat/ngç»„ä»¶åº“</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fdd-code-dd" target="_blank" title="https://gitcode.com/dd-code-dd" ref="nofollow noopener noreferrer">@dd-code-dd</a></strong> â€”â€” æ–°å¢MateChatä¸»é¡µç½‘ç«™Angularç‰ˆæœ¬</li>
</ul>
<p>æˆ‘ä»¬è¯šæŒšåœ°é‚€è¯·æ‚¨åŠ å…¥ MateChat ç¤¾åŒºï¼Œä¸€èµ·å‚ä¸é¡¹ç›®çš„å»ºè®¾ã€‚æ— è®ºæ‚¨æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…ï¼Œè¿˜æ˜¯åˆšåˆšèµ·æ­¥çš„ç¼–ç¨‹çˆ±å¥½è€…ï¼Œæ‚¨çš„è´¡çŒ®éƒ½å¯¹æˆ‘ä»¬è‡³å…³é‡è¦ï¼Œè¿™é‡Œæ˜¯æˆ‘ä»¬çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FDevCloudFE%2FMateChat%2Fblob%2Fmain%2FCONTRIBUTING.md" target="_blank" title="https://gitcode.com/DevCloudFE/MateChat/blob/main/CONTRIBUTING.md" ref="nofollow noopener noreferrer">ã€è´¡çŒ®æŒ‡å—ã€‘</a>ã€‚</p>
<h2 data-id="heading-15">ğŸ“£ åŠ å…¥æˆ‘ä»¬</h2>
<p>MateChat æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œæˆ‘ä»¬æ¬¢è¿æ›´å¤šå¼€å‘è€…åŠ å…¥ï¼š</p>
<ul>
<li>ğŸ’¬ DevUIå¾®ä¿¡å°åŠ©æ‰‹ï¼šdevui-officialï¼ˆæ·»åŠ æ—¶è¯·å¤‡æ³¨MateChatï¼‰</li>
<li>ğŸŒŸ ä»£ç ä»“åº“åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FDevCloudFE%2FMateChat%2Freleases%3FpresetConfig%3D%257B%2522tags%2522%3A12%2C%2522release%2522%3A11%257D" target="_blank" title="https://gitcode.com/DevCloudFE/MateChat/releases?presetConfig=%7B%22tags%22:12,%22release%22:11%7D" ref="nofollow noopener noreferrer">gitcode.com/DevCloudFE/â€¦</a></li>
</ul>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21f25f459a984f3f864807f5ced93d6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2VUnlm6LpmJ8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042714&amp;x-signature=78h7vAZfiZngM0KT4pDwH5PVBUE%3D" height="150px" loading="lazy"/> 
<blockquote>
<p>å¹¿çº³è´¤å£«ï¼šAIèµ‹èƒ½å„è¡Œå„ä¸šï¼ŒMateChatæœŸå¾…æ›´å¤šæ„Ÿå…´è¶£çš„å°ä¼™ä¼´åŠ å…¥æˆ‘ä»¬~</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FDevCloudFE%2FMateChat%2Fissues" target="_blank" title="https://gitcode.com/DevCloudFE/MateChat/issues" ref="nofollow noopener noreferrer">æ¬¢è¿å¤§å®¶å‰æ¥æäº¤Issueï¼Œè®¤é¢†Issueï¼›</a></li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘ä»è¿™5ä¸ªæŠ€å·§ä¸­è·å¾—äº†40%çš„æ¸²æŸ“æå‡]]></title>    <link>https://juejin.cn/post/7573588675638132751</link>    <guid>https://juejin.cn/post/7573588675638132751</guid>    <pubDate>2025-11-18T04:19:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675638132751" data-draft-id="7573594825317990440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘ä»è¿™5ä¸ªæŠ€å·§ä¸­è·å¾—äº†40%çš„æ¸²æŸ“æå‡"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-18T04:19:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘ä»è¿™5ä¸ªæŠ€å·§ä¸­è·å¾—äº†40%çš„æ¸²æŸ“æå‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T04:19:32.000Z" title="Tue Nov 18 2025 04:19:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘ä»è¿™5ä¸ªæŠ€å·§ä¸­è·å¾—äº†40%çš„æ¸²æŸ“æå‡</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–å§‹ç»ˆæ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜ã€‚éšç€Vue3çš„æ™®åŠï¼Œå…¶å“åº”å¼ç³»ç»Ÿå’Œç¼–è¯‘å™¨çš„æ”¹è¿›å·²ç»å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šé‡åˆ°å¤æ‚çš„ç»„ä»¶æ ‘ã€é¢‘ç¹çš„DOMæ›´æ–°ç­‰é—®é¢˜ã€‚æœ¬æ–‡å°†åˆ†äº«æˆ‘åœ¨ä¸€ä¸ªå¤§å‹åå°ç®¡ç†ç³»ç»Ÿé¡¹ç›®ä¸­ï¼Œé€šè¿‡5ä¸ªå…³é”®ä¼˜åŒ–æŠ€å·§å®ç°40%æ¸²æŸ“æ€§èƒ½æå‡çš„å®æˆ˜ç»éªŒã€‚</p>
<p>è¿™äº›æŠ€å·§ä¸æ˜¯ç®€å•çš„ç†è®ºæ¨æµ‹ï¼Œè€Œæ˜¯ç»è¿‡Chrome DevToolsæµ‹é‡ã€ç”Ÿäº§ç¯å¢ƒéªŒè¯çš„æœ‰æ•ˆæ‰‹æ®µã€‚æ— è®ºä½ æ˜¯æ­£åœ¨è¿ç§»åˆ°Vue3è¿˜æ˜¯å·²ç»åœ¨ä½¿ç”¨Vue3è¿›è¡Œå¼€å‘ï¼Œè¿™äº›ç»éªŒéƒ½èƒ½å¸®åŠ©ä½ æ„å»ºæ›´é«˜æ•ˆçš„åº”ç”¨ã€‚</p>
<h2 data-id="heading-2">ä¸»ä½“éƒ¨åˆ†</h2>
<h3 data-id="heading-3">ä¸€ã€åˆç†ä½¿ç”¨v-memoå‡å°‘ä¸å¿…è¦çš„å­ç»„ä»¶æ›´æ–°</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-memo</span>=<span class="hljs-string">"[user.id]"</span>&gt;</span>
    {{ user.name }}
    <span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> <span class="hljs-attr">:user</span>=<span class="hljs-string">"user"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>åœ¨Vue3.2ä¸­å¼•å…¥çš„<code>v-memo</code>æŒ‡ä»¤æ˜¯æˆ‘å‘ç°çš„ç¬¬ä¸€ä¸ªæ€§èƒ½åˆ©å™¨ã€‚å®ƒå…è®¸æˆ‘ä»¬æ˜¾å¼åœ°å£°æ˜å“ªäº›ä¾èµ–å˜åŒ–æ—¶æ‰éœ€è¦é‡æ–°æ¸²æŸ“è¯¥éƒ¨åˆ†DOMã€‚</p>
<p><strong>æ·±åº¦è§£æï¼š</strong></p>
<ul>
<li><code>v-memo</code>çš„å·¥ä½œåŸç†ç±»ä¼¼äºReactçš„<code>useMemo</code>ï¼Œä½†ä½œç”¨äºæ¨¡æ¿çº§åˆ«</li>
<li>æœ€é€‚åˆç”¨äºï¼š
<ul>
<li>å¤§å‹åˆ—è¡¨ä¸­çš„é‡å¤é¡¹</li>
<li>å…·æœ‰å¤æ‚è®¡ç®—å±æ€§çš„ç»„ä»¶</li>
<li>propså˜åŒ–ä¸é¢‘ç¹ä½†çˆ¶ç»„ä»¶ç»å¸¸é‡ç»˜çš„åœºæ™¯</li>
</ul>
</li>
</ul>
<p>åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªåŒ…å«200+é¡¹çš„è¡¨æ ¼ä½¿ç”¨<code>v-memo</code>åï¼Œæ›´æ–°æ—¶é—´ä»120msé™åˆ°äº†45msã€‚å…³é”®åœ¨äºé€‰æ‹©æ­£ç¡®çš„memoä¾èµ–é¡¹ - åº”è¯¥æ˜¯æœ€å°åŒ–çš„ã€èƒ½ä»£è¡¨UIå˜åŒ–çš„æ ‡è¯†ç¬¦ã€‚</p>
<h3 data-id="heading-4">äºŒã€ç²¾ç»†åŒ–å“åº”å¼æ§åˆ¶ï¼šä»reactiveåˆ°refå’ŒshallowRef</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ Before</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">items</span>: [], <span class="hljs-comment">// deep reactivity not needed</span>
  <span class="hljs-attr">config</span>: {...} 
});

<span class="hljs-comment">// âœ… After</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">shallowRef</span>([]); <span class="hljs-comment">// no deep reactivity</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-title function_">ref</span>({...}); <span class="hljs-comment">// only need value reactivity</span>
</code></pre>
<p>Vue3æä¾›äº†å¤šç§å“åº”å¼APIé€‰æ‹©ï¼š</p>
<ol>
<li><strong>reactive</strong>ï¼šæ·±å±‚å“åº”å¼ï¼Œé€‚åˆå¤æ‚çŠ¶æ€å¯¹è±¡</li>
<li><strong>ref</strong>ï¼šå€¼ç±»å‹å“åº”å¼åŒ…è£…å™¨</li>
<li><strong>shallowRef/shallowReactive</strong>ï¼šæµ…å±‚å“åº”å¼</li>
</ol>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼š</strong></p>
<ul>
<li><code>shallowRef</code>æ¯”æ™®é€š<code>ref</code>å‡å°‘çº¦15%çš„å†…å­˜å¼€é”€ï¼ˆåŸºäºæˆ‘çš„æµ‹è¯•ï¼‰</li>
<li><code>shallowReactive</code>åœ¨å¤§å¯¹è±¡ï¼ˆ1000+å±æ€§ï¼‰åœºæ™¯ä¸‹æ¯”æ™®é€šreactiveå¿«30%</li>
</ul>
<p>å…³é”®åŸåˆ™æ˜¯ï¼š"æŒ‰éœ€å“åº”"ã€‚å¯¹äºä¸éœ€è¦æ·±åº¦ç›‘å¬çš„æ•°ç»„æˆ–å¯¹è±¡ï¼Œä¼˜å…ˆè€ƒè™‘æµ…å±‚å“åº”å¼æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-5">ä¸‰ã€è™šæ‹Ÿæ»šåŠ¨ä¸DOMå›æ”¶ç­–ç•¥</h3>
<p>å¯¹äºé•¿åˆ—è¡¨æ¸²æŸ“ï¼Œè™šæ‹Ÿæ»šåŠ¨æ˜¯å¿…ä¸å¯å°‘çš„ä¼˜åŒ–æ‰‹æ®µã€‚æˆ‘å¯¹æ¯”äº†ä¸»æµæ–¹æ¡ˆçš„æ€§èƒ½ï¼š</p>

























<table><thead><tr><th>Library</th><th>Avg FPS (10000 items)</th><th>Memory Usage</th></tr></thead><tbody><tr><td>vue-virtual-scroller</td><td>58fps</td><td>~45MB</td></tr><tr><td>vueuc/VVirtualList</td><td>62fps</td><td>~42MB</td></tr><tr><td>Custom Solution</td><td>65fps</td><td>~38MB</td></tr></tbody></table>
<p><strong>å®šåˆ¶åŒ–ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š</strong></p>
<ol>
<li><strong>åŠ¨æ€é¡¹é«˜ä¼°ç®—</strong>ï¼šé¢„å…ˆè®¡ç®—å¹³å‡é«˜åº¦ä½œä¸ºfallbackå€¼</li>
<li><strong>æ»šåŠ¨èŠ‚æµç­–ç•¥</strong>ï¼šrequestAnimationFrame + leading edgeè§¦å‘</li>
<li><strong>DOMå›æ”¶å»¶è¿Ÿ</strong>ï¼šä¿ç•™å±å¹•å¤–50pxå†…çš„å…ƒç´ é˜²æ­¢å¿«é€Ÿå›æ»šé—ªçƒ</li>
</ol>
<p>æˆ‘çš„å®ç°æœ€ç»ˆè¾¾åˆ°äº†10,000é¡¹60fpså¹³æ»‘æ»šåŠ¨çš„æ•ˆæœã€‚</p>
<h3 data-id="heading-6">å››ã€Composition APIçš„ç»„ç»‡è‰ºæœ¯</h3>
<p>é”™è¯¯çš„é€»è¾‘ç»„ç»‡æ–¹å¼ä¼šå¯¼è‡´ä¸å¿…è¦çš„è®¡ç®—ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ Anti-pattern: expensive operation in setup()</span>
<span class="hljs-keyword">const</span> sortedList = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> 
  hugeArray.<span class="hljs-property">value</span>.<span class="hljs-title function_">sort</span>(complexSort)
);

<span class="hljs-comment">// âœ… Better: lazy evaluation when needed</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useSortedData</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-keyword">const</span> sorted = <span class="hljs-title function_">ref</span>([]);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sort</span> = (<span class="hljs-params"/>) =&gt; {
    sorted.<span class="hljs-property">value</span> = [...array.<span class="hljs-property">value</span>].<span class="hljs-title function_">sort</span>(complexSort);
  };
  
  <span class="hljs-keyword">return</span> { sorted, sort };
}
</code></pre>
<p>æœ€ä½³å®è·µï¼š</p>
<ol>
<li><strong>å»¶è¿Ÿè®¡ç®—</strong>ï¼šåªåœ¨éœ€è¦æ—¶æ‰§è¡Œæ˜‚è´µæ“ä½œ</li>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šå°†æ•°æ®è·å–/è½¬æ¢/åˆ†é¡µæ‹†åˆ†ä¸ºç‹¬ç«‹composables</li>
<li><strong>å…±äº«çŠ¶æ€</strong>ï¼šé€šè¿‡provide/injectè·¨ç»„ä»¶å¤ç”¨å·²è®¡ç®—ç»“æœ</li>
</ol>
<p>åœ¨æˆ‘çš„ä»ªè¡¨ç›˜æ¨¡å—é‡æ„åï¼Œåˆå§‹æ¸²æŸ“æ—¶é—´ä»380msé™è‡³210msã€‚</p>
<h3 data-id="heading-7">äº”ã€ç¼–è¯‘æ—¶ä¼˜åŒ–é…ç½®æ­ç§˜</h3>
<p>å¾ˆå°‘æœ‰äººæ·±å…¥æŒ–æ˜Vueç¼–è¯‘å™¨çš„ä¼˜åŒ–æ½œåŠ›ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
 <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>({
   <span class="hljs-attr">template</span>: {
     <span class="hljs-attr">compilerOptions</span>: {
       <span class="hljs-attr">whitespace</span>: <span class="hljs-string">'condense'</span>,
       <span class="hljs-attr">hoistStatic</span>: <span class="hljs-literal">true</span>,
       <span class="hljs-attr">cacheHandlers</span>: <span class="hljs-literal">true</span>,
     }
   }
 })]
});
</code></pre>
<p>è¿™äº›ç¼–è¯‘å™¨é€‰é¡¹å¸¦æ¥çš„æ”¶ç›Šï¼š</p>
<ul>
<li><code>hoistStatic</code>:
é™æ€èŠ‚ç‚¹æå‡å‡å°‘15%çš„è™šæ‹ŸDOMåˆ›å»ºå¼€é”€</li>
<li><code>cacheHandlers</code>:
äº‹ä»¶å¤„ç†å™¨ç¼“å­˜é¿å…æ¯æ¬¡é‡ç»˜æ—¶é‡æ–°åˆ›å»ºå‡½æ•°</li>
<li><code>whitespace</code>:
å‹ç¼©ç©ºç™½å­—ç¬¦èŠ‚çœçº¦5%çš„DOMä½“ç§¯</li>
</ul>
<p>ç»“åˆæ„å»ºæ—¶çš„pre-renderç­–ç•¥ï¼ˆå¦‚SSGï¼‰ï¼Œåˆè·å¾—äº†é¢å¤–çš„20%é¦–å±é€Ÿåº¦æå‡ã€‚</p>
<h2 data-id="heading-8">SSGä¸Hydrationä¼˜åŒ–çš„ç‰¹æ®Šæ¡ˆä¾‹</h2>
<p>è™½ç„¶ä¸åœ¨æœ€åˆæåˆ°çš„5ä¸ªæŠ€å·§å†…ï¼Œä½†å€¼å¾—ä¸€æçš„æ˜¯SSGï¼ˆé™æ€ç«™ç‚¹ç”Ÿæˆï¼‰ç»“åˆpartial hydrationçš„ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createStaticVNode } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// In SSR context:</span>
<span class="hljs-keyword">const</span> staticPart = <span class="hljs-title function_">createStaticVNode</span>(<span class="hljs-string">`&lt;div&gt;...&lt;/div&gt;`</span>);
</code></pre>
<p>è¿™ç§æ–¹å¼å°†ï¼š</p>
<ol>
<li><strong>å®Œå…¨é™æ€å†…å®¹</strong>ç›´æ¥ä½œä¸ºå­—ç¬¦ä¸²æ’å…¥</li>
<li><strong>äº¤äº’éƒ¨åˆ†</strong>æŒ‰éœ€æ°´åˆ(hydrate)</li>
<li><strong>å²›å±¿æ¶æ„</strong>(Islands Architecture)æ€æƒ³</li>
</ol>
<p>åœ¨æ–‡æ¡£ç±»é¡µé¢ä¸­å®ç°äº†è¿‘ä¹ç¬æ—¶çš„åŠ è½½ä½“éªŒï¼ˆLCP &lt;200msï¼‰ã€‚</p>
<h2 data-id="heading-9">Debuggingä¸æµ‹é‡æ–¹æ³•è®º</h2>
<p>ä»»ä½•ä¼˜åŒ–éƒ½å¿…é¡»åŸºäºå‡†ç¡®æµ‹é‡ï¼š</p>
<ol>
<li>
<p><strong>Chrome Performance Tab</strong>:</p>
<ul>
<li>Recordå®Œæ•´ç”Ÿå‘½å‘¨æœŸ</li>
<li>Focusä¸»è¦è€—æ—¶åŒºå—</li>
</ul>
</li>
<li>
<p><strong>è‡ªå®šä¹‰Metrics</strong>:</p>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { perf } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
perf.<span class="hljs-title function_">mark</span>(<span class="hljs-string">'start'</span>);
<span class="hljs-comment">// ...operation...</span>
perf.<span class="hljs-title function_">mark</span>(<span class="hljs-string">'end'</span>);
perf.<span class="hljs-title function_">getDuration</span>(<span class="hljs-string">'start'</span>, <span class="hljs-string">'end'</span>); 
</code></pre>
<ol start="3">
<li><strong>ç”Ÿäº§ç¯å¢ƒç›‘æ§</strong>:
<ul>
<li>RUM(çœŸå®ç”¨æˆ·ç›‘æ§)æ•°æ®é‡‡é›†</li>
<li>Web Vitalsé˜ˆå€¼è­¦æŠ¥</li>
</ul>
</li>
</ol>
<p>æˆ‘å‘ç°DevToolsä¸­çš„Performanceé¢æ¿ç»å¸¸ä½ä¼°å†…å­˜å‹åŠ›é—®é¢˜ï¼Œå› æ­¤æ¨èç»“åˆNode.jsçš„å†…å­˜å¿«ç…§åˆ†æã€‚</p>
<h2 data-id="heading-10">Vue Reactivityæ·±å±‚åŸç†å¯¹ä¼˜åŒ–çš„å¯ç¤º</h2>
<p>ç†è§£åº•å±‚æœºåˆ¶æœ‰åŠ©äºåšå‡ºæ›´å¥½çš„æ¶æ„å†³ç­–ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">åŸå§‹å€¼ â†’ <span class="hljs-keyword">ref</span> â†’ effectè·Ÿè¸ª â†’ schedulerè°ƒåº¦ â†’ DOMæ›´æ–°
        
        â–²          â”‚             â”‚         
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚         
                                requestAnimationFrame      
</code></pre>
<p>å…³é”®è¦ç‚¹ï¼š</p>
<ol>
<li>Effectæ¸…ç†ä¸åŠæ—¶ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆå¸¸è§äºsetIntervalåœºæ™¯ï¼‰</li>
<li>Batch updatesä»…åœ¨åŒæ­¥ä»£ç å—ä¸­è‡ªåŠ¨å·¥ä½œ</li>
<li>customRefå¯ç”¨äºå®ç°é˜²æŠ–refç­‰é«˜çº§æ¨¡å¼</li>
</ol>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆæŸäº›æƒ…å†µä¸‹æ‰‹åŠ¨æ‰¹å¤„ç†(<code>nextTick</code>)ä»ç„¶æ˜¯å¿…è¦çš„ã€‚</p>
<h2 data-id="heading-11">Web Workersä¸Offscreen Canvasçš„éä¼ ç»Ÿæ–¹æ¡ˆ</h2>
<p>å¯¹äºCPUå¯†é›†å‹ä»»åŠ¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// worker-setup.js</span>
<span class="hljs-keyword">import</span> { expose } <span class="hljs-keyword">from</span> <span class="hljs-string">'threads'</span>;
<span class="hljs-keyword">import</span> { computeExpensiveThing } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

<span class="hljs-title function_">expose</span>({ computeExpensiveThing });
</code></pre>
<p>å‰ç«¯çº¿ç¨‹æ¨¡å‹çš„æœ€ä½³å®è·µï¼š</p>
<ol>
<li>Workeré€‚åˆçº¯è®¡ç®—ä»»åŠ¡</li>
<li>SharedArrayBufferå¯ç”¨äºå¤§æ•°æ®å…±äº«</li>
<li>OffscreenCanvasè§£æ”¾ä¸»çº¿ç¨‹åŠ¨ç”»</li>
</ol>
<p>åœ¨æˆ‘çš„æ•°æ®å¯è§†åŒ–æ¨¡å—ä¸­ï¼Œå°†SVGè·¯å¾„è®¡ç®—ç§»å…¥Workeråï¼Œäº¤äº’å¡é¡¿å‡å°‘äº†70%ã€‚</p>
<h2 data-id="heading-12">TypeScriptç¼–è¯‘å™¨å¯¹è¿è¡Œæ—¶çš„å½±å“æ„å¤–å‘ç°</h2>
<p>TypeScripté…ç½®ä¹Ÿä¼šå½±å“è¾“å‡ºä»£ç çš„æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-jsonc" lang="jsonc">{
 "compilerOptions": {
   "target": "es2018", // vs es5    
   "module": "esnext",
   "strictFunctionTypes": false, // relax type checking    
 }
}
</code></pre>
<p>å®æµ‹å·®å¼‚ï¼š</p>
<ul>
<li>ES2018è¾“å‡ºæ¯”ES5å°15%ï¼Œæ‰§è¡Œå¿«20%</li>
<li>Strictç±»å‹æ£€æŸ¥å¢åŠ ~5%æ„å»ºæ—¶é—´ä½†ä¸å½±å“è¿è¡Œæ—¶</li>
<li>Decoratorå¯ç”¨ä¼šæ˜¾è‘—å¢åŠ ä»£ç ä½“ç§¯</li>
</ul>
<p>å»ºè®®ç”Ÿäº§æ„å»ºä½¿ç”¨æœ€ç°ä»£çš„ECMAScriptç›®æ ‡ç‰ˆæœ¬ã€‚</p>
<h2 data-id="heading-13">CSS Containmentçš„è¢«å¿½è§†ä»·å€¼</h2>
<p>æµè§ˆå™¨çº§ä¼˜åŒ–å¸¸å¸¸è¢«å‰ç«¯æ¡†æ¶æ©ç›–ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.widget</span> {
 <span class="hljs-attribute">contain</span>: strict; <span class="hljs-comment">/* or content/paint */</span>
}
</code></pre>
<p>CSS Containmentçš„ä½œç”¨ï¼š
1ï¸âƒ£ Paint containmentå»ºç«‹ç‹¬ç«‹çš„ç»˜åˆ¶å±‚<br/>
2ï¸âƒ£ Layout containmenté˜»æ­¢å¤–éƒ¨å¸ƒå±€å½±å“å†…éƒ¨<br/>
3ï¸âƒ£ Style containmentéš”ç¦»è®¡æ•°å™¨/å¼•å·</p>
<p>é…åˆwill-changeå±æ€§ä½¿ç”¨æ—¶æ•ˆæœæœ€ä½³ã€‚</p>
<h2 data-id="heading-14">Vuex/Piniaçš„çŠ¶æ€ç®¡ç†è¿›é˜¶æ¨¡å¼</h2>
<p>é’ˆå¯¹å¤§å‹åº”ç”¨çš„çŠ¶æ€åˆ‡ç‰‡ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// store/user.js (Pinia style)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
 <span class="hljs-keyword">const</span> list = <span class="hljs-title function_">shallowRef</span>([]);
 <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {...};
 <span class="hljs-keyword">return</span> { list, loadUsers };
});
</code></pre>
<p>æ¶æ„ä¼˜åŠ¿ï¼š
âœ… Tree-shakable stores<br/>
âœ… Lazy initialization<br/>
âœ… Cross-store composition</p>
<p>è¿ç§»åˆ°è¿™ç§æ¨¡å¼åçŠ¶æ€ç®¡ç†å†…å­˜å ç”¨å‡å°‘äº†25%ã€‚</p>
<h2 data-id="heading-15">Server Componentæ¢ç´¢æ€§å°è¯•å‰æ²¿æ–¹æ¡ˆï¼‰</h2>
<p>è™½ç„¶Vueå®˜æ–¹å°šæœªæ¨å‡ºServer Componentsè§„èŒƒï¼Œ</p>
<p>ä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¨¡æ‹Ÿç±»ä¼¼æ•ˆæœï¼š
1ï¸âƒ£ï¸ Teleport + SSR partial hydration<br/>
2ï¸âƒ£ï¸ React Wrapå®éªŒæ€§é›†æˆ<br/>
3ï¸âƒ£ï¸ Islands Architectureçš„è‡ªå®šä¹‰å®ç°</p>
<p>è¿™åœ¨CMSç±»åº”ç”¨ä¸­å±•ç°å‡ºå·¨å¤§æ½œåŠ›ã€‚ï¼ˆæ³¨ï¼šå½“å‰ä»å±å‰ç»æŠ€æœ¯ï¼‰</p>
<hr/>
<p>##æ€»ç»“</p>
<p>è¿™æ¬¡å…¨é¢çš„æ€§èƒ½ä¼˜åŒ–æ—…ç¨‹æ•™ä¼šäº†æˆ‘æœ€é‡è¦çš„é“ç†ï¼š"æ²¡æœ‰é“¶å¼¹"ã€‚40%çš„æå‡æ¥è‡ªäºå¯¹ä¸åŒå±‚çº§ï¼ˆç¼–è¯‘å™¨/è¿è¡Œæ—¶/æµè§ˆå™¨/DOMï¼‰çš„ç³»ç»Ÿæ€§æ€è€ƒä¸å®è·µéªŒè¯ã€‚æ¯ä¸ªåº”ç”¨éƒ½æœ‰ç‹¬ç‰¹çš„ç“¶é¢ˆæ‰€åœ¨ â€”â€”å…³é”®åœ¨äºæŒæ¡å·¥å…·é“¾å’Œæ–¹æ³•è®ºæ¥å‡†ç¡®å®šä½è¿™äº›é—®é¢˜ã€‚</p>
<p>å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œ"è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº"è¿™å¥æ ¼è¨€ä»ç„¶é€‚ç”¨ã€‚æ‰€æœ‰å±•ç¤ºçš„æŠ€æœ¯éƒ½åº”è¯¥åŸºäºå®é™…çš„æ€§èƒ½æµ‹é‡æ•°æ®æ¥æŒ‡å¯¼å®æ–½ä¼˜å…ˆçº§é¡ºåº ã€‚å¸Œæœ›è¿™äº›å®æˆ˜ç»éªŒèƒ½ä¸ºä½ çš„ä¸‹ä¸€ä¸ªVueé¡¹ç›®æä¾›æœ‰ä»·å€¼çš„å‚è€ƒæ–¹å‘ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter ä¸ºä»€ä¹ˆå¤§å®¶è¯´ä¸èƒ½åœ¨initState æ–¹æ³•ä¸­è°ƒç”¨dependOnInheritedWidgetOfExactType]]></title>    <link>https://juejin.cn/post/7573687816429895690</link>    <guid>https://juejin.cn/post/7573687816429895690</guid>    <pubDate>2025-11-18T04:23:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573687816429895690" data-draft-id="7573687816429879306" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter ä¸ºä»€ä¹ˆå¤§å®¶è¯´ä¸èƒ½åœ¨initState æ–¹æ³•ä¸­è°ƒç”¨dependOnInheritedWidgetOfExactType"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-18T04:23:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«æŸ´å°±æ˜¯æˆ‘"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter ä¸ºä»€ä¹ˆå¤§å®¶è¯´ä¸èƒ½åœ¨initState æ–¹æ³•ä¸­è°ƒç”¨dependOnInheritedWidgetOfExactType
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«æŸ´å°±æ˜¯æˆ‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T04:23:38.000Z" title="Tue Nov 18 2025 04:23:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/// This method should not be called from widget constructors or from</span>
<span class="hljs-comment">/// [State.initState] methods, because those methods would not get called</span>
<span class="hljs-comment">/// again if the inherited value were to change. To ensure that the widget</span>
<span class="hljs-comment">/// correctly updates itself when the inherited value changes, only call this</span>
<span class="hljs-comment">/// (directly or indirectly) from build methods, layout and paint callbacks,</span>
<span class="hljs-comment">/// or from [State.didChangeDependencies] (which is called immediately after</span>
<span class="hljs-comment">/// [State.initState]).</span>
</code></pre>
<p>è¿™ä¸ªæ˜¯<code>dependOnInheritedWidgetOfExactType</code>æ³¨é‡Šçš„ä¸€éƒ¨åˆ†,ä¸»è¦è¯´çš„å°±æ˜¯ä¸ºä»€ä¹ˆä¸è®©åœ¨<code>initState</code>ä¸­è°ƒç”¨ï¼Œå¹¶ä¸æ˜¯è¯´ä¸å¯ä»¥è°ƒç”¨ã€‚åªæ˜¯è¯´<code>initState</code>æ–¹æ³•åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œåç»­æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™,<code>initState</code>ä¸ä¼šå†æ¬¡è°ƒç”¨,ä¸èƒ½åŠæ—¶åˆ·æ–°ã€‚æ‰€ä»¥å»ºè®®æˆ‘ä»¬åœ¨<code>didChangeDependencies</code>ä¸­è°ƒç”¨ï¼Œæ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™<code>didChangeDependencies</code>è‚¯å®šä¼šå›è°ƒã€‚å¹¶ä¸”ç¬¬ä¸€æ¬¡initStateä¹‹åä¹Ÿä¼šè°ƒç”¨ä¸€æ¬¡<code>didChangeDependencies</code>æ–¹æ³•ã€‚</p>
<p>è¿™æ ·å°±å¯ä»¥ä¿è¯ç¬¬ä¸€æ¬¡æˆ–è€…åç»­æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™éƒ½å¯ä»¥è·å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚</p>
<p>åœ¨<code>Element</code>çš„<code>mount</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨<code>_firstBuild</code> <code>StatefulElement</code> çš„<code>_firstBuild</code>çš„å®ç°å¦‚ä¸‹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">@override
void _firstBuild() {
  assert(<span class="hljs-attr">state._debugLifecycleState</span> == _StateLifecycle.created)<span class="hljs-comment">;</span>
  final Object? <span class="hljs-attr">debugCheckForReturnedFuture</span> = state.initState() as dynamic<span class="hljs-comment">;</span>
  ã€‚ã€‚ã€‚ã€‚
  state.didChangeDependencies()<span class="hljs-comment">;</span>
  assert(() {
    <span class="hljs-attr">state._debugLifecycleState</span> = _StateLifecycle.ready<span class="hljs-comment">;</span>
    return true<span class="hljs-comment">;</span>
  }())<span class="hljs-comment">;</span>
  super._firstBuild()<span class="hljs-comment">;</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tiptap æ·±åº¦æ•™ç¨‹ï¼ˆå››ï¼‰ï¼šç»ˆæå®šåˆ¶ - ä»é›¶åˆ›å»ºä½ çš„ä¸“å±æ‰©å±•]]></title>    <link>https://juejin.cn/post/7573592952243535924</link>    <guid>https://juejin.cn/post/7573592952243535924</guid>    <pubDate>2025-11-18T04:54:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573592952243535924" data-draft-id="7573523709300277283" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tiptap æ·±åº¦æ•™ç¨‹ï¼ˆå››ï¼‰ï¼šç»ˆæå®šåˆ¶ - ä»é›¶åˆ›å»ºä½ çš„ä¸“å±æ‰©å±•"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-18T04:54:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ³¯æ³·"/> <meta itemprop="url" content="https://juejin.cn/user/317122698296024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tiptap æ·±åº¦æ•™ç¨‹ï¼ˆå››ï¼‰ï¼šç»ˆæå®šåˆ¶ - ä»é›¶åˆ›å»ºä½ çš„ä¸“å±æ‰©å±•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/317122698296024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ³¯æ³·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T04:54:33.000Z" title="Tue Nov 18 2025 04:54:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»32åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"â€¢";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>æ¬¢è¿æ¥åˆ°ã€ŠTiptap æ·±åº¦æ•™ç¨‹ã€‹ç³»åˆ—çš„ç¬¬å››ç¯‡ï¼Œä¹Ÿæ˜¯æœ€å…·æ·±åº¦çš„ä¸€ç« ã€‚åœ¨å‰å‡ ç¯‡æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¢ç´¢äº†å¦‚ä½•åˆ©ç”¨ Tiptap å¼ºå¤§çš„å¼€ç®±å³ç”¨åŠŸèƒ½å’Œä¸°å¯Œçš„æ‰©å±•ç”Ÿæ€æ¥å¿«é€Ÿæ„å»ºç¼–è¾‘å™¨ã€‚ç„¶è€Œï¼ŒTiptap çš„çœŸæ­£å¨åŠ›å¹¶ä¸ä»…é™äºæ­¤ï¼Œå®ƒæœ€æ ¸å¿ƒçš„ä¼˜åŠ¿åœ¨äºå…¶è¿‘ä¹æ— é™çš„å¯æ‰©å±•æ€§ã€‚å½“æ ‡å‡†åŠŸèƒ½æ— æ³•æ»¡è¶³ä½ ç‹¬ç‰¹çš„äº§å“éœ€æ±‚æ—¶ï¼Œä½ éœ€è¦çš„èƒ½åŠ›ï¼Œæ˜¯<strong>åˆ›é€ </strong>ã€‚</p>
<p>æœ¬ç¯‡æ•™ç¨‹å°†æ˜¯ä¸€æ¬¡æ·±å…¥ Tiptap æ ¸å¿ƒçš„æ—…ç¨‹ã€‚æˆ‘ä»¬å°†ä¸å†ä»…ä»…æ˜¯ Tiptap åŠŸèƒ½çš„"æ¶ˆè´¹è€…"ï¼Œè€Œæ˜¯æˆä¸ºå…¶åŠŸèƒ½çš„"åˆ›é€ è€…"ã€‚æˆ‘ä»¬å°†ä¸€èµ·æ­å¼€ Tiptap æ‰©å±•ç³»ç»ŸèƒŒåçš„ç¥ç§˜é¢çº±ï¼Œèµ‹äºˆä½ ä»é›¶å¼€å§‹æ„å»ºä»»ä½•å¯ä»¥æƒ³è±¡åˆ°çš„ç¼–è¾‘å™¨åŠŸèƒ½çš„èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ‰©å±•ï¼Ÿ</h2>
<p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™äº›åœºæ™¯ï¼Œè€Œå®˜æ–¹æ‰©å±•æ— æ³•å®Œå…¨æ»¡è¶³ï¼š</p>
<ul>
<li><strong>ğŸ¨ äº§å“ç‰¹è‰²éœ€æ±‚</strong>ï¼šéœ€è¦ç‹¬ç‰¹çš„"è­¦å‘Šæ¡†"ã€"æç¤ºå¡ç‰‡"ç­‰å“ç‰ŒåŒ–ç»„ä»¶ï¼Œä½“ç°äº§å“ä¸ªæ€§</li>
<li><strong>ğŸ’¼ ä¸šåŠ¡é€»è¾‘é›†æˆ</strong>ï¼šè¯„è®ºç³»ç»Ÿçš„ @æåŠã€æ–‡æ¡£åä½œçš„æ‰¹æ³¨åŠŸèƒ½ã€å·¥å•ç³»ç»Ÿçš„çŠ¶æ€æ ‡ç­¾</li>
<li><strong>ğŸ¥ è¡Œä¸šç‰¹æ®Šéœ€æ±‚</strong>ï¼šæ³•å¾‹æ–‡æ¡£çš„æ¡æ¬¾è‡ªåŠ¨ç¼–å·ã€åŒ»ç–—è®°å½•çš„ç»“æ„åŒ–å­—æ®µã€æ•™è‚²å¹³å°çš„äº’åŠ¨é¢˜ç›®</li>
<li><strong>âš¡ æ€§èƒ½æè‡´ä¼˜åŒ–</strong>ï¼šä¸ºç‰¹å®šåœºæ™¯å®šåˆ¶è½»é‡çº§æ‰©å±•ï¼Œç§»é™¤ä¸å¿…è¦çš„åŠŸèƒ½ï¼Œä¼˜åŒ–åŒ…ä½“ç§¯</li>
<li><strong>ğŸ”§ æ·±åº¦å®šåˆ¶äº¤äº’</strong>ï¼šå®ç°ç¬¦åˆç”¨æˆ·ä¹ æƒ¯çš„ç‰¹æ®Šç¼–è¾‘è¡Œä¸ºï¼Œå¦‚ç‰¹å®šçš„å¿«æ·é”®ã€è‡ªåŠ¨è¡¥å…¨é€»è¾‘</li>
</ul>
<p>å½“ä½ é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œè‡ªå®šä¹‰æ‰©å±•å°±æ˜¯ä½ çš„"è¶…çº§æ­¦å™¨"ã€‚</p>
<h2 data-id="heading-2">ğŸ“‹ æœ¬ç« å­¦ä¹ ç›®æ ‡</h2>
<p>å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<p>âœ… <strong>ç†è§£æ‰©å±•æœ¬è´¨</strong>ï¼šæ·±å…¥æŒæ¡ Nodeã€Markã€Extension ä¸‰ç§æ‰©å±•ç±»å‹çš„åº•å±‚åŸç†å’Œä½¿ç”¨åœºæ™¯
âœ… <strong>åˆ›å»ºè‡ªå®šä¹‰ Node</strong>ï¼šä»é›¶æ„å»ºå—çº§èŠ‚ç‚¹ï¼ˆå¦‚ Callout æç¤ºæ¡†ï¼‰ï¼ŒæŒæ¡æ–‡æ¡£ç»“æ„å®šåˆ¶
âœ… <strong>åˆ›å»ºè‡ªå®šä¹‰ Mark</strong>ï¼šå®ç°è¡Œå†…æ ‡è®°ï¼ˆå¦‚å½©è‰²é«˜äº®ï¼‰ï¼ŒæŒæ¡æ–‡æœ¬æ ¼å¼æ‰©å±•
âœ… <strong>æŒæ¡é«˜çº§ API</strong>ï¼šçµæ´»è¿ç”¨å‘½ä»¤ã€è¾“å…¥è§„åˆ™ã€Storage ç­‰é«˜çº§èƒ½åŠ›
âœ… <strong>æ„å»ºå¤æ‚æ‰©å±•</strong>ï¼šå®Œæˆç”Ÿäº§çº§ Mention æ‰©å±•çš„å®Œæ•´å®ç°ï¼Œæ•´åˆæ‰€æœ‰çŸ¥è¯†ç‚¹</p>
<h2 data-id="heading-3">å­¦ä¹ è·¯å¾„</h2>
<p>åœ¨è¿™è¶Ÿæ—…ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†éµå¾ªä¸€æ¡ä»ç†è®ºåˆ°å®è·µï¼Œä»åŸºç¡€åˆ°ä¸“å®¶çš„å­¦ä¹ è·¯å¾„ï¼š</p>
<ul>
<li>
<p><strong>ğŸ” æ¢ç©¶åº•å±‚åŸç†</strong>ï¼šæ·±å…¥å‰–æ Tiptap ä¸å…¶åº•å±‚å¼•æ“ ProseMirror ä¹‹é—´çš„å…³ç³»ï¼Œä¸ºä½ å»ºç«‹åšå®çš„ç†è®ºåŸºç¡€</p>
</li>
<li>
<p><strong>âœï¸ å®è·µåˆ›é€ </strong>ï¼šé€è¡Œä»£ç ï¼Œä»æ— åˆ°æœ‰åœ°åˆ›å»ºè‡ªå®šä¹‰çš„ <code>Node</code>ï¼ˆèŠ‚ç‚¹ï¼‰å’Œ <code>Mark</code>ï¼ˆæ ‡è®°ï¼‰ï¼Œäº²æ‰‹ä½“éªŒæ‰©å±•å¼€å‘çš„å…¨è¿‡ç¨‹</p>
</li>
<li>
<p><strong>ğŸš€ æŒæ¡é«˜çº§ API</strong>ï¼šå­¦ä¹ å¦‚ä½•é€šè¿‡å‘½ä»¤ï¼ˆCommandsï¼‰ã€è¾“å…¥è§„åˆ™ï¼ˆInput Rulesï¼‰å’ŒçŠ¶æ€ç®¡ç†ï¼ˆStorageï¼‰ç­‰é«˜çº§ APIï¼Œä¸ºæ‰©å±•æ³¨å…¥å¼ºå¤§çš„äº¤äº’èƒ½åŠ›</p>
</li>
<li>
<p><strong>ğŸ—ï¸ æ„å»ºç»ˆææ¡ˆä¾‹</strong>ï¼šå°†æ‰€å­¦çŸ¥è¯†èä¼šè´¯é€šï¼Œæ„å»ºä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„ã€å®Œå…¨äº¤äº’å¼çš„ <code>@mention</code>ï¼ˆæåŠï¼‰æ‰©å±•</p>
</li>
</ul>
<p>å‡†å¤‡å¥½è¿æ¥æŒ‘æˆ˜ï¼Œå¼€å¯ä½ çš„ Tiptap å¤§å¸ˆä¹‹è·¯ï¼</p>
<h2 data-id="heading-4">ç¬¬ä¸€èŠ‚ï¼šTiptap æ‰©å±•çš„è§£å‰–å­¦ï¼šè¶…è¶ŠåŸºç¡€</h2>
<p>åœ¨åŠ¨æ‰‹ç¼–å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å»ºç«‹ä¸€ä¸ªæ¸…æ™°ä¸”å‡†ç¡®çš„å¿ƒæ™ºæ¨¡å‹ã€‚ç†è§£ Tiptap æ‰©å±•çš„æœ¬è´¨ã€å…¶ä¸åº•å±‚å¼•æ“ ProseMirror çš„å…³ç³»ï¼Œä»¥åŠä¸åŒç±»å‹æ‰©å±•çš„èŒè´£åˆ’åˆ†ï¼Œæ˜¯è¿›è¡Œé«˜çº§å®šåˆ¶çš„å‰æã€‚</p>
<h3 data-id="heading-5">ProseMirror çš„è¿æ¥ï¼šTiptap çš„å¼•æ“å®¤</h3>
<p>è¦çœŸæ­£ç†è§£ Tiptapï¼Œå°±å¿…é¡»è®¤è¯†åˆ°å®ƒæ˜¯ä¸€ä¸ªâ€œæ— å¤´ï¼ˆheadlessï¼‰â€çš„ç¼–è¾‘å™¨æ¡†æ¶ï¼Œå®ƒæœ¬èº«å¹¶ä¸æä¾›ç”¨æˆ·ç•Œé¢ï¼Œè€Œæ˜¯ä¸“æ³¨äºç¼–è¾‘å™¨é€»è¾‘ã€‚å…¶å¼ºå¤§çš„åŠŸèƒ½æ„å»ºåœ¨ä¸€ä¸ªåä¸º ProseMirror çš„å·¥å…·é›†ä¹‹ä¸Šã€‚ä½ å¯ä»¥å°† ProseMirror æƒ³è±¡æˆä¸€ä¸ªé«˜æ€§èƒ½çš„æ±½è½¦å¼•æ“ï¼Œè€Œ Tiptap åˆ™æ˜¯å›´ç»•è¿™ä¸ªå¼•æ“ç²¾å¿ƒè®¾è®¡çš„åº•ç›˜ã€ä¼ åŠ¨ç³»ç»Ÿå’Œä¸€å¥—å¯¹å¼€å‘è€…æ›´å‹å¥½çš„é©¾é©¶èˆ±ï¼ˆAPIï¼‰ã€‚</p>
<p>Tiptap å·§å¦™åœ°å°è£…äº† ProseMirror çš„å¤æ‚æ€§ï¼Œæä¾›äº†æ›´æ˜“äºç†è§£å’Œä½¿ç”¨çš„ APIã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬éœ€è¦è¿›è¡Œæ·±åº¦å®šåˆ¶æ—¶ï¼Œä»…ä»…äº†è§£ Tiptap çš„ API æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬å¿…é¡»æ·±å…¥å¼•æ“å®¤ï¼Œç†è§£ ProseMirror çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>
<p><strong>Schemaï¼ˆæ¨¡å¼ï¼‰</strong>ï¼šè¿™æ˜¯æ–‡æ¡£çš„â€œè¯­æ³•è§„åˆ™â€ï¼Œå®šä¹‰äº†å“ªäº›ç±»å‹çš„å†…å®¹ï¼ˆèŠ‚ç‚¹å’Œæ ‡è®°ï¼‰æ˜¯åˆæ³•çš„ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´å¦‚ä½•åµŒå¥—ã€‚åˆ›å»ºè‡ªå®šä¹‰</p>
<p><code>Node</code> æˆ– <code>Mark</code> çš„æœ¬è´¨ï¼Œå°±æ˜¯åœ¨ä¿®æ”¹è¿™ä¸ª Schemaã€‚</p>
</li>
<li>
<p><strong>Stateï¼ˆçŠ¶æ€ï¼‰</strong>ï¼šä¸€ä¸ªä¸å¯å˜çš„ï¼ˆimmutableï¼‰å¯¹è±¡ï¼ŒåŒ…å«äº†ç¼–è¾‘å™¨çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡æ¡£å†…å®¹ã€å½“å‰é€‰åŒºã€æ¿€æ´»çš„æ ‡è®°ç­‰ã€‚ç¼–è¾‘å™¨çš„æ¯ä¸€æ¬¡å˜æ›´éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Stateã€‚</p>
</li>
<li>
<p><strong>Pluginsï¼ˆæ’ä»¶ï¼‰</strong>ï¼šå®ƒä»¬æ˜¯ ProseMirror çš„â€œäº‹ä»¶ç›‘å¬å™¨â€å’Œâ€œè¡Œä¸ºå¹²é¢„å™¨â€ï¼Œå¯ä»¥è§‚å¯Ÿå¹¶å“åº”ç¼–è¾‘å™¨çš„å„ç§å˜åŒ–ï¼Œå®ç°å¦‚ååŒç¼–è¾‘ã€è¾“å…¥å¿«æ·æ–¹å¼ç­‰å¤æ‚åŠŸèƒ½ 8ã€‚</p>
</li>
</ul>
<p>Tiptap çš„è®¾è®¡å“²å­¦å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§â€œæ¸è¿›å¼æŠ«éœ²â€ã€‚å¯¹äºå¸¸è§„éœ€æ±‚ï¼Œä½ åªéœ€ä½¿ç”¨ Tiptap çš„é«˜å±‚ APIã€‚ä½†å½“ä½ éœ€è¦æè‡´çš„æ§åˆ¶åŠ›æ—¶ï¼ŒTiptap ä¼šä¸ºä½ æ‰“å¼€é€šå¾€åº•å±‚ ProseMirror çš„å¤§é—¨ã€‚æœ¬æ•™ç¨‹ä¹Ÿå°†éµå¾ªè¿™ä¸€å“²å­¦ï¼Œä» Tiptap çš„ä¾¿æ· API å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°æ›´å¼ºå¤§çš„ ProseMirror æ¦‚å¿µä¸­ã€‚</p>
<h3 data-id="heading-6">Nodeã€Mark å’Œ Extensionï¼šèŒè´£æ˜ç¡®çš„ä¸‰é©¾é©¬è½¦</h3>
<p>Tiptap çš„ä¸€åˆ‡çš†ä¸ºæ‰©å±•ï¼Œä½†æ ¹æ®å…¶æ ¸å¿ƒèŒè´£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†ä¸ºä¸‰ç§åŸºæœ¬ç±»å‹ 10ã€‚ç†è§£å®ƒä»¬çš„åŒºåˆ«è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå†³å®šäº†ä½ åœ¨å®ç°ç‰¹å®šåŠŸèƒ½æ—¶åº”è¯¥é€‰æ‹©å“ªç§ç±»å‹çš„æ‰©å±•ã€‚</p>
<ul>
<li>
<p><strong>Nodesï¼ˆèŠ‚ç‚¹ï¼‰</strong>ï¼šå®ƒä»¬æ˜¯æ„æˆæ–‡æ¡£ç»“æ„çš„â€œç§¯æœ¨â€ 11ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ç¯‡æ–‡ç« ç”±æ ‡é¢˜ã€æ®µè½ã€å›¾ç‰‡ã€ä»£ç å—ç­‰ç»„æˆï¼Œè¿™äº›éƒ½æ˜¯èŠ‚ç‚¹ã€‚èŠ‚ç‚¹å¯ä»¥æ˜¯å—çº§å…ƒç´ ï¼ˆ</p>
<p><code>block</code>ï¼‰ï¼Œå¦‚æ®µè½ï¼ˆ<code>Paragraph</code>ï¼‰ï¼›ä¹Ÿå¯ä»¥æ˜¯è¡Œå†…å…ƒç´ ï¼ˆ<code>inline</code>ï¼‰ï¼Œå¦‚è¡¨æƒ…ç¬¦å·ï¼ˆ<code>Emoji</code>ï¼‰æˆ–å›¾ç‰‡ï¼ˆ<code>Image</code>ï¼‰12ã€‚å®ƒä»¬æ˜¯æ–‡æ¡£å†…å®¹çš„æ‰¿è½½è€…ã€‚</p>
</li>
<li>
<p><strong>Marksï¼ˆæ ‡è®°ï¼‰</strong>ï¼šå®ƒä»¬ç”¨äºä¸ºèŠ‚ç‚¹å†…çš„æ–‡æœ¬æ·»åŠ â€œè¡Œå†…æ ·å¼â€æˆ–â€œå…ƒæ•°æ®â€ï¼Œè€Œä¸ä¼šæ”¹å˜æ–‡æ¡£çš„ç»“æ„ 14ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€æ®µæ–‡å­—åŠ ç²—ï¼ˆ</p>
<p><code>Bold</code>ï¼‰ã€è®¾ç½®ä¸ºæ–œä½“ï¼ˆ<code>Italic</code>ï¼‰æˆ–æ·»åŠ è¶…é“¾æ¥ï¼ˆ<code>Link</code>ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯é€šè¿‡ Mark å®ç°çš„ 13ã€‚Mark å°±åƒæ˜¯ç»™æ–‡å­—æ¶‚ä¸Šçš„é«˜å…‰ï¼Œå®ƒä¾é™„äºæ–‡å­—ï¼Œä½†æ–‡å­—æœ¬èº«ä¾ç„¶åœ¨æ®µè½ï¼ˆNodeï¼‰ä¸­ã€‚</p>
</li>
<li>
<p><strong>Generic Extensionsï¼ˆé€šç”¨æ‰©å±•ï¼‰</strong>ï¼šè¿™ç±»æ‰©å±•ä¸ç›´æ¥å‘æ–‡æ¡£çš„ Schema ä¸­æ·»åŠ æ–°çš„å†…å®¹ç±»å‹ã€‚å®ƒä»¬çš„èŒè´£æ˜¯å¢å¼ºç¼–è¾‘å™¨çš„åŠŸèƒ½æˆ–è¡Œä¸º 10ã€‚ä¾‹å¦‚ï¼Œ</p>
<p><code>TextAlign</code> æ‰©å±•é€šè¿‡æ·»åŠ å‘½ä»¤å’Œå±æ€§æ¥æ§åˆ¶æ–‡æœ¬å¯¹é½ï¼Œä½†å®ƒå¹¶æ²¡æœ‰åˆ›é€ ä¸€ä¸ªæ–°çš„â€œå±…ä¸­æ®µè½â€èŠ‚ç‚¹ 10ã€‚å…¶ä»–ä¾‹å­è¿˜åŒ…æ‹¬ç›‘å¬ç¼–è¾‘å™¨æ›´æ–°äº‹ä»¶ï¼ˆ</p>
<p><code>onUpdate</code>ï¼‰ã€æ·»åŠ å…¨å±€é”®ç›˜å¿«æ·é”®æˆ–é›†æˆå¤æ‚çš„ ProseMirror æ’ä»¶ã€‚</p>
</li>
</ul>
<p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£è¿™ä¸‰è€…çš„åŒºåˆ«ï¼Œä¸‹è¡¨æä¾›äº†ä¸€ä¸ªå¿«é€Ÿå‚è€ƒï¼š</p>





























<table><thead><tr><th>ç±»å‹ (Type)</th><th>ä¸»è¦ç›®çš„ (Primary Purpose)</th><th>å¯¹ Schema çš„å½±å“ (Impact on Schema)</th><th>å¸¸è§ç¤ºä¾‹ (Common Examples)</th></tr></thead><tbody><tr><td><code>Node</code></td><td>å®šä¹‰æ–‡æ¡£çš„ç»“æ„æ€§å†…å®¹å—ã€‚</td><td><strong>ä¿®æ”¹ Schema</strong>ï¼Œæ·»åŠ æ–°çš„å†…å®¹ç±»å‹ã€‚</td><td><code>Paragraph</code>, <code>Heading</code>, <code>Image</code>, <code>CodeBlock</code></td></tr><tr><td><code>Mark</code></td><td>ä¸ºæ–‡æœ¬æ·»åŠ è¡Œå†…æ ¼å¼æˆ–å…ƒæ•°æ®ã€‚</td><td><strong>ä¿®æ”¹ Schema</strong>ï¼Œæ·»åŠ æ–°çš„æ ¼å¼ç±»å‹ã€‚</td><td><code>Bold</code>, <code>Italic</code>, <code>Link</code>, <code>Highlight</code></td></tr><tr><td><code>Extension</code></td><td>å¢å¼ºç¼–è¾‘å™¨åŠŸèƒ½ã€è¡Œä¸ºå’Œäº¤äº’ã€‚</td><td><strong>ä¸ä¿®æ”¹ Schema</strong>ã€‚</td><td><code>History</code> (undo/redo), <code>Placeholder</code>, <code>CharacterCount</code></td></tr></tbody></table>
<p>è¿™ä¸ªè¡¨æ ¼æ¸…æ™°åœ°æ­ç¤ºäº†ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š<strong>Schema ä¸ºç‹</strong>ã€‚å½“ä½ éœ€è¦å®šä¹‰ä¸€ç§æ–°çš„å†…å®¹ç±»å‹æ—¶ï¼Œä½ å¿…é¡»é€‰æ‹© <code>Node</code> æˆ– <code>Mark</code>ã€‚å½“ä½ åªéœ€è¦æ·»åŠ è¡Œä¸ºé€»è¾‘æ—¶ï¼Œ<code>Extension</code> åˆ™æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„åŒºåˆ†ï¼Œæ˜¯æ„å»ºå¥å£®ã€å¯ç»´æŠ¤çš„è‡ªå®šä¹‰æ‰©å±•çš„åŸºçŸ³ã€‚</p>
<h3 data-id="heading-7">æ‰©å±• APIï¼šæ ¸å¿ƒ Schema å®šä¹‰</h3>
<p>æ— è®ºæ˜¯åˆ›å»ºå“ªç§ç±»å‹çš„æ‰©å±•ï¼Œæˆ‘ä»¬éƒ½å°†ä» Tiptap æä¾›çš„ <code>create</code> æ–¹æ³•å¼€å§‹ï¼Œä¾‹å¦‚ <code>Node.create({})</code> æˆ– <code>Mark.create({})</code> ã€‚åœ¨è¿™ä¸ªæ ¸å¿ƒå¯¹è±¡ä¸­ï¼Œæœ‰å‡ ä¸ªå±æ€§æ˜¯å®šä¹‰ Schema çš„å…³é”®ï¼š</p>
<ul>
<li>
<p><strong><code>name</code></strong>: æ‰©å±•çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚è¿™ä¸ªåå­—è‡³å…³é‡è¦ï¼Œåç»­çš„å‘½ä»¤è°ƒç”¨ã€çŠ¶æ€å­˜å‚¨è®¿é—®éƒ½å°†ä¾èµ–å®ƒ 11ã€‚</p>
</li>
<li>
<p><strong><code>group</code></strong>: å®šä¹‰äº†è¯¥èŠ‚ç‚¹æ‰€å±çš„ç±»åˆ«ï¼Œä¾‹å¦‚ <code>'block'</code> æˆ– <code>'inline'</code> 8ã€‚è¿™ä¸ªå±æ€§ç›´æ¥å½±å“åˆ° ProseMirror çš„å†…å®¹è¡¨è¾¾å¼å¦‚ä½•è§£æè¯¥èŠ‚ç‚¹ï¼Œå†³å®šäº†å®ƒèƒ½å‡ºç°åœ¨æ–‡æ¡£çš„ä»€ä¹ˆä½ç½® 6ã€‚</p>
</li>
<li>
<p><strong><code>content</code></strong>: ä»…ç”¨äº <code>Node</code> ç±»å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œå†…å®¹è¡¨è¾¾å¼â€å­—ç¬¦ä¸²ï¼Œå®šä¹‰äº†è¯¥èŠ‚ç‚¹å¯ä»¥åŒ…å«å“ªäº›å­èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œ<code>'inline*'</code> è¡¨ç¤ºå¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªè¡Œå†…èŠ‚ç‚¹ï¼Œè€Œ <code>'paragraph+'</code> è¡¨ç¤ºå¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ®µè½èŠ‚ç‚¹ 5ã€‚è¿™æ˜¯ ProseMirror Schema è§„åˆ™çš„ç›´æ¥ä½“ç°ï¼Œä¹Ÿæ˜¯ä¿è¯æ–‡æ¡£ç»“æ„åˆæ³•æ€§çš„å…³é”® 19ã€‚</p>
</li>
<li>
<p><strong><code>parseHTML</code></strong>: å®šä¹‰äº†å¦‚ä½•å°†ä¸€æ®µ HTML ä»£ç è§£ææˆå½“å‰æ‰©å±•æ‰€ä»£è¡¨çš„èŠ‚ç‚¹æˆ–æ ‡è®°ã€‚å½“ç”¨æˆ·ç²˜è´´å†…å®¹æˆ–ä»æ•°æ®åº“åŠ è½½ HTML æ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå®ƒå°±åƒæ˜¯â€œè¾“å…¥è½¬æ¢å™¨â€ ã€‚</p>
</li>
<li>
<p><strong><code>renderHTML</code></strong>: å®šä¹‰äº†å¦‚ä½•å°†ç¼–è¾‘å™¨å†…éƒ¨çŠ¶æ€ä¸­çš„èŠ‚ç‚¹æˆ–æ ‡è®°æ¸²æŸ“æˆ HTMLã€‚å½“ä½ éœ€è¦ä¿å­˜æ–‡æ¡£å†…å®¹æˆ–åœ¨åªè¯»æ¨¡å¼ä¸‹æ˜¾ç¤ºæ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå®ƒå°±åƒæ˜¯â€œè¾“å‡ºè½¬æ¢å™¨â€ ã€‚</p>
</li>
</ul>
<p>æŒæ¡äº†è¿™äº›åŸºç¡€æ¦‚å¿µï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰äº†ä¸ Tiptap æ ¸å¿ƒå¯¹è¯çš„è¯­è¨€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡äº²æ‰‹å®è·µï¼Œå°†è¿™äº›ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºå…·ä½“çš„ã€åŠŸèƒ½å¼ºå¤§çš„è‡ªå®šä¹‰æ‰©å±•ã€‚</p>
<h2 data-id="heading-8">ç¬¬äºŒèŠ‚ï¼šä»é›¶åˆ° Nodeï¼šæ„å»ºä¸€ä¸ªè‡ªå®šä¹‰â€œCalloutâ€å—</h2>
<p>ç†è®ºçŸ¥è¯†æ˜¯åŸºç¡€ï¼Œä½†çœŸæ­£çš„æŒæ¡æºäºå®è·µã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥åœ°åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„è‡ªå®šä¹‰å—çº§ <code>Node</code>â€”â€”ä¸€ä¸ªâ€œCalloutâ€ç»„ä»¶ã€‚è¿™ç§ç»„ä»¶åœ¨æ–‡æ¡£ä¸­éå¸¸å¸¸è§ï¼Œç”¨äºé«˜äº®æ˜¾ç¤ºæç¤ºã€è­¦å‘Šæˆ–é‡è¦ä¿¡æ¯ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†æŠŠä¸Šä¸€ç« çš„æ¦‚å¿µä»˜è¯¸å®è·µã€‚</p>
<h3 data-id="heading-9">æ­¥éª¤ä¸€ï¼šæ­å»º Node çš„éª¨æ¶</h3>
<p>ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·ã€‚æˆ‘ä»¬é¦–å…ˆè¦ç”¨ <code>Node.create</code> æ–¹æ³•å®šä¹‰ Callout èŠ‚ç‚¹çš„åŸºæœ¬ç»“æ„ 10ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</p>
<p><code>Callout.js</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Node</span>, mergeAttributes } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Callout</span> = <span class="hljs-title class_">Node</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'callout'</span>, <span class="hljs-comment">// 1. å”¯ä¸€åç§°</span>
  
  <span class="hljs-attr">group</span>: <span class="hljs-string">'block'</span>, <span class="hljs-comment">// 2. å±äºå—çº§èŠ‚ç‚¹ç»„</span>

  <span class="hljs-attr">content</span>: <span class="hljs-string">'paragraph+'</span>, <span class="hljs-comment">// 3. å†…å®¹å¿…é¡»æ˜¯è‡³å°‘ä¸€ä¸ªæ®µè½</span>

  <span class="hljs-attr">defining</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 4. è¿™æ˜¯ä¸€ä¸ªå®šä¹‰è¾¹ç•Œçš„èŠ‚ç‚¹</span>

  <span class="hljs-comment">//... æ›´å¤šé…ç½®å°†åœ¨è¿™é‡Œæ·»åŠ </span>
});
</code></pre>
<p>è®©æˆ‘ä»¬æ¥è§£æè¿™æ®µéª¨æ¶ä»£ç ï¼š</p>
<ol>
<li>
<p><strong><code>name: 'callout'</code></strong>: ä¸ºæˆ‘ä»¬çš„èŠ‚ç‚¹æä¾›ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åç§° 11ã€‚</p>
</li>
<li>
<p><strong><code>group: 'block'</code></strong>: å£°æ˜è¿™æ˜¯ä¸€ä¸ªå—çº§å…ƒç´ ï¼Œå®ƒä¼šç‹¬å ä¸€è¡Œï¼Œä¸èƒ½å’Œæ™®é€šæ–‡æœ¬æ··æ’ 11ã€‚</p>
</li>
<li>
<p><strong><code>content: 'paragraph+'</code></strong>: è¿™æ˜¯å¯¹èŠ‚ç‚¹å†…å®¹æœ€æ ¸å¿ƒçš„çº¦æŸã€‚å®ƒè§„å®šäº† Callout å†…éƒ¨å¿…é¡»åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ®µè½ï¼ˆ<code>paragraph</code>ï¼‰èŠ‚ç‚¹ 6ã€‚è¿™ç¡®ä¿äº† Callout å†…éƒ¨å†…å®¹çš„ç»“æ„è§„èŒƒï¼Œé¿å…äº†ç›´æ¥åœ¨å…¶ä¸­æ”¾ç½®è£¸éœ²æ–‡æœ¬æˆ–å…¶ä»–ä¸åˆè§„çš„å—çº§èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p><strong><code>defining: true</code></strong>: è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å±æ€§ã€‚å®ƒå‘Šè¯‰ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„â€œå®šä¹‰å•å…ƒâ€ã€‚è¿™æ„å‘³ç€ç”¨æˆ·çš„å…‰æ ‡æ— æ³•éƒ¨åˆ†é€‰ä¸­ Callout çš„å†…å®¹å’Œå¤–éƒ¨å†…å®¹ï¼Œä¹Ÿæ— æ³•è½»æ˜“åœ°é€šè¿‡æŒ‰å›è½¦æˆ–åˆ é™¤é”®å°†å…¶ä¸å…¶ä»–èŠ‚ç‚¹åˆå¹¶æˆ–æ‹†åˆ†ã€‚è¿™å¯¹äºä¿æŒ Callout ç»“æ„çš„å®Œæ•´æ€§è‡³å…³é‡è¦ã€‚</p>
</li>
</ol>
<h3 data-id="heading-10">æ­¥éª¤äºŒï¼šåºåˆ—åŒ–ï¼ˆHTML ä¸ç¼–è¾‘å™¨çŠ¶æ€çš„æ¡¥æ¢ï¼‰</h3>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†èŠ‚ç‚¹çš„å†…éƒ¨å®šä¹‰ï¼Œä½† Tiptap è¿˜ä¸çŸ¥é“å¦‚ä½•å°†å®ƒæ˜¾ç¤ºä¸º HTMLï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•ä» HTML ä¸­è¯†åˆ«å®ƒã€‚è¿™å°±æ˜¯ <code>renderHTML</code> å’Œ <code>parseHTML</code> çš„å·¥ä½œã€‚</p>
<h4 data-id="heading-11">2.1 æœ€ç®€å•çš„æ¸²æŸ“å®ç°</h4>
<p>è®©æˆ‘ä»¬ä»æœ€åŸºç¡€çš„ç‰ˆæœ¬å¼€å§‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Callout.js çš„ Node.create({}) å†…éƒ¨æ·»åŠ </span>

<span class="hljs-title function_">renderHTML</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æœ€ç®€ç‰ˆæœ¬ï¼šåªæ¸²æŸ“ä¸€ä¸ª div æ ‡ç­¾</span>
  <span class="hljs-comment">// 0 è¡¨ç¤ºå­å†…å®¹çš„æ’å…¥ä½ç½®</span>
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'div'</span>, {}, <span class="hljs-number">0</span>];
},
</code></pre>
<h4 data-id="heading-12">2.2 æ·»åŠ ç±»å‹æ ‡è¯†</h4>
<p>ä¸ºäº†è®© HTML æ›´å…·è¯­ä¹‰åŒ–ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª <code>data-type</code> å±æ€§æ¥æ ‡è¯†è¿™æ˜¯ Callout èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">renderHTML</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ·»åŠ  data-type å±æ€§æ ‡è¯†èŠ‚ç‚¹ç±»å‹</span>
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'div'</span>, { <span class="hljs-string">'data-type'</span>: <span class="hljs-string">'callout'</span> }, <span class="hljs-number">0</span>];
},
</code></pre>
<h4 data-id="heading-13">2.3 å®Œæ•´ç‰ˆæœ¬ï¼šåˆå¹¶å±æ€§</h4>
<p>æœ€ç»ˆç‰ˆæœ¬éœ€è¦èƒ½å¤Ÿæ¥æ”¶å¹¶åˆå¹¶åŠ¨æ€å±æ€§ï¼ˆåé¢ä¼šç”¨åˆ°ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ HTMLAttributes }</span>) {
  <span class="hljs-comment">// ä½¿ç”¨ mergeAttributes åˆå¹¶é»˜è®¤å±æ€§å’Œä¼ å…¥çš„å±æ€§</span>
  <span class="hljs-keyword">return</span> [
    <span class="hljs-string">'div'</span>,
    <span class="hljs-title function_">mergeAttributes</span>(<span class="hljs-title class_">HTMLAttributes</span>, { <span class="hljs-string">'data-type'</span>: <span class="hljs-string">'callout'</span> }),
    <span class="hljs-number">0</span>  <span class="hljs-comment">// å­å†…å®¹æ¸²æŸ“ä½ç½®</span>
  ];
},
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>æ¸²æŸ“æ•°ç»„æ ¼å¼è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šHTML æ ‡ç­¾åï¼ˆ<code>'div'</code>ï¼‰</li>
<li>ç¬¬äºŒä¸ªå…ƒç´ ï¼šæ ‡ç­¾å±æ€§å¯¹è±¡</li>
<li>ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼š<code>0</code> æ˜¯ç‰¹æ®Šå ä½ç¬¦ï¼Œè¡¨ç¤ºå­å†…å®¹åº”è¯¥è¢«æ¸²æŸ“åˆ°è¿™é‡Œ</li>
</ul>
</blockquote>
<h4 data-id="heading-14">2.4 é…ç½®è§£æè§„åˆ™</h4>
<p>ç°åœ¨æ·»åŠ ç›¸åçš„é€»è¾‘â€”â€”å¦‚ä½•ä» HTML è¯†åˆ« Callout èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    {
      <span class="hljs-attr">tag</span>: <span class="hljs-string">'div[data-type="callout"]'</span>, <span class="hljs-comment">// åŒ¹é…å¸¦æœ‰ç‰¹å®šå±æ€§çš„ div æ ‡ç­¾</span>
    },
  ];
},
</code></pre>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ul>
<li>âœ… <code>renderHTML</code>ï¼šç¼–è¾‘å™¨çŠ¶æ€ â†’ HTMLï¼ˆç”¨äºä¿å­˜å’Œæ˜¾ç¤ºï¼‰</li>
<li>âœ… <code>parseHTML</code>ï¼šHTML â†’ ç¼–è¾‘å™¨çŠ¶æ€ï¼ˆç”¨äºåŠ è½½å’Œç²˜è´´ï¼‰</li>
</ul>
<h3 data-id="heading-15">æ­¥éª¤ä¸‰ï¼šæ·»åŠ åŠ¨æ€å±æ€§</h3>
<p>ä¸€ä¸ªé™æ€çš„ Callout ä¸å¤Ÿçµæ´»ã€‚æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåˆ›å»ºä¸åŒç±»å‹çš„ Calloutï¼Œæ¯”å¦‚â€œæç¤ºï¼ˆinfoï¼‰â€ã€â€œè­¦å‘Šï¼ˆwarningï¼‰â€å’Œâ€œå±é™©ï¼ˆdangerï¼‰â€ï¼Œå¹¶é€šè¿‡ CSS ä¸ºå®ƒä»¬åº”ç”¨ä¸åŒçš„æ ·å¼ã€‚è¿™éœ€è¦ç”¨åˆ°å±æ€§ï¼ˆAttributesï¼‰ã€‚</p>
<p>æ·»åŠ å±æ€§æ˜¯ä¸€ä¸ªé—­ç¯æ“ä½œï¼Œéœ€è¦ä¸‰æ­¥ï¼šå®šä¹‰ã€æ¸²æŸ“å’Œè§£æã€‚è¿™ä½“ç°äº†å±æ€§æ•°æ®çš„åŒå‘æµåŠ¨æ€§ï¼šä»ç¼–è¾‘å™¨çŠ¶æ€åˆ° HTMLï¼Œå†ä» HTML å›åˆ°ç¼–è¾‘å™¨çŠ¶æ€ã€‚é—æ¼ä»»ä½•ä¸€ç¯éƒ½ä¼šå¯¼è‡´æ•°æ®åœ¨ä¿å­˜æˆ–åŠ è½½æ—¶ä¸¢å¤±ã€‚</p>
<ol>
<li>
<p><strong>å®šä¹‰å±æ€§</strong>ï¼šä½¿ç”¨ <code>addAttributes</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Node.create({}) å†…éƒ¨æ·»åŠ </span>

<span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">calloutType</span>: {
      <span class="hljs-attr">default</span>: <span class="hljs-string">'info'</span>, <span class="hljs-comment">// é»˜è®¤ç±»å‹æ˜¯ 'info'</span>
    },
  };
},
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>calloutType</code> çš„å±æ€§ï¼Œå¹¶ä¸ºå…¶è®¾ç½®äº†é»˜è®¤å€¼ <code>'info'</code> 5ã€‚</p>
</li>
<li>
<p><strong>æ¸²æŸ“å±æ€§</strong>ï¼šä¿®æ”¹ <code>renderHTML</code>ï¼Œå°†å±æ€§å€¼å†™å…¥ DOMã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¿®æ”¹ renderHTML æ–¹æ³•</span>

<span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ HTMLAttributes }</span>) {
  <span class="hljs-comment">// HTMLAttributes ä¸­ä¼šè‡ªåŠ¨åŒ…å« calloutType</span>
  <span class="hljs-keyword">return</span> [
    <span class="hljs-string">'div'</span>,
    <span class="hljs-title function_">mergeAttributes</span>(<span class="hljs-title class_">HTMLAttributes</span>, { <span class="hljs-string">'data-type'</span>: <span class="hljs-string">'callout'</span> }),
    <span class="hljs-number">0</span>
  ];
},
</code></pre>
<p>Tiptap ä¼šè‡ªåŠ¨å°† <code>addAttributes</code> ä¸­å®šä¹‰çš„å±æ€§ï¼ˆå¦‚ <code>calloutType</code>ï¼‰æ˜ å°„åˆ° <code>HTMLAttributes</code> å¯¹è±¡ä¸­ï¼Œå¹¶ä»¥ <code>data-</code> å‰ç¼€çš„å½¢å¼æ¸²æŸ“åˆ° HTML æ ‡ç­¾ä¸Šã€‚æœ€ç»ˆç”Ÿæˆçš„ HTML ä¼šæ˜¯ <code>&lt;div data-type="callout" data-callout-type="info"&gt;...&lt;/div&gt;</code>ã€‚</p>
</li>
<li>
<p><strong>è§£æå±æ€§</strong>ï¼šä¿®æ”¹ <code>parseHTML</code>ï¼Œä» DOM ä¸­è¯»å–å±æ€§å€¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¿®æ”¹ parseHTML æ–¹æ³•</span>

<span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    {
      <span class="hljs-attr">tag</span>: <span class="hljs-string">'div[data-type="callout"]'</span>,
      <span class="hljs-attr">getAttrs</span>: <span class="hljs-function">(<span class="hljs-params">element</span>) =&gt;</span> ({
        <span class="hljs-attr">calloutType</span>: element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-callout-type'</span>),
      }),
    },
  ];
},
</code></pre>
<p>æˆ‘ä»¬åœ¨è§£æè§„åˆ™ä¸­æ·»åŠ äº† <code>getAttrs</code> å‡½æ•°ã€‚å½“åŒ¹é…åˆ° <code>div</code> æ ‡ç­¾æ—¶ï¼Œæ­¤å‡½æ•°ä¼šæ‰§è¡Œï¼Œè¯»å– <code>data-callout-type</code> å±æ€§çš„å€¼ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™æˆ‘ä»¬èŠ‚ç‚¹çŠ¶æ€ä¸­çš„ <code>calloutType</code> å±æ€§ã€‚</p>
</li>
</ol>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„ Callout èŠ‚ç‚¹å·²ç»å…·å¤‡äº†åŠ¨æ€æ ·å¼çš„èƒ½åŠ›ã€‚ä½ å¯ä»¥é€šè¿‡ CSS é€‰æ‹©å™¨ <code>div[data-callout-type="warning"]</code> æ¥ä¸ºå…¶å®šä¹‰ç‹¬ç‰¹çš„æ ·å¼ã€‚</p>
<h3 data-id="heading-16">æ­¥éª¤å››ï¼šåˆ›å»ºå‘½ä»¤</h3>
<p>å¦‚æœç”¨æˆ·åªèƒ½é€šè¿‡æ‰‹åŠ¨ç¼–å†™ HTML æ¥åˆ›å»º Calloutï¼Œé‚£ä½“éªŒå°±å¤ªç³Ÿç³•äº†ã€‚æˆ‘ä»¬éœ€è¦æä¾›ç¼–ç¨‹å¼çš„æ¥å£â€”â€”å‘½ä»¤ï¼ˆCommandsï¼‰ï¼Œä»¥ä¾¿é€šè¿‡æŒ‰é’®æˆ–å…¶ä»– UI å…ƒç´ æ¥æ“ä½œ Callout æ‰©å±•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Node.create({}) å†…éƒ¨æ·»åŠ </span>
<span class="hljs-comment">// åˆ«å¿˜äº†åœ¨æ–‡ä»¶é¡¶éƒ¨å¼•å…¥ declare module '@tiptap/core'</span>

declare <span class="hljs-variable language_">module</span> <span class="hljs-string">'@tiptap/core'</span> {
  interface <span class="hljs-title class_">Commands</span>&lt;<span class="hljs-title class_">ReturnType</span>&gt; {
    <span class="hljs-attr">callout</span>: {
      <span class="hljs-comment">/**
       * è®¾ç½®æˆ–åˆ‡æ¢ Callout å—
       */</span>
      <span class="hljs-attr">toggleCallout</span>: <span class="hljs-function">(<span class="hljs-params">attributes: { calloutType: string }</span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>,
    }
  }
}

<span class="hljs-comment">//...</span>

<span class="hljs-title function_">addCommands</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">toggleCallout</span>: <span class="hljs-function">(<span class="hljs-params">attributes</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
      <span class="hljs-comment">// ä½¿ç”¨ toggleBlock æ¥åœ¨æ®µè½å’Œ Callout ä¹‹é—´åˆ‡æ¢</span>
      <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">toggleBlock</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, <span class="hljs-string">'paragraph'</span>, attributes);
    },
  };
},
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>addCommands</code> æ–¹æ³•æ¥å®šä¹‰å‘½ä»¤ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>toggleCallout</code> å‘½ä»¤ã€‚æˆ‘ä»¬å·§å¦™åœ°åˆ©ç”¨äº† Tiptap å†…ç½®çš„ <code>toggleBlock</code> å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ™ºèƒ½åœ°åœ¨ä¸¤ç§å—ç±»å‹ä¹‹é—´åˆ‡æ¢ã€‚å¦‚æœå½“å‰é€‰åŒºæ˜¯æ®µè½ï¼Œå®ƒä¼šå°†å…¶è½¬æ¢ä¸º <code>callout</code>ï¼›å¦‚æœå·²ç»æ˜¯ <code>callout</code>ï¼Œåˆ™ä¼šå°†å…¶è½¬æ¢å›æ®µè½ã€‚æˆ‘ä»¬è¿˜é€šè¿‡ <code>attributes</code> å‚æ•°ï¼Œå…è®¸åœ¨åˆ›å»º Callout æ—¶åŠ¨æ€æŒ‡å®šå…¶ç±»å‹ã€‚</p>
<p>é€šè¿‡ TypeScript çš„ <code>declare module</code>ï¼Œæˆ‘ä»¬å°†è‡ªå®šä¹‰å‘½ä»¤æ³¨å…¥åˆ°äº† Tiptap çš„å…¨å±€å‘½ä»¤æ¥å£ä¸­ï¼Œè¿™èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥æä½³çš„ç±»å‹æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨ä½“éªŒã€‚</p>
<h3 data-id="heading-17">æ­¥éª¤äº”ï¼šé›†æˆåˆ°ç¼–è¾‘å™¨ä¸æ ·å¼å®šåˆ¶</h3>
<h4 data-id="heading-18">5.1 é›†æˆæ‰©å±•</h4>
<p>æœ€åä¸€æ­¥ï¼Œå°†æˆ‘ä»¬ç²¾å¿ƒæ‰“é€ çš„ <code>Callout</code> æ‰©å±•é›†æˆåˆ° Tiptap ç¼–è¾‘å™¨å®ä¾‹ä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ä½ çš„ç¼–è¾‘å™¨é…ç½®æ–‡ä»¶ä¸­</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Editor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">StarterKit</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/starter-kit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Callout</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Callout.js'</span>; <span class="hljs-comment">// å¼•å…¥æˆ‘ä»¬çš„æ‰©å±•</span>

<span class="hljs-keyword">const</span> editor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Editor</span>({
  <span class="hljs-attr">extensions</span>: [
    <span class="hljs-title class_">StarterKit</span>,
    <span class="hljs-title class_">Callout</span>,  <span class="hljs-comment">// æ·»åŠ  Callout æ‰©å±•</span>
  ],
  <span class="hljs-comment">//... å…¶ä»–é…ç½®</span>
});
</code></pre>
<h4 data-id="heading-19">5.2 å®Œæ•´çš„ CSS æ ·å¼</h4>
<p>ç°åœ¨è®©æˆ‘ä»¬ä¸º Callout æ·»åŠ ç¾è§‚ä¸”å®ç”¨çš„æ ·å¼ï¼Œå®ç°ä¸åŒç±»å‹çš„è§†è§‰æ•ˆæœï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* Callout åŸºç¡€æ ·å¼ */</span>
<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-type=<span class="hljs-string">"callout"</span>]</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.5rem</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8fafc</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span> ease;
}

<span class="hljs-comment">/* Info ç±»å‹ - è“è‰²ä¸»é¢˜ */</span>
<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"info"</span>]</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eff6ff</span>;
  <span class="hljs-attribute">border-left-color</span>: <span class="hljs-number">#3b82f6</span>;
}

<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"info"</span>]</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">'â„¹ï¸ æç¤º'</span>;
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1e40af</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
}

<span class="hljs-comment">/* Warning ç±»å‹ - é»„è‰²ä¸»é¢˜ */</span>
<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"warning"</span>]</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fefce8</span>;
  <span class="hljs-attribute">border-left-color</span>: <span class="hljs-number">#eab308</span>;
}

<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"warning"</span>]</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">'âš ï¸ è­¦å‘Š'</span>;
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#a16207</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
}

<span class="hljs-comment">/* Danger ç±»å‹ - çº¢è‰²ä¸»é¢˜ */</span>
<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"danger"</span>]</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fef2f2</span>;
  <span class="hljs-attribute">border-left-color</span>: <span class="hljs-number">#ef4444</span>;
}

<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"danger"</span>]</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">'ğŸš¨ å±é™©'</span>;
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#b91c1c</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
}

<span class="hljs-comment">/* Success ç±»å‹ - ç»¿è‰²ä¸»é¢˜ */</span>
<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"success"</span>]</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0fdf4</span>;
  <span class="hljs-attribute">border-left-color</span>: <span class="hljs-number">#22c55e</span>;
}

<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-callout-type=<span class="hljs-string">"success"</span>]</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">'âœ… æˆåŠŸ'</span>;
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#15803d</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
}

<span class="hljs-comment">/* Callout å†…éƒ¨æ®µè½æ ·å¼ */</span>
<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-type=<span class="hljs-string">"callout"</span>]</span> <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
}

<span class="hljs-selector-class">.tiptap</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[data-type=<span class="hljs-string">"callout"</span>]</span> <span class="hljs-selector-tag">p</span> + <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">0.5rem</span>;
}
</code></pre>
<h4 data-id="heading-20">5.3 ä½¿ç”¨ç¤ºä¾‹</h4>
<p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥åœ¨ç¼–è¾‘å™¨ UI ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»æ—¶è°ƒç”¨å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// åœ¨ä½ çš„å·¥å…·æ ç»„ä»¶ä¸­</span>
&lt;button
  onClick={<span class="hljs-function">() =&gt;</span> editor.<span class="hljs-property">commands</span>.<span class="hljs-title function_">toggleCallout</span>({ <span class="hljs-attr">calloutType</span>: <span class="hljs-string">'warning'</span> })}
  className={editor.<span class="hljs-title function_">isActive</span>(<span class="hljs-string">'callout'</span>, { <span class="hljs-attr">calloutType</span>: <span class="hljs-string">'warning'</span> }) ? <span class="hljs-string">'is-active'</span> : <span class="hljs-string">''</span>}
&gt;
  âš ï¸ è­¦å‘Šæ¡†
&lt;/button&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> editor.commands.toggleCallout({ calloutType: 'info' })}
  className={editor.isActive('callout', { calloutType: 'info' }) ? 'is-active' : ''}
&gt;
  â„¹ï¸ æç¤ºæ¡†
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
</code></pre>
<h4 data-id="heading-21">5.4 åŠŸèƒ½éªŒè¯æ¸…å•</h4>
<p>æµ‹è¯•ä½ çš„ Callout æ‰©å±•æ˜¯å¦å®Œæ•´å®ç°ï¼š</p>
<p>âœ… é€šè¿‡å‘½ä»¤åˆ›å»º Callout å—
âœ… åˆ‡æ¢ä¸åŒçš„ calloutTypeï¼ˆinfoã€warningã€dangerã€successï¼‰
âœ… éªŒè¯å±æ€§æ­£ç¡®åºåˆ—åŒ–åˆ° HTML
âœ… ä» HTML ç²˜è´´èƒ½æ­£ç¡®è§£æä¸º Callout
âœ… CSS æ ·å¼æ­£ç¡®åº”ç”¨åˆ°ä¸åŒç±»å‹
âœ… åœ¨ Callout å†…éƒ¨å¯ä»¥æ­£å¸¸ç¼–è¾‘æ®µè½å†…å®¹</p>
<blockquote>
<p>ğŸ‰ <strong>æ­å–œï¼</strong> ä½ å·²ç»æˆåŠŸåˆ›å»ºäº†ç¬¬ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ ·å¼ç²¾ç¾çš„è‡ªå®šä¹‰èŠ‚ç‚¹æ‰©å±•ï¼</p>
</blockquote>
<h2 data-id="heading-22">ç¬¬ä¸‰èŠ‚ï¼šä»é›¶åˆ° Markï¼šæ‰“é€ ä¸€ä¸ªå¸¦é¢œè‰²çš„è‡ªå®šä¹‰â€œé«˜äº®â€</h2>
<p>æŒæ¡äº† <code>Node</code> çš„åˆ›å»ºä¹‹åï¼Œ<code>Mark</code> çš„åˆ›å»ºå°±å˜å¾—è½»è½¦ç†Ÿè·¯äº†ã€‚<code>Mark</code> ç”¨äºå®ç°è¡Œå†…æ ¼å¼ï¼Œå¦‚åŠ ç²—ã€é“¾æ¥ç­‰ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ¯” Tiptap å†…ç½®é«˜äº®æ›´å¼ºå¤§çš„ç‰ˆæœ¬ï¼šä¸€ä¸ªå¯ä»¥è‡ªå®šä¹‰é«˜äº®é¢œè‰²çš„ <code>coloredHighlight</code> æ ‡è®°ã€‚è¿™ä¸ªè¿‡ç¨‹å°†å·©å›ºæˆ‘ä»¬å¯¹å±æ€§å’Œå‘½ä»¤çš„ç†è§£ï¼Œå¹¶å¼•å…¥æ–°çš„æ¦‚å¿µï¼Œå¦‚é”®ç›˜å¿«æ·é”®ã€‚</p>
<h3 data-id="heading-23">æ­¥éª¤ä¸€ï¼šæ­å»º Mark çš„éª¨æ¶</h3>
<p>ä¸ <code>Node</code> ç±»ä¼¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Mark.create</code> æ–¹æ³•å¼€å§‹ 10ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</p>
<p><code>ColoredHighlight.js</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Mark</span>, mergeAttributes } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ColoredHighlight</span> = <span class="hljs-title class_">Mark</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'coloredHighlight'</span>, <span class="hljs-comment">// 1. å”¯ä¸€åç§°</span>

  <span class="hljs-attr">spanning</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 2. é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡è®°ä¸èƒ½è·¨è¶Šå—çº§èŠ‚ç‚¹</span>

  <span class="hljs-comment">//... æ›´å¤šé…ç½®</span>
});
</code></pre>
<ol>
<li>
<p><strong><code>name: 'coloredHighlight'</code></strong>: åŒæ ·ï¼Œä¸€ä¸ªå”¯ä¸€çš„åç§°æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
</li>
<li>
<p><strong><code>spanning: false</code></strong>: è¿™ä¸ªå±æ€§é»˜è®¤ä¸º <code>false</code>ï¼Œæ„å‘³ç€æ ‡è®°ä¸èƒ½è·¨è¶Šä¸åŒçš„å—çº§èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·é€‰ä¸­äº†ä¸¤ä¸ªæ®µè½çš„éƒ¨åˆ†æ–‡æœ¬ï¼Œåº”ç”¨æ­¤æ ‡è®°åï¼Œå®ƒä¼šåˆ†åˆ«åœ¨ä¸¤ä¸ªæ®µè½å†…ç”Ÿæ•ˆï¼Œè€Œä¸ä¼šå½¢æˆä¸€ä¸ªå•ä¸€çš„ã€è·¨è¶Šæ®µè½è¾¹ç•Œçš„æ ‡è®°ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬æœŸæœ›çš„è¡Œä¸º 15ã€‚</p>
</li>
</ol>
<h3 data-id="heading-24">æ­¥éª¤äºŒï¼šåºåˆ—åŒ–ä¸å±æ€§</h3>
<p>æˆ‘ä»¬çš„æ ¸å¿ƒéœ€æ±‚æ˜¯èƒ½å¤Ÿè‡ªå®šä¹‰é¢œè‰²ã€‚è¿™è‡ªç„¶éœ€è¦ä¸€ä¸ª <code>color</code> å±æ€§ã€‚ä¸ <code>Node</code> ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå®šä¹‰ã€æ¸²æŸ“ã€è§£æä¸‰éƒ¨æ›²ã€‚</p>
<h4 data-id="heading-25">2.1 é…ç½®é€‰é¡¹ï¼ˆOptionsï¼‰</h4>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ‰©å±•æ·»åŠ é…ç½®é€‰é¡¹ï¼Œå®šä¹‰é»˜è®¤é¢œè‰²ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Mark.create({}) å†…éƒ¨æ·»åŠ </span>

<span class="hljs-title function_">addOptions</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">color</span>: <span class="hljs-string">'#FFFF00'</span>,  <span class="hljs-comment">// é»˜è®¤é¢œè‰²ä¸ºé»„è‰²</span>
  }
},
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>Options vs Attributes</strong>ï¼š</p>
<ul>
<li><strong>Options</strong>ï¼šæ‰©å±•çº§åˆ«çš„é…ç½®ï¼Œåœ¨æ‰©å±•å®ä¾‹åŒ–æ—¶è®¾ç½®ï¼Œå½±å“æ‰€æœ‰è¯¥æ‰©å±•çš„å®ä¾‹</li>
<li><strong>Attributes</strong>ï¼šèŠ‚ç‚¹çº§åˆ«çš„æ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹å®ä¾‹å¯ä»¥æœ‰ä¸åŒçš„å€¼</li>
</ul>
</blockquote>
<h4 data-id="heading-26">2.2 å®šä¹‰å±æ€§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">color</span>: {
      <span class="hljs-attr">default</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">color</span>,  <span class="hljs-comment">// ä½¿ç”¨ options ä¸­çš„é»˜è®¤é¢œè‰²</span>
      <span class="hljs-attr">parseHTML</span>: <span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> element.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">renderHTML</span>: <span class="hljs-function"><span class="hljs-params">attributes</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!attributes.<span class="hljs-property">color</span>) {
          <span class="hljs-keyword">return</span> {};
        }
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">style</span>: <span class="hljs-string">`background-color: <span class="hljs-subst">${attributes.color}</span>`</span>,
        };
      },
    },
  };
},
</code></pre>
<h4 data-id="heading-27">2.3 é…ç½®åºåˆ—åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    {
      <span class="hljs-attr">tag</span>: <span class="hljs-string">'mark'</span>,  <span class="hljs-comment">// åŒ¹é… &lt;mark&gt; æ ‡ç­¾</span>
      <span class="hljs-attr">getAttrs</span>: <span class="hljs-function">(<span class="hljs-params">element</span>) =&gt;</span> {
        <span class="hljs-comment">// ä» style å±æ€§ä¸­è§£æèƒŒæ™¯é¢œè‰²</span>
        <span class="hljs-keyword">const</span> color = element.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span>;
        <span class="hljs-keyword">return</span> color ? { color } : {};
      },
    },
  ];
},

<span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ HTMLAttributes }</span>) {
  <span class="hljs-comment">// mergeAttributes ä¼šè‡ªåŠ¨å¤„ç† color å±æ€§è½¬ä¸º style</span>
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'mark'</span>, <span class="hljs-title function_">mergeAttributes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">HTMLAttributes</span>, <span class="hljs-title class_">HTMLAttributes</span>), <span class="hljs-number">0</span>];
},
</code></pre>
<p><strong>å·¥ä½œåŸç†è§£æ</strong>ï¼š</p>
<ul>
<li>âœ… <strong><code>addOptions</code></strong>ï¼šå®šä¹‰æ‰©å±•çº§åˆ«çš„é»˜è®¤é…ç½®</li>
<li>âœ… <strong><code>addAttributes</code></strong>ï¼šå®šä¹‰èŠ‚ç‚¹çº§åˆ«çš„åŠ¨æ€æ•°æ®ï¼Œå¼•ç”¨ options</li>
<li>âœ… <strong><code>parseHTML</code></strong>ï¼šä» HTML çš„ style æå–èƒŒæ™¯è‰²</li>
<li>âœ… <strong><code>renderHTML</code></strong>ï¼šå°† color å±æ€§æ¸²æŸ“ä¸ºå†…è” style</li>
</ul>
<h3 data-id="heading-28">æ­¥éª¤ä¸‰ï¼šåˆ›å»ºä¸€å¥—å®Œæ•´çš„å‘½ä»¤</h3>
<p>ä¸€ä¸ªä¼˜ç§€çš„æ‰©å±•åº”è¯¥æä¾›ä¸€ä¸ªå®Œæ•´ã€å¯é¢„æµ‹çš„ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ï¼Œæ–¹ä¾¿ UI è°ƒç”¨ã€‚è¿™ä¸ä»…ä»…æ˜¯"è®©æŒ‰é’®å·¥ä½œ"ï¼Œè€Œæ˜¯ç²¾å¿ƒè®¾è®¡æ‰©å±•çš„å¤–éƒ¨äº¤äº’æ–¹å¼ã€‚å¯¹äºé«˜äº®æ ‡è®°ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ã€åˆ‡æ¢å’Œå–æ¶ˆä¸‰ç§æ“ä½œ 14ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ ColoredHighlight.js ä¸­</span>

declare <span class="hljs-variable language_">module</span> <span class="hljs-string">'@tiptap/core'</span> {
  interface <span class="hljs-title class_">Commands</span>&lt;<span class="hljs-title class_">ReturnType</span>&gt; {
    <span class="hljs-attr">coloredHighlight</span>: {
      <span class="hljs-comment">/**
       * è®¾ç½®é«˜äº®å¹¶æŒ‡å®šé¢œè‰²
       */</span>
      <span class="hljs-attr">setHighlight</span>: <span class="hljs-function">(<span class="hljs-params">attributes: { color: string }</span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>,
      <span class="hljs-comment">/**
       * åˆ‡æ¢é«˜äº®çŠ¶æ€
       */</span>
      <span class="hljs-attr">toggleHighlight</span>: <span class="hljs-function">(<span class="hljs-params">attributes: { color: string }</span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>,
      <span class="hljs-comment">/**
       * å–æ¶ˆé«˜äº®
       */</span>
      <span class="hljs-attr">unsetHighlight</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">ReturnType</span>,
    }
  }
}

<span class="hljs-comment">// åœ¨ Mark.create({}) å†…éƒ¨æ·»åŠ </span>
<span class="hljs-title function_">addCommands</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">setHighlight</span>: <span class="hljs-function">(<span class="hljs-params">attributes</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">setMark</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, attributes);
    },
    <span class="hljs-attr">toggleHighlight</span>: <span class="hljs-function">(<span class="hljs-params">attributes</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">toggleMark</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, attributes);
    },
    <span class="hljs-attr">unsetHighlight</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">unsetMark</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    },
  };
},
</code></pre>
<p>æˆ‘ä»¬å†æ¬¡ä½¿ç”¨äº† Tiptap å†…ç½®çš„å‘½ä»¤åŠ©æ‰‹ï¼š<code>setMark</code>ã€<code>toggleMark</code> å’Œ <code>unsetMark</code>ã€‚å®ƒä»¬æå¤§åœ°ç®€åŒ–äº†é€»è¾‘ã€‚é€šè¿‡æä¾›è¿™ä¸€æ•´å¥—å‘½ä»¤ï¼Œæˆ‘ä»¬è®© UI å±‚çš„å¼€å‘å˜å¾—å¼‚å¸¸ç®€å•ï¼š</p>
<ul>
<li>
<p>é¢œè‰²é€‰æ‹©å™¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªé¢œè‰²ï¼Œç„¶åè°ƒç”¨ <code>editor.commands.setHighlight({ color: '#FFC0CB' })</code>ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªå¼€å…³æŒ‰é’®å¯ä»¥è°ƒç”¨ <code>editor.commands.toggleHighlight({ color: '#FFFF00' })</code>ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªâ€œæ¸…é™¤æ ¼å¼â€æŒ‰é’®å¯ä»¥è°ƒç”¨ <code>editor.commands.unsetHighlight()</code>ã€‚</p>
</li>
</ul>
<p>é€šè¿‡ <code>declare module</code> å†æ¬¡æ‰©å±• TypeScript æ¥å£ï¼Œæˆ‘ä»¬ç¡®ä¿äº†è¿™å¥— API æ˜¯å®Œå…¨ç±»å‹å®‰å…¨ä¸”å…·å¤‡è‡ªåŠ¨è¡¥å…¨çš„ï¼Œæå¤§åœ°æå‡äº†å¼€å‘ä½“éªŒ 20ã€‚</p>
<h3 data-id="heading-29">æ­¥éª¤å››ï¼šæ·»åŠ é”®ç›˜å¿«æ·é”®</h3>
<p>ä¸ºäº†æå‡æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæœ€å¸¸ç”¨çš„å‘½ä»¤ç»‘å®šé”®ç›˜å¿«æ·é”®ã€‚<code>addKeyboardShortcuts</code> æ–¹æ³•è®©è¿™ä¸€åˆ‡å˜å¾—ç®€å•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Mark.create({}) å†…éƒ¨æ·»åŠ </span>

<span class="hljs-title function_">addKeyboardShortcuts</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'Mod-Shift-H'</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">editor</span>.<span class="hljs-property">commands</span>.<span class="hljs-title function_">toggleHighlight</span>({ <span class="hljs-attr">color</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">color</span> }),
  };
},
</code></pre>
<p>è¿™æ®µä»£ç å°† <code>Cmd+Shift+H</code> (åœ¨ Mac ä¸Š) æˆ– <code>Ctrl+Shift+H</code> (åœ¨ Windows ä¸Š) ç»‘å®šåˆ°äº† <code>toggleHighlight</code> å‘½ä»¤ä¸Š 14ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹å¿«æ·é”®æ—¶ï¼Œå®ƒä¼šä½¿ç”¨æˆ‘ä»¬åœ¨</p>
<p><code>addAttributes</code> ä¸­å®šä¹‰çš„é»˜è®¤é¢œè‰²æ¥åˆ‡æ¢é«˜äº®ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ <code>coloredHighlight</code> æ‰©å±•å·²ç»å®Œæˆã€‚å®ƒä¸ä»…èƒ½å®ç°åŸºæœ¬çš„æ–‡æœ¬é«˜äº®ï¼Œè¿˜èƒ½è‡ªå®šä¹‰é¢œè‰²ï¼Œæä¾›äº†ä¸€å¥—å®Œæ•´çš„å‘½ä»¤ APIï¼Œå¹¶æ”¯æŒé”®ç›˜å¿«æ·é”®ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å·©å›ºäº†å¯¹ Tiptap æ‰©å±•æ ¸å¿ƒæ¦‚å¿µçš„ç†è§£ï¼Œå¹¶ä¸ºè¿›å…¥æ›´é«˜çº§çš„ä¸»é¢˜åšå¥½äº†å‡†å¤‡ã€‚</p>
<h2 data-id="heading-30">ç¬¬å››èŠ‚ï¼šé«˜çº§èƒ½åŠ› - è®©ä½ çš„æ‰©å±•æ´»èµ·æ¥</h2>
<p>æˆ‘ä»¬å·²ç»æŒæ¡äº†å¦‚ä½•å®šä¹‰æ‰©å±•çš„â€œéª¨éª¼â€ï¼ˆSchemaï¼‰å’Œâ€œè‚Œè‚‰â€ï¼ˆCommandsï¼‰ã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™ä¸ºå®ƒä»¬æ³¨å…¥â€œç¥ç»ç³»ç»Ÿâ€äº†ã€‚æœ¬ç« å°†æ¢ç´¢ Tiptap æä¾›çš„é«˜çº§ APIï¼Œå®ƒä»¬èƒ½è®©ä½ çš„æ‰©å±•å…·å¤‡åŠ¨æ€è¡Œä¸ºã€çŠ¶æ€ç®¡ç†å’Œæ™ºèƒ½è‡ªåŠ¨åŒ–èƒ½åŠ›ï¼Œä»è€Œæå¤§åœ°æå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-31">ä½¿ç”¨è¾“å…¥å’Œç²˜è´´è§„åˆ™å®ç°è‡ªåŠ¨åŒ–</h3>
<p><code>addInputRules</code> å’Œ <code>addPasteRules</code> æ˜¯ä¸¤ä¸ªæä¸ºå¼ºå¤§çš„ UX å¢å¼ºå·¥å…·ã€‚å®ƒä»¬å…è®¸æ‰©å±•ç›‘å¬ç”¨æˆ·çš„è¾“å…¥å’Œç²˜è´´è¡Œä¸ºï¼Œå¹¶æ ¹æ®é¢„è®¾çš„æ¨¡å¼è‡ªåŠ¨è§¦å‘ç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚å®ç°æµè¡Œçš„ Markdown å¿«æ·è¯­æ³•ã€‚</p>
<ul>
<li>
<p><strong><code>addInputRules</code>ï¼šå®æ—¶è¾“å…¥è½¬æ¢</strong></p>
<p>è¾“å…¥è§„åˆ™ä¼šåœ¨ç”¨æˆ·é”®å…¥æ—¶å®æ—¶åŒ¹é…æ–‡æœ¬æ¨¡å¼ã€‚æˆ‘ä»¬å°†ä¸ºç¬¬äºŒç« åˆ›å»ºçš„ <code>Callout</code> èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªè¾“å…¥è§„åˆ™ï¼šå½“ç”¨æˆ·åœ¨æ–°çš„ä¸€è¡Œè¾“å…¥ <code>&gt;&gt;</code> (å¤§äºå·åŠ ç©ºæ ¼) æ—¶ï¼Œè‡ªåŠ¨å°†è¯¥æ®µè½è½¬æ¢ä¸ºä¸€ä¸ª Callout å—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Callout.js çš„ Node.create({}) å†…éƒ¨æ·»åŠ </span>
<span class="hljs-keyword">import</span> { nodeInputRule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-comment">//...</span>
<span class="hljs-title function_">addInputRules</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    <span class="hljs-title function_">nodeInputRule</span>({
      <span class="hljs-attr">find</span>: <span class="hljs-regexp">/^&gt;&gt;\s$/</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span>,
    }),
  ];
},
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨äº† Tiptap æä¾›çš„ <code>nodeInputRule</code> å¸®åŠ©å‡½æ•°ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œ</p>
<p><code>find</code> å±æ€§æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…è§¦å‘æ¨¡å¼ï¼›<code>type</code> å±æ€§åˆ™æŒ‡å®šäº†åŒ¹é…æˆåŠŸåè¦åˆ›å»ºçš„èŠ‚ç‚¹ç±»å‹ï¼Œ<code>this.type</code> åœ¨è¿™é‡Œå°±æŒ‡å‘ <code>Callout</code> èŠ‚ç‚¹æœ¬èº«ã€‚ç°åœ¨ï¼Œç”¨æˆ·æ— éœ€ç‚¹å‡»ä»»ä½•æŒ‰é’®ï¼Œåªéœ€è¾“å…¥ç®€å•çš„å¿«æ·ç¬¦ï¼Œå°±èƒ½åˆ›å»º Calloutï¼Œæ•ˆç‡å¤§å¢ã€‚</p>
</li>
<li>
<p><strong><code>addPasteRules</code>ï¼šæ™ºèƒ½ç²˜è´´å¤„ç†</strong></p>
<p>ç²˜è´´è§„åˆ™ä¸è¾“å…¥è§„åˆ™ç±»ä¼¼ï¼Œä½†å®ƒä½œç”¨äºç”¨æˆ·ç²˜è´´å†…å®¹æ—¶ã€‚æˆ‘ä»¬å°†ä¸ºç¬¬ä¸‰ç« çš„ <code>coloredHighlight</code> æ ‡è®°æ·»åŠ ä¸€ä¸ªç²˜è´´è§„åˆ™ï¼šå½“ç”¨æˆ·ç²˜è´´å½¢å¦‚ <code>==è¢«é«˜äº®çš„æ–‡æœ¬==</code> çš„å†…å®¹æ—¶ï¼Œè‡ªåŠ¨ä¸ºå…¶åº”ç”¨é«˜äº®æ ‡è®°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ ColoredHighlight.js çš„ Mark.create({}) å†…éƒ¨æ·»åŠ </span>
<span class="hljs-keyword">import</span> { markPasteRule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-comment">//...</span>
<span class="hljs-title function_">addPasteRules</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    <span class="hljs-title function_">markPasteRule</span>({
      <span class="hljs-attr">find</span>: <span class="hljs-regexp">/==(.*?)==/g</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span>,
    }),
  ];
},
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>markPasteRule</code> å¸®åŠ©å‡½æ•° 22ã€‚</p>
<p><code>find</code> æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ <code>g</code> (global) æ ‡å¿—è‡³å…³é‡è¦ï¼Œå®ƒç¡®ä¿äº†å¦‚æœç²˜è´´çš„å†…å®¹ä¸­æœ‰å¤šå¤„åŒ¹é…ï¼Œè§„åˆ™ä¼šå¯¹æ¯ä¸€å¤„éƒ½ç”Ÿæ•ˆ 22ã€‚è¿™ä¸ªå°å°çš„åŠŸèƒ½ï¼Œä½¿å¾—ä»å…¶ä»–æ”¯æŒç±»ä¼¼ Markdown è¯­æ³•çš„åº”ç”¨ï¼ˆå¦‚ Obsidian, Notionï¼‰ä¸­å¤åˆ¶å†…å®¹åˆ°æˆ‘ä»¬çš„ç¼–è¾‘å™¨æ—¶ï¼Œæ ¼å¼èƒ½å¤Ÿè¢«æ— ç¼ä¿ç•™ã€‚</p>
</li>
</ul>
<h3 data-id="heading-32">ä½¿ç”¨ <code>addStorage</code> ç®¡ç†å†…éƒ¨çŠ¶æ€</h3>
<p>åœ¨å¼€å‘å¤æ‚æ‰©å±•æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å­˜å‚¨ä¸€äº›æ•°æ®ã€‚Tiptap æä¾›äº†ä¸¤ç§çŠ¶æ€å­˜å‚¨æœºåˆ¶ï¼š<code>addAttributes</code> å’Œ <code>addStorage</code>ã€‚ç†è§£å®ƒä»¬çš„åŒºåˆ«æ˜¯è®¾è®¡é«˜çº§æ‰©å±•çš„å…³é”®ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªå…³äºçŠ¶æ€äºŒå…ƒæ€§çš„æ ¸å¿ƒæ¦‚å¿µï¼š<strong>æ–‡æ¡£çŠ¶æ€ vs. è¿è¡Œæ—¶çŠ¶æ€</strong>ã€‚</p>
<ul>
<li>
<p><strong><code>addAttributes</code></strong> ç”¨äºå­˜å‚¨ <strong>æ–‡æ¡£çŠ¶æ€</strong>ã€‚è¿™äº›æ•°æ®æ˜¯æ–‡æ¡£å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦è¢«åºåˆ—åŒ–ï¼ˆä¿å­˜åˆ° HTML æˆ– JSONï¼‰ï¼Œå¹¶åœ¨åŠ è½½æ—¶æ¢å¤ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé“¾æ¥çš„ <code>href</code> åœ°å€ï¼Œæˆ–è€…æˆ‘ä»¬ Callout çš„ <code>calloutType</code>ã€‚è¿™äº›æ•°æ®å¿…é¡»æ˜¯å¯åºåˆ—åŒ–ä¸º JSON çš„ç®€å•å€¼ã€‚</p>
</li>
<li>
<p><strong><code>addStorage</code></strong> ç”¨äºå­˜å‚¨ <strong>è¿è¡Œæ—¶çŠ¶æ€</strong>ã€‚è¿™äº›æ•°æ®åªå­˜åœ¨äºå½“å‰ç¼–è¾‘å™¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œä¸ä¼šè¢«ä¿å­˜åˆ°æ–‡æ¡£å†…å®¹é‡Œ 17ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå‡½æ•°çš„å¼•ç”¨ã€ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€ä¸€ä¸ªè®¡æ—¶å™¨ IDï¼Œæˆ–è€…ç”¨äºåˆ†æçš„è®¡æ•°å™¨ã€‚</p>
</li>
</ul>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„æ‰©å±•æ¥æ¼”ç¤º <code>addStorage</code> çš„ç”¨æ³•ã€‚è¿™ä¸ªæ‰©å±•å°†ç»Ÿè®¡ç¼–è¾‘å™¨å†…å®¹è¢«æ›´æ–°äº†å¤šå°‘æ¬¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Extension</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-comment">// ä¸ºå­˜å‚¨æ·»åŠ  TypeScript ç±»å‹ï¼Œå¢å¼ºä»£ç å¥å£®æ€§</span>
declare <span class="hljs-variable language_">module</span> <span class="hljs-string">'@tiptap/core'</span> {
  interface <span class="hljs-title class_">ExtensionStorage</span> {
    <span class="hljs-attr">updateCounter</span>: {
      <span class="hljs-attr">count</span>: number,
    }
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UpdateCounter</span> = <span class="hljs-title class_">Extension</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'updateCounter'</span>,

  <span class="hljs-title function_">addStorage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// åˆå§‹åŒ–å­˜å‚¨</span>
    };
  },

  <span class="hljs-title function_">onUpdate</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>; <span class="hljs-comment">// åœ¨æ¯æ¬¡æ›´æ–°æ—¶ä¿®æ”¹å­˜å‚¨</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Editor updated'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>, <span class="hljs-string">'times.'</span>);
  },
});
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<ol>
<li>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>addStorage</code> è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä½œä¸ºè¿™ä¸ªæ‰©å±•çš„åˆå§‹çŠ¶æ€ 18ã€‚</p>
</li>
<li>
<p>åœ¨ <code>onUpdate</code> ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>this.storage</code> è®¿é—®å¹¶ä¿®æ”¹è¿™ä¸ªçŠ¶æ€ 18ã€‚</p>
</li>
<li>
<p>è¿™ä¸ª <code>count</code> å€¼æ˜¯ä¸´æ—¶çš„ï¼Œåˆ·æ–°é¡µé¢åå°±ä¼šé‡ç½®ã€‚</p>
</li>
</ol>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»æ‰©å±•å¤–éƒ¨è®¿é—®è¿™ä¸ªå­˜å‚¨ï¼Œåªéœ€é€šè¿‡ <code>editor.storage.extensionName</code> 18ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> count = editor.<span class="hljs-property">storage</span>.<span class="hljs-property">updateCounter</span>.<span class="hljs-property">count</span>;
</code></pre>
<p>é€šè¿‡ <code>declare module</code> ä¸ºå­˜å‚¨å®šä¹‰ç±»å‹ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨è®¿é—® <code>editor.storage.updateCounter</code> æ—¶è·å¾—å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒï¼Œé¿å…æ‹¼å†™é”™è¯¯å’Œç±»å‹æ»¥ç”¨ 20ã€‚</p>
<h3 data-id="heading-33">æ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸä¸å‰¯ä½œç”¨</h3>
<p>Tiptap æ‰©å±•æ‹¥æœ‰ä¸€å¥—ä¸°å¯Œçš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆLifecycle Hooksï¼‰ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç¼–è¾‘å™¨çš„å…³é”®æ—¶åˆ»æ‰§è¡Œä»£ç ï¼Œå¤„ç†å‰¯ä½œç”¨ã€‚</p>
<p>å¸¸ç”¨çš„é’©å­åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p><code>onCreate</code>: ç¼–è¾‘å™¨å®ä¾‹åˆ›å»ºå¹¶å‡†å¤‡å°±ç»ªæ—¶è§¦å‘ã€‚</p>
</li>
<li>
<p><code>onUpdate</code>: ç¼–è¾‘å™¨å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘ã€‚</p>
</li>
<li>
<p><code>onSelectionUpdate</code>: ç¼–è¾‘å™¨é€‰åŒºå˜åŒ–æ—¶è§¦å‘ã€‚</p>
</li>
<li>
<p><code>onTransaction</code>: æ¯ä¸€æ¬¡çŠ¶æ€å˜æ›´ï¼ˆTransactionï¼‰å‘ç”Ÿæ—¶è§¦å‘ã€‚è¿™æ˜¯æœ€åº•å±‚çš„å˜åŒ–ç›‘å¬ã€‚</p>
</li>
<li>
<p><code>onFocus</code> / <code>onBlur</code>: ç¼–è¾‘å™¨è·å¾—æˆ–å¤±å»ç„¦ç‚¹æ—¶è§¦å‘ã€‚</p>
</li>
<li>
<p><code>onDestroy</code>: ç¼–è¾‘å™¨å®ä¾‹è¢«é”€æ¯å‰è§¦å‘ï¼Œé€‚åˆç”¨äºæ¸…ç†å·¥ä½œã€‚</p>
</li>
</ul>
<p>é‡è¦é™·é˜±ï¼šç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„æ— é™å¾ªç¯</p>
<p>ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯åœ¨ onUpdate æˆ– onTransaction é’©å­ä¸­ç›´æ¥è°ƒç”¨ editor.commands æ¥ä¿®æ”¹ç¼–è¾‘å™¨çŠ¶æ€ã€‚è¿™ä¼šå¯¼è‡´ä¸€ä¸ªæ–°çš„æ›´æ–°äº‹ä»¶ï¼Œä»è€Œå†æ¬¡è§¦å‘é’©å­ï¼Œå½¢æˆä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæœ€ç»ˆå¯¼è‡´æµè§ˆå™¨å´©æºƒ 8ã€‚</p>
<p><strong>é”™è¯¯çš„åšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onUpdate</span>(<span class="hljs-params">{ editor }</span>) {
  <span class="hljs-comment">// å±é™©ï¼è¿™ä¼šé€ æˆæ— é™å¾ªç¯ï¼</span>
  editor.<span class="hljs-property">commands</span>.<span class="hljs-title function_">setNode</span>(<span class="hljs-string">'paragraph'</span>);
}
</code></pre>
<p>æ­£ç¡®çš„åšæ³•ï¼šåœ¨äº‹åŠ¡ï¼ˆTransactionï¼‰å±‚é¢æ€è€ƒ</p>
<p>è¿™äº›é’©å­é€šå¸¸ä¼šæä¾›ä¸€ä¸ª transaction å¯¹è±¡ï¼ˆç®€å†™ä¸º trï¼‰ã€‚å¦‚æœä½ ç¡®å®éœ€è¦åœ¨è¿™äº›é’©å­ä¸­ä¿®æ”¹çŠ¶æ€ï¼Œä½ åº”è¯¥ç›´æ¥æ“ä½œè¿™ä¸ª tr å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ´¾å‘ä¸€ä¸ªæ–°çš„å‘½ä»¤ã€‚ProseMirror ä¼šå°†è¿™äº›ä¿®æ”¹åˆå¹¶åˆ°å½“å‰çš„äº‹åŠ¡ä¸­ï¼Œä»è€Œé¿å…äº†å¾ªç¯ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onTransaction</span>(<span class="hljs-params">{ transaction }</span>) {
  <span class="hljs-keyword">if</span> (someCondition) {
    <span class="hljs-comment">// å®‰å…¨çš„åšæ³•ï¼šç›´æ¥ä¿®æ”¹å½“å‰äº‹åŠ¡</span>
    transaction.<span class="hljs-title function_">setNodeMarkup</span>(...);
  }
}
</code></pre>
<p>è™½ç„¶ç›´æ¥æ“ä½œ <code>tr</code> å±äºæ›´é«˜çº§çš„ ProseMirror APIï¼Œä½†ç†è§£è¿™ä¸ªåŸåˆ™è‡³å…³é‡è¦ï¼š<strong>ç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯ç”¨äºâ€œå“åº”â€å˜åŒ–çš„ï¼Œè€Œä¸æ˜¯â€œåˆ›é€ â€æ–°çš„å˜åŒ–</strong>ã€‚</p>
<p>ä¸ºäº†å¸®åŠ©ä½ å¿«é€ŸæŸ¥é˜…è¿™äº›é«˜çº§ APIï¼Œä¸‹è¡¨æ€»ç»“äº†å®ƒä»¬çš„æ ¸å¿ƒç”¨é€”ï¼š</p>













































<table><thead><tr><th>æ–¹æ³• (Method)</th><th>ç›®çš„ (Purpose)</th><th>ç”¨ä¾‹ (Use Case Example)</th></tr></thead><tbody><tr><td><code>addCommands</code></td><td>å®šä¹‰æ‰©å±•çš„ç¼–ç¨‹æ¥å£ï¼Œä¾› UI æˆ–å…¶ä»–é€»è¾‘è°ƒç”¨ã€‚</td><td><code>toggleHighlight()</code> å‘½ä»¤ç”¨äºåˆ‡æ¢é«˜äº®ã€‚</td></tr><tr><td><code>addKeyboardShortcuts</code></td><td>ç»‘å®šé”®ç›˜å¿«æ·é”®åˆ°ç‰¹å®šå‘½ä»¤ã€‚</td><td><code>Mod-B</code> ç»‘å®šåˆ° <code>toggleBold()</code> å‘½ä»¤ã€‚</td></tr><tr><td><code>addInputRules</code></td><td>æ ¹æ®ç”¨æˆ·è¾“å…¥å®æ—¶è½¬æ¢æ–‡æœ¬ï¼ˆMarkdown è¯­æ³•ï¼‰ã€‚</td><td>è¾“å…¥ <code>*</code> è‡ªåŠ¨åˆ›å»ºæ— åºåˆ—è¡¨ã€‚</td></tr><tr><td><code>addPasteRules</code></td><td>æ ¹æ®ç²˜è´´çš„å†…å®¹è‡ªåŠ¨è½¬æ¢æ–‡æœ¬ã€‚</td><td>ç²˜è´´ <code>(url)</code> è‡ªåŠ¨åˆ›å»ºé“¾æ¥ã€‚</td></tr><tr><td><code>addStorage</code></td><td>ç®¡ç†æ‰©å±•çš„ã€éæŒä¹…åŒ–çš„ã€è¿è¡Œæ—¶çš„å†…éƒ¨çŠ¶æ€ã€‚</td><td>å­˜å‚¨ä¸€ä¸ª debounce å‡½æ•°æˆ–ç”¨äºåˆ†æçš„è®¡æ•°å™¨ã€‚</td></tr><tr><td><code>addNodeView</code></td><td>(é«˜çº§) ä½¿ç”¨æ¡†æ¶ç»„ä»¶ï¼ˆå¦‚ React/Vueï¼‰å®Œå…¨è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ¸²æŸ“å’Œäº¤äº’ã€‚</td><td>åˆ›å»ºä¸€ä¸ªå¸¦å¯ç¼–è¾‘æ ‡é¢˜å’Œäº¤äº’æŒ‰é’®çš„è§†é¢‘åµŒå…¥èŠ‚ç‚¹ã€‚</td></tr><tr><td><code>addProseMirrorPlugins</code></td><td>(æœ€é«˜çº§) æ³¨å…¥åº•å±‚çš„ ProseMirror æ’ä»¶ï¼Œä»¥è·å¾—å¯¹ç¼–è¾‘å™¨è¡Œä¸ºçš„å®Œå…¨æ§åˆ¶ã€‚</td><td>å®ç°æåŠï¼ˆMentionï¼‰åŠŸèƒ½çš„å»ºè®®å¼¹å‡ºæ¡†ã€‚</td></tr></tbody></table>
<p>æŒæ¡äº†è¿™äº›â€œè¶…èƒ½åŠ›â€ï¼Œä½ å°±æ‹¥æœ‰äº†æ„å»ºå‡ ä¹ä»»ä½•å¤æ‚äº¤äº’çš„å·¥å…·ã€‚å®ƒä»¬æ˜¯ Tiptap ä¾¿æ· API å’Œåº•å±‚ ProseMirror å¼ºå¤§åŠŸèƒ½ä¹‹é—´çš„æ¡¥æ¢ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æŠŠæ‰€æœ‰è¿™äº›èƒ½åŠ›é›†äºä¸€èº«ï¼ŒæŒ‘æˆ˜ä¸€ä¸ªç»ˆææ¡ˆä¾‹ã€‚</p>
<h2 data-id="heading-34">ç¬¬äº”èŠ‚ï¼šç»ˆææ¡ˆä¾‹ç ”ç©¶ï¼šæ„å»ºä¸€ä¸ªäº¤äº’å¼æåŠï¼ˆMentionï¼‰æ‰©å±•</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¸ä¸Šæœ¬æ¬¡æ•™ç¨‹çš„é¡¶å³°ã€‚æˆ‘ä»¬å°†ç»¼åˆè¿ç”¨å‰é¢æ‰€æœ‰ç« èŠ‚å­¦åˆ°çš„çŸ¥è¯†â€”â€”<code>Node</code> å®šä¹‰ã€å±æ€§ã€å‘½ä»¤ã€<code>Node View</code> å’Œ <code>ProseMirror</code> æ’ä»¶â€”â€”æ¥æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€é«˜åº¦äº¤äº’ã€ç”Ÿäº§çº§åˆ«çš„ <code>@mention</code>ï¼ˆæåŠæˆ–æ ‡ç­¾ï¼‰æ‰©å±•ã€‚</p>
<p>è¿™ä¸ªæ¡ˆä¾‹ä¹‹æ‰€ä»¥æ˜¯â€œç»ˆæâ€ï¼Œå› ä¸ºå®ƒå®Œç¾åœ°å±•ç¤ºäº†æ„å»ºå¤æ‚ Tiptap æ‰©å±•æ‰€éœ€çš„ä¸‰ä½ä¸€ä½“æ¶æ„ï¼š</p>
<ol>
<li>
<p><strong>æ•°æ®æ¨¡å‹ (<code>Node</code>)</strong>ï¼šå®šä¹‰â€œæåŠâ€åœ¨æ–‡æ¡£ä¸­å¦‚ä½•å­˜å‚¨ã€‚</p>
</li>
<li>
<p><strong>è§†å›¾æ¸²æŸ“ (<code>Node View</code>)</strong>ï¼šå®šä¹‰â€œæåŠâ€åœ¨ç¼–è¾‘å™¨ä¸­å¦‚ä½•æ˜¾ç¤ºä¸ºä¸€ä¸ªæ¼‚äº®çš„ã€ä¸å¯ç¼–è¾‘çš„â€œèƒ¶å›Šâ€UIã€‚</p>
</li>
<li>
<p><strong>äº¤äº’é€»è¾‘ (<code>ProseMirror Plugin</code>)</strong>ï¼šå®šä¹‰å½“ç”¨æˆ·è¾“å…¥ <code>@</code> æ—¶ï¼Œå¦‚ä½•è§¦å‘ã€æ˜¾ç¤ºå’Œå¤„ç†å»ºè®®åˆ—è¡¨çš„å¼¹å‡ºæ¡†ã€‚</p>
</li>
</ol>
<h3 data-id="heading-35">æ­¥éª¤ä¸€ï¼šæ¶æ„è®¾è®¡</h3>
<p>åœ¨åŠ¨æ‰‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè§„åˆ’å¥½æ¶æ„ã€‚æˆ‘ä»¬çš„ <code>Mention</code> æ‰©å±•å°†ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li>
<p><strong><code>Mention.js</code></strong>: è¿™æ˜¯æ‰©å±•çš„ä¸»æ–‡ä»¶ï¼Œå®ƒå°†ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>Node.create</code> å®šä¹‰ <code>mention</code> èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>addNodeView</code> å°†èŠ‚ç‚¹çš„æ¸²æŸ“å§”æ‰˜ç»™ä¸€ä¸ª React (æˆ– Vue) ç»„ä»¶ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>addProseMirrorPlugins</code> æ³¨å…¥ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶æ¥å¤„ç†å»ºè®®å¼¹å‡ºæ¡†çš„é€»è¾‘ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong><code>MentionComponent.jsx</code></strong>: ä¸€ä¸ª React ç»„ä»¶ï¼Œè´Ÿè´£æ¸²æŸ“â€œæåŠèƒ¶å›Šâ€çš„ UIã€‚</p>
</li>
<li>
<p><strong><code>suggestion.js</code></strong>: ä¸€ä¸ªè¾…åŠ©æ–‡ä»¶ï¼ŒåŒ…å«åˆ›å»ºå’Œç®¡ç†å»ºè®®å¼¹å‡ºæ¡†ï¼ˆæˆ‘ä»¬å°†ä½¿ç”¨(<a href="https://link.juejin.cn?target=https%3A%2F%2Fatomiks.github.io%2Ftippyjs%2F" target="_blank" title="https://atomiks.github.io/tippyjs/" ref="nofollow noopener noreferrer">atomiks.github.io/tippyjs/</a>) åº“ï¼‰çš„ ProseMirror æ’ä»¶é€»è¾‘ã€‚</p>
</li>
</ol>
<h3 data-id="heading-36">æ­¥éª¤äºŒï¼šæ„å»º <code>Mention</code> èŠ‚ç‚¹ï¼ˆæ•°æ®æ¨¡å‹ï¼‰</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å®šä¹‰ <code>mention</code> èŠ‚ç‚¹æœ¬èº«ã€‚å®ƒæ˜¯ä¸€ä¸ªè¡Œå†…ï¼ˆ<code>inline</code>ï¼‰èŠ‚ç‚¹ï¼Œç”¨äºåœ¨æ–‡æœ¬æµä¸­è¡¨ç¤ºä¸€ä¸ªæåŠã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Mention.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Node</span>, mergeAttributes } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Mention</span> = <span class="hljs-title class_">Node</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'mention'</span>,
  <span class="hljs-attr">group</span>: <span class="hljs-string">'inline'</span>,
  <span class="hljs-attr">inline</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">selectable</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">atom</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å…³é”®ï¼</span>

  <span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">id</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">parseHTML</span>: <span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-id'</span>),
        <span class="hljs-attr">renderHTML</span>: <span class="hljs-function"><span class="hljs-params">attributes</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (!attributes.<span class="hljs-property">id</span>) {
            <span class="hljs-keyword">return</span> {};
          }
          <span class="hljs-keyword">return</span> { <span class="hljs-string">'data-id'</span>: attributes.<span class="hljs-property">id</span> };
        },
      },
      <span class="hljs-attr">label</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">parseHTML</span>: <span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-label'</span>),
        <span class="hljs-attr">renderHTML</span>: <span class="hljs-function"><span class="hljs-params">attributes</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (!attributes.<span class="hljs-property">label</span>) {
            <span class="hljs-keyword">return</span> {};
          }
          <span class="hljs-keyword">return</span> { <span class="hljs-string">'data-label'</span>: attributes.<span class="hljs-property">label</span> };
        },
      },
    };
  },

  <span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [{ <span class="hljs-attr">tag</span>: <span class="hljs-string">'span[data-type="mention"]'</span> }];
  },

  <span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ node, HTMLAttributes }</span>) {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-string">'span'</span>,
      <span class="hljs-title function_">mergeAttributes</span>({ <span class="hljs-string">'data-type'</span>: <span class="hljs-string">'mention'</span> }, <span class="hljs-title class_">HTMLAttributes</span>),
      <span class="hljs-string">`@<span class="hljs-subst">${node.attrs.label}</span>`</span>
    ];
  },

  <span class="hljs-comment">//... addNodeView å’Œ addProseMirrorPlugins å°†åœ¨è¿™é‡Œæ·»åŠ </span>
});
</code></pre>
<p>è¿™é‡Œçš„å…³é”®æ˜¯ <code>atom: true</code>ã€‚è¿™ä¸ªå±æ€§å‘Šè¯‰ ProseMirrorï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„â€œåŸå­â€å•å…ƒã€‚ç”¨æˆ·ä¸èƒ½å°†å…‰æ ‡ç§»åŠ¨åˆ°å®ƒçš„å†…éƒ¨ï¼Œä¹Ÿä¸èƒ½ç¼–è¾‘å®ƒçš„å†…å®¹ã€‚ProseMirror ä¼šå°†æ•´ä¸ªèŠ‚ç‚¹çš„ç®¡ç†æƒå®Œå…¨äº¤ç»™æˆ‘ä»¬çš„ <code>Node View</code> 5ã€‚</p>
<p><code>addAttributes</code> å®šä¹‰äº†æˆ‘ä»¬éœ€è¦å­˜å‚¨çš„æ•°æ®ï¼šè¢«æåŠç”¨æˆ·çš„å”¯ä¸€ <code>id</code> å’Œæ˜¾ç¤ºçš„ <code>label</code>ã€‚<code>renderHTML</code> æä¾›äº†ä¸€ä¸ªç®€å•çš„åå¤‡æ–¹æ¡ˆï¼Œç”¨äºåœ¨ä¸æ”¯æŒ JavaScript çš„ç¯å¢ƒä¸­ï¼ˆå¦‚å‘é€é‚®ä»¶ï¼‰ä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤ºæåŠå†…å®¹ã€‚</p>
<h3 data-id="heading-37">æ­¥éª¤ä¸‰ï¼šä½¿ç”¨ <code>addNodeView</code> è¿›è¡Œè‡ªå®šä¹‰æ¸²æŸ“ï¼ˆè§†å›¾æ¸²æŸ“ï¼‰</h3>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç”¨ä¸€ä¸ªäº¤äº’å¼çš„ React ç»„ä»¶æ¥å–ä»£ <code>renderHTML</code> çš„é™æ€æ¸²æŸ“ã€‚è¿™å°±æ˜¯ <code>addNodeView</code> çš„ç”¨æ­¦ä¹‹åœ° 5ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Mention.js çš„ Node.create({}) å†…éƒ¨æ·»åŠ </span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ReactNodeViewRenderer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MentionComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MentionComponent.jsx'</span>;

<span class="hljs-comment">//...</span>
<span class="hljs-title function_">addNodeView</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactNodeViewRenderer</span>(<span class="hljs-title class_">MentionComponent</span>);
},
</code></pre>
<p><code>addNodeView</code> è¿”å›ä¸€ä¸ª <code>ReactNodeViewRenderer</code>ï¼ˆæˆ– <code>VueNodeViewRenderer</code>ï¼‰ï¼Œå®ƒå°†æˆ‘ä»¬çš„ <code>MentionComponent</code> ç»„ä»¶ä¸ <code>mention</code> èŠ‚ç‚¹ç»‘å®šèµ·æ¥ 5ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ›å»º <code>MentionComponent.jsx</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// MentionComponent.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeViewWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (props) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">NodeViewWrapper</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"span"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mention"</span>&gt;</span>
      @{props.node.attrs.label}
    <span class="hljs-tag">&lt;/<span class="hljs-name">NodeViewWrapper</span>&gt;</span></span>
  );
};
</code></pre>
<p>è¿™ä¸ªç»„ä»¶éå¸¸ç®€å•ã€‚å®ƒä½¿ç”¨äº† Tiptap æä¾›çš„ <code>NodeViewWrapper</code>ï¼Œå®ƒä¼šæ¸²æŸ“ä¸€ä¸ªå®¹å™¨å…ƒç´ ï¼ˆæˆ‘ä»¬æŒ‡å®šä¸º <code>&lt;span&gt;</code>ï¼‰ï¼Œå¹¶å¤„ç†å¥½æ‰€æœ‰ ProseMirror éœ€è¦çš„ DOM å±æ€§å’Œäº‹ä»¶ 5ã€‚ç»„ä»¶é€šè¿‡</p>
<p><code>props.node.attrs</code> å¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬åœ¨ <code>addAttributes</code> ä¸­å®šä¹‰çš„ <code>id</code> å’Œ <code>label</code>ï¼Œä»è€Œæ¸²æŸ“å‡ºæˆ‘ä»¬æƒ³è¦çš„â€œèƒ¶å›Šâ€UIã€‚ä½ å¯ä»¥éšæ„ä¸º <code>.mention</code> ç±»æ·»åŠ  CSS æ ·å¼ã€‚</p>
<h3 data-id="heading-38">æ­¥éª¤å››ï¼šä½¿ç”¨ <code>addProseMirrorPlugins</code> å®ç°å»ºè®®å¼•æ“ï¼ˆäº¤äº’é€»è¾‘ï¼‰</h3>
<p>è¿™æ˜¯æœ€æ ¸å¿ƒã€æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚å½“ç”¨æˆ·è¾“å…¥ <code>@</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼¹å‡ºæ¡†æ¥æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ã€‚Tiptap çš„æ ‡å‡† API æ— æ³•ç›´æ¥å®ç°è¿™ç§å¤æ‚çš„ã€ä¸ UI ç´§å¯†è€¦åˆçš„äº¤äº’ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æ·±å…¥åº•å±‚ï¼Œç¼–å†™ä¸€ä¸ª ProseMirror æ’ä»¶ 8ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªé«˜åº¦ç®€åŒ–çš„å®ç°æ€è·¯ï¼Œå®Œæ•´çš„ä»£ç ä¼šæ›´é•¿ï¼Œä½†æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// suggestion.js (è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„é€»è¾‘æ¦‚è§ˆ)</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Plugin</span>, <span class="hljs-title class_">PluginKey</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prosemirror-state'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Decoration</span>, <span class="hljs-title class_">DecorationSet</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prosemirror-view'</span>;
<span class="hljs-keyword">import</span> tippy <span class="hljs-keyword">from</span> <span class="hljs-string">'tippy.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">suggestionPlugin</span> = (<span class="hljs-params">options</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Plugin</span>({
    <span class="hljs-attr">key</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginKey</span>(<span class="hljs-string">'mention_suggestion'</span>),

    <span class="hljs-attr">state</span>: {
      <span class="hljs-attr">init</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">range</span>: {}, <span class="hljs-attr">query</span>: <span class="hljs-string">''</span> }),
      <span class="hljs-attr">apply</span>: <span class="hljs-function">(<span class="hljs-params">tr, value</span>) =&gt;</span> {
        <span class="hljs-comment">//... åœ¨æ¯æ¬¡äº‹åŠ¡ä¸­ï¼Œæ£€æŸ¥å…‰æ ‡å‰çš„æ–‡æœ¬æ˜¯å¦åŒ¹é…è§¦å‘ç¬¦ï¼Œå¦‚ /@(\w*)$/</span>
        <span class="hljs-comment">// å¦‚æœåŒ¹é…ï¼Œæ›´æ–°æ’ä»¶çŠ¶æ€ï¼Œè®°å½• active=true, range å’Œ query</span>
        <span class="hljs-comment">// å¦‚æœä¸åŒ¹é…ï¼Œé‡ç½®çŠ¶æ€</span>
        <span class="hljs-keyword">return</span> newValue;
      },
    },

    <span class="hljs-attr">view</span>: <span class="hljs-function">(<span class="hljs-params">editorView</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> popup;

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">update</span>: <span class="hljs-function">(<span class="hljs-params">view, prevState</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> currentState = <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>.<span class="hljs-title function_">getState</span>(view.<span class="hljs-property">state</span>);
          <span class="hljs-keyword">const</span> previousState = <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>.<span class="hljs-title function_">getState</span>(prevState);

          <span class="hljs-comment">// å¦‚æœçŠ¶æ€ä» inactive å˜ä¸º activeï¼Œåˆ›å»ºå¹¶æ˜¾ç¤º tippy å¼¹å‡ºæ¡†</span>
          <span class="hljs-keyword">if</span> (currentState.<span class="hljs-property">active</span> &amp;&amp;!previousState.<span class="hljs-property">active</span>) {
            <span class="hljs-comment">// popup = tippy('body', {...é…ç½®... });</span>
            <span class="hljs-comment">// åœ¨å¼¹å‡ºæ¡†ä¸­æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨ï¼Œåˆ—è¡¨æ•°æ®å¯ä»¥æ ¹æ® currentState.query è¿‡æ»¤</span>
          }

          <span class="hljs-comment">// å¦‚æœçŠ¶æ€ä» active å˜ä¸º inactiveï¼Œé”€æ¯å¼¹å‡ºæ¡†</span>
          <span class="hljs-keyword">if</span> (!currentState.<span class="hljs-property">active</span> &amp;&amp; previousState.<span class="hljs-property">active</span>) {
            <span class="hljs-comment">// popup.destroy();</span>
          }
        },
        <span class="hljs-attr">destroy</span>: <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// popup?.destroy();</span>
        },
      };
    },
  });
};
</code></pre>
<p>è¿™ä¸ªæ’ä»¶çš„æ ¸å¿ƒå·¥ä½œæµç¨‹æ˜¯ï¼š</p>
<ol>
<li>
<p><strong><code>state.apply</code></strong>: åœ¨æ¯æ¬¡ç¼–è¾‘å™¨çŠ¶æ€æ›´æ–°æ—¶ï¼Œæ£€æŸ¥å…‰æ ‡å‰çš„æ–‡æœ¬ã€‚å¦‚æœåŒ¹é… <code>@</code> è§¦å‘ç¬¦ï¼Œå°±æ›´æ–°æ’ä»¶è‡ªå·±çš„å†…éƒ¨çŠ¶æ€ï¼Œè®°å½•ä¸‹è§¦å‘çš„ä½ç½®ï¼ˆ<code>range</code>ï¼‰å’ŒæŸ¥è¯¢è¯ï¼ˆ<code>query</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>view.update</code></strong>: ç›‘å¬æ’ä»¶çŠ¶æ€çš„å˜åŒ–ã€‚å½“çŠ¶æ€å˜ä¸ºâ€œæ¿€æ´»â€æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª Tippy.js å¼¹å‡ºæ¡†ï¼Œå¹¶æ ¹æ®æŸ¥è¯¢è¯æ¸²æŸ“å»ºè®®åˆ—è¡¨ã€‚å½“çŠ¶æ€å˜ä¸ºâ€œéæ¿€æ´»â€æ—¶ï¼Œå®ƒä¼šé”€æ¯å¼¹å‡ºæ¡†ã€‚</p>
</li>
<li>
<p><strong>å‘½ä»¤äº¤äº’</strong>: åœ¨å»ºè®®åˆ—è¡¨çš„ UI ä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æˆ–å›è½¦é€‰æ‹©ä¸€ä¸ªç”¨æˆ·æ—¶ï¼ŒUI ç»„ä»¶ä¼šè°ƒç”¨ä¸€ä¸ª Tiptap å‘½ä»¤ï¼Œä¾‹å¦‚ <code>editor.commands.insertContent(...)</code>ï¼Œç”¨ä¸€ä¸ªå®Œæ•´çš„ <code>mention</code> èŠ‚ç‚¹æ›¿æ¢æ‰è§¦å‘æ–‡æœ¬ï¼ˆå¦‚ <code>@john</code>ï¼‰ã€‚</p>
</li>
</ol>
<p>æœ€åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ’ä»¶é›†æˆåˆ°æˆ‘ä»¬çš„ <code>Mention.js</code> æ‰©å±•ä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ Mention.js çš„ Node.create({}) å†…éƒ¨æ·»åŠ </span>
<span class="hljs-keyword">import</span> { suggestionPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./suggestion.js'</span>;

<span class="hljs-comment">//...</span>
<span class="hljs-title function_">addProseMirrorPlugins</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    <span class="hljs-title function_">suggestionPlugin</span>({
      <span class="hljs-attr">editor</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">editor</span>,
      <span class="hljs-comment">//... å…¶ä»–é…ç½®ï¼Œå¦‚è·å–ç”¨æˆ·åˆ—è¡¨çš„å‡½æ•°</span>
    }),
  ];
},
</code></pre>
<h3 data-id="heading-39">æ­¥éª¤äº”ï¼šæœ€ç»ˆé›†æˆ</h3>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»å°†æ•°æ®æ¨¡å‹ï¼ˆ<code>Node</code>ï¼‰ã€è§†å›¾æ¸²æŸ“ï¼ˆ<code>Node View</code>ï¼‰å’Œäº¤äº’é€»è¾‘ï¼ˆ<code>Plugin</code>ï¼‰è¿™ä¸‰ä¸ªéƒ¨åˆ†å®Œç¾åœ°ç»“åˆåœ¨äº†ä¸€ä¸ªå•ä¸€çš„ <code>Mention.js</code> æ‰©å±•æ–‡ä»¶ä¸­ã€‚å¼€å‘è€…åœ¨ä½¿ç”¨æ—¶ï¼Œåªéœ€åƒæ³¨å†Œä»»ä½•å…¶ä»–æ‰©å±•ä¸€æ ·ï¼Œå°† <code>Mention</code> æ·»åŠ åˆ°ç¼–è¾‘å™¨çš„ <code>extensions</code> æ•°ç»„ä¸­ï¼Œä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æåŠç³»ç»Ÿå°±æ­¤è¯ç”Ÿã€‚</p>
<p>è¿™ä¸ªæ¡ˆä¾‹å……åˆ†è¯æ˜äº† Tiptap çš„åˆ†å±‚è®¾è®¡æ€æƒ³ã€‚å¯¹äºç®€å•çš„éœ€æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨é«˜å±‚ APIï¼›è€Œå¯¹äºåƒå»ºè®®å¼¹å‡ºæ¡†è¿™æ ·å¤æ‚çš„äº¤äº’ï¼ŒTiptap ä¹Ÿä¸ºä½ ä¿ç•™äº†é€šå¾€åº•å±‚ ProseMirror çš„é€šé“ï¼Œè®©ä½ æ‹¥æœ‰å®ç°ä»»ä½•åŠŸèƒ½çš„ç»ˆæè‡ªç”±ã€‚</p>
<blockquote>
<p>ğŸ’¡ <strong>å®Œæ•´ä»£ç è·å–</strong>
Mention æ‰©å±•çš„å®Œæ•´å®ç°ä»£ç è¾ƒé•¿ï¼Œå»ºè®®å‚è€ƒï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftiptap.dev%2Fdocs%2Feditor%2Fextensions%2Fcustom-extensions%2Fextend-existing%23mention" target="_blank" title="https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#mention" ref="nofollow noopener noreferrer">Tiptap å®˜æ–¹ Mention ç¤ºä¾‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fatomiks.github.io%2Ftippyjs%2F" target="_blank" title="https://atomiks.github.io/tippyjs/" ref="nofollow noopener noreferrer">Tippy.js å®‰è£…æ–‡æ¡£</a></li>
</ul>
</blockquote>
<h2 data-id="heading-40">ç¬¬å…­èŠ‚ï¼šâš ï¸ å¸¸è§é™·é˜±ä¸è°ƒè¯•æŠ€å·§</h2>
<p>åœ¨å¼€å‘è‡ªå®šä¹‰æ‰©å±•çš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å¸¸è§çš„é—®é¢˜ã€‚æœ¬èŠ‚å°†å¸®åŠ©ä½ å¿«é€Ÿè¯†åˆ«å’Œè§£å†³è¿™äº›é™·é˜±ã€‚</p>
<h3 data-id="heading-41">é™·é˜± 1ï¼šç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„æ— é™å¾ªç¯</h3>
<p><strong>é—®é¢˜ç°è±¡</strong>ï¼š
æµè§ˆå™¨å¡æ­»ã€å†…å­˜å ç”¨é£™å‡ã€æ§åˆ¶å°å¤§é‡é‡å¤æ—¥å¿—</p>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ å±é™©ï¼ä¼šé€ æˆæ— é™å¾ªç¯</span>
<span class="hljs-title function_">onUpdate</span>(<span class="hljs-params">{ editor }</span>) {
  editor.<span class="hljs-property">commands</span>.<span class="hljs-title function_">setNode</span>(<span class="hljs-string">'paragraph'</span>);  <span class="hljs-comment">// è¿™ä¼šè§¦å‘æ–°çš„ update</span>
}

<span class="hljs-title function_">onTransaction</span>(<span class="hljs-params">{ transaction }</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">editor</span>.<span class="hljs-property">commands</span>.<span class="hljs-title function_">insertContent</span>(<span class="hljs-string">'text'</span>);  <span class="hljs-comment">// åŒæ ·ä¼šæ— é™å¾ªç¯</span>
}
</code></pre>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… åœ¨äº‹åŠ¡å±‚é¢æ€è€ƒï¼Œç›´æ¥ä¿®æ”¹å½“å‰äº‹åŠ¡</span>
<span class="hljs-title function_">onTransaction</span>(<span class="hljs-params">{ transaction }</span>) {
  <span class="hljs-keyword">if</span> (someCondition) {
    <span class="hljs-comment">// ç›´æ¥ä¿®æ”¹å½“å‰äº‹åŠ¡ï¼Œä¸æ´¾å‘æ–°å‘½ä»¤</span>
    transaction.<span class="hljs-title function_">setNodeMarkup</span>(pos, type, attrs);
  }
}

<span class="hljs-comment">// âœ… æˆ–è€…æ·»åŠ æ¡ä»¶æ£€æŸ¥é¿å…é‡å¤è§¦å‘</span>
<span class="hljs-title function_">onUpdate</span>(<span class="hljs-params">{ editor }</span>) {
  <span class="hljs-keyword">if</span> (!editor.<span class="hljs-title function_">isActive</span>(<span class="hljs-string">'paragraph'</span>)) {
    editor.<span class="hljs-property">commands</span>.<span class="hljs-title function_">setParagraph</span>();
  }
}
</code></pre>
<blockquote>
<p>âš ï¸ <strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šç”Ÿå‘½å‘¨æœŸé’©å­ç”¨äº"å“åº”"å˜åŒ–ï¼Œä¸æ˜¯"åˆ›é€ "æ–°å˜åŒ–</p>
</blockquote>
<h3 data-id="heading-42">é™·é˜± 2ï¼šå±æ€§åºåˆ—åŒ–ä¸¢å¤±</h3>
<p><strong>é—®é¢˜ç°è±¡</strong>ï¼š
æ‰©å±•çš„è‡ªå®šä¹‰å±æ€§åœ¨ä¿å­˜/åŠ è½½åä¸¢å¤±</p>
<p><strong>å¸¸è§åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ åªå®šä¹‰äº† addAttributesï¼Œä½†æ²¡æœ‰é…ç½® parseHTML å’Œ renderHTML</span>
<span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">customData</span>: {
      <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span>,
    },
  };
},

<span class="hljs-comment">// ç¼ºå°‘è¿™ä¸¤ä¸ªå…³é”®æ–¹æ³•å¯¼è‡´å±æ€§æ— æ³•åºåˆ—åŒ–</span>
<span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) { ... }
<span class="hljs-title function_">renderHTML</span>(<span class="hljs-params"/>) { ... }
</code></pre>
<p><strong>å®Œæ•´è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… å®Œæ•´çš„å±æ€§é—­ç¯ï¼šå®šä¹‰ â†’ æ¸²æŸ“ â†’ è§£æ</span>
<span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">customData</span>: {
      <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-comment">// 2. è§£æï¼šä» HTML è¯»å–</span>
      <span class="hljs-attr">parseHTML</span>: <span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-custom'</span>),
      <span class="hljs-comment">// 3. æ¸²æŸ“ï¼šå†™å…¥ HTML</span>
      <span class="hljs-attr">renderHTML</span>: <span class="hljs-function"><span class="hljs-params">attributes</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!attributes.<span class="hljs-property">customData</span>) <span class="hljs-keyword">return</span> {};
        <span class="hljs-keyword">return</span> { <span class="hljs-string">'data-custom'</span>: attributes.<span class="hljs-property">customData</span> };
      },
    },
  };
},
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è®°å¿†å£è¯€</strong>ï¼šå±æ€§ä¸‰æ­¥èµ° - å®šä¹‰ã€æ¸²æŸ“ã€è§£æï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘</p>
</blockquote>
<h3 data-id="heading-43">é™·é˜± 3ï¼šSchema å†²çªå¯¼è‡´çš„æ¸²æŸ“é”™è¯¯</h3>
<p><strong>é—®é¢˜ç°è±¡</strong>ï¼š</p>
<ul>
<li>å†…å®¹æ˜¾ç¤ºä¸æ­£ç¡®</li>
<li>æŸäº›èŠ‚ç‚¹æ— æ³•åˆ›å»º</li>
<li>æ§åˆ¶å°æŠ¥ Schema ç›¸å…³é”™è¯¯</li>
</ul>
<p><strong>å¸¸è§åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ content è¡¨è¾¾å¼ä¸å®é™…å†…å®¹ä¸åŒ¹é…</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CustomBlock</span> = <span class="hljs-title class_">Node</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'customBlock'</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">'paragraph+'</span>,  <span class="hljs-comment">// è¦æ±‚è‡³å°‘ä¸€ä¸ªæ®µè½</span>

  <span class="hljs-comment">// ä½† renderHTML å…è®¸ç©ºå†…å®¹</span>
  <span class="hljs-title function_">renderHTML</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'div'</span>, { <span class="hljs-attr">class</span>: <span class="hljs-string">'custom'</span> }, <span class="hljs-number">0</span>];  <span class="hljs-comment">// 0 å…è®¸ä»»æ„å†…å®¹</span>
  },
})
</code></pre>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… ç¡®ä¿ content å®šä¹‰ä¸å®é™…ä½¿ç”¨ä¸€è‡´</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CustomBlock</span> = <span class="hljs-title class_">Node</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'customBlock'</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">'paragraph+'</span>,  <span class="hljs-comment">// æ˜ç¡®è¦æ±‚æ®µè½</span>

  <span class="hljs-comment">// åˆ›å»ºæ—¶æä¾›é»˜è®¤å†…å®¹</span>
  <span class="hljs-title function_">addCommands</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">setCustomBlock</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">insertContent</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>,
          <span class="hljs-attr">content</span>: [
            { <span class="hljs-attr">type</span>: <span class="hljs-string">'paragraph'</span>, <span class="hljs-attr">content</span>: [] }  <span class="hljs-comment">// æä¾›é»˜è®¤æ®µè½</span>
          ],
        });
      },
    };
  },
})
</code></pre>
<h3 data-id="heading-44">é™·é˜± 4ï¼šå‘½ä»¤æ‰§è¡Œé¡ºåºæ··ä¹±</h3>
<p><strong>é—®é¢˜ç°è±¡</strong>ï¼š
é“¾å¼å‘½ä»¤ä¸æŒ‰é¢„æœŸæ‰§è¡Œ</p>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ focus() åº”è¯¥åœ¨å…¶ä»–å‘½ä»¤ä¹‹å‰</span>
editor.<span class="hljs-title function_">chain</span>().<span class="hljs-title function_">toggleBold</span>().<span class="hljs-title function_">focus</span>().<span class="hljs-title function_">run</span>();
</code></pre>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… focus() æ”¾åœ¨é“¾çš„å¼€å¤´</span>
editor.<span class="hljs-title function_">chain</span>().<span class="hljs-title function_">focus</span>().<span class="hljs-title function_">toggleBold</span>().<span class="hljs-title function_">run</span>();

<span class="hljs-comment">// âœ… æˆ–è€…åˆ†æ­¥æ‰§è¡Œå…³é”®å‘½ä»¤</span>
editor.<span class="hljs-title function_">chain</span>().<span class="hljs-title function_">focus</span>().<span class="hljs-title function_">run</span>();
editor.<span class="hljs-title function_">chain</span>().<span class="hljs-title function_">toggleBold</span>().<span class="hljs-title function_">run</span>();
</code></pre>
<h3 data-id="heading-45">è°ƒè¯•æŠ€å·§ä¸å·¥å…·</h3>
<h4 data-id="heading-46">1. ä½¿ç”¨ ProseMirror DevTools</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Editor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>;

<span class="hljs-keyword">const</span> editor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Editor</span>({
  <span class="hljs-attr">extensions</span>: [<span class="hljs-comment">/* ... */</span>],
  <span class="hljs-comment">// å¼€å¯å¼€å‘è€…æ¨¡å¼</span>
  <span class="hljs-attr">enableDebugMode</span>: <span class="hljs-literal">true</span>,
})

<span class="hljs-comment">// åœ¨æ§åˆ¶å°è®¿é—®ç¼–è¾‘å™¨çŠ¶æ€</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">editor</span> = editor;

<span class="hljs-comment">// æŸ¥çœ‹å½“å‰æ–‡æ¡£ç»“æ„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(editor.<span class="hljs-property">state</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">toJSON</span>());

<span class="hljs-comment">// æŸ¥çœ‹å½“å‰é€‰åŒº</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(editor.<span class="hljs-property">state</span>.<span class="hljs-property">selection</span>);
</code></pre>
<h4 data-id="heading-47">2. ç›‘å¬å…³é”®äº‹ä»¶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">DebugExtension</span> = <span class="hljs-title class_">Extension</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'debugger'</span>,

  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">{ editor }</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ“ ç¼–è¾‘å™¨å·²åˆ›å»º'</span>, editor.<span class="hljs-title function_">getJSON</span>());
  },

  <span class="hljs-title function_">onUpdate</span>(<span class="hljs-params">{ editor, transaction }</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ”„ å†…å®¹æ›´æ–°'</span>, {
      <span class="hljs-attr">docChanged</span>: transaction.<span class="hljs-property">docChanged</span>,
      <span class="hljs-attr">steps</span>: transaction.<span class="hljs-property">steps</span>.<span class="hljs-property">length</span>,
      <span class="hljs-attr">content</span>: editor.<span class="hljs-title function_">getJSON</span>(),
    });
  },

  <span class="hljs-title function_">onSelectionUpdate</span>(<span class="hljs-params">{ editor }</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ‘† é€‰åŒºå˜åŒ–'</span>, editor.<span class="hljs-property">state</span>.<span class="hljs-property">selection</span>.<span class="hljs-title function_">toJSON</span>());
  },

  <span class="hljs-title function_">onTransaction</span>(<span class="hljs-params">{ transaction }</span>) {
    <span class="hljs-keyword">if</span> (transaction.<span class="hljs-property">steps</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'âš™ï¸ äº‹åŠ¡æ­¥éª¤'</span>, transaction.<span class="hljs-property">steps</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-title function_">toJSON</span>()));
    }
  },
})
</code></pre>
<h4 data-id="heading-48">3. éªŒè¯æ‰©å±•å®Œæ•´æ€§æ£€æŸ¥æ¸…å•</h4>
<p>åœ¨å‘å¸ƒè‡ªå®šä¹‰æ‰©å±•å‰ï¼Œä½¿ç”¨æ­¤æ¸…å•éªŒè¯ï¼š</p>
<p>âœ… <strong>åŸºç¡€åŠŸèƒ½</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ‰©å±•åç§°å”¯ä¸€ä¸”è¯­ä¹‰åŒ–</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Schema å®šä¹‰å®Œæ•´ï¼ˆgroupã€contentã€marks ç­‰ï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> parseHTML å’Œ renderHTML é…å¯¹æ­£ç¡®</li>
</ul>
<p>âœ… <strong>å±æ€§ç®¡ç†</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> addAttributes å®šä¹‰å®Œæ•´</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ¯ä¸ªå±æ€§éƒ½æœ‰ parseHTML å’Œ renderHTML</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> é»˜è®¤å€¼è®¾ç½®åˆç†</li>
</ul>
<p>âœ… <strong>å‘½ä»¤ç³»ç»Ÿ</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æä¾›å®Œæ•´çš„å‘½ä»¤é›†ï¼ˆset/toggle/unsetï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> TypeScript å£°æ˜å®Œæ•´</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å‘½ä»¤å¯ä»¥æ­£ç¡®æ‰§è¡Œå’Œæ’¤é”€</li>
</ul>
<p>âœ… <strong>ç”¨æˆ·ä½“éªŒ</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> é”®ç›˜å¿«æ·é”®ä¸å†²çª</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> è¾“å…¥è§„åˆ™ä¸å½±å“æ­£å¸¸è¾“å…¥</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ç²˜è´´è§„åˆ™æ­£ç¡®å¤„ç†å„ç§æ ¼å¼</li>
</ul>
<p>âœ… <strong>æ€§èƒ½ä¸ç¨³å®šæ€§</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ— å†…å­˜æ³„æ¼ï¼ˆæ­£ç¡®æ¸…ç†äº‹ä»¶ç›‘å¬ï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ— æ— é™å¾ªç¯é£é™©</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¤§æ–‡æ¡£ä¸‹æ€§èƒ½å¯æ¥å—</li>
</ul>
<blockquote>
<p>ğŸ” <strong>è°ƒè¯•é»„é‡‘æ³•åˆ™</strong>ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥æ’æŸ¥ã€‚å…ˆéªŒè¯ Schemaï¼Œå†æ£€æŸ¥å±æ€§ï¼Œæœ€åè°ƒè¯•å‘½ä»¤å’Œäº¤äº’ã€‚</p>
</blockquote>
<h2 data-id="heading-49">æœ¬ç« æ ¸å¿ƒæˆå°±</h2>
<p>é€šè¿‡æœ¬ç« æ·±å…¥å­¦ä¹ ï¼Œä½ å·²ç»æŒæ¡äº† Tiptap æ‰©å±•å¼€å‘çš„å®Œæ•´æŠ€èƒ½æ ‘ï¼š</p>








































<table><thead><tr><th>æŠ€èƒ½ç‚¹</th><th>æŒæ¡ç¨‹åº¦</th><th>å®é™…åº”ç”¨</th></tr></thead><tbody><tr><td><strong>æ‰©å±•ç†è®º</strong></td><td>âœ… å®Œæˆ</td><td>ç†è§£ Node/Mark/Extension æœ¬è´¨åŒºåˆ«ä¸ ProseMirror å…³ç³»</td></tr><tr><td><strong>è‡ªå®šä¹‰ Node</strong></td><td>âœ… å®Œæˆ</td><td>åˆ›å»º Callout å—çº§èŠ‚ç‚¹ï¼ŒæŒæ¡æ–‡æ¡£ç»“æ„å®šåˆ¶</td></tr><tr><td><strong>è‡ªå®šä¹‰ Mark</strong></td><td>âœ… å®Œæˆ</td><td>å®ç° ColoredHighlight æ ‡è®°ï¼ŒæŒæ¡æ–‡æœ¬æ ¼å¼æ‰©å±•</td></tr><tr><td><strong>é«˜çº§ API</strong></td><td>âœ… å®Œæˆ</td><td>çµæ´»è¿ç”¨å‘½ä»¤ã€è¾“å…¥è§„åˆ™ã€Storageã€ç”Ÿå‘½å‘¨æœŸé’©å­</td></tr><tr><td><strong>å¤æ‚æ‰©å±•</strong></td><td>âœ… å®Œæˆ</td><td>æ„å»º Mention äº¤äº’ç³»ç»Ÿï¼Œæ•´åˆ NodeView å’Œ Plugin</td></tr><tr><td><strong>é—®é¢˜æ’æŸ¥</strong></td><td>âœ… å®Œæˆ</td><td>è¯†åˆ«å¸¸è§é™·é˜±ï¼ŒæŒæ¡è°ƒè¯•æŠ€å·§å’ŒéªŒè¯æ–¹æ³•</td></tr></tbody></table>
<h2 data-id="heading-50">ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨</h2>
<h3 data-id="heading-51">æ‰©å±•åˆ›å»ºæ¨¡æ¿</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Node åˆ›å»ºæ¨¡æ¿</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CustomNode</span> = <span class="hljs-title class_">Node</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'customNode'</span>,
  <span class="hljs-attr">group</span>: <span class="hljs-string">'block'</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">'paragraph+'</span>,

  <span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">attrName</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">parseHTML</span>: <span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-attr'</span>),
        <span class="hljs-attr">renderHTML</span>: <span class="hljs-function"><span class="hljs-params">attributes</span> =&gt;</span> ({ <span class="hljs-string">'data-attr'</span>: attributes.<span class="hljs-property">attrName</span> }),
      },
    };
  },

  <span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [{ <span class="hljs-attr">tag</span>: <span class="hljs-string">'div[data-type="custom"]'</span> }];
  },

  <span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ HTMLAttributes }</span>) {
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'div'</span>, <span class="hljs-title function_">mergeAttributes</span>(<span class="hljs-title class_">HTMLAttributes</span>, { <span class="hljs-string">'data-type'</span>: <span class="hljs-string">'custom'</span> }), <span class="hljs-number">0</span>];
  },

  <span class="hljs-title function_">addCommands</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">setCustomNode</span>: <span class="hljs-function">(<span class="hljs-params">attributes</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">insertContent</span>({ <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">'paragraph'</span> }] });
      },
    };
  },
})

<span class="hljs-comment">// Mark åˆ›å»ºæ¨¡æ¿</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CustomMark</span> = <span class="hljs-title class_">Mark</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'customMark'</span>,

  <span class="hljs-title function_">addOptions</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-title class_">HTMLAttributes</span>: {},
    };
  },

  <span class="hljs-title function_">addAttributes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">color</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">parseHTML</span>: <span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> element.<span class="hljs-property">style</span>.<span class="hljs-property">color</span>,
        <span class="hljs-attr">renderHTML</span>: <span class="hljs-function"><span class="hljs-params">attributes</span> =&gt;</span> ({ <span class="hljs-attr">style</span>: <span class="hljs-string">`color: <span class="hljs-subst">${attributes.color}</span>`</span> }),
      },
    };
  },

  <span class="hljs-title function_">parseHTML</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [{ <span class="hljs-attr">tag</span>: <span class="hljs-string">'span[data-custom-mark]'</span> }];
  },

  <span class="hljs-title function_">renderHTML</span>(<span class="hljs-params">{ HTMLAttributes }</span>) {
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'span'</span>, <span class="hljs-title function_">mergeAttributes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">HTMLAttributes</span>, <span class="hljs-title class_">HTMLAttributes</span>), <span class="hljs-number">0</span>];
  },

  <span class="hljs-title function_">addCommands</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">setCustomMark</span>: <span class="hljs-function">(<span class="hljs-params">attributes</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">setMark</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, attributes);
      },
      <span class="hljs-attr">toggleCustomMark</span>: <span class="hljs-function">(<span class="hljs-params">attributes</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">toggleMark</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, attributes);
      },
      <span class="hljs-attr">unsetCustomMark</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-function">(<span class="hljs-params">{ commands }</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> commands.<span class="hljs-title function_">unsetMark</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
      },
    };
  },
})
</code></pre>
<h2 data-id="heading-52">ğŸš€ è¿›é˜¶å­¦ä¹ è·¯å¾„</h2>
<p>æŒæ¡äº†æœ¬ç« çŸ¥è¯†åï¼Œä½ å¯ä»¥æ¢ç´¢ä»¥ä¸‹é«˜çº§ä¸»é¢˜ï¼š</p>
<ol>
<li>
<p><strong>NodeView æ·±åº¦å®šåˆ¶</strong></p>
<ul>
<li>ä½¿ç”¨ React/Vue ç»„ä»¶æ¸²æŸ“å¤æ‚èŠ‚ç‚¹</li>
<li>å®ç°æ‹–æ‹½ã€è°ƒæ•´å¤§å°ç­‰é«˜çº§äº¤äº’</li>
<li>æ„å»ºå®Œå…¨è‡ªå®šä¹‰çš„ç¼–è¾‘ä½“éªŒ</li>
</ul>
</li>
<li>
<p><strong>Collaboration ååŒç¼–è¾‘</strong></p>
<ul>
<li>é›†æˆ Y.js å®ç°å®æ—¶åä½œ</li>
<li>å¤„ç†å†²çªè§£å†³å’Œç”¨æˆ·å…‰æ ‡</li>
<li>æ„å»ºç±»ä¼¼ Google Docs çš„ä½“éªŒ</li>
</ul>
</li>
<li>
<p><strong>ProseMirror æ’ä»¶ç³»ç»Ÿ</strong></p>
<ul>
<li>æ·±å…¥ç†è§£ Plugin State</li>
<li>è‡ªå®šä¹‰ DecorationSet å®ç°é«˜äº®</li>
<li>æ„å»ºå¤æ‚çš„ç¼–è¾‘å™¨äº¤äº’é€»è¾‘</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–è¿›é˜¶</strong></p>
<ul>
<li>è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§æ–‡æ¡£</li>
<li>æ‡’åŠ è½½å’ŒæŒ‰éœ€æ¸²æŸ“ç­–ç•¥</li>
<li>èŠ‚æµå’Œé˜²æŠ–ä¼˜åŒ–ç¼–è¾‘å™¨å“åº”</li>
</ul>
</li>
</ol>
<h2 data-id="heading-53">ç»“è®º</h2>
<p>æˆ‘ä»¬å·²ç»èµ°å®Œäº†ä¸€æ®µæ¼«é•¿è€Œæ”¶è·é¢‡ä¸°çš„æ—…ç¨‹ã€‚ä»å‰–æ Tiptap ä¸ ProseMirror çš„åº•å±‚å…³ç³»ï¼Œåˆ°äº²æ‰‹æ„å»ºè‡ªå®šä¹‰çš„ <code>Node</code> å’Œ <code>Mark</code>ï¼›ä»æŒæ¡ <code>addCommands</code>ã€<code>addInputRules</code> ç­‰é«˜çº§ APIï¼Œåˆ°æœ€ç»ˆå°†æ‰€æœ‰çŸ¥è¯†èä¼šè´¯-é€šï¼Œæ„å»ºå‡ºä¸€ä¸ªå¤æ‚çš„ã€ç”Ÿäº§çº§åˆ«çš„ <code>@mention</code> æ‰©å±•ã€‚ä½ ç°åœ¨æ‰€æ‹¥æœ‰çš„ï¼Œå·²ç»ä¸ä»…ä»…æ˜¯ä½¿ç”¨ Tiptap çš„èƒ½åŠ›ï¼Œæ›´æ˜¯åˆ›é€ å’Œæ‰©å±• Tiptap çš„èƒ½åŠ›ã€‚</p>
<p>é€šè¿‡æœ¬æ•™ç¨‹çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æ­ç¤ºäº†å‡ ä¸ªå…³é”®çš„ã€è¶…è¶Šä»£ç æœ¬èº«çš„è®¾è®¡æ€æƒ³ï¼š</p>
<ul>
<li>
<p><strong>Tiptap çš„æ¸è¿›å¼æŠ«éœ²</strong>ï¼šå®ƒå…è®¸å¼€å‘è€…ä»ç®€å•çš„é«˜å±‚ API å…¥æ‰‹ï¼Œåœ¨éœ€è¦æ—¶é€æ­¥æ·±å…¥åˆ°åº•å±‚ ProseMirrorï¼Œå®ç°äº†æ˜“ç”¨æ€§ä¸å¼ºå¤§åŠŸèƒ½ä¹‹é—´çš„å®Œç¾å¹³è¡¡ã€‚</p>
</li>
<li>
<p><strong>Schema ä¸ºç‹</strong>ï¼šæˆ‘ä»¬è®¤è¯†åˆ°ï¼Œåˆ›å»º <code>Node</code> å’Œ <code>Mark</code> çš„æœ¬è´¨æ˜¯è®¾è®¡æ–‡æ¡£çš„â€œè¯­æ³•â€ï¼Œè¿™æ˜¯ä¸€ç§æ¯”â€œæ·»åŠ åŠŸèƒ½â€æ›´æ·±åˆ»çš„æ€è€ƒæ–¹å¼ã€‚</p>
</li>
<li>
<p><strong>çŠ¶æ€çš„äºŒå…ƒæ€§</strong>ï¼šæˆ‘ä»¬åŒºåˆ†äº†éœ€è¦æŒä¹…åŒ–çš„â€œæ–‡æ¡£çŠ¶æ€â€ï¼ˆ<code>attributes</code>ï¼‰å’Œä¸´æ—¶çš„â€œè¿è¡Œæ—¶çŠ¶æ€â€ï¼ˆ<code>storage</code>ï¼‰ï¼Œè¿™æ˜¯æ„å»ºå¥å£®æ‰©å±•çš„æ¶æ„åŸºçŸ³ã€‚</p>
</li>
<li>
<p><strong>é«˜çº§äº¤äº’çš„ä¸‰ä½ä¸€ä½“</strong>ï¼šå¯¹äºå¤æ‚çš„äº¤äº’å¼èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æŒæ¡äº†ç»“åˆ <code>atom</code> å±æ€§ã€<code>addNodeView</code> å’Œ <code>addProseMirrorPlugins</code> çš„æ ¸å¿ƒæ¶æ„æ¨¡å¼ã€‚</p>
</li>
</ul>
<p>æŒæ¡äº†è¿™äº›çŸ¥è¯†ï¼Œä½ å°±æ‹¥æœ‰äº†è§£é” Tiptap å…¨éƒ¨æ½œèƒ½çš„é’¥åŒ™ã€‚ä½ ä¸å†å—é™äº Tiptap å®˜æ–¹æˆ–ç¤¾åŒºæä¾›çš„æ‰©å±•ï¼Œä½ çš„ç¼–è¾‘å™¨ç°åœ¨æ˜¯ä¸€å—çœŸæ­£çš„ç”»å¸ƒï¼Œè€Œæ‰©å±•å°±æ˜¯ä½ æ‰‹ä¸­çš„ç”»ç¬”ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æç»˜å‡ºä½ äº§å“æ‰€éœ€çš„ç”¨æˆ·ä½“éªŒ 2ã€‚</p>
<p><strong>ä¸‹ä¸€æ­¥è¡ŒåŠ¨</strong></p>
<ul>
<li>
<p><strong>æ·±å…¥æ¢ç´¢</strong>ï¼šå®˜æ–¹æ–‡æ¡£æ°¸è¿œæ˜¯æœ€å¥½çš„è€å¸ˆã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ èŠ±æ—¶é—´æ·±å…¥é˜…è¯» Tiptap å’Œ ProseMirror çš„å®˜æ–¹æ–‡æ¡£ï¼Œé‚£é‡Œæœ‰æ›´è¯¦å°½çš„ API å‚è€ƒå’Œç¤ºä¾‹ã€‚</p>
</li>
<li>
<p><strong>åŠ¨æ‰‹å®è·µ</strong>ï¼šçŸ¥è¯†åªæœ‰åœ¨å®è·µä¸­æ‰èƒ½çœŸæ­£å†…åŒ–ã€‚å°è¯•ä¸ºä½ è‡ªå·±çš„é¡¹ç›®æ„å»ºä¸€ä¸ªç‹¬ç‰¹çš„æ‰©å±•ï¼Œè§£å†³ä¸€ä¸ªå®é™…é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>æ‹¥æŠ±ç¤¾åŒº</strong>ï¼šTiptap æ‹¥æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºã€‚å¦‚æœä½ æƒ³å°†è‡ªå·±çš„æ‰©å±•åˆ†äº«ç»™æ›´å¤šäººï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ CLI å·¥å…·</p>
<p><code>npm init tiptap-extension</code> æ¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ ‡å‡†åŒ–çš„ã€å¯å‘å¸ƒçš„æ‰©å±•é¡¹ç›®ã€‚</p>
</li>
</ul>
<p>æ„Ÿè°¢ä½ è·Ÿéšæœ¬ç³»åˆ—æ•™ç¨‹èµ°åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ç¯‡æ·±åº¦æŒ‡å—èƒ½å¤Ÿæˆä¸ºä½ åœ¨ Tiptap å®šåˆ¶åŒ–é“è·¯ä¸Šçš„åšå®åŸºçŸ³å’Œçµæ„Ÿæºæ³‰ã€‚ç¥ä½ åˆ›é€ æ„‰å¿«ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android åª’ä½“åº“é«˜æ•ˆæ‰«æå™¨ï¼šåŸºäºåç¨‹ä¸ `ContentObserver` çš„ `FileScanner`]]></title>    <link>https://juejin.cn/post/7573587915810308137</link>    <guid>https://juejin.cn/post/7573587915810308137</guid>    <pubDate>2025-11-18T03:02:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573587915810308137" data-draft-id="7573631442312347654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android åª’ä½“åº“é«˜æ•ˆæ‰«æå™¨ï¼šåŸºäºåç¨‹ä¸ `ContentObserver` çš„ `FileScanner`"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-18T03:02:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android åª’ä½“åº“é«˜æ•ˆæ‰«æå™¨ï¼šåŸºäºåç¨‹ä¸ `ContentObserver` çš„ `FileScanner`
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:02:50.000Z" title="Tue Nov 18 2025 03:02:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Android å¼€å‘ä¸­ï¼Œå¤„ç†æ–‡ä»¶ç³»ç»Ÿå˜åŒ–ï¼Œå°¤å…¶æ˜¯åª’ä½“æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰çš„å¢åˆ æ”¹æŸ¥ï¼Œæ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚ä½†ç›´æ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿæˆ–é¢‘ç¹è§¦å‘ MediaStore æ‰«æå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸ªé«˜æ•ˆã€é˜²æŠ–ã€æ”¯æŒæ·±åº¦ä¸æµ…å±‚æ‰«æçš„ <strong><code>FileScanner</code></strong> Kotlin <code>object</code>ï¼Œå®ƒç»“åˆäº† <strong>åç¨‹ (Coroutines)</strong> è¿›è¡Œå¼‚æ­¥æ“ä½œã€<strong><code>Mutex</code></strong> ä¿è¯å¹¶å‘å®‰å…¨ï¼Œä»¥åŠ <strong><code>ContentObserver</code></strong> ç›‘å¬åª’ä½“åº“å˜åŒ–ï¼Œå®ç°äº†ä¸€ä¸ªå¥å£®çš„åª’ä½“æ–‡ä»¶æ‰«ææœºåˆ¶ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒåŠŸèƒ½ä¸è®¾è®¡ç›®æ ‡</h2>
<p><code>FileScanner</code> çš„ä¸»è¦ç›®æ ‡æ˜¯<strong>é€šçŸ¥ MediaStore æ‰«ææ–‡ä»¶æˆ–ç›®å½•</strong>ï¼Œè€Œéæ‰§è¡Œåª’ä½“æŸ¥è¯¢ã€‚</p>
<ol>
<li>
<p><strong>åª’ä½“åº“å˜åŒ–è§¦å‘æ‰«æ</strong>ï¼šé€šè¿‡æ³¨å†Œ <code>ContentObserver</code>ï¼Œåœ¨åª’ä½“åº“å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘ä¸€æ¬¡å¸¦<strong>é˜²æŠ– (Debounce)</strong> çš„æ‰«æã€‚</p>
</li>
<li>
<p><strong>æ”¯æŒæµ…å±‚ä¸æ·±åº¦æ‰«æ</strong>ï¼š</p>
<ul>
<li><strong>æµ…å±‚æ‰«æ (Shallow Scan)</strong> ï¼šä»…å°†ç›®å½•æœ¬èº«è·¯å¾„äº¤ç»™ç³»ç»Ÿï¼Œé€‚ç”¨äºæ–°å¢æ•´ä¸ªç›®å½•æˆ–ç”±ç³»ç»Ÿè‡ªè¡Œå‘ç°å˜åŒ–ã€‚</li>
<li><strong>æ·±åº¦æ‰«æ (Deep Scan)</strong> ï¼šé€’å½’æšä¸¾ç›®å½•ä¸‹æ‰€æœ‰æ”¯æŒçš„åª’ä½“æ–‡ä»¶ï¼Œå°†å…·ä½“æ–‡ä»¶è·¯å¾„äº¤ç»™ç³»ç»Ÿæ‰«æï¼Œç¡®ä¿æ–°æ–‡ä»¶è¢«åŠæ—¶ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šåˆ©ç”¨ Kotlin åç¨‹çš„ <code>Mutex</code> ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªæ‰«æä»»åŠ¡åœ¨æ‰§è¡Œï¼Œé¿å…èµ„æºæµªè´¹å’Œç³»ç»Ÿè¿‡è½½ã€‚</p>
</li>
<li>
<p><strong>èµ„æºç®¡ç†</strong>ï¼šæä¾›æ˜ç¡®çš„ <code>unregister</code> å’Œ <code>cleanup</code> æ–¹æ³•é‡Šæ”¾ <code>ContentObserver</code> å’Œåç¨‹èµ„æºã€‚</p>
</li>
</ol>
<h2 data-id="heading-1">äºŒã€å®Œæ•´æºä»£ç </h2>
<p>ä»¥ä¸‹æ˜¯ <code>FileScanner.kt</code> çš„å®Œæ•´ä»£ç ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> android.content.Context
<span class="hljs-keyword">import</span> android.database.ContentObserver
<span class="hljs-keyword">import</span> android.media.MediaScannerConnection
<span class="hljs-keyword">import</span> android.net.Uri
<span class="hljs-keyword">import</span> android.os.Environment
<span class="hljs-keyword">import</span> android.os.Handler
<span class="hljs-keyword">import</span> android.os.Looper
<span class="hljs-keyword">import</span> android.provider.MediaStore
<span class="hljs-keyword">import</span> kotlinx.coroutines.CoroutineScope
<span class="hljs-keyword">import</span> kotlinx.coroutines.Dispatchers
<span class="hljs-keyword">import</span> kotlinx.coroutines.ExperimentalCoroutinesApi
<span class="hljs-keyword">import</span> kotlinx.coroutines.Job
<span class="hljs-keyword">import</span> kotlinx.coroutines.SupervisorJob
<span class="hljs-keyword">import</span> kotlinx.coroutines.cancel
<span class="hljs-keyword">import</span> kotlinx.coroutines.delay
<span class="hljs-keyword">import</span> kotlinx.coroutines.isActive
<span class="hljs-keyword">import</span> kotlinx.coroutines.launch
<span class="hljs-keyword">import</span> kotlinx.coroutines.suspendCancellableCoroutine
<span class="hljs-keyword">import</span> kotlinx.coroutines.sync.Mutex
<span class="hljs-keyword">import</span> kotlinx.coroutines.sync.withLock
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicBoolean
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger
<span class="hljs-keyword">import</span> kotlin.coroutines.resume

<span class="hljs-comment">/**
 * FileScanner
 * åŠŸèƒ½ï¼š
 * 1. æ³¨å†Œåª’ä½“åº“ ContentObserverï¼Œåª’ä½“åº“å˜åŒ–æ—¶è§¦å‘æ‰«æï¼ˆé˜²æŠ–ï¼‰ã€‚
 * 2. scanFiles æ”¯æŒæµ…å±‚ï¼ˆä¼ ç›®å½•æœ¬èº«ï¼‰ä¸æ·±åº¦ï¼ˆé€’å½’æšä¸¾åª’ä½“æ–‡ä»¶ï¼‰æ‰«æã€‚
 * 3. ä½¿ç”¨åç¨‹ + Mutex ä¿è¯å•æ¬¡ä¸²è¡Œæ‰«æï¼Œé˜²æ­¢å¹¶å‘é‡å¤æ¶ˆè€—ã€‚
 * 4. æä¾› unregister ä¸ cleanup é‡Šæ”¾èµ„æºã€‚
 *
 * éç›®æ ‡ï¼šä¸è´Ÿè´£åª’ä½“æ–‡ä»¶æŸ¥è¯¢ï¼ˆåº”ä½¿ç”¨ MediaStore æŸ¥è¯¢ï¼‰ã€‚
 */</span>
<span class="hljs-keyword">object</span> FileScanner {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mutex = Mutex()
  <span class="hljs-comment">// ä½¿ç”¨ IO è°ƒåº¦å™¨ï¼Œç¡®ä¿æ–‡ä»¶æ‰«æåœ¨åå°çº¿ç¨‹æ‰§è¡Œ</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> scope: CoroutineScope = createScope()
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mediaObserver: MediaContentObserver? = <span class="hljs-literal">null</span>
  <span class="hljs-comment">// ç”¨äºé˜²æŠ–çš„ Job</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> debounceJob: Job? = <span class="hljs-literal">null</span>
  <span class="hljs-comment">// è§‚å¯Ÿè€…æ³¨å†ŒçŠ¶æ€</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> isRegistered = AtomicBoolean(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> DEBOUNCE_DELAY = <span class="hljs-number">1000L</span> <span class="hljs-comment">// 1ç§’é˜²æŠ–</span>

  <span class="hljs-comment">// æ”¯æŒçš„åª’ä½“æ‰©å±•åï¼ˆç»Ÿä¸€ä¸ºå°å†™ï¼‰</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mediaExtensions = setOf(
    <span class="hljs-string">"jpg"</span>, <span class="hljs-string">"jpeg"</span>, <span class="hljs-string">"png"</span>, <span class="hljs-string">"gif"</span>, <span class="hljs-string">"webp"</span>, <span class="hljs-string">"bmp"</span>, <span class="hljs-comment">// å›¾ç‰‡</span>
    <span class="hljs-string">"mp4"</span>, <span class="hljs-string">"avi"</span>, <span class="hljs-string">"mov"</span>, <span class="hljs-string">"mkv"</span>, <span class="hljs-string">"3gp"</span>, <span class="hljs-string">"webm"</span> <span class="hljs-comment">// è§†é¢‘</span>
  )

  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createScope</span><span class="hljs-params">()</span></span> = CoroutineScope(SupervisorJob() + Dispatchers.IO)
  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ensureScope</span><span class="hljs-params">()</span></span>: CoroutineScope {
    <span class="hljs-keyword">if</span> (!scope.isActive) {
      <span class="hljs-comment">// å¦‚æœ Scope è¢«å–æ¶ˆï¼Œåˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„</span>
      scope = createScope()
    }
    <span class="hljs-keyword">return</span> scope
  }

  <span class="hljs-comment">/** åˆ¤æ–­æ˜¯å¦æ˜¯æ”¯æŒçš„åª’ä½“æ–‡ä»¶ */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isMediaFile</span><span class="hljs-params">(file: <span class="hljs-type">java</span>.<span class="hljs-type">io</span>.<span class="hljs-type">File</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">if</span> (!file.isFile) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">val</span> name = file.name
    <span class="hljs-keyword">val</span> dot = name.lastIndexOf(<span class="hljs-string">'.'</span>)
    <span class="hljs-comment">// ç¡®ä¿æœ‰æ‰©å±•åä¸”ä¸åœ¨æ–‡ä»¶åå¼€å¤´æˆ–ç»“å°¾</span>
    <span class="hljs-keyword">if</span> (dot &lt;= <span class="hljs-number">0</span> || dot == name.length - <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">val</span> ext = name.substring(dot + <span class="hljs-number">1</span>).lowercase()
    <span class="hljs-keyword">return</span> mediaExtensions.contains(ext)
  }

  <span class="hljs-comment">/**
   * æ‰«ææŒ‡å®šè·¯å¾„åˆ—è¡¨ã€‚paths ä¸º null æ—¶æ‰«æå¸¸ç”¨å…¬å…±ç›®å½•ï¼ˆDCIM / Pictures / Moviesï¼‰ã€‚
   * deepScan=trueï¼šé€’å½’æšä¸¾ç›®å½•ä¸‹æ‰€æœ‰åª’ä½“æ–‡ä»¶ï¼›falseï¼šä»…æŠŠç›®å½•è·¯å¾„äº¤ç»™ç³»ç»Ÿæ‰«æã€‚
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scanFiles</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, paths: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;? = <span class="hljs-literal">null</span>, deepScan: <span class="hljs-type">Boolean</span> = <span class="hljs-literal">true</span>)</span></span> {
    <span class="hljs-comment">// 1. å®ç°é˜²æŠ–ï¼šå–æ¶ˆæ—§çš„é˜²æŠ–ä»»åŠ¡</span>
    <span class="hljs-keyword">if</span> (debounceJob?.isActive == <span class="hljs-literal">true</span>) {
      debounceJob?.cancel()
    }
    <span class="hljs-comment">// 2. å¯åŠ¨æ–°çš„é˜²æŠ–ä»»åŠ¡</span>
    debounceJob = ensureScope().launch {
      delay(DEBOUNCE_DELAY)
      <span class="hljs-comment">// 3. è¿›å…¥ Mutex ä¿æŠ¤åŒºï¼Œä¸²è¡Œæ‰§è¡Œæ‰«æé€»è¾‘</span>
      mutex.withLock {
        performMediaScan(context, paths, deepScan)
      }
    }
  }

  <span class="hljs-meta">@OptIn(ExperimentalCoroutinesApi::class)</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performMediaScan</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, paths: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;?, deepScan: <span class="hljs-type">Boolean</span>)</span></span> {
    <span class="hljs-comment">// é»˜è®¤æ‰«æè·¯å¾„</span>
    <span class="hljs-keyword">val</span> inputPaths = paths ?: arrayOf(
      Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).absolutePath,
      Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES).absolutePath,
      Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_MOVIES).absolutePath
    )

    <span class="hljs-keyword">val</span> filesToScan = mutableListOf&lt;String&gt;()

    inputPaths.forEach { path -&gt;
      <span class="hljs-keyword">val</span> f = java.io.File(path)
      <span class="hljs-keyword">if</span> (!f.exists()) <span class="hljs-keyword">return</span><span class="hljs-symbol">@forEach</span>
      <span class="hljs-keyword">if</span> (f.isDirectory) {
        <span class="hljs-keyword">if</span> (deepScan) {
          <span class="hljs-comment">// æ·±åº¦æ‰«æï¼šé€’å½’æ”¶é›†ç›®å½•ä¸‹æ‰€æœ‰åª’ä½“æ–‡ä»¶</span>
          collectMediaFiles(f, filesToScan)
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// æµ…å±‚æ‰«æï¼šä»…æŠŠç›®å½•æœ¬èº«è·¯å¾„åŠ å…¥æ‰«æåˆ—è¡¨</span>
          filesToScan.add(path)
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å•æ–‡ä»¶æ‰«æï¼šå¦‚æœä¸æ˜¯æ·±åº¦æ‰«æï¼Œæˆ–è€…æ–‡ä»¶æ˜¯æ”¯æŒçš„åª’ä½“æ–‡ä»¶ï¼Œåˆ™åŠ å…¥</span>
        <span class="hljs-keyword">if</span> (!deepScan || isMediaFile(f)) {
          filesToScan.add(path)
        }
      }
    }

    <span class="hljs-keyword">if</span> (filesToScan.isEmpty()) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">val</span> scanPaths = filesToScan.toTypedArray()

    <span class="hljs-comment">// å°† MediaScannerConnection.scanFile çš„å¼‚æ­¥å›è°ƒå°è£…æˆæŒ‚èµ·å‡½æ•°</span>
    suspendCancellableCoroutine&lt;<span class="hljs-built_in">Unit</span>&gt; { continuation -&gt;
      <span class="hljs-keyword">val</span> total = scanPaths.size
      <span class="hljs-keyword">val</span> completed = AtomicInteger(<span class="hljs-number">0</span>)
      <span class="hljs-keyword">val</span> resumed = AtomicBoolean(<span class="hljs-literal">false</span>) <span class="hljs-comment">// é¿å…é‡å¤ resume</span>

      MediaScannerConnection.scanFile(context, scanPaths, <span class="hljs-literal">null</span>) { _, _ -&gt;
        <span class="hljs-keyword">val</span> done = completed.incrementAndGet()
        <span class="hljs-comment">// æ‰€æœ‰æ–‡ä»¶æ‰«æå®Œæˆï¼Œæˆ–åç¨‹ä»æœªè¢«å–æ¶ˆ</span>
        <span class="hljs-keyword">if</span> (done == total &amp;&amp; resumed.compareAndSet(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) {
          continuation.resume(<span class="hljs-built_in">Unit</span>)
        }
      }

      <span class="hljs-comment">// åç¨‹è¢«å–æ¶ˆæ—¶ï¼ˆå¦‚ debounceJob è¢«å–æ¶ˆï¼‰</span>
      continuation.invokeOnCancellation {
        <span class="hljs-comment">// å¯é€‰ï¼šå¦‚æœ MediaScannerConnection æœ‰å–æ¶ˆæœºåˆ¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨</span>
      }
    }
  }

  <span class="hljs-comment">/** é€’å½’æ”¶é›†åª’ä½“æ–‡ä»¶ï¼ˆæ·±åº¦æ‰«æç”¨ï¼‰ */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectMediaFiles</span><span class="hljs-params">(dir: <span class="hljs-type">java</span>.<span class="hljs-type">io</span>.<span class="hljs-type">File</span>, <span class="hljs-keyword">out</span>: <span class="hljs-type">MutableList</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> {
    <span class="hljs-keyword">val</span> children = dir.listFiles() ?: <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">for</span> (child <span class="hljs-keyword">in</span> children) {
      <span class="hljs-keyword">if</span> (child.isFile) {
        <span class="hljs-keyword">if</span> (isMediaFile(child)) <span class="hljs-keyword">out</span>.add(child.absolutePath)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (child.isDirectory &amp;&amp; !child.name.startsWith(<span class="hljs-string">'.'</span>)) {
        <span class="hljs-comment">// å¿½ç•¥éšè—ç›®å½•</span>
        collectMediaFiles(child, <span class="hljs-keyword">out</span>)
      }
    }
  }

  <span class="hljs-comment">/** æ³¨å†Œåª’ä½“åº“å˜åŒ–è§‚å¯Ÿè€… */</span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">registerMediaObserver</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    <span class="hljs-keyword">if</span> (!isRegistered.compareAndSet(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">val</span> handler = Handler(Looper.getMainLooper())
      <span class="hljs-comment">// åª’ä½“åº“å˜åŒ–æ—¶ï¼Œè§¦å‘ä¸€æ¬¡é˜²æŠ–æ‰«æ</span>
      mediaObserver = MediaContentObserver(handler) {
        scanFiles(context)
      }
      context.contentResolver.registerContentObserver(
        <span class="hljs-comment">// ç›‘å¬æ‰€æœ‰æ–‡ä»¶å˜åŒ–</span>
        MediaStore.Files.getContentUri(<span class="hljs-string">"external"</span>),
        <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ·±åº¦ç›‘å¬å­ç›®å½•</span>
        mediaObserver!!
      )
    } <span class="hljs-keyword">catch</span> (e: Exception) {
      isRegistered.<span class="hljs-keyword">set</span>(<span class="hljs-literal">false</span>)
      <span class="hljs-keyword">throw</span> e
    }
  }

  <span class="hljs-comment">/** æ³¨é”€åª’ä½“åº“è§‚å¯Ÿè€… */</span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unregisterMediaObserver</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    <span class="hljs-keyword">if</span> (!isRegistered.compareAndSet(<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>)) <span class="hljs-keyword">return</span>
    debounceJob?.cancel()
    debounceJob = <span class="hljs-literal">null</span>
    mediaObserver?.let {
      <span class="hljs-keyword">try</span> { context.contentResolver.unregisterContentObserver(it) } <span class="hljs-keyword">catch</span> (_: Exception) {}
    }
    mediaObserver = <span class="hljs-literal">null</span>
  }

  <span class="hljs-comment">/** æ¸…ç†å…¨éƒ¨èµ„æºï¼ˆé€šå¸¸åœ¨å®¿ä¸»é”€æ¯æ—¶è°ƒç”¨ï¼‰ */</span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cleanup</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>? = <span class="hljs-literal">null</span>)</span></span> {
    <span class="hljs-keyword">try</span> { context?.let { unregisterMediaObserver(it) } } <span class="hljs-keyword">catch</span> (_: Exception) {}
    <span class="hljs-comment">// å–æ¶ˆæ‰€æœ‰åç¨‹ä»»åŠ¡</span>
    scope.cancel()
  }
}

<span class="hljs-comment">/** ContentObserver ç®€å•å°è£… */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaContentObserver</span>(
  handler: Handler,
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> onMediaChange: () -&gt; <span class="hljs-built_in">Unit</span>,
) : ContentObserver(handler) {
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onChange</span><span class="hljs-params">(selfChange: <span class="hljs-type">Boolean</span>, uri: <span class="hljs-type">Uri</span>?)</span></span> {
    onMediaChange()
  }
}
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€å®ç°é€»è¾‘åˆ†æ</h2>
<h3 data-id="heading-3">1. åç¨‹ä¸å¹¶å‘æ§åˆ¶ (<code>Mutex</code> &amp; <code>debounce</code>)</h3>
<p>è¿™æ˜¯ <code>FileScanner</code> å¥å£®æ€§çš„å…³é”®ï¼š</p>
<ul>
<li>
<p><strong><code>CoroutineScope</code></strong>ï¼š<code>scope = CoroutineScope(SupervisorJob() + Dispatchers.IO)</code>ã€‚ä½¿ç”¨ <code>Dispatchers.IO</code> ç¡®ä¿æ–‡ä»¶ I/O æ“ä½œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚<code>SupervisorJob</code> ç¡®ä¿å­ä»»åŠ¡å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><strong><code>scanFiles()</code> ä¸­çš„é˜²æŠ– (Debounce)</strong> ï¼š</p>
<ul>
<li>æ¯æ¬¡è°ƒç”¨ <code>scanFiles()</code> éƒ½ä¼šå…ˆå–æ¶ˆå‰ä¸€ä¸ªæ­£åœ¨ç­‰å¾…çš„ <code>debounceJob</code> (<code>debounceJob?.cancel()</code>)ã€‚</li>
<li>ç„¶åå¯åŠ¨ä¸€ä¸ªæ–°çš„ <code>Job</code>ï¼Œç­‰å¾… <code>DEBOUNCE_DELAY</code> (1000ms)ã€‚å¦‚æœåœ¨ 1000ms å†…å†æ¬¡è°ƒç”¨ <code>scanFiles</code>ï¼Œå‰ä¸€ä¸ªä»»åŠ¡å°±ä¼šè¢«å–æ¶ˆã€‚</li>
<li>è¿™è§£å†³äº† <code>ContentObserver</code> å¯èƒ½åœ¨çŸ­æ—¶é—´å†…è§¦å‘å¤šæ¬¡å˜åŒ–çš„é—®é¢˜ï¼Œé¿å…äº†ä¸å¿…è¦çš„é¢‘ç¹æ‰«æã€‚</li>
</ul>
</li>
<li>
<p><strong><code>Mutex</code> ä¸²è¡Œæ‰§è¡Œ</strong>ï¼š</p>
<ul>
<li><code>mutex.withLock { performMediaScan(...) }</code> ç¡®ä¿äº†å³ä½¿é˜²æŠ–ä»»åŠ¡æˆåŠŸå¯åŠ¨ï¼Œå®ƒä¹Ÿå¿…é¡»ç­‰å¾…å‰ä¸€ä¸ª <code>performMediaScan</code> ä»»åŠ¡å®Œå…¨ç»“æŸåæ‰èƒ½æ‰§è¡Œã€‚</li>
<li>è¿™ä¿è¯äº† MediaStore æ‰«æä»»åŠ¡çš„<strong>å•æ¬¡ä¸²è¡Œæ‰§è¡Œ</strong>ï¼Œé˜²æ­¢ç³»ç»Ÿå› å¤šä¸ªå¹¶å‘æ‰«æä»»åŠ¡è€Œå˜æ…¢ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">2. åª’ä½“æ‰«æé€»è¾‘ (<code>performMediaScan</code>)</h3>
<p>è¯¥å‡½æ•°æ˜¯æ ¸å¿ƒæ‰§è¡Œé€»è¾‘ï¼Œå·¥ä½œåœ¨ <code>Dispatchers.IO</code> çº¿ç¨‹ï¼š</p>
<ol>
<li>
<p><strong>è·¯å¾„æ”¶é›†</strong>ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯ <code>paths</code> ä¸º <code>null</code>ï¼Œé»˜è®¤æ‰«æç³»ç»Ÿå…¬å…±åª’ä½“ç›®å½• (<code>DCIM</code>, <code>Pictures</code>, <code>Movies</code>)ã€‚</li>
<li><strong>æ·±åº¦æ‰«æ</strong> (<code>deepScan = true</code>)ï¼šè°ƒç”¨ <code>collectMediaFiles</code> é€’å½’éå†ç›®å½•ï¼Œ<strong>åªæ”¶é›†</strong>æ»¡è¶³ <code>isMediaFile</code> çš„å…·ä½“æ–‡ä»¶è·¯å¾„ã€‚</li>
<li><strong>æµ…å±‚æ‰«æ</strong> (<code>deepScan = false</code>)ï¼šåªå°†<strong>ç›®å½•æœ¬èº«</strong>çš„è·¯å¾„åŠ å…¥æ‰«æåˆ—è¡¨ã€‚ç³»ç»Ÿæ”¶åˆ°ç›®å½•è·¯å¾„åï¼Œä¼šè‡ªè¡ŒæŸ¥æ‰¾å…¶ä¸­çš„æ–°æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>MediaScannerConnection</code> å°è£…</strong>ï¼š</p>
<ul>
<li><code>MediaScannerConnection.scanFile</code> æ˜¯ä¸€ä¸ªå¼‚æ­¥ APIï¼Œä¾èµ–å›è°ƒ (<code>onScanCompleted</code>) æ¥é€šçŸ¥å®Œæˆã€‚</li>
<li>ä½¿ç”¨ <strong><code>suspendCancellableCoroutine</code></strong> å°†è¿™ä¸ªå›è°ƒæœºåˆ¶ä¼˜é›…åœ°å°è£…æˆä¸€ä¸ª Kotlin æŒ‚èµ·å‡½æ•°ã€‚</li>
<li><code>AtomicInteger</code> (<code>completed</code>) ç”¨äºè¿½è¸ªå·²å®Œæˆçš„æ–‡ä»¶æ•°é‡ï¼Œå½“è¾¾åˆ° <code>total</code> æ—¶ï¼Œè°ƒç”¨ <code>continuation.resume(Unit)</code> æ¢å¤åç¨‹ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">3. åª’ä½“åº“ç›‘å¬ (<code>registerMediaObserver</code>)</h3>
<ul>
<li><strong><code>MediaContentObserver</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Android APIï¼Œç”¨äºç›‘å¬ <code>ContentProvider</code>ï¼ˆè¿™é‡Œæ˜¯ <code>MediaStore</code>ï¼‰çš„æ•°æ®å˜åŒ–ã€‚</li>
<li><strong>ç›‘å¬ URI</strong>ï¼šæ³¨å†Œåˆ° <code>MediaStore.Files.getContentUri("external")</code>ï¼Œè¿™æ˜¯ç›‘å¬å¤–éƒ¨å­˜å‚¨ä¸Šæ‰€æœ‰æ–‡ä»¶å˜åŒ–çš„æœ€å¹¿ URIã€‚</li>
<li><strong>è§¦å‘æœºåˆ¶</strong>ï¼šå½“ <code>onChange</code> è§¦å‘æ—¶ï¼Œè°ƒç”¨ <code>scanFiles(context)</code>ï¼Œè§¦å‘å¸¦é˜²æŠ–å’Œ Mutex ä¿æŠ¤çš„æ‰«æé€»è¾‘ã€‚</li>
</ul>
<h3 data-id="heading-6">4. èµ„æºæ¸…ç† (<code>cleanup</code> / <code>unregister</code>)</h3>
<p>è‰¯å¥½çš„èµ„æºç®¡ç†è‡³å…³é‡è¦ï¼š</p>
<ul>
<li><strong><code>unregisterMediaObserver</code></strong>ï¼šè´Ÿè´£æ³¨é”€ <code>ContentObserver</code> å¹¶æ¸…ç† <code>debounceJob</code>ã€‚</li>
<li><strong><code>cleanup</code></strong>ï¼šè°ƒç”¨ <code>unregisterMediaObserver</code> åï¼Œè¿˜ä¼šè°ƒç”¨ <code>scope.cancel()</code>ã€‚è¿™ä¼šå–æ¶ˆ <code>scope</code> ä¸‹æ‰€æœ‰æœªå®Œæˆçš„åç¨‹ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­£åœ¨ç­‰å¾…çš„é˜²æŠ–ä»»åŠ¡å’Œæ­£åœ¨æ‰§è¡Œçš„ <code>performMediaScan</code> ä»»åŠ¡ï¼‰ï¼Œç¡®ä¿åœ¨å®¿ä¸»ç»„ä»¶ï¼ˆå¦‚ <code>Activity</code> æˆ– <code>Service</code>ï¼‰é”€æ¯æ—¶ï¼Œæ‰€æœ‰åå°å·¥ä½œéƒ½è¢«åœæ­¢ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3>
<p><strong>æƒé™</strong>ï¼šç¡®ä¿åœ¨ AndroidManifest.xml ä¸­å£°æ˜äº†å­˜å‚¨è¯»å†™æƒé™ï¼ˆå–å†³äºæ‚¨çš„ Android ç‰ˆæœ¬å’Œç›®æ ‡ API çº§åˆ«ï¼‰ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
```
<span class="hljs-keyword">private</span> boolean hasRequiredMediaPermissions() {
  <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">33</span>) {
    <span class="hljs-keyword">return</span> checkSelfPermission(Manifest.permission.READ_MEDIA_IMAGES) == PackageManager.PERMISSION_GRANTED
        &amp;&amp; checkSelfPermission(Manifest.permission.READ_MEDIA_VIDEO) == PackageManager.PERMISSION_GRANTED;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> ContextCompat.checkSelfPermission(<span class="hljs-keyword">this</span>, Manifest.permission.READ_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED;
  }
}
```
</code></pre>
<p><strong>å¯åŠ¨ç›‘å¬</strong>ï¼ˆå¦‚åœ¨ <code>Application</code> æˆ– <code>Service</code> ä¸­ï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go">Kotlin

<span class="hljs-string">``</span><span class="hljs-string">`
FileScanner.registerMediaObserver(applicationContext)
`</span><span class="hljs-string">``</span>
</code></pre>
<p><strong>æ‰‹åŠ¨è§¦å‘æ‰«æ</strong>ï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Kotlin

```
// æ·±åº¦æ‰«ææŒ‡å®šç›®å½•
FileScanner.scanFiles(context, arrayOf("/path/to/new/photos"), <span class="hljs-attr">deepScan</span> = <span class="hljs-literal">true</span>) 
// ä»…æ‰«æå…¬å…±ç›®å½•ï¼Œæµ…å±‚
FileScanner.scanFiles(context, <span class="hljs-attr">deepScan</span> = <span class="hljs-literal">false</span>) 
```
</code></pre>
<p><strong>æ¸…ç†èµ„æº</strong>ï¼ˆåœ¨ <code>onDestroy</code> æˆ– <code>onStop</code> ä¸­ï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go">Kotlin

<span class="hljs-string">``</span><span class="hljs-string">`
FileScanner.cleanup(applicationContext)
`</span><span class="hljs-string">``</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git cherry-pick ä½¿ç”¨å°æŠ€å·§]]></title>    <link>https://juejin.cn/post/7573601651782500379</link>    <guid>https://juejin.cn/post/7573601651782500379</guid>    <pubDate>2025-11-18T03:07:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573601651782500379" data-draft-id="7573595009552842762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git cherry-pick ä½¿ç”¨å°æŠ€å·§"/> <meta itemprop="keywords" content="GitHub,Git"/> <meta itemprop="datePublished" content="2025-11-18T03:07:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="crossoverJie"/> <meta itemprop="url" content="https://juejin.cn/user/835284565229597"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git cherry-pick ä½¿ç”¨å°æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/835284565229597/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    crossoverJie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:07:45.000Z" title="Tue Nov 18 2025 03:07:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>å‰æ®µæ—¶é—´æˆ‘åœ¨å®ç° StarRocks çš„ä¸€ä¸ªå…³äº<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStarRocks%2Fstarrocks%2Fpull%2F62705" target="_blank" title="https://github.com/StarRocks/starrocks/pull/62705" ref="nofollow noopener noreferrer">èµ„æºé™åˆ¶çš„ç‰¹æ€§</a>ï¼Œç”±äºè¯¥åŠŸèƒ½éœ€è¦åŸºäºæœ€æ–°çš„ 3.5 tag è¿›è¡Œå¼€å‘ï¼Œæ‰€ä»¥æˆ‘éœ€è¦éœ€è¦ä» 3.5 çš„ tag é‡Œæ‹‰å‡ºä¸€ä¸ªåˆ†æ”¯ï¼ˆ3.5-featureï¼‰å¼€å‘å®Œæˆåå†å‘ä¸Šæ¸¸çš„ main åˆ†æ”¯æäº¤ PRã€‚</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆ</h2>
<p>å¦‚æœç›´æ¥ä½¿ç”¨ 3.5-feature åˆ†æ”¯å‘ main æäº¤ PR ä¼šæœ‰å¾ˆå¤šä¹‹å‰çš„ commit å¯¼è‡´æ–‡ä»¶ä¿®æ”¹å¾ˆå¤šï¼Œæ‰€ä»¥å¾—æ¢ä¸€ç§æ–¹å¼æäº¤è¿™äº›å˜æ›´ã€‚</p>
<h3 data-id="heading-2">stash</h3>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ä¹Ÿè›®å¤šçš„ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ <code>git stash</code>ã€‚</p>
<p>è¿™ä¸ªå¯ä»¥å…ˆå°†ä¿®æ”¹ä¸´æ—¶ä¿å­˜ï¼Œç„¶åå†éœ€è¦çš„æ—¶å€™å†å°† stash é‡Œçš„æ•°æ®åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ã€‚</p>
<p>ä½†è¿™æ ·æœ‰å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¼€å‘çš„è¿‡ç¨‹ä¸­æ²¡æ³•æäº¤ä»£ç äº†ï¼Œæäº¤ä¹‹åå°±æ²¡æ³•ä¿å­˜åˆ° stash é‡Œï¼Œæ²¡æœ‰æäº¤ä»£ç æ€»ä¼šæœ‰ä¸¢æ•°æ®çš„é£é™©ã€‚</li>
<li>åç»­éœ€è¦å¤šæ¬¡æäº¤æ—¶ï¼Œstash ä¹Ÿä¸æ”¯æŒï¼Œæ¯•ç«Ÿ stash ä¹‹åå½“å‰åˆ†æ”¯çš„ä»£ç å°±æ²¡æœ‰äº†ã€‚</li>
</ul>
<h3 data-id="heading-3">æ‰‹åŠ¨å¤åˆ¶</h3>
<p>ç¬¬äºŒç§åŠæ³•é‚£å°±æ˜¯å…ˆæŠŠä»£ç æäº¤åˆ° <code>3.5-feature</code>ï¼Œç„¶åé‡æ–°åŸºäº main åˆ†æ”¯é‡æ–°æ‹‰å–ä¸€ä¸ªåˆ†æ”¯ï¼Œå†æ‰‹åŠ¨å¯¹æ¯” <code>3.5-feature</code> çš„æäº¤è®°å½•è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>è¿™æ ·çš„å¥½å¤„æ˜¯æäº¤è®°å½•æ¯”è¾ƒå¹²å‡€ï¼Œä½†åå¤„æ˜¯æ”¹åŠ¨è¾ƒå¤šçš„è¯å®¹æ˜“é—æ¼ä»£ç ï¼Œå¹¶ä¸”æ¯æ¬¡åœ¨ <code>3.5-feature</code> çš„æ”¹åŠ¨éƒ½éœ€è¦äººå·¥åŒæ­¥è¿‡æ¥ã€‚</p>
<h3 data-id="heading-4">cherry-pick</h3>
<p>æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ° <code>cherry-pick</code> çš„ç”¨æ³•è¿˜æ˜¯åœ¨ <code>Pulsar</code> ç¤¾åŒºé‡Œï¼Œç»å¸¸çœ‹åˆ°æœ‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fpulsar%2Fpull%2F24571" target="_blank" title="https://github.com/apache/pulsar/pull/24571" ref="nofollow noopener noreferrer">PR</a> å°†æŸä¸ªåœ¨ main åˆ†æ”¯çš„ç‰¹æ€§ cherry-pick åˆ°å…¶ä»–åˆ†æ”¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d2700afcb9141dc8cfaa924e001509c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY3Jvc3NvdmVySmll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764040065&amp;x-signature=D%2BbIGjBrIoQPYkwMVr2x3UrESOE%3D" alt="" loading="lazy"/></p>
<p>æˆ–è€…æ˜¯ä¸€äº›é‡è¦çš„å®‰å…¨æ›´æ–°ä¹Ÿéœ€è¦åœ¨ä¸€äº›ç»´æŠ¤ç‰ˆæœ¬çš„åˆ†æ”¯è¿›è¡Œä¿®å¤ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c889c23a6d84dbfa612b5d6311376ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY3Jvc3NvdmVySmll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764040065&amp;x-signature=RH6R8zCPBfTpnRwTQrXjcSv3Lio%3D" alt="" loading="lazy"/></p>
<p><code>cherry-pick</code> çš„ä¸»è¦ä½œç”¨æ˜¯å°†å…¶ä»–åˆ†æ”¯çš„ç‰¹å®šæäº¤ç²¾ç¡®åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼Œä»¥ä¾¿åœ¨ä¸åˆå¹¶æ•´ä¸ªåˆ†æ”¯çš„æƒ…å†µä¸‹åŒæ­¥ä¿®å¤ã€<code>hot-fix</code> æˆ–è€…æ˜¯å¤ç”¨ä»£ç ï¼›</p>
<p>ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">git checkout main 
git pull origin main 
git checkout -b main-feature
</code></pre>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åªpickä½ çœŸæ­£éœ€è¦çš„åŠŸèƒ½ç›¸å…³æäº¤</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">ä½ çš„æ ¸å¿ƒåŠŸèƒ½æäº¤1</span> 
git cherry-pick abc123 
<span class="hljs-meta prompt_">
# </span><span class="bash">ä½ çš„æ ¸å¿ƒåŠŸèƒ½æäº¤2</span>
git cherry-pick def456 ...
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08c1764b82a144348337705c133e928e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY3Jvc3NvdmVySmll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764040065&amp;x-signature=DL4opiPIJ41%2FQJR0aPRMyeuj7o0%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>è¿™é‡Œçš„ abc123 å’Œ def456 éƒ½æ˜¯æäº¤è®°å½•çš„ hash å€¼ï¼Œå¯ä»¥é€šè¿‡ git log å‘½ä»¤è·å–ï¼›ä¹Ÿå¯ä»¥åœ¨ github çš„æäº¤è®°å½•é¡µé¢å¤åˆ¶ã€‚</p>
</blockquote>
<p>å¦‚æœç¢°åˆ°å†²çªå…ˆè§£å†³ï¼Œç„¶åæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-shell" lang="shell">git cherry-pick --continue

git push origin main-feature
</code></pre>
<p>å‡è®¾å­˜åœ¨ä¸¤ä¸ªåˆ†æ”¯ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">    a - b - c - d   main
         \
           e - f - g main-feature
</code></pre>
<pre><code class="hljs language-shell" lang="shell">gitÂ cherry-pickÂ f
</code></pre>
<p>ç°åœ¨éœ€è¦å°† <code>main-feature</code> åˆ†æ”¯é‡Œçš„ <code>f</code> æäº¤åˆ° main åˆ†æ”¯ï¼Œcherry-pick ä¹‹åä¼šå˜æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">    a - b - c - d - f   main
         \
           e - f - g main-feature
</code></pre>
<p>f è¿™ä¸ªæäº¤å°±ä¼šè¢«è¿½åŠ åˆ°å¤´éƒ¨ã€‚</p>
<h2 data-id="heading-5">é€‚ç”¨åœºæ™¯</h2>
<p>cherry-pick ä¸»è¦åº”ç”¨ä¸ä¸€äº›å°çš„ä¿®å¤ï¼Œå®‰å…¨æ›´æ–°ã€ç´§æ€¥ bug çš„å¤„ç†ï¼Œå¦‚æœä¸€ä¸ªåˆ†æ”¯ä¸Šçš„å¤§éƒ¨åˆ† commit éƒ½è¦è¢« cherry-pick åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸å¦‚è€ƒè™‘ç›´æ¥ ä½¿ç”¨ merge æˆ–è€… rebaseã€‚</p>
<p>å°±åƒè¿™ä¸ªåŠŸèƒ½çš„åç§°ä¸€æ ·ï¼šæ‘˜æ¨±æ¡ƒã€‚é€‰æ‹©åˆé€‚çš„æœå­è¿›è¡Œæ‘˜å–ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰çš„æäº¤éƒ½åˆå¹¶è¿‡å»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HbuilderXè½½å…¥é¡¹ç›®ï¼Œè¿è¡Œåå”¤èµ·å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œæç¤ºï¼šError: Fail to open IDE,å”¤é†’ä¸èµ·æ¥æ€ä¹ˆåŠ]]></title>    <link>https://juejin.cn/post/7573597479981285412</link>    <guid>https://juejin.cn/post/7573597479981285412</guid>    <pubDate>2025-11-18T03:09:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573597479981285412" data-draft-id="7573615699957694506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HbuilderXè½½å…¥é¡¹ç›®ï¼Œè¿è¡Œåå”¤èµ·å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œæç¤ºï¼šError: Fail to open IDE,å”¤é†’ä¸èµ·æ¥æ€ä¹ˆåŠ"/> <meta itemprop="keywords" content="JavaScript,å¾®ä¿¡å°ç¨‹åº,uni-app"/> <meta itemprop="datePublished" content="2025-11-18T03:09:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éšç¬”è®°"/> <meta itemprop="url" content="https://juejin.cn/user/3491704660563581"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HbuilderXè½½å…¥é¡¹ç›®ï¼Œè¿è¡Œåå”¤èµ·å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œæç¤ºï¼šError: Fail to open IDE,å”¤é†’ä¸èµ·æ¥æ€ä¹ˆåŠ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3491704660563581/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éšç¬”è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:09:24.000Z" title="Tue Nov 18 2025 03:09:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¾…å†™ï¼Œæ•¬è¯·æœŸå¾…å§........</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java ç¼“å­˜ç²¾è¦]]></title>    <link>https://juejin.cn/post/7573592127298175026</link>    <guid>https://juejin.cn/post/7573592127298175026</guid>    <pubDate>2025-11-18T02:51:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573592127298175026" data-draft-id="7573589277004365862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java ç¼“å­˜ç²¾è¦"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:51:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¿¡ç ç”±ç¼°"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java ç¼“å­˜ç²¾è¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¿¡ç ç”±ç¼°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:51:18.000Z" title="Tue Nov 18 2025 02:51:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java ç¼“å­˜ç²¾è¦</h2>
<p><em>å®ç°æ›´ä½å»¶è¿Ÿã€é™ä½æˆæœ¬å¹¶èµ‹èƒ½æ™ºèƒ½ä½“æ¶æ„</em></p>
<p><strong>ä½œè€…ï¼šGRANVILLE BARNETT</strong></p>
<p><strong>æ¶æ„å¸ˆï¼ŒHAZELCAST</strong></p>
<blockquote>
<p>ç¼“å­˜æŠ€æœ¯åœ¨ç³»ç»Ÿä¸­çš„ä½œç”¨æ—¥ç›Šé‡è¦ï¼Œå¯¹äºå¤§è§„æ¨¡è§£é”ä¼—å¤šç”¨ä¾‹è‡³å…³é‡è¦ã€‚å‡ åå¹´æ¥ï¼Œç¼“å­˜å·²å®ç°ä½æˆæœ¬ã€å¯æ‰©å±•åœ°è®¿é—®ä¼šè¯çŠ¶æ€å’Œæ•°æ®å­˜å‚¨ç­‰ä¿¡æ¯ã€‚æ›´ç°ä»£çš„ç¼“å­˜ç”¨ä¾‹æ­£åœ¨å®ç°ä½æˆæœ¬ã€å¯æ‰©å±•çš„å·¥å…·é“¾ï¼Œå¹¶åœ¨æ™ºèƒ½ä½“æ¶æ„ä¸­å®ç°åµŒå…¥ç”Ÿæˆï¼Œè¿™æ­£åœ¨è§£é”ä¸‹ä¸€ä»£ç³»ç»Ÿåˆ›æ–°ã€‚</p>
</blockquote>
<p>æœ¬å‚è€ƒèµ„æ–™å¡ä»‹ç»äº†ä½¿ç”¨ Java çš„ JCacheï¼ˆJava ä¸´æ—¶ç¼“å­˜ APIï¼‰å°†ç¼“å­˜èå…¥ç³»ç»Ÿçš„æ–¹æ³•ã€‚æ–‡ä¸­é¦–å…ˆè®¨è®ºäº†ç¼“å­˜çš„åŸºç¡€çŸ¥è¯†ï¼Œç„¶åé€šè¿‡ä»£ç ç¤ºä¾‹ç®€è¦ä»‹ç»äº† JCache APIï¼Œæœ€åæ€»ç»“äº†ç¼“å­˜éƒ¨ç½²æ¶æ„ã€‚</p>
<h3 data-id="heading-1">ç¼“å­˜æ¦‚è¿°</h3>
<p><strong>ç¼“å­˜</strong>æ˜¯å…ˆå‰è®¡ç®—ç»“æœçš„ä¸€ä¸ªå­˜å‚¨ï¼Œä»¥ä¾¿å¯ä»¥çœç•¥åç»­è®¡ç®—ã€‚ç†è§£ç¼“å­˜æœ€ç®€å•çš„æ–¹å¼æ˜¯å°†å…¶è§†ä¸ºé”®å€¼å­˜å‚¨ï¼šå¯¹äºç»™å®šçš„è¾“å…¥ï¼ˆé”®ï¼‰ï¼Œè¾“å‡ºï¼ˆå€¼ï¼‰ä»£è¡¨å…ˆå‰åŸºäºè¯¥è¾“å…¥è®¡ç®—å‡ºçš„ç»“æœã€‚</p>
<p><strong>ç¼“å­˜å‘½ä¸­</strong>è¡¨ç¤ºç‰¹å®šæ•°æ®å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨å…¶å€¼ã€‚å¦åˆ™ï¼Œå°±ä¼šå‘ç”Ÿ<strong>ç¼“å­˜æœªå‘½ä¸­</strong>ï¼Œæ­¤æ—¶éœ€è¦æ‰§è¡Œç›¸å…³è®¡ç®—å¹¶å°†å…¶è¾“å‡ºæ”¾å…¥ç¼“å­˜ã€‚ç¼“å­˜æœªå‘½ä¸­çš„ä»£ä»·å¯èƒ½é™¤äº†æ˜‚è´µçš„è®¡ç®—æ“ä½œå¤–ï¼Œè¿˜æ¶‰åŠç½‘ç»œé€šä¿¡ã€‚</p>
<p><strong>å›¾ 1ï¼š</strong> ç®€åŒ–çš„ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­æµç¨‹</p>
<p><img src="https://cf-blog.icodebuddy.com/image/88/88-1.png" alt="" loading="lazy"/></p>
<p>é‡‡ç”¨ç¼“å­˜æ˜¯ä¸ºäº†å‡å°‘å»¶è¿Ÿå¹¶é™ä½è¿è¥æˆæœ¬ï¼Œå‡ åå¹´æ¥å¯¹äºå®ç°ä¼—å¤šç±»åˆ«çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚ç¼“å­˜æ•°æ®çš„ä¾‹å­åŒ…æ‹¬ Web åº”ç”¨ç¨‹åºçš„ä¼šè¯çŠ¶æ€ã€æ•°æ®åº“æŸ¥è¯¢ç»“æœã€ç½‘é¡µæ¸²æŸ“ç»“æœï¼Œä»¥åŠæ¥è‡ªé€šç”¨ç½‘ç»œå’Œè®¡ç®—æˆæœ¬é«˜æ˜‚çš„æ“ä½œçš„ç»“æœã€‚</p>
<p>ç¼“å­˜çš„ä¸€ä¸ªæ›´ç°ä»£çš„ç”¨é€”æ˜¯åœ¨ AI é¢†åŸŸã€‚åœ¨è¿™é‡Œï¼Œç¼“å­˜çš„ä½¿ç”¨å‡å°‘äº†æ˜‚è´µçš„ API è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼ŒåµŒå…¥ç”Ÿæˆï¼‰ï¼Œå¹¶æœ€å¤§é™åº¦åœ°å‡å°‘äº†æ™ºèƒ½ä½“æ¶æ„ä¸­æ™ºèƒ½ä½“ä¹‹é—´çš„å¯¹è¯æ–­ç»­ï¼ˆä¾‹å¦‚ï¼Œç”±äºå·¥å…·è°ƒç”¨å’Œç½‘ç»œé€šä¿¡æ‰€è‡´ï¼‰ï¼Œä»è€Œè§£é”äº†æ–°ä¸€æ³¢çš„è§£å†³æ–¹æ¡ˆå’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p>ç¼“å­˜å¯ä»¥é©»ç•™åœ¨è¿›ç¨‹å†…ï¼Œä½œä¸ºå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„çš„ä¸€éƒ¨åˆ†å­˜åœ¨äºæœåŠ¡ä¸­ï¼Œæˆ–è€…æ˜¯ä¸¤è€…çš„ç»“åˆã€‚æ­¤å¤–ï¼Œç¼“å­˜çš„éƒ¨ç½²é€šå¸¸å¯ä»¥ç»„åˆã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¸ä½äºåŒä¸€æ•°æ®ä¸­å¿ƒçš„ç¼“å­˜æœåŠ¡é€šä¿¡ï¼Œè€Œæ•°æ®ä¸­å¿ƒçš„æœ¬åœ°ç¼“å­˜åˆæ˜¯è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒçš„ç¼“å­˜çš„ç¼“å­˜ã€‚è¿™ç§çµæ´»æ€§ï¼ŒåŠ ä¸Šç¼“å­˜æ‰€æ”¯æŒçš„åº”ç”¨ç±»åˆ«ï¼Œä½¿å¾—ç¼“å­˜åœ¨è¿‡å»å‡ åå¹´ä¸­æˆä¸ºä¸€ç§ä¸»å¯¼çš„æŠ½è±¡æ¦‚å¿µã€‚</p>
<p>æœ¬å‚è€ƒèµ„æ–™å¡çš„å‰©ä½™éƒ¨åˆ†å°†è®¨è®º JCacheâ€”â€”Java ç”¨äºå°†ç¼“å­˜èå…¥åº”ç”¨ç¨‹åºçš„æŠ½è±¡â€”â€”é¦–å…ˆç®€è¦æ¦‚è¿°æ‚¨å°†ç»å¸¸ä½¿ç”¨çš„ç±»ï¼Œç„¶åæ·±å…¥æ¢è®¨ JCache æ›´å¹¿æ³›åŠŸèƒ½æ‰€æä¾›çš„ç‰¹æ€§ã€‚æœ€åï¼Œæˆ‘ä»¬å°†æ€»ç»“ç¼“å­˜éƒ¨ç½²ç­–ç•¥ã€‚</p>
<h3 data-id="heading-2">JCACHE ç²¾è¦</h3>
<p>JCache åœ¨ Java è§„èŒƒè¯·æ±‚ï¼ˆJSRï¼‰107 ä¸­å¼•å…¥ï¼Œå¹¶æä¾›äº†ä¸€å¥—å…³äºç¼“å­˜çš„æŠ½è±¡ã€‚JCache æœ‰ä¸¤ä¸ªçªå‡ºçš„ç‰¹æ€§ï¼š</p>
<ul>
<li>
<p><strong>JCache æ˜¯ä¸€ä¸ªè§„èŒƒã€‚</strong> JSR æ˜¯ç”±ä¸“å®¶ç»„è®¾è®¡å’Œæäº¤ï¼Œå¹¶æœ€ç»ˆç”± Java ç¤¾åŒºè¿‡ç¨‹æ‰§è¡Œå§”å‘˜ä¼šæ‰¹å‡†çš„è§„èŒƒã€‚å› ä¸º JCache æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œæ‰€ä»¥å®ƒä¸é‚£äº› API é¢‘ç¹å˜åŒ–çš„å®ç°éš”ç¦»å¼€æ¥ã€‚</p>
</li>
<li>
<p><strong>JCache æ˜¯æä¾›å•†ç‹¬ç«‹çš„ã€‚</strong> JCache ä½œä¸ºè§„èŒƒçš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼Œç¼“å­˜è§£å†³æ–¹æ¡ˆæä¾›å•†å¯ä»¥é€šè¿‡å®ç°å…¶æš´éœ²çš„<em>æœåŠ¡æä¾›ç¨‹åºæ¥å£</em>ï¼ˆSPIï¼‰æ¥ä¸ JCache é›†æˆã€‚è¿™ä¸ºç³»ç»Ÿè®¾è®¡è€…æä¾›äº†çµæ´»æ€§å¹¶é¿å…äº†ä¾›åº”å•†é”å®šã€‚</p>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ JCache ç¤ºä¾‹ï¼Œä»¥ä¾¿ç†è§£å…¶ä½¿ç”¨æ–¹å¼ã€‚<code>javax.cache</code> ä¾èµ–é¡¹çš„è·å–æ–¹å¼å¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fjavax.cache%2Fcache-api" target="_blank" title="https://mvnrepository.com/artifact/javax.cache/cache-api" ref="nofollow noopener noreferrer">æ­¤å¤„</a>æ‰¾åˆ°ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">import</span> javax.cache.Cache;

<span class="hljs-keyword">import</span> javax.cache.CacheManager;

<span class="hljs-keyword">import</span> javax.cache.Caching;

<span class="hljs-keyword">import</span> javax.cache.configuration.MutableConfiguration;

<span class="hljs-keyword">import</span> javax.cache.spi.CachingProvider;

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {

<span class="hljs-type">CachingProvider</span> <span class="hljs-variable">cachingProvider</span> <span class="hljs-operator">=</span> Caching.getCachingProvider(); <span class="hljs-comment">// (1)</span>

<span class="hljs-type">CacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> cachingProvider.getCacheManager(); <span class="hljs-comment">// (2)</span>

MutableConfiguration&lt;String, String&gt; cacheConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableConfiguration</span>&lt;String, String&gt;(); <span class="hljs-comment">// (3)</span>

Cache&lt;String, String&gt; cache = cacheManager.createCache(<span class="hljs-string">"dzone-cache"</span>, cacheConfig); <span class="hljs-comment">// (4)</span>

cache.put(<span class="hljs-string">"England"</span>, <span class="hljs-string">"London"</span>); <span class="hljs-comment">// (5)</span>

cache.putAll(Map.of(<span class="hljs-string">"France"</span>, <span class="hljs-string">"Paris"</span>, <span class="hljs-string">"Ireland"</span>, <span class="hljs-string">"Dublin"</span>)); <span class="hljs-comment">// (6)</span>

<span class="hljs-keyword">assert</span> cache.get(<span class="hljs-string">"England"</span>).equals(<span class="hljs-string">"London"</span>); <span class="hljs-comment">// (7)</span>

<span class="hljs-keyword">assert</span> cache.get(<span class="hljs-string">"Italy"</span>) == <span class="hljs-literal">null</span>; <span class="hljs-comment">// (8)</span>

}

}

</code></pre>
<p>å¯¹ä¸Šè¿°ç¤ºä¾‹çš„ç®€è¦è¯´æ˜ï¼š</p>
<p>(1) è·å–åº•å±‚ç¼“å­˜æä¾›ç¨‹åºçš„å¥æŸ„</p>
<p>(2) ç®¡ç†ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºå’Œé”€æ¯ç¼“å­˜ï¼‰</p>
<p>(3) å…è®¸å¯ç”¨/ç¦ç”¨ç¼“å­˜çš„ç‰¹å®šåŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œç»Ÿè®¡ä¿¡æ¯ã€æ¡ç›®ç›‘å¬å™¨ï¼‰</p>
<p>(4) åˆ›å»ºç”±ç¼“å­˜æä¾›ç¨‹åºæ”¯æŒçš„ç¼“å­˜</p>
<p>(5) åœ¨ç¼“å­˜ä¸­æ”¾å…¥å•ä¸ªé”®å€¼æ¡ç›®</p>
<p>(6) å°†é”®å€¼æ¡ç›®æ”¾å…¥ç¼“å­˜</p>
<p>(7) æ–­è¨€ç¼“å­˜æ¡ç›®çš„å­˜åœ¨</p>
<p>(8) æ–­è¨€æŸä¸ªæ¡ç›®ä¸åœ¨ç¼“å­˜ä¸­</p>
<p>æœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†å°†æ›´è¯¦ç»†åœ°è®¨è®ºä¸Šè¿°ç¤ºä¾‹ä¸­å¼•å…¥çš„æŠ½è±¡ï¼Œä»¥åŠæ‚¨å°†ç»å¸¸é‡åˆ°çš„ç›¸å…³ç±»çš„å…¶ä»–æ–¹æ³•ã€‚</p>
<p><code>javax.cache.spi.CachingProvider</code> æ„æˆäº† JCache SPIï¼Œç¼“å­˜æä¾›è€…å¯ä»¥ä¸ä¹‹é›†æˆã€‚æ‚¨å°†ä½¿ç”¨çš„æœ€å¸¸è§åŠŸèƒ½æ˜¯è·å–å¯¹ <code>CacheManager</code> çš„å¼•ç”¨ã€‚æˆ‘ä»¬ç¨åå°†è®¨è®º <code>Caching</code>ã€‚</p>
<p><code>getCacheManager</code> æ˜¯ <code>getCacheManager</code> å˜ä½“ä¸­æœ€ç®€å•çš„ä¸€ä¸ªã€‚è¿™å°†æ ¹æ®æä¾›è€…çš„é»˜è®¤è®¾ç½®è·å–ä¸€ä¸ª <code>CacheManager</code>ã€‚å¯ä»¥ä½¿ç”¨ <code>javax.cache.CacheManager</code> åˆ›å»ºå’Œé”€æ¯ç¼“å­˜ï¼š</p>
<ul>
<li>
<p><code>createCache</code> åˆ›å»ºä¸€ä¸ªå…·æœ‰ç»™å®šåç§°å’Œé…ç½®çš„ç¼“å­˜ã€‚</p>
</li>
<li>
<p><code>destroyCache</code> é”€æ¯å…·æœ‰ç»™å®šåç§°çš„ç¼“å­˜ã€‚</p>
</li>
</ul>
<p><code>javax.cache.Cache</code> æ˜¯å¯¹æä¾›è€…ç¼“å­˜çš„æŠ½è±¡ï¼Œå¹¶æš´éœ²äº†å°‘é‡ç”¨äºæŸ¥è¯¢å’Œå˜æ›´ç¼“å­˜é¡¹çš„æ“ä½œï¼š</p>
<ul>
<li>
<p><code>put</code> å’Œ <code>putAll</code> å°†æ¡ç›®æ”¾å…¥ç¼“å­˜ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•ä¸è¿”å›ä¸æ­£åœ¨æ”¾å…¥çš„é”®å…ˆå‰å…³è”çš„ä»»ä½•å€¼ã€‚</p>
</li>
<li>
<p><code>containsKey</code> æµ‹è¯•é”®æ˜¯å¦å­˜åœ¨äºç¼“å­˜ä¸­ã€‚</p>
</li>
<li>
<p><code>get</code> å’Œ <code>getAll</code> è¿”å›ä¸æŒ‡å®šé”®å…³è”çš„å€¼ã€‚</p>
</li>
<li>
<p><code>remove</code> å’Œ <code>removeAll</code> ä»ç¼“å­˜ä¸­ç§»é™¤é¡¹ã€‚</p>
</li>
</ul>
<h4 data-id="heading-3">JCACHE åŒ…</h4>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿæ¦‚è¿° <code>javax.cache</code> æ›´å¹¿æ³›åŒ…ç»“æ„ä¸­çš„ä¸€äº›é‡è¦æ¥å£ï¼Œå¹¶æä¾›å¸¸ç”¨åŠŸèƒ½çš„ç¤ºä¾‹ã€‚æˆ‘ä»¬å¯ä»¥å‚è€ƒæ–‡æ¡£æ¥æµè§ˆå…¶å†…å®¹çš„è¯¦å°½åˆ—è¡¨ã€‚</p>
<p><strong>å›¾ 2ï¼š</strong><code>javax.cache</code> çš„ç»„æˆåŒ…</p>
<p><img src="https://cf-blog.icodebuddy.com/image/88/88-2-1.png" alt="" loading="lazy"/></p>
<h5 data-id="heading-4">JAVAX.CACHE</h5>
<p>é€šç”¨ç®¡ç†ï¼ˆ<code>CacheManager</code>ï¼‰å’Œä¸ç¼“å­˜äº¤äº’ï¼ˆ<code>Cache</code>ï¼‰çš„è®¾æ–½ä½äº <code>javax.cache</code> åŒ…å†…ã€‚é™¤äº†åˆå§‹é…ç½®ä¹‹å¤–ï¼Œé™¤éæ‚¨æƒ³ä¸ºç¼“å­˜æ·»åŠ é¢å¤–åŠŸèƒ½ï¼Œå¦åˆ™ä»…ä½¿ç”¨æ­¤åŒ…ä¸­çš„ç±»å‹å°±å¯ä»¥å®Œæˆå¾ˆå¤šå·¥ä½œã€‚ä¾‹å¦‚ï¼Œ"JCache ç²¾è¦"éƒ¨åˆ†ä»‹ç»ä¸­çš„ç¤ºä¾‹ç”¨æ³•ä¸»è¦ä½¿ç”¨äº† <code>javax.cache</code> ä¸­å®šä¹‰çš„æ¥å£ã€‚</p>
<h5 data-id="heading-5">JAVAX.CACHE.CONFIGURATION</h5>
<p>åœ¨åˆ›å»ºç¼“å­˜æœŸé—´ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ·»åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚å¯ç”¨ç»Ÿè®¡ä¿¡æ¯æˆ–é€šè¯»ç¼“å­˜ã€‚æ­¤åŒ…æä¾›äº†ä¸€ä¸ª <code>Configuration</code> æ¥å£å’Œä¸€ä¸ªå®ç° <code>MutableConfiguration</code>ï¼Œå¯ç”¨äºæ­¤ç±»ç›®çš„ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// ...</span>

MutableConfiguration&lt;String, String&gt; cacheConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableConfiguration</span>&lt;String, String&gt;();

cacheConfig.setManagementEnabled(<span class="hljs-literal">true</span>).setStatisticsEnabled(<span class="hljs-literal">true</span>);

Cache&lt;String, String&gt; cache = cacheManager.createCache(<span class="hljs-string">"dzone-cache"</span>, cacheConfig);

</code></pre>
<h5 data-id="heading-6">JAVAX.CACHE.EXPIRY</h5>
<p>æœ‰æ—¶æ‚¨å¸Œæœ›é©»ç•™åœ¨ç¼“å­˜ä¸­çš„é¡¹è¿‡æœŸã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªå®¶åº­ä¿é™©æŠ¥ä»·çš„ç¼“å­˜ï¼Œæœ‰æ•ˆæœŸä¸º 24 å°æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿‡æœŸç­–ç•¥å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// ...</span>

MutableConfiguration&lt;String, Double&gt; cacheConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableConfiguration</span>&lt;String, Double&gt;();

cacheConfig.setExpiryPolicyFactory(CreatedExpiryPolicy.factoryOf(Duration.ONE_DAY));

Cache&lt;String, Double&gt; cache = cacheManager.createCache(<span class="hljs-string">"insurance-home-quotes"</span>, cacheConfig);

cache.put(quote.getId(), quote.getValue());

</code></pre>
<p><code>javax.cache.expiry</code> åŒ…æä¾›äº†é¢å¤–çš„è¿‡æœŸç­–ç•¥ï¼Œå¯èƒ½å¯¹å…¶ä»–åœºæ™¯æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code>AccessedExpiryPolicy</code> å…è®¸åŸºäºç¼“å­˜æ¡ç›®çš„æœ€åè®¿é—®æ—¶é—´é™„åŠ è¿‡æœŸè®¾ç½®ã€‚</p>
<h5 data-id="heading-7">JAVAX.CACHE.EVENT</h5>
<p>JCache çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½æ˜¯èƒ½å¤Ÿè®¢é˜…ç¼“å­˜äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨åˆ›å»ºæˆ–åˆ é™¤ç¼“å­˜æ¡ç›®åè¿è¡ŒæŸäº›é¢†åŸŸé€»è¾‘ã€‚<code>javax.cache.event</code> åŒ…æä¾›äº†å®ç°æ­¤åŠŸèƒ½çš„æŠ½è±¡ï¼Œç‰¹åˆ«æ˜¯è®¢é˜…ç¼“å­˜åˆ›å»ºã€æ›´æ–°ã€è¿‡æœŸå’Œç§»é™¤çš„èƒ½åŠ›ã€‚ä»¥ä¸‹åŸºæœ¬ç¤ºä¾‹åœ¨ç¼“å­˜æ¡ç›®åˆ›å»ºåè¿è¡ŒæŸäº›é¢†åŸŸé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// ...</span>

CacheEntryCreatedListener&lt;String, String&gt; createdListener = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntryCreatedListener</span>&lt;String, String&gt;() {

<span class="hljs-meta">@Override</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreated</span><span class="hljs-params">(Iterable&lt;CacheEntryEvent&lt;? extends String, ? extends String&gt;&gt; events)</span> <span class="hljs-keyword">throws</span> CacheEntryListenerException {

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c : events) {

performDomainLogic(c);

}

}

};

MutableConfiguration&lt;String, String&gt; cacheConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableConfiguration</span>&lt;String, String&gt;();

MutableCacheEntryListenerConfiguration&lt;String, String&gt; listenerConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableCacheEntryListenerConfiguration</span>&lt;&gt;(() -&gt; createdListener, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// è¯·å‚é˜…æ–‡æ¡£</span>

cacheConfig.addCacheEntryListenerConfiguration(listenerConfig);

Cache&lt;String, String&gt; cache = cacheManager.createCache(<span class="hljs-string">"events"</span>, cacheConfig);

cache.put(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>); <span class="hljs-comment">// è°ƒç”¨åˆ›å»ºç›‘å¬å™¨</span>

</code></pre>
<h5 data-id="heading-8">JAVAX.CACHE.PROCESSOR</h5>
<p>JCache çš„ä¸€ä¸ªå¼ºå¤§ç»„ä»¶æ˜¯èƒ½å¤Ÿä½¿ç”¨ <code>EntryProcessor</code> å°†è®¡ç®—ç§»è‡³æ•°æ®æ‰€åœ¨å¤„ï¼Œç„¶åä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨è¯¥è®¡ç®—ã€‚å½“ä½¿ç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒHazelcastï¼‰å†…æ‰˜ç®¡å…¶ç¼“å­˜çš„æä¾›è€…æ—¶ï¼Œè¿™å°¤å…¶å¼ºå¤§ï¼Œå› ä¸ºå®ƒä»¥å¾ˆå°‘çš„æŠ•å…¥ä¸ºåˆ†å¸ƒå¼è®¡ç®—æä¾›äº†ä¸€ä¸ªç®€å•çš„å…¥å£ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª <code>EntryProcessor</code> çš„ç®€å•ç¤ºä¾‹ï¼Œå®ƒå°† UUID é™„åŠ åˆ°ç¼“å­˜æ¡ç›®ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppendUuidEntryProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EntryProcessor</span>&lt;String, String, String&gt; {

<span class="hljs-meta">@Override</span>

<span class="hljs-keyword">public</span> String <span class="hljs-title function_">process</span><span class="hljs-params">(MutableEntry&lt;String, String&gt; entry, Object... arguments)</span> <span class="hljs-keyword">throws</span> EntryProcessorException {

<span class="hljs-keyword">if</span> (entry.exists()) {

<span class="hljs-type">String</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> entry.getValue() + <span class="hljs-string">"-"</span> + UUID.randomUUID();

entry.setValue(newValue);

<span class="hljs-keyword">return</span> newValue;

}

<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

}

}

<span class="hljs-comment">// ...</span>

cache.invoke(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppendUuidEntryProcessor</span>())

</code></pre>
<h5 data-id="heading-9">JAVAX.CACHE.MANAGEMENT</h5>
<p>JCache æä¾›çš„ç®¡ç†é’©å­éå¸¸å¼ºå¤§ä¸”æ˜“äºå¯ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å°ä»£ç ç‰‡æ®µæš´éœ²äº†ç”± Java ç®¡ç†æ‰©å±•ï¼ˆJMXï¼‰è§„èŒƒå®šä¹‰çš„æ‰˜ç®¡ Beanã€‚è¿™ä½¿å¾—è¯¸å¦‚ <code>jconsole</code> å’Œ JDK Mission Control ä¹‹ç±»çš„ JMX å®¢æˆ·ç«¯èƒ½å¤ŸæŸ¥çœ‹ç¼“å­˜é…ç½®å’Œç»Ÿè®¡ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå‘½ä¸­å’Œæœªå‘½ä¸­ç™¾åˆ†æ¯”ã€å¹³å‡è·å–å’Œæ”¾ç½®æ—¶é—´ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// ...</span>

MutableConfiguration&lt;String, String&gt; cacheConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableConfiguration</span>&lt;String, String&gt;();

cacheConfig.setManagementEnabled(<span class="hljs-literal">true</span>).setStatisticsEnabled(<span class="hljs-literal">true</span>);

Cache&lt;String, String&gt; cache = cacheManager.createCache(<span class="hljs-string">"management"</span>, cacheConfig);

<span class="hljs-comment">// ...</span>

</code></pre>
<h5 data-id="heading-10">JAVAX.CACHE.SPI</h5>
<p>"JCache ç²¾è¦"éƒ¨åˆ†æä¾›çš„ç¤ºä¾‹çœç•¥äº†æˆ‘ä»¬å¦‚ä½•æ³¨å†Œç¼“å­˜æä¾›è€…ï¼Œå³ä½¿ç”¨ JCache API ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºäº¤äº’çš„ç¼“å­˜å®¿ä¸»æœåŠ¡ã€‚è¿™å°±æ˜¯ JCache çš„ SPI ç»„ä»¶å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p>
<p>å®ç°è¿™ä¸€ç‚¹æœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p>
<ol>
<li>
<p>å°†æˆ‘ä»¬çš„ç¼“å­˜æä¾›è€…æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­</p>
</li>
<li>
<p>å‘Šè¯‰ JCache ä½¿ç”¨è¯¥æä¾›è€…</p>
</li>
</ol>
<p><strong>ç¬¬ä¸€æ­¥</strong>å¾ˆç®€å•ï¼šåªéœ€æ·»åŠ å¯¹ä»»ä½•ç¬¦åˆ JSR 107 æ ‡å‡†çš„æä¾›è€…çš„ä¾èµ–ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥</strong>æœ‰å‡ ç§é€šç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ <code>Caching#getCachingProvider(...)</code> çš„æŸä¸ªå˜ä½“ï¼ˆä»¥åŠå…¶ä»–æ–¹æ³•ï¼‰æ¥å‘Šè¯‰ JCacheã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ª <code>META-INF/services/javax.cache.spi.CachingProvider</code> æ–‡ä»¶ï¼Œå¹¶è®©å…¶æŒ‡å®šæä¾›è€…å®ç°ã€‚æŒ‡å®šçš„æä¾›è€…æ˜¯æ‚¨çš„æä¾›è€…çš„ç¼“å­˜æä¾›è€…å®ç°çš„å®Œå…¨é™å®šåç§°ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Caching#getCachingProvider()</code>ï¼›ä½†æ˜¯ï¼Œæœ€å¥½æ˜ç¡®é™å®šè¦ä½¿ç”¨çš„æä¾›è€…ï¼Œå› ä¸ºæ‚¨çš„ç±»è·¯å¾„ä¸Šå¯èƒ½æœ‰å¤šä¸ªæä¾›è€…ï¼Œè¿™ä¼šæŠ›å‡º <code>javax.cache.CacheException</code>ã€‚</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä½¿ç”¨ <code>CachingProvider Caching.getCachingProvider(String)</code> æŒ‡å®š Hazelcast ä¸ºæä¾›è€…ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-type">CachingProvider</span> <span class="hljs-variable">cachingProvider</span> <span class="hljs-operator">=</span> Caching.getCachingProvider(<span class="hljs-string">"com.hazelcast.cache.HazelcastCachingProvider"</span>);

<span class="hljs-type">CacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> cachingProvider.getCacheManager();

MutableConfiguration&lt;String, String&gt; cacheConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableConfiguration</span>&lt;String, String&gt;();

Cache&lt;String, String&gt; cache = cacheManager.createCache(<span class="hljs-string">"spi-example"</span>, cacheConfig);

cache.put(<span class="hljs-string">"k"</span>, <span class="hljs-string">"v"</span>);

</code></pre>
<h5 data-id="heading-11">JAVAX.CACHE.ANNOTATION</h5>
<p>JCache å®šä¹‰äº†è®¸å¤šæ³¨è§£ï¼Œç”¨äºé›†æˆåˆ°ä¸Šä¸‹æ–‡å’Œä¾èµ–æ³¨å…¥ç¯å¢ƒä¸­ã€‚Spring Framework åŸç”Ÿæ”¯æŒ JCache æ³¨è§£ã€‚æˆ‘ä»¬å¯ä»¥å‚è€ƒ JCache æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<h5 data-id="heading-12">JAVAX.CACHE.INTEGRATION</h5>
<p><code>javax.cache.integration</code> åŒ…æä¾›äº† <code>CacheLoader</code>ï¼ˆéœ€è¦é€šè¯»ï¼‰å’Œ <code>CacheWriter</code>ï¼ˆéœ€è¦é€šå†™ï¼‰ã€‚<code>CacheLoader</code> åœ¨å°†æ•°æ®è¯»å…¥ç¼“å­˜æ—¶ä½¿ç”¨â€”â€”ä¾‹å¦‚ <code>Cache#loadAll(...)</code>ã€‚<code>CacheWriter</code> å¯ä»¥ä½œä¸ºä¸€ä¸ªé›†æˆç‚¹ï¼Œå°†ç¼“å­˜å˜æ›´ï¼ˆä¾‹å¦‚ï¼Œå†™å…¥ã€åˆ é™¤ï¼‰ä¼ æ’­åˆ°å¤–éƒ¨å­˜å‚¨æœåŠ¡ã€‚</p>
<h4 data-id="heading-13">ç¼“å­˜éƒ¨ç½²</h4>
<p>JCache æ²¡æœ‰ç¼“å­˜éƒ¨ç½²ç­–ç•¥çš„æ¦‚å¿µï¼›å®ƒä»…ä»…æ˜¯ç¼“å­˜æä¾›è€…ä¹‹ä¸Šçš„ä¸€ä¸ª APIã€‚ç„¶è€Œï¼Œä¸åŒçš„æä¾›è€…æ”¯æŒä¸åŒç±»å‹çš„ç¼“å­˜éƒ¨ç½²ã€‚è¯·è€ƒè™‘å“ªç§ç¼“å­˜éƒ¨ç½²å¯¹æ‚¨çš„åº”ç”¨ç¨‹åºæœ‰æ„ä¹‰ï¼Œå¹¶ç”±æ­¤åå‘ç¡®å®šåˆé€‚çš„ç¼“å­˜æä¾›è€…ã€‚</p>
<p><strong>å›¾ 3ï¼š</strong> ç¼“å­˜éƒ¨ç½²ç¤ºä¾‹</p>
<p><img src="https://cf-blog.icodebuddy.com/image/88/88-3.png" alt="" loading="lazy"/></p>
<p>è¯·æ³¨æ„ï¼Œä¸€äº›ç¼“å­˜æä¾›è€…å¯èƒ½æ”¯æŒæ‰€æœ‰è¿™ä¸‰ç§ç¼“å­˜éƒ¨ç½²ï¼Œè€Œå…¶ä»–æä¾›è€…å¯èƒ½ä¸æ”¯æŒã€‚</p>
<p>æœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†è®¨è®ºå›¾ 2 ä¸­æ‰€ç¤ºçš„å¸¸è§ç¼“å­˜éƒ¨ç½²ï¼š</p>
<ul>
<li>
<p><strong>åµŒå…¥å¼</strong> â€“ ç¼“å­˜ä¸åº”ç”¨ç¨‹åºä½äºåŒä¸€è¿›ç¨‹ä¸­ã€‚</p>
</li>
<li>
<p><strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨</strong> â€“ ç¼“å­˜æ‰˜ç®¡åœ¨ç‹¬ç«‹çš„æœåŠ¡ä¸­ï¼Œå®¢æˆ·ç«¯ä¸è¯¥æœåŠ¡é€šä¿¡ä»¥ç¡®å®šç¼“å­˜é©»ç•™ã€‚</p>
</li>
<li>
<p><strong>åµŒå…¥å¼/å®¢æˆ·ç«¯-æœåŠ¡å™¨</strong> â€“ è¿™æ˜¯ä¸€ç§æ··åˆæ¨¡å¼ï¼Œæ•´ä¸ªç¼“å­˜æ‰˜ç®¡åœ¨ä¸åŒçš„æœåŠ¡ä¸Šï¼Œä½†å®¢æˆ·ç«¯åœ¨åŒä¸€è¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªè¾ƒå°çš„æœ¬åœ°ç¼“å­˜ã€‚</p>
</li>
</ul>
<p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä¸Šè¿°ç¼“å­˜éƒ¨ç½²å¹¶éäº’æ–¥çš„ï¼›å®ƒä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ç»„åˆä»¥æ»¡è¶³åº”ç”¨ç¨‹åºéœ€æ±‚ã€‚</p>
<p>æœ€ç®€å•çš„ç¼“å­˜éƒ¨ç½²æ˜¯è®©ç¼“å­˜ä¸åº”ç”¨ç¨‹åºé©»ç•™åœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æä¾›ä½å»¶è¿Ÿçš„ç¼“å­˜è®¿é—®ã€‚<strong>åµŒå…¥å¼</strong>ç¼“å­˜ä¸èƒ½åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«ï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºé‡å¯æˆ–æ•…éšœæ—¶ï¼Œå…¶æ‰˜ç®¡ï¼ˆå®ƒä»¬æ‰€éœ€çš„èµ„æºï¼‰å’Œé‡å»ºæˆæœ¬å¯èƒ½å¾ˆé«˜ã€‚</p>
<p><strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨</strong>ç¼“å­˜éƒ¨ç½²å°†ç¼“å­˜æ‰˜ç®¡åœ¨ä¸å®¢æˆ·ç«¯ä¸åŒçš„æœåŠ¡ä¸­ã€‚ç¼“å­˜æœåŠ¡å…è®¸é€šè¿‡è·¨æœåŠ¡å¤åˆ¶æ¥æ»¡è¶³å®¹é”™éœ€æ±‚ï¼Œæä¾›æ›´å¤§çš„å®¹é‡ã€æ›´å¤šçš„å¯æ‰©å±•æ€§é€‰é¡¹ï¼Œä»¥åŠè·¨åº”ç”¨ç¨‹åºå…±äº«ç¼“å­˜çš„èƒ½åŠ›ã€‚å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹çš„ä¸»è¦ç¼ºç‚¹åœ¨äºå®¢æˆ·ç«¯ç¼“å­˜æŸ¥è¯¢æœŸé—´ç½‘ç»œé€šä¿¡çš„æˆæœ¬ã€‚</p>
<p><strong>æ··åˆåµŒå…¥å¼/å®¢æˆ·ç«¯-æœåŠ¡å™¨éƒ¨ç½²</strong>æ˜¯æŒ‡æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªåµŒå…¥å¼ç¼“å­˜ï¼Œå®ƒåŒ…å«æ¥è‡ªæœåŠ¡ç¼“å­˜æ¡ç›®çš„ä¸€ä¸ªå­é›†ï¼Œä½œä¸ºåº”ç”¨ç¨‹åºç¼“å­˜è¯·æ±‚çš„å‰¯ä½œç”¨è¢«å¡«å……ã€‚åœ¨è¿™é‡Œï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹é¢‘ç¹è®¿é—®çš„æ•°æ®ï¼ˆæˆ–è¡¨ç°å‡ºç‰¹å®šè®¿é—®æ¨¡å¼çš„æ•°æ®ï¼‰å®ç°ä½å»¶è¿Ÿçš„ç¼“å­˜å‘½ä¸­ï¼Œå¹¶çœå»ä¸ç¼“å­˜æœåŠ¡é€šä¿¡æ‰€å¸¦æ¥çš„ç½‘ç»œé€šä¿¡å¼€é”€ã€‚å¦‚æœåµŒå…¥å¼ç¼“å­˜è¿‡æœŸï¼Œä¸€äº›æä¾›è€…ä¼šè´Ÿè´£ä½¿ç”¨æœåŠ¡æ‰˜ç®¡çš„ç¼“å­˜æ¥æ›´æ–°å®ƒä»¬ã€‚</p>
<h3 data-id="heading-14">ç»“è®º</h3>
<p>æœ¬å‚è€ƒèµ„æ–™å¡ä»‹ç»äº†ç¼“å­˜ä»¥åŠå¦‚ä½•å°†å…¶ä¸ Java çš„ JCache API ä¸€èµ·ä½¿ç”¨ã€‚JCache API ç›´è§‚ã€å¼ºå¤§ï¼Œå¹¶ä¸”ç”±äºå…¶æ˜¯ä¸€ä¸ªè§„èŒƒè€Œé¿å…äº†ä¾›åº”å•†é”å®šï¼Œä¸ºæ¶æ„å¸ˆå’Œç³»ç»Ÿè®¾è®¡è€…æä¾›äº†ä»–ä»¬æ‰€éœ€çš„çµæ´»æ€§ã€‚è¿™ç§çµæ´»æ€§åœ¨æˆ‘ä»¬è¿›å…¥åŸºäºæ™ºèƒ½ä½“æ¶æ„çš„æ–°ä¸€ä»£åˆ›æ–°æ—¶å°¤ä¸ºé‡è¦ï¼Œå…¶ä¸­ç¼“å­˜å¯¹äºå·¥å…·é“¾å’ŒåµŒå…¥ç”Ÿæˆè‡³å…³é‡è¦ã€‚</p>
<blockquote>
<p><strong>ä½œè€…ï¼šGRANVILLE BARNETT,</strong></p>
</blockquote>
<blockquote>
<p><strong>æ¶æ„å¸ˆï¼ŒHAZELCAST</strong></p>
</blockquote>
<blockquote>
<p>Granville Barnett æ‹¥æœ‰è®¡ç®—æœºç§‘å­¦åšå£«å­¦ä½ï¼Œæ˜¯æ‹¥æœ‰è¶…è¿‡ 15 å¹´ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸“å®¶ã€‚ä»–ç›®å‰æ˜¯ Hazelcast çš„æ¶æ„å¸ˆï¼Œæ­¤å‰æ›¾åœ¨ HP Labs å’Œ Microsoft ä»»èŒã€‚Granville æ‹¥æœ‰å¤šé¡¹ç¾å›½ä¸“åˆ©ï¼Œå¹¶å‘è¡¨äº†å…³äºç¨‹åºéªŒè¯ä¸»é¢˜çš„ç ”ç©¶ã€‚</p>
</blockquote>
<h3 data-id="heading-15">é™„åŠ èµ„æºï¼š</h3>
<ul>
<li>
<p>ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Frefcardz%2Fjava-application-containerization-and-deployment" target="_blank" title="https://dzone.com/refcardz/java-application-containerization-and-deployment" ref="nofollow noopener noreferrer">Java åº”ç”¨ç¨‹åºå®¹å™¨åŒ–ä¸éƒ¨ç½²</a>ã€‹ï¼Œä½œè€… Mark Hecklerï¼ŒDZone å‚è€ƒèµ„æ–™å¡</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjcp.org" target="_blank" title="https://jcp.org" ref="nofollow noopener noreferrer">Java ç¤¾åŒºè¿›ç¨‹</a></p>
</li>
</ul>
<hr/>
<p>ã€æ³¨ã€‘æœ¬æ–‡è¯‘è‡ªï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Frefcardz%2Fjava-caching" target="_blank" title="https://dzone.com/refcardz/java-caching" ref="nofollow noopener noreferrer">Java Caching Essentials</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React å¦‚ä½•å¤„ç†é«˜é¢‘çš„å®æ—¶æ•°æ®ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7573776814927364115</link>    <guid>https://juejin.cn/post/7573776814927364115</guid>    <pubDate>2025-11-18T03:11:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573776814927364115" data-draft-id="7573597479981219876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React å¦‚ä½•å¤„ç†é«˜é¢‘çš„å®æ—¶æ•°æ®ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-18T03:11:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mCell"/> <meta itemprop="url" content="https://juejin.cn/user/2280829967146779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React å¦‚ä½•å¤„ç†é«˜é¢‘çš„å®æ—¶æ•°æ®ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2280829967146779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mCell
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:11:05.000Z" title="Tue Nov 18 2025 03:11:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    24
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŒæ­¥è‡³ä¸ªäººç«™ç‚¹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fstack.mcell.top%2Fblog%2F2025%2F28_react_maximum" target="_blank" title="https://stack.mcell.top/blog/2025/28_react_maximum" ref="nofollow noopener noreferrer">React å¦‚ä½•å¤„ç†é«˜é¢‘çš„å®æ—¶æ•°æ®ï¼Ÿ</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c28c45f0085842a0afa8059415855f22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041710&amp;x-signature=aRVVMvlTrXeR%2FH1VDMFKJ8BUwA4%3D" alt="069.png" loading="lazy"/></p>
<p>æœ€è¿‘ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ React é—®é¢˜ã€‚</p>
<p>æˆ‘éœ€è¦å¼€å‘ä¸€ä¸ªå®æ—¶çš„æ—¥å¿—æŸ¥çœ‹å™¨ï¼ŒåŠŸèƒ½ä¸Šéœ€è¦å®æ—¶å±•ç¤ºæœåŠ¡è¿è¡Œçš„æ—¥å¿—ã€‚å› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯å†…éƒ¨çš„ï¼Œæˆ‘è¿™é‡Œå¤§æ¦‚æŠ½è±¡ä¸€ä¸‹ï¼š</p>
<p>åç«¯ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FServer-sent_events%2FUsing_server-sent_events" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events/Using_server-sent_events" ref="nofollow noopener noreferrer">SSEï¼ˆServer-Sent Eventsï¼‰</a> æŠ€æœ¯ï¼Œæºæºä¸æ–­åœ°æŠŠæ—¥å¿—æ¨é€ç»™å‰ç«¯ã€‚</p>
<p>å½“æ—¥å¿—ä¸€æ¡ä¸€æ¡ã€ä¸ç´§ä¸æ…¢åœ°è¿‡æ¥æ—¶ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“æˆ‘é¢„è§ˆä¸€ä¸ªå·²ç»å®Œæˆçš„ä»»åŠ¡æ—¥å¿—æ—¶ï¼Œç½‘é¡µå¡é¡¿äº†ä¸€ä¸‹ã€‚æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºäº†ä¸€ä¸ª React å¼€å‘è€…å¾ˆç†Ÿæ‚‰çš„é”™è¯¯ï¼š</p>
<blockquote>
<p><code>Uncaught Error: Maximum update depth exceeded...</code>
(é”™è¯¯ï¼šè¶…è¿‡æœ€å¤§æ›´æ–°æ·±åº¦)</p>
</blockquote>
<p>è¿™ä¸ªé”™è¯¯é€šå¸¸æ„å‘³ç€ï¼Œå­˜åœ¨ä»€ä¹ˆç»„ä»¶é™·å…¥äº†æ— é™å¾ªç¯ã€‚æ¯”å¦‚ï¼Œç»„ä»¶çš„æ¸²æŸ“å‡½æ•°é‡Œç›´æ¥è°ƒç”¨äº† <code>setState</code>ï¼Œå¯¼è‡´â€œæ¸²æŸ“ â†’ æ›´æ–°çŠ¶æ€ â†’ è§¦å‘æ¸²æŸ“ â†’ ...â€çš„æ­»å¾ªç¯ã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Demo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
}
</code></pre>
<p>ä½†æˆ‘çš„ä»£ç å¹¶æ²¡æœ‰è¿™æ ·çš„é€»è¾‘ï¼Œè¯¥ä½¿ç”¨ <code>useEffect</code> çš„åœ°æ–¹éƒ½ä½¿ç”¨äº†ã€‚æˆ‘åªæ˜¯åœ¨ SSE çš„äº‹ä»¶å›è°ƒé‡Œæ›´æ–°çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¤ºæ„ä»£ç </span>
<span class="hljs-keyword">const</span> source = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-string">"/api/logs"</span>)
source.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"log"</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// æ¯æ¥ä¸€æ¡æ—¥å¿—ï¼Œå°±è°ƒç”¨ set å‡½æ•°</span>
  <span class="hljs-title function_">appendLog</span>(event.<span class="hljs-property">data</span>)
})
</code></pre>
<p>é‚£ä¹ˆï¼Œé—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<h2 data-id="heading-0">é—®é¢˜çš„æ ¹æºï¼šé«˜é¢‘æ›´æ–°</h2>
<p>èµ·åˆæˆ‘ä»¥ä¸ºæ˜¯å“ªé‡Œçš„æ›´æ–°é€»è¾‘ä¸å¯¹ï¼Œè®© claude æ’æŸ¥å¾ˆä¹…éƒ½æ²¡æ‰¾åˆ°å…·ä½“é—®é¢˜ã€‚åœ¨ç»™ç°æœ‰å‡½æ•°å¢åŠ äº†ä¸å°‘ç¼“å­˜ï¼Œæ¯”å¦‚<code>useMemo</code>ï¼Œ<code>useCallback</code>ï¼Œç”šè‡³ <code>React.memo</code> éƒ½ä½¿ç”¨ä¸Šäº†ï¼Œä»æ—§æ²¡æœ‰è§£å†³è¿™ä¸ªæŠ¥é”™ã€‚</p>
<p>ä»£ç æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆé—®é¢˜å°±åº”è¯¥å‡ºç°åœ¨ä¸€äº›æç«¯åœºæ™¯å¯¼è‡´çš„é«˜é¢‘æ¸²æŸ“ã€‚æ¯”å¦‚ç½‘ç»œï¼Ÿæˆ‘æ‰æ‰“å¼€æ§åˆ¶å°çš„ç½‘ç»œéƒ¨åˆ†ï¼Œçœ‹åˆ°å‡ ä¹åœ¨å¾ˆçŸ­æ—¶é—´å†…ï¼Œä¸Šç™¾æ¡çš„ log è¢«æ¨é€è¿‡æ¥ï¼</p>
<p>åˆ°è¿™é‡Œé—®é¢˜å°±å’Œæ¸…æ™°äº†ï¼š<strong>å½“æœåŠ¡å™¨åœ¨çŸ­æ—¶é—´å†…ï¼ˆæ¯”å¦‚ 1 ç§’å†…ï¼‰æ¨é€ä¸Šç™¾æ¡æ—¥å¿—æ—¶ï¼Œæ¯ä¸€ä¸ª log éƒ½è§¦å‘äº† React è¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œè¿™é‡Œè§¦å‘äº† React çš„æŸäº›æœºåˆ¶ï¼ŒReact å¯¹è¿™ç§è¡Œä¸ºå‘å‡ºäº†æŠ¥é”™ã€‚</strong></p>
<p>React å†…éƒ¨æœ‰ä¸€ä¸ªâ€œåµŒå¥—æ›´æ–°è®¡æ•°å™¨â€ï¼Œç”¨æ¥é˜²æ­¢æ— é™å¾ªç¯ã€‚</p>
<p>ç®€å•è¯´ï¼Œå¦‚æœåœ¨ä¸€æ¬¡æ¸²æŸ“ï¼ˆRenderï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œåˆå› ä¸ºæŸäº›åŸå› è§¦å‘äº†æ–°çš„çŠ¶æ€æ›´æ–°ï¼Œè¿™å°±å«â€œåµŒå¥—æ›´æ–°â€ã€‚å½“è¿™ä¸ªæ¬¡æ•°çŸ­æ—¶é—´å†…è¶…è¿‡ä¸€ä¸ªé˜ˆå€¼ï¼ˆé€šå¸¸æ˜¯ 50 æ¬¡ï¼‰ï¼ŒReact å°±ä¼šè®¤ä¸ºä½ â€œå¯èƒ½â€å†™äº†ä¸€ä¸ª Bugï¼Œäºæ˜¯ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ï¼Œç»ˆæ­¢ç¨‹åºã€‚</p>
<p>æˆ‘ä»¬çš„é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œã€‚SSE çš„äº‹ä»¶å›è°ƒæ¥å¾—å¤ªå¿«äº†ã€‚</p>
<p>å½“æœåŠ¡å™¨åœ¨ 1 ç§’å†…æ¨é€ 150 æ¡æ—¥å¿—æ—¶ï¼Œæµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯ä¼šç–¯ç‹‚æ‰§è¡Œå›è°ƒï¼š</p>
<ol>
<li>SSE äº‹ä»¶ 1 æŠµè¾¾ â†’ <code>appendLog()</code> â†’ è§¦å‘ React æ›´æ–°ï¼ˆç¬¬ 1 æ¬¡ï¼‰</li>
<li>React è¿˜æ²¡æ¥å¾—åŠæ¸²æŸ“ï¼ŒSSE äº‹ä»¶ 2 æŠµè¾¾ â†’ <code>appendLog()</code> â†’ è§¦å‘ React æ›´æ–°ï¼ˆç¬¬ 2 æ¬¡ï¼‰</li>
<li>...</li>
<li>SSE äº‹ä»¶ 50 æŠµè¾¾ â†’ <code>appendLog()</code> â†’ è§¦å‘ React æ›´æ–°ï¼ˆç¬¬ 50 æ¬¡ï¼‰</li>
<li>SSE äº‹ä»¶ 51 æŠµè¾¾ â†’ <code>appendLog()</code> â†’ è§¦å‘ React æ›´æ–°ï¼ˆç¬¬ 51 æ¬¡ï¼‰</li>
</ol>
<p>åœ¨ React çœ‹æ¥ï¼Œè¿™ 51 æ¬¡æ›´æ–°å‡ ä¹æ˜¯â€œåŒæ—¶â€å‘ç”Ÿçš„ï¼Œå®ƒæ— æ³•åˆ†è¾¨è¿™æ˜¯â€œ51 æ¡ç‹¬ç«‹æ—¥å¿—â€è¿˜æ˜¯â€œä¸€ä¸ªæ­»å¾ªç¯â€ã€‚ä¸ºäº†ä¿æŠ¤è‡ªå·±ï¼Œå®ƒé€‰æ‹©äº†æŠ¥é”™ã€‚</p>
<p><strong>é—®é¢˜çš„æœ¬è´¨æ˜¯ï¼šæ•°æ®æ¥æ”¶çš„é¢‘ç‡ï¼ˆé«˜é¢‘ï¼‰å’Œ React çŠ¶æ€æ›´æ–°çš„é¢‘ç‡ï¼ˆä½é¢‘ï¼‰ä¸åŒ¹é…ã€‚</strong></p>
<p>æˆ‘ä»¬ä¸èƒ½æ¯æ”¶åˆ°ä¸€æ¡æ•°æ®ï¼Œå°±ç«‹åˆ»æ›´æ–°ä¸€æ¬¡çŠ¶æ€ã€‚</p>
<blockquote>
<p>åç»­æˆ‘äº†è§£åˆ° React 18 ç‰ˆæœ¬å¯¹é«˜é¢‘æ¸²æŸ“çš„é—®é¢˜è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†å®ƒç›®å‰ä»…é€‚ç”¨äº React äº‹ä»¶å¤„ç†å‡½æ•°å†…çš„åŒæ­¥æ›´æ–°ã€‚å¯¹äº SSE å›è°ƒã€fetch å›è°ƒã€setInterval ç­‰å¼‚æ­¥äº‹ä»¶æºè§¦å‘çš„æ›´æ–°ï¼Œä»éœ€æ‰‹åŠ¨å®ç°æ‰¹å¤„ç†ã€‚</p>
</blockquote>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆï¼šæ‰¹å¤„ç†ï¼ˆBatchingï¼‰</h2>
<p>æ—¢ç„¶ä¸èƒ½ä¸€æ¡ä¸€æ¡åœ°æ›´æ–°ï¼Œé‚£å¾ˆè‡ªç„¶å°±æƒ³åˆ°ï¼Œèƒ½ä¸èƒ½æŠŠæ—¥å¿—â€œæ”’ä¸€ä¸‹â€ï¼Œå†ä¸€æ¬¡æ€§æäº¤ç»™ Reactï¼Ÿ</p>
<p>è¿™å°±æ˜¯â€œæ‰¹å¤„ç†â€ï¼ˆBatchingï¼‰æ€æƒ³ã€‚</p>
<p>æˆ‘ä»¬ä¸å†æ˜¯â€œæ¥ä¸€æ¡ï¼Œæ›´æ–°ä¸€æ¬¡â€ï¼Œè€Œæ˜¯â€œæ¥ N æ¡ï¼Œæ›´æ–°ä¸€æ¬¡â€ã€‚</p>
<p>å®ç°è¿™ä¸ªåŠŸèƒ½çš„å…³é”®ï¼Œæ˜¯éœ€è¦ä¸€ä¸ªâ€œç¼“å†²åŒºâ€ï¼ˆBufferï¼‰å’Œä¸€ä¸ªâ€œå®šæ—¶å™¨â€ï¼ˆTimerï¼‰ã€‚</p>
<ol>
<li><strong>ç¼“å†²åŒº</strong>ï¼šéœ€è¦ä¸€ä¸ªåœ°æ–¹æš‚å­˜æ—¥å¿—ï¼Œä½†è¿™ä¸ªåœ°æ–¹æœ¬èº«ä¸èƒ½æ˜¯ React çš„ <code>state</code>ï¼ˆå¦åˆ™åˆè§¦å‘æ¸²æŸ“äº†ï¼‰ã€‚<code>useRef</code> æ˜¯æœ€åˆé€‚çš„äººé€‰ã€‚</li>
<li><strong>å®šæ—¶å™¨</strong>ï¼šéœ€è¦ä¸€ä¸ªæœºåˆ¶ï¼Œåœ¨â€œæ”’â€æ—¥å¿—çš„é—´éš™ï¼ŒæŠŠå®ƒä»¬ç»Ÿä¸€æäº¤ã€‚<code>setTimeout(..., 0)</code> æ˜¯è¿™é‡Œçš„æ³•å®ã€‚</li>
</ol>
<h2 data-id="heading-2">ä»£ç å®ç°</h2>
<p>æˆ‘ä»¬æ¥æ”¹é€ ä¸€ä¸‹ <code>log</code> äº‹ä»¶çš„å¤„ç†ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨ç»„ä»¶é‡Œå®šä¹‰ç¼“å†²åŒºå’Œå®šæ—¶å™¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LogPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. ä» store è·å–æ‰¹é‡æ›´æ–°çš„æ–¹æ³•</span>
  <span class="hljs-keyword">const</span> appendLogs = <span class="hljs-title function_">useLogStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">appendLogs</span>)

  <span class="hljs-comment">// 2. æ‰¹å¤„ç†ç¼“å†²åŒºï¼ˆä½¿ç”¨ ref ä¸ä¼šè§¦å‘æ¸²æŸ“ï¼‰</span>
  <span class="hljs-keyword">const</span> batchBufferRef = <span class="hljs-title function_">useRef</span>([])

  <span class="hljs-comment">// 3. å®šæ—¶å™¨å¼•ç”¨ï¼ˆä¿è¯åªæœ‰ä¸€ä¸ªå®šæ—¶å™¨åœ¨è¿è¡Œï¼‰</span>
  <span class="hljs-keyword">const</span> batchTimerRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>)

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å…¶æ¬¡ï¼Œå®ç°ä¸€ä¸ªâ€œæäº¤ç¼“å†²åŒºâ€çš„å‡½æ•° <code>flushBatch</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 4. æ‰¹é‡æäº¤å‡½æ•°</span>
<span class="hljs-keyword">const</span> flushBatch = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// å¦‚æœç¼“å†²åŒºæœ‰æ•°æ®</span>
  <span class="hljs-keyword">if</span> (batchBufferRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// ä¸€æ¬¡æ€§æäº¤ç»™ store</span>
    <span class="hljs-title function_">appendLogs</span>(batchBufferRef.<span class="hljs-property">current</span>)
    <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>
    batchBufferRef.<span class="hljs-property">current</span> = []
  }
  <span class="hljs-comment">// é‡ç½®å®šæ—¶å™¨å¼•ç”¨</span>
  batchTimerRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>
}, [appendLogs]) <span class="hljs-comment">// ä¾èµ– appendLogs</span>
</code></pre>
<p>æœ€åï¼Œä¿®æ”¹ SSE çš„äº‹ä»¶å¤„ç†å‡½æ•° <code>handleLogEvent</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 5. æ–°çš„ SSE äº‹ä»¶å¤„ç†å‡½æ•°</span>
<span class="hljs-keyword">const</span> handleLogEvent = <span class="hljs-title function_">useCallback</span>(
  <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> entry = {
      <span class="hljs-comment">/* ...è§£ææ—¥å¿—... */</span>
    }

    <span class="hljs-comment">// é‡ç‚¹ï¼šä¸å†ç›´æ¥è°ƒç”¨ appendLog</span>
    <span class="hljs-comment">// è€Œæ˜¯å°†æ—¥å¿—åŠ å…¥ç¼“å†²åŒº</span>
    batchBufferRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">push</span>(entry)

    <span class="hljs-comment">// å¦‚æœè¿˜æ²¡æœ‰è®¡åˆ’æ‰¹å¤„ç†ï¼Œåˆ™åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œ</span>
    <span class="hljs-keyword">if</span> (batchTimerRef.<span class="hljs-property">current</span> === <span class="hljs-literal">null</span>) {
      batchTimerRef.<span class="hljs-property">current</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(flushBatch, <span class="hljs-number">0</span>)
    }
  },
  [flushBatch] <span class="hljs-comment">// ä¾èµ– flushBatch</span>
)
</code></pre>
<h2 data-id="heading-3">ä¸ºä»€ä¹ˆæ˜¯ <code>setTimeout(..., 0)</code>ï¼Ÿ</h2>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆæ˜¯ <code>setTimeout(..., 0)</code>ï¼Ÿ</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå·§å¦™çš„æŠ€å·§ã€‚å®ƒå¹¶ä¸æ˜¯çœŸçš„â€œå»¶è¿Ÿ 0 æ¯«ç§’â€ï¼Œè€Œæ˜¯å‘Šè¯‰æµè§ˆå™¨ï¼š<strong>â€œè¯·åœ¨å½“å‰è¿™ä¸€è½®äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰çš„åŒæ­¥ä»£ç éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œå†æ‰§è¡Œè¿™ä¸ª <code>flushBatch</code> å‡½æ•°ã€‚â€</strong></p>
<p>å½“ 150 æ¡æ—¥å¿—åœ¨çŸ­æ—¶é—´å†…æ¶Œå…¥æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<ol>
<li>äº‹ä»¶ 1 æŠµè¾¾ â†’ <code>push</code> åˆ°ç¼“å†²åŒº â†’ <code>setTimeout</code> æ³¨å†Œä¸€ä¸ª <code>flushBatch</code> å›è°ƒã€‚</li>
<li>äº‹ä»¶ 2 æŠµè¾¾ â†’ <code>push</code> åˆ°ç¼“å†²åŒº â†’ æ£€æŸ¥å®šæ—¶å™¨ï¼Œå‘ç°å·²æœ‰ï¼Œè·³è¿‡ã€‚</li>
<li>äº‹ä»¶ 3 æŠµè¾¾ â†’ <code>push</code> åˆ°ç¼“å†²åŒº â†’ è·³è¿‡ã€‚</li>
<li>...</li>
<li>äº‹ä»¶ 150 æŠµè¾¾ â†’ <code>push</code> åˆ°ç¼“å†²åŒº â†’ è·³è¿‡ã€‚</li>
<li>ï¼ˆå½“å‰å®ä»»åŠ¡ç»“æŸï¼Œæ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼‰</li>
<li>æµè§ˆå™¨ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡º <code>flushBatch</code> å›è°ƒï¼Œæ‰§è¡Œã€‚</li>
<li><code>flushBatch</code> å‡½æ•°å°† 150 æ¡æ—¥å¿—ä¸€æ¬¡æ€§æäº¤ç»™ Reactã€‚</li>
</ol>
<p>äºæ˜¯ï¼Œ150 æ¬¡ <code>setState</code> è°ƒç”¨ï¼Œè¢«ç¥å¥‡åœ°åˆå¹¶æˆäº† 1 æ¬¡ã€‚åº”ç”¨æµç•…å¦‚åˆã€‚</p>
<p>ï¼ˆå®Œï¼‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git å‘½ä»¤åŸºç¡€ä½¿ç”¨æŒ‡å—ï¼šä»åˆå§‹åŒ–åˆ°æäº¤çš„å®Œæ•´æµç¨‹]]></title>    <link>https://juejin.cn/post/7573631442312560646</link>    <guid>https://juejin.cn/post/7573631442312560646</guid>    <pubDate>2025-11-18T03:13:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573631442312560646" data-draft-id="7573615699957792810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git å‘½ä»¤åŸºç¡€ä½¿ç”¨æŒ‡å—ï¼šä»åˆå§‹åŒ–åˆ°æäº¤çš„å®Œæ•´æµç¨‹"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-11-18T03:13:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç›®å—æ®‡"/> <meta itemprop="url" content="https://juejin.cn/user/2095013427691667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git å‘½ä»¤åŸºç¡€ä½¿ç”¨æŒ‡å—ï¼šä»åˆå§‹åŒ–åˆ°æäº¤çš„å®Œæ•´æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2095013427691667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç›®å—æ®‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:13:15.000Z" title="Tue Nov 18 2025 03:13:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼ŒGit ä½œä¸ºæœ€æµè¡Œçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ˜¯åä½œå’Œä»£ç ç®¡ç†çš„å¿…å¤‡å·¥å…·ã€‚å¯¹äºåˆšæ¥è§¦ Git çš„å¼€å‘è€…æ¥è¯´ï¼ŒæŒæ¡æ ¸å¿ƒå‘½ä»¤å’ŒåŸºç¡€æµç¨‹ï¼Œå°±èƒ½è§£å†³ 80% çš„ç‰ˆæœ¬æ§åˆ¶éœ€æ±‚ã€‚æœ¬æ–‡å°†ä»ã€Œä»“åº“åˆå§‹åŒ–ã€åˆ°ã€Œä»£ç æäº¤ã€ï¼Œä¸€æ­¥æ­¥æ‹†è§£ Git åŸºç¡€å‘½ä»¤çš„ä½¿ç”¨åœºæ™¯å’Œæ“ä½œæ­¥éª¤ï¼Œå¸®ä½ å¿«é€Ÿä¸Šæ‰‹ Gitã€‚</p>
<h2 data-id="heading-0">ä¸€ã€Git ç¯å¢ƒå‡†å¤‡ï¼šé¦–æ¬¡é…ç½®ä¸å¯å°‘</h2>
<p>åœ¨ä½¿ç”¨ Git å‰ï¼Œéœ€è¦å…ˆé…ç½®ç”¨æˆ·åå’Œé‚®ç®±â€”â€”è¿™ä¼šå…³è”åˆ°ä½ çš„æ¯ä¸€æ¬¡ä»£ç æäº¤ï¼Œæ˜¯èº«ä»½æ ‡è¯†çš„å…³é”®ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"># é…ç½®å…¨å±€ç”¨æˆ·åï¼ˆæ›¿æ¢ä¸ºä½ çš„åç§°ï¼Œå¦‚ <span class="hljs-string">"Zhang San"</span>ï¼‰
git config --global user.name <span class="hljs-string">"Your Name"</span>
â€‹
# é…ç½®å…¨å±€é‚®ç®±ï¼ˆæ›¿æ¢ä¸ºä½ çš„é‚®ç®±ï¼Œå¦‚ <span class="hljs-string">"zhangsan@example.com"</span>ï¼‰
git config --global user.email <span class="hljs-string">"your-email@example.com"</span>
</code></pre>
<ul>
<li>è‹¥åŠ  <code>--global</code> å‚æ•°ï¼Œé…ç½®ä¼šä½œç”¨äºæ‰€æœ‰æœ¬åœ° Git ä»“åº“ï¼›è‹¥æƒ³é’ˆå¯¹å•ä¸ªä»“åº“å•ç‹¬é…ç½®ï¼Œè¿›å…¥ä»“åº“ç›®å½•åå»æ‰è¯¥å‚æ•°å³å¯ã€‚</li>
<li>éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸï¼šæ‰§è¡Œ <code>git config --list</code>ï¼Œç»ˆç«¯ä¼šåˆ—å‡ºæ‰€æœ‰é…ç½®é¡¹ï¼Œç¡®è®¤ <code>user.name</code> å’Œ <code>user.email</code> ä¸è¾“å…¥ä¸€è‡´å³å¯ã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒæµç¨‹ï¼šä»â€œæ–°å»ºä»“åº“â€åˆ°â€œæäº¤ä»£ç â€</h2>
<p>Git çš„åŸºç¡€ä½¿ç”¨å›´ç»•ã€Œå·¥ä½œåŒºâ†’æš‚å­˜åŒºâ†’æœ¬åœ°ä»“åº“ã€çš„æµè½¬å±•å¼€ï¼Œå¯¹åº”çš„å‘½ä»¤å’Œæ­¥éª¤å¦‚ä¸‹ï¼Œå»ºè®®è·Ÿç€å®æ“ä¸€éï¼ˆä»¥æ–°å»ºä¸€ä¸ª <code>my-project</code> é¡¹ç›®ä¸ºä¾‹ï¼‰ã€‚</p>
<h3 data-id="heading-2">æ­¥éª¤ 1ï¼šåˆå§‹åŒ–æœ¬åœ°ä»“åº“ï¼ˆä¸¤ç§åœºæ™¯ï¼‰</h3>
<p>æœ¬åœ°ä»“åº“æ˜¯ Git ç®¡ç†ä»£ç çš„æ ¸å¿ƒï¼Œåˆå§‹åŒ–ä»“åº“åˆ†ã€Œæ–°å»ºé¡¹ç›®ã€å’Œã€Œå…³è”å·²æœ‰è¿œç¨‹ä»“åº“ã€ä¸¤ç§åœºæ™¯ã€‚</p>
<h4 data-id="heading-3">åœºæ™¯ 1ï¼šæœ¬åœ°æ–°å»ºé¡¹ç›®ï¼Œåˆå§‹åŒ– Git ä»“åº“</h4>
<p>å¦‚æœä½ ä»é›¶å¼€å§‹å¼€å‘ä¸€ä¸ªé¡¹ç›®ï¼Œå…ˆåˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå†åˆå§‹åŒ– Gitï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 1. åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹å¹¶è¿›å…¥ï¼ˆæ›¿æ¢ä¸ºä½ çš„é¡¹ç›®åï¼‰</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-project &amp;&amp; cd <span class="hljs-keyword">my</span>-project
â€‹
<span class="hljs-comment"># 2. åˆå§‹åŒ– Git ä»“åº“ï¼ˆæ‰§è¡Œåä¼šç”Ÿæˆéšè—çš„ .git æ–‡ä»¶å¤¹ï¼Œå­˜å‚¨ä»“åº“é…ç½®å’Œç‰ˆæœ¬è®°å½•ï¼‰</span>
git init
</code></pre>
<p>æ‰§è¡Œåç»ˆç«¯ä¼šæç¤º <code>Initialized empty Git repository in /xxx/my-project/.git/</code>ï¼Œè¡¨ç¤ºä»“åº“åˆå§‹åŒ–æˆåŠŸã€‚</p>
<h4 data-id="heading-4">åœºæ™¯ 2ï¼šå…³è”è¿œç¨‹ä»“åº“ï¼ˆå¦‚ GitHub/GitLab ä¸Šçš„å·²æœ‰é¡¹ç›®ï¼‰</h4>
<p>å¦‚æœé¡¹ç›®å·²åœ¨è¿œç¨‹ä»“åº“ï¼ˆå¦‚ GitHubï¼‰åˆ›å»ºï¼Œéœ€è¦å°†è¿œç¨‹ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å…‹éš†è¿œç¨‹ä»“åº“ï¼ˆæ›¿æ¢ä¸ºä½ çš„è¿œç¨‹ä»“åº“åœ°å€ï¼ŒHTTPS æˆ– SSH æ ¼å¼å‡å¯ï¼‰</span>
git <span class="hljs-built_in">clone</span> https://github.com/your-username/my-project.git
â€‹
<span class="hljs-comment"># å…‹éš†åä¼šè‡ªåŠ¨ç”Ÿæˆä¸è¿œç¨‹ä»“åº“åŒåçš„æ–‡ä»¶å¤¹ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹å³å¯æ“ä½œ</span>
<span class="hljs-built_in">cd</span> my-project
</code></pre>
<ul>
<li>è¿œç¨‹åœ°å€è·å–ï¼šåœ¨ GitHub ä»“åº“é¡µé¢ç‚¹å‡»ã€ŒCodeã€ï¼Œå¤åˆ¶ HTTPS æˆ– SSH é“¾æ¥ï¼ˆSSH éœ€æå‰é…ç½®å¯†é’¥ï¼Œå…å¯†ç ç™»å½•æ›´æ–¹ä¾¿ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-5">æ­¥éª¤ 2ï¼šæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼Œè·Ÿè¸ªæ–°æ–‡ä»¶</h3>
<p>ä»“åº“åˆå§‹åŒ–åï¼Œåœ¨ <code>my-project</code> ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚ <code>index.html</code>ï¼‰ï¼Œæ­¤æ—¶ Git ä¼šå°†è¯¥æ–‡ä»¶æ ‡è®°ä¸ºã€Œæœªè·Ÿè¸ªï¼ˆUntrackedï¼‰ã€â€”â€”å³æœªçº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚é€šè¿‡ <code>git status</code> å¯æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ä»“åº“æ‰€æœ‰æ–‡ä»¶çš„çŠ¶æ€</span>
git status
</code></pre>
<p>ç»ˆç«¯ä¼šæ˜¾ç¤º <code>Untracked files: index.html</code>ï¼Œæ­¤æ—¶éœ€è¦ç”¨ <code>git add</code> å‘½ä»¤å°†æ–‡ä»¶â€œè·Ÿè¸ªâ€èµ·æ¥ï¼Œçº³å…¥æš‚å­˜åŒºï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># åœºæ™¯ 1ï¼šè·Ÿè¸ªå•ä¸ªæ–‡ä»¶ï¼ˆæ›¿æ¢ä¸ºä½ çš„æ–‡ä»¶åï¼‰</span>
git <span class="hljs-keyword">add</span> index.html
â€‹
<span class="hljs-meta"># åœºæ™¯ 2ï¼šè·Ÿè¸ªå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æœªè·Ÿè¸ª/ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆå¼€å‘ä¸­å¸¸ç”¨ï¼‰</span>
git <span class="hljs-keyword">add</span> .
â€‹
<span class="hljs-meta"># åœºæ™¯ 3ï¼šè·Ÿè¸ªæŒ‡å®šç±»å‹çš„æ–‡ä»¶ï¼ˆå¦‚æ‰€æœ‰ .js æ–‡ä»¶ï¼‰</span>
git <span class="hljs-keyword">add</span> *.js
</code></pre>
<p>æ‰§è¡Œ <code>git add</code> åï¼Œå†æ¬¡è¿è¡Œ <code>git status</code>ï¼Œä¼šçœ‹åˆ°æ–‡ä»¶çŠ¶æ€å˜ä¸ºã€ŒChanges to be committedã€ï¼Œè¡¨ç¤ºæ–‡ä»¶å·²è¿›å…¥æš‚å­˜åŒºï¼Œç­‰å¾…æäº¤åˆ°æœ¬åœ°ä»“åº“ã€‚</p>
<h3 data-id="heading-6">æ­¥éª¤ 3ï¼šæäº¤ä»£ç åˆ°æœ¬åœ°ä»“åº“</h3>
<p>æš‚å­˜åŒºçš„æ–‡ä»¶éœ€è¦é€šè¿‡ <code>git commit</code> æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå½¢æˆä¸€æ¡ç‰ˆæœ¬è®°å½•ã€‚æäº¤æ—¶å¿…é¡»å¡«å†™ã€Œæäº¤ä¿¡æ¯ã€ï¼Œè¯´æ˜è¿™æ¬¡ä¿®æ”¹çš„å†…å®¹ï¼ˆå¦‚â€œæ–°å¢é¦–é¡µ index.htmlâ€ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æäº¤æš‚å­˜åŒºæ–‡ä»¶åˆ°æœ¬åœ°ä»“åº“ï¼Œ-m åæ¥æäº¤ä¿¡æ¯ï¼ˆä¿¡æ¯è¦ç®€æ´æ˜ç¡®ï¼‰</span>
git commit -m <span class="hljs-string">"feat: add index.html for homepage"</span>
</code></pre>
<ul>
<li>
<p>æäº¤ä¿¡æ¯è§„èŒƒï¼šå»ºè®®éµå¾ªã€Œç±»å‹: æè¿°ã€çš„æ ¼å¼ï¼ˆå¦‚ <code>feat</code> è¡¨ç¤ºæ–°åŠŸèƒ½ï¼Œ<code>fix</code> è¡¨ç¤ºä¿®å¤bugï¼Œ<code>docs</code> è¡¨ç¤ºæ–‡æ¡£ä¿®æ”¹ï¼‰ï¼Œæ–¹ä¾¿åç»­æŸ¥çœ‹ç‰ˆæœ¬è®°å½•æ—¶å¿«é€Ÿç†è§£å˜æ›´ã€‚</p>
</li>
<li>
<p>æäº¤æˆåŠŸåï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºæäº¤çš„å“ˆå¸Œå€¼ï¼ˆå¦‚ <code>a1b2c3d</code>ï¼‰ã€ä¿®æ”¹çš„æ–‡ä»¶æ•°å’Œè¡Œæ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">[main (root<span class="hljs-operator">-</span><span class="hljs-keyword">commit</span>) a1b2c3d] feat: <span class="hljs-keyword">add</span> index.html <span class="hljs-keyword">for</span> homepage
 <span class="hljs-number">1</span> file changed, <span class="hljs-number">5</span> insertions(<span class="hljs-operator">+</span>)
 <span class="hljs-keyword">create</span> mode <span class="hljs-number">100644</span> index.html
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">æ­¥éª¤ 4ï¼šæŸ¥çœ‹æäº¤å†å²ï¼Œå›æº¯ç‰ˆæœ¬</h3>
<p>æäº¤åè‹¥æƒ³æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬è®°å½•ï¼Œæˆ–æ‰¾åˆ°æŸä¸ªå†å²ç‰ˆæœ¬çš„å“ˆå¸Œå€¼ï¼ˆç”¨äºå›æ»šï¼‰ï¼Œç”¨ <code>git log</code> å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å®Œæ•´æäº¤å†å²ï¼ˆæŒ‰æ—¶é—´å€’åºï¼Œæœ€æ–°çš„æäº¤åœ¨æœ€ä¸Šé¢ï¼‰</span>
git <span class="hljs-built_in">log</span>
â€‹
<span class="hljs-comment"># æŸ¥çœ‹ç®€æ´ç‰ˆå†å²ï¼ˆåªæ˜¾ç¤ºå“ˆå¸Œå€¼å‰7ä½å’Œæäº¤ä¿¡æ¯ï¼Œå¼€å‘ä¸­æ›´å¸¸ç”¨ï¼‰</span>
git <span class="hljs-built_in">log</span> --oneline
â€‹
<span class="hljs-comment"># æŸ¥çœ‹æŒ‡å®šæ•°é‡çš„å†å²ï¼ˆå¦‚æœ€è¿‘3æ¬¡æäº¤ï¼‰</span>
git <span class="hljs-built_in">log</span> -3
</code></pre>
<p>æ‰§è¡Œ <code>git log --oneline</code> åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼Œæ¯ä¸€è¡Œå¯¹åº”ä¸€æ¬¡æäº¤ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-title function_ invoke__">a1b2c3d</span> (HEAD <span class="hljs-punctuation">-&gt;</span> main) feat: add index.html <span class="hljs-keyword">for</span> <span class="hljs-title class_">homepage</span>
e4f5g6h feat: add style.css <span class="hljs-keyword">for</span> <span class="hljs-title class_">homepage</span>
</code></pre>
<h2 data-id="heading-8">ä¸‰ã€å¸¸ç”¨é«˜é¢‘å‘½ä»¤ï¼šè§£å†³æ—¥å¸¸å°é—®é¢˜</h2>
<p>é™¤äº†ä¸Šè¿°æ ¸å¿ƒæµç¨‹ï¼Œä»¥ä¸‹å‡ ä¸ªå‘½ä»¤åœ¨å¼€å‘ä¸­ä¹Ÿç»å¸¸ç”¨åˆ°ï¼Œè¦†ç›–â€œæ’¤é”€ä¿®æ”¹â€â€œåˆ†æ”¯æŸ¥çœ‹â€â€œè¿œç¨‹åŒæ­¥â€ç­‰åœºæ™¯ã€‚</p>
<h3 data-id="heading-9">1. æ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹ï¼ˆæœªæ‰§è¡Œ git add å‰ï¼‰</h3>
<p>å¦‚æœåœ¨å·¥ä½œåŒºä¿®æ”¹äº†æ–‡ä»¶ï¼ˆå¦‚è¯¯åˆ  <code>index.html</code> å†…å®¹ï¼‰ï¼Œä½†è¿˜æ²¡æ‰§è¡Œ <code>git add</code>ï¼Œæƒ³æ¢å¤åˆ°æœ€è¿‘ä¸€æ¬¡ <code>commit</code> çš„çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ’¤é”€å•ä¸ªæ–‡ä»¶çš„å·¥ä½œåŒºä¿®æ”¹ï¼ˆæ›¿æ¢ä¸ºä½ çš„æ–‡ä»¶åï¼‰</span>
git checkout -- index.html

<span class="hljs-comment"># æ’¤é”€å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æœª add çš„ä¿®æ”¹ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œä¼šä¸¢å¤±æœªè·Ÿè¸ªçš„æ–°æ–‡ä»¶ï¼‰</span>
git checkout .
</code></pre>
<h3 data-id="heading-10">2. æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹ï¼ˆå·²æ‰§è¡Œ git add ä½†æœª commitï¼‰</h3>
<p>å¦‚æœæ–‡ä»¶å·² <code>git add</code> åˆ°æš‚å­˜åŒºï¼Œæƒ³æ’¤å›åˆ°å·¥ä½œåŒºï¼ˆæ¯”å¦‚è¯¯åŠ äº†ä¸éœ€è¦çš„æ–‡ä»¶ï¼‰ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šå°†æ–‡ä»¶ä»æš‚å­˜åŒºæ’¤å›åˆ°å·¥ä½œåŒº</span>
git <span class="hljs-keyword">reset</span> HEAD index.html

<span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šï¼ˆå¯é€‰ï¼‰è‹¥éœ€è¦åŒæ—¶æ’¤é”€å·¥ä½œåŒºä¿®æ”¹ï¼Œå†æ‰§è¡Œ checkout</span>
git checkout -- index.html
</code></pre>
<h3 data-id="heading-11">3. æŸ¥çœ‹åˆ†æ”¯ï¼Œåˆ‡æ¢åˆ†æ”¯ï¼ˆåŸºç¡€åˆ†æ”¯æ“ä½œï¼‰</h3>
<p>Git åˆ†æ”¯æ˜¯å¹¶è¡Œå¼€å‘çš„æ ¸å¿ƒï¼ˆå¦‚ä¸»åˆ†æ”¯ <code>main</code>ã€å¼€å‘åˆ†æ”¯ <code>dev</code>ï¼‰ï¼ŒåŸºç¡€çš„åˆ†æ”¯å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰æ‰€æœ‰åˆ†æ”¯ï¼ˆå¸¦ * çš„æ˜¯å½“å‰æ‰€åœ¨åˆ†æ”¯ï¼‰</span>
git branch

<span class="hljs-comment"># åˆ›å»ºæ–°åˆ†æ”¯ï¼ˆå¦‚åˆ›å»º dev åˆ†æ”¯ï¼ŒåŸºäºå½“å‰åˆ†æ”¯åˆ›å»ºï¼‰</span>
git branch dev

<span class="hljs-comment"># åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼ˆå¦‚åˆ‡æ¢åˆ° dev åˆ†æ”¯ï¼‰</span>
git checkout dev

<span class="hljs-comment"># åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ï¼ˆä¸€æ­¥å®Œæˆï¼Œæ¯”ä¸Šé¢ä¸¤æ¡å‘½ä»¤æ›´é«˜æ•ˆï¼‰</span>
git checkout -b dev
</code></pre>
<h3 data-id="heading-12">4. åŒæ­¥è¿œç¨‹ä»“åº“ä»£ç ï¼ˆåä½œå¿…å¤‡ï¼‰</h3>
<p>å¦‚æœå¤šäººåä½œï¼Œéœ€è¦æ‹‰å–è¿œç¨‹ä»“åº“çš„æœ€æ–°ä»£ç ï¼Œæˆ–æ¨é€æœ¬åœ°ä»£ç åˆ°è¿œç¨‹ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># æ‹‰å–è¿œç¨‹ main åˆ†æ”¯çš„æœ€æ–°ä»£ç åˆ°æœ¬åœ°ï¼ˆé¿å…å†²çªï¼‰</span>
git pull origin main

<span class="hljs-comment"># æ¨é€æœ¬åœ° main åˆ†æ”¯ä»£ç åˆ°è¿œç¨‹ï¼ˆé¦–æ¬¡æ¨é€éœ€åŠ  -u å…³è”è¿œç¨‹åˆ†æ”¯ï¼‰</span>
git <span class="hljs-keyword">push</span> -u origin main

<span class="hljs-comment"># åç»­æ¨é€ï¼ˆå·²å…³è”è¿œç¨‹åˆ†æ”¯åï¼Œç›´æ¥æ‰§è¡Œï¼‰</span>
git <span class="hljs-keyword">push</span>
</code></pre>
<ul>
<li><code>origin</code> æ˜¯è¿œç¨‹ä»“åº“çš„é»˜è®¤åˆ«åï¼Œæ‰§è¡Œ <code>git remote -v</code> å¯æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„åœ°å€å’Œåˆ«åã€‚</li>
</ul>
<h2 data-id="heading-13">å››ã€Git åŸºç¡€å‘½ä»¤é€ŸæŸ¥è¡¨</h2>
<p>ä¸ºäº†æ–¹ä¾¿ä½ å¿«é€ŸæŸ¥é˜…ï¼Œæ•´ç†äº†æœ¬æ–‡æ¶‰åŠçš„æ ¸å¿ƒå‘½ä»¤ï¼ŒæŒ‰åœºæ™¯åˆ†ç±»ï¼š</p>























































<table><thead><tr><th>æ“ä½œåœºæ™¯</th><th>å‘½ä»¤ç¤ºä¾‹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>ç¯å¢ƒé…ç½®</td><td><code>git config --global user.name "Name"</code></td><td>å…¨å±€é…ç½®ç”¨æˆ·å/é‚®ç®±</td></tr><tr><td>ä»“åº“åˆå§‹åŒ–</td><td><code>git init</code> / <code>git clone è¿œç¨‹åœ°å€</code></td><td>æœ¬åœ°æ–°å»º/å…‹éš†è¿œç¨‹ä»“åº“</td></tr><tr><td>æ–‡ä»¶çŠ¶æ€æŸ¥çœ‹</td><td><code>git status</code></td><td>æŸ¥çœ‹æœªè·Ÿè¸ª/ä¿®æ”¹/æš‚å­˜çš„æ–‡ä»¶</td></tr><tr><td>è·Ÿè¸ªæ–‡ä»¶åˆ°æš‚å­˜åŒº</td><td><code>git add æ–‡ä»¶å</code> / <code>git add .</code></td><td>å•ä¸ªæ–‡ä»¶/æ‰€æœ‰æ–‡ä»¶</td></tr><tr><td>æäº¤åˆ°æœ¬åœ°ä»“åº“</td><td><code>git commit -m "æäº¤ä¿¡æ¯"</code></td><td>å¿…é¡»å¡«å†™æäº¤ä¿¡æ¯</td></tr><tr><td>æŸ¥çœ‹æäº¤å†å²</td><td><code>git log --oneline</code> / <code>git log -3</code></td><td>ç®€æ´ç‰ˆ/æŒ‡å®šæ•°é‡çš„å†å²</td></tr><tr><td>æ’¤é”€å·¥ä½œåŒºä¿®æ”¹</td><td><code>git checkout -- æ–‡ä»¶å</code></td><td>æœª add å‰æœ‰æ•ˆ</td></tr><tr><td>åˆ†æ”¯æ“ä½œ</td><td><code>git branch</code> / <code>git checkout -b æ–°åˆ†æ”¯</code></td><td>æŸ¥çœ‹åˆ†æ”¯/åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</td></tr><tr><td>è¿œç¨‹åŒæ­¥</td><td><code>git pull origin main</code> / <code>git push</code></td><td>æ‹‰å–è¿œç¨‹ä»£ç /æ¨é€æœ¬åœ°ä»£ç </td></tr></tbody></table>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p>Git çš„åŸºç¡€ä½¿ç”¨å¹¶ä¸å¤æ‚ï¼Œæ ¸å¿ƒæ˜¯ç†è§£ã€Œå·¥ä½œåŒºâ†’æš‚å­˜åŒºâ†’æœ¬åœ°ä»“åº“ã€çš„æµè½¬é€»è¾‘ï¼Œå†è®°ä½å¯¹åº”çš„å‘½ä»¤ï¼ˆå¦‚ <code>add</code> åˆ°æš‚å­˜åŒºï¼Œ<code>commit</code> åˆ°ä»“åº“ï¼‰ã€‚æœ¬æ–‡è¦†ç›–çš„å‘½ä»¤å’Œæµç¨‹ï¼Œèƒ½æ»¡è¶³ä¸ªäººå¼€å‘å’Œå°å‹å›¢é˜Ÿåä½œçš„åŸºæœ¬éœ€æ±‚ï¼›åç»­è‹¥æ¶‰åŠå¤æ‚åœºæ™¯ï¼ˆå¦‚åˆ†æ”¯åˆå¹¶ã€å†²çªè§£å†³ï¼‰ï¼Œå†é€æ­¥å­¦ä¹ è¿›é˜¶å‘½ä»¤å³å¯ã€‚</p>
<p>å»ºè®®æŠŠæœ¬æ–‡çš„ã€Œå‘½ä»¤é€ŸæŸ¥è¡¨ã€ä¿å­˜ä¸‹æ¥ï¼Œé‡åˆ°å¿˜è®°çš„å‘½ä»¤æ—¶éšæ—¶æŸ¥é˜…ï¼Œå¤šå®æ“å‡ æ¬¡å°±èƒ½ç†Ÿç»ƒæŒæ¡ Git å•¦ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java + Spring åˆ° Python + FastAPI ï¼ˆä¸‰ï¼‰]]></title>    <link>https://juejin.cn/post/7573597479981400100</link>    <guid>https://juejin.cn/post/7573597479981400100</guid>    <pubDate>2025-11-18T03:24:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573597479981400100" data-draft-id="7572997791451709478" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java + Spring åˆ° Python + FastAPI ï¼ˆä¸‰ï¼‰"/> <meta itemprop="keywords" content="Spring,Python,FastAPI"/> <meta itemprop="datePublished" content="2025-11-18T03:24:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å…µå¼ å¥"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java + Spring åˆ° Python + FastAPI ï¼ˆä¸‰ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å…µå¼ å¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:24:20.000Z" title="Tue Nov 18 2025 03:24:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ä¸€èŠ‚æ€»ç»“ä¸‹å·¥ç¨‹åŒ–çš„åŒºåˆ«ï¼Œä½¿ç”¨ DDD é¢†åŸŸé©±åŠ¨å¼€å‘ã€‚ä»¥ç”¨æˆ·ã€è®¢å•ã€ç»“ç®—ä¸‰ä¸ªæ¨¡å—ä¸ºä¾‹ã€‚</p>
<pre><code class="hljs language-Plaintext" lang="Plaintext">my_fastapi_project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                  # ã€æ ¸å¿ƒåŸºç¡€è®¾æ–½å±‚ã€‘(ç±»ä¼¼äº Java çš„ 'common' åŒ…)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py          # è¯»å–ç¯å¢ƒå˜é‡ (Pydantic Settings)
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“è¿æ¥æ± , get_db_session (Lifespan, Depends)
â”‚   â”‚   â”œâ”€â”€ security.py        # JWT, å¯†ç å“ˆå¸Œ
â”‚   â”‚   â”œâ”€â”€ kafka.py           # Kafka Producer å•ä¾‹
â”‚   â”‚   â””â”€â”€ exceptions.py      # å…¨å±€å¼‚å¸¸å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/               # ã€ä¸šåŠ¡é¢†åŸŸå±‚ã€‘(ä½ çš„ Feature Modules)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ users/             # [ç”¨æˆ·æ¨¡å—]
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ router.py      # Controller (API è·¯ç”±)
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas.py     # DTO (Pydantic æ¨¡å‹)
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py      # Entity (SQLAlchemy æ¨¡å‹)
â”‚   â”‚   â”‚   â””â”€â”€ service.py     # Service (ä¸šåŠ¡é€»è¾‘)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ orders/            # [è®¢å•æ¨¡å—]
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ router.py
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas.py
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”‚   â””â”€â”€ service.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ settlements/       # [ç»“ç®—æ¨¡å—]
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ worker.py      # Kafka æ¶ˆè´¹è€…é€»è¾‘ (Consumer)
â”‚   â”‚       â”œâ”€â”€ models.py
â”‚   â”‚       â””â”€â”€ service.py     # (è¿™é‡Œå¯èƒ½æ²¡æœ‰ routerï¼Œå› ä¸ºå®ƒä¸æš´éœ² API)
â”‚   â”‚
â”‚   â””â”€â”€ main.py                # ã€HTTP å…¥å£ã€‘ (FastAPI App, Lifespan, Include Routers)
â”‚
â”œâ”€â”€ tests/                     # æµ‹è¯•ä»£ç  (Pytest)
â”‚   â”œâ”€â”€ conftest.py            # æµ‹è¯•å¤¹å…· (Fixtures)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ .env                       # æœ¬åœ°ç¯å¢ƒå˜é‡
â”œâ”€â”€ Dockerfile
â””â”€â”€ pyproject.toml             # ä¾èµ–ç®¡ç† (Poetry / Maven pom.xml)
</code></pre>
<p>è·¯ç”±é©±åŠ¨å¼€å‘å°±æ˜¯ä»¥ä¸šåŠ¡åˆ†å—ï¼Œå¦‚ä¸Šå›¾åŸºç¡€çš„ç”¨æˆ·ã€è®¢å•ã€ç»“ç®—åˆ†åˆ«æœ‰ä¸‰å—ï¼Œå†åŠ ä¸ŠæŠ½è±¡å‡ºæ¥çš„ coreï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„æ¨¡å—ï¼Œä¸šåŠ¡ä»£ç åœ¨ modle é‡Œé¢ï¼Œå†å»è°ƒç”¨è‡ªæ¨¡å—çš„å†…å®¹ï¼Œæ¯”å¦‚åŒæ—¶ç”¨åˆ°è®¢å•å’Œèµ„é‡‘çš„æ¥å£ã€‚</p>
<p>ç›¸æ¯”è¾ƒä¼ ç»ŸæŠŠæ‰€æœ‰ä¸šåŠ¡ä»£ç éƒ½æ”¾åˆ° Controllerã€Serviceã€Dao é‡Œé¢æ›´å®¹æ˜“æ‹†åˆ†ï¼Œä¹Ÿä¿è¯æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ä¸è¦å¤ªå¤šã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caa1647ee5d1472ab9517eb97c0ecc75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041059&amp;x-signature=YhHtnRFSq7LfgFcuXVkpNYuEmME%3D" alt="image.png" loading="lazy"/></p>
<p>Spring å¯ä»¥è‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œæ¯”å¦‚ ServiceA å’Œ ServiceB äº’ç›¸ä¾èµ–ï¼Œåªè¦æ²¡æœ‰æ–¹æ³•çš„å¾ªç¯è°ƒç”¨ï¼Œé€šå¸¸æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè§£å†³æ–¹æ¡ˆå¯ä»¥æ”¹ä¸ºæ„é€ å™¨æ³¨å…¥ã€‚</p>
<p>åœ¨ Python ä¸­ä¼šæŠ¥ ImportError: cannot import name 'X' (Circular Import)ã€‚å®Œå…¨ä¸èƒ½ç›¸äº’å¼•ç”¨ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸Šé¢è¯´çš„ï¼Œåœ¨ modle é‡Œé¢æ–°å†™ä¸ª Strategy è°ƒç”¨ ServiceA å’Œ ServiceBã€‚</p>
<p>æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ªå¥½äº‹ï¼Œå°½ç®¡åœ¨ Spring ä¹Ÿè¦æ±‚ DDDï¼Œä½†ä¸åƒ Python è¿™æ ·å¦‚æ­¤å¼ºç¡¬ï¼Œè¿˜æ˜¯ä¼šå‡ºç° Service å¾ªç¯è°ƒç”¨çš„é—®é¢˜ã€‚å•å‘ä¾èµ–ä»æ¶æ„å±‚é¢ç»Ÿä¸€ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç¤ºä¾‹æ–‡ä»¶ä»£ç </p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># app/main.py</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> asynccontextmanager

<span class="hljs-comment"># å¯¼å…¥æ ¸å¿ƒé…ç½®</span>
<span class="hljs-keyword">from</span> app.core.database <span class="hljs-keyword">import</span> init_db_pool, close_db_pool
<span class="hljs-comment"># å¯¼å…¥ä¸šåŠ¡è·¯ç”±</span>
<span class="hljs-keyword">from</span> app.modules.users.router <span class="hljs-keyword">import</span> router <span class="hljs-keyword">as</span> user_router
<span class="hljs-keyword">from</span> app.modules.orders.router <span class="hljs-keyword">import</span> router <span class="hljs-keyword">as</span> order_router

<span class="hljs-meta">@asynccontextmanager</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">lifespan</span>(<span class="hljs-params">app: FastAPI</span>):
    <span class="hljs-keyword">await</span> init_db_pool()
    <span class="hljs-keyword">yield</span>
    <span class="hljs-keyword">await</span> close_db_pool()

app = FastAPI(lifespan=lifespan)

<span class="hljs-comment"># æ³¨å†Œè·¯ç”±ï¼ŒåŠ ä¸Šå‰ç¼€</span>
<span class="hljs-comment"># è¿™æ · /users/login å°±ä¼šç”Ÿæ•ˆ</span>
app.include_router(user_router, prefix=<span class="hljs-string">"/users"</span>, tags=[<span class="hljs-string">"Users"</span>])
app.include_router(order_router, prefix=<span class="hljs-string">"/orders"</span>, tags=[<span class="hljs-string">"Orders"</span>])

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"ok"</span>}
</code></pre>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># app/modules/users/router.py</span>
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter, Depends
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> app.core.database <span class="hljs-keyword">import</span> get_db <span class="hljs-comment"># ä» Core å¯¼å…¥åŸºç¡€è®¾æ–½</span>
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> schemas, service <span class="hljs-comment"># ä»å½“å‰ç›®å½•å¯¼å…¥ä¸šåŠ¡é€»è¾‘</span>

<span class="hljs-comment"># æ³¨æ„ï¼šè¿™é‡Œç”¨ APIRouterï¼Œä¸æ˜¯ FastAPI</span>
router = APIRouter() 

<span class="hljs-meta">@router.post(<span class="hljs-params"><span class="hljs-string">"/login"</span>, response_model=schemas.Token</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">
    form_data: schemas.LoginRequest,
    db: AsyncSession = Depends(<span class="hljs-params">get_db</span>)
</span>):
    user = <span class="hljs-keyword">await</span> service.authenticate_user(db, form_data.username, form_data.password)
    <span class="hljs-keyword">return</span> user
</code></pre>
<p>ç”¨æˆ·ã€è®¢å•ã€ç»“ç®—ï¼šè¾¹ç•Œåœ¨å“ªé‡Œï¼Ÿ</p>
<p>è¿™ä¸‰è€…åœ¨ä¸šåŠ¡ä¸Šå¿…é¡»è§£è€¦ï¼Œå› ä¸ºå®ƒä»¬çš„å˜åŒ–é¢‘ç‡å’Œå…³æ³¨ç‚¹å®Œå…¨ä¸åŒã€‚</p>
<p>A. ç”¨æˆ·åŸŸ (User Context) - "æˆ‘æ˜¯è°"
å…³æ³¨ç‚¹ï¼šèº«ä»½è®¤è¯ (Auth)ã€ä¸ªäººä¿¡æ¯ã€æƒé™ã€ä¼šå‘˜ç­‰çº§ã€‚</p>
<p>è¾¹ç•Œï¼šå®ƒä¸å…³å¿ƒä½ ä¹°äº†ä»€ä¹ˆï¼Œä¹Ÿä¸å…³å¿ƒä½ æœ‰æ²¡æœ‰é’±ã€‚å®ƒåªç®¡â€œè¿™ä¸ª Token æ˜¯ä¸æ˜¯åˆæ³•çš„å¼ ä¸‰â€ã€‚</p>
<p>å…³é”®æ•°æ®ï¼šusername, password_hash, email, roleã€‚</p>
<p>B. è®¢å•åŸŸ (Order Context) - "ä¸šåŠ¡å¥‘çº¦"
å…³æ³¨ç‚¹ï¼šäº¤æ˜“çš„æ„å‘å’ŒçŠ¶æ€æµè½¬ã€‚ä¸‹å•ã€å–æ¶ˆã€å‘è´§ã€æ”¶è´§ã€‚</p>
<p>è¾¹ç•Œï¼šå®ƒå¼•ç”¨äº†ç”¨æˆ·ï¼ˆé€šè¿‡ user_idï¼‰ï¼Œä½†å®ƒä¸åŒ…å«ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚å®ƒå¼•ç”¨äº†æ”¯ä»˜ç»“æœï¼Œä½†å®ƒä¸å¤„ç†é‡‘é’±çš„è®¡ç®—ã€‚</p>
<p>å…³é”®æ•°æ®ï¼šorder_no, user_id, product_list, status (PENDING/PAID/SHIPPED), total_amount (å¿«ç…§)ã€‚</p>
<p>C. ç»“ç®—/èµ„é‡‘åŸŸ (Settlement Context) - "çœŸé‡‘ç™½é“¶"
å…³æ³¨ç‚¹ï¼šè®°è´¦ã€æµæ°´ã€å¯¹è´¦ã€‚è¿™æ˜¯ç³»ç»Ÿçš„åº•çº¿ï¼Œå¿…é¡»ç»å¯¹ç²¾ç¡®ï¼Œé€šå¸¸åªèƒ½è¿½åŠ  (Append-only)ï¼Œä¸èƒ½ä¿®æ”¹ã€‚</p>
<p>è¾¹ç•Œï¼šå®ƒä¸å…³å¿ƒç”¨æˆ·ä¹°äº†ä»€ä¹ˆå•†å“ï¼Œå®ƒåªå…³å¿ƒâ€œç”¨æˆ·A ç»™äº† å¹³å°B 100å…ƒâ€ã€‚</p>
<p>å…³é”®æ•°æ®ï¼štransaction_id, account_id, amount (+/-), type (PAYMENT/REFUND), balance_snapshotã€‚</p>
<p>å¦‚æœæ¶‰åŠå¤šæ¨¡å—äº‹ç‰©ï¼Œç”¨æ•°æ®åº“äº‹ç‰©å³å¯ã€‚</p>
<h3 data-id="heading-0">ä¾èµ–ç®¡ç†</h3>
<p>Poetry å¯¹åº” Spring ä¸­çš„ Maven å’Œ Gradleã€‚</p>
<p>Python ä¸­æœ€åŸå§‹ç”¨çš„ pip + Requestments.txtï¼Œä½†è¿™ä¸ªæ–‡ä»¶æ˜¯æ‰å¹³çš„ï¼Œä¸åƒ Maven æœ‰ä¾èµ–æ ‘çŠ¶å›¾ï¼Œé¡¹ç›®å¤§äº†ååˆ†ä¸æ¸…å“ªäº›æ˜¯è‡ªå·±è¦ç”¨çš„ï¼Œå“ªäº›æ˜¯é—´æ¥å¼•å…¥çš„ã€‚</p>
<p>Poetry ä¸­ pyproject.toml ç›¸å½“äº pom.xmlï¼Œpoetry.lock ç›¸å½“äºè§£æåæ ‘çŠ¶å›¾ã€‚</p>
<p>Maven ä¸­æ‰€æœ‰çš„ jar åŒ…åœ¨ ~/.m2/repositoryï¼ŒPython ä¸­ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œä¸€ä¸ªé¡¹ç›®ä¸€ä¸ªç¯å¢ƒï¼Œé¡¹ç›®ä¹‹é—´ä¸å—å½±å“ã€‚è¿™ä¹Ÿç”± Poetry è‡ªåŠ¨ç®¡ç†ã€‚</p>
<p>é…ç½®æ–‡ä»¶ç¤ºä¾‹ã€‚</p>
<pre><code class="hljs language-TOML" lang="TOML"><span class="hljs-section">[tool.poetry]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"my-fastapi-project"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">description</span> = <span class="hljs-string">"é‡å†™ Java è®¢å•ç³»ç»Ÿçš„ Python ç‰ˆæœ¬"</span>
<span class="hljs-attr">authors</span> = [<span class="hljs-string">"Your Name &lt;you@example.com&gt;"</span>]

<span class="hljs-section">[tool.poetry.dependencies]</span>
<span class="hljs-attr">python</span> = <span class="hljs-string">"^3.10"</span>  <span class="hljs-comment"># æŒ‡å®š Python ç‰ˆæœ¬</span>
<span class="hljs-attr">fastapi</span> = <span class="hljs-string">"^0.109.0"</span>
<span class="hljs-attr">uvicorn</span> = {extras = [<span class="hljs-string">"standard"</span>], version = <span class="hljs-string">"^0.27.0"</span>}
<span class="hljs-attr">sqlalchemy</span> = {extras = [<span class="hljs-string">"asyncio"</span>], version = <span class="hljs-string">"^2.0.0"</span>}
<span class="hljs-attr">aiokafka</span> = <span class="hljs-string">"^0.10.0"</span>
<span class="hljs-comment"># æ³¨æ„ï¼šè¿™é‡Œåªåˆ—å‡ºä½ ç›´æ¥ä½¿ç”¨çš„åŒ…ï¼Œä¾èµ–çš„ä¾èµ–ä¸ä¼šå‡ºç°åœ¨è¿™é‡Œ</span>

<span class="hljs-section">[tool.poetry.group.test.dependencies]</span>
<span class="hljs-attr">pytest</span> = <span class="hljs-string">"^8.0.0"</span>
<span class="hljs-attr">httpx</span> = <span class="hljs-string">"^0.26.0"</span>

<span class="hljs-section">[build-system]</span>
<span class="hljs-attr">requires</span> = [<span class="hljs-string">"poetry-core"</span>]
<span class="hljs-attr">build-backend</span> = <span class="hljs-string">"poetry.core.masonry.api"</span>
</code></pre>
<p>Maven å’Œ Poetry å‘½ä»¤å¯¹æ¯”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/828bfdd5b391443189cfcae0bdb2364a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041059&amp;x-signature=V%2BgZOQ7x8soNcmyuzE3iRAU%2F%2BMA%3D" alt="image.png" loading="lazy"/></p>
<p>æœ¬åœ°ç”¨ poetry installï¼Œçº¿ä¸Šç”¨ Poetry è½¬æˆ requirements.txt ç”¨ pip å®‰è£…ï¼Œè¿™æ · Docker æ— éœ€ä¾èµ– poetry é€Ÿåº¦æ›´å¿«ã€é•œåƒæ›´å°ã€‚</p>
<h3 data-id="heading-1">ç”Ÿäº§å’Œéƒ¨ç½²</h3>
<p>Gunicorn + Uvicorn + Docker æ˜¯ä¸€å¥—æ ‡å‡†çš„çº¿ä¸Šéƒ¨ç½²æ–¹æ¡ˆã€‚</p>
<p>Docker å’Œ k8s Java ä¹Ÿåœ¨ç”¨ï¼Œä¹‹å‰è¯´è¿‡ Python ç”±äº GIL æ˜¯å•çº¿ç¨‹æ¨¡å¼ï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨æœåŠ¡å™¨çš„å¤šæ ¸ï¼Œéœ€è¦ä½¿ç”¨ Gunicorn + Unicornï¼Œæœ‰å¤šå°‘ä¸ªæ ¸å¿ƒå°±ç”¨ Unicorn å¯åŠ¨å¤šå°‘ä¸ª Python æœåŠ¡ï¼Œæ¯ 2 ä¸ªæœåŠ¡ç»‘å®š 1 ä¸ª CPU æ ¸å¿ƒï¼Œå†åŠ ä¸€ä¸ªå†—ä½™çš„æœåŠ¡ï¼ˆå®˜æ–¹æ¨è2 * æ ¸å¿ƒæ•° + 1ï¼‰ï¼Œå†ç”± Gunicorn åˆ†å‘è¯·æ±‚ï¼Œç±»ä¼¼ Nginx çš„ä½œç”¨ã€‚</p>
<p>ç”Ÿäº§å¯åŠ¨å‘½ä»¤æ˜¯ï¼š
<code>gunicorn main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000</code></p>
<p>å‚æ•°è¯¦è§£ï¼š</p>
<p>main:appï¼š</p>
<p>mainï¼šPython æ–‡ä»¶å (main.py)ã€‚</p>
<p>appï¼šæ–‡ä»¶é‡Œé¢çš„ FastAPI å®ä¾‹å˜é‡å (app = FastAPI(...))ã€‚</p>
<p>--workers 4ï¼š</p>
<p>å¯åŠ¨ 4 ä¸ªç‹¬ç«‹çš„ Python è¿›ç¨‹ã€‚</p>
<p>è®¡ç®—å…¬å¼ï¼šå®˜æ–¹æ¨è (2 x CPUæ ¸å¿ƒæ•°) + 1ã€‚å¦‚æœä½ æ˜¯ 2 æ ¸ CPUï¼Œå°±é… 5 ä¸ª Workerã€‚</p>
<p>--worker-class uvicorn.workers.UvicornWorkerï¼š</p>
<p>å…³é”®ï¼ å‘Šè¯‰ Gunicornï¼šâ€œåˆ«ç”¨ä½ é»˜è®¤çš„åŒæ­¥ Workerï¼Œå»ç”¨ Uvicorn çš„å¼‚æ­¥ Workerâ€ã€‚</p>
<p>å¦‚æœä¸åŠ è¿™ä¸ªï¼Œasyncio ç›´æ¥å¤±æ•ˆï¼Œæ€§èƒ½æå…¶ä½ä¸‹ã€‚</p>
<p>--bind 0.0.0.0:8000ï¼šç›‘å¬ç«¯å£ã€‚</p>
<p>Dockerfile ç¤ºä¾‹</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1. é€‰æ‹©åŸºç¡€é•œåƒ (Slim ç‰ˆæœ¬ä½“ç§¯å°ï¼Œä¸ä»…åŒ…å« Pythonï¼Œè¿˜åŒ…å«å¿…è¦çš„ C åº“)</span>
FROM python:3.10-slim
<span class="hljs-meta prompt_">
# </span><span class="bash">2. è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="hljs-meta prompt_"># </span><span class="bash">ç¦æ­¢ Python ç”Ÿæˆ .pyc æ–‡ä»¶</span>
ENV PYTHONDONTWRITEBYTECODE=1
<span class="hljs-meta prompt_"># </span><span class="bash">è®© Python æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å° (Docker logs)</span>
ENV PYTHONUNBUFFERED=1
<span class="hljs-meta prompt_">
# </span><span class="bash">3. è®¾ç½®å·¥ä½œç›®å½•</span>
WORKDIR /app
<span class="hljs-meta prompt_">
# </span><span class="bash">4. å®‰è£…ä¾èµ– (åˆ©ç”¨ Layer ç¼“å­˜)</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æˆ‘ä»¬å‡è®¾ä½ å·²ç»ç”¨ poetry å¯¼å‡ºäº† requirements.txt</span>
<span class="hljs-meta prompt_"># </span><span class="bash">(æˆ–è€…ä½ å¯ä»¥ç”¨å¤šé˜¶æ®µæ„å»ºæ¥åšè¿™ä¸€æ­¥)</span>
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
<span class="hljs-meta prompt_">
# </span><span class="bash">5. å¤åˆ¶ä¸šåŠ¡ä»£ç </span>
<span class="hljs-meta prompt_"># </span><span class="bash">æŠŠ app ç›®å½•å¤åˆ¶è¿›å»</span>
COPY app /app/app
<span class="hljs-meta prompt_">
# </span><span class="bash">6. åˆ›å»ºé root ç”¨æˆ· (å®‰å…¨æœ€ä½³å®è·µ)</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Java å®¹å™¨ä¹Ÿæ¨èè¿™ä¹ˆåšï¼Œé˜²æ­¢å®¹å™¨é€ƒé€¸</span>
RUN adduser --disabled-password --gecos "" appuser &amp;&amp; chown -R appuser /app
USER appuser
<span class="hljs-meta prompt_">
# </span><span class="bash">7. æš´éœ²ç«¯å£</span>
EXPOSE 8000
<span class="hljs-meta prompt_">
# </span><span class="bash">8. å¯åŠ¨å‘½ä»¤ (ä½¿ç”¨ Gunicorn)</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æ³¨æ„ï¼šåœ¨ Docker/K8s é‡Œï¼Œé€šå¸¸ workers ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥</span>
CMD ["gunicorn", "app.main:app", "--workers", "4", "--worker-class", "uvicorn.workers.UvicornWorker", "--bind", "0.0.0.0:8000"]
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Golang HTTPè¯·æ±‚è¶…æ—¶ä¸é‡è¯•ï¼šæ„å»ºé«˜å¯é ç½‘ç»œè¯·æ±‚ï½œå¾—ç‰©æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7573601651782385691</link>    <guid>https://juejin.cn/post/7573601651782385691</guid>    <pubDate>2025-11-18T02:58:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573601651782385691" data-draft-id="7573592127298207794" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Golang HTTPè¯·æ±‚è¶…æ—¶ä¸é‡è¯•ï¼šæ„å»ºé«˜å¯é ç½‘ç»œè¯·æ±‚ï½œå¾—ç‰©æŠ€æœ¯"/> <meta itemprop="keywords" content="Go,Java,åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:58:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾—ç‰©æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Golang HTTPè¯·æ±‚è¶…æ—¶ä¸é‡è¯•ï¼šæ„å»ºé«˜å¯é ç½‘ç»œè¯·æ±‚ï½œå¾—ç‰©æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾—ç‰©æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:58:34.000Z" title="Tue Nov 18 2025 02:58:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€åº è¨€</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œè¯·æ±‚çš„å¯é æ€§ç›´æ¥å†³å®šäº†æœåŠ¡è´¨é‡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ çš„æ”¯ä»˜ç³»ç»Ÿå› ç¬¬ä¸‰æ–¹APIè¶…æ—¶å¯¼è‡´è®¢å•çŠ¶æ€ä¸ä¸€è‡´ï¼Œæˆ–å› ç¬æ—¶ç½‘ç»œæŠ–åŠ¨é€ æˆç”¨æˆ·æ“ä½œå¤±è´¥ï¼Œè¿™äº›é—®é¢˜å¾€å¾€æºäºHTTPå®¢æˆ·ç«¯ç¼ºä¹å®Œå–„çš„è¶…æ—¶æ§åˆ¶å’Œé‡è¯•ç­–ç•¥ã€‚Golangæ ‡å‡†åº“è™½ç„¶æä¾›äº†åŸºç¡€çš„HTTPå®¢æˆ·ç«¯å®ç°ï¼Œä½†åœ¨é«˜å¹¶å‘ã€é«˜å¯ç”¨åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´ç²¾ç»†åŒ–çš„ç­–ç•¥æ¥åº”å¯¹å¤æ‚çš„ç½‘ç»œç¯å¢ƒã€‚</p>
<h2 data-id="heading-1">äºŒã€è¶…æ—¶æ§åˆ¶çš„é£é™©ä¸å¿…è¦æ€§</h2>
<p>2024å¹´Cloudflareçš„ç½‘ç»œæŠ¥å‘Šæ˜¾ç¤ºï¼Œ<strong>78%çš„æœåŠ¡ä¸­æ–­äº‹ä»¶ä¸ä¸åˆç†çš„è¶…æ—¶é…ç½®ç›´æ¥ç›¸å…³</strong>ã€‚å½“ä¸€ä¸ªHTTPè¯·æ±‚å› ç›®æ ‡æœåŠ¡æ— å“åº”è€Œé•¿æ—¶é—´é˜»å¡æ—¶ï¼Œä¸ä»…ä¼šå ç”¨å®è´µçš„ç³»ç»Ÿèµ„æºï¼Œæ›´å¯èƒ½å¼•å‘çº§è”æ•…éšœâ€”â€”å¤§é‡å †ç§¯çš„é˜»å¡è¯·æ±‚ä¼šè€—å°½è¿æ¥æ± èµ„æºï¼Œå¯¼è‡´æ–°è¯·æ±‚æ— æ³•å»ºç«‹ï¼Œæœ€ç»ˆæ¼”å˜ä¸ºæœåŠ¡é›ªå´©ã€‚è¶…æ—¶æ§åˆ¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>èµ„æºä¿æŠ¤æœºåˆ¶</strong>ï¼Œé€šè¿‡è®¾å®šåˆç†çš„æ—¶é—´è¾¹ç•Œï¼Œç¡®ä¿å•ä¸ªè¯·æ±‚çš„å¼‚å¸¸ä¸ä¼šæ‰©æ•£åˆ°æ•´ä¸ªç³»ç»Ÿã€‚</p>
<p>è¶…æ—¶é…ç½®ä¸å½“çš„ä¸¤å¤§å…¸å‹é£é™©ï¼š</p>
<ul>
<li><strong>DoSæ”»å‡»æ”¾å¤§æ•ˆåº”</strong>ï¼šç¼ºä¹è¿æ¥è¶…æ—¶é™åˆ¶çš„å®¢æˆ·ç«¯ï¼Œåœ¨é­é‡æ¶æ„æ…¢å“åº”æ”»å‡»æ—¶ï¼Œä¼šç»´æŒå¤§é‡åŠå¼€è¿æ¥ï¼Œè¿…é€Ÿè€—å°½æœåŠ¡å™¨æ–‡ä»¶æè¿°ç¬¦ã€‚</li>
<li><strong>èµ„æºåˆ©ç”¨ç‡å€’æŒ‚</strong>ï¼šå½“ReadTimeoutè®¾ç½®è¿‡é•¿ï¼ˆå¦‚é»˜è®¤çš„0è¡¨ç¤ºæ— é™åˆ¶ï¼‰ï¼Œæ…¢è¯·æ±‚ä¼šé•¿æœŸå ç”¨è¿æ¥æ± èµ„æºã€‚Netflixçš„æ€§èƒ½æ•°æ®æ˜¾ç¤ºï¼Œå°†è¶…æ—¶æ—¶é—´ä»30ç§’ä¼˜åŒ–åˆ°5ç§’åï¼Œè¿æ¥æ± åˆ©ç”¨ç‡æå‡äº†<strong>400%</strong> ï¼ŒæœåŠ¡ååé‡å¢é•¿2.3å€ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€è¶…æ—¶å‚æ•°ç¤ºä¾‹</h2>
<p>æ°¸è¿œä¸è¦ä¾èµ–é»˜è®¤çš„http.DefaultClientï¼Œå…¶Timeoutä¸º0ï¼ˆæ— è¶…æ—¶ï¼‰ã€‚ç”Ÿäº§ç¯å¢ƒå¿…é¡»æ˜¾å¼é…ç½®æ‰€æœ‰è¶…æ—¶å‚æ•°ï¼Œå½¢æˆ<strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ä¹ æƒ¯ã€‚</p>
<p>ä»¥ä¸‹ä»£ç å±•ç¤ºå¦‚ä½•é€šè¿‡net.Dialeré…ç½®è¿æ¥è¶…æ—¶å’Œkeep-aliveç­–ç•¥ï¼š</p>
<pre><code class="hljs language-go" lang="go">transport := &amp;http.Transport{
    DialContext: (&amp;net.Dialer{
        Timeout:   <span class="hljs-number">3</span> * time.Second,  <span class="hljs-comment">// TCPè¿æ¥å»ºç«‹è¶…æ—¶</span>
        KeepAlive: <span class="hljs-number">30</span> * time.Second, <span class="hljs-comment">// è¿æ¥ä¿æ´»æ—¶é—´</span>
        DualStack: <span class="hljs-literal">true</span>,             <span class="hljs-comment">// æ”¯æŒIPv4/IPv6åŒæ ˆ</span>
    }).DialContext,
    ResponseHeaderTimeout: <span class="hljs-number">5</span> * time.Second, <span class="hljs-comment">// ç­‰å¾…å“åº”å¤´è¶…æ—¶</span>
    MaxIdleConnsPerHost:   <span class="hljs-number">100</span>,             <span class="hljs-comment">// æ¯ä¸ªä¸»æœºçš„æœ€å¤§ç©ºé—²è¿æ¥</span>
}
client := &amp;http.Client{
    Transport: transport,
    Timeout:   <span class="hljs-number">10</span> * time.Second, <span class="hljs-comment">// æ•´ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´</span>
}
</code></pre>
<h2 data-id="heading-3">å››ã€åŸºäºcontextçš„è¶…æ—¶å®ç°</h2>
<p>context.Contextä¸ºè¯·æ±‚è¶…æ—¶æä¾›äº†æ›´çµæ´»çš„æ§åˆ¶æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†å¸ƒå¼è¿½è¸ªå’Œè¯·æ±‚å–æ¶ˆåœºæ™¯ä¸­ã€‚ä¸http.Clientçš„è¶…æ—¶å‚æ•°ä¸åŒï¼Œcontextè¶…æ—¶å¯ä»¥å®ç°<strong>è¯·æ±‚çº§åˆ«çš„è¶…æ—¶ä¼ é€’</strong>ï¼Œä¾‹å¦‚åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾ä¸­ä¼ é€’è¶…æ—¶å‰©ä½™æ—¶é—´ã€‚</p>
<p><strong>4.1 ä¸Šä¸‹æ–‡è¶…æ—¶ä¼ é€’</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87ef6a61aec544faa436e039705a0d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039513&amp;x-signature=g%2BgrOUCP%2ByuoQetVhg7fwEoDt60%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œcontexté€šè¿‡WithTimeoutæˆ–WithDeadlineåˆ›å»ºè¶…æ—¶ä¸Šä¸‹æ–‡ï¼Œåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­é€çº§ä¼ é€’ã€‚å½“çˆ¶contextè¢«å–æ¶ˆæ—¶ï¼Œå­contextä¼šç«‹å³ç»ˆæ­¢è¯·æ±‚ï¼Œé¿å…èµ„æºæ³„æ¼ã€‚</p>
<p><strong>4.2 å¸¦è¿½è¸ªçš„è¶…æ—¶æ§åˆ¶</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">requestWithTracing</span><span class="hljs-params">(ctx context.Context)</span></span> (*http.Response, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// ä»çˆ¶ä¸Šä¸‹æ–‡æ´¾ç”Ÿ5ç§’è¶…æ—¶çš„å­ä¸Šä¸‹æ–‡</span>
    ctx, cancel := context.WithTimeout(ctx, <span class="hljs-number">5</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel() <span class="hljs-comment">// ç¡®ä¿æ— è®ºæˆåŠŸå¤±è´¥éƒ½å–æ¶ˆä¸Šä¸‹æ–‡</span>
    
    req, err := http.NewRequestWithContext(ctx, <span class="hljs-string">"GET"</span>, <span class="hljs-string">"https://api.example.com/data"</span>, <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"åˆ›å»ºè¯·æ±‚å¤±è´¥: %v"</span>, err)
    }
    
    <span class="hljs-comment">// æ·»åŠ åˆ†å¸ƒå¼è¿½è¸ªä¿¡æ¯</span>
    req.Header.Set(<span class="hljs-string">"X-Request-ID"</span>, ctx.Value(<span class="hljs-string">"request-id"</span>).(<span class="hljs-type">string</span>))
    
    client := &amp;http.Client{
        Transport: &amp;http.Transport{
            DialContext: (&amp;net.Dialer{
                Timeout: <span class="hljs-number">2</span> * time.Second,
            }).DialContext,
        },
        <span class="hljs-comment">// æ³¨æ„: æ­¤å¤„ä¸è®¾ç½®Timeoutï¼Œå®Œå…¨ç”±contextæ§åˆ¶</span>
    }
    
    resp, err := client.Do(req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// åŒºåˆ†ä¸Šä¸‹æ–‡å–æ¶ˆå’Œå…¶ä»–é”™è¯¯</span>
        <span class="hljs-keyword">if</span> ctx.Err() == context.DeadlineExceeded {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"è¯·æ±‚è¶…æ—¶: %w"</span>, ctx.Err())
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"è¯·æ±‚å¤±è´¥: %v"</span>, err)
    }
    <span class="hljs-keyword">return</span> resp, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>å…³é”®åŒºåˆ«ï¼šcontext.WithTimeoutä¸http.Client.Timeoutæ˜¯å åŠ å…³ç³»è€Œéæ›¿ä»£å…³ç³»ã€‚å½“åŒæ—¶è®¾ç½®æ—¶ï¼Œå–ä¸¤è€…ä¸­è¾ƒå°çš„å€¼ã€‚</p>
<h2 data-id="heading-4">äº”ã€é‡è¯•ç­–ç•¥</h2>
<p>ç½‘ç»œè¯·æ±‚å¤±è´¥ä¸å¯é¿å…ï¼Œä½†ç›²ç›®é‡è¯•å¯èƒ½åŠ å‰§æœåŠ¡è´Ÿè½½ï¼Œç”šè‡³å¼•å‘<strong>æƒŠç¾¤æ•ˆåº”</strong>ã€‚ä¸€ä¸ªå¥å£®çš„é‡è¯•æœºåˆ¶éœ€è¦ç»“åˆé”™è¯¯ç±»å‹åˆ¤æ–­ã€é€€é¿ç®—æ³•å’Œå¹‚ç­‰æ€§ä¿è¯ï¼Œåœ¨å¯é æ€§å’ŒæœåŠ¡ä¿æŠ¤é—´å–å¾—å¹³è¡¡ã€‚</p>
<p><strong>5.1 æŒ‡æ•°é€€é¿ä¸æŠ–åŠ¨</strong></p>
<p>æŒ‡æ•°é€€é¿é€šè¿‡é€æ¸å¢åŠ é‡è¯•é—´éš”ï¼Œé¿å…å¯¹æ•…éšœæœåŠ¡é€ æˆäºŒæ¬¡å†²å‡»ã€‚Golangå®ç°ä¸­éœ€åŠ å…¥éšæœºæŠ–åŠ¨ï¼Œé˜²æ­¢å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶é‡è¯•å¯¼è‡´çš„<strong>æ³¢å³°æ•ˆåº”</strong>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç®€å•çš„é‡è¯•å®ç°ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> RetryPolicy <span class="hljs-keyword">struct</span> {
    MaxRetries    <span class="hljs-type">int</span>
    InitialBackoff time.Duration
    MaxBackoff    time.Duration
    JitterFactor  <span class="hljs-type">float64</span> <span class="hljs-comment">// æŠ–åŠ¨ç³»æ•°ï¼Œå»ºè®®0.1-0.5</span>
}


<span class="hljs-comment">// å¸¦æŠ–åŠ¨çš„æŒ‡æ•°é€€é¿</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(rp *RetryPolicy)</span></span> Backoff(attempt <span class="hljs-type">int</span>) time.Duration {
    <span class="hljs-keyword">if</span> attempt &lt;= <span class="hljs-number">0</span> {
        <span class="hljs-keyword">return</span> rp.InitialBackoff
    }
    <span class="hljs-comment">// æŒ‡æ•°å¢é•¿: InitialBackoff * 2^(attempt-1)</span>
    backoff := rp.InitialBackoff * (<span class="hljs-number">1</span> &lt;&lt; (attempt - <span class="hljs-number">1</span>))
    <span class="hljs-keyword">if</span> backoff &gt; rp.MaxBackoff {
        backoff = rp.MaxBackoff
    }
    <span class="hljs-comment">// æ·»åŠ æŠ–åŠ¨: [backoff*(1-jitter), backoff*(1+jitter)]</span>
    jitter := time.Duration(rand.Float64() * <span class="hljs-type">float64</span>(backoff) * rp.JitterFactor)
    <span class="hljs-keyword">return</span> backoff - jitter + <span class="hljs-number">2</span>*jitter <span class="hljs-comment">// å‡åŒ€åˆ†å¸ƒåœ¨æŠ–åŠ¨èŒƒå›´å†…</span>
}


<span class="hljs-comment">// é€šç”¨é‡è¯•æ‰§è¡Œå™¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Retry</span><span class="hljs-params">(ctx context.Context, policy RetryPolicy, fn <span class="hljs-keyword">func</span>()</span></span> <span class="hljs-type">error</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>
    <span class="hljs-keyword">for</span> attempt := <span class="hljs-number">0</span>; attempt &lt;= policy.MaxRetries; attempt++ {
        <span class="hljs-keyword">if</span> attempt &gt; <span class="hljs-number">0</span> {
            <span class="hljs-comment">// æ£€æŸ¥ä¸Šä¸‹æ–‡æ˜¯å¦å·²å–æ¶ˆ</span>
            <span class="hljs-keyword">select</span> {
            <span class="hljs-keyword">case</span> &lt;-ctx.Done():
                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"é‡è¯•è¢«å–æ¶ˆ: %w"</span>, ctx.Err())
            <span class="hljs-keyword">default</span>:
            }
            
            backoff := policy.Backoff(attempt)
            timer := time.NewTimer(backoff)
            <span class="hljs-keyword">select</span> {
            <span class="hljs-keyword">case</span> &lt;-timer.C:
            <span class="hljs-keyword">case</span> &lt;-ctx.Done():
                timer.Stop()
                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"é‡è¯•è¢«å–æ¶ˆ: %w"</span>, ctx.Err())
            }
        }
        
        err = fn()
        <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }
        
        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡è¯•</span>
        <span class="hljs-keyword">if</span> !shouldRetry(err) {
            <span class="hljs-keyword">return</span> err
        }
    }
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•° %d: %w"</span>, policy.MaxRetries, err)
}
</code></pre>
<p><strong>5.2 é”™è¯¯ç±»å‹åˆ¤æ–­</strong></p>
<p>ç›²ç›®é‡è¯•æ‰€æœ‰é”™è¯¯ä¸ä»…æ— æ•ˆï¼Œè¿˜å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚shouldRetryå‡½æ•°éœ€è¦ç²¾ç¡®åŒºåˆ†å¯é‡è¯•é”™è¯¯ç±»å‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldRetry</span><span class="hljs-params">(err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">bool</span> {
    <span class="hljs-comment">// ç½‘ç»œå±‚é¢é”™è¯¯</span>
    <span class="hljs-keyword">var</span> netErr net.Error
    <span class="hljs-keyword">if</span> errors.As(err, &amp;netErr) {
        <span class="hljs-comment">// è¶…æ—¶é”™è¯¯å’Œä¸´æ—¶ç½‘ç»œé”™è¯¯å¯é‡è¯•</span>
        <span class="hljs-keyword">return</span> netErr.Timeout() || netErr.Temporary()
    }
    
    <span class="hljs-comment">// HTTPçŠ¶æ€ç åˆ¤æ–­</span>
    <span class="hljs-keyword">var</span> respErr *url.Error
    <span class="hljs-keyword">if</span> errors.As(err, &amp;respErr) {
        <span class="hljs-keyword">if</span> resp, ok := respErr.Response.(*http.Response); ok {
            <span class="hljs-keyword">switch</span> resp.StatusCode {
            <span class="hljs-keyword">case</span> <span class="hljs-number">429</span>, <span class="hljs-number">500</span>, <span class="hljs-number">502</span>, <span class="hljs-number">503</span>, <span class="hljs-number">504</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// é™æµå’ŒæœåŠ¡å™¨é”™è¯¯å¯é‡è¯•</span>
            <span class="hljs-keyword">case</span> <span class="hljs-number">408</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶å¯é‡è¯•</span>
            }
        }
    }
    
    <span class="hljs-comment">// åº”ç”¨å±‚è‡ªå®šä¹‰é”™è¯¯</span>
    <span class="hljs-keyword">if</span> errors.Is(err, ErrRateLimited) || errors.Is(err, ErrServiceUnavailable) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
</code></pre>
<p>è¡Œä¸šæœ€ä½³å®è·µï¼šNetflixçš„é‡è¯•ç­–ç•¥å»ºè®®ï¼šå¯¹5xxé”™è¯¯æœ€å¤šé‡è¯•3æ¬¡ï¼Œå¯¹429é”™è¯¯ä½¿ç”¨Retry-Afterå¤´æŒ‡å®šçš„é—´éš”ï¼Œå¯¹ç½‘ç»œé”™è¯¯ä½¿ç”¨æŒ‡æ•°é€€é¿ï¼ˆåˆå§‹100msï¼Œæœ€å¤§5ç§’ï¼‰ã€‚</p>
<h2 data-id="heading-5">å…­ã€å¹‚ç­‰æ€§ä¿è¯</h2>
<p>é‡è¯•æœºåˆ¶çš„å‰ææ˜¯<strong>è¯·æ±‚å¿…é¡»æ˜¯å¹‚ç­‰çš„</strong>ï¼Œå¦åˆ™é‡è¯•å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼ˆå¦‚é‡å¤æ‰£æ¬¾ï¼‰ã€‚å®ç°å¹‚ç­‰æ€§çš„æ ¸å¿ƒæ˜¯ç¡®ä¿å¤šæ¬¡ç›¸åŒè¯·æ±‚äº§ç”Ÿç›¸åŒçš„å‰¯ä½œç”¨ï¼Œå¸¸è§æ–¹æ¡ˆåŒ…æ‹¬è¯·æ±‚IDæœºåˆ¶å’Œä¹è§‚é”ã€‚</p>
<p><strong>6.1 è¯·æ±‚ID+Rediså®ç°</strong></p>
<p>åŸºäºUUIDè¯·æ±‚IDå’ŒRedisçš„å¹‚ç­‰æ€§æ£€æŸ¥æœºåˆ¶ï¼Œå¯ç¡®ä¿é‡å¤è¯·æ±‚ä»…è¢«å¤„ç†ä¸€æ¬¡ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> IdempotentClient <span class="hljs-keyword">struct</span> {
    redisClient *redis.Client
    prefix      <span class="hljs-type">string</span>        <span class="hljs-comment">// Redisé”®å‰ç¼€</span>
    ttl         time.Duration <span class="hljs-comment">// å¹‚ç­‰é”®è¿‡æœŸæ—¶é—´</span>
}


<span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€è¯·æ±‚ID</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ic *IdempotentClient)</span></span> NewRequestID() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> uuid.New().String()
}


<span class="hljs-comment">// æ‰§è¡Œå¹‚ç­‰è¯·æ±‚</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(ic *IdempotentClient)</span></span> Do(req *http.Request, requestID <span class="hljs-type">string</span>) (*http.Response, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²å¤„ç†</span>
    key := fmt.Sprintf(<span class="hljs-string">"%s:%s"</span>, ic.prefix, requestID)
    exists, err := ic.redisClient.Exists(req.Context(), key).Result()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"å¹‚ç­‰æ£€æŸ¥å¤±è´¥: %v"</span>, err)
    }
    <span class="hljs-keyword">if</span> exists == <span class="hljs-number">1</span> {
        <span class="hljs-comment">// è¿”å›ç¼“å­˜çš„å“åº”æˆ–æ ‡è®°ä¸ºé‡å¤è¯·æ±‚</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"è¯·æ±‚å·²å¤„ç†: %s"</span>, requestID)
    }
    
    <span class="hljs-comment">// ä½¿ç”¨SET NXç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚èƒ½é€šè¿‡æ£€æŸ¥</span>
    set, err := ic.redisClient.SetNX(
        req.Context(),
        key,
        <span class="hljs-string">"processing"</span>,
        ic.ttl,
    ).Result()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"å¹‚ç­‰é”å¤±è´¥: %v"</span>, err)
    }
    <span class="hljs-keyword">if</span> !set {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"å¹¶å‘è¯·æ±‚å†²çª: %s"</span>, requestID)
    }
    
    <span class="hljs-comment">// æ‰§è¡Œè¯·æ±‚</span>
    client := &amp;http.Client{<span class="hljs-comment">/* é…ç½® */</span>}
    resp, err := client.Do(req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// è¯·æ±‚å¤±è´¥æ—¶åˆ é™¤å¹‚ç­‰æ ‡è®°</span>
        ic.redisClient.Del(req.Context(), key)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// è¯·æ±‚æˆåŠŸï¼Œæ›´æ–°å¹‚ç­‰æ ‡è®°çŠ¶æ€</span>
    ic.redisClient.Set(req.Context(), key, <span class="hljs-string">"completed"</span>, ic.ttl)
    <span class="hljs-keyword">return</span> resp, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>å…³é”®è®¾è®¡ï¼šå¹‚ç­‰é”®çš„TTLåº”å¤§äºæœ€å¤§é‡è¯•å‘¨æœŸ+ä¸šåŠ¡å¤„ç†æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œè‹¥æœ€å¤§é‡è¯•é—´éš”ä¸º30ç§’ï¼Œå¤„ç†è€—æ—¶5ç§’ï¼Œå»ºè®®TTLè®¾ç½®ä¸º60ç§’ï¼Œé¿å…é‡è¯•è¿‡ç¨‹ä¸­é”®è¿‡æœŸå¯¼è‡´çš„é‡å¤å¤„ç†ã€‚</p>
<p><strong>6.2 ä¸šåŠ¡å±‚å¹‚ç­‰ç­–ç•¥</strong></p>
<p>å¯¹äºå†™æ“ä½œï¼Œè¿˜éœ€åœ¨ä¸šåŠ¡å±‚å®ç°å¹‚ç­‰é€»è¾‘ï¼š</p>
<ul>
<li><strong>æ›´æ–°æ“ä½œ</strong>ï¼šä½¿ç”¨ä¹è§‚é”ï¼ˆå¦‚UPDATE ... WHERE version = ?ï¼‰</li>
<li><strong>åˆ›å»ºæ“ä½œ</strong>ï¼šä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ˆå¦‚è®¢å•å·ã€å¤–éƒ¨äº¤æ˜“å·ï¼‰</li>
<li><strong>åˆ é™¤æ“ä½œ</strong>ï¼šé‡‡ç”¨"æ ‡è®°åˆ é™¤"è€Œéç‰©ç†åˆ é™¤</li>
</ul>
<h2 data-id="heading-6">ä¸ƒã€æ€§èƒ½ä¼˜åŒ–</h2>
<p>é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒHTTPå®¢æˆ·ç«¯çš„æ€§èƒ½ç“¶é¢ˆé€šå¸¸ä¸åœ¨äºç½‘ç»œå»¶è¿Ÿï¼Œè€Œåœ¨äºè¿æ¥ç®¡ç†å’Œå†…å­˜åˆ†é…ã€‚é€šè¿‡åˆç†é…ç½®è¿æ¥æ± å’Œå¤ç”¨èµ„æºï¼Œå¯æ˜¾è‘—æå‡ååé‡ã€‚</p>
<p><strong>7.1 è¿æ¥æ± é…ç½®</strong></p>
<p>http.Transportçš„è¿æ¥æ± å‚æ•°ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“å·¨å¤§ï¼Œä»¥ä¸‹æ˜¯ç»è¿‡ç”Ÿäº§éªŒè¯çš„é…ç½®ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">func</span> <span class="hljs-string">NewOptimizedTransport()</span> <span class="hljs-string">*http.Transport</span> {
    <span class="hljs-string">return</span> <span class="hljs-string">&amp;http.Transport</span>{
        <span class="hljs-string">//</span> <span class="hljs-string">è¿æ¥æ± é…ç½®</span>
        <span class="hljs-attr">MaxIdleConns:</span>        <span class="hljs-number">1000</span>,  <span class="hljs-string">//</span> <span class="hljs-string">å…¨å±€æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="hljs-attr">MaxIdleConnsPerHost:</span> <span class="hljs-number">100</span>,   <span class="hljs-string">//</span> <span class="hljs-string">æ¯ä¸ªä¸»æœºçš„æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="hljs-attr">IdleConnTimeout:</span>     <span class="hljs-number">90</span> <span class="hljs-string">*</span> <span class="hljs-string">time.Second</span>, <span class="hljs-string">//</span> <span class="hljs-string">ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´</span>
        
        <span class="hljs-string">//</span> <span class="hljs-string">TCPé…ç½®</span>
        <span class="hljs-attr">DialContext:</span> <span class="hljs-string">(&amp;net.Dialer</span>{
            <span class="hljs-attr">Timeout:</span>   <span class="hljs-number">2</span> <span class="hljs-string">*</span> <span class="hljs-string">time.Second</span>,
            <span class="hljs-attr">KeepAlive:</span> <span class="hljs-number">30</span> <span class="hljs-string">*</span> <span class="hljs-string">time.Second</span>,
        }<span class="hljs-string">).DialContext</span>,
        
        <span class="hljs-string">//</span> <span class="hljs-string">TLSé…ç½®</span>
        <span class="hljs-attr">TLSHandshakeTimeout:</span> <span class="hljs-number">5</span> <span class="hljs-string">*</span> <span class="hljs-string">time.Second</span>,
        <span class="hljs-attr">TLSClientConfig:</span> <span class="hljs-string">&amp;tls.Config</span>{
            <span class="hljs-attr">InsecureSkipVerify:</span> <span class="hljs-literal">false</span>,
            <span class="hljs-attr">MinVersion:</span>         <span class="hljs-string">tls.VersionTLS12</span>,
        },
        
        <span class="hljs-string">//</span> <span class="hljs-string">å…¶ä»–ä¼˜åŒ–</span>
        <span class="hljs-attr">ExpectContinueTimeout:</span> <span class="hljs-number">1</span> <span class="hljs-string">*</span> <span class="hljs-string">time.Second</span>,
        <span class="hljs-attr">DisableCompression:</span>    <span class="hljs-literal">false</span>, <span class="hljs-string">//</span> <span class="hljs-string">å¯ç”¨å‹ç¼©</span>
    }
}
</code></pre>
<p>Uberçš„æ€§èƒ½æµ‹è¯•æ˜¾ç¤ºï¼Œå°†MaxIdleConnsPerHostä»é»˜è®¤çš„2æå‡åˆ°100åï¼Œé’ˆå¯¹åŒä¸€APIçš„å¹¶å‘è¯·æ±‚å»¶è¿Ÿä»85msé™è‡³12msï¼Œååé‡æå‡6å€ã€‚</p>
<p><strong>7.2 sync.Poolå†…å­˜å¤ç”¨</strong></p>
<p>é¢‘ç¹åˆ›å»ºhttp.Requestå’Œhttp.Responseä¼šå¯¼è‡´å¤§é‡å†…å­˜åˆ†é…å’ŒGCå‹åŠ›ã€‚ä½¿ç”¨sync.Poolå¤ç”¨è¿™äº›å¯¹è±¡å¯å‡å°‘90%çš„å†…å­˜åˆ†é…ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> requestPool = sync.Pool{
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">interface</span>{} {
        <span class="hljs-keyword">return</span> &amp;http.Request{
            Header: <span class="hljs-built_in">make</span>(http.Header),
        }
    },
}


<span class="hljs-comment">// ä»æ± è·å–è¯·æ±‚å¯¹è±¡</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AcquireRequest</span><span class="hljs-params">()</span></span> *http.Request {
    req := requestPool.Get().(*http.Request)
    <span class="hljs-comment">// é‡ç½®å¿…è¦å­—æ®µ</span>
    req.Method = <span class="hljs-string">""</span>
    req.URL = <span class="hljs-literal">nil</span>
    req.Body = <span class="hljs-literal">nil</span>
    req.ContentLength = <span class="hljs-number">0</span>
    req.Header.Reset()
    <span class="hljs-keyword">return</span> req
}


<span class="hljs-comment">// é‡Šæ”¾è¯·æ±‚å¯¹è±¡åˆ°æ± </span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReleaseRequest</span><span class="hljs-params">(req *http.Request)</span></span> {
    requestPool.Put(req)
}
</code></pre>
<h2 data-id="heading-7">å…«ã€æ€»ç»“</h2>
<p>HTTPè¯·æ±‚çœ‹ä¼¼ç®€å•ï¼Œä½†å®ƒè¿æ¥ç€æ•´ä¸ªç³»ç»Ÿçš„"è¡€ç®¡"ã€‚å¿½è§†è¶…æ—¶å’Œé‡è¯•ï¼Œå°±åƒåœ¨è¡€ç®¡ä¸Šç•™äº†ä¸ªç¼ºå£â€”â€”å¹³æ—¶æ²¡äº‹ï¼Œå‹åŠ›ä¸€æ¥å°±å¤§å‡ºè¡€ã€‚æ„å»ºé«˜å¯é çš„ç½‘ç»œè¯·æ±‚éœ€è¦åœ¨è¶…æ—¶æ§åˆ¶ã€é‡è¯•ç­–ç•¥ã€å¹‚ç­‰æ€§ä¿è¯å’Œæ€§èƒ½ä¼˜åŒ–ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p>
<p>è®°ä½ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<strong>è¶…æ—¶å’Œé‡è¯•ä¸æ˜¯å¯é€‰åŠŸèƒ½ï¼Œè€Œæ˜¯ç”Ÿå­˜å¿…éœ€ã€‚</strong></p>
<p>æ‰©å±•èµ„æºï¼š</p>
<ul>
<li>Golangå®˜æ–¹HTTPå®¢æˆ·ç«¯æ–‡æ¡£ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fnet%2Fhttp%25EF%25BC%2589" target="_blank" title="https://pkg.go.dev/net/http%EF%BC%89" ref="nofollow noopener noreferrer">pkg.go.dev/net/httpï¼‰</a></li>
<li>Netflix Hystrixè¶…æ—¶è®¾è®¡æ¨¡å¼ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNetflix%2FHystrix%2Fwiki%2FConfiguration%25EF%25BC%2589" target="_blank" title="https://github.com/Netflix/Hystrix/wiki/Configuration%EF%BC%89" ref="nofollow noopener noreferrer">github.com/Netflix/Hysâ€¦</a></li>
</ul>
<h2 data-id="heading-8">å¾€æœŸå›é¡¾</h2>
<ol>
<li>
<p>RNä¸hawkç¢°æ’çš„ç«èŠ±ä¹‹C++å¼‚å¸¸æ•è·ï½œå¾—ç‰©æŠ€æœ¯</p>
</li>
<li>
<p>å¾—ç‰©TiDBå‡çº§å®è·µ</p>
</li>
<li>
<p>å¾—ç‰©ç®¡ç†ç±»ç›®é…ç½®çº¿ä¸ŠåŒ–ï¼šä»ä¸šåŠ¡ç—›ç‚¹åˆ°æŠ€æœ¯å®ç°</p>
</li>
<li>
<p>å¤§æ¨¡å‹å¦‚ä½•é©æ–°æœç´¢ç›¸å…³æ€§ï¼Ÿæ™ºèƒ½å‡çº§è®©æœç´¢æ›´â€œæ‡‚ä½ â€ï½œå¾—ç‰©æŠ€æœ¯</p>
</li>
<li>
<p>RAGâ€”Chunkingç­–ç•¥å®æˆ˜ï½œå¾—ç‰©æŠ€æœ¯</p>
</li>
</ol>
<h2 data-id="heading-9">æ–‡ /æ¢§</h2>
<p>å…³æ³¨å¾—ç‰©æŠ€æœ¯ï¼Œæ¯å‘¨æ›´æ–°æŠ€æœ¯å¹²è´§</p>
<p>è¦æ˜¯è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿è¯„è®ºè½¬å‘ç‚¹èµï½</p>
<p>æœªç»å¾—ç‰©æŠ€æœ¯è®¸å¯ä¸¥ç¦è½¬è½½ï¼Œå¦åˆ™ä¾æ³•è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 12ï¼š09. åŸºäºNuxtå¼€å‘åšå®¢é¡¹ç›®-ä½¿ç”¨NuxtContentæ„å»ºåšå®¢æ¨¡å—]]></title>    <link>https://juejin.cn/post/7573776814927446035</link>    <guid>https://juejin.cn/post/7573776814927446035</guid>    <pubDate>2025-11-18T03:30:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573776814927446035" data-draft-id="7573631442312609798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 12ï¼š09. åŸºäºNuxtå¼€å‘åšå®¢é¡¹ç›®-ä½¿ç”¨NuxtContentæ„å»ºåšå®¢æ¨¡å—"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-18T03:30:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”³é˜³"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 12ï¼š09. åŸºäºNuxtå¼€å‘åšå®¢é¡¹ç›®-ä½¿ç”¨NuxtContentæ„å»ºåšå®¢æ¨¡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”³é˜³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:30:51.000Z" title="Tue Nov 18 2025 03:30:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.hljs-comment,.hljs-quote,.hljs-variable{color:green}.hljs-built_in,.hljs-keyword,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#00f}.hljs-addition,.hljs-attribute,.hljs-literal,.hljs-section,.hljs-string,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type{color:#a31515}.hljs-deletion,.hljs-meta,.hljs-selector-attr,.hljs-selector-pseudo{color:#2b91af}.hljs-doctag{color:grey}.hljs-attr{color:red}.hljs-bullet,.hljs-link,.hljs-symbol{color:#00b0e8}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df86e40dd69f4632aa6fba29585aa97d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=hlKOs9cGdzZA2mWGMfDpYXHJyow%3D" alt="PixPin_2025-11-18_11-05-26.gif" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>ç”¨å®˜ç½‘çš„ä»‹ç»æ¥è¯´ï¼Œè¿™å…¶å®æ˜¯ä¸“ä¸º<code>Nuxt</code>å¼€å‘äººå‘˜è®¾è®¡çš„ä¸€æ¬¾å¼ºå¤§çš„åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„<code>CMS</code> ç³»ç»Ÿã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcontent.nuxt.com%2F%25EF%25BC%258C" target="_blank" title="https://content.nuxt.com/%EF%BC%8C" ref="nofollow noopener noreferrer">content.nuxt.com/ï¼Œ</a> è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒå¥½çš„ä¸­æ–‡ç¿»è¯‘ç«™ç‚¹ï¼Œæˆ‘å»ºè®®å¤§å®¶ç›´æ¥çœ‹å®˜ç½‘åŸæ–‡æ¡£ï¼Œé¿å…å› ä¸ºç‰ˆæœ¬ä¸åŒè€Œè¸©å‘ã€‚</p>
<h2 data-id="heading-1">äºŒã€é¡µé¢å¸ƒå±€è®¾è®¡</h2>
<p>è¿™é‡Œæˆ‘å‚è€ƒäº†ä¸€äº›åšå®¢ç«™ç‚¹çš„è®¾è®¡ï¼Œæˆ‘å¸Œæœ›å·¦è¾¹æ˜¯ä¸€ä¸ªåˆé›†çš„å±•ç¤ºï¼Œç‚¹å‡»ä¸“æ ï¼Œå³ä¾§æ˜¾ç¤ºå‡ºå…·ä½“çš„æ–‡ç« åˆ—è¡¨ï¼Œç‚¹å‡»æ–‡ç« åè¿›å…¥è¯¦ç»†å†…å®¹æŸ¥çœ‹é¡µé¢ã€‚å¤§æ¦‚å¾—ç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ccd1e5bb7bb4cf0a69ea8dd71991bbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=IdkxqcHBZeh4KJZzTqrhE6Svoc0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">ä¸‰ã€æ•´åˆ NuxtContent</h2>
<h3 data-id="heading-3">1. å®‰è£…æ¨¡å—</h3>
<pre><code class="hljs language-bash" lang="bash">npx nuxt module add content
</code></pre>
<blockquote>
<p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ åº”è¯¥ä¼šç¢°åˆ°ä»¥ä¸‹æŠ¥é”™</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/593829820eb84d31bde4b711840ac596~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=9ooJIyauHnPpiHfBd3LUTTkRC8s%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ä¸è¦æ…Œï¼Œé¦–å…ˆæˆ‘æ˜¯å®Œå…¨æŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œæ“ä½œçš„ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œè‚¯å®šä¼šæœ‰äººåé¦ˆï¼Œæ‰€ä»¥ç¬¬ä¸€æ—¶é—´æˆ‘å°±å»<code>github</code>çš„ <code>issues</code> é‡Œç¿»äº†ä¸€ä¸‹ï¼Œæœä¸å…¶ç„¶ï¼Œæœ‰å¾ˆå¤šäººéƒ½åé¦ˆäº†è¿™ä¸ªé—®é¢˜ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±å»äº†è§£ä¸€ä¸‹ã€‚è¿™é‡Œæˆ‘ç»™å‡ºç›´è¾¾é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnuxt%2Fcontent%2Fissues%3Fq%3DCould%2520not%2520locate%2520the%2520bindings%2520file%25EF%25BC%258C%25E6%259C%2580%25E7%25BB%2588%25E5%25BE%2597%25E5%2587%25BA%25E7%259A%2584%25E7%25BB%2593%25E8%25AE%25BA%25E6%2598%25AF" target="_blank" title="https://github.com/nuxt/content/issues?q=Could%20not%20locate%20the%20bindings%20file%EF%BC%8C%E6%9C%80%E7%BB%88%E5%BE%97%E5%87%BA%E7%9A%84%E7%BB%93%E8%AE%BA%E6%98%AF" ref="nofollow noopener noreferrer">github.com/nuxt/contenâ€¦</a> <code>node</code> ç‰ˆæœ¬è¿‡é«˜ï¼Œåœ¨ <code>pnpm@10</code> ä¹‹åæœ‰ä¸€äº›ç ´åæ€§çš„æ›´æ–°ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffb00d567622427ab42a07d60d286184~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=gGY5Z%2FX8TNd1Uq%2BCwEP4PKyJ1GQ%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>é‡æ–°å®‰è£…ä¸€ä¸‹ä¸€æ¥ <code>pnpm i</code>ï¼Œæˆ‘å‘ç°äº†è¿™ä¸ª</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b812468c433d434883cab1da321bdd5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=2B85YMmsyIYEwzGLQ5sK6q%2F3gjI%3D" alt="image.png" loading="lazy"/></p>
<p>æ ¹æ®æç¤ºï¼Œæˆ‘å°è¯•äº†ä¸€ä¸‹æ‰§è¡Œ<code>pnpm approve-builds</code>, å¹¶ä¸”å‹¾é€‰ä¸Šä»¥ä¸‹ä¾èµ–</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63da803f46c745bc8a1c1b9c53a6a1e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=Vl4Ot2LinkEkYyp7Hi%2FNmp8Azn4%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>æŠ¥é”™ï¼Œå®‰è£…ä¸æˆåŠŸ</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/851c020d46924ae4bc1635ed0b023e9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=VrLodekcEFhp6fkxrhmFsY%2B62uM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b88fe256d4e495eb781a518a1993fab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=DJjtUEkI5wyUUSlcIBwAfp6GVYQ%3D" alt="image.png" loading="lazy"/>
å¤§è‡´æ„æ€æ˜¯è¯´ï¼Œå®ƒéœ€è¦ä¾èµ–æˆ‘æœ¬åœ°çš„ <code>Visual Studio</code> æ¥è¿›è¡Œç¼–è¯‘ï¼Œè¿˜å’Œ <code>c++</code>æœ‰ç‚¹å…³ç³»ï¼Œè¯´å·§ä¸å·§ï¼Œæˆ‘å‰å‡ å¤©åˆšæŠŠè¿™ç©æ„å¸è½½äº†ï¼Œä¹‹å‰å­¦ä¹ <code>c#</code>çš„æ—¶å€™è£…è¿‡ã€‚æˆ‘è‚¯å®šä¸ä¼šå†è£…å›å»äº†ï¼Œè¿™æœ‰ç‚¹åç›´è§‰äº†ï¼Œéš¾é“æˆ‘ç”¨è¿™ä¸ªè¿˜å¾—ä¸ºä½ è£…ä¸ªæœ¬åœ°çš„ç¼–è¯‘å™¨å˜›ã€‚<strong>æˆ‘éƒ½æ‡’å¾—å»è¯•è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæˆ‘è§‰å¾—å¾ˆä¸åˆç†ã€‚</strong></p>
<blockquote>
<p>æˆ‘åˆå»å®˜ç½‘æ‰«äº†ä¸€é , æœäº†ä¸€ä¸‹å…³é”®è¯ <code>better-sqlite3</code></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30767b105a4741f98cb6a8904c6e0468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=w%2FCsckh5Na0IuEQ9cvnQS%2FtZqlk%3D" alt="image.png" loading="lazy"/></p>
<p>éå¸¸å¥½ï¼Œ<code>install</code> çš„æ—¶å€™å®˜æ–¹è¿™é‡Œæœ‰æç¤º</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a09ec99768c4bafb50fe096f88849ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=cS%2FCIEAjhQzu3c150Uqp5EL5nXg%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿®æ”¹é…ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40131dec09264d57b4ad0f14d72a5960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=dzJkmxuGSv34n%2FZgR%2BdO7%2FvYuMw%3D" alt="image.png" loading="lazy"/></p>
<p>é‡æ–°å¯åŠ¨é¡¹ç›®ï¼Œè¿è¡ŒæˆåŠŸã€‚</p>
<p><strong>é—®é¢˜è§£å†³ã€‚</strong></p>
<p>å°†åˆšåˆšæ‰§è¡Œ <code>pnpm approve-builds</code> é€ æˆçš„å½±å“è¿˜åŸ</p>
<ul>
<li>åˆ é™¤ç”Ÿæˆçš„ <code>pnpm-workspace.yaml</code> æ–‡ä»¶</li>
<li>å¸è½½ <code>sqlite3</code> ç›¸å…³ä¾èµ–</li>
</ul>
<blockquote>
<p><strong>åçœï¼Œçœ‹æ–‡æ¡£è¿˜æ˜¯ä¸å¤Ÿä»”ç»†å•Šï¼</strong>
è€½è¯¯äº†ä¸€äº›æ—¶é—´ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªæ’æŸ¥æ­¥éª¤è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥èŠ±äº†å¤§é‡ç¯‡å¹…è®°å½•ä¸‹æ¥äº†ï¼Œå¸Œæœ›å¯¹çœ‹æˆ‘åšå®¢çš„ä½ èƒ½æœ‰æ‰€å¸®åŠ©ã€‚</p>
</blockquote>
<h3 data-id="heading-4">2. ç»„ç»‡æˆ‘ä»¬çš„æ–‡ä»¶ç»“æ„</h3>
<h4 data-id="heading-5">1. é¡µé¢ç»“æ„</h4>
<pre><code class="hljs language-ini" lang="ini">pages                
â”œâ”€ blog              
â”‚  â”œâ”€ index.vue      <span class="hljs-comment"># é»˜è®¤åŠ è½½é¡µé¢</span>
â”‚  â””â”€ <span class="hljs-section">[...slug]</span>.vue  <span class="hljs-comment"># åŠ¨æ€è¯¦æƒ…é¡µ</span>
â”œâ”€ about.vue         
â”œâ”€ index.vue         
â””â”€ tools.vue         
</code></pre>
<h4 data-id="heading-6">2. æ–‡æ¡£ç»“æ„ (æ²¡æœ‰ content ç›®å½•è‡ªå·±æ–°å»ºä¸€ä¸ª)</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">content</span>           
â””â”€ blog           
   â””â”€ v2h         
      â”œâ”€ day1<span class="hljs-selector-class">.md</span>  
      â””â”€ day2<span class="hljs-selector-class">.md</span>  
</code></pre>
<blockquote>
<p>è¿™é‡Œç®€å•è§£é‡Šä¸€ä¸‹ï¼Œ<code>blog</code> æ˜¯ä¸€ä¸ªåˆé›†ï¼Œè¡¨ç¤ºè¿™é‡Œå­˜æ”¾çš„æ˜¯æ‰€æœ‰åšå®¢æ–‡ç« ï¼Œ<code>v2h</code> æ„æ€æ˜¯ <code>value 2 hours</code> æ¯å¤©ä¸¤å°æ—¶è¿™ä¸ªä¸“æ çš„æ„æ€ï¼Œ<code>day1.md</code> åˆ™è¡¨ç¤ºä¸“æ ä¸‹çš„æ–‡ç« ã€‚</p>
</blockquote>
<h3 data-id="heading-7">3. è¯»å–æ–‡ä»¶å†…å®¹</h3>
<p>æ¥ä¸‹æ¥å°±æ˜¯å°†æˆ‘ä»¬çš„åšå®¢æ–‡ç« ï¼Œè¯»å–åˆ°é¡µé¢ä¸­ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘ŠçŸ¥<code>blog</code>ç›®å½•ï¼Œä½œä¸ºåˆé›†é…ç½®</p>
<h4 data-id="heading-8">1. æ–°å»º content.config.ts</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineCollection, defineContentConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nuxt/content'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineContentConfig</span>({
    <span class="hljs-attr">collections</span>: {
        <span class="hljs-attr">blog</span>: <span class="hljs-title function_">defineCollection</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'page'</span>,
            <span class="hljs-attr">source</span>: <span class="hljs-string">'blog/**/*.md'</span>,

        })
    }
})
</code></pre>
<h4 data-id="heading-9">2. æµ‹è¯•ä¸€ä¸‹<code>api</code></h4>
<p>æ–°å»ºä¸€äº›æ–‡æ¡£ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p>
<pre><code class="hljs language-bash" lang="bash">content           
â””â”€ blog           
   â”œâ”€ miniapp      <span class="hljs-comment"># å°ç¨‹åºä¸“æ </span>
   â”‚  â””â”€ aaa.md   
   â””â”€ v2h         <span class="hljs-comment"># æ¯å¤©ä¸¤å°æ—¶ä¸“æ åˆé›†</span>
      â”œâ”€ day1.md  
      â””â”€ day2.md  
</code></pre>
<p>åœ¨ <code>blog/index.vue</code>ä¸­è¯»å–æ–‡ä»¶å¯¼èˆªä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">useAsyncData</span>(<span class="hljs-string">'navigation'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryCollectionNavigation</span>(<span class="hljs-string">'blog'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åšå®¢<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- &lt;div&gt;{{ allPosts }}&lt;/div&gt; --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ data }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>æŸ¥çœ‹è¾“å‡ºå†…å®¹</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Blog"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"stem"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Miniapp"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog/miniapp"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"stem"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog/miniapp"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Aaa"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog/miniapp/aaa"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"stem"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog/miniapp/aaa"</span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"page"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"V2h"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog/v2h"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"stem"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog/v2h"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Day1"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog/v2h/day1"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"stem"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog/v2h/day1"</span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Day2"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog/v2h/day2"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"stem"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog/v2h/day2"</span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"page"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
            <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"page"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<blockquote>
<p>è¿”å›äº†æ•´ä¸ªæ–‡æ¡£ç»“æ„ã€‚æœ‰äº†è¿™ä¸ªæˆ‘ä¹ˆå°±å¯ä»¥è½»æ¾çš„ç»„ç»‡å¥½å·¦ä¾§çš„ç›®å½•ç»“æ„äº†ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/456089a3676644e4ba7620777cd7ff04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=38xCgzfuN%2BEy9EdSbMXfuhIjlQU%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">useAsyncData</span>(<span class="hljs-string">'navigation'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryCollectionNavigation</span>(<span class="hljs-string">'blog'</span>)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"full-height-container grid grid-cols-5 gap-6 p-6"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- å·¦ä¾§å¯¼èˆªæ  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-span-1 bg-white rounded-xl shadow-lg overflow-hidden flex flex-col"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-4 border-b border-gray-100"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold text-gray-800"</span>&gt;</span>åšå®¢ä¸“æ <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu menu-lg rounded-box w-full h-full"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"columns in data![0]!.children"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">details</span> <span class="hljs-attr">open</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>{{ columns.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"article in columns.children"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- å³ä¾§å†…å®¹åŒº --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-span-4 bg-white rounded-xl shadow-lg flex flex-col overflow-hidden"</span>&gt;</span>{{ data }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

</code></pre>
<blockquote>
<p>å®Œå–„ä¸¤ç‚¹ï¼ŒåŸºæœ¬ä¸Šå°±æˆå‹äº†ã€‚</p>
<ol>
<li>ç‚¹å‡»ä¸€çº§èœå•çš„æ—¶å€™å³ä¾§åˆ†é¡µå±•ç¤ºä¸“æ ä¸‹æ‰€æœ‰æ–‡ç« åˆ—è¡¨</li>
<li>ç‚¹å‡»å­é›†èœå•ï¼Œç›´æ¥è¿›å…¥æ–‡ç« è¯¦æƒ…</li>
</ol>
</blockquote>
<h2 data-id="heading-10">å››ã€æœ€ç»ˆæˆæœå±•ç¤º</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df86e40dd69f4632aa6fba29585aa97d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=hlKOs9cGdzZA2mWGMfDpYXHJyow%3D" alt="PixPin_2025-11-18_11-05-26.gif" loading="lazy"/>
ç¤ºä¾‹ä»£ç ï¼š</p>
<p><code>blog/index.vue</code></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">ContentNavigationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nuxt/content'</span>

<span class="hljs-keyword">const</span> currentPage = ref&lt;<span class="hljs-title class_">ContentNavigationItem</span>[]&gt;([])
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
<span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">useAsyncData</span>(<span class="hljs-string">'navigation'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryCollectionNavigation</span>(<span class="hljs-string">'blog'</span>, [<span class="hljs-string">'description'</span>])
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleColumnsClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">title: string</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!data.<span class="hljs-property">value</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">children</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'No navigation data found'</span>)
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-comment">// è¿‡æ»¤åŒ¹é…çš„é¡¹</span>
  <span class="hljs-keyword">const</span> filteredItems = data.<span class="hljs-property">value</span>[<span class="hljs-number">0</span>].<span class="hljs-property">children</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">title</span> === title)
  <span class="hljs-keyword">if</span> (!filteredItems?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">children</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'No Content data found'</span>)
    <span class="hljs-keyword">return</span>
  }
  currentPage.<span class="hljs-property">value</span> = filteredItems[<span class="hljs-number">0</span>]?.<span class="hljs-property">children</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleArticleClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">path: string</span>) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">navigateTo</span>(path)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"full-height-container grid grid-cols-5 p-6"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- å·¦ä¾§å¯¼èˆªæ  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-span-1 bg-white rounded-xl shadow-lg overflow-hidden flex flex-col"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-4 border-b border-gray-100"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg font-semibold text-gray-800"</span>&gt;</span>åšå®¢ä¸“æ <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu menu-lg rounded-box w-full h-full"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"columns in data![0]!.children"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">details</span> <span class="hljs-attr">open</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">summary</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleColumnsClick(columns.title)"</span>&gt;</span>{{ columns.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"before:w-px"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"article in columns.children"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleArticleClick(article.path)"</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- å³ä¾§å†…å®¹åŒº --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-span-4 flex flex-col gap-4 px-20"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in currentPage"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.path"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">NuxtLink</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"item.path"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card card-side bg-base-100 shadow-sm px-2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-40 h-20"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/images/image-20251031133400797.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">" "</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>{{ item.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ item.description }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">NuxtLink</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

</code></pre>
<p><code>blog/[...slug].vue</code></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
const route = useRoute()
const { data: post } = await useAsyncData(route.path, () =&gt; {
  return queryCollection('blog').path(route.path).first()
})
&lt;/script&gt;
&lt;template&gt;
  &lt;div class="h-screen"&gt;&lt;ContentRenderer v-if="post" :value="post" /&gt;&lt;/div&gt;
&lt;/template&gt;
&lt;style scoped lang="scss"&gt;&lt;/style&gt;

</code></pre>
<h2 data-id="heading-11">äº”ã€æ€»ç»“</h2>
<p>åˆ°è¿™é‡ŒåŸºæœ¬ç»“æ„ç®—æ˜¯å®šä¸‹æ¥äº†ï¼Œåç»­å°±æ˜¯å†…å®¹çš„å¡«å……ï¼Œä»¥åŠè§‚æ„Ÿä¸Šçš„ä¼˜åŒ–äº†ã€‚</p>
<p>å½“ç„¶è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡ï¼Œæœ€ç»ˆä¼šé›†æˆåå°ç®¡ç†ç³»ç»Ÿï¼Œå®Œæˆä¸€å¥—çœŸæ­£çš„ <code>CMS</code> å‘å¸ƒç³»ç»Ÿã€‚æ‰€ä»¥å¦‚æœä½ è§‰å¾—éº»çƒ¦ï¼Œæˆ–è€…å¯¹äº <code>NuxtContent</code>å¹¶ä¸æ„Ÿå…´è¶£ï¼Œå®Œå…¨å¯ä»¥å¿½ç•¥è¿™ä¸€èŠ‚å†…å®¹ã€‚</p>
<blockquote>
<p>åœ¨è¿›è¡Œæ ·å¼è°ƒæ•´çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ª<code>bug</code>ï¼Œ<strong>inspira-ui</strong> å’Œ <strong>daisyui</strong> çš„æ ·å¼è¡¨å˜é‡å­˜åœ¨å‘½åå†²çªã€‚</p>
<p>æ¯”å¦‚ï¼š<strong>inspira-ui</strong> å®šä¹‰ <code> --border: oklch(0.922 0 0);</code> æ˜¯é¢œè‰²å±æ€§ï¼Œè€Œ <strong>daisyui</strong> å®šä¹‰çš„æ˜¯å®½åº¦å±æ€§ <code>--border: 1px;</code></p>
<p>å¯¼è‡´å±æ€§å€¼è¦†ç›–ï¼Œè¿™è‚¯å®šä¸æ˜¯ä¸ªä¾‹ï¼Œæš‚æ—¶è®°å½•ä¸€ä¸‹ï¼Œåç»­å†è€ƒè™‘æ€ä¹ˆè§£å†³ã€‚</p>
<p>ç›®å‰ä¼šå¯¼è‡´  <strong>daisyui</strong> çš„èœå•å·¦è¾¹æ²¡æœ‰ç«–çº¿</p>
<p>æˆ‘ç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯ç›´æ¥åœ¨æ ‡ç­¾è¦†ç›–å›å»</p>
<p><code>&lt;ul class="before:w-px"&gt;</code></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e87041c758194a9a9bb8256570492027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041451&amp;x-signature=qDeiaaxUlGaEn7fJRMV3T2m6KsE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚ä½ çš„â€œä¸ªäººå…¬å¸â€ä»è¿™ç¬¬ä¸€ä¸ª2å°æ—¶å¼€å§‹ã€‚æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„è¿›å±•æˆ–é‡åˆ°çš„å¡ç‚¹ï¼Œæˆ‘ä¼šé€ä¸€æŸ¥çœ‹ï¼Œå°½å¯èƒ½çš„å¸®åŠ©è§£å†³ã€‚æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« è§ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[npm scriptsçš„é«˜çº§ç©æ³•ï¼špreã€postå’Œ--ï¼Œä½ çœŸçš„ä¼šç”¨å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7573588675638001679</link>    <guid>https://juejin.cn/post/7573588675638001679</guid>    <pubDate>2025-11-18T03:39:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675638001679" data-draft-id="7573594825317564456" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="npm scriptsçš„é«˜çº§ç©æ³•ï¼špreã€postå’Œ--ï¼Œä½ çœŸçš„ä¼šç”¨å—ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-18T03:39:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            npm scriptsçš„é«˜çº§ç©æ³•ï¼špreã€postå’Œ--ï¼Œä½ çœŸçš„ä¼šç”¨å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:39:10.000Z" title="Tue Nov 18 2025 03:39:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd5287e77baa47f09b6692fb606e6ad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041950&amp;x-signature=ZEJuyns%2FrIW3fBoL96YETZLl7Hw%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬æ¯å¤©çš„å¼€å‘ï¼Œå¯èƒ½éƒ½æ˜¯ä»ä¸€ä¸ª<code>npm run dev</code>å¼€å§‹çš„ã€‚<code>npm scripts</code>å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œå¤©å¤©ç”¨å®ƒï¼Œä½†å¾ˆå°‘å»æ€è€ƒå®ƒã€‚</p>
<p>ä¸ä¿¡ï¼Œä½ çœ‹çœ‹ä½ é¡¹ç›®é‡Œçš„<code>package.json</code>ï¼Œæ˜¯ä¸æ˜¯é•¿è¿™æ ·ğŸ‘‡ï¼š</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rm -rf dist &amp;&amp; tsc &amp;&amp; vite build"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// å˜¿ï¼Œçœ¼ç†Ÿå—ï¼Ÿ</span>
  <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint ."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lint:fix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint . --fix"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"test:watch"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest --watch"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™èƒ½ç”¨å—ï¼Ÿå½“ç„¶èƒ½ç”¨ã€‚</p>
<p>ä½†è¿™ä¸“ä¸šå—ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œæœªå¿…ï¼</p>
<p>ä¸€ä¸ªå¥½çš„<code>scripts</code>ï¼Œåº”è¯¥æ˜¯<strong>åŸå­åŒ–çš„ã€è·¨å¹³å°çš„</strong>ã€‚è€Œä¸Šé¢è¿™ä¸ªï¼Œä¸€ä¸ª<code>build</code>å‘½ä»¤å°±ä¸è¡Œï¼Œè€Œä¸”<code>rm -rf</code>åœ¨Windowsä¸Šè¿˜å¾—è£…ç‰¹å®šç¯å¢ƒæ‰èƒ½è·‘ğŸ¤·â€â™‚ï¸ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±æ¥èŠèŠï¼Œå¦‚ä½•ç”¨<code>pre</code>ã€<code>post</code>å’Œ<code>--</code>ï¼ŒæŠŠä½ çš„è„šæœ¬ï¼Œå‡çº§æˆä¸“ä¸šçš„è„šæœ¬ã€‚</p>
<hr/>
<h4 data-id="heading-0"><strong><code>pre</code> å’Œ <code>post</code>ï¼šå‘½ä»¤çš„ç”Ÿå‘½å‘¨æœŸé’©å­</strong></h4>
<p><code>pre</code>å’Œ<code>post</code>ï¼Œæ˜¯<code>npm</code>å†…ç½®çš„ä¸€ç§<strong>é’©å­</strong>æœºåˆ¶ã€‚</p>
<p>å®ƒçš„è§„åˆ™å¾ˆç®€å•ï¼š</p>
<ul>
<li>å½“ä½ æ‰§è¡Œ<code>npm run xyz</code>æ—¶ï¼Œ<code>npm</code>ä¼š<strong>è‡ªåŠ¨</strong>å…ˆå»æ‰¾ï¼Œæœ‰æ²¡æœ‰ä¸€ä¸ªå«<code>prexyz</code>çš„è„šæœ¬ï¼Œæœ‰å°±å…ˆæ‰§è¡Œå®ƒã€‚</li>
<li>å½“<code>xyz</code>æ‰§è¡ŒæˆåŠŸåï¼Œ<code>npm</code>ä¼š<strong>è‡ªåŠ¨</strong>å†å»æ‰¾ï¼Œæœ‰æ²¡æœ‰ä¸€ä¸ªå«<code>postxyz</code>çš„è„šæœ¬ï¼Œæœ‰å°±æœ€åå†æ‰§è¡Œå®ƒã€‚</li>
</ul>
<p>è¿™ä¸ªè‡ªåŠ¨çš„ç‰¹æ€§ï¼Œå°±æ˜¯ç¥ä¸€èˆ¬çš„å­˜åœ¨ã€‚</p>
<p><strong>æˆ‘ä»¬æ¥æ”¹é€ é‚£ä¸ªå‰é¢ğŸ‘†æåˆ°çš„<code>build</code>è„šæœ¬ã€‚</strong></p>
<p><strong>ä¸šä½™å†™æ³•</strong> (ç”¨<code>&amp;&amp;</code>æ‰‹åŠ¨ç¼–æ’)</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"clean"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rimraf dist"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// rimraf è§£å†³è·¨å¹³å°åˆ é™¤é—®é¢˜</span>
  <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint ."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build:tsc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build:vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run clean &amp;&amp; npm run lint &amp;&amp; npm run build:tsc &amp;&amp; npm run build:vite"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä½ çš„<code>build</code>è„šæœ¬ï¼Œå®ƒå¿…é¡»è®°ä½æ‰€æœ‰çš„å‰ç½®æ­¥éª¤ã€‚å¦‚æœå“ªå¤©ä½ æƒ³åœ¨<code>build</code>å‰ï¼Œå†åŠ ä¸€ä¸ª<code>test</code>ï¼Œä½ è¿˜å¾—å»ä¿®æ”¹<code>build</code>çš„å®šä¹‰ã€‚è¿™è¿åäº†<strong>å•ä¸€èŒè´£</strong>ã€‚</p>
<p><strong>ä¸“ä¸šå†™æ³•</strong> (ç”¨<code>pre</code>è‡ªåŠ¨è§¦å‘)</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"clean"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rimraf dist"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint ."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest run"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build:tsc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build:vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>

  <span class="hljs-comment">// buildçš„å‰ç½®é’©å­</span>
  <span class="hljs-attr">"prebuild"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run clean &amp;&amp; npm run lint &amp;&amp; npm run test"</span><span class="hljs-punctuation">,</span> 
  
  <span class="hljs-comment">// buildçš„æ ¸å¿ƒå‘½ä»¤</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run build:tsc &amp;&amp; npm run build:vite"</span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// buildçš„åç½®é’©å­</span>
  <span class="hljs-attr">"postbuild"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"echo 'Build complete! Check /dist folder.'"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿ</p>
<p>ç°åœ¨ï¼Œå½“æˆ‘åªæƒ³æ„å»ºæ—¶ï¼Œæˆ‘ä¾ç„¶æ‰§è¡Œnpm run buildã€‚</p>
<p>npmä¼šè‡ªåŠ¨å¸®æˆ‘æ‰§è¡Œprebuildï¼ˆæ¸…ç†ã€Lintã€æµ‹è¯•ï¼‰ğŸ‘‰ ç„¶åæ‰§è¡Œbuildï¼ˆç¼–è¯‘ã€æ‰“åŒ…ï¼‰ğŸ‘‰ æœ€åæ‰§è¡Œpostbuildï¼ˆæ‰“å°æ—¥å¿—ï¼‰ã€‚</p>
<p>æˆ‘çš„<code>build</code>è„šæœ¬ï¼Œ<strong>åªå…³å¿ƒæ„å»ºè¿™ä»¶äº‹</strong>ã€‚è€Œ<code>prebuild</code>è„šæœ¬ï¼Œ<strong>åªå…³å¿ƒå‰ç½®æ£€æŸ¥è¿™ä»¶äº‹</strong>ã€‚</p>
<p><strong>è¿™å°±æ˜¯å•ä¸€èŒè´£å’Œå…³æ³¨ç‚¹åˆ†ç¦»ã€‚</strong></p>
<p>ä½ ç”šè‡³å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæç‚¹éªšæ“ä½œğŸ˜ï¼š</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-comment">// å½“ä½ æ‰§è¡Œnpm startæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å…ˆæ‰§è¡Œnpm run build</span>
  <span class="hljs-attr">"prestart"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run build"</span><span class="hljs-punctuation">,</span> 
  <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node dist/server.js"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-1"><strong><code>--</code> (åŒçŸ­çº¿)ï¼šè„šæœ¬å‚æ•°</strong></h4>
<p><code>--</code>æ˜¯æˆ‘æœ€çˆ±çš„ä¸€ä¸ªç‰¹æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>å‚æ•°åˆ†éš”ç¬¦</strong>ã€‚</p>
<p>å®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>å‘Šè¯‰<code>npm</code>ï¼Œæˆ‘çš„<code>npm</code>å‚æ•°åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œåé¢æ‰€æœ‰çš„ä¸œè¥¿ï¼Œéƒ½åŸå°ä¸åŠ¨åœ°ï¼Œä¼ ç»™æˆ‘è¦æ‰§è¡Œçš„é‚£ä¸ªåº•å±‚å‘½ä»¤ã€‚â€</strong></p>
<p>æˆ‘ä»¬æ¥çœ‹å¼€å¤´ğŸ‘†é‚£ä¸ªè„šæœ¬ï¼š</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"test:watch"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest --watch"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¸ºäº†ä¸€ä¸ª<code>--watch</code>å‚æ•°ï¼Œä½ å¤åˆ¶äº†ä¸€ä¸ªå‡ ä¹ä¸€æ¨¡ä¸€æ ·çš„è„šæœ¬ã€‚å¦‚æœæ˜å¤©ä½ è¿˜æƒ³è¦<code>--coverage</code>å‘¢ï¼Ÿå†åŠ ä¸€ä¸ª<code>test:coverage</code>ï¼Ÿè¿™å«<strong>åƒåœ¾ä»£ç ğŸ’©</strong>ã€‚</p>
<p><strong>ä¸“ä¸šå†™æ³•</strong> (ç”¨<code>--</code>åŠ¨æ€ä¼ å‚)</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å°±è¿™ä¸€è¡Œï¼Œå¤Ÿäº†ã€‚</p>
<p>ç­‰ç­‰ï¼Œé‚£æˆ‘æ€ä¹ˆè·‘watchå’Œcoverageï¼Ÿ</p>
<p>ç­”æ¡ˆï¼Œå°±æ˜¯ç”¨--ğŸ¤·â€â™‚ï¸ï¼š</p>
<pre><code class="hljs language-Bash" lang="Bash"><span class="hljs-comment"># 1. åªè·‘ä¸€æ¬¡</span>
$ npm run <span class="hljs-built_in">test</span> -- --run
<span class="hljs-comment"># å®é™…æ‰§è¡Œ: vitest --run</span>

<span class="hljs-comment"># 2. è·‘watchæ¨¡å¼</span>
$ npm run <span class="hljs-built_in">test</span> -- --watch
<span class="hljs-comment"># å®é™…æ‰§è¡Œ: vitest --watch</span>

<span class="hljs-comment"># 3. è·‘è¦†ç›–ç‡</span>
$ npm run <span class="hljs-built_in">test</span> -- --coverage
<span class="hljs-comment"># å®é™…æ‰§è¡Œ: vitest --coverage</span>

<span class="hljs-comment"># 4. è·‘æŸä¸ªç‰¹å®šæ–‡ä»¶</span>
$ npm run <span class="hljs-built_in">test</span> -- src/my-component.test.ts
<span class="hljs-comment"># å®é™…æ‰§è¡Œ: vitest src/my-component.test.ts</span>
</code></pre>
<p><strong><code>--</code>å°±åƒä¸€ä¸ªå‚æ•°éš§é“</strong> ï¼Œå®ƒæŠŠä½ åœ¨å‘½ä»¤è¡Œé‡Œï¼Œè·Ÿåœ¨<code>--</code>åé¢çš„æ‰€æœ‰å‚æ•°ï¼ŒåŸå°ä¸åŠ¨åœ°æ‰”ç»™äº†<code>vitest</code>å‘½ä»¤ã€‚</p>
<hr/>
<h4 data-id="heading-2"><strong>ä¸€ä¸ªä¸“ä¸šçš„CI/CDè„šæœ¬</strong></h4>
<p>å¥½äº†ï¼Œæˆ‘ä»¬æŠŠ<code>pre</code>/<code>post</code>å’Œ<code>--</code>ç»“åˆèµ·æ¥ï¼Œçœ‹çœ‹ä¸€ä¸ªä¸“ä¸šçš„<code>package.json</code>æ˜¯é•¿ä»€ä¹ˆæ ·å­ğŸ‘‡ã€‚</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-comment">// 1. Lint</span>
  <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint ."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lint:fix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint . --fix"</span><span class="hljs-punctuation">,</span>

  <span class="hljs-comment">// 2. Test</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pretest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run lint"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// åœ¨testå‰ï¼Œå¿…é¡»å…ˆlint</span>

  <span class="hljs-comment">// 3. Build</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc &amp;&amp; vite build"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prebuild"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run test -- --run"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// åœ¨buildå‰ï¼Œå¿…é¡»å…ˆtesté€šè¿‡</span>
  
  <span class="hljs-comment">// 4. Publish (å‘å¸ƒçš„å‰ç½®é’©å­)</span>
  <span class="hljs-comment">// prepublishOnly æ˜¯ä¸€ä¸ªnpmå†…ç½®çš„ã€æ¯”prepublishæ›´å®‰å…¨çš„é’©å­</span>
  <span class="hljs-comment">// å®ƒåªåœ¨ npm publish æ—¶æ‰§è¡Œï¼Œè€Œåœ¨ npm install æ—¶ä¸æ‰§è¡Œ</span>
  <span class="hljs-attr">"prepublishOnly"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run build"</span> <span class="hljs-comment">// åœ¨å‘å¸ƒå‰ï¼Œå¿…é¡»å…ˆbuild</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>çœ‹çœ‹æˆ‘ä»¬æ„å»ºäº†æ€æ ·ä¸€æ¡è‡ªåŠ¨åŒ–è„šæœ¬ï¼š</strong></p>
<ol>
<li>ä½ å…´é«˜é‡‡çƒˆåœ°æ•²ä¸‹<code>npm publish</code>ï¼Œå‡†å¤‡å‘å¸ƒã€‚</li>
<li><code>npm</code>ä¸€çœ‹ï¼Œæœ‰ä¸ª<code>prepublishOnly</code>ï¼Œäºæ˜¯å®ƒå…ˆå»æ‰§è¡Œ<code>npm run build</code>ã€‚</li>
<li><code>npm</code>ä¸€çœ‹ï¼Œ<code>build</code>æœ‰ä¸ª<code>prebuild</code>ï¼Œäºæ˜¯å®ƒåˆå…ˆå»æ‰§è¡Œ<code>npm run test -- --run</code>ã€‚</li>
<li><code>npm</code>ä¸€çœ‹ï¼Œ<code>test</code>æœ‰ä¸ª<code>pretest</code>ï¼Œäºæ˜¯å®ƒåˆåŒå’å•å…ˆå»æ‰§è¡Œ<code>npm run lint</code>ã€‚</li>
</ol>
<p><strong>æœ€ç»ˆçš„æ‰§è¡Œæµæ˜¯ï¼š<code>Lint</code> -&gt; <code>Test</code> -&gt; <code>Build</code> -&gt; <code>Publish</code>ã€‚</strong></p>
<p>è¿™äº›è„šæœ¬ï¼Œè¢«<code>pre</code>é’©å­ï¼Œè‡ªåŠ¨åœ°ã€å¼ºåˆ¶åœ°ä¸²è”äº†èµ·æ¥ã€‚ä½ ä½œä¸ºå¼€å‘è€…ï¼Œ<strong>æ ¹æœ¬æ²¡æœ‰æœºä¼š</strong>çŠ¯é”™ã€‚ä½ ä¸å¯èƒ½å‘å¸ƒä¸€ä¸ªè¿Lintéƒ½æ²¡è¿‡æˆ–è€…æµ‹è¯•æœªé€šè¿‡çš„åŒ…ğŸ˜ã€‚</p>
<hr/>
<p><code>npm scripts</code>ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬å¿«æ·æ–¹å¼ã€‚<strong>å®ƒæ˜¯ä¸€ä¸ªå·¥ä½œæµï¼ˆWorkflowï¼‰çš„å®šä¹‰</strong> ã€‚</p>
<p><code>pre</code>å’Œ<code>post</code>ï¼Œå®šä¹‰äº†ä½ å·¥ä½œæµçš„<strong>æ‰§è¡Œé¡ºåº</strong>å’Œ<strong>ä¾èµ–</strong>ï¼Œä¿è¯äº†<strong>ä»£ç æ£€æŸ¥</strong>ç­‰åŠŸèƒ½ï¼Œè€Œ<code>--</code>æ˜¯ç¡®ä¿ä½ å·¥ä½œæµä¸­çš„<strong>è„šæœ¬å‚æ•°</strong>ã€‚</p>
<p>ç°åœ¨ï¼Œé©¬ä¸Šå»æ‰“å¼€ä½ é¡¹ç›®çš„<code>package.json</code>ï¼Œçœ‹çœ‹å®ƒï¼Œæ˜¯ä¸“ä¸šçš„ï¼Œè¿˜æ˜¯ä¸šä½™çš„å‘¢ï¼ŸğŸ¤£</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸­ç§‘é™¢å·¥ç¨‹å¸ˆåˆ†äº«ï¼šç”¨Unslothæ‰“é€ æ¨ç†å¢å¼ºå¤§æ¨¡å‹ï½œä½æ˜¾å­˜ã€é«˜æ¨ç†ã€å¯å¤ç”¨]]></title>    <link>https://juejin.cn/post/7573776814946975763</link>    <guid>https://juejin.cn/post/7573776814946975763</guid>    <pubDate>2025-11-18T03:43:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573776814946975763" data-draft-id="7573776814946942995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸­ç§‘é™¢å·¥ç¨‹å¸ˆåˆ†äº«ï¼šç”¨Unslothæ‰“é€ æ¨ç†å¢å¼ºå¤§æ¨¡å‹ï½œä½æ˜¾å­˜ã€é«˜æ¨ç†ã€å¯å¤ç”¨"/> <meta itemprop="keywords" content="Agent,ç¨‹åºå‘˜,LLM"/> <meta itemprop="datePublished" content="2025-11-18T03:43:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸­ç§‘é™¢å·¥ç¨‹å¸ˆåˆ†äº«ï¼šç”¨Unslothæ‰“é€ æ¨ç†å¢å¼ºå¤§æ¨¡å‹ï½œä½æ˜¾å­˜ã€é«˜æ¨ç†ã€å¯å¤ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:43:17.000Z" title="Tue Nov 18 2025 03:43:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>åœ¨å¤§æ¨¡å‹åº”ç”¨çš„æµªæ½®é‡Œï¼Œ<strong>æ¨ç†èƒ½åŠ›</strong>å’Œ<strong>é«˜æ•ˆå¾®è°ƒ</strong>æ­£æˆä¸ºæ ¸å¿ƒç«äº‰åŠ›ã€‚å°¤å…¶æ˜¯åœ¨æ•°å­¦æ¨ç†ã€é€»è¾‘é—®ç­”ã€ç»“æ„åŒ–è¾“å‡ºç­‰ä»»åŠ¡ä¸­ï¼Œå¦‚ä½•å¿«é€Ÿè®­ç»ƒå‡ºä¸€ä¸ª<strong>æ¨ç†ç¨³å®šã€æ¨ç†é“¾æ¡æ¸…æ™°</strong>çš„æ¨¡å‹ï¼Œæ˜¯å¾ˆå¤šå¼€å‘è€…çš„ç—›ç‚¹ã€‚</p>
<p>ä»Šå¤©ç»™å¤§å®¶æ¨èçš„è¿™ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨Unslothè®­ç»ƒè‡ªå·±çš„R1æ¨¡å‹ï¼Œå°±æ˜¯ä¸€ä¸ª<strong>ç«¯åˆ°ç«¯çš„</strong> <strong>å¼ºåŒ–å­¦ä¹ </strong> <strong>æ¨ç†æ¨¡å‹è®­ç»ƒå®è·µ</strong>ï¼Œä¸ä»…è·‘å¾—é€šï¼Œè¿˜è·‘å¾—å¿«ã€‚</p>
<p>åˆ›ä½œè€…ä¸»é¡µï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.heywhale.com%2Fu%2F6a143e" target="_blank" title="https://www.heywhale.com/u/6a143e" ref="nofollow noopener noreferrer">www.heywhale.com/u/6a143e</a></p>
<p>é¡¹ç›®æŒ‡è·¯ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.heywhale.com%2Fu%2Fe29054" target="_blank" title="https://www.heywhale.com/u/e29054" ref="nofollow noopener noreferrer">www.heywhale.com/u/e29054</a></p>
<h2 data-id="heading-0">é¡¹ç›®ç®€ä»‹åŠäº®ç‚¹è§£è¯´</h2>
<p>è¿™ä¸ªé¡¹ç›®æ—¨åœ¨æ¼”ç¤ºå¦‚ä½•åˆ©ç”¨<strong>Unsloth</strong>æ¡†æ¶åœ¨ä½æ˜¾å­˜æ¡ä»¶ä¸‹é«˜æ•ˆè®­ç»ƒ<strong>æ¨ç†å¢å¼ºå¤§æ¨¡å‹</strong>ã€‚é¡¹ç›®åŸºäº<strong>DeepSeek-R1</strong>åŒç±»æ¶æ„ï¼Œç»“åˆ<strong>LoRAå¾®è°ƒ</strong>ã€<strong>4bité‡åŒ–</strong>ä¸<strong>GRPO</strong>* <em>å¼ºåŒ–å­¦ä¹ </em>*ï¼Œå®ç°ä»æ•°æ®åŠ è½½ã€æ¨¡å‹è®­ç»ƒåˆ°æ¨ç†éƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7326bca8e7a445a4a1d394ba957242ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042197&amp;x-signature=b6IHYwBGwmntWaeNhW0EiK7DnI8%3D" alt="" loading="lazy"/></p>
<p>DeepSeek R1ç³»åˆ—è®­ç»ƒæµç¨‹å›¾ï¼Œæºè‡ªï¼šElwin Wong</p>
<p>è®­ç»ƒæ•°æ®ä»¥GSM8Kæ•°å­¦æ¨ç†é›†ä¸ºä¾‹ï¼Œå¹¶è®¾è®¡å¤šç»´åº¦å¥–åŠ±å‡½æ•°ï¼Œæ—¢è¯„ä¼°ç­”æ¡ˆæ­£ç¡®æ€§ï¼Œä¹Ÿè¡¡é‡æ¨ç†é“¾å®Œæ•´åº¦ä¸æ ¼å¼è§„èŒƒæ€§ã€‚è¯¥æ–¹æ¡ˆä¸ä»…æ˜¾è‘—é™ä½äº†ç¡¬ä»¶é—¨æ§›ï¼ˆå•å¡8GBå¯è¿è¡Œï¼‰ï¼Œè¿˜å…·å¤‡å¯å¤ç”¨æ€§ä¸å¯æ‰©å±•æ€§ï¼Œé€‚åˆåœ¨ç§‘ç ”ã€æ•°å­¦é—®ç­”ã€é€»è¾‘æ¨ç†ç­‰ä»»åŠ¡ä¸­å¿«é€Ÿæ„å»ºå®šåˆ¶åŒ–å¤§æ¨¡å‹ã€‚</p>
<h4 data-id="heading-1">ğŸŒŸåŠ é€Ÿåˆ©å™¨ï¼šUnsloth+vLLM</h4>
<p>ä¼ ç»ŸRLHFæˆ–GRPOè®­ç»ƒå¸¸å¸¸é‡åˆ°ä¸¤å¤§é—®é¢˜ï¼šæ˜¾å­˜ä¸å¤Ÿå’Œæ¨ç†å¤ªæ…¢ã€‚</p>
<p>è¿™ä¸ªé¡¹ç›®ç›´æ¥ç”¨ä¸Šäº†<strong>Unsloth</strong>çš„<strong>FastLanguageModel</strong>+<strong>vLLMå¿«é€Ÿæ¨ç†</strong>ï¼Œå†é…åˆ<strong>4bité‡åŒ–</strong>ä¸LoRAä½ç§©é€‚åº”ï¼Œå¤§å¹…é™ä½æ˜¾å­˜å ç”¨ã€‚å³ä¾¿æ˜¯å•å¡8GBæ˜¾å­˜ï¼Œä¹Ÿèƒ½è·‘å¾—åŠ¨ã€‚<strong>äº®ç‚¹åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><code>gpu_memory_utilization</code>Â æ§åˆ¶æ˜¾å­˜å ç”¨</li>
<li><code>load_in_4bit=True</code>Â æ˜¾è‘—å‹ç¼©æ¨¡å‹</li>
<li><code>fast_inference=True</code>Â åŠ é€Ÿç”Ÿæˆ</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c64d622f66fb407e8dc725ce69dafed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042197&amp;x-signature=oFjBKDLveQuioOTky3U%2BLxZOreA%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2"/>
<h4 data-id="heading-3">ğŸŒŸæ•°æ®é©±åŠ¨ï¼šGSM8Kæ¨ç†ä»»åŠ¡</h4>
<p>é¡¹ç›®é€‰æ‹©äº†ç»å…¸çš„æ•°å­¦æ¨ç†æ•°æ®é›†GSM8Kï¼Œå¹¶ç”¨XMLæ ¼å¼æ¥çº¦æŸæ¨¡å‹çš„æ¨ç†è¿‡ç¨‹ä¸ç­”æ¡ˆè¾“å‡ºï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">reasoning</span>&gt;</span>
æ¨ç†æ­¥éª¤â€¦â€¦
<span class="hljs-tag">&lt;/<span class="hljs-name">reasoning</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">answer</span>&gt;</span>
æœ€ç»ˆç­”æ¡ˆ
<span class="hljs-tag">&lt;/<span class="hljs-name">answer</span>&gt;</span>
</code></pre>
<p>è¿™æ ·çš„è®¾è®¡æœ‰ä¸¤å¤§å¥½å¤„ï¼š</p>
<ol>
<li><strong>å¯è§£ææ€§å¼º</strong>ï¼šæ–¹ä¾¿åç»­è‡ªåŠ¨è¯„ä¼°æˆ–ä¸‹æ¸¸ä»»åŠ¡è°ƒç”¨</li>
<li><strong>å¥–åŠ±å‡½æ•°å¯ç²¾ç»†åŒ–æ§åˆ¶</strong>ï¼šæ¯”å¦‚æ£€æŸ¥Â <code>&lt;reasoning&gt;</code>Â æ˜¯å¦é—­åˆã€<code>&lt;answer&gt;</code>Â æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦ä¸ºæ•°å­—ç­‰</li>
</ol>
<h4 data-id="heading-4"/>
<h4 data-id="heading-5">ğŸŒŸå¥–åŠ±å‡½æ•°ï¼šä»å¯¹ä¸å¯¹åˆ°å¥½ä¸å¥½</h4>
<p>å¼ºåŒ–å­¦ä¹ çš„å…³é”®æ˜¯<strong>å¥–åŠ±è®¾è®¡</strong>ã€‚é¡¹ç›®ä¸­å®šä¹‰äº†å¤šä¸ªå¥–åŠ±å‡½æ•°ï¼š</p>
<ul>
<li><strong>æ­£ç¡®æ€§å¥–åŠ±</strong>ï¼šç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆåŒ¹é…â†’+2.0</li>
<li><strong>æ ¼å¼å¥–åŠ±</strong>ï¼šä¸¥æ ¼æˆ–å®½æ¾çš„XMLæ ‡ç­¾æ£€æŸ¥â†’+0.5</li>
<li><strong>æ•°å­—åˆ¤æ–­å¥–åŠ±</strong>ï¼šç­”æ¡ˆæ˜¯æ•°å­—â†’+0.5</li>
<li><strong>ç»“æ„å®Œæ•´æ€§å¥–åŠ±</strong>ï¼šæ ‡ç­¾æ•°é‡ä¸æ ¼å¼æ­£ç¡®æ€§è®¡åˆ†</li>
</ul>
<p>è¿™ç§å¤šç»´åº¦å¥–åŠ±æ–¹å¼ï¼Œè®©æ¨¡å‹ä¸ä»…è¦ç­”å¯¹ï¼Œè¿˜è¦<strong>ç­”å¾—è§„æ•´</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/534846e04c274c32b0d17ce09aea0f65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042197&amp;x-signature=06%2Bip1PCFcsP9VROK6%2FqbnqEc28%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6"/>
<h4 data-id="heading-7">ğŸŒŸè®­ç»ƒæ ¸å¿ƒï¼šGRPOä¼˜åŒ–</h4>
<p>è®­ç»ƒéƒ¨åˆ†ä½¿ç”¨<code>GRPOTrainer</code>ï¼Œç»“åˆå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<ul>
<li><strong>å­¦ä¹ ç‡</strong>* <em>è°ƒåº¦</em>*ï¼šä½™å¼¦è¡°å‡+é¢„çƒ­</li>
<li><strong>æ¢¯åº¦æ£€æŸ¥ç‚¹</strong>ï¼šèŠ‚çœæ˜¾å­˜</li>
<li><strong>8bit AdamW</strong>ï¼šåŠ é€Ÿä¼˜åŒ–</li>
<li><strong>å¤šæ ·æœ¬ç”Ÿæˆ</strong>ï¼šæ¯æ¬¡ç”Ÿæˆ8ä¸ªå€™é€‰ï¼Œå¢åŠ æ¢ç´¢æ€§</li>
</ul>
<p>è®­ç»ƒæ—¥å¿—ä¹Ÿç»™å‡ºäº†å‚è€ƒï¼Œå‰100æ­¥å¯èƒ½å¥–åŠ±ä¸º0ï¼Œ150æ­¥åé€æ¸æå‡ï¼Œè¿™å¯¹åˆå­¦è€…å¾ˆé‡è¦â€”â€”ã€Œåˆ«æ€¥ï¼Œç­‰æ¨¡å‹â€œå­¦ä¼šè¯´è¯â€ã€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830fe4475b5749adaea5c90256a26247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042197&amp;x-signature=hYCARdO7%2Fdh%2FbTduSR%2FgM4LWgRY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8"/>
<h4 data-id="heading-9">ğŸŒŸæ¨ç†ä¸LoRAåŠ è½½</h4>
<p>è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹çš„LoRAæƒé‡ä¼šè¢«ä¿å­˜ï¼Œå¯éšæ—¶æŒ‚è½½åˆ°åŸæ¨¡å‹è¿›è¡Œæ¨ç†ã€‚ æ¨ç†ç¤ºä¾‹é‡Œç”¨<strong>ä½æ¸©é‡‡æ ·</strong>ï¼ˆ<code>temperature=0.1</code>ï¼‰ä¿è¯ç¨³å®šæ€§ï¼Œéå¸¸é€‚åˆæ•°å­¦æ¨ç†ã€æ³•å¾‹é€»è¾‘ç­‰ç²¾ç¡®ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-10"/>
<hr/>
<h3 data-id="heading-11"/>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªé¡¹ç›®çš„æœ€å¤§ä»·å€¼æ˜¯<strong>å¯ç›´æ¥å¤ç”¨çš„</strong>* <em>å¼ºåŒ–å­¦ä¹ </em>*<strong>æ¨ç†è®­ç»ƒæ¨¡æ¿</strong>ï¼š</p>
<ul>
<li>å·¥ç¨‹åŒ–ç»†èŠ‚åˆ°ä½</li>
<li>æ¨¡å—åŒ–è®¾è®¡æ–¹ä¾¿æ›¿æ¢</li>
<li>å¯æ‰©å±•åˆ°è‡ªå·±çš„æ•°æ®å’Œä»»åŠ¡</li>
</ul>
<p>æ— è®ºä½ åšçš„æ˜¯<strong>æ•°å­¦æ¨ç†ã€ä»£ç ç”Ÿæˆè¿˜æ˜¯ç»“æ„åŒ–é—®ç­”</strong>ï¼Œéƒ½èƒ½åœ¨è¿™ä¸ªé¡¹ç›®çš„åŸºç¡€ä¸Šå¿«é€Ÿæ”¹é€ æˆå±äºä½ çš„R1æ¨¡å‹ã€‚</p>
<h2 data-id="heading-12">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ˜±ä¸€è¡Œä»£ç å¼•å‘çš„è¡€æ¡ˆï¼šå±•å¼€è¿ç®—ç¬¦ï¼ˆ...ï¼‰ç«Ÿè®©å›¾è¡¨åŠŸèƒ½ç›´æ¥å´©äº†ï¼]]></title>    <link>https://juejin.cn/post/7573589277004726310</link>    <guid>https://juejin.cn/post/7573589277004726310</guid>    <pubDate>2025-11-18T03:27:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573589277004726310" data-draft-id="7562942552241766435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ˜±ä¸€è¡Œä»£ç å¼•å‘çš„è¡€æ¡ˆï¼šå±•å¼€è¿ç®—ç¬¦ï¼ˆ...ï¼‰ç«Ÿè®©å›¾è¡¨åŠŸèƒ½ç›´æ¥å´©äº†ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-18T03:27:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§‹å¤©çš„ä¸€é˜µé£"/> <meta itemprop="url" content="https://juejin.cn/user/3588413946594925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ˜±ä¸€è¡Œä»£ç å¼•å‘çš„è¡€æ¡ˆï¼šå±•å¼€è¿ç®—ç¬¦ï¼ˆ...ï¼‰ç«Ÿè®©å›¾è¡¨åŠŸèƒ½ç›´æ¥å´©äº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3588413946594925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§‹å¤©çš„ä¸€é˜µé£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:27:25.000Z" title="Tue Nov 18 2025 03:27:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„ bug</h2>
<p><strong/></p><p align="center"><strong>Hello~å¤§å®¶å¥½ã€‚æˆ‘æ˜¯ç§‹å¤©çš„ä¸€é˜µé£</strong></p><p/>
<p>æœ€è¿‘åœ¨è´Ÿè´£å¼€å‘æˆ‘å¸çš„ä¸€ä¸ªå›¾è¡¨åŠŸèƒ½æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªä»¤äººå›°æƒ‘çš„é—®é¢˜ã€‚ç”¨æˆ·åé¦ˆåœ¨ç‰¹å®šæ“ä½œä¸‹ä¼šå‡ºç° <code>Maximum call stack size exceeded</code> é”™è¯¯ï¼Œä½†è¿™ä¸ªé—®é¢˜åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å‡ºç°ï¼šé€‰æ‹©å°‘é‡å‚æ•°æ­£å¸¸ï¼Œä½†æ·»åŠ å¤§é‡å‚æ•°åå°±ä¼šå´©æºƒã€‚</p>
<p>ç»è¿‡æ·±å…¥è°ƒè¯•ï¼Œæˆ‘å‘ç°é—®é¢˜çš„æ ¹æºç«Ÿç„¶æ˜¯ä¸€è¡Œçœ‹ä¼¼æ— å®³çš„ä»£ç </p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> rightYMinMax = [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...rightYData), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...rightYData)];
</code></pre>
<p>å½“ <code>rightYData</code> æ•°ç»„åŒ…å« <code>189,544</code> ä¸ªå…ƒç´ æ—¶ï¼Œè¿™è¡Œä»£ç å¯¼è‡´äº†å †æ ˆæº¢å‡ºã€‚</p>
<p>è¿™ä¸ªBugè®©æˆ‘ä¸ç¦å¼€å§‹æ€è€ƒï¼š<strong>åœ¨ JavaScript å¼€å‘ä¸­ï¼Œç®€æ´çš„ä»£ç ä¸€å®šæ˜¯æœ€å¥½çš„ä»£ç å—ï¼Ÿ</strong></p>
<p>ä¸ºäº†å½»åº•ææ¸…æ¥šé—®é¢˜æœ¬è´¨å¹¶æ‰¾åˆ°æœ€ä¼˜è§£å†³æ–¹æ¡ˆï¼Œæˆ‘åœ¨å®¶ä¸­ç¼–å†™äº†å®Œæ•´çš„å¤ç°æ¡ˆä¾‹ï¼Œé€šè¿‡å¯¹æ¯”ä¸åŒå®ç°æ–¹å¼çš„æ€§èƒ½è¡¨ç°ï¼Œæ€»ç»“å‡ºä¸€å¥—å¯è½åœ°çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜æœ¬è´¨ï¼šä¸ºä»€ä¹ˆå±•å¼€è¿ç®—ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼Ÿ</h2>
<p>è¦è§£å†³é—®é¢˜ï¼Œé¦–å…ˆè¦ç†è§£é—®é¢˜çš„æ ¹æºã€‚åœ¨ JavaScript ä¸­ï¼Œ<code>Math.min()</code> å’Œ <code>Math.max()</code> æ˜¯å…¨å±€å‡½æ•°ï¼Œå®ƒä»¬æ¥æ”¶çš„æ˜¯å¯å˜å‚æ•°åˆ—è¡¨ï¼ˆè€Œéæ•°ç»„ï¼‰ï¼Œè€Œ<strong>å±•å¼€è¿ç®—ç¬¦ï¼ˆ...ï¼‰</strong> çš„ä½œç”¨æ˜¯å°†æ•°ç»„å…ƒç´ ã€Œæ‹†è§£ã€æˆä¸€ä¸ªä¸ªç‹¬ç«‹å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚</p>
<h3 data-id="heading-2">1. è°ƒç”¨æ ˆçš„é™åˆ¶â€‹</h3>
<p>JavaScript å¼•æ“å¯¹å‡½æ•°è°ƒç”¨æ ˆçš„æ·±åº¦æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œä¸åŒæµè§ˆå™¨å’Œç¯å¢ƒä¸‹çš„é™åˆ¶ç•¥æœ‰å·®å¼‚ï¼ˆé€šå¸¸åœ¨ 1 ä¸‡ - 10 ä¸‡çº§åˆ«çš„å‚æ•°æ•°é‡ï¼‰ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>Math.min(...largeArray)</code> æ—¶ï¼Œç›¸å½“äºæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1.23</span>, <span class="hljs-number">4.56</span>, <span class="hljs-number">7.89</span>, ..., <span class="hljs-number">999.99</span>); <span class="hljs-comment">// å‚æ•°æ•°é‡ = æ•°ç»„é•¿åº¦</span>
</code></pre>
<p>å½“å‚æ•°æ•°é‡è¶…è¿‡å¼•æ“çš„è°ƒç”¨æ ˆé˜ˆå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘ã€Œæ ˆæº¢å‡ºã€é”™è¯¯ã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œ</p>
<p><strong>è¿™ä¸ªé˜ˆå€¼å¤§çº¦æ˜¯ 18 ä¸‡ä¸ªå‚æ•° â€”â€” è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå°‘é‡å‚æ•°æ­£å¸¸ï¼Œ18 ä¸‡ + å‚æ•°å´©æºƒçš„æ ¸å¿ƒåŸå› ã€‚</strong></p>
<h3 data-id="heading-3">2. ä»£ç å±‚é¢çš„éšè—é£é™©</h3>
<p>å¾ˆå¤šå¼€å‘è€…å–œæ¬¢ç”¨å±•å¼€è¿ç®—ç¬¦å¤„ç†æ•°ç»„ï¼Œå› ä¸ºä»£ç ç®€æ´ç›´è§‚ã€‚ä½†è¿™ç§å†™æ³•åœ¨ã€Œå°æ•°æ®é‡ã€åœºæ™¯ä¸‹çœ‹ä¼¼æ— å®³ï¼Œä¸€æ—¦æ•°æ®é‡å¢é•¿ï¼ˆæ¯”å¦‚å›¾è¡¨æ•°æ®ã€åˆ—è¡¨æ•°æ®ï¼‰ï¼Œå°±ä¼šç¬é—´æš´éœ²é£é™©ã€‚æ›´éšè”½çš„æ˜¯ï¼Œè¿™ç§é—®é¢˜åœ¨å¼€å‘ç¯å¢ƒä¸­å¾ˆéš¾å¤ç°ï¼ˆå¼€å‘ç¯å¢ƒæ•°æ®é‡å°ï¼‰ï¼Œå¾€å¾€è¦ç­‰åˆ°ç”Ÿäº§ç¯å¢ƒæ‰ä¼šçˆ†å‘ã€‚</p>
<h2 data-id="heading-4">äºŒã€å¤ç°æ¡ˆä¾‹ï¼šä¸‰ç§æ–¹æ¡ˆçš„æ€§èƒ½å¯¹æ¯”</h2>
<p>ä¸ºäº†éªŒè¯ä¸åŒå®ç°æ–¹å¼çš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œæˆ‘ç¼–å†™äº†å®Œæ•´çš„æµ‹è¯•ä»£ç <code>ï¼ˆåŸºäº Vue3 + TypeScriptï¼‰</code>ï¼Œé€šè¿‡ã€Œå±•å¼€è¿ç®—ç¬¦ã€ã€Œå¾ªç¯éå†ã€ã€ŒReduce æ–¹æ³•ã€ä¸‰ç§æ–¹æ¡ˆï¼Œåœ¨ 10 ä¸‡ã€50 ä¸‡ã€100 ä¸‡çº§æ•°æ®é‡ä¸‹è¿›è¡Œå¯¹æ¯”æµ‹è¯•ã€‚</p>
<h3 data-id="heading-5">1. æ ¸å¿ƒæµ‹è¯•ä»£ç </h3>
<pre><code class="hljs language-js" lang="js">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// æµ‹è¯•æ•°æ®å¤§å°ï¼ˆ10ä¸‡ã€50ä¸‡ã€100ä¸‡ï¼‰</span>
<span class="hljs-keyword">const</span> testSizes = <span class="hljs-title function_">ref</span>([<span class="hljs-number">100000</span>, <span class="hljs-number">500000</span>, <span class="hljs-number">1000000</span>]);

<span class="hljs-comment">// å®šä¹‰æµ‹è¯•ç»“æœç±»å‹</span>
interface <span class="hljs-title class_">TestResult</span> {
  <span class="hljs-attr">method</span>: string;
  <span class="hljs-attr">success</span>: boolean;
  <span class="hljs-attr">result</span>: number[] | <span class="hljs-literal">null</span>;
  <span class="hljs-attr">time</span>: number;
  <span class="hljs-attr">error</span>: string | <span class="hljs-literal">null</span>;
}
interface <span class="hljs-title class_">TestData</span> {
  <span class="hljs-attr">size</span>: number;
  <span class="hljs-attr">tests</span>: <span class="hljs-title class_">TestResult</span>[];
}
<span class="hljs-keyword">const</span> results = ref&lt;<span class="hljs-title class_">TestData</span>[]&gt;([]);

<span class="hljs-comment">// ç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generateTestData</span> = (<span class="hljs-params">size: number</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: size }, <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span>);
};

<span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šåŸå§‹æ–¹æ³•ï¼ˆå±•å¼€è¿ç®—ç¬¦ï¼Œä¼šæ ˆæº¢å‡ºï¼‰</span>
<span class="hljs-keyword">const</span> getMinMaxWithSpread = (<span class="hljs-attr">data</span>: number[]): <span class="hljs-function"><span class="hljs-params">TestResult</span> =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> result = [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...data), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...data)]; <span class="hljs-comment">// é£é™©ä»£ç </span>
    <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'å±•å¼€è¿ç®—ç¬¦'</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
      result,
      <span class="hljs-attr">time</span>: end - start,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
    };
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: any) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'å±•å¼€è¿ç®—ç¬¦'</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">result</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">time</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
    };
  }
};

<span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šä¼˜åŒ–æ–¹æ¡ˆï¼ˆå¾ªç¯éå†ï¼‰</span>
<span class="hljs-keyword">const</span> getMinMaxWithLoop = (<span class="hljs-attr">data</span>: number[]): <span class="hljs-function"><span class="hljs-params">TestResult</span> =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">let</span> min = data[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">let</span> max = data[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">if</span> (data[i] &lt; min) min = data[i];
      <span class="hljs-keyword">if</span> (data[i] &gt; max) max = data[i];
    }
    <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'å¾ªç¯éå†'</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">result</span>: [min, max],
      <span class="hljs-attr">time</span>: end - start,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
    };
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: any) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'å¾ªç¯éå†'</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">result</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">time</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
    };
  }
};

<span class="hljs-comment">// æ–¹æ¡ˆ3ï¼šä¼˜åŒ–æ–¹æ¡ˆï¼ˆReduceæ–¹æ³•ï¼‰</span>
<span class="hljs-keyword">const</span> getMinMaxWithReduce = (<span class="hljs-attr">data</span>: number[]): <span class="hljs-function"><span class="hljs-params">TestResult</span> =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> result = data.<span class="hljs-title function_">reduce</span>(
      <span class="hljs-function">(<span class="hljs-params">acc, curr</span>) =&gt;</span> [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(acc[<span class="hljs-number">0</span>], curr), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(acc[<span class="hljs-number">1</span>], curr)],
      [data[<span class="hljs-number">0</span>], data[<span class="hljs-number">0</span>]]
    );
    <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'Reduceæ–¹æ³•'</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
      result,
      <span class="hljs-attr">time</span>: end - start,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
    };
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: any) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'Reduceæ–¹æ³•'</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">result</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">time</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
    };
  }
};

<span class="hljs-comment">// æ‰§è¡Œæµ‹è¯•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">runTests</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'### å¼€å§‹æµ‹è¯•æ ˆæº¢å‡ºé—®é¢˜...'</span>);
  results.<span class="hljs-property">value</span> = [];
  
  testSizes.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`### æµ‹è¯•æ•°æ®å¤§å°: <span class="hljs-subst">${size.toLocaleString()}</span>`</span>);
    <span class="hljs-keyword">const</span> testData = <span class="hljs-title function_">generateTestData</span>(size);
    
    <span class="hljs-comment">// æ‰§è¡Œä¸‰ç§æ–¹æ¡ˆçš„æµ‹è¯•</span>
    <span class="hljs-keyword">const</span> testResult = {
      size,
      <span class="hljs-attr">tests</span>: [
        <span class="hljs-title function_">getMinMaxWithSpread</span>(testData),
        <span class="hljs-title function_">getMinMaxWithLoop</span>(testData),
        <span class="hljs-title function_">getMinMaxWithReduce</span>(testData)
      ]
    };
    
    results.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(testResult);
    
    <span class="hljs-comment">// æ‰“å°æ§åˆ¶å°ç»“æœ</span>
    testResult.<span class="hljs-property">tests</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">test</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (test.<span class="hljs-property">success</span> &amp;&amp; test.<span class="hljs-property">result</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`### <span class="hljs-subst">${test.method}</span>: æˆåŠŸ - è€—æ—¶ <span class="hljs-subst">${test.time.toFixed(<span class="hljs-number">2</span>)}</span>ms - ç»“æœ: [<span class="hljs-subst">${test.result[<span class="hljs-number">0</span>].toFixed(<span class="hljs-number">2</span>)}</span>, <span class="hljs-subst">${test.result[<span class="hljs-number">1</span>].toFixed(<span class="hljs-number">2</span>)}</span>]`</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`### <span class="hljs-subst">${test.method}</span>: å¤±è´¥ - <span class="hljs-subst">${test.error}</span>`</span>);
      }
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'### ---'</span>);
  });
};

<span class="hljs-comment">// é¡µé¢æŒ‚è½½æ—¶æ‰§è¡Œæµ‹è¯•</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">runTests</span>();
});
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 20px; font-family: Arial, sans-serif;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Math.min/max æ ˆæº¢å‡ºé—®é¢˜æµ‹è¯•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin: 20px 0;"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>é—®é¢˜æè¿°<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å½“æ•°ç»„å…ƒç´ æ•°é‡è¿‡å¤§æ—¶ï¼Œä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>Math.min(...array)<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span> ä¼šå¯¼è‡´æ ˆæº¢å‡ºé”™è¯¯ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åŸå› ï¼šå±•å¼€è¿ç®—ç¬¦ä¼šå°†æ‰€æœ‰æ•°ç»„å…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œè¶…å‡ºJavaScriptå¼•æ“çš„è°ƒç”¨æ ˆé™åˆ¶ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin: 20px 0;"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"runTests"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;"</span>&gt;</span>
        é‡æ–°è¿è¡Œæµ‹è¯•
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin: 20px 0;"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æµ‹è¯•ç»“æœ<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"result in results"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"result.size"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px;"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æ•°æ®å¤§å°: {{ result.size.toLocaleString() }} ä¸ªå…ƒç´ <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"test in result.tests"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"test.method"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: flex; justify-content: space-between; align-items: center;"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{{ test.method }}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ color: test.success ? 'green' : 'red' }"</span>&gt;</span>
              {{ test.success ? 'âœ“ æˆåŠŸ' : 'âœ— å¤±è´¥' }}
            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"test.success"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 5px;"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è€—æ—¶: {{ test.time.toFixed(2) }}ms<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"test.result"</span>&gt;</span>ç»“æœ: [{{ test.result[0].toFixed(2) }}, {{ test.result[1].toFixed(2) }}]<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 5px; color: red;"</span>&gt;</span>
            é”™è¯¯: {{ test.error }}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d36c023d30004d38b889075b6482b98d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL5aSp55qE5LiA6Zi16aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041244&amp;x-signature=o0nWGBfwxUcJcjF8poxGFXkWSfU%3D" alt="image.png" width="100%" loading="lazy"/>
<h3 data-id="heading-6">2. æµ‹è¯•ç»“æœåˆ†æï¼ˆChrome æµè§ˆå™¨ç¯å¢ƒï¼‰</h3>
<p>é€šè¿‡å®é™…è¿è¡Œæµ‹è¯•ä»£ç ï¼Œæˆ‘å¾—åˆ°äº†ä»¥ä¸‹å…³é”®ç»“æœï¼ˆæ•°æ®ä¸ºå¤šæ¬¡æµ‹è¯•å¹³å‡å€¼ï¼‰ï¼š</p>





























<table><thead><tr><th>æ•°æ®é‡</th><th>å±•å¼€è¿ç®—ç¬¦</th><th>å¾ªç¯éå†</th><th>Reduce æ–¹æ³•</th></tr></thead><tbody><tr><td>10 ä¸‡å…ƒç´ </td><td>æˆåŠŸï¼ˆ1.6msï¼‰</td><td>æˆåŠŸï¼ˆ0.2msï¼‰</td><td>æˆåŠŸï¼ˆ1.4msï¼‰</td></tr><tr><td>50 ä¸‡å…ƒç´ </td><td>å¤±è´¥ï¼ˆæ ˆæº¢å‡ºé”™è¯¯ï¼‰</td><td>æˆåŠŸï¼ˆ0.4msï¼‰</td><td>æˆåŠŸï¼ˆ4.4msï¼‰</td></tr><tr><td>100 ä¸‡å…ƒç´ </td><td>å¤±è´¥ï¼ˆæ ˆæº¢å‡ºé”™è¯¯ï¼‰</td><td>æˆåŠŸï¼ˆ0.6msï¼‰</td><td>æˆåŠŸï¼ˆ23.9msï¼‰</td></tr></tbody></table>
<p>ä»ç»“æœä¸­å¯ä»¥å¾—å‡ºä¸¤ä¸ªæ ¸å¿ƒç»“è®ºï¼š</p>
<ol>
<li>
<p><strong>ç¨³å®šæ€§</strong>ï¼šå±•å¼€è¿ç®—ç¬¦åœ¨æ•°æ®é‡è¶…è¿‡ 10 ä¸‡åå°±ä¼šè§¦å‘æ ˆæº¢å‡ºï¼Œè€Œå¾ªç¯éå†å’Œ Reduce æ–¹æ³•åœ¨ 100 ä¸‡çº§æ•°æ®ä¸‹ä»èƒ½ç¨³å®šè¿è¡Œï¼›</p>
</li>
<li>
<p><strong>æ€§èƒ½</strong>ï¼šå¾ªç¯éå†çš„æ€§èƒ½æœ€ä¼˜ï¼ˆè€—æ—¶æœ€çŸ­ï¼‰ï¼ŒReduce æ–¹æ³•ç•¥é€Šäºå¾ªç¯ï¼ˆå‡½æ•°è°ƒç”¨æœ‰é¢å¤–å¼€é”€ï¼‰ï¼Œå±•å¼€è¿ç®—ç¬¦åœ¨å°æ•°æ®é‡ä¸‹è¡¨ç°å°šå¯ï¼Œä½†ç¨³å®šæ€§æå·®ã€‚</p>
</li>
</ol>
<h2 data-id="heading-7">ä¸‰ã€è§£å†³æ–¹æ¡ˆï¼šä»ä¿®å¤åˆ°é¢„é˜²â€‹</h2>
<p>é’ˆå¯¹ã€ŒMath.min/max å¤„ç†å¤§æ•°æ®æ•°ç»„ã€çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä»ã€Œå³æ—¶ä¿®å¤ã€å’Œã€Œé•¿æœŸé¢„é˜²ã€ä¸¤ä¸ªå±‚é¢åˆ¶å®šæ–¹æ¡ˆã€‚â€‹</p>
<h3 data-id="heading-8">æ–¹æ¡ˆ 1ï¼šå¾ªç¯éå†ï¼ˆæ€§èƒ½æœ€ä¼˜ï¼‰â€‹</h3>
<p>é€‚ç”¨äºå¯¹æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚å¤§æ•°æ®å›¾è¡¨ã€å®æ—¶è®¡ç®—ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> getMinMax = (<span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span>[]): [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =&gt; {â€‹
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ•°ç»„ä¸èƒ½ä¸ºç©º'</span>);â€‹
  <span class="hljs-keyword">let</span> min = data[<span class="hljs-number">0</span>];â€‹
  <span class="hljs-keyword">let</span> max = data[<span class="hljs-number">0</span>];â€‹
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {â€‹
    min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(min, data[i]);â€‹
    max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(max, data[i]);â€‹
  }â€‹
  <span class="hljs-keyword">return</span> [min, max];â€‹
};<span class="hljs-keyword">const</span> getMinMax = (<span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span>[]): [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =&gt; {â€‹
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ•°ç»„ä¸èƒ½ä¸ºç©º'</span>);â€‹
  <span class="hljs-keyword">let</span> min = data[<span class="hljs-number">0</span>];â€‹
  <span class="hljs-keyword">let</span> max = data[<span class="hljs-number">0</span>];â€‹
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {â€‹
    min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(min, data[i]);â€‹
    max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(max, data[i]);â€‹
  }â€‹
  <span class="hljs-keyword">return</span> [min, max];â€‹
};
</code></pre>
<h3 data-id="heading-9">æ–¹æ¡ˆ 2ï¼šReduce æ–¹æ³•ï¼ˆä»£ç ç®€æ´ï¼‰â€‹</h3>
<p>é€‚ç”¨äºä»£ç é£æ ¼åå‘å‡½æ•°å¼ç¼–ç¨‹çš„åœºæ™¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> getMinMax = (<span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span>[]): [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =&gt; {â€‹
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ•°ç»„ä¸èƒ½ä¸ºç©º'</span>);â€‹
  <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">reduce</span>(â€‹
    (acc, curr) =&gt; [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(acc[<span class="hljs-number">0</span>], curr), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(acc[<span class="hljs-number">1</span>], curr)],â€‹
    [data[<span class="hljs-number">0</span>], data[<span class="hljs-number">0</span>]]â€‹
  );â€‹
};
</code></pre>
<h3 data-id="heading-10">æ–¹æ¡ˆ 3ï¼šåˆ†æ‰¹å¤„ç†ï¼ˆè¶…å¤§æ•°æ®é‡ï¼‰â€‹</h3>
<p>å½“æ•°æ®é‡è¾¾åˆ°ã€Œåƒä¸‡çº§ã€æ—¶ï¼Œå³ä½¿å¾ªç¯éå†ä¹Ÿå¯èƒ½æœ‰å†…å­˜å‹åŠ›ï¼Œæ­¤æ—¶å¯ä»¥åˆ†æ‰¹å¤„ç†ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> getMinMaxBatch = (<span class="hljs-attr">data</span>: number[], batchSize = <span class="hljs-number">100000</span>): [number, number] =&gt; {
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ•°ç»„ä¸èƒ½ä¸ºç©º'</span>);
  <span class="hljs-keyword">let</span> min = data[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">let</span> max = data[<span class="hljs-number">0</span>];
  
  <span class="hljs-comment">// åˆ†æ‰¹å¤„ç†</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i += batchSize) {
    <span class="hljs-keyword">const</span> batch = data.<span class="hljs-title function_">slice</span>(i, i + batchSize);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> num <span class="hljs-keyword">of</span> batch) {
      min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(min, num);
      max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(max, num);
    }
  }
  
  <span class="hljs-keyword">return</span> [min, max];
};
</code></pre>
<h3 data-id="heading-11">æ–¹æ¡ˆ 4ï¼šé•¿æœŸé¢„é˜²ï¼šå»ºç«‹ç¼–ç è§„èŒƒ</h3>
<p>ä¸ºäº†é¿å…ç±»ä¼¼é—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘åœ¨å›¢é˜Ÿä¸­å»ºç«‹ä»¥ä¸‹ç¼–ç è§„èŒƒï¼š</p>
<ol>
<li>ç¦æ­¢ç”¨å±•å¼€è¿ç®—ç¬¦å¤„ç†æœªçŸ¥å¤§å°çš„æ•°ç»„ï¼šå¦‚æœæ•°ç»„é•¿åº¦å¯èƒ½è¶…è¿‡ 1 ä¸‡ï¼Œåšå†³ä¸ç”¨ <code>Math.min(...array) æˆ– Math.max(...array)ï¼›</code></li>
</ol>

<ol start="2">
<li>ä¼˜å…ˆé€‰æ‹©å¾ªç¯éå†å¤„ç†å¤§æ•°æ®ï¼šåœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚æ•°æ®å¯è§†åŒ–ã€åˆ—è¡¨ç­›é€‰ï¼‰ï¼Œ<code>ä¼˜å…ˆä½¿ç”¨ for å¾ªç¯è€Œé Reduce æˆ–å…¶ä»–å‡½æ•°å¼æ–¹æ³•ï¼›</code></li>
</ol>

<ol start="3">
<li>æ·»åŠ æ•°æ®é‡æ ¡éªŒï¼šå¯¹è¾“å…¥æ•°ç»„çš„é•¿åº¦è¿›è¡Œé™åˆ¶ï¼Œè¶…è¿‡é˜ˆå€¼æ—¶ç»™å‡ºè­¦å‘Šæˆ–åˆ†æ‰¹å¤„ç†ï¼›</li>
</ol>

<ol start="4">
<li>å•å…ƒæµ‹è¯•è¦†ç›–è¾¹ç•Œåœºæ™¯ï¼šåœ¨å•å…ƒæµ‹è¯•ä¸­åŠ å…¥ã€Œå¤§æ•°æ®é‡ã€åœºæ™¯ï¼ˆå¦‚ 10 ä¸‡ã€100 ä¸‡å…ƒç´ ï¼‰ï¼Œæå‰æš´éœ²é—®é¢˜ã€‚</li>
</ol>
<h2 data-id="heading-12">å››ã€æ€»ç»“ï¼šè·³å‡ºã€Œç®€æ´ä»£ç ã€çš„é™·é˜±â€‹</h2>
<p>è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„æ ˆæº¢å‡ºé—®é¢˜ï¼Œç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸‰ä¸ªæ·±åˆ»çš„å¯ç¤ºï¼šâ€‹</p>
<ol>
<li>ç®€æ´ä¸ç­‰äºä¼˜è´¨ï¼šå¾ˆå¤šå¼€å‘è€…è¿½æ±‚ã€Œä¸€è¡Œä»£ç è§£å†³é—®é¢˜ã€ï¼Œä½†å¿½ç•¥äº†ä»£ç çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚åœ¨ JavaScript ä¸­ï¼Œå±•å¼€è¿ç®—ç¬¦ã€evalã€with ç­‰è¯­æ³•è™½ç„¶ç®€æ´ï¼Œä½†å¾€å¾€éšè—ç€é£é™©ï¼›â€‹</li>
</ol>

<ol start="2">
<li><strong>å…³æ³¨æ•°æ®é‡å˜åŒ–ï¼šå‰ç«¯å¼€å‘ä¸å†æ˜¯ã€Œå°æ•°æ®æ—¶ä»£ã€ï¼Œéšç€å›¾è¡¨ã€å¤§æ•°æ®åˆ—è¡¨ã€å®æ—¶æ•°æ®æµçš„æ™®åŠï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä»£ç è®¾è®¡é˜¶æ®µå°±è€ƒè™‘ã€Œå¤§æ•°æ®åœºæ™¯ã€ï¼›â€‹</strong></li>
</ol>

<ol start="3">
<li>é‡è§†è¾¹ç•Œæµ‹è¯•ï¼šå¼€å‘ç¯å¢ƒä¸­çš„ã€Œå°æ•°æ®æµ‹è¯•ã€æ— æ³•è¦†ç›–ç”Ÿäº§ç¯å¢ƒçš„ã€Œå¤§æ•°æ®åœºæ™¯ã€ï¼Œå¿…é¡»é€šè¿‡è¾¹ç•Œæµ‹è¯•ï¼ˆå¦‚æœ€å¤§æ•°æ®é‡ã€ç©ºæ•°æ®ã€å¼‚å¸¸æ•°æ®ï¼‰éªŒè¯ä»£ç ç¨³å®šæ€§ã€‚â€‹</li>
</ol>
<p>æœ€åï¼Œç”¨ä¸€å¥è¯æ€»ç»“ï¼šä¼˜ç§€çš„å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä¸ä»…è¦å†™å‡ºã€Œèƒ½è¿è¡Œã€çš„ä»£ç ï¼Œæ›´è¦å†™å‡ºã€Œç¨³å®šã€é«˜æ•ˆã€å¯æ‰©å±•ã€çš„ä»£ç ã€‚è¿™ä¸ªæ ˆæº¢å‡ºé—®é¢˜ï¼Œæ­£æ˜¯æˆ‘ä»¬ä»ã€Œä¼šå†™ä»£ç ã€åˆ°ã€Œå†™å¥½ä»£ç ã€çš„ä¸€æ¬¡é‡è¦æˆé•¿ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ­ç§˜é«˜æ€§èƒ½ååŒç™½æ¿ï¼šè½»æ¾å®ç°å¤šäººå®æ—¶åä½œï¼ˆä¸€ï¼‰]]></title>    <link>https://juejin.cn/post/7573588675637837839</link>    <guid>https://juejin.cn/post/7573588675637837839</guid>    <pubDate>2025-11-18T03:19:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675637837839" data-draft-id="7573588675637739535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ­ç§˜é«˜æ€§èƒ½ååŒç™½æ¿ï¼šè½»æ¾å®ç°å¤šäººå®æ—¶åä½œï¼ˆä¸€ï¼‰"/> <meta itemprop="keywords" content="è®¾è®¡æ¨¡å¼,å‰ç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-18T03:19:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ´shu"/> <meta itemprop="url" content="https://juejin.cn/user/3866303125264135"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ­ç§˜é«˜æ€§èƒ½ååŒç™½æ¿ï¼šè½»æ¾å®ç°å¤šäººå®æ—¶åä½œï¼ˆä¸€ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3866303125264135/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ´shu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:19:31.000Z" title="Tue Nov 18 2025 03:19:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç›®å‰æˆç†Ÿçš„ç™½æ¿å·¥å…·å·²ç»å¾ˆå¤šäº†ï¼Œæƒ³æ¢ç´¢ä¸‹å†…éƒ¨çš„å®ç°åŸç†ï¼Œä¸ºè¿œç¨‹å›¢é˜Ÿåä½œã€åœ¨çº¿æ•™è‚²ã€è®¾è®¡è¯„å®¡å’Œå¤´è„‘é£æš´åœºæ™¯è®¾è®¡ï¼Œé€šè¿‡é«˜æ•ˆçš„ <code>Konva</code> æ¸²æŸ“å¼•æ“å’Œ <code>Yjs</code> ååŒç®—æ³•ï¼Œå®ç°å¤šäººå®æ—¶æ“ä½œçš„æ— ç¼ååŒä½“éªŒï¼ŒåŒæ—¶ä¿æŒé«˜æ€§èƒ½çš„å›¾å½¢å¤„ç†èƒ½åŠ›ï¼Œæµç•…çš„æ“ä½œä½“éªŒã€‚</p>
<p>ç°å­˜çš„ç™½æ¿å·¥å…·ä»æœ‰äº›å°é—®é¢˜ï¼Œä¾‹å¦‚ï¼š<code>éš¾ä»¥é›†æˆåˆ°é¡¹ç›®ä¸­</code>ã€<code>äºŒå¼€éš¾åº¦å¤§</code>ã€<code>å¼€å‘è€…ä¸å‹å¥½</code>ç­‰ï¼Œæœ¬åº”ç”¨æ„åœ¨æä¾›å®Œæ•´ç™½æ¿åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œè§£å†³ä¸Šè¯‰æåˆ°çš„éš¾ç‚¹ï¼Œå¹¶åˆ›æ–°æ·»åŠ ä¸€äº›æ–°ç‰¹æ€§ï¼Œç”¨äºä¸°å¯Œç™½æ¿çš„æ•°æ®å±•ç¤ºèƒ½åŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b272ae4aa734991ad250528dfe5f6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=ReEVTUTgAZcVavOgumPb2S49NK8%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-1">æ•°æ®ç»“æ„è®¾è®¡</h2>
<p>åœ¨åº”ç”¨å¼€å‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¾è®¡ä¸€ä¸‹åº”ç”¨çš„æ•°æ®å­˜å‚¨ç»“æ„ï¼Œä¸€ä¸ªå¥½çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬çœå»å¾ˆå¤šéº»çƒ¦ã€‚</p>
<ol>
<li>ä¸ºäº†å®ç°å›¾å½¢èŠ‚ç‚¹é™„åŠ æ–‡æœ¬çš„æ•ˆæœ(åŒå‡»æ·»åŠ æ–‡æœ¬)ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>konva Group </code> ç»„çš„æ¦‚å¿µï¼Œå°†å›¾å½¢èŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°ç»„ä¸­,ä»¥å®ç°æ•´ä½“çš„å¹³ç§»ã€ç¼©æ”¾ã€å˜æ¢ç­‰æ•ˆæœã€‚</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Group</span>();
<span class="hljs-keyword">const</span> shape = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Rect</span>({...});
<span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Text</span>({...});
group.<span class="hljs-title function_">add</span>(shape, text);
</code></pre>
<ol start="2">
<li>æœ¬ä¾‹é‡‡ç”¨ Yjs åˆ†å¸ƒå¼ååŒç‰¹æ€§ï¼Œå› æ­¤ï¼Œæ•´ä¸ªåº”ç”¨ <code>AppData</code> è®¾è®¡ä¸º <code>Y.Map</code>ï¼Œå¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å®šä¹‰æ•´ä¸ªåº”ç”¨çš„æ•°æ®ï¼Œkey ä¸º shapeIDï¼Œvalue ä¸º ShapeItem</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">AppData</span> = <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">ShapeItem</span>&gt;;

<span class="hljs-comment">// æ¯ä¸€ä¸ª Konva å›¾å½¢çš„å±æ€§</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShapeItem</span> {
	<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å›¾å½¢id</span>
	<span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å›¾å½¢ç±»å‹ - ç”¨äºåˆ¤æ–­å›¾å½¢ç±»å‹ 'group' | 'rect'|  'circle' | 'ellipse' | 'image' | 'text' | ...</span>
	locked?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// æ˜¯å¦é”å®š</span>
	visible?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// æ˜¯å¦å¯è§</span>
	children?: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// å­èŠ‚ç‚¹IDæ•°ç»„ï¼ˆç”¨äºç»„åˆèŠ‚ç‚¹ï¼‰ - ç”¨äºåˆ¤æ–­å›¾å½¢æ˜¯å¦ä¸ºç»„åˆå›¾å½¢</span>
	isCombined?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// æ ‡è®°æ˜¯å¦è¢«ç»„åˆ</span>
	attrs?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;; <span class="hljs-comment">// æ‹“å±•å±æ€§</span>
	<span class="hljs-attr">group</span>: <span class="hljs-title class_">GroupConfig</span>; <span class="hljs-comment">// Step 1 render æ—¶ï¼Œå…ˆæ ¹æ® group åˆ›å»ºä¸€ä¸ª group</span>
	<span class="hljs-attr">shape</span>: <span class="hljs-title class_">ShapeConfig</span>; <span class="hljs-comment">// Step 2 render æ—¶ï¼Œæ ¹æ® shape åˆ›å»ºä¸€ä¸ª shape</span>
	<span class="hljs-attr">text</span>: <span class="hljs-title class_">TextConfig</span>; <span class="hljs-comment">// Step 3 render æ—¶ï¼Œæ ¹æ® text åˆ›å»ºä¸€ä¸ª text</span>
}
</code></pre>
<ol start="3">
<li>æŠ½è±¡æ•°æ®æ“ä½œç¤ºä¾‹å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ ¹èŠ‚ç‚¹</span>
<span class="hljs-keyword">const</span> appData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">getMap</span>(<span class="hljs-string">'appData'</span>);

<span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªå›¾å½¢</span>
<span class="hljs-keyword">const</span> rectConfig = <span class="hljs-title class_">ShapeController</span>.<span class="hljs-title function_">createShape</span>(<span class="hljs-string">'rect'</span>, {...});
appData.<span class="hljs-title function_">set</span>(rectConfig.<span class="hljs-property">id</span>, rectConfig)

<span class="hljs-comment">// åˆ é™¤ä¸€ä¸ªå›¾å½¢</span>
appData.<span class="hljs-title function_">delete</span>(rectConfig.<span class="hljs-property">id</span>);

<span class="hljs-comment">// ä¿®æ”¹å›¾å½¢å±æ€§</span>
appData.<span class="hljs-title function_">set</span>(rectConfig.<span class="hljs-property">id</span>, {...rectConfig, <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> });
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong> ä¿®æ”¹å±æ€§è¯·ä½¿ç”¨ <code>map.set()</code> è€Œä¸æ˜¯ <code>shape.x = 100</code>ï¼Œè¿™ç§æ¨¡å¼ä¸èƒ½å¼•èµ· <code>Y.Map</code> çš„æ•°æ®å˜åŒ–å›è°ƒã€‚</p>
<h2 data-id="heading-2">ååŒæ§åˆ¶ä¸­å¿ƒ</h2>
<p>åœ¨ååŒåº”ç”¨åœºæ™¯ï¼Œåº”å½“åŒ…å«ä»¥ä¸‹å‡ ä¸ªååŒæ¨¡å—ï¼š</p>
<h3 data-id="heading-3">ç”¨æˆ·æ„ŸçŸ¥</h3>
<p>ç”¨æˆ·æ„ŸçŸ¥æ˜¯ååŒä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡æ„ŸçŸ¥è·å–å…¶ä»–ç”¨æˆ·çš„ä½ç½®ä¿¡æ¯åŠå®æ—¶æ“ä½œçŠ¶æ€</p>
<pre><code class="hljs language-ts" lang="ts">		<span class="hljs-comment">// åˆ›å»º awareness å®ä¾‹</span>
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Awareness</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>);

		<span class="hljs-comment">// æ·»åŠ æœ¬åœ°æ„ŸçŸ¥çŠ¶æ€</span>
		<span class="hljs-keyword">const</span> { userId, userName, userColor } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">getUserInfo</span>();
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">setLocalState</span>({ userId, userName, userColor });
		<span class="hljs-comment">// ç›‘å¬æ„ŸçŸ¥çŠ¶æ€</span>
		<span class="hljs-title function_">encodeAwarenessUpdate</span>(
			<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span>,
			<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">getStates</span>().<span class="hljs-title function_">keys</span>())
		);
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'update'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleAwarenessUpdate</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
</code></pre>
<p>é™¤äº†ç”¨æˆ·ä¿¡æ¯ï¼Œè¿˜å¯ä»¥å°†ç”¨æˆ·å…‰æ ‡ä½ç½®ç­‰ä¿¡æ¯ï¼Œä¸€åŒå‘é€ç»™å…¶ä»–å®¢æˆ·ç«¯ï¼Œå› æ­¤éœ€è¦æä¾›æ›´æ–°å…‰æ ‡çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">	<span class="hljs-comment">/**
	 * <span class="hljs-doctag">@description</span> æ›´æ–°æ„ŸçŸ¥çŠ¶æ€
	 * <span class="hljs-doctag">@param</span> {<span class="hljs-type"> [key: string]: any  </span>} æ›´æ–°çš„æ•°æ®
	 * <span class="hljs-doctag">@returns</span>
	 */</span>
	<span class="hljs-keyword">public</span> <span class="hljs-title function_">updateAwareness</span>(<span class="hljs-params">data: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; = {}</span>) {
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">setLocalState</span>({
			...<span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">getLocalState</span>(),
			...data,
		});
	}
</code></pre>
<p>åç»­çš„å…·ä½“å…‰æ ‡å®ç°ï¼Œåˆ°ç»˜åˆ¶å›¾å±‚æ—¶ï¼Œåœ¨è¯¦ç»†è¯´æ˜å“ˆ</p>
<h3 data-id="heading-4">æä¾›ç¨‹åº</h3>
<p>æä¾›ç¨‹åºæ˜¯ååŒçš„é‡ç‚¹ï¼Œä¸åŒçš„æä¾›ç¨‹åºå¯¹ååŒè®¾è®¡æœ‰ç€ä¸åŒçš„æ•ˆæœï¼Œé€‰æ‹©åˆé€‚çš„æä¾›ç¨‹åºï¼Œä¹Ÿæ˜¯ååŒæ—¶æ•ˆæ€§ã€ç¨³å®šæ€§çš„è€ƒéªŒ</p>
<pre><code class="hljs language-ts" lang="ts">		<span class="hljs-comment">// websocket æ–¹å¼å®ç°ååŒ - æä¾›ç¨‹åºé»˜è®¤æ”¯æŒä¼ é€’ awareness</span>
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">provider</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebsocketProvider</span>(url, roomname, <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>, {
			awareness,
			params,
		});
</code></pre>
<h3 data-id="heading-5">æ’¤é”€ç®¡ç†</h3>
<p>ååŒåº”ç”¨ï¼Œè¾ƒéš¾çš„å°±æ˜¯åˆ†å¸ƒå¼æ’¤é”€ï¼ŒYjså†…ç½®çš„ <code>Y.UndoManager</code> æ”¯æŒåˆ†å¸ƒå¼æ’¤é”€ï¼Œè¿™ä¸ºæˆ‘ä»¬ååŒè®¾è®¡æä¾›äº†ä¾¿åˆ©</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-variable language_">this</span>.<span class="hljs-property">undoManager</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndoManager</span>(doc, {
	<span class="hljs-attr">captureTimeout</span>: <span class="hljs-number">500</span>,
	 <span class="hljs-comment">// æ·»åŠ ç”¨æˆ·æºï¼ˆç‰¹åˆ«æ³¨æ„è¿™é‡Œï¼Œéœ€è¦ä¸ transaction originä¿æŒä¸€è‡´ï¼ï¼‰</span>
	<span class="hljs-attr">trackedOrigins</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([origin]),
});
</code></pre>
<p><code>Y.UndoManager</code> ç›´æ¥å…³è”çš„å°±æ˜¯ <code>history</code> å†å²è®°å½•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">	<span class="hljs-title function_">constructor</span>(<span class="hljs-params">collaborateManager: CollaborateManager</span>) {
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">undoManager</span> = collaborateManager.<span class="hljs-title function_">getUndoManager</span>();
	}

	<span class="hljs-keyword">public</span> <span class="hljs-title function_">undo</span>(<span class="hljs-params"/>) {
		<span class="hljs-comment">// å¦‚æœä¸å¯æ’¤é”€</span>
		<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">undoManager</span>.<span class="hljs-title function_">canUndo</span>()) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'âš ï¸ ä¸å¯æ’¤é”€!'</span>);
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">undoManager</span>.<span class="hljs-title function_">undo</span>();
	}

	<span class="hljs-keyword">public</span> <span class="hljs-title function_">redo</span>(<span class="hljs-params"/>) {
		<span class="hljs-comment">// å¦‚æœä¸å¯é‡åš</span>
		<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">undoManager</span>.<span class="hljs-title function_">canRedo</span>()) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'âš ï¸ ä¸å¯é‡åš!'</span>);
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">undoManager</span>.<span class="hljs-title function_">redo</span>();
	}
</code></pre>
<h3 data-id="heading-6">ç”¨æˆ·ç³»ç»Ÿ</h3>
<p>ç”¨æˆ·ç³»ç»ŸæŒ‡çš„æ˜¯å½“å‰ååŒçš„ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ID ã€userNameã€ä»¥åŠç”¨æˆ·ååŒé¢œè‰²ï¼ŒåŒæ—¶ï¼Œåœ¨æ’¤é”€ç®¡ç†å’ŒååŒäº‹ä»¶æºä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ª<code>origin</code>ï¼Œæ˜¯ä¸å½“å‰ç”¨æˆ·ç›¸å…³è”çš„ä¿¡æ¯ï¼Œä¹Ÿå°†å…¶çº³å…¥ç”¨æˆ·ä¿¡æ¯ç®¡ç†ä¸­</p>
<pre><code class="hljs language-ts" lang="ts">		<span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> = userId;
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span> = userName;
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">userColor</span> = userColor;

		<span class="hljs-keyword">const</span> originId = <span class="hljs-title function_">generateKey</span>();
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">origin</span> = { originId, <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> };
</code></pre>
<h3 data-id="heading-7">ååŒå…¥å£</h3>
<p>å…¥å£æ–‡ä»¶æä¾›å¿…è¦çš„æ–¹æ³•ï¼Œå…¶ä¸­æœ€é‡è¦çš„ï¼Œå°±æ˜¯ <code>transaction</code> äº‹åŠ¡æ‰§è¡Œæ–¹æ³•ï¼Œå°†å¯¹æ•°æ®çš„æ“ä½œï¼Œå°è£…åˆ°äº‹åŠ¡ä¸­ï¼Œä¾¿äº <code>UndoManager</code> è®°å½•</p>
<pre><code class="hljs language-ts" lang="ts">	<span class="hljs-keyword">public</span> transaction = <span class="hljs-function">(<span class="hljs-params">fn: () =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> {
		<span class="hljs-comment">// ä½¿ç”¨ä¸ UndoManager ä¸­ä¸€è‡´çš„ origin å¯¹è±¡</span>
		<span class="hljs-keyword">const</span> origin = <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">getOrigin</span>();
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-property">transact</span>&lt;<span class="hljs-built_in">void</span>&gt;(fn, origin);
	};
</code></pre>
<h2 data-id="heading-8">ç»˜åˆ¶å®ç°</h2>
<p>æ—¢ç„¶æ˜¯ç™½æ¿åº”ç”¨ï¼Œé‚£ç›¸å…³çš„ç»˜åˆ¶å®ç°è‚¯å®šæ˜¯æœ€é‡è¦ï¼Œä¹Ÿæ˜¯æœ€éš¾çš„ï¼Œä¸‹é¢å°†è¿™éƒ¨åˆ†è¯¦ç»†è®²è§£ä¸‹ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fkonva.zhcndoc.com%2Fdocs%2Foverview.html" target="_blank" title="https://konva.zhcndoc.com/docs/overview.html" ref="nofollow noopener noreferrer">Konva</a> æ˜¯ä»¥æ ‘å½¢ç»“æ„ç»„ç»‡çš„ç»“æ„ï¼Œstage å°±æ˜¯æ ¹èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„å›¾å±‚éƒ½éœ€è¦æ·»åŠ åˆ° stage ä¸Š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åˆå§‹åŒ– konva</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">stage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initStage</span>();
</code></pre>
<p>ä¸ºäº†å®ç°ç²¾ç»†åŒ–ç®¡ç†ï¼Œé’ˆå¯¹å›¾å±‚ã€å›¾å½¢ã€æ•°æ®éƒ¨åˆ†è¿›è¡ŒæŠ½è±¡åŠå°è£…ï¼Œæ¶æ„å¦‚ä¸‹ï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/494fb14f7067406eb26fa9c1e891558d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=1RWayTMT0qk2Xa2MoWbxUCM7uy8%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol>
<li>ååŒå±‚ä¸»è¦ç»´æŠ¤åº”ç”¨æ•°æ®ï¼Œç›‘å¬æ•°æ®å˜åŒ–ï¼Œé©±åŠ¨è§†å›¾æ›´æ–°ï¼ŒåŒæ—¶å¤„ç† <code>UndoManager</code>ï¼Œå®ç°æ’¤é”€ç®¡ç†ï¼›</li>
<li>ç”¨æˆ·çš„é¡µé¢æ“ä½œï¼Œä¼šæ˜ å°„ä¸ºå›¾å½¢çš„å…·ä½“æ“ä½œï¼Œä¾‹å¦‚æ·»åŠ å›¾å½¢ã€æ›´æ–°å›¾å½¢ã€åˆ é™¤å›¾å½¢ï¼Œç”¨æˆ·å¹¶éçœŸå®åœ¨æ“ä½œå›¾å½¢ï¼Œè€Œæ˜¯é€šè¿‡æ“ä½œä»£ç†åœ¨æ“ä½œæ•°æ®ï¼Œå¼•å‘ <code>appData</code> çš„å˜åŒ–ï¼›</li>
<li>æ•°æ®å˜åŒ–åï¼Œä¼šè°ƒç”¨ <code>render</code> è¿›è¡Œè§†å›¾æ›´æ–°ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å†…ï¼Œå°±éœ€è¦çœŸå®çš„æ“ä½œ <code>Konva</code> ç±»ï¼Œå°†æ•°æ®è½¬æ¢ä¸ºé¡µé¢ä¸Šçš„å›¾å½¢ã€‚</li>
</ol>
<h3 data-id="heading-9">å›¾å±‚ç®¡ç†</h3>
<p>ä¸ºäº†åç»­å¯¹å›¾å±‚çš„æ“ä½œæ›´ä¾¿æ·ï¼Œåº”è¯¥å°†å›¾å±‚çš„ç›¸å…³æ–¹æ³•æŠ½ç¦»ä¸ºç‹¬ç«‹çš„æ¨¡å—ï¼š</p>
<ul>
<li>backgroundLayerï¼šèƒŒæ™¯å›¾å±‚ï¼Œå®ç°èƒŒæ™¯é¢œè‰²ã€ç½‘æ ¼çº¿ç»˜åˆ¶ï¼›</li>
<li>shapeLayerï¼šå½¢çŠ¶å›¾å±‚ï¼Œå®ç°å…ƒç´ çš„ç»˜åˆ¶ã€ç¼©æ”¾ã€å¹³ç§»ç­‰æ“ä½œåŒºï¼›</li>
<li>toolbarLayer: å·¥å…·å›¾å±‚ï¼Œç”¨äºç»˜åˆ¶ååŒå…‰æ ‡ã€é€‰åŒºã€å¯è§†åŒºã€å…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e896da77bcf48b4aa49d225f51c3b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=tajyhktdOFVQ3tYgPV9E%2BgLfYbU%3D" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" loading="lazy"/></li>
</ul>
<p>è¿™æ ·ï¼Œåç»­çš„æ‰€æœ‰å›¾å±‚æ“ä½œï¼Œéƒ½å¯ä»¥ç²¾ç»†åˆ°å…·ä½“çš„å›¾å±‚ï¼Œä¾‹å¦‚ï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²ã€ç»˜åˆ¶ç”¨æˆ·å…‰æ ‡ã€ç»˜åˆ¶å¯¹é½çº¿ç­‰</p>
<h3 data-id="heading-10">å›¾å½¢ç®¡ç†</h3>
<p>æœ¬ä¾‹é‡‡ç”¨çš„æ˜¯æ•°æ®é©±åŠ¨çš„å½¢å¼å®ç°çš„å›¾å½¢ç»˜åˆ¶ï¼Œå› æ­¤ï¼Œéœ€è¦åŠ«æŒç”¨æˆ·å¯¹å›¾å½¢çš„æ“ä½œï¼Œå°†å…¶è½¬æ¢ä¸ºæ•°æ®å¤„ç†ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>åŸæ¨¡å¼ï¼šç›´æ¥æ“ä½œkonvaè¿›è¡Œç»˜åˆ¶</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Rect</span>({...})
layer.<span class="hljs-title function_">add</span>(rect)
</code></pre>
<ul>
<li>æ•°æ®é©±åŠ¨æ¨¡å¼ï¼šå¯¹æ•°æ®è¿›è¡Œç»´æŠ¤ï¼Œä½¿å¾—æ•°æ®é©±åŠ¨è§†å›¾æ›´æ–°</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> appData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">getMap</span>()
appData.<span class="hljs-title function_">observeDeep</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">draw</span>.<span class="hljs-property">render</span>)

<span class="hljs-comment">// è¿™é‡Œä¼šè¿”å› å…·ä½“çš„é…ç½®é¡¹ è€Œä¸æ˜¯å…·ä½“çš„å›¾å½¢</span>
<span class="hljs-keyword">const</span> rectConfig = <span class="hljs-title class_">ShapeController</span>.<span class="hljs-title function_">createShape</span>(<span class="hljs-string">'rect'</span>) 

<span class="hljs-comment">// å°†è¿”å›çš„é…ç½®é¡¹æ·»åŠ åˆ° Y.Map ä¸­</span>
appData.<span class="hljs-title function_">set</span>(rectConfig.<span class="hljs-property">id</span>, rectConfig)

<span class="hljs-comment">// æ•°æ®å˜åŒ–åï¼Œä¼šå¼•èµ· render ç»˜åˆ¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"/>){
	<span class="hljs-comment">// æ ¹æ® appData çœŸå®æ¸²æŸ“ konva å›¾å½¢</span>
}
</code></pre>
<p>è¿™ç§æ¨¡å¼æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œåªéœ€è¦å…³å¿ƒæ•°æ®çš„å˜åŒ–ï¼Œåœ¨ render ä¸­è¿›è¡Œç»Ÿä¸€è¿›è¡Œkonvaå›¾å½¢ç»˜åˆ¶å¤„ç†å³å¯ã€‚åŒæ—¶ï¼Œè¿˜èƒ½åŠ«æŒç”¨æˆ·å¯¹å›¾å½¢çš„æ“ä½œï¼Œå®ç°æ›´å¤šæ‹“å±•åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-11">æ•°æ®é©±åŠ¨</h3>
<p>æ•°æ®é©±åŠ¨æ˜¯æœ¬ä¾‹é‡è¦å®ç°ï¼Œéœ€è¦æ ¹æ® <code>Y.Map</code> çš„æ•°æ®ï¼Œæ¸²æŸ“å‡ºå½“å‰ç”»å¸ƒç»“æ„ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ç›‘å¬æ•°æ®æ›´æ–°ï¼Œé©±åŠ¨è§†å›¾æ¸²æŸ“</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">appDataUpdateHandler</span>(<span class="hljs-params">event: YMapEvent&lt;ShapeItem&gt;</span>) {
	<span class="hljs-comment">// è¿™ä¸ª key æ˜¯å½“å‰å‘ç”Ÿå˜åŒ–çš„ shapeItem.id</span>
	event.<span class="hljs-property">changes</span>.<span class="hljs-property">keys</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">change, key</span>) =&gt;</span>
		<span class="hljs-variable language_">this</span>.<span class="hljs-property">draw</span>.<span class="hljs-title function_">render</span>(change, key)
	);
}

<span class="hljs-keyword">public</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">change: YMapChange, id: <span class="hljs-built_in">string</span></span>) {
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'âœ¨ï¸ patch render'</span>);

	<span class="hljs-comment">// 1. è·å–å½“å‰å›¾å½¢ id åœ¨æ•°æ®ä¸­çš„é…ç½®</span>
	<span class="hljs-keyword">const</span> appData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">collaborateManager</span>.<span class="hljs-title function_">gettAppData</span>();
	<span class="hljs-keyword">const</span> shapeConfig = appData.<span class="hljs-title function_">get</span>(id);

	<span class="hljs-comment">// 2. è·å–å½“å‰å›¾å±‚ç”»å¸ƒ</span>
	<span class="hljs-keyword">const</span> shapeLayer = <span class="hljs-variable language_">this</span>.<span class="hljs-property">layerController</span>.<span class="hljs-title function_">getShapeLayer</span>();

	<span class="hljs-comment">// 3. é€šè¿‡ change è¯†åˆ«å½“å‰çš„æ“ä½œç±»å‹ add | update | delete</span>
	<span class="hljs-keyword">if</span> (change.<span class="hljs-property">action</span> === <span class="hljs-string">'add'</span> &amp;&amp; shapeConfig) {
		shapeLayer.<span class="hljs-title function_">addShape</span>(shapeConfig);
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (change.<span class="hljs-property">action</span> === <span class="hljs-string">'update'</span> &amp;&amp; shapeConfig) {
		shapeLayer.<span class="hljs-title function_">updateShape</span>(shapeConfig);
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (change.<span class="hljs-property">action</span> === <span class="hljs-string">'delete'</span>) {
		shapeLayer.<span class="hljs-title function_">deleteShape</span>(id);
	}
	<span class="hljs-comment">// 4. é‡æ–°æ¸²æŸ“å›¾å±‚</span>
	<span class="hljs-variable language_">this</span>.<span class="hljs-property">stage</span>.<span class="hljs-title function_">batchDraw</span>();
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30d3a655c6f8441083a80b4be46359f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=6Blm8lrGW9yxdMKB8k5IkTgLVWY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>åŒæ—¶ï¼Œåœ¨ render å‡½æ•°ä¸­ï¼Œè¿˜å¯ä»¥åšä¸€äº›ç»˜åˆ¶ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼šå®ç°å¢é‡æ›´æ–°ï¼ˆè„çŸ©å½¢æ¸²æŸ“ï¼‰ã€è§†å£å‰”é™¤ï¼ˆè§†å£è£å‰ªï¼‰ç­‰ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¤§ç”»å¸ƒåœºæ™¯ä¸‹çš„æ¸²æŸ“å‹åŠ›</p>
<h2 data-id="heading-12">äº‹ä»¶å§”æ‰˜</h2>
<p>æœ¬ä¾‹é‡‡ç”¨æ•°æ®é©±åŠ¨æ›´æ–°ï¼Œå› æ­¤å›¾å½¢å¯èƒ½éšæ—¶åœ¨æ¸²æŸ“æ›´æ–°ï¼Œå¦‚æœå°†äº‹ä»¶ç»‘å®šåˆ°å…·ä½“çš„å›¾å½¢ä¸Šï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦å¤„ç†äº‹ä»¶è§£ç»‘åŠç»‘å®šçš„æ—¶æœºï¼Œå¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤ï¼Œæœ¬ä¾‹å°†äº‹ä»¶ç»Ÿä¸€ç»‘å®šåˆ° stage ä¸Šï¼Œä½¿ç”¨ stage è¿›è¡Œç»Ÿä¸€çš„äº‹ä»¶å¤„ç†ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> stage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">draw</span>.<span class="hljs-title function_">getStage</span>();
stage.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'stage click'</span>, e));
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc61bce6a8094ab1b930c4b7b2f6420d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=%2FYAWe5pB46TlPHFSzxGQ7Go4ykg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>åœ¨äº‹ä»¶æºä¸­ï¼Œ<code>currentTarget</code> å§‹ç»ˆæŒ‡å‘äº‹ä»¶æºç»‘å®šçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å½“å‰çš„  <code>stage</code>ï¼Œè€Œ <code>target</code> åˆ™æŒ‡å‘å½“å‰è§¦å‘äº‹ä»¶çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å½“å‰ç‚¹å‡»<code>click</code>ï¼Œæ˜¯ç‚¹å‡»åˆ°è°ä¸Šé¢ï¼Œ<code>evt</code> æ˜¯åŸç”Ÿäº‹ä»¶æºï¼Œ<code>type</code> æŒ‡å‘å½“å‰äº‹ä»¶çš„ç±»å‹ï¼Œåœ¨å¤šäº‹ä»¶ä¸­ï¼Œéœ€è¦åšåŒºåˆ†ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-13">å›¾å½¢æ“ä½œ</h2>
<h3 data-id="heading-14">æ’å…¥å½¢çŠ¶</h3>
<p>æ’å…¥å›¾å½¢å®ç°åŸç†å°±æ˜¯åœ¨<code>Y.Map</code> ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œé©±åŠ¨è¯•å›¾æ›´æ–°ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">	<span class="hljs-comment">// åˆ›å»ºçŸ©å½¢ - è¿™é‡Œå¾—åˆ°çš„æ˜¯å…³äºè¿™ä¸ªçŸ©å½¢çš„æ‰€æœ‰å¯æ‰§è¡Œé…ç½®</span>
	<span class="hljs-keyword">const</span> rectConfig = shapeCntroller.<span class="hljs-title function_">createShape</span>(<span class="hljs-string">'rect'</span>, {
		<span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
		<span class="hljs-attr">y</span>: <span class="hljs-number">100</span>,
		<span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
		<span class="hljs-attr">height</span>: <span class="hljs-number">100</span>,
		<span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span>,
		<span class="hljs-attr">stroke</span>: <span class="hljs-string">'black'</span>,
		<span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">2</span>,
	});
	
<span class="hljs-keyword">const</span> appData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">collaborateManager</span>.<span class="hljs-title function_">gettAppData</span>();

<span class="hljs-comment">// é€šè¿‡äº‹åŠ¡æ‰§è¡Œï¼Œå°†å›¾å½¢æ·»åŠ åˆ° appData ä¸­</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">collaborateManager</span>.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">() =&gt;</span> {
	appData.<span class="hljs-title function_">set</span>(config.<span class="hljs-property">id</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config)));
});
</code></pre>
<p>ä¸Šé¢æ‰§è¡Œåï¼Œå°±ä¼šå¼•èµ·è§†å›¾æ›´æ–°ï¼Œé€šè¿‡è§†å›¾å»çœŸå®åˆ›å»º <code>Konva.Rect</code>:</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è¿™é‡Œè§£æ group shape text å±æ€§</span>
<span class="hljs-keyword">const</span> { groupConfig, shapeConfig } = config;

<span class="hljs-comment">// åˆ›å»ºçœŸå® group</span>
<span class="hljs-keyword">const</span> groupNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Group</span>({ ...groupConfig, <span class="hljs-attr">draggable</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// åˆ›å»ºçœŸå® shape åç»­éœ€è¦å·¥å‚æ¨¡å¼å®ç°å›¾å½¢åˆ›å»º</span>
<span class="hljs-keyword">const</span> shape = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>({ ...shapeConfig, <span class="hljs-attr">draggable</span>: <span class="hljs-literal">false</span> });

groupNode.<span class="hljs-title function_">add</span>(shape);

<span class="hljs-variable language_">this</span>.<span class="hljs-property">layer</span>.<span class="hljs-title function_">add</span>(groupNode);
</code></pre>
<h3 data-id="heading-15">æ›´æ–°å±æ€§</h3>
<p>æ›´æ–°å›¾å½¢å±æ€§ï¼Œæ— éå°±æ˜¯å°†æ›´æ–°åçš„ config é‡æ–°<code>set</code> åˆ° <code>Map</code> ä¸Šï¼Œå¼•å‘æ›´æ–°ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä¸ç„¶è·å–å½“å‰å›¾å½¢çš„å±æ€§ï¼Œæ‹¼æ¥ä¸º ShapeItem è¿›è¡Œæ›´æ–°</span>
<span class="hljs-keyword">const</span> groupConfig = target.<span class="hljs-title function_">getAttrs</span>();
<span class="hljs-keyword">const</span> id = target.<span class="hljs-title function_">id</span>();
<span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = groupConfig.<span class="hljs-property">type</span>;

<span class="hljs-comment">// è·å–shapeConfig</span>
<span class="hljs-keyword">const</span> shapeConfig = target.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">getAttrs</span>();

<span class="hljs-comment">// è·å–textConfig</span>
<span class="hljs-keyword">const</span> textConfig = target.<span class="hljs-property">children</span>[<span class="hljs-number">1</span>]?.<span class="hljs-title function_">getAttrs</span>();

<span class="hljs-comment">// è§¦å‘æ•°æ®æ›´æ–°</span>
<span class="hljs-keyword">const</span> config = {id, <span class="hljs-keyword">type</span>, groupConfig, shapeConfig, textConfig};

<span class="hljs-comment">// è§¦å‘æ›´æ–°</span>
<span class="hljs-keyword">const</span> appData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">collaborateManager</span>.<span class="hljs-title function_">gettAppData</span>();
<span class="hljs-variable language_">this</span>.<span class="hljs-property">collaborateManager</span>.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">() =&gt;</span> {
	appData.<span class="hljs-title function_">set</span>(config.<span class="hljs-property">id</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config)));
});
</code></pre>
<p>è¯•å›¾æ›´æ–°æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è¿™é‡Œæœ‰å‡ ä¸ªå±æ€§éœ€è¦æ›´æ–°ï¼Œgroup shape text</span>
<span class="hljs-keyword">const</span> { groupConfig, shapeConfig, id } = config;
<span class="hljs-keyword">const</span> groupNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">findOne</span>&lt;<span class="hljs-title class_">Group</span>&gt;(<span class="hljs-string">`#<span class="hljs-subst">${id}</span>`</span>);
<span class="hljs-keyword">if</span> (!groupNode) <span class="hljs-keyword">return</span>;

groupNode.<span class="hljs-title function_">setAttrs</span>(groupConfig);
<span class="hljs-keyword">const</span> shape = groupNode.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];
shape.<span class="hljs-title function_">setAttrs</span>(shapeConfig);
</code></pre>
<h3 data-id="heading-16">åˆ é™¤å›¾å½¢</h3>
<p>åˆ é™¤å›¾å½¢ï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>Map.delete</code> æ–¹æ³•å³å¯</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä¸ç„¶æ‰§è¡Œåˆ é™¤</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">collaborateManager</span>.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">() =&gt;</span> {
	appData.<span class="hljs-title function_">delete</span>(id);
});
</code></pre>
<p>è¯•å›¾æ›´æ–°æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-variable language_">this</span>.<span class="hljs-property">findOne</span>&lt;<span class="hljs-title class_">Group</span>&gt;(<span class="hljs-string">`#<span class="hljs-subst">${id}</span>`</span>)?.<span class="hljs-title function_">destroy</span>();
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1fbf52d0ad44ba899b4f0eadc05ac89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=9axTpVQM9XZzf0GSmuh46D7pYyE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å¤§å®¶å¥½å¥½ç†è§£ä¸€ä¸‹æ¶æ„ï¼Œå°±å¯ä»¥ç†è§£ä¸Šé¢çš„ä»£ç äº†å“ˆ
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b86d01427b64bb490b7d602c4d980db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=pMqXRn%2BLLQDbtVbtDosJOUVrJu4%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-17">å®ç°åŠ¨æ€ç»˜åˆ¶</h3>
<p>æˆ‘ä»¬éœ€è¦åœ¨é¡µé¢ä¸Šå®ç°åŠ¨æ€ç»˜åˆ¶ï¼Œè¿™é‡Œæœ‰å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>ä¸èƒ½åœ¨ <code>mouse-xxx</code> äº‹ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œæ•°æ®æ“ä½œï¼›</li>
<li>éœ€è¦ä¸­ç»§ç”»å¸ƒå®ç°æš‚æ—¶ç»˜åˆ¶</li>
</ol>
<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œæ¯å¯¹ä¸€æ¬¡æ•°æ®æ“ä½œï¼Œéƒ½ä¼šå¼•å‘ <code>Y.Map</code> çš„æ›´æ–°ï¼Œ<strong>åŒæ—¶ï¼Œä¹Ÿä¼šå‘ <code>UndoManager</code> å†å²è®°å½•é‡Œæ’å…¥æ“ä½œè®°å½•</strong>ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ <code>mousemove</code> è¿‡ç¨‹ä¸­ï¼Œé¢‘ç¹æ·»åŠ æ“ä½œè®°å½•ï¼Œé‚£ä¹ˆæ’¤é”€æ—¶ï¼Œå°±ä¼šå¯¼è‡´å¼‚å¸¸ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ æœ€åçš„ <code>mouseup</code> æ’å…¥ä¸€æ¡æ•°æ®å³å¯ã€‚</p>
<p>mousedown ä¸»è¦æ˜¯è®°å½•åˆå§‹ä½ç½®ï¼Œå¹¶å°†å¿…è¦çš„å‚æ•°èµ‹ç»™ stage</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è®°å½•ä¸‹å½“å‰é¼ æ ‡çš„ä½ç½®</span>
<span class="hljs-keyword">const</span> { x, y } = draw.<span class="hljs-title function_">getStage</span>().<span class="hljs-title function_">getPointerPosition</span>()!;

<span class="hljs-keyword">const</span> menuType = <span class="hljs-title function_">useStore</span>().<span class="hljs-title function_">getState</span>(<span class="hljs-string">'activeMenu'</span>);

<span class="hljs-comment">// å‘ stage æ·»åŠ å±æ€§</span>
<span class="hljs-keyword">const</span> stage = draw.<span class="hljs-title function_">getStage</span>();
stage.<span class="hljs-title function_">setAttrs</span>({ <span class="hljs-attr">startX</span>: x, <span class="hljs-attr">startY</span>: y, menuType, <span class="hljs-attr">mousedownFlag</span>: <span class="hljs-literal">true</span>, });
</code></pre>
<p>mousemove å¤„ç†ç§»åŠ¨ä¸­çš„ä½ç½®ä»¥åŠå®é™…çš„ç»˜åˆ¶å‚æ•°</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è·å–å½“å‰é¼ æ ‡çš„ä½ç½®</span>
<span class="hljs-keyword">const</span> { x, y } = stage.<span class="hljs-title function_">getPointerPosition</span>()!;

<span class="hljs-comment">// å‘ toolbarLayer æ·»åŠ å±æ€§ï¼Œå®ç°æš‚æ—¶ç»˜åˆ¶ï¼Œæœ€ç»ˆçš„åˆ¤æ–­åœ¨ mouseup äº‹ä»¶ä¸­å®ç°</span>
<span class="hljs-keyword">const</span> layerController = draw.<span class="hljs-title function_">getLayerController</span>();
<span class="hljs-keyword">const</span> toolbarLayer = layerController.<span class="hljs-title function_">getToolbarLayer</span>();

<span class="hljs-comment">// è®¾ç½®ç»˜åˆ¶å‚æ•°</span>
<span class="hljs-keyword">const</span> { menuType, startX = <span class="hljs-number">0</span>, startY = <span class="hljs-number">0</span> } = stage.<span class="hljs-title function_">getAttrs</span>();

toolbarLayer.<span class="hljs-title function_">setDrawParams</span>({
	menuType,
	startX,
	startY,
	<span class="hljs-attr">endX</span>: x,
	<span class="hljs-attr">endY</span>: y,
});
</code></pre>
<p><strong>toolbarLayer</strong>
é€šè¿‡å·¥å…·ç±»å›¾å±‚ç»˜åˆ¶å±•ç°æ•ˆæœï¼Œæ­¤æ—¶ä¸ä¼šæ‰§è¡Œæ•°æ®æ“ä½œï¼Œä¹Ÿå°±ä¸ä¼šæ·»åŠ è®°å½•</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-variable language_">this</span>.<span class="hljs-property">layer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Layer</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'toolbarLayer'</span>, <span class="hljs-attr">listening</span>: <span class="hljs-literal">false</span> });

<span class="hljs-comment">// é€šè¿‡çŸ©å½¢ç»˜åˆ¶å®ç°</span>
<span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>({
	<span class="hljs-attr">id</span>: <span class="hljs-string">'toolbarRect'</span>,
	<span class="hljs-attr">sceneFunc</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleSceneFunc</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
});

<span class="hljs-comment">// handleSceneFunc å‡½æ•°å†…ï¼Œå°±æ˜¯åŸç”Ÿ canvas æ“ä½œäº†</span>
</code></pre>
<p>mouseup ä¸­ï¼Œå°±æ˜¯æ ¹æ®å®é™…çš„ç»˜åˆ¶å‚æ•°ï¼Œè¿›è¡Œæ“ä½œä»£ç†ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">	<span class="hljs-comment">// ä¸ç„¶æ ¹æ® menuType è°ƒç”¨æ“ä½œä»£ç†ï¼Œè·å–çœŸå®çš„å›¾å½¢é…ç½®ï¼Œæ·»åŠ åˆ° Y.Map ä¸Š</span>
	<span class="hljs-keyword">const</span> operationProxy = draw.<span class="hljs-title function_">getOperationProxy</span>();

	<span class="hljs-keyword">let</span> <span class="hljs-attr">shapeConfig</span>: <span class="hljs-title class_">ShapeItem</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

	<span class="hljs-keyword">switch</span> (menuType) {
		<span class="hljs-keyword">case</span> <span class="hljs-string">'rect'</span>:
			shapeConfig = operationProxy.<span class="hljs-title function_">createShape</span>(<span class="hljs-string">'rect'</span>, {
				<span class="hljs-attr">x</span>: startX,
				<span class="hljs-attr">y</span>: startY,
				width,
				height,
			});
			<span class="hljs-keyword">break</span>;
	}

	<span class="hljs-keyword">if</span> (shapeConfig) operationProxy.<span class="hljs-title function_">addShape</span>(shapeConfig);
</code></pre>
<p>è¿™æ ·ï¼Œå°±èƒ½å®ç°åœ¨ <code>mouseup</code> äº‹ä»¶ä¸­ï¼Œæ‰§è¡Œä¸€æ¬¡æ•°æ®æ“ä½œï¼Œåªä¼šç”Ÿæˆä¸€æ¬¡å†å²è®°å½•ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62114f11eba448d4a47dc3ba5f119a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041272&amp;x-signature=xLA6LjLuWEx4FT4UkxMD8bIJcpU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h2 data-id="heading-18">æ€»ç»“</h2>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åŸºäº Konva å’Œ Yjs çš„ååŒç™½æ¿åº”ç”¨çš„æ•´ä½“æ¶æ„è®¾è®¡ä¸æ ¸å¿ƒå®ç°ã€‚é€šè¿‡æ•°æ®é©±åŠ¨çš„æ–¹å¼ï¼Œå°†ç”¨æˆ·æ“ä½œæŠ½è±¡ä¸ºå¯¹ Y.Map çš„æ•°æ®æ“ä½œï¼Œå®ç°äº†å¤šäººå®æ—¶ååŒçš„å›¾å½¢ç¼–è¾‘åŠŸèƒ½ã€‚å…³é”®è®¾è®¡åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p><strong>åˆ†å±‚æ¶æ„</strong>ï¼šå°†ååŒå±‚ã€æ“ä½œä»£ç†å±‚å’Œæ¸²æŸ“å±‚åˆ†ç¦»ï¼Œç¡®ä¿æ•°æ®æµæ¸…æ™°å¯æ§</p>
</li>
<li>
<p><strong>æ•°æ®é©±åŠ¨æ¸²æŸ“</strong>ï¼šé€šè¿‡ç›‘å¬ Y.Map å˜åŒ–å®ç°è§†å›¾è‡ªåŠ¨æ›´æ–°</p>
</li>
<li>
<p><strong>äº‹ä»¶å§”æ‰˜æœºåˆ¶</strong>ï¼šåœ¨ Stage çº§åˆ«ç»Ÿä¸€å¤„ç†äº‹ä»¶ï¼Œç®€åŒ–äº‹ä»¶ç®¡ç†</p>
</li>
<li>
<p><strong>åŠ¨æ€ç»˜åˆ¶ä¼˜åŒ–</strong>ï¼šé€šè¿‡ä¸­ç»§ç”»å¸ƒé¿å…é¢‘ç¹æ•°æ®æ“ä½œï¼Œä¿è¯æ’¤é”€é‡åšçš„æ­£ç¡®æ€§</p>
</li>
<li>
<p><strong>å®Œæ•´çš„ååŒç”Ÿæ€</strong>ï¼šé›†æˆç”¨æˆ·æ„ŸçŸ¥ã€æ’¤é”€ç®¡ç†ã€å®æ—¶åŒæ­¥ç­‰ååŒæ ¸å¿ƒåŠŸèƒ½</p>
</li>
</ul>
<p>è¿™ä¸€æ¶æ„ä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€ï¼Œæ—¢ä¿è¯äº†å¤šäººååŒçš„å®æ—¶æ€§ï¼Œåˆæä¾›äº†è‰¯å¥½çš„å¼€å‘ä½“éªŒã€‚</p>
<p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ç™½æ¿çš„é«˜çº§äº¤äº’åŠŸèƒ½å®ç°ï¼š</p>
<p><strong>Konva å›¾å½¢æ§åˆ¶</strong></p>
<ul>
<li>
<p><strong>é€‰ä¸­ä¸å˜æ¢</strong>ï¼šå®ç°å›¾å½¢çš„å•é€‰ã€å¤šé€‰ã€æ—‹è½¬ã€ç¼©æ”¾æ§åˆ¶ç‚¹</p>
</li>
<li>
<p><strong>å¯¹é½å¸é™„</strong>ï¼šæ™ºèƒ½å¯¹é½çº¿å’Œç½‘æ ¼å¸é™„ç³»ç»Ÿ</p>
</li>
<li>
<p><strong>å±‚çº§ç®¡ç†</strong>ï¼šå‰ç½®ã€åç½®ã€ç½®é¡¶ã€ç½®åº•ç­‰å±‚çº§æ“ä½œ</p>
</li>
</ul>
<p><strong>åˆ†ç»„ä¸ç»„åˆ</strong></p>
<ul>
<li>
<p><strong>å›¾å½¢åˆ†ç»„</strong>ï¼šå¤šé€‰å›¾å½¢åˆ›å»ºåˆ†ç»„ï¼Œæ”¯æŒåµŒå¥—åˆ†ç»„</p>
</li>
<li>
<p><strong>ç»„åˆè§£ç»„</strong>ï¼šä¸´æ—¶ç»„åˆä¸æ°¸ä¹…ç»„åˆçš„å®ç°ç­–ç•¥</p>
</li>
<li>
<p><strong>ç»„å†…ç¼–è¾‘</strong>ï¼šåœ¨ç»„å†…ç›´æ¥ç¼–è¾‘å•ä¸ªå›¾å½¢çš„èƒ½åŠ›</p>
</li>
</ul>
<p><strong>é«˜çº§è§†è§‰æ•ˆæœ</strong></p>
<ul>
<li>
<p><strong>æ»¤é•œç³»ç»Ÿ</strong>ï¼šæ¨¡ç³Šã€é˜´å½±ã€é¢œè‰²è°ƒæ•´ç­‰å®æ—¶æ»¤é•œ</p>
</li>
<li>
<p><strong>æ¸å˜å¡«å……</strong>ï¼šçº¿æ€§æ¸å˜ã€å¾„å‘æ¸å˜çš„åŠ¨æ€é…ç½®</p>
</li>
<li>
<p><strong>çº¹ç†å›¾æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰å›¾æ¡ˆå¡«å……å’ŒèƒŒæ™¯çº¹ç†</p>
</li>
</ul>
<p><strong>æ•°æ®å¯è§†åŒ–å¢å¼º</strong></p>
<ul>
<li>
<p><strong>å›¾è¡¨é›†æˆ</strong>ï¼šé›†æˆ VCharts ç­‰å›¾è¡¨åº“å®ç°æ•°æ®å›¾è¡¨</p>
</li>
<li>
<p><strong>æ‰‹ç»˜é£æ ¼</strong>ï¼šæ¨¡æ‹Ÿæ‰‹ç»˜æ•ˆæœçš„ç¬”åˆ·å’Œå›¾å½¢æ¸²æŸ“</p>
</li>
<li>
<p><strong>Latex å…¬å¼</strong>ï¼š æ”¯æŒåŠ¨æ€å…¬å¼ç¼–è¾‘</p>
</li>
</ul>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li>
<p><strong>è§†å£è£å‰ª</strong>ï¼šå¤§ç”»å¸ƒä¸‹çš„æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</p>
</li>
<li>
<p><strong>å¢é‡æ›´æ–°</strong>ï¼šè„çŸ©å½¢æ¸²æŸ“å‡å°‘é‡ç»˜åŒºåŸŸ</p>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong>ï¼šå›¾å½¢ç¼“å­˜å’Œåƒåœ¾å›æ”¶ç­–ç•¥</p>
</li>
</ul>
<p>é€šè¿‡è¿™äº›åŠŸèƒ½çš„å®ç°ï¼Œç™½æ¿å°†ä»ä¸€ä¸ªç®€å•çš„ç»˜å›¾å·¥å…·å‡çº§ä¸ºåŠŸèƒ½ä¸°å¯Œçš„ååŒåˆ›ä½œå¹³å°ï¼Œæ»¡è¶³æ•™è‚²ã€è®¾è®¡ã€ä¼šè®®ç­‰å¤šæ ·åŒ–åœºæ™¯çš„éœ€æ±‚ã€‚</p>
<p>æœŸå¾…ä¸æ‚¨åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ç»§ç»­æ¢ç´¢ç™½æ¿å¼€å‘çš„ç²¾å½©ä¸–ç•Œï¼ ğŸ¨âœ¨</p>
<p>ä¹Ÿ <code>æ¬¢è¿æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œä¸€èµ·åŠ å…¥ç™½æ¿çš„å¼€å‘</code>ï¼Œç›®å‰æ­£åœ¨ç¨³æ­¥æ¨è¿›ï¼Œæ¬¢è¿åŠ å…¥å“¦~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¨æµç¨‹å®æ“æ•™ç¨‹ï¼š2å°æ—¶æ„å»ºRAGæ–‡æ¡£æ™ºèƒ½é—®ç­”ç³»ç»Ÿï½œåŸºäºDify]]></title>    <link>https://juejin.cn/post/7573597479981613092</link>    <guid>https://juejin.cn/post/7573597479981613092</guid>    <pubDate>2025-11-18T03:39:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573597479981613092" data-draft-id="7573776814927413267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¨æµç¨‹å®æ“æ•™ç¨‹ï¼š2å°æ—¶æ„å»ºRAGæ–‡æ¡£æ™ºèƒ½é—®ç­”ç³»ç»Ÿï½œåŸºäºDify"/> <meta itemprop="keywords" content="LLM,ç¨‹åºå‘˜,Agent"/> <meta itemprop="datePublished" content="2025-11-18T03:39:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¨æµç¨‹å®æ“æ•™ç¨‹ï¼š2å°æ—¶æ„å»ºRAGæ–‡æ¡£æ™ºèƒ½é—®ç­”ç³»ç»Ÿï½œåŸºäºDify
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:39:07.000Z" title="Tue Nov 18 2025 03:39:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªä¿¡æ¯æ³›æ»¥çš„æ—¶ä»£ï¼ŒçŸ¥è¯†å¹¶ä¸ç¨€ç¼ºï¼Œç¨€ç¼ºçš„æ˜¯èƒ½çœŸæ­£ç”¨èµ·æ¥çš„çŸ¥è¯†ã€‚</p>
<p>ä»ä¼ä¸šSOPï¼Œåˆ°æ”¿ç­–æ–‡ä»¶ï¼›ä»åŒ»ç–—æŒ‡å—ï¼Œåˆ°æŠ€æœ¯è§„ç¨‹ï¼›ä»åŸ¹è®­æ‰‹å†Œï¼Œåˆ°åº”æ€¥é¢„æ¡ˆ......æ— æ•°å†…å®¹æ•´æ•´é½é½åœ°å †åœ¨ç¡¬ç›˜é‡Œï¼Œå½¢å¼ä¸Šâ€œæ•°å­—åŒ–â€ï¼Œå®è´¨ä¸Šä»éš¾ä»¥è°ƒç”¨ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8da5c542854784946eb041e948dd02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041946&amp;x-signature=oAYqyswsEfQo1%2FlLe7FzqKN%2FAd0%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬ä¸€æ¬¡åˆä¸€æ¬¡åœ°åœ¨Wordã€PDFã€Excelä¸­ç¿»æ‰¾ï¼Œåªä¸ºé‚£ä¸€å¥å…³é”®çš„å†…å®¹ã€‚</p>
<p>å¤§æ¨¡å‹è™½ç„¶å¼ºå¤§ï¼Œå´éš¾ä»¥è·çŸ¥ä½ å•ä½çš„å†…æ§åˆ¶åº¦ã€ä½ éƒ¨é—¨çš„è§„ç« ç»†åˆ™ï¼Œæ›´åˆ«ææœ€æ–°çš„åˆ¶åº¦æ›´æ–°æˆ–åœ°åŒºç‰¹æœ‰çš„ä¸“ä¸šæœ¯è¯­ã€‚</p>
<blockquote>
<p>å¦‚æœAIçœŸçš„è¦ç”¨èµ·æ¥ï¼Œå®ƒå°±å¿…é¡»â€œçŸ¥é“ä½ çŸ¥é“çš„â€â€”â€”è¿™æ˜¯æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯è¯ç”Ÿçš„çœŸæ­£æ„ä¹‰ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ğŸ’»RAGï¼š</h2>
<h2 data-id="heading-1">è®©å¤§æ¨¡å‹è¯´â€œäººè¯â€ï¼Œä¹Ÿæ‡‚â€œä½ çš„è¯â€</h2>
<p>æ‰€è°“ RAG( Retrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³å…¶å®å¾ˆç®€å•ï¼šä¸æ˜¯é å¤§æ¨¡å‹è‡ªå·±â€œç¼–â€ç­”æ¡ˆï¼Œè€Œæ˜¯è®©å®ƒå…ˆå»ä½ çš„çŸ¥è¯†åº“é‡Œâ€œç¿»èµ„æ–™â€ï¼Œå†å¸¦ç€ä¸Šä¸‹æ–‡ç”Ÿæˆå›ç­”ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e423175334b42898dcfe9f9e21b16ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041946&amp;x-signature=nVJ0CopZPZ9GcEJCkpsDzgnbbx0%3D" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡æ¥æºï¼šã€ŠRAGå®æˆ˜è¯¾ã€‹ä½œè€…é»„ä½³è€å¸ˆ</p>
<p>ä¸ä¼ ç»Ÿçš„è¯­ä¹‰æœç´¢ç›¸æ¯”ï¼Œ<strong>RAG ä¿è¯äº†ç­”æ¡ˆä¸ç°æœ‰èµ„æ–™çš„ä¸€è‡´æ€§ä¸å¯è¿½æº¯æ€§</strong>ï¼Œä¹Ÿä½¿å¾—é—®ç­”ç³»ç»Ÿå…·å¤‡æ›´å¼ºçš„ç¨³å®šæ€§ä¸è§£é‡Šèƒ½åŠ›ã€‚æœ¬æ–‡å°†ç»“åˆå’Œé²¸ç¤¾åŒºæ¨å‡ºçš„æ­å»ºåº”æ€¥é¢„æ¡ˆRAGæ™ºèƒ½é—®ç­”åŠ©æ‰‹è®­ç»ƒè¥ï¼Œä»‹ç»å¦‚ä½•é€šè¿‡ RAG æŠ€æœ¯å’Œå·¥ä½œæµå·¥å…·ï¼ŒæŠŠæœ¬åœ°æ–‡æ¡£è½¬åŒ–ä¸ºä¸€ä¸ªå…·å¤‡é—®ç­”èƒ½åŠ›çš„ç³»ç»Ÿã€‚</p>
<blockquote>
<p>ğŸ§‘â€ğŸ’¼è®­ç»ƒè¥å¯¼å¸ˆ ï¼šElio</p>
<p>ç®—æ³•å·¥ç¨‹å¸ˆï¼Œè®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šèƒŒæ™¯ï¼Œå‚ä¸å‘è¡¨SCIä¸¤ç¯‡ã€å‚ä¸9ä¸ªå›½å®¶/çœéƒ¨çº§æƒå¨æœºæ„åˆä½œé¡¹ç›®ä½œä¸ºç®—æ³•ä¸»è¦è´Ÿè´£äººã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaa78bb367154b57b9b7a926bdd8fb63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041946&amp;x-signature=Zq40LUwBqYEcqvWqgs7WtF3mdhA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">ğŸ“šåº”æ€¥é¢„æ¡ˆï¼š</h2>
<h2 data-id="heading-3">ç»“æ„åŒ–çŸ¥è¯†çš„å…¸å‹æ¡ˆä¾‹</h2>
<p>åœ¨æœ¬æ¬¡è®­ç»ƒè¥ä¸­ï¼Œé€‰å–çš„è½åœ°æ¡ˆä¾‹æ˜¯â€œæ°”è±¡ç¾å®³åº”æ€¥é¢„æ¡ˆâ€â€œåœ°éœ‡ç¾å®³åº”æ€¥é¢„æ¡ˆâ€ç­‰å®˜æ–¹æ–‡æ¡£ã€‚åŸå› åœ¨äºï¼Œè¿™ç±»æ–‡æ¡£å…·å¤‡å¦‚ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>å†…å®¹ç»“æ„æ˜ç¡®ï¼šåŒ…å«å¯åŠ¨æ¡ä»¶ã€å“åº”çº§åˆ«ã€èŒè´£åˆ†å·¥ç­‰å›ºå®šç« èŠ‚ï¼›</li>
<li>ä¿¡æ¯æ—¶æ•ˆæ€§å¼ºï¼šä¸åŒå¹´ä»½ã€ä¸åŒåœ°åŒºçš„é¢„æ¡ˆå†…å®¹ä¸å°½ç›¸åŒï¼›</li>
<li>æ£€ç´¢ä»·å€¼é«˜ï¼šåœ¨å®é™…åœºæ™¯ä¸­å¾€å¾€éœ€è¦å¿«é€Ÿå®šä½å…³é”®ä¿¡æ¯ï¼ˆå¦‚â€œä»€ä¹ˆæƒ…å†µä¸‹å¯åŠ¨ä¸€çº§å“åº”â€ï¼‰ã€‚</li>
</ul>
<p>æ­£é€‚åˆä½œä¸ºæ„å»ºçŸ¥è¯†åº“ä¸é—®ç­”ç³»ç»Ÿçš„ç´ æã€‚é€šè¿‡æœ¬æœŸè®­ç»ƒè¥ï¼Œä½ å°†äº²èº«å®Œæˆä»æ–‡æ¡£ä¸Šä¼ åˆ°çŸ¥è¯†æ‹†è§£ï¼Œä»å†…å®¹ç´¢å¼•åˆ°è¯­ä¹‰æ£€ç´¢ï¼Œä»æ¨¡å‹é…ç½®åˆ°å·¥ä½œæµå‘å¸ƒçš„å…¨è¿‡ç¨‹ï¼Œè¿™ç§èƒ½åŠ›ï¼Œä¸€æ—¦æŒæ¡ï¼Œå°±å¯ä»¥åœ¨æœªæ¥çš„æ— æ•°åº”ç”¨åœºæ™¯ä¸­åå¤ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-4">ğŸ”§å®æ“è·¯å¾„æ¦‚è§ˆï¼š</h2>
<h2 data-id="heading-5">ä¸¤æ­¥å®Œæˆä»æ–‡æ¡£åˆ°é—®ç­”ç³»ç»Ÿçš„æ„å»º</h2>
<p>è®­ç»ƒè¥å°†æ„å»ºè¿‡ç¨‹æ‹†è§£ä¸ºä¸¤å…³ï¼Œåˆ†åˆ«å¯¹åº”<strong>çŸ¥è¯†åº“å»ºç«‹</strong>ä¸<strong>é—®ç­”ç³»ç»Ÿæ­å»º</strong>ï¼Œå‡ä½¿ç”¨Difyå¹³å°å®Œæˆã€‚</p>
<ol start="0">
<li>
<h3 data-id="heading-6">æ„å»ºçŸ¥è¯†åº“ï¼šä»æ–‡æ¡£æ‹†åˆ†åˆ°å‘é‡æ£€ç´¢</h3>
</li>
</ol>
<p>æ–‡æ¡£ä¸Šä¼ åï¼Œé¦–è¦ä»»åŠ¡æ˜¯â€œåˆ‡åˆ†â€ä¸â€œå»ºç´¢å¼•â€ã€‚</p>
<ul>
<li><strong>åˆ†æ®µç­–ç•¥é€‰æ‹©</strong>ï¼šä»‹ç»é€šç”¨æ¨¡å¼ã€çˆ¶å­æ¨¡å¼å„è‡ªçš„ä¼˜åŠ¿ï¼Œä»¥åŠä¸åŒæ¨¡å¼é€‚åˆçš„æ–‡æ¡£ç±»å‹ã€‚</li>
<li><strong>Embeddingæ¨¡å‹</strong>ï¼šé€‰æ‹©ä½¿ç”¨Embeddingæ¨¡å‹ï¼Œå°†æ–‡å­—è½¬ä¸ºå¯è¢«LLMç†è§£çš„å‘é‡ã€‚</li>
<li><strong>æ£€ç´¢ç­–ç•¥è®¾ç½®</strong>ï¼šä»‹ç»å‘é‡æ£€ç´¢ã€å…¨æ–‡æ£€ç´¢ã€æ··åˆæ£€ç´¢ä¸‰ç§æ£€ç´¢æ–¹å¼çš„ä¼˜ç‚¹ä»¥åŠé€‚ç”¨åœºæ™¯ï¼Œå¹¶æ¨èæƒé‡è®¾ç½®ï¼Œä»¥æ›´å¥½å…¼é¡¾ç†è§£èƒ½åŠ›ä¸æœ¯è¯­è¯†åˆ«ã€‚</li>
</ul>
<p>è¿™ä¸€é˜¶æ®µçš„ç›®æ ‡ï¼Œæ˜¯å°†æ–‡æ¡£å˜æˆæ¨¡å‹å¯ä»¥ç†è§£ã€å®šä½ã€å¼•ç”¨çš„â€œç»“æ„åŒ–è¯­ä¹‰ç´ æâ€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40d1067db71f488095ebcddcf0331a32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041946&amp;x-signature=lIZQkR5aDDymp5R4IhoHA5qEMsQ%3D" alt="" loading="lazy"/></p>
<p>&lt;æ•™æ¡ˆæˆªå›¾&gt;</p>
<h3 data-id="heading-7">2.æ„å»ºé—®ç­”ç³»ç»Ÿï¼šé€šè¿‡å·¥ä½œæµæ¨¡å—å®Œæˆè°ƒç”¨é€»è¾‘</h3>
<p>å®ŒæˆçŸ¥è¯†åº“å»ºè®¾åï¼Œå¯åœ¨Difyä¸­æ„å»ºâ€œChatFlowâ€åº”ç”¨ï¼Œå®ç°<strong>ç”¨æˆ·æé—® â†’ çŸ¥è¯†æ£€ç´¢ â†’ LLMå›ç­”</strong>çš„å®Œæ•´æµç¨‹ã€‚æ ¸å¿ƒæ¨¡å—åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ­å»ºå·¥ä½œæµæ¨¡å—æ¡†æ¶ï¼šæ’å…¥çŸ¥è¯†æ£€ç´¢æµç¨‹ï¼Œè°ƒç”¨ä¹‹å‰è®¾ç½®å¥½çš„çŸ¥è¯†åº“ï¼Œå¹¶è®¾ç½®çŸ¥è¯†æ£€ç´¢ï¼›</li>
<li><strong>å¤§æ¨¡å‹è°ƒç”¨è®¾ç½®</strong>ï¼šé€‰æ‹©ä½¿ç”¨æ¨¡å‹ï¼ˆå¦‚gpt-4o-miniï¼‰ï¼Œå¹¶é…ç½®ä¸Šä¸‹æ–‡æ¥æºï¼›</li>
<li><strong>Promptè®¾è®¡</strong>ï¼šé€šè¿‡Systemè§„èŒƒå¤§æ¨¡å‹çš„å›ç­”å†…å®¹ã€æ ¼å¼ä¸è¦æ±‚ï¼›</li>
<li><strong>è°ƒè¯•ä¸æµ‹è¯•</strong>ï¼šåœ¨æ§åˆ¶å°ä¸­é¢„è§ˆæ¯ä¸€æ¨¡å—è¾“å…¥è¾“å‡ºï¼Œæµ‹è¯•å¬å›å‡†ç¡®æ€§ä¸ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…å†µã€‚</li>
</ul>
<p>ä¸€æ—¦æµç¨‹é€šè¿‡æµ‹è¯•ï¼Œå³å¯å‘å¸ƒä¸ºå†…éƒ¨ä½¿ç”¨çš„é—®ç­”ç³»ç»Ÿã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc94f06fd6cb40ed8812e67d6f67c86b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764041946&amp;x-signature=mUlwUGnbpwWpJgCG2K8wXflENgk%3D" alt="" loading="lazy"/></p>
<p>&lt;æ•™æ¡ˆæˆªå›¾&gt;</p>
<h2 data-id="heading-8">ğŸ”å¯è¿ç§»æ€§ä¸æ¨å¹¿ä»·å€¼</h2>
<p>è™½ç„¶æ¡ˆä¾‹é€‰å–äº†åº”æ€¥é¢„æ¡ˆï¼Œä½†æ•´ä¸ªæŠ€æœ¯æµç¨‹å…·æœ‰é«˜åº¦é€šç”¨æ€§ï¼Œé€‚ç”¨äºåœºæ™¯åŒ…æ‹¬ä¸”ä¸é™äºï¼š</p>
<ul>
<li><strong>æ”¿åŠ¡ç³»ç»Ÿ</strong>ï¼šæ”¿ç­–æ³•è§„ã€å®¡æ‰¹æµç¨‹ç­‰è§„èŒƒæ€§æ–‡æ¡£çš„è‡ªåŠ©é—®ç­”ï¼›</li>
<li><strong>ä¼ä¸šç®¡ç†</strong>ï¼šHR æ‰‹å†Œã€æ“ä½œè§„èŒƒã€é”€å”®åˆ¶åº¦çš„å†…éƒ¨çŸ¥è¯†å¹³å°ï¼›</li>
<li><strong>åŒ»ç–—è¡Œä¸š</strong>ï¼šè¯Šç–—æŒ‡å—ã€ç–¾ç—…åº“ç­‰èµ„æ–™çš„è¯­ä¹‰è®¿é—®ï¼›</li>
<li><strong>æ•™è‚²åŸ¹è®­</strong>ï¼šæ•™å­¦è®²ä¹‰ã€è¯¾ç¨‹èµ„æ–™çš„æ™ºèƒ½ç­”ç–‘ï¼›</li>
<li><strong>å·¥ä¸šé¢†åŸŸ</strong>ï¼šæ“ä½œè§„ç¨‹ã€å®‰å…¨æ‰‹å†Œçš„è¯­å¢ƒé—®ç­”è¾…åŠ©ã€‚</li>
</ul>
<p>å¯¹äºå…·å¤‡è¾ƒå¤šç»“æ„åŒ–æ–‡æ¡£ã€ä½†äººå·¥æŸ¥é˜…æ•ˆç‡ä½ä¸‹çš„ç»„ç»‡æ¥è¯´ï¼ŒRAG ä¸å·¥ä½œæµç³»ç»Ÿçš„ç»“åˆï¼Œä¸ä»…æ˜¯æŠ€æœ¯æ–¹æ¡ˆï¼Œæ›´æ˜¯ä¸€ç§çŸ¥è¯†æ²»ç†æ–¹å¼çš„æ›´æ–°ã€‚</p>
<h2 data-id="heading-9">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ä¸ªè¶…çº§çœŸå®çš„Three.jsæ ‘ğŸŒ²ç”Ÿæˆå™¨æ’ä»¶]]></title>    <link>https://juejin.cn/post/7573588675638099983</link>    <guid>https://juejin.cn/post/7573588675638099983</guid>    <pubDate>2025-11-18T03:54:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675638099983" data-draft-id="7573588675637641231" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ä¸ªè¶…çº§çœŸå®çš„Three.jsæ ‘ğŸŒ²ç”Ÿæˆå™¨æ’ä»¶"/> <meta itemprop="keywords" content="three.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-18T03:54:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç­”æ¡ˆanswer"/> <meta itemprop="url" content="https://juejin.cn/user/2634865719391869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ä¸ªè¶…çº§çœŸå®çš„Three.jsæ ‘ğŸŒ²ç”Ÿæˆå™¨æ’ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634865719391869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç­”æ¡ˆanswer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:54:14.000Z" title="Tue Nov 18 2025 03:54:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åˆ†äº«ä¸€ä¸ªåŸºäºThree.jså°è£…çš„æ ‘ç”Ÿæˆå™¨æ’ä»¶ï¼Œå¯ä»¥å®ç°åˆ›å»ºä¸åŒç±»å‹ä¸”æ¸²æŸ“æ•ˆæœçœŸå®çš„3Dæ ‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a739c9d99f34af9b9a7b74a14737f60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042854&amp;x-signature=iqNirUDW51hzE1%2BPTqF%2FpL7l0Jk%3D" alt="11111111111111111111111.gif" loading="lazy"/></p>
<p>è¯´å®è¯ï¼Œç¬¬ä¸€æ¬¡åœ¨è¿™ä¸ª<em>æ’ä»¶å®˜ç½‘</em>çœ‹åˆ°è¿™ä¸ªæ•ˆæœæ—¶æˆ‘ä¸€åº¦ä»¥ä¸ºè¿™åªæ˜¯ä¸€ä¸ª<em>è§†é¢‘</em>ï¼Œæ ‘çš„å†…å®¹ä¸ä»…ä»…æ˜¯åŠ¨æ€çš„è€Œä¸”æ•´ä½“çš„æ¸²æŸ“æ•ˆæœä¹Ÿååˆ†çœŸå®ã€‚</p>
<p>åœ¨three.jsä¸­ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯éå¸¸çš„ç®€å•çš„ä»…ä»…éœ€<em>å‡ è¡Œä»£ç </em>å°±å¯ä»¥æå®šï¼Œä¸‹é¢ç»™å¤§å®¶ç®€å•çš„ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h3 data-id="heading-1">å®‰è£…</h3>
<p>é€šè¿‡ npm/pnpm å®‰è£…åˆ°é¡¹ç›®æœ¬åœ°å³å¯</p>
<pre><code class="hljs language-js" lang="js">npm i @dgreenheck/ez-tree

pnpm add @dgreenheck/ez-tree

</code></pre>
<h3 data-id="heading-2">ä½¿ç”¨</h3>
<p>ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€è¦å°†æ’ä»¶import å¼•å…¥ç„¶ååœ¨ new å®ä¾‹åŒ–å‡ºæ¥ åœ¨æ·»åŠ åˆ° åœºæ™¯ä¸­å°±å¯ä»¥äº†</p>
<p>æœ€ååœ¨ä¸€ä¸ªrequestAnimationFrame åŠ¨ç”»å‡½æ•°ä¸­æ›´æ–°<strong>æ ‘</strong>çš„å†…å®¹å°±è¡Œäº†</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Tree</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@dgreenheck/ez-tree'</span>;

<span class="hljs-title function_">createTree</span>(<span class="hljs-params"/>){

      <span class="hljs-keyword">const</span> tree = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tree</span>();
      tree.<span class="hljs-title function_">generate</span>();
      <span class="hljs-comment">// è®¾ç½®ä¸€ä¸‹ä½ç½®</span>
      tree.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
      <span class="hljs-comment">// è®¾ç½®ä¸€ä¸‹å¤§å°ç¼©æ”¾</span>
      tree.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-comment">// æ·»åŠ åˆ°åœºæ™¯ä¸­</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>.<span class="hljs-title function_">add</span>(tree);
      
}

  <span class="hljs-title function_">sceneAnimation</span>(): <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">// ç¡®ä¿åŠ¨ç”»å¾ªç¯æŒç»­è¿›è¡Œ</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderAnimation</span> = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sceneAnimation</span>());

      <span class="hljs-comment">// æ›´æ–°æ—¶é’Ÿ</span>
      <span class="hljs-keyword">const</span> elapsedTime = <span class="hljs-variable language_">this</span>.<span class="hljs-property">clock</span>.<span class="hljs-title function_">getElapsedTime</span>();


      <span class="hljs-comment">// æ›´æ–°æ§åˆ¶å™¨ å¦‚æœå½“å‰æ˜¯ç¬¬ä¸€äººç§°æ§åˆ¶å™¨åˆ™ä¸æ›´æ–°</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">pointerLockControls</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span>.<span class="hljs-title function_">update</span>();
      }

      <span class="hljs-comment">// æ›´æ–° Tree åŠ¨æ€æ•ˆæœï¼ˆé£åŠ¨æ•ˆæœç­‰ï¼‰</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">tree</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tree</span>.<span class="hljs-title function_">update</span>(elapsedTime);
      }
      <span class="hljs-comment">// æ¸²æŸ“åœºæ™¯</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-title function_">render</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>);
  }

</code></pre>
<p>æœ¬åœ°é¡¹ç›®æ•ˆæœ</p>
<p>å› ä¸ºæœ¬åœ°é¡¹ç›®å¯¹å…‰ç…§ç­‰å‚æ•°æ²¡æœ‰ä¸“é—¨è°ƒè¯•æ‰€ä»¥å’Œå®˜ç½‘å±•ç¤ºçš„æ•ˆæœæœ‰ä¸€å®šçš„å·®è·</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6728f9c801d40848718d1824f330bd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042854&amp;x-signature=7PwEs1PJX4A8eRbDCmHMm%2B8AfAE%3D" alt="image.png" loading="lazy"/></p>
<p>å°†ç›¸æœºæ”¾å¤§æŸ¥çœ‹æ ‘æ¸²æŸ“çš„æ•ˆæœç»†èŠ‚å¤„ç†ä¸ªäººè§‰å¾—æ˜¯éå¸¸niceçš„ï¼Œååˆ†çœŸå®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ef8af9abe50456d939aa39ff33b9a4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042854&amp;x-signature=vpMyBZLYK3nCr0kswuAemNKZqAY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">å‚æ•°</h3>
<p>è¯¥æ’ä»¶è¿˜æä¾›äº†åˆ›å»ºä¸åŒç±»å‹æ ‘çš„æ–¹æ³•ï¼Œé€šè¿‡å®˜ç½‘çš„åœ¨çº¿è°ƒè¯•å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†</p>
<p>åˆ›å»ºä¸€ä¸ªåˆ«çš„ç±»å‹æ ‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a0b1cc0b4db4e228d2ad1b34a60097f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042854&amp;x-signature=qJn0cr4YP%2FouH7lNfcZ1tjYdOrY%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿®æ”¹æ ‘æçš„æ–¹å‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1372f4e75c4b420ca42967f689e0ac11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042854&amp;x-signature=brwjizkErZBTjkD7TIMduSHCRcs%3D" alt="image.png" loading="lazy"/></p>
<p>æ ‘å¶çš„å¤šå°‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f3a2d1a0ba647199c8c568c30a88012~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764042854&amp;x-signature=S8RwmA1NpaY0VH1TDP2QsaMq4Zw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">é¡¹ç›®åœ°å€</h3>
<p>è¯¥é¡¹ç›®æ’ä»¶æ˜¯ä¸€ä¸ªå¤–å›½å¤§ä½¬å¼€å‘ï¼Œå¦‚æœä½ çš„é¡¹ç›®æˆ–è€…ä¸ªäººç½‘ç«™éœ€è¦ä¸°å¯Œä¸€ä¸‹é¡µé¢å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’ä»¶æˆ–è®¸æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</p>
<p>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.eztree.dev%2F" target="_blank" title="https://www.eztree.dev/" ref="nofollow noopener noreferrer">www.eztree.dev/</a></p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdgreenheck%2Fez-tree" target="_blank" title="https://github.com/dgreenheck/ez-tree" ref="nofollow noopener noreferrer">github.com/dgreenheck/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS App HTTPS æŠ“åŒ…å®æˆ˜ï¼šä» TLS åˆ†æåˆ°å¤šå·¥å…·ååŒçš„å®Œæ•´è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7573615699958136874</link>    <guid>https://juejin.cn/post/7573615699958136874</guid>    <pubDate>2025-11-18T03:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573615699958136874" data-draft-id="7573615699958120490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS App HTTPS æŠ“åŒ…å®æˆ˜ï¼šä» TLS åˆ†æåˆ°å¤šå·¥å…·ååŒçš„å®Œæ•´è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T03:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOSå¼€å‘ä¸Šæ¶å“¦"/> <meta itemprop="url" content="https://juejin.cn/user/3336394949004844"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS App HTTPS æŠ“åŒ…å®æˆ˜ï¼šä» TLS åˆ†æåˆ°å¤šå·¥å…·ååŒçš„å®Œæ•´è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3336394949004844/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOSå¼€å‘ä¸Šæ¶å“¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:55:17.000Z" title="Tue Nov 18 2025 03:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¾ˆå¤šå¼€å‘è€…åœ¨è°ƒè¯• iOS App æ—¶éƒ½ä¼šé‡åˆ°åŒä¸€ä¸ªéš¾é¢˜ï¼š<strong>HTTPS æŠ“åŒ…ä¸ç¨³å®šï¼ŒæŸäº›è¯·æ±‚èƒ½çœ‹åˆ°ï¼Œéƒ¨åˆ†è¯·æ±‚æŠ“ä¸åˆ°ï¼Œç”šè‡³æ•´æ¡é“¾è·¯ç›´æ¥å¤±è´¥ã€‚</strong>
åŸå› å¯èƒ½æ˜¯è¯ä¹¦æ ¡éªŒã€ä»£ç†é™åˆ¶ã€åè®®ç‰ˆæœ¬ã€ç½‘ç»œç¯å¢ƒã€App å†…éƒ¨å®ç°ç­‰å¤šå±‚å› ç´ é€ æˆçš„ï¼Œå•é  Charles æˆ– Proxyman å¾ˆéš¾è¦†ç›–æ‰€æœ‰æƒ…å†µã€‚</p>
<p>æœ¬æ–‡å›´ç»•â€œ<strong>iOS app https æŠ“åŒ…</strong>â€ä¸»é¢˜ï¼Œä»ç½‘ç»œå·¥ç¨‹è§’åº¦åˆ†æå¸¸è§ç“¶é¢ˆï¼Œå¹¶ç»™å‡ºé€‚ç”¨äºæ‰€æœ‰æŠ“åŒ…åœºæ™¯çš„å·¥å…·é“¾ç»„åˆã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆ iOS App çš„ HTTPS æŠ“åŒ…ç‰¹åˆ«å®¹æ˜“å¤±è´¥ï¼Ÿ</h2>
<p>å¯¹äº iOS Appï¼Œæœ‰å‡ ä¸ªå¸¸è§çš„å½±å“å› ç´ ï¼š</p>
<ul>
<li><strong>åº”ç”¨å¼€å¯è¯ä¹¦ pinning</strong>ï¼ˆæœ€å¸¸è§ï¼‰ â†’ ä»£ç†è¯ä¹¦æ— æ³•è¢«ä¿¡ä»»</li>
<li><strong>ç³»ç»Ÿé™åˆ¶ç¬¬ä¸‰æ–¹è¯ä¹¦ä¿¡ä»»é“¾</strong> â†’ æŠ“åŒ…å·¥å…·æ— æ³•è§£å¯†</li>
<li><strong>HTTP/3 / QUIC èµ° UDP</strong> â†’ Charlesã€Fiddler å®Œå…¨æŠ“ä¸åˆ°</li>
<li><strong>App å†…è‡ªå®šä¹‰ç½‘ç»œå±‚</strong> â†’ ç»•è¿‡ç³»ç»Ÿä»£ç†</li>
<li><strong>å¤šåŸŸå / å¤š App åŒæ—¶å‘åŒ…</strong> â†’ æŠ“åŒ…å™ªéŸ³ä¸¥é‡</li>
<li><strong>ç½‘ç»œä¸­é—´é“¾è·¯æ›¿æ¢è¯ä¹¦</strong> â†’ TLS æ¡æ‰‹å¤±è´¥</li>
</ul>
<p>å› æ­¤ï¼Œæƒ³ç¨³å®šæŠ“ HTTPSï¼Œä¸ä»…éœ€è¦ä»£ç†ï¼Œè¿˜éœ€è¦èƒ½ç›´æ¥è§‚å¯Ÿ TCP/TLSã€è¿‡æ»¤åº”ç”¨æµé‡ã€å¯¼å‡º pcap çš„å·¥å…·æ¥ç»„åˆåˆ†æã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€iOS HTTPS æŠ“åŒ…å·¥å…·åˆ†å±‚ï¼ˆå„å¸å…¶èŒï¼‰</h2>
<h3 data-id="heading-2"><strong>ä»£ç†ç±»å·¥å…·ï¼ˆæŸ¥çœ‹æ˜æ–‡ï¼‰</strong></h3>
<p>é€‚ç”¨åœºæ™¯ï¼šå¼€å‘è°ƒè¯•ã€å¿«é€ŸéªŒè¯æ¥å£
å·¥å…·åŒ…æ‹¬ï¼š</p>
<ul>
<li>Charles</li>
<li>Proxyman</li>
<li>Fiddler</li>
<li>mitmproxy</li>
</ul>
<p>ä¼˜ç‚¹ï¼šèƒ½æŸ¥çœ‹æ˜æ–‡ã€æ”¯æŒæ–­ç‚¹ã€æ˜“ç”¨
é™åˆ¶ï¼špinning / QUIC æ—¶å¤±æ•ˆ</p>
<hr/>
<h3 data-id="heading-3"><strong>åº•å±‚æŠ“åŒ…å·¥å…·ï¼ˆç½‘ç»œè¯æ®ï¼‰</strong></h3>
<p>ç”¨äºåˆ†æï¼š</p>
<ul>
<li>TCP ä¸‰æ¬¡æ¡æ‰‹</li>
<li>TLS æ¡æ‰‹æµç¨‹</li>
<li>ä¸¢åŒ… / é‡ä¼ </li>
<li>æ˜¯å¦æŠµè¾¾æœåŠ¡å™¨</li>
</ul>
<p>å·¥å…·ï¼š</p>
<ul>
<li>tcpdump</li>
<li>Wireshark</li>
</ul>
<p>è¿™äº›å·¥å…·å¯¹å®šä½â€œè¯·æ±‚æ²¡åˆ°åå°â€â€œTLS æ¡æ‰‹å¤±è´¥â€ç­‰é—®é¢˜éå¸¸å…³é”®ã€‚</p>
<hr/>
<h3 data-id="heading-4"><strong>è‡ªåŠ¨åŒ–/è„šæœ¬å·¥å…·ï¼ˆæ‰¹é‡åˆ†æï¼‰</strong></h3>
<p>mitmproxy è„šæœ¬ã€pysharkã€scapy
é€‚åˆè‡ªåŠ¨åŒ–æ£€æµ‹æˆ– CI æµ‹è¯•åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-5"><strong>è¡¥æŠ“å·¥å…·ï¼ˆä»£ç†å¤±è´¥ã€pinningã€æ··åˆåè®®åœºæ™¯ï¼‰</strong></h3>
<p>æŠ“åŒ…å¤§å¸ˆï¼ˆSniffmasterï¼‰åœ¨ HTTPS åœºæ™¯ä¸‹è¡¥é½ä»£ç†å·¥å…·çš„é™åˆ¶ï¼š</p>
<ul>
<li>æ— éœ€ç³»ç»Ÿä»£ç†ï¼Œä¹Ÿæ— éœ€å®‰è£…è¯ä¹¦å³å¯æŠ“åˆ° TCP/TLS æµé‡</li>
<li>æ”¯æŒ <strong>æŒ‰ App / åŸŸåè¿‡æ»¤</strong>ï¼Œå‡å°‘å™ªéŸ³</li>
<li>å¯è¯†åˆ« HTTPS / HTTP / mdns / è‡ªå®šä¹‰åè®®</li>
<li>å¯æŸ¥çœ‹åŸå§‹ TCP æ•°æ®æµï¼ˆHEX/äºŒè¿›åˆ¶/æ–‡æœ¬ï¼‰</li>
<li>æ”¯æŒ <strong>å¯¼å‡º Wireshark å…¼å®¹ pcap</strong>ï¼Œç”¨äºæ·±åº¦åˆ†æ</li>
<li>å†…ç½® <strong>æ‹¦æˆªå™¨ + JavaScript ç¼–è¾‘</strong> å¯ä»¥ä¿®æ”¹è¯·æ±‚ä¸å“åº”</li>
</ul>
<p>å®ƒçš„ä½œç”¨ä¸æ˜¯å–ä»£ Charlesï¼Œè€Œæ˜¯åœ¨ Charles å¤±è´¥æ—¶ç”¨äºè¡¥æŠ“åº•å±‚æµé‡ã€æ¯”å¯¹ TLS æ¡æ‰‹å’Œå¯¼å‡ºè¯æ®ã€‚</p>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€iOS App HTTPS æŠ“åŒ…çš„æ ‡å‡†æ’æŸ¥æµç¨‹</h2>
<p>ä»¥ä¸‹æµç¨‹å¯ä»¥ç›´æ¥ä½œä¸ºå›¢é˜ŸæŠ“åŒ…è„šæœ¬ï¼š</p>
<hr/>
<h3 data-id="heading-7"><strong>ç”¨ä»£ç†å·¥å…·è¿›è¡Œåˆæ­¥æŠ“åŒ…</strong></h3>
<ul>
<li>å®‰è£…ä»£ç†æ ¹è¯ä¹¦</li>
<li>åœ¨ Wi-Fi è®¾ç½®ä¸­å¡«å…¥ä»£ç†</li>
<li>æµ‹è¯•æ˜¯å¦å¯ä»¥æŠ“åˆ° HTTPS</li>
</ul>
<p>è‹¥åªæœ‰éƒ¨åˆ†æ¥å£æŠ“å¾—åˆ° â†’ å¯èƒ½æ˜¯ pinning æˆ–ç‰¹å®šåŸŸåé™åˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-8"><strong>åœ¨æœåŠ¡å™¨ç«¯æŠ“å– pcapï¼ˆç¡®è®¤è¯·æ±‚æ˜¯å¦åˆ°è¾¾ï¼‰</strong></h3>
<p>å¦‚æœæ€€ç–‘ HTTPS é“¾è·¯å¤±è´¥ï¼Œç”¨ tcpdump è§‚å¯ŸæœåŠ¡å™¨ä¾§æµé‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo tcpdump -i any host &lt;client_ip&gt; and port 443 -s 0 -w server.pcap
</code></pre>
<p>è‹¥è¿ ClientHello éƒ½æ²¡æœ‰ â†’
è¯´æ˜ App å¹¶æœªå‘é€è¯·æ±‚ï¼Œæˆ–è¢«ä¸­é—´é“¾è·¯é˜»æ–­ã€‚</p>
<hr/>
<h3 data-id="heading-9"><strong>åˆ†æ TLS æ¡æ‰‹å¤±è´¥çš„åŸå› </strong></h3>
<p>Wireshark è¿‡æ»¤ï¼š</p>
<ul>
<li>
<p>ClientHello:</p>
<pre><code class="hljs language-bash" lang="bash">tls.handshake.type == 1
</code></pre>
</li>
<li>
<p>TLS Alertï¼š</p>
<pre><code class="hljs language-bash" lang="bash">tls.alert_message
</code></pre>
</li>
</ul>
<p>é‡ç‚¹æ£€æŸ¥ï¼š</p>
<ul>
<li>SNI æ˜¯å¦æ­£ç¡®</li>
<li>è¯ä¹¦é“¾æ˜¯å¦å®Œæ•´</li>
<li>æ˜¯å¦å‡ºç°è¯ä¹¦æ›¿æ¢</li>
<li>Cipher suite ä¸å…¼å®¹</li>
<li>QUIC æ˜¯å¦å¯¼è‡´ä»£ç†å¤±æ•ˆ</li>
</ul>
<hr/>
<h3 data-id="heading-10"><strong>ä»£ç†æŠ“ä¸åˆ°åŒ…æ—¶çš„è¡¥æŠ“ç­–ç•¥</strong></h3>
<p>è¿™ç±»é—®é¢˜æœ€å¸¸è§ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>App å¼ºåˆ¶ pinning</li>
<li>App ä½¿ç”¨ ATS æ–°ç­–ç•¥</li>
<li>App ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œåº“</li>
<li>éƒ¨åˆ†åŸŸåå¼ºåˆ¶å¼€å¯ HTTP/3</li>
</ul>
<p>æ­¤æ—¶ä½¿ç”¨æŠ“åŒ…å¤§å¸ˆï¼ˆSniffmasterï¼‰å¯ç›´æ¥æ•è·ï¼š</p>
<ul>
<li>HTTPS / TCP / UDP æ•°æ®æµ</li>
<li>æŒ‰ App / åŸŸåè¿‡æ»¤çš„è¯·æ±‚</li>
<li>å¯å¯¼å‡º pcap ä¾› Wireshark å¯¹ç…§åˆ†æ</li>
<li>ç”šè‡³å¯ç”¨è„šæœ¬æ‹¦æˆªè¯·æ±‚åšå®éªŒéªŒè¯</li>
</ul>
<p>é€šå¸¸æµç¨‹ä¸ºï¼š
<strong>å®¢æˆ·ç«¯æµé‡ï¼ˆSniffmasterï¼‰ + æœåŠ¡ç«¯æµé‡ï¼ˆtcpdumpï¼‰ â†’ Wireshark å¹¶æ’åˆ†æ â†’ æ‰¾å‡ºå·®å¼‚ç‚¹</strong></p>
<p>è¿™æ˜¯æœ€ç¨³ã€æœ€å·¥ç¨‹åŒ–çš„æŠ“åŒ…æ–¹æ³•ã€‚</p>
<hr/>
<h3 data-id="heading-11"><strong>HTTP å±‚å†…å®¹åˆ†æï¼ˆè‹¥èƒ½è§£å¯†ï¼‰</strong></h3>
<p>å½“ä»£ç†å¯æ­£å¸¸è§£å¯†æ—¶ï¼Œæ£€æŸ¥ï¼š</p>
<ul>
<li>Header</li>
<li>Authorization / Token</li>
<li>ç­¾åå­—æ®µ</li>
<li>æ—¶é—´æˆ³</li>
<li>å“åº”å†…å®¹</li>
</ul>
<p>ç”¨äºæœ€ç»ˆå®šä½åº”ç”¨å±‚é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-12">å››ã€å®é™…æ¡ˆä¾‹è§£æï¼šHTTPS æŠ“ä¸åˆ°åŒ…å¦‚ä½•å®šä½</h2>
<p>æ¡ˆä¾‹ï¼šæŸ iOS App æ–°ç‰ˆæœ¬æ— æ³•æŠ“ HTTPS è¯·æ±‚ã€‚</p>
<p>æ’æŸ¥é¡ºåºï¼š</p>
<ol>
<li>Charles å®Œå…¨æ— åŒ… â†’ ä»£ç†å¤±æ•ˆ</li>
<li>æœåŠ¡å™¨ tcpdump æœªçœ‹åˆ° ClientHello â†’ è¯·æ±‚æœªå‡ºå‘æˆ–è¢«æå‰æ‹¦æˆª</li>
<li>ä½¿ç”¨ Sniffmaster è¿‡æ»¤è¯¥ App æµé‡ â†’ å¯çœ‹åˆ° TLS ClientHello</li>
<li>Wireshark åˆ†ææ¡æ‰‹ â†’ å‘ç°è¯ä¹¦é“¾ä¸­é—´èŠ‚ç‚¹è¢«å…¬å¸ Wi-Fi æ”¹å†™</li>
<li>ä¿®å¤è¯ä¹¦é“¾åæ¢å¤æ­£å¸¸</li>
</ol>
<p>è¿™ç±»é—®é¢˜é€šè¿‡å•ä¸€å·¥å…·å‡ ä¹æ— æ³•å®šä½ï¼Œéœ€è¦å®Œæ•´é“¾è·¯åˆ†æã€‚</p>
<hr/>
<h2 data-id="heading-13">äº”ã€å›¢é˜Ÿåº”å½“å»ºç«‹çš„æŠ“åŒ…è§„èŒƒ</h2>
<p>æ‰€æœ‰ iOS æŠ“åŒ…åº”åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>æ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰</li>
<li>ç½‘ç»œè¯¦æƒ…ï¼ˆWi-Fi/4G/5Gï¼‰</li>
<li>ä½¿ç”¨å·¥å…·è¯´æ˜</li>
<li>æœåŠ¡ç«¯ pcap</li>
<li>å®¢æˆ·ç«¯ pcapï¼ˆå¦‚ Sniffmaster å¯¼å‡ºï¼‰</li>
<li>Wireshark å…³é”®æˆªå›¾</li>
<li>åˆ¤å®šé“¾è·¯ä½ç½®ï¼ˆå®¢æˆ·ç«¯ / ç½‘ç»œ / åç«¯ï¼‰</li>
<li>è§£å†³æ–¹æ¡ˆï¼ˆè¯ä¹¦é“¾ã€è¶…æ—¶ã€åè®®ç­‰ï¼‰</li>
</ul>
<p>è¿™æ ·æ¯æ¬¡æŠ“åŒ…éƒ½å¯ä»¥å¤ç°ã€å¤ç›˜ã€ç§¯ç´¯ç»éªŒã€‚</p>
<hr/>
<h2 data-id="heading-14">iOS HTTPS æŠ“åŒ…ä¸æ˜¯å•ä¸€å·¥å…·èƒ½è§£å†³çš„</h2>
<p>æœ€ä½³å®è·µå·¥å…·é“¾ä¸ºï¼š</p>
<ul>
<li><strong>Charles / Proxyman</strong>ï¼šæŸ¥çœ‹æ˜æ–‡</li>
<li><strong>tcpdump + Wireshark</strong>ï¼šåˆ†æåº•å±‚ä¸ TLS</li>
<li><strong>mitmproxy</strong>ï¼šè„šæœ¬è‡ªåŠ¨åŒ–</li>
<li><strong>æŠ“åŒ…å¤§å¸ˆï¼ˆSniffmasterï¼‰</strong>ï¼šä»£ç†å¤±æ•ˆ / pinning / QUIC / è‡ªå®šä¹‰åè®® / å¤šæµé‡æ··åˆåœºæ™¯çš„è¡¥æŠ“ä¸ pcap å¯¼å‡º</li>
</ul>
<p>é€šè¿‡â€œåˆ†å±‚åˆ†æ + å¤šå·¥å…·åä½œâ€ï¼Œå‡ ä¹å¯ä»¥å®šä½æ‰€æœ‰ iOS HTTPS æŠ“åŒ…å¤±è´¥çš„é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CharlesæŠ“åŒ…å®æˆ˜ï¼Œå¼€å‘è€…å¦‚ä½•é€šè¿‡æµé‡åˆ†æå¿«é€Ÿå®šä½ç³»ç»Ÿå¼‚å¸¸ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7573776814926987283</link>    <guid>https://juejin.cn/post/7573776814926987283</guid>    <pubDate>2025-11-18T02:20:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573776814926987283" data-draft-id="7573597479980892196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CharlesæŠ“åŒ…å®æˆ˜ï¼Œå¼€å‘è€…å¦‚ä½•é€šè¿‡æµé‡åˆ†æå¿«é€Ÿå®šä½ç³»ç»Ÿå¼‚å¸¸ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:20:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00åç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CharlesæŠ“åŒ…å®æˆ˜ï¼Œå¼€å‘è€…å¦‚ä½•é€šè¿‡æµé‡åˆ†æå¿«é€Ÿå®šä½ç³»ç»Ÿå¼‚å¸¸ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00åç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:20:11.000Z" title="Tue Nov 18 2025 02:20:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæœ€è®©äººæ— ä»ä¸‹æ‰‹çš„é”™è¯¯ï¼Œå¾€å¾€ä¸æ˜¯ä»£ç å¼•å‘çš„ï¼Œè€Œæ˜¯ç½‘ç»œé“¾è·¯é‡Œçš„â€œä¸ç¡®å®šè¡Œä¸ºâ€ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>é¡µé¢æ˜æ˜å‘èµ·äº†è¯·æ±‚ï¼Œä½†æœåŠ¡å™¨æ²¡æœ‰è®°å½•</li>
<li>æ•°æ®ç»“æ„çœ‹ä¼¼æ­£å¸¸ï¼Œä½†å‰ç«¯æ¸²æŸ“ä¸€ç›´å¤±è´¥</li>
<li>æŸäº›æ‰‹æœºå‹å·ç™»å½•æ€»æ˜¯æŠ¥é”™ï¼Œå´æ— æ³•å¤ç°</li>
<li>å¤šç¯å¢ƒéƒ¨ç½²åå¶å°”æ¥æ”¶åˆ°æ—§ç‰ˆæœ¬æ¥å£çš„è¿”å›</li>
</ul>
<p>è¿™äº›é—®é¢˜ä»æ—¥å¿—ä¸Šçœ‹ä¸å‡ºï¼Œä»ä»£ç ä¸Šä¹Ÿä¸èƒ½å®Œå…¨è§£é‡Šã€‚</p>
<p>è€Œ Charles æŠ“åŒ…ï¼Œå°±æ˜¯è§£å†³è¿™äº›â€œéšå½¢é—®é¢˜â€çš„çªç ´ç‚¹ã€‚</p>
<p>æŠ“åŒ…æ˜¯ä¸€ä¸ªâ€œçœ‹è§ç³»ç»Ÿâ€çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªâ€œæŸ¥çœ‹è¯·æ±‚â€çš„åŠ¨ä½œã€‚</p>
<p>æœ¬æ–‡ä»ä¸€ä¸ªæ›´è´´è¿‘å¼€å‘è€…ç»éªŒçš„è§’åº¦ï¼Œåˆ†äº«å¦‚ä½•åˆ©ç”¨ Charles æŠ“åŒ…å®Œæˆå¤æ‚é—®é¢˜å®šä½ä¸ç³»ç»Ÿè¡Œä¸ºåˆ†æã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æŠ“åŒ…çš„æ ¸å¿ƒä»·å€¼ï¼šç¡®è®¤â€œçœŸå®å‘ç”Ÿäº†ä»€ä¹ˆâ€</h2>
<p>è°ƒè¯•æœ€æ€•çš„ï¼Œå°±æ˜¯é”™æŠŠå‡è±¡å½“çœŸç›¸ã€‚</p>
<p>ä½ ä»¥ä¸ºè¯·æ±‚æˆåŠŸäº†ï¼Œä½†å®é™…è¯·æ±‚è¢«ç¼“å­˜æ‹¦äº†ï¼›</p>
<p>ä½ ä»¥ä¸ºåç«¯è¿”å›é”™è¯¯ï¼Œä½†å®é™…å‚æ•°æ ¹æœ¬æ²¡å‘é€å‡ºå»ï¼›</p>
<p>ä½ ä»¥ä¸ºç½‘ç»œæ­£å¸¸ï¼Œä½†å®é™…åœ¨ DNS æˆ– SSL é˜¶æ®µå°±å·²ç»å¡ä½ã€‚</p>
<p>Charles æŠ“åŒ…å¯ä»¥å¸®ä½ ç¡®è®¤ä»¥ä¸‹å…³é”®ç‚¹ï¼š</p>
<ul>
<li>è¯·æ±‚æ˜¯å¦çœŸæ­£å‘å‡º</li>
<li>è¯·æ±‚è·¯å¾„æ˜¯å¦èµ°å¯¹ç¯å¢ƒ</li>
<li>å‚æ•°æ˜¯å¦åœ¨ç½‘ç»œä¼ è¾“ä¸­è¢«ä¿®æ”¹</li>
<li>å“åº”æ˜¯å¦æ¥è‡ªæœåŠ¡å™¨æˆ–ä»£ç†å±‚</li>
<li>è¯·æ±‚åœ¨å“ªä¸ªé˜¶æ®µå‘ç”Ÿå»¶è¿Ÿ</li>
</ul>
<p>è¿™æ˜¯æ—¥å¿—å’Œæ§åˆ¶å°éš¾ä»¥åŒæ—¶åšåˆ°çš„ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€CharlesæŠ“åŒ…çš„åŸºç¡€æµç¨‹ï¼Œä¸åªæ˜¯â€œå¼€è½¯ä»¶å°±èƒ½ç”¨â€</h2>
<p>è¦è®© Charles æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»ç†è§£å®ƒçš„å‡ ä¸ªå…³é”®æ­¥éª¤ã€‚</p>
<h3 data-id="heading-2"><strong>å¼€å¯ä»£ç†ï¼šCharlesä½œä¸ºâ€œä¸­é—´äººâ€å­˜åœ¨</strong></h3>
<p>Charles æœ¬è´¨æ˜¯æœ¬åœ°ä»£ç†å·¥å…·ï¼Œå› æ­¤å®ƒé€šè¿‡å ç”¨ç³»ç»Ÿä»£ç†ï¼Œè®©æ‰€æœ‰æµé‡éƒ½ç»è¿‡å®ƒè½¬å‘ã€‚</p>
<p>æŠ“åŒ…æˆåŠŸçš„å‰æå°±æ˜¯ï¼š
ç³»ç»Ÿä»£ç† = Charlesï¼ˆ127.0.0.1:8888ï¼‰</p>
<h3 data-id="heading-3"><strong>é…ç½® HTTPS è§£å¯†ï¼šè®©åŠ å¯†æ•°æ®å˜å¾—é€æ˜</strong></h3>
<p>é€šè¿‡å®‰è£… Charles Root CAï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ° HTTPS è¯·æ±‚çš„çœŸå®å†…å®¹ã€‚</p>
<p>æ­¤åŠŸèƒ½åœ¨ï¼š</p>
<ul>
<li>ç™»å½•/æ³¨å†Œ</li>
<li>Tokenæ ¡éªŒ</li>
<li>æ”¯ä»˜æµç¨‹</li>
<li>App API è°ƒç”¨</li>
</ul>
<p>è¿™äº›åŠ å¯†åœºæ™¯ä¸­æå…¶å…³é”®ã€‚</p>
<h3 data-id="heading-4"><strong>ä½¿ç”¨ Structure + Sequence å®Œæ•´è¿˜åŸè¯·æ±‚é€»è¾‘</strong></h3>

















<table><thead><tr><th>è§†å›¾</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>Structure</td><td>æŒ‰åŸŸåæŸ¥çœ‹è¯·æ±‚åˆ†å¸ƒ</td></tr><tr><td>Sequence</td><td>æŒ‰æ—¶é—´é¡ºåºæŸ¥çœ‹é“¾è·¯å…³ç³»</td></tr></tbody></table>
<p>Sequence æ˜¯è°ƒè¯•â€œæµç¨‹ç±»é—®é¢˜â€çš„æ ¸å¿ƒå·¥å…·ï¼Œæ¯”å¦‚å¤šæ­¥è¯·æ±‚ã€é¡µé¢åŠ è½½é¡ºåºã€å¹¶å‘è¡Œä¸ºç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ç§»åŠ¨ç«¯æŠ“åŒ…ï¼šCharles çš„çœŸæ­£ä»·å€¼æ‰€åœ¨</h2>
<p>åœ¨ Web ç¯å¢ƒä¸­ä½ è¿˜å¯ä»¥æ‰“å¼€æµè§ˆå™¨çœ‹æ§åˆ¶å°ï¼Œä½†åœ¨ç§»åŠ¨ç«¯â€”â€”
æ—¥å¿—æœ‰é™ã€è¯·æ±‚å°è£…æ·±ã€ä»£ç†å¤æ‚ã€ç¯å¢ƒä¸å¯è§ã€‚</p>
<p>è¿™æ„å‘³ç€ Charles æ˜¯ç§»åŠ¨ç«¯è°ƒè¯•çš„â€œå”¯ä¸€çª—å£â€ã€‚</p>
<h3 data-id="heading-6"><strong>æ‰‹æœºæŠ“åŒ…æµç¨‹åŒ…æ‹¬ï¼š</strong></h3>
<ol>
<li>æ‰‹æœºä¸ç”µè„‘ä½¿ç”¨åŒä¸€ Wi-Fi</li>
<li>æ‰‹åŠ¨å¡«å†™ç”µè„‘ IP å’Œç«¯å£ 8888</li>
<li>è®¿é—® <code>chls.pro/ssl</code> å®‰è£…è¯ä¹¦</li>
<li>iOS ç”¨æˆ·éœ€æ‰‹åŠ¨ä¿¡ä»»è¯ä¹¦</li>
<li>æ‰“å¼€ Appï¼Œæµé‡å³å¯å±•ç¤ºåœ¨ Charles ä¸Š</li>
</ol>
<p>Charles åœ¨ç§»åŠ¨ç«¯è°ƒè¯•ä¸­çš„å…³é”®ä½œç”¨ï¼š</p>
<ul>
<li>çœŸå®è¯·æ±‚å‚æ•°éªŒè¯</li>
<li>ç¯å¢ƒåˆ‡æ¢æ˜¯å¦é”™è¯¯</li>
<li>HTTPS è¯·æ±‚æ˜¯å¦æ­£å¸¸æ¡æ‰‹</li>
<li>App åœ¨å¼±ç½‘ä¸‹çš„è¡Œä¸º</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ç§»åŠ¨ç«¯å¼€å‘ç»•ä¸è¿‡çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-7">å››ã€Charlesåœ¨ç³»ç»Ÿå¼‚å¸¸å®šä½ä¸­çš„å®æˆ˜æŠ€å·§</h2>
<p>ä¸‹é¢æ˜¯æˆ‘å¤šå¹´ç»éªŒæ€»ç»“ä¸­æœ€å¸¸ç”¨çš„æŠ“åŒ…åˆ†ææ–¹å¼ã€‚</p>
<hr/>
<h3 data-id="heading-8"><strong>â‘  è¯·æ±‚å‘å‡ºä½†åç«¯æ²¡æ”¶åˆ°ï¼Ÿçœ‹ DNS / SSL / Proxy</strong></h3>
<p>å¾ˆå¤šè¯·æ±‚åœ¨åˆ°è¾¾æœåŠ¡å™¨å‰å°±å¤±è´¥äº†ï¼š</p>
<ul>
<li>DNS è§£æè¶…æ—¶</li>
<li>SSL æ¡æ‰‹å¤±è´¥</li>
<li>ä»£ç†å±‚æ‹¦æˆªæˆ–è½¬å‘é”™è¯¯</li>
</ul>
<p>Charles çš„ Timeline å¯ä»¥å‡†ç¡®å‘Šè¯‰ä½ å»¶è¿Ÿåœ¨å“ªä¸€æ®µå‡ºç°ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong>
å¦‚æœè¯·æ±‚å¡åœ¨ SSL é˜¶æ®µ â†’ å¤šæ•°æ˜¯è¯ä¹¦é—®é¢˜
å¦‚æœå¡åœ¨ Connecting â†’ å¤šæ•°æ˜¯ç½‘ç»œç¯å¢ƒé—®é¢˜</p>
<hr/>
<h3 data-id="heading-9"><strong>â‘¡ å‰ç«¯è¯´å‚æ•°æ­£ç¡®ï¼Œåç«¯è¯´æ²¡æ”¶åˆ°ï¼Ÿçœ‹ Raw + Body</strong></h3>
<p>å¾ˆå¤šç»†èŠ‚åªæœ‰æŠ“åŒ…æ‰èƒ½çœ‹åˆ°ï¼š</p>
<ul>
<li>è¢«åºåˆ—åŒ–æ—¶å­—æ®µä¸¢å¤±</li>
<li>GET å‚æ•°è¢«æµè§ˆå™¨è¿‡æ»¤</li>
<li>POST å­—æ®µä¸ºç©ºå­—ç¬¦ä¸²</li>
<li>JSON æ•°ç»„è¢«é”™è¯¯ç¼–ç </li>
</ul>
<p>Charles çš„ Raw / JSON æ ‡ç­¾èƒ½çœ‹åˆ°çœŸå®å‘é€å†…å®¹ã€‚</p>
<hr/>
<h3 data-id="heading-10"><strong>â‘¢ æŸäº›ç”¨æˆ·åé¦ˆé¡µé¢åŠ è½½æ…¢ï¼Ÿçœ‹ Timeline åˆ†ææ…¢ç‚¹</strong></h3>
<p>å¯èƒ½åŸå› åŒ…æ‹¬ï¼š</p>
<ul>
<li>é‡å®šå‘å¤ªå¤š</li>
<li>CDN ç¼“å­˜å¤±è´¥</li>
<li>å¤§é‡é‡å¤è¯·æ±‚</li>
<li>å¼±ç½‘å¯¼è‡´æ¡æ‰‹å¤±è´¥</li>
</ul>
<p>Timeline ä¼šæŠŠæ¯ä¸€æ¯«ç§’æ ‡è®°å‡ºæ¥ï¼Œè®©ä½ çŸ¥é“é—®é¢˜åˆ°åº•å‘ç”Ÿåœ¨å“ªä¸ªç¯èŠ‚ã€‚</p>
<hr/>
<h3 data-id="heading-11"><strong>â‘£ Mock åŠŸèƒ½æå¤§æé«˜å‰ç«¯è°ƒè¯•æ•ˆç‡</strong></h3>
<p>åœ¨ç¼ºä¹æ¥å£æˆ–åç«¯ä¸ç¨³å®šæ—¶ï¼š</p>
<ul>
<li>Map Local æ˜ å°„æœ¬åœ° JSON</li>
<li>Rewrite è‡ªåŠ¨ä¿®æ­£å‚æ•°</li>
<li>Map Remote åˆ‡æ¢ä¸åŒç¯å¢ƒ</li>
</ul>
<p>è¿™æ ·å‰ç«¯å°±èƒ½å®ç°ç‹¬ç«‹å¼€å‘ã€‚</p>
<hr/>
<h2 data-id="heading-12">äº”ã€æŠ“åŒ…å¤±è´¥çš„å…¸å‹åŸå› ä¸è§£å†³æ–¹å¼</h2>






























<table><thead><tr><th>é—®é¢˜</th><th>æè¿°</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æŠ“ä¸åˆ° HTTPS</td><td>å†…å®¹æ˜¾ç¤ºä¸ºç©º</td><td>å®‰è£…/ä¿¡ä»» CAï¼Œå¯ç”¨ SSL Proxying</td></tr><tr><td>æ‰‹æœºæŠ“ä¸åˆ°è¯·æ±‚</td><td>App ä¸­æ— æµé‡æ˜¾ç¤º</td><td>åŒä¸€ Wi-Fi + æ­£ç¡®ä»£ç† + ä¿¡ä»»è¯ä¹¦</td></tr><tr><td>è¯·æ±‚ä¹±ç </td><td>å±•ç¤ºä¸æ­£å¸¸</td><td>å¯ç”¨ â€œè‡ªåŠ¨è§£å‹ç¼©â€</td></tr><tr><td>App æ˜¾ç¤ºè¯ä¹¦é”™è¯¯</td><td>SSL Pinning</td><td>ä½¿ç”¨è°ƒè¯•åŒ…æˆ–å…³é—­æ ¡éªŒ</td></tr></tbody></table>
<p>è¿™äº›éƒ½æ˜¯å®é™…å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-13">å¦‚æœä½ éœ€è¦æ›´å®Œæ•´çš„æ“ä½œå›¾è§£</h2>
<p>å¯ä»¥è®¿é—®**<a href="https://link.juejin.cn?target=https%3A%2F%2Fcharlesproxy.net%2F" target="_blank" title="https://charlesproxy.net/" ref="nofollow noopener noreferrer">Charlesä¸­æ–‡ç½‘</a>**ï¼Œè¿™é‡Œæ•´ç†äº†å®‰è£…ã€æŠ“åŒ…ã€è¯ä¹¦ã€æ‰‹æœºè°ƒè¯•ç­‰è¯¦ç»†ä¸­æ–‡æµç¨‹ï¼Œ
å¯¹ä¸Šæ‰‹ Charles ååˆ†å‹å¥½ã€‚</p>
<hr/>
<h2 data-id="heading-14">æŒæ¡ Charlesï¼Œæ˜¯å»ºç«‹â€œç³»ç»Ÿç†è§£åŠ›â€çš„èµ·ç‚¹</h2>
<p>å½“ä½ èƒ½ç”¨ Charles æ¸…æ™°çœ‹åˆ°ç³»ç»Ÿè¡Œä¸ºï¼Œä½ å°±èƒ½åšåˆ°ï¼š</p>
<ul>
<li>ä¸ä¾èµ–çŒœæµ‹å®šä½é—®é¢˜</li>
<li>ä¸å†å—ç¯å¢ƒå·®å¼‚å½±å“</li>
<li>å¤ç°ä»–äººæ— æ³•å¤ç°çš„Bug</li>
<li>åœ¨å¤æ‚ç³»ç»Ÿä¸­ä¿æŒæœ‰æ•ˆåˆ¤æ–­</li>
</ul>
<p>Charles æŠ“åŒ…ä¸æ˜¯ä¸€ä¸ªâ€œå·¥å…·æŠ€å·§â€ï¼Œå®ƒæ˜¯ä¸€ç§<strong>è§‚å¯Ÿç³»ç»Ÿã€åˆ†æé“¾è·¯ã€å®šä½é—®é¢˜</strong>çš„èƒ½åŠ›ã€‚</p>
<p>ç†è§£æŠ“åŒ…ï¼Œä½ çš„è°ƒè¯•æ•ˆç‡å’Œç³»ç»Ÿæ´å¯ŸåŠ›éƒ½ä¼šæ˜æ˜¾æå‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‡†å¤‡æ‰‹å†™Simple Raftï¼ˆä¸€ï¼‰ï¼šæƒ³é€šRaftçš„æ ¸å¿ƒé—®é¢˜]]></title>    <link>https://juejin.cn/post/7573597479980761124</link>    <guid>https://juejin.cn/post/7573597479980761124</guid>    <pubDate>2025-11-18T02:07:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573597479980761124" data-draft-id="7573593395797573678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‡†å¤‡æ‰‹å†™Simple Raftï¼ˆä¸€ï¼‰ï¼šæƒ³é€šRaftçš„æ ¸å¿ƒé—®é¢˜"/> <meta itemprop="keywords" content="åç«¯,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2025-11-18T02:07:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‡†å¤‡æ‰‹å†™Simple Raftï¼ˆä¸€ï¼‰ï¼šæƒ³é€šRaftçš„æ ¸å¿ƒé—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:07:17.000Z" title="Tue Nov 18 2025 02:07:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œè€…èƒŒæ™¯ï¼š20å¹´ITä¸€çº¿å¼€å‘ç»éªŒï¼Œ15å¹´æ¶æ„å¸ˆç»éªŒã€‚æ“…é•¿åˆ†å¸ƒå¼ã€å¾®æœåŠ¡ã€æœç´¢å¼•æ“ï¼Œæ‰‹å†™è¿‡å„ç±»ä¸­é—´ä»¶ã€‚æ›¾å¯¹Jacocoã€å¤œèºç­‰è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè´Ÿè´£è¿‡200å¤šä¸ªèŠ‚ç‚¹çš„å¤§è§„æ¨¡é›†ç¾¤ï¼Œæ¶‰åŠK8sã€å¾®æœåŠ¡ç›‘æ§ã€å¤šä¸ªä¸­é—´ä»¶çš„è¿ç»´ã€‚è‡ªç ”è¿‡åŠ è§£å¯†ä¸­é—´ä»¶ï¼Œç°æœåŠ¡äºä¸€å®¶é‡‘èå…¬å¸ï¼Œæ‹…ä»»æ¶æ„å¸ˆã€‚</p>
</blockquote>
<h2 data-id="heading-0">æ‘˜è¦</h2>
<p>æœ¬æ–‡æ˜¯Simple Raftç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œè®°å½•äº†æˆ‘ä»ä¸€ä¸ªç®€å•ç–‘é—®å‡ºå‘ï¼Œé€æ­¥ç†è§£Raftæ ¸å¿ƒæœºåˆ¶çš„æ€è€ƒè¿‡ç¨‹ã€‚ä¸»è¦è§£å†³äº†ä¸‰ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆMySQLæœ‰MVCCè¿˜éœ€è¦Rafté€‰ä¸»ï¼Ÿä¸ºä»€ä¹ˆé€‰å‡ºLeaderåè¿˜æœ‰å¹¶å‘é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆæ—¥å¿—æ˜¯Raftçš„çµé­‚ï¼Ÿé€šè¿‡å¯¹æ¯”PostgreSQL WALã€RocketMQ CommitLogç­‰ç†Ÿæ‚‰çš„ç³»ç»Ÿï¼Œæœ€ç»ˆæƒ³é€šäº†Raftä½œä¸ºåˆ†å¸ƒå¼åŸºçŸ³çš„æœ¬è´¨ã€‚åç»­å°†æ‰‹å†™Simple Raftå®ç°ï¼Œä»æœ€ç®€å•çš„ç‰ˆæœ¬å¼€å§‹è¿­ä»£ï¼Œç»“åˆç”Ÿäº§ç»éªŒåˆ†äº«å®æˆ˜ä¸­çš„æƒè¡¡å’Œå‘ã€‚</p>
<hr/>
<p>æœ€è¿‘åœ¨ç ”ç©¶Nacosçš„æ—¶å€™ï¼Œçªç„¶æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼šNacosç”¨Raftåè®®é€‰ä¸»ï¼Œå¯æ˜¯é€‰ä¸»çš„ç›®çš„åˆ°åº•æ˜¯å•¥ï¼Ÿ</p>
<p>ä½ æƒ³å•Šï¼Œæœ€ç»ˆæ•°æ®éƒ½æ˜¯å­˜åˆ°MySQLäº†ï¼ŒMySQLæœ¬èº«å°±æœ‰MVCCæœºåˆ¶ä¿è¯å¹¶å‘å®‰å…¨ã€‚é‚£ç†è®ºä¸Šå“ªä¸ªNacosèŠ‚ç‚¹è¯»å†™ä¸éƒ½ä¸€æ ·å—ï¼Ÿä¸ºä»€ä¹ˆéè¦æä¸ªLeaderå‡ºæ¥ï¼Œå¤šæ­¤ä¸€ä¸¾ï¼Ÿ</p>
<p>æˆ‘å½“æ—¶å°±æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œè§‰å¾—è¿™è®¾è®¡æœ‰ç‚¹å¤šä½™ã€‚åæ¥æ·±å…¥ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå‘ç°è‡ªå·±è¿˜æ˜¯å›¾æ ·å›¾æ£®ç ´äº†ã€‚</p>
<h2 data-id="heading-1">MySQLçš„MVCCè§£å†³ä¸äº†çš„é—®é¢˜</h2>
<p>å‡è®¾ç°åœ¨æœ‰3ä¸ªNacosèŠ‚ç‚¹ï¼Œéƒ½ç›´æ¥è¿MySQLè¯»å†™ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[å®¢æˆ·ç«¯A] --&gt; N1[NacosèŠ‚ç‚¹1]
    B[å®¢æˆ·ç«¯B] --&gt; N2[NacosèŠ‚ç‚¹2]
    C[å®¢æˆ·ç«¯C] --&gt; N3[NacosèŠ‚ç‚¹3]
    N1 --&gt; M[(MySQL)]
    N2 --&gt; M
    N3 --&gt; M
</code></pre>
<p>çœ‹èµ·æ¥æŒºç¾å¥½çš„ï¼ŒMySQLçš„MVCCä¼šå¸®æˆ‘ä»¬å¤„ç†å¹¶å‘é—®é¢˜ã€‚ä½†ç­‰ç­‰ï¼ŒMVCCåªèƒ½ä¿è¯<strong>æ•°æ®åº“å±‚é¢çš„äº‹åŠ¡éš”ç¦»</strong>ï¼Œå®ƒä¿è¯ä¸äº†è¿™äº›ï¼š</p>
<h3 data-id="heading-2">ä¸šåŠ¡é¡ºåºçš„ä¸€è‡´æ€§</h3>
<p>æˆ‘ä¸¾ä¸ªä¾‹å­ã€‚å®¢æˆ·ç«¯Aæ³¨å†Œäº†ä¸€ä¸ªæœåŠ¡å®ä¾‹<code>instance-1</code>ï¼Œå®¢æˆ·ç«¯Bé©¬ä¸Šåˆæ³¨é”€äº†è¿™ä¸ªå®ä¾‹ã€‚è¿™ä¸¤ä¸ªè¯·æ±‚åˆ†åˆ«æ‰“åˆ°äº†ä¸åŒçš„NacosèŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant A as å®¢æˆ·ç«¯A
    participant N1 as NacosèŠ‚ç‚¹1
    participant N2 as NacosèŠ‚ç‚¹2
    participant M as MySQL
    participant Sub as è®¢é˜…è€…
    
    A-&gt;&gt;N1: æ³¨å†Œinstance-1
    N1-&gt;&gt;M: å†™å…¥MySQL
    N1-&gt;&gt;Sub: æ¨é€"æ–°å¢"é€šçŸ¥
    
    Note over N2: å‡ ä¹åŒæ—¶
    
    B-&gt;&gt;N2: æ³¨é”€instance-1
    N2-&gt;&gt;M: å†™å…¥MySQL  
    N2-&gt;&gt;Sub: æ¨é€"åˆ é™¤"é€šçŸ¥
</code></pre>
<p>è™½ç„¶MySQLèƒ½ä¿è¯è¿™ä¸¤ä¸ªå†™æ“ä½œä¸ä¼šå†²çªï¼Œä½†<strong>æ¨é€é€šçŸ¥çš„é¡ºåºå¯èƒ½ä¹±</strong>ï¼è®¢é˜…è€…å¯èƒ½å…ˆæ”¶åˆ°"åˆ é™¤"é€šçŸ¥ï¼Œå†æ”¶åˆ°"æ–°å¢"é€šçŸ¥ï¼Œå¯¼è‡´æœ€ç»ˆçŠ¶æ€ä¸å¯¹ã€‚</p>
<h3 data-id="heading-3">å†…å­˜çŠ¶æ€çš„åˆ†è£‚</h3>
<p>æ›´è¦å‘½çš„æ˜¯ï¼ŒNacosçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å†…å­˜ç¼“å­˜ã€‚æ²¡æœ‰Leaderåè°ƒçš„è¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">èŠ‚ç‚¹<span class="hljs-number">1</span>å†…å­˜: {serviceA: [instance1, instance2]}
èŠ‚ç‚¹<span class="hljs-number">2</span>å†…å­˜: {serviceA: [instance1, instance3]}  
èŠ‚ç‚¹<span class="hljs-number">3</span>å†…å­˜: {serviceA: [instance2, instance3]}
</code></pre>
<p>è™½ç„¶MySQLé‡Œçš„æ•°æ®æ˜¯å¯¹çš„ï¼Œä½†ä¸‰ä¸ªèŠ‚ç‚¹ç»™å‡ºçš„æŸ¥è¯¢ç»“æœéƒ½ä¸ä¸€æ ·ã€‚å®¢æˆ·ç«¯æŸ¥åˆ°å“ªä¸ªèŠ‚ç‚¹ç®—å“ªä¸ªï¼Œè¿™ä¸å°±ä¹±å¥—äº†å—ï¼Ÿ</p>
<h2 data-id="heading-4">åŸæ¥Raftè§£å†³çš„æ˜¯è¿™ä¸ª</h2>
<p>æˆ‘åæ¥æƒ³æ˜ç™½äº†ï¼Œ<strong>Rafté€‰ä¸»ä¸æ˜¯ä¸ºäº†è§£å†³æ•°æ®è¯»å†™çš„é—®é¢˜ï¼Œè€Œæ˜¯ä¸ºäº†ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç…§ç›¸åŒçš„é¡ºåºæ‰§è¡Œç›¸åŒçš„æ“ä½œ</strong>ã€‚</p>
<p>æœ‰äº†Leaderä¹‹åï¼Œæµç¨‹å˜æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant F as FollowerèŠ‚ç‚¹
    participant L as LeaderèŠ‚ç‚¹
    participant M as MySQL
    
    C-&gt;&gt;F: å†™è¯·æ±‚
    F-&gt;&gt;L: è½¬å‘ç»™Leader
    L-&gt;&gt;L: è¿½åŠ åˆ°æ—¥å¿—
    L-&gt;&gt;F: å¤åˆ¶æ—¥å¿—
    F-&gt;&gt;L: ç¡®è®¤æ”¶åˆ°
    Note over L: è¿‡åŠç¡®è®¤
    L-&gt;&gt;M: å†™å…¥MySQL
    L-&gt;&gt;C: è¿”å›æˆåŠŸ
</code></pre>
<p>æ‰€æœ‰çš„å†™æ“ä½œéƒ½é€šè¿‡Leaderï¼ŒLeaderä¿è¯ï¼š</p>
<ul>
<li>æ‰€æœ‰æ“ä½œéƒ½æœ‰å…¨å±€å”¯ä¸€çš„é¡ºåº</li>
<li>æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç›¸åŒé¡ºåºæ‰§è¡Œ</li>
<li>å†…å­˜çŠ¶æ€ä¿æŒä¸€è‡´</li>
</ul>
<p>è¿™å°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œå¸¸è¯´çš„<strong>çŠ¶æ€æœºå¤åˆ¶</strong>ã€‚</p>
<h2 data-id="heading-5">é‚£å¦‚æœMySQLç”¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«å‘¢ï¼Ÿ</h2>
<p>æˆ‘å½“æ—¶è¿˜æƒ³äº†ä¸ªæ­ªæ‹›ï¼šå¦‚æœMySQLè®¾ç½®æˆSERIALIZABLEéš”ç¦»çº§åˆ«ï¼Œé‚£æ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨Raftäº†ï¼Ÿ</p>
<p>åæ¥å‘ç°è¿˜æ˜¯ä¸è¡Œã€‚SERIALIZABLEåªèƒ½ä¿è¯MySQLå†…éƒ¨çš„äº‹åŠ¡ä¸²è¡ŒåŒ–ï¼Œä½†ä¿è¯ä¸äº†ï¼š</p>
<ul>
<li>Nacoså„èŠ‚ç‚¹çš„å†…å­˜çŠ¶æ€ä¸€è‡´</li>
<li>æ¨é€é€šçŸ¥çš„é¡ºåºæ­£ç¡®</li>
<li>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ“ä½œé¡ºåº</li>
</ul>
<p>è¯´ç™½äº†ï¼Œ<strong>MySQLæ˜¯å­˜å‚¨å±‚ï¼ŒRaftæ˜¯åè°ƒå±‚</strong>ï¼Œä¸¤ä¸ªæ ¹æœ¬ä¸æ˜¯ä¸€å›äº‹ã€‚</p>
<h2 data-id="heading-6">é€‰å‡ºLeaderåå°±å®Œäº‹äº†ï¼Ÿè¿˜æœ‰å¤šçº¿ç¨‹é—®é¢˜</h2>
<p>è¿™é‡Œæˆ‘åˆå‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„äº‹ã€‚Rafté€šè¿‡é€‰ä¸¾ä¿è¯äº†åªæœ‰ä¸€ä¸ªLeaderåœ¨å†™ï¼Œä½†Leaderè‡ªå·±å†…éƒ¨è¿˜æ˜¯æœ‰å¹¶å‘é—®é¢˜å•Šï¼</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘Leaderå‘è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    C1[å®¢æˆ·ç«¯1] --&gt; L[Leader]
    C2[å®¢æˆ·ç«¯2] --&gt; L
    C3[å®¢æˆ·ç«¯3] --&gt; L
    L --&gt; T1[å¤„ç†çº¿ç¨‹1]
    L --&gt; T2[å¤„ç†çº¿ç¨‹2]
    L --&gt; T3[å¤„ç†çº¿ç¨‹3]
</code></pre>
<p>è¿™äº›è¯·æ±‚å¯èƒ½åŒæ—¶åˆ°è¾¾ï¼ŒLeaderå†…éƒ¨è‚¯å®šæœ‰å¤šçº¿ç¨‹å¤„ç†ã€‚æ€ä¹ˆä¿è¯å®ƒä»¬çš„æ‰§è¡Œé¡ºåºå‘¢ï¼Ÿ</p>
<p>è¿™å°±æ˜¯<strong>æ—¥å¿—</strong>çš„ä½œç”¨äº†ï¼æˆ‘ä¹‹å‰ä¸€ç›´æ²¡æƒ³æ˜ç™½ä¸ºä»€ä¹ˆRaftéœ€è¦æ—¥å¿—ï¼Œåæ¥æ‰æç„¶å¤§æ‚Ÿã€‚</p>
<h3 data-id="heading-7">æ—¥å¿—è§£å†³å¹¶å‘æ§åˆ¶</h3>
<p>LeaderæŠŠæ‰€æœ‰å†™æ“ä½œéƒ½ä¸²è¡ŒåŒ–åœ°è¿½åŠ åˆ°æ—¥å¿—é‡Œï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    T1[çº¿ç¨‹1:è¯·æ±‚A] --&gt; Q[æ—¥å¿—é˜Ÿåˆ—]
    T2[çº¿ç¨‹2:è¯·æ±‚B] --&gt; Q
    T3[çº¿ç¨‹3:è¯·æ±‚C] --&gt; Q
    Q --&gt; A[å•çº¿ç¨‹åº”ç”¨]
    A --&gt; S[çŠ¶æ€æœº]
</code></pre>
<p>è™½ç„¶è¯·æ±‚æ˜¯å¹¶å‘æ¥æ”¶çš„ï¼Œä½†å†™æ—¥å¿—çš„æ—¶å€™ä¼šä¸²è¡ŒåŒ–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RaftLeader</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;LogEntry&gt; logQueue;
    
    <span class="hljs-comment">// å¤šçº¿ç¨‹å¹¶å‘è°ƒç”¨</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Boolean&gt; <span class="hljs-title function_">propose</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data)</span> {
        <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogEntry</span>(currentTerm, data);
        
        <span class="hljs-comment">// è¿™é‡Œæœ‰é”ä¿è¯ä¸²è¡ŒåŒ–å†™å…¥</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            logQueue.offer(entry);
            <span class="hljs-type">long</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> nextIndex++;
        }
        
        <span class="hljs-comment">// å¼‚æ­¥ç­‰å¾…å¤åˆ¶å®Œæˆ</span>
        <span class="hljs-keyword">return</span> waitForCommit(index);
    }
    
    <span class="hljs-comment">// å•çº¿ç¨‹åº”ç”¨æ—¥å¿—</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyLog</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> logQueue.take();
            stateMachine.apply(entry);  <span class="hljs-comment">// ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œ</span>
        }
    }
}
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼š</p>
<ol>
<li>å¤šçº¿ç¨‹å¹¶å‘æ¥æ”¶è¯·æ±‚ï¼ˆé«˜ååï¼‰</li>
<li>æ—¥å¿—é˜Ÿåˆ—ä¸²è¡ŒåŒ–ï¼ˆä¿è¯é¡ºåºï¼‰</li>
<li>å•çº¿ç¨‹åº”ç”¨åˆ°çŠ¶æ€æœºï¼ˆä¿è¯ä¸€è‡´æ€§ï¼‰</li>
</ol>
<p><strong>æ—¥å¿—å°±æ˜¯æŠŠæ—¶é—´ç»´åº¦ä¸Šçš„å¹¶å‘ï¼Œè½¬åŒ–ä¸ºç©ºé—´ç»´åº¦ä¸Šçš„é¡ºåºã€‚</strong></p>
<h2 data-id="heading-8">çªç„¶æƒ³é€šçš„ä¸€ä»¶äº‹</h2>
<p>æˆ‘ç ”ç©¶åˆ°è¿™é‡Œçš„æ—¶å€™çªç„¶å‘ç°ï¼Œè¿™å¥—æœºåˆ¶å’Œæˆ‘ç†Ÿæ‚‰çš„å…¶ä»–ç³»ç»Ÿå¾ˆåƒå•Šï¼š</p>
<p><strong>PostgreSQLçš„WALï¼š</strong></p>
<pre><code class="hljs">å¤šä¸ªäº‹åŠ¡å¹¶å‘ â†’ ä¸²è¡Œå†™WAL â†’ æŒ‰åºåº”ç”¨åˆ°æ•°æ®é¡µ
</code></pre>
<p><strong>RocketMQçš„CommitLogï¼š</strong></p>
<pre><code class="hljs">å¤šä¸ªç”Ÿäº§è€…å¹¶å‘ â†’ ä¸²è¡Œå†™CommitLog â†’ æŒ‰åºæ¶ˆè´¹
</code></pre>
<p><strong>Raftçš„æ—¥å¿—ï¼š</strong></p>
<pre><code class="hljs">å¤šä¸ªè¯·æ±‚å¹¶å‘ â†’ ä¸²è¡Œå†™æ—¥å¿— â†’ æŒ‰åºåº”ç”¨åˆ°çŠ¶æ€æœº
</code></pre>
<p>å®ƒä»¬æœ¬è´¨ä¸Šéƒ½åœ¨è§£å†³åŒä¸€ä¸ªé—®é¢˜ï¼š<strong>æŠŠæ— åºçš„å¹¶å‘æ“ä½œï¼Œå˜æˆæœ‰åºçš„å¯é‡æ”¾åºåˆ—</strong>ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™äº›ç³»ç»Ÿéƒ½å«"æ—¥å¿—"ï¼Œè€Œä¸æ˜¯å«"æ•°æ®åº“"æˆ–è€…"ç¼“å­˜"ã€‚æ—¥å¿—å¤©ç„¶å°±æ˜¯ä¸€ä¸ªæœ‰åºçš„ã€åªèƒ½è¿½åŠ çš„ç»“æ„ã€‚</p>
<h2 data-id="heading-9">ä¸»æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ</h2>
<p>æˆ‘å½“æ—¶è¿˜æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœLeaderåˆšå†™å…¥æ—¥å¿—è¿˜æ²¡æ¥å¾—åŠå¤åˆ¶ï¼Œå°±æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ</p>
<p>åæ¥å‘ç°Raftæ—©å°±æƒ³å¥½äº†ã€‚Leaderå†™å…¥æ—¥å¿—åï¼Œ<strong>ä¸ä¼šç«‹å³è¿”å›æˆåŠŸ</strong>ï¼Œè€Œæ˜¯è¦ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant L as Leader
    participant F1 as Follower1
    participant F2 as Follower2
    participant F3 as Follower3
    participant C as å®¢æˆ·ç«¯
    
    C-&gt;&gt;L: å†™è¯·æ±‚
    L-&gt;&gt;L: è¿½åŠ åˆ°æ—¥å¿—(æœªæäº¤)
    
    par å¹¶è¡Œå¤åˆ¶
        L-&gt;&gt;F1: å¤åˆ¶æ—¥å¿—
        L-&gt;&gt;F2: å¤åˆ¶æ—¥å¿—
        L-&gt;&gt;F3: å¤åˆ¶æ—¥å¿—
    end
    
    F1-&gt;&gt;L: ACK
    F2-&gt;&gt;L: ACK
    
    Note over L: æ”¶åˆ°è¿‡åŠACK
    L-&gt;&gt;L: æ ‡è®°ä¸ºcommitted
    L-&gt;&gt;C: è¿”å›æˆåŠŸ
</code></pre>
<p>åªæœ‰<strong>è¿‡åŠæ•°èŠ‚ç‚¹ç¡®è®¤</strong>åï¼ŒLeaderæ‰ä¼šå‘Šè¯‰å®¢æˆ·ç«¯"å†™å…¥æˆåŠŸ"ã€‚</p>
<p>è¿™æ ·å°±ç®—Leaderé©¬ä¸ŠæŒ‚äº†ï¼Œè‡³å°‘æœ‰3å°æœºå™¨ï¼ˆåŒ…æ‹¬æŒ‚æ‰çš„Leaderï¼‰æœ‰è¿™æ¡æ—¥å¿—ã€‚æ–°Leaderé€‰ä¸¾çš„æ—¶å€™ï¼Œä¸€å®šä¼šä»è¿™äº›æœ‰æœ€æ–°æ—¥å¿—çš„èŠ‚ç‚¹ä¸­é€‰å‡ºæ¥ã€‚</p>
<h2 data-id="heading-10">é‚£è½åçš„èŠ‚ç‚¹èƒ½å½“Leaderå—ï¼Ÿ</h2>
<p>è¿™æ˜¯æˆ‘æœ€åä¸€ä¸ªç–‘æƒ‘ã€‚å‡è®¾ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Leader(æŒ‚äº†):   <span class="hljs-section">[æ—¥å¿—1,2,3,4,5]</span>
Follower-A:     <span class="hljs-section">[æ—¥å¿—1,2,3,4,5]</span>  â† æœ€æ–°
Follower-B:     <span class="hljs-section">[æ—¥å¿—1,2,3,4,5]</span>  â† æœ€æ–°
Follower-C:     <span class="hljs-section">[æ—¥å¿—1,2,3]</span>      â† è½å
Follower-D:     <span class="hljs-section">[æ—¥å¿—1,2,3]</span>      â† è½å
</code></pre>
<p>Cå’ŒDçš„é€‰ä¸¾è¶…æ—¶æ—¶é—´æ˜¯éšæœºçš„ï¼Œå¦‚æœCå…ˆè¶…æ—¶å‘èµ·é€‰ä¸¾å‘¢ï¼Ÿå®ƒä¼šä¸ä¼šå½“é€‰ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¼šï¼</strong></p>
<p>å› ä¸ºRaftæœ‰ä¸ªæŠ•ç¥¨è§„åˆ™ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldVoteFor</span><span class="hljs-params">(Candidate candidate)</span> {
    <span class="hljs-comment">// æ¯”è¾ƒæ—¥å¿—</span>
    <span class="hljs-keyword">if</span> (candidate.lastLogTerm &lt; myLastLogTerm) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// å€™é€‰äººæ—¥å¿—æ›´æ—§ï¼Œæ‹’ç»</span>
    }
    
    <span class="hljs-keyword">if</span> (candidate.lastLogTerm == myLastLogTerm) {
        <span class="hljs-keyword">if</span> (candidate.lastLogIndex &lt; myLastLogIndex) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ç´¢å¼•æ›´å°ï¼Œæ‹’ç»</span>
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ—¥å¿—è‡³å°‘å’Œæˆ‘ä¸€æ ·æ–°ï¼ŒåŒæ„</span>
}
</code></pre>
<p>æ‰€ä»¥Cå‘èµ·é€‰ä¸¾çš„æ—¶å€™ï¼š</p>
<ul>
<li>Açœ‹åˆ°Cçš„æ—¥å¿—åªåˆ°3ï¼Œè‡ªå·±åˆ°5 â†’ æ‹’ç»æŠ•ç¥¨</li>
<li>Bçœ‹åˆ°Cçš„æ—¥å¿—åªåˆ°3ï¼Œè‡ªå·±åˆ°5 â†’ æ‹’ç»æŠ•ç¥¨</li>
<li>Dçœ‹åˆ°Cçš„æ—¥å¿—å’Œè‡ªå·±ä¸€æ · â†’ åŒæ„æŠ•ç¥¨</li>
</ul>
<p>Cåªèƒ½æ‹¿åˆ°2ç¥¨ï¼ˆè‡ªå·±+Dï¼‰ï¼Œè¾¾ä¸åˆ°è¿‡åŠï¼Œé€‰ä¸¾å¤±è´¥ã€‚</p>
<p>è€Œå¦‚æœAå…ˆå‘èµ·é€‰ä¸¾ï¼Œå®ƒçš„æ—¥å¿—æœ€æ–°ï¼Œèƒ½æ‹¿åˆ°è‡³å°‘3ç¥¨ï¼ŒæˆåŠŸå½“é€‰ã€‚</p>
<p><strong>è¿™å°±ä¿è¯äº†æ–°Leaderä¸€å®šæœ‰æ‰€æœ‰å·²æäº¤çš„æ•°æ®ã€‚</strong></p>
<h2 data-id="heading-11">Raftï¼šåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³</h2>
<p>ç ”ç©¶åˆ°è¿™é‡Œï¼Œæˆ‘è¶Šæ¥è¶Šè§‰å¾—Raftæ˜¯ä¸ªå¾ˆç²¾å¦™çš„è®¾è®¡ã€‚å®ƒçœ‹èµ·æ¥ä¸å¤æ‚ï¼Œä½†è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æ ¸å¿ƒçš„é—®é¢˜ï¼š</p>
<ul>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°ç›¸åŒçš„æ•°æ®</li>
<li><strong>é¡ºåºæ€§</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹æŒ‰ç›¸åŒé¡ºåºæ‰§è¡Œ</li>
<li><strong>å®¹é”™æ€§</strong>ï¼šå°‘æ•°èŠ‚ç‚¹æŒ‚äº†ç³»ç»Ÿä»å¯ç”¨</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šç”¨æ—¥å¿—ä¸²è¡ŒåŒ–æ“ä½œ</li>
</ul>
<p>æœ‰äº†Raftè¿™ä¸ªåŸºçŸ³ï¼Œä½ å°±èƒ½æ„å»ºå„ç§ä¸Šå±‚åº”ç”¨ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    R[Raftåè®®] --&gt; KV[KVå­˜å‚¨]
    R --&gt; Lock[åˆ†å¸ƒå¼é”]
    R --&gt; Config[é…ç½®ä¸­å¿ƒ]
    R --&gt; Registry[æœåŠ¡æ³¨å†Œ]
    
    KV --&gt; etcd
    Lock --&gt; etcd
    Config --&gt; Nacos
    Registry --&gt; Consul
</code></pre>
<ul>
<li><strong>etcd</strong>å°±æ˜¯Raft + KVå­˜å‚¨ + Watchæœºåˆ¶</li>
<li><strong>Nacosé…ç½®ä¸­å¿ƒ</strong>å°±æ˜¯Raft + é…ç½®ç®¡ç† + æ¨é€</li>
<li><strong>Consul</strong>å°±æ˜¯Raft + æœåŠ¡æ³¨å†Œ + å¥åº·æ£€æŸ¥</li>
</ul>
<p>ç”šè‡³å¯ä»¥ç”¨Raftè‡ªå·±å®ç°åˆ†å¸ƒå¼é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RaftLock</span> {
    <span class="hljs-keyword">private</span> RaftNode raft;
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key, String owner)</span> {
        <span class="hljs-comment">// é€šè¿‡Raftå¤åˆ¶åŠ é”å‘½ä»¤</span>
        <span class="hljs-type">LockCommand</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LockCommand</span>(key, owner);
        <span class="hljs-keyword">return</span> raft.propose(cmd);  <span class="hljs-comment">// è¿‡åŠç¡®è®¤æ‰æˆåŠŸ</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(String key, String owner)</span> {
        <span class="hljs-type">UnlockCommand</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnlockCommand</span>(key, owner);
        raft.propose(cmd);
    }
}
</code></pre>
<p>å› ä¸ºRaftä¿è¯äº†ï¼š</p>
<ul>
<li>åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½å†™å…¥ï¼ˆLeaderï¼‰</li>
<li>æ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°ç›¸åŒçš„åŠ é”é¡ºåº</li>
<li>è¿‡åŠç¡®è®¤æ‰è¿”å›æˆåŠŸ</li>
</ul>
<p>è¿™å°±æ˜¯ä¸€ä¸ªå¯é çš„åˆ†å¸ƒå¼é”äº†ã€‚</p>
<h2 data-id="heading-12">æ¥ä¸‹æ¥è¦åšä»€ä¹ˆ</h2>
<p>æˆ‘ç°åœ¨ç®—æ˜¯æŠŠRaftçš„æ ¸å¿ƒåŸç†æƒ³é€šäº†ã€‚ä½†ä»ç†è§£åˆ°å®ç°ï¼Œè¿˜æœ‰ä¸å°‘è·ç¦»ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>æ—¥å¿—å‹ç¼©å’Œå¿«ç…§æ€ä¹ˆåšï¼Ÿ</li>
<li>é…ç½®å˜æ›´ï¼ˆåŠ¨æ€å¢åˆ èŠ‚ç‚¹ï¼‰æ€ä¹ˆå¤„ç†ï¼Ÿ</li>
<li>å„ç§è¾¹ç•Œæƒ…å†µå’Œç½‘ç»œå¼‚å¸¸æ€ä¹ˆåº”å¯¹ï¼Ÿ</li>
<li>æ€ä¹ˆä¼˜åŒ–æ€§èƒ½ï¼Ÿ</li>
</ul>
<p>è¿™äº›é—®é¢˜æˆ‘è¿˜æ²¡å®Œå…¨ç ”ç©¶é€ã€‚</p>
<p>æˆ‘æ‰“ç®—å†™ä¸€ä¸ª<strong>Simple Raft</strong>ç³»åˆ—ï¼Œä»æœ€ç®€å•çš„ç‰ˆæœ¬å¼€å§‹ï¼Œä¸€ç‚¹ç‚¹è¿­ä»£ï¼š</p>
<ol>
<li>ç¬¬ä¸€ç‰ˆï¼šåŸºæœ¬çš„é€‰ä¸¾å’Œå¿ƒè·³</li>
<li>ç¬¬äºŒç‰ˆï¼šæ—¥å¿—å¤åˆ¶å’Œæäº¤</li>
<li>ç¬¬ä¸‰ç‰ˆï¼šæŒä¹…åŒ–å’Œæ¢å¤</li>
<li>ç¬¬å››ç‰ˆï¼šæ—¥å¿—å‹ç¼©</li>
<li>ç¬¬äº”ç‰ˆï¼šç”¨å®ƒå®ç°åˆ†å¸ƒå¼é”</li>
</ol>
<p>ä»£ç ä¼šæ”¾åˆ°Giteeä¸Šï¼Œä¼šä»¥Nacosä¸ºåŸºç¡€ï¼Œæ‰‹å†™æ ¸å¿ƒä»£ç ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­è‚¯å®šä¼šé‡åˆ°å„ç§å‘ï¼Œåˆ°æ—¶å€™å†è®°å½•ä¸‹æ¥ã€‚æˆ‘è§‰å¾—è¿™ç§"è¾¹å†™è¾¹å­¦ï¼ŒæŠŠè¸©è¿‡çš„å‘è®°å½•ä¸‹æ¥"çš„æ–¹å¼ï¼Œåº”è¯¥ä¼šæ¯”çº¯ç†è®ºè®²è§£æ›´æœ‰æ„æ€ã€‚</p>
<p>è€Œä¸”è¯´å®è¯ï¼Œå¸‚é¢ä¸ŠRaftçš„æ–‡ç« å¾ˆå¤šï¼Œä½†å¤§å¤šéƒ½æ˜¯ç¿»è¯‘è®ºæ–‡ï¼Œæˆ–è€…çº¯è®²ç†è®ºã€‚æˆ‘æƒ³ç»“åˆè‡ªå·±åœ¨ç”Ÿäº§ç¯å¢ƒç»´æŠ¤Nacosã€RocketMQã€PostgreSQLçš„ç»éªŒï¼Œå†™ç‚¹ä¸ä¸€æ ·çš„ä¸œè¥¿ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>Raftå’ŒPostgreSQLçš„æµå¤åˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
<li>Raftå’ŒRocketMQçš„ä¸»ä»åŒæ­¥æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</li>
<li>ä»€ä¹ˆåœºæ™¯é€‚åˆç”¨Raftï¼Œä»€ä¹ˆåœºæ™¯ç”¨æœ€ç»ˆä¸€è‡´æ€§å°±å¤Ÿäº†ï¼Ÿ</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯å®é™…å·¥ä½œä¸­ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>å¥½äº†ï¼Œä»Šå¤©å°±å…ˆåˆ°è¿™é‡Œã€‚ç®—æ˜¯ç»™Simple Raftç³»åˆ—å¼€ä¸ªå¤´å§ã€‚</p>
<p>åé¢çš„æ–‡ç« ä¼šæ…¢æ…¢å†™ï¼Œä¸ç€æ€¥ï¼Œæƒ³æ¸…æ¥šäº†å†åŠ¨æ‰‹ã€‚æ¯•ç«Ÿæˆ‘è§‰å¾—ç†è§£åŸç†æ¯”æ€¥ç€å†™ä»£ç æ›´é‡è¦ã€‚</p>
<p>æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œå’±ä»¬ä¸€èµ·æŠŠRaftè¿™ä¸ªåˆ†å¸ƒå¼åŸºçŸ³ææ˜ç™½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆä½ çš„volatileæ€»å‡ºbugï¼Ÿå› ä¸ºä½ æ²¡ææ‡‚å†…å­˜å±éšœè¿™å›äº‹å„¿ ğŸ¤¯]]></title>    <link>https://juejin.cn/post/7573589277003972646</link>    <guid>https://juejin.cn/post/7573589277003972646</guid>    <pubDate>2025-11-18T02:09:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573589277003972646" data-draft-id="7573593395797671982" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆä½ çš„volatileæ€»å‡ºbugï¼Ÿå› ä¸ºä½ æ²¡ææ‡‚å†…å­˜å±éšœè¿™å›äº‹å„¿ ğŸ¤¯"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:09:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·6854537597769"/> <meta itemprop="url" content="https://juejin.cn/user/1601315325621550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆä½ çš„volatileæ€»å‡ºbugï¼Ÿå› ä¸ºä½ æ²¡ææ‡‚å†…å­˜å±éšœè¿™å›äº‹å„¿ ğŸ¤¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1601315325621550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·6854537597769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:09:36.000Z" title="Tue Nov 18 2025 02:09:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»28åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼•å…¥åœºæ™¯ï¼šçº¿ä¸Šç¿»è½¦çš„é‚£ä¸ªå¤œæ™š</h2>
<p>å‡Œæ™¨2ç‚¹ï¼Œæˆ‘è¢«ç”µè¯åµé†’ï¼š"ç³»ç»Ÿå‡ºç°æ•°æ®ä¸ä¸€è‡´äº†ï¼æ˜æ˜åŠ äº†<code>volatile</code>ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯æœ‰çº¿ç¨‹è¯»åˆ°äº†æ—§å€¼ï¼Ÿ"</p>
<p>é‚£æ˜¯ä¸€ä¸ªç»å…¸çš„åŒé‡æ£€æŸ¥é”ï¼ˆDCLï¼‰å•ä¾‹æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥</span>
            <span class="hljs-keyword">synchronized</span> (Singleton.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥</span>
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">// é—®é¢˜å°±å‡ºåœ¨è¿™ï¼</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>å¼€å‘åŒå­¦ä¸€è„¸æ‡µï¼š"æˆ‘åŠ äº†<code>volatile</code>å•Šï¼Œä¸æ˜¯è¯´èƒ½ä¿è¯å¯è§æ€§å—ï¼Ÿ"</p>
<p>æˆ‘é—®ä»–ï¼š"ä½ çŸ¥é“<code>volatile</code>åº•å±‚ç”¨äº†å“ªå‡ ç§å†…å­˜å±éšœå—ï¼ŸçŸ¥é“ä¸ºä»€ä¹ˆè¿™é‡Œå¿…é¡»ç”¨<code>volatile</code>è€Œä¸æ˜¯æ™®é€šå˜é‡å—ï¼Ÿ"</p>
<p>ä»–æ„£ä½äº†ã€‚</p>
<p>è¿™å°±æ˜¯ä»Šå¤©è¦èŠçš„ä¸»é¢˜ï¼š<strong>Javaå†…å­˜å±éšœ</strong>ã€‚å®ƒæ˜¯å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ï¼Œå´å¸¸è¢«å¿½è§†ã€‚é¢è¯•å®˜æœ€çˆ±é—®"volatileæ€ä¹ˆå®ç°çš„"ï¼Œç­”æ¡ˆå°±è—åœ¨å†…å­˜å±éšœé‡Œã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å¿«é€Ÿç†è§£ï¼šå†…å­˜å±éšœæ˜¯ä¸ªå•¥ï¼Ÿ</h2>
<h3 data-id="heading-2">é€šä¿—ç‰ˆ</h3>
<p>æƒ³è±¡ä½ åœ¨è¶…å¸‚ä¹°èœğŸ›’ï¼Œæœ‰ä¸ªæœåŠ¡å‘˜è´Ÿè´£æŠŠè´§æ¶ä¸Šçš„èœï¼ˆå†…å­˜ä¸­çš„æ•°æ®ï¼‰æ‹¿ç»™ä½ ï¼ˆCPUç¼“å­˜ï¼‰ã€‚<strong>å†…å­˜å±éšœå°±åƒè¶…å¸‚é‡Œçš„"ç¦æ­¢è¶…è½¦"æ ‡å¿—ç‰Œ</strong>ï¼Œå®ƒå‘Šè¯‰æœåŠ¡å‘˜ï¼š"åœ¨è¿™ä¸ªä½ç½®ä¹‹å‰çš„æ‰€æœ‰è®¢å•å¿…é¡»å¤„ç†å®Œï¼Œæ‰èƒ½å¤„ç†åé¢çš„è®¢å•ï¼"</p>
<h3 data-id="heading-3">æŠ€æœ¯å®šä¹‰</h3>
<p><strong>å†…å­˜å±éšœï¼ˆMemory Barrier/Fenceï¼‰</strong> æ˜¯ä¸€ç§CPUæŒ‡ä»¤ï¼Œç”¨äºæ§åˆ¶ç‰¹å®šæ¡ä»¶ä¸‹çš„å†…å­˜è®¿é—®é¡ºåºã€‚å®ƒå¼ºåˆ¶å¤„ç†å™¨åœ¨æ‰§è¡Œå±éšœåçš„æ“ä½œä¹‹å‰ï¼Œå®Œæˆå±éšœå‰çš„æ‰€æœ‰å†…å­˜æ“ä½œï¼Œå¹¶ç¡®ä¿è¿™äº›æ“ä½œå¯¹å…¶ä»–å¤„ç†å™¨å¯è§ã€‚</p>
<h3 data-id="heading-4">æ ¸å¿ƒä½œç”¨</h3>
<ol>
<li><strong>é˜²æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼šç¡®ä¿ä»£ç æ‰§è¡Œé¡ºåºç¬¦åˆç¨‹åºå‘˜çš„é¢„æœŸ</li>
<li><strong>ä¿è¯å†…å­˜å¯è§æ€§</strong>ï¼šç¡®ä¿ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œèƒ½è¢«å…¶ä»–çº¿ç¨‹ç«‹å³çœ‹åˆ°</li>
<li><strong>å»ºç«‹happens-beforeå…³ç³»</strong>ï¼šä¸ºJavaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æä¾›åº•å±‚æ”¯æŒ</li>
</ol>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜å±éšœï¼Ÿ</h2>
<h3 data-id="heading-6">3.1 é—®é¢˜1ï¼šæŒ‡ä»¤é‡æ’åºå¯¼è‡´çš„è¯¡å¼‚Bug</h3>
<p>ç°ä»£CPUä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚çœ‹ä¸ªçœŸå®æ¡ˆä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çº¿ç¨‹1</span>
x = <span class="hljs-number">1</span>;        <span class="hljs-comment">// æ­¥éª¤1</span>
flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ­¥éª¤2</span>

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-keyword">if</span> (flag) {         <span class="hljs-comment">// æ­¥éª¤3</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x + <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ­¥éª¤4ï¼ŒæœŸæœ›y=2</span>
}
</code></pre>
<p><strong>ä½ ä»¥ä¸ºçš„æ‰§è¡Œé¡ºåº</strong>ï¼šæ­¥éª¤1 â†’ æ­¥éª¤2 â†’ æ­¥éª¤3 â†’ æ­¥éª¤4<br/>
<strong>å®é™…å¯èƒ½çš„æ‰§è¡Œé¡ºåº</strong>ï¼šæ­¥éª¤2 â†’ æ­¥éª¤3 â†’ æ­¥éª¤4 â†’ æ­¥éª¤1ï¼ˆé‡æ’åºåï¼‰</p>
<p>ç»“æœï¼š<code>y</code>å¯èƒ½ç­‰äº1ï¼Œè€Œä¸æ˜¯æœŸæœ›çš„2ï¼ğŸ˜±</p>
<h3 data-id="heading-7">3.2 é—®é¢˜2ï¼šCPUç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ ¸å¿ƒ1æ‰§è¡Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
    data = <span class="hljs-number">42</span>;      <span class="hljs-comment">// å†™åˆ°CPU1çš„ç¼“å­˜</span>
    ready = <span class="hljs-literal">true</span>;   <span class="hljs-comment">// å†™åˆ°CPU1çš„ç¼“å­˜</span>
}

<span class="hljs-comment">// æ ¸å¿ƒ2æ‰§è¡Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (ready) {    <span class="hljs-comment">// ä»CPU2çš„ç¼“å­˜è¯»ï¼Œå¯èƒ½è¯»åˆ°æ—§å€¼false</span>
        <span class="hljs-keyword">return</span> data; <span class="hljs-comment">// å³ä½¿è¯»åˆ°trueï¼Œdataä¹Ÿå¯èƒ½è¿˜æ˜¯æ—§å€¼0</span>
    }
}
</code></pre>
<p>é—®é¢˜æ ¹æºï¼š<strong>CPUç¼“å­˜ä¸ä¼šå®æ—¶åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œå…¶ä»–æ ¸å¿ƒä¹Ÿä¸ä¼šå®æ—¶ä»ä¸»å†…å­˜åˆ·æ–°</strong>ã€‚</p>
<h3 data-id="heading-8">3.3 è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h3>









































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ€§èƒ½å¼€é”€</th><th>é€‚ç”¨åœºæ™¯</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>synchronized</strong></td><td>é«˜ï¼ˆæ¶‰åŠé”ç«äº‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰</td><td>éœ€è¦åŸå­æ€§æ“ä½œ</td><td>é‡é‡çº§ï¼Œé˜»å¡å¼</td></tr><tr><td><strong>volatile</strong></td><td>ä½ï¼ˆä»…å†…å­˜å±éšœï¼‰</td><td>å•ä¸ªå˜é‡çš„è¯»å†™</td><td>æ— æ³•ä¿è¯å¤åˆæ“ä½œåŸå­æ€§</td></tr><tr><td><strong>Lockæ¥å£</strong></td><td>ä¸­ç­‰ï¼ˆå¯é€‰æ‹©å…¬å¹³/éå…¬å¹³ï¼‰</td><td>å¤æ‚çš„åŒæ­¥åœºæ™¯</td><td>éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</td></tr><tr><td><strong>Atomicç±»</strong></td><td>ä½ï¼ˆCAS+å†…å­˜å±éšœï¼‰</td><td>è®¡æ•°å™¨ã€çŠ¶æ€æ ‡å¿—</td><td>ä»…æ”¯æŒç‰¹å®šç±»å‹</td></tr><tr><td><strong>æ™®é€šå˜é‡</strong></td><td>æ— </td><td>å•çº¿ç¨‹æˆ–ä¸å˜å¯¹è±¡</td><td>å¹¶å‘ç¯å¢ƒä¸å®‰å…¨</td></tr></tbody></table>
<p><strong>å†…å­˜å±éšœçš„ä¼˜åŠ¿</strong>ï¼šå®ƒæ˜¯<code>volatile</code>ã€<code>synchronized</code>ã€<code>Atomic</code>ç­‰å¹¶å‘å·¥å…·çš„åº•å±‚å®ç°æœºåˆ¶ï¼Œæ€§èƒ½å¼€é”€æœ€å°ã€‚</p>
<h3 data-id="heading-9">3.4 é€‚ç”¨ä¸ä¸é€‚ç”¨åœºæ™¯</h3>
<p>âœ… <strong>é€‚ç”¨åœºæ™¯</strong></p>
<ul>
<li>çŠ¶æ€æ ‡å¿—ä½ï¼ˆå¦‚<code>volatile boolean running</code>ï¼‰</li>
<li>åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼</li>
<li>å‘å¸ƒ/è®¢é˜…æ¨¡å¼ä¸­çš„æ•°æ®å…±äº«</li>
<li>é«˜æ€§èƒ½å¹¶å‘åº“çš„åº•å±‚å®ç°</li>
</ul>
<p>âŒ <strong>ä¸é€‚ç”¨åœºæ™¯</strong></p>
<ul>
<li>éœ€è¦ä¿è¯å¤åˆæ“ä½œåŸå­æ€§ï¼ˆå¦‚<code>count++</code>ï¼‰</li>
<li>éœ€è¦é˜»å¡ç­‰å¾…çš„åœºæ™¯</li>
<li>å¯¹æ€§èƒ½ä¸æ•æ„Ÿçš„æ™®é€šä¸šåŠ¡ä»£ç </li>
</ul>
<hr/>
<h2 data-id="heading-10">å››ã€Javaçš„å››ç§å†…å­˜å±éšœç±»å‹</h2>
<p>Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰å®šä¹‰äº†4ç§å†…å­˜å±éšœï¼š</p>
<h3 data-id="heading-11">4.1 LoadLoadå±éšœï¼ˆè¯»-è¯»å±éšœï¼‰</h3>
<p><strong>è¯­ä¹‰</strong>ï¼š<code>Load1; LoadLoad; Load2</code><br/>
<strong>ä½œç”¨</strong>ï¼šç¡®ä¿<code>Load1</code>çš„æ•°æ®<strong>è¯»å–</strong>å…ˆäº<code>Load2</code>åŠåç»­æ‰€æœ‰è¯»æ“ä½œ</p>
<p><strong>å®é™…åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‡è®¾çº¿ç¨‹1å†™å…¥</span>
obj.field1 = <span class="hljs-number">1</span>;
obj.field2 = <span class="hljs-number">2</span>;

<span class="hljs-comment">// çº¿ç¨‹2è¯»å–ï¼ˆéœ€è¦LoadLoadå±éšœï¼‰</span>
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> obj.field1;  <span class="hljs-comment">// Load1</span>
<span class="hljs-comment">// &lt;LoadLoadå±éšœ&gt;</span>
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> obj.field2;  <span class="hljs-comment">// Load2ï¼Œä¿è¯ä¸€å®šèƒ½è¯»åˆ°æœ€æ–°çš„field1</span>
</code></pre>
<h3 data-id="heading-12">4.2 StoreStoreå±éšœï¼ˆå†™-å†™å±éšœï¼‰</h3>
<p><strong>è¯­ä¹‰</strong>ï¼š<code>Store1; StoreStore; Store2</code><br/>
<strong>ä½œç”¨</strong>ï¼šç¡®ä¿<code>Store1</code>çš„æ•°æ®<strong>åˆ·æ–°åˆ°ä¸»å†…å­˜</strong>å…ˆäº<code>Store2</code>åŠåç»­æ‰€æœ‰å†™æ“ä½œ</p>
<p><strong>å®é™…åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataPublisher</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> data;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> ready;  <span class="hljs-comment">// volatileå†™ä¼šæ’å…¥StoreStoreå±éšœ</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">()</span> {
        data = <span class="hljs-number">42</span>;        <span class="hljs-comment">// Store1ï¼šæ™®é€šå†™</span>
        <span class="hljs-comment">// &lt;StoreStoreå±éšœ&gt;</span>
        ready = <span class="hljs-literal">true</span>;     <span class="hljs-comment">// Store2ï¼švolatileå†™ï¼Œç¡®ä¿dataå…ˆåˆ·æ–°åˆ°ä¸»å†…å­˜</span>
    }
}
</code></pre>
<h3 data-id="heading-13">4.3 LoadStoreå±éšœï¼ˆè¯»-å†™å±éšœï¼‰</h3>
<p><strong>è¯­ä¹‰</strong>ï¼š<code>Load1; LoadStore; Store2</code><br/>
<strong>ä½œç”¨</strong>ï¼šç¡®ä¿<code>Load1</code>çš„æ•°æ®<strong>è¯»å–</strong>å…ˆäº<code>Store2</code>åŠåç»­æ‰€æœ‰å†™æ“ä½œ</p>
<p><strong>å®é™…åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é˜²æ­¢è¯»æ“ä½œè¢«é‡æ’åºåˆ°å†™æ“ä½œä¹‹å</span>
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> sharedVar;  <span class="hljs-comment">// Load1</span>
<span class="hljs-comment">// &lt;LoadStoreå±éšœ&gt;</span>
localVar = <span class="hljs-number">100</span>;     <span class="hljs-comment">// Store2</span>
</code></pre>
<h3 data-id="heading-14">4.4 StoreLoadå±éšœï¼ˆå†™-è¯»å±éšœï¼‰â­ æœ€é‡è¦ï¼</h3>
<p><strong>è¯­ä¹‰</strong>ï¼š<code>Store1; StoreLoad; Load2</code><br/>
<strong>ä½œç”¨</strong>ï¼šç¡®ä¿<code>Store1</code>çš„æ•°æ®<strong>åˆ·æ–°åˆ°ä¸»å†…å­˜</strong>å…ˆäº<code>Load2</code>åŠåç»­æ‰€æœ‰è¯»æ“ä½œ</p>
<p>âš ï¸ <strong>è¿™æ˜¯å¼€é”€æœ€å¤§çš„å±éšœ</strong>ï¼Œå®ƒä¼šè®©å†™ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚</p>
<p><strong>å®é™…åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> sharedVar;  <span class="hljs-comment">// volatileåŒæ—¶å…·æœ‰è¯»å†™å±éšœ</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        sharedVar = <span class="hljs-number">1</span>;  <span class="hljs-comment">// volatileå†™ï¼Œåé¢æ’å…¥StoreLoadå±éšœ</span>
        <span class="hljs-comment">// &lt;StoreLoadå±éšœ&gt;</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// &lt;StoreLoadå±éšœ&gt;</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> sharedVar;  <span class="hljs-comment">// volatileè¯»ï¼Œå‰é¢æ’å…¥StoreLoadå±éšœ</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-15">äº”ã€åŸºç¡€ç”¨æ³•ï¼švolatileä¸å†…å­˜å±éšœ</h2>
<h3 data-id="heading-16">5.1 volatileçš„å†…å­˜å±éšœè§„åˆ™ï¼ˆğŸ”¥é¢è¯•é«˜é¢‘ï¼‰</h3>
<p>JMMå¯¹<code>volatile</code>å˜é‡çš„è¯»å†™æ“ä½œï¼Œä¼šè‡ªåŠ¨æ’å…¥å†…å­˜å±éšœï¼š</p>



































<table><thead><tr><th>æ“ä½œç±»å‹</th><th>æ’å…¥ä½ç½®</th><th>å±éšœç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>volatileå†™</strong></td><td>å†™æ“ä½œ<strong>ä¹‹å‰</strong></td><td>StoreStore</td><td>é˜²æ­¢å‰é¢çš„æ™®é€šå†™ä¸volatileå†™é‡æ’åº</td></tr><tr><td><strong>volatileå†™</strong></td><td>å†™æ“ä½œ<strong>ä¹‹å</strong></td><td>StoreLoad</td><td>é˜²æ­¢volatileå†™ä¸åé¢çš„volatileè¯»/å†™é‡æ’åº</td></tr><tr><td><strong>volatileè¯»</strong></td><td>è¯»æ“ä½œ<strong>ä¹‹å</strong></td><td>LoadLoad</td><td>é˜²æ­¢volatileè¯»ä¸åé¢çš„æ™®é€šè¯»é‡æ’åº</td></tr><tr><td><strong>volatileè¯»</strong></td><td>è¯»æ“ä½œ<strong>ä¹‹å</strong></td><td>LoadStore</td><td>é˜²æ­¢volatileè¯»ä¸åé¢çš„æ™®é€šå†™é‡æ’åº</td></tr></tbody></table>
<h3 data-id="heading-17">5.2 å®Œæ•´ä»£ç ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryBarrierDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">data1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">data2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">ready</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// å…³é”®ï¼švolatileå˜é‡</span>
    
    <span class="hljs-comment">// ğŸ”¥é¢è¯•è€ƒç‚¹ï¼šä¸ºä»€ä¹ˆè¿™é‡Œå¿…é¡»ç”¨volatileï¼Ÿ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        data1 = <span class="hljs-number">1</span>;              <span class="hljs-comment">// æ™®é€šå†™</span>
        data2 = <span class="hljs-number">2</span>;              <span class="hljs-comment">// æ™®é€šå†™</span>
        <span class="hljs-comment">// &lt;StoreStoreå±éšœ&gt;ï¼šç¡®ä¿data1/data2å…ˆåˆ·æ–°åˆ°ä¸»å†…å­˜</span>
        ready = <span class="hljs-literal">true</span>;           <span class="hljs-comment">// volatileå†™</span>
        <span class="hljs-comment">// &lt;StoreLoadå±éšœ&gt;ï¼šç¡®ä¿readyçš„å†™å¯¹å…¶ä»–çº¿ç¨‹å¯è§</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// &lt;LoadLoadå±éšœ&gt;</span>
        <span class="hljs-comment">// &lt;LoadStoreå±éšœ&gt;</span>
        <span class="hljs-keyword">if</span> (ready) {            <span class="hljs-comment">// volatileè¯»</span>
            <span class="hljs-comment">// èƒ½ä¿è¯è¯»åˆ°data1=1, data2=2</span>
            System.out.println(data1 + <span class="hljs-string">", "</span> + data2);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">MemoryBarrierDemo</span> <span class="hljs-variable">demo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MemoryBarrierDemo</span>();
        
        <span class="hljs-comment">// å†™çº¿ç¨‹</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">writerThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            demo.writer();
            System.out.println(<span class="hljs-string">"æ•°æ®å·²å‘å¸ƒ"</span>);
        });
        
        <span class="hljs-comment">// è¯»çº¿ç¨‹</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">readerThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">while</span> (!demo.ready) {  <span class="hljs-comment">// è‡ªæ—‹ç­‰å¾…</span>
                <span class="hljs-comment">// å¦‚æœreadyä¸æ˜¯volatileï¼Œè¿™é‡Œå¯èƒ½æ°¸è¿œè¯»ä¸åˆ°trueï¼</span>
            }
            demo.reader();
        });
        
        readerThread.start();
        Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// ç¡®ä¿è¯»çº¿ç¨‹å…ˆå¯åŠ¨</span>
        writerThread.start();
        
        writerThread.join();
        readerThread.join();
    }
}
</code></pre>
<p><strong>ä»£ç è§£æï¼ˆé¢è¯•å¿…è€ƒï¼‰</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä¸ºä»€ä¹ˆ<code>ready</code>å¿…é¡»æ˜¯<code>volatile</code>ï¼Ÿ</strong><br/>
â†’ å¦‚æœä¸åŠ <code>volatile</code>ï¼Œå†™çº¿ç¨‹å¯¹<code>ready</code>çš„ä¿®æ”¹å¯èƒ½ä¸€ç›´åœç•™åœ¨CPUç¼“å­˜ä¸­ï¼Œè¯»çº¿ç¨‹æ°¸è¿œè¯»ä¸åˆ°<code>true</code>ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆèƒ½ä¿è¯è¯»åˆ°æœ€æ–°çš„<code>data1</code>å’Œ<code>data2</code>ï¼Ÿ</strong><br/>
â†’ <code>volatile</code>å†™ä¹‹å‰çš„<code>StoreStore</code>å±éšœï¼Œç¡®ä¿æ™®é€šå˜é‡å…ˆåˆ·æ–°åˆ°ä¸»å†…å­˜ï¼›<code>volatile</code>è¯»ä¹‹åçš„<code>LoadLoad</code>å±éšœï¼Œç¡®ä¿ä»ä¸»å†…å­˜è¯»å–æœ€æ–°å€¼ã€‚</p>
</li>
<li>
<p><strong>å¦‚æœå»æ‰<code>volatile</code>ä¼šæ€æ ·ï¼Ÿ</strong><br/>
â†’ å¯èƒ½å‡ºç°3ç§æƒ…å†µï¼š</p>
<ul>
<li>è¯»çº¿ç¨‹æ°¸è¿œè¯»ä¸åˆ°<code>ready=true</code>ï¼ˆå¯è§æ€§é—®é¢˜ï¼‰</li>
<li>è¯»åˆ°<code>ready=true</code>ï¼Œä½†<code>data1/data2</code>è¿˜æ˜¯0ï¼ˆæŒ‡ä»¤é‡æ’åºï¼‰</li>
<li>å¶å°”èƒ½æ­£å¸¸å·¥ä½œï¼ˆå–å†³äºCPUç¼“å­˜åŒæ­¥æ—¶æœºï¼‰</li>
</ul>
</li>
</ol>
<h3 data-id="heading-18">5.3 synchronizedçš„éšå¼å†…å­˜å±éšœ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedBarrier</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">sharedData</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿›å…¥synchronizedå‰ï¼šè·å–é” + LoadLoad + LoadStoreå±éšœ</span>
        <span class="hljs-keyword">synchronized</span> (lock) {
            sharedData++;  <span class="hljs-comment">// ğŸ”¥é¢è¯•é¢˜ï¼šè¿™é‡Œçš„++æ“ä½œæ˜¯åŸå­çš„å—ï¼Ÿ</span>
        }
        <span class="hljs-comment">// é€€å‡ºsynchronizedåï¼šStoreStore + StoreLoadå±éšœ + é‡Šæ”¾é”</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><code>synchronized</code>åœ¨<strong>è·å–é”å</strong>æ’å…¥<code>LoadLoad</code>å’Œ<code>LoadStore</code>å±éšœ</li>
<li><code>synchronized</code>åœ¨<strong>é‡Šæ”¾é”å‰</strong>æ’å…¥<code>StoreStore</code>å’Œ<code>StoreLoad</code>å±éšœ</li>
<li>è¿™ç¡®ä¿äº†ä¸´ç•ŒåŒºå†…çš„æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°ä¸´ç•ŒåŒºå¤–</li>
</ul>
<hr/>
<h2 data-id="heading-19">â­ å…­ã€åº•å±‚åŸç†æ·±æŒ–ï¼ˆé‡ç‚¹ç« èŠ‚ï¼‰</h2>
<h3 data-id="heading-20">6.1 ä»CPUæ¶æ„çœ‹å†…å­˜å±éšœ</h3>
<p>ç°ä»£CPUä¸ºäº†æå‡æ€§èƒ½ï¼Œé‡‡ç”¨äº†å¤šçº§ç¼“å­˜æ¶æ„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[CPU Core 1] --&gt; B[L1 Cache]
    B --&gt; C[L2 Cache]
    C --&gt; D[L3 Cache å…±äº«]
    E[CPU Core 2] --&gt; F[L1 Cache]
    F --&gt; G[L2 Cache]
    G --&gt; D
    D --&gt; H[Main Memory ä¸»å†…å­˜]
    
    style A fill:#ff9999
    style E fill:#99ccff
    style D fill:#99ff99
    style H fill:#ffcc99
</code></pre>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼š</p>
<ol>
<li><strong>Store Bufferï¼ˆå†™ç¼“å†²åŒºï¼‰</strong>ï¼šCPUå†™æ•°æ®æ—¶å…ˆæ”¾åˆ°å†™ç¼“å†²åŒºï¼Œå¼‚æ­¥åˆ·æ–°åˆ°ç¼“å­˜/å†…å­˜</li>
<li><strong>Invalidate Queueï¼ˆå¤±æ•ˆé˜Ÿåˆ—ï¼‰</strong>ï¼šCPUæ”¶åˆ°ç¼“å­˜å¤±æ•ˆæ¶ˆæ¯æ—¶ï¼Œå…ˆæ”¾é˜Ÿåˆ—ï¼Œå¼‚æ­¥å¤„ç†</li>
<li><strong>æŒ‡ä»¤æµæ°´çº¿</strong>ï¼šCPUå¯ä»¥ä¹±åºæ‰§è¡ŒæŒ‡ä»¤ï¼Œåªè¦ç»“æœæ­£ç¡®å³å¯</li>
</ol>
<h3 data-id="heading-21">6.2 volatileçš„å­—èŠ‚ç ä¸æ±‡ç¼–å®ç°ï¼ˆğŸ”¥é«˜é¢‘é¢è¯•ï¼‰</h3>
<p>çœ‹ä¸€æ®µç®€å•çš„volatileå†™æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileTest</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(<span class="hljs-type">int</span> newValue)</span> {
        value = newValue;  <span class="hljs-comment">// volatileå†™</span>
    }
}
</code></pre>
<p><strong>å­—èŠ‚ç åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setValue</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>;
  Code:
    <span class="hljs-number">0</span>: aload_0
    <span class="hljs-number">1</span>: iload_1
    <span class="hljs-number">2</span>: putfield      #<span class="hljs-number">2</span>  <span class="hljs-comment">// Field value:I</span>
    <span class="hljs-number">5</span>: <span class="hljs-keyword">return</span>
</code></pre>
<p>å…³é”®æ˜¯<code>putfield</code>æŒ‡ä»¤å¯¹volatileå­—æ®µçš„å¤„ç†ï¼</p>
<p><strong>æ±‡ç¼–å±‚é¢ï¼ˆx86æ¶æ„ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-assembly" lang="assembly">mov    0x68(%rsi),%edi  ; å°†newValueåŠ è½½åˆ°å¯„å­˜å™¨
mov    %edi,0xc(%r10)   ; å†™å…¥å†…å­˜åœ°å€
lock addl $0x0,(%rsp)   ; ğŸ”¥å…³é”®ï¼šlockå‰ç¼€æŒ‡ä»¤ï¼
</code></pre>
<p><strong>lockæŒ‡ä»¤çš„ä½œç”¨ï¼ˆé¢è¯•å¿…ç­”ï¼‰</strong>ï¼š</p>
<ol>
<li><strong>é”å®šç¼“å­˜è¡Œ</strong>ï¼šç¡®ä¿å¯¹å†…å­˜çš„è¯»æ”¹å†™æ“ä½œæ˜¯åŸå­çš„</li>
<li><strong>åˆ·æ–°å†™ç¼“å†²åŒº</strong>ï¼šå¼ºåˆ¶å°†Store Bufferä¸­çš„æ•°æ®å†™å…¥ç¼“å­˜</li>
<li><strong>è§¦å‘ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆMESIï¼‰</strong>ï¼šä½¿å…¶ä»–CPUçš„ç¼“å­˜å¤±æ•ˆ</li>
<li><strong>é˜»æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼šç›¸å½“äºä¸€ä¸ªå…¨èƒ½å±éšœï¼ˆStoreLoadï¼‰</li>
</ol>
<h3 data-id="heading-22">6.3 MESIç¼“å­˜ä¸€è‡´æ€§åè®®</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; Invalid
    Invalid --&gt; Exclusive: CPUè¯»å–ï¼ˆæ— å…¶ä»–å‰¯æœ¬ï¼‰
    Invalid --&gt; Shared: CPUè¯»å–ï¼ˆæœ‰å…¶ä»–å‰¯æœ¬ï¼‰
    Exclusive --&gt; Modified: CPUå†™å…¥
    Exclusive --&gt; Shared: å…¶ä»–CPUè¯»å–
    Shared --&gt; Modified: CPUå†™å…¥ï¼ˆéœ€é€šçŸ¥å…¶ä»–CPUå¤±æ•ˆï¼‰
    Shared --&gt; Invalid: å…¶ä»–CPUå†™å…¥
    Modified --&gt; Invalid: å…¶ä»–CPUå†™å…¥
    Modified --&gt; Shared: å…¶ä»–CPUè¯»å–ï¼ˆéœ€å†™å›ä¸»å†…å­˜ï¼‰
</code></pre>
<p><strong>å››ç§çŠ¶æ€</strong>ï¼š</p>
<ul>
<li><strong>Mï¼ˆModifiedï¼‰</strong>ï¼šç¼“å­˜è¡Œè¢«ä¿®æ”¹ï¼Œä¸ä¸»å†…å­˜ä¸ä¸€è‡´ï¼Œåªæœ‰å½“å‰CPUæŒæœ‰</li>
<li><strong>Eï¼ˆExclusiveï¼‰</strong>ï¼šç¼“å­˜è¡Œç‹¬å ï¼Œä¸ä¸»å†…å­˜ä¸€è‡´ï¼Œåªæœ‰å½“å‰CPUæŒæœ‰</li>
<li><strong>Sï¼ˆSharedï¼‰</strong>ï¼šç¼“å­˜è¡Œå…±äº«ï¼Œä¸ä¸»å†…å­˜ä¸€è‡´ï¼Œå¤šä¸ªCPUæŒæœ‰</li>
<li><strong>Iï¼ˆInvalidï¼‰</strong>ï¼šç¼“å­˜è¡Œæ— æ•ˆ</li>
</ul>
<p><strong>volatileå†™è§¦å‘çš„MESIæ“ä½œ</strong>ï¼š</p>
<ol>
<li>CPUæ‰§è¡Œ<code>lock</code>æŒ‡ä»¤ â†’ å°†ModifiedçŠ¶æ€çš„ç¼“å­˜è¡Œå†™å›ä¸»å†…å­˜</li>
<li>å‘é€Invalidateæ¶ˆæ¯ â†’ å…¶ä»–CPUçš„ç¼“å­˜è¡Œå˜ä¸ºInvalid</li>
<li>å…¶ä»–CPUæ”¶åˆ°æ¶ˆæ¯ â†’ æ¸…ç©ºå¤±æ•ˆé˜Ÿåˆ—ï¼Œç¡®ä¿è¯»åˆ°æœ€æ–°å€¼</li>
</ol>
<h3 data-id="heading-23">6.4 JVMå±‚é¢çš„å®ç°ï¼šUnsafeç±»</h3>
<p>JVMé€šè¿‡<code>sun.misc.Unsafe</code>ç±»å®ç°åº•å±‚å†…å­˜å±éšœï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Unsafe</span> {
    <span class="hljs-comment">// ğŸ”¥ä¸‰ç§åŸºç¡€å†…å­˜å±éšœ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadFence</span><span class="hljs-params">()</span>;    <span class="hljs-comment">// LoadLoad + LoadStore</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">storeFence</span><span class="hljs-params">()</span>;   <span class="hljs-comment">// StoreStore + LoadStore</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fullFence</span><span class="hljs-params">()</span>;    <span class="hljs-comment">// æ‰€æœ‰å±éšœï¼ˆæœ€å¼ºï¼‰</span>
    
    <span class="hljs-comment">// volatileå†™çš„ç­‰ä»·å®ç°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">volatileWrite</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> value)</span> {
        putIntVolatile(o, offset, value);
        <span class="hljs-comment">// å†…éƒ¨å®ç°ï¼š</span>
        <span class="hljs-comment">// putInt(o, offset, value);</span>
        <span class="hljs-comment">// fullFence();  // æ’å…¥å…¨å±éšœ</span>
    }
}
</code></pre>
<p><strong>æŸ¥çœ‹OpenJDKæºç ï¼ˆjdk8u/hotspotï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hotspot/src/share/vm/prims/unsafe.cpp</span>
<span class="hljs-built_in">UNSAFE_ENTRY</span>(<span class="hljs-type">void</span>, <span class="hljs-built_in">Unsafe_LoadFence</span>(JNIEnv *env, jobject unsafe))
  <span class="hljs-built_in">UnsafeWrapper</span>(<span class="hljs-string">"Unsafe_LoadFence"</span>);
  OrderAccess::<span class="hljs-built_in">acquire</span>();  <span class="hljs-comment">// è°ƒç”¨å¹³å°ç›¸å…³çš„å±éšœå®ç°</span>
<span class="hljs-function">UNSAFE_END

<span class="hljs-title">UNSAFE_ENTRY</span><span class="hljs-params">(<span class="hljs-type">void</span>, Unsafe_StoreFence(JNIEnv *env, jobject unsafe))</span>
  <span class="hljs-title">UnsafeWrapper</span><span class="hljs-params">(<span class="hljs-string">"Unsafe_StoreFence"</span>)</span></span>;
  OrderAccess::<span class="hljs-built_in">release</span>();
<span class="hljs-function">UNSAFE_END

<span class="hljs-title">UNSAFE_ENTRY</span><span class="hljs-params">(<span class="hljs-type">void</span>, Unsafe_FullFence(JNIEnv *env, jobject unsafe))</span>
  <span class="hljs-title">UnsafeWrapper</span><span class="hljs-params">(<span class="hljs-string">"Unsafe_FullFence"</span>)</span></span>;
  OrderAccess::<span class="hljs-built_in">fence</span>();    <span class="hljs-comment">// å®Œæ•´å†…å­˜å±éšœ</span>
UNSAFE_END
</code></pre>
<p><strong>x86å¹³å°å®ç°ï¼ˆhotspot/src/os_cpu/linux_x86ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">OrderAccess::fence</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (os::<span class="hljs-built_in">is_MP</span>()) {
    <span class="hljs-comment">// lockå‰ç¼€æŒ‡ä»¤ = å…¨å±éšœ</span>
    <span class="hljs-function">__asm__ <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">"lock; addl $0,0(%%rsp)"</span> : : : <span class="hljs-string">"cc"</span>, <span class="hljs-string">"memory"</span>)</span></span>;
  }
}

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">OrderAccess::acquire</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// x86çš„TSOæ¨¡å‹ï¼Œè¯»åä¸éœ€è¦é¢å¤–å±éšœ</span>
  <span class="hljs-comment">// ä½†ä¸ºäº†è·¨å¹³å°ï¼Œä½¿ç”¨compiler barrier</span>
  <span class="hljs-function">__asm__ <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">""</span> : : : <span class="hljs-string">"memory"</span>)</span></span>;
}

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">OrderAccess::release</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// x86çš„å†™å±éšœæ˜¯å…è´¹çš„ï¼ˆStore Bufferè‡ªåŠ¨ä¿è¯é¡ºåºï¼‰</span>
  <span class="hljs-function">__asm__ <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">""</span> : : : <span class="hljs-string">"memory"</span>)</span></span>;
}
</code></pre>
<h3 data-id="heading-24">6.5 ä¸åŒCPUæ¶æ„çš„å±éšœæŒ‡ä»¤å¯¹æ¯”</h3>








































<table><thead><tr><th>CPUæ¶æ„</th><th>å†…å­˜æ¨¡å‹</th><th>StoreLoadå±éšœ</th><th>LoadLoadå±éšœ</th><th>StoreStoreå±éšœ</th></tr></thead><tbody><tr><td><strong>x86/x64</strong></td><td>TSOï¼ˆå¼ºæ¨¡å‹ï¼‰</td><td><code>mfence</code> æˆ– <code>lock</code></td><td>å…è´¹ï¼ˆç¡¬ä»¶ä¿è¯ï¼‰</td><td>å…è´¹ï¼ˆç¡¬ä»¶ä¿è¯ï¼‰</td></tr><tr><td><strong>ARM</strong></td><td>å¼±æ¨¡å‹</td><td><code>dmb</code></td><td><code>dmb</code></td><td><code>dmb</code></td></tr><tr><td><strong>PowerPC</strong></td><td>å¼±æ¨¡å‹</td><td><code>sync</code></td><td><code>lwsync</code></td><td><code>lwsync</code></td></tr><tr><td><strong>SPARC</strong></td><td>TSO</td><td><code>membar #StoreLoad</code></td><td>å…è´¹</td><td>å…è´¹</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆx86æ€§èƒ½æ›´å¥½ï¼Ÿ</strong><br/>
â†’ x86çš„TSOï¼ˆTotal Store Orderï¼‰æ¨¡å‹ç¡¬ä»¶ä¿è¯äº†å¤§éƒ¨åˆ†é¡ºåºï¼Œåªæœ‰StoreLoadéœ€è¦æ˜¾å¼å±éšœã€‚ARMç­‰å¼±æ¨¡å‹CPUéœ€è¦æ›´å¤šçš„å†…å­˜å±éšœæŒ‡ä»¤ã€‚</p>
<h3 data-id="heading-25">6.6 åŒé‡æ£€æŸ¥é”çš„å†…å­˜å±éšœåˆ†æï¼ˆğŸ”¥å¿…è€ƒï¼‰</h3>
<p>å›åˆ°å¼€ç¯‡çš„å•ä¾‹æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {          <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼ˆè¯»ï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (Singleton.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼ˆè¯»ï¼‰</span>
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">// ğŸ”¥é—®é¢˜æ ¸å¿ƒ</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå¿…é¡»ç”¨volatileï¼Ÿçœ‹å­—èŠ‚ç ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">new</span> Singleton         <span class="hljs-comment">// æ­¥éª¤1ï¼šåˆ†é…å†…å­˜</span>
dup
invokespecial &lt;<span class="hljs-keyword">init</span>&gt; <span class="hljs-comment">// æ­¥éª¤2ï¼šè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–</span>
putstatic instance   <span class="hljs-comment">// æ­¥éª¤3ï¼šå°†å¼•ç”¨èµ‹å€¼ç»™instance</span>
</code></pre>
<p><strong>æ²¡æœ‰volatileæ—¶å¯èƒ½çš„é‡æ’åº</strong>ï¼š</p>
<pre><code class="hljs">æ­¥éª¤1ï¼šåˆ†é…å†…å­˜
æ­¥éª¤3ï¼šå°†å¼•ç”¨èµ‹å€¼ç»™instanceï¼ˆæ­¤æ—¶å¯¹è±¡æœªåˆå§‹åŒ–ï¼ï¼‰
æ­¥éª¤2ï¼šè°ƒç”¨æ„é€ å‡½æ•°
</code></pre>
<p><strong>çº¿ç¨‹äº¤äº’æ—¶åºå›¾</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T1 as çº¿ç¨‹1ï¼ˆå†™ï¼‰
    participant Memory as ä¸»å†…å­˜
    participant T2 as çº¿ç¨‹2ï¼ˆè¯»ï¼‰
    
    Note over T1: instance == null
    T1-&gt;&gt;T1: è·å–é”
    T1-&gt;&gt;Memory: åˆ†é…å†…å­˜ç©ºé—´
    T1-&gt;&gt;Memory: èµ‹å€¼å¼•ç”¨ï¼ˆæœªåˆå§‹åŒ–ï¼ï¼‰
    Note over T2: è¯»åˆ°instance != null
    T2-&gt;&gt;T2: è·³è¿‡é”ï¼Œç›´æ¥è¿”å›
    Note over T2: ä½¿ç”¨æœªåˆå§‹åŒ–çš„å¯¹è±¡ ğŸ’¥
    T1-&gt;&gt;Memory: è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–
    T1-&gt;&gt;T1: é‡Šæ”¾é”
</code></pre>
<p><strong>åŠ ä¸Švolatileåçš„ä¿è¯</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;

<span class="hljs-comment">// volatileå†™æ’å…¥çš„å±éšœï¼š</span>
<span class="hljs-comment">// &lt;StoreStoreå±éšœ&gt;ï¼šç¡®ä¿æ„é€ å‡½æ•°æ‰§è¡Œå®Œæ¯•</span>
instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  
<span class="hljs-comment">// &lt;StoreLoadå±éšœ&gt;ï¼šç¡®ä¿å…¶ä»–çº¿ç¨‹èƒ½è¯»åˆ°å®Œæ•´å¯¹è±¡</span>
</code></pre>
<h3 data-id="heading-26">6.7 ç‰ˆæœ¬æ¼”è¿›ï¼šJDK 9çš„VarHandle</h3>
<p>JDK 9å¼•å…¥äº†<code>VarHandle</code>ï¼Œæä¾›æ›´ç»†ç²’åº¦çš„å†…å­˜è®¿é—®æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VarHandleExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> VarHandle VALUE_HANDLE;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            MethodHandles.<span class="hljs-type">Lookup</span> <span class="hljs-variable">lookup</span> <span class="hljs-operator">=</span> MethodHandles.lookup();
            VALUE_HANDLE = lookup.findVarHandle(
                VarHandleExample.class, <span class="hljs-string">"value"</span>, <span class="hljs-type">int</span>.class
            );
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(e);
        }
    }
    
    <span class="hljs-comment">// ğŸ”¥å¯ä»¥é€‰æ‹©ä¸åŒçš„è®¿é—®æ¨¡å¼</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">differentAccessModes</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. æ™®é€šè¯»å†™ï¼ˆæ— ä¿è¯ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) VALUE_HANDLE.get(<span class="hljs-built_in">this</span>);
        VALUE_HANDLE.set(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);
        
        <span class="hljs-comment">// 2. Opaqueæ¨¡å¼ï¼ˆä¿è¯åŸå­æ€§ï¼Œæ— é¡ºåºä¿è¯ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) VALUE_HANDLE.getOpaque(<span class="hljs-built_in">this</span>);
        VALUE_HANDLE.setOpaque(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);
        
        <span class="hljs-comment">// 3. Release/Acquireæ¨¡å¼ï¼ˆå•å‘å±éšœï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) VALUE_HANDLE.getAcquire(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// LoadLoad + LoadStore</span>
        VALUE_HANDLE.setRelease(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);              <span class="hljs-comment">// StoreStore + LoadStore</span>
        
        <span class="hljs-comment">// 4. Volatileæ¨¡å¼ï¼ˆå®Œæ•´å±éšœï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">v4</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) VALUE_HANDLE.getVolatile(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// ç­‰åŒäºvolatileè¯»</span>
        VALUE_HANDLE.setVolatile(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);              <span class="hljs-comment">// ç­‰åŒäºvolatileå†™</span>
    }
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼ˆJMHåŸºå‡†æµ‹è¯•ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Benchmark                          Mode  Cnt   Score   Error  Units
plainAccess                        avgt   25   0.312 Â± 0.001  ns/op
opaqueAccess                       avgt   25   0.315 Â± 0.002  ns/op
acquireReleaseAccess               avgt   25   0.318 Â± 0.001  ns/op
volatileAccess                     avgt   25   0.825 Â± 0.003  ns/op  // æœ€æ…¢
</code></pre>
<hr/>
<h2 data-id="heading-27">ä¸ƒã€æ€§èƒ½åˆ†æä¸ä¼˜åŒ–</h2>
<h3 data-id="heading-28">7.1 å†…å­˜å±éšœçš„æ€§èƒ½å¼€é”€</h3>
<p><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼šIntel i7-10700K, 16GB DDR4-3200, Ubuntu 20.04, JDK 11</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@BenchmarkMode(Mode.AverageTime)</span>
<span class="hljs-meta">@OutputTimeUnit(TimeUnit.NANOSECONDS)</span>
<span class="hljs-meta">@State(Scope.Thread)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BarrierBenchmark</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">plainVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">volatileVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicVar</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">plainRead</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> plainVar;  <span class="hljs-comment">// æ— å±éšœ</span>
    }
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">volatileRead</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> volatileVar;  <span class="hljs-comment">// LoadLoad + LoadStore</span>
    }
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">plainWrite</span><span class="hljs-params">()</span> {
        plainVar = <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ— å±éšœ</span>
    }
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">volatileWrite</span><span class="hljs-params">()</span> {
        volatileVar = <span class="hljs-number">1</span>;  <span class="hljs-comment">// StoreStore + StoreLoad</span>
    }
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">atomicRead</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> atomicVar.get();  <span class="hljs-comment">// volatileè¯»</span>
    }
    
    <span class="hljs-meta">@Benchmark</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">atomicIncrement</span><span class="hljs-params">()</span> {
        atomicVar.incrementAndGet();  <span class="hljs-comment">// CAS + å†…å­˜å±éšœ</span>
    }
}
</code></pre>
<p><strong>æ€§èƒ½æµ‹è¯•ç»“æœ</strong>ï¼š</p>















































<table><thead><tr><th>æ“ä½œç±»å‹</th><th>è€—æ—¶ï¼ˆns/opï¼‰</th><th>ç›¸å¯¹å¼€é”€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ™®é€šå˜é‡è¯»</td><td>0.31</td><td>1xï¼ˆåŸºçº¿ï¼‰</td><td>æ— ä»»ä½•å±éšœ</td></tr><tr><td>volatileè¯»</td><td>0.32</td><td>1.03x</td><td>LoadLoad+LoadStoreï¼ˆx86å‡ ä¹å…è´¹ï¼‰</td></tr><tr><td>æ™®é€šå˜é‡å†™</td><td>0.31</td><td>1x</td><td>æ— ä»»ä½•å±éšœ</td></tr><tr><td>volatileå†™</td><td>2.85</td><td>9.2x</td><td>StoreStore+<strong>StoreLoad</strong>ï¼ˆæœ€è´µï¼‰</td></tr><tr><td>AtomicIntegerè¯»</td><td>0.33</td><td>1.06x</td><td>ç­‰åŒäºvolatileè¯»</td></tr><tr><td>AtomicIntegerè‡ªå¢</td><td>15.7</td><td>50.6x</td><td>CASå¾ªç¯+å†…å­˜å±éšœ</td></tr></tbody></table>
<p><strong>å…³é”®å‘ç°</strong>ï¼š</p>
<ol>
<li><strong>volatileè¯»å‡ ä¹å…è´¹</strong>ï¼ˆx86æ¶æ„ï¼‰</li>
<li><strong>volatileå†™å¼€é”€ä¸»è¦æ¥è‡ªStoreLoadå±éšœ</strong>ï¼ˆéœ€è¦åˆ·æ–°Store Bufferï¼‰</li>
<li><strong>AtomicIntegerçš„è‡ªå¢æ“ä½œæœ€æ…¢</strong>ï¼ˆCASå¤±è´¥ä¼šé‡è¯•ï¼‰</li>
</ol>
<h3 data-id="heading-29">7.2 ä¸åŒCPUæ¶æ„çš„æ€§èƒ½å·®å¼‚</h3>



































<table><thead><tr><th>æ“ä½œ</th><th>x86 (TSO)</th><th>ARM (Weak)</th><th>æ€§èƒ½å·®å¼‚åŸå› </th></tr></thead><tbody><tr><td>volatileè¯»</td><td>~0.3ns</td><td>~2.5ns</td><td>ARMéœ€è¦dmbæŒ‡ä»¤</td></tr><tr><td>volatileå†™</td><td>~2.8ns</td><td>~8.5ns</td><td>ARMéœ€è¦å®Œæ•´çš„dmbå±éšœ</td></tr><tr><td>StoreLoad</td><td>~2.5ns</td><td>~8.0ns</td><td>ARMæ— ç¡¬ä»¶ä¿è¯ï¼Œéœ€æ˜¾å¼å±éšœ</td></tr><tr><td>LoadLoad</td><td>å…è´¹</td><td>~2.0ns</td><td>x86ç¡¬ä»¶ä¿è¯ï¼ŒARMéœ€å±éšœ</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆARMæ…¢ï¼Ÿ</strong><br/>
â†’ ARMçš„å¼±å†…å­˜æ¨¡å‹å…è®¸æ›´æ¿€è¿›çš„é‡æ’åºï¼Œéœ€è¦æ›´å¤šæ˜¾å¼å±éšœæŒ‡ä»¤ã€‚x86çš„TSOæ¨¡å‹ç¡¬ä»¶ä¿è¯äº†å¤§éƒ¨åˆ†é¡ºåºæ€§ã€‚</p>
<h3 data-id="heading-30">7.3 ä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰ä¸ç¼“å­˜è¡Œå¡«å……</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒé”™è¯¯ç¤ºä¾‹ï¼šä¼ªå…±äº«é—®é¢˜</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FalseSharingBad</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value1;  <span class="hljs-comment">// å‡è®¾åœ¨ç¼“å­˜è¡Œåç§»0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value2;  <span class="hljs-comment">// åœ¨ç¼“å­˜è¡Œåç§»8ï¼ˆåŒä¸€ç¼“å­˜è¡Œï¼ï¼‰</span>
    
    <span class="hljs-comment">// çº¿ç¨‹1ä¿®æ”¹value1 â†’ ç¼“å­˜è¡Œå¤±æ•ˆ â†’ çº¿ç¨‹2çš„value2ä¹Ÿå¤±æ•ˆï¼</span>
}

<span class="hljs-comment">// âœ…æ­£ç¡®ç¤ºä¾‹ï¼šç¼“å­˜è¡Œå¡«å……</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FalseSharingGood</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value1;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> p1, p2, p3, p4, p5, p6, p7;  <span class="hljs-comment">// å¡«å……56å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value2;  <span class="hljs-comment">// ç¡®ä¿åœ¨ä¸åŒç¼“å­˜è¡Œ</span>
    
    <span class="hljs-comment">// æˆ–è€…ä½¿ç”¨@Contendedæ³¨è§£ï¼ˆJDK 8+ï¼Œéœ€è¦-XX:-RestrictContendedï¼‰</span>
}

<span class="hljs-meta">@sun</span>.misc.Contended  <span class="hljs-comment">// è‡ªåŠ¨å¡«å……ç¼“å­˜è¡Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContendedExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value1;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value2;  <span class="hljs-comment">// JVMè‡ªåŠ¨å¡«å……ï¼Œé¿å…ä¼ªå…±äº«</span>
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”ï¼ˆ4çº¿ç¨‹åŒæ—¶å†™å…¥ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">æ— å¡«å……ï¼ˆä¼ªå…±äº«ï¼‰ï¼š    <span class="hljs-number">1500</span> ms
æ‰‹åŠ¨å¡«å……ï¼š            <span class="hljs-number">320</span> ms
<span class="hljs-keyword">@Contended</span>æ³¨è§£ï¼š      <span class="hljs-number">310</span> ms
</code></pre>
<h3 data-id="heading-31">7.4 ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-32">åœºæ™¯1ï¼šé«˜é¢‘è¯»ã€ä½é¢‘å†™</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ…æ¨èï¼šç”¨volatile</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Configuration config;  <span class="hljs-comment">// è¯»å¤šå†™å°‘</span>
    
    <span class="hljs-keyword">public</span> Configuration <span class="hljs-title function_">getConfig</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> config;  <span class="hljs-comment">// volatileè¯»å¼€é”€å¾ˆå°</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateConfig</span><span class="hljs-params">(Configuration newConfig)</span> {
        config = newConfig;  <span class="hljs-comment">// å¶å°”å†™ä¸€æ¬¡ï¼Œå¯ä»¥æ¥å—StoreLoadå¼€é”€</span>
    }
}
</code></pre>
<h4 data-id="heading-33">åœºæ™¯2ï¼šé«˜é¢‘å†™ã€éœ€è¦åŸå­æ€§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ…æ¨èï¼šç”¨AtomicIntegeræˆ–LongAdder</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// æˆ–è€…ç”¨LongAdderï¼ˆå¤šçº¿ç¨‹å†™å…¥æ›´å¿«ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">LongAdder</span> <span class="hljs-variable">adder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongAdder</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        adder.increment();  <span class="hljs-comment">// å†…éƒ¨åˆ†æ®µï¼Œå‡å°‘ç«äº‰</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> adder.sum();
    }
}
</code></pre>
<h4 data-id="heading-34">åœºæ™¯3ï¼šå¤æ‚çš„çŠ¶æ€æœº</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ…æ¨èï¼šç”¨synchronizedæˆ–ReentrantLock</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachine</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transition</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// å¤æ‚çš„çŠ¶æ€è½¬æ¢é€»è¾‘</span>
            <span class="hljs-keyword">if</span> (state == <span class="hljs-number">0</span>) {
                state = <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state == <span class="hljs-number">1</span>) {
                state = <span class="hljs-number">2</span>;
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-35">7.5 æ˜“æ··æ·†æ¦‚å¿µå¯¹æ¯”</h3>















































<table><thead><tr><th>æ¦‚å¿µ</th><th>ä½œç”¨èŒƒå›´</th><th>æ€§èƒ½å¼€é”€</th><th>é€‚ç”¨åœºæ™¯</th><th>å¸¸è§è¯¯åŒº</th></tr></thead><tbody><tr><td><strong>å†…å­˜å±éšœ</strong></td><td>CPUæŒ‡ä»¤çº§åˆ«</td><td>ä½</td><td>volatile/Atomicåº•å±‚å®ç°</td><td>âŒè®¤ä¸ºæ˜¯Javaç‰¹æ€§ï¼ˆå®é™…æ˜¯CPUç‰¹æ€§ï¼‰</td></tr><tr><td><strong>volatile</strong></td><td>Javaå˜é‡çº§åˆ«</td><td>ä½~ä¸­</td><td>å•ä¸ªå˜é‡çš„å¯è§æ€§</td><td>âŒè®¤ä¸ºèƒ½ä¿è¯å¤åˆæ“ä½œåŸå­æ€§</td></tr><tr><td><strong>synchronized</strong></td><td>ä»£ç å—çº§åˆ«</td><td>ä¸­~é«˜</td><td>éœ€è¦åŸå­æ€§çš„å¤æ‚æ“ä½œ</td><td>âŒè®¤ä¸ºåªæ˜¯åŠ é”ï¼ˆè¿˜æœ‰å†…å­˜è¯­ä¹‰ï¼‰</td></tr><tr><td><strong>happens-before</strong></td><td>JMMè§„åˆ™</td><td>æ¦‚å¿µæ€§</td><td>æ¨ç†çº¿ç¨‹å®‰å…¨æ€§</td><td>âŒè®¤ä¸ºæ˜¯æ—¶é—´å…ˆåï¼ˆå®é™…æ˜¯å¯è§æ€§å…³ç³»ï¼‰</td></tr><tr><td><strong>CAS</strong></td><td>åŸå­æ“ä½œ</td><td>ä¸­</td><td>æ— é”åŒ–å¹¶å‘</td><td>âŒè®¤ä¸ºæ— å¼€é”€ï¼ˆæœ‰å†…å­˜å±éšœ+ABAé—®é¢˜ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-36">å…«ã€å¸¸è§å‘ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-37">8.1 å‘1ï¼švolatileä¸ä¿è¯åŸå­æ€§ï¼ˆâ­â­â­é«˜é¢‘ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒé”™è¯¯ç¤ºä¾‹ï¼šä»¥ä¸ºvolatileèƒ½ä¿è¯count++çš„åŸå­æ€§</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++;  <span class="hljs-comment">// è¿™æ˜¯ä¸‰ä¸ªæ“ä½œï¼šè¯»-æ”¹-å†™ï¼Œä¸æ˜¯åŸå­çš„ï¼</span>
    }
}

<span class="hljs-comment">// é—®é¢˜åˆ†æï¼šå­—èŠ‚ç å±‚é¢</span>
<span class="hljs-comment">// 0: aload_0</span>
<span class="hljs-comment">// 1: dup</span>
<span class="hljs-comment">// 2: getfield      #2  // è¯»å–count</span>
<span class="hljs-comment">// 5: iconst_1</span>
<span class="hljs-comment">// 6: iadd               // è®¡ç®—count+1</span>
<span class="hljs-comment">// 7: putfield      #2  // å†™å›count</span>
<span class="hljs-comment">// çº¿ç¨‹Aè¯»åˆ°0ï¼Œçº¿ç¨‹Bä¹Ÿè¯»åˆ°0 â†’ éƒ½å†™å…¥1 â†’ ä¸¢å¤±ä¸€æ¬¡è‡ªå¢ï¼</span>

<span class="hljs-comment">// âœ…æ­£ç¡®å†™æ³•1ï¼šä½¿ç”¨AtomicInteger</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorrectCounter1</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count.incrementAndGet();  <span class="hljs-comment">// CASä¿è¯åŸå­æ€§</span>
    }
}

<span class="hljs-comment">// âœ…æ­£ç¡®å†™æ³•2ï¼šä½¿ç”¨synchronized</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorrectCounter2</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++;  <span class="hljs-comment">// synchronizedä¿è¯åŸå­æ€§</span>
    }
}
</code></pre>
<h3 data-id="heading-38">8.2 å‘2ï¼šå¯¹è±¡å¼•ç”¨çš„å¯è§æ€§é™·é˜±</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒé”™è¯¯ç¤ºä¾‹ï¼šä»¥ä¸ºvolatileå¼•ç”¨èƒ½ä¿è¯å¯¹è±¡å†…å®¹å¯è§</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileObjectTrap</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">MyData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyData</span>();
    
    <span class="hljs-comment">// çº¿ç¨‹1</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        data.value = <span class="hljs-number">42</span>;  <span class="hljs-comment">// âš ï¸ è¿™ä¸ªå†™æ“ä½œæ²¡æœ‰volatileè¯­ä¹‰ï¼</span>
    }
    
    <span class="hljs-comment">// çº¿ç¨‹2</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> data.value;  <span class="hljs-comment">// å¯èƒ½è¯»åˆ°æ—§å€¼0</span>
    }
}

<span class="hljs-comment">// åº•å±‚åŸå› ï¼švolatileåªä¿è¯å¼•ç”¨çš„å¯è§æ€§ï¼Œä¸ä¿è¯å¯¹è±¡å­—æ®µçš„å¯è§æ€§</span>

<span class="hljs-comment">// âœ…æ­£ç¡®å†™æ³•1ï¼šå‘å¸ƒæ•´ä¸ªå¯¹è±¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorrectVolatileObject1</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> MyData data;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MyData</span> <span class="hljs-variable">newData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyData</span>();
        newData.value = <span class="hljs-number">42</span>;
        data = newData;  <span class="hljs-comment">// volatileå†™ï¼Œä¿è¯æ•´ä¸ªå¯¹è±¡å¯è§</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MyData</span> <span class="hljs-variable">localData</span> <span class="hljs-operator">=</span> data;  <span class="hljs-comment">// volatileè¯»</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> localData.value;  <span class="hljs-comment">// ä¿è¯èƒ½è¯»åˆ°42</span>
    }
}

<span class="hljs-comment">// âœ…æ­£ç¡®å†™æ³•2ï¼šå¯¹è±¡å­—æ®µä¹Ÿç”¨volatile</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorrectVolatileObject2</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">MyData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyData</span>();
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyData</span> {
        <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> value;  <span class="hljs-comment">// å­—æ®µä¹Ÿå£°æ˜ä¸ºvolatile</span>
    }
}
</code></pre>
<h3 data-id="heading-39">8.3 å‘3ï¼šè¿‡åº¦ä½¿ç”¨volatileé™ä½æ€§èƒ½</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒé”™è¯¯ç¤ºä¾‹ï¼šæ‰€æœ‰å­—æ®µéƒ½åŠ volatile</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OverUseVolatile</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> field1;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> field2;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> field3;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> field4;
    <span class="hljs-comment">// ... æ›´å¤švolatileå­—æ®µ</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateAll</span><span class="hljs-params">()</span> {
        field1 = <span class="hljs-number">1</span>;  <span class="hljs-comment">// StoreStore + StoreLoad</span>
        field2 = <span class="hljs-number">2</span>;  <span class="hljs-comment">// StoreStore + StoreLoad</span>
        field3 = <span class="hljs-number">3</span>;  <span class="hljs-comment">// StoreStore + StoreLoad</span>
        field4 = <span class="hljs-number">4</span>;  <span class="hljs-comment">// StoreStore + StoreLoad</span>
        <span class="hljs-comment">// æ¯æ¬¡å†™å…¥éƒ½æœ‰æ˜‚è´µçš„StoreLoadå±éšœï¼</span>
    }
}

<span class="hljs-comment">// âœ…æ­£ç¡®å†™æ³•ï¼šç”¨ä¸€ä¸ªvolatileæ ‡å¿—ä½</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedVolatile</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> field1;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> field2;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> field3;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> field4;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateAll</span><span class="hljs-params">()</span> {
        field1 = <span class="hljs-number">1</span>;
        field2 = <span class="hljs-number">2</span>;
        field3 = <span class="hljs-number">3</span>;
        field4 = <span class="hljs-number">4</span>;
        <span class="hljs-comment">// StoreStoreå±éšœï¼šç¡®ä¿ä¸Šé¢çš„å†™å…¥å®Œæˆ</span>
        updated = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// åªåœ¨æœ€åä¸€ä¸ªvolatileå†™</span>
        <span class="hljs-comment">// StoreLoadå±éšœ</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readAll</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (updated) {  <span class="hljs-comment">// volatileè¯»</span>
            <span class="hljs-comment">// LoadLoadå±éšœï¼šç¡®ä¿èƒ½è¯»åˆ°æœ€æ–°çš„field1-4</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> field1;
            <span class="hljs-type">int</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> field2;
            <span class="hljs-type">int</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> field3;
            <span class="hljs-type">int</span> <span class="hljs-variable">v4</span> <span class="hljs-operator">=</span> field4;
        }
    }
}
</code></pre>
<h3 data-id="heading-40">8.4 å‘4ï¼šæ‡’åŠ è½½çš„åŒé‡æ£€æŸ¥é”å¿˜è®°volatile</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒé”™è¯¯ç¤ºä¾‹ï¼šDCLæ²¡åŠ volatile</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BrokenDCL</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SomeClass instance;  <span class="hljs-comment">// ç¼ºå°‘volatileï¼</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SomeClass <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (BrokenDCL.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeClass</span>();  <span class="hljs-comment">// å¯èƒ½å‘ç”ŸæŒ‡ä»¤é‡æ’åº</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;  <span class="hljs-comment">// å¯èƒ½è¿”å›æœªåˆå§‹åŒ–çš„å¯¹è±¡ï¼</span>
    }
}

<span class="hljs-comment">// âœ…æ­£ç¡®å†™æ³•ï¼šåŠ ä¸Švolatile</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorrectDCL</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> SomeClass instance;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SomeClass <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (CorrectDCL.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeClass</span>();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}

<span class="hljs-comment">// âœ…æ›´ä¼˜é›…çš„å†™æ³•ï¼šé™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BestDCL</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">BestDCL</span><span class="hljs-params">()</span> {}
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span> {
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BestDCL</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BestDCL</span>();
        <span class="hljs-comment">// åˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€volatile</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BestDCL <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Holder.INSTANCE;
    }
}
</code></pre>
<h3 data-id="heading-41">8.5 å‘5ï¼šè¯¯ç”¨StoreLoadå±éšœå¯¼è‡´æ€§èƒ½é—®é¢˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒé”™è¯¯ç¤ºä¾‹ï¼šé¢‘ç¹çš„volatileå†™</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrequentVolatileWrite</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countEvents</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {
            counter++;  <span class="hljs-comment">// æ¯æ¬¡éƒ½æœ‰StoreLoadå±éšœï¼</span>
        }
    }
    <span class="hljs-comment">// æ€§èƒ½ï¼šçº¦ 800ms</span>
}

<span class="hljs-comment">// âœ…ä¼˜åŒ–å†™æ³•ï¼šæ‰¹é‡æ›´æ–°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchVolatileWrite</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countEvents</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">localCounter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {
            localCounter++;  <span class="hljs-comment">// æœ¬åœ°å˜é‡ï¼Œæ— å±éšœ</span>
        }
        counter = localCounter;  <span class="hljs-comment">// åªæœ‰ä¸€æ¬¡volatileå†™</span>
    }
    <span class="hljs-comment">// æ€§èƒ½ï¼šçº¦ 2msï¼ˆæå‡400å€ï¼ï¼‰</span>
}
</code></pre>
<h3 data-id="heading-42">8.6 æœ€ä½³å®è·µæ¸…å•</h3>
<h4 data-id="heading-43">âœ… DOï¼ˆæ¨èåšæ³•ï¼‰</h4>
<ol>
<li>
<p><strong>çŠ¶æ€æ ‡å¿—ç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
</code></pre>
</li>
<li>
<p><strong>ä¸€æ¬¡æ€§å‘å¸ƒç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Configuration config;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Configuration</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> loadConfig();
    config = temp;  <span class="hljs-comment">// ä¸€æ¬¡æ€§å‘å¸ƒ</span>
}
</code></pre>
</li>
<li>
<p><strong>ç‹¬ç«‹è§‚å¯Ÿç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> lastUpdateTime;
</code></pre>
</li>
<li>
<p><strong>è¯»å¤šå†™å°‘ç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Map&lt;String, String&gt; cache;
</code></pre>
</li>
<li>
<p><strong>é¿å…ä¼ªå…±äº«ç”¨@Contended</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@sun</span>.misc.Contended
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> counter;
</code></pre>
</li>
</ol>
<h4 data-id="heading-44">âŒ DON'Tï¼ˆé¿å…åšæ³•ï¼‰</h4>
<ol>
<li>
<p><strong>å¤åˆæ“ä½œä¸è¦ç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> count;
count++;  <span class="hljs-comment">// âŒé”™è¯¯ï¼æ”¹ç”¨AtomicInteger</span>
</code></pre>
</li>
<li>
<p><strong>ä¸è¦volatileæ•°ç»„å…ƒç´ </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span>[] array;  <span class="hljs-comment">// âŒåªæœ‰å¼•ç”¨æ˜¯volatileï¼Œå…ƒç´ ä¸æ˜¯</span>
<span class="hljs-comment">// æ”¹ç”¨AtomicIntegerArray</span>
</code></pre>
</li>
<li>
<p><strong>ä¸è¦åœ¨å¾ªç¯å†…é¢‘ç¹å†™volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; N; i++) {
    volatileVar = i;  <span class="hljs-comment">// âŒæ¯æ¬¡éƒ½æœ‰StoreLoadå±éšœ</span>
}
</code></pre>
</li>
<li>
<p><strong>ä¸è¦ç”¨volatileä»£æ›¿é”</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> Map&lt;String, String&gt; map;
map.put(key, value);  <span class="hljs-comment">// âŒmapå†…éƒ¨æ“ä½œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</span>
</code></pre>
</li>
<li>
<p><strong>ä¸è¦åœ¨æ€§èƒ½æ•æ„Ÿè·¯å¾„è¿‡åº¦ä½¿ç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hotMethod</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> volatileVar;  <span class="hljs-comment">// å¦‚æœæ¯ç§’è°ƒç”¨ç™¾ä¸‡æ¬¡ï¼Œè€ƒè™‘ä¼˜åŒ–</span>
}
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-45">â­ ä¹ã€é¢è¯•é¢˜ç²¾é€‰</h2>
<h3 data-id="heading-46">â­ åŸºç¡€é¢˜ï¼ˆå¿…ç­”ï¼‰</h3>
<h4 data-id="heading-47">Q1: volatileå…³é”®å­—çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p>volatileæœ‰ä¸¤ä¸ªæ ¸å¿ƒä½œç”¨ï¼š</p>
<ol>
<li><strong>ä¿è¯å¯è§æ€§</strong>ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹volatileå˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§</li>
<li><strong>é˜²æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼švolatileå˜é‡çš„è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åº</li>
</ol>
<p><strong>åº•å±‚å®ç°</strong>ï¼ˆåˆ†ç‚¹ä½œç­”ï¼‰ï¼š</p>
<ul>
<li><strong>å­—èŠ‚ç å±‚é¢</strong>ï¼š<code>putfield</code>/<code>getfield</code>æŒ‡ä»¤è¯†åˆ«volatileæ ‡å¿—</li>
<li><strong>JVMå±‚é¢</strong>ï¼šé€šè¿‡<code>Unsafe</code>ç±»çš„<code>loadFence()</code>/<code>storeFence()</code>/<code>fullFence()</code>æ’å…¥å†…å­˜å±éšœ</li>
<li><strong>CPUå±‚é¢ï¼ˆx86ï¼‰</strong>ï¼šä½¿ç”¨<code>lock</code>å‰ç¼€æŒ‡ä»¤ï¼ˆå¦‚<code>lock addl $0x0,(%rsp)</code>ï¼‰
<ul>
<li>é”å®šç¼“å­˜è¡Œ</li>
<li>åˆ·æ–°Store Bufferåˆ°ç¼“å­˜</li>
<li>è§¦å‘MESIç¼“å­˜ä¸€è‡´æ€§åè®®</li>
<li>é˜»æ­¢æŒ‡ä»¤é‡æ’åº</li>
</ul>
</li>
</ul>
<p><strong>è¡¥å……</strong>ï¼švolatileå†™ä¹‹å‰æ’å…¥<code>StoreStore</code>å±éšœï¼Œä¹‹åæ’å…¥<code>StoreLoad</code>å±éšœï¼›volatileè¯»ä¹‹åæ’å…¥<code>LoadLoad</code>å’Œ<code>LoadStore</code>å±éšœã€‚</p>
<hr/>
<h4 data-id="heading-48">Q2: è¯´è¯´Javaçš„å››ç§å†…å­˜å±éšœç±»å‹åŠå…¶ä½œç”¨</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>



































<table><thead><tr><th>å±éšœç±»å‹</th><th>è¯­ä¹‰</th><th>ä½œç”¨</th><th>å®é™…ä¾‹å­</th></tr></thead><tbody><tr><td><strong>LoadLoad</strong></td><td><code>Load1; LoadLoad; Load2</code></td><td>ç¡®ä¿Load1å…ˆäºLoad2è¯»å–</td><td>volatileè¯»åçš„æ™®é€šè¯»</td></tr><tr><td><strong>StoreStore</strong></td><td><code>Store1; StoreStore; Store2</code></td><td>ç¡®ä¿Store1å…ˆäºStore2åˆ·æ–°åˆ°ä¸»å†…å­˜</td><td>volatileå†™å‰çš„æ™®é€šå†™</td></tr><tr><td><strong>LoadStore</strong></td><td><code>Load1; LoadStore; Store2</code></td><td>ç¡®ä¿Load1å…ˆäºStore2æ‰§è¡Œ</td><td>volatileè¯»åçš„æ™®é€šå†™</td></tr><tr><td><strong>StoreLoad</strong></td><td><code>Store1; StoreLoad; Load2</code></td><td>ç¡®ä¿Store1åˆ·æ–°åˆ°ä¸»å†…å­˜å…ˆäºLoad2</td><td>volatileå†™åçš„ä»»ä½•æ“ä½œ</td></tr></tbody></table>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>StoreLoadæ˜¯<strong>å¼€é”€æœ€å¤§</strong>çš„å±éšœï¼ˆéœ€è¦åˆ·æ–°å†™ç¼“å†²åŒºï¼‰</li>
<li>x86æ¶æ„ä¸‹ï¼ŒLoadLoadå’ŒStoreStoreæ˜¯<strong>å…è´¹çš„</strong>ï¼ˆç¡¬ä»¶ä¿è¯ï¼‰</li>
<li>ARMç­‰å¼±å†…å­˜æ¨¡å‹CPUï¼Œæ‰€æœ‰å±éšœéƒ½éœ€è¦æ˜¾å¼æŒ‡ä»¤</li>
</ul>
<hr/>
<h4 data-id="heading-49">Q3: volatileèƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>ä¸èƒ½ä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§ï¼</strong></p>
<p><strong>åŸå› åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// ä¸æ˜¯åŸå­çš„ï¼</span>
}
</code></pre>
<p>å­—èŠ‚ç åˆ†è§£ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">getfield count   <span class="hljs-comment">// æ­¥éª¤1ï¼šè¯»å–</span>
iconst_1         <span class="hljs-comment">// æ­¥éª¤2ï¼šåŠ è½½å¸¸é‡1</span>
iadd             <span class="hljs-comment">// æ­¥éª¤3ï¼šæ‰§è¡ŒåŠ æ³•</span>
putfield count   <span class="hljs-comment">// æ­¥éª¤4ï¼šå†™å›</span>
</code></pre>
<p><strong>æ—¶åºé—®é¢˜</strong>ï¼š</p>
<ul>
<li>çº¿ç¨‹Aè¯»åˆ°count=0ï¼ˆæ­¥éª¤1ï¼‰</li>
<li>çº¿ç¨‹Bè¯»åˆ°count=0ï¼ˆæ­¥éª¤1ï¼‰</li>
<li>çº¿ç¨‹Aå†™å…¥count=1ï¼ˆæ­¥éª¤4ï¼‰</li>
<li>çº¿ç¨‹Bå†™å…¥count=1ï¼ˆæ­¥éª¤4ï¼‰</li>
<li><strong>ç»“æœ</strong>ï¼šæ‰§è¡Œä¸¤æ¬¡è‡ªå¢ï¼Œcountåªå¢åŠ 1æ¬¡ï¼</li>
</ul>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>AtomicInteger.incrementAndGet()</code>ï¼ˆCASä¿è¯åŸå­æ€§ï¼‰</li>
<li>ä½¿ç”¨<code>synchronized</code>å…³é”®å­—</li>
</ul>
<hr/>
<h3 data-id="heading-50">â­â­ è¿›é˜¶é¢˜ï¼ˆæ‹‰å¼€å·®è·ï¼‰</h3>
<h4 data-id="heading-51">Q4: ä¸ºä»€ä¹ˆåŒé‡æ£€æŸ¥é”ï¼ˆDCLï¼‰å•ä¾‹å¿…é¡»ç”¨volatileï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>é—®é¢˜æ ¹æº</strong>ï¼šå¯¹è±¡åˆ›å»ºä¸æ˜¯åŸå­æ“ä½œ</p>
<pre><code class="hljs language-java" lang="java">instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
</code></pre>
<p>å­—èŠ‚ç åˆ†è§£ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">new</span> Singleton         <span class="hljs-comment">// 1. åˆ†é…å†…å­˜</span>
dup
invokespecial &lt;<span class="hljs-keyword">init</span>&gt; <span class="hljs-comment">// 2. è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–</span>
putstatic instance   <span class="hljs-comment">// 3. å°†å¼•ç”¨èµ‹å€¼ç»™instance</span>
</code></pre>
<p><strong>æŒ‡ä»¤é‡æ’åºé£é™©</strong>ï¼š</p>
<ul>
<li>JVMå¯èƒ½é‡æ’åºä¸ºï¼š1 â†’ 3 â†’ 2</li>
<li>çº¿ç¨‹Aæ‰§è¡Œåˆ°æ­¥éª¤3ï¼ˆå¯¹è±¡æœªåˆå§‹åŒ–ï¼Œä½†å¼•ç”¨å·²èµ‹å€¼ï¼‰</li>
<li>çº¿ç¨‹Båˆ¤æ–­<code>instance != null</code>ï¼Œç›´æ¥è¿”å›<strong>æœªåˆå§‹åŒ–çš„å¯¹è±¡</strong></li>
<li>çº¿ç¨‹Bä½¿ç”¨å¯¹è±¡ â†’ <strong>ç©ºæŒ‡é’ˆå¼‚å¸¸æˆ–æ•°æ®é”™è¯¯</strong></li>
</ul>
<p><strong>volatileçš„ä½œç”¨</strong>ï¼š</p>
<ol>
<li><strong>StoreStoreå±éšœ</strong>ï¼ˆvolatileå†™ä¹‹å‰ï¼‰ï¼šç¦æ­¢æ­¥éª¤2ã€3é‡æ’åº</li>
<li><strong>StoreLoadå±éšœ</strong>ï¼ˆvolatileå†™ä¹‹åï¼‰ï¼šç¡®ä¿å…¶ä»–çº¿ç¨‹èƒ½è¯»åˆ°å®Œæ•´å¯¹è±¡</li>
<li><strong>LoadLoadå±éšœ</strong>ï¼ˆvolatileè¯»ä¹‹åï¼‰ï¼šç¡®ä¿è¯»åˆ°æœ€æ–°çš„instanceå¼•ç”¨</li>
</ol>
<p><strong>å®Œæ•´ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼ˆvolatileè¯»ï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (Singleton.class) {
            <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥</span>
                instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">// volatileå†™</span>
            }
        }
    }
    <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<hr/>
<h4 data-id="heading-52">Q5: volatileå’Œsynchronizedçš„å†…å­˜è¯­ä¹‰æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>volatile</th><th>synchronized</th></tr></thead><tbody><tr><td><strong>åŸå­æ€§</strong></td><td>ä»…ä¿è¯å•ä¸ªè¯»/å†™åŸå­æ€§</td><td>ä¿è¯ä¸´ç•ŒåŒºå†…æ‰€æœ‰æ“ä½œåŸå­æ€§</td></tr><tr><td><strong>å¯è§æ€§</strong></td><td>ä¿è¯</td><td>ä¿è¯</td></tr><tr><td><strong>æœ‰åºæ€§</strong></td><td>ä¿è¯ï¼ˆæ’å…¥å†…å­˜å±éšœï¼‰</td><td>ä¿è¯ï¼ˆä¸´ç•ŒåŒºä¸ä¼šé‡æ’åºåˆ°å¤–é¢ï¼‰</td></tr><tr><td><strong>é”æœºåˆ¶</strong></td><td>æ— é”</td><td>æœ‰é”ï¼ˆMonitorï¼‰</td></tr><tr><td><strong>é˜»å¡</strong></td><td>ä¸é˜»å¡</td><td>é˜»å¡</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>è¯»ï¼š~0.3nsï¼Œå†™ï¼š~2.8ns</td><td>åŠ é”/è§£é”ï¼š~25ns</td></tr></tbody></table>
<p><strong>å†…å­˜å±éšœå¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// volatileçš„å±éšœæ’å…¥</span>
<span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> v;
v = <span class="hljs-number">1</span>;  <span class="hljs-comment">// &lt;StoreStore&gt; + å†™å…¥ + &lt;StoreLoad&gt;</span>

<span class="hljs-comment">// synchronizedçš„å±éšœæ’å…¥</span>
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-comment">// &lt;LoadLoad&gt; + &lt;LoadStore&gt;ï¼ˆè¿›å…¥ä¸´ç•ŒåŒºåï¼‰</span>
    <span class="hljs-comment">// ... ä¸´ç•ŒåŒºä»£ç  ...</span>
    <span class="hljs-comment">// &lt;StoreStore&gt; + &lt;StoreLoad&gt;ï¼ˆé€€å‡ºä¸´ç•ŒåŒºå‰ï¼‰</span>
}
</code></pre>
<p><strong>å…³é”®å·®å¼‚</strong>ï¼š</p>
<ul>
<li>volatileåªå¯¹<strong>å•ä¸ªå˜é‡</strong>ç”Ÿæ•ˆ</li>
<li>synchronizedå¯¹<strong>æ•´ä¸ªä»£ç å—</strong>ç”Ÿæ•ˆï¼Œè¿˜æœ‰<strong>é”çš„happens-beforeè¯­ä¹‰</strong></li>
</ul>
<hr/>
<h4 data-id="heading-53">Q6: happens-beforeè§„åˆ™ä¸­ï¼Œvolatileå˜é‡è§„åˆ™æ˜¯æ€æ ·çš„ï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>volatileå˜é‡è§„åˆ™</strong>ï¼š</p>
<blockquote>
<p>å¯¹ä¸€ä¸ªvolatileå˜é‡çš„<strong>å†™æ“ä½œ</strong>ï¼Œhappens-beforeäºåç»­å¯¹è¿™ä¸ªå˜é‡çš„<strong>è¯»æ“ä½œ</strong>ã€‚</p>
</blockquote>
<p><strong>æ·±å…¥ç†è§£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-comment">// çº¿ç¨‹1</span>
a = <span class="hljs-number">1</span>;           <span class="hljs-comment">// æ“ä½œ1</span>
flag = <span class="hljs-literal">true</span>;     <span class="hljs-comment">// æ“ä½œ2ï¼ˆvolatileå†™ï¼‰</span>

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-keyword">if</span> (flag) {      <span class="hljs-comment">// æ“ä½œ3ï¼ˆvolatileè¯»ï¼‰</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a;   <span class="hljs-comment">// æ“ä½œ4</span>
}
</code></pre>
<p><strong>happens-beforeé“¾</strong>ï¼š</p>
<ol>
<li>æ“ä½œ1 happens-before æ“ä½œ2ï¼ˆç¨‹åºé¡ºåºè§„åˆ™ï¼‰</li>
<li>æ“ä½œ2 happens-before æ“ä½œ3ï¼ˆvolatileè§„åˆ™ï¼‰</li>
<li>æ“ä½œ3 happens-before æ“ä½œ4ï¼ˆç¨‹åºé¡ºåºè§„åˆ™ï¼‰</li>
</ol>
<p><strong>ä¼ é€’æ€§</strong>ï¼šæ“ä½œ1 happens-before æ“ä½œ4</p>
<p><strong>ç»“è®º</strong>ï¼šçº¿ç¨‹2èƒ½ä¿è¯è¯»åˆ°<code>a=1</code></p>
<p><strong>åº•å±‚æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>volatileå†™çš„<code>StoreStore</code>å±éšœï¼šç¡®ä¿æ“ä½œ1çš„å†™å…¥å…ˆå®Œæˆ</li>
<li>volatileè¯»çš„<code>LoadLoad</code>å±éšœï¼šç¡®ä¿æ“ä½œ4èƒ½è¯»åˆ°æœ€æ–°å€¼</li>
</ul>
<hr/>
<h3 data-id="heading-54">â­â­â­ é«˜çº§é¢˜ï¼ˆæŠ€æœ¯æ·±åº¦ï¼‰</h3>
<h4 data-id="heading-55">Q7: ä¸åŒCPUæ¶æ„çš„å†…å­˜æ¨¡å‹å¯¹Javaå†…å­˜å±éšœæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>CPUå†…å­˜æ¨¡å‹åˆ†ç±»</strong>ï¼š</p>
<ol>
<li>
<p><strong>å¼ºæ¨¡å‹ï¼ˆTSO - Total Store Orderï¼‰</strong>ï¼šx86ã€SPARC</p>
<ul>
<li>ç¡¬ä»¶ä¿è¯LoadLoadã€StoreStoreé¡ºåº</li>
<li>åªéœ€è¦StoreLoadå±éšœ</li>
</ul>
</li>
<li>
<p><strong>å¼±æ¨¡å‹</strong>ï¼šARMã€PowerPC</p>
<ul>
<li>å…è®¸æ›´æ¿€è¿›çš„é‡æ’åº</li>
<li>æ‰€æœ‰å±éšœéƒ½éœ€è¦æ˜¾å¼æŒ‡ä»¤</li>
</ul>
</li>
</ol>
<p><strong>JVMçš„å±éšœæ˜ å°„</strong>ï¼ˆä»¥JDK 8ä¸ºä¾‹ï¼‰ï¼š</p>






























<table><thead><tr><th>JMMå±éšœ</th><th>x86æŒ‡ä»¤</th><th>ARMæŒ‡ä»¤</th></tr></thead><tbody><tr><td>LoadLoad</td><td>æ— æ“ä½œï¼ˆç¡¬ä»¶ä¿è¯ï¼‰</td><td><code>dmb ishld</code></td></tr><tr><td>StoreStore</td><td>æ— æ“ä½œï¼ˆç¡¬ä»¶ä¿è¯ï¼‰</td><td><code>dmb ishst</code></td></tr><tr><td>LoadStore</td><td>æ— æ“ä½œï¼ˆç¡¬ä»¶ä¿è¯ï¼‰</td><td><code>dmb ish</code></td></tr><tr><td>StoreLoad</td><td><code>lock addl</code> æˆ– <code>mfence</code></td><td><code>dmb ish</code></td></tr></tbody></table>
<p><strong>æ€§èƒ½å½±å“</strong>ï¼š</p>
<ul>
<li>x86ï¼švolatileå†™ ~2.8ns</li>
<li>ARMï¼švolatileå†™ ~8.5nsï¼ˆéœ€è¦å®Œæ•´dmbå±éšœï¼‰</li>
</ul>
<p><strong>JVMä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>JITç¼–è¯‘å™¨ä¼šæ ¹æ®ç›®æ ‡CPUæ¶æ„é€‰æ‹©æœ€ä¼˜å±éšœæŒ‡ä»¤</li>
<li>åœ¨å¼ºæ¨¡å‹CPUä¸Šï¼ŒJVMå¯ä»¥çœç•¥éƒ¨åˆ†å±éšœ</li>
</ul>
<hr/>
<h4 data-id="heading-56">Q8: ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>å®šä¹‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡ï¼Œä½†è¿™äº›å˜é‡ä½äº<strong>åŒä¸€ç¼“å­˜è¡Œ</strong>ï¼Œå¯¼è‡´ç¼“å­˜è¡Œé¢‘ç¹å¤±æ•ˆã€‚</p>
<p><strong>é—®é¢˜æ ¹æº</strong>ï¼š</p>
<ul>
<li>CPUç¼“å­˜ä»¥**ç¼“å­˜è¡Œï¼ˆCache Lineï¼‰**ä¸ºå•ä½ï¼ˆé€šå¸¸64å­—èŠ‚ï¼‰</li>
<li>MESIåè®®ä»¥ç¼“å­˜è¡Œä¸ºç²’åº¦è¿›è¡Œå¤±æ•ˆ</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FalseSharing</span> {
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value1;  <span class="hljs-comment">// åç§»0-7å­—èŠ‚</span>
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value2;  <span class="hljs-comment">// åç§»8-15å­—èŠ‚ï¼ˆåŒä¸€ç¼“å­˜è¡Œï¼ï¼‰</span>
    
    <span class="hljs-comment">// çº¿ç¨‹1ä¿®æ”¹value1 â†’ æ•´ä¸ªç¼“å­˜è¡Œå¤±æ•ˆ</span>
    <span class="hljs-comment">// çº¿ç¨‹2çš„value2ç¼“å­˜ä¹Ÿå¤±æ•ˆ â†’ æ€§èƒ½ä¸‹é™</span>
}
</code></pre>
<p><strong>æ—¶åºå›¾</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant CPU1
    participant CacheLine as ç¼“å­˜è¡Œ[value1, value2]
    participant CPU2
    
    CPU1-&gt;&gt;CacheLine: å†™value1ï¼ˆModifiedçŠ¶æ€ï¼‰
    CPU1-&gt;&gt;CPU2: å‘é€Invalidateæ¶ˆæ¯
    Note over CPU2: ç¼“å­˜è¡Œå¤±æ•ˆï¼ˆvalue2ä¹Ÿå¤±æ•ˆï¼ï¼‰
    CPU2-&gt;&gt;CacheLine: é‡æ–°åŠ è½½æ•´ä¸ªç¼“å­˜è¡Œ
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li><strong>æ‰‹åŠ¨å¡«å……</strong>ï¼ˆJDK 8ä¹‹å‰ï¼‰</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaddedValue</span> {
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value1;
    <span class="hljs-type">long</span> p1, p2, p3, p4, p5, p6, p7;  <span class="hljs-comment">// å¡«å……56å­—èŠ‚</span>
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value2;  <span class="hljs-comment">// ç¡®ä¿åœ¨ä¸åŒç¼“å­˜è¡Œ</span>
}
</code></pre>
<ol start="2">
<li><strong>@Contendedæ³¨è§£</strong>ï¼ˆJDK 8+ï¼‰</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@sun</span>.misc.Contended
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContendedValue</span> {
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value1;
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value2;  <span class="hljs-comment">// JVMè‡ªåŠ¨å¡«å……</span>
}
</code></pre>
<p>éœ€è¦JVMå‚æ•°ï¼š<code>-XX:-RestrictContended</code></p>
<p><strong>æ€§èƒ½æå‡</strong>ï¼š</p>
<ul>
<li>æ— å¡«å……ï¼š1500ms</li>
<li>æœ‰å¡«å……ï¼š320msï¼ˆæå‡4.7å€ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-57">Q9: JDK 9çš„VarHandleä¸volatileæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>VarHandleä¼˜åŠ¿</strong>ï¼šæä¾›<strong>æ›´ç»†ç²’åº¦çš„å†…å­˜è®¿é—®æ§åˆ¶</strong></p>
<p><strong>è®¿é—®æ¨¡å¼å¯¹æ¯”</strong>ï¼š</p>








































<table><thead><tr><th>æ¨¡å¼</th><th>åŸå­æ€§</th><th>é¡ºåºä¿è¯</th><th>ç­‰ä»·volatile</th><th>æ€§èƒ½ï¼ˆns/opï¼‰</th></tr></thead><tbody><tr><td><code>get/set</code></td><td>âœ…</td><td>âŒæ— ä¿è¯</td><td>æ— </td><td>0.31</td></tr><tr><td><code>getOpaque/setOpaque</code></td><td>âœ…</td><td>âŒæ— é¡ºåº</td><td>æ— </td><td>0.32</td></tr><tr><td><code>getAcquire/setRelease</code></td><td>âœ…</td><td>âœ…å•å‘å±éšœ</td><td>éƒ¨åˆ†</td><td>0.32</td></tr><tr><td><code>getVolatile/setVolatile</code></td><td>âœ…</td><td>âœ…å®Œæ•´å±éšœ</td><td>volatile</td><td>0.83</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> VarHandle VALUE;
<span class="hljs-keyword">static</span> {
    VALUE = MethodHandles.lookup().findVarHandle(
        MyClass.class, <span class="hljs-string">"value"</span>, <span class="hljs-type">int</span>.class
    );
}
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;

<span class="hljs-comment">// 1. Plainæ¨¡å¼ï¼ˆæœ€å¿«ï¼‰</span>
VALUE.set(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);

<span class="hljs-comment">// 2. Release/Acquireæ¨¡å¼ï¼ˆå•å‘å±éšœï¼‰</span>
VALUE.setRelease(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);  <span class="hljs-comment">// åªæ’å…¥StoreStore</span>
<span class="hljs-type">int</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) VALUE.getAcquire(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// åªæ’å…¥LoadLoad</span>

<span class="hljs-comment">// 3. Volatileæ¨¡å¼ï¼ˆå®Œæ•´å±éšœï¼‰</span>
VALUE.setVolatile(<span class="hljs-built_in">this</span>, <span class="hljs-number">42</span>);  <span class="hljs-comment">// ç­‰åŒäºvolatileå†™</span>
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>Release/Acquire</strong>ï¼šå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰</li>
<li><strong>Volatile</strong>ï¼šéœ€è¦å®Œæ•´å¯è§æ€§ä¿è¯</li>
<li><strong>Opaque</strong>ï¼šä»…éœ€åŸå­æ€§ï¼Œæ— é¡ºåºè¦æ±‚</li>
</ul>
<hr/>
<h4 data-id="heading-58">Q10: è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„æ— é”è®¡æ•°å™¨ï¼Œè¯´æ˜è®¾è®¡æ€è·¯ï¼ˆå¼€æ”¾é¢˜ï¼‰</h4>
<p><strong>æ ‡å‡†ç­”æ¡ˆ</strong>ï¼š</p>
<p><strong>éœ€æ±‚åˆ†æ</strong>ï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹å¹¶å‘è‡ªå¢</li>
<li>é«˜ååé‡ï¼ˆæ¯ç§’ç™¾ä¸‡æ¬¡çº§åˆ«ï¼‰</li>
<li>å…è®¸æœ€ç»ˆä¸€è‡´æ€§ï¼ˆè¯»å–æ—¶åˆå¹¶ï¼‰</li>
</ul>
<p><strong>è®¾è®¡æ–¹æ¡ˆ</strong>ï¼š<strong>åˆ†æ®µè®¡æ•°å™¨ï¼ˆç±»ä¼¼LongAdderï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HighPerformanceCounter</span> {
    <span class="hljs-comment">// ğŸ”¥å…³é”®ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹è®¡æ•°ï¼Œé¿å…ç«äº‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cell</span> {
        <span class="hljs-meta">@sun</span>.misc.Contended  <span class="hljs-comment">// é¿å…ä¼ªå…±äº«</span>
        <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> value;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cell[] cells;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mask;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HighPerformanceCounter</span><span class="hljs-params">(<span class="hljs-type">int</span> segments)</span> {
        <span class="hljs-comment">// ç¡®ä¿æ˜¯2çš„å¹‚ï¼Œæ–¹ä¾¿ä½è¿ç®—</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (n &lt; segments) n &lt;&lt;= <span class="hljs-number">1</span>;
        
        <span class="hljs-built_in">this</span>.cells = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cell</span>[n];
        <span class="hljs-built_in">this</span>.mask = n - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; i++) {
            cells[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cell</span>();
        }
    }
    
    <span class="hljs-comment">// ğŸ”¥å¢åŠ æ“ä½œï¼šæ— ç«äº‰æƒ…å†µä¸‹çš„CAS</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ ¹æ®çº¿ç¨‹IDé€‰æ‹©Cellï¼ˆå‡å°‘ç«äº‰ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> Thread.currentThread().hashCode();
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> hash &amp; mask;
        <span class="hljs-type">Cell</span> <span class="hljs-variable">cell</span> <span class="hljs-operator">=</span> cells[index];
        
        <span class="hljs-comment">// ä½¿ç”¨VarHandleçš„CASï¼ˆæ›´é«˜æ•ˆï¼‰</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> cell.value;
        CELL_VALUE.compareAndSet(cell, current, current + <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-comment">// ğŸ”¥è¯»å–æ“ä½œï¼šåˆå¹¶æ‰€æœ‰Cell</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sum</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (Cell cell : cells) {
            sum += cell.value;  <span class="hljs-comment">// volatileè¯»</span>
        }
        <span class="hljs-keyword">return</span> sum;
    }
    
    <span class="hljs-comment">// VarHandleåˆå§‹åŒ–</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> VarHandle CELL_VALUE;
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            CELL_VALUE = MethodHandles.lookup().findVarHandle(
                Cell.class, <span class="hljs-string">"value"</span>, <span class="hljs-type">long</span>.class
            );
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(e);
        }
    }
}
</code></pre>
<p><strong>è®¾è®¡äº®ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>åˆ†æ®µè®¡æ•°</strong>ï¼šå‡å°‘CASç«äº‰ï¼ˆç±»ä¼¼ConcurrentHashMapçš„æ€æƒ³ï¼‰</li>
<li><strong>@Contended</strong>ï¼šé¿å…ä¼ªå…±äº«</li>
<li><strong>2çš„å¹‚å–æ¨¡</strong>ï¼šç”¨ä½è¿ç®—<code>&amp;</code>ä»£æ›¿<code>%</code>ï¼ˆæ›´å¿«ï¼‰</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šè¯»å–æ—¶æ‰åˆå¹¶ï¼Œå†™å…¥æ—¶æ— éœ€åŒæ­¥</li>
</ol>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">AtomicLongï¼š        15.7 ns/opï¼ˆé«˜ç«äº‰ä¸‹é€€åŒ–åˆ°100+ ns/opï¼‰
LongAdderï¼š         2.3 ns/op
æœ¬æ–¹æ¡ˆï¼ˆ8åˆ†æ®µï¼‰ï¼š    1.8 ns/op
</code></pre>
<p><strong>æƒè¡¡</strong>ï¼š</p>
<ul>
<li>âœ…å†™å…¥æ€§èƒ½æé«˜</li>
<li>âŒè¯»å–éœ€è¦éå†æ‰€æœ‰Cellï¼ˆä½†é€šå¸¸è¯»å°‘å†™å¤šï¼‰</li>
<li>âŒå†…å­˜å ç”¨å¢åŠ ï¼ˆCellæ•°ç»„ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-59">åã€æ€»ç»“ä¸å»¶ä¼¸</h2>
<h3 data-id="heading-60">10.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol>
<li>
<p><strong>å†…å­˜å±éšœçš„æœ¬è´¨</strong></p>
<ul>
<li>CPUæŒ‡ä»¤çº§åˆ«çš„åŒæ­¥åŸè¯­</li>
<li>æ§åˆ¶å†…å­˜è®¿é—®é¡ºåºï¼Œé˜²æ­¢é‡æ’åº</li>
<li>ç¡®ä¿ç¼“å­˜ä¸€è‡´æ€§ï¼ˆMESIåè®®ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å››ç§å±éšœç±»å‹è®°å¿†æ³•</strong></p>
<pre><code class="hljs">LoadLoadï¼š   è¯»åè¯»  â†’ ç¡®ä¿å‰ä¸€ä¸ªè¯»å…ˆå®Œæˆ
StoreStoreï¼š å†™åå†™  â†’ ç¡®ä¿å‰ä¸€ä¸ªå†™å…ˆåˆ·æ–°
LoadStoreï¼š  è¯»åå†™  â†’ ç¡®ä¿è¯»å…ˆäºå†™
StoreLoadï¼š  å†™åè¯»  â†’ æœ€è´µçš„å±éšœï¼Œç¡®ä¿å†™åˆ·æ–°åæ‰è¯»
</code></pre>
</li>
<li>
<p><strong>volatileçš„å†…å­˜è¯­ä¹‰</strong></p>
<ul>
<li><strong>å†™æ“ä½œ</strong>ï¼š<code>&lt;StoreStore&gt; + å†™å…¥ + &lt;StoreLoad&gt;</code></li>
<li><strong>è¯»æ“ä½œ</strong>ï¼š<code>è¯»å– + &lt;LoadLoad&gt; + &lt;LoadStore&gt;</code></li>
<li>å»ºç«‹happens-beforeå…³ç³»</li>
</ul>
</li>
<li>
<p><strong>å¸¸è§è¯¯åŒº</strong></p>
<ul>
<li>âŒ volatileèƒ½ä¿è¯<code>count++</code>çš„åŸå­æ€§</li>
<li>âŒ volatileå¯¹è±¡å¼•ç”¨èƒ½ä¿è¯å¯¹è±¡å­—æ®µå¯è§æ€§</li>
<li>âŒ æ‰€æœ‰å­—æ®µéƒ½ç”¨volatileæ€§èƒ½æ›´å¥½</li>
<li>âŒ å†…å­˜å±éšœæ˜¯Javaç‰¹æ€§ï¼ˆå®é™…æ˜¯CPUç‰¹æ€§ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½å…³é”®ç‚¹</strong></p>
<ul>
<li>x86æ¶æ„ï¼švolatileè¯»å‡ ä¹å…è´¹ï¼Œvolatileå†™ ~2.8ns</li>
<li>StoreLoadå±éšœå¼€é”€æœ€å¤§ï¼ˆéœ€è¦åˆ·å†™ç¼“å†²åŒºï¼‰</li>
<li>é¿å…ä¼ªå…±äº«ï¼šä½¿ç”¨@Contendedæˆ–æ‰‹åŠ¨å¡«å……</li>
<li>åˆ†æ®µè®¡æ•°å™¨ï¼šå‡å°‘CASç«äº‰ï¼ˆLongAdderæ€æƒ³ï¼‰</li>
</ul>
</li>
</ol>
<h3 data-id="heading-61">10.2 æŠ€æœ¯æ ˆå…³è”</h3>
<h4 data-id="heading-62">å¹¶å‘å·¥å…·ç±»çš„åº•å±‚å®ç°</h4>



































<table><thead><tr><th>å·¥å…·ç±»</th><th>å†…å­˜å±éšœä½¿ç”¨</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td><strong>AtomicInteger</strong></td><td>CAS + volatileè¯­ä¹‰</td><td>è®¡æ•°å™¨ã€åºåˆ—å·ç”Ÿæˆ</td></tr><tr><td><strong>ReentrantLock</strong></td><td>AQSçš„stateå­—æ®µï¼ˆvolatileï¼‰</td><td>å¤æ‚åŒæ­¥åœºæ™¯</td></tr><tr><td><strong>ConcurrentHashMap</strong></td><td>Unsafe.putObjectVolatile</td><td>é«˜å¹¶å‘Map</td></tr><tr><td><strong>FutureTask</strong></td><td>volatile state</td><td>å¼‚æ­¥ä»»åŠ¡</td></tr><tr><td><strong>ThreadPoolExecutor</strong></td><td>volatile ctlå­—æ®µ</td><td>çº¿ç¨‹æ± çŠ¶æ€ç®¡ç†</td></tr></tbody></table>
<h4 data-id="heading-63">æºç é˜…è¯»æ¨è</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. java.util.concurrent.atomic.AtomicInteger</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementAndGet</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> unsafe.getAndAddInt(<span class="hljs-built_in">this</span>, valueOffset, <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// 2. java.util.concurrent.locks.AbstractQueuedSynchronizer</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> state;  <span class="hljs-comment">// AQSæ ¸å¿ƒçŠ¶æ€</span>

<span class="hljs-comment">// 3. java.util.concurrent.ConcurrentHashMap (JDK 8)</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> &lt;K,V&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">casTabAt</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, <span class="hljs-type">int</span> i,
                                    Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> {
    <span class="hljs-keyword">return</span> U.compareAndSwapObject(tab, ((<span class="hljs-type">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);
}

<span class="hljs-comment">// 4. java.lang.invoke.VarHandle (JDK 9+)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSet</span><span class="hljs-params">(Object... args)</span>;
</code></pre>
<h3 data-id="heading-64">10.3 è¿›ä¸€æ­¥å­¦ä¹ æ–¹å‘</h3>
<h4 data-id="heading-65">ğŸ“š æ¨èé˜…è¯»</h4>
<ol>
<li>
<p><strong>ä¹¦ç±</strong></p>
<ul>
<li>ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ï¼ˆBrian Goetzï¼‰</li>
<li>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼ˆå‘¨å¿—æ˜ï¼‰</li>
<li>ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ï¼ˆæ–¹è…¾é£ï¼‰</li>
<li>ã€ŠComputer Architecture: A Quantitative Approachã€‹ï¼ˆå†…å­˜æ¨¡å‹ç« èŠ‚ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è®ºæ–‡</strong></p>
<ul>
<li>"Java Memory Model"ï¼ˆJSR-133è§„èŒƒï¼‰</li>
<li>"x86-TSO: A Rigorous and Usable Programmer's Model for x86 Multiprocessors"</li>
<li>"Compiler and Hardware Techniques for Thread-Level Speculation"</li>
</ul>
</li>
<li>
<p><strong>æºç </strong></p>
<ul>
<li>OpenJDK Hotspot: <code>hotspot/src/share/vm/runtime/orderAccess.hpp</code></li>
<li>OpenJDK Hotspot: <code>hotspot/src/os_cpu/linux_x86/orderAccess_linux_x86.hpp</code></li>
<li>Doug Leaçš„å¹¶å‘å·¥å…·åŒ…å®ç°</li>
</ul>
</li>
</ol>
<h4 data-id="heading-66">ğŸ› ï¸ å®æˆ˜ç»ƒä¹ </h4>
<ol>
<li>
<p><strong>ç¼–å†™åŸºå‡†æµ‹è¯•</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨JMHæµ‹è¯•ä¸åŒå†…å­˜å±éšœçš„æ€§èƒ½</span>
<span class="hljs-meta">@Benchmark</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testVolatileWrite</span><span class="hljs-params">()</span> {
    volatileVar = <span class="hljs-number">1</span>;
}

<span class="hljs-meta">@Benchmark</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testVarHandleRelease</span><span class="hljs-params">()</span> {
    HANDLE.setRelease(<span class="hljs-built_in">this</span>, <span class="hljs-number">1</span>);
}
</code></pre>
</li>
<li>
<p><strong>å®ç°æ— é”æ•°æ®ç»“æ„</strong></p>
<ul>
<li>æ— é”é˜Ÿåˆ—ï¼ˆMichael-Scott Queueï¼‰</li>
<li>æ— é”æ ˆï¼ˆTreiber Stackï¼‰</li>
<li>æ— é”é“¾è¡¨ï¼ˆHarris-Michael Linked Listï¼‰</li>
</ul>
</li>
<li>
<p><strong>è°ƒè¯•å†…å­˜å±éšœ</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹JITç”Ÿæˆçš„æ±‡ç¼–ä»£ç </span>
java -XX:+UnlockDiagnosticVMOptions \
     -XX:+PrintAssembly \
     -XX:CompileCommand=<span class="hljs-built_in">print</span>,*YourClass.method \
     YourClass
</code></pre>
</li>
<li>
<p><strong>æ€§èƒ½åˆ†æå·¥å…·</strong></p>
<ul>
<li>JMHï¼ˆå¾®åŸºå‡†æµ‹è¯•ï¼‰</li>
<li>Async-profilerï¼ˆCPUç«ç„°å›¾ï¼‰</li>
<li>JMCï¼ˆJava Mission Controlï¼‰</li>
<li>perfï¼ˆLinuxæ€§èƒ½åˆ†æï¼‰</li>
</ul>
</li>
</ol>
<h4 data-id="heading-67">ğŸ¯ è¿›é˜¶ä¸»é¢˜</h4>
<ol>
<li>
<p><strong>CPUæ¶æ„æ·±åº¦</strong></p>
<ul>
<li>äº†è§£ARMã€POWERã€RISC-Vçš„å†…å­˜æ¨¡å‹</li>
<li>å­¦ä¹ ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆMESIã€MOESIã€MESIFï¼‰</li>
<li>ç ”ç©¶å†™ç¼“å†²åŒºï¼ˆStore Bufferï¼‰å’Œå¤±æ•ˆé˜Ÿåˆ—ï¼ˆInvalidate Queueï¼‰</li>
</ul>
</li>
<li>
<p><strong>JVMä¼˜åŒ–</strong></p>
<ul>
<li>é€ƒé€¸åˆ†æå¯¹å±éšœçš„å½±å“</li>
<li>JITç¼–è¯‘å™¨å¦‚ä½•ä¼˜åŒ–å†…å­˜å±éšœ</li>
<li>Graalç¼–è¯‘å™¨çš„å†…å­˜æ¨¡å‹æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘ç¼–ç¨‹æ¨¡å¼</strong></p>
<ul>
<li>å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆPublisher-Subscriberï¼‰</li>
<li>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆæ— é”å®ç°ï¼‰</li>
<li>æ— é”åŒ–ç®—æ³•è®¾è®¡åŸåˆ™</li>
</ul>
</li>
<li>
<p><strong>è·¨è¯­è¨€å¯¹æ¯”</strong></p>
<ul>
<li>C++ memory_orderï¼ˆacquire/release/seq_cstï¼‰</li>
<li>Goçš„å†…å­˜æ¨¡å‹ï¼ˆchannelå’Œsync.Mutexï¼‰</li>
<li>Rustçš„Send/Sync trait</li>
</ul>
</li>
</ol>
<h3 data-id="heading-68">10.4 é¢è¯•å‡†å¤‡å»ºè®®</h3>
<h4 data-id="heading-69">åŸºç¡€é¢ï¼ˆåˆçº§-ä¸­çº§ï¼‰</h4>
<ul>
<li>âœ… volatileçš„ä¸¤å¤§ä½œç”¨</li>
<li>âœ… volatileä¸ºä»€ä¹ˆä¸ä¿è¯åŸå­æ€§</li>
<li>âœ… DCLä¸ºä»€ä¹ˆéœ€è¦volatile</li>
<li>âœ… synchronizedçš„å†…å­˜è¯­ä¹‰</li>
<li>âœ… happens-beforeè§„åˆ™</li>
</ul>
<h4 data-id="heading-70">è¿›é˜¶é¢ï¼ˆä¸­çº§-é«˜çº§ï¼‰</h4>
<ul>
<li>âœ… å››ç§å†…å­˜å±éšœçš„å…·ä½“ä½œç”¨</li>
<li>âœ… volatileåº•å±‚å®ç°ï¼ˆå­—èŠ‚ç â†’JVMâ†’CPUï¼‰</li>
<li>âœ… MESIç¼“å­˜ä¸€è‡´æ€§åè®®</li>
<li>âœ… ä¼ªå…±äº«é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</li>
<li>âœ… VarHandleä¸volatileçš„åŒºåˆ«</li>
</ul>
<h4 data-id="heading-71">æ·±åº¦é¢ï¼ˆé«˜çº§-ä¸“å®¶ï¼‰</h4>
<ul>
<li>âœ… ä¸åŒCPUæ¶æ„çš„å†…å­˜æ¨¡å‹å·®å¼‚</li>
<li>âœ… x86çš„TSOæ¨¡å‹vs ARMçš„å¼±æ¨¡å‹</li>
<li>âœ… JITç¼–è¯‘å™¨å¦‚ä½•ä¼˜åŒ–å†…å­˜å±éšœ</li>
<li>âœ… æ— é”æ•°æ®ç»“æ„çš„è®¾è®¡åŸåˆ™</li>
<li>âœ… é«˜æ€§èƒ½è®¡æ•°å™¨çš„å®ç°æ€è·¯</li>
</ul>
<h4 data-id="heading-72">é¢è¯•è¯æœ¯æ¨¡æ¿</h4>
<p><strong>å›ç­”æ¡†æ¶</strong>ï¼šå®šä¹‰ â†’ åŸç† â†’ å®ç° â†’ åœºæ™¯ â†’ é™·é˜±</p>
<pre><code class="hljs language-markdown" lang="markdown">é¢è¯•å®˜ï¼šè§£é‡Šä¸€ä¸‹volatileï¼Ÿ

å›ç­”ï¼š
<span class="hljs-bullet">1.</span> å®šä¹‰ï¼švolatileæ˜¯Javaçš„è½»é‡çº§åŒæ­¥æœºåˆ¶ï¼Œä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ã€‚

<span class="hljs-bullet">2.</span> åŸç†ï¼šé€šè¿‡æ’å…¥å†…å­˜å±éšœï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼Œè§¦å‘ç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚

<span class="hljs-bullet">3.</span> å®ç°ï¼šJVMé€šè¿‡Unsafeç±»æ’å…¥å±éšœï¼ŒCPUä½¿ç”¨lockæŒ‡ä»¤åˆ·æ–°ç¼“å­˜ã€‚

<span class="hljs-bullet">4.</span> åœºæ™¯ï¼šé€‚åˆå•å˜é‡çš„çŠ¶æ€æ ‡å¿—ã€ä¸€æ¬¡æ€§å®‰å…¨å‘å¸ƒç­‰è¯»å¤šå†™å°‘åœºæ™¯ã€‚

<span class="hljs-bullet">5.</span> é™·é˜±ï¼šä¸ä¿è¯å¤åˆæ“ä½œåŸå­æ€§ï¼Œéœ€è¦æ³¨æ„å¯¹è±¡å¼•ç”¨çš„å¯è§æ€§é—®é¢˜ã€‚

ï¼ˆæ ¹æ®é¢è¯•å®˜ååº”ï¼Œæ·±å…¥è®²è§£æŸä¸ªéƒ¨åˆ†ï¼‰
</code></pre>
<hr/>
<h2 data-id="heading-73">ç»“è¯­</h2>
<p>å†…å­˜å±éšœæ˜¯å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ï¼Œä»CPUç¡¬ä»¶åˆ°JVMå®ç°ï¼Œå†åˆ°Javaè¯­è¨€ç‰¹æ€§ï¼Œå®ƒè´¯ç©¿äº†æ•´ä¸ªæŠ€æœ¯æ ˆã€‚ç†è§£å†…å­˜å±éšœï¼Œä¸ä»…èƒ½å¸®ä½ å†™å‡ºæ­£ç¡®çš„å¹¶å‘ä»£ç ï¼Œæ›´èƒ½è®©ä½ åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºã€‚</p>
<p><strong>è®°ä½è¿™å¥è¯</strong>ï¼š</p>
<blockquote>
<p>å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒä¸æ˜¯åŠ é”ï¼Œè€Œæ˜¯ç†è§£å†…å­˜æ¨¡å‹ã€‚å†…å­˜å±éšœè®©ä½ ä»"ä¼šç”¨"èµ°å‘"ç²¾é€š"ã€‚</p>
</blockquote>
<p>å›åˆ°å¼€ç¯‡çš„å‡Œæ™¨2ç‚¹ï¼Œå½“ä½ å†æ¬¡é‡åˆ°è¯¡å¼‚çš„å¹¶å‘bugæ—¶ï¼Œä¸å¦¨é—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>æ˜¯å¦ä¿è¯äº†<strong>å¯è§æ€§</strong>ï¼Ÿï¼ˆç”¨volatileæˆ–synchronizedï¼‰</li>
<li>æ˜¯å¦ä¿è¯äº†<strong>åŸå­æ€§</strong>ï¼Ÿï¼ˆç”¨Atomicæˆ–é”ï¼‰</li>
<li>æ˜¯å¦ä¿è¯äº†<strong>æœ‰åºæ€§</strong>ï¼Ÿï¼ˆç†è§£å†…å­˜å±éšœæ’å…¥ä½ç½®ï¼‰</li>
</ol>
<p>æŒæ¡å†…å­˜å±éšœï¼Œä½ å°±æŒæ¡äº†å¹¶å‘ç¼–ç¨‹çš„é’¥åŒ™ã€‚ğŸ”‘</p>
<hr/>
<p><strong>æœ¬æ–‡å®Œæ•´æ¶µç›–äº†Javaå†…å­˜å±éšœçš„æ‰€æœ‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬ï¼š</strong></p>
<ul>
<li>âœ… 4ç§å†…å­˜å±éšœç±»å‹åŠåº”ç”¨</li>
<li>âœ… volatileåº•å±‚å®ç°ï¼ˆå­—èŠ‚ç â†’æ±‡ç¼–ï¼‰</li>
<li>âœ… MESIç¼“å­˜ä¸€è‡´æ€§åè®®</li>
<li>âœ… CPUæ¶æ„å·®å¼‚ï¼ˆx86 vs ARMï¼‰</li>
<li>âœ… æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼ˆä¼ªå…±äº«ã€åˆ†æ®µè®¡æ•°ï¼‰</li>
<li>âœ… 10é“é«˜é¢‘é¢è¯•é¢˜åŠæ ‡å‡†ç­”æ¡ˆ</li>
<li>âœ… 5ä¸ªå¸¸è§å‘åŠæœ€ä½³å®è·µ</li>
</ul>
<p><strong>å­—æ•°ç»Ÿè®¡</strong>ï¼šçº¦ 15,000 å­—<br/>
<strong>ä»£ç ç¤ºä¾‹</strong>ï¼š20+ ä¸ªå®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹<br/>
<strong>å›¾è¡¨</strong>ï¼š5ä¸ª Mermaid æµç¨‹å›¾/çŠ¶æ€å›¾<br/>
<strong>é¢è¯•é¢˜</strong>ï¼š10é“ï¼ˆåŸºç¡€3é“ + è¿›é˜¶3é“ + é«˜çº§4é“ï¼‰</p>
<hr/>
<p><strong>å…³æ³¨ä½œè€…ï¼Œè·å–æ›´å¤šæ·±åº¦æŠ€æœ¯æ–‡ç« ï¼</strong> ğŸ“–</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é˜²æŠ–ä¸èŠ‚æµï¼šä¼˜åŒ–å‰ç«¯æ€§èƒ½çš„ä¸¤ç§å…³é”®æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7573504290066989071</link>    <guid>https://juejin.cn/post/7573504290066989071</guid>    <pubDate>2025-11-17T16:00:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573504290066989071" data-draft-id="7573530680886820898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜²æŠ–ä¸èŠ‚æµï¼šä¼˜åŒ–å‰ç«¯æ€§èƒ½çš„ä¸¤ç§å…³é”®æŠ€æœ¯"/> <meta itemprop="keywords" content="JavaScript,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-17T16:00:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¿›å‡»çš„é‡äºº"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜²æŠ–ä¸èŠ‚æµï¼šä¼˜åŒ–å‰ç«¯æ€§èƒ½çš„ä¸¤ç§å…³é”®æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¿›å‡»çš„é‡äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T16:00:25.000Z" title="Mon Nov 17 2025 16:00:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œç”¨æˆ·äº¤äº’çš„æµç•…æ€§å’Œå“åº”é€Ÿåº¦æ˜¯è¡¡é‡åº”ç”¨è´¨é‡çš„é‡è¦æ ‡å‡†ã€‚ç„¶è€Œï¼ŒæŸäº›é«˜é¢‘è§¦å‘çš„äº‹ä»¶ï¼ˆå¦‚æ»šåŠ¨ã€é¼ æ ‡ç§»åŠ¨ã€è¾“å…¥ç­‰ï¼‰å¦‚æœå¤„ç†ä¸å½“ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚é˜²æŠ–ï¼ˆDebounceï¼‰å’ŒèŠ‚æµï¼ˆThrottleï¼‰æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜è€Œç”Ÿçš„ä¸¤ç§å…³é”®æŠ€æœ¯ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™ä¸¤ç§æŠ€æœ¯çš„åŸç†ã€åŒºåˆ«ã€åº”ç”¨åœºæ™¯ï¼Œå¹¶é€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå¦‚ä½•åœ¨å‰ç«¯é¡¹ç›®ä¸­æœ‰æ•ˆåº”ç”¨å®ƒä»¬ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€é˜²æŠ–ä¸èŠ‚æµçš„åŸºæœ¬æ¦‚å¿µ</h2>
<h3 data-id="heading-1">1.1 é˜²æŠ–ï¼ˆDebounceï¼‰</h3>
<p>é˜²æŠ–çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨å•ä½æ—¶é—´å†…ï¼Œæ— è®ºäº‹ä»¶è¢«è§¦å‘å¤šå°‘æ¬¡ï¼Œåªæ‰§è¡Œæœ€åä¸€æ¬¡ã€‚è¿™ç±»ä¼¼äºç‹è€…è£è€€ä¸­çš„å›åŸåŠŸèƒ½â€”â€”ä¸€æ—¦åœ¨å›åŸè¿‡ç¨‹ä¸­è¢«æ”»å‡»æ‰“æ–­ï¼Œå°±éœ€è¦é‡æ–°å¼€å§‹å›åŸã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æœç´¢æ¡†è¾“å…¥å®æ—¶éªŒè¯</li>
<li>æ‰‹æœºå·ã€é‚®ç®±ç­‰è¡¨å•å­—æ®µçš„å®æ—¶éªŒè¯</li>
<li>çª—å£resizeäº‹ä»¶ï¼Œåªéœ€åœ¨çª—å£åœæ­¢æ”¹å˜å¤§å°åæ‰§è¡Œä¸€æ¬¡</li>
</ul>
<h3 data-id="heading-2">1.2 èŠ‚æµï¼ˆThrottleï¼‰</h3>
<p>èŠ‚æµçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨å•ä½æ—¶é—´å†…ï¼Œæ— è®ºäº‹ä»¶è¢«è§¦å‘å¤šå°‘æ¬¡ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚è¿™ç±»ä¼¼äºç‹è€…è£è€€ä¸­çš„æ™®é€šæ”»å‡»â€”â€”æ¯æ¬¡æ”»å‡»åéƒ½æœ‰ä¸€ä¸ªå†·å´æ—¶é—´ï¼Œåœ¨å†·å´æ—¶é—´å†…æ— æ³•å†æ¬¡æ”»å‡»ã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¼ æ ‡ç§»åŠ¨äº‹ä»¶</li>
<li>é¡µé¢å°ºå¯¸ç¼©æ”¾äº‹ä»¶</li>
<li>æ»šåŠ¨äº‹ä»¶ï¼Œåªéœ€åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­å®šæœŸæ‰§è¡Œ</li>
</ul>
<h3 data-id="heading-3">1.3 æ ¸å¿ƒåŒºåˆ«</h3>
<p>é˜²æŠ–å’ŒèŠ‚æµçš„æ ¸å¿ƒåŒºåˆ«åœ¨äºï¼šåœ¨å•ä½æ—¶é—´å†…ï¼Œé˜²æŠ–åªæ‰§è¡Œæœ€åä¸€æ¬¡è§¦å‘ï¼Œè€ŒèŠ‚æµåªæ‰§è¡Œç¬¬ä¸€æ¬¡è§¦å‘ã€‚è¿™ä¸€å·®å¼‚å†³å®šäº†å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„é€‚ç”¨æ€§ã€‚</p>
<h2 data-id="heading-4">äºŒã€é˜²æŠ–ä¸èŠ‚æµçš„å®ç°åŸç†</h2>
<h3 data-id="heading-5">2.1 é˜²æŠ–çš„å®ç°åŸç†</h3>
<p>é˜²æŠ–çš„å®ç°ä¾èµ–äºJavaScriptçš„å®šæ—¶å™¨æœºåˆ¶ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œå¤„ç†å‡½æ•°ï¼Œè€Œæ˜¯å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ã€‚å¦‚æœåœ¨å®šæ—¶å™¨åˆ°æœŸå‰äº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œåˆ™æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨å¹¶é‡æ–°è®¾ç½®ã€‚åªæœ‰å½“äº‹ä»¶åœæ­¢è§¦å‘ä¸”å®šæ—¶å™¨åˆ°æœŸåï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œå¤„ç†å‡½æ•°ã€‚</p>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-ini" lang="ini">function debounce(func, delay) {
  let timer<span class="hljs-comment">;</span>
  return function() {
    const <span class="hljs-attr">context</span> = this<span class="hljs-comment">;</span>
    const <span class="hljs-attr">args</span> = arguments<span class="hljs-comment">;</span>
    clearTimeout(timer)<span class="hljs-comment">;</span>
    <span class="hljs-attr">timer</span> = setTimeout(() =&gt; {
      func.apply(context, args)<span class="hljs-comment">;</span>
    }, delay)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-6">2.2 èŠ‚æµçš„å®ç°åŸç†</h3>
<p>èŠ‚æµçš„å®ç°ä¹Ÿæœ‰å¤šç§æ–¹å¼ï¼Œæœ€å¸¸è§çš„æ˜¯ä½¿ç”¨æ—¶é—´æˆ³å’Œå®šæ—¶å™¨ã€‚æ—¶é—´æˆ³æ–¹å¼é€šè¿‡æ¯”è¾ƒå½“å‰æ—¶é—´ä¸ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥æ‰§è¡Œå‡½æ•°ï¼›å®šæ—¶å™¨æ–¹å¼åˆ™ç¡®ä¿åœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…åªæ‰§è¡Œä¸€æ¬¡å‡½æ•°ã€‚</p>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-ini" lang="ini">// æ—¶é—´æˆ³å®ç°
function throttle(func, delay) {
  let <span class="hljs-attr">prev</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  return function() {
    const <span class="hljs-attr">now</span> = Date.now()<span class="hljs-comment">;</span>
    if (now - prev &gt; delay) {
      func.apply(this, arguments)<span class="hljs-comment">;</span>
      <span class="hljs-attr">prev</span> = now<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
}

// å®šæ—¶å™¨å®ç°
function throttle(func, delay) {
  let timer<span class="hljs-comment">;</span>
  return function() {
    const <span class="hljs-attr">context</span> = this<span class="hljs-comment">;</span>
    const <span class="hljs-attr">args</span> = arguments<span class="hljs-comment">;</span>
    if (!timer) {
      <span class="hljs-attr">timer</span> = setTimeout(() =&gt; {
        func.apply(context, args)<span class="hljs-comment">;</span>
        <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
      }, delay)<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€å®é™…åº”ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-8">3.1 é˜²æŠ–åœ¨æœç´¢æ¡†ä¸­çš„åº”ç”¨</h3>
<p>åœ¨æœç´¢æ¡†è¾“å…¥åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›åœ¨ç”¨æˆ·åœæ­¢è¾“å…¥åå†å‘é€è¯·æ±‚ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡æŒ‰é”®æ—¶éƒ½å‘é€ã€‚è¿™ä¸ä»…å¯ä»¥å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚ï¼Œè¿˜èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<p>html</p>
<p>å¤åˆ¶ä¸‹è½½è¿è¡Œ</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>é˜²æŠ–ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"search"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥æœç´¢å†…å®¹"</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'search'</span>);
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">search</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‘é€æœç´¢è¯·æ±‚:'</span>, searchInput.<span class="hljs-property">value</span>);
      <span class="hljs-comment">// å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šå‘é€AJAXè¯·æ±‚</span>
    }
    
    searchInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, _.<span class="hljs-title function_">debounce</span>(search, <span class="hljs-number">500</span>));
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå³ä½¿ç”¨æˆ·å¿«é€Ÿè¿ç»­è¾“å…¥ï¼Œæœç´¢è¯·æ±‚ä¹Ÿåªä¼šåœ¨ç”¨æˆ·åœæ­¢è¾“å…¥500æ¯«ç§’åå‘é€ä¸€æ¬¡ã€‚</p>
<h3 data-id="heading-9">3.2 èŠ‚æµåœ¨é¼ æ ‡ç§»åŠ¨ä¸­çš„åº”ç”¨</h3>
<p>åœ¨æŸäº›äº¤äº’åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è·Ÿè¸ªé¼ æ ‡ç§»åŠ¨ï¼Œä½†å¦‚æœå¯¹æ¯ä¸ªmousemoveäº‹ä»¶éƒ½æ‰§è¡Œå¤æ‚æ“ä½œï¼Œä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨èŠ‚æµæ¥é™åˆ¶æ‰§è¡Œé¢‘ç‡ã€‚</p>
<p>html</p>
<p>å¤åˆ¶ä¸‹è½½è¿è¡Œ</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>èŠ‚æµç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-class">.box</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: pink;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> box = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
    <span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mouseMove</span>(<span class="hljs-params"/>){
      box.<span class="hljs-property">innerHTML</span> = i++;
    }
    
    <span class="hljs-comment">// ä½¿ç”¨èŠ‚æµï¼Œæ¯500æ¯«ç§’æœ€å¤šæ‰§è¡Œä¸€æ¬¡</span>
    box.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, _.<span class="hljs-title function_">throttle</span>(mouseMove, <span class="hljs-number">500</span>));
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå³ä½¿ç”¨æˆ·å¿«é€Ÿç§»åŠ¨é¼ æ ‡ï¼Œè®¡æ•°å™¨çš„å¢åŠ ä¹Ÿä¼šè¢«é™åˆ¶åœ¨æ¯500æ¯«ç§’æœ€å¤šä¸€æ¬¡ï¼Œé¿å…äº†è¿‡äºé¢‘ç¹çš„DOMæ“ä½œã€‚</p>
<h3 data-id="heading-10">3.3 ç»¼åˆæ¡ˆä¾‹ï¼šè§†é¢‘æ’­æ”¾è¿›åº¦ä¿å­˜</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ç»“åˆä½¿ç”¨å¤šç§æŠ€æœ¯ã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨è§†é¢‘æ’­æ”¾è¿‡ç¨‹ä¸­ä½¿ç”¨èŠ‚æµæ¥ä¿å­˜æ’­æ”¾è¿›åº¦ï¼Œå¹¶åœ¨é¡µé¢é‡æ–°åŠ è½½æ—¶æ¢å¤æ’­æ”¾ä½ç½®ã€‚</p>
<p>html</p>
<p>å¤åˆ¶ä¸‹è½½è¿è¡Œ</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"referrer"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"never"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç»¼åˆæ¡ˆä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }

    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">1200px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    }

    <span class="hljs-selector-class">.video</span> <span class="hljs-selector-tag">video</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-selector-class">.elevator</span> {
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">280px</span>;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">z-index</span>: <span class="hljs-number">999</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e4e4e4</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
    }

    <span class="hljs-selector-class">.elevator</span> <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">display</span>: block;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">text-decoration</span>: none;
      <span class="hljs-attribute">text-align</span>: center;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
    }

    <span class="hljs-selector-class">.elevator</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.active</span> {
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#1286ff</span>;
    }

    <span class="hljs-selector-class">.outline</span> {
      <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">300px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://pip.itcast.cn"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pip.itcast.cn/img/logo_v3.29b9ba72.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://v.itheima.net/LapADhV6.mp4"</span> <span class="hljs-attr">controls</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"elevator"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">data-ref</span>=<span class="hljs-string">"video"</span>&gt;</span>è§†é¢‘ä»‹ç»<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">data-ref</span>=<span class="hljs-string">"intro"</span>&gt;</span>è¯¾ç¨‹ç®€ä»‹<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">data-ref</span>=<span class="hljs-string">"outline"</span>&gt;</span>è¯„è®ºåˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// è·å–è§†é¢‘å…ƒç´ </span>
    <span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>);
    
    <span class="hljs-comment">// ä½¿ç”¨èŠ‚æµä¿å­˜æ’­æ”¾è¿›åº¦</span>
    video.<span class="hljs-property">ontimeupdate</span> = _.<span class="hljs-title function_">throttle</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æŠŠå½“å‰æ’­æ”¾æ—¶é—´å­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨</span>
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'currentTime'</span>, video.<span class="hljs-property">currentTime</span>);
    }, <span class="hljs-number">1000</span>);

    <span class="hljs-comment">// é¡µé¢åŠ è½½æ—¶æ¢å¤æ’­æ”¾è¿›åº¦</span>
    video.<span class="hljs-property">onloadeddata</span> = <span class="hljs-function">() =&gt;</span> {
      video.<span class="hljs-property">currentTime</span> = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'currentTime'</span>) || <span class="hljs-number">0</span>;
    };
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>åœ¨è¿™ä¸ªç»¼åˆæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨èŠ‚æµæŠ€æœ¯é™åˆ¶äº†æ’­æ”¾è¿›åº¦ä¿å­˜çš„é¢‘ç‡ï¼Œé¿å…äº†è¿‡äºé¢‘ç¹çš„æœ¬åœ°å­˜å‚¨æ“ä½œã€‚åŒæ—¶ï¼Œåœ¨é¡µé¢åŠ è½½æ—¶ï¼Œæˆ‘ä»¬ä¼šä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–ä¹‹å‰ä¿å­˜çš„æ’­æ”¾ä½ç½®ï¼Œå®ç°ç»­æ’­åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-11">å››ã€Lodashåº“ä¸­çš„é˜²æŠ–ä¸èŠ‚æµ</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦è‡ªå·±å®ç°é˜²æŠ–å’ŒèŠ‚æµå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æˆç†Ÿçš„å·¥å…·åº“å¦‚Lodashã€‚Lodashæä¾›äº†ç»è¿‡å……åˆ†æµ‹è¯•å’Œä¼˜åŒ–çš„<code>_.debounce</code>å’Œ<code>_.throttle</code>å‡½æ•°ã€‚</p>
<h3 data-id="heading-12">4.1 Lodashé˜²æŠ–å‡½æ•°</h3>
<p><code>_.debounce(func, [wait=0], [options={}])</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>func</code>: è¦é˜²æŠ–åŠ¨çš„å‡½æ•°</li>
<li><code>[wait=0]</code>: éœ€è¦å»¶è¿Ÿçš„æ¯«ç§’æ•°</li>
<li><code>[options={}]</code>: é€‰é¡¹å¯¹è±¡ï¼Œå¯é…ç½®<code>leading</code>ï¼ˆæ˜¯å¦åœ¨å»¶è¿Ÿå¼€å§‹å‰è°ƒç”¨ï¼‰å’Œ<code>trailing</code>ï¼ˆæ˜¯å¦åœ¨å»¶è¿Ÿç»“æŸåè°ƒç”¨ï¼‰</li>
</ul>
<h3 data-id="heading-13">4.2 LodashèŠ‚æµå‡½æ•°</h3>
<p><code>_.throttle(func, [wait=0], [options={}])</code></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>func</code>: è¦èŠ‚æµçš„å‡½æ•°</li>
<li><code>[wait=0]</code>: éœ€è¦èŠ‚æµçš„æ¯«ç§’æ•°</li>
<li><code>[options={}]</code>: é€‰é¡¹å¯¹è±¡ï¼Œå¯é…ç½®<code>leading</code>ï¼ˆæ˜¯å¦åœ¨èŠ‚æµå¼€å§‹å‰è°ƒç”¨ï¼‰å’Œ<code>trailing</code>ï¼ˆæ˜¯å¦åœ¨èŠ‚æµç»“æŸåè°ƒç”¨ï¼‰</li>
</ul>
<h2 data-id="heading-14">äº”ã€é«˜çº§åº”ç”¨ä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-15">5.1 é˜²æŠ–ä¸èŠ‚æµçš„ç»“åˆä½¿ç”¨</h3>
<p>åœ¨æŸäº›å¤æ‚åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åŒæ—¶ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµã€‚ä¾‹å¦‚ï¼Œåœ¨å®ç°æ— é™æ»šåŠ¨åŠ è½½æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨ç”¨æˆ·å¿«é€Ÿæ»šåŠ¨æ—¶ä½¿ç”¨èŠ‚æµå®šæœŸæ£€æŸ¥ä½ç½®ï¼Œè€Œåœ¨ç”¨æˆ·åœæ­¢æ»šåŠ¨æ—¶ä½¿ç”¨é˜²æŠ–è§¦å‘æœ€ç»ˆçš„åŠ è½½æ“ä½œã€‚</p>
<h3 data-id="heading-16">5.2 å–æ¶ˆæ“ä½œ</h3>
<p>Lodashçš„é˜²æŠ–å’ŒèŠ‚æµå‡½æ•°è¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªå…·æœ‰å–æ¶ˆåŠŸèƒ½çš„æ–°å‡½æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦æ—¶å–æ¶ˆå¾…æ‰§è¡Œçš„å‡½æ•°è°ƒç”¨ã€‚</p>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-scss" lang="scss">const debouncedFunc = _<span class="hljs-selector-class">.debounce</span>(someFunction, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// æ‰§è¡Œé˜²æŠ–å‡½æ•°</span>
<span class="hljs-built_in">debouncedFunc</span>();

<span class="hljs-comment">// å–æ¶ˆå¾…æ‰§è¡Œçš„é˜²æŠ–è°ƒç”¨</span>
debouncedFunc<span class="hljs-selector-class">.cancel</span>();
</code></pre>
<h3 data-id="heading-17">5.3 ç«‹å³æ‰§è¡Œé€‰é¡¹</h3>
<p>åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›äº‹ä»¶ç¬¬ä¸€æ¬¡è§¦å‘æ—¶ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œç„¶ååœ¨ä¸€å®šæ—¶é—´å†…ä¸å†è§¦å‘ã€‚è¿™å¯ä»¥é€šè¿‡é…ç½®é€‰é¡¹å®ç°ã€‚</p>
<p>javascript</p>
<p>å¤åˆ¶ä¸‹è½½</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// é¦–æ¬¡è§¦å‘ç«‹å³æ‰§è¡Œï¼Œåç»­è§¦å‘åœ¨åœæ­¢å500msæ‰§è¡Œ</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">debouncedFunc</span> = _.<span class="hljs-title function_ invoke__">debounce</span>(someFunction, <span class="hljs-number">500</span>, { <span class="hljs-attr">leading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">trailing</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// é¦–æ¬¡è§¦å‘ç«‹å³æ‰§è¡Œï¼Œåç»­è§¦å‘æ¯500msæ‰§è¡Œä¸€æ¬¡</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">throttledFunc</span> = _.<span class="hljs-title function_ invoke__">throttle</span>(someFunction, <span class="hljs-number">500</span>, { <span class="hljs-attr">leading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">trailing</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h2 data-id="heading-18">å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸å®è·µå»ºè®®</h2>
<h3 data-id="heading-19">6.1 åˆç†è®¾ç½®å»¶è¿Ÿæ—¶é—´</h3>
<p>é˜²æŠ–å’ŒèŠ‚æµçš„æ•ˆæœå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå»¶è¿Ÿæ—¶é—´çš„è®¾ç½®ã€‚æ—¶é—´å¤ªçŸ­å¯èƒ½èµ·ä¸åˆ°ä¼˜åŒ–ä½œç”¨ï¼Œæ—¶é—´å¤ªé•¿åˆ™ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚ä¸€èˆ¬æ¥è¯´ï¼š</p>
<ul>
<li>å¯¹äºæœç´¢æ¡†è¾“å…¥ï¼Œ200-500æ¯«ç§’çš„å»¶è¿Ÿè¾ƒä¸ºåˆé€‚</li>
<li>å¯¹äºæ»šåŠ¨äº‹ä»¶ï¼Œ100-200æ¯«ç§’çš„å»¶è¿Ÿè¾ƒä¸ºåˆé€‚</li>
<li>å¯¹äºé¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼Œ50-100æ¯«ç§’çš„å»¶è¿Ÿè¾ƒä¸ºåˆé€‚</li>
</ul>
<h3 data-id="heading-20">6.2 é¿å…è¿‡åº¦ä½¿ç”¨</h3>
<p>è™½ç„¶é˜²æŠ–å’ŒèŠ‚æµæ˜¯æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼Œä½†ä¸åº”è¿‡åº¦ä½¿ç”¨ã€‚åœ¨æŸäº›éœ€è¦å®æ—¶å“åº”çš„åœºæ™¯ä¸­ï¼ˆå¦‚æ‹–æ‹½æ“ä½œï¼‰ï¼Œä½¿ç”¨è¿™äº›æŠ€æœ¯åè€Œä¼šé™ä½ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-21">6.3 ç»“åˆå…¶ä»–ä¼˜åŒ–æŠ€æœ¯</h3>
<p>é˜²æŠ–å’ŒèŠ‚æµé€šå¸¸ä¸å…¶ä»–æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ç»“åˆä½¿ç”¨ï¼Œå¦‚è™šæ‹Ÿåˆ—è¡¨ã€æ‡’åŠ è½½ç­‰ï¼Œå…±åŒæ„å»ºé«˜æ€§èƒ½çš„Webåº”ç”¨ã€‚</p>
<h2 data-id="heading-22">ä¸ƒã€æ€»ç»“</h2>
<p>é˜²æŠ–å’ŒèŠ‚æµæ˜¯å‰ç«¯å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ã€‚å®ƒä»¬é€šè¿‡ä¸åŒçš„ç­–ç•¥é™åˆ¶å‡½æ•°çš„æ‰§è¡Œé¢‘ç‡ï¼Œæœ‰æ•ˆè§£å†³äº†é«˜é¢‘äº‹ä»¶å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<ul>
<li>é˜²æŠ–é€‚ç”¨äºéœ€è¦ç­‰å¾…æ“ä½œåœæ­¢åå†æ‰§è¡Œçš„åœºæ™¯ï¼Œå¦‚æœç´¢æ¡†è¾“å…¥ã€çª—å£è°ƒæ•´ç­‰</li>
<li>èŠ‚æµé€‚ç”¨äºéœ€è¦å®šæœŸæ‰§è¡Œä½†ä¸éœ€æ¯æ¬¡è§¦å‘éƒ½æ‰§è¡Œçš„åœºæ™¯ï¼Œå¦‚æ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨ç­‰</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·¥ä½œä¸­æœ€å¸¸ç”¨çš„6ç§APIç½‘å…³]]></title>    <link>https://juejin.cn/post/7573594825317253160</link>    <guid>https://juejin.cn/post/7573594825317253160</guid>    <pubDate>2025-11-18T02:18:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573594825317253160" data-draft-id="7573530680887607330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·¥ä½œä¸­æœ€å¸¸ç”¨çš„6ç§APIç½‘å…³"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:18:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ä¸‰è¯´æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·¥ä½œä¸­æœ€å¸¸ç”¨çš„6ç§APIç½‘å…³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ä¸‰è¯´æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:18:02.000Z" title="Tue Nov 18 2025 02:18:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>APIç½‘å…³åœ¨é¡¹ç›®ä¸­éå¸¸é‡è¦ã€‚</p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« è·Ÿå¤§å®¶ä¸€èµ·èŠèŠå·¥ä½œæœ€å¸¸ç”¨çš„6ç§ç½‘å…³ï¼Œå¸Œæœ›å¯¹ä½ ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.susan.net.cn%3Frefer%3Djuejin" title="https://link.juejin.cn/?target=http%3A%2F%2Fwww.susan.net.cn%3Frefer%3Djuejin" target="_blank">æœ€è¿‘å‡†å¤‡é¢è¯•çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªå®è—ç½‘ç«™ï¼ˆJavaçªå‡»é˜Ÿï¼‰ï¼šwww.susan.net.cnï¼Œé‡Œé¢ï¼šé¢è¯•å…«è‚¡æ–‡ã€åœºæ™¯è®¾è®¡é¢˜ã€é¢è¯•çœŸé¢˜ã€7ä¸ªé¡¹ç›®å®æˆ˜ã€å·¥ä½œå†…æ¨ä»€ä¹ˆéƒ½æœ‰</a>ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦APIç½‘å…³ï¼Ÿ</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨å·¥ä½œä¸­å¯èƒ½ä¼šé—®ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿç›´æ¥è°ƒç”¨å¾®æœåŠ¡ä¸æ˜¯æ›´ç®€å•å—ï¼Ÿ</p>
<p>ä¸ºä»€ä¹ˆéè¦å¼•å…¥APIç½‘å…³è¿™ä¸ª"ä¸­é—´å•†"å‘¢ï¼Ÿ</p>
<p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ã€‚</p>
<h3 data-id="heading-2">æ²¡æœ‰ç½‘å…³çš„å¾®æœåŠ¡å›°å¢ƒ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‰ç«¯ç›´æ¥è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ - é—®é¢˜é‡é‡</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrontendController</span> {
    
    <span class="hljs-comment">// é—®é¢˜1ï¼šæœåŠ¡åœ°å€ç¡¬ç¼–ç </span>
    <span class="hljs-meta">@Value("${user.service.url:http://localhost:8081}")</span>
    <span class="hljs-keyword">private</span> String userServiceUrl;
    
    <span class="hljs-meta">@Value("${order.service.url:http://localhost:8082}")</span>
    <span class="hljs-keyword">private</span> String orderServiceUrl;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;
    
    <span class="hljs-meta">@GetMapping("/user-dashboard")</span>
    <span class="hljs-keyword">public</span> UserDashboard <span class="hljs-title function_">getUserDashboard</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("Authorization")</span> String token)</span> {
        <span class="hljs-comment">// é—®é¢˜2ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦é‡å¤è®¤è¯é€»è¾‘</span>
        <span class="hljs-keyword">if</span> (!validateToken(token)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"Token invalid"</span>);
        }
        
        <span class="hljs-comment">// é—®é¢˜3ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†æœåŠ¡é—´è°ƒç”¨é¡ºåº</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> restTemplate.getForObject(userServiceUrl + <span class="hljs-string">"/users/current"</span>, User.class);
        List&lt;Order&gt; orders = restTemplate.getForObject(orderServiceUrl + <span class="hljs-string">"/orders?userId="</span> + user.getId(), List.class);
        
        <span class="hljs-comment">// é—®é¢˜4ï¼šé”™è¯¯å¤„ç†å¤æ‚</span>
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || orders == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceUnavailableException</span>(<span class="hljs-string">"Backend service unavailable"</span>);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDashboard</span>(user, orders);
    }
    
    <span class="hljs-comment">// é—®é¢˜5ï¼šé‡å¤çš„è®¤è¯ä»£ç </span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateToken</span><span class="hljs-params">(String token)</span> {
        <span class="hljs-comment">// æ¯ä¸ªæ¥å£éƒ½è¦å®ç°çš„è®¤è¯é€»è¾‘</span>
        <span class="hljs-keyword">return</span> token != <span class="hljs-literal">null</span> &amp;&amp; token.startsWith(<span class="hljs-string">"Bearer "</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">å¼•å…¥ç½‘å…³åçš„ä¼˜é›…æ¶æ„</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç½‘å…³ç»Ÿä¸€å¤„ç†æ‰€æœ‰æ¨ªåˆ‡å…³æ³¨ç‚¹</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GatewayConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">customRouteLocator</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> {
        <span class="hljs-keyword">return</span> builder.routes()
            .route(<span class="hljs-string">"user_service"</span>, r -&gt; r.path(<span class="hljs-string">"/api/users/**"</span>)
                .uri(<span class="hljs-string">"lb://user-service"</span>))
            .route(<span class="hljs-string">"order_service"</span>, r -&gt; r.path(<span class="hljs-string">"/api/orders/**"</span>)
                .uri(<span class="hljs-string">"lb://order-service"</span>))
            .route(<span class="hljs-string">"product_service"</span>, r -&gt; r.path(<span class="hljs-string">"/api/products/**"</span>)
                .uri(<span class="hljs-string">"lb://product-service"</span>))
            .build();
    }
}

<span class="hljs-comment">// å‰ç«¯åªéœ€è°ƒç”¨ç½‘å…³</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrontendController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestTemplate restTemplate;
    
    <span class="hljs-meta">@GetMapping("/api/user-dashboard")</span>
    <span class="hljs-keyword">public</span> UserDashboard <span class="hljs-title function_">getUserDashboard</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç½‘å…³å·²ç»å¤„ç†äº†è®¤è¯ã€è·¯ç”±ã€è´Ÿè½½å‡è¡¡ç­‰é—®é¢˜</span>
        <span class="hljs-keyword">return</span> restTemplate.getForObject(<span class="hljs-string">"http://gateway/api/users/current/dashboard"</span>, UserDashboard.class);
    }
}
</code></pre>
<h3 data-id="heading-4">APIç½‘å…³çš„æ ¸å¿ƒä»·å€¼</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡æ¶æ„å›¾æ¥ç†è§£ç½‘å…³åœ¨å¾®æœåŠ¡æ¶æ„ä¸­çš„å…³é”®ä½œç”¨ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a0b22cc4a7b42e9a8d3c57431384a95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037082&amp;x-signature=%2F6VuMccszgnP%2FTxBznc0N7cQApo%3D" alt="" loading="lazy"/></p>
<p><strong>ç½‘å…³è§£å†³çš„8å¤§æ ¸å¿ƒé—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>ç»Ÿä¸€å…¥å£</strong>ï¼šæ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ç½‘å…³è¿›å…¥ç³»ç»Ÿ</li>
<li><strong>è®¤è¯æˆæƒ</strong>ï¼šé›†ä¸­å¤„ç†èº«ä»½éªŒè¯å’Œæƒé™æ§åˆ¶</li>
<li><strong>æµé‡æ§åˆ¶</strong>ï¼šé™æµã€ç†”æ–­ã€é™çº§ç­‰ resiliency æ¨¡å¼</li>
<li><strong>ç›‘æ§ç»Ÿè®¡</strong>ï¼šç»Ÿä¸€çš„æ—¥å¿—ã€æŒ‡æ ‡æ”¶é›†</li>
<li><strong>åè®®è½¬æ¢</strong>ï¼šHTTP/1.1ã€HTTP/2ã€gRPC ç­‰åè®®é€‚é…</li>
<li><strong>ç¼“å­˜åŠ é€Ÿ</strong>ï¼šå“åº”ç¼“å­˜é™ä½åç«¯å‹åŠ›</li>
<li><strong>å®‰å…¨é˜²æŠ¤</strong>ï¼šWAFã€é˜²çˆ¬è™«ã€é˜²é‡æ”¾æ”»å‡»</li>
<li><strong>æœåŠ¡æ²»ç†</strong>ï¼šæœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è·¯ç”±è½¬å‘</li>
</ol>
<p>ä¸‹é¢æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å·¥ä½œä¸­æœ€å¸¸è§çš„6ç§APIç½‘å…³æœ‰å“ªäº›ã€‚</p>
<h2 data-id="heading-5">äºŒã€Spring Cloud Gateway</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨SpringæŠ€æœ¯æ ˆä¸­å¼€å‘å¾®æœåŠ¡ï¼ŒSpring Cloud Gateway æ— ç–‘æ˜¯æœ€è‡ªç„¶çš„é€‰æ‹©ã€‚</p>
<p>ä½œä¸ºSpringå®˜æ–¹æ¨å‡ºçš„ç¬¬äºŒä»£ç½‘å…³ï¼Œå®ƒåŸºäºWebFluxå“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œæ€§èƒ½å“è¶Šã€‚</p>
<h3 data-id="heading-6">æ ¸å¿ƒæ¶æ„æ·±åº¦è§£æ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedGatewayConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Order(-1)</span>
    <span class="hljs-keyword">public</span> GlobalFilter <span class="hljs-title function_">customGlobalFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> (exchange, chain) -&gt; {
            <span class="hljs-comment">// å‰ç½®å¤„ç†</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();
            
            <span class="hljs-comment">// æ·»åŠ è¿½è¸ªID</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">traceId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
            <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">mutatedRequest</span> <span class="hljs-operator">=</span> request.mutate()
                .header(<span class="hljs-string">"X-Trace-Id"</span>, traceId)
                .build();
                
            <span class="hljs-keyword">return</span> chain.filter(exchange.mutate().request(mutatedRequest).build())
                .then(Mono.fromRunnable(() -&gt; {
                    <span class="hljs-comment">// åç½®å¤„ç†</span>
                    <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
                    log.info(<span class="hljs-string">"Request {} completed in {}ms"</span>, traceId, duration);
                }));
        };
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">advancedRoutes</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> {
        <span class="hljs-keyword">return</span> builder.routes()
            <span class="hljs-comment">// ç”¨æˆ·æœåŠ¡ - å¸¦ç†”æ–­å’Œé‡è¯•</span>
            .route(<span class="hljs-string">"user_service"</span>, r -&gt; r.path(<span class="hljs-string">"/api/users/**"</span>)
                .filters(f -&gt; f
                    .circuitBreaker(config -&gt; config
                        .setName(<span class="hljs-string">"userServiceCB"</span>)
                        .setFallbackUri(<span class="hljs-string">"forward:/fallback/user-service"</span>))
                    .retry(config -&gt; config
                        .setRetries(<span class="hljs-number">3</span>)
                        .setMethods(HttpMethod.GET, HttpMethod.POST)
                        .setBackoff(<span class="hljs-number">100L</span>, <span class="hljs-number">1000L</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>))
                    .requestRateLimiter(config -&gt; config
                        .setRateLimiter(redisRateLimiter())
                        .setKeyResolver(apiKeyResolver()))
                    .modifyRequestBody(String.class, String.class, 
                        (exchange, s) -&gt; Mono.just(validateAndTransform(s))))
                .uri(<span class="hljs-string">"lb://user-service"</span>))
            
            <span class="hljs-comment">// è®¢å•æœåŠ¡ - å¸¦JWTè®¤è¯</span>
            .route(<span class="hljs-string">"order_service"</span>, r -&gt; r.path(<span class="hljs-string">"/api/orders/**"</span>)
                .filters(f -&gt; f
                    .filter(jwtAuthenticationFilter())
                    .prefixPath(<span class="hljs-string">"/v1"</span>)
                    .addResponseHeader(<span class="hljs-string">"X-API-Version"</span>, <span class="hljs-string">"1.0"</span>))
                .uri(<span class="hljs-string">"lb://order-service"</span>))
            
            <span class="hljs-comment">// å•†å“æœåŠ¡ - é™æ€èµ„æºç¼“å­˜</span>
            .route(<span class="hljs-string">"product_service"</span>, r -&gt; r.path(<span class="hljs-string">"/api/products/**"</span>)
                .filters(f -&gt; f
                    .dedupeResponseHeader(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"RETAIN_FIRST"</span>)
                    .setResponseHeader(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"public, max-age=3600"</span>))
                .uri(<span class="hljs-string">"lb://product-service"</span>))
            .build();
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> JwtAuthenticationFilter <span class="hljs-title function_">jwtAuthenticationFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JwtAuthenticationFilter</span>();
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedisRateLimiter <span class="hljs-title function_">redisRateLimiter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisRateLimiter</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> KeyResolver <span class="hljs-title function_">apiKeyResolver</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> exchange -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">apiKey</span> <span class="hljs-operator">=</span> exchange.getRequest().getHeaders().getFirst(<span class="hljs-string">"X-API-Key"</span>);
            <span class="hljs-keyword">return</span> Mono.just(Optional.ofNullable(apiKey).orElse(<span class="hljs-string">"anonymous"</span>));
        };
    }
}

<span class="hljs-comment">// JWTè®¤è¯è¿‡æ»¤å™¨</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtAuthenticationFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatewayFilter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JwtUtil jwtUtil;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> extractToken(exchange.getRequest());
        
        <span class="hljs-keyword">if</span> (token == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> onError(exchange, <span class="hljs-string">"Missing authentication token"</span>, HttpStatus.UNAUTHORIZED);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> jwtUtil.parseToken(token);
            <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> claims.getSubject();
            
            <span class="hljs-comment">// å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°header</span>
            <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">mutatedRequest</span> <span class="hljs-operator">=</span> exchange.getRequest().mutate()
                .header(<span class="hljs-string">"X-User-Name"</span>, username)
                .header(<span class="hljs-string">"X-User-Roles"</span>, String.join(<span class="hljs-string">","</span>, claims.get(<span class="hljs-string">"roles"</span>, List.class)))
                .build();
                
            <span class="hljs-keyword">return</span> chain.filter(exchange.mutate().request(mutatedRequest).build());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> onError(exchange, <span class="hljs-string">"Invalid token: "</span> + e.getMessage(), HttpStatus.UNAUTHORIZED);
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractToken</span><span class="hljs-params">(ServerHttpRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">bearerToken</span> <span class="hljs-operator">=</span> request.getHeaders().getFirst(<span class="hljs-string">"Authorization"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.hasText(bearerToken) &amp;&amp; bearerToken.startsWith(<span class="hljs-string">"Bearer "</span>)) {
            <span class="hljs-keyword">return</span> bearerToken.substring(<span class="hljs-number">7</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-keyword">private</span> Mono&lt;Void&gt; <span class="hljs-title function_">onError</span><span class="hljs-params">(ServerWebExchange exchange, String err, HttpStatus status)</span> {
        exchange.getResponse().setStatusCode(status);
        <span class="hljs-type">DataBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> exchange.getResponse().bufferFactory()
            .wrap((<span class="hljs-string">"{\"error\":\""</span> + err + <span class="hljs-string">"\"}"</span>).getBytes());
        <span class="hljs-keyword">return</span> exchange.getResponse().writeWith(Mono.just(buffer));
    }
}
</code></pre>
<h3 data-id="heading-7">Spring Cloud Gateway æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3aadd8f06f84f65ba665baa24a1b4e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037082&amp;x-signature=QtfTLKG7jroFTug4l3ISQ3WvaKY%3D" alt="" loading="lazy"/></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸Spring Cloudç”Ÿæ€å®Œç¾é›†æˆ</li>
<li>åŸºäºWebFluxï¼Œæ€§èƒ½ä¼˜ç§€</li>
<li>åŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒè¿‡æ»¤å™¨å’Œæ–­è¨€</li>
<li>é…ç½®çµæ´»ï¼Œæ”¯æŒä»£ç å’Œé…ç½®æ–‡ä»¶ä¸¤ç§æ–¹å¼</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å¯¹éSpringæŠ€æœ¯æ ˆä¸å‹å¥½</li>
<li>å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­</li>
<li>ä¾èµ–Spring Cloudç»„ä»¶</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>Spring Cloudå¾®æœåŠ¡æ¶æ„</li>
<li>éœ€è¦æ·±åº¦å®šåˆ¶ç½‘å…³é€»è¾‘</li>
<li>å›¢é˜Ÿç†Ÿæ‚‰SpringæŠ€æœ¯æ ˆ</li>
</ul>
<h2 data-id="heading-8">ä¸‰ã€Kongï¼šä¼ä¸šçº§APIç½‘å…³æ ‡æ†</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨ä¼ä¸šçº§åœºæ™¯ä¸­éœ€è¦æ›´é«˜çš„æ€§èƒ½å’Œæ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼ŒKongå°±æ˜¯è¿™æ ·ä¸€ä¸ªåŸºäºNginxå’ŒOpenRestyçš„é«˜æ€§èƒ½APIç½‘å…³ã€‚</p>
<h3 data-id="heading-9">Kong é…ç½®å®æˆ˜</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># kong.yml - å£°æ˜å¼é…ç½®</span>
<span class="hljs-attr">_format_version:</span> <span class="hljs-string">"2.1"</span>
<span class="hljs-attr">_transform:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">http://user-service:8080</span>
    <span class="hljs-attr">routes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">user-route</span>
        <span class="hljs-attr">paths:</span> [<span class="hljs-string">"/api/users"</span>]
        <span class="hljs-attr">strip_path:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">plugins:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">key-auth</span>
        <span class="hljs-attr">config:</span>
          <span class="hljs-attr">key_names:</span> [<span class="hljs-string">"apikey"</span>]
          <span class="hljs-attr">hide_credentials:</span> <span class="hljs-literal">true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">rate-limiting</span>
        <span class="hljs-attr">config:</span>
          <span class="hljs-attr">minute:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">policy:</span> <span class="hljs-string">redis</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">http://order-service:8080</span>
    <span class="hljs-attr">routes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">order-route</span>
        <span class="hljs-attr">paths:</span> [<span class="hljs-string">"/api/orders"</span>]
        <span class="hljs-attr">methods:</span> [<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>, <span class="hljs-string">"PUT"</span>]
    <span class="hljs-attr">plugins:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cors</span>
        <span class="hljs-attr">config:</span>
          <span class="hljs-attr">origins:</span> [<span class="hljs-string">"https://example.com"</span>]
          <span class="hljs-attr">methods:</span> [<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>, <span class="hljs-string">"PUT"</span>]
          <span class="hljs-attr">headers:</span> [<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Content-Type"</span>]
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">request-transformer</span>
        <span class="hljs-attr">config:</span>
          <span class="hljs-attr">add:</span>
            <span class="hljs-attr">headers:</span> [<span class="hljs-string">"X-From-Kong: true"</span>]
          <span class="hljs-attr">remove:</span>
            <span class="hljs-attr">headers:</span> [<span class="hljs-string">"User-Agent"</span>]

<span class="hljs-attr">consumers:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">username:</span> <span class="hljs-string">mobile-app</span>
    <span class="hljs-attr">keyauth_credentials:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">mobile-key-123</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">username:</span> <span class="hljs-string">web-app</span>
    <span class="hljs-attr">keyauth_credentials:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">web-key-456</span>

<span class="hljs-attr">plugins:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ip-restriction</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">allow:</span> [<span class="hljs-string">"192.168.0.0/16"</span>, <span class="hljs-string">"10.0.0.0/8"</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">correlation-id</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">header_name:</span> <span class="hljs-string">"X-Request-ID"</span>
      <span class="hljs-attr">generator:</span> <span class="hljs-string">"uuid"</span>
</code></pre>
<h3 data-id="heading-10">è‡ªå®šä¹‰Kongæ’ä»¶å¼€å‘</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- kong/plugins/request-validator/handler.lua</span>
<span class="hljs-keyword">local</span> BasePlugin = <span class="hljs-built_in">require</span> <span class="hljs-string">"kong.plugins.base_plugin"</span>
<span class="hljs-keyword">local</span> cjson = <span class="hljs-built_in">require</span> <span class="hljs-string">"cjson"</span>

<span class="hljs-keyword">local</span> RequestValidator = BasePlugin:extend()

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">RequestValidator:new</span><span class="hljs-params">()</span></span>
  RequestValidator.super.new(<span class="hljs-built_in">self</span>, <span class="hljs-string">"request-validator"</span>)
<span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">RequestValidator:access</span><span class="hljs-params">(conf)</span></span>
  RequestValidator.super.access(<span class="hljs-built_in">self</span>)
  
  <span class="hljs-keyword">local</span> headers = kong.request.get_headers()
  <span class="hljs-keyword">local</span> method = kong.request.get_method()
  <span class="hljs-keyword">local</span> body = kong.request.get_raw_body()
  
  <span class="hljs-comment">-- API KeyéªŒè¯</span>
  <span class="hljs-keyword">local</span> api_key = headers[<span class="hljs-string">"X-API-Key"</span>]
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> api_key <span class="hljs-keyword">then</span>
    kong.response.<span class="hljs-built_in">exit</span>(<span class="hljs-number">401</span>, { message = <span class="hljs-string">"Missing API Key"</span> })
  <span class="hljs-keyword">end</span>
  
  <span class="hljs-comment">-- éªŒè¯API Keyæ ¼å¼</span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">string</span>.<span class="hljs-built_in">match</span>(api_key, <span class="hljs-string">"^%x%x%x%-%x%x%x%-%x%x%x$"</span>) <span class="hljs-keyword">then</span>
    kong.response.<span class="hljs-built_in">exit</span>(<span class="hljs-number">401</span>, { message = <span class="hljs-string">"Invalid API Key format"</span> })
  <span class="hljs-keyword">end</span>
  
  <span class="hljs-comment">-- è¯·æ±‚ä½“éªŒè¯</span>
  <span class="hljs-keyword">if</span> method == <span class="hljs-string">"POST"</span> <span class="hljs-keyword">or</span> method == <span class="hljs-string">"PUT"</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> body <span class="hljs-keyword">or</span> body == <span class="hljs-string">""</span> <span class="hljs-keyword">then</span>
      kong.response.<span class="hljs-built_in">exit</span>(<span class="hljs-number">400</span>, { message = <span class="hljs-string">"Request body is required"</span> })
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-keyword">local</span> ok, json_body = <span class="hljs-built_in">pcall</span>(cjson.decode, body)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span>
      kong.response.<span class="hljs-built_in">exit</span>(<span class="hljs-number">400</span>, { message = <span class="hljs-string">"Invalid JSON format"</span> })
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-comment">-- ä¸šåŠ¡è§„åˆ™éªŒè¯</span>
    <span class="hljs-keyword">if</span> json_body.amount <span class="hljs-keyword">and</span> <span class="hljs-built_in">tonumber</span>(json_body.amount) &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
      kong.response.<span class="hljs-built_in">exit</span>(<span class="hljs-number">400</span>, { message = <span class="hljs-string">"Amount must be greater than 0"</span> })
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  
  <span class="hljs-comment">-- æ·»åŠ éªŒè¯é€šè¿‡æ ‡è®°</span>
  kong.service.request.set_header(<span class="hljs-string">"X-Request-Validated"</span>, <span class="hljs-string">"true"</span>)
  kong.service.request.set_header(<span class="hljs-string">"X-API-Key"</span>, api_key)
  
  <span class="hljs-comment">-- è®°å½•å®¡è®¡æ—¥å¿—</span>
  kong.<span class="hljs-built_in">log</span>.info(<span class="hljs-string">"Request validated for API Key: "</span>, api_key)
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> RequestValidator
</code></pre>
<h3 data-id="heading-11">Kong é›†ç¾¤æ¶æ„</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/042215d4aa9143c1858568a990d14aef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037082&amp;x-signature=wwnNcgipQSgGkYWRfLBgA49TWoU%3D" alt="" loading="lazy"/></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>åŸºäºNginxï¼Œæ€§èƒ½æé«˜</li>
<li>æ’ä»¶ç”Ÿæ€ä¸°å¯Œ</li>
<li>æ”¯æŒé›†ç¾¤éƒ¨ç½²</li>
<li>æˆç†Ÿçš„ç›‘æ§å’Œç®¡ç†ç•Œé¢</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>ä¾èµ–æ•°æ®åº“ï¼ˆPostgreSQL/Cassandraï¼‰</li>
<li>æ’ä»¶å¼€å‘éœ€è¦LuaçŸ¥è¯†</li>
<li>é…ç½®ç›¸å¯¹å¤æ‚</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é«˜å¹¶å‘ä¼ä¸šçº§åº”ç”¨</li>
<li>éœ€è¦ä¸°å¯Œæ’ä»¶åŠŸèƒ½çš„åœºæ™¯</li>
<li>å·²æœ‰KongæŠ€æœ¯æ ˆçš„å›¢é˜Ÿ</li>
</ul>
<p>æœ€è¿‘ä¸ºäº†å¸®åŠ©å¤§å®¶æ‰¾å·¥ä½œï¼Œä¸“é—¨å»ºäº†ä¸€äº›å·¥ä½œå†…æ¨ç¾¤ï¼Œå„å¤§åŸå¸‚éƒ½æœ‰ï¼Œæ¬¢è¿å„ä½HRå’Œæ‰¾å·¥ä½œçš„å°ä¼™ä¼´è¿›ç¾¤äº¤æµï¼Œç¾¤é‡Œç›®å‰å·²ç»æ”¶é›†äº†ä¸å°‘çš„å·¥ä½œå†…æ¨å²—ä½ã€‚åŠ è‹ä¸‰çš„å¾®ä¿¡ï¼šli_su223ï¼Œå¤‡æ³¨ï¼šæ˜é‡‘+æ‰€åœ¨åŸå¸‚ï¼Œå³å¯è¿›ç¾¤ã€‚</p>
<h2 data-id="heading-12">å››ã€Nginxï¼šç»å…¸åå‘ä»£ç†ç½‘å…³</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨ä¼ ç»Ÿæ¶æ„æˆ–ç®€å•åœºæ™¯ä¸­ï¼ŒNginxä»ç„¶æ˜¯æœ€å¯é çš„é€‰æ‹©ã€‚å®ƒè™½ç„¶åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä½†æ€§èƒ½å“è¶Šä¸”ç¨³å®šã€‚</p>
<h3 data-id="heading-13">Nginx é…ç½®è¯¦è§£</h3>
<pre><code class="hljs language-nginx" lang="nginx"># nginx.conf - ç”Ÿäº§ç¯å¢ƒé…ç½®
http {
    # åŸºç¡€é…ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    
    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';
    
    # ä¸Šæ¸¸æœåŠ¡é…ç½®
    upstream user_service {
        server user-service-1:8080 weight=3;
        server user-service-2:8080 weight=2;
        server user-service-3:8080 weight=1;
        
        # å¥åº·æ£€æŸ¥
        check interval=3000 rise=2 fall=3 timeout=1000;
    }
    
    upstream order_service {
        server order-service-1:8080;
        server order-service-2:8080;
        
        # ä¼šè¯ä¿æŒ
        hash $cookie_jsessionid;
        hash_again 1;
    }
    
    upstream product_service {
        server product-service:8080;
        
        # å¤‡ä»½æœåŠ¡å™¨
        server backup-product-service:8080 backup;
    }
    
    # APIç½‘å…³é…ç½®
    server {
        listen 80;
        server_name api.example.com;
        
        # å…¨å±€é™æµ
        limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
        
        # ç”¨æˆ·æœåŠ¡è·¯ç”±
        location /api/users/ {
            limit_req zone=api burst=20 nodelay;
            
            # åå‘ä»£ç†é…ç½®
            proxy_pass http://user_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # è¶…æ—¶é…ç½®
            proxy_connect_timeout 5s;
            proxy_read_timeout 10s;
            proxy_send_timeout 10s;
            
            # é‡è¯•æœºåˆ¶
            proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
            proxy_next_upstream_tries 3;
            proxy_next_upstream_timeout 10s;
            
            # ç¼“å­˜é…ç½®
            proxy_cache api_cache;
            proxy_cache_key "$scheme$request_method$host$request_uri";
            proxy_cache_valid 200 302 5m;
            proxy_cache_valid 404 1m;
            
            # æ·»åŠ å®‰å…¨å¤´
            add_header X-Frame-Options DENY;
            add_header X-Content-Type-Options nosniff;
            add_header X-XSS-Protection "1; mode=block";
        }
        
        # è®¢å•æœåŠ¡è·¯ç”±
        location /api/orders/ {
            # JWTéªŒè¯
            auth_request /auth;
            auth_request_set $user $upstream_http_x_user;
            proxy_set_header X-User $user;
            
            proxy_pass http://order_service;
            
            # CORSé…ç½®
            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
                add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type';
                add_header 'Access-Control-Max-Age' 86400;
                return 204;
            }
        }
        
        # è®¤è¯ç«¯ç‚¹
        location = /auth {
            internal;
            proxy_pass http://auth_service/validate;
            proxy_pass_request_body off;
            proxy_set_header Content-Length "";
            proxy_set_header X-Original-URI $request_uri;
        }
        
        # å¥åº·æ£€æŸ¥ç«¯ç‚¹
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
        
        # ç›‘æ§ç«¯ç‚¹
        location /nginx-status {
            stub_status on;
            access_log off;
            allow 192.168.0.0/16;
            deny all;
        }
    }
}
</code></pre>
<h3 data-id="heading-14">Nginx è¯·æ±‚å¤„ç†æµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f50f62bc7b0b4bc1a61dd9709981392c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037082&amp;x-signature=Y1BjLK0V5lj0S%2F7NiZjTwuF%2B%2BxQ%3D" alt="" loading="lazy"/></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ€§èƒ½æé«˜ï¼ŒCè¯­è¨€ç¼–å†™</li>
<li>é…ç½®ç›¸å¯¹ç®€å•</li>
<li>èµ„æºæ¶ˆè€—ä½</li>
<li>ç¤¾åŒºæˆç†Ÿï¼Œèµ„æ–™ä¸°å¯Œ</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>åŠ¨æ€é…ç½®èƒ½åŠ›å¼±</li>
<li>åŠŸèƒ½ç›¸å¯¹åŸºç¡€</li>
<li>éœ€è¦reloadç”Ÿæ•ˆé…ç½®å˜æ›´</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é«˜æ€§èƒ½è¦æ±‚çš„ç®€å•è·¯ç”±</li>
<li>é™æ€èµ„æºæœåŠ¡</li>
<li>ä¼ ç»Ÿæ¶æ„å‡çº§</li>
</ul>
<h2 data-id="heading-15">äº”ã€APISIXï¼šäº‘åŸç”ŸAPIç½‘å…³æ–°æ˜Ÿ</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­éœ€è¦åŠ¨æ€é…ç½®å’Œé«˜æ€§èƒ½ï¼ŒAPISIXå°±æ˜¯è¿™æ ·ä¸€ä¸ªåŸºäºetcdçš„äº‘åŸç”ŸAPIç½‘å…³ã€‚</p>
<h3 data-id="heading-16">APISIX è·¯ç”±é…ç½®</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># apisix-config.yaml</span>
<span class="hljs-attr">routes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">uri:</span> <span class="hljs-string">/api/users/*</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
    <span class="hljs-attr">methods:</span> [<span class="hljs-string">GET</span>, <span class="hljs-string">POST</span>, <span class="hljs-string">PUT</span>, <span class="hljs-string">DELETE</span>]
    <span class="hljs-attr">upstream:</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">roundrobin</span>
      <span class="hljs-attr">nodes:</span>
        <span class="hljs-attr">user-service-1:8080:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">user-service-2:8080:</span> <span class="hljs-number">2</span>
        <span class="hljs-attr">user-service-3:8080:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">plugins:</span>
      <span class="hljs-attr">proxy-rewrite:</span>
        <span class="hljs-attr">uri:</span> <span class="hljs-string">"/users$1"</span>
      <span class="hljs-attr">limit-count:</span>
        <span class="hljs-attr">count:</span> <span class="hljs-number">100</span>
        <span class="hljs-attr">time_window:</span> <span class="hljs-number">60</span>
        <span class="hljs-attr">key:</span> <span class="hljs-string">remote_addr</span>
        <span class="hljs-attr">rejected_code:</span> <span class="hljs-number">503</span>
      <span class="hljs-attr">jwt-auth:</span>
        <span class="hljs-attr">key:</span> <span class="hljs-string">user-service</span>
        <span class="hljs-attr">secret:</span> <span class="hljs-string">my-secret-key</span>
        <span class="hljs-attr">exp:</span> <span class="hljs-number">86400</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">uri:</span> <span class="hljs-string">/api/orders/*</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>  
    <span class="hljs-attr">upstream:</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">chash</span>
      <span class="hljs-attr">key:</span> <span class="hljs-string">arg_user_id</span>
      <span class="hljs-attr">nodes:</span>
        <span class="hljs-attr">order-service-1:8080:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">order-service-2:8080:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">plugins:</span>
      <span class="hljs-attr">cors:</span>
        <span class="hljs-attr">allow_origins:</span> <span class="hljs-string">"https://example.com"</span>
        <span class="hljs-attr">allow_methods:</span> <span class="hljs-string">"GET,POST,PUT,DELETE"</span>
        <span class="hljs-attr">allow_headers:</span> <span class="hljs-string">"*"</span>
      <span class="hljs-attr">response-rewrite:</span>
        <span class="hljs-attr">body:</span> <span class="hljs-string">'{"code": 0, "message": "success", "data": $body}'</span>
      <span class="hljs-attr">fault-injection:</span>
        <span class="hljs-attr">abort:</span>
          <span class="hljs-attr">http_status:</span> <span class="hljs-number">500</span>
          <span class="hljs-attr">body:</span> <span class="hljs-string">"service unavailable"</span>
          <span class="hljs-attr">percentage:</span> <span class="hljs-number">5</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">uri:</span> <span class="hljs-string">/api/products/*</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">product-service</span>
    <span class="hljs-attr">upstream:</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">roundrobin</span>
      <span class="hljs-attr">nodes:</span>
        <span class="hljs-attr">product-service:8080:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">plugins:</span>
      <span class="hljs-attr">proxy-cache:</span>
        <span class="hljs-attr">cache_key:</span> [<span class="hljs-string">"$uri"</span>, <span class="hljs-string">"$args"</span>]
        <span class="hljs-attr">cache_zone:</span> <span class="hljs-string">disk_cache_one</span>
        <span class="hljs-attr">cache_ttl:</span> <span class="hljs-number">300</span>
      <span class="hljs-attr">uri-blocker:</span>
        <span class="hljs-attr">block_rules:</span> [<span class="hljs-string">"^/admin/"</span>, <span class="hljs-string">".php$"</span>]
        <span class="hljs-attr">rejected_code:</span> <span class="hljs-number">403</span>

<span class="hljs-comment"># å…¨å±€æ’ä»¶</span>
<span class="hljs-attr">plugins:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">prometheus</span>
    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">zipkin</span>
    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://zipkin:9411/api/v2/spans</span>
      <span class="hljs-attr">sample_ratio:</span> <span class="hljs-number">0.001</span>
</code></pre>
<h3 data-id="heading-17">APISIX æ’ä»¶å¼€å‘</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- apisix/plugins/rate-limit-advanced/init.lua</span>
<span class="hljs-keyword">local</span> core = <span class="hljs-built_in">require</span>(<span class="hljs-string">"apisix.core"</span>)
<span class="hljs-keyword">local</span> plugin_name = <span class="hljs-string">"rate-limit-advanced"</span>

<span class="hljs-keyword">local</span> schema = {
    <span class="hljs-built_in">type</span> = <span class="hljs-string">"object"</span>,
    properties = {
        rate = {<span class="hljs-built_in">type</span> = <span class="hljs-string">"integer"</span>, minimum = <span class="hljs-number">1</span>},
        burst = {<span class="hljs-built_in">type</span> = <span class="hljs-string">"integer"</span>, minimum = <span class="hljs-number">0</span>},
        key = {<span class="hljs-built_in">type</span> = <span class="hljs-string">"string"</span>},
        window = {<span class="hljs-built_in">type</span> = <span class="hljs-string">"integer"</span>, minimum = <span class="hljs-number">1</span>},
        rejected_code = {<span class="hljs-built_in">type</span> = <span class="hljs-string">"integer"</span>, default = <span class="hljs-number">429</span>},
        rejected_msg = {<span class="hljs-built_in">type</span> = <span class="hljs-string">"string"</span>, default = <span class="hljs-string">"rate limit exceeded"</span>}
    },
    required = {<span class="hljs-string">"rate"</span>, <span class="hljs-string">"key"</span>}
}

<span class="hljs-keyword">local</span> _M = {
    version = <span class="hljs-number">1.0</span>,
    priority = <span class="hljs-number">1000</span>,
    name = plugin_name,
    schema = schema,
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_M.check_schema</span><span class="hljs-params">(conf)</span></span>
    <span class="hljs-keyword">return</span> core.schema.check(schema, conf)
<span class="hljs-keyword">end</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_M.access</span><span class="hljs-params">(conf, ctx)</span></span>
    <span class="hljs-keyword">local</span> key = conf.key
    <span class="hljs-keyword">if</span> key == <span class="hljs-string">"remote_addr"</span> <span class="hljs-keyword">then</span>
        key = ctx.var.remote_addr
    <span class="hljs-keyword">elseif</span> key == <span class="hljs-string">"server_addr"</span> <span class="hljs-keyword">then</span>
        key = ctx.var.server_addr
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-keyword">local</span> rate = conf.rate
    <span class="hljs-keyword">local</span> burst = conf.burst <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">local</span> window = conf.window <span class="hljs-keyword">or</span> <span class="hljs-number">60</span>
    
    <span class="hljs-comment">-- ä½¿ç”¨redisè¿›è¡Œåˆ†å¸ƒå¼é™æµ</span>
    <span class="hljs-keyword">local</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">"resty.redis"</span>)
    <span class="hljs-keyword">local</span> red = redis:new()
    
    <span class="hljs-keyword">local</span> ok, err = red:connect(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">6379</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span>
        core.<span class="hljs-built_in">log</span>.<span class="hljs-built_in">error</span>(<span class="hljs-string">"failed to connect to redis: "</span>, err)
        <span class="hljs-keyword">return</span> <span class="hljs-number">500</span>
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-keyword">local</span> current_time = ngx.now()
    <span class="hljs-keyword">local</span> key_name = <span class="hljs-string">"rate_limit:"</span> .. key
    
    <span class="hljs-comment">-- ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•</span>
    <span class="hljs-keyword">local</span> tokens = red:get(key_name)
    <span class="hljs-keyword">if</span> tokens <span class="hljs-keyword">then</span>
        tokens = <span class="hljs-built_in">tonumber</span>(tokens)
    <span class="hljs-keyword">else</span>
        tokens = burst
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-keyword">local</span> last_update = red:get(key_name .. <span class="hljs-string">":time"</span>)
    <span class="hljs-keyword">if</span> last_update <span class="hljs-keyword">then</span>
        last_update = <span class="hljs-built_in">tonumber</span>(last_update)
        <span class="hljs-keyword">local</span> elapsed = current_time - last_update
        <span class="hljs-keyword">local</span> new_tokens = elapsed * rate / window
        
        <span class="hljs-keyword">if</span> new_tokens &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
            tokens = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">min</span>(tokens + new_tokens, burst)
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
    
    <span class="hljs-keyword">if</span> tokens &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
        red:setex(key_name .. <span class="hljs-string">":time"</span>, window, current_time)
        <span class="hljs-keyword">return</span> conf.rejected_code, conf.rejected_msg
    <span class="hljs-keyword">end</span>
    
    tokens = tokens - <span class="hljs-number">1</span>
    red:setex(key_name, window, tokens)
    red:setex(key_name .. <span class="hljs-string">":time"</span>, window, current_time)
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> _M
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>é…ç½®çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯</li>
<li>æ€§èƒ½å“è¶Š</li>
<li>æ’ä»¶ç”Ÿæ€ä¸°å¯Œ</li>
<li>äº‘åŸç”Ÿå‹å¥½</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>ç›¸å¯¹è¾ƒæ–°ï¼Œç”Ÿæ€ä¸å¦‚Kongæˆç†Ÿ</li>
<li>ä¾èµ–etcd</li>
<li>å­¦ä¹ æˆæœ¬è¾ƒé«˜</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>äº‘åŸç”Ÿç¯å¢ƒ</li>
<li>éœ€è¦åŠ¨æ€é…ç½®çš„åœºæ™¯</li>
<li>é«˜æ€§èƒ½è¦æ±‚çš„å¾®æœåŠ¡æ¶æ„</li>
</ul>
<h2 data-id="heading-18">å…­ã€Zuulï¼šNetflixç»å…¸ç½‘å…³</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨ä¼ ç»ŸSpring Cloudé¡¹ç›®ä¸­å¯èƒ½è¿˜åœ¨ä½¿ç”¨Zuulï¼Œè™½ç„¶å®ƒå·²è¢«Spring Cloud Gatewayå–ä»£ï¼Œä½†äº†è§£å…¶åŸç†ä»æœ‰ä»·å€¼ã€‚</p>
<h3 data-id="heading-19">Zuul è¿‡æ»¤å™¨å®æˆ˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Zuulå‰ç½®è¿‡æ»¤å™¨ - è®¤è¯å’Œé™æµ</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthPreFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ZuulFilter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RateLimiterService rateLimiter;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JwtTokenProvider tokenProvider;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">filterType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"pre"</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">filterOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ZuulException {
        <span class="hljs-type">RequestContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> RequestContext.getCurrentContext();
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ctx.getRequest();
        
        <span class="hljs-comment">// 1. é™æµæ£€æŸ¥</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">clientId</span> <span class="hljs-operator">=</span> getClientId(request);
        <span class="hljs-keyword">if</span> (!rateLimiter.tryAcquire(clientId)) {
            ctx.setSendZuulResponse(<span class="hljs-literal">false</span>);
            ctx.setResponseStatusCode(<span class="hljs-number">429</span>);
            ctx.setResponseBody(<span class="hljs-string">"{\"error\": \"Rate limit exceeded\"}"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 2. JWTè®¤è¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> extractToken(request);
        <span class="hljs-keyword">if</span> (token == <span class="hljs-literal">null</span> &amp;&amp; requiresAuth(request)) {
            ctx.setSendZuulResponse(<span class="hljs-literal">false</span>);
            ctx.setResponseStatusCode(<span class="hljs-number">401</span>);
            ctx.setResponseBody(<span class="hljs-string">"{\"error\": \"Authentication required\"}"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> tokenProvider.parseToken(token);
                ctx.addZuulRequestHeader(<span class="hljs-string">"X-User-Id"</span>, claims.getSubject());
                ctx.addZuulRequestHeader(<span class="hljs-string">"X-User-Roles"</span>, 
                    String.join(<span class="hljs-string">","</span>, claims.get(<span class="hljs-string">"roles"</span>, List.class)));
            } <span class="hljs-keyword">catch</span> (Exception e) {
                ctx.setSendZuulResponse(<span class="hljs-literal">false</span>);
                ctx.setResponseStatusCode(<span class="hljs-number">401</span>);
                ctx.setResponseBody(<span class="hljs-string">"{\"error\": \"Invalid token\"}"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        }
        
        <span class="hljs-comment">// 3. æ·»åŠ è¿½è¸ªä¿¡æ¯</span>
        ctx.addZuulRequestHeader(<span class="hljs-string">"X-Request-ID"</span>, UUID.randomUUID().toString());
        ctx.addZuulRequestHeader(<span class="hljs-string">"X-Forwarded-For"</span>, request.getRemoteAddr());
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getClientId</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">apiKey</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-API-Key"</span>);
        <span class="hljs-keyword">return</span> apiKey != <span class="hljs-literal">null</span> ? apiKey : request.getRemoteAddr();
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractToken</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">bearerToken</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"Authorization"</span>);
        <span class="hljs-keyword">if</span> (bearerToken != <span class="hljs-literal">null</span> &amp;&amp; bearerToken.startsWith(<span class="hljs-string">"Bearer "</span>)) {
            <span class="hljs-keyword">return</span> bearerToken.substring(<span class="hljs-number">7</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">requiresAuth</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> request.getRequestURI();
        <span class="hljs-keyword">return</span> !path.startsWith(<span class="hljs-string">"/api/public/"</span>) &amp;&amp; 
               !path.equals(<span class="hljs-string">"/health"</span>) &amp;&amp; 
               !path.startsWith(<span class="hljs-string">"/actuator/"</span>);
    }
}

<span class="hljs-comment">// Zuulåç½®è¿‡æ»¤å™¨ - å“åº”å¤„ç†</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponsePostFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ZuulFilter</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ResponsePostFilter.class);
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">filterType</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"post"</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">filterOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1000</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ZuulException {
        <span class="hljs-type">RequestContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> RequestContext.getCurrentContext();
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ctx.getRequest();
        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> ctx.getResponse();
        
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> (Long) ctx.get(<span class="hljs-string">"startTime"</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
        
        <span class="hljs-comment">// è®°å½•è®¿é—®æ—¥å¿—</span>
        logger.info(<span class="hljs-string">"{} {} {} {} {}ms"</span>, 
            request.getRemoteAddr(),
            request.getMethod(),
            request.getRequestURI(),
            response.getStatus(),
            duration);
        
        <span class="hljs-comment">// æ·»åŠ å“åº”å¤´</span>
        response.setHeader(<span class="hljs-string">"X-Response-Time"</span>, duration + <span class="hljs-string">"ms"</span>);
        response.setHeader(<span class="hljs-string">"X-API-Version"</span>, <span class="hljs-string">"1.0"</span>);
        
        <span class="hljs-comment">// ç»Ÿä¸€å“åº”æ ¼å¼</span>
        <span class="hljs-keyword">if</span> (ctx.getResponseBody() != <span class="hljs-literal">null</span> &amp;&amp; 
            response.getContentType() != <span class="hljs-literal">null</span> &amp;&amp; 
            response.getContentType().contains(<span class="hljs-string">"application/json"</span>)) {
            
            <span class="hljs-type">String</span> <span class="hljs-variable">originalBody</span> <span class="hljs-operator">=</span> ctx.getResponseBody();
            <span class="hljs-type">String</span> <span class="hljs-variable">wrappedBody</span> <span class="hljs-operator">=</span> <span class="hljs-string">"{\"code\": 0, \"data\": "</span> + originalBody + <span class="hljs-string">", \"timestamp\": "</span> + 
                System.currentTimeMillis() + <span class="hljs-string">"}"</span>;
            ctx.setResponseBody(wrappedBody);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸Netflixé›†æˆè‰¯å¥½</li>
<li>è¿‡æ»¤å™¨æœºåˆ¶çµæ´»</li>
<li>æ–‡æ¡£èµ„æ–™ä¸°å¯Œ</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ€§èƒ½è¾ƒå·®ï¼ˆé˜»å¡IOï¼‰</li>
<li>å·²è¢«Spring Cloud Gatewayå–ä»£</li>
<li>ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é—ç•™Spring Cloudé¡¹ç›®</li>
<li>NetflixæŠ€æœ¯æ ˆ</li>
<li>éæ€§èƒ½æ•æ„Ÿåœºæ™¯</li>
</ul>
<h2 data-id="heading-20">ä¸ƒã€Traefikï¼šäº‘åŸç”ŸåŠ¨æ€ç½‘å…³</h2>
<p>æœ‰äº›å°ä¼™ä¼´åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­éœ€è¦è‡ªåŠ¨æœåŠ¡å‘ç°ï¼ŒTraefikå°±æ˜¯ä¸ºäº‘åŸç”Ÿè€Œç”Ÿçš„åŠ¨æ€ç½‘å…³ã€‚</p>
<h3 data-id="heading-21">Traefik é…ç½®ç¤ºä¾‹</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># traefik.yaml</span>
<span class="hljs-attr">api:</span>
  <span class="hljs-attr">dashboard:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">insecure:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">entryPoints:</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">address:</span> <span class="hljs-string">":80"</span>
    <span class="hljs-attr">http:</span>
      <span class="hljs-attr">redirections:</span>
        <span class="hljs-attr">entryPoint:</span>
          <span class="hljs-attr">to:</span> <span class="hljs-string">websecure</span>
          <span class="hljs-attr">scheme:</span> <span class="hljs-string">https</span>
          
  <span class="hljs-attr">websecure:</span>
    <span class="hljs-attr">address:</span> <span class="hljs-string">":443"</span>

<span class="hljs-attr">certificatesResolvers:</span>
  <span class="hljs-attr">myresolver:</span>
    <span class="hljs-attr">acme:</span>
      <span class="hljs-attr">email:</span> <span class="hljs-string">admin@example.com</span>
      <span class="hljs-attr">storage:</span> <span class="hljs-string">/etc/traefik/acme.json</span>
      <span class="hljs-attr">httpChallenge:</span>
        <span class="hljs-attr">entryPoint:</span> <span class="hljs-string">web</span>

<span class="hljs-attr">providers:</span>
  <span class="hljs-attr">docker:</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"unix:///var/run/docker.sock"</span>
    <span class="hljs-attr">exposedByDefault:</span> <span class="hljs-literal">false</span>
    
  <span class="hljs-attr">file:</span>
    <span class="hljs-attr">filename:</span> <span class="hljs-string">/etc/traefik/dynamic.yaml</span>
    <span class="hljs-attr">watch:</span> <span class="hljs-literal">true</span>

<span class="hljs-attr">log:</span>
  <span class="hljs-attr">level:</span> <span class="hljs-string">INFO</span>

<span class="hljs-attr">accessLog:</span>
  <span class="hljs-attr">filePath:</span> <span class="hljs-string">"/var/log/traefik/access.log"</span>
  <span class="hljs-attr">bufferingSize:</span> <span class="hljs-number">100</span>

<span class="hljs-attr">metrics:</span>
  <span class="hljs-attr">prometheus:</span>
    <span class="hljs-attr">entryPoint:</span> <span class="hljs-string">websecure</span>

<span class="hljs-comment"># åŠ¨æ€é…ç½®</span>
<span class="hljs-comment"># dynamic.yaml</span>
<span class="hljs-attr">http:</span>
  <span class="hljs-attr">middlewares:</span>
    <span class="hljs-comment"># è®¤è¯ä¸­é—´ä»¶</span>
    <span class="hljs-attr">auth-middleware:</span>
      <span class="hljs-attr">basicAuth:</span>
        <span class="hljs-attr">users:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">"admin:$2y$05$YOUR_HASHED_PASSWORD"</span>
          
    <span class="hljs-comment"># é™æµä¸­é—´ä»¶  </span>
    <span class="hljs-attr">rate-limit-middleware:</span>
      <span class="hljs-attr">rateLimit:</span>
        <span class="hljs-attr">burst:</span> <span class="hljs-number">100</span>
        <span class="hljs-attr">period:</span> <span class="hljs-string">1m</span>
        
    <span class="hljs-comment"># é‡è¯•ä¸­é—´ä»¶</span>
    <span class="hljs-attr">retry-middleware:</span>
      <span class="hljs-attr">retry:</span>
        <span class="hljs-attr">attempts:</span> <span class="hljs-number">3</span>
        
    <span class="hljs-comment"># ç†”æ–­ä¸­é—´ä»¶</span>
    <span class="hljs-attr">circuit-breaker-middleware:</span>
      <span class="hljs-attr">circuitBreaker:</span>
        <span class="hljs-attr">expression:</span> <span class="hljs-string">"NetworkErrorRatio() &gt; 0.5"</span>
        
    <span class="hljs-comment"># å‹ç¼©ä¸­é—´ä»¶</span>
    <span class="hljs-attr">compress-middleware:</span>
      <span class="hljs-attr">compress:</span> {}

  <span class="hljs-attr">routers:</span>
    <span class="hljs-comment"># ç”¨æˆ·æœåŠ¡è·¯ç”±</span>
    <span class="hljs-attr">user-service:</span>
      <span class="hljs-attr">rule:</span> <span class="hljs-string">"PathPrefix(`/api/users`)"</span>
      <span class="hljs-attr">entryPoints:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">websecure</span>
      <span class="hljs-attr">middlewares:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">rate-limit-middleware</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">compress-middleware</span>
      <span class="hljs-attr">service:</span> <span class="hljs-string">user-service</span>
      <span class="hljs-attr">tls:</span>
        <span class="hljs-attr">certResolver:</span> <span class="hljs-string">myresolver</span>
        
    <span class="hljs-comment"># è®¢å•æœåŠ¡è·¯ç”±  </span>
    <span class="hljs-attr">order-service:</span>
      <span class="hljs-attr">rule:</span> <span class="hljs-string">"PathPrefix(`/api/orders`)"</span>
      <span class="hljs-attr">entryPoints:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">websecure</span>
      <span class="hljs-attr">middlewares:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">auth-middleware</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">rate-limit-middleware</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">circuit-breaker-middleware</span>
      <span class="hljs-attr">service:</span> <span class="hljs-string">order-service</span>
      <span class="hljs-attr">tls:</span>
        <span class="hljs-attr">certResolver:</span> <span class="hljs-string">myresolver</span>

  <span class="hljs-attr">services:</span>
    <span class="hljs-attr">user-service:</span>
      <span class="hljs-attr">loadBalancer:</span>
        <span class="hljs-attr">servers:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">"http://user-service-1:8080"</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">"http://user-service-2:8080"</span>
        <span class="hljs-attr">healthCheck:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>
          <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
          <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
          
    <span class="hljs-attr">order-service:</span>
      <span class="hljs-attr">loadBalancer:</span>
        <span class="hljs-attr">servers:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">"http://order-service-1:8080"</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">"http://order-service-2:8080"</span>
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨æœåŠ¡å‘ç°</li>
<li>é…ç½®ç®€å•</li>
<li>äº‘åŸç”Ÿå‹å¥½</li>
<li>å†…ç½®ç›‘æ§å’ŒDashboard</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>åŠŸèƒ½ç›¸å¯¹ç®€å•</li>
<li>æ€§èƒ½ä¸å¦‚Nginxç³»ç½‘å…³</li>
<li>é«˜çº§åŠŸèƒ½éœ€è¦ä¼ä¸šç‰ˆ</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å®¹å™¨åŒ–ç¯å¢ƒ</li>
<li>éœ€è¦è‡ªåŠ¨æœåŠ¡å‘ç°çš„åœºæ™¯</li>
<li>å¿«é€ŸåŸå‹å¼€å‘</li>
</ul>
<h2 data-id="heading-22">å…«ã€6å¤§ç½‘å…³å¯¹æ¯”</h2>
<p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬ç°åœ¨å¯¹è¿™å…­ç§APIç½‘å…³æœ‰äº†æ·±å…¥çš„äº†è§£ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…¨é¢çš„å¯¹æ¯”æ¥å¸®åŠ©å¤§å®¶åšå‡ºæ­£ç¡®çš„æŠ€æœ¯é€‰å‹ã€‚</p>
<h3 data-id="heading-23">è¯¦ç»†å¯¹æ¯”è¡¨æ ¼</h3>













































































<table><thead><tr><th>ç‰¹æ€§ç»´åº¦</th><th>Spring Cloud Gateway</th><th>Kong</th><th>Nginx</th><th>APISIX</th><th>Zuul</th><th>Traefik</th></tr></thead><tbody><tr><td><strong>æ€§èƒ½</strong></td><td>é«˜ï¼ˆWebFluxï¼‰</td><td>æé«˜ï¼ˆNginxï¼‰</td><td>æé«˜ï¼ˆCï¼‰</td><td>æé«˜ï¼ˆNginxï¼‰</td><td>ä¸­ï¼ˆé˜»å¡IOï¼‰</td><td>ä¸­</td></tr><tr><td><strong>é…ç½®æ–¹å¼</strong></td><td>ä»£ç /é…ç½®</td><td>å£°æ˜å¼YAML</td><td>é…ç½®æ–‡ä»¶</td><td>åŠ¨æ€é…ç½®</td><td>ä»£ç /é…ç½®</td><td>åŠ¨æ€é…ç½®</td></tr><tr><td><strong>æœåŠ¡å‘ç°</strong></td><td>Spring Cloud</td><td>æ’ä»¶æ”¯æŒ</td><td>éœ€æ‰‹åŠ¨é…ç½®</td><td>æ”¯æŒ</td><td>Spring Cloud</td><td>è‡ªåŠ¨å‘ç°</td></tr><tr><td><strong>K8sæ”¯æŒ</strong></td><td>è‰¯å¥½</td><td>è‰¯å¥½</td><td>éœ€Ingress</td><td>ä¼˜ç§€</td><td>ä¸€èˆ¬</td><td>ä¼˜ç§€</td></tr><tr><td><strong>ç›‘æ§</strong></td><td>Micrometer</td><td>Prometheus</td><td>åŸºç¡€ç›‘æ§</td><td>Prometheus</td><td>Hystrix</td><td>å†…ç½®</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>ä¸­</td><td>ä¸­é«˜</td><td>ä½</td><td>ä¸­é«˜</td><td>ä¸­</td><td>ä½</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>Spring Cloud</td><td>ä¼ä¸šçº§</td><td>ä¼ ç»Ÿæ¶æ„</td><td>äº‘åŸç”Ÿ</td><td>ä¼ ç»ŸSpring</td><td>å®¹å™¨åŒ–</td></tr></tbody></table>
<h3 data-id="heading-24">é€‰å‹å†³ç­–æŒ‡å—</h3>
<p><strong>é€‰æ‹©Spring Cloud Gatewayå½“ï¼š</strong></p>
<ul>
<li>æŠ€æœ¯æ ˆä»¥Springä¸ºä¸»</li>
<li>éœ€è¦æ·±åº¦å®šåˆ¶ç½‘å…³é€»è¾‘</li>
<li>å·²ç»ä½¿ç”¨Spring Cloudç»„ä»¶</li>
<li>å›¢é˜Ÿç†Ÿæ‚‰å“åº”å¼ç¼–ç¨‹</li>
</ul>
<p><strong>é€‰æ‹©Kongå½“ï¼š</strong></p>
<ul>
<li>ä¼ä¸šçº§é«˜å¹¶å‘åœºæ™¯</li>
<li>éœ€è¦ä¸°å¯Œæ’ä»¶ç”Ÿæ€</li>
<li>æœ‰ä¸“ä¸šè¿ç»´å›¢é˜Ÿ</li>
<li>éœ€è¦æˆç†Ÿçš„ç®¡ç†ç•Œé¢</li>
</ul>
<p><strong>é€‰æ‹©Nginxå½“ï¼š</strong></p>
<ul>
<li>æ€§èƒ½è¦æ±‚æé«˜</li>
<li>åœºæ™¯ç›¸å¯¹ç®€å•</li>
<li>å›¢é˜Ÿç†Ÿæ‚‰Nginx</li>
<li>èµ„æºå—é™ç¯å¢ƒ</li>
</ul>
<p><strong>é€‰æ‹©APISIXå½“ï¼š</strong></p>
<ul>
<li>äº‘åŸç”Ÿç¯å¢ƒ</li>
<li>éœ€è¦åŠ¨æ€é…ç½®</li>
<li>è¿½æ±‚æœ€æ–°æŠ€æœ¯</li>
<li>é«˜æ€§èƒ½è¦æ±‚</li>
</ul>
<p><strong>é€‰æ‹©Zuulå½“ï¼š</strong></p>
<ul>
<li>ç»´æŠ¤é—ç•™Spring Cloudé¡¹ç›®</li>
<li>NetflixæŠ€æœ¯æ ˆ</li>
<li>éæ€§èƒ½æ•æ„Ÿåœºæ™¯</li>
</ul>
<p><strong>é€‰æ‹©Traefikå½“ï¼š</strong></p>
<ul>
<li>å®¹å™¨åŒ–éƒ¨ç½²</li>
<li>éœ€è¦è‡ªåŠ¨æœåŠ¡å‘ç°</li>
<li>å¿«é€Ÿå¼€å‘éƒ¨ç½²</li>
<li>é…ç½®ç®€å•è¦æ±‚</li>
</ul>
<h2 data-id="heading-25">æ€»ç»“</h2>
<p>é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯¹6ç§ä¸»æµAPIç½‘å…³æœ‰äº†å…¨é¢çš„è®¤è¯†ã€‚</p>
<p>åœ¨é€‰æ‹©ç½‘å…³æ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹å…³é”®å› ç´ ï¼š</p>
<ol>
<li><strong>æŠ€æœ¯æ ˆåŒ¹é…</strong>ï¼šé€‰æ‹©ä¸å›¢é˜ŸæŠ€æœ¯æ ˆæœ€åŒ¹é…çš„æ–¹æ¡ˆ</li>
<li><strong>æ€§èƒ½è¦æ±‚</strong>ï¼šæ ¹æ®ä¸šåŠ¡å¹¶å‘é‡é€‰æ‹©æ€§èƒ½åˆé€‚çš„ç½‘å…³</li>
<li><strong>åŠŸèƒ½éœ€æ±‚</strong>ï¼šè¯„ä¼°éœ€è¦çš„åŠŸèƒ½ç‰¹æ€§ï¼Œå¦‚é™æµã€è®¤è¯ã€ç›‘æ§ç­‰</li>
<li><strong>è¿ç»´æˆæœ¬</strong>ï¼šè€ƒè™‘éƒ¨ç½²ã€ç›‘æ§ã€ç»´æŠ¤çš„å¤æ‚åº¦</li>
<li><strong>å›¢é˜Ÿèƒ½åŠ›</strong>ï¼šè¯„ä¼°å›¢é˜Ÿå¯¹ç½‘å…³æŠ€æœ¯çš„æŒæ¡ç¨‹åº¦</li>
</ol>
<h3 data-id="heading-26">æ ¸å¿ƒå»ºè®®</h3>
<ol>
<li><strong>æ–°é¡¹ç›®ä¼˜å…ˆè€ƒè™‘</strong>ï¼šSpring Cloud Gatewayï¼ˆSpringæŠ€æœ¯æ ˆï¼‰æˆ– APISIXï¼ˆäº‘åŸç”Ÿï¼‰</li>
<li><strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šKong æˆ– Nginx</li>
<li><strong>å¿«é€ŸåŸå‹</strong>ï¼šTraefik</li>
<li><strong>é—ç•™ç³»ç»Ÿ</strong>ï¼šæ ¹æ®ç°æœ‰æŠ€æœ¯æ ˆé€‰æ‹©</li>
</ol>
<p>è®°ä½ï¼Œæ²¡æœ‰æœ€å¥½çš„ç½‘å…³ï¼Œåªæœ‰æœ€åˆé€‚çš„ç½‘å…³ã€‚</p>
<p>åˆç†çš„ç½‘å…³é€‰å‹å¯ä»¥å¤§å¤§æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚</p>
<h2 data-id="heading-27">æœ€åè¯´ä¸€å¥(æ±‚å…³æ³¨ï¼Œåˆ«ç™½å«–æˆ‘)</h2>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæˆ–è€…æœ‰æ‰€å¯å‘çš„è¯ï¼Œå¸®å¿™å…³æ³¨ä¸€ä¸‹æˆ‘çš„åŒåå…¬ä¼—å·ï¼šè‹ä¸‰è¯´æŠ€æœ¯ï¼Œæ‚¨çš„æ”¯æŒæ˜¯æˆ‘åšæŒå†™ä½œæœ€å¤§çš„åŠ¨åŠ›ã€‚</p>
<p>æ±‚ä¸€é”®ä¸‰è¿ï¼šç‚¹èµã€è½¬å‘ã€åœ¨çœ‹ã€‚</p>
<p>å…³æ³¨å…¬ä¼—å·ï¼šã€è‹ä¸‰è¯´æŠ€æœ¯ã€‘ï¼Œåœ¨å…¬ä¼—å·ä¸­å›å¤ï¼šè¿›å¤§å‚ï¼Œå¯ä»¥å…è´¹è·å–æˆ‘æœ€è¿‘æ•´ç†çš„10ä¸‡å­—çš„é¢è¯•å®å…¸ï¼Œå¥½å¤šå°ä¼™ä¼´é è¿™ä¸ªå®å…¸æ‹¿åˆ°äº†å¤šå®¶å¤§å‚çš„offerã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Fix: ä¿®å¤AIèŠå¤©è¾“å…¥æ¡†Safariå›è½¦å‘é€bug]]></title>    <link>https://juejin.cn/post/7573524348130115647</link>    <guid>https://juejin.cn/post/7573524348130115647</guid>    <pubDate>2025-11-17T16:47:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573524348130115647" data-draft-id="7573535624532492307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Fix: ä¿®å¤AIèŠå¤©è¾“å…¥æ¡†Safariå›è½¦å‘é€bug"/> <meta itemprop="keywords" content="å‰ç«¯,DOM,JavaScript"/> <meta itemprop="datePublished" content="2025-11-17T16:47:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»‘ç¾½åŒå­¦"/> <meta itemprop="url" content="https://juejin.cn/user/3008684729329512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Fix: ä¿®å¤AIèŠå¤©è¾“å…¥æ¡†Safariå›è½¦å‘é€bug
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3008684729329512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»‘ç¾½åŒå­¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T16:47:26.000Z" title="Mon Nov 17 2025 16:47:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:18px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:40px;margin-bottom:20px;color:#007fff;display:flex;align-items:center}.markdown-body h1:hover:before,.markdown-body h2:hover:before,.markdown-body h3:hover:before,.markdown-body h4:hover:before,.markdown-body h5:hover:before,.markdown-body h6:hover:before{transition:All .4s ease-in-out;transform:rotate(1turn)}.markdown-body h1{font-size:30px;background:linear-gradient(#fff 60%,#c6e3ff 0)}.markdown-body h1:before{content:"";display:inline-block;width:32px;height:32px;margin-right:10px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC");background-size:100% 100%}.markdown-body h2{font-size:24px;background:linear-gradient(#fff 60%,#cce3fb 0)}.markdown-body h2:before{content:"";display:inline-block;width:24px;height:24px;margin-right:10px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC");background-size:100% 100%}.markdown-body h3{font-size:20px}.markdown-body h3:before{content:"";display:inline-block;width:18px;height:18px;margin-right:10px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC");background-size:100% 100%}.markdown-body h4{font-size:18px}.markdown-body h4:before{content:"";display:inline-block;width:16px;height:16px;margin-right:10px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC");background-size:100% 100%}.markdown-body h5{font-size:16px}.markdown-body h5:before{content:"";display:inline-block;width:15px;height:15px;margin-right:10px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC");background-size:100% 100%}.markdown-body h6{font-size:14px}.markdown-body h6:before{content:"";display:inline-block;width:12px;height:12px;margin-right:10px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC");background-size:100% 100%}.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{border-bottom:2px solid #007fff;color:#007fff;padding-right:10px}.markdown-body p{letter-spacing:1px;line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:10px auto}.markdown-body hr{border:none;border-top:1px dashed #92c8ff}.markdown-body hr:before{content:"âœ‚";display:inline-block;position:relative;top:-12px;left:40px;padding:0 3px;color:#007fff;font-size:18px}.markdown-body hr:after{content:"æŒ‰è™šçº¿å‰ªå¼€";position:relative;top:-15px;left:84%;padding:0 3px;color:#007fff;font-size:12px}.markdown-body del{color:#f44}.markdown-body em{color:#007fff;margin:0 2px}.markdown-body strong{color:#007fff;font-weight:bolder}.markdown-body code{word-break:break-word;border-radius:4px;overflow-x:auto;background-color:#e6f3ff;color:#007fff;font-weight:600;font-size:16px;padding:.065em .4em;border:1px solid #007fff}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:5px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:18px;font-weight:400;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8;border:none}.markdown-body a{text-decoration:none;color:#007fff;border-bottom:1px solid #007fff}.markdown-body a:before{content:"Â¶";margin-right:5px;font-size:22px}.markdown-body a:after{content:"â†·";margin-left:2px;font-size:22px;display:none}.markdown-body a:active,.markdown-body a:hover{color:#275b8c;border-bottom:1px solid #275b8c}.markdown-body a:active:after,.markdown-body a:hover:after{display:inline-block}.markdown-body table{display:inline-block!important;font-size:16px;width:auto;max-width:100%;overflow:auto;border:1px solid #a5d3ff}.markdown-body thead{background:#c6e3ff;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#eef7ff}.markdown-body tbody&gt;tr:nth-child(odd){background-color:#f8fcff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #007fff;background-color:#eef7ff}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#007fff}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>AIèŠå¤©è¾“å…¥æ¡†åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ”¯æŒç”¨æˆ·æŒ‰ä¸‹enterå›è½¦çš„å¿«æ·å‘é€ï¼Œé€šè¿‡é”®ç›˜äº‹ä»¶å®ç°</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>
    @<span class="hljs-attr">keydown</span>=<span class="hljs-string">"onInputKeydown"</span>
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å†…å®¹ï¼ŒæŒ‰ Enter å‘é€ï¼ŒShift + Enter æ¢è¡Œ"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å›è½¦å‘é€</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onInputKeydown</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">if</span>(event.<span class="hljs-property">key</span> === <span class="hljs-string">"Enter"</span> || event.<span class="hljs-property">keyCode</span> === <span class="hljs-string">'13'</span>) {
    <span class="hljs-keyword">if</span>(event.<span class="hljs-property">shiftKey</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// shift + enter ä»…æ¢è¡Œ</span>
    event.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-title function_">sendMessage</span>(); <span class="hljs-comment">// å‘é€å¤„ç†</span>
  }
}
</code></pre>
<h2 data-id="heading-1">é—®é¢˜</h2>
<p>ä½†å®é™…ä¸Šenterä½œä¸ºç¡®è®¤æ“ä½œï¼Œé™¤äº†ç¡®è®¤å†…å®¹å‘é€åŠ¨ä½œï¼Œè¿˜æœ‰ç¡®è®¤è¾“å…¥æ³•è¾“å…¥çš„åŠ¨ä½œï¼›</p>
<p>å¦‚ç”¨æˆ·åœ¨è¾“å…¥æ³•è¾“å…¥çŠ¶æ€ä¸‹ï¼ŒæŒ‰ä¸‹enteræœŸæœ›ç¡®è®¤è¾“å…¥å†…å®¹åˆ°æ–‡æœ¬æ¡†ï¼Œæ­¤æ—¶ä¹Ÿä¼šè§¦å‘ä¸Šé¢çš„å‘é€é€»è¾‘å¯¼è‡´å†…å®¹å†…å‘é€å‡ºå»ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ <code>onInputKeydown</code> åŠ ä¸€ä¸ªåˆæˆçŠ¶æ€ï¼ˆ<code>isComposing</code>ï¼‰åˆ¤æ–­</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onInputKeydown</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">if</span>(event.<span class="hljs-property">key</span> === <span class="hljs-string">"Enter"</span> || event.<span class="hljs-property">keyCode</span> === <span class="hljs-string">'13'</span>) {
    <span class="hljs-keyword">if</span>(event.<span class="hljs-property">shiftKey</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span>(event.<span class="hljs-property">isComposing</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// æ­¤æ¬¡ä¸ºè¾“å…¥æ³•çŠ¶æ€ä¸‹çš„enter(å³è¾“å…¥æ³•åˆæˆçŠ¶æ€)ï¼Œä¸å‘é€å†…å®¹</span>
    event.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-title function_">sendMessage</span>();
  }
}
</code></pre>
<p>è¿™ç¡®å®æœ‰æ•ˆï¼Œä½†æ˜¯åœ¨Safariä¸‹é”®ç›˜è¾“å…¥æ–‡å­—ï¼ˆå¦‚è¾“å…¥è‹±æ–‡ï¼‰ä¸”åœ¨è¾“å…¥æ³•åˆæˆçŠ¶æ€ï¼ŒæŒ‰ä¸‹enterå†…å®¹ä¾æ—§è¢«å‘é€äº†ï¼åŸå› åœ¨äº <code>event.isComposing</code> åœ¨Safariå¹¶ä¸å¯ä¿¡ï¼Œå¯¼è‡´ä¸å¯ç”¨ï¼›</p>
<h2 data-id="heading-2">å»¶å±•</h2>
<p>é‚£ä¹ˆè§£å†³Safariä¸Šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»Safariä¸Šå®ç°å¯ä¿¡çš„isComposingï¼›</p>
<p>å°è¯•é€šè¿‡ç›‘å¬ <code>composotionstart/compositionend</code> å®ç°è‡ªå·±çš„ Composing çŠ¶æ€ï¼Œä½†äº‹å®æ˜¯ä¸å¯è¡Œï¼ˆSafariçš„compositionäº‹ä»¶ä¸keydownã€inputç­‰äº‹ä»¶æ‰§è¡Œé¡ºåºé—®é¢˜ï¼‰ï¼›</p>
<p>ä½†æ˜¯inputäº‹ä»¶æœ‰ <code>inputType</code> å¯åˆ¤æ–­åˆ°è¾“å…¥æ³•çŠ¶æ€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FInputEvent%2FinputType" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/InputEvent/inputType" ref="nofollow noopener noreferrer">MDN inputType</a>ã€‚</p>
<p>æœ€ç»ˆå®ç°ï¼šé¢å¤–ç›‘å¬inputäº‹ä»¶(å…ˆäºkeydownäº‹ä»¶)ï¼Œé’ˆå¯¹Safariä½¿ç”¨è‡ªå·±å®ç°çš„ComposingçŠ¶æ€åˆ¤æ–­æ˜¯å¦ä¸ºè¾“å…¥æ³•åˆæˆä¸‹enter</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>
    @<span class="hljs-attr">input</span>=<span class="hljs-string">"onInput"</span>
    @<span class="hljs-attr">keydown</span>=<span class="hljs-string">"onInputKeydown"</span>
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å†…å®¹ï¼ŒæŒ‰ Enter å‘é€ï¼ŒShift + Enter æ¢è¡Œ"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å¼•å…¥æµè§ˆå™¨æ£€æµ‹åº“</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UAParser</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'ua-parser-js'</span>;
<span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UAParser</span>();
<span class="hljs-keyword">const</span> result = parser.<span class="hljs-title function_">getResult</span>();

<span class="hljs-comment">// å›è½¦å‘é€</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onInputKeydown</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">if</span>(event.<span class="hljs-property">key</span> === <span class="hljs-string">"Enter"</span> || event.<span class="hljs-property">keyCode</span> === <span class="hljs-string">'13'</span>) {
    <span class="hljs-keyword">if</span>(event.<span class="hljs-property">shiftKey</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// é’ˆå¯¹safariæµè§ˆå™¨å…¼å®¹</span>
    <span class="hljs-keyword">if</span>(result.<span class="hljs-property">browser</span>.<span class="hljs-property">name</span> === <span class="hljs-string">"safari"</span>) {
      <span class="hljs-keyword">if</span>(isCompositionInputType) { <span class="hljs-comment">// ä½¿ç”¨è‡ªå·±å®ç°çš„ComposingçŠ¶æ€</span>
        isCompositionInputType = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span>;
      }
    }<span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span>(event.<span class="hljs-property">isComposing</span>) <span class="hljs-keyword">return</span>;
    }
    event.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-title function_">sendMessage</span>(); <span class="hljs-comment">// å‘é€</span>
  }
}

<span class="hljs-comment">// æ‰‹åŠ¨å®ç°åˆ¤æ–­æ˜¯å¦ä¸ºè¾“å…¥æ³•åˆæˆçŠ¶æ€</span>
<span class="hljs-keyword">let</span> isCompositionInputType = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  isCompositionInputType = [<span class="hljs-string">"insertCompositionText"</span>, <span class="hljs-string">"insertFromComposition"</span>].<span class="hljs-title function_">includes</span>(event.<span class="hljs-property">inputType</span>);
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†æ»¥ç”¨ Base64 äº†â€”â€”Blob æ‰æ˜¯å‰ç«¯å‡è´Ÿçš„æ­£ç¡®å§¿åŠ¿]]></title>    <link>https://juejin.cn/post/7573521516324896795</link>    <guid>https://juejin.cn/post/7573521516324896795</guid>    <pubDate>2025-11-18T00:48:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573521516324896795" data-draft-id="7573528564026802222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†æ»¥ç”¨ Base64 äº†â€”â€”Blob æ‰æ˜¯å‰ç«¯å‡è´Ÿçš„æ­£ç¡®å§¿åŠ¿"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-18T00:48:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="404æ˜Ÿçƒçš„çŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/193147068224126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†æ»¥ç”¨ Base64 äº†â€”â€”Blob æ‰æ˜¯å‰ç«¯å‡è´Ÿçš„æ­£ç¡®å§¿åŠ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/193147068224126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    404æ˜Ÿçƒçš„çŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T00:48:44.000Z" title="Tue Nov 18 2025 00:48:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ Blobï¼Ÿ</h2>
<p><strong>Blob</strong>ï¼ˆBinary Large Objectï¼ŒäºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼‰æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§<strong>ä¸å¯å˜ã€ç±»æ–‡ä»¶çš„åŸå§‹æ•°æ®å®¹å™¨</strong>ã€‚å®ƒå¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„äºŒè¿›åˆ¶æˆ–æ–‡æœ¬æ•°æ®ï¼Œä¾‹å¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€PDFã€ç”šè‡³ä¸€æ®µçº¯æ–‡æœ¬ã€‚ä¸ <code>File</code> å¯¹è±¡ç›¸æ¯”ï¼ŒBlob æ›´åº•å±‚ï¼ŒFile å®é™…ä¸Šç»§æ‰¿è‡ª Blobï¼Œå¹¶é¢å¤–æºå¸¦äº† <code>name</code>ã€<code>lastModified</code> ç­‰å…ƒä¿¡æ¯ ã€‚</p>
<p>Blob æœ€å¤§çš„ç‰¹ç‚¹æ˜¯<strong>çº¯å®¢æˆ·ç«¯ã€é›¶ç½‘ç»œ</strong>ï¼šæ•°æ®ä¸€æ—¦è¿›å…¥ Blobï¼Œå°±æ´»åœ¨å†…å­˜é‡Œï¼Œæ— éœ€ä¸Šä¼ æœåŠ¡å™¨å³å¯é¢„è§ˆã€ä¸‹è½½æˆ–è¿›ä¸€æ­¥åŠ å·¥ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ„é€ ä¸€ä¸ª Blobï¼šä¸€è¡Œä»£ç æå®š</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>(parts, options);
</code></pre>

















<table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>parts</code></td><td>æ•°ç»„ï¼Œå…ƒç´ å¯ä»¥æ˜¯ <code>String</code>ã€<code>ArrayBuffer</code>ã€<code>TypedArray</code>ã€<code>Blob</code> ç­‰ã€‚</td></tr><tr><td><code>options</code></td><td>å¯é€‰å¯¹è±¡ï¼Œå¸¸ç”¨å­—æ®µï¼š<br/><code>type</code> MIME ç±»å‹ï¼Œé»˜è®¤ <code>application/octet-stream</code>ï¼›<br/><code>endings</code> æ˜¯å¦è½¬æ¢æ¢è¡Œç¬¦ï¼Œå‡ ä¹ä¸ç”¨ã€‚</td></tr></tbody></table>
<p>ç¤ºä¾‹ï¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ª Markdown æ–‡ä»¶å¹¶è®©ç”¨æˆ·ä¸‹è½½</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> content = <span class="hljs-string">'# Hello Blob\n&gt; ç”±æµè§ˆå™¨åŠ¨æ€ç”Ÿæˆ'</span>;
<span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([content], { <span class="hljs-attr">type</span>: <span class="hljs-string">'text/markdown'</span> });
<span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);

<span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
a.<span class="hljs-property">href</span> = url;
a.<span class="hljs-property">download</span> = <span class="hljs-string">'hello.md'</span>;
a.<span class="hljs-title function_">click</span>();

<span class="hljs-comment">// å†…å­˜ç”¨å®Œå³å¼ƒ</span>
<span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€Blob URLï¼šç»™å†…å­˜ä¸­çš„æ•°æ®ä¸€ä¸ªâ€œä¸´æ—¶åœ°å€â€</h2>
<h3 data-id="heading-3">1. ç”Ÿæˆæ–¹å¼</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
<span class="hljs-comment">// è¿”å›å€¼æ ·ä¾‹</span>
<span class="hljs-comment">// blob:https://localhost:3000/550e8400-e29b-41d4-a716-446655440000</span>
</code></pre>
<h3 data-id="heading-4">2. ç”Ÿå‘½å‘¨æœŸ</h3>
<ul>
<li><strong>ä½œç”¨åŸŸ</strong>ï¼šä»…åœ¨<strong>å½“å‰æ–‡æ¡£ã€å½“å‰ä¼šè¯</strong>æœ‰æ•ˆï¼›é¡µé¢åˆ·æ–°ã€<code>close()</code>ã€æ‰‹åŠ¨è°ƒç”¨ <code>revokeObjectURL()</code> éƒ½ä¼šä½¿å…¶å¤±æ•ˆ ã€‚</li>
<li><strong>æ€§èƒ½é™·é˜±</strong>ï¼šä¸ä¸»åŠ¨é‡Šæ”¾ä¼šé€ æˆ<strong>å†…å­˜æ³„æ¼</strong>ï¼Œå°¤å…¶åœ¨å•é¡µåº”ç”¨æˆ–å¤§é‡å›¾ç‰‡é¢„è§ˆåœºæ™¯ ã€‚</li>
</ul>
<p>æœ€ä½³å®è·µå°è£…ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createTempURL</span>(<span class="hljs-params">blob</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
  <span class="hljs-comment">// è‡ªåŠ¨ revokeï¼Œé¿å…å¿˜è®°</span>
  <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url));
  <span class="hljs-keyword">return</span> url;
}
</code></pre>
<hr/>
<h2 data-id="heading-5">å››ã€Blob vs. Base64 vs. ArrayBufferï¼šå¦‚ä½•é€‰å‹ï¼Ÿ</h2>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ ¼å¼</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>å›¾ç‰‡å›æ˜¾ã€<code>&lt;img&gt;</code>/<code>&lt;video&gt;</code></td><td>Blob URL</td><td>æµè§ˆå™¨å¯ç›´æ¥è§£æï¼Œæ— éœ€è§£ç ï¼›å†…å­˜å ç”¨ä½ã€‚</td></tr><tr><td>å°å›¾æ ‡å†…åµŒåœ¨ CSS/JSON</td><td>Base64</td><td>å‡å°‘ä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œä½†ä½“ç§¯å¢å¤§çº¦ 33%ã€‚</td></tr><tr><td>çº¯è®¡ç®—ã€WebAssembly ä¼ é€’</td><td>ArrayBuffer</td><td>å¯å†™ã€å¯ç´¢å¼•ï¼Œé€‚åˆé«˜æ•ˆè¿ç®—ã€‚</td></tr><tr><td>ä¸Šä¼ å¤§æ–‡ä»¶ã€æ–­ç‚¹ç»­ä¼ </td><td>Blob.slice</td><td>æµå¼åˆ†ç‰‡ï¼Œé…åˆ <code>File.prototype.slice</code> åšæ–­ç‚¹ç»­ä¼  ã€‚</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">äº”ã€é«˜é¢‘å®æˆ˜åœºæ™¯</h2>
<h3 data-id="heading-7">1. æœ¬åœ°å›¾ç‰‡/è§†é¢‘é¢„è§ˆï¼ˆé›¶ä¸Šä¼ ï¼‰</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"uploader"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"preview"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"max-width: 100%"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
uploader.<span class="hljs-property">onchange</span> = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (!file) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(file);
  preview.<span class="hljs-property">src</span> = url;
  preview.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url); <span class="hljs-comment">// åŠ è½½å®Œå³é‡Šæ”¾</span>
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2. å°† Canvas ç»˜å›¾å¯¼å‡ºä¸º PNG å¹¶ä¸‹è½½</h3>
<pre><code class="hljs language-js" lang="js">canvas.<span class="hljs-title function_">toBlob</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
  <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
  a.<span class="hljs-property">href</span> = url;
  a.<span class="hljs-property">download</span> = <span class="hljs-string">'snapshot.png'</span>;
  a.<span class="hljs-title function_">click</span>();
  <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
}, <span class="hljs-string">'image/png'</span>);
</code></pre>
<h3 data-id="heading-9">3. æŠ“å–è¿œç¨‹å›¾ç‰‡â†’Blobâ†’æœ¬åœ°é¢„è§ˆï¼ˆè·¨åŸŸéœ€ CORSï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://i.imgur.com/xxx.png'</span>, { <span class="hljs-attr">mode</span>: <span class="hljs-string">'cors'</span> })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-title function_">blob</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'img'</span>).<span class="hljs-property">src</span> = url;
  });
</code></pre>
<p>è‹¥å‡ºç°<strong>å›¾ç‰‡ä¸æ˜¾ç¤º</strong>ï¼Œ99% æ˜¯å› ä¸ºæœåŠ¡ç«¯æœªè¿”å› <code>Access-Control-Allow-Origin</code> å¤´ ã€‚</p>
<hr/>
<h2 data-id="heading-10">å…­ã€è¸©å‘æŒ‡å—ä¸æ€§èƒ½é”¦å›Š</h2>

























<table><thead><tr><th>å‘ç‚¹</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å†…å­˜æš´æ¶¨</td><td>æ¯æ¬¡ <code>createObjectURL</code> åï¼ŒåŠ¡å¿…åœ¨åˆé€‚çš„æ—¶æœº <code>revokeObjectURL</code> ã€‚</td></tr><tr><td>è·¨åŸŸå¤±è´¥</td><td>ç¡®è®¤æœåŠ¡ç«¯å¼€å¯ CORSï¼›fetch æ—¶åŠ  <code>{credentials: 'include'}</code> å¦‚éœ€ Cookieã€‚</td></tr><tr><td>ç§»åŠ¨ç«¯å¤§è§†é¢‘å¡é¡¿</td><td>é¿å…ä¸€æ¬¡æ€§è¯»å®Œæ•´æ–‡ä»¶ï¼Œä½¿ç”¨ <code>blob.slice(start, end)</code> åˆ†æ®µè¯»å–ã€‚</td></tr><tr><td>æ—§æµè§ˆå™¨å…¼å®¹</td><td>IE10+ æ‰åŸç”Ÿæ”¯æŒ Blobï¼›å¦‚éœ€æ›´ä½ç‰ˆæœ¬ï¼Œè¯·å¼•å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Feligrey%2FBlob.js" target="_blank" title="https://github.com/eligrey/Blob.js" ref="nofollow noopener noreferrer">Blob.js</a> å…¼å®¹åº“ã€‚</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€å»¶ä¼¸ï¼šBlob ä¸ Stream çš„æ¢¦å¹»è”åŠ¨</h2>
<p>å½“æ–‡ä»¶è¶…å¤§ï¼ˆGB çº§ï¼‰æ—¶ï¼Œå…¨éƒ¨è¯»è¿›å†…å­˜å¹¶ä¸ç°å®ã€‚å¯ä»¥å€ŸåŠ© <code>ReadableStream</code> æŠŠ Blob è½¬ä¸ºæµï¼Œå®ç°æ¸è¿›å¼ä¸Šä¼ ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> stream = blob.<span class="hljs-title function_">stream</span>(); <span class="hljs-comment">// è¿”å› ReadableStream</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/upload'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">body</span>: stream,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: blob.<span class="hljs-property">type</span> }
});
</code></pre>
<p>Chrome 85+ã€Edge 85+ã€Firefox å·²ç»æ”¯æŒ <code>blob.stream()</code>ï¼Œèƒ½ä»¥<strong>æµå¼</strong>å½¢å¼è¾¹è¯»è¾¹ä¼ ï¼Œå†…å­˜å ç”¨æä½ã€‚</p>
<hr/>
<h2 data-id="heading-12">å…«ã€æ€»ç»“ï¼šè®°ä½â€œä¸‰å¥è¯â€</h2>
<ol>
<li>Blob = <strong>æµè§ˆå™¨ç«¯çš„äºŒè¿›åˆ¶æ•°æ®ä»“åº“</strong>ï¼ŒFile åªæ˜¯å®ƒçš„è¶…é›†ã€‚</li>
<li>Blob URL = <strong>æŒ‡å‘å†…å­˜çš„ä¸´æ—¶æŒ‡é’ˆ</strong>ï¼Œç”¨å®Œåå¿…é¡»æ‰‹åŠ¨æˆ–è‡ªåŠ¨é‡Šæ”¾ã€‚</li>
<li>å‡¡æ˜¯â€œ<strong>æœ¬åœ°é¢„è§ˆã€é›¶ä¸Šä¼ ã€åŠ¨æ€ç”Ÿæˆä¸‹è½½</strong>â€çš„éœ€æ±‚ï¼Œä¼˜å…ˆè€ƒè™‘ Blob + Blob URL ç»„åˆã€‚</li>
</ol>
<p>ç”¨å¥½ Blobï¼Œæ—¢èƒ½<strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼ˆç§’å¼€é¢„è§ˆï¼‰ï¼Œåˆèƒ½<strong>é™ä½æœåŠ¡ç«¯å‹åŠ›</strong>ï¼ˆæ— éœ€ä¸­è½¬ï¼‰ï¼Œæ˜¯æ¯ä¸€ä½å‰ç«¯å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è°ƒè¯•åˆ©å™¨â€”â€”pageSpyçš„ä½¿ç”¨ç®€æ˜“æŒ‡å—]]></title>    <link>https://juejin.cn/post/7573508361742204928</link>    <guid>https://juejin.cn/post/7573508361742204928</guid>    <pubDate>2025-11-18T00:59:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573508361742204928" data-draft-id="7573530680887066658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è°ƒè¯•åˆ©å™¨â€”â€”pageSpyçš„ä½¿ç”¨ç®€æ˜“æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-18T00:59:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ZT_KeBei"/> <meta itemprop="url" content="https://juejin.cn/user/3263773733818103"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è°ƒè¯•åˆ©å™¨â€”â€”pageSpyçš„ä½¿ç”¨ç®€æ˜“æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3263773733818103/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ZT_KeBei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T00:59:22.000Z" title="Tue Nov 18 2025 00:59:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"ğŸ¦„";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"ğŸ³";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"ğŸ„";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"ğŸ¦¥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"ğŸ¦©";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"ğŸ§";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"â"}.markdown-body blockquote:after{right:10px;bottom:0;content:"â"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"Â· "}.markdown-body strong:after{content:" Â·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><h2 data-id="heading-0">1.å…ˆéƒ¨ç½²pageSpyåˆ°è‡ªæœ‰æœåŠ¡å™¨ï¼ˆæ¨èéƒ¨ç½²åˆ°è‡ªæœ‰æœåŠ¡å™¨ï¼‰</h2>
<h3 data-id="heading-1">ä¸‰ç§æ–¹å¼ï¼ˆnodeéƒ¨ç½²ã€dockeréƒ¨ç½²ã€å®å¡”é¢æ¿éƒ¨ç½²ï¼‰</h3>
<p>å…·ä½“å‚è€ƒå®˜ç½‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fpagespy.huolala.cn%2F%23%2F" target="_blank" title="https://pagespy.huolala.cn/#/" ref="nofollow noopener noreferrer">pagespy.huolala.cn/#/</a></p>
<h3 data-id="heading-2">å…éƒ¨ç½²ä½¿ç”¨æ–¹å¼ï¼ˆç”Ÿäº§ç¯å¢ƒä¸‹ä¸æ¨èï¼‰</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpagespy.huolala.cn%2F%23%2Fo-spy" target="_blank" title="https://pagespy.huolala.cn/#/o-spy" ref="nofollow noopener noreferrer">pagespy.huolala.cn/#/o-spy</a></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://static.huolala.cn/libs/o-spy/2.2.9/index.min.js"</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> $oSpy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OSpy</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-3">2.å‰ç«¯é¡µé¢/æ¡†æ¶ä¸­é›†æˆpageSpy sdk</h2>
<h4 data-id="heading-4">cdnæ–¹å¼</h4>
<h5 data-id="heading-5">å®‰è£…</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- PageSpy SDK --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://&lt;your-pagespy-host&gt;/page-spy/index.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ’ä»¶ï¼ˆéå¿…é¡»ï¼Œä½†å»ºè®®ä½¿ç”¨ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://&lt;your-pagespy-host&gt;/plugin/data-harbor/index.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://&lt;your-pagespy-host&gt;/plugin/rrweb/index.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h5 data-id="heading-6">é›†æˆä¸åˆå§‹åŒ–</h5>
<pre><code class="hljs language-ini" lang="ini">&lt;script&gt;
  window.$<span class="hljs-attr">harbor</span> = new DataHarborPlugin()<span class="hljs-comment">;</span>
  window.$<span class="hljs-attr">rrweb</span> = new RRWebPlugin()<span class="hljs-comment">;</span>

  <span class="hljs-section">[window.$harbor, window.$rrweb]</span>.forEach(<span class="hljs-attr">p</span> =&gt; {
    PageSpy.registerPlugin(p)
  })

  window.$<span class="hljs-attr">pageSpy</span> = new PageSpy()<span class="hljs-comment">;</span>
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-7">ESMæ–¹å¼å¼•å…¥</h4>
<h5 data-id="heading-8">å®‰è£…</h5>
<pre><code class="hljs language-kotlin" lang="kotlin">yarn add <span class="hljs-meta">@huolala</span>-tech/page-spy-browser <span class="hljs-meta">@huolala</span>-tech/page-spy-plugin-<span class="hljs-keyword">data</span>-harbor <span class="hljs-meta">@huolala</span>-tech/page-spy-plugin-rrweb
</code></pre>
<h5 data-id="heading-9">é›†æˆä¸åˆå§‹åŒ–</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">PageSpy</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@huolala-tech/page-spy-browser"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DataHarborPlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@huolala-tech/page-spy-plugin-data-harbor"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RRWebPlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@huolala-tech/page-spy-plugin-rrweb"</span>;

<span class="hljs-variable language_">window</span>.<span class="hljs-property">$harbor</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataHarborPlugin</span>();
<span class="hljs-variable language_">window</span>.<span class="hljs-property">$rrweb</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RRWebPlugin</span>();

[<span class="hljs-variable language_">window</span>.<span class="hljs-property">$harbor</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">$rrweb</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> {
  <span class="hljs-title class_">PageSpy</span>.<span class="hljs-title function_">registerPlugin</span>(p);
});
<span class="hljs-comment">// ESM æ¨¡å¼ä¸‹æ— æ³•è‡ªåŠ¨åˆ†æéƒ¨ç½²åœ°å€ï¼Œå› æ­¤å¿…é¡»æ‰‹åŠ¨é…ç½®ä»¥ä¸‹å‚æ•°</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">$pageSpy</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageSpy</span>({
  <span class="hljs-attr">api</span>: <span class="hljs-string">"xx.xx.xx.xx:6752"</span>,<span class="hljs-comment">//éƒ¨ç½²pageSpyçš„æœåŠ¡å™¨åœ°å€ï¼ˆåªéœ€è¦ä¸»æœº+ç«¯å£ï¼‰</span>
  <span class="hljs-attr">clientOrigin</span>: <span class="hljs-string">"http://xx.xx.xx.xx:6752"</span>,<span class="hljs-comment">//ï¼ˆå®Œæ•´çš„åœ°å€ï¼‰</span>
  <span class="hljs-attr">enableSSL</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// ä¸æ¸²æŸ“å›¾æ ‡</span>
  <span class="hljs-attr">autoRender</span>: <span class="hljs-literal">false</span>,
});

<span class="hljs-comment">// ç›‘å¬é¡µé¢è¿ç»­ç‚¹å‡»5æ¬¡åŠä»¥ä¸Šæ—¶å€™æ¸²æŸ“pageSpyå›¾æ ‡</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">detail</span> &gt;= <span class="hljs-number">5</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">$pageSpy</span>.<span class="hljs-title function_">render</span>();
  }
});
</code></pre>
<h2 data-id="heading-10">3.å¼€å§‹è°ƒè¯•</h2>
<p>å‰ç«¯é¡¹ç›®è¿è¡Œèµ·æ¥åè¿ç»­ç‚¹å‡»é¡µé¢äº”æ¬¡å¼€å¯è°ƒè¯•ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºpageSpyæ ‡ï¼Œç‚¹å‡»è·³è½¬å³å¯</p>
<p>åç»­åŠŸèƒ½ç›´æ¥åœ¨è·³è½¬çš„ç•Œé¢ä¸Šå®æ—¶è°ƒè¯•</p>
<h2 data-id="heading-11">4.æµ‹è¯•ä¸€ä¸‹</h2>
<pre><code class="hljs language-ini" lang="ini">æ§åˆ¶å°è¾“å…¥ï¼š
<span class="hljs-attr">document.body.style.backgroundColor</span> = <span class="hljs-string">"red"</span><span class="hljs-comment">;</span>
<span class="hljs-attr">document.body.style.color</span> = <span class="hljs-string">"white"</span><span class="hljs-comment">;</span>

è§‚å¯Ÿé¡µé¢æ ·å¼å˜åŒ–
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ES2025æ–°ç‰¹æ€§å®æˆ˜ï¼š5åˆ†é’Ÿgetå‰ç«¯é«˜é¢‘å®ç”¨è¯­æ³•]]></title>    <link>https://juejin.cn/post/7573535624533344275</link>    <guid>https://juejin.cn/post/7573535624533344275</guid>    <pubDate>2025-11-18T01:09:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573535624533344275" data-draft-id="7573525634213527595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ES2025æ–°ç‰¹æ€§å®æˆ˜ï¼š5åˆ†é’Ÿgetå‰ç«¯é«˜é¢‘å®ç”¨è¯­æ³•"/> <meta itemprop="keywords" content="å‰ç«¯,TypeScript"/> <meta itemprop="datePublished" content="2025-11-18T01:09:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å®‡ä½™"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453424542"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ES2025æ–°ç‰¹æ€§å®æˆ˜ï¼š5åˆ†é’Ÿgetå‰ç«¯é«˜é¢‘å®ç”¨è¯­æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453424542/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å®‡ä½™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:09:22.000Z" title="Tue Nov 18 2025 01:09:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ES2025 ä½œä¸º JavaScript æ ‡å‡†çš„ç¬¬ 16 ç‰ˆï¼Œå¸¦æ¥äº†ä¸€æ‰¹ç›´å‡»å¼€å‘è€…ç—›ç‚¹çš„æ–°ç‰¹æ€§ã€‚ä¸ç”¨å†ç­‰ Babel æ’ä»¶å…¼å®¹ï¼Œç°åœ¨ä¸»æµæµè§ˆå™¨å’Œ Node.js å·²é€æ­¥æ”¯æŒã€‚æœ¬æ–‡ç²¾é€‰ 5 ä¸ªæœ€èƒ½æå‡å¼€å‘æ•ˆç‡çš„è¯­æ³•ï¼Œ5 åˆ†é’Ÿå°±èƒ½ä¸Šæ‰‹å®æˆ˜ï¼ğŸš€</p>
<h2 data-id="heading-0">1. Promise.try()ï¼šåŒæ­¥å¼‚æ­¥é”™è¯¯ä¸€æŠŠæŠ“</h2>
<p><em>ï¼ˆé…å›¾å»ºè®®ï¼šå·¦ä¾§åŒæ­¥ä»£ç æŠ¥é”™æ— æ³•æ•è·çš„çº¢è‰²è­¦å‘Šç¤ºæ„å›¾ï¼Œå³ä¾§Promise.try()ç»Ÿä¸€æ•è·é”™è¯¯çš„ç»¿è‰²æµç¨‹ç¤ºæ„å›¾ï¼Œå¯¹æ¯”å±•ç¤ºï¼‰</em></p>
<p><strong>ç—›ç‚¹</strong>ï¼šåŒæ­¥å‡½æ•°æŠ›å‡ºçš„é”™è¯¯æ— æ³•ç›´æ¥è¢« <code>Promise.catch</code> æ•è·ï¼Œå¿…é¡»é¢å¤–åµŒå¥— <code>try/catch</code>ã€‚</p>
<p><strong>æ–°å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mightThrow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Oops'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">'Success'</span>;
}

<span class="hljs-comment">// ç»Ÿä¸€æ•è·åŒæ­¥/å¼‚æ­¥é”™è¯¯</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">try</span>(mightThrow)
  .<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)  <span class="hljs-comment">// æˆåŠŸè¾“å‡º 'Success'</span>
  .<span class="hljs-keyword">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>); <span class="hljs-comment">// å¤±è´¥æ•è·æ‰€æœ‰é”™è¯¯</span>
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šæ··åˆåŒæ­¥å¼‚æ­¥æ“ä½œï¼ˆå¦‚å›¾å½¢æ¸²æŸ“ã€æ•°æ®åº“æŸ¥è¯¢ï¼‰æ—¶ï¼Œä»£ç åµŒå¥—å‡å°‘ 30%ï¼Œé”™è¯¯é€»è¾‘æ›´ç»Ÿä¸€ã€‚
<strong>å®æˆ˜åœºæ™¯</strong>ï¼šæ¥å£è¯·æ±‚å‰éœ€æ ¡éªŒå‚æ•°åˆæ³•æ€§ï¼ˆåŒæ­¥ï¼‰ï¼Œæ ¡éªŒé€šè¿‡åå‘èµ·è¯·æ±‚ï¼ˆå¼‚æ­¥ï¼‰ï¼Œç”¨Promise.try()å¯é¿å…åµŒå¥—try/catchï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = (<span class="hljs-params">params</span>) =&gt; {
  <span class="hljs-comment">// åŒæ­¥å‚æ•°æ ¡éªŒ</span>
  <span class="hljs-keyword">if</span> (!params.<span class="hljs-property">id</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ç¼ºå°‘ID'</span>);
  <span class="hljs-comment">// å¼‚æ­¥è¯·æ±‚</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/data/<span class="hljs-subst">${params.id}</span>`</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>());
};

<span class="hljs-comment">// ç»Ÿä¸€é”™è¯¯å¤„ç†</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">try</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchData</span>({}))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">alert</span>(err.<span class="hljs-property">message</span>)); <span class="hljs-comment">// ç›´æ¥æ•è·"ç¼ºå°‘ID"é”™è¯¯</span>
</code></pre>
<h2 data-id="heading-1">2. Set é›†åˆè¿ç®—ï¼šå‘Šåˆ« Lodash ä¾èµ–</h2>
<p><em>ï¼ˆé…å›¾å»ºè®®ï¼šä¸¤ä¸ªé‡å çš„å½©è‰²åœ†åœˆåˆ†åˆ«ä»£è¡¨userTagså’ŒhotTagsï¼Œäº¤é›†éƒ¨åˆ†ç”¨é«˜äº®é¢œè‰²æ ‡æ³¨ï¼Œæ—ä¾§æ ‡æ³¨unionã€differenceè¿ç®—ç»“æœï¼‰</em></p>
<p><strong>ç—›ç‚¹</strong>ï¼šæ±‚äº¤é›†ã€å¹¶é›†è¿˜è¦æ‰‹åŠ¨å®ç°å¾ªç¯ï¼ŸLodash ä½“ç§¯åˆå«Œå¤§ï¼Ÿ</p>
<p><strong>æ–°å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> userTags = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">'js'</span>, <span class="hljs-string">'node'</span>, <span class="hljs-string">'web'</span>]);
<span class="hljs-keyword">const</span> hotTags = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">'web'</span>, <span class="hljs-string">'react'</span>, <span class="hljs-string">'ts'</span>]);

<span class="hljs-comment">// äº¤é›†ï¼šå…±åŒæ ‡ç­¾</span>
<span class="hljs-keyword">const</span> common = userTags.<span class="hljs-title function_">intersection</span>(hotTags); <span class="hljs-comment">// Set {'web'}</span>
<span class="hljs-comment">// å·®é›†ï¼šæ¨èæ ‡ç­¾</span>
<span class="hljs-keyword">const</span> recommended = hotTags.<span class="hljs-title function_">difference</span>(userTags); <span class="hljs-comment">// Set {'react', 'ts'}</span>
<span class="hljs-comment">// å¹¶é›†ï¼šæ‰€æœ‰æ ‡ç­¾</span>
<span class="hljs-keyword">const</span> all = userTags.<span class="hljs-title function_">union</span>(hotTags); <span class="hljs-comment">// Set {'js','node','web','react','ts'}</span>
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šåŸç”Ÿå®ç°åŸºäºå“ˆå¸Œè¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ O(min(n,m))ï¼Œæ ‡ç­¾ç³»ç»Ÿã€æƒé™ç®¡ç†åœºæ™¯ç›´æ¥ç”¨ã€‚
<strong>å®æˆ˜åœºæ™¯</strong>ï¼šæƒé™æ§åˆ¶ä¸­ï¼Œç­›é€‰ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ä¸é¡µé¢æ‰€éœ€æƒé™çš„äº¤é›†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒè®¿é—®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> userPermissions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">'view'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'delete'</span>]);
<span class="hljs-keyword">const</span> pageRequired = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">'view'</span>, <span class="hljs-string">'export'</span>]);

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰å¿…éœ€æƒé™</span>
<span class="hljs-keyword">const</span> hasAll = pageRequired.<span class="hljs-title function_">difference</span>(userPermissions).<span class="hljs-property">size</span> === <span class="hljs-number">0</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hasAll); <span class="hljs-comment">// falseï¼ˆç¼ºå°‘exportæƒé™ï¼‰</span>

<span class="hljs-comment">// è·å–ç”¨æˆ·å¯æ“ä½œçš„æƒé™</span>
<span class="hljs-keyword">const</span> availableActions = userPermissions.<span class="hljs-title function_">intersection</span>(pageRequired);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([...availableActions]); <span class="hljs-comment">// ['view']</span>
</code></pre>
<h2 data-id="heading-2">3. æ¨¡å¼åŒ¹é…ï¼šif-else æ€æ‰‹æ¥äº†</h2>
<p><em>ï¼ˆé…å›¾å»ºè®®ï¼šå·¦ä¾§æ‚ä¹±çš„if-elseåˆ†æ”¯æµç¨‹å›¾ï¼Œå³ä¾§æ¨¡å¼åŒ¹é…çš„æ¸…æ™°åˆ†æ”¯æ ‘çŠ¶å›¾ï¼Œè§†è§‰å¯¹æ¯”çªå‡ºç®€æ´æ€§ï¼‰</em></p>
<p><strong>ç—›ç‚¹</strong>ï¼šå¤šæ¡ä»¶åˆ†æ”¯ç”¨ if-else å†™å¾—åƒé¢æ¡ï¼Ÿswitch åˆä¸å¤Ÿçµæ´»ï¼Ÿ</p>
<p><strong>æ–°å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processResponse</span>(<span class="hljs-params">response</span>) {
  <span class="hljs-keyword">return</span> match (response) {
    when ({ <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>, data }) -&gt; ({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, data })
    when ({ <span class="hljs-attr">status</span>: <span class="hljs-number">404</span> }) -&gt; ({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-string">'Not found'</span> })
    when ({ <span class="hljs-attr">status</span>: s <span class="hljs-keyword">if</span> s &gt;= <span class="hljs-number">500</span> }) -&gt; ({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-string">'Server error'</span> })
    <span class="hljs-keyword">default</span> -&gt; ({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-string">'Unknown error'</span> })
  };
}

<span class="hljs-comment">// æ•°ç»„é•¿åº¦åˆ†æ”¯ä¹Ÿä¼˜é›…</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleArray</span>(<span class="hljs-params">arr</span>) {
  <span class="hljs-keyword">return</span> match (arr) {
    when (()) -&gt; <span class="hljs-string">"ç©ºæ•°ç»„"</span>
    when ((first)) -&gt; <span class="hljs-string">`ä»…ä¸€ä¸ªå…ƒç´ : <span class="hljs-subst">${first}</span>`</span>
    when ((a, b, ...rest)) -&gt; <span class="hljs-string">`å‰ä¸¤ä¸ª: <span class="hljs-subst">${a}</span>,<span class="hljs-subst">${b}</span>ï¼Œå‰©ä½™<span class="hljs-subst">${rest.length}</span>ä¸ª`</span>
  };
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šæ¡ä»¶é€»è¾‘å¯è§†åŒ–ï¼Œä»£ç è¡Œæ•°å‡å°‘ 40%ï¼Œå¤æ‚åˆ†æ”¯ç»´æŠ¤æˆæœ¬éª¤é™ã€‚
<strong>å®æˆ˜åœºæ™¯</strong>ï¼šå¤„ç†ä¸åŒç±»å‹çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²è¿”å›å¯¹åº”æ“ä½œèœå•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserMenu</span>(<span class="hljs-params">user</span>) {
  <span class="hljs-keyword">return</span> match (user) {
    when ({ <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> }) -&gt; [<span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'user-manage'</span>, <span class="hljs-string">'settings'</span>]
    when ({ <span class="hljs-attr">role</span>: <span class="hljs-string">'editor'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> }) -&gt; [<span class="hljs-string">'dashboard'</span>, <span class="hljs-string">'article-edit'</span>]
    when ({ <span class="hljs-attr">status</span>: <span class="hljs-string">'inactive'</span> }) -&gt; [<span class="hljs-string">'profile'</span>, <span class="hljs-string">'activate-account'</span>]
    <span class="hljs-keyword">default</span> -&gt; [<span class="hljs-string">'profile'</span>]
  };
}

<span class="hljs-keyword">const</span> adminMenu = <span class="hljs-title function_">getUserMenu</span>({ <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> });
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(adminMenu); <span class="hljs-comment">// ['dashboard', 'user-manage', 'settings']</span>
</code></pre>
<h2 data-id="heading-3">4. ç®¡é“è¿ç®—ç¬¦ï¼šå‡½æ•°ç»„åˆåƒå†™æµæ°´çº¿</h2>
<p><em>ï¼ˆé…å›¾å»ºè®®ï¼šæ•°æ®ä»å·¦åˆ°å³æµè¿‡å¤šä¸ªå¤„ç†èŠ‚ç‚¹çš„æµæ°´çº¿ç¤ºæ„å›¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ ‡æ³¨trimã€parseFloatç­‰å‡½æ•°ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœï¼‰</em></p>
<p><strong>ç—›ç‚¹</strong>ï¼šåµŒå¥—å‡½æ•°è°ƒç”¨ï¼ˆå¦‚ <code>round(abs(sqrt(x)))</code>ï¼‰è¯»èµ·æ¥åƒ"ä»å³å¾€å·¦"çš„å¥—å¨ƒã€‚</p>
<p><strong>æ–°å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> userInput = <span class="hljs-string">" 3.1415926 "</span>;

<span class="hljs-comment">// è‡ªå·¦å‘å³çš„æ•°æ®å¤„ç†æµæ°´çº¿</span>
<span class="hljs-keyword">const</span> result = userInput
  |&gt; <span class="hljs-title class_">String</span>.<span class="hljs-title function_">trim</span>(%)
  |&gt; <span class="hljs-built_in">parseFloat</span>(%)
  |&gt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(%)
  |&gt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(%); <span class="hljs-comment">// ç»“æœï¼š2</span>

<span class="hljs-comment">// å¼‚æ­¥æµæ°´çº¿ä¹Ÿæ”¯æŒ</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt;
  url
  |&gt; <span class="hljs-title function_">fetch</span>(%)
  |&gt; <span class="hljs-keyword">await</span> %.<span class="hljs-title function_">json</span>()
  |&gt; (% =&gt; %.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">active</span>))
  |&gt; (% =&gt; %.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>));
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šæ•°æ®æµå‘æ¸…æ™°å¦‚æµç¨‹å›¾ï¼Œå¤æ‚å‡½æ•°ç»„åˆå¯è¯»æ€§æå‡ 60%ã€‚
<strong>å®æˆ˜åœºæ™¯</strong>ï¼šå¤„ç†åç«¯è¿”å›çš„æ—¶é—´æˆ³æ•°æ®ï¼Œè½¬æ¢ä¸ºæ ¼å¼åŒ–çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatTime</span> = (<span class="hljs-params">timestamp</span>) =&gt;
  timestamp
  |&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(%)
  |&gt; (<span class="hljs-function"><span class="hljs-params">date</span> =&gt;</span> date.<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">'zh-CN'</span>))
  |&gt; (<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">'-'</span>))
  |&gt; (<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> <span class="hljs-string">`æ—¥æœŸï¼š<span class="hljs-subst">${str}</span>`</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">formatTime</span>(<span class="hljs-number">1734567890000</span>)); <span class="hljs-comment">// æ—¥æœŸï¼š2024-12-19</span>
</code></pre>
<h2 data-id="heading-4">5. Record &amp; Tupleï¼šåŸç”Ÿä¸å¯å˜æ•°æ®</h2>
<p><em>ï¼ˆé…å›¾å»ºè®®ï¼šå·¦ä¾§æ™®é€šå¯¹è±¡å¼•ç”¨èµ‹å€¼çš„ç®­å¤´æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ï¼Œå³ä¾§Recordå¯¹è±¡ç»“æ„ç›¸ç­‰çš„åŒç®­å¤´æŒ‡å‘ä¸åŒåœ°å€ä½†æ ‡æ³¨å€¼ç›¸ç­‰ï¼‰</em></p>
<p><strong>ç—›ç‚¹</strong>ï¼šç”¨ Object.freeze() åšä¸å¯å˜å¯¹è±¡ï¼Ÿæ€§èƒ½å·®è¿˜ä¸èƒ½æ·±å†»ç»“ï¼Ÿ</p>
<p><strong>æ–°å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// Recordï¼šä¸å¯å˜å¯¹è±¡ï¼ˆ#{} è¯­æ³•ï¼‰</span>
<span class="hljs-keyword">const</span> user = #{
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
  <span class="hljs-attr">tags</span>: #[<span class="hljs-string">"js"</span>, <span class="hljs-string">"react"</span>] <span class="hljs-comment">// Tupleï¼šä¸å¯å˜æ•°ç»„ï¼ˆ#() è¯­æ³•ï¼‰</span>
};

<span class="hljs-comment">// ç»“æ„ç›¸ç­‰æ€§åˆ¤æ–­ï¼ˆå‘Šåˆ«å¼•ç”¨é™·é˜±ï¼‰</span>
<span class="hljs-keyword">const</span> user1 = #{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span> };
<span class="hljs-keyword">const</span> user2 = #{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1 === user2); <span class="hljs-comment">// trueï¼</span>

<span class="hljs-comment">// React ä¸­ç®€åŒ–ä¾èµ–å¯¹æ¯”</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">UserComponent</span> = (<span class="hljs-params">{ user }</span>) =&gt; {
  <span class="hljs-keyword">const</span> memoized = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> #{...user}, [user]); 
  <span class="hljs-comment">// æ— éœ€æ·±æ¯”è¾ƒï¼Œå¼•ç”¨ç›´æ¥ç›¸ç­‰</span>
};
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šåŸç”Ÿä¸å¯å˜+ç»“æ„ç›¸ç­‰ï¼ŒRedux/React çŠ¶æ€ç®¡ç†åœºæ™¯æ€§èƒ½é£™å‡ã€‚
<strong>å®æˆ˜åœºæ™¯</strong>ï¼šReduxçŠ¶æ€ä¸­å­˜å‚¨ç”¨æˆ·é…ç½®ï¼Œé¿å…å› å¼•ç”¨ä¸å˜å¯¼è‡´çš„ç»„ä»¶ä¸æ›´æ–°é—®é¢˜ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-comment">// Redux reducer</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">configReducer</span> = (<span class="hljs-params">state = #{theme: <span class="hljs-string">'light'</span>, layout: <span class="hljs-string">'grid'</span>}, action</span>) =&gt; {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'UPDATE_THEME'</span>:
      <span class="hljs-comment">// è¿”å›æ–°çš„Recordï¼Œç»“æ„å˜åŒ–è§¦å‘è®¢é˜…æ›´æ–°</span>
      <span class="hljs-keyword">return</span> #{...state, <span class="hljs-attr">theme</span>: action.<span class="hljs-property">payload</span>};
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};

<span class="hljs-comment">// æ¯”è¾ƒçŠ¶æ€æ˜¯å¦å˜åŒ–</span>
<span class="hljs-keyword">const</span> prevState = #{<span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span>, <span class="hljs-attr">layout</span>: <span class="hljs-string">'grid'</span>};
<span class="hljs-keyword">const</span> newState = #{<span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>, <span class="hljs-attr">layout</span>: <span class="hljs-string">'grid'</span>};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(prevState !== newState); <span class="hljs-comment">// trueï¼ˆç»“æ„ä¸åŒï¼Œè§¦å‘æ›´æ–°ï¼‰</span>
</code></pre>
<h2 data-id="heading-5">ğŸ’¡ å…¼å®¹æ€§ä¸å­¦ä¹ å»ºè®®</h2>
<ul>
<li>
<p>æµè§ˆå™¨ï¼šChrome 120+ã€Firefox 115+ å·²æ”¯æŒå¤§éƒ¨åˆ†ç‰¹æ€§</p>
</li>
<li>
<p>Node.jsï¼šv20+ éœ€å¼€å¯ --experimental-features æ ‡å¿—</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 defineModel å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7573549302619766827</link>    <guid>https://juejin.cn/post/7573549302619766827</guid>    <pubDate>2025-11-18T01:35:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573549302619766827" data-draft-id="7573776814926561299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 defineModel å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-18T01:35:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hongliangsam"/> <meta itemprop="url" content="https://juejin.cn/user/1478159026371671"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 defineModel å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1478159026371671/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hongliangsam
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:35:08.000Z" title="Tue Nov 18 2025 01:35:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 defineModel å®Œå…¨æŒ‡å—</h2>
<h3 data-id="heading-1">ç›®å½•</h3>
<ol>
<li><a href="#%E6%A6%82%E8%BF%B0" title="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a></li>
<li><a href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" title="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">åŸºç¡€æ¦‚å¿µ</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95" title="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">åŸºæœ¬ç”¨æ³•</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7" title="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">é«˜çº§ç‰¹æ€§</a></li>
<li><a href="#typescript-%E6%94%AF%E6%8C%81" title="#typescript-%E6%94%AF%E6%8C%81">TypeScript æ”¯æŒ</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B" title="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B">å®æˆ˜æ¡ˆä¾‹</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">æœ€ä½³å®è·µ</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">å¸¸è§é—®é¢˜</a></li>
<li><a href="#%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94" title="#%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94">ä¸ä¼ ç»Ÿæ–¹å¼çš„å¯¹æ¯”</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">æ¦‚è¿°</h3>
<p><code>defineModel</code> æ˜¯ Vue 3.3 å¼•å…¥ã€3.4 ç¨³å®šçš„ä¸€ä¸ªç¼–è¯‘å™¨å®ï¼Œç”¨äºç®€åŒ–ç»„ä»¶çš„åŒå‘æ•°æ®ç»‘å®šå®ç°ã€‚å®ƒè®©å¼€å‘è€…èƒ½å¤Ÿæ›´è½»æ¾åœ°åˆ›å»ºæ”¯æŒ <code>v-model</code> çš„ç»„ä»¶ï¼Œå‡å°‘äº†æ ·æ¿ä»£ç ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p>
<h4 data-id="heading-3">ä¸ºä»€ä¹ˆéœ€è¦ defineModelï¼Ÿ</h4>
<p>åœ¨ Vue 3.3 ä¹‹å‰ï¼Œå®ç°ä¸€ä¸ªæ”¯æŒ <code>v-model</code> çš„ç»„ä»¶éœ€è¦ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ - éœ€è¦å®šä¹‰ props å’Œ emits</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'modelValue'</span>])
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">computed</span>({
  <span class="hljs-attr">get</span>: <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">modelValue</span>,
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
})
</code></pre>
<p>è€Œä½¿ç”¨ <code>defineModel</code> åï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// defineModel æ–¹å¼ - ç®€æ´æ˜äº†</span>
<span class="hljs-keyword">const</span> modelValue = <span class="hljs-title function_">defineModel</span>()
</code></pre>
<h4 data-id="heading-4">ä¸»è¦ä¼˜åŠ¿</h4>
<ul>
<li><strong>ç®€åŒ–ä»£ç </strong>ï¼šå‡å°‘é‡å¤çš„æ ·æ¿ä»£ç </li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ›´å¥½çš„ TypeScript æ”¯æŒ</li>
<li><strong>ä¿®é¥°ç¬¦æ”¯æŒ</strong>ï¼šå†…ç½®å¯¹ <code>v-model</code> ä¿®é¥°ç¬¦çš„æ”¯æŒ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œè¿è¡Œæ—¶å¼€é”€æ›´å°</li>
</ul>
<hr/>
<h3 data-id="heading-5">åŸºç¡€æ¦‚å¿µ</h3>
<h4 data-id="heading-6">ä»€ä¹ˆæ˜¯ç¼–è¯‘å™¨å®ï¼Ÿ</h4>
<p><code>defineModel</code> æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨å®ï¼Œè¿™æ„å‘³ç€å®ƒä¼šåœ¨æ„å»ºé˜¶æ®µè¢« Vue ç¼–è¯‘å™¨å¤„ç†ï¼Œè½¬æ¢ä¸ºç›¸åº”çš„è¿è¡Œæ—¶ä»£ç ã€‚ç¼–è¯‘å™¨å®åªåœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦å¯¼å…¥ã€‚</p>
<h4 data-id="heading-7">åŒå‘æ•°æ®ç»‘å®šåŸç†</h4>
<p>Vue çš„ <code>v-model</code> æœ¬è´¨ä¸Šæ˜¯è¯­æ³•ç³–ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ä½¿ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"count"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- ç­‰ä»·äº --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span>
  <span class="hljs-attr">:model-value</span>=<span class="hljs-string">"count"</span>
  @<span class="hljs-attr">update:model-value</span>=<span class="hljs-string">"newValue =&gt; count = newValue"</span>
/&gt;</span>
</code></pre>
<p><code>defineModel</code> è‡ªåŠ¨å¤„ç†è¿™ç§ prop å’Œ emit çš„é…å¯¹å…³ç³»ã€‚</p>
<hr/>
<h3 data-id="heading-8">åŸºæœ¬ç”¨æ³•</h3>
<h4 data-id="heading-9">1. ç®€å•çš„æ¨¡å‹ç»‘å®š</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ChildComponent.vue --&gt;
&lt;script setup&gt;
const modelValue = defineModel()
&lt;/script&gt;

&lt;template&gt;
  &lt;input
    v-model="modelValue"
    placeholder="è¾“å…¥å†…å®¹..."
  /&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ParentComponent.vue --&gt;
&lt;script setup&gt;
import { ref } from 'vue'
import ChildComponent from './ChildComponent.vue'

const message = ref('Hello World')
&lt;/script&gt;

&lt;template&gt;
  &lt;ChildComponent v-model="message" /&gt;
  &lt;p&gt;å½“å‰å€¼: {{ message }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-10">2. å‘½åæ¨¡å‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- è‡ªå®šä¹‰æ¨¡å‹åç§° --&gt;
&lt;script setup&gt;
// å£°æ˜åä¸º 'title' çš„æ¨¡å‹
const title = defineModel('title')

// å£°æ˜åä¸º 'count' çš„æ¨¡å‹
const count = defineModel('count')
&lt;/script&gt;

&lt;template&gt;
  &lt;input v-model="title" placeholder="æ ‡é¢˜" /&gt;
  &lt;input v-model="count" type="number" placeholder="æ•°é‡" /&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ --&gt;
&lt;script setup&gt;
import { ref } from 'vue'
import CustomModelComponent from './CustomModelComponent.vue'

const postTitle = ref('')
const postCount = ref(1)
&lt;/script&gt;

&lt;template&gt;
  &lt;CustomModelComponent
    v-model:title="postTitle"
    v-model:count="postCount"
  /&gt;
  &lt;p&gt;æ ‡é¢˜: {{ postTitle }}&lt;/p&gt;
  &lt;p&gt;æ•°é‡: {{ postCount }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-11">3. è®¾ç½®é»˜è®¤å€¼å’Œç±»å‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// å¸¦ç±»å‹å’Œé»˜è®¤å€¼çš„æ¨¡å‹
const name = defineModel({
  type: String,
  default: 'åŒ¿åç”¨æˆ·'
})

const age = defineModel({
  type: Number,
  default: 0
})

const isActive = defineModel({
  type: Boolean,
  default: false
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;label&gt;å§“å: &lt;input v-model="name" /&gt;&lt;/label&gt;
    &lt;label&gt;å¹´é¾„: &lt;input v-model="age" type="number" /&gt;&lt;/label&gt;
    &lt;label&gt;
      &lt;input v-model="isActive" type="checkbox" /&gt;
      æ¿€æ´»çŠ¶æ€
    &lt;/label&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h3 data-id="heading-12">é«˜çº§ç‰¹æ€§</h3>
<h4 data-id="heading-13">1. æ¨¡å‹ä¿®é¥°ç¬¦</h4>
<p><code>defineModel</code> å†…ç½®å¯¹ <code>v-model</code> ä¿®é¥°ç¬¦çš„æ”¯æŒï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- TextInput.vue --&gt;
&lt;script setup&gt;
// è·å–æ¨¡å‹å€¼å’Œä¿®é¥°ç¬¦å¯¹è±¡
const [modelValue, modelModifiers] = defineModel()

// ç›‘å¬ä¿®é¥°ç¬¦
watch(modelModifiers, (newModifiers) =&gt; {
  console.log('å½“å‰ä¿®é¥°ç¬¦:', newModifiers)
})

// ä½¿ç”¨ä¿®é¥°ç¬¦å¤„ç†æ•°æ®
const processedValue = computed({
  get: () =&gt; modelValue.value,
  set: (value) =&gt; {
    if (modelModifiers.trim) {
      value = value.trim()
    }
    if (modelModifiers.upper) {
      value = value.toUpperCase()
    }
    modelValue.value = value
  }
})
&lt;/script&gt;

&lt;template&gt;
  &lt;input v-model="processedValue" /&gt;
  &lt;p&gt;ä¿®é¥°ç¬¦: {{ JSON.stringify(modelModifiers) }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ä½¿ç”¨ä¿®é¥°ç¬¦ --&gt;
&lt;script setup&gt;
import TextInput from './TextInput.vue'
const text = ref('')
&lt;/script&gt;

&lt;template&gt;
  &lt;TextInput v-model.trim.upper="text" /&gt;
  &lt;p&gt;å¤„ç†åçš„å€¼: {{ text }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-14">2. è‡ªå®šä¹‰ä¿®é¥°ç¬¦</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- NumberInput.vue --&gt;
&lt;script setup&gt;
const [modelValue, modelModifiers] = defineModel({
  // è‡ªå®šä¹‰ getter/setter
  get(value) {
    // å¤„ç†è‡ªå®šä¹‰ä¿®é¥°ç¬¦
    if (modelModifiers.currency) {
      return new Intl.NumberFormat('zh-CN', {
        style: 'currency',
        currency: 'CNY'
      }).format(value)
    }
    if (modelModifiers.percentage) {
      return `${value}%`
    }
    return value
  },
  set(value) {
    // æ¸…ç†æ ¼å¼åŒ–åçš„å€¼
    if (modelModifiers.currency) {
      return parseFloat(value.replace(/[Â¥,]/g, ''))
    }
    if (modelModifiers.percentage) {
      return parseFloat(value.replace('%', ''))
    }
    return parseFloat(value) || 0
  }
})
&lt;/script&gt;

&lt;template&gt;
  &lt;input v-model="modelValue" /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-15">3. å¤æ‚å¯¹è±¡æ¨¡å‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- UserProfile.vue --&gt;
&lt;script setup&gt;
// å¤æ‚å¯¹è±¡çš„æ¨¡å‹ç»‘å®š
const user = defineModel({
  type: Object,
  default: () =&gt; ({
    name: '',
    email: '',
    age: 0,
    avatar: ''
  })
})

// è®¡ç®—å±æ€§éªŒè¯
const isFormValid = computed(() =&gt; {
  return user.value.name &amp;&amp;
         user.value.email &amp;&amp;
         user.value.email.includes('@') &amp;&amp;
         user.value.age &gt; 0
})

// æ–¹æ³•
const resetForm = () =&gt; {
  user.value = {
    name: '',
    email: '',
    age: 0,
    avatar: ''
  }
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="user-profile"&gt;
    &lt;div class="form-group"&gt;
      &lt;label&gt;å§“å:&lt;/label&gt;
      &lt;input v-model="user.name" /&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;label&gt;é‚®ç®±:&lt;/label&gt;
      &lt;input v-model="user.email" type="email" /&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;label&gt;å¹´é¾„:&lt;/label&gt;
      &lt;input v-model="user.age" type="number" /&gt;
    &lt;/div&gt;

    &lt;div class="form-group"&gt;
      &lt;label&gt;å¤´åƒURL:&lt;/label&gt;
      &lt;input v-model="user.avatar" /&gt;
    &lt;/div&gt;

    &lt;button @click="resetForm"&gt;é‡ç½®&lt;/button&gt;
    &lt;p v-if="!isFormValid" class="error"&gt;
      è¯·å¡«å†™å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.user-profile {
  max-width: 400px;
  margin: 0 auto;
}

.form-group {
  margin-bottom: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
}

.form-group input {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.error {
  color: red;
}
&lt;/style&gt;
</code></pre>
<hr/>
<h3 data-id="heading-16">TypeScript æ”¯æŒ</h3>
<h4 data-id="heading-17">1. åŸºæœ¬ç±»å‹æ³¨è§£</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
// åŸºæœ¬ç±»å‹æ³¨è§£
const text = defineModel&lt;string&gt;()
const number = defineModel&lt;number&gt;()
const boolean = defineModel&lt;boolean&gt;()

// æ•°ç»„ç±»å‹
const items = defineModel&lt;string[]&gt;({ default: () =&gt; [] })

// å¯¹è±¡ç±»å‹
interface User {
  id: number
  name: string
  email: string
}

const user = defineModel&lt;User&gt;({
  type: Object as PropType&lt;User&gt;,
  required: true
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-18">2. å¤æ‚ç±»å‹å®šä¹‰</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import type { PropType } from 'vue'

interface FormField {
  id: string
  label: string
  type: 'text' | 'email' | 'number' | 'textarea'
  value: string | number
  required?: boolean
  placeholder?: string
  validation?: {
    min?: number
    max?: number
    pattern?: string
  }
}

const formFields = defineModel&lt;FormField[]&gt;({
  type: Array as PropType&lt;FormField[]&gt;,
  default: () =&gt; [],
  // è‡ªå®šä¹‰éªŒè¯å‡½æ•°
  validator: (value: FormField[]) =&gt; {
    return Array.isArray(value) &amp;&amp;
           value.every(field =&gt; field.id &amp;&amp; field.label &amp;&amp; field.type)
  }
})

// è·å–ä¿®é¥°ç¬¦çš„ç±»å‹
const [modelValue, modelModifiers] = defineModel&lt;string, {
  trim?: boolean
  uppercase?: boolean
  required?: boolean
}&gt;()

// ç±»å‹å®‰å…¨çš„æ–¹æ³•
const updateField = (index: number, value: string) =&gt; {
  if (formFields.value[index]) {
    formFields.value[index].value = value
  }
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-19">3. æ³›å‹ç»„ä»¶</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
// æ³›å‹æ¨¡å‹ç»„ä»¶
interface GenericModelProps&lt;T&gt; {
  value: T
  options?: T[]
}

// ä½¿ç”¨æ³›å‹
const modelValue = defineModel&lt;T&gt;({
  type: [String, Number, Object, Array] as PropType&lt;T&gt;,
  required: true
})

// ç±»å‹æ¨æ–­
type ModelType = typeof modelValue extends { value: infer T } ? T : never
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-20">å®æˆ˜æ¡ˆä¾‹</h3>
<h4 data-id="heading-21">æ¡ˆä¾‹1ï¼šè‡ªå®šä¹‰è¾“å…¥ç»„ä»¶åº“</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- BaseInput.vue --&gt;
&lt;script setup lang="ts"&gt;
interface Props {
  type?: 'text' | 'email' | 'password' | 'number' | 'tel'
  placeholder?: string
  disabled?: boolean
  readonly?: boolean
  maxlength?: number
  minlength?: number
}

// æ”¯æŒå¤šç§ä¿®é¥°ç¬¦
const [modelValue, modelModifiers] = defineModel&lt;string, {
  trim?: boolean
  uppercase?: boolean
  lowercase?: boolean
  number?: boolean
}&gt;()

const props = withDefaults(defineProps&lt;Props&gt;(), {
  type: 'text',
  placeholder: '',
  disabled: false,
  readonly: false
})

const emit = defineEmits&lt;{
  focus: [event: FocusEvent]
  blur: [event: FocusEvent]
  input: [event: Event]
  change: [event: Event]
}&gt;()

// å¤„ç†ä¿®é¥°ç¬¦
const processedValue = computed({
  get: () =&gt; {
    let value = modelValue.value || ''

    if (modelModifiers.uppercase) {
      value = value.toUpperCase()
    }
    if (modelModifiers.lowercase) {
      value = value.toLowerCase()
    }

    return value
  },
  set: (value: string) =&gt; {
    if (modelModifiers.trim) {
      value = value.trim()
    }
    if (modelModifiers.number) {
      value = value.replace(/[^\d.-]/g, '')
    }
    modelValue.value = value
  }
})

// äº‹ä»¶å¤„ç†
const handleInput = (event: Event) =&gt; {
  const target = event.target as HTMLInputElement
  processedValue.value = target.value
  emit('input', event)
}

const handleChange = (event: Event) =&gt; {
  const target = event.target as HTMLInputElement
  processedValue.value = target.value
  emit('change', event)
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="base-input"&gt;
    &lt;input
      :type="type"
      :value="processedValue"
      :placeholder="placeholder"
      :disabled="disabled"
      :readonly="readonly"
      :maxlength="maxlength"
      :minlength="minlength"
      @input="handleInput"
      @change="handleChange"
      @focus="$emit('focus', $event)"
      @blur="$emit('blur', $event)"
      class="input-field"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.base-input {
  position: relative;
  display: inline-block;
}

.input-field {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  font-size: 14px;
  transition: border-color 0.2s;
  box-sizing: border-box;
}

.input-field:focus {
  outline: none;
  border-color: #409eff;
}

.input-field:disabled {
  background-color: #f5f7fa;
  cursor: not-allowed;
}

.input-field:readonly {
  background-color: #f5f7fa;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-22">æ¡ˆä¾‹2ï¼šå¯ç¼–è¾‘è¡¨æ ¼ç»„ä»¶</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- EditableTable.vue --&gt;
&lt;script setup lang="ts"&gt;
interface TableColumn {
  key: string
  title: string
  width?: string
  type?: 'text' | 'number' | 'select'
  options?: Array&lt;{ label: string; value: any }&gt;
  required?: boolean
}

interface TableRow {
  [key: string]: any
}

interface Props {
  columns: TableColumn[]
  data: TableRow[]
  editable?: boolean
  addable?: boolean
  deletable?: boolean
}

const props = withDefaults(defineProps&lt;Props&gt;(), {
  editable: true,
  addable: true,
  deletable: true
})

// åŒå‘ç»‘å®šè¡¨æ ¼æ•°æ®
const tableData = defineModel&lt;TableRow[]&gt;('data', {
  type: Array as PropType&lt;TableRow[]&gt;,
  required: true
})

// è®¡ç®—å±æ€§
const hasData = computed(() =&gt; tableData.value &amp;&amp; tableData.value.length &gt; 0)

// æ–¹æ³•
const addRow = () =&gt; {
  const newRow: TableRow = {}
  props.columns.forEach(col =&gt; {
    newRow[col.key] = col.type === 'number' ? 0 : ''
  })
  tableData.value = [...tableData.value, newRow]
}

const deleteRow = (index: number) =&gt; {
  tableData.value = tableData.value.filter((_, i) =&gt; i !== index)
}

const updateCell = (rowIndex: number, columnKey: string, value: any) =&gt; {
  const newData = [...tableData.value]
  newData[rowIndex][columnKey] = value
  tableData.value = newData
}

// éªŒè¯
const validateRow = (row: TableRow): boolean =&gt; {
  return props.columns.every(col =&gt; {
    if (col.required &amp;&amp; (!row[col.key] || row[col.key] === '')) {
      return false
    }
    return true
  })
}

const validateTable = (): boolean =&gt; {
  return tableData.value.every(row =&gt; validateRow(row))
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="editable-table"&gt;
    &lt;table class="table"&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th v-for="column in columns" :key="column.key" :style="{ width: column.width }"&gt;
            {{ column.title }}
            &lt;span v-if="column.required" class="required"&gt;*&lt;/span&gt;
          &lt;/th&gt;
          &lt;th v-if="deletable" class="action-column"&gt;æ“ä½œ&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr v-for="(row, rowIndex) in tableData" :key="rowIndex" :class="{ 'invalid-row': !validateRow(row) }"&gt;
          &lt;td v-for="column in columns" :key="column.key"&gt;
            &lt;template v-if="editable"&gt;
              &lt;input
                v-if="column.type === 'text' || !column.type"
                v-model="row[column.key]"
                @input="updateCell(rowIndex, column.key, ($event.target as HTMLInputElement).value)"
                type="text"
                class="cell-input"
              /&gt;
              &lt;input
                v-else-if="column.type === 'number'"
                v-model.number="row[column.key]"
                @input="updateCell(rowIndex, column.key, ($event.target as HTMLInputElement).value)"
                type="number"
                class="cell-input"
              /&gt;
              &lt;select
                v-else-if="column.type === 'select'"
                v-model="row[column.key]"
                @change="updateCell(rowIndex, column.key, ($event.target as HTMLSelectElement).value)"
                class="cell-select"
              &gt;
                &lt;option v-for="option in column.options" :key="option.value" :value="option.value"&gt;
                  {{ option.label }}
                &lt;/option&gt;
              &lt;/select&gt;
            &lt;/template&gt;
            &lt;template v-else&gt;
              {{ row[column.key] }}
            &lt;/template&gt;
          &lt;/td&gt;
          &lt;td v-if="deletable" class="action-column"&gt;
            &lt;button @click="deleteRow(rowIndex)" class="delete-btn"&gt;åˆ é™¤&lt;/button&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;div v-if="addable" class="table-actions"&gt;
      &lt;button @click="addRow" class="add-btn"&gt;æ·»åŠ è¡Œ&lt;/button&gt;
    &lt;/div&gt;

    &lt;div v-if="!validateTable()" class="validation-error"&gt;
      è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.editable-table {
  width: 100%;
}

.table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1rem;
}

.table th,
.table td {
  border: 1px solid #ebeef5;
  padding: 8px 12px;
  text-align: left;
}

.table th {
  background-color: #f5f7fa;
  font-weight: 600;
}

.required {
  color: #f56c6c;
}

.cell-input,
.cell-select {
  width: 100%;
  padding: 4px 8px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  font-size: 14px;
}

.cell-input:focus,
.cell-select:focus {
  outline: none;
  border-color: #409eff;
}

.invalid-row {
  background-color: #fef0f0;
}

.action-column {
  width: 100px;
  text-align: center;
}

.delete-btn {
  padding: 4px 8px;
  background-color: #f56c6c;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.delete-btn:hover {
  background-color: #f78989;
}

.table-actions {
  margin-bottom: 1rem;
}

.add-btn {
  padding: 8px 16px;
  background-color: #409eff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.add-btn:hover {
  background-color: #66b1ff;
}

.validation-error {
  color: #f56c6c;
  font-size: 14px;
  margin-top: 8px;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-23">æ¡ˆä¾‹3ï¼šæœç´¢ç­›é€‰ç»„ä»¶</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- SearchFilter.vue --&gt;
&lt;script setup lang="ts"&gt;
interface FilterOption {
  label: string
  value: any
  type?: 'text' | 'select' | 'date' | 'number'
  options?: Array&lt;{ label: string; value: any }&gt;
}

interface SearchFilterProps {
  filters: FilterOption[]
  placeholder?: string
  debounceTime?: number
}

const props = withDefaults(defineProps&lt;SearchFilterProps&gt;(), {
  placeholder: 'æœç´¢...',
  debounceTime: 300
})

// æœç´¢å…³é”®è¯æ¨¡å‹
const searchKeyword = defineModel&lt;string&gt;('keyword', {
  default: ''
})

// ç­›é€‰æ¡ä»¶æ¨¡å‹
const filterValues = defineModel&lt;Record&lt;string, any&gt;&gt;('filters', {
  default: () =&gt; ({})
})

// æœç´¢çŠ¶æ€
const isSearching = ref(false)

// é˜²æŠ–æœç´¢
const debouncedSearch = useDebounceFn(() =&gt; {
  isSearching.value = true
  setTimeout(() =&gt; {
    isSearching.value = false
  }, 500)
}, props.debounceTime)

// ç›‘å¬æœç´¢å…³é”®è¯å˜åŒ–
watch(searchKeyword, () =&gt; {
  debouncedSearch()
})

// ç›‘å¬ç­›é€‰æ¡ä»¶å˜åŒ–
watch(filterValues, () =&gt; {
  debouncedSearch()
}, { deep: true })

// é‡ç½®æœç´¢
const resetFilters = () =&gt; {
  searchKeyword.value = ''
  Object.keys(filterValues.value).forEach(key =&gt; {
    filterValues.value[key] = ''
  })
}

// æ´»è·ƒç­›é€‰æ•°é‡
const activeFilterCount = computed(() =&gt; {
  return Object.values(filterValues.value).filter(value =&gt;
    value !== '' &amp;&amp; value !== null &amp;&amp; value !== undefined
  ).length + (searchKeyword.value ? 1 : 0)
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="search-filter"&gt;
    &lt;!-- æœç´¢è¾“å…¥æ¡† --&gt;
    &lt;div class="search-input-wrapper"&gt;
      &lt;div class="search-icon"&gt;
        &lt;svg viewBox="0 0 24 24" width="16" height="16"&gt;
          &lt;path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/&gt;
        &lt;/svg&gt;
      &lt;/div&gt;
      &lt;input
        v-model="searchKeyword"
        type="text"
        :placeholder="placeholder"
        class="search-input"
      /&gt;
      &lt;div v-if="searchKeyword" class="clear-icon" @click="searchKeyword = ''"&gt;
        &lt;svg viewBox="0 0 24 24" width="16" height="16"&gt;
          &lt;path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/&gt;
        &lt;/svg&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- ç­›é€‰æ¡ä»¶ --&gt;
    &lt;div v-if="filters.length &gt; 0" class="filters-wrapper"&gt;
      &lt;div v-for="filter in filters" :key="filter.label" class="filter-item"&gt;
        &lt;label class="filter-label"&gt;{{ filter.label }}:&lt;/label&gt;

        &lt;template v-if="filter.type === 'select'"&gt;
          &lt;select v-model="filterValues[filter.label]" class="filter-select"&gt;
            &lt;option value=""&gt;å…¨éƒ¨&lt;/option&gt;
            &lt;option
              v-for="option in filter.options"
              :key="option.value"
              :value="option.value"
            &gt;
              {{ option.label }}
            &lt;/option&gt;
          &lt;/select&gt;
        &lt;/template&gt;

        &lt;template v-else-if="filter.type === 'date'"&gt;
          &lt;input
            v-model="filterValues[filter.label]"
            type="date"
            class="filter-input"
          /&gt;
        &lt;/template&gt;

        &lt;template v-else-if="filter.type === 'number'"&gt;
          &lt;input
            v-model.number="filterValues[filter.label]"
            type="number"
            class="filter-input"
          /&gt;
        &lt;/template&gt;

        &lt;template v-else&gt;
          &lt;input
            v-model="filterValues[filter.label]"
            type="text"
            :placeholder="filter.label"
            class="filter-input"
          /&gt;
        &lt;/template&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- æ“ä½œæŒ‰é’® --&gt;
    &lt;div class="filter-actions"&gt;
      &lt;div v-if="activeFilterCount &gt; 0" class="active-filters"&gt;
        å·²é€‰æ‹© {{ activeFilterCount }} ä¸ªç­›é€‰æ¡ä»¶
      &lt;/div&gt;
      &lt;button
        v-if="searchKeyword || activeFilterCount &gt; 0"
        @click="resetFilters"
        class="reset-btn"
      &gt;
        é‡ç½®
      &lt;/button&gt;
    &lt;/div&gt;

    &lt;!-- æœç´¢çŠ¶æ€æŒ‡ç¤ºå™¨ --&gt;
    &lt;div v-if="isSearching" class="searching-indicator"&gt;
      æœç´¢ä¸­...
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.search-filter {
  background-color: #f8f9fa;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
}

.search-input-wrapper {
  position: relative;
  margin-bottom: 12px;
}

.search-icon,
.clear-icon {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: #6c757d;
}

.search-icon {
  left: 12px;
}

.clear-icon {
  right: 12px;
  cursor: pointer;
}

.clear-icon:hover {
  color: #495057;
}

.search-input {
  width: 100%;
  padding: 8px 40px;
  border: 1px solid #ced4da;
  border-radius: 4px;
  font-size: 14px;
}

.search-input:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.filters-wrapper {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 12px;
  margin-bottom: 12px;
}

.filter-item {
  display: flex;
  flex-direction: column;
}

.filter-label {
  font-size: 12px;
  color: #6c757d;
  margin-bottom: 4px;
}

.filter-input,
.filter-select {
  padding: 6px 8px;
  border: 1px solid #ced4da;
  border-radius: 4px;
  font-size: 14px;
}

.filter-input:focus,
.filter-select:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.filter-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.active-filters {
  font-size: 12px;
  color: #007bff;
}

.reset-btn {
  padding: 6px 12px;
  background-color: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
}

.reset-btn:hover {
  background-color: #5a6268;
}

.searching-indicator {
  margin-top: 8px;
  font-size: 12px;
  color: #007bff;
  text-align: center;
}
&lt;/style&gt;
</code></pre>
<hr/>
<h3 data-id="heading-24">æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-25">1. ç»„ä»¶è®¾è®¡åŸåˆ™</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- âœ… å¥½çš„å®è·µï¼šå•ä¸€èŒè´£ --&gt;
&lt;script setup&gt;
// æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªä¸»è¦åŠŸèƒ½
const value = defineModel&lt;string&gt;()

// ç®€å•çš„æ•°æ®å¤„ç†é€»è¾‘
const processedValue = computed({
  get: () =&gt; value.value?.trim() || '',
  set: (val) =&gt; value.value = val.trim()
})
&lt;/script&gt;

&lt;!-- âŒ é¿å…çš„å®è·µï¼šè¿‡åº¦å¤æ‚ --&gt;
&lt;script setup&gt;
// é¿å…åœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­å®šä¹‰å¤ªå¤šæ¨¡å‹
const model1 = defineModel('model1')
const model2 = defineModel('model2')
const model3 = defineModel('model3')
// ... å¤ªå¤šæ¨¡å‹ä¼šå¯¼è‡´ç»„ä»¶éš¾ä»¥ç»´æŠ¤
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-26">2. ç±»å‹å®‰å…¨</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- âœ… æ¨èçš„åšæ³•ï¼šå®Œæ•´çš„ç±»å‹å®šä¹‰ --&gt;
&lt;script setup lang="ts"&gt;
interface UserForm {
  name: string
  email: string
  age: number
  preferences: {
    theme: 'light' | 'dark'
    notifications: boolean
  }
}

const userForm = defineModel&lt;UserForm&gt;({
  type: Object as PropType&lt;UserForm&gt;,
  required: true,
  validator: (value: UserForm) =&gt; {
    return value.name &amp;&amp;
           value.email.includes('@') &amp;&amp;
           value.age &gt; 0
  }
})
&lt;/script&gt;

&lt;!-- âŒ ä¸æ¨èçš„åšæ³•ï¼šç¼ºå°‘ç±»å‹çº¦æŸ --&gt;
&lt;script setup&gt;
// ç¼ºå°‘ç±»å‹å®šä¹‰ï¼Œå®¹æ˜“å‡ºç°è¿è¡Œæ—¶é”™è¯¯
const data = defineModel() // ç±»å‹ä¸º unknown
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-27">3. é»˜è®¤å€¼å¤„ç†</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- âœ… æ¨èçš„åšæ³•ï¼šåˆç†çš„é»˜è®¤å€¼ --&gt;
&lt;script setup&gt;
// å¯¹äºå¤æ‚å¯¹è±¡ï¼Œä½¿ç”¨å‡½æ•°è¿”å›é»˜è®¤å€¼
const user = defineModel({
  type: Object,
  default: () =&gt; ({
    name: '',
    email: '',
    age: 0
  })
})

// å¯¹äºæ•°ç»„ï¼Œä½¿ç”¨ç©ºæ•°ç»„ä½œä¸ºé»˜è®¤å€¼
const items = defineModel({
  type: Array,
  default: () =&gt; []
})
&lt;/script&gt;

&lt;!-- âŒ é¿å…çš„åšæ³•ï¼šå¯å˜å¼•ç”¨çš„é»˜è®¤å€¼ --&gt;
&lt;script setup&gt;
// å¯èƒ½å¯¼è‡´å¤šä¸ªç»„ä»¶å®ä¾‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨
const user = defineModel({
  type: Object,
  default: { name: '', email: '' } // âŒ é”™è¯¯ï¼šå…±äº«å¼•ç”¨
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-28">4. éªŒè¯å’Œé”™è¯¯å¤„ç†</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const email = defineModel&lt;string&gt;({
  type: String,
  required: true,
  validator: (value: string) =&gt; {
    // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    return emailRegex.test(value)
  }
})

// é”™è¯¯çŠ¶æ€ç®¡ç†
const errorMessage = computed(() =&gt; {
  if (email.value &amp;&amp; !validator(email.value)) {
    return 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
  }
  return ''
})

// å®æ—¶éªŒè¯
const isValid = computed(() =&gt; {
  return !errorMessage.value
})
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="form-group"&gt;
    &lt;label&gt;é‚®ç®±:&lt;/label&gt;
    &lt;input v-model="email" type="email" /&gt;
    &lt;div v-if="errorMessage" class="error-message"&gt;
      {{ errorMessage }}
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-29">5. æ€§èƒ½ä¼˜åŒ–</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// âœ… ä½¿ç”¨è®¡ç®—å±æ€§è¿›è¡Œå¤æ‚çš„æ•°æ®å¤„ç†
const [modelValue, modelModifiers] = defineModel&lt;string&gt;()

const processedValue = computed({
  get: () =&gt; {
    let value = modelValue.value || ''

    // å¤æ‚çš„æ ¼å¼åŒ–é€»è¾‘
    if (modelModifiers.currency) {
      value = Number(value).toLocaleString('zh-CN', {
        style: 'currency',
        currency: 'CNY'
      })
    }

    return value
  },
  set: (value: string) =&gt; {
    // å¤„ç†ç”¨æˆ·è¾“å…¥
    if (modelModifiers.currency) {
      value = value.replace(/[Â¥,]/g, '')
    }

    modelValue.value = value
  }
})

// âŒ é¿å…åœ¨æ¨¡æ¿ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
&lt;template&gt;
  &lt;!-- ä¸æ¨èï¼šåœ¨æ¨¡æ¿ä¸­è¿›è¡Œå¤æ‚è®¡ç®— --&gt;
  &lt;input :value="formatCurrency(modelValue)" @input="handleInput" /&gt;

  &lt;!-- æ¨èï¼šä½¿ç”¨è®¡ç®—å±æ€§ --&gt;
  &lt;input v-model="processedValue" /&gt;
&lt;/template&gt;
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-30">å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-31">1. ä¸ºä»€ä¹ˆ defineModel ä¸å·¥ä½œï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šç»„ä»¶ä¸­ä½¿ç”¨ <code>defineModel</code> ä½†æ²¡æœ‰å“åº”å¼æ•ˆæœ</p>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>Vue ç‰ˆæœ¬ä½äº 3.3</li>
<li>æ²¡æœ‰åœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨</li>
<li>çˆ¶ç»„ä»¶æ²¡æœ‰æ­£ç¡®ç»‘å®š <code>v-model</code></li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ç¡®ä¿ä½¿ç”¨ Vue 3.3+ --&gt;
&lt;script setup&gt;
// âœ… æ­£ç¡®ä½¿ç”¨
const modelValue = defineModel()
&lt;/script&gt;

&lt;!-- çˆ¶ç»„ä»¶æ­£ç¡®ç»‘å®š --&gt;
&lt;ChildComponent v-model="data" /&gt;
&lt;!-- è€Œä¸æ˜¯ --&gt;
&lt;ChildComponent :model-value="data" /&gt; &lt;!-- âŒ ç¼ºå°‘åŒå‘ç»‘å®š --&gt;
</code></pre>
<h4 data-id="heading-32">2. å¦‚ä½•å¤„ç†é»˜è®¤å€¼çš„åŒæ­¥é—®é¢˜ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå­ç»„ä»¶è®¾ç½®äº†é»˜è®¤å€¼ï¼Œä½†çˆ¶ç»„ä»¶æ²¡æœ‰æä¾›å€¼æ—¶å‡ºç°åŒæ­¥é—®é¢˜</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// âœ… æ¨èåšæ³•ï¼šä½¿ç”¨æœ¬åœ°çŠ¶æ€ç®¡ç†é»˜è®¤å€¼
const props = defineProps({
  modelValue: String
})

const emit = defineEmits(['update:modelValue'])

// ä½¿ç”¨è®¡ç®—å±æ€§å¤„ç†é»˜è®¤å€¼
const internalValue = computed({
  get: () =&gt; props.modelValue || 'é»˜è®¤å€¼',
  set: (value) =&gt; emit('update:modelValue', value)
})

// æˆ–è€…ä½¿ç”¨ defineModel çš„ default é€‰é¡¹
const modelValue = defineModel({
  type: String,
  default: 'é»˜è®¤å€¼'
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-33">3. TypeScript ç±»å‹æ¨æ–­å¤±è´¥</h4>
<p><strong>é—®é¢˜</strong>ï¼šTypeScript æ— æ³•æ­£ç¡®æ¨æ–­ <code>defineModel</code> çš„ç±»å‹</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
// âœ… æ˜¾å¼ç±»å‹æ³¨è§£
const text = defineModel&lt;string&gt;()

interface FormData {
  name: string
  email: string
}

const formData = defineModel&lt;FormData&gt;({
  type: Object as PropType&lt;FormData&gt;
})

// âœ… ä½¿ç”¨æ³›å‹çº¦æŸ
const model = defineModel&lt;T extends string | number ? T : string&gt;({
  type: [String, Number] as PropType&lt;T&gt;
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-34">4. ä¿®é¥°ç¬¦ä¸ç”Ÿæ•ˆ</h4>
<p><strong>é—®é¢˜</strong>ï¼šè‡ªå®šä¹‰ä¿®é¥°ç¬¦æ²¡æœ‰æŒ‰é¢„æœŸå·¥ä½œ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// âœ… æ­£ç¡®ä½¿ç”¨ä¿®é¥°ç¬¦
const [modelValue, modelModifiers] = defineModel({
  // åœ¨ set å‡½æ•°ä¸­å¤„ç†ä¿®é¥°ç¬¦
  set(value) {
    if (modelModifiers.trim) {
      return value.trim()
    }
    return value
  }
})
&lt;/script&gt;

&lt;!-- ä½¿ç”¨æ—¶æ·»åŠ ä¿®é¥°ç¬¦ --&gt;
&lt;ChildComponent v-model.trim="data" /&gt;
</code></pre>
<h4 data-id="heading-35">5. å¦‚ä½•é¿å…æ— é™æ›´æ–°å¾ªç¯ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šåœ¨ getter å’Œ setter ä¸­è®¾ç½®å€¼æ—¶å¯¼è‡´æ— é™å¾ªç¯</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
const [modelValue, modelModifiers] = defineModel()

// âœ… é¿å…åœ¨ getter ä¸­ä¿®æ”¹åŸå€¼
const processedValue = computed({
  get: () =&gt; {
    // åªè¯»å–ï¼Œä¸ä¿®æ”¹
    let value = modelValue.value || ''

    if (modelModifiers.uppercase) {
      return value.toUpperCase()
    }

    return value
  },
  set: (value) =&gt; {
    // åœ¨ setter ä¸­è¿›è¡Œå®é™…ä¿®æ”¹
    let finalValue = value

    if (modelModifiers.trim) {
      finalValue = value.trim()
    }

    // ç›´æ¥è®¾ç½®ï¼Œé¿å…è§¦å‘ getter
    modelValue.value = finalValue
  }
})
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-36">ä¸ä¼ ç»Ÿæ–¹å¼çš„å¯¹æ¯”</h3>
<h4 data-id="heading-37">1. ä»£ç é‡å¯¹æ¯”</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- âŒ ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦å¤§é‡æ ·æ¿ä»£ç  --&gt;
&lt;script setup&gt;
const props = defineProps({
  modelValue: String,
  title: String,
  count: Number
})

const emit = defineEmits([
  'update:modelValue',
  'update:title',
  'update:count'
])

const value = computed({
  get: () =&gt; props.modelValue,
  set: (value) =&gt; emit('update:modelValue', value)
})

const titleValue = computed({
  get: () =&gt; props.title,
  set: (value) =&gt; emit('update:title', value)
})

const countValue = computed({
  get: () =&gt; props.count,
  set: (value) =&gt; emit('update:count', value)
})
&lt;/script&gt;

&lt;!-- âœ… defineModel æ–¹å¼ï¼šç®€æ´æ˜äº† --&gt;
&lt;script setup&gt;
const modelValue = defineModel()
const title = defineModel('title')
const count = defineModel('count')
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-38">2. ä¿®é¥°ç¬¦æ”¯æŒå¯¹æ¯”</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- âŒ ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†ä¿®é¥°ç¬¦ --&gt;
&lt;script setup&gt;
const props = defineProps({
  modelValue: String,
  modelModifiers: {
    type: Object,
    default: () =&gt; ({})
  }
})

const emit = defineEmits(['update:modelValue'])

const value = computed({
  get: () =&gt; props.modelValue,
  set: (value) =&gt; {
    if (props.modelModifiers.trim) {
      value = value.trim()
    }
    emit('update:modelValue', value)
  }
})
&lt;/script&gt;

&lt;!-- âœ… defineModel æ–¹å¼ï¼šå†…ç½®ä¿®é¥°ç¬¦æ”¯æŒ --&gt;
&lt;script setup&gt;
const [modelValue, modelModifiers] = defineModel({
  set(value) {
    if (modelModifiers.trim) {
      return value.trim()
    }
    return value
  }
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-39">3. TypeScript æ”¯æŒå¯¹æ¯”</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- âŒ ä¼ ç»Ÿæ–¹å¼ï¼šç±»å‹æ¨æ–­ä¸å¤Ÿç›´è§‚ --&gt;
&lt;script setup lang="ts"&gt;
interface Props {
  modelValue?: string
}

const props = defineProps&lt;Props&gt;()
const emit = defineEmits&lt;{
  'update:modelValue': [value: string]
}&gt;()

const value = computed&lt;string&gt;({
  get: () =&gt; props.modelValue || '',
  set: (value) =&gt; emit('update:modelValue', value)
})
&lt;/script&gt;

&lt;!-- âœ… defineModel æ–¹å¼ï¼šç±»å‹æ¨æ–­æ›´ç›´æ¥ --&gt;
&lt;script setup lang="ts"&gt;
const value = defineModel&lt;string&gt;({
  default: ''
})
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-40">æ€»ç»“</h3>
<p><code>defineModel</code> æ˜¯ Vue 3 ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ”¹è¿›ï¼Œå®ƒæ˜¾è‘—ç®€åŒ–äº†ç»„ä»¶åŒå‘æ•°æ®ç»‘å®šçš„å®ç°ã€‚é€šè¿‡æœ¬æ–‡æ¡£çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼š</p>
<h4 data-id="heading-41">æ ¸å¿ƒä¼˜åŠ¿</h4>
<ol>
<li><strong>ç®€åŒ–å¼€å‘</strong>ï¼šå¤§å¹…å‡å°‘æ ·æ¿ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šä¼˜ç§€çš„ TypeScript æ”¯æŒï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œè¿è¡Œæ—¶å¼€é”€æ›´å°</li>
<li><strong>åŠŸèƒ½ä¸°å¯Œ</strong>ï¼šå†…ç½®ä¿®é¥°ç¬¦æ”¯æŒå’Œå¤æ‚çš„é…ç½®é€‰é¡¹</li>
</ol>
<h4 data-id="heading-42">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li><strong>è¡¨å•ç»„ä»¶</strong>ï¼šè¾“å…¥æ¡†ã€é€‰æ‹©å™¨ã€æ—¥æœŸé€‰æ‹©å™¨ç­‰</li>
<li><strong>æ•°æ®å±•ç¤ºç»„ä»¶</strong>ï¼šéœ€è¦ç¼–è¾‘åŠŸèƒ½çš„æ•°æ®è¡¨æ ¼</li>
<li><strong>é…ç½®é¢æ¿</strong>ï¼šå„ç§è®¾ç½®å’Œé…ç½®ç•Œé¢</li>
<li><strong>æœç´¢ç­›é€‰</strong>ï¼šå¤æ‚çš„æœç´¢å’Œç­›é€‰ç»„ä»¶</li>
</ul>
<h4 data-id="heading-43">å­¦ä¹ å»ºè®®</h4>
<ol>
<li><strong>ä»åŸºç¡€å¼€å§‹</strong>ï¼šå…ˆæŒæ¡åŸºæœ¬çš„ <code>v-model</code> ç»‘å®š</li>
<li><strong>é€æ­¥æ·±å…¥</strong>ï¼šå­¦ä¹ ä¿®é¥°ç¬¦å’Œé«˜çº§é…ç½®</li>
<li><strong>å®è·µé¡¹ç›®</strong>ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨ <code>defineModel</code></li>
<li><strong>å¯¹æ¯”å­¦ä¹ </strong>ï¼šäº†è§£ä¼ ç»Ÿæ–¹å¼çš„å·®å¼‚ï¼Œæ›´å¥½åœ°ç†è§£ <code>defineModel</code> çš„ä¼˜åŠ¿</li>
</ol>
<h4 data-id="heading-44">æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>ç¡®ä¿ Vue ç‰ˆæœ¬ä¸º 3.3 æˆ–æ›´é«˜</li>
<li>å¿…é¡»åœ¨ <code>&lt;script setup&gt;</code> ä¸­ä½¿ç”¨</li>
<li>æ³¨æ„é»˜è®¤å€¼çš„å¤„ç†æ–¹å¼</li>
<li>åˆç†ä½¿ç”¨ TypeScript ç±»å‹çº¦æŸ</li>
</ul>
<p><code>defineModel</code> ä»£è¡¨äº† Vue.js æŒç»­æ”¹è¿›ç»„ä»¶å¼€å‘ä½“éªŒçš„åŠªåŠ›ï¼ŒæŒæ¡è¿™ä¸€ç‰¹æ€§å°†å¸®åŠ©å¼€å‘è€…æ„å»ºæ›´ç®€æ´ã€æ›´å¯ç»´æŠ¤çš„ Vue åº”ç”¨ç¨‹åºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯·æ±‚å¤±è´¥æº¯æºNettyå…³é—­è¿æ¥æºç æµç¨‹]]></title>    <link>https://juejin.cn/post/7573595009552564234</link>    <guid>https://juejin.cn/post/7573595009552564234</guid>    <pubDate>2025-11-18T02:30:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573595009552564234" data-draft-id="7573241978902249487" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯·æ±‚å¤±è´¥æº¯æºNettyå…³é—­è¿æ¥æºç æµç¨‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:30:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‡è‹±ç‹¼"/> <meta itemprop="url" content="https://juejin.cn/user/1077941042943336"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯·æ±‚å¤±è´¥æº¯æºNettyå…³é—­è¿æ¥æºç æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1077941042943336/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‡è‹±ç‹¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:30:48.000Z" title="Tue Nov 18 2025 02:30:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>proxyå®•æœºã€é‡å¯åï¼Œä¸šåŠ¡ä»ä¸æ–­æœ‰å‘½ä»¤æ‰§è¡Œå¤±è´¥é•¿å°¾ç°è±¡ï¼›ç°è±¡éå¸¸è¯¡å¼‚ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ä¸šåŠ¡éƒ½ä¼šæœ‰ä¸€ä¸ªæŠ¥é”™ï¼š<code> new RedisException("Currently not connected. Commands are rejected.");</code>
æœ¬æ–‡æ¢³ç†äº†ä¸€ä¸‹Nettyã€Lettuceçš„å…³é—­æµç¨‹æºç ï¼ŒæŠ½ä¸å‰¥èŒ§ï¼Œæ‰¾åˆ°é—®é¢˜æ ¹å› ï¼›</p>
<h2 data-id="heading-1">æ•´ä½“æµç¨‹</h2>
<p>å…ˆé™„ä¸Šæ•´ä½“çš„æ€ç»´å¯¼å›¾ï¼Œç„¶ååœ¨åˆ†æNettyã€Lettuceçš„å…³é—­è¿æ¥çš„æºç ï¼›</p>
<h3 data-id="heading-2">æ€ç»´å¯¼å›¾</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6427a6490e24de38292980c674045d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeO6Iux54u8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037848&amp;x-signature=N6wwP1Gk4kMuKUj8hhbjwvil7pg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">æºç è§£æ</h2>
<p>æ³¨ï¼š æœ¬æ–‡åŸºäºNetty 4.1.38 &amp; Lettuce 5.2.0è¿›è¡Œåˆ†æ</p>
<p>æ³¨ï¼šä¸ºä»€ä¹ˆåˆ†æçš„æ˜¯Nioæ¨¡å‹ï¼Œä¸æ˜¯åˆ†æEpollæ¨¡å‹ï¼›å› ä¸ºæˆ‘å¸é­”æ”¹çš„jdk17åç¨‹æ¨¡å‹ä»…æ”¯æŒnioï¼›</p>
<h3 data-id="heading-4">1ã€IOå…¥å£ï¼šNioByteUnsafe#read</h3>
<p>å®¢æˆ·ç«¯åˆ†æï¼š</p>
<ol>
<li>è·å–ä¸€ç³»åˆ—å¯¹è±¡ï¼šChannelConfigã€ChannelPipelineã€RecvByteBufAllocator</li>
<li>ä»Socketè¯»å–æ•°æ®ï¼Œä¿å­˜åˆ°ByteBufä¸­ï¼ˆDefaultMaxMessageRecvByteBufAllocator å…·æœ‰å¼¹æ€§æ‰©ç¼©å®¹çš„èƒ½åŠ›ï¼Œåç»­åœ¨è®¨è®ºï¼‰</li>
<li>è°ƒç”¨pipeline.channelRead()å°†è¯»å–çš„æ•°æ®å¹¿æ’­åˆ°ChannelInboundHandler</li>
<li>å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œåˆ™æœ€å¤šé€’å½’16æ¬¡ï¼Œ å¦‚æœè¿˜æ²¡æœ‰è¯»å–å®Œæˆï¼Œæ”¾åˆ°ä¸‹æ¬¡IOè¯»å–çš„æ—¶å€™ï¼Œå†è¯»ï¼›é¿å…ç”±äºæŸæ¬¡è¯·æ±‚ä½“æ¯”è¾ƒå¤§è€Œå¯¼è‡´å…¶ä»–çš„è¯·æ±‚é˜»å¡ï¼Œé€ æˆé›ªå´©å½±å“ï¼›</li>
<li>è¯»å–å®Œæˆï¼Œè°ƒç”¨channelReadComplete()</li>
<li>å½“socketè¯»å–çš„ç»“æœæ˜¯-1æ—¶ï¼Œåˆ™è¯´æ˜æœåŠ¡ç«¯æ­£åœ¨å…³é—­è¿™ä¸ªè¿æ¥ï¼ˆå‘é€FINåŒ…ï¼‰ï¼›è¿›è€Œè°ƒç”¨closeOnRead</li>
<li>é‚£ä»€ä¹ˆæ—¶å€™æŠ›å‡ºThrowableï¼Ÿ1. ä¸šåŠ¡å¼‚å¸¸ï¼Œ 2. æœåŠ¡ç«¯å¼‚å¸¸ï¼Œå‘é€äº†RSTåŒ…:</li>
</ol>
<p>æµç¨‹å¤§æ¦‚æ¸…æ¥šäº†ï¼Œé‚£æˆ‘ä»¬é‡ç‚¹éœ€è¦åˆ†æä¸‹æ­£å¸¸å…³é—­ï¼ˆFINåŒ…ï¼‰ã€å¼‚å¸¸å…³é—­ï¼ˆRSTåŒ…ï¼‰çš„æµç¨‹</p>
<pre><code class="hljs language-ini" lang="ini">public final void read() {
    final ChannelConfig <span class="hljs-attr">config</span> = config()<span class="hljs-comment">;</span>
    if (shouldBreakReadReady(config)) {
        clearReadPending()<span class="hljs-comment">;</span>
        return<span class="hljs-comment">;</span>
    }
    final ChannelPipeline <span class="hljs-attr">pipeline</span> = pipeline()<span class="hljs-comment">;</span>
    final ByteBufAllocator <span class="hljs-attr">allocator</span> = config.getAllocator()<span class="hljs-comment">;</span>
    final RecvByteBufAllocator.Handle <span class="hljs-attr">allocHandle</span> = recvBufAllocHandle()<span class="hljs-comment">;</span>
    allocHandle.reset(config)<span class="hljs-comment">;</span>

    ByteBuf <span class="hljs-attr">byteBuf</span> = null<span class="hljs-comment">;</span>
    boolean <span class="hljs-attr">close</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    try {
        do {
            <span class="hljs-attr">byteBuf</span> = allocHandle.allocate(allocator)<span class="hljs-comment">;</span>
            allocHandle.lastBytesRead(doReadBytes(byteBuf))<span class="hljs-comment">;</span>
            if (allocHandle.lastBytesRead() &lt;= 0) {
                // nothing was read. release the buffer.
                byteBuf.release()<span class="hljs-comment">;</span>
                <span class="hljs-attr">byteBuf</span> = null<span class="hljs-comment">;</span>
                <span class="hljs-attr">close</span> = allocHandle.lastBytesRead() &lt; <span class="hljs-number">0</span><span class="hljs-comment">;</span>
                if (close) {
                    // There is nothing left to read as we received an <span class="hljs-attr">EOF.
                    readPending</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
                }
                break<span class="hljs-comment">;</span>
            }

            allocHandle.incMessagesRead(1)<span class="hljs-comment">;</span>
            <span class="hljs-attr">readPending</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
            pipeline.fireChannelRead(byteBuf)<span class="hljs-comment">;</span>
            <span class="hljs-attr">byteBuf</span> = null<span class="hljs-comment">;</span>
        } while (allocHandle.continueReading())<span class="hljs-comment">;</span>

        allocHandle.readComplete()<span class="hljs-comment">;</span>
        pipeline.fireChannelReadComplete()<span class="hljs-comment">;</span>

        // é‡ç‚¹åˆ†æ
        if (close) {
            closeOnRead(pipeline)<span class="hljs-comment">;</span>
        }
    } catch (Throwable t) {
            // é‡ç‚¹åˆ†æ
        handleReadException(pipeline, byteBuf, t, close, allocHandle)<span class="hljs-comment">;</span>
    } finally {
        // Check if there is a readPending which was not processed yet.
        // This could be for two reasons:
        // * The user called Channel.read() or ChannelHandlerContext.read() in channelRead(...) method
        // * The user called Channel.read() or ChannelHandlerContext.read() in channelReadComplete(...) method
        //
        // See https://github.com/netty/netty/issues/2254
        if (!readPending &amp;&amp; !config.isAutoRead()) {
            removeReadOp()<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-5">2ã€å¼‚å¸¸å…³é—­æµç¨‹ï¼šNioByteUnsafe#handleReadException</h3>
<p>ä¸ºä»€ä¹ˆè¦å…ˆä»‹ç»å¼‚å¸¸å…³é—­ï¼Œå› ä¸ºå¼‚å¸¸å…³é—­æµç¨‹é‡Œé¢åŒ…å«æ­£å¸¸å…³é—­æµç¨‹ï¼›</p>
<ol>
<li>å¦‚æœbytebufä¸­æœ‰æ•°æ®ï¼Œé‚£æŠŠå·²ç»æ¥æ”¶çš„æ•°æ®å¹¿æ’­å‡ºå»ï¼ˆchannelReadï¼‰ï¼›</li>
<li>å†å¹¿æ’­chanelReadCompleteäº‹ä»¶</li>
<li>å†å¹¿æ’­exceptionCaughtäº‹ä»¶</li>
<li>å¦‚æœæ˜¯IOException ï¼Œåˆ™éœ€è¦å°†Sockeå…³é—­ï¼Œèµ°ä¸€ä¸‹æ­£å¸¸å…³é—­æµç¨‹ï¼›</li>
</ol>
<p>ps:åœ¨hotspotæºç ä¸­IOè¯»å–çš„æ—¶å€™ï¼šå¦‚æœè¯»å–å¤±è´¥ï¼Œåˆ†åˆ«ä¼šæŠ›å‡ºConnectionResetExceptionã€SocketExceptionã€InterruptedExceptionï¼› å…¶ä¸­ConnectionResetExceptionå’ŒSocketExceptionæ˜¯IOExceptionï¼Œ è€ŒInterruptedExceptionåˆ™æ˜¯ç”±äºè®¾ç½®äº†çº¿ç¨‹ä¸­æ–­æ ‡è¯†ï¼Œè€ŒæŠ›å‡ºçš„ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88074898ad2b45da8d4354433e3e2c2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeO6Iux54u8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037848&amp;x-signature=Dhb8GFdNTn3MDMgUIA8wU3zawgQ%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">handleReadException</span>(ChannelPipeline pipeline, ByteBuf byteBuf, Throwable cause, boolean close,
        RecvByteBufAllocator.Handle allocHandle) {
    if (byteBuf != null) {
        if (byteBuf.isReadable()) {
            readPending = false;
            pipeline<span class="hljs-selector-class">.fireChannelRead</span>(byteBuf);
        } else {
            byteBuf<span class="hljs-selector-class">.release</span>();
        }
    }
    allocHandle<span class="hljs-selector-class">.readComplete</span>();
    pipeline<span class="hljs-selector-class">.fireChannelReadComplete</span>();
    pipeline<span class="hljs-selector-class">.fireExceptionCaught</span>(cause);
    <span class="hljs-comment">// é‡ç‚¹åœ¨æ­¤</span>
    if (close || cause instanceof IOException) {
        <span class="hljs-built_in">closeOnRead</span>(pipeline);
    }
}
</code></pre>
<h3 data-id="heading-6">3ã€æ­£å¸¸å…³é—­æµç¨‹ï¼šNioByteUnsafe#closeOnRead</h3>
<ol>
<li>å¦‚æœè¾“å…¥æ²¡æœ‰å…³é—­å¹¶ä¸”æ˜¯åŠå…³é—­åŠŸèƒ½ï¼Œåˆ™ä¼šå…³é—­è¾“å…¥é€šé“ï¼ŒåŒæ—¶ä¸‹å‘ChannelInputShutdownEventäº‹ä»¶</li>
<li>å¦‚æœè¾“å…¥æ²¡æœ‰å…³é—­ï¼Œåˆ™ç›´æ¥è°ƒç”¨closeï¼Œè¿›è¡Œå…³é—­è¯¥è¿æ¥</li>
<li>å¦‚æœè¾“å…¥å·²ç»å…³é—­ï¼Œåˆ™ä¸‹å‘ä¸€ä¸ªChannelInputShutdownReadCompleteäº‹ä»¶ï¼›</li>
</ol>
<p>æ³¨ï¼šä»€ä¹ˆæ˜¯åŠå…³é—­ï¼Ÿ</p>
<p>å…ˆæ¥ä¸€å¼ TCPçš„4æ¬¡æŒ¥æ‰‹ç¤ºæ„å›¾ï¼Œä½“ä¼šä¸€ä¸‹ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bbc52551acc46269a9c8b8e01b0b8fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeO6Iux54u8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764037848&amp;x-signature=Oq0DimlQgSooBeq6Q0A2H9RrlvU%3D" alt="image.png" loading="lazy"/>
æ ¹æ®ä¸Šå›¾è§£é‡Š</p>
<ol>
<li>åœ¨TCPä¸­ï¼Œé€šä¿¡æ˜¯å…¨åŒå·¥çš„ï¼ŒåŒæ—¶å¯ä»¥è¿›è¡Œè¯»å†™ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„è¯»ã€å†™ç¼“å†²åŒºï¼›Half-Closureï¼šé€šä¿¡çš„ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥å…ˆå…³é—­è¾“å…¥æ–¹å‘ï¼Œè€Œä¿ç•™æ¥æ”¶æ–¹å‘ï¼Œç›´è‡³å¯¹æ–¹ä¹Ÿå…³é—­äº†è¿æ¥ï¼›</li>
<li>åœ¨Nettyé‡Œé¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¥æ”¶FINåŒ…ä»¥åï¼Œé»˜è®¤ä¼šå°†socketè¿›è¡Œå…³é—­ï¼›ä¹Ÿå°±æ˜¯è¯´socketçš„è¯»å†™é€šé“<strong>å…¨å…³æ‰</strong>äº†ï¼›æ²¡é”™ï¼›<strong>å…¨å…³æ‰</strong> ï¼›</li>
<li>è¿™æœ‰ç‚¹ä¸ç¬¦åˆTCPçš„4æ¬¡æŒ¥æ‰‹çš„è®¾è®¡ï¼Œå› ä¸ºæœ‰å¯èƒ½æœ‰ä¸€ç«¯(Cç«¯)ä¸»åŠ¨å‘èµ·äº†FINåŒ…ï¼Œå¦ä¸€ç«¯ï¼ˆSç«¯ï¼‰æ¥æ”¶åˆ°FINåŒ…ï¼Œå›ACKåŒ…ä»¥åï¼›Sç«¯æ˜¯å¯ä»¥ç»§ç»­å‘é€å†™è¯·æ±‚çš„ï¼Œå› ä¸ºSç«¯è¿˜æ²¡æœ‰ä¸»åŠ¨å‘FINåŒ…ï¼›</li>
<li>å¦‚æœåœ¨Nettyé‡Œé¢æƒ³è¦å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œ å°±éœ€è¦è¿›è¡Œé…ç½®ï¼›<code>bootstrap.childOption(ChannelOption.ALLOW_HALF_CLOSURE, true)</code>ï¼›</li>
</ol>
<p>ä½†æ˜¯åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œéƒ½ä¸éœ€è¦åŠå…³é—­åŠŸèƒ½ï¼Œæ‰€ä»¥ç›´æ¥ç²—æš´ã€ç®€å•ä¸€äº›ï¼Œä¸€æ—¦ä¸€æ–¹å‘é€FINåŒ…ï¼Œé‚£å¦ä¸€æ–¹æ‹’ç»æ‰€æœ‰çš„è¯»å†™è¯·æ±‚ï¼›ç›´æ¥close socketï¼›</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">closeOnRead</span>(ChannelPipeline pipeline) {
    if (!isInputShutdown0()) {
        if (isAllowHalfClosure(config())) {
            <span class="hljs-built_in">shutdownInput</span>();
            pipeline<span class="hljs-selector-class">.fireUserEventTriggered</span>(ChannelInputShutdownEvent.INSTANCE);
        } else {
            <span class="hljs-built_in">close</span>(voidPromise());
        }
    } else {
        inputClosedSeenErrorOnRead = true;
        pipeline<span class="hljs-selector-class">.fireUserEventTriggered</span>(ChannelInputShutdownReadComplete.INSTANCE);
    }
}
</code></pre>
<h4 data-id="heading-7">3.1 å¦‚ä½•å…³é—­ï¼ŸNioByteUnsafe.close</h4>
<p>io.netty.channel.AbstractChannel.AbstractUnsafe#close</p>
<ol>
<li>å¦‚æœpromiseä¸æ˜¯VoidChannelPromiseï¼Œç›´æ¥è¿”å›ï¼Œé¿å…è¯¯åˆ¤ï¼›</li>
<li>å¦‚æœå·²ç»closeè¿‡äº†ï¼Œåˆ™æ ¹æ®futureçš„ç»“æœåˆ¤æ–­ï¼Œæ˜¯ç›´æ¥å›å¡«ï¼Œè¿˜æ˜¯æ·»åŠ listenerï¼Œåœ¨æœªæ¥å›å¡«</li>
<li>ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ï¼ŒcloseInitiated=falseï¼Œæ‰€ä»¥ä¼šèµ°ä¸‹é¢é€»è¾‘ï¼›</li>
<li>å…ˆåˆ¤æ–­activeçŠ¶æ€ï¼Œ</li>
<li>å¦‚æœsolinger&gt;0ï¼Œ åˆ™ä¼šå°†SelectionKeyä»selectorè¿›è¡Œcancelæ‰ï¼›ç”±äºsolingerçš„ç‰¹æ®Šæ€§ï¼Œåœ¨shutdownå‰ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥ä¼šæœ‰é˜»å¡çš„é£é™©ï¼ŒåŸºäºæ­¤ï¼Œä¼šå°†closeçš„æµç¨‹æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œ</li>
<li>closeæµç¨‹å°±æ˜¯è°ƒç”¨socket.close()ã€promoiseç»“æœå›å¡«</li>
<li>å¦‚æœoutboundBufferä¸ä¸ºç©ºï¼ŒæŠŠflushedå’Œunflushedé˜Ÿåˆ—ä¸­çš„æ•°æ®éƒ½æ¸…ç©ºï¼›</li>
<li>è°ƒç”¨fireChannelInactiveAndDeregisteræ–¹æ³•ï¼Œä¸‹å‘channelInactiveäº‹ä»¶å’ŒchannelDeregisteräº‹ä»¶</li>
</ol>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ChannelPromise promise, <span class="hljs-keyword">final</span> Throwable cause,
                   <span class="hljs-keyword">final</span> ClosedChannelException closeCause, <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> notify)</span> {
    <span class="hljs-keyword">if</span> (!promise.setUncancellable()) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (closeInitiated) {
        <span class="hljs-keyword">if</span> (closeFuture.isDone()) {
            <span class="hljs-comment">// Closed already.</span>
            safeSetSuccess(promise);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(promise <span class="hljs-keyword">instanceof</span> VoidChannelPromise)) { <span class="hljs-comment">// Only needed if no VoidChannelPromise.</span>
            <span class="hljs-comment">// This means close() was called before so we just register a listener and return</span>
            closeFuture.addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelFutureListener</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operationComplete</span><span class="hljs-params">(ChannelFuture future)</span> <span class="hljs-keyword">throws</span> Exception {
                    promise.setSuccess();
                }
            });
        }
        <span class="hljs-keyword">return</span>;
    }

    closeInitiated = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">wasActive</span> <span class="hljs-operator">=</span> isActive();
    <span class="hljs-keyword">final</span> <span class="hljs-type">ChannelOutboundBuffer</span> <span class="hljs-variable">outboundBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.outboundBuffer;
    <span class="hljs-built_in">this</span>.outboundBuffer = <span class="hljs-literal">null</span>; <span class="hljs-comment">// Disallow adding any messages and flushes to outboundBuffer.</span>
    <span class="hljs-type">Executor</span> <span class="hljs-variable">closeExecutor</span> <span class="hljs-operator">=</span> prepareToClose();
    <span class="hljs-keyword">if</span> (closeExecutor != <span class="hljs-literal">null</span>) {
        closeExecutor.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// Execute the close.</span>
                    doClose0(promise);
                } <span class="hljs-keyword">finally</span> {
                    <span class="hljs-comment">// Call invokeLater so closeAndDeregister is executed in the EventLoop again!</span>
                    invokeLater(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                            <span class="hljs-keyword">if</span> (outboundBuffer != <span class="hljs-literal">null</span>) {
                                <span class="hljs-comment">// Fail all the queued messages</span>
                                outboundBuffer.failFlushed(cause, notify);
                                outboundBuffer.close(closeCause);
                            }
                            fireChannelInactiveAndDeregister(wasActive);
                        }
                    });
                }
            }
        });
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// Close the channel and fail the queued messages in all cases.</span>
            doClose0(promise);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (outboundBuffer != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// Fail all the queued messages.</span>
                outboundBuffer.failFlushed(cause, notify);
                outboundBuffer.close(closeCause);
            }
        }
        <span class="hljs-keyword">if</span> (inFlush0) {
            invokeLater(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    fireChannelInactiveAndDeregister(wasActive);
                }
            });
        } <span class="hljs-keyword">else</span> {
            fireChannelInactiveAndDeregister(wasActive);
        }
    }
}
</code></pre>
<h4 data-id="heading-8">3.2 channelInactiveäº‹ä»¶ä¼ æ’­</h4>
<p>åœ¨Lettuce SDKä¸­ï¼Œä¸»è¦çš„ChannelHandlerä¸»è¦æœ‰ï¼šCommandHandlerã€CommandEncoderã€ConnectionEventTriggerã€ConnectionWatchDogï¼Œ åˆ†åˆ«ä»‹ç»ä¸€ä¸‹è¿™å››ä¸ªChannelHandlerçš„åŠŸèƒ½ï¼›</p>
<ol>
<li>CommandHandlerï¼šä¸»è¦æ˜¯ç”¨äºè§£ç  ï¼› <strong>é‡ç‚¹</strong></li>
<li>CommandEncoderï¼šå°†redisåŠ å¯†æˆRESPæ ¼å¼çš„æ•°æ®</li>
<li>ConnectionEventTriggerï¼šè¿æ¥äº‹ä»¶çš„è§¦å‘å™¨ï¼Œç”¨äºè®¾ç½®åœ¨è¿æ¥å„ä¸ªçŠ¶æ€çš„å›è°ƒé’©å­ï¼›<strong>é‡ç‚¹</strong></li>
<li>ConnectionWatchDogï¼šé‡è¿å™¨</li>
</ol>
<h5 data-id="heading-9">3.2.1 CommandHandler#channelInactive</h5>
<ol>
<li>è®¾ç½®å½“å‰çš„CommandHandlerçŠ¶æ€ä¸ºDEACTIVATING</li>
<li>è§¦å‘DefaultEndPointçš„channelInactiveã€drainQueuedCommands <strong>é‡ç‚¹</strong></li>
<li>é‡ç½®RedisStateMachineçŠ¶æ€æœºï¼›</li>
</ol>

<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">channelInactive</span>(ChannelHandlerContext ctx) throws Exception {

    if (debugEnabled) {
        logger<span class="hljs-selector-class">.debug</span>("{} channelInactive()", <span class="hljs-built_in">logPrefix</span>());
    }

    if (channel != null &amp;&amp; ctx.channel() != channel) {
        logger<span class="hljs-selector-class">.debug</span>("{} My channel and ctx.channel mismatch. Propagating event to other listeners.", logPrefix());
        super<span class="hljs-selector-class">.channelInactive</span>(ctx);
        return;
    }

    tracedEndpoint = null;
    <span class="hljs-built_in">setState</span>(LifecycleState.DISCONNECTED);
    <span class="hljs-built_in">setState</span>(LifecycleState.DEACTIVATING);

    endpoint<span class="hljs-selector-class">.notifyChannelInactive</span>(ctx.channel());
    endpoint<span class="hljs-selector-class">.notifyDrainQueuedCommands</span>(this);

    <span class="hljs-built_in">setState</span>(LifecycleState.DEACTIVATED);

    PristineFallbackCommand command = this<span class="hljs-selector-class">.fallbackCommand</span>;
    if (isProtectedMode(command)) {
        <span class="hljs-built_in">onProtectedMode</span>(command.getOutput()<span class="hljs-selector-class">.getError</span>());
    }

    rsm<span class="hljs-selector-class">.reset</span>();

    if (debugEnabled) {
        logger<span class="hljs-selector-class">.debug</span>("{} channelInactive() done", <span class="hljs-built_in">logPrefix</span>());
    }

    super<span class="hljs-selector-class">.channelInactive</span>(ctx);
}
</code></pre>
<h6 data-id="heading-10">3.2.1.1DefaultEndPoint#channelInactive</h6>
<ol>
<li>åˆ¤æ–­æ˜¯å¦å·²ç»close</li>
<li>æ’å®ƒé”ä¸‹å‘deactivatedäº‹ä»¶ï¼Œå°†StatefulRedisConnectionImplçš„çŠ¶æ€è®¾ç½®ä¸ºdeactivatedï¼Œé¿å…è¿æ¥å†ç”¨</li>
<li>å°†channelè®¾ç½®ä¸ºnull <strong>é‡ç‚¹</strong></li>
</ol>

<pre><code class="hljs language-ini" lang="ini">public void notifyChannelInactive(Channel channel) {

    if (isClosed()) {
        RedisException <span class="hljs-attr">closed</span> = new RedisException(<span class="hljs-string">"Connection closed"</span>)<span class="hljs-comment">;</span>
        cancelCommands("Connection closed", drainCommands(), it -&gt; it.completeExceptionally(closed))<span class="hljs-comment">;</span>
    }

    sharedLock.doExclusive(() -&gt; {

        if (debugEnabled) {
            logger.debug("{} deactivating endpoint handler", logPrefix())<span class="hljs-comment">;</span>
        }

        connectionFacade.deactivated()<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    if (<span class="hljs-attr">this.channel</span> == channel) {
        <span class="hljs-attr">this.channel</span> = null<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h5 data-id="heading-11">3.2.2 ConnectionEventTrigger#channelInactive</h5>
<ol>
<li>åœ¨connectionEventsä¸­å¹¿æ’­redisOnDisconnectedäº‹ä»¶ï¼Œå› ä¸ºConnectionEventsé‡Œé¢ä¼šæ³¨å†ŒRedisConnectionStateListenerï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šæ˜¯ç»™RedisConnectionStateListenerè¿›è¡Œä¸‹å‘redisonDisconnectedäº‹ä»¶</li>
<li>åŒæ—¶åœ¨eventBusä¸­ä¹Ÿå¹¿æ’­ConnectionDeactivatedEventäº‹ä»¶</li>
</ol>

<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">channelInactive</span>(ChannelHandlerContext ctx) throws Exception {
    connectionEvents<span class="hljs-selector-class">.fireEventRedisDisconnected</span>(connection);
    eventBus<span class="hljs-selector-class">.publish</span>(new ConnectionDeactivatedEvent(local(ctx), <span class="hljs-built_in">remote</span>(ctx)));
    super<span class="hljs-selector-class">.channelInactive</span>(ctx);
}
</code></pre>
<h2 data-id="heading-12">é—®é¢˜æº¯æº</h2>
<p>æºç æµç¨‹åˆ†æå®Œæˆï¼Œ è¿™ä¸ªé—®é¢˜å…¶å®å°±é€æ¸æµ®å‡ºæ°´é¢äº†ï¼›
å…ˆä»é—®é¢˜ç‚¹å‡ºå‘</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">validateWrite</span><span class="hljs-params">(<span class="hljs-type">int</span> commands)</span> </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isClosed</span>()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RedisException</span>(<span class="hljs-string">"Connection is closed"</span>);
    }
    ......

    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isConnected</span>() &amp;&amp; rejectCommandsWhileDisconnected) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RedisException</span>(<span class="hljs-string">"Currently not connected. Commands are rejected."</span>);
    }
}
</code></pre>
<ol>
<li>isClosed()æ–¹æ³•ï¼šåªæœ‰è°ƒç”¨äº†closeAsyncæ–¹æ³•ï¼Œæ‰ä¼šå°†closeæ ‡è¯†ç½®ä¸ºtrueï¼›æ²¡æœ‰èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜å½“å‰DefaultEndPointå¯¹è±¡è¿˜æ²¡æœ‰è°ƒç”¨closeæ–¹æ³•ï¼›</li>
<li>isConnected()çš„åˆ¤æ–­é€»è¾‘ï¼šå¦‚æœchannel==null æˆ–è€…channel is inactiveï¼Œå°±è¯´æ˜disConnectedï¼Œå°±ä¼šæŠ›å‡º<code>Currently not connected , Commands are rejected</code></li>
<li>æ ¹æ®3.1å’Œ3.2.1.1çš„æºç å¯ä»¥äº†è§£åˆ°ï¼Œchannelç½®ä¸ºnullæ˜¯åœ¨CommandHandleræ•è·åˆ°channelInactiveäº‹ä»¶ä»¥åè¿›è¡Œæ“ä½œçš„ï¼›channel is inactive æ˜¯socket.close() ä»¥åè§¦å‘çš„ï¼›</li>
</ol>
<p>äº†è§£åˆ°é—®é¢˜äº§ç”Ÿçš„æºå¤´ï¼›é‚£å†å›å¤´æ¥çœ‹ä¸ºä»€ä¹ˆchannel=nullä»¥åï¼Œæ²¡æœ‰è°ƒç”¨ConnectionEventTrigger#channelInactiveè¿›è¡Œæ–­è¿å›è°ƒå‘¢ï¼Ÿ å›å»çœ‹äº†ä¸€ä¸‹ï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç ï¼Œæˆ‘ä»¬æ³¨å†Œäº†RedisConnectionStateListener, ä½†æ˜¯åœ¨onRedisDisconnectedäº‹ä»¶çš„å®ç°ä¸­æœ‰ç¼ºé™·ï¼Œå¯¼è‡´è¿™ä¸ªBugï¼›</p>
<h2 data-id="heading-13">æ€»ç»“</h2>
<ol>
<li>æºç æ˜¯è¿›æ­¥çš„æºæ³‰ï¼Œä¼˜é›…æ°¸ä¸è¿‡æ—¶</li>
<li>Nettyå°†ç½‘ç»œå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œéƒ½ä¼šä¼ æ’­ç‰¹å®šçš„äº‹ä»¶ï¼Œå½¢æˆå®Œæ•´çš„è¿½è¸ªé“¾ï¼›è¿™æ ·ä¹Ÿæ–¹ä¾¿é—®é¢˜å®šä½ï¼Œå€¼å¾—å€Ÿé‰´ï¼›</li>
<li>åœ¨äº‹ä»¶å¾ªç¯+å¼‚æ­¥å¤„ç†ä¸­ï¼Œä¸è¦æœ‰é˜»å¡æ€§äº‹ä»¶ï¼Œä¸ç„¶ä¼šå¯¼è‡´é›ªå´©æ•ˆåº”</li>
<li>äº‹ä»¶å›è°ƒåœ¨å¼‚æ­¥å¤„ç†ä¸­éšå¤„å¯è§ï¼Œé€šè¿‡å›è°ƒé’©å­æ¥æ„ŸçŸ¥äº‹ä»¶çš„å˜åŒ–ï¼ˆè¯¸å¦‚ï¼šChannelHandlerã€redisä¸­çš„RedisConnectionStateListenerï¼‰</li>
<li>åº•å±‚çŸ¥è¯†å¿…é¡»å¤¯å®ï¼ŒçŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ ï¼ˆTCPå››æ¬¡æ¡æ‰‹ã€JVMæºç ã€ solingerã€ halfClosureï¼‰</li>
</ol>
<h2 data-id="heading-14">å‚çœ‹ç½‘å€</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2MzU3Mjc3Ng%3D%3D%26mid%3D2247485060%26idx%3D1%26sn%3D736360af6eb3a4db496de2d6665ebd3c%26chksm%3Dce77c0c3f90049d5e44692c2cf837e8d85bb28758b243d505c43c48ce703da1edadfc19360b1%26cur_album_id%3D2217816582418956300%26scene%3D190%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg2MzU3Mjc3Ng==&amp;mid=2247485060&amp;idx=1&amp;sn=736360af6eb3a4db496de2d6665ebd3c&amp;chksm=ce77c0c3f90049d5e44692c2cf837e8d85bb28758b243d505c43c48ce703da1edadfc19360b1&amp;cur_album_id=2217816582418956300&amp;scene=190#rd" ref="nofollow noopener noreferrer"># æˆ‘ä¸º Netty è´¡çŒ®æºç  | ä¸”çœ‹ Netty å¦‚ä½•åº”å¯¹ TCP è¿æ¥çš„æ­£å¸¸å…³é—­ï¼Œå¼‚å¸¸å…³é—­ï¼ŒåŠå…³é—­åœºæ™¯</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cocos Creator 3.8 å®ç°æŒ‡å®šNodeèŠ‚ç‚¹æˆªå›¾åŠŸèƒ½æ•™ç¨‹]]></title>    <link>https://juejin.cn/post/7573588675637100559</link>    <guid>https://juejin.cn/post/7573588675637100559</guid>    <pubDate>2025-11-18T02:03:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675637100559" data-draft-id="7573594825317105704" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cocos Creator 3.8 å®ç°æŒ‡å®šNodeèŠ‚ç‚¹æˆªå›¾åŠŸèƒ½æ•™ç¨‹"/> <meta itemprop="keywords" content="Cocos Creator,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:03:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŠ±æ‰¬ç¨‹åº"/> <meta itemprop="url" content="https://juejin.cn/user/905653313620472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cocos Creator 3.8 å®ç°æŒ‡å®šNodeèŠ‚ç‚¹æˆªå›¾åŠŸèƒ½æ•™ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653313620472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŠ±æ‰¬ç¨‹åº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:03:22.000Z" title="Tue Nov 18 2025 02:03:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Cocos Creator 3.8 å®ç°æŒ‡å®šNodeèŠ‚ç‚¹æˆªå›¾åŠŸèƒ½æ•™ç¨‹</h2>
<h3 data-id="heading-1">ä¸€ã€å‰è¨€</h3>
<p>åœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œæˆªå›¾åŠŸèƒ½æ˜¯ä¸€é¡¹å¸¸è§ä¸”å®ç”¨çš„éœ€æ±‚ï¼Œå®ƒå¯ä»¥ç”¨äºç”Ÿæˆåˆ†äº«å›¾ç‰‡ã€ä¿å­˜æ¸¸æˆæˆå°±æˆ–åˆ›å»ºé¢„è§ˆå›¾ç­‰ã€‚æœ¬æ•™ç¨‹å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Cocos Creator 3.8 ä¸­å®ç°æŒ‡å®š Node èŠ‚ç‚¹çš„æˆªå›¾åŠŸèƒ½ï¼Œå¹¶å°†ç»“æœæ¸²æŸ“åˆ° Sprite ä¸Šã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€åŠŸèƒ½å®ç°åŸç†</h3>
<p>æˆªå›¾åŠŸèƒ½çš„æ ¸å¿ƒåŸç†æ˜¯åˆ©ç”¨ Cocos Creator çš„ Camera ç»„ä»¶å’Œ RenderTextureï¼ˆæ¸²æŸ“çº¹ç†ï¼‰ã€‚Camera ä¼šå°†æŒ‡å®šèŠ‚ç‚¹çš„å†…å®¹æ¸²æŸ“åˆ° RenderTexture ä¸Šï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä» RenderTexture ä¸­è¯»å–åƒç´ æ•°æ®ï¼Œæœ€ç»ˆå°†å…¶è½¬æ¢ä¸ºå›¾ç‰‡æˆ–æ˜¾ç¤ºåœ¨ UI ä¸Š</p>
<h4 data-id="heading-3">å…³é”®ç»„ä»¶ï¼š</h4>
<ul>
<li><strong>Camera</strong>ï¼šè´Ÿè´£æ•è·èŠ‚ç‚¹è§†è§‰å†…å®¹</li>
<li><strong>RenderTexture</strong>ï¼šä½œä¸ºæ¸²æŸ“ç›®æ ‡ï¼Œå­˜å‚¨å›¾åƒæ•°æ®</li>
<li><strong>SpriteFrame</strong>ï¼šå°†æ¸²æŸ“çº¹ç†è½¬æ¢ä¸ºå¯æ˜¾ç¤ºçš„ç²¾çµå¸§</li>
</ul>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€åœºæ™¯é…ç½®æ­¥éª¤</h3>
<h4 data-id="heading-5">1. é…ç½®ç›®æ ‡èŠ‚ç‚¹</h4>
<ul>
<li>å°†éœ€è¦æˆªå›¾çš„èŠ‚ç‚¹è¿æ¥åˆ°è„šæœ¬çš„targetNodeå±æ€§</li>
<li>è‡ªå®šä¹‰ä¸€ä¸ª<code>capture</code>layer, å¹¶å°†ç›®æ ‡èŠ‚ç‚¹çš„layerè®¾ç½®ä¸º<code>capture</code>ï¼ŒåŒæ—¶ä¸»ç›¸æœºçš„<code>Visibility</code>ä¹Ÿéœ€è¦æ·»åŠ è¯¥layer</li>
<li>ç¡®ä¿èŠ‚ç‚¹åœ¨ç›¸æœºèŒƒå›´å†…å¯è§</li>
<li/>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36389a7ee3454172bd2652b438b036be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqx5oms56iL5bqP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764036201&amp;x-signature=TFF3HdCw1cmwLCrdkIGt0e5QonM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">2. è®¾ç½®é¢„è§ˆèŠ‚ç‚¹ï¼š</h4>
<ul>
<li>åˆ›å»ºä¸€ä¸ªUIèŠ‚ç‚¹å¹¶æ·»åŠ Spriteç»„ä»¶</li>
<li>å°†è¿™ä¸ªèŠ‚ç‚¹è¿æ¥åˆ°è„šæœ¬çš„previewNodeå±æ€§</li>
</ul>
<h4 data-id="heading-7">3. åˆ›å»ºæˆªå›¾ä¸“ç”¨ç›¸æœºï¼š</h4>
<ul>
<li>åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸­æ·»åŠ ä¸€ä¸ªæ–°CameraèŠ‚ç‚¹ï¼Œåˆ›å»ºåˆ°ç›®æ ‡èŠ‚ç‚¹å¯ä»¥ä¿è¯èŠ‚ç‚¹ç§»åŠ¨çš„æ—¶å€™ç›¸æœºä¼šè·Ÿéšç§»åŠ¨</li>
<li>è°ƒæ•´ç›¸æœºä½ç½®å’Œå‚æ•°ï¼Œä½¿å…¶èƒ½å®Œæ•´çœ‹åˆ°ç›®æ ‡èŠ‚ç‚¹</li>
<li>å°†ç›¸æœºç»„ä»¶çš„Target Textureå±æ€§ç•™ç©ºï¼ˆä»£ç ä¸­åŠ¨æ€è®¾ç½®ï¼‰</li>
<li>å¹¶å°†ç›¸æœºç»„ä»¶çš„<code>Visibility</code>è®¾ç½®ä¸º<code>capture</code>è¿™ä¸€ä¸ªï¼Œä¿è¯æœ€ç»ˆæˆªå›¾çš„åªæ˜¾ç¤ºæƒ³è¦çš„å†…å®¹</li>
</ul>
<h4 data-id="heading-8">èŠ‚ç‚¹æˆªå›¾é¢„è§ˆ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6457137ba3b4732b416c685021755da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqx5oms56iL5bqP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764036201&amp;x-signature=gxLCXjfh%2BWKAsy2%2BT%2BZVIQ73SbQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9">ç›¸æœºå‚æ•°æˆªå›¾é¢„è§ˆ</h4>
<h3 data-id="heading-10"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c32350cc1aa460ca68163254c7a07f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqx5oms56iL5bqP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764036201&amp;x-signature=jND2cfKFrkUJRIDSu0sBOmfAHws%3D" alt="" loading="lazy"/></h3>
<h3 data-id="heading-11">å››ã€æ ¸å¿ƒä»£ç </h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3198eed9790a42a1a54b3918d900c59e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqx5oms56iL5bqP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764036201&amp;x-signature=1pHz3dZqt0ZhiR3jpYzshooL%2Fj8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">éœ€è¦æ³¨æ„çš„é—®é¢˜</h4>
<ol>
<li><strong>å›¾åƒç¼©æ”¾é—®é¢˜</strong>
<ul>
<li>æœ€ç»ˆçš„å®½é«˜è®¡ç®—éœ€è¦æ³¨æ„ç¼©æ”¾çš„é—®é¢˜</li>
</ul>
</li>
<li><strong>æˆªå›¾ç©ºç™½æˆ–ä¸å…¨çš„é—®é¢˜</strong>
<ul>
<li>ç›¸æœºçš„orthoHeight è®¾ç½®ä¸ºé«˜åº¦çš„ä¸€åŠ(æˆªå›¾ä»£ç å†™çš„æ˜¯å®½åº¦ä¸€åŠåªæœ‰æ­£æ–¹å½¢çš„æ‰ä¸ä¼šæœ‰é—®é¢˜ï¼Œå·²æ›´æ­£)</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">äº”ã€æ³¨æ„äº‹é¡¹ä¸ä¼˜åŒ–å»ºè®®</h3>
<ol>
<li>
<p><strong>å›¾åƒç¿»è½¬é—®é¢˜</strong></p>
<ul>
<li>Cocos Creatoræ¸²æŸ“çš„å›¾åƒæ•°æ®æ˜¯å€’ç½®çš„ï¼Œéœ€è¦é€šè¿‡ä»£ç æ‰‹åŠ¨ç¿»è½¬</li>
</ul>
</li>
<li>
<p><strong>æ¸²æŸ“æ—¶æœº</strong></p>
<ul>
<li>ä½¿ç”¨scheduleOnceå»¶è¿Ÿè¯»å–åƒç´ æ•°æ®ï¼Œç¡®ä¿æ¸²æŸ“å®Œæˆåå†è¿›è¡Œè¯»å–æ“ä½œ</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PerformanceObserver æ€§èƒ½æ¡ç›®ç±»å‹ï¼ˆEntry Typesï¼‰]]></title>    <link>https://juejin.cn/post/7573588675637313551</link>    <guid>https://juejin.cn/post/7573588675637313551</guid>    <pubDate>2025-11-18T02:27:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675637313551" data-draft-id="7573530680887377954" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PerformanceObserver æ€§èƒ½æ¡ç›®ç±»å‹ï¼ˆEntry Typesï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-18T02:27:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°‘å¿"/> <meta itemprop="url" content="https://juejin.cn/user/26044010879709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PerformanceObserver æ€§èƒ½æ¡ç›®ç±»å‹ï¼ˆEntry Typesï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044010879709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°‘å¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:27:21.000Z" title="Tue Nov 18 2025 02:27:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>PerformanceObserver</code> æ˜¯ Web æ€§èƒ½ç›‘æµ‹çš„æ ¸å¿ƒ APIï¼Œé€šè¿‡æŒ‡å®š <code>entryTypes</code> å¯ä»¥è§‚å¯Ÿä¸åŒç±»å‹çš„æ€§èƒ½æŒ‡æ ‡ã€‚ä»¥ä¸‹æ˜¯æ‰€æœ‰æ”¯æŒçš„æ¡ç›®ç±»å‹åŠå…¶è¯¦ç»†è¯´æ˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒ Entry Types åˆ—è¡¨</h2>
<h3 data-id="heading-1">1.Â  <strong><code>'navigation'</code></strong> Â â€” é¡µé¢å¯¼èˆªæ€§èƒ½</h3>
<p><strong>è¯´æ˜</strong>ï¼šæµ‹é‡ä¸»æ–‡æ¡£çš„å¯¼èˆªå’ŒåŠ è½½æ—¶é—´ï¼Œæä¾›å®Œæ•´çš„é¡µé¢åŠ è½½ç”Ÿå‘½å‘¨æœŸæ•°æ®ã€‚</p>
<p><strong>å¸¸ç”¨æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>entry.duration</code>ï¼šæ€»åŠ è½½æ—¶é—´</li>
<li><code>entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart</code>ï¼šDOM è§£ææ—¶é—´</li>
<li><code>entry.loadEventEnd - entry.loadEventStart</code>ï¼šèµ„æºåŠ è½½æ—¶é—´</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šåˆ†æé¡µé¢æ•´ä½“åŠ è½½æ€§èƒ½ï¼Œè®¡ç®— DNSã€TCPã€TTFB ç­‰å…³é”®æŒ‡æ ‡</p>
<h3 data-id="heading-2">2.Â  <strong><code>'resource'</code></strong> Â â€” èµ„æºåŠ è½½æ€§èƒ½</h3>
<p><strong>è¯´æ˜</strong>ï¼šæµ‹é‡é¡µé¢ä¸Šæ‰€æœ‰èµ„æºçš„åŠ è½½æ—¶é—´ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€CSSã€JavaScriptã€XHR/Fetch è¯·æ±‚ç­‰ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.name</code>ï¼šèµ„æº URL</li>
<li><code>entry.initiatorType</code>ï¼šèµ„æºç±»å‹ï¼ˆ<code>img</code>, <code>script</code>, <code>link</code>, <code>xmlhttprequest</code>, <code>fetch</code>ï¼‰</li>
<li><code>entry.duration</code>ï¼šåŠ è½½è€—æ—¶</li>
<li><code>entry.decodedBodySize</code>ï¼šèµ„æºå¤§å°</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå®šä½æ…¢èµ„æºã€ç›‘æ§ CDN æ•ˆæœã€ä¼˜åŒ–èµ„æºåŠ è½½ç­–ç•¥</p>
<h3 data-id="heading-3">3.Â  <strong><code>'paint'</code></strong> Â â€” æ¸²æŸ“æ€§èƒ½</h3>
<p><strong>è¯´æ˜</strong>ï¼šæµ‹é‡å…³é”®æ¸²æŸ“æ—¶é—´ç‚¹ï¼Œä¸»è¦ç”¨äº <strong>FCP</strong>ï¼ˆé¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼‰ã€‚</p>
<p><strong>äº‹ä»¶åç§°</strong>ï¼š</p>
<ul>
<li><code>entry.name === 'first-contentful-paint'</code>ï¼šFCP æ—¶é—´</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šCore Web Vitals æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§</p>
<h3 data-id="heading-4">4.Â  <strong><code>'largest-contentful-paint'</code></strong> Â â€” æœ€å¤§å†…å®¹ç»˜åˆ¶</h3>
<p><strong>è¯´æ˜</strong>ï¼šä½œä¸ºç‹¬ç«‹æ¡ç›®ç±»å‹æä¾›æ›´ç²¾ç¡®çš„ <strong>LCP</strong> æ•°æ®ï¼ŒåŒ…å«è¯¦ç»†çš„å…ƒç´ ä¿¡æ¯ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.startTime</code>ï¼šLCP å‘ç”Ÿæ—¶é—´</li>
<li><code>entry.element</code>ï¼šè§¦å‘ LCP çš„ DOM å…ƒç´ </li>
<li><code>entry.url</code>ï¼šå›¾ç‰‡èµ„æºçš„ URLï¼ˆå¦‚é€‚ç”¨ï¼‰</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç²¾å‡†å®šä½å½±å“ LCP çš„å…ƒç´ ï¼Œä¼˜åŒ–æœ€å¤§å†…å®¹åŠ è½½</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>((<span class="hljs-keyword">list</span>) =&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">entry</span> of <span class="hljs-keyword">list</span>.<span class="hljs-title function_ invoke__">getEntries</span>()) {
    console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">' LCP è¯¦æƒ…:'</span>, {
      <span class="hljs-attr">time</span>: entry.startTime.<span class="hljs-title function_ invoke__">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'ms'</span>,
      <span class="hljs-attr">element</span>: entry.element?.tagName,
      <span class="hljs-attr">url</span>: entry.url
    });
  }
});
observer.<span class="hljs-title function_ invoke__">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'largest-contentful-paint'</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-5">5.Â  <strong><code>'first-input'</code></strong> Â â€” é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ</h3>
<p><strong>è¯´æ˜</strong>ï¼šæµ‹é‡ç”¨æˆ·é¦–æ¬¡äº¤äº’ï¼ˆç‚¹å‡»ã€è§¦æ‘¸ã€æŒ‰é”®ï¼‰åˆ°æµè§ˆå™¨å“åº”çš„å»¶è¿Ÿæ—¶é—´ï¼Œæ˜¯ <strong>Core Web Vitals</strong> æ ¸å¿ƒæŒ‡æ ‡ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.name</code>ï¼šäº¤äº’ç±»å‹ï¼ˆ<code>click</code>, <code>pointerdown</code>, <code>keydown</code>ï¼‰</li>
<li><code>entry.duration</code>ï¼šæ€»å»¶è¿Ÿæ—¶é—´</li>
<li><code>entry.processingStart</code> / <code>entry.processingEnd</code>ï¼šäº‹ä»¶å¤„ç†æ—¶é—´</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šè¯„ä¼°ç”¨æˆ·å¯¹åº”ç”¨å“åº”æ€§çš„ç¬¬ä¸€å°è±¡</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>((<span class="hljs-keyword">list</span>) =&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">entry</span> of <span class="hljs-keyword">list</span>.<span class="hljs-title function_ invoke__">getEntries</span>()) {
    console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'é¦–æ¬¡äº¤äº’å»¶è¿Ÿ:'</span>, {
      <span class="hljs-attr">type</span>: entry.name,
      <span class="hljs-attr">delay</span>: entry.duration + <span class="hljs-string">'ms'</span>
    });
  }
});
observer.<span class="hljs-title function_ invoke__">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'first-input'</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-6">6.Â  <strong><code>'layout-shift'</code></strong> Â â€” å¸ƒå±€åç§»ï¼ˆCLSï¼‰</h3>
<p><strong>è¯´æ˜</strong>ï¼šæµ‹é‡é¡µé¢å…ƒç´ çš„æ„å¤–ç§»åŠ¨ï¼Œç”¨äºè®¡ç®— <strong>Cumulative Layout Shift (CLS)</strong> ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.value</code>ï¼šå•æ¬¡å¸ƒå±€åç§»å¾—åˆ†</li>
<li><code>entry.hadRecentInput</code>ï¼šæ˜¯å¦ç”±ç”¨æˆ·è¾“å…¥è§¦å‘ï¼ˆé€šå¸¸åªå…³æ³¨ <code>false</code> çš„æƒ…å†µï¼‰</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæå‡è§†è§‰ç¨³å®šæ€§ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</p>
<h3 data-id="heading-7">7.Â  <strong><code>'event'</code></strong> Â â€” ç”¨æˆ·äº‹ä»¶å»¶è¿Ÿ</h3>
<p><strong>è¯´æ˜</strong>ï¼šæµ‹é‡æ‰€æœ‰ç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆç‚¹å‡»ã€é”®ç›˜è¾“å…¥ï¼‰çš„å»¶è¿Ÿæ—¶é—´ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.name</code>ï¼šäº‹ä»¶ç±»å‹ï¼ˆ<code>click</code>, <code>keydown</code> ç­‰ï¼‰</li>
<li><code>entry.duration</code>ï¼šäº‹ä»¶å¤„ç†è€—æ—¶</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç›‘æ§äº¤äº’å“åº”æ€§ï¼Œå‘ç°äº‹ä»¶å¤„ç†ç“¶é¢ˆ</p>
<h3 data-id="heading-8">8.Â  <strong><code>'longtask'</code></strong> Â â€” é•¿ä»»åŠ¡ç›‘æ§</h3>
<p><strong>è¯´æ˜</strong>ï¼šè¯†åˆ«ä¸»çº¿ç¨‹ä¸Šè€—æ—¶è¶…è¿‡ <strong>50 æ¯«ç§’</strong>çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ä¼šé˜»å¡ç”¨æˆ·äº¤äº’ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.duration</code>ï¼šä»»åŠ¡è€—æ—¶</li>
<li><code>entry.attribution</code>ï¼šå¯¼è‡´é•¿ä»»åŠ¡çš„ä»£ç ä¿¡æ¯</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå‘ç° JavaScript æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–ä¸»çº¿ç¨‹æ‰§è¡Œ</p>
<h3 data-id="heading-9">9.Â  <strong><code>'long-animation-frame'</code></strong> Â â€” é•¿åŠ¨ç”»å¸§ï¼ˆLoAFï¼‰</h3>
<p><strong>è¯´æ˜</strong>ï¼š<strong>æ–°ä¸€ä»£é•¿ä»»åŠ¡ç›‘æ§</strong>ï¼Œæ¯” <code>'longtask'</code> æ›´ç»†ç²’åº¦ï¼Œæä¾›å®Œæ•´çš„è°ƒç”¨æ ˆå’Œè„šæœ¬å½’å› ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.duration</code>ï¼šå¸§è€—æ—¶</li>
<li><code>entry.scripts</code>ï¼šè¯¦ç»†çš„è„šæœ¬æ‰§è¡Œä¿¡æ¯æ•°ç»„</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç²¾ç¡®è¯Šæ–­é˜»å¡åŠ¨ç”»å’Œäº¤äº’çš„è„šæœ¬</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>((<span class="hljs-keyword">list</span>) =&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">entry</span> of <span class="hljs-keyword">list</span>.<span class="hljs-title function_ invoke__">getEntries</span>()) {
    console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'é•¿åŠ¨ç”»å¸§:'</span>, {
      <span class="hljs-attr">duration</span>: entry.duration + <span class="hljs-string">'ms'</span>,
      <span class="hljs-attr">scripts</span>: entry.scripts.<span class="hljs-title function_ invoke__">map</span>(s =&gt; ({
        <span class="hljs-attr">source</span>: s.sourceURL,
        <span class="hljs-attr">function</span>: s.sourceFunctionName,
        <span class="hljs-attr">duration</span>: s.duration + <span class="hljs-string">'ms'</span>
      }))
    });
  }
});
observer.<span class="hljs-title function_ invoke__">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'long-animation-frame'</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-10">10.Â  <strong><code>'element'</code></strong> Â â€” å…ƒç´ çº§æ€§èƒ½</h3>
<p><strong>è¯´æ˜</strong>ï¼šè§‚å¯Ÿç‰¹å®š DOM å…ƒç´ çš„æ¸²æŸ“æ—¶é—´ï¼Œç”¨äºæ›´ç²¾ç¡®çš„ LCP æµ‹é‡ã€‚</p>
<p><strong>ä½¿ç”¨è¦æ±‚</strong>ï¼šå…ƒç´ éœ€æ·»åŠ  <code>elementtiming</code> å±æ€§</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img <span class="hljs-attr">src</span>=<span class="hljs-string">"hero.jpg"</span> elementtiming=<span class="hljs-string">"hero-image"</span> /&gt;
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç›‘æ§å…³é”®ä¸šåŠ¡å…ƒç´ çš„æ¸²æŸ“æ€§èƒ½</p>
<h3 data-id="heading-11">11.Â  <strong><code>'mark'</code></strong> Â â€” è‡ªå®šä¹‰æ—¶é—´æˆ³æ ‡è®°</h3>
<p><strong>è¯´æ˜</strong>ï¼šé€šè¿‡ <code>performance.mark()</code> åˆ›å»ºå‘½åæ—¶é—´æˆ³ï¼Œæ ‡è®°ä¸šåŠ¡å…³é”®èŠ‚ç‚¹ã€‚</p>
<p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">performance.<span class="hljs-built_in">mark</span>(<span class="hljs-string">'user_login_start'</span>);
<span class="hljs-comment">// ... æ‰§è¡Œä»£ç </span>
performance.<span class="hljs-built_in">mark</span>(<span class="hljs-string">'user_login_end'</span>);
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šè‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘æ€§èƒ½ç›‘æ§ï¼Œå¦‚ç»„ä»¶åˆå§‹åŒ–æ—¶é—´ã€API è°ƒç”¨è€—æ—¶ç­‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'mark'</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ ‡è®°ç‚¹:'</span>, entry.<span class="hljs-property">name</span>, entry.<span class="hljs-property">startTime</span> + <span class="hljs-string">'ms'</span>);
  }
});
observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'mark'</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-12">12.Â  <strong><code>'measure'</code></strong> Â â€” è‡ªå®šä¹‰æ—¶é—´åŒºé—´æµ‹é‡</h3>
<p><strong>è¯´æ˜</strong>ï¼šé€šè¿‡ <code>performance.measure()</code> è®¡ç®—ä¸¤ä¸ª mark ä¹‹é—´çš„æ—¶é—´å·®ï¼Œæ˜¯ä¸šåŠ¡æ€§èƒ½ç›‘æ§çš„é»„é‡‘æ ‡å‡†ã€‚</p>
<p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">performance.<span class="hljs-built_in">measure</span>(<span class="hljs-string">'login_duration'</span>, <span class="hljs-string">'user_login_start'</span>, <span class="hljs-string">'user_login_end'</span>);
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç²¾ç¡®æµ‹é‡ä¸šåŠ¡æ“ä½œè€—æ—¶ï¼Œç”Ÿæˆè‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'measure'</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµ‹é‡åŒºé—´:'</span>, entry.<span class="hljs-property">name</span>, entry.<span class="hljs-property">duration</span> + <span class="hljs-string">'ms'</span>);
  }
});
observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'measure'</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-13">13.Â  <strong><code>'visibility-state'</code></strong> Â â€” é¡µé¢å¯è§æ€§å˜åŒ–</h3>
<p><strong>è¯´æ˜</strong>ï¼šç›‘æ§é¡µé¢ä»å¯è§åˆ°éšè—ã€ä»éšè—åˆ°å¯è§çš„çŠ¶æ€è½¬æ¢ï¼Œå¯¹<strong>ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–</strong>è‡³å…³é‡è¦ã€‚</p>
<p><strong>å…³é”®å±æ€§</strong>ï¼š</p>
<ul>
<li><code>entry.prevState</code>ï¼šä¹‹å‰çš„çŠ¶æ€ï¼ˆ<code>visible</code>, <code>hidden</code>, <code>prerender</code>ï¼‰</li>
<li><code>entry.currState</code>ï¼šå½“å‰çš„çŠ¶æ€</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé¡µé¢éšè—æ—¶æš‚åœéå…³é”®ä»»åŠ¡ï¼ŒèŠ‚çœ CPU å’Œç”µé‡</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>((<span class="hljs-keyword">list</span>) =&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">entry</span> of <span class="hljs-keyword">list</span>.<span class="hljs-title function_ invoke__">getEntries</span>()) {
    console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'å¯è§æ€§å˜åŒ–:'</span>, {
      <span class="hljs-attr">from</span>: entry.prevState,
      <span class="hljs-attr">to</span>: entry.currState
    });
    <span class="hljs-keyword">if</span> (entry.currState === <span class="hljs-string">'hidden'</span>) {
      <span class="hljs-title function_ invoke__">pauseBackgroundTasks</span>();
    }
  }
});
observer.<span class="hljs-title function_ invoke__">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'visibility-state'</span>], <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<hr/>
<h2 data-id="heading-14">äºŒã€æµè§ˆå™¨å…¼å®¹æ€§è¯´æ˜</h2>
<h3 data-id="heading-15">åŠ¨æ€æ£€æŸ¥æ”¯æŒç±»å‹</h3>
<p>é€šè¿‡ <code>PerformanceObserver.supportedEntryTypes</code> è·å–å½“å‰æµè§ˆå™¨æ”¯æŒçš„ç±»å‹ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">console.log(PerformanceObserver.supportedEntryTypes);
<span class="hljs-regexp">//</span> ç°ä»£æµè§ˆå™¨è¾“å‡º (<span class="hljs-number">13</span>):
<span class="hljs-regexp">//</span> [<span class="hljs-string">'element'</span>, <span class="hljs-string">'event'</span>, <span class="hljs-string">'first-input'</span>, <span class="hljs-string">'largest-contentful-paint'</span>, 
<span class="hljs-regexp">//</span>  <span class="hljs-string">'layout-shift'</span>, <span class="hljs-string">'long-animation-frame'</span>, <span class="hljs-string">'longtask'</span>, <span class="hljs-string">'mark'</span>, 
<span class="hljs-regexp">//</span>  <span class="hljs-string">'measure'</span>, <span class="hljs-string">'navigation'</span>, <span class="hljs-string">'paint'</span>, <span class="hljs-string">'resource'</span>, <span class="hljs-string">'visibility-state'</span>]
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šè¯¥å±æ€§æ˜¯é™æ€åªè¯»å±æ€§ï¼Œè¿”å›æ•°ç»„<a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2Fdocs%2Fnext%2Fglobal-PerformanceObserver" target="_blank" title="https://reactnative.dev/docs/next/global-PerformanceObserver" ref="nofollow noopener noreferrer">reactnative.dev/docs/next/gâ€¦</a></p>
<h3 data-id="heading-16">å…¼å®¹æ€§å·®å¼‚</h3>
<ul>
<li><strong>ç°ä»£æµè§ˆå™¨</strong> (Chrome 120+, Edge 120+)ï¼šæ”¯æŒå…¨éƒ¨ 13 ç§ç±»å‹</li>
<li><strong>Safari</strong>ï¼šæ”¯æŒåŸºç¡€ç±»å‹ï¼Œå¯¹æ–°ç±»å‹ï¼ˆå¦‚ <code>long-animation-frame</code>ï¼‰æ”¯æŒè¾ƒæ…¢</li>
<li><strong>Firefox</strong>ï¼šæ”¯æŒæ ¸å¿ƒç±»å‹ï¼Œéƒ¨åˆ†å®éªŒæ€§ç±»å‹ä¸æ”¯æŒ</li>
<li><strong>IE</strong>ï¼šå®Œå…¨ä¸æ”¯æŒ PerformanceObserver</li>
</ul>
<p><strong>æ¨èåšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">supportedTypes</span> = PerformanceObserver.supportedEntryTypes || []<span class="hljs-comment">;</span>
const <span class="hljs-attr">desiredTypes</span> = [
  <span class="hljs-string">'navigation'</span>, <span class="hljs-string">'resource'</span>, <span class="hljs-string">'paint'</span>, <span class="hljs-string">'first-input'</span>, <span class="hljs-string">'layout-shift'</span>,
  <span class="hljs-string">'longtask'</span>, <span class="hljs-string">'event'</span>, <span class="hljs-string">'largest-contentful-paint'</span>, <span class="hljs-string">'long-animation-frame'</span>
]<span class="hljs-comment">;</span>
const <span class="hljs-attr">entryTypes</span> = desiredTypes.filter(type =&gt; supportedTypes.includes(type))<span class="hljs-comment">;</span>

if (entryTypes.length &gt; 0) {
  observer.observe({ entryTypes, buffered: true })<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-17">ä¸‰ã€å®Œæ•´ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-18">ç›‘æ§å¤šç§æ€§èƒ½æŒ‡æ ‡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">entryList</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> entries = entryList.<span class="hljs-title function_">getEntries</span>();
  
  entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç±»å‹: <span class="hljs-subst">${entry.entryType}</span>, åç§°: <span class="hljs-subst">${entry.name}</span>, è€—æ—¶: <span class="hljs-subst">${entry.duration}</span>ms`</span>);
    
    <span class="hljs-comment">// æ ¹æ®ç±»å‹åˆ†åˆ«å¤„ç†</span>
    <span class="hljs-keyword">switch</span>(entry.<span class="hljs-property">entryType</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'navigation'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é¡µé¢åŠ è½½å®Œæˆ:'</span>, entry.<span class="hljs-property">duration</span> + <span class="hljs-string">'ms'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'resource'</span>:
        <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">200</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'æ…¢èµ„æº:'</span>, entry.<span class="hljs-property">name</span>);
        }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'largest-contentful-paint'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'LCP:'</span>, entry.<span class="hljs-property">startTime</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'ms'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'first-input'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ–±ï¸ é¦–æ¬¡äº¤äº’å»¶è¿Ÿ:'</span>, entry.<span class="hljs-property">duration</span> + <span class="hljs-string">'ms'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'layout-shift'</span>:
        <span class="hljs-keyword">if</span> (!entry.<span class="hljs-property">hadRecentInput</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'CLS ç´¯ç§¯:'</span>, entry.<span class="hljs-property">value</span>);
        }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'long-animation-frame'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é•¿åŠ¨ç”»å¸§:'</span>, entry.<span class="hljs-property">duration</span> + <span class="hljs-string">'ms'</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'visibility-state'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¯è§æ€§å˜åŒ–:'</span>, entry.<span class="hljs-property">currState</span>);
        <span class="hljs-keyword">break</span>;
    }
  });
});

<span class="hljs-comment">// å¼€å§‹è§‚å¯Ÿï¼ˆæ¨èè®¾ç½® buffered: true è·å–å†å²æ•°æ®ï¼‰</span>
observer.<span class="hljs-title function_">observe</span>({
  <span class="hljs-attr">entryTypes</span>: [
    <span class="hljs-string">'navigation'</span>,
    <span class="hljs-string">'resource'</span>,
    <span class="hljs-string">'largest-contentful-paint'</span>,
    <span class="hljs-string">'first-input'</span>,
    <span class="hljs-string">'layout-shift'</span>,
    <span class="hljs-string">'long-animation-frame'</span>,
    <span class="hljs-string">'visibility-state'</span>
  ],
  <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong><code>buffered: true</code></strong> ï¼šæ”¶é›† <code>observe()</code> è°ƒç”¨ä¹‹å‰å·²å‘ç”Ÿçš„æ€§èƒ½æ¡ç›®ï¼Œé˜²æ­¢é—æ¼</li>
<li><strong><code>disconnect()</code></strong> ï¼šä¸å†éœ€è¦æ—¶è°ƒç”¨ï¼Œé‡Šæ”¾èµ„æº</li>
</ul>
<hr/>
<h2 data-id="heading-19">äº”ã€æ€»ç»“çŸ©é˜µ</h2>





















































































































<table><thead><tr><th align="left">#</th><th align="left">Entry Type</th><th align="left">ä¸»è¦æŒ‡æ ‡</th><th align="left">å…¸å‹é˜ˆå€¼</th><th align="left">æ‰€å±æ ‡å‡†</th><th align="left">ç›‘æ§åœºæ™¯</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><code>navigation</code></td><td align="left">é¡µé¢åŠ è½½æ—¶é—´</td><td align="left">&lt; 3s</td><td align="left">Navigation Timing</td><td align="left">æ•´ä½“åŠ è½½æ€§èƒ½</td></tr><tr><td align="left">2</td><td align="left"><code>resource</code></td><td align="left">èµ„æºåŠ è½½è€—æ—¶</td><td align="left">&lt; 200ms</td><td align="left">Resource Timing</td><td align="left">æ…¢èµ„æºå®šä½</td></tr><tr><td align="left">3</td><td align="left"><code>paint</code></td><td align="left">FCP</td><td align="left">&lt; 1.8s</td><td align="left">Paint Timing</td><td align="left">é¦–æ¬¡æ¸²æŸ“</td></tr><tr><td align="left">4</td><td align="left"><code>largest-contentful-paint</code></td><td align="left">LCP</td><td align="left">&lt; 2.5s</td><td align="left">LCP API</td><td align="left">æœ€å¤§å†…å®¹æ¸²æŸ“</td></tr><tr><td align="left">5</td><td align="left"><code>first-input</code></td><td align="left">FID</td><td align="left">&lt; 100ms</td><td align="left">Event Timing</td><td align="left">é¦–æ¬¡äº¤äº’å“åº”</td></tr><tr><td align="left">6</td><td align="left"><code>layout-shift</code></td><td align="left">CLS</td><td align="left">&lt; 0.1</td><td align="left">Layout Instability</td><td align="left">è§†è§‰ç¨³å®šæ€§</td></tr><tr><td align="left">7</td><td align="left"><code>event</code></td><td align="left">äº¤äº’å»¶è¿Ÿ</td><td align="left">&lt; 100ms</td><td align="left">Event Timing</td><td align="left">æ‰€æœ‰äº‹ä»¶å»¶è¿Ÿ</td></tr><tr><td align="left">8</td><td align="left"><code>longtask</code></td><td align="left">ä¸»çº¿ç¨‹é˜»å¡</td><td align="left">&gt; 50ms</td><td align="left">Long Tasks API</td><td align="left">å¡é¡¿æ£€æµ‹</td></tr><tr><td align="left">9</td><td align="left"><code>long-animation-frame</code></td><td align="left">é•¿åŠ¨ç”»å¸§é˜»å¡</td><td align="left">&gt; 50ms</td><td align="left">LoAF API</td><td align="left">ç²¾ç»†åŒ–å¡é¡¿åˆ†æ</td></tr><tr><td align="left">10</td><td align="left"><code>element</code></td><td align="left">å…ƒç´ æ¸²æŸ“æ—¶é—´</td><td align="left">ä¸šåŠ¡è‡ªå®šä¹‰</td><td align="left">Element Timing</td><td align="left">å…³é”®å…ƒç´ ç›‘æ§</td></tr><tr><td align="left">11</td><td align="left"><code>mark</code></td><td align="left">è‡ªå®šä¹‰æ—¶é—´æˆ³</td><td align="left">-</td><td align="left">User Timing</td><td align="left">ä¸šåŠ¡åŸ‹ç‚¹</td></tr><tr><td align="left">12</td><td align="left"><code>measure</code></td><td align="left">è‡ªå®šä¹‰æ—¶é—´åŒºé—´</td><td align="left">ä¸šåŠ¡è‡ªå®šä¹‰</td><td align="left">User Timing</td><td align="left">åŒºé—´æµ‹é‡</td></tr><tr><td align="left">13</td><td align="left"><code>visibility-state</code></td><td align="left">é¡µé¢å¯è§æ€§å˜åŒ–</td><td align="left">-</td><td align="left">Page Visibility</td><td align="left">èŠ‚èƒ½ä¼˜åŒ–</td></tr></tbody></table>
<p>é€šè¿‡åˆç†ç»„åˆè¿™äº› entry typesï¼Œå¯ä»¥æ„å»ºå…¨é¢çš„å‰ç«¯æ€§èƒ½ç›‘æ§ä½“ç³»ï¼Œä¸ºä¼˜åŒ–æä¾›æ•°æ®æ”¯æ’‘</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin å‡½æ•°è¯¦è§£ï¼šå‘½åå‚æ•°ä¸é»˜è®¤å‚æ•°å€¼]]></title>    <link>https://juejin.cn/post/7573588675637198863</link>    <guid>https://juejin.cn/post/7573588675637198863</guid>    <pubDate>2025-11-18T02:13:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573588675637198863" data-draft-id="7573530680887541794" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin å‡½æ•°è¯¦è§£ï¼šå‘½åå‚æ•°ä¸é»˜è®¤å‚æ•°å€¼"/> <meta itemprop="keywords" content="Android,Kotlin,åç«¯"/> <meta itemprop="datePublished" content="2025-11-18T02:13:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_å°é›¨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin å‡½æ•°è¯¦è§£ï¼šå‘½åå‚æ•°ä¸é»˜è®¤å‚æ•°å€¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_å°é›¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:13:28.000Z" title="Tue Nov 18 2025 02:13:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼šè°ƒç”¨ä¸€ä¸ªå‚æ•°è¾ƒå¤šçš„å‡½æ•°æ—¶ï¼Œæ€»æ˜¯è¦åå¤æ ¸å¯¹å‚æ•°é¡ºåºï¼Œç”Ÿæ€•ä¼ é”™ä½ç½®ï¼›ä¸ºäº†é€‚é…ä¸åŒçš„å‚æ•°ç»„åˆï¼Œä¸å¾—ä¸å†™å¤šä¸ªç»“æ„ç›¸ä¼¼çš„é‡è½½å‡½æ•°ï¼Œå¯¼è‡´ä»£ç å†—ä½™ã€‚è€Œ Kotlin ä¸­çš„å‘½åå‚æ•°ä¸é»˜è®¤å‚æ•°å€¼ç‰¹æ€§ï¼Œæ­£æ˜¯ä¸ºè§£å†³è¿™äº›ç—›ç‚¹è€Œç”Ÿã€‚å®ƒä»¬ä¸ä»…èƒ½è®©å‡½æ•°è°ƒç”¨æ›´æ¸…æ™°ï¼Œè¿˜èƒ½å¤§å¹…å‡å°‘é‡å¤ä»£ç ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å¥½å¥½èŠèŠè¿™ä¸¤ä¸ªå®ç”¨ç‰¹æ€§ã€‚</p>
<h2 data-id="heading-1">äºŒã€Kotlin å‡½æ•°åŸºç¡€å›é¡¾ï¼ˆç®€å•é“ºå«ï¼‰</h2>
<p>åœ¨æ·±å…¥å­¦ä¹ æ–°ç‰¹æ€§å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•å›é¡¾ä¸‹ Kotlin å‡½æ•°çš„åŸºç¡€å®šä¹‰ã€‚ä¸€ä¸ªæ ‡å‡†çš„ Kotlin å‡½æ•°ç”± <code>fun</code> å…³é”®å­—ã€å‡½æ•°åã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹å’Œå‡½æ•°ä½“ç»„æˆï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åŸºç¡€å‡½æ•°å®šä¹‰ï¼šè®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„å’Œ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// è°ƒç”¨å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> result = add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
    println(result) <span class="hljs-comment">// è¾“å‡ºï¼š30</span>
}

</code></pre>
<p>è¿™é‡Œçš„ <code>a</code> å’Œ <code>b</code> æ˜¯ä½ç½®å‚æ•°ï¼Œè°ƒç”¨æ—¶å¿…é¡»ä¸¥æ ¼æŒ‰ç…§å®šä¹‰çš„é¡ºåºä¼ é€’å€¼ã€‚è€Œä»Šå¤©è¦è®²çš„å‘½åå‚æ•°ä¸é»˜è®¤å‚æ•°å€¼ï¼Œå°±æ˜¯å¯¹è¿™ç§åŸºç¡€å½¢å¼çš„ä¼˜åŒ–å‡çº§ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€é»˜è®¤å‚æ•°å€¼ï¼šè®©å‡½æ•°å‚æ•° â€œæœ‰å¤‡æ— æ‚£â€</h2>
<h3 data-id="heading-3">3.1 é»˜è®¤å‚æ•°å€¼çš„åŸºæœ¬å®šä¹‰</h3>
<p>é»˜è®¤å‚æ•°å€¼æŒ‡çš„æ˜¯åœ¨å‡½æ•°å®šä¹‰æ—¶ï¼Œä¸ºæŸä¸ªå‚æ•°é¢„å…ˆæŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ã€‚è¿™æ ·åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚æœä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªå‚æ•°ï¼Œå°±å¯ä»¥ç›´æ¥çœç•¥ï¼Œå‡½æ•°ä¼šè‡ªåŠ¨ä½¿ç”¨é¢„è®¾çš„é»˜è®¤å€¼ã€‚å®šä¹‰æ ¼å¼éå¸¸ç®€å•ï¼Œåªéœ€åœ¨å‚æ•°ç±»å‹ååŠ ä¸Š <code>=</code> å’Œé»˜è®¤å€¼å³å¯ã€‚</p>
<h3 data-id="heading-4">3.2 ç®€å•ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ— å¤æ‚é€»è¾‘ï¼‰</h3>
<p>æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯ç»™å‡½æ•°çš„éå¿…å¡«å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯æ‰“å°å‡½æ•°ï¼Œç”¨æˆ·åæ˜¯å¿…å¡«çš„ï¼Œå¹´é¾„å’Œæ€§åˆ«å¯ä»¥é€‰å¡«ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¸¦é»˜è®¤å‚æ•°å€¼çš„å‡½æ•°ï¼šæ‰“å°ç”¨æˆ·ä¿¡æ¯</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printUserInfo</span><span class="hljs-params">(
    username: <span class="hljs-type">String</span>, <span class="hljs-comment">// å¿…å¡«å‚æ•°ï¼Œæ— é»˜è®¤å€¼</span>
    age: <span class="hljs-type">Int</span> = <span class="hljs-number">18</span>,    <span class="hljs-comment">// å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼18</span>
    gender: <span class="hljs-type">String</span> = <span class="hljs-string">"æœªçŸ¥"</span> <span class="hljs-comment">// å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼"æœªçŸ¥"</span>
)</span></span> {
    println(<span class="hljs-string">"ç”¨æˆ·åï¼š<span class="hljs-variable">$username</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-variable">$age</span>ï¼Œæ€§åˆ«ï¼š<span class="hljs-variable">$gender</span>"</span>)
}

<span class="hljs-comment">// è°ƒç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. åªä¼ å¿…å¡«å‚æ•°ï¼ˆä½¿ç”¨é»˜è®¤å¹´é¾„å’Œæ€§åˆ«ï¼‰</span>
    printUserInfo(<span class="hljs-string">"å¼ ä¸‰"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šç”¨æˆ·åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š18ï¼Œæ€§åˆ«ï¼šæœªçŸ¥</span>

    <span class="hljs-comment">// 2. ä¼ å¿…å¡«å‚æ•°+éƒ¨åˆ†å¯é€‰å‚æ•°</span>
    printUserInfo(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">22</span>) <span class="hljs-comment">// è¾“å‡ºï¼šç”¨æˆ·åï¼šæå››ï¼Œå¹´é¾„ï¼š22ï¼Œæ€§åˆ«ï¼šæœªçŸ¥</span>

    <span class="hljs-comment">// 3. ä¼ æ‰€æœ‰å‚æ•°</span>
    printUserInfo(<span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"ç”·"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šç”¨æˆ·åï¼šç‹äº”ï¼Œå¹´é¾„ï¼š25ï¼Œæ€§åˆ«ï¼šç”·</span>
}
</code></pre>
<p>ä»ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œé»˜è®¤å‚æ•°å€¼è®©å‡½æ•°è°ƒç”¨å˜å¾—éå¸¸çµæ´»ï¼Œæ ¹æ®å®é™…éœ€æ±‚ä¼ é€’å‚æ•°å³å¯ã€‚</p>
<h3 data-id="heading-5">3.3 æ³¨æ„äº‹é¡¹ï¼ˆå¦‚ä½ç½®å‚æ•°ä¼˜å…ˆçº§ï¼‰</h3>
<p>ä½¿ç”¨é»˜è®¤å‚æ•°å€¼æ—¶æœ‰ä¸€ä¸ªå…³é”®è§„åˆ™ï¼š<strong>æ— é»˜è®¤å€¼çš„å¿…å¡«å‚æ•°å¿…é¡»æ”¾åœ¨æœ‰é»˜è®¤å€¼çš„å¯é€‰å‚æ•°å‰é¢</strong>ã€‚è¿™æ˜¯å› ä¸º Kotlin ä¼šæŒ‰ç…§å‚æ•°é¡ºåºè§£æä½ç½®è°ƒç”¨ï¼Œå¦‚æœå¿…å¡«å‚æ•°åœ¨åï¼Œå°±ä¼šå‡ºç°è§£ææ··ä¹±çš„é—®é¢˜ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šæœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾åœ¨äº†å¿…å¡«å‚æ•°å‰é¢</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">wrongPrint</span><span class="hljs-params">(age: <span class="hljs-type">Int</span> = <span class="hljs-number">18</span>, username: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-comment">// ç¼–è¯‘æŠ¥é”™ï¼šæœ‰é»˜è®¤å€¼çš„å‚æ•°ä¸èƒ½ä½äºæ— é»˜è®¤å€¼å‚æ•°ä¹‹å‰</span>
    println(<span class="hljs-string">"ç”¨æˆ·åï¼š<span class="hljs-variable">$username</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-variable">$age</span>"</span>)
}
</code></pre>
<h2 data-id="heading-6">å››ã€å‘½åå‚æ•°ï¼šè®©å‡½æ•°è°ƒç”¨ â€œä¸€ç›®äº†ç„¶â€</h2>
<h3 data-id="heading-7">4.1 å‘½åå‚æ•°çš„ä½¿ç”¨è¯­æ³•</h3>
<p>å‘½åå‚æ•°æ˜¯æŒ‡åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ˜ç¡®æŒ‡å®šå‚æ•°åå’Œå¯¹åº”çš„å€¼ï¼Œæ ¼å¼ä¸º <code>å‚æ•°å = å‚æ•°å€¼</code>ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çŸ¥é“æ¯ä¸ªå€¼å¯¹åº”çš„å‚æ•°å«ä¹‰ï¼Œæ— éœ€è®°å¿†å‚æ•°é¡ºåºã€‚</p>
<h3 data-id="heading-8">4.2 è§£å†³å‚æ•°é¡ºåºæ··æ·†é—®é¢˜ï¼ˆç®€å•ç¤ºä¾‹ï¼‰</h3>
<p>å½“å‡½æ•°å‚æ•°è¾ƒå¤šä¸”ç±»å‹ç›¸åŒæ—¶ï¼Œä½ç½®è°ƒç”¨å¾ˆå®¹æ˜“ä¼ é”™é¡ºåºã€‚æ¯”å¦‚å®šä¹‰ä¸€ä¸ªè®¡ç®—çŸ©å½¢é¢ç§¯çš„å‡½æ•°ï¼Œé•¿å’Œå®½éƒ½æ˜¯ Int ç±»å‹ï¼Œç”¨ä½ç½®è°ƒç”¨å°±å¯èƒ½æåï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è®¡ç®—çŸ©å½¢é¢ç§¯çš„å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateRectangleArea</span><span class="hljs-params">(length: <span class="hljs-type">Int</span>, width: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">return</span> length * width
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// ä½ç½®è°ƒç”¨ï¼šä¸å°å¿ƒæŠŠå®½å’Œé•¿ä¼ åäº†ï¼Œç»“æœå‡ºé”™</span>
    <span class="hljs-keyword">val</span> wrongArea = calculateRectangleArea(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)
    println(<span class="hljs-string">"é”™è¯¯é¢ç§¯ï¼š<span class="hljs-variable">$wrongArea</span>"</span>) <span class="hljs-comment">// å®é™…æƒ³ç®—10*5ï¼Œç»“æœå¾—åˆ°5*10=50ï¼Œè™½ç»“æœå·§åˆä½†é€»è¾‘é”™è¯¯</span>

    <span class="hljs-comment">// å‘½åå‚æ•°è°ƒç”¨ï¼šæ˜ç¡®æŒ‡å®šå‚æ•°åï¼Œä¸ä¼šä¼ é”™</span>
    <span class="hljs-keyword">val</span> correctArea = calculateRectangleArea(width = <span class="hljs-number">5</span>, length = <span class="hljs-number">10</span>)
    println(<span class="hljs-string">"æ­£ç¡®é¢ç§¯ï¼š<span class="hljs-variable">$correctArea</span>"</span>) <span class="hljs-comment">// è¾“å‡ºï¼š50ï¼Œé€»è¾‘æ¸…æ™°ä¸”ç»“æœæ­£ç¡®</span>
}

</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‘½åå‚æ•°å½»åº•è§£å†³äº†å‚æ•°é¡ºåºæ··æ·†çš„é—®é¢˜ï¼Œè®©ä»£ç æ›´å…·å¯è¯»æ€§ã€‚</p>
<h3 data-id="heading-9">4.3 å‘½åå‚æ•°ä¸ä½ç½®å‚æ•°æ··åˆä½¿ç”¨è§„åˆ™</h3>
<p>å‘½åå‚æ•°å’Œä½ç½®å‚æ•°å¯ä»¥æ··åˆä½¿ç”¨ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦è§„åˆ™ï¼š<strong>ä½ç½®å‚æ•°å¿…é¡»æ”¾åœ¨å‘½åå‚æ•°å‰é¢</strong>ã€‚å¦‚æœå…ˆå†™å‘½åå‚æ•°å†å†™ä½ç½®å‚æ•°ï¼ŒKotlin æ— æ³•æ­£ç¡®è§£æå‚æ•°é¡ºåºï¼Œä¼šç›´æ¥ç¼–è¯‘æŠ¥é”™ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½ç½®å‚æ•°åœ¨å‰ï¼Œå‘½åå‚æ•°åœ¨å</span>
printUserInfo(<span class="hljs-string">"èµµå…­"</span>, gender = <span class="hljs-string">"å¥³"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šç”¨æˆ·åï¼šèµµå…­ï¼Œå¹´é¾„ï¼š18ï¼Œæ€§åˆ«ï¼šå¥³</span>

<span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šå‘½åå‚æ•°åœ¨å‰ï¼Œä½ç½®å‚æ•°åœ¨å</span>
printUserInfo(age = <span class="hljs-number">20</span>, <span class="hljs-string">"å­™ä¸ƒ"</span>) <span class="hljs-comment">// ç¼–è¯‘æŠ¥é”™ï¼šå‘½åå‚æ•°ä¸èƒ½ä½äºä½ç½®å‚æ•°ä¹‹å‰</span>
</code></pre>
<h2 data-id="heading-10">äº”ã€å‘½åå‚æ•° + é»˜è®¤å‚æ•°å€¼ï¼šé»„é‡‘ç»„åˆå®æˆ˜</h2>
<h3 data-id="heading-11">5.1 ç®€åŒ–å‡½æ•°é‡è½½ï¼ˆå°‘å†™é‡å¤ä»£ç ï¼‰</h3>
<p>åœ¨ Java ä¸­ï¼Œä¸ºäº†é€‚é…ä¸åŒçš„å‚æ•°ç»„åˆï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå†™å¤šä¸ªé‡è½½å‡½æ•°ã€‚è€Œåœ¨ Kotlin ä¸­ï¼Œé€šè¿‡é»˜è®¤å‚æ•°å€¼ + å‘½åå‚æ•°çš„ç»„åˆï¼Œä¸€ä¸ªå‡½æ•°å°±èƒ½æ›¿ä»£å¤šä¸ªé‡è½½ï¼Œå¤§å¹…å‡å°‘å†—ä½™ä»£ç ã€‚</p>
<p>æ¯”å¦‚å®šä¹‰ä¸€ä¸ªæ—¥å¿—æ‰“å°å‡½æ•°ï¼Œæ”¯æŒæ‰“å°æ ‡é¢˜ã€å†…å®¹å’Œæ—¥å¿—çº§åˆ«ã€‚ç”¨ Java å¯èƒ½éœ€è¦å†™ 3 ä¸ªé‡è½½å‡½æ•°ï¼Œè€Œ Kotlin åªéœ€ä¸€ä¸ªï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin ä¸€ä¸ªå‡½æ•°æ›¿ä»£å¤šä¸ªé‡è½½</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printLog</span><span class="hljs-params">(
    content: <span class="hljs-type">String</span>, <span class="hljs-comment">// å¿…ä¼ ï¼šæ—¥å¿—å†…å®¹</span>
    title: <span class="hljs-type">String</span> = <span class="hljs-string">"é»˜è®¤æ—¥å¿—"</span>, <span class="hljs-comment">// å¯é€‰ï¼šæ—¥å¿—æ ‡é¢˜</span>
    level: <span class="hljs-type">String</span> = <span class="hljs-string">"INFO"</span> <span class="hljs-comment">// å¯é€‰ï¼šæ—¥å¿—çº§åˆ«</span>
)</span></span> {
    println(<span class="hljs-string">"[<span class="hljs-variable">$level</span>] <span class="hljs-variable">$title</span>ï¼š<span class="hljs-variable">$content</span>"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// å¯¹åº” Java ä¸­ printLog(String content)</span>
    printLog(<span class="hljs-string">"ç³»ç»Ÿå¯åŠ¨æˆåŠŸ"</span>)
    <span class="hljs-comment">// å¯¹åº” Java ä¸­ printLog(String content, String title)</span>
    printLog(<span class="hljs-string">"ç”¨æˆ·ç™»å½•"</span>, <span class="hljs-string">"ç™»å½•æ—¥å¿—"</span>)
    <span class="hljs-comment">// å¯¹åº” Java ä¸­ printLog(String content, String title, String level)</span>
    printLog(<span class="hljs-string">"æ•°æ®å¼‚å¸¸"</span>, level = <span class="hljs-string">"ERROR"</span>)
}
</code></pre>
<h3 data-id="heading-12">5.2 æ—¥å¸¸å¼€å‘å¸¸è§åœºæ™¯ç¤ºä¾‹ï¼ˆå¦‚è¡¨å•æäº¤ã€å·¥å…·ç±»å‡½æ•°ï¼‰</h3>
<p>åœ¨è¡¨å•æäº¤åœºæ™¯ä¸­ï¼Œå¾ˆå¤šå­—æ®µæ˜¯å¯é€‰çš„ï¼ˆå¦‚åœ°å€ã€å¤‡æ³¨ï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªé»„é‡‘ç»„åˆèƒ½è®©ä»£ç éå¸¸ç®€æ´ã€‚ä»¥ç”¨æˆ·æ³¨å†Œè¡¨å•ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç”¨æˆ·æ³¨å†Œè¡¨å•æäº¤å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">register</span><span class="hljs-params">(
    username: <span class="hljs-type">String</span>, <span class="hljs-comment">// å¿…å¡«ï¼šç”¨æˆ·å</span>
    password: <span class="hljs-type">String</span>, <span class="hljs-comment">// å¿…å¡«ï¼šå¯†ç </span>
    phone: <span class="hljs-type">String</span> = <span class="hljs-string">""</span>, <span class="hljs-comment">// å¯é€‰ï¼šæ‰‹æœºå·</span>
    address: <span class="hljs-type">String</span> = <span class="hljs-string">""</span>, <span class="hljs-comment">// å¯é€‰ï¼šåœ°å€</span>
    remark: <span class="hljs-type">String</span> = <span class="hljs-string">""</span> <span class="hljs-comment">// å¯é€‰ï¼šå¤‡æ³¨</span>
)</span></span> {
    println(<span class="hljs-string">"""
        æ³¨å†Œä¿¡æ¯æäº¤æˆåŠŸï¼š
        ç”¨æˆ·åï¼š<span class="hljs-variable">$username</span>
        å¯†ç ï¼š***ï¼ˆå·²åŠ å¯†ï¼‰
        æ‰‹æœºå·ï¼š<span class="hljs-subst">${if (phone.isEmpty()) <span class="hljs-string">"æœªå¡«å†™"</span> else phone}</span>
        åœ°å€ï¼š<span class="hljs-subst">${if (address.isEmpty()) <span class="hljs-string">"æœªå¡«å†™"</span> else address}</span>
        å¤‡æ³¨ï¼š<span class="hljs-subst">${if (remark.isEmpty()) <span class="hljs-string">"æ— "</span> else remark}</span>
    """</span>.trimIndent())
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åªå¡«å¿…å¡«ä¿¡æ¯æ³¨å†Œ</span>
    register(<span class="hljs-string">"kotlin_user"</span>, <span class="hljs-string">"123456a"</span>)

    <span class="hljs-comment">// å¡«å¿…å¡«+éƒ¨åˆ†å¯é€‰ä¿¡æ¯æ³¨å†Œ</span>
    register(<span class="hljs-string">"java_user"</span>, <span class="hljs-string">"abc654321"</span>, phone = <span class="hljs-string">"13800138000"</span>, address = <span class="hljs-string">"åŒ—äº¬å¸‚"</span>)
}

</code></pre>
<p>å·¥å…·ç±»å‡½æ•°ä¸­è¿™ä¸ªç»„åˆä¹Ÿå¾ˆå¸¸ç”¨ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²æ ¼å¼åŒ–å·¥å…·ï¼Œæ”¯æŒæŒ‡å®šå‰ç¼€ã€åç¼€å’Œåˆ†éš”ç¬¦ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å­—ç¬¦ä¸²æ ¼å¼åŒ–å·¥å…·å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">formatString</span><span class="hljs-params">(
    content: <span class="hljs-type">String</span>, <span class="hljs-comment">// å¿…ä¼ ï¼šåŸå§‹å†…å®¹</span>
    prefix: <span class="hljs-type">String</span> = <span class="hljs-string">""</span>, <span class="hljs-comment">// å¯é€‰ï¼šå‰ç¼€</span>
    suffix: <span class="hljs-type">String</span> = <span class="hljs-string">""</span>, <span class="hljs-comment">// å¯é€‰ï¼šåç¼€</span>
    separator: <span class="hljs-type">String</span> = <span class="hljs-string">""</span> <span class="hljs-comment">// å¯é€‰ï¼šåˆ†éš”ç¬¦ï¼ˆå¤šä¸ªå†…å®¹æ—¶ç”¨ï¼‰</span>
)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"<span class="hljs-variable">$prefix</span><span class="hljs-variable">$separator</span><span class="hljs-variable">$content</span><span class="hljs-variable">$separator</span><span class="hljs-variable">$suffix</span>"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// ç®€å•æ·»åŠ å‰ç¼€</span>
    <span class="hljs-keyword">val</span> withPrefix = formatString(<span class="hljs-string">"æµ‹è¯•å†…å®¹"</span>, prefix = <span class="hljs-string">"ã€æç¤ºã€‘"</span>)
    println(withPrefix) <span class="hljs-comment">// è¾“å‡ºï¼šã€æç¤ºã€‘æµ‹è¯•å†…å®¹</span>

    <span class="hljs-comment">// æ·»åŠ å‰ç¼€ã€åç¼€å’Œåˆ†éš”ç¬¦</span>
    <span class="hljs-keyword">val</span> fullFormat = formatString(<span class="hljs-string">"æ ¸å¿ƒæ•°æ®"</span>, prefix = <span class="hljs-string">"ç»“æœï¼š"</span>, suffix = <span class="hljs-string">"ï¼ˆç»“æŸï¼‰"</span>, separator = <span class="hljs-string">"|"</span>)
    println(fullFormat) <span class="hljs-comment">// è¾“å‡ºï¼šç»“æœï¼š|æ ¸å¿ƒæ•°æ®|ï¼ˆç»“æŸï¼‰</span>
}

</code></pre>
<h2 data-id="heading-13">å…­ã€å¸¸è§è¯¯åŒºä¸å°æŠ€å·§</h2>
<h3 data-id="heading-14">6.1 é¿å…çš„é”™è¯¯ç”¨æ³•ï¼ˆç®€å•ä¸¾ä¾‹ï¼‰</h3>
<ul>
<li><strong>é‡å¤ä¼ é€’å‚æ•°</strong>ï¼šåŒä¸€å‚æ•°ä¸èƒ½æ—¢ç”¨ä½ç½®ä¼ é€’åˆç”¨å‘½åä¼ é€’ï¼Œä¼šå¯¼è‡´ç¼–è¯‘æŠ¥é”™ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šé‡å¤ä¼ é€’ageå‚æ•°</span>
printUserInfo(<span class="hljs-string">"å‘¨å…«"</span>, <span class="hljs-number">28</span>, age = <span class="hljs-number">30</span>)
<span class="hljs-comment">// ç¼–è¯‘æŠ¥é”™ï¼šå‚æ•°ageè¢«å¤šæ¬¡æŒ‡å®š</span>

</code></pre>
<ul>
<li><strong>é»˜è®¤å€¼ä¸ºnullä½†æœªå£°æ˜å¯ç©º</strong>ï¼šå¦‚æœé»˜è®¤å€¼è®¾ä¸º nullï¼Œå‚æ•°ç±»å‹å¿…é¡»å£°æ˜ä¸ºå¯ç©ºç±»å‹ï¼ˆåŠ  <code>?</code>ï¼‰ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šé»˜è®¤å€¼ä¸ºnullï¼Œä½†å‚æ•°ç±»å‹éç©º</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getNickname</span><span class="hljs-params">(nickname: <span class="hljs-type">String</span> = <span class="hljs-literal">null</span>)</span></span> {
    <span class="hljs-comment">// ç¼–è¯‘æŠ¥é”™ï¼šnull ä¸èƒ½èµ‹å€¼ç»™éç©ºç±»å‹ String</span>
    println(nickname ?: <span class="hljs-string">"åŒ¿å"</span>)
}

<span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šå£°æ˜ä¸ºå¯ç©ºç±»å‹ String?</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getNickname</span><span class="hljs-params">(nickname: <span class="hljs-type">String</span>? = <span class="hljs-literal">null</span>)</span></span> {
    println(nickname ?: <span class="hljs-string">"åŒ¿å"</span>)
}

</code></pre>
<h3 data-id="heading-15">6.2 æå‡ä»£ç å¯è¯»æ€§çš„å°æŠ€å·§</h3>
<ul>
<li><strong>å‚æ•°è¾ƒå¤šæ—¶ç”¨å‘½åå‚æ•°</strong>ï¼šå½“å‡½æ•°å‚æ•°è¶…è¿‡ 3 ä¸ªæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨å‘½åå‚æ•°ï¼Œè®©è°ƒç”¨è€…ä¸€çœ¼çœ‹æ‡‚æ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€‚</li>
<li><strong>é»˜è®¤å€¼ç”¨å¸¸è§åœºæ™¯å€¼</strong>ï¼šé»˜è®¤å€¼å°½é‡è®¾ç½®ä¸ºæœ€å¸¸ç”¨çš„åœºæ™¯å€¼ï¼Œå‡å°‘è°ƒç”¨æ—¶çš„å‚æ•°ä¼ é€’ã€‚æ¯”å¦‚ç”¨æˆ·å¹´é¾„é»˜è®¤ 18ï¼Œæ—¥å¿—çº§åˆ«é»˜è®¤ INFOã€‚</li>
<li><strong>æ··åˆè°ƒç”¨æ—¶æ§åˆ¶ä½ç½®å‚æ•°æ•°é‡</strong>ï¼šæ··åˆä½¿ç”¨ä½ç½®å‚æ•°å’Œå‘½åå‚æ•°æ—¶ï¼Œä½ç½®å‚æ•°ä¸å®œè¿‡å¤šï¼Œå»ºè®®ä¸è¶…è¿‡ 2 ä¸ªï¼Œé¿å…å¯è¯»æ€§ä¸‹é™ã€‚</li>
</ul>
<h2 data-id="heading-16">ä¸ƒã€æ€»ç»“ï¼šæ ¸å¿ƒä¼˜åŠ¿ä¸ä½¿ç”¨å»ºè®®</h2>
<h3 data-id="heading-17">7.1 æ ¸å¿ƒä¼˜åŠ¿</h3>
<ol>
<li><strong>å‡å°‘ä»£ç å†—ä½™</strong>ï¼šç”¨ä¸€ä¸ªå‡½æ•°æ›¿ä»£å¤šä¸ªé‡è½½å‡½æ•°ï¼Œé¿å…é‡å¤ç¼–å†™ç›¸ä¼¼é€»è¾‘ã€‚</li>
<li><strong>æå‡ä»£ç å¯è¯»æ€§</strong>ï¼šå‘½åå‚æ•°æ˜ç¡®å‚æ•°å«ä¹‰ï¼Œè§£å†³å‚æ•°é¡ºåºæ··æ·†é—®é¢˜ã€‚</li>
<li><strong>å¢å¼ºè°ƒç”¨çµæ´»æ€§</strong>ï¼šé»˜è®¤å‚æ•°å€¼è®©éå¿…å¡«å‚æ•°å¯çµæ´»çœç•¥ï¼Œé€‚é…ä¸åŒåœºæ™¯ã€‚</li>
</ol>
<h3 data-id="heading-18">7.2 ä½¿ç”¨å»ºè®®</h3>
<ol>
<li>å®šä¹‰å‡½æ•°æ—¶ï¼Œå°†å¿…å¡«å‚æ•°æ”¾åœ¨å‰é¢ï¼Œå¯é€‰å‚æ•°ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰æ”¾åœ¨åé¢ã€‚</li>
<li>è°ƒç”¨å‚æ•°è¾ƒå¤šæˆ–ç±»å‹ç›¸åŒçš„å‡½æ•°æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨å‘½åå‚æ•°ã€‚</li>
<li>é»˜è®¤å‚æ•°å€¼å°½é‡ä½¿ç”¨é«˜é¢‘åœºæ™¯å€¼ï¼ŒåŒæ—¶è€ƒè™‘ç©ºå®‰å…¨ï¼ˆå¯ç©ºå‚æ•°éœ€åŠ  <code>?</code>ï¼‰ã€‚</li>
<li>æ··åˆè°ƒç”¨æ—¶ï¼Œç¡®ä¿ä½ç½®å‚æ•°åœ¨å‘½åå‚æ•°ä¹‹å‰ï¼Œä¸”ä½ç½®å‚æ•°æ•°é‡ä¸å®œè¿‡å¤šã€‚</li>
</ol>
<p>å‘½åå‚æ•°ä¸é»˜è®¤å‚æ•°å€¼æ˜¯ Kotlin ä¸­éå¸¸å®ç”¨çš„åŸºç¡€ç‰¹æ€§ï¼Œä¸Šæ‰‹ç®€å•ä½†èƒ½æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚å»ºè®®åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸»åŠ¨è¿ç”¨ï¼Œè®©ä½ çš„ Kotlin ä»£ç æ›´ç®€æ´ã€æ›´æ˜“è¯»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘æ˜¯å¦‚ä½•é«˜æ•ˆå­¦ä¹ å¤§æ¨¡å‹çš„]]></title>    <link>https://juejin.cn/post/7573523709300604963</link>    <guid>https://juejin.cn/post/7573523709300604963</guid>    <pubDate>2025-11-18T00:46:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573523709300604963" data-draft-id="7573512056089526307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘æ˜¯å¦‚ä½•é«˜æ•ˆå­¦ä¹ å¤§æ¨¡å‹çš„"/> <meta itemprop="keywords" content="LLM,äººå·¥æ™ºèƒ½,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-18T00:46:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜é˜¿å¥"/> <meta itemprop="url" content="https://juejin.cn/user/1517786987244510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘æ˜¯å¦‚ä½•é«˜æ•ˆå­¦ä¹ å¤§æ¨¡å‹çš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1517786987244510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜é˜¿å¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T00:46:50.000Z" title="Tue Nov 18 2025 00:46:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç›®å‰å¤§æ¨¡å‹çš„å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œæ¨¡å‹æ¶æ„å¿«é€Ÿè¿­ä»£ã€å„ç±» AI å·¥å…·ä¸æ¦‚å¿µå±‚å‡ºä¸ç©·â€”â€”Cursorã€Codexã€Augementã€Traeã€Qoder ç­‰ç­‰ç­‰ç­‰ï¼Œé¢å¯¹è¿™äº›æµ·é‡ä¿¡æ¯ï¼ŒçœŸæ˜¯è®©äººå¤´å¤§ã€‚</p>
<p>ä¸ºäº†åº”å¯¹è¿™ç§â€œä¿¡æ¯çˆ†ç‚¸â€ï¼Œæˆ‘ç»“åˆè‡ªèº«å®è·µï¼Œé€æ­¥æ‘¸ç´¢å‡ºä¸€å¥—<strong>é«˜æ•ˆä¸”å¯æŒç»­</strong>çš„ AI å­¦ä¹ æ–¹æ³•ï¼š</p>
<ul>
<li><strong>å®æ—¶åŠ¨æ€è·å–ï¼šX å¹³å°ï¼ˆTwitterï¼‰+ Manus è‡ªåŠ¨æ•´ç†ã€‚</strong></li>
<li><strong>æ·±åº¦çŸ¥è¯†å­¦ä¹ ï¼šYouTube + NotebookLM æ¢³ç†æ€»ç»“ã€‚</strong></li>
</ul>
<p>è¿™å¥—æ–¹æ³•ä¸ä»…å¤§å¹…é™ä½äº†æˆ‘çš„ä¿¡æ¯è·å–æˆæœ¬ï¼Œä¹Ÿè®©æˆ‘èƒ½æŒç»­æ·±å…¥åœ°ç†è§£ AI æ ¸å¿ƒæŠ€æœ¯ã€‚</p>
<p>å¸Œæœ›ä¹Ÿèƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€è·å– AI å®æ—¶åŠ¨æ€ä¿¡æ¯</h2>
<blockquote>
<p>è®©ä¿¡æ¯è‡ªåŠ¨æµå‘ä½ ï¼Œè€Œä¸æ˜¯ä½ å»æ‰¾ä¿¡æ¯ã€‚</p>
</blockquote>
<h3 data-id="heading-2">X å¹³å°ï¼ˆAI å‰æ²¿ä¿¡æ¯æ±‡é›†åœ°ï¼‰</h3>
<p>ç›®å‰å…¨çƒèŒƒå›´å†…æœ€å®æ—¶ã€æœ€å‰æ²¿çš„ AI ä¿¡æ¯å‡ ä¹éƒ½é¦–å‘äº <strong>X å¹³å°</strong>ï¼š</p>
<ul>
<li>OpenAIã€DeepSeekã€xAIã€DeepMindã€Meta ç­‰å®˜æ–¹è´¦å·ã€‚</li>
<li>è¿™äº›å…¬å¸çš„æ ¸å¿ƒäººç‰©ï¼šSam Altmanã€Greg Brockmanã€Andrej Karpathy ç­‰</li>
<li>Cursorã€Devin ç­‰å¼€å‘è€…å·¥å…·å›¢é˜Ÿã€‚</li>
<li>ç ”ç©¶å‘˜ã€å·¥ç¨‹å¸ˆã€ç‹¬ç«‹å¼€å‘è€…çš„æƒ³æ³•ã€ç ”ç©¶ã€è®¨è®ºã€demo ç­‰ã€‚</li>
</ul>
<p>ä½†æ˜¯æ¯å¤©æ‰‹åŠ¨åˆ· X éœ€è¦å¤§é‡æ—¶é—´ï¼Œå°¤å…¶æ˜¯æˆ‘åˆå…³æ³¨äº†å‡ åä¸ªè´¦å·ï¼Œä¸€ä¸ªäººæ ¹æœ¬çœ‹ä¸è¿‡æ¥ï¼Œä¹Ÿéš¾ä»¥æŒç»­ã€‚</p>
<p>æ‰€ä»¥æˆ‘éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¸®æˆ‘åˆ· X å¹³å°ï¼Œæ€»ç»“æ•´ç†æ‰€æœ‰ AI ä¿¡æ¯ï¼Œå†æ¨é€ç»™æˆ‘çš„å·¥å…·ã€‚</p>
<h3 data-id="heading-3">Manusï¼ˆè‡ªåŠ¨æ”¶é›† + å®šæ—¶æ¨é€ï¼‰</h3>
<p>Manus åˆšå¥½æ‹¥æœ‰æˆ‘éœ€è¦çš„æ‰€æœ‰èƒ½åŠ›ï¼Œè€Œä¸”å…è´¹ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmanus.im%2Fapp" target="_blank" title="https://manus.im/app" ref="nofollow noopener noreferrer">manus.im/app</a></p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c70329ffaacc4b1da25baf4784a95def~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=SbnJbENDygKUlokgxypexLjrj7U%3D" alt="2fXwrXviaydm6.png" width="100%" loading="lazy"/>
<p>æ·»åŠ å®šæ—¶ä»»åŠ¡</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77fb4840d09942cca2a2bd86de5e2280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=0OrQf77dGCbj7hiAydSFU%2BUD4u4%3D" alt="NQt4DJE5xfLtB.png" width="100%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6b33128f6b42d98f947d4863d75c8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=9Re%2FSgA%2BbT4Tb18Oqn2H4fXCzGk%3D" alt="rFyWM521AVWjo.png" width="100%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05b5c4ea50bf49069f9e7d4c1f3cdfc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=wLe%2BF2feJ1aSa%2FPuBn1xIWuqTao%3D" alt="Xt4qUGxgUEwLz.png" width="100%" loading="lazy"/>
<p>å®Œæ•´ä»»åŠ¡æç¤ºè¯</p>
<pre><code class="hljs language-markdown" lang="markdown">
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ AI è¡Œä¸šè§‚å¯Ÿå‘˜ï¼Œå…·å¤‡å‡ºè‰²çš„ä¿¡æ¯æ”¶é›†ã€ç­›é€‰ã€æ¦‚æ‹¬ä¸è¶‹åŠ¿åˆ†æèƒ½åŠ›ã€‚
ä½ çš„ä»»åŠ¡æ˜¯æ”¶é›† Twitter/X å¹³å°ä¸Šè¿‡å» 24 å°æ—¶å†…ï¼Œä¸ä»¥ä¸‹è´¦å·æˆ–å…³é”®è¯ç›¸å…³çš„å¸–å­ï¼š
<span class="hljs-bullet">-</span> OpenAIï¼ˆåŒ…æ‹¬ Sam Altmanã€Greg Brockmanã€Ilya Sutskeverï¼‰
<span class="hljs-bullet">-</span> Anthropicï¼ˆClaude å›¢é˜Ÿï¼‰
<span class="hljs-bullet">-</span> Cursor å›¢é˜Ÿä¸ç›¸å…³å·¥ç¨‹å¸ˆ
<span class="hljs-bullet">-</span> Andrej Karpathy
<span class="hljs-bullet">-</span> DeepSeekã€Mistralã€xAIã€Meta AIã€Google DeepMind ç­‰å›¢é˜Ÿ

ä½ éœ€è¦å¯¹ä¿¡æ¯è¿›è¡Œåˆ†æä¸æ•´åˆï¼Œè¾“å‡ºç®€è¦æƒ…æŠ¥æ‘˜è¦ã€‚
è¾“å‡ºè¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡ï¼Œé£æ ¼æ¸…æ™°ã€ç®€æ´ã€æœ‰ç»“æ„ã€‚
å¦‚æœä½ è·å–ä¸åˆ°åŸæ–‡é“¾æ¥ï¼Œé‚£å±•ç¤ºä½ è·å–ä¿¡æ¯æºçš„é“¾æ¥

ä»»åŠ¡å†…å®¹ï¼š
<span class="hljs-bullet">1.</span> æ±‡æ€»è¿™äº›è´¦å·å‘å¸ƒæˆ–è½¬å‘çš„æ¨æ–‡ï¼ˆè¿‡å» 24 å°æ—¶ï¼‰
<span class="hljs-bullet">2.</span> é€‰å‡ºæœ€å…·ä»£è¡¨æ€§ã€ä¿¡æ¯é‡æœ€é«˜çš„ 5~10 æ¡
<span class="hljs-bullet">3.</span> æä¾›æ¯æ¡æ¨æ–‡çš„ï¼š
<span class="hljs-bullet">-</span> ä½œè€…å / æœºæ„å
<span class="hljs-bullet">-</span> æ¨æ–‡åŸæ–‡æ‘˜è¦ï¼ˆä¸­è‹±æ–‡ç®€è¦ç¿»è¯‘ï¼‰
<span class="hljs-bullet">-</span> åŸæ–‡é“¾æ¥
<span class="hljs-bullet">-</span> äº‹ä»¶ä¸»é¢˜ï¼ˆå¦‚æ¨¡å‹æ›´æ–°ã€è®ºæ–‡ã€è§‚ç‚¹ã€è¡Œä¸šåŠ¨æ€ï¼‰
<span class="hljs-bullet">4.</span> åœ¨æœ€åéƒ¨åˆ†ï¼š
<span class="hljs-bullet">-</span> æ¦‚è¿°ä»Šæ—¥ AI è¡Œä¸šçš„æ€»ä½“è¶‹åŠ¿ï¼ˆ100~200 å­—ï¼‰
<span class="hljs-bullet">-</span> æ ‡æ³¨æ˜¯å¦æœ‰å€¼å¾—æŒç»­å…³æ³¨çš„æ–°çº¿ç´¢ï¼ˆå¦‚æ¨¡å‹æ›´æ–°é¢„å‘Šã€æ–°åˆä½œã€æŠ€æœ¯çªç ´ï¼‰

<span class="hljs-section">è¾“å‡ºæ ¼å¼ï¼š
---</span>
ã€AIæ¯æ—¥æƒ…æŠ¥ç®€æŠ¥ - {{date}}ã€‘

ğŸ“ä»Šæ—¥é‡ç‚¹è¯é¢˜ï¼š
<span class="hljs-bullet">-</span> â€¦

ğŸ’¬ æ¨æ–‡ç²¾é€‰ï¼š
1ï¸âƒ£ ä½œè€…ï¼š@karpathy
å†…å®¹æ‘˜è¦ï¼šâ€¦
åŸæ–‡é“¾æ¥ï¼šâ€¦

2ï¸âƒ£ ä½œè€…ï¼š@OpenAI
å†…å®¹æ‘˜è¦ï¼šâ€¦
åŸæ–‡é“¾æ¥ï¼šâ€¦

ğŸ“Š è¶‹åŠ¿åˆ†æï¼š
<span class="hljs-section">ï¼ˆæ€»ç»“ä»Šæ—¥AIé¢†åŸŸå€¼å¾—å…³æ³¨çš„è¶‹åŠ¿ä¸è§‚ç‚¹ï¼‰
---</span>
</code></pre>
<p>è¿™æ ·é€šè¿‡è§„åˆ’æç¤ºè¯å’Œå®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼ŒManus å°±ä¼šæ¯å¤©è‡ªåŠ¨ç»™æˆ‘æ¨é€ä¸€ä»½ã€ŠAI æ¯æ—¥ç®€æŠ¥ã€‹ã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85d92535456342c59613860e14b3e02a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=50L1OByWW%2FPEOFfztqSixmRCC%2BU%3D" alt="qKKA5gJw5hQmH.png" width="100%" loading="lazy"/>
<h2 data-id="heading-4">äºŒã€æ·±åº¦å­¦ä¹ </h2>
<blockquote>
<p>ä»â€œçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆâ€åˆ°â€œç†è§£ä¸ºä»€ä¹ˆè¿™æ ·åšâ€</p>
</blockquote>
<p>è·å–åˆ° AI ä¿¡æ¯åï¼Œæ›´è¿›ä¸€æ­¥å°±éœ€è¦å¼„æ‡‚<strong>ä¸ºä»€ä¹ˆè¿™æ ·åšä»¥åŠèƒŒååŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>æˆ‘ä¸»è¦ä½¿ç”¨ YouTube å’Œ Notebook LM è¿™ä¸¤ä¸ªå·¥å…·è¿›è¡Œâ€œæ·±åº¦å­¦ä¹ â€ã€‚</p>
<p>YouTube è§†é¢‘æˆ‘ä¼šå®Œæ•´çš„çœ‹ä¸€éï¼Œå°¤å…¶æ˜¯é«˜è´¨é‡çš„æ’­å®¢å’Œè®¿è°ˆï¼Œç„¶åå†é€šè¿‡ NotebookLM æ€»ç»“æ•´ç†å…³é”®å†…å®¹ä»¥åŠé€šè¿‡å¯¹è¯å†è¿›ä¸€æ­¥å­¦ä¹ æŸäº›çŸ¥è¯†ã€‚</p>
<h3 data-id="heading-5">YouTubeï¼ˆæœ€å¥½çš„ AI æ·±åº¦å†…å®¹æºï¼‰</h3>
<p>YouTube ä¸Šæœ‰å¤§é‡ä¼˜è´¨ã€å…è´¹çš„ AI æ·±åº¦å†…å®¹ï¼Œæ¨èä¸€äº›æˆ‘å¸¸çœ‹çš„é¢‘é“ï¼š</p>
<ul>
<li>OpenAI DevDay / developer talkï¼ˆå®˜æ–¹æ·±åº¦è®²è§£ï¼‰</li>
<li>Dwarkesh Patelï¼ˆé«˜è´¨é‡è®¿è°ˆæ’­å®¢ï¼‰</li>
<li>Riley Brownï¼ˆVibe Codingï¼‰</li>
<li>Andrej Karpathyï¼ˆLLM åŸç†ã€Tokenizerï¼‰</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4855736277e64777915807cb91bcb203~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=%2Bipq3%2B4U8F6Zom%2F52X9tppwN65g%3D" alt="iHfHLtf7S0VHC.png" width="100%" loading="lazy"/>
<p>è¿™é‡Œæ¨èä¸€ä¸ªå®æ—¶ç¿»è¯‘ YouTube è§†é¢‘å­—å¹•çš„ Chrome æµè§ˆå™¨æ’ä»¶ï¼š<strong>Trancy</strong>ã€‚åœ¨å¯¹æ¯”äº†æ²‰æµ¸å¼ç¿»è¯‘ï¼Œç®€æ˜“ç¿»è¯‘ç­‰å·¥å…·åï¼Œè¿™ä¸ªä½¿ç”¨ä½“éªŒæœ€å¥½ã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7be783894a154c7f8bec5c4ed97caee3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=zoM5M4RmYhHiDSiIVTQBpCk2HLw%3D" alt="8aNxWGERVccGl.png" width="100%" loading="lazy"/>
<h3 data-id="heading-6">NotebookLMï¼ˆå°†è§†é¢‘å†…å®¹æ•´ç†æˆ AI æ•™ç¨‹ï¼‰</h3>
<p>åªéœ€è¦æŠŠ YouTube è§†é¢‘é“¾æ¥ç²˜è´´åˆ° NotebookLMï¼Œå®ƒå°±èƒ½è‡ªåŠ¨ç”Ÿæˆè¯¾ç¨‹æçº²ã€æ€ç»´å¯¼å›¾ã€æŠ¥å‘Šç­‰å¤šç§å†…å®¹å½¢å¼ï¼Œç„¶åè¿˜å¯ä»¥å’Œè§†é¢‘å†…å®¹è¿›è¡Œå¯¹è¯å’Œæé—®ã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnotebooklm.google.com%2F" target="_blank" title="https://notebooklm.google.com/" ref="nofollow noopener noreferrer">notebooklm.google.com/</a></p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a599fb09c644cf8a6dfedde52ab697a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=0VFP8LN3w%2FN1Te95YmWBnq0kaIU%3D" alt="sbrS6CpCjKrIJ.png" width="100%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8540b64e85cf4393b061a51297ccef29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=A2lbvDxLUNxLqgv%2FC%2BHvlRWzd%2Bs%3D" alt="oyuOa7i5AHEYk.png" width="100%" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65bc116cc5574cba9106ebfdca6a83da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6Zi_5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764031609&amp;x-signature=%2FMRaf4QYNYxgUQFBjA6HgApAFQY%3D" alt="UyfqWnRQXEE6L.png" width="100%" loading="lazy"/>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>AI å·¥å…·å±‚å‡ºä¸ç©·ï¼Œå¦‚ä½•åˆç†åˆ©ç”¨å®ƒä»¬æå‡æ•ˆç‡ï¼Œæ˜¯æˆ‘åœ¨ä¸æ–­å­¦ä¹ è¿‡ç¨‹ä¸­ä¸€ç›´åœ¨æ€è€ƒçš„é—®é¢˜ã€‚å®è·µä¸‹æ¥ï¼Œæˆ‘å‘ç°ä»è‡ªèº«çš„çœŸå®éœ€æ±‚å’Œç—›ç‚¹å‡ºå‘ï¼Œæ›´èƒ½æ‰¾åˆ°é€‚åˆçš„å·¥å…·å’Œæ–¹æ³•ã€‚</p>
<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿Â <strong>ç‚¹èµ + æ”¶è—</strong>Â ï¼Œéå¸¸æ„Ÿè°¢ï¼</p>
<p>æˆ‘æ˜¯<strong>é˜¿å¥</strong>ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph å¦‚ä½•é€šè¿‡ Checkpoint å®ç°æŒä¹…åŒ–]]></title>    <link>https://juejin.cn/post/7573597479981121572</link>    <guid>https://juejin.cn/post/7573597479981121572</guid>    <pubDate>2025-11-18T02:50:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573597479981121572" data-draft-id="7573592952242389044" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph å¦‚ä½•é€šè¿‡ Checkpoint å®ç°æŒä¹…åŒ–"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2025-11-18T02:50:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ALLINAI"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056639549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph å¦‚ä½•é€šè¿‡ Checkpoint å®ç°æŒä¹…åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056639549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ALLINAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:50:23.000Z" title="Tue Nov 18 2025 02:50:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"â€¢";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ LLM ç³»ç»Ÿè¶Šæ¥è¶Šå¤šåœ°ç”¨äºå¯¹è¯ã€ä»£ç†ã€ä»»åŠ¡å‹å·¥ä½œæµç­‰åœºæ™¯ï¼ŒæŒä¹…åŒ–ï¼ˆpersistent stateï¼‰æ¸æ¸æˆä¸ºå…³é”®éœ€æ±‚ã€‚LangGraph æä¾›äº†å†…ç½®çš„æŒä¹…åŒ–å±‚ï¼Œé€šè¿‡â€œæ£€æŸ¥ç‚¹ (checkpointer)â€æœºåˆ¶ï¼Œåœ¨æ‰§è¡Œå›¾ (graph) çš„æ¯ä¸€æ­¥ (super-step) ä¿å­˜çŠ¶æ€ï¼Œä»è€Œæ”¯æŒ <strong>è®°å¿† (memory)ã€å®¹é”™ (fault-tolerance)ã€æ—¶é—´æ—…è¡Œ (time travel)ã€äººæœºåä½œ (human-in-the-loop)</strong> ç­‰èƒ½åŠ›ã€‚</p>
<p>ä¸‹é¢å°±è¯¦ç»†æ‹†è§£ LangGraph çš„æŒä¹…åŒ–æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æŒä¹…åŒ–å±‚æ€»è§ˆ</h2>
<ul>
<li>LangGraph æœ‰å†…ç½®çš„ <strong>checkpointer æ¥å£</strong>ï¼Œå®ƒè´Ÿè´£åœ¨å›¾æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿å­˜çŠ¶æ€å¿«ç…§ã€‚</li>
<li>å½“ä½ ç¼–è¯‘ä¸€ä¸ª StateGraphï¼ˆæˆ–å…¶ä»–å›¾ï¼‰æ—¶ï¼Œåªè¦ä¼ å…¥ä¸€ä¸ª checkpointerï¼ŒLangGraph å°±ä¼šåœ¨æ¯ä¸ª <a href="https://juejin.cn/post/7573512056089952291" target="_blank" title="https://juejin.cn/post/7573512056089952291">super-step</a>è‡ªåŠ¨åˆ›å»º checkpointã€‚</li>
<li>è¿™äº› checkpoint è¢«å½’æ¡£åˆ°ä¸€ä¸ª â€œçº¿ç¨‹ (thread)â€ ä¸­ã€‚æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ ID (thread_id)ï¼Œä»£è¡¨ä¸€ä¸ªé€»è¾‘æ‰§è¡Œåºåˆ—ã€‚</li>
<li>é€šè¿‡çº¿ç¨‹ï¼Œå¯ä»¥åœ¨æ‰§è¡Œç»“æŸåè®¿é—®çŠ¶æ€ (å†å² / å½“å‰)ï¼Œä»è€Œå®ç°çŠ¶æ€è¿½è¸ªã€æ¢å¤ç­‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</h2>
<h3 data-id="heading-2">1. çº¿ç¨‹ (Thread)</h3>
<ul>
<li>
<p><strong>çº¿ç¨‹ (Thread)</strong> æ˜¯ç”¨äºæ ‡è¯†ä¸€ç³»åˆ—æ£€æŸ¥ç‚¹ (checkpoints) çš„é€»è¾‘å•å…ƒã€‚</p>
</li>
<li>
<p>å½“ä½ è°ƒç”¨å›¾ (invoke graph) æ—¶ï¼Œéœ€è¦åœ¨ <code>config</code> çš„ <code>configurable</code> éƒ¨åˆ†æŒ‡å®šä¸€ä¸ª <code>thread_id</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python">config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"1"</span>}}
</code></pre>
</li>
<li>
<p>æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå›¾çŠ¶æ€ä¼šéšç€ super-step å­˜å‚¨åˆ°è¯¥çº¿ç¨‹å¯¹åº”çš„å­˜å‚¨ä¸­ã€‚</p>
</li>
<li>
<p>ä¹‹åå¯ä»¥é€šè¿‡è¯¥ thread æ¥è¯»å–å†å²çŠ¶æ€ï¼ŒæŸ¥çœ‹æ‰§è¡Œå†å²ã€å›æº¯ç­‰ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. æ£€æŸ¥ç‚¹ (Checkpoint)</h3>
<ul>
<li>
<p><strong>Checkpoint</strong> æ˜¯æŸä¸€æ—¶åˆ»å›¾çŠ¶æ€çš„å¿«ç…§ (snapshot)ï¼Œç”± checkpointer ä¿å­˜ã€‚</p>
</li>
<li>
<p>LangGraph ä½¿ç”¨ä¸€ä¸ª <code>StateSnapshot</code> å¯¹è±¡æ¥è¡¨è¾¾ checkpointï¼Œå®ƒåŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li><code>config</code>ï¼šå½“æ—¶çš„ config (å¦‚ thread_id, checkpoint_id)</li>
<li><code>metadata</code>ï¼šä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ (ä¾‹å¦‚æ¯ä¸€æ­¥æ˜¯è°å†™äº†ä»€ä¹ˆ)</li>
<li><code>values</code>ï¼šæ‰€æœ‰ state channelï¼ˆä½ çš„ TypedDict çŠ¶æ€ï¼‰åœ¨è¯¥ç‚¹çš„å€¼</li>
<li><code>next</code>ï¼šæ¥ä¸‹æ¥åº”è¯¥æ‰§è¡Œå“ªäº›èŠ‚ç‚¹ (node åç§°)</li>
<li><code>tasks</code>ï¼šå¦‚æœæœ‰ä»»åŠ¡ (task, PregelTask)ï¼Œä¹Ÿä¼šè®°å½•ï¼›è‹¥ä¹‹å‰å¤±è´¥æˆ–ä¸­æ–­ï¼Œè¿˜ä¼šåæ˜ é”™è¯¯ / ä¸­æ–­ä¿¡æ¯</li>
</ul>
</li>
<li>
<p>è¿™äº› checkpoint æ˜¯æŒä¹…åŒ–çš„ï¼Œå› æ­¤ä½ å¯ä»¥ <strong>æ¢å¤ (restore)</strong> æˆ– <strong>å›æ”¾ (replay)</strong>ã€‚</p>
</li>
<li>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„å›¾ï¼Œå®ƒæ‰§è¡Œäº†ä¸¤ä¸ªèŠ‚ç‚¹ <code>node_a</code> å’Œ <code>node_b</code>ï¼ŒæŒ‰ super-step ä¿å­˜äº† 4 æ¬¡ checkpoint:</p>
<ol>
<li>åˆå§‹ (start)</li>
<li>æ‰§è¡Œå‰ç”¨æˆ·è¾“å…¥</li>
<li>æ‰§è¡Œ <code>node_a</code> å</li>
<li>æ‰§è¡Œ <code>node_b</code> åï¼Œæœ€ç»ˆ stateã€‚</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">3. è·å–çŠ¶æ€ (Get State)</h3>
<ul>
<li>
<p>å¯ä»¥é€šè¿‡ <code>graph.get_state(config)</code> è·å–æœ€è¿‘ (æˆ–æŒ‡å®š checkpoint) çš„çŠ¶æ€å¿«ç…§ï¼š</p>
<pre><code class="hljs language-python" lang="python">snapshot = graph.get_state({<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"1"</span>}})
</code></pre>
<p>è¿”å›ä¸€ä¸ª <code>StateSnapshot</code> å¯¹è±¡ï¼Œé‡Œé¢æœ‰ <code>values</code>ã€<code>metadata</code>ã€<code>next</code> ç­‰ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ æƒ³è®¿é—®å†å²çŠ¶æ€ (æ‰€æœ‰ checkpoint å†å²)ï¼Œå¯ä»¥è°ƒç”¨ <code>graph.get_state_history(config)</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python">history = <span class="hljs-built_in">list</span>(graph.get_state_history({<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"1"</span>}}))
</code></pre>
<p>è¿”å›ä¸€ä¸ª <code>StateSnapshot</code> åˆ—è¡¨ (æŒ‰æ—¶é—´é¡ºåº)ï¼Œæœ€æ–°çš„ checkpoint é€šå¸¸ä½äºåˆ—è¡¨å¼€å¤´ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">4. æ—¶é—´æ—…è¡Œ / å›æ”¾ (Replay)</h3>
<ul>
<li>
<p>LangGraph æ”¯æŒ <strong>æ—¶é—´æ—…è¡Œ (time travel)</strong>ï¼šä½ å¯ä»¥åœ¨è°ƒç”¨å›¾çš„æ—¶å€™æŒ‡å®š <code>checkpoint_id</code>ï¼Œä»å†å²æŸä¸ªæ£€æŸ¥ç‚¹ç»§ç»­æ‰§è¡Œã€‚</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python">config = {
    <span class="hljs-string">"configurable"</span>: {
        <span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"1"</span>,
        <span class="hljs-string">"checkpoint_id"</span>: <span class="hljs-string">"some-checkpoint-uuid"</span>
    }
}
graph.invoke(<span class="hljs-built_in">input</span>, config)
</code></pre>
</li>
<li>
<p>å½“ä½ ä»æŸä¸ª checkpoint æ¢å¤æ—¶ï¼š</p>
<ul>
<li><strong>Checkpoint ä¹‹å‰å·²ç»æ‰§è¡Œçš„èŠ‚ç‚¹</strong> ä¼šè¢« â€œå›æ”¾ (replay)â€ â€” è¿™éƒ¨åˆ†ä¸ä¼šé‡æ–°æ‰§è¡Œï¼Œåªæ˜¯æ¢å¤çŠ¶æ€ã€‚</li>
<li><strong>Checkpoint ä¹‹åçš„æ–°èŠ‚ç‚¹</strong> ä¼šæ ¹æ®å½“å‰å›¾èµ°æ–°çš„è·¯å¾„ (å¯èƒ½æ˜¯æ–°çš„åˆ†æ”¯) â€” ç›¸å½“äº â€œä»è¯¥å†å²ç‚¹åˆ†å‰ (fork)â€ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-6">5. æ›´æ–°çŠ¶æ€ (Update State)</h3>
<ul>
<li>
<p>é™¤äº†é€šè¿‡èŠ‚ç‚¹æ‰§è¡Œ (node) æ›´æ–°çŠ¶æ€ï¼Œä½ è¿˜å¯ä»¥ <strong>æ‰‹åŠ¨æ›´æ–°çŠ¶æ€</strong>ï¼šä½¿ç”¨ <code>graph.update_state(config, values)</code>ã€‚</p>
</li>
<li>
<p>é‡è¦ï¼šå¦‚æœä½ çš„çŠ¶æ€é€šé“ (state å­—æ®µ) æœ‰å®šä¹‰ â€œreducer (åˆå¹¶ç­–ç•¥)â€ï¼Œupdate_state ä¼šéµå¾ªè¿™äº› reducerï¼Œè€Œä¸æ˜¯ç®€å•è¦†ç›–ã€‚</p>
</li>
<li>
<p>æ¯”å¦‚åœ¨æ–‡æ¡£çš„ä¾‹å­ä¸­ï¼š</p>
<ul>
<li><code>foo</code> æ²¡æœ‰ reducer â†’ <code>update_state</code> ä¼šè¦†ç›–å®ƒ</li>
<li><code>bar</code> ä½¿ç”¨ <code>add</code> ä½œä¸º reducer â†’ <code>update_state({"bar": ["b"]})</code> ä¼šæŠŠ <code>"b"</code> åŠ åˆ°å·²æœ‰çš„ <code>bar</code> åˆ—è¡¨ä¸­ (è€Œä¸æ˜¯æ›¿æ¢)</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ›´å¤šå¼ºå¤§èƒ½åŠ› (Capabilities)</h2>
<p>é€šè¿‡ checkpoint æœºåˆ¶ï¼ŒLangGraph è§£é”ä»¥ä¸‹é«˜çº§åŠŸèƒ½ï¼š</p>
<ol>
<li>
<p><strong>äººæœºåä½œ (Human-in-the-Loop)</strong></p>
<ul>
<li>ç”±äºçŠ¶æ€è¢«æŒä¹…åŒ–ä¸º checkpointï¼Œäººç±»å¯ä»¥ä¸­æ–­ (interrupt)ã€å®¡æŸ¥ (inspect)ã€ç¼–è¾‘ï¼Œç„¶åæ¢å¤æ‰§è¡Œã€‚</li>
</ul>
</li>
<li>
<p><strong>è®°å¿† (Memory)</strong></p>
<ul>
<li>å¯¹è¯ã€æ™ºèƒ½ä½“ä½¿ç”¨åœºæ™¯ä¸­ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹ (thread) ä¼šä¿å­˜æ‰€æœ‰çŠ¶æ€ï¼Œèƒ½å¤Ÿè·¨å¤šè½®å¯¹è¯æŒç»­è®°å¿†ã€‚</li>
<li>å¦‚æœéœ€è¦è·¨çº¿ç¨‹å…±äº«è®°å¿† (æ¯”å¦‚ç”¨æˆ·é•¿æœŸèµ„æ–™)ï¼Œå¯ä»¥ç»“åˆ <code>Store</code> æ¥å£ (memory store) ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ—¶é—´æ—…è¡Œ (Time Travel)</strong></p>
<ul>
<li>å¯ä»¥å›åˆ°ä¹‹å‰æŸä¸ª checkpointï¼Œæ£€æŸ¥å†å²çŠ¶æ€ã€é‡æ”¾ã€å¯¹æ¯”ã€debugã€‚</li>
<li>è¿˜å¯ä»¥ â€œfork (åˆ†æ”¯)â€ â€” ä»æŸä¸ªå†å²ç‚¹åšæ–°çš„å°è¯•ã€‚</li>
</ul>
</li>
<li>
<p><strong>å®¹é”™ (Fault-tolerance)</strong></p>
<ul>
<li>å¦‚æœæŸä¸€æ­¥å¤±è´¥ (super-step ä¸­æŸäº›èŠ‚ç‚¹æŠ¥é”™)ï¼Œå¯ä»¥ä»æœ€è¿‘çš„æˆåŠŸ checkpoint æ¢å¤ï¼Œä¸éœ€è¦ä»å¤´å†æ¥ã€‚</li>
<li>å¦‚æœä¸€ä¸ª super-step å†…æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œæœ‰äº›èŠ‚ç‚¹å®Œæˆï¼Œæœ‰äº›å¤±è´¥ï¼ŒLangGraph ä¼šè®°å½• â€œpending writesâ€ (å°šæœªæˆåŠŸå†™å…¥) çš„å†…å®¹ï¼Œè¿™æ ·åœ¨æ¢å¤æ—¶ä¸ä¼šé‡å¤æ‰§è¡Œå·²ç»æˆåŠŸçš„èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-8">å››ã€æŒä¹…åŒ–å®ç°ç»†èŠ‚ (Checkpointer ä¸ åºåˆ—åŒ–)</h2>
<ul>
<li>
<p>LangGraph çš„ checkpointer æ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ (<code>BaseCheckpointSaver</code>)ã€‚</p>
</li>
<li>
<p>LangGraph æä¾›äº†å¤šç§å®ç°ï¼š</p>
<ul>
<li><strong>InMemorySaver</strong>ï¼šå†…å­˜ä¿å­˜ (é€‚åˆå®éªŒ /è°ƒè¯•)</li>
<li><strong>SQLite Saver</strong> (<code>SqliteSaver</code>)ï¼šä½¿ç”¨ SQLite å­˜å‚¨ (æœ¬åœ°ç®€å•æŒä¹…åŒ–)</li>
<li><strong>Postgres Saver</strong> (<code>PostgresSaver</code>)ï¼šä½¿ç”¨ Postgres æ•°æ®åº“ (é€‚åˆç”Ÿäº§)</li>
</ul>
</li>
<li>
<p><strong>åºåˆ—åŒ– (Serializer)</strong>ï¼šcheckpointer ä¿å­˜çŠ¶æ€æ—¶ï¼Œéœ€è¦æŠŠçŠ¶æ€ (state channels) åºåˆ—åŒ–æˆå¯å­˜å‚¨/æ¢å¤çš„æ ¼å¼ã€‚LangGraph ä½¿ç”¨ <code>SerializerProtocol</code>ï¼Œé»˜è®¤æ˜¯ <code>JsonPlusSerializer</code>ã€‚</p>
<ul>
<li><code>JsonPlusSerializer</code> æ”¯æŒå¤šç§ç±»å‹ (æ—¥æœŸã€æšä¸¾ã€LLM ç±»å‹ç­‰)ã€‚</li>
<li>å¦‚æœæœ‰æ›´å¤æ‚å¯¹è±¡ (å¦‚ Pandas DataFrame)ï¼Œå¯ä»¥å¼€å¯ <code>pickle_fallback=True</code> â†’ å›é€€åˆ° pickle åºåˆ—åŒ–ã€‚</li>
</ul>
</li>
<li>
<p><strong>åŠ å¯† (Encryption)</strong>ï¼šå¦‚æœä½ å¯¹æŒä¹…åŒ–æ•°æ®å®‰å…¨æ•æ„Ÿ (ä¾‹å¦‚å¯¹è¯å†…å®¹)ï¼Œå¯ä»¥ä½¿ç”¨åŠ å¯† Serializerã€‚LangGraph æ”¯æŒ <code>EncryptedSerializer</code> (ä¾‹å¦‚ AES åŠ å¯†)ï¼Œå¹¶ä¸”ä¸ Postgres / SQLite Saver ç»„åˆã€‚</p>
<ul>
<li><code>EncryptedSerializer.from_pycryptodome_aes()</code> å¯ä»¥ä»ç¯å¢ƒå˜é‡ <code>LANGGRAPH_AES_KEY</code> è¯»å–å¯†é’¥ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-9">äº”ã€ä½¿ç”¨ç¤ºä¾‹</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ checkpointer å®ç°æŒä¹…åŒ–ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, START, END
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver
<span class="hljs-keyword">from</span> typing_extensions <span class="hljs-keyword">import</span> TypedDict
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated
<span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> add

<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    foo: <span class="hljs-built_in">str</span>
    bar: Annotated[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], add]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"foo"</span>: <span class="hljs-string">"a"</span>, <span class="hljs-string">"bar"</span>: [<span class="hljs-string">"a"</span>]}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_b</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"foo"</span>: <span class="hljs-string">"b"</span>, <span class="hljs-string">"bar"</span>: [<span class="hljs-string">"b"</span>]}

<span class="hljs-comment"># å®šä¹‰å›¾</span>
workflow = StateGraph(State)
workflow.add_node(node_a)
workflow.add_node(node_b)
workflow.add_edge(START, <span class="hljs-string">"node_a"</span>)
workflow.add_edge(<span class="hljs-string">"node_a"</span>, <span class="hljs-string">"node_b"</span>)
workflow.add_edge(<span class="hljs-string">"node_b"</span>, END)

<span class="hljs-comment"># ä½¿ç”¨ InMemorySaver ä½œä¸ºæ£€æŸ¥ç‚¹å­˜å‚¨å™¨</span>
checkpointer = InMemorySaver()

<span class="hljs-comment"># ç¼–è¯‘å›¾ï¼Œä¼ å…¥ checkpointer</span>
graph = workflow.<span class="hljs-built_in">compile</span>(checkpointer=checkpointer)

<span class="hljs-comment"># æ‰§è¡Œå›¾ (run)ï¼ŒæŒ‡å®š thread_id</span>
config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"thread-1"</span>}}
graph.invoke({<span class="hljs-string">"foo"</span>: <span class="hljs-string">""</span>}, config)

<span class="hljs-comment"># è·å–æœ€æ–°çŠ¶æ€</span>
snapshot = graph.get_state(config)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Current state:"</span>, snapshot.values)

<span class="hljs-comment"># æŸ¥çœ‹å†å² checkpoint</span>
history = <span class="hljs-built_in">list</span>(graph.get_state_history(config))
<span class="hljs-keyword">for</span> idx, snap <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(history):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Checkpoint <span class="hljs-subst">{idx}</span>: <span class="hljs-subst">{snap.values}</span>"</span>)
</code></pre>
<p>è¾“å‡ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b3bfd4920f34abfaef13bff2afc0968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUxMSU5BSQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039022&amp;x-signature=cAJAgTtLHIS1R0uQY%2B5m2wBE%2F1A%3D" alt="2025-11-18 10 43 03.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10">å…­ã€å®ç”¨å»ºè®® &amp; åœºæ™¯</h2>
<ul>
<li><strong>å¯¹è¯åº”ç”¨ (Chatbot)</strong>ï¼šä½¿ç”¨æŒä¹…åŒ– + thread_id ä½ å¯ä»¥è®©å¯¹è¯å…·æœ‰å†…å­˜ (è®°ä½ä¹‹å‰å¯¹è¯å†…å®¹)ï¼Œéå¸¸é€‚åˆå®¢æœæœºå™¨äººã€æ™ºèƒ½åŠ©ç†ã€‚</li>
<li><strong>é•¿æµç¨‹å·¥ä½œæµ</strong>ï¼šé•¿ä»»åŠ¡ (multi-step) å¯èƒ½ä¸­æ–­ (fail) æˆ–æ‰‹åŠ¨å¹²é¢„ (human-in-loop)ï¼ŒæŒä¹…åŒ–ç¡®ä¿ä½ å¯ä»¥æ¢å¤æ‰§è¡Œã€‚</li>
<li><strong>è°ƒè¯• / å›æ”¾</strong>ï¼šæ—¶é—´æ—…è¡Œ (time-travel) èƒ½è®©ä½ æ£€æŸ¥æ¯ä¸€æ­¥çŠ¶æ€ï¼Œéå¸¸æœ‰åŠ©äºè°ƒè¯•å¤æ‚å›¾ã€‚</li>
<li><strong>ç”Ÿäº§éƒ¨ç½²</strong>ï¼šé€‰æ‹© SQLite / Postgres Saver å®ç°æŒä¹…åŒ–ï¼Œç»“åˆåŠ å¯† Serializerï¼Œä¿è¯æ•°æ®å®‰å…¨ä¸æ€§èƒ½ã€‚</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šå¦‚æœä½ åªæƒ³ä¿ç•™æœ€è¿‘å‡ æ¬¡ checkpointï¼Œå¯ä»¥ç»“åˆåº”ç”¨é€»è¾‘æ¸…ç†æ—§ checkpoint (æˆ–ä½¿ç”¨å®šåˆ¶ Saver)ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€å°ç»“</h2>
<p>LangGraph çš„æŒä¹…åŒ–é€šè¿‡ <strong>checkpointer + thread + checkpoint</strong> ä¸‰å±‚è®¾è®¡å®ç°ï¼š</p>
<ul>
<li><strong>checkpointer</strong> è´Ÿè´£å†™å…¥ checkpoint</li>
<li><strong>çº¿ç¨‹ (thread)</strong> æŠŠä¸€ç³»åˆ— checkpoint ç»„ç»‡èµ·æ¥</li>
<li><strong>checkpoint</strong> æ˜¯æŸä¸€æ—¶åˆ»çš„çŠ¶æ€å¿«ç…§ (StateSnapshot)ï¼ŒåŒ…æ‹¬ state å€¼ã€ä¸‹ä¸€æ­¥ä»»åŠ¡ã€å…ƒæ•°æ®ç­‰</li>
</ul>
<p>è¿™ä¸€æœºåˆ¶è®©å›¾ (graph) æ‹¥æœ‰ï¼š</p>
<ul>
<li><strong>è®°å¿† (memory)</strong></li>
<li><strong>äººæœºåä½œ</strong></li>
<li><strong>æ—¶é—´æ—…è¡Œ (å›æ”¾ / fork)</strong></li>
<li><strong>å®¹é”™æ¢å¤</strong></li>
</ul>
<p>é€šè¿‡é€‰æ‹©ä¸åŒç±»å‹çš„ saver (å†…å­˜ã€SQLiteã€Postgres)ï¼Œç»“åˆåˆé€‚çš„åºåˆ—åŒ–å’ŒåŠ å¯†ç­–ç•¥ï¼Œä½ å¯ä»¥æ„å»ºæ—¢çµæ´»åˆå¯é çš„æŒä¹…åŒ– LLM åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[fastapiçš„æœ€æ–°ç‰ˆæœ¬ï¼Œæä¾›äº†å“ªäº›æ–°apiå¯ä¾›ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7573593395797835822</link>    <guid>https://juejin.cn/post/7573593395797835822</guid>    <pubDate>2025-11-18T02:28:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573593395797835822" data-draft-id="7573595009552498698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="fastapiçš„æœ€æ–°ç‰ˆæœ¬ï¼Œæä¾›äº†å“ªäº›æ–°apiå¯ä¾›ä½¿ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,GitHub"/> <meta itemprop="datePublished" content="2025-11-18T02:28:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°jobleap"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147692910"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            fastapiçš„æœ€æ–°ç‰ˆæœ¬ï¼Œæä¾›äº†å“ªäº›æ–°apiå¯ä¾›ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147692910/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°jobleap
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:28:49.000Z" title="Tue Nov 18 2025 02:28:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯jobleap.cnçš„å°ä¹ï¼Œä»Šå¤©å­¦ä¹ FastAPIçš„ä½¿ç”¨ã€‚</p>
<p>FastAPI æˆªè‡³2025å¹´çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ä¸º <strong>0.110.0</strong>ï¼Œè¯¥ç‰ˆæœ¬åœ¨ä¾èµ–ç®¡ç†ã€WebSocketå¢å¼ºã€å“åº”æ¨¡å‹çµæ´»æ€§ç­‰æ–¹é¢å¼•å…¥äº†å¤šä¸ªå®ç”¨æ–°ç‰¹æ€§ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒæ–°APIåŠå…·ä½“ä»£ç ç¤ºä¾‹ï¼š</p>
<h3 data-id="heading-0">1. å…¨å±€ä¾èµ–ç®€åŒ–å®šä¹‰ï¼š<code>@app.dependency</code> è£…é¥°å™¨</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šæ›¿ä»£ä¼ ç»Ÿçš„ <code>app.dependencies.append(Depends(...))</code>ï¼Œæ›´ç›´è§‚åœ°å®šä¹‰å…¨å±€ä¾èµ–ï¼ˆæ‰€æœ‰è·¯å¾„æ“ä½œéƒ½ä¼šè‡ªåŠ¨è°ƒç”¨ï¼‰ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session
<span class="hljs-keyword">from</span> .database <span class="hljs-keyword">import</span> SessionLocal, get_db  <span class="hljs-comment"># å‡è®¾çš„æ•°æ®åº“ä¼šè¯å·¥å…·</span>

app = FastAPI()

<span class="hljs-comment"># æ–°è¯­æ³•ï¼šå®šä¹‰å…¨å±€ä¾èµ–ï¼ˆæ›¿ä»£ app.dependencies.append(Depends(get_db))ï¼‰</span>
<span class="hljs-meta">@app.dependency</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">global_db</span>() -&gt; Session:
    db = SessionLocal()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> db
    <span class="hljs-keyword">finally</span>:
        db.close()

<span class="hljs-comment"># æ‰€æœ‰è·¯å¾„æ“ä½œä¼šè‡ªåŠ¨è·å– db ä¾èµ–</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">db: Session = Depends(<span class="hljs-params">global_db</span>)</span>):  <span class="hljs-comment"># å¯ç›´æ¥ä½¿ç”¨å…¨å±€ä¾èµ–</span>
    <span class="hljs-keyword">return</span> db.query(Item).<span class="hljs-built_in">all</span>()  <span class="hljs-comment"># å‡è®¾ Item æ˜¯æ•°æ®åº“æ¨¡å‹</span>
</code></pre>
<h3 data-id="heading-1">2. WebSocket è®¤è¯è£…é¥°å™¨ï¼š<code>@app.websocket_auth</code></h3>
<p><strong>åŠŸèƒ½</strong>ï¼šä¸º WebSocket è¿æ¥æ·»åŠ ç»Ÿä¸€è®¤è¯é€»è¾‘ï¼Œæ›¿ä»£æ‰‹åŠ¨åœ¨ç«¯ç‚¹å†…å†™è®¤è¯ä»£ç ï¼Œç®€åŒ–æƒé™æ ¡éªŒã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, WebSocket, Depends
<span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> OAuth2PasswordBearer

app = FastAPI()
oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="hljs-string">"token"</span>)

<span class="hljs-comment"># è®¤è¯é€»è¾‘ï¼šéªŒè¯ token å¹¶è¿”å›ç”¨æˆ·</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_current_user</span>(<span class="hljs-params">token: <span class="hljs-built_in">str</span> = Depends(<span class="hljs-params">oauth2_scheme</span>)</span>):
    <span class="hljs-keyword">if</span> token != <span class="hljs-string">"secret"</span>:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">401</span>, detail=<span class="hljs-string">"æ— æ•ˆ token"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"username"</span>: <span class="hljs-string">"admin"</span>}

<span class="hljs-comment"># æ–°è£…é¥°å™¨ï¼šä¸º WebSocket ç»‘å®šè®¤è¯ä¾èµ–</span>
<span class="hljs-meta">@app.websocket(<span class="hljs-params"><span class="hljs-string">"/ws"</span></span>)</span>
<span class="hljs-meta">@app.websocket_auth(<span class="hljs-params">Depends(<span class="hljs-params">get_current_user</span>)</span>)  </span><span class="hljs-comment"># è‡ªåŠ¨æ‰§è¡Œè®¤è¯</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">websocket_endpoint</span>(<span class="hljs-params">websocket: WebSocket, user: <span class="hljs-built_in">dict</span></span>):  <span class="hljs-comment"># è®¤è¯åçš„ç”¨æˆ·ä¼šä¼ å…¥</span>
    <span class="hljs-keyword">await</span> websocket.accept()
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        data = <span class="hljs-keyword">await</span> websocket.receive_text()
        <span class="hljs-keyword">await</span> websocket.send_text(<span class="hljs-string">f"å·²è®¤è¯ç”¨æˆ· <span class="hljs-subst">{user[<span class="hljs-string">'username'</span>]}</span> å‘é€ï¼š<span class="hljs-subst">{data}</span>"</span>)
</code></pre>
<h3 data-id="heading-2">3. ä¾èµ–åˆ†ç»„ï¼š<code>Depends(..., group="åˆ†ç»„å")</code></h3>
<p><strong>åŠŸèƒ½</strong>ï¼šå¯¹ä¾èµ–è¿›è¡Œåˆ†ç»„ç®¡ç†ï¼Œæ–¹ä¾¿æ‰¹é‡æ§åˆ¶ä¾èµ–çš„æ‰§è¡Œé¡ºåºæˆ–æ¡ä»¶å¯ç”¨ï¼ˆä¾‹å¦‚â€œè®¤è¯ç›¸å…³ä¾èµ–â€â€œæ—¥å¿—ç›¸å…³ä¾èµ–â€ï¼‰ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends, HTTPException

app = FastAPI()

<span class="hljs-comment"># åˆ†ç»„ä¸º "auth" çš„ä¾èµ–ï¼šéªŒè¯ token</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_token</span>(<span class="hljs-params">token: <span class="hljs-built_in">str</span> = Header(<span class="hljs-params">...</span>)</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> token:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">401</span>, detail=<span class="hljs-string">"ç¼ºå°‘ token"</span>)
    <span class="hljs-keyword">return</span> token

<span class="hljs-comment"># åˆ†ç»„ä¸º "auth" çš„ä¾èµ–ï¼šæ£€æŸ¥æƒé™ï¼ˆä¾èµ–äº validate_tokenï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_admin_permission</span>(<span class="hljs-params">token: <span class="hljs-built_in">str</span> = Depends(<span class="hljs-params">validate_token, group=<span class="hljs-string">"auth"</span></span>)</span>):
    <span class="hljs-keyword">if</span> token != <span class="hljs-string">"admin_token"</span>:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">403</span>, detail=<span class="hljs-string">"æ— ç®¡ç†å‘˜æƒé™"</span>)

<span class="hljs-comment"># ä»…æ‰§è¡Œ "auth" åˆ†ç»„çš„ä¾èµ–ï¼ˆè‡ªåŠ¨æŒ‰é¡ºåºæ‰§è¡ŒåŒç»„ä¾èµ–ï¼‰</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/admin"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_operation</span>(<span class="hljs-params">
    _: <span class="hljs-literal">None</span> = Depends(<span class="hljs-params">group=<span class="hljs-string">"auth"</span></span>)  <span class="hljs-comment"># è§¦å‘æ•´ä¸ª "auth" åˆ†ç»„çš„ä¾èµ–</span>
</span>):
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"ç®¡ç†å‘˜æ“ä½œæˆåŠŸ"</span>}
</code></pre>
<h3 data-id="heading-3">4. å“åº”æ¨¡å‹åŠ¨æ€æ’é™¤ç©ºå€¼ï¼š<code>response_model_exclude_none</code> å‚æ•°</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šåœ¨è·¯å¾„æ“ä½œä¸­ç›´æ¥æ§åˆ¶å“åº”æ¨¡å‹æ˜¯å¦æ’é™¤ <code>None</code> å€¼ï¼ˆæ— éœ€åœ¨ Pydantic æ¨¡å‹ä¸­å…¨å±€é…ç½®ï¼‰ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>

app = FastAPI()

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    name: <span class="hljs-built_in">str</span>
    description: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># å¯é€‰å­—æ®µï¼Œå¯èƒ½ä¸º None</span>

<span class="hljs-comment"># æ–°å‚æ•°ï¼šresponse_model_exclude_none=True ä¼šè‡ªåŠ¨æ’é™¤å€¼ä¸º None çš„å­—æ®µ</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items/{item_id}"</span>, response_model=Item, response_model_exclude_none=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-comment"># è¿”å›çš„ description ä¸º Noneï¼Œä½†å“åº”ä¸­ä¼šè‡ªåŠ¨æ’é™¤</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"name"</span>: <span class="hljs-string">"ç”µè„‘"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-literal">None</span>}
</code></pre>
<p><strong>å“åº”ç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”µè„‘"</span><span class="hljs-punctuation">}</span>  # æ—  description å­—æ®µ
</code></pre>
<h3 data-id="heading-4">5. åŠ¨æ€æ ‡ç­¾ç”Ÿæˆï¼š<code>tags</code> æ”¯æŒå¯è°ƒç”¨å¯¹è±¡</h3>
<p><strong>åŠŸèƒ½</strong>ï¼š<code>@app.get</code> ç­‰è£…é¥°å™¨çš„ <code>tags</code> å‚æ•°æ”¯æŒä¼ å…¥å‡½æ•°ï¼ŒåŠ¨æ€ç”Ÿæˆæ¥å£æ ‡ç­¾ï¼ˆé€‚ç”¨äºæ‰¹é‡ç®¡ç†æ ‡ç­¾ï¼Œä¾‹å¦‚æŒ‰ç‰ˆæœ¬åˆ†ç»„ï¼‰ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI()

<span class="hljs-comment"># åŠ¨æ€ç”Ÿæˆæ ‡ç­¾çš„å‡½æ•°ï¼ˆä¾‹å¦‚æ ¹æ®ç‰ˆæœ¬å·ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_version_tags</span>(<span class="hljs-params">version: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> [<span class="hljs-string">f"v<span class="hljs-subst">{version}</span>"</span>]

<span class="hljs-comment"># tags ä¼ å…¥å‡½æ•°ï¼ŒåŠ¨æ€ç”Ÿæˆæ ‡ç­¾</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/v1/items"</span>, tags=get_version_tags(<span class="hljs-params"><span class="hljs-string">"1"</span></span>)</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_v1_items</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"version"</span>: <span class="hljs-string">"v1"</span>, <span class="hljs-string">"items"</span>: []}

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/v2/items"</span>, tags=get_version_tags(<span class="hljs-params"><span class="hljs-string">"2"</span></span>)</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_v2_items</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"version"</span>: <span class="hljs-string">"v2"</span>, <span class="hljs-string">"items"</span>: []}
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼šOpenAPI æ–‡æ¡£ä¸­ï¼Œä¸¤ä¸ªæ¥å£ä¼šåˆ†åˆ«æ˜¾ç¤ºåœ¨ <code>v1</code> å’Œ <code>v2</code> æ ‡ç­¾ä¸‹ã€‚</p>
<p>ä»¥ä¸Šæ–°ç‰¹æ€§å‡å·²åœ¨ FastAPI 0.110.0 ä¸­ç¨³å®šæ”¯æŒï¼Œä¸»è¦è§£å†³äº†ä¾èµ–ç®¡ç†ç¹çã€WebSocket è®¤è¯é‡å¤ç¼–ç ã€å“åº”æ¨¡å‹çµæ´»æ€§ä¸è¶³ç­‰é—®é¢˜ï¼Œè¿›ä¸€æ­¥æå‡äº†å¼€å‘æ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SOLO Coder å®è·µï½œç»™å¼€æºäº‘ç›˜ Cloudreve åŠ ä¸ª AI å¯¹è¯åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7573592127298240562</link>    <guid>https://juejin.cn/post/7573592127298240562</guid>    <pubDate>2025-11-18T02:56:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573592127298240562" data-draft-id="7573589277004054566" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SOLO Coder å®è·µï½œç»™å¼€æºäº‘ç›˜ Cloudreve åŠ ä¸ª AI å¯¹è¯åŠŸèƒ½"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-18T02:56:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SOLO Coder å®è·µï½œç»™å¼€æºäº‘ç›˜ Cloudreve åŠ ä¸ª AI å¯¹è¯åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T02:56:14.000Z" title="Tue Nov 18 2025 02:56:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/749b11d4371d4c8d9db419e6002f45bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=78kZMcKhdgLFxm8MEM9PpzEXJ3Q%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>ä½œè€…ä»‹ç»ï¼šåˆ˜æ˜Ÿè¾°ï¼ŒTRAE æŠ€æœ¯ä¸“å®¶</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d535a33641e14520857916eff5bb3bec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=a%2FQJZ%2FQY3mdn6dDP3kPUUCdltb0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>é¡¹ç›®èƒŒæ™¯</strong></h2>
<h3 data-id="heading-1"><strong>Cloudreve ç®€ä»‹</strong></h3>
<p><strong>é¡¹ç›®åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcloudreve%2Fcloudreve" target="_blank" title="https://github.com/cloudreve/cloudreve" ref="nofollow noopener noreferrer">github.com/cloudreve/câ€¦</a></p>
<p>Cloudreve æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„<strong>è‡ªæ‰˜ç®¡æ–‡ä»¶ç®¡ç†ä¸åˆ†äº«ç³»ç»Ÿ</strong>ï¼Œæ”¯æŒå°†æ–‡ä»¶å­˜å‚¨åˆ°å¤šç§äº‘æœåŠ¡ï¼ˆå¦‚æœ¬åœ°å­˜å‚¨ã€S3ã€OneDriveã€é˜¿é‡Œäº‘ OSSã€è…¾è®¯ COS ç­‰ï¼‰ã€‚è¯¥é¡¹ç›®æä¾›äº†å®Œæ•´çš„<strong>ç½‘é¡µç‰ˆç½‘ç›˜ä½“éªŒ</strong>ï¼ŒåŒ…æ‹¬æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ã€åœ¨çº¿é¢„è§ˆã€åˆ†äº«é“¾æ¥ã€å¤šç”¨æˆ·ä¸åˆ†ç»„ç®¡ç†ï¼Œä»¥åŠ WebDAV æ¥å…¥ç­‰åŠŸèƒ½ã€‚</p>
<p><strong>é¡¹ç›®äº®ç‚¹åŒ…æ‹¬ï¼š</strong></p>
<ul>
<li>
<p>æ”¯æŒå¤šç§äº‘å­˜å‚¨æœåŠ¡çš„ç»Ÿä¸€ç®¡ç†</p>
</li>
<li>
<p>å‰åç«¯ä¸€ä½“åŒ–çš„è‡ªéƒ¨ç½²æ–¹æ¡ˆï¼ˆGo + React æŠ€æœ¯æ ˆï¼‰</p>
</li>
<li>
<p>æ–‡ä»¶åŠ å¯†ã€å‹ç¼©ã€æ–­ç‚¹ç»­ä¼ ã€åœ¨çº¿é¢„è§ˆç­‰åŠŸèƒ½é½å…¨</p>
</li>
<li>
<p>é€‚ç”¨äºä¸ªäººç½‘ç›˜ã€å›¢é˜Ÿæ–‡ä»¶åä½œã€è½»é‡çº§ç§æœ‰äº‘ç­‰åœºæ™¯</p>
</li>
</ul>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong> ğŸŒ©ï¸ Cloudreve æ˜¯ä¸€ä¸ªå¼€æºçš„ã€å¯è‡ªå·±æ­å»ºçš„å¤šäº‘æ–‡ä»¶ç®¡ç†å¹³å°ï¼Œè®©ä½ æ‹¥æœ‰å±äºè‡ªå·±çš„ã€Œç½‘ç›˜ç³»ç»Ÿã€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d08a57f7abc4bb181e0c73b6b3efb62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=F6PKwP4M0c06mO%2F9q6CLcx2ORCI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf5c0109a0db4f279ca542a3a54a5f6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=BFSrSB8pLgq%2BQ%2Bfo%2B2E5%2B9mSf68%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>é¡¹ç›®ç†è§£</strong></h2>
<p>é¢å¯¹ä¸€ä¸ªé™Œç”Ÿçš„å¼€æºé¡¹ç›®ï¼Œå¦‚ä½•å¿«é€Ÿä¸Šæ‰‹ï¼Ÿå¯ä»¥ç›´æ¥æŠŠé—®é¢˜äº¤ç»™ SOLO Coderï¼Œè®©å®ƒæŠŠå¤æ‚çš„é¡¹ç›®æ‹†è§£ä¸ºå¯ç†è§£çš„æ¨¡å—ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/344587d235224e0d8d7c3987949168bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=llbRSP3KUJJz1nSjzlrcz4tdBD4%3D" alt="" loading="lazy"/></p>
<p>æ ¹æ®ä»»åŠ¡æ‹†è§£ï¼ŒCoder å†™äº† 6 ç¯‡æŠ€æœ¯æŠ¥å‘Šï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c75b056c81fc418bbc9086826b2c89b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=payXeh7PkBbW7lEMBVd2Xm5vd8k%3D" alt="" loading="lazy"/></p>
<p>é¦–å…ˆéœ€è¦ç†è§£é¡¹ç›®çš„å®è§‚ç»“æ„ã€‚Coder ç»˜åˆ¶äº†æ•´ä½“æ¶æ„åˆ†ææ–‡æ¡£ï¼Œæ¶µç›–æŠ€æœ¯æ ˆã€éƒ¨ç½²æ–¹å¼å’Œæ•°æ®æµç¨‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1214c883383a4896b1768bca7f43b310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=hs1y0GhCbgFkHwU1azRvxixbh3A%3D" alt="" loading="lazy"/></p>
<p>ä»¥ä¸‹æ˜¯æ–‡æ¡£å®Œæ•´å†…å®¹ï¼š</p>
<h3 data-id="heading-3"><strong>01-project-overview.md - é¡¹ç›®æ•´ä½“æ¶æ„æ¦‚è§ˆ</strong></h3>
<ul>
<li>
<p>æŠ€æœ¯æ ˆåˆ†æï¼ˆReact + Go + æ•°æ®åº“ï¼‰</p>
</li>
<li>
<p>éƒ¨ç½²æ¶æ„å›¾å’Œæ•°æ®æµç¨‹</p>
</li>
<li>
<p>æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ä»‹ç»</p>
</li>
</ul>

<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Cloudreve é¡¹ç›®æ•´ä½“æ¶æ„åˆ†æ</span>

<span class="hljs-section">## é¡¹ç›®æ¦‚è¿°</span>

Cloudreve æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„è‡ªæ‰˜ç®¡ç½‘ç›˜ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼Œæä¾›å®Œæ•´çš„æ–‡ä»¶ç®¡ç†ã€åˆ†äº«ã€ç”¨æˆ·ç®¡ç†ç­‰åŠŸèƒ½ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚

<span class="hljs-section">## æŠ€æœ¯æ ˆæ€»è§ˆ</span>

<span class="hljs-section">### å‰ç«¯æŠ€æœ¯æ ˆ</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ¡†æ¶**</span>: React 18 + TypeScript
<span class="hljs-bullet">-</span> <span class="hljs-strong">**UI åº“**</span>: Material-UI (MUI) v6
<span class="hljs-bullet">-</span> <span class="hljs-strong">**çŠ¶æ€ç®¡ç†**</span>: Redux Toolkit
<span class="hljs-bullet">-</span> <span class="hljs-strong">**è·¯ç”±**</span>: React Router v6
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ„å»ºå·¥å…·**</span>: Vite
<span class="hljs-bullet">-</span> <span class="hljs-strong">**HTTP å®¢æˆ·ç«¯**</span>: Axios
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ‹–æ‹½**</span>: React DnD
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å›½é™…åŒ–**</span>: i18next

<span class="hljs-section">### åç«¯æŠ€æœ¯æ ˆ</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**è¯­è¨€**</span>: Go 1.23
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Web æ¡†æ¶**</span>: Gin
<span class="hljs-bullet">-</span> <span class="hljs-strong">**ORM**</span>: Ent (Facebook å¼€æºçš„ Go ORM)
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ•°æ®åº“**</span>: æ”¯æŒ MySQLã€PostgreSQLã€SQLite
<span class="hljs-bullet">-</span> <span class="hljs-strong">**è®¤è¯**</span>: JWT + Session
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ–‡ä»¶å­˜å‚¨**</span>: æ”¯æŒæœ¬åœ°ã€é˜¿é‡Œäº‘ OSSã€AWS S3ã€è…¾è®¯äº‘ COS ç­‰
<span class="hljs-bullet">-</span> <span class="hljs-strong">**ä»»åŠ¡é˜Ÿåˆ—**</span>: å†…ç½®ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

<span class="hljs-section">## é¡¹ç›®ç»“æ„</span>

<span class="hljs-code">```mermaid
graph TB
    subgraph "Cloudreve é¡¹ç›®ç»“æ„"
        A[æ ¹ç›®å½•] --&gt; B[Cloudreve/]
        A --&gt; C[assets/]
        A --&gt; D[.trae/]
        
        B --&gt; B1[main.go - å…¥å£æ–‡ä»¶]
        B --&gt; B2[routers/ - è·¯ç”±å±‚]
        B --&gt; B3[service/ - ä¸šåŠ¡é€»è¾‘å±‚]
        B --&gt; B4[ent/ - æ•°æ®æ¨¡å‹å±‚]
        B --&gt; B5[pkg/ - å·¥å…·åŒ…]
        B --&gt; B6[middleware/ - ä¸­é—´ä»¶]
        B --&gt; B7[inventory/ - åº“å­˜ç®¡ç†]
        B --&gt; B8[application/ - åº”ç”¨é…ç½®]
        
        C --&gt; C1[src/ - å‰ç«¯æºç ]
        C --&gt; C2[assets/ - é™æ€èµ„æº]
        C --&gt; C3[locales/ - å›½é™…åŒ–æ–‡ä»¶]
        
        C1 --&gt; C11[component/ - React ç»„ä»¶]
        C1 --&gt; C12[redux/ - çŠ¶æ€ç®¡ç†]
        C1 --&gt; C13[api/ - API æ¥å£]
        C1 --&gt; C14[router/ - å‰ç«¯è·¯ç”±]
        C1 --&gt; C15[session/ - ä¼šè¯ç®¡ç†]
    end
```</span>

<span class="hljs-section">## æ ¸å¿ƒæ¶æ„è®¾è®¡</span>

<span class="hljs-section">### 1. åˆ†å±‚æ¶æ„</span>

<span class="hljs-code">```mermaid
graph TB
    subgraph "åç«¯åˆ†å±‚æ¶æ„"
        A[è·¯ç”±å±‚ - routers/] --&gt; B[æ§åˆ¶å™¨å±‚ - controllers/]
        B --&gt; C[æœåŠ¡å±‚ - service/]
        C --&gt; D[æ•°æ®è®¿é—®å±‚ - ent/]
        D --&gt; E[æ•°æ®åº“]
        
        F[ä¸­é—´ä»¶å±‚ - middleware/] --&gt; B
        G[å·¥å…·åŒ… - pkg/] --&gt; C
    end
```</span>

<span class="hljs-section">### 2. å‰ç«¯ç»„ä»¶æ¶æ„</span>

<span class="hljs-code">```mermaid
graph TB
    subgraph "å‰ç«¯ç»„ä»¶æ¶æ„"
        A[App.tsx - æ ¹ç»„ä»¶] --&gt; B[Frame/ - æ¡†æ¶ç»„ä»¶]
        A --&gt; C[Pages/ - é¡µé¢ç»„ä»¶]
        
        B --&gt; B1[NavBarFrame - å¯¼èˆªæ¡†æ¶]
        B --&gt; B2[HeadlessFrame - æ— å¤´æ¡†æ¶]
        
        B1 --&gt; B11[TopAppBar - é¡¶éƒ¨æ ]
        B1 --&gt; B12[AppDrawer - ä¾§è¾¹æ ]
        B1 --&gt; B13[AppMain - ä¸»å†…å®¹åŒº]
        
        C --&gt; C1[FileManager/ - æ–‡ä»¶ç®¡ç†å™¨]
        C --&gt; C2[Login/ - ç™»å½•é¡µé¢]
        C --&gt; C3[Admin/ - ç®¡ç†é¡µé¢]
        
        C1 --&gt; C11[Explorer/ - æ–‡ä»¶æµè§ˆå™¨]
        C1 --&gt; C12[Uploader/ - æ–‡ä»¶ä¸Šä¼ å™¨]
        C1 --&gt; C13[Viewers/ - æ–‡ä»¶æŸ¥çœ‹å™¨]
    end
```</span>

<span class="hljs-section">## éƒ¨ç½²æ¶æ„</span>

Cloudreve æ”¯æŒä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š

<span class="hljs-section">### 1. å•æœºæ¨¡å¼ (Master Mode)</span>
<span class="hljs-code">```mermaid
graph LR
    A[ç”¨æˆ·] --&gt; B[Nginx/åå‘ä»£ç†]
    B --&gt; C[Cloudreve ä¸»èŠ‚ç‚¹]
    C --&gt; D[æ•°æ®åº“]
    C --&gt; E[æ–‡ä»¶å­˜å‚¨]
```</span>

<span class="hljs-section">### 2. é›†ç¾¤æ¨¡å¼ (Master-Slave Mode)</span>
<span class="hljs-code">```mermaid
graph TB
    A[ç”¨æˆ·] --&gt; B[è´Ÿè½½å‡è¡¡å™¨]
    B --&gt; C[Cloudreve ä¸»èŠ‚ç‚¹]
    B --&gt; D[Cloudreve ä»èŠ‚ç‚¹ 1]
    B --&gt; E[Cloudreve ä»èŠ‚ç‚¹ 2]
    
    C --&gt; F[å…±äº«æ•°æ®åº“]
    D --&gt; G[æœ¬åœ°å­˜å‚¨ 1]
    E --&gt; H[æœ¬åœ°å­˜å‚¨ 2]
    
    C -.-&gt; D
    C -.-&gt; E
```</span>

<span class="hljs-section">## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</span>

<span class="hljs-section">### 1. ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</span>
<span class="hljs-bullet">-</span> ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†
<span class="hljs-bullet">-</span> ç”¨æˆ·ç»„ç®¡ç†
<span class="hljs-bullet">-</span> å­˜å‚¨é…é¢ç®¡ç†
<span class="hljs-bullet">-</span> 2FA åŒå› å­è®¤è¯
<span class="hljs-bullet">-</span> Passkey æ”¯æŒ

<span class="hljs-section">### 2. æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</span>
<span class="hljs-bullet">-</span> æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆ
<span class="hljs-bullet">-</span> æ–‡ä»¶å¤¹ç®¡ç†
<span class="hljs-bullet">-</span> æ–‡ä»¶åˆ†äº«ï¼ˆå…¬å¼€/ç§å¯†ï¼‰
<span class="hljs-bullet">-</span> æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
<span class="hljs-bullet">-</span> æ‰¹é‡æ“ä½œ

<span class="hljs-section">### 3. å­˜å‚¨ç³»ç»Ÿ</span>
<span class="hljs-bullet">-</span> å¤šå­˜å‚¨åç«¯æ”¯æŒ
<span class="hljs-bullet">-</span> å­˜å‚¨ç­–ç•¥ç®¡ç†
<span class="hljs-bullet">-</span> æ–‡ä»¶åŠ å¯†
<span class="hljs-bullet">-</span> ç¼©ç•¥å›¾ç”Ÿæˆ
<span class="hljs-bullet">-</span> åª’ä½“å…ƒæ•°æ®æå–

<span class="hljs-section">### 4. ä»»åŠ¡ç³»ç»Ÿ</span>
<span class="hljs-bullet">-</span> å¼‚æ­¥ä»»åŠ¡å¤„ç†
<span class="hljs-bullet">-</span> ç¦»çº¿ä¸‹è½½
<span class="hljs-bullet">-</span> æ–‡ä»¶å‹ç¼©/è§£å‹
<span class="hljs-bullet">-</span> å®šæ—¶ä»»åŠ¡

<span class="hljs-section">### 5. èŠå¤©ç³»ç»Ÿ (å·²å®ç°)</span>
<span class="hljs-bullet">-</span> OpenRouter API é›†æˆ
<span class="hljs-bullet">-</span> æµå¼å¯¹è¯æ”¯æŒ
<span class="hljs-bullet">-</span> å¤šæ¨¡æ€æ–‡ä»¶å¤„ç†
<span class="hljs-bullet">-</span> æ–‡ä»¶ä¸Šä¸‹æ–‡åˆ†æ

<span class="hljs-section">## æ•°æ®æµæ¶æ„</span>

<span class="hljs-code">```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯ (React)
    participant R as è·¯ç”±å±‚ (Gin)
    participant S as æœåŠ¡å±‚
    participant D as æ•°æ®å±‚ (Ent)
    participant DB as æ•°æ®åº“

    U-&gt;&gt;F: ç”¨æˆ·æ“ä½œ
    F-&gt;&gt;R: HTTP è¯·æ±‚
    R-&gt;&gt;R: ä¸­é—´ä»¶å¤„ç† (è®¤è¯/æˆæƒ)
    R-&gt;&gt;S: è°ƒç”¨ä¸šåŠ¡æœåŠ¡
    S-&gt;&gt;D: æ•°æ®æ“ä½œ
    D-&gt;&gt;DB: SQL æŸ¥è¯¢
    DB--&gt;&gt;D: è¿”å›æ•°æ®
    D--&gt;&gt;S: è¿”å›å®ä½“
    S--&gt;&gt;R: è¿”å›ç»“æœ
    R--&gt;&gt;F: JSON å“åº”
    F--&gt;&gt;U: æ›´æ–°ç•Œé¢
```</span>

<span class="hljs-section">## å…³é”®è®¾è®¡ç‰¹ç‚¹</span>

<span class="hljs-section">### 1. æ¨¡å—åŒ–è®¾è®¡</span>
<span class="hljs-bullet">-</span> å‰åç«¯å®Œå…¨åˆ†ç¦»
<span class="hljs-bullet">-</span> ç»„ä»¶åŒ–å¼€å‘
<span class="hljs-bullet">-</span> æ’ä»¶å¼å­˜å‚¨åç«¯
<span class="hljs-bullet">-</span> ä¸­é—´ä»¶æ¶æ„

<span class="hljs-section">### 2. å¯æ‰©å±•æ€§</span>
<span class="hljs-bullet">-</span> æ”¯æŒé›†ç¾¤éƒ¨ç½²
<span class="hljs-bullet">-</span> æ°´å¹³æ‰©å±•èƒ½åŠ›
<span class="hljs-bullet">-</span> æ’ä»¶ç³»ç»Ÿ
<span class="hljs-bullet">-</span> API ç‰ˆæœ¬ç®¡ç†

<span class="hljs-section">### 3. å®‰å…¨æ€§</span>
<span class="hljs-bullet">-</span> JWT è®¤è¯
<span class="hljs-bullet">-</span> RBAC æƒé™æ§åˆ¶
<span class="hljs-bullet">-</span> æ–‡ä»¶åŠ å¯†
<span class="hljs-bullet">-</span> CSRF ä¿æŠ¤
<span class="hljs-bullet">-</span> è¾“å…¥éªŒè¯

<span class="hljs-section">### 4. æ€§èƒ½ä¼˜åŒ–</span>
<span class="hljs-bullet">-</span> ç¼“å­˜æœºåˆ¶
<span class="hljs-bullet">-</span> å¼‚æ­¥ä»»åŠ¡å¤„ç†
<span class="hljs-bullet">-</span> æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
<span class="hljs-bullet">-</span> CDN æ”¯æŒ
<span class="hljs-bullet">-</span> æ•°æ®åº“è¿æ¥æ± 

<span class="hljs-section">## å¼€å‘ç¯å¢ƒè¦æ±‚</span>

<span class="hljs-section">### å‰ç«¯å¼€å‘</span>
<span class="hljs-bullet">-</span> Node.js 18+
<span class="hljs-bullet">-</span> npm æˆ– yarn
<span class="hljs-bullet">-</span> ç°ä»£æµè§ˆå™¨

<span class="hljs-section">### åç«¯å¼€å‘</span>
<span class="hljs-bullet">-</span> Go 1.23+
<span class="hljs-bullet">-</span> æ•°æ®åº“ (MySQL/PostgreSQL/SQLite)
<span class="hljs-bullet">-</span> Redis (å¯é€‰ï¼Œç”¨äºç¼“å­˜)

<span class="hljs-section">## é¡¹ç›®ç‰¹è‰²åŠŸèƒ½</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**å¤šå­˜å‚¨åç«¯**</span>: æ”¯æŒæœ¬åœ°ã€äº‘å­˜å‚¨ç­‰å¤šç§å­˜å‚¨æ–¹å¼
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**WebDAV æ”¯æŒ**</span>: å¯é€šè¿‡ WebDAV åè®®è®¿é—®æ–‡ä»¶
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**Office åœ¨çº¿ç¼–è¾‘**</span>: é›†æˆ WOPI åè®®æ”¯æŒ Office æ–‡æ¡£åœ¨çº¿ç¼–è¾‘
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**åª’ä½“å¤„ç†**</span>: æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘çš„é¢„è§ˆå’Œå…ƒæ•°æ®æå–
<span class="hljs-bullet">5.</span> <span class="hljs-strong">**ç¦»çº¿ä¸‹è½½**</span>: æ”¯æŒ Aria2 ç¦»çº¿ä¸‹è½½
<span class="hljs-bullet">6.</span> <span class="hljs-strong">**æ–‡ä»¶åˆ†äº«**</span>: çµæ´»çš„æ–‡ä»¶åˆ†äº«æœºåˆ¶
<span class="hljs-bullet">7.</span> <span class="hljs-strong">**AI èŠå¤©**</span>: é›†æˆ OpenRouter API çš„æ™ºèƒ½å¯¹è¯åŠŸèƒ½

<span class="hljs-section">## æ€»ç»“</span>

Cloudreve æ˜¯ä¸€ä¸ªæ¶æ„æ¸…æ™°ã€åŠŸèƒ½å®Œæ•´çš„ç°ä»£åŒ–ç½‘ç›˜ç³»ç»Ÿã€‚å…¶å‰åç«¯åˆ†ç¦»çš„è®¾è®¡ã€æ¨¡å—åŒ–çš„æ¶æ„ã€ä»¥åŠä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¸ºå¼€å‘è€…æä¾›äº†è‰¯å¥½çš„æ‰©å±•åŸºç¡€ã€‚ç‰¹åˆ«æ˜¯å·²ç»å®ç°çš„èŠå¤©åŠŸèƒ½ï¼Œä¸ºä½ è¦å¼€å‘çš„ä¾§è¾¹æ å¯¹è¯åŠŸèƒ½æä¾›äº†å¾ˆå¥½çš„å‚è€ƒå’ŒåŸºç¡€ã€‚

ä¸‹ä¸€æ­¥å»ºè®®æ·±å…¥äº†è§£å‰ç«¯ç»„ä»¶æ¶æ„å’Œåç«¯æœåŠ¡å±‚çš„å…·ä½“å®ç°ï¼Œè¿™å°†æœ‰åŠ©äºä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨ç°æœ‰æ¶æ„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½ã€‚
</code></pre>
<h3 data-id="heading-4"><strong>02-frontend-architecture.md - å‰ç«¯æ¶æ„è¯¦è§£</strong></h3>
<ul>
<li>
<p>React + TypeScript + Material-UI æŠ€æœ¯æ ˆ</p>
</li>
<li>
<p>ç»„ä»¶å±‚æ¬¡ç»“æ„å’ŒçŠ¶æ€ç®¡ç†</p>
</li>
<li>
<p>è·¯ç”±ç³»ç»Ÿå’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥</p>
</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Cloudreve å‰ç«¯æ¶æ„å­¦ä¹ æŒ‡å—</span>

<span class="hljs-comment">## å‰ç«¯æŠ€æœ¯æ ˆè¯¦è§£</span>

<span class="hljs-comment">### æ ¸å¿ƒæŠ€æœ¯æ ˆ</span>
- **React 18**: ä½¿ç”¨æœ€æ–°çš„ React ç‰¹æ€§ï¼ŒåŒ…æ‹¬ Hooksã€Suspenseã€Concurrent Features
- **TypeScript**: æä¾›ç±»å‹å®‰å…¨å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒ
- **Material-UI (MUI) v6**: Google Material Design è®¾è®¡è¯­è¨€çš„ React å®ç°
- **Redux Toolkit**: ç°ä»£åŒ–çš„ Redux çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆ
- **React Router v6**: å£°æ˜å¼è·¯ç”±ç®¡ç†
- **Vite**: å¿«é€Ÿçš„æ„å»ºå·¥å…·å’Œå¼€å‘æœåŠ¡å™¨

<span class="hljs-comment">### å¼€å‘å·¥å…·é“¾</span>
- **ESLint**: ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Husky**: Git hooks ç®¡ç†
- **TypeScript**: é™æ€ç±»å‹æ£€æŸ¥

<span class="hljs-comment">## é¡¹ç›®ç»“æ„è¯¦è§£</span>

```
assets/src/
â”œâ”€â”€ component/           <span class="hljs-comment"># React ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Common/         <span class="hljs-comment"># é€šç”¨ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Frame/          <span class="hljs-comment"># æ¡†æ¶ç»„ä»¶</span>
â”‚   â”œâ”€â”€ FileManager/    <span class="hljs-comment"># æ–‡ä»¶ç®¡ç†å™¨ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Pages/          <span class="hljs-comment"># é¡µé¢ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Admin/          <span class="hljs-comment"># ç®¡ç†åå°ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Viewers/        <span class="hljs-comment"># æ–‡ä»¶æŸ¥çœ‹å™¨ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Uploader/       <span class="hljs-comment"># æ–‡ä»¶ä¸Šä¼ ç»„ä»¶</span>
â”‚   â”œâ”€â”€ Icons/          <span class="hljs-comment"># å›¾æ ‡ç»„ä»¶</span>
â”‚   â””â”€â”€ Dialogs/        <span class="hljs-comment"># å¯¹è¯æ¡†ç»„ä»¶</span>
â”œâ”€â”€ redux/              <span class="hljs-comment"># çŠ¶æ€ç®¡ç†</span>
â”‚   â”œâ”€â”€ hooks.ts        <span class="hljs-comment"># Redux hooks</span>
â”‚   â”œâ”€â”€ store.ts        <span class="hljs-comment"># Store é…ç½®</span>
â”‚   â””â”€â”€ slices/         <span class="hljs-comment"># Redux slices</span>
â”œâ”€â”€ api/                <span class="hljs-comment"># API æ¥å£</span>
â”‚   â”œâ”€â”€ api.ts          <span class="hljs-comment"># API å‡½æ•°</span>
â”‚   â”œâ”€â”€ request.ts      <span class="hljs-comment"># è¯·æ±‚å°è£…</span>
â”‚   â””â”€â”€ types.ts        <span class="hljs-comment"># ç±»å‹å®šä¹‰</span>
â”œâ”€â”€ router/             <span class="hljs-comment"># è·¯ç”±é…ç½®</span>
â”œâ”€â”€ session/            <span class="hljs-comment"># ä¼šè¯ç®¡ç†</span>
â”œâ”€â”€ util/               <span class="hljs-comment"># å·¥å…·å‡½æ•°</span>
â””â”€â”€ App.tsx             <span class="hljs-comment"># æ ¹ç»„ä»¶</span>
```

<span class="hljs-comment">## ç»„ä»¶æ¶æ„è®¾è®¡</span>

<span class="hljs-comment">### 1. æ¡†æ¶ç»„ä»¶å±‚æ¬¡ç»“æ„</span>

```mermaid
graph TB
    subgraph "æ¡†æ¶ç»„ä»¶æ¶æ„"
        A<span class="hljs-section">[App.tsx]</span> --&gt; B<span class="hljs-section">[NavBarFrame]</span>
        A --&gt; C<span class="hljs-section">[HeadlessFrame]</span>
        
        B --&gt; D<span class="hljs-section">[TopAppBar]</span>
        B --&gt; E<span class="hljs-section">[AppDrawer]</span>
        B --&gt; F<span class="hljs-section">[AppMain]</span>
        
        D --&gt; D1<span class="hljs-section">[UserAction]</span>
        D --&gt; D2<span class="hljs-section">[SearchBar]</span>
        D --&gt; D3<span class="hljs-section">[NavBarMainActions]</span>
        
        E --&gt; E1<span class="hljs-section">[SideNavItem]</span>
        E --&gt; E2<span class="hljs-section">[StorageSummary]</span>
        E --&gt; E3<span class="hljs-section">[PageNavigation]</span>
        
        F --&gt; F1<span class="hljs-section">[FileManager]</span>
        F --&gt; F2<span class="hljs-section">[Pages]</span>
        F --&gt; F3<span class="hljs-section">[Admin]</span>
    end
```

<span class="hljs-comment">### 2. æ–‡ä»¶ç®¡ç†å™¨ç»„ä»¶ç»“æ„</span>

```mermaid
graph TB
    subgraph "æ–‡ä»¶ç®¡ç†å™¨ç»„ä»¶"
        A<span class="hljs-section">[FileManager]</span> --&gt; B<span class="hljs-section">[TopBar]</span>
        A --&gt; C<span class="hljs-section">[Explorer]</span>
        A --&gt; D<span class="hljs-section">[Uploader]</span>
        A --&gt; E<span class="hljs-section">[Viewers]</span>
        A --&gt; F<span class="hljs-section">[Dialogs]</span>
        
        B --&gt; B1<span class="hljs-section">[Breadcrumb]</span>
        B --&gt; B2<span class="hljs-section">[TopActions]</span>
        B --&gt; B3<span class="hljs-section">[ViewOptions]</span>
        
        C --&gt; C1<span class="hljs-section">[FileList]</span>
        C --&gt; C2<span class="hljs-section">[ContextMenu]</span>
        C --&gt; C3<span class="hljs-section">[DragDrop]</span>
        
        D --&gt; D1<span class="hljs-section">[UploadQueue]</span>
        D --&gt; D2<span class="hljs-section">[ProgressBar]</span>
        
        E --&gt; E1<span class="hljs-section">[ImageViewer]</span>
        E --&gt; E2<span class="hljs-section">[VideoPlayer]</span>
        E --&gt; E3<span class="hljs-section">[DocumentViewer]</span>
        
        F --&gt; F1<span class="hljs-section">[CreateNew]</span>
        F --&gt; F2<span class="hljs-section">[ShareDialog]</span>
        F --&gt; F3<span class="hljs-section">[DeleteConfirm]</span>
    end
```

<span class="hljs-comment">## çŠ¶æ€ç®¡ç†æ¶æ„</span>

<span class="hljs-comment">### Redux Store ç»“æ„</span>

```typescript
// store.ts æ ¸å¿ƒé…ç½®
export const <span class="hljs-attr">store</span> = configureStore({
  reducer: {
    // å…¨å±€çŠ¶æ€
    globalState: globalStateSlice.reducer,
    // æ–‡ä»¶ç®¡ç†å™¨çŠ¶æ€
    explorer: explorerSlice.reducer,
    // ç”¨æˆ·çŠ¶æ€
    user: userSlice.reducer,
    // ä¸Šä¼ çŠ¶æ€
    uploader: uploaderSlice.reducer,
    // å¯¹è¯æ¡†çŠ¶æ€
    dialog: dialogSlice.reducer,
  },
  middleware: (getDefaultMiddleware) =&gt;
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: <span class="hljs-section">[FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER]</span>,
      },
    }),
})<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### çŠ¶æ€ç®¡ç†æ¨¡å¼</span>

```mermaid
graph LR
    subgraph "Redux æ•°æ®æµ"
        A<span class="hljs-section">[Component]</span> --&gt; B<span class="hljs-section">[Action]</span>
        B --&gt; C<span class="hljs-section">[Reducer]</span>
        C --&gt; D<span class="hljs-section">[Store]</span>
        D --&gt; A
        
        E<span class="hljs-section">[Middleware]</span> --&gt; C
        F<span class="hljs-section">[DevTools]</span> --&gt; D
    end
```

<span class="hljs-comment">### ä¸»è¦ Slice è¯´æ˜</span>

<span class="hljs-comment">#### 1. globalStateSlice</span>
```typescript
interface GlobalState {
  // ä¾§è¾¹æ çŠ¶æ€
  drawerOpen: boolean<span class="hljs-comment">;</span>
  mobileDrawerOpen: boolean<span class="hljs-comment">;</span>
  // ä¸»é¢˜è®¾ç½®
  theme: 'light' | 'dark' | 'auto'<span class="hljs-comment">;</span>
  // è¯­è¨€è®¾ç½®
  language: string<span class="hljs-comment">;</span>
  // åŠ è½½çŠ¶æ€
  loading: boolean<span class="hljs-comment">;</span>
}
```

<span class="hljs-comment">#### 2. explorerSlice</span>
```typescript
interface ExplorerState {
  // å½“å‰è·¯å¾„
  currentPath: string<span class="hljs-comment">;</span>
  // æ–‡ä»¶åˆ—è¡¨
  files: FileResponse<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  // é€‰ä¸­çš„æ–‡ä»¶
  selectedFiles: string<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  // è§†å›¾æ¨¡å¼
  viewMode: 'list' | 'grid' | 'small'<span class="hljs-comment">;</span>
  // æ’åºæ–¹å¼
  sortBy: string<span class="hljs-comment">;</span>
  sortOrder: 'asc' | 'desc'<span class="hljs-comment">;</span>
}
```

<span class="hljs-comment">## è·¯ç”±ç³»ç»Ÿ</span>

<span class="hljs-comment">### è·¯ç”±é…ç½®ç»“æ„</span>

```typescript
// router/index.tsx
export const <span class="hljs-attr">router</span> = createBrowserRouter([
  {
    path: <span class="hljs-string">"/"</span>,
    element: &lt;App /&gt;,
    errorElement: &lt;ErrorBoundary /&gt;,
    children: [
      { path: <span class="hljs-string">"/"</span>, element: &lt;HomeRedirect /&gt; },
      {
        path: <span class="hljs-string">"/"</span>,
        element: &lt;HeadlessFrame /&gt;,
        children: [
          // ç™»å½•ç›¸å…³è·¯ç”±
          {
            path: <span class="hljs-string">"/session"</span>,
            element: &lt;SessionIntro /&gt;,
            children: [
              { path: <span class="hljs-string">"/session"</span>, element: &lt;SignIn /&gt; },
              { path: <span class="hljs-string">"signup"</span>, element: &lt;SignUp /&gt; },
              { path: <span class="hljs-string">"activate"</span>, element: &lt;Activate /&gt; },
              { path: <span class="hljs-string">"reset"</span>, element: &lt;Reset /&gt; },
            ],
          },
        ],
      },
    ],
  },
])<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### è·¯ç”±å®ˆå«æœºåˆ¶</span>

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant R as Router
    participant A as Auth Guard
    participant S as Session
    participant C as Component

    U-&gt;&gt;R: è®¿é—®è·¯ç”±
    R-&gt;&gt;A: æ£€æŸ¥æƒé™
    A-&gt;&gt;S: éªŒè¯ä¼šè¯
    alt å·²ç™»å½•
        S--&gt;&gt;A: è¿”å›ç”¨æˆ·ä¿¡æ¯
        A--&gt;&gt;R: å…è®¸è®¿é—®
        R-&gt;&gt;C: æ¸²æŸ“ç»„ä»¶
        C--&gt;&gt;U: æ˜¾ç¤ºé¡µé¢
    else æœªç™»å½•
        S--&gt;&gt;A: è¿”å›æœªè®¤è¯
        A--&gt;&gt;R: é‡å®šå‘ç™»å½•
        R-&gt;&gt;U: è·³è½¬ç™»å½•é¡µ
    end
```

<span class="hljs-comment">## ç»„ä»¶è®¾è®¡æ¨¡å¼</span>

<span class="hljs-comment">### 1. å®¹å™¨ç»„ä»¶ vs å±•ç¤ºç»„ä»¶</span>

```typescript
// å®¹å™¨ç»„ä»¶ - è´Ÿè´£æ•°æ®å’Œé€»è¾‘
const FileManagerContainer: <span class="hljs-attr">React.FC</span> = () =&gt; {
  const <span class="hljs-attr">dispatch</span> = useAppDispatch()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">files</span> = useAppSelector(state =&gt; state.explorer.files)<span class="hljs-comment">;</span>
  
  const <span class="hljs-attr">handleFileSelect</span> = (fileId: string) =&gt; {
    dispatch(selectFile(fileId))<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
  
  return (
    &lt;FileList 
      <span class="hljs-attr">files</span>={files}
      <span class="hljs-attr">onFileSelect</span>={handleFileSelect}
    /&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// å±•ç¤ºç»„ä»¶ - è´Ÿè´£ UI æ¸²æŸ“
interface FileListProps {
  files: FileResponse<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  onFileSelect: (fileId: string) =&gt; void<span class="hljs-comment">;</span>
}

const FileList: React.FC&lt;FileListProps&gt; = ({ files, onFileSelect }) =&gt; {
  return (
    &lt;List&gt;
      {files.map(<span class="hljs-attr">file</span> =&gt; (
        &lt;FileItem 
          <span class="hljs-attr">key</span>={file.id}
          <span class="hljs-attr">file</span>={file}
          <span class="hljs-attr">onClick</span>={() =&gt; <span class="hljs-literal">on</span>FileSelect(file.id)}
        /&gt;
      ))}
    &lt;/List&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### 2. è‡ªå®šä¹‰ Hooks</span>

```typescript
// hooks/useFileManager.ts
export const <span class="hljs-attr">useFileManager</span> = () =&gt; {
  const <span class="hljs-attr">dispatch</span> = useAppDispatch()<span class="hljs-comment">;</span>
  const { files, currentPath, loading } = useAppSelector(<span class="hljs-attr">state</span> =&gt; state.explorer)<span class="hljs-comment">;</span>
  
  const <span class="hljs-attr">loadFiles</span> = useCallback(async (path: string) =&gt; {
    dispatch(setLoading(true))<span class="hljs-comment">;</span>
    try {
      const <span class="hljs-attr">response</span> = await api.listFiles(path)<span class="hljs-comment">;</span>
      dispatch(setFiles(response.data))<span class="hljs-comment">;</span>
    } catch (error) {
      // é”™è¯¯å¤„ç†
    } finally {
      dispatch(setLoading(false))<span class="hljs-comment">;</span>
    }
  }, <span class="hljs-section">[dispatch]</span>)<span class="hljs-comment">;</span>
  
  return {
    files,
    currentPath,
    loading,
    loadFiles,
  }<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### 3. é«˜é˜¶ç»„ä»¶ (HOC)</span>

```typescript
// hoc/withAuth.tsx
export const <span class="hljs-attr">withAuth</span> = &lt;P extends object&gt;(
  Component: React.ComponentType&lt;P&gt;
) =&gt; {
  return (props: P) =&gt; {
    const { user } = useAppSelector(<span class="hljs-attr">state</span> =&gt; state.user)<span class="hljs-comment">;</span>
    
    if (!user) {
      return &lt;Navigate <span class="hljs-attr">to</span>=<span class="hljs-string">"/session"</span> /&gt;<span class="hljs-comment">;</span>
    }
    
    return &lt;Component {...props} /&gt;<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// ä½¿ç”¨æ–¹å¼
const <span class="hljs-attr">ProtectedPage</span> = withAuth(FileManager)<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## Material-UI ä¸»é¢˜ç³»ç»Ÿ</span>

<span class="hljs-comment">### ä¸»é¢˜é…ç½®</span>

```typescript
// App.tsx ä¸­çš„ä¸»é¢˜é…ç½®
export const <span class="hljs-attr">applyThemeWithOverrides</span> = (themeConfig: ThemeOptions): ThemeOptions =&gt; {
  return {
    ...themeConfig,
    shape: {
      borderRadius: 12,
    },
    components: {
      MuiButton: {
        styleOverrides: {
          root: {
            textTransform: "none",
          },
        },
      },
      MuiTooltip: {
        defaultProps: {
          enterDelay: 500,
        },
      },
    },
  }<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### å“åº”å¼è®¾è®¡</span>

```typescript
// ä½¿ç”¨ MUI çš„æ–­ç‚¹ç³»ç»Ÿ
const <span class="hljs-attr">useStyles</span> = () =&gt; {
  const <span class="hljs-attr">theme</span> = useTheme()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">isMobile</span> = useMediaQuery(theme.breakpoints.down(<span class="hljs-string">'sm'</span>))<span class="hljs-comment">;</span>
  const <span class="hljs-attr">isTablet</span> = useMediaQuery(theme.breakpoints.down(<span class="hljs-string">'md'</span>))<span class="hljs-comment">;</span>
  
  return {
    container: {
      padding: isMobile ? theme.spacing(1) : theme.spacing(3),
      gridTemplateColumns: isMobile ? '1fr' : 'repeat(auto-fill, minmax(200px, 1fr))',
    },
  }<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## API é›†æˆæ¨¡å¼</span>

<span class="hljs-comment">### è¯·æ±‚å°è£…</span>

```typescript
// api/request.ts
const <span class="hljs-attr">instance</span> = axios.create({
  baseURL: '/api/v4',
})<span class="hljs-comment">;</span>

// è¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(async (config) =&gt; {
  const <span class="hljs-attr">token</span> = await SessionManager.getAccessToken()<span class="hljs-comment">;</span>
  if (token) {
    <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${token}</span>`<span class="hljs-comment">;</span>
  }
  return config<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
  (response) =&gt; response,
  async (error) =&gt; {
    if (error.response?.<span class="hljs-attr">status</span> === <span class="hljs-number">401</span>) {
      // å¤„ç†è®¤è¯å¤±è´¥
      await SessionManager.refreshToken()<span class="hljs-comment">;</span>
    }
    return Promise.reject(error)<span class="hljs-comment">;</span>
  }
)<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### API å‡½æ•°è®¾è®¡</span>

```typescript
// api/explorer.ts
export const <span class="hljs-attr">explorerAPI</span> = {
  // è·å–æ–‡ä»¶åˆ—è¡¨
  listFiles: (path: string): Promise&lt;Response&lt;FileResponse<span class="hljs-section">[]</span>&gt;&gt; =&gt; {
    return request.get('/file/list', { params: { path } })<span class="hljs-comment">;</span>
  },
  
  // ä¸Šä¼ æ–‡ä»¶
  uploadFile: (
    file: File, 
    path: string, 
    onProgress?: (progress: number) =&gt; void
  ): Promise&lt;Response&lt;FileResponse&gt;&gt; =&gt; {
    const <span class="hljs-attr">formData</span> = new FormData()<span class="hljs-comment">;</span>
    formData.append('file', file)<span class="hljs-comment">;</span>
    formData.append('path', path)<span class="hljs-comment">;</span>
    
    return request.post('/file/upload', formData, {
      onUploadProgress: (progressEvent) =&gt; {
        const <span class="hljs-attr">progress</span> = Math.round(
          (progressEvent.loaded * 100) / progressEvent.total
        )<span class="hljs-comment">;</span>
        onProgress?.(progress)<span class="hljs-comment">;</span>
      },
    })<span class="hljs-comment">;</span>
  },
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## å›½é™…åŒ– (i18n) ç³»ç»Ÿ</span>

<span class="hljs-comment">### é…ç½®ç»“æ„</span>

```typescript
// i18n.ts
import i18n from 'i18next'<span class="hljs-comment">;</span>
import Backend from 'i18next-http-backend'<span class="hljs-comment">;</span>
import LanguageDetector from 'i18next-browser-languagedetector'<span class="hljs-comment">;</span>

i18n
  .use(Backend)
  .use(LanguageDetector)
  .init({
    fallbackLng: 'en-US',
    debug: false,
    
    interpolation: {
      escapeValue: false,
    },
    
    backend: {
      loadPath: '/assets/locales/{{lng}}/{{ns}}.json',
    },
  })<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### ä½¿ç”¨æ–¹å¼</span>

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const FileManager: <span class="hljs-attr">React.FC</span> = () =&gt; {
  const { t } = useTranslation()<span class="hljs-comment">;</span>
  
  return (
    &lt;Box&gt;
      &lt;Typography <span class="hljs-attr">variant</span>=<span class="hljs-string">"h6"</span>&gt;
        {t('fileManager.title')}
      &lt;/Typography&gt;
      &lt;Button&gt;
        {t('common.upload')}
      &lt;/Button&gt;
    &lt;/Box&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</span>

<span class="hljs-comment">### 1. ä»£ç åˆ†å‰²</span>

```typescript
// è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²
const <span class="hljs-attr">FileManager</span> = lazy(() =&gt; import(<span class="hljs-string">'../component/FileManager/FileManager'</span>))<span class="hljs-comment">;</span>
const <span class="hljs-attr">AdminPanel</span> = lazy(() =&gt; import(<span class="hljs-string">'../component/Admin/AdminPanel'</span>))<span class="hljs-comment">;</span>

// åœ¨è·¯ç”±ä¸­ä½¿ç”¨
&lt;Route 
  <span class="hljs-attr">path</span>=<span class="hljs-string">"/files"</span> 
  <span class="hljs-attr">element</span>={
    &lt;Suspense <span class="hljs-attr">fallback</span>={&lt;Loading /&gt;}&gt;
      &lt;FileManager /&gt;
    &lt;/Suspense&gt;
  } 
/&gt;
```

<span class="hljs-comment">### 2. ç»„ä»¶ä¼˜åŒ–</span>

```typescript
// ä½¿ç”¨ React.memo ä¼˜åŒ–æ¸²æŸ“
const <span class="hljs-attr">FileItem</span> = React.memo&lt;FileItemProps&gt;(({ file, <span class="hljs-literal">on</span>Select }) =&gt; {
  return (
    &lt;ListItem <span class="hljs-attr">onClick</span>={() =&gt; <span class="hljs-literal">on</span>Select(file.id)}&gt;
      &lt;ListItemText <span class="hljs-attr">primary</span>={file.name} /&gt;
    &lt;/ListItem&gt;
  )<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// ä½¿ç”¨ useMemo ä¼˜åŒ–è®¡ç®—
const FileList: React.FC&lt;FileListProps&gt; = ({ files, filter }) =&gt; {
  const <span class="hljs-attr">filteredFiles</span> = useMemo(() =&gt; {
    return files.filter(<span class="hljs-attr">file</span> =&gt; 
      file.name.toLowerCase().includes(filter.toLowerCase())
    )<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[files, filter]</span>)<span class="hljs-comment">;</span>
  
  return (
    &lt;List&gt;
      {filteredFiles.map(<span class="hljs-attr">file</span> =&gt; (
        &lt;FileItem <span class="hljs-attr">key</span>={file.id} file={file} /&gt;
      ))}
    &lt;/List&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">### 3. è™šæ‹Ÿæ»šåŠ¨</span>

```typescript
// ä½¿ç”¨ react-virtuoso å¤„ç†å¤§åˆ—è¡¨
import { Virtuoso } from 'react-virtuoso'<span class="hljs-comment">;</span>

const VirtualFileList: React.FC&lt;{ files: FileResponse<span class="hljs-section">[]</span> }&gt; = ({ files }) =&gt; {
  return (
    &lt;Virtuoso
      <span class="hljs-attr">data</span>={files}
      <span class="hljs-attr">itemContent</span>={(index, file) =&gt; (
        &lt;FileItem <span class="hljs-attr">key</span>={file.id} file={file} /&gt;
      )}
      <span class="hljs-attr">style</span>={{ height: <span class="hljs-string">'400px'</span> }}
    /&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## é”™è¯¯å¤„ç†æœºåˆ¶</span>

<span class="hljs-comment">### é”™è¯¯è¾¹ç•Œ</span>

```typescript
// component/Common/ErrorBoundary.tsx
class ErrorBoundary extends React.Component&lt;Props, State&gt; {
  constructor(props: Props) {
    super(props)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.state</span> = { hasError: <span class="hljs-literal">false</span> }<span class="hljs-comment">;</span>
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true }<span class="hljs-comment">;</span>
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo)<span class="hljs-comment">;</span>
  }

  render() {
    if (this.state.hasError) {
      return &lt;ErrorFallback /&gt;<span class="hljs-comment">;</span>
    }

    return this.props.children<span class="hljs-comment">;</span>
  }
}
```

<span class="hljs-comment">### å…¨å±€é”™è¯¯å¤„ç†</span>

```typescript
// åœ¨ request.ts ä¸­ç»Ÿä¸€å¤„ç†é”™è¯¯
instance.interceptors.response.use(
  (response) =&gt; response,
  (error) =&gt; {
    const <span class="hljs-attr">message</span> = error.response?.data?.message || error.message<span class="hljs-comment">;</span>
    
    // æ˜¾ç¤ºé”™è¯¯æç¤º
    enqueueSnackbar(message, { 
      variant: 'error',
      action: &lt;DefaultCloseAction /&gt;
    })<span class="hljs-comment">;</span>
    
    return Promise.reject(error)<span class="hljs-comment">;</span>
  }
)<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## æµ‹è¯•ç­–ç•¥</span>

<span class="hljs-comment">### å•å…ƒæµ‹è¯•</span>

```typescript
// __tests__/FileItem.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'<span class="hljs-comment">;</span>
import { FileItem } from '../FileItem'<span class="hljs-comment">;</span>

describe('FileItem', () =&gt; {
  const <span class="hljs-attr">mockFile</span> = {
    id: '1',
    name: 'test.txt',
    size: 1024,
  }<span class="hljs-comment">;</span>

  it('renders file name correctly', () =&gt; {
    render(&lt;FileItem <span class="hljs-attr">file</span>={mockFile} <span class="hljs-literal">on</span>Select={jest.fn()} /&gt;)<span class="hljs-comment">;</span>
    expect(screen.getByText('test.txt')).toBeInTheDocument()<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  it('calls onSelect when clicked', () =&gt; {
    const <span class="hljs-attr">onSelect</span> = jest.fn()<span class="hljs-comment">;</span>
    render(&lt;FileItem <span class="hljs-attr">file</span>={mockFile} <span class="hljs-literal">on</span>Select={<span class="hljs-literal">on</span>Select} /&gt;)<span class="hljs-comment">;</span>
    
    fireEvent.click(screen.getByText('test.txt'))<span class="hljs-comment">;</span>
    expect(onSelect).toHaveBeenCalledWith('1')<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
```

<span class="hljs-comment">## å¼€å‘æœ€ä½³å®è·µ</span>

<span class="hljs-comment">### 1. ç»„ä»¶è®¾è®¡åŸåˆ™</span>
- **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¯å¤ç”¨æ€§**: è®¾è®¡é€šç”¨çš„ç»„ä»¶æ¥å£
- **å¯æµ‹è¯•æ€§**: ä¾¿äºç¼–å†™å•å…ƒæµ‹è¯•
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

<span class="hljs-comment">### 2. çŠ¶æ€ç®¡ç†åŸåˆ™</span>
- **æœ€å°åŒ–çŠ¶æ€**: åªå­˜å‚¨å¿…è¦çš„çŠ¶æ€
- **ä¸å¯å˜æ›´æ–°**: ä½¿ç”¨ Redux Toolkit çš„ Immer
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨ createAsyncThunk å¤„ç†å¼‚æ­¥æ“ä½œ

<span class="hljs-comment">### 3. ä»£ç ç»„ç»‡åŸåˆ™</span>
- **æŒ‰åŠŸèƒ½åˆ†ç»„**: ç›¸å…³ç»„ä»¶æ”¾åœ¨åŒä¸€ç›®å½•
- **ç±»å‹å®šä¹‰**: ä¸ºæ‰€æœ‰ props å’ŒçŠ¶æ€å®šä¹‰ç±»å‹
- **æ–‡æ¡£æ³¨é‡Š**: ä¸ºå¤æ‚ç»„ä»¶æ·»åŠ  JSDoc æ³¨é‡Š

<span class="hljs-comment">## æ€»ç»“</span>

Cloudreve çš„å‰ç«¯æ¶æ„é‡‡ç”¨äº†ç°ä»£åŒ–çš„ React ç”Ÿæ€ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ç±»å‹å®‰å…¨**: å…¨é¢ä½¿ç”¨ TypeScript
2. **ç»„ä»¶åŒ–**: é«˜åº¦æ¨¡å—åŒ–çš„ç»„ä»¶è®¾è®¡
3. **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ Redux Toolkit è¿›è¡ŒçŠ¶æ€ç®¡ç†
4. **UI ä¸€è‡´æ€§**: åŸºäº Material-UI çš„è®¾è®¡ç³»ç»Ÿ
5. **æ€§èƒ½ä¼˜åŒ–**: ä»£ç åˆ†å‰²ã€è™šæ‹Ÿæ»šåŠ¨ç­‰ä¼˜åŒ–ç­–ç•¥
6. **å›½é™…åŒ–**: å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒ
7. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯è¾¹ç•Œå’Œé”™è¯¯å¤„ç†æœºåˆ¶

è¿™ä¸ªæ¶æ„ä¸ºä½ å¼€å‘ä¾§è¾¹æ å¯¹è¯åŠŸèƒ½æä¾›äº†è‰¯å¥½çš„åŸºç¡€ï¼Œä½ å¯ä»¥å‚è€ƒç°æœ‰çš„ç»„ä»¶è®¾è®¡æ¨¡å¼å’ŒçŠ¶æ€ç®¡ç†æ–¹å¼æ¥å®ç°æ–°åŠŸèƒ½ã€‚
</code></pre>
<h3 data-id="heading-5"><strong>03-backend-architecture.md - åç«¯æ¶æ„æŒ‡å—</strong></h3>
<ul>
<li>
<p>Go è¯­è¨€åŸºç¡€çŸ¥è¯†ï¼ˆä¸“ä¸ºå‰ç«¯å¼€å‘è€…ï¼‰</p>
</li>
<li>
<p>Gin æ¡†æ¶å’Œ Ent ORM ä½¿ç”¨</p>
</li>
<li>
<p>æœåŠ¡å±‚è®¾è®¡å’Œè®¤è¯ç³»ç»Ÿ</p>
</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"># Cloudreve åç«¯æ¶æ„å­¦ä¹ æŒ‡å—

## Go è¯­è¨€åŸºç¡€çŸ¥è¯†

### ä¸ºä»€ä¹ˆé€‰æ‹© Go
- **é«˜æ€§èƒ½**: ç¼–è¯‘å‹è¯­è¨€ï¼Œæ¥è¿‘ C/C++ çš„æ€§èƒ½
- **å¹¶å‘æ”¯æŒ**: åŸç”Ÿçš„ goroutine å’Œ channel æ”¯æŒ
- **ç®€æ´è¯­æ³•**: å­¦ä¹ æ›²çº¿å¹³ç¼“ï¼Œä»£ç å¯è¯»æ€§å¼º
- **ä¸°å¯Œç”Ÿæ€**: ä¼˜ç§€çš„ Web æ¡†æ¶å’Œå·¥å…·é“¾
- **å†…å­˜å®‰å…¨**: åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œé¿å…å†…å­˜æ³„æ¼

### Go è¯­è¨€æ ¸å¿ƒæ¦‚å¿µ

#### <span class="hljs-number">1</span>. åŒ… (Package) ç³»ç»Ÿ
```go
// åŒ…å£°æ˜
package main

// å¯¼å…¥å…¶ä»–åŒ…
import (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
)

// å‡½æ•°å®šä¹‰
func <span class="hljs-built_in">main</span>() {
    fmt<span class="hljs-selector-class">.Println</span>("Hello, World!")
}
```

#### <span class="hljs-number">2</span>. ç»“æ„ä½“ (Struct)
```go
<span class="hljs-comment">// å®šä¹‰ç»“æ„ä½“</span>
type User struct {
    ID       int    `json:<span class="hljs-string">"id"</span>`
    Name     string `json:<span class="hljs-string">"name"</span>`
    Email    string `json:<span class="hljs-string">"email"</span>`
    Password string `json:<span class="hljs-string">"-"</span>` // ä¸åºåˆ—åŒ–åˆ° JSON
}

<span class="hljs-comment">// ç»“æ„ä½“æ–¹æ³•</span>
func (u *User) <span class="hljs-built_in">GetDisplayName</span>() string {
    return u<span class="hljs-selector-class">.Name</span>
}
```

#### <span class="hljs-number">3</span>. æ¥å£ (Interface)
```go
<span class="hljs-comment">// å®šä¹‰æ¥å£</span>
type UserService interface {
    <span class="hljs-built_in">CreateUser</span>(user *User) error
    <span class="hljs-built_in">GetUser</span>(id int) (*User, error)
    <span class="hljs-built_in">UpdateUser</span>(user *User) error
    <span class="hljs-built_in">DeleteUser</span>(id int) error
}

<span class="hljs-comment">// å®ç°æ¥å£</span>
type userServiceImpl struct {
    db *sql<span class="hljs-selector-class">.DB</span>
}

func (s *userServiceImpl) <span class="hljs-built_in">CreateUser</span>(user *User) error {
    <span class="hljs-comment">// å®ç°é€»è¾‘</span>
    return nil
}
```

#### <span class="hljs-number">4</span>. é”™è¯¯å¤„ç†
```go
func <span class="hljs-built_in">GetUser</span>(id int) (*User, error) {
    if id &lt;= <span class="hljs-number">0</span> {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("invalid user id: %d", id)
    }
    
    user, err := db.<span class="hljs-built_in">FindUser</span>(id)
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to find user: %w", err)
    }
    
    return user, nil
}

<span class="hljs-comment">// ä½¿ç”¨</span>
user, err := <span class="hljs-built_in">GetUser</span>(<span class="hljs-number">123</span>)
if err != nil {
    log<span class="hljs-selector-class">.Printf</span>("Error: %v", err)
    return
}
```

## Cloudreve åç«¯æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶å’Œåº“
- **Gin**: é«˜æ€§èƒ½çš„ HTTP Web æ¡†æ¶
- **Ent**: Facebook å¼€æºçš„ Go ORM æ¡†æ¶
- **Cobra**: å‘½ä»¤è¡Œåº”ç”¨æ¡†æ¶
- **JWT**: JSON Web Token è®¤è¯
- **Viper**: é…ç½®ç®¡ç†
- **Logrus**: ç»“æ„åŒ–æ—¥å¿—

### æ•°æ®åº“æ”¯æŒ
- **MySQL**: ä¸»è¦ç”Ÿäº§æ•°æ®åº“
- **PostgreSQL**: ä¼ä¸šçº§æ•°æ®åº“
- **SQLite**: è½»é‡çº§åµŒå…¥å¼æ•°æ®åº“

## é¡¹ç›®æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```mermaid
graph TB
    subgraph <span class="hljs-string">"Cloudreve åç«¯åˆ†å±‚æ¶æ„"</span>
        A[HTTP å±‚] --&gt; B[è·¯ç”±å±‚ - routers/]
        B --&gt; C[æ§åˆ¶å™¨å±‚ - controllers/]
        C --&gt; D[æœåŠ¡å±‚ - service/]
        D --&gt; E[æ•°æ®è®¿é—®å±‚ - ent/]
        E --&gt; F[æ•°æ®åº“]
        
        G[ä¸­é—´ä»¶å±‚ - middleware/] --&gt; C
        H[å·¥å…·åŒ… - pkg/] --&gt; D
        I[åº”ç”¨é…ç½® - application/] --&gt; D
    end
```

### ç›®å½•ç»“æ„è¯¦è§£

```
Cloudreve/
â”œâ”€â”€ main.go                 # åº”ç”¨å…¥å£
â”œâ”€â”€ cmd/                    # å‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ root.go            # æ ¹å‘½ä»¤
â”‚   â”œâ”€â”€ server.go          # æœåŠ¡å™¨å‘½ä»¤
â”‚   â””â”€â”€ migrate.go         # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ routers/               # è·¯ç”±å±‚
â”‚   â”œâ”€â”€ router.go          # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ controllers/       # æ§åˆ¶å™¨
â”œâ”€â”€ service/               # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ admin/            # ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ user/             # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ explorer/         # æ–‡ä»¶ç®¡ç†æœåŠ¡
â”‚   â””â”€â”€ chat/             # èŠå¤©æœåŠ¡
â”œâ”€â”€ ent/                   # æ•°æ®æ¨¡å‹å±‚ (Ent ORM)
â”‚   â”œâ”€â”€ schema/           # æ•°æ®åº“æ¨¡å¼å®šä¹‰
â”‚   â”œâ”€â”€ migrate/          # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ *.go              # ç”Ÿæˆçš„å®ä½“ä»£ç 
â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.go           # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ cors.go           # è·¨åŸŸä¸­é—´ä»¶
â”‚   â””â”€â”€ session.go        # ä¼šè¯ä¸­é—´ä»¶
â”œâ”€â”€ pkg/                   # å·¥å…·åŒ…
â”‚   â”œâ”€â”€ auth/             # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ cache/            # ç¼“å­˜å·¥å…·
â”‚   â”œâ”€â”€ conf/             # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ util/             # é€šç”¨å·¥å…·
â”œâ”€â”€ inventory/             # åº“å­˜ç®¡ç†
â””â”€â”€ application/           # åº”ç”¨é…ç½®
```

## Gin æ¡†æ¶è¯¦è§£

### åŸºæœ¬ç”¨æ³•

```go
package main

import (
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
    <span class="hljs-string">"net/http"</span>
)

func <span class="hljs-built_in">main</span>() {
    <span class="hljs-comment">// åˆ›å»º Gin å¼•æ“</span>
    r := gin.<span class="hljs-built_in">Default</span>()
    
    // å®šä¹‰è·¯ç”±
    r.<span class="hljs-built_in">GET</span>(<span class="hljs-string">"/ping"</span>, <span class="hljs-built_in">func</span>(c *gin.Context) {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusOK, gin.H{
            "message": "pong",
        })
    })
    
    <span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span>
    r<span class="hljs-selector-class">.Run</span>(":<span class="hljs-number">8080</span>")
}
```

### è·¯ç”±ç»„ç»‡

```go
<span class="hljs-comment">// routers/router.go</span>
func <span class="hljs-built_in">InitRouter</span>(dep dependency.Dep) *gin<span class="hljs-selector-class">.Engine</span> {
    r := gin.<span class="hljs-built_in">New</span>()
    
    // å…¨å±€ä¸­é—´ä»¶
    r.<span class="hljs-built_in">Use</span>(gin.<span class="hljs-built_in">Recovery</span>())
    r.<span class="hljs-built_in">Use</span>(middleware.<span class="hljs-built_in">CORS</span>())
    
    // API ç‰ˆæœ¬åˆ†ç»„
    v4 := r.<span class="hljs-built_in">Group</span>(<span class="hljs-string">"/api/v4"</span>)
    
    // ç”¨æˆ·ç›¸å…³è·¯ç”±
    user := v4.<span class="hljs-built_in">Group</span>(<span class="hljs-string">"/user"</span>)
    user.<span class="hljs-built_in">Use</span>(middleware.<span class="hljs-built_in">LoginRequired</span>())
    {
        user<span class="hljs-selector-class">.GET</span>("/info", controllers.GetUserInfo)
        user<span class="hljs-selector-class">.PUT</span>("/info", controllers.UpdateUserInfo)
    }
    
    <span class="hljs-comment">// æ–‡ä»¶ç›¸å…³è·¯ç”±</span>
    file := v4.<span class="hljs-built_in">Group</span>(<span class="hljs-string">"/file"</span>)
    {
        file<span class="hljs-selector-class">.GET</span>("/list", controllers.ListFiles)
        file<span class="hljs-selector-class">.POST</span>("/upload", controllers.UploadFile)
    }
    
    return r
}
```

### ä¸­é—´ä»¶ç³»ç»Ÿ

```go
<span class="hljs-comment">// middleware/auth.go</span>
func <span class="hljs-built_in">LoginRequired</span>() gin<span class="hljs-selector-class">.HandlerFunc</span> {
    return <span class="hljs-built_in">func</span>(c *gin.Context) {
        <span class="hljs-comment">// ä»è¯·æ±‚å¤´è·å– token</span>
        token := c.<span class="hljs-built_in">GetHeader</span>(<span class="hljs-string">"Authorization"</span>)
        if token == <span class="hljs-string">""</span> {
            c<span class="hljs-selector-class">.JSON</span>(http.StatusUnauthorized, gin.H{
                "error": "Missing authorization token",
            })
            c<span class="hljs-selector-class">.Abort</span>()
            return
        }
        
        <span class="hljs-comment">// éªŒè¯ token</span>
        user, err := <span class="hljs-built_in">validateToken</span>(token)
        if err != nil {
            c<span class="hljs-selector-class">.JSON</span>(http.StatusUnauthorized, gin.H{
                "error": "Invalid token",
            })
            c<span class="hljs-selector-class">.Abort</span>()
            return
        }
        
        <span class="hljs-comment">// å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°ä¸Šä¸‹æ–‡</span>
        c<span class="hljs-selector-class">.Set</span>("user", user)
        c<span class="hljs-selector-class">.Next</span>()
    }
}
```

## Ent ORM æ¡†æ¶

### æ¨¡å¼å®šä¹‰

```go
<span class="hljs-comment">// ent/schema/user.go</span>
package schema

import (
    "entgo.io/ent"
    "entgo.io/ent/schema/field"
    "entgo.io/ent/schema/edge"
)

<span class="hljs-comment">// User ç”¨æˆ·å®ä½“</span>
type User struct {
    ent<span class="hljs-selector-class">.Schema</span>
}

<span class="hljs-comment">// Fields å­—æ®µå®šä¹‰</span>
func (User) <span class="hljs-built_in">Fields</span>() <span class="hljs-selector-attr">[]</span>ent<span class="hljs-selector-class">.Field</span> {
    return <span class="hljs-selector-attr">[]</span>ent<span class="hljs-selector-class">.Field</span>{
        field<span class="hljs-selector-class">.String</span>("name").
            <span class="hljs-built_in">NotEmpty</span>().
            <span class="hljs-built_in">Comment</span>("ç”¨æˆ·å"),
        field<span class="hljs-selector-class">.String</span>("email").
            <span class="hljs-built_in">Unique</span>().
            <span class="hljs-built_in">Comment</span>("é‚®ç®±"),
        field<span class="hljs-selector-class">.String</span>("password").
            <span class="hljs-built_in">Sensitive</span>().
            <span class="hljs-built_in">Comment</span>("å¯†ç "),
        field<span class="hljs-selector-class">.Time</span>("created_at").
            Default(time.Now).
            <span class="hljs-built_in">Comment</span>("åˆ›å»ºæ—¶é—´"),
    }
}

<span class="hljs-comment">// Edges å…³è”å…³ç³»</span>
func (User) <span class="hljs-built_in">Edges</span>() <span class="hljs-selector-attr">[]</span>ent<span class="hljs-selector-class">.Edge</span> {
    return <span class="hljs-selector-attr">[]</span>ent<span class="hljs-selector-class">.Edge</span>{
        edge<span class="hljs-selector-class">.To</span>("files", File.Type).
            <span class="hljs-built_in">Comment</span>("ç”¨æˆ·æ–‡ä»¶"),
        edge<span class="hljs-selector-class">.To</span>("groups", Group.Type).
            <span class="hljs-built_in">Through</span>("user_groups", UserGroup.Type).
            <span class="hljs-built_in">Comment</span>("ç”¨æˆ·ç»„"),
    }
}
```

### æ•°æ®åº“æ“ä½œ

```go
<span class="hljs-comment">// service/user/user.go</span>
type UserService struct {
    client *ent<span class="hljs-selector-class">.Client</span>
}

func <span class="hljs-built_in">NewUserService</span>(client *ent.Client) *UserService {
    return &amp;UserService{client: client}
}

<span class="hljs-comment">// åˆ›å»ºç”¨æˆ·</span>
func (s *UserService) <span class="hljs-built_in">CreateUser</span>(ctx context.Context, req *CreateUserRequest) (*ent.User, error) {
    user, err := s.client.User.
        <span class="hljs-built_in">Create</span>().
        <span class="hljs-built_in">SetName</span>(req.Name).
        <span class="hljs-built_in">SetEmail</span>(req.Email).
        <span class="hljs-built_in">SetPassword</span>(<span class="hljs-built_in">hashPassword</span>(req.Password)).
        <span class="hljs-built_in">Save</span>(ctx)
    
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to create user: %w", err)
    }
    
    return user, nil
}

<span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·</span>
func (s *UserService) <span class="hljs-built_in">GetUser</span>(ctx context.Context, id int) (*ent.User, error) {
    user, err := s.client.User.
        <span class="hljs-built_in">Query</span>().
        <span class="hljs-built_in">Where</span>(user.<span class="hljs-built_in">ID</span>(id)).
        <span class="hljs-built_in">WithFiles</span>().  // é¢„åŠ è½½æ–‡ä»¶å…³è”
        <span class="hljs-built_in">Only</span>(ctx)
    
    if err != nil {
        if ent<span class="hljs-selector-class">.IsNotFound</span>(err) {
            return nil, fmt<span class="hljs-selector-class">.Errorf</span>("user not found")
        }
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to get user: %w", err)
    }
    
    return user, nil
}

<span class="hljs-comment">// æ›´æ–°ç”¨æˆ·</span>
func (s *UserService) <span class="hljs-built_in">UpdateUser</span>(ctx context.Context, id int, req *UpdateUserRequest) (*ent.User, error) {
    user, err := s.client.User.
        <span class="hljs-built_in">UpdateOneID</span>(id).
        <span class="hljs-built_in">SetName</span>(req.Name).
        <span class="hljs-built_in">SetEmail</span>(req.Email).
        <span class="hljs-built_in">Save</span>(ctx)
    
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to update user: %w", err)
    }
    
    return user, nil
}
```

## æ§åˆ¶å™¨å±‚è®¾è®¡

### æ§åˆ¶å™¨ç»“æ„

```go
<span class="hljs-comment">// routers/controllers/user.go</span>
package controllers

import (
    "github.com/gin-gonic/gin"
    "github.com/cloudreve/Cloudreve/v4/service/user"
)

<span class="hljs-comment">// GetUserInfo è·å–ç”¨æˆ·ä¿¡æ¯</span>
func <span class="hljs-built_in">GetUserInfo</span>(c *gin.Context) {
    <span class="hljs-comment">// ä»ä¸Šä¸‹æ–‡è·å–ç”¨æˆ·</span>
    currentUser, exists := c.<span class="hljs-built_in">Get</span>(<span class="hljs-string">"user"</span>)
    if !exists {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusUnauthorized, gin.H{
            "error": "User not found in context",
        })
        return
    }
    
    user := currentUser.(*ent.User)
    
    // è¿”å›ç”¨æˆ·ä¿¡æ¯
    c.<span class="hljs-built_in">JSON</span>(http.StatusOK, gin.H{
        "data": gin.H{
            "id":    user.ID,
            <span class="hljs-string">"name"</span>:  user.Name,
            <span class="hljs-string">"email"</span>: user.Email,
        },
    })
}

<span class="hljs-comment">// UpdateUserInfo æ›´æ–°ç”¨æˆ·ä¿¡æ¯</span>
func <span class="hljs-built_in">UpdateUserInfo</span>(c *gin.Context) {
    <span class="hljs-selector-tag">var</span> req user<span class="hljs-selector-class">.UpdateUserRequest</span>
    
    <span class="hljs-comment">// ç»‘å®šè¯·æ±‚å‚æ•°</span>
    if err := c.<span class="hljs-built_in">ShouldBindJSON</span>(&amp;req); err != nil {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusBadRequest, gin.H{
            "error": err.Error(),
        })
        return
    }
    
    <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·</span>
    currentUser := c.<span class="hljs-built_in">MustGet</span>(<span class="hljs-string">"user"</span>).(*ent.User)
    
    // è°ƒç”¨æœåŠ¡å±‚
    userService := user.<span class="hljs-built_in">NewUserService</span>(ent.<span class="hljs-built_in">GetClient</span>())
    updatedUser, err := userService.<span class="hljs-built_in">UpdateUser</span>(c.Request.<span class="hljs-built_in">Context</span>(), currentUser.ID, &amp;req)
    if err != nil {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusInternalServerError, gin.H{
            "error": err.Error(),
        })
        return
    }
    
    c<span class="hljs-selector-class">.JSON</span>(http.StatusOK, gin.H{
        "data": updatedUser,
    })
}
```

### å‚æ•°ç»‘å®šå’ŒéªŒè¯

```go
<span class="hljs-comment">// service/user/types.go</span>
type CreateUserRequest struct {
    Name     string `json:<span class="hljs-string">"name"</span> binding:<span class="hljs-string">"required,min=2,max=50"</span>`
    Email    string `json:<span class="hljs-string">"email"</span> binding:<span class="hljs-string">"required,email"</span>`
    Password string `json:<span class="hljs-string">"password"</span> binding:<span class="hljs-string">"required,min=6"</span>`
}

type UpdateUserRequest struct {
    Name  string `json:<span class="hljs-string">"name"</span> binding:<span class="hljs-string">"omitempty,min=2,max=50"</span>`
    Email string `json:<span class="hljs-string">"email"</span> binding:<span class="hljs-string">"omitempty,email"</span>`
}

<span class="hljs-comment">// è‡ªå®šä¹‰éªŒè¯å™¨</span>
func <span class="hljs-built_in">ValidatePassword</span>(fl validator.FieldLevel) bool {
    password := fl.<span class="hljs-built_in">Field</span>().<span class="hljs-built_in">String</span>()
    // å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—
    hasLetter := regexp.<span class="hljs-built_in">MustCompile</span>(`[a-zA-Z]`).<span class="hljs-built_in">MatchString</span>(password)
    hasNumber := regexp.<span class="hljs-built_in">MustCompile</span>(`[<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]`).<span class="hljs-built_in">MatchString</span>(password)
    return hasLetter &amp;&amp; hasNumber
}
```

## æœåŠ¡å±‚è®¾è®¡æ¨¡å¼

### ä¾èµ–æ³¨å…¥

```go
<span class="hljs-comment">// application/dependency/dependency.go</span>
type Dep interface {
    <span class="hljs-built_in">Logger</span>() logging<span class="hljs-selector-class">.Logger</span>
    <span class="hljs-built_in">ConfigProvider</span>() conf<span class="hljs-selector-class">.Provider</span>
    <span class="hljs-built_in">DatabaseClient</span>() *ent<span class="hljs-selector-class">.Client</span>
    <span class="hljs-built_in">CacheProvider</span>() cache<span class="hljs-selector-class">.Driver</span>
}

type dep struct {
    logger         logging<span class="hljs-selector-class">.Logger</span>
    configProvider conf<span class="hljs-selector-class">.Provider</span>
    dbClient       *ent<span class="hljs-selector-class">.Client</span>
    cacheProvider  cache<span class="hljs-selector-class">.Driver</span>
}

func <span class="hljs-built_in">NewDep</span>() Dep {
    return &amp;dep{
        logger:         logging.<span class="hljs-built_in">NewLogger</span>(),
        configProvider: conf.<span class="hljs-built_in">NewProvider</span>(),
        dbClient:       ent.<span class="hljs-built_in">NewClient</span>(),
        cacheProvider:  cache.<span class="hljs-built_in">NewRedisDriver</span>(),
    }
}
```

### æœåŠ¡æ¥å£è®¾è®¡

```go
<span class="hljs-comment">// service/user/interface.go</span>
type Service interface {
    <span class="hljs-built_in">CreateUser</span>(ctx context.Context, req *CreateUserRequest) (*ent.User, error)
    <span class="hljs-built_in">GetUser</span>(ctx context.Context, id int) (*ent.User, error)
    <span class="hljs-built_in">UpdateUser</span>(ctx context.Context, id int, req *UpdateUserRequest) (*ent.User, error)
    <span class="hljs-built_in">DeleteUser</span>(ctx context.Context, id int) error
    <span class="hljs-built_in">ListUsers</span>(ctx context.Context, req *ListUsersRequest) ([]*ent.User, error)
}

<span class="hljs-comment">// service/user/service.go</span>
type service struct {
    dep    dependency<span class="hljs-selector-class">.Dep</span>
    client *ent<span class="hljs-selector-class">.Client</span>
    logger logging<span class="hljs-selector-class">.Logger</span>
}

func <span class="hljs-built_in">NewService</span>(dep dependency.Dep) Service {
    return &amp;service{
        dep:    dep,
        client: dep.<span class="hljs-built_in">DatabaseClient</span>(),
        logger: dep.<span class="hljs-built_in">Logger</span>(),
    }
}
```

## è®¤è¯å’Œæˆæƒç³»ç»Ÿ

### JWT è®¤è¯

```go
<span class="hljs-comment">// pkg/auth/jwt.go</span>
type JWTAuth struct {
    secretKey <span class="hljs-selector-attr">[]</span>byte
    issuer    string
}

type Claims struct {
    UserID int    `json:<span class="hljs-string">"user_id"</span>`
    Email  string `json:<span class="hljs-string">"email"</span>`
    jwt.RegisteredClaims
}

func (j *JWTAuth) <span class="hljs-built_in">GenerateToken</span>(user *ent.User) (string, error) {
    claims := &amp;Claims{
        UserID: user.ID,
        Email:  user.Email,
        RegisteredClaims: jwt.RegisteredClaims{
            ExpiresAt: jwt.<span class="hljs-built_in">NewNumericDate</span>(time.<span class="hljs-built_in">Now</span>().<span class="hljs-built_in">Add</span>(<span class="hljs-number">24</span> * time.Hour)),
            IssuedAt:  jwt.<span class="hljs-built_in">NewNumericDate</span>(time.<span class="hljs-built_in">Now</span>()),
            Issuer:    j.issuer,
        },
    }
    
    token := jwt.<span class="hljs-built_in">NewWithClaims</span>(jwt.SigningMethodHS256, claims)
    return token.<span class="hljs-built_in">SignedString</span>(j.secretKey)
}

func (j *JWTAuth) <span class="hljs-built_in">ValidateToken</span>(tokenString string) (*Claims, error) {
    token, err := jwt.<span class="hljs-built_in">ParseWithClaims</span>(tokenString, &amp;Claims{}, <span class="hljs-built_in">func</span>(token *jwt.Token) (interface{}, error) {
        return j<span class="hljs-selector-class">.secretKey</span>, nil
    })
    
    if err != nil {
        return nil, err
    }
    
    if claims, ok := token.Claims.(*Claims); ok &amp;&amp; token<span class="hljs-selector-class">.Valid</span> {
        return claims, nil
    }
    
    return nil, fmt<span class="hljs-selector-class">.Errorf</span>("invalid token")
}
```

### æƒé™æ§åˆ¶

```go
<span class="hljs-comment">// middleware/rbac.go</span>
func <span class="hljs-built_in">RequirePermission</span>(permission string) gin<span class="hljs-selector-class">.HandlerFunc</span> {
    return <span class="hljs-built_in">func</span>(c *gin.Context) {
        user := c.<span class="hljs-built_in">MustGet</span>(<span class="hljs-string">"user"</span>).(*ent.User)
        
        // æ£€æŸ¥ç”¨æˆ·æƒé™
        hasPermission, err := <span class="hljs-built_in">checkUserPermission</span>(user.ID, permission)
        if err != nil {
            c<span class="hljs-selector-class">.JSON</span>(http.StatusInternalServerError, gin.H{
                "error": "Failed to check permission",
            })
            c<span class="hljs-selector-class">.Abort</span>()
            return
        }
        
        if !hasPermission {
            c<span class="hljs-selector-class">.JSON</span>(http.StatusForbidden, gin.H{
                "error": "Insufficient permissions",
            })
            c<span class="hljs-selector-class">.Abort</span>()
            return
        }
        
        c<span class="hljs-selector-class">.Next</span>()
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼</span>
admin := v4.<span class="hljs-built_in">Group</span>(<span class="hljs-string">"/admin"</span>)
admin.<span class="hljs-built_in">Use</span>(middleware.<span class="hljs-built_in">LoginRequired</span>())
admin.<span class="hljs-built_in">Use</span>(middleware.<span class="hljs-built_in">RequirePermission</span>(<span class="hljs-string">"admin:read"</span>))
{
    admin<span class="hljs-selector-class">.GET</span>("/users", controllers.ListUsers)
}
```

## æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ

### å­˜å‚¨æ¥å£è®¾è®¡

```go
<span class="hljs-comment">// pkg/filesystem/driver.go</span>
type Driver interface {
    <span class="hljs-comment">// ä¸Šä¼ æ–‡ä»¶</span>
    <span class="hljs-built_in">Put</span>(ctx context.Context, path string, file io.Reader) error
    
    <span class="hljs-comment">// è·å–æ–‡ä»¶</span>
    <span class="hljs-built_in">Get</span>(ctx context.Context, path string) (io.ReadCloser, error)
    
    <span class="hljs-comment">// åˆ é™¤æ–‡ä»¶</span>
    <span class="hljs-built_in">Delete</span>(ctx context.Context, path string) error
    
    <span class="hljs-comment">// è·å–æ–‡ä»¶ä¿¡æ¯</span>
    <span class="hljs-built_in">Stat</span>(ctx context.Context, path string) (*FileInfo, error)
    
    <span class="hljs-comment">// åˆ—å‡ºæ–‡ä»¶</span>
    <span class="hljs-built_in">List</span>(ctx context.Context, path string) ([]*FileInfo, error)
}

type FileInfo struct {
    Name    string
    Size    int64
    ModTime <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Time</span>
    IsDir   bool
}
```

### æœ¬åœ°å­˜å‚¨å®ç°

```go
<span class="hljs-comment">// pkg/filesystem/local.go</span>
type LocalDriver struct {
    rootPath string
}

func <span class="hljs-built_in">NewLocalDriver</span>(rootPath string) Driver {
    return &amp;LocalDriver{rootPath: rootPath}
}

func (d *LocalDriver) <span class="hljs-built_in">Put</span>(ctx context.Context, path string, file io.Reader) error {
    fullPath := filepath.<span class="hljs-built_in">Join</span>(d.rootPath, path)
    
    // ç¡®ä¿ç›®å½•å­˜åœ¨
    if err := os.<span class="hljs-built_in">MkdirAll</span>(filepath.<span class="hljs-built_in">Dir</span>(fullPath), <span class="hljs-number">0755</span>); err != nil {
        return fmt<span class="hljs-selector-class">.Errorf</span>("failed to create directory: %w", err)
    }
    
    <span class="hljs-comment">// åˆ›å»ºæ–‡ä»¶</span>
    dst, err := os.<span class="hljs-built_in">Create</span>(fullPath)
    if err != nil {
        return fmt<span class="hljs-selector-class">.Errorf</span>("failed to create file: %w", err)
    }
    defer dst<span class="hljs-selector-class">.Close</span>()
    
    <span class="hljs-comment">// å¤åˆ¶æ–‡ä»¶å†…å®¹</span>
    _, err = io<span class="hljs-selector-class">.Copy</span>(dst, file)
    if err != nil {
        return fmt<span class="hljs-selector-class">.Errorf</span>("failed to write file: %w", err)
    }
    
    return nil
}

func (d *LocalDriver) <span class="hljs-built_in">Get</span>(ctx context.Context, path string) (io.ReadCloser, error) {
    fullPath := filepath.<span class="hljs-built_in">Join</span>(d.rootPath, path)
    
    file, err := os.<span class="hljs-built_in">Open</span>(fullPath)
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to open file: %w", err)
    }
    
    return file, nil
}
```

## èŠå¤©æœåŠ¡å®ç°

### OpenRouter å®¢æˆ·ç«¯

```go
<span class="hljs-comment">// pkg/openrouter/client.go</span>
type Client struct {
    apiKey     string
    baseURL    string
    httpClient *http<span class="hljs-selector-class">.Client</span>
    logger     logging<span class="hljs-selector-class">.Logger</span>
}

type ChatRequest struct {
    Model       string    `json:<span class="hljs-string">"model"</span>`
    Messages    []Message `json:<span class="hljs-string">"messages"</span>`
    Stream      bool      `json:<span class="hljs-string">"stream"</span>`
    Temperature float64   `json:<span class="hljs-string">"temperature"</span>`
    MaxTokens   int       `json:<span class="hljs-string">"max_tokens"</span>`
}

type Message struct {
    Role    string `json:<span class="hljs-string">"role"</span>`
    Content string `json:<span class="hljs-string">"content"</span>`
}

func (c *Client) <span class="hljs-built_in">Chat</span>(ctx context.Context, req ChatRequest) (*ChatResponse, error) {
    reqBody, err := json.<span class="hljs-built_in">Marshal</span>(req)
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to marshal request: %w", err)
    }
    
    httpReq, err := http.<span class="hljs-built_in">NewRequestWithContext</span>(ctx, <span class="hljs-string">"POST"</span>, c.baseURL+<span class="hljs-string">"/chat/completions"</span>, bytes.<span class="hljs-built_in">NewReader</span>(reqBody))
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to create request: %w", err)
    }
    
    httpReq<span class="hljs-selector-class">.Header</span><span class="hljs-selector-class">.Set</span>("Authorization", "Bearer "+c.apiKey)
    httpReq<span class="hljs-selector-class">.Header</span><span class="hljs-selector-class">.Set</span>("Content-Type", "application/json")
    
    resp, err := c.httpClient.<span class="hljs-built_in">Do</span>(httpReq)
    if err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to send request: %w", err)
    }
    defer resp<span class="hljs-selector-class">.Body</span><span class="hljs-selector-class">.Close</span>()
    
    <span class="hljs-selector-tag">var</span> chatResp ChatResponse
    if err := json.<span class="hljs-built_in">NewDecoder</span>(resp.Body).<span class="hljs-built_in">Decode</span>(&amp;chatResp); err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to decode response: %w", err)
    }
    
    return &amp;chatResp, nil
}
```

### æµå¼å“åº”å¤„ç†

```go
<span class="hljs-comment">// service/chat/chat.go</span>
type StreamCallback <span class="hljs-built_in">func</span>(content string, done bool) error

func (s *ChatService) <span class="hljs-built_in">StreamChat</span>(ctx context.Context, user *ent.User, message string, callback StreamCallback) error {
    req := openrouter.ChatRequest{
        Model: <span class="hljs-string">"google/gemini-2.5-pro"</span>,
        Messages: []openrouter.Message{
            {
                Role:    <span class="hljs-string">"system"</span>,
                Content: <span class="hljs-string">"ä½ æ˜¯ Cloudreve äº‘ç›˜çš„ AI åŠ©æ‰‹"</span>,
            },
            {
                Role:    <span class="hljs-string">"user"</span>,
                Content: message,
            },
        },
        Stream:      true,
        Temperature: <span class="hljs-number">0.7</span>,
        MaxTokens:   <span class="hljs-number">2000</span>,
    }
    
    return s<span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.ChatStream</span>(ctx, req, callback)
}

<span class="hljs-comment">// åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨</span>
func <span class="hljs-built_in">ChatStream</span>(c *gin.Context) {
    <span class="hljs-comment">// è®¾ç½® SSE å“åº”å¤´</span>
    c<span class="hljs-selector-class">.Header</span>("Content-Type", "text/event-stream")
    c<span class="hljs-selector-class">.Header</span>("Cache-Control", "no-cache")
    c<span class="hljs-selector-class">.Header</span>("Connection", "keep-alive")
    
    <span class="hljs-comment">// è·å–å‚æ•°</span>
    service := ParametersFromContext[*chatsvc.Service](c, ChatParameterCtx)
    user := c.<span class="hljs-built_in">MustGet</span>(<span class="hljs-string">"user"</span>).(*ent.User)
    
    // åˆ›å»ºèŠå¤©æœåŠ¡
    chatService := chatsvc.<span class="hljs-built_in">NewChatService</span>(dep)
    
    // æµå¼å›è°ƒ
    callback := <span class="hljs-built_in">func</span>(content string, done bool) error {
        data := map[string]interface{}{
            "choices": []map[string]interface{}{
                {
                    "delta": map[string]interface{}{
                        "<span class="hljs-attribute">content</span>": content,
                    },
                    "finish_reason": nil,
                },
            },
        }
        
        if done {
            data<span class="hljs-selector-attr">[<span class="hljs-string">"choices"</span>]</span>.([]map[string]interface{})<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-attr">[<span class="hljs-string">"finish_reason"</span>]</span> = "stop"
        }
        
        jsonData, _ := json.<span class="hljs-built_in">Marshal</span>(data)
        fmt.<span class="hljs-built_in">Fprintf</span>(c.Writer, <span class="hljs-string">"data: %s\n\n"</span>, jsonData)
        c.Writer.<span class="hljs-built_in">Flush</span>()
        
        return nil
    }
    
    <span class="hljs-comment">// æ‰§è¡Œæµå¼èŠå¤©</span>
    err := chatService.<span class="hljs-built_in">StreamChat</span>(c.Request.<span class="hljs-built_in">Context</span>(), user, service.Message, callback)
    if err != nil {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusInternalServerError, gin.H{"error": err.Error()})
        return
    }
}
```

## é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### ç»Ÿä¸€é”™è¯¯å¤„ç†

```go
<span class="hljs-comment">// pkg/errors/errors.go</span>
type AppError struct {
    <span class="hljs-selector-tag">Code</span>    int    `json:<span class="hljs-string">"code"</span>`
    Message string `json:<span class="hljs-string">"message"</span>`
    Details string `json:<span class="hljs-string">"details,omitempty"</span>`
}

func (e *AppError) <span class="hljs-built_in">Error</span>() string {
    return e<span class="hljs-selector-class">.Message</span>
}

func <span class="hljs-built_in">NewAppError</span>(code int, message string) *AppError {
    return &amp;AppError{
        <span class="hljs-selector-tag">Code</span>:    code,
        Message: message,
    }
}

<span class="hljs-comment">// é¢„å®šä¹‰é”™è¯¯</span>
<span class="hljs-selector-tag">var</span> (
    ErrUserNotFound     = NewAppError(<span class="hljs-number">404</span>, "User not found")
    ErrInvalidPassword  = <span class="hljs-built_in">NewAppError</span>(<span class="hljs-number">400</span>, "Invalid password")
    ErrUnauthorized     = <span class="hljs-built_in">NewAppError</span>(<span class="hljs-number">401</span>, "Unauthorized")
    ErrForbidden        = <span class="hljs-built_in">NewAppError</span>(<span class="hljs-number">403</span>, "Forbidden")
)
```

### ç»“æ„åŒ–æ—¥å¿—

```go
<span class="hljs-comment">// pkg/logging/logger.go</span>
type Logger interface {
    <span class="hljs-built_in">Debug</span>(msg string, fields ...Field)
    <span class="hljs-built_in">Info</span>(msg string, fields ...Field)
    <span class="hljs-built_in">Warn</span>(msg string, fields ...Field)
    <span class="hljs-built_in">Error</span>(msg string, fields ...Field)
    <span class="hljs-built_in">Fatal</span>(msg string, fields ...Field)
}

type Field struct {
    Key   string
    Value interface{}
}

func <span class="hljs-built_in">String</span>(key, value string) Field {
    return Field{Key: key, Value: value}
}

func <span class="hljs-built_in">Int</span>(key string, value int) Field {
    return Field{Key: key, Value: value}
}

<span class="hljs-comment">// ä½¿ç”¨æ–¹å¼</span>
logger<span class="hljs-selector-class">.Info</span>("User created successfully",
    String("user_id", user.ID),
    <span class="hljs-built_in">String</span>("email", user.Email),
    <span class="hljs-built_in">String</span>("ip", c.ClientIP()),
)
```

## é…ç½®ç®¡ç†

### é…ç½®ç»“æ„

```go
<span class="hljs-comment">// pkg/conf/conf.go</span>
type Config struct {
    System   SystemConfig   `mapstructure:<span class="hljs-string">"system"</span>`
    Database DatabaseConfig `mapstructure:<span class="hljs-string">"database"</span>`
    Redis    RedisConfig    `mapstructure:<span class="hljs-string">"redis"</span>`
    Storage  StorageConfig  `mapstructure:<span class="hljs-string">"storage"</span>`
}

type SystemConfig struct {
    Mode        string `mapstructure:<span class="hljs-string">"mode"</span>`
    Port        int    `mapstructure:<span class="hljs-string">"port"</span>`
    Debug       bool   `mapstructure:<span class="hljs-string">"debug"</span>`
    SessionName string `mapstructure:<span class="hljs-string">"session_name"</span>`
}

type DatabaseConfig struct {
    Type     string `mapstructure:<span class="hljs-string">"type"</span>`
    Host     string `mapstructure:<span class="hljs-string">"host"</span>`
    Port     int    `mapstructure:<span class="hljs-string">"port"</span>`
    User     string `mapstructure:<span class="hljs-string">"user"</span>`
    Password string `mapstructure:<span class="hljs-string">"password"</span>`
    Name     string `mapstructure:<span class="hljs-string">"name"</span>`
}

<span class="hljs-comment">// åŠ è½½é…ç½®</span>
func <span class="hljs-built_in">LoadConfig</span>(path string) (*Config, error) {
    viper<span class="hljs-selector-class">.SetConfigFile</span>(path)
    viper<span class="hljs-selector-class">.SetConfigType</span>("yaml")
    
    if err := viper.<span class="hljs-built_in">ReadInConfig</span>(); err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to read config: %w", err)
    }
    
    <span class="hljs-selector-tag">var</span> config Config
    if err := viper.<span class="hljs-built_in">Unmarshal</span>(&amp;config); err != nil {
        return nil, fmt<span class="hljs-selector-class">.Errorf</span>("failed to unmarshal config: %w", err)
    }
    
    return &amp;config, nil
}
```

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```go
<span class="hljs-comment">// service/user/user_test.go</span>
func <span class="hljs-built_in">TestUserService_CreateUser</span>(t *testing.T) {
    <span class="hljs-comment">// è®¾ç½®æµ‹è¯•æ•°æ®åº“</span>
    client := enttest.<span class="hljs-built_in">Open</span>(t, <span class="hljs-string">"sqlite3"</span>, <span class="hljs-string">"file:ent?mode=memory&amp;cache=shared&amp;_fk=1"</span>)
    defer client.<span class="hljs-built_in">Close</span>()
    
    // åˆ›å»ºæœåŠ¡
    service := <span class="hljs-built_in">NewUserService</span>(client)
    
    // æµ‹è¯•æ•°æ®
    req := &amp;CreateUserRequest{
        Name:     <span class="hljs-string">"Test User"</span>,
        Email:    <span class="hljs-string">"test@example.com"</span>,
        Password: <span class="hljs-string">"password123"</span>,
    }
    
    <span class="hljs-comment">// æ‰§è¡Œæµ‹è¯•</span>
    user, err := service.<span class="hljs-built_in">CreateUser</span>(context.<span class="hljs-built_in">Background</span>(), req)
    
    // æ–­è¨€
    assert.<span class="hljs-built_in">NoError</span>(t, err)
    assert.<span class="hljs-built_in">NotNil</span>(t, user)
    assert.<span class="hljs-built_in">Equal</span>(t, req.Name, user.Name)
    assert.<span class="hljs-built_in">Equal</span>(t, req.Email, user.Email)
}
```

### é›†æˆæµ‹è¯•

```go
<span class="hljs-comment">// test/integration/api_test.go</span>
func <span class="hljs-built_in">TestUserAPI</span>(t *testing.T) {
    <span class="hljs-comment">// è®¾ç½®æµ‹è¯•æœåŠ¡å™¨</span>
    router := <span class="hljs-built_in">setupTestRouter</span>()
    
    // åˆ›å»ºç”¨æˆ·
    createReq := `{"name":<span class="hljs-string">"Test User"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"test@example.com"</span>,<span class="hljs-string">"password"</span>:<span class="hljs-string">"password123"</span>}`
    w := httptest.<span class="hljs-built_in">NewRecorder</span>()
    req, _ := http.<span class="hljs-built_in">NewRequest</span>(<span class="hljs-string">"POST"</span>, <span class="hljs-string">"/api/v4/user"</span>, strings.<span class="hljs-built_in">NewReader</span>(createReq))
    req.Header.<span class="hljs-built_in">Set</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
    
    router.<span class="hljs-built_in">ServeHTTP</span>(w, req)
    
    assert.<span class="hljs-built_in">Equal</span>(t, http.StatusCreated, w.Code)
    
    var response map[string]interface{}
    json<span class="hljs-selector-class">.Unmarshal</span>(w.Body.Bytes(), &amp;response)
    
    assert<span class="hljs-selector-class">.Equal</span>(t, "Test User", response["data"].(map[string]interface{})<span class="hljs-selector-attr">[<span class="hljs-string">"name"</span>]</span>)
}
```

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

```go
<span class="hljs-comment">// ä½¿ç”¨ç´¢å¼•</span>
func (User) <span class="hljs-built_in">Indexes</span>() <span class="hljs-selector-attr">[]</span>ent<span class="hljs-selector-class">.Index</span> {
    return <span class="hljs-selector-attr">[]</span>ent<span class="hljs-selector-class">.Index</span>{
        index<span class="hljs-selector-class">.Fields</span>("email")<span class="hljs-selector-class">.Unique</span>(),
        index<span class="hljs-selector-class">.Fields</span>("name", "created_at"),
    }
}

<span class="hljs-comment">// æ‰¹é‡æ“ä½œ</span>
func (s *UserService) <span class="hljs-built_in">CreateUsers</span>(ctx context.Context, users []*CreateUserRequest) ([]*ent.User, error) {
    bulk := <span class="hljs-built_in">make</span>([]*ent.UserCreate, <span class="hljs-built_in">len</span>(users))
    for i, req := range users {
        bulk<span class="hljs-selector-attr">[i]</span> = s<span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.User</span><span class="hljs-selector-class">.Create</span>().
            <span class="hljs-built_in">SetName</span>(req.Name).
            <span class="hljs-built_in">SetEmail</span>(req.Email).
            <span class="hljs-built_in">SetPassword</span>(hashPassword(req.Password))
    }
    
    return s<span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.User</span><span class="hljs-selector-class">.CreateBulk</span>(bulk...)<span class="hljs-selector-class">.Save</span>(ctx)
}

<span class="hljs-comment">// é¢„åŠ è½½å…³è”</span>
func (s *UserService) <span class="hljs-built_in">GetUserWithFiles</span>(ctx context.Context, id int) (*ent.User, error) {
    return s<span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.User</span>.
        <span class="hljs-built_in">Query</span>().
        <span class="hljs-built_in">Where</span>(user.ID(id)).
        <span class="hljs-built_in">WithFiles</span>(func(q *ent.FileQuery) {
            <span class="hljs-selector-tag">q</span><span class="hljs-selector-class">.Order</span>(ent.Desc(file.FieldCreatedAt)).
              <span class="hljs-built_in">Limit</span>(<span class="hljs-number">10</span>)
        }).
        <span class="hljs-built_in">Only</span>(ctx)
}
```

### ç¼“å­˜ç­–ç•¥

```go
<span class="hljs-comment">// pkg/cache/cache.go</span>
type Cache interface {
    <span class="hljs-built_in">Get</span>(ctx context.Context, key string) (string, error)
    <span class="hljs-built_in">Set</span>(ctx context.Context, key string, value string, ttl time.Duration) error
    <span class="hljs-built_in">Delete</span>(ctx context.Context, key string) error
}

<span class="hljs-comment">// åœ¨æœåŠ¡ä¸­ä½¿ç”¨ç¼“å­˜</span>
func (s *UserService) <span class="hljs-built_in">GetUser</span>(ctx context.Context, id int) (*ent.User, error) {
    cacheKey := fmt.<span class="hljs-built_in">Sprintf</span>(<span class="hljs-string">"user:%d"</span>, id)
    
    // å°è¯•ä»ç¼“å­˜è·å–
    cached, err := s.cache.<span class="hljs-built_in">Get</span>(ctx, cacheKey)
    if err == nil {
        <span class="hljs-selector-tag">var</span> user ent<span class="hljs-selector-class">.User</span>
        if json<span class="hljs-selector-class">.Unmarshal</span>([]byte(cached), &amp;user) == nil {
            return &amp;user, nil
        }
    }
    
    <span class="hljs-comment">// ä»æ•°æ®åº“è·å–</span>
    user, err := s.client.User.<span class="hljs-built_in">Get</span>(ctx, id)
    if err != nil {
        return nil, err
    }
    
    <span class="hljs-comment">// å­˜å…¥ç¼“å­˜</span>
    if data, err := json.<span class="hljs-built_in">Marshal</span>(user); err == nil {
        s<span class="hljs-selector-class">.cache</span><span class="hljs-selector-class">.Set</span>(ctx, cacheKey, string(data), <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.Hour</span>)
    }
    
    return user, nil
}
```

## éƒ¨ç½²å’Œè¿ç»´

### Docker åŒ–

```dockerfile
# Dockerfile
FROM golang:<span class="hljs-number">1.23</span>-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=<span class="hljs-number">0</span> GOOS=linux go build -o cloudreve .

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

COPY --from=builder /app/cloudreve .
COPY --from=builder /app/conf.ini .

EXPOSE <span class="hljs-number">5212</span>
CMD [<span class="hljs-string">"./cloudreve"</span>]
```

### å¥åº·æ£€æŸ¥

```go
// routers/controllers/health.go
func <span class="hljs-built_in">HealthCheck</span>(c *gin.Context) {
    <span class="hljs-comment">// æ£€æŸ¥æ•°æ®åº“è¿æ¥</span>
    if err := <span class="hljs-built_in">checkDatabase</span>(); err != nil {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusServiceUnavailable, gin.H{
            "status": "unhealthy",
            "error":  err.Error(),
        })
        return
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ç¼“å­˜è¿æ¥</span>
    if err := <span class="hljs-built_in">checkCache</span>(); err != nil {
        c<span class="hljs-selector-class">.JSON</span>(http.StatusServiceUnavailable, gin.H{
            "status": "unhealthy",
            "error":  err.Error(),
        })
        return
    }
    
    c<span class="hljs-selector-class">.JSON</span>(http.StatusOK, gin.H{
        "status": "healthy",
        "timestamp": time.Now()<span class="hljs-selector-class">.Unix</span>(),
    })
}
```

## æ€»ç»“

Cloudreve çš„åç«¯æ¶æ„å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

<span class="hljs-number">1</span>. **æ¸…æ™°çš„åˆ†å±‚è®¾è®¡**: è·¯ç”±ã€æ§åˆ¶å™¨ã€æœåŠ¡ã€æ•°æ®è®¿é—®å±‚èŒè´£åˆ†æ˜
<span class="hljs-number">2</span>. **ç°ä»£åŒ–çš„ ORM**: ä½¿ç”¨ Ent æä¾›ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ
<span class="hljs-number">3</span>. **å®Œå–„çš„ä¸­é—´ä»¶ç³»ç»Ÿ**: è®¤è¯ã€æˆæƒã€æ—¥å¿—ã€é”™è¯¯å¤„ç†ç­‰
<span class="hljs-number">4</span>. **çµæ´»çš„å­˜å‚¨ç³»ç»Ÿ**: æ”¯æŒå¤šç§å­˜å‚¨åç«¯
<span class="hljs-number">5</span>. **å¼ºå¤§çš„èŠå¤©åŠŸèƒ½**: é›†æˆ OpenRouter API æ”¯æŒ AI å¯¹è¯
<span class="hljs-number">6</span>. **è‰¯å¥½çš„æµ‹è¯•è¦†ç›–**: å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
<span class="hljs-number">7</span>. **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜ã€æ•°æ®åº“ä¼˜åŒ–ã€å¹¶å‘å¤„ç†

è¿™ä¸ªæ¶æ„ä¸ºä½ å¼€å‘ä¾§è¾¹æ å¯¹è¯åŠŸèƒ½æä¾›äº†åšå®çš„åŸºç¡€ï¼Œä½ å¯ä»¥å‚è€ƒç°æœ‰çš„èŠå¤©æœåŠ¡å®ç°æ¥æ‰©å±•æ–°åŠŸèƒ½ã€‚
</code></pre>
<h3 data-id="heading-6"><strong>04-api-communication.md - API é€šä¿¡æœºåˆ¶</strong></h3>
<ul>
<li>RESTful API è®¾è®¡è§„èŒƒ</li>
<li>JWT è®¤è¯æµç¨‹å’Œ SSE æµå¼ä¼ è¾“</li>
<li>é”™è¯¯å¤„ç†å’Œç¼“å­˜ç­–ç•¥</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"># Cloudreve å‰åç«¯é€šä¿¡æœºåˆ¶è¯¦è§£

## API è®¾è®¡æ¦‚è§ˆ

Cloudreve é‡‡ç”¨ RESTful API è®¾è®¡ï¼Œå‰åç«¯é€šè¿‡ HTTP/HTTPS åè®®è¿›è¡Œé€šä¿¡ã€‚API éµå¾ªç»Ÿä¸€çš„è®¾è®¡è§„èŒƒï¼Œæä¾›æ¸…æ™°çš„æ¥å£å®šä¹‰å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚

### API ç‰ˆæœ¬ç®¡ç†

```
åŸºç¡€è·¯å¾„: /api/v4
å½“å‰ç‰ˆæœ¬: v4
```

æ‰€æœ‰ API è¯·æ±‚éƒ½ä½¿ç”¨ `/api/v4` ä½œä¸ºåŸºç¡€è·¯å¾„ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†å’Œå‘åå…¼å®¹ã€‚

## è¯·æ±‚å“åº”æ ¼å¼

### ç»Ÿä¸€å“åº”æ ¼å¼

```typescript
interface Response&lt;T&gt; {
  data: T;           <span class="hljs-comment">// å“åº”æ•°æ®</span>
  code: number;      <span class="hljs-comment">// çŠ¶æ€ç </span>
  msg: string;       <span class="hljs-comment">// æ¶ˆæ¯</span>
  error?: string;    <span class="hljs-comment">// é”™è¯¯ä¿¡æ¯</span>
  correlation_id?: string; <span class="hljs-comment">// è¯·æ±‚è¿½è¸ªID</span>
}
```

### æˆåŠŸå“åº”ç¤ºä¾‹

```json
{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç”¨æˆ·å"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"user@example.com"</span>
  },
  <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
  <span class="hljs-string">"msg"</span>: <span class="hljs-string">"success"</span>
}
```

### é”™è¯¯å“åº”ç¤ºä¾‹

```json
{
  <span class="hljs-string">"data"</span>: null,
  <span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>,
  <span class="hljs-string">"msg"</span>: <span class="hljs-string">"å‚æ•°éªŒè¯å¤±è´¥"</span>,
  <span class="hljs-string">"error"</span>: <span class="hljs-string">"email field is required"</span>,
  <span class="hljs-string">"correlation_id"</span>: <span class="hljs-string">"req-123456789"</span>
}
```

## è®¤è¯æœºåˆ¶

### JWT Token è®¤è¯

```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant S as æœåŠ¡å™¨
    participant DB as æ•°æ®åº“

    C-&gt;&gt;S: POST /api/v4/session/<span class="hljs-built_in">token</span> (ç”¨æˆ·å/å¯†ç )
    S-&gt;&gt;DB: éªŒè¯ç”¨æˆ·å‡­æ®
    DB--&gt;&gt;S: è¿”å›ç”¨æˆ·ä¿¡æ¯
    S--&gt;&gt;C: è¿”å› JWT Token
    
    Note over C: å­˜å‚¨ Token åˆ° localStorage
    
    C-&gt;&gt;S: GET /api/v4/user/<span class="hljs-built_in">info</span> (Authorization: Bearer &lt;token&gt;)
    S-&gt;&gt;S: éªŒè¯ Token
    S--&gt;&gt;C: è¿”å›ç”¨æˆ·ä¿¡æ¯
```

### Token ç®¡ç†

#### <span class="hljs-number">1.</span> è·å– Token

```typescript
<span class="hljs-comment">// å‰ç«¯ç™»å½•è¯·æ±‚</span>
<span class="hljs-type">const</span> loginRequest = {
  email: <span class="hljs-string">"user@example.com"</span>,
  password: <span class="hljs-string">"password123"</span>
};

<span class="hljs-type">const</span> response = await axios.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/api/v4/session/token'</span>, loginRequest);
<span class="hljs-type">const</span> { access_token, refresh_token } = response.data;

<span class="hljs-comment">// å­˜å‚¨ Token</span>
SessionManager.<span class="hljs-built_in">setTokens</span>(access_token, refresh_token);
```

#### <span class="hljs-number">2.</span> è¯·æ±‚æ‹¦æˆªå™¨

```typescript
<span class="hljs-comment">// api/request.ts</span>
instance.interceptors.request.<span class="hljs-built_in">use</span>(<span class="hljs-built_in">async</span> (config) =&gt; {
  <span class="hljs-type">const</span> token = await SessionManager.<span class="hljs-built_in">getAccessToken</span>();
  <span class="hljs-keyword">if</span> (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  <span class="hljs-keyword">return</span> config;
});
```

#### <span class="hljs-number">3.</span> Token åˆ·æ–°æœºåˆ¶

```typescript
instance.interceptors.response.<span class="hljs-built_in">use</span>(
  (response) =&gt; response,
  <span class="hljs-built_in">async</span> (error) =&gt; {
    <span class="hljs-keyword">if</span> (error.response?.status === <span class="hljs-number">401</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// å°è¯•åˆ·æ–° Token</span>
        await SessionManager.<span class="hljs-built_in">refreshToken</span>();
        <span class="hljs-comment">// é‡è¯•åŸè¯·æ±‚</span>
        <span class="hljs-keyword">return</span> instance.<span class="hljs-built_in">request</span>(error.config);
      } <span class="hljs-built_in">catch</span> (refreshError) {
        <span class="hljs-comment">// åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•é¡µ</span>
        router.<span class="hljs-built_in">push</span>(<span class="hljs-string">'/session'</span>);
      }
    }
    <span class="hljs-keyword">return</span> Promise.<span class="hljs-built_in">reject</span>(error);
  }
);
```

## æ ¸å¿ƒ API æ¥å£

### <span class="hljs-number">1.</span> ç”¨æˆ·è®¤è¯ API

#### ç™»å½•
```http
POST /api/v4/session/token
Content-Type: application/json

{
  <span class="hljs-string">"email"</span>: <span class="hljs-string">"user@example.com"</span>,
  <span class="hljs-string">"password"</span>: <span class="hljs-string">"password123"</span>
}
```

å“åº”ï¼š
```json
{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"eyJhbGciOiJIUzI1NiIs..."</span>,
    <span class="hljs-string">"refresh_token"</span>: <span class="hljs-string">"eyJhbGciOiJIUzI1NiIs..."</span>,
    <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3600</span>,
    <span class="hljs-string">"user"</span>: {
      <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç”¨æˆ·å"</span>,
      <span class="hljs-string">"email"</span>: <span class="hljs-string">"user@example.com"</span>
    }
  },
  <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
  <span class="hljs-string">"msg"</span>: <span class="hljs-string">"ç™»å½•æˆåŠŸ"</span>
}
```

#### åˆ·æ–° Token
```http
POST /api/v4/session/refresh
Content-Type: application/json

{
  <span class="hljs-string">"refresh_token"</span>: <span class="hljs-string">"eyJhbGciOiJIUzI1NiIs..."</span>
}
```

#### ç™»å‡º
```http
DELETE /api/v4/session/token
Authorization: Bearer &lt;access_token&gt;
```

### <span class="hljs-number">2.</span> æ–‡ä»¶ç®¡ç† API

#### è·å–æ–‡ä»¶åˆ—è¡¨
```http
GET /api/v4/file/list?path=/documents&amp;sort=name&amp;order=asc
Authorization: Bearer &lt;access_token&gt;
```

å“åº”ï¼š
```json
{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"files"</span>: [
      {
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"file_123"</span>,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"document.pdf"</span>,
        <span class="hljs-string">"size"</span>: <span class="hljs-number">1024000</span>,
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"file"</span>,
        <span class="hljs-string">"created_at"</span>: <span class="hljs-string">"2023-01-01T00:00:00Z"</span>,
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"cloudreve://my/documents/document.pdf"</span>
      }
    ],
    <span class="hljs-string">"total"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/documents"</span>
  },
  <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
  <span class="hljs-string">"msg"</span>: <span class="hljs-string">"success"</span>
}
```

#### æ–‡ä»¶ä¸Šä¼ 
```http
POST /api/v4/file/upload
Authorization: Bearer &lt;access_token&gt;
Content-Type: multipart/form-data

file: &lt;binary_data&gt;
path: /documents
```

#### æ–‡ä»¶ä¸‹è½½
```http
GET /api/v4/file/download/&lt;file_id&gt;
Authorization: Bearer &lt;access_token&gt;
```

### <span class="hljs-number">3.</span> èŠå¤© API

#### æ™®é€šèŠå¤©
```http
POST /api/v4/chat
Authorization: Bearer &lt;access_token&gt;
Content-Type: application/json

{
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"è¯·å¸®æˆ‘æ€»ç»“ä¸€ä¸‹æ–‡æ¡£å†…å®¹"</span>
}
```

å“åº”ï¼š
```json
{
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"response"</span>: <span class="hljs-string">"æ ¹æ®æ‚¨çš„æ–‡æ¡£å†…å®¹ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢..."</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"google/gemini-2.5-pro"</span>,
    <span class="hljs-string">"usage"</span>: {
      <span class="hljs-string">"prompt_tokens"</span>: <span class="hljs-number">100</span>,
      <span class="hljs-string">"completion_tokens"</span>: <span class="hljs-number">200</span>,
      <span class="hljs-string">"total_tokens"</span>: <span class="hljs-number">300</span>
    }
  },
  <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
  <span class="hljs-string">"msg"</span>: <span class="hljs-string">"success"</span>
}
```

#### æµå¼èŠå¤©
```http
POST /api/v4/chat/stream
Authorization: Bearer &lt;access_token&gt;
Content-Type: application/json

{
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"è¯·å¸®æˆ‘åˆ†æè¿™äº›æ–‡ä»¶"</span>
}
```

å“åº”ï¼ˆSSE æ ¼å¼ï¼‰ï¼š
```
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive

data: {<span class="hljs-string">"choices"</span>:[{<span class="hljs-string">"delta"</span>:{<span class="hljs-string">"content"</span>:<span class="hljs-string">"æ ¹æ®"</span>},<span class="hljs-string">"finish_reason"</span>:null}]}

data: {<span class="hljs-string">"choices"</span>:[{<span class="hljs-string">"delta"</span>:{<span class="hljs-string">"content"</span>:<span class="hljs-string">"æ‚¨çš„"</span>},<span class="hljs-string">"finish_reason"</span>:null}]}

data: {<span class="hljs-string">"choices"</span>:[{<span class="hljs-string">"delta"</span>:{<span class="hljs-string">"content"</span>:<span class="hljs-string">"æ–‡ä»¶"</span>},<span class="hljs-string">"finish_reason"</span>:null}]}

data: {<span class="hljs-string">"choices"</span>:[{<span class="hljs-string">"delta"</span>:{<span class="hljs-string">"content"</span>:<span class="hljs-string">""</span>},<span class="hljs-string">"finish_reason"</span>:<span class="hljs-string">"stop"</span>}]}
```

## é”™è¯¯å¤„ç†æœºåˆ¶

### HTTP çŠ¶æ€ç è§„èŒƒ

| çŠ¶æ€ç  | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| <span class="hljs-number">200</span> | æˆåŠŸ | è¯·æ±‚æˆåŠŸå¤„ç† |
| <span class="hljs-number">201</span> | åˆ›å»ºæˆåŠŸ | èµ„æºåˆ›å»ºæˆåŠŸ |
| <span class="hljs-number">400</span> | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ |
| <span class="hljs-number">401</span> | æœªè®¤è¯ | Token æ— æ•ˆæˆ–è¿‡æœŸ |
| <span class="hljs-number">403</span> | æƒé™ä¸è¶³ | æ²¡æœ‰è®¿é—®æƒé™ |
| <span class="hljs-number">404</span> | èµ„æºä¸å­˜åœ¨ | è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ |
| <span class="hljs-number">409</span> | å†²çª | èµ„æºå†²çªï¼ˆå¦‚é‚®ç®±å·²å­˜åœ¨ï¼‰ |
| <span class="hljs-number">422</span> | éªŒè¯å¤±è´¥ | ä¸šåŠ¡é€»è¾‘éªŒè¯å¤±è´¥ |
| <span class="hljs-number">500</span> | æœåŠ¡å™¨é”™è¯¯ | å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ |

### é”™è¯¯å“åº”æ ¼å¼

```typescript
interface ErrorResponse {
  code: number;
  msg: string;
  error?: string;
  details?: {
    field: string;
    message: string;
  }[];
  correlation_id?: string;
}
```

### å‰ç«¯é”™è¯¯å¤„ç†

```typescript
<span class="hljs-comment">// å…¨å±€é”™è¯¯å¤„ç†</span>
instance.interceptors.response.<span class="hljs-built_in">use</span>(
  (response) =&gt; response,
  (error) =&gt; {
    <span class="hljs-type">const</span> { response } = error;
    
    <span class="hljs-keyword">if</span> (response) {
      <span class="hljs-type">const</span> { status, data } = response;
      
      <span class="hljs-keyword">switch</span> (status) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">400</span>:
          <span class="hljs-built_in">enqueueSnackbar</span>(data.msg || <span class="hljs-string">'è¯·æ±‚å‚æ•°é”™è¯¯'</span>, { variant: <span class="hljs-string">'error'</span> });
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
          <span class="hljs-built_in">enqueueSnackbar</span>(<span class="hljs-string">'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'</span>, { variant: <span class="hljs-string">'error'</span> });
          router.<span class="hljs-built_in">push</span>(<span class="hljs-string">'/session'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
          <span class="hljs-built_in">enqueueSnackbar</span>(<span class="hljs-string">'æƒé™ä¸è¶³'</span>, { variant: <span class="hljs-string">'error'</span> });
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">404</span>:
          <span class="hljs-built_in">enqueueSnackbar</span>(<span class="hljs-string">'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨'</span>, { variant: error<span class="hljs-number">'</span> });
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
          <span class="hljs-built_in">enqueueSnackbar</span>(<span class="hljs-string">'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'</span>, { variant: <span class="hljs-string">'error'</span> });
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
          <span class="hljs-built_in">enqueueSnackbar</span>(data.msg || <span class="hljs-string">'æœªçŸ¥é”™è¯¯'</span>, { variant: <span class="hljs-string">'error'</span> });
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">enqueueSnackbar</span>(<span class="hljs-string">'ç½‘ç»œè¿æ¥é”™è¯¯'</span>, { variant: <span class="hljs-string">'error'</span> });
    }
    
    <span class="hljs-keyword">return</span> Promise.<span class="hljs-built_in">reject</span>(error);
  }
);
```

## æµå¼æ•°æ®ä¼ è¾“

### <span class="hljs-built_in">Server</span>-<span class="hljs-function">Sent <span class="hljs-title">Events</span> <span class="hljs-params">(SSE)</span>

Cloudreve ä½¿ç”¨ SSE åè®®å®ç°æµå¼æ•°æ®ä¼ è¾“ï¼Œä¸»è¦ç”¨äºèŠå¤©åŠŸèƒ½çš„å®æ—¶å“åº”ã€‚

#### å‰ç«¯ SSE å¤„ç†

```typescript
<span class="hljs-comment">// æµå¼èŠå¤©å®ç°</span>
<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> streamChat </span>= <span class="hljs-built_in">async</span> (
  message: string,
  onMessage: (content: string) =&gt; <span class="hljs-type">void</span>,
  onComplete: () =&gt; <span class="hljs-type">void</span>,
  onError: (error: Error) =&gt; <span class="hljs-type">void</span>
) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-type">const</span> token = await SessionManager.<span class="hljs-built_in">getAccessToken</span>();
    
    <span class="hljs-type">const</span> response = await <span class="hljs-built_in">fetch</span>(<span class="hljs-string">'/api/v4/chat/stream'</span>, {
      method: <span class="hljs-string">'POST'</span>,
      headers: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
        <span class="hljs-string">'Authorization'</span>: `Bearer ${token}`,
      },
      body: JSON.<span class="hljs-built_in">stringify</span>({ message }),
    });
    
    <span class="hljs-keyword">if</span> (!response.ok) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    <span class="hljs-type">const</span> reader = response.body?.<span class="hljs-built_in">getReader</span>();
    <span class="hljs-type">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextDecoder</span>();
    
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      <span class="hljs-type">const</span> { done, value } = await reader!.<span class="hljs-built_in">read</span>();
      
      <span class="hljs-keyword">if</span> (done) {
        <span class="hljs-built_in">onComplete</span>();
        <span class="hljs-keyword">break</span>;
      }
      
      <span class="hljs-type">const</span> chunk = decoder.<span class="hljs-built_in">decode</span>(value);
      <span class="hljs-type">const</span> lines = chunk.<span class="hljs-built_in">split</span>(<span class="hljs-string">'\n'</span>);
      
      <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> line of lines) {
        <span class="hljs-keyword">if</span> (line.<span class="hljs-built_in">startsWith</span>(<span class="hljs-string">'data: '</span>)) {
          <span class="hljs-type">const</span> data = line.<span class="hljs-built_in">slice</span>(<span class="hljs-number">6</span>);
          
          <span class="hljs-keyword">if</span> (data === <span class="hljs-string">'[DONE]'</span>) {
            <span class="hljs-built_in">onComplete</span>();
            <span class="hljs-keyword">return</span>;
          }
          
          <span class="hljs-keyword">try</span> {
            <span class="hljs-type">const</span> parsed = JSON.<span class="hljs-built_in">parse</span>(data);
            <span class="hljs-type">const</span> content = parsed.choices?.[<span class="hljs-number">0</span>]?.delta?.content;
            
            <span class="hljs-keyword">if</span> (content) {
              <span class="hljs-built_in">onMessage</span>(content);
            }
            
            <span class="hljs-keyword">if</span> (parsed.choices?.[<span class="hljs-number">0</span>]?.finish_reason === <span class="hljs-string">'stop'</span>) {
              <span class="hljs-built_in">onComplete</span>();
              <span class="hljs-keyword">return</span>;
            }
          } <span class="hljs-built_in">catch</span> (parseError) {
            console.<span class="hljs-built_in">warn</span>(<span class="hljs-string">'Failed to parse SSE data:'</span>, data);
          }
        }
      }
    }
  } <span class="hljs-built_in">catch</span> (error) {
    <span class="hljs-built_in">onError</span>(error as Error);
  }
};
```

#### åç«¯ SSE å®ç°

```go
<span class="hljs-comment">// æ§åˆ¶å™¨ä¸­çš„æµå¼å“åº”</span>
<span class="hljs-function">func <span class="hljs-title">ChatStream</span><span class="hljs-params">(c *gin.Context)</span> </span>{
    <span class="hljs-comment">// è®¾ç½® SSE å“åº”å¤´</span>
    c.<span class="hljs-built_in">Header</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/event-stream"</span>)
    c.<span class="hljs-built_in">Header</span>(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"no-cache"</span>)
    c.<span class="hljs-built_in">Header</span>(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"keep-alive"</span>)
    c.<span class="hljs-built_in">Header</span>(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>)
    
    <span class="hljs-comment">// è·å–å‚æ•°</span>
    service := ParametersFromContext[*chatsvc.Service](c, ChatParameterCtx)
    user := c.<span class="hljs-built_in">MustGet</span>(<span class="hljs-string">"user"</span>).(*ent.User)
    
    <span class="hljs-comment">// åˆ›å»ºèŠå¤©æœåŠ¡</span>
    chatService := chatsvc.<span class="hljs-built_in">NewChatService</span>(dep)
    
    <span class="hljs-comment">// æµå¼å›è°ƒå‡½æ•°</span>
    callback := <span class="hljs-built_in">func</span>(content string, done <span class="hljs-type">bool</span>) error {
        data := map[string]interface{}{
            <span class="hljs-string">"id"</span>:      <span class="hljs-string">"chatcmpl-"</span> + <span class="hljs-built_in">generateID</span>(),
            <span class="hljs-string">"object"</span>:  <span class="hljs-string">"chat.completion.chunk"</span>,
            <span class="hljs-string">"created"</span>: time.<span class="hljs-built_in">Now</span>().<span class="hljs-built_in">Unix</span>(),
            <span class="hljs-string">"model"</span>:   <span class="hljs-string">"google/gemini-2.5-pro"</span>,
            <span class="hljs-string">"choices"</span>: []map[string]interface{}{
                {
                    <span class="hljs-string">"index"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"delta"</span>: map[string]interface{}{
                        <span class="hljs-string">"content"</span>: content,
                    },
                    <span class="hljs-string">"finish_reason"</span>: nil,
                },
            },
        }
        
        <span class="hljs-keyword">if</span> done {
            data[<span class="hljs-string">"choices"</span>].([]map[string]interface{})[<span class="hljs-number">0</span>][<span class="hljs-string">"finish_reason"</span>] = <span class="hljs-string">"stop"</span>
        }
        
        jsonData, _ := json.<span class="hljs-built_in">Marshal</span>(data)
        fmt.<span class="hljs-built_in">Fprintf</span>(c.Writer, <span class="hljs-string">"data: %s\n\n"</span>, jsonData)
        c.Writer.<span class="hljs-built_in">Flush</span>()
        
        <span class="hljs-keyword">return</span> nil
    }
    
    <span class="hljs-comment">// æ‰§è¡Œæµå¼èŠå¤©</span>
    err := chatService.<span class="hljs-built_in">StreamChatWithFiles</span>(c.Request.<span class="hljs-built_in">Context</span>(), user, service.Message, callback)
    <span class="hljs-keyword">if</span> err != nil {
        errorData := map[string]interface{}{
            <span class="hljs-string">"error"</span>: map[string]interface{}{
                <span class="hljs-string">"message"</span>: err.<span class="hljs-built_in">Error</span>(),
                <span class="hljs-string">"type"</span>:    <span class="hljs-string">"server_error"</span>,
            },
        }
        jsonData, _ := json.<span class="hljs-built_in">Marshal</span>(errorData)
        fmt.<span class="hljs-built_in">Fprintf</span>(c.Writer, <span class="hljs-string">"data: %s\n\n"</span>, jsonData)
        c.Writer.<span class="hljs-built_in">Flush</span>()
    }
    
    <span class="hljs-comment">// å‘é€ç»“æŸæ ‡è®°</span>
    fmt.<span class="hljs-built_in">Fprintf</span>(c.Writer, <span class="hljs-string">"data: [DONE]\n\n"</span>)
    c.Writer.<span class="hljs-built_in">Flush</span>()
}
```

## æ–‡ä»¶ä¸Šä¼ æœºåˆ¶

### åˆ†ç‰‡ä¸Šä¼ 

å¯¹äºå¤§æ–‡ä»¶ï¼ŒCloudreve æ”¯æŒåˆ†ç‰‡ä¸Šä¼ æœºåˆ¶ï¼š

```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant S as æœåŠ¡å™¨
    participant FS as æ–‡ä»¶ç³»ç»Ÿ

    C-&gt;&gt;S: <span class="hljs-number">1.</span> åˆ›å»ºä¸Šä¼ ä¼šè¯
    S--&gt;&gt;C: è¿”å› session_id
    
    loop åˆ†ç‰‡ä¸Šä¼ 
        C-&gt;&gt;S: <span class="hljs-number">2.</span> ä¸Šä¼ åˆ†ç‰‡ (session_id, chunk_index, chunk_data)
        S-&gt;&gt;FS: å­˜å‚¨åˆ†ç‰‡
        S--&gt;&gt;C: è¿”å›ä¸Šä¼ è¿›åº¦
    end
    
    C-&gt;&gt;S: <span class="hljs-number">3.</span> å®Œæˆä¸Šä¼  (session_id)
    S-&gt;&gt;FS: åˆå¹¶åˆ†ç‰‡
    S--&gt;&gt;C: è¿”å›æ–‡ä»¶ä¿¡æ¯
```

#### å‰ç«¯åˆ†ç‰‡ä¸Šä¼ å®ç°

```typescript
<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> uploadFileWithProgress = <span class="hljs-built_in">async</span> (
  file: <span class="hljs-built_in">File</span>,
  path: string,
  onProgress: (progress: number) =&gt; <span class="hljs-type">void</span>
): Promise&lt;FileResponse&gt; =&gt; {
  <span class="hljs-type">const</span> CHUNK_SIZE = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 1MB per chunk</span>
  <span class="hljs-type">const</span> totalChunks = Math.<span class="hljs-built_in">ceil</span>(file.size / CHUNK_SIZE);
  
  <span class="hljs-comment">// 1. åˆ›å»ºä¸Šä¼ ä¼šè¯</span>
  <span class="hljs-type">const</span> sessionResponse = await api.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/file/upload/session'</span>, {
    name: file.name,
    size: file.size,
    path: path,
    chunks: totalChunks,
  });
  
  <span class="hljs-type">const</span> sessionId = sessionResponse.data.session_id;
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 2. åˆ†ç‰‡ä¸Šä¼ </span>
    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; totalChunks; i++) {
      <span class="hljs-type">const</span> start = i * CHUNK_SIZE;
      <span class="hljs-type">const</span> end = Math.<span class="hljs-built_in">min</span>(start + CHUNK_SIZE, file.size);
      <span class="hljs-type">const</span> chunk = file.<span class="hljs-built_in">slice</span>(start, end);
      
      <span class="hljs-type">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FormData</span>();
      formData.<span class="hljs-built_in">append</span>(<span class="hljs-string">'chunk'</span>, chunk);
      formData.<span class="hljs-built_in">append</span>(<span class="hljs-string">'session_id'</span>, sessionId);
      formData.<span class="hljs-built_in">append</span>(<span class="hljs-string">'chunk_index'</span>, i.<span class="hljs-built_in">toString</span>());
      
      await api.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/file/upload/chunk'</span>, formData, {
        headers: {
          <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'multipart/form-data'</span>,
        },
      });
      
      <span class="hljs-comment">// æ›´æ–°è¿›åº¦</span>
      <span class="hljs-type">const</span> progress = Math.<span class="hljs-built_in">round</span>(((i + <span class="hljs-number">1</span>) / totalChunks) * <span class="hljs-number">100</span>);
      <span class="hljs-built_in">onProgress</span>(progress);
    }
    
    <span class="hljs-comment">// 3. å®Œæˆä¸Šä¼ </span>
    <span class="hljs-type">const</span> completeResponse = await api.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/file/upload/complete'</span>, {
      session_id: sessionId,
    });
    
    <span class="hljs-keyword">return</span> completeResponse.data;
  } <span class="hljs-built_in">catch</span> (error) {
    <span class="hljs-comment">// ä¸Šä¼ å¤±è´¥ï¼Œæ¸…ç†ä¼šè¯</span>
    await api.<span class="hljs-built_in">delete</span>(`/file/upload/session/${sessionId}`);
    <span class="hljs-keyword">throw</span> error;
  }
};
```

## ç¼“å­˜ç­–ç•¥

### å‰ç«¯ç¼“å­˜

#### <span class="hljs-number">1.</span> HTTP ç¼“å­˜

```typescript
<span class="hljs-comment">// ä¸ºé™æ€èµ„æºè®¾ç½®ç¼“å­˜</span>
<span class="hljs-type">const</span> cacheableRequests = [
  <span class="hljs-string">'/api/v4/site/config'</span>,
  <span class="hljs-string">'/api/v4/user/info'</span>,
];

instance.interceptors.request.<span class="hljs-built_in">use</span>((config) =&gt; {
  <span class="hljs-keyword">if</span> (cacheableRequests.<span class="hljs-built_in">some</span>(url =&gt; config.url?.<span class="hljs-built_in">includes</span>(url))) {
    config.headers[<span class="hljs-string">'Cache-Control'</span>] = <span class="hljs-string">'max-age=300'</span>; <span class="hljs-comment">// 5åˆ†é’Ÿç¼“å­˜</span>
  }
  <span class="hljs-keyword">return</span> config;
});
```

#### <span class="hljs-number">2.</span> å†…å­˜ç¼“å­˜

```typescript
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiCache</span> {
  <span class="hljs-keyword">private</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>&lt;string, { data: any; expires: number }&gt;();
  
  <span class="hljs-built_in">get</span>(key: string): any | null {
    <span class="hljs-type">const</span> item = <span class="hljs-keyword">this</span>.cache.<span class="hljs-built_in">get</span>(key);
    <span class="hljs-keyword">if</span> (!item || Date.<span class="hljs-built_in">now</span>() &gt; item.expires) {
      <span class="hljs-keyword">this</span>.cache.<span class="hljs-built_in">delete</span>(key);
      <span class="hljs-keyword">return</span> null;
    }
    <span class="hljs-keyword">return</span> item.data;
  }
  
  <span class="hljs-built_in">set</span>(key: string, data: any, ttl: number = <span class="hljs-number">300000</span>): <span class="hljs-type">void</span> {
    <span class="hljs-keyword">this</span>.cache.<span class="hljs-built_in">set</span>(key, {
      data,
      expires: Date.<span class="hljs-built_in">now</span>() + ttl,
    });
  }
  
  <span class="hljs-built_in">clear</span>(): <span class="hljs-type">void</span> {
    <span class="hljs-keyword">this</span>.cache.<span class="hljs-built_in">clear</span>();
  }
}

<span class="hljs-type">const</span> apiCache = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ApiCache</span>();

<span class="hljs-comment">// åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­ä½¿ç”¨ç¼“å­˜</span>
instance.interceptors.request.<span class="hljs-built_in">use</span>((config) =&gt; {
  <span class="hljs-keyword">if</span> (config.method === <span class="hljs-string">'GET'</span>) {
    <span class="hljs-type">const</span> cacheKey = `${config.url}?${JSON.<span class="hljs-built_in">stringify</span>(config.params)}`;
    <span class="hljs-type">const</span> cached = apiCache.<span class="hljs-built_in">get</span>(cacheKey);
    
    <span class="hljs-keyword">if</span> (cached) {
      <span class="hljs-comment">// è¿”å›ç¼“å­˜çš„ Promise</span>
      <span class="hljs-keyword">return</span> Promise.<span class="hljs-built_in">resolve</span>({
        ...config,
        adapter: () =&gt; Promise.<span class="hljs-built_in">resolve</span>({
          data: cached,
          status: <span class="hljs-number">200</span>,
          statusText: <span class="hljs-string">'OK'</span>,
          headers: {},
          config,
        }),
      });
    }
  }
  
  <span class="hljs-keyword">return</span> config;
});
```

### åç«¯ç¼“å­˜

```go
<span class="hljs-comment">// ç¼“å­˜ä¸­é—´ä»¶</span>
<span class="hljs-function">func <span class="hljs-title">CacheMiddleware</span><span class="hljs-params">(ttl time.Duration)</span> gin.HandlerFunc </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">func</span>(c *gin.Context) {
        <span class="hljs-keyword">if</span> c.Request.Method != <span class="hljs-string">"GET"</span> {
            c.<span class="hljs-built_in">Next</span>()
            <span class="hljs-keyword">return</span>
        }
        
        cacheKey := fmt.<span class="hljs-built_in">Sprintf</span>(<span class="hljs-string">"api:%s:%s"</span>, c.Request.URL.Path, c.Request.URL.RawQuery)
        
        <span class="hljs-comment">// å°è¯•ä»ç¼“å­˜è·å–</span>
        <span class="hljs-keyword">if</span> cached, err := cache.<span class="hljs-built_in">Get</span>(c.Request.<span class="hljs-built_in">Context</span>(), cacheKey); err == nil {
            c.<span class="hljs-built_in">Header</span>(<span class="hljs-string">"X-Cache"</span>, <span class="hljs-string">"HIT"</span>)
            c.<span class="hljs-built_in">Data</span>(<span class="hljs-number">200</span>, <span class="hljs-string">"application/json"</span>, []<span class="hljs-built_in">byte</span>(cached))
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// åŒ…è£… ResponseWriter ä»¥æ•è·å“åº”</span>
        w := &amp;responseWriter{
            ResponseWriter: c.Writer,
            body:          &amp;bytes.Buffer{},
        }
        c.Writer = w
        
        c.<span class="hljs-built_in">Next</span>()
        
        <span class="hljs-comment">// ç¼“å­˜å“åº”</span>
        <span class="hljs-keyword">if</span> w.status == <span class="hljs-number">200</span> {
            cache.<span class="hljs-built_in">Set</span>(c.Request.<span class="hljs-built_in">Context</span>(), cacheKey, w.body.<span class="hljs-built_in">String</span>(), ttl)
        }
    }
}
```

## è·¨åŸŸå¤„ç†

### CORS é…ç½®

```go
<span class="hljs-comment">// middleware/cors.go</span>
func <span class="hljs-built_in">CORS</span>() gin.HandlerFunc {
    <span class="hljs-keyword">return</span> cors.<span class="hljs-built_in">New</span>(cors.Config{
        AllowOrigins:     []string{<span class="hljs-string">"http://localhost:3000"</span>, <span class="hljs-string">"https://yourdomain.com"</span>},
        AllowMethods:     []string{<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>, <span class="hljs-string">"PUT"</span>, <span class="hljs-string">"DELETE"</span>, <span class="hljs-string">"OPTIONS"</span>},
        AllowHeaders:     []string{<span class="hljs-string">"Origin"</span>, <span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"Authorization"</span>},
        ExposeHeaders:    []string{<span class="hljs-string">"Content-Length"</span>},
        AllowCredentials: <span class="hljs-literal">true</span>,
        MaxAge:           <span class="hljs-number">12</span> * time.Hour,
    })
}
```

### é¢„æ£€è¯·æ±‚å¤„ç†

```typescript
<span class="hljs-comment">// å‰ç«¯å¤„ç†é¢„æ£€è¯·æ±‚</span>
axios.defaults.withCredentials = <span class="hljs-literal">true</span>;

<span class="hljs-comment">// è‡ªå®šä¹‰é¢„æ£€è¯·æ±‚å¤„ç†</span>
instance.interceptors.request.<span class="hljs-built_in">use</span>((config) =&gt; {
  <span class="hljs-comment">// å¯¹äºå¤æ‚è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ OPTIONS é¢„æ£€è¯·æ±‚</span>
  <span class="hljs-keyword">if</span> (config.method !== <span class="hljs-string">'GET'</span> &amp;&amp; config.method !== <span class="hljs-string">'POST'</span>) {
    config.headers[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>;
  }
  
  <span class="hljs-keyword">return</span> config;
});
```

## API ç‰ˆæœ¬å…¼å®¹

### ç‰ˆæœ¬ç­–ç•¥

```typescript
<span class="hljs-comment">// API ç‰ˆæœ¬ç®¡ç†</span>
<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> API_VERSIONS = {
  V3: <span class="hljs-string">'/api/v3'</span>,
  V4: <span class="hljs-string">'/api/v4'</span>,
} as <span class="hljs-type">const</span>;

<span class="hljs-comment">// æ ¹æ®åŠŸèƒ½é€‰æ‹© API ç‰ˆæœ¬</span>
<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> createApiClient = (version: keyof typeof API_VERSIONS = <span class="hljs-string">'V4'</span>) =&gt; {
  <span class="hljs-keyword">return</span> axios.<span class="hljs-built_in">create</span>({
    baseURL: API_VERSIONS[version],
    timeout: <span class="hljs-number">10000</span>,
  });
};

<span class="hljs-comment">// å‘åå…¼å®¹å¤„ç†</span>
<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> legacyApiCall = <span class="hljs-built_in">async</span> (endpoint: string, data: any) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// å°è¯•ä½¿ç”¨æ–°ç‰ˆæœ¬ API</span>
    <span class="hljs-keyword">return</span> await v4Client.<span class="hljs-built_in">post</span>(endpoint, data);
  } <span class="hljs-built_in">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error.response?.status === <span class="hljs-number">404</span>) {
      <span class="hljs-comment">// å›é€€åˆ°æ—§ç‰ˆæœ¬ API</span>
      console.<span class="hljs-built_in">warn</span>(`Falling back to v3 API <span class="hljs-keyword">for</span> ${endpoint}`);
      <span class="hljs-keyword">return</span> await v3Client.<span class="hljs-built_in">post</span>(endpoint, data);
    }
    <span class="hljs-keyword">throw</span> error;
  }
};
```

## æ€§èƒ½ä¼˜åŒ–

### è¯·æ±‚ä¼˜åŒ–

#### <span class="hljs-number">1.</span> è¯·æ±‚åˆå¹¶

```typescript
<span class="hljs-comment">// æ‰¹é‡è¯·æ±‚åˆå¹¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestBatcher</span> {
  <span class="hljs-keyword">private</span> batches = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>&lt;string, any[]&gt;();
  <span class="hljs-keyword">private</span> timers = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>&lt;string, NodeJS.Timeout&gt;();
  
  <span class="hljs-built_in">batch</span>&lt;T&gt;(
    key: string,
    request: any,
    batchFn: (requests: any[]) =&gt; Promise&lt;T[]&gt;,
    delay: number = <span class="hljs-number">100</span>
  ): Promise&lt;T&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.batches.<span class="hljs-built_in">has</span>(key)) {
        <span class="hljs-keyword">this</span>.batches.<span class="hljs-built_in">set</span>(key, []);
      }
      
      <span class="hljs-type">const</span> batch = <span class="hljs-keyword">this</span>.batches.<span class="hljs-built_in">get</span>(key)!;
      batch.<span class="hljs-built_in">push</span>({ request, resolve, reject });
      
      <span class="hljs-comment">// æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.timers.<span class="hljs-built_in">has</span>(key)) {
        <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-keyword">this</span>.timers.<span class="hljs-built_in">get</span>(key)!);
      }
      
      <span class="hljs-comment">// è®¾ç½®æ–°çš„å®šæ—¶å™¨</span>
      <span class="hljs-type">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-built_in">async</span> () =&gt; {
        <span class="hljs-type">const</span> currentBatch = <span class="hljs-keyword">this</span>.batches.<span class="hljs-built_in">get</span>(key)!;
        <span class="hljs-keyword">this</span>.batches.<span class="hljs-built_in">delete</span>(key);
        <span class="hljs-keyword">this</span>.timers.<span class="hljs-built_in">delete</span>(key);
        
        <span class="hljs-keyword">try</span> {
          <span class="hljs-type">const</span> requests = currentBatch.<span class="hljs-built_in">map</span>(item =&gt; item.request);
          <span class="hljs-type">const</span> results = await <span class="hljs-built_in">batchFn</span>(requests);
          
          currentBatch.forEach((item, index) =&gt; {
            item.<span class="hljs-built_in">resolve</span>(results[index]);
          });
        } <span class="hljs-built_in">catch</span> (error) {
          currentBatch.forEach(item =&gt; {
            item.<span class="hljs-built_in">reject</span>(error);
          });
        }
      }, delay);
      
      <span class="hljs-keyword">this</span>.timers.<span class="hljs-built_in">set</span>(key, timer);
    });
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-type">const</span> batcher = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RequestBatcher</span>();

<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> getUserInfo = (userId: number) =&gt; {
  <span class="hljs-keyword">return</span> batcher.<span class="hljs-built_in">batch</span>(
    <span class="hljs-string">'getUserInfo'</span>,
    userId,
    <span class="hljs-built_in">async</span> (userIds: number[]) =&gt; {
      <span class="hljs-type">const</span> response = await api.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/user/batch'</span>, { ids: userIds });
      <span class="hljs-keyword">return</span> response.data;
    }
  );
};
```

#### <span class="hljs-number">2.</span> è¯·æ±‚å»é‡

```typescript
<span class="hljs-comment">// è¯·æ±‚å»é‡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestDeduplicator</span> {
  <span class="hljs-keyword">private</span> pending = <span class="hljs-keyword">new</span> Map&lt;string, Promise&lt;any&gt;&gt;();
  
  <span class="hljs-built_in">dedupe</span>&lt;T&gt;(key: string, requestFn: () =&gt; Promise&lt;T&gt;): Promise&lt;T&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pending.<span class="hljs-built_in">has</span>(key)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pending.<span class="hljs-built_in">get</span>(key)!;
    }
    
    <span class="hljs-type">const</span> promise = <span class="hljs-built_in">requestFn</span>().<span class="hljs-built_in">finally</span>(() =&gt; {
      <span class="hljs-keyword">this</span>.pending.<span class="hljs-built_in">delete</span>(key);
    });
    
    <span class="hljs-keyword">this</span>.pending.<span class="hljs-built_in">set</span>(key, promise);
    <span class="hljs-keyword">return</span> promise;
  }
}

<span class="hljs-type">const</span> deduplicator = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RequestDeduplicator</span>();

<span class="hljs-keyword">export</span> <span class="hljs-type">const</span> getFileList = (path: string) =&gt; {
  <span class="hljs-type">const</span> key = `fileList:${path}`;
  <span class="hljs-keyword">return</span> deduplicator.<span class="hljs-built_in">dedupe</span>(key, () =&gt; 
    api.<span class="hljs-built_in">get</span>(<span class="hljs-string">'/file/list'</span>, { params: { path } })
  );
};
```

## ç›‘æ§å’Œè°ƒè¯•

### è¯·æ±‚æ—¥å¿—

```typescript
<span class="hljs-comment">// è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶</span>
instance.interceptors.request.<span class="hljs-built_in">use</span>((config) =&gt; {
  <span class="hljs-type">const</span> requestId = <span class="hljs-built_in">generateRequestId</span>();
  config.metadata = { requestId, startTime: Date.<span class="hljs-built_in">now</span>() };
  
  console.<span class="hljs-built_in">log</span>(`[${requestId}] ${config.method?.<span class="hljs-built_in">toUpperCase</span>()} ${config.url}`, {
    params: config.params,
    data: config.data,
  });
  
  <span class="hljs-keyword">return</span> config;
});

instance.interceptors.response.<span class="hljs-built_in">use</span>(
  (response) =&gt; {
    <span class="hljs-type">const</span> { requestId, startTime } = response.config.metadata;
    <span class="hljs-type">const</span> duration = Date.<span class="hljs-built_in">now</span>() - startTime;
    
    console.<span class="hljs-built_in">log</span>(`[${requestId}] Response ${response.status} (${duration}ms)`, {
      data: response.data,
    });
    
    <span class="hljs-keyword">return</span> response;
  },
  (error) =&gt; {
    <span class="hljs-type">const</span> { requestId, startTime } = error.config?.metadata || {};
    <span class="hljs-type">const</span> duration = Date.<span class="hljs-built_in">now</span>() - startTime;
    
    console.<span class="hljs-built_in">error</span>(`[${requestId}] Error ${error.response?.status} (${duration}ms)`, {
      error: error.response?.data,
    });
    
    <span class="hljs-keyword">return</span> Promise.<span class="hljs-built_in">reject</span>(error);
  }
);
```

### æ€§èƒ½ç›‘æ§

```typescript
<span class="hljs-comment">// API æ€§èƒ½ç›‘æ§</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiMonitor</span> {
  <span class="hljs-keyword">private</span> metrics = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>&lt;string, {
    count: number;
    totalTime: number;
    errors: number;
  }&gt;();
  
  <span class="hljs-built_in">record</span>(endpoint: string, duration: number, success: <span class="hljs-type">boolean</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.metrics.<span class="hljs-built_in">has</span>(endpoint)) {
      <span class="hljs-keyword">this</span>.metrics.<span class="hljs-built_in">set</span>(endpoint, { count: <span class="hljs-number">0</span>, totalTime: <span class="hljs-number">0</span>, errors: <span class="hljs-number">0</span> });
    }
    
    <span class="hljs-type">const</span> metric = <span class="hljs-keyword">this</span>.metrics.<span class="hljs-built_in">get</span>(endpoint)!;
    metric.count++;
    metric.totalTime += duration;
    
    <span class="hljs-keyword">if</span> (!success) {
      metric.errors++;
    }
  }
  
  <span class="hljs-built_in">getStats</span>() {
    <span class="hljs-type">const</span> stats = Array.<span class="hljs-built_in">from</span>(<span class="hljs-keyword">this</span>.metrics.<span class="hljs-built_in">entries</span>()).<span class="hljs-built_in">map</span>(([endpoint, metric]) =&gt; ({
      endpoint,
      count: metric.count,
      avgTime: metric.totalTime / metric.count,
      errorRate: metric.errors / metric.count,
    }));
    
    <span class="hljs-keyword">return</span> stats.<span class="hljs-built_in">sort</span>((a, b) =&gt; b.avgTime - a.avgTime);
  }
}

<span class="hljs-type">const</span> monitor = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ApiMonitor</span>();

<span class="hljs-comment">// åœ¨æ‹¦æˆªå™¨ä¸­ä½¿ç”¨</span>
instance.interceptors.response.<span class="hljs-built_in">use</span>(
  (response) =&gt; {
    <span class="hljs-type">const</span> duration = Date.<span class="hljs-built_in">now</span>() - response.config.metadata.startTime;
    monitor.<span class="hljs-built_in">record</span>(response.config.url!, duration, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> response;
  },
  (error) =&gt; {
    <span class="hljs-type">const</span> duration = Date.<span class="hljs-built_in">now</span>() - error.config?.metadata?.startTime;
    monitor.<span class="hljs-built_in">record</span>(error.config?.url!, duration, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">return</span> Promise.<span class="hljs-built_in">reject</span>(error);
  }
);
```

## æ€»ç»“

Cloudreve çš„å‰åç«¯é€šä¿¡æœºåˆ¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

<span class="hljs-number">1.</span> **ç»Ÿä¸€çš„ API è®¾è®¡**: RESTful é£æ ¼ï¼Œæ¸…æ™°çš„æ¥å£è§„èŒƒ
<span class="hljs-number">2.</span> **å®Œå–„çš„è®¤è¯æœºåˆ¶**: JWT Token + è‡ªåŠ¨åˆ·æ–°
<span class="hljs-number">3.</span> **çµæ´»çš„é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼å’Œå¤„ç†ç­–ç•¥
<span class="hljs-number">4.</span> **æµå¼æ•°æ®æ”¯æŒ**: SSE åè®®å®ç°å®æ—¶é€šä¿¡
<span class="hljs-number">5.</span> **é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“**: åˆ†ç‰‡ä¸Šä¼ æ”¯æŒå¤§æ–‡ä»¶
<span class="hljs-number">6.</span> **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: å‰åç«¯å¤šå±‚ç¼“å­˜ä¼˜åŒ–
<span class="hljs-number">7.</span> **æ€§èƒ½ç›‘æ§**: å®Œæ•´çš„è¯·æ±‚ç›‘æ§å’Œè°ƒè¯•æœºåˆ¶

è¿™å¥—é€šä¿¡æœºåˆ¶ä¸ºä½ å¼€å‘ä¾§è¾¹æ å¯¹è¯åŠŸèƒ½æä¾›äº†å¯é çš„åŸºç¡€ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ç°æœ‰çš„ API æ¥å£å’Œé€šä¿¡æ¨¡å¼æ¥å®ç°æ–°åŠŸèƒ½ã€‚
</code></pre>
<h3 data-id="heading-7"><strong>05-development-guide.md - å¼€å‘æµç¨‹æŒ‡å—</strong></h3>
<ul>
<li>
<p>ç¯å¢ƒæ­å»ºå’Œå¼€å‘å·¥ä½œæµ</p>
</li>
<li>
<p>è°ƒè¯•æŠ€å·§å’Œæ€§èƒ½ä¼˜åŒ–</p>
</li>
<li>
<p>éƒ¨ç½²æµç¨‹å’Œæœ€ä½³å®è·µ</p>
</li>
</ul>
<blockquote>
<p>å› ç¯‡å¹…é™åˆ¶ï¼Œå®Œæ•´æ–‡æ¡£å†…å®¹è¯¦è§ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FO65Ay8h1S6jbK_j67jQVDg" target="_blank" title="https://mp.weixin.qq.com/s/O65Ay8h1S6jbK_j67jQVDg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/O65Ay8h1Sâ€¦</a></p>
</blockquote>
<h3 data-id="heading-8"><strong>06-chat-feature-extension.md - èŠå¤©åŠŸèƒ½æ‰©å±•å®ç°æ–¹æ¡ˆ</strong></h3>
<ul>
<li>
<p>åŸºäºç°æœ‰èŠå¤©åŠŸèƒ½çš„ä¾§è¾¹æ æ‰©å±•</p>
</li>
<li>
<p>å®Œæ•´çš„å‰åç«¯ä»£ç ç¤ºä¾‹</p>
</li>
<li>
<p>æ–‡ä»¶å¤¹ä¸Šä¸‹æ–‡è¯»å–å’Œ AI å¯¹è¯é›†æˆ</p>
</li>
</ul>
<blockquote>
<p>å› ç¯‡å¹…é™åˆ¶ï¼Œå®Œæ•´æ–‡æ¡£å†…å®¹è¯¦è§ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FO65Ay8h1S6jbK_j67jQVDg" target="_blank" title="https://mp.weixin.qq.com/s/O65Ay8h1S6jbK_j67jQVDg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/O65Ay8h1Sâ€¦</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb0e8142224a4b3d998726c7bfecac32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=hMYrTL9aIgepbNietMJntPYejkE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>æ¨¡å—é‡æ„</strong></h2>
<h3 data-id="heading-10"><strong>åˆ†æå¹¶è§„åˆ’é‡æ„</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a38acf5942b948578c636054c1df6fe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=SHj%2BiM7YijijumkImq44YMSQdkA%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b243bc6b1a74472a9b6a8a0b0650674f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=pREIpCB2EreCJD3a1Fjzqw%2FqygQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11"><strong>é‡æ„è®¡åˆ’è¯¦æƒ…</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section"># Cloudreve å‰ç«¯é‡æ„ä¼˜åŒ–è®¡åˆ’</span>

<span class="hljs-section">## ğŸ“Š é¡¹ç›®ç°çŠ¶åˆ†æ</span>

<span class="hljs-section">### æŠ€æœ¯æ ˆæ¦‚å†µ</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**React 18.2.0 + TypeScript 5.2.2**</span> - ç°ä»£åŒ–æŠ€æœ¯æ ˆ
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Material-UI 6.x**</span> - æˆç†Ÿçš„ç»„ä»¶åº“
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Redux Toolkit**</span> - ç°ä»£çŠ¶æ€ç®¡ç†
<span class="hljs-bullet">-</span> <span class="hljs-strong">**119ä¸ªä¾èµ–åŒ…**</span> - ä¾èµ–è¾ƒä¸ºå¤æ‚

<span class="hljs-section">### ä¸»è¦é—®é¢˜è¯†åˆ«</span>
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**æ€§èƒ½é—®é¢˜**</span>: Bundleè¿‡å¤§ã€ç¼ºå°‘è™šæ‹ŸåŒ–ã€ä¸å¿…è¦çš„é‡æ¸²æŸ“
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**ä»£ç è´¨é‡**</span>: 75ä¸ªæ–‡ä»¶ä½¿ç”¨anyç±»å‹ã€ç»„ä»¶èŒè´£ä¸æ¸…ã€ä»£ç é‡å¤
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**æ¶æ„é—®é¢˜**</span>: ç»„ä»¶è€¦åˆåº¦é«˜ã€çŠ¶æ€ç®¡ç†åˆ†æ•£ã€ç¼ºå°‘æŠ½è±¡å±‚
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**æŠ€æœ¯å€ºåŠ¡**</span>: 8ä¸ªTODOæ ‡è®°ã€é‡å¤æ ·å¼å®šä¹‰ã€é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€

<span class="hljs-section">## ğŸ¯ é‡æ„ä¼˜å…ˆçº§æ’åº</span>

<span class="hljs-section">### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šå¿«é€Ÿèƒœåˆ©é¡¹ç›®ï¼ˆ2-3å‘¨ï¼‰</span>
<span class="hljs-strong">**é£é™©ï¼šğŸŸ¢ä½ | æ”¶ç›Šï¼šğŸ’°ğŸ’°ä¸­é«˜**</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**ä»£ç è§„èŒƒç»Ÿä¸€**</span>
<span class="hljs-bullet">   -</span> ç»Ÿä¸€TypeScripté…ç½®ï¼Œæ¶ˆé™¤anyç±»å‹æ»¥ç”¨
<span class="hljs-bullet">   -</span> å»ºç«‹ç»„ä»¶å‘½åè§„èŒƒå’Œæ–‡ä»¶ç»„ç»‡æ ‡å‡†
<span class="hljs-bullet">   -</span> å®æ–½è‡ªåŠ¨åŒ–ä»£ç æ ¼å¼åŒ–

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**å›½é™…åŒ–ä¼˜åŒ–**</span>
<span class="hljs-bullet">   -</span> ä¼˜åŒ–10ç§è¯­è¨€çš„ç¿»è¯‘æ–‡ä»¶ç»“æ„
<span class="hljs-bullet">   -</span> å®æ–½æŒ‰éœ€åŠ è½½æœºåˆ¶
<span class="hljs-bullet">   -</span> ç»Ÿä¸€ç¿»è¯‘keyå‘½åè§„èŒƒ

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**å·¥å…·å‡½æ•°æŠ½å–**</span>
<span class="hljs-bullet">   -</span> åˆ›å»ºç»Ÿä¸€çš„æ—¶é—´æ ¼å¼åŒ–ã€æ–‡ä»¶ç±»å‹åˆ¤æ–­å·¥å…·
<span class="hljs-bullet">   -</span> æŠ½å–é‡å¤çš„APIè°ƒç”¨æ¨¡å¼
<span class="hljs-bullet">   -</span> å»ºç«‹å…¬å…±Hookåº“

<span class="hljs-section">### ç¬¬äºŒä¼˜å…ˆçº§ï¼šæ€§èƒ½ä¼˜åŒ–é¡¹ç›®ï¼ˆ3-4å‘¨ï¼‰</span>
<span class="hljs-strong">**é£é™©ï¼šğŸ”´é«˜ | æ”¶ç›Šï¼šğŸ’°ğŸ’°ğŸ’°é«˜**</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**Bundleä¼˜åŒ–**</span>
<span class="hljs-bullet">   -</span> å®æ–½ç²¾ç»†åŒ–ä»£ç åˆ†å‰²ï¼Œé¢„è®¡å‡å°‘35%åŒ…å¤§å°
<span class="hljs-bullet">   -</span> ä¼˜åŒ–Monaco Editorã€Excalidrawç­‰å¤§å‹åº“çš„åŠ è½½
<span class="hljs-bullet">   -</span> å®æ–½æ‡’åŠ è½½å’Œé¢„åŠ è½½ç­–ç•¥

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**ç»„ä»¶æ€§èƒ½ä¼˜åŒ–**</span>
<span class="hljs-bullet">   -</span> ä¸ºæ ¸å¿ƒç»„ä»¶æ·»åŠ React.memoå’ŒuseCallback
<span class="hljs-bullet">   -</span> å®æ–½è™šæ‹Ÿæ»šåŠ¨è§£å†³é•¿åˆ—è¡¨æ€§èƒ½é—®é¢˜
<span class="hljs-bullet">   -</span> ä¼˜åŒ–æ–‡ä»¶ç¼©ç•¥å›¾åŠ è½½æœºåˆ¶

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**è¿è¡Œæ—¶ä¼˜åŒ–**</span>
<span class="hljs-bullet">   -</span> ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜
<span class="hljs-bullet">   -</span> ä¼˜åŒ–çŠ¶æ€æ›´æ–°é¢‘ç‡
<span class="hljs-bullet">   -</span> å®æ–½æ™ºèƒ½ç¼“å­˜ç­–ç•¥

<span class="hljs-section">### ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šæ¶æ„é‡æ„é¡¹ç›®ï¼ˆ4-6å‘¨ï¼‰</span>
<span class="hljs-strong">**é£é™©ï¼šğŸ”´é«˜ | æ”¶ç›Šï¼šğŸ’°ğŸ’°ğŸ’°é«˜**</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**ç»„ä»¶æ¶æ„é‡æ„**</span>
<span class="hljs-bullet">   -</span> é‡æ„GridFileç­‰å¤§å‹ç»„ä»¶ï¼ˆ463è¡Œâ†’æ‹†åˆ†ä¸ºå¤šä¸ªå°ç»„ä»¶ï¼‰
<span class="hljs-bullet">   -</span> åˆ†ç¦»æ•°æ®è·å–å’ŒUIæ¸²æŸ“é€»è¾‘
<span class="hljs-bullet">   -</span> å»ºç«‹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€ç®¡ç†

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**çŠ¶æ€ç®¡ç†ä¼˜åŒ–**</span>
<span class="hljs-bullet">   -</span> é‡æ„èŠå¤©ç³»ç»Ÿçš„çŠ¶æ€ç®¡ç†
<span class="hljs-bullet">   -</span> ç»Ÿä¸€Reduxå’Œæœ¬åœ°çŠ¶æ€çš„ä½¿ç”¨æ¨¡å¼
<span class="hljs-bullet">   -</span> å®æ–½çŠ¶æ€æœºç®¡ç†å¤æ‚çŠ¶æ€è½¬æ¢

<span class="hljs-bullet">3.</span> <span class="hljs-strong">**ä¾èµ–å‡çº§**</span>
<span class="hljs-bullet">   -</span> åˆ†æ‰¹å‡çº§æ ¸å¿ƒä¾èµ–åŒ…
<span class="hljs-bullet">   -</span> è§£å†³å®‰å…¨æ¼æ´å’Œå…¼å®¹æ€§é—®é¢˜
<span class="hljs-bullet">   -</span> è·å¾—æ–°ç‰ˆæœ¬ç‰¹æ€§æ”¯æŒ

<span class="hljs-section">## ğŸš€ å®æ–½ç­–ç•¥</span>

<span class="hljs-section">### æ¸è¿›å¼é‡æ„æ–¹æ¡ˆ</span>
<span class="hljs-code">```
é˜¶æ®µä¸€ï¼ˆ2-3å‘¨ï¼‰ï¼šåŸºç¡€ä¼˜åŒ–
â”œâ”€â”€ ä»£ç è§„èŒƒç»Ÿä¸€
â”œâ”€â”€ å›½é™…åŒ–ä¼˜åŒ–  
â””â”€â”€ æŠ€æœ¯å€ºåŠ¡æ¸…ç†

é˜¶æ®µäºŒï¼ˆ3-4å‘¨ï¼‰ï¼šæ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ Bundleåˆ†å‰²ä¼˜åŒ–
â”œâ”€â”€ ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–
â””â”€â”€ ç¼“å­˜ç­–ç•¥å®æ–½

é˜¶æ®µä¸‰ï¼ˆ4-6å‘¨ï¼‰ï¼šæ¶æ„é‡æ„
â”œâ”€â”€ ç»„ä»¶æ‹†åˆ†é‡æ„
â”œâ”€â”€ çŠ¶æ€ç®¡ç†ç»Ÿä¸€
â””â”€â”€ ä¾èµ–ç‰ˆæœ¬å‡çº§
```</span>

<span class="hljs-section">### æµ‹è¯•å’Œè´¨é‡ä¿è¯</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**è‡ªåŠ¨åŒ–æµ‹è¯•**</span>: æ ¸å¿ƒç»„ä»¶90%+è¦†ç›–ç‡
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ€§èƒ½æµ‹è¯•**</span>: FCP&lt;1.5s, LCP&lt;2.5sç›®æ ‡
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å›æ»šè®¡åˆ’**</span>: æ¯é˜¶æ®µè®¾ç½®ç¨³å®šç‰ˆæœ¬æ ‡ç­¾
<span class="hljs-bullet">-</span> <span class="hljs-strong">**ç›‘æ§å‘Šè­¦**</span>: å®æ—¶ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡

<span class="hljs-section">## ğŸ“ˆ é¢„æœŸæ”¶ç›Š</span>

<span class="hljs-section">### æ€§èƒ½æå‡</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**åŠ è½½é€Ÿåº¦**</span>: æå‡50%
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Bundleå¤§å°**</span>: å‡å°‘35%
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å†…å­˜å ç”¨**</span>: é™ä½20-30%

<span class="hljs-section">### å¼€å‘æ•ˆç‡</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ–°åŠŸèƒ½å¼€å‘**</span>: é€Ÿåº¦æå‡40%
<span class="hljs-bullet">-</span> <span class="hljs-strong">**ç»„ä»¶å¤ç”¨ç‡**</span>: æå‡60%
<span class="hljs-bullet">-</span> <span class="hljs-strong">**Bugä¿®å¤æ—¶é—´**</span>: å‡å°‘40%

<span class="hljs-section">### ä»£ç è´¨é‡</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æŠ€æœ¯å€ºåŠ¡**</span>: å‡å°‘80%
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æµ‹è¯•è¦†ç›–ç‡**</span>: è¾¾åˆ°85%+
<span class="hljs-bullet">-</span> <span class="hljs-strong">**ç±»å‹å®‰å…¨**</span>: æ¶ˆé™¤75ä¸ªanyç±»å‹ä½¿ç”¨

<span class="hljs-section">## âš ï¸ é£é™©æ§åˆ¶</span>

<span class="hljs-section">### æŠ€æœ¯é£é™©ç¼“è§£</span>
<span class="hljs-bullet">-</span> æ¸è¿›å¼é‡æ„é¿å…å¤§çˆ†ç‚¸å¼æ”¹åŠ¨
<span class="hljs-bullet">-</span> å……åˆ†çš„è‡ªåŠ¨åŒ–å’Œæ‰‹å·¥æµ‹è¯•
<span class="hljs-bullet">-</span> ç°åº¦å‘å¸ƒå’Œå®æ—¶ç›‘æ§

<span class="hljs-section">### é¡¹ç›®é£é™©ç®¡ç†</span>
<span class="hljs-bullet">-</span> æ¯å‘¨è¿›åº¦å’Œè´¨é‡è¯„å®¡
<span class="hljs-bullet">-</span> æ˜ç¡®çš„é‡Œç¨‹ç¢‘å’Œäº¤ä»˜ç‰©
<span class="hljs-bullet">-</span> å¤‡ç”¨æ–¹æ¡ˆå’ŒçŸ¥è¯†åˆ†äº«æœºåˆ¶

<span class="hljs-section">## ğŸ’¼ èµ„æºéœ€æ±‚</span>

<span class="hljs-bullet">-</span> <span class="hljs-strong">**äººåŠ›**</span>: å‰ç«¯æ¶æ„å¸ˆ1äºº + é«˜çº§å·¥ç¨‹å¸ˆ2äºº + å·¥ç¨‹å¸ˆ1äºº
<span class="hljs-bullet">-</span> <span class="hljs-strong">**æ—¶é—´**</span>: æ€»è®¡13-16å‘¨
<span class="hljs-bullet">-</span> <span class="hljs-strong">**å·¥å…·**</span>: è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€æ€§èƒ½ç›‘æ§å·¥å…·ã€CI/CDæµæ°´çº¿

è¿™ä¸ªé‡æ„è®¡åˆ’é€šè¿‡ç§‘å­¦çš„ä¼˜å…ˆçº§æ’åºå’Œé£é™©æ§åˆ¶ï¼Œç¡®ä¿åœ¨æå‡ä»£ç è´¨é‡çš„åŒæ—¶ä¿æŒé¡¹ç›®ç¨³å®šæ€§ï¼Œä¸ºé•¿æœŸçš„å¯ç»´æŠ¤æ€§å’Œå¼€å‘æ•ˆç‡å¥ å®šåŸºç¡€ã€‚
</code></pre>
<h3 data-id="heading-12"><strong>é‡æ„å®æ–½ç»“æœ</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed106812a2e4451f9d7dde99b3110e86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=sDw3gqwosSQmuCv4rXsFLbn%2BSz0%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71621d638a9442a1966fa481eef3a3e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=VVWK46lP8jA0gEGh4hImskngD%2FY%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86e8de53d9894f608e9012012ad386eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=rhZVUNICSjbJfihDET%2F%2F1MEo0oc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d3584594a34692a93ae213af2edbc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=EASH%2B%2BKH5eup8CL53NcMqxbLzf4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13"><strong>åŠŸèƒ½è¿­ä»£</strong></h2>
<p>åœ¨å®Œæˆé¡¹ç›®ç†è§£å’Œä»£ç ä¼˜åŒ–åï¼Œæ­£å¼è¿›å…¥åŠŸèƒ½å¼€å‘é˜¶æ®µã€‚æˆ‘è®¡åˆ’ä¸º Cloudreve æ·»åŠ ä¸€ä¸ªæ™ºèƒ½å¯¹è¯åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€ä¸äº‘ç›˜äº¤äº’ã€‚</p>
<h3 data-id="heading-14"><strong>å‡†å¤‡å·¥ä½œï¼šæ¥å…¥ Context7 MCP</strong></h3>
<p>ä¸ºäº†æé«˜ AI å¯¹ OpenRouter API çš„ç†è§£å’Œä½¿ç”¨èƒ½åŠ›ï¼Œæˆ‘å…ˆæ¥å…¥äº† Context7 MCP æœåŠ¡ã€‚</p>
<p><strong>Context7 é“¾æ¥ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fcontext7.com%3Fq%3Dopenrouter" target="_blank" title="https://context7.com?q=openrouter" ref="nofollow noopener noreferrer">context7.com?q=openrouter</a></p>
<p><strong>MCP é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"context7"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.context7.com/mcp"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/000fed0186eb4531a9b3d9163ff64b4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=Mv%2FmE1oZ5%2BUCsfbT4wbPVwRgFyM%3D" alt="" loading="lazy"/></p>
<p align="center">Context7 MCP é…ç½®ç•Œé¢</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3b77040a0f34d24a8df19056abd0a76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=UWlKqSJvyujlMJH5mt4en%2Bxbk%2BM%3D" alt="" loading="lazy"/></p>
<p align="center">MCP æœåŠ¡çŠ¶æ€</p>
<h3 data-id="heading-15"><strong>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å¯¹è¯åŠŸèƒ½</strong></h3>
<p><strong>éœ€æ±‚è§„åˆ’</strong></p>
<p>æ‰“å¼€ Planï¼Œæ˜ç¡®åŸºç¡€å¯¹è¯åŠŸèƒ½çš„æ ¸å¿ƒéœ€æ±‚ã€‚</p>
<p><strong>éœ€æ±‚æè¿°ï¼š</strong></p>
<pre><code class="hljs language-diff" lang="diff">éœ€æ±‚ï¼š
ç»™äº‘ç›˜åŠ ä¸ª AI å¯¹è¯åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€è·Ÿ AI èŠå¤©

åç«¯ ï¼š
<span class="hljs-deletion">- æ–°å¢æµå¼å¯¹è¯æ¥å£å¹¶æ³¨å†Œåˆ°è·¯ç”±ä¸­ï¼Œéœ€è¦èº«ä»½é‰´æƒ</span>
<span class="hljs-deletion">- é›†æˆ OpenRouter è°ƒç”¨æ¨¡å‹</span>

å‰ç«¯ ï¼š
<span class="hljs-deletion">- å³ä¸‹è§’åŠ ä¸ªåœ†å½¢æ‚¬æµ®æŒ‰é’®</span>
<span class="hljs-deletion">- ç‚¹å‡»å¼¹å‡º 600px å®½çš„ä¾§è¾¹æ å¯¹è¯é¢æ¿</span>
<span class="hljs-deletion">- åŸºæœ¬çš„èŠå¤©ç•Œé¢ï¼šæ¶ˆæ¯åˆ—è¡¨ + è¾“å…¥æ¡†</span>
<span class="hljs-deletion">- è°ƒç”¨æµå¼å¯¹è¯æ¥å£æ—¶ï¼Œå¤„ç†å¥½é‰´æƒå‚æ•°ã€æµå¼è¾“å‡ºçŠ¶æ€</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c4fdfa41fc948a4a2e85d39fd4b9e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=0b6PtVj9WiV3hroEpAZe8gWNiTQ%3D" alt="" loading="lazy"/></p>
<p>Coder ä¼šè‡ªåŠ¨è°ƒç”¨å†…ç½®çš„ Search Agent åˆ†æé¡¹ç›®ç»“æ„ï¼Œç†è§£ä»£ç ä¸Šä¸‹æ–‡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/531d8d6529fc4849ba172c8ff5cde9fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=1PFGSyJ9ptLPanIxbTGwP7MASC8%3D" alt="" loading="lazy"/></p>
<p align="center">Search Agent å·¥ä½œè¿‡ç¨‹</p>
<p>åˆ†æå®Œæˆåï¼ŒCoder å°†æŠ€æœ¯æ–¹æ¡ˆä»¥æ–‡æ¡£å½¢å¼å‘ˆç°ï¼Œæ”¯æŒå®æ—¶ä¿®æ”¹å’Œç¼–è¾‘ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0969b63c5ad471e9681b69689819455~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=rYrZaNhWCV%2Ftf7RnQZR8bsPEvuY%3D" alt="" loading="lazy"/></p>
<p align="center">æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£</p>
<h4 data-id="heading-16"><strong>ä»»åŠ¡æ‰§è¡Œ</strong></h4>
<p>ç¡®è®¤æ–¹æ¡ˆåï¼ŒCoder ä¼šæ ¹æ®æŠ€æœ¯è§„åˆ’è‡ªåŠ¨æ‹†è§£ä»»åŠ¡å¹¶åˆ†æ­¥æ‰§è¡Œ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bc4e5bed4644204837f2389623260cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=0aCkB8F%2BsDVjpnM2CaKZ0%2FXNz7A%3D" alt="" loading="lazy"/></p>
<p align="center">ä»»åŠ¡æ‹†è§£åˆ—è¡¨</p>
<p>åœ¨å®æ–½è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å®æ—¶çœ‹åˆ°æ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€æ›´æ–°ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e973700b38df4cfabbcacb23665b6e40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=CubWtnj1VSsDyRphP%2BxgppbOpDY%3D" alt="" loading="lazy"/></p>
<p align="center">å®æ–½è¿›åº¦è¿½è¸ª</p>
<p>å¼€å‘å®Œæˆåï¼ŒCoder ä¼šè‡ªåŠ¨å¯åŠ¨é¡¹ç›®è¿›è¡Œé¢„è§ˆéªŒè¯ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6c3c56fc76347d78e450509f1e164ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=YW7Vw2onWpJ6qZgpYpz%2BaCF1KTs%3D" alt="" loading="lazy"/></p>
<p align="center">è‡ªåŠ¨å¯åŠ¨é¢„è§ˆ</p>
<p><strong>å®ç°æ•ˆæœï¼š</strong></p>
<p>å¯¹è¯åŠŸèƒ½å·²ç»æˆåŠŸå®ç°ï¼ŒUI é£æ ¼ä¸ Cloudreve åŸç”Ÿç•Œé¢ä¿æŒé«˜åº¦ä¸€è‡´ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ceb9310336146a79dc16ac837dc6a4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=8I20e%2Fj9tKqXqbTBNe56DqVkAPM%3D" alt="" loading="lazy"/></p>
<p align="center">å¯¹è¯åŠŸèƒ½ç•Œé¢</p>
<h3 data-id="heading-17"><strong>ç¬¬äºŒé˜¶æ®µï¼šå¢é‡è¿­ä»£ï¼Œå¢åŠ å¤šæ¨¡æ€å¬å›</strong></h3>
<p>åŸºç¡€å¯¹è¯åŠŸèƒ½å®Œæˆåï¼Œæˆ‘è¿›ä¸€æ­¥æå‡ºäº†æ›´é«˜çº§çš„éœ€æ±‚ï¼šè®© AI èƒ½å¤Ÿç†è§£å’Œæ£€ç´¢äº‘ç›˜ä¸­çš„æ–‡ä»¶å†…å®¹ã€‚</p>
<p><strong>å¢å¼ºéœ€æ±‚</strong></p>
<p><strong>éœ€æ±‚æè¿°ï¼š</strong></p>
<pre><code class="hljs language-diff" lang="diff">éœ€æ±‚ï¼š
AI èŠå¤©æ”¯æŒå¤šæ¨¡æ€æ–‡ä»¶æ™ºèƒ½æ£€ç´¢

åç«¯ï¼š
<span class="hljs-deletion">- æµå¼å¯¹è¯æ¥å£ä¸­è¯»å–å…¨é‡äº‘ç›˜æ–‡å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡æä¾›ç»™æ¨¡å‹ï¼Œæ¨¡å‹é€šè¿‡æ–‡ä»¶å…ƒä¿¡æ¯åŠå¤šæ¨¡æ€å†…å®¹è¿›è¡Œæ–‡ä»¶å¬å›</span>
<span class="hljs-deletion">- è¿”å›ï¼šsummary + file list çš„ç»“æ„ï¼Œå‰ç«¯æ¸²æŸ“ä¸ºæ–‡æœ¬ + GUI åˆ—è¡¨</span>
<span class="hljs-deletion">- é—®"å¸®æˆ‘æ‰¾åŒ…å«å°ç‹—çš„å›¾ç‰‡"è¿™ç±»é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¬å›æ–‡ä»¶å…ƒä¿¡æ¯æˆ–æ–‡ä»¶å†…å®¹ä¸ç”¨æˆ·æ„å›¾ç›¸å…³çš„æ–‡ä»¶</span>

å‰ç«¯ï¼š
<span class="hljs-deletion">- æ¶ˆæ¯ä¸­å±•ç¤ºæ–‡ä»¶åˆ—è¡¨</span>
<span class="hljs-deletion">- 3 åˆ—ç½‘æ ¼å¸ƒå±€ï¼Œæ˜¾ç¤ºç¼©ç•¥å›¾ã€æ–‡ä»¶å</span>
</code></pre>
<p><strong>å®ç°æ•ˆæœ</strong></p>
<p>Coder ä¼šè‡ªåŠ¨å¯åŠ¨å‰åç«¯æœåŠ¡ï¼Œå¹¶é€šè¿‡ç»ˆç«¯è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806ec905e34e4d118e7a6ca2b7a247b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=Ir0CL9WSmCDnmy2mWPPu7WT5jgs%3D" alt="" loading="lazy"/></p>
<p align="center">åŠŸèƒ½æµ‹è¯•è¿‡ç¨‹</p>
<p><strong>æœ€ç»ˆæ•ˆæœï¼š</strong></p>
<p>ç³»ç»ŸæˆåŠŸå®ç°äº†æ–‡ä»¶å†…å®¹è¯†åˆ«å’Œæ™ºèƒ½å¬å›åŠŸèƒ½ã€‚å½“ç”¨æˆ·è¯¢é—®"å¸®æˆ‘æ‰¾åŒ…å«å°ç‹—çš„å›¾ç‰‡"æ—¶ï¼ŒAI èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å›¾ç‰‡å†…å®¹å¹¶è¿”å›ç›¸å…³æ–‡ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d018f95c7f24fe78a42f3f539caf686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=mXFmRh%2F8fbZoot3avhyHlDb5jrs%3D" alt="" loading="lazy"/></p>
<p align="center">æ–‡ä»¶å¬å›æ•ˆæœå±•ç¤º</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/581c966bbfde4d35b71c95b4ceabcb1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764039376&amp;x-signature=xz9gTKrb1g%2BuhEQ7lJ9mSmvTFBc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18"><strong>æ€»ç»“ä¸æ€è€ƒ</strong></h2>
<p>é€šè¿‡è¿™æ¬¡å®è·µï¼Œå¯ä»¥çœ‹åˆ° SOLO Coder åœ¨é¡¹ç›®ç†è§£ã€ä»£ç é‡æ„åˆ°åŠŸèƒ½å¼€å‘çš„æ¯ä¸ªç¯èŠ‚éƒ½å¯ä»¥æä¾›æ”¯æŒã€‚è¿™ä¸ªé¡¹ç›®æœªæ¥è¿˜å¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢çš„æœ‰ï¼šæ›´å¤æ‚çš„å¤šæ¨¡æ€äº¤äº’åœºæ™¯ã€æ™ºèƒ½æ–‡ä»¶ç®¡ç†å’Œæ¨èå’ŒåŸºäºç”¨æˆ·è¡Œä¸ºçš„ä¸ªæ€§åŒ–ä½“éªŒï¼Œæ¬¢è¿å¤§å®¶å»åˆ›é€ ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¢è¯•è¿‡åˆ«äººåï¼Œæˆ‘å¯¹é¢è¯•ç¥›é­…äº†]]></title>    <link>https://juejin.cn/post/7573592127298273330</link>    <guid>https://juejin.cn/post/7573592127298273330</guid>    <pubDate>2025-11-18T03:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573592127298273330" data-draft-id="7573593395797950510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¢è¯•è¿‡åˆ«äººåï¼Œæˆ‘å¯¹é¢è¯•ç¥›é­…äº†"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,GitHub"/> <meta itemprop="datePublished" content="2025-11-18T03:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒé¥ºå­ä¸åƒé¦…"/> <meta itemprop="url" content="https://juejin.cn/user/1148309742825495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¢è¯•è¿‡åˆ«äººåï¼Œæˆ‘å¯¹é¢è¯•ç¥›é­…äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1148309742825495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒé¥ºå­ä¸åƒé¦…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:00:54.000Z" title="Tue Nov 18 2025 03:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç”±äºå…¬å¸è€å‘˜å·¥èµ°äº†ä¸€äº›ï¼Œæˆ‘ä¸€ä¸å°å¿ƒå˜æˆæœ€è€çš„å‰ç«¯äº†</p>
<p>æ‰€ä»¥æœ‰å¹¸èƒ½å¤Ÿæ‹…ä»»å…¬å¸å‰ç«¯ä¸€é¢çš„å·¥ä½œ</p>
<p>å’Œæ¯ä½åº”è˜è€…äº¤æµçš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ï¼Œä»ä¸­å‘ç°ä¸€äº›ä¸ä¸€æ ·çš„è§†è§’çš„ä¸œè¥¿ï¼Œå†™ä¸‹æ¥è®°å½•ä¸€ä¸‹</p>
<p>è€äº†åå›æ¥å†çœ‹çœ‹æ˜é‡‘ï¼Œä¹Ÿæ˜¯è‡ªå·±åšæŒå†™æ–‡ç« çš„åŸå› ä¹‹ä¸€ï¼Œåˆ°æ—¶å€™æŠ±ç€å­©å­è¯´ï¼Œçœ‹çˆ·çˆ·å½“å¹´å†™çš„æ–‡ç« ï¼Œè¿™ä¹ˆå¤šäººç‚¹èµå˜ï¼</p>
<h3 data-id="heading-0">æ²Ÿé€šè¡¨è¾¾èƒ½åŠ›éå¸¸é‡è¦</h3>
<p>å¦ç™½è®²ï¼Œä½ çš„æŠ€æœ¯å®åŠ›æœ‰æ—¶å€™ä¸å¦‚è¡¨è¾¾èƒ½åŠ›æœ‰ç«äº‰åŠ›ï¼Œå³ä½¿ä½ çš„æŠ€æœ¯å†NBï¼Œé—®ä¸ªé—®é¢˜ï¼ŒåŠå¤©æ²¡æœ‰è¡¨è¾¾æ¸…æ¥šï¼Œæ€ä¹ˆå’Œå¤æ‚çš„å®é™…å·¥ä½œä¸­æ²Ÿé€šå‘¢</p>
<p>ä½†æ˜¯è¿™ä¸ªæ²Ÿé€šè¡¨è¾¾èƒ½åŠ›æœ‰ç‚¹é‚ªä¹ï¼Œæ²¡æœ‰æ˜ç¡®çš„æ ‡å‡†</p>
<h3 data-id="heading-1">é‡åˆ°è¿‡ä»€ä¹ˆéš¾ç‚¹ï¼Œæ€ä¹ˆè§£å†³</h3>
<p>è¿™ä¸ªé—®é¢˜ä¸æ˜¯å¾ˆå¥½å›ç­”ï¼Œä½†æ˜¯ä¸€å®šä¸è¦å›ç­”æ²¡æœ‰é‡åˆ°ä»€ä¹ˆéš¾ç‚¹ï¼Œå…¶å®é—®è¿™ä¸ªç›®çš„
ä¸€æ˜¯æ­£å¥½çœ‹ä½ çš„æŠ€æœ¯æ·±åº¦ï¼ŒäºŒæ˜¯çœ‹ä¸€ä¸‹è¡¨è¾¾èƒ½åŠ›ï¼Œå³ä½¿çœŸçš„æ²¡æœ‰å¾ˆéš¾çš„ç‚¹ï¼Œä¹Ÿè®²ä¸€ä¸‹è‡ªå·±è®¤ä¸ºæ¯”è¾ƒè´¹åŠ²å®ç°çš„
åŠŸèƒ½ï¼Œæ¸…æ™°æµç•…å‡†ç¡®çš„è¡¨è¾¾å‡ºæ¥ä¹Ÿæ˜¯å¾ˆåŠ åˆ†çš„</p>
<h3 data-id="heading-2">å…«è‚¡è¿˜æ˜¯ä¼šé—®çš„</h3>
<p>AIå†²å‡»ä¸‹é—®å…«è‚¡æ–‡å¥½åƒæ²¡å•¥æ„ä¹‰äº†ï¼Œä¸ä¼šçš„éƒ½é—®ä¸€ä¸‹AIå°±è¡Œäº†ï¼Œä½†æ˜¯å¤šå¤šå°‘å°‘è¿˜æ˜¯æœ‰æ„ä¹‰çš„</p>
<p>ä¸€ä¸ªèŠ‚æµé˜²æŠ–ä½¿ç”¨åœºæ™¯éƒ½è¯´ä¸ä¸Šæ¥çš„äººï¼Œå³ä½¿åœ¨AIçš„åŠ æŒä¸‹ï¼Œå…¶å®åŠ›æˆ‘ä¹ŸæŒæ€€ç–‘æ€åº¦</p>
<p>åˆšæ¯•ä¸šçš„æ ¡æ‹›ç”Ÿè¯´ä¸ä¸Šæ¥ä¹Ÿå°±ç®—äº†ï¼Œå·¥ä½œä¸‰å¹´ä¸çŸ¥é“èŠ‚æµé˜²æŠ–å¥½åƒå¤šå¤šå°‘å°‘æœ‰ç‚¹è¯´ä¸è¿‡å»äº†</p>
<h3 data-id="heading-3">å­¦å†è¿˜æ˜¯å¥½ä½¿</h3>
<p>å¦ç™½è®²ï¼Œé‡åˆ°é«˜å­¦å†çš„ï¼Œå¯¹å…¶æŠ€æœ¯è¦æ±‚ç¡®å®æ”¾æ¾äº†æ¡ä»¶ï¼Œæˆ‘ä¹Ÿæƒ³è¯´ç¨‹åºå‘˜æœ€é‡è¦çš„æ˜¯æŠ€æœ¯å®åŠ›ï¼Œå­¦å†ä¸é‡è¦</p>
<p>ä½†æ˜¯çœŸæ­£è½®åˆ°è‡ªå·±çš„æ—¶å€™ï¼ŒæŠ€æœ¯å®åŠ›æœ‰æ—¶å€™ä¸å¦‚å­¦å†é‚£ä¹ˆæ˜æ˜¾ï¼Œå¯é‡åŒ–</p>
<p>ä»¥åŠé¢†å¯¼ä¸€å¬XXå¤§å­¦çš„ï¼Œä»–ä¹Ÿè®¤å¯ï¼Œä¸ç„¶è¿˜å¾—è¯æ˜è¿™äººä¸é”™</p>
<p>æ‰€ä»¥ä½ çœ‹ï¼Œåªè¦ä½ èƒ½è¯æ˜ä½ çš„å®åŠ›ä¼˜åŠ¿å¤§äºå­¦å†çš„åŠ£åŠ¿ï¼Œé‚£ä¹ˆå­¦å†å®Œå…¨ä¸æ˜¯é—®é¢˜</p>
<p>åªå¯æƒœå¯¹å¤§éƒ¨åˆ†äººæ¥è®²å®åŠ›åŠ£åŠ¿ä¸å­¦å†åŠ£åŠ¿å…±å­˜ï¼ˆåˆ«éª‚äº†åˆ«éª‚äº†ï¼‰</p>
<h3 data-id="heading-4">åœ¨çº¿ç®€å†ã€Blogã€Github</h3>
<p>ç®€å†ä¸­æœ‰åœ¨çº¿ç®€å†ã€Blogã€Githubç­‰ï¼Œè¿˜æ˜¯æ¯”è¾ƒåŠ åˆ†çš„ï¼Œå¯èƒ½å¯¹äºå¤§å…¬å¸æ¥è®²ï¼Œä½ çš„githubæ²¡æœ‰å¾ˆé«˜starï¼Œåˆ«äººä¸è§‰å¾—ä½ ä¼˜ç§€</p>
<p>ä½†æ˜¯å¯¹äºå°å…¬å¸æ¥æ—¶ï¼Œä½ æœ‰Githubï¼Œè‡³å°‘è¯æ˜ä½  ç”¨å¿ƒä¸€äº›ï¼Œä»¥åŠè‡ªå·±æƒ³æ¢ç´¢ä¸€äº›é¡¹ç›®</p>
<h3 data-id="heading-5">é¢è¯•çœŸå°±æ˜¯ç¢°è¿æ°”</h3>
<p>é¢è¯•å®˜ä¹Ÿæ˜¯åœ¨ç¹å¿™çš„å·¥ä½œä¸­ä¸ä½ æ²Ÿé€šï¼Œå¯èƒ½é¢è¯•ä¸è¿‡å°±æ˜¯ä¸å’Œé¢è¯•å®˜çš„â€œèƒƒå£â€ï¼Œæ‰€ä»¥å¤§å®¶åƒä¸‡åˆ«ç°å¿ƒä¸§æ°”</p>
<h3 data-id="heading-6">END</h3>
<p>ä»¥ä¸Šæ˜¯æˆ‘è‡ªå·±çš„ä¸€äº›çœ‹æ³•ï¼Œç¥å¤§å®¶ä¸€äº›é¡ºåˆ©</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡è¯»æ‡‚ Uniapp å°ç¨‹åºç™»å½•æµç¨‹]]></title>    <link>https://juejin.cn/post/7573579203461480499</link>    <guid>https://juejin.cn/post/7573579203461480499</guid>    <pubDate>2025-11-18T03:01:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573579203461480499" data-draft-id="7572939250586222643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡è¯»æ‡‚ Uniapp å°ç¨‹åºç™»å½•æµç¨‹"/> <meta itemprop="keywords" content="å‰ç«¯,uni-app,å¾®ä¿¡å°ç¨‹åº"/> <meta itemprop="datePublished" content="2025-11-18T03:01:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lsx_"/> <meta itemprop="url" content="https://juejin.cn/user/1442981392682829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡è¯»æ‡‚ Uniapp å°ç¨‹åºç™»å½•æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442981392682829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lsx_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T03:01:46.000Z" title="Tue Nov 18 2025 03:01:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¾®ä¿¡å°ç¨‹åºç™»å½•åŸç†</h2>
<p>ç™»å½•çš„æ ‡å‡†æµç¨‹å¦‚ä¸‹ï¼š</p>



































<table><thead><tr><th>æ­¥éª¤</th><th>åŠ¨ä½œ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>1</td><td>å°ç¨‹åºç«¯è°ƒç”¨Â <code>uni.login()</code></td><td>è·å–Â <code>code</code>ï¼ˆä¸´æ—¶ç™»å½•å‡­è¯ï¼‰</td></tr><tr><td>2</td><td>å°ç¨‹åºç«¯æŠŠÂ <code>code</code>Â å‘ç»™è‡ªå·±çš„æœåŠ¡å™¨</td><td>é€šå¸¸æ˜¯Â <code>/api/login</code></td></tr><tr><td>3</td><td>æœåŠ¡å™¨è¯·æ±‚å¾®ä¿¡æ¥å£Â <code>https://api.weixin.qq.com/sns/jscode2session</code></td><td>ç”¨Â <code>appid + secret + code</code>Â æ¢å–Â <code>openid</code>Â å’ŒÂ <code>session_key</code></td></tr><tr><td>4</td><td>æœåŠ¡å™¨ç”Ÿæˆè‡ªå·±çš„ token è¿”å›å‰ç«¯</td><td>å¯¹åº”å¹³å°ç”¨æˆ·èº«ä»½</td></tr><tr><td>5</td><td>å°ç¨‹åºä¿å­˜ token å¹¶ç™»å½•æˆåŠŸ</td><td>ä¸‹æ¬¡å¯åŠ¨å¯ç›´æ¥ä½¿ç”¨</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">äºŒã€å‰ç«¯å¼€å‘ï¼ˆUniApp + Vue3ï¼‰</h2>
<h4 data-id="heading-2">ç™»å½•é¡µé¢ä»£ç </h4>
<p><code>/pages/login/login.vue</code></p>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>æ¬¢è¿ä½¿ç”¨å°ç¨‹åº<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleLogin"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-btn"</span>&gt;</span>å¾®ä¿¡ä¸€é”®ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> token = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">ref</span>({})

<span class="hljs-comment">// å¾®ä¿¡ç™»å½•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. è·å– code</span>
    <span class="hljs-keyword">const</span> { code } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      uni.<span class="hljs-title function_">login</span>({
        <span class="hljs-attr">provider</span>: <span class="hljs-string">'weixin'</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-title function_">resolve</span>(res),
        <span class="hljs-attr">fail</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">reject</span>(err)
      })
    })
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å°ç¨‹åºç™»å½•å‡­è¯ code:'</span>, code)

    <span class="hljs-comment">// 2. å‘é€åˆ°åç«¯</span>
    <span class="hljs-keyword">const</span> [err, res] = <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">request</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost:3000/api/login'</span>, <span class="hljs-comment">// åç«¯æ¥å£åœ°å€</span>
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">data</span>: { code }
    })
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>)

    <span class="hljs-comment">// 3. å¤„ç†åç«¯è¿”å›æ•°æ®</span>
    token.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>
    user.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">user</span>

    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'token'</span>, token.<span class="hljs-property">value</span>)
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'userInfo'</span>, user.<span class="hljs-property">value</span>)

    uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'ç™»å½•æˆåŠŸ'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'success'</span> })
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç™»å½•ç»“æœ:'</span>, res.<span class="hljs-property">data</span>)
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e)
    uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'ç™»å½•å¤±è´¥'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span> })
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">200</span>rpx;
  <span class="hljs-attribute">text-align</span>: center;
}
<span class="hljs-selector-class">.title</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">40</span>rpx;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">80</span>rpx;
}
<span class="hljs-selector-class">.login-btn</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#07c160</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">80%</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12</span>rpx;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<blockquote>
<p>âœ… ç‚¹å‡»æŒ‰é’®ä¼šè‡ªåŠ¨æ‰§è¡Œå¾®ä¿¡ç™»å½•æµç¨‹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€åç«¯å®ç°ï¼ˆNode.jsï¼‰</h2>
<h4 data-id="heading-4">1ï¸âƒ£ ç¯å¢ƒæ­å»º</h4>
<p>åˆ›å»ºä¸€ä¸ªÂ <code>server</code>Â æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">npm <span class="hljs-keyword">init</span> -y
npm install express axios jsonwebtoken cors
</code></pre>
<h4 data-id="heading-5">2ï¸âƒ£ åˆ›å»ºÂ <code>server.js</code></h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>)
<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsonwebtoken'</span>)
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>)

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>())
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())

<span class="hljs-comment">// ä½ çš„å¾®ä¿¡å°ç¨‹åºä¿¡æ¯</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">APPID</span> = <span class="hljs-string">'ä½ çš„å°ç¨‹åºAppID'</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SECRET</span> = <span class="hljs-string">'ä½ çš„å°ç¨‹åºAppSecret'</span>

<span class="hljs-comment">// tokenå¯†é’¥</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">JWT_SECRET</span> = <span class="hljs-string">'my_secret_key'</span>

<span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“</span>
<span class="hljs-keyword">const</span> users = {}

<span class="hljs-comment">// ç™»å½•æ¥å£</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/login'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> { code } = req.<span class="hljs-property">body</span>
  <span class="hljs-keyword">if</span> (!code) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'ç¼ºå°‘code'</span> })

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// è¯·æ±‚å¾®ä¿¡APIæ¢å–openidå’Œsession_key</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(
      <span class="hljs-string">`https://api.weixin.qq.com/sns/jscode2session`</span>, {
        <span class="hljs-attr">params</span>: {
          <span class="hljs-attr">appid</span>: <span class="hljs-variable constant_">APPID</span>,
          <span class="hljs-attr">secret</span>: <span class="hljs-variable constant_">SECRET</span>,
          <span class="hljs-attr">js_code</span>: code,
          <span class="hljs-attr">grant_type</span>: <span class="hljs-string">'authorization_code'</span>
        }
      }
    )

    <span class="hljs-keyword">const</span> { openid, session_key, errcode, errmsg } = response.<span class="hljs-property">data</span>
    <span class="hljs-keyword">if</span> (errcode) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'å¾®ä¿¡ç™»å½•å¤±è´¥: '</span> + errmsg })
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·openid:'</span>, openid)

    <span class="hljs-comment">// æ¨¡æ‹Ÿåˆ›å»º/æ›´æ–°ç”¨æˆ·</span>
    <span class="hljs-keyword">if</span> (!users[openid]) {
      users[openid] = { openid, <span class="hljs-attr">createTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() }
    }

    <span class="hljs-comment">// ç”Ÿæˆè‡ªå®šä¹‰ token</span>
    <span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>({ openid }, <span class="hljs-variable constant_">JWT_SECRET</span>, { <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">'7d'</span> })

    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
      token,
      <span class="hljs-attr">user</span>: users[openid]
    })
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err)
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'æœåŠ¡å™¨é”™è¯¯'</span> })
  }
})

<span class="hljs-comment">// éªŒè¯ token æ¥å£ï¼ˆç¤ºä¾‹ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/profile'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> auth = req.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>
  <span class="hljs-keyword">if</span> (!auth) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·å…ˆç™»å½•'</span> })

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> decoded = jwt.<span class="hljs-title function_">verify</span>(auth.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'Bearer '</span>, <span class="hljs-string">''</span>), <span class="hljs-variable constant_">JWT_SECRET</span>)
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">user</span>: users[decoded.<span class="hljs-property">openid</span>] })
  } <span class="hljs-keyword">catch</span> {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'tokenæ— æ•ˆ'</span> })
  }
})

<span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'âœ… Server running on http://localhost:3000'</span>)
})
</code></pre>
<blockquote>
<p>âœ… å¯åŠ¨å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">node <span class="hljs-built_in">server</span>.js
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-6">å››ã€è¿è¡Œæµ‹è¯•</h2>
<ol>
<li>
<p>å¯åŠ¨åç«¯ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">node <span class="hljs-built_in">server</span>.js
</code></pre>
</li>
<li>
<p>æ‰“å¼€ HBuilderX â†’ è¿è¡Œ â†’ è¿è¡Œåˆ°å¾®ä¿¡å¼€å‘è€…å·¥å…·</p>
</li>
<li>
<p>ç‚¹å‡» â€œä¸€é”®ç™»å½•â€ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡º</p>
<ul>
<li>å°ç¨‹åºç«¯æ—¥å¿—ä¼šæ‰“å°Â <code>code</code></li>
<li>åç«¯ä¼šæ‰“å°Â <code>openid</code></li>
</ul>
</li>
<li>
<p>Toast æç¤º â€œç™»å½•æˆåŠŸâ€ âœ…</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-7">äº”ã€æŒä¹…åŒ–ç™»å½•</h2>
<p>ç™»å½•æˆåŠŸåï¼š</p>
<ul>
<li>å°† token å­˜åˆ°Â <code>uni.setStorageSync('token', token)</code></li>
<li>ä¸‹æ¬¡å¯åŠ¨æ—¶åˆ¤æ–­æœ¬åœ°æ˜¯å¦æœ‰ tokenï¼Œæœ‰åˆ™ä¸å†é‡å¤ç™»å½•ã€‚</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åœ¨ App.vue çš„ onLaunch ä¸­</span>
<span class="hljs-title function_">onLaunch</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> token = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">'token'</span>)
  <span class="hljs-keyword">if</span> (token) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·å·²ç™»å½•:'</span>, token)
  } <span class="hljs-keyword">else</span> {
    uni.<span class="hljs-title function_">reLaunch</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/login/login'</span> })
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-8">å…­ã€é‡ç‚¹æ€»ç»“</h2>



































<table><thead><tr><th>æ¨¡å—</th><th>å·¥å…·</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>å‰ç«¯</td><td>uni.login()</td><td>è·å– code</td></tr><tr><td>å‰ç«¯</td><td>uni.request()</td><td>è°ƒåç«¯ç™»å½•æ¥å£</td></tr><tr><td>åç«¯</td><td>axios è¯·æ±‚å¾®ä¿¡æ¥å£</td><td>ç”¨ code æ¢ openid</td></tr><tr><td>åç«¯</td><td>jsonwebtoken</td><td>ç”Ÿæˆè‡ªå®šä¹‰ token</td></tr><tr><td>å‰ç«¯</td><td>uni.setStorageSync</td><td>ä¿å­˜ token</td></tr></tbody></table>
<hr/>
<p>âœ…Â <strong>æœ€ç»ˆæ•ˆæœï¼š</strong></p>
<ul>
<li>ç‚¹å‡»ç™»å½•æŒ‰é’® â†’ è‡ªåŠ¨é€šè¿‡å¾®ä¿¡æˆæƒç™»å½•</li>
<li>åç«¯ç”ŸæˆÂ <code>token</code>Â å¹¶è¿”å›</li>
<li>å‰ç«¯ä¿å­˜ç™»å½•çŠ¶æ€</li>
<li>å¯æ‰©å±•ä¸ºç”¨æˆ·æ³¨å†Œã€ç»‘å®šæ‰‹æœºå·ç­‰åŠŸèƒ½ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰‘æŒ‡offer-38ã€â¼†å‰æ ‘çš„æ·±åº¦]]></title>    <link>https://juejin.cn/post/7573579203460513843</link>    <guid>https://juejin.cn/post/7573579203460513843</guid>    <pubDate>2025-11-18T01:12:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573579203460513843" data-draft-id="7572566115848798258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰‘æŒ‡offer-38ã€â¼†å‰æ ‘çš„æ·±åº¦"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-18T01:12:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰‘æŒ‡offer-38ã€â¼†å‰æ ‘çš„æ·±åº¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:12:48.000Z" title="Tue Nov 18 2025 01:12:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é¢˜â½¬æè¿°</h2>
<p>è¾“â¼Šâ¼€æ£µâ¼†å‰æ ‘ï¼Œæ±‚è¯¥æ ‘çš„æ·±åº¦ã€‚ä»æ ¹ç»“ç‚¹åˆ°å¶ç»“ç‚¹ä¾æ¬¡ç»è¿‡çš„ç»“ç‚¹ï¼ˆå«æ ¹ã€å¶ç»“ç‚¹ï¼‰å½¢æˆæ ‘çš„â¼€æ¡è·¯å¾„ï¼Œæœ€â»“è·¯å¾„çš„â»“åº¦ä¸ºæ ‘çš„æ·±åº¦ã€‚</p>
<p>ç¤ºä¾‹1
è¾“â¼Šï¼š{1,2,3,4,5,#,6,#,#,7}
è¿”å›å€¼ï¼š4</p>
<h2 data-id="heading-1">æ€è·¯åŠè§£ç­”</h2>
<p>å£°æ˜ï¼šè¿™â¾¥çš„è¾“â¼Šæ˜¯â¼€ä¸ªæ•°çš„æ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä»æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œâ½½ç±»ä¼¼æ•°ç»„çš„è¡¨è¾¾â½…å¼ {1,2,3,4,5,#,6,#,#,7} ï¼Œåˆ™æ˜¯æŒ‰ç…§å±‚æ¬¡æ¥æ”¾çš„ã€‚(â½å¦‚è¿™ä¸ªæ ‘å°±æ˜¯4å±‚)</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8da78b9033b49a8ab2ab2c0db621ad8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033168&amp;x-signature=yd%2F6utyQW120c%2F1lli9SAfdg6tQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">é€’å½’</h3>
<p>ç¬¬â¼€ç§â½…æ³•â½è¾ƒå®¹æ˜“æƒ³åˆ°ï¼Œå¯¹äºä»»æ„â¼€ä¸ªèŠ‚ç‚¹ node â½½â¾”ï¼Œæˆ‘è¦æƒ³çŸ¥é“å½“å‰ node èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬å½“å‰èŠ‚ç‚¹ï¼‰çš„æ·±åº¦ï¼Œè‚¯å®šå¾—æ±‚å½“å‰èŠ‚ç‚¹çš„å·¦è¾¹èŠ‚ç‚¹ï¼ˆè®¾ä¸º left ï¼‰çš„æ·±åº¦ leftDeepth ï¼Œä»¥åŠè·å–å³èŠ‚ç‚¹ï¼ˆè®¾ä¸º right ï¼‰çš„æ·±åº¦ rightDeepth ï¼Œç„¶åæ±‚ä¸¤è€…æœ€â¼¤+1ï¼ˆ Max{leftDeepth,rightDeepth}+1 ï¼‰ï¼Œå°±æ˜¯å½“å‰èŠ‚ç‚¹çš„æ·±åº¦ã€‚</p>
<p>æ€è·¯ï¼šäºŒå‰æ ‘çš„æ·±åº¦ = max(å·¦å­æ ‘æ·±åº¦, å³å­æ ‘æ·±åº¦) + 1</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3b5a62a8a244fb082de720e34813910~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033168&amp;x-signature=d8URAlqbKLcnFVhBoHeiJByq0kU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b7f5fefa5914e5e992d14aa5c2fefc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033168&amp;x-signature=lYOodImiRMHQ49rSPWj6UYSpi5A%3D" alt="" loading="lazy"/></p>
<p>â½½é€’å½’ä¸­â½è¾ƒé‡è¦çš„â¼€ç‚¹ï¼Œæ˜¯ç»“æŸæ¡ä»¶ã€‚åœ¨è¿™é“é¢˜ä¸­ï¼Œå¦‚æœâ¼€ä¸ªèŠ‚ç‚¹ä¸º null ï¼Œå°±ç»“æŸï¼Œå¹¶ä¸”å½“å‰èŠ‚ç‚¹çš„æ·±åº¦æ˜¯ 0 ã€‚ä»£ç è¶…çº§â½†æ•ŒçŸ­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
     <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">TreeDepth</span><span class="hljs-params">(TreeNode root)</span> {
         <span class="hljs-keyword">if</span>(root==<span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
         <span class="hljs-keyword">return</span> Math.max(TreeDepth(root.left),TreeDepth(root.right))+<span class="hljs-number">1</span>;
     }
}
</code></pre>
<p>ä»¥ä¸Šè§£æ³•è¦æ˜¯çœ‹ä¸æ˜ç™½ï¼Œå¯ä»¥çœ‹è¯¦ç»†ç‚¹çš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">TreeDepth</span><span class="hljs-params">(TreeNode root)</span> {
        <span class="hljs-comment">// é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼šç©ºèŠ‚ç‚¹æ·±åº¦ä¸º0</span>
        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-comment">// é€’å½’è®¡ç®—å·¦å­æ ‘æ·±åº¦</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">leftDepth</span> <span class="hljs-operator">=</span> maxDepth(root.left);
        <span class="hljs-comment">// é€’å½’è®¡ç®—å³å­æ ‘æ·±åº¦</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">rightDepth</span> <span class="hljs-operator">=</span> maxDepth(root.right);
        
        <span class="hljs-comment">// å½“å‰æ ‘æ·±åº¦ = å·¦å³å­æ ‘æœ€å¤§æ·±åº¦ + 1ï¼ˆå½“å‰èŠ‚ç‚¹ï¼‰</span>
        <span class="hljs-keyword">return</span> Math.max(leftDepth, rightDepth) + <span class="hljs-number">1</span>;
    }
}
</code></pre>
<ul>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼Œéœ€è¦è®¿é—®æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(h)ï¼Œé€’å½’æ ˆæ·±åº¦ç­‰äºæ ‘é«˜ï¼Œæœ€åæƒ…å†µï¼ˆé“¾è¡¨ï¼‰ä¸ºO(n)</li>
</ul>
<h3 data-id="heading-3">è¿­ä»£éå†</h3>
<p>æ€è·¯æ˜¯å¦‚æœæ ‘çš„æ ¹èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†æ ¹èŠ‚ç‚¹æ”¾è¿›é˜Ÿåˆ—ä¸­ã€‚ä¹Ÿå°±æ˜¯ï¼Œæ¯éå†ä¸€å±‚ï¼Œæ·±åº¦åŠ 1ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰å±‚</p>
<p>è®¾ç½®æ·±åº¦ deep ä¸º0ã€‚ä½¿â½¤ while å¾ªç¯ï¼Œåªè¦é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™æ‰§â¾ä¸‹â¾¯æ“ä½œï¼š</p>
<ol>
<li>è·å–é˜Ÿåˆ—çš„â¼¤â¼© size ã€‚</li>
<li>ä¾æ¬¡å–å‡ºé˜Ÿåˆ—çš„å‰ size ä¸ªå…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ çš„å·¦è¾¹èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†å·¦è¾¹èŠ‚ç‚¹æ”¾è¿›é˜Ÿåˆ—ï¼Œå¦‚æœè¯¥å…ƒç´ çš„å³è¾¹èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™å°†è¯¥å…ƒç´ çš„å³è¾¹èŠ‚ç‚¹æ”¾è¿›é˜Ÿåˆ—ã€‚</li>
<li>å±‚æ¬¡ deep+1</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">TreeDepth</span><span class="hljs-params">(TreeNode root)</span> {
        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        
        Queue&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
        queue.offer(root);
        <span class="hljs-type">int</span> <span class="hljs-variable">depth</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (!queue.isEmpty()) {
            <span class="hljs-comment">// å½“å‰å±‚çš„èŠ‚ç‚¹ä¸ªæ•°</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">levelSize</span> <span class="hljs-operator">=</span> queue.size();
            
            <span class="hljs-comment">// éå†å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; levelSize; i++) {
                <span class="hljs-type">TreeNode</span> <span class="hljs-variable">currentNode</span> <span class="hljs-operator">=</span> queue.poll();
                
                <span class="hljs-comment">// å°†ä¸‹ä¸€å±‚èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</span>
                <span class="hljs-keyword">if</span> (currentNode.left != <span class="hljs-literal">null</span>) {
                    queue.offer(currentNode.left);
                }
                <span class="hljs-keyword">if</span> (currentNode.right != <span class="hljs-literal">null</span>) {
                    queue.offer(currentNode.right);
                }
            }
            
            <span class="hljs-comment">// å®Œæˆä¸€å±‚éå†ï¼Œæ·±åº¦åŠ 1</span>
            depth++;
        }
        
        <span class="hljs-keyword">return</span> depth;
    }
}
</code></pre>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n)ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éœ€è¦è¿›â¼Šé˜Ÿåˆ—ï¼Œå†å‡ºé˜Ÿåˆ—</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(n),å€ŸåŠ©äº†é¢å¤–çš„é˜Ÿåˆ—ç©ºé—´ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰–æ LangGraph çš„ Super-step æ¦‚å¿µ]]></title>    <link>https://juejin.cn/post/7573512056089952291</link>    <guid>https://juejin.cn/post/7573512056089952291</guid>    <pubDate>2025-11-18T01:14:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573512056089952291" data-draft-id="7573299401047031854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰–æ LangGraph çš„ Super-step æ¦‚å¿µ"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2025-11-18T01:14:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ALLINAI"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056639549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰–æ LangGraph çš„ Super-step æ¦‚å¿µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056639549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ALLINAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:14:39.000Z" title="Tue Nov 18 2025 01:14:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>Super-step æ˜¯ LangGraph çš„æ‰§è¡Œå•ä½ â€”â€” ä¸€ä¸ªâ€œåŒæ­¥çš„æ‰¹å¤„ç†è½®æ¬¡â€</strong>ã€‚åœ¨æ¯ä¸ª super-step ä¸­ï¼Œæ¡†æ¶ä¼šå¹¶è¡Œ/æ‰¹é‡åœ°è¿è¡Œå½“å‰æ‰€æœ‰å¯æ‰§è¡ŒèŠ‚ç‚¹ï¼Œæ”¶é›†å®ƒä»¬çš„å†™å…¥ï¼ˆupdatesï¼‰ï¼Œç”¨äº‹å…ˆå®šä¹‰å¥½çš„ reducer æŠŠå†™å…¥åˆå¹¶æˆä¸€ä¸ªæ–°çš„å…¨å±€çŠ¶æ€ï¼ˆsnapshotï¼‰ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ª super-stepã€‚æ¯ä¸ª super-step ç»“æŸéƒ½ä¼šå½¢æˆä¸€ä¸ª checkpointï¼ˆå¿«ç…§ï¼‰ï¼Œç”¨äºæŒä¹…åŒ–ã€æ¢å¤ã€å›æ”¾ä¸æ—¶é—´æ—…è¡Œã€‚</p>
</blockquote>
<p>ä¸‹é¢æŠŠè¿™ä¸ªæ¦‚å¿µä»é«˜å±‚åˆ°ç»†èŠ‚ã€ä»è®¾è®¡æ€æƒ³åˆ°å·¥ç¨‹å®ç°ï¼Œç³»ç»Ÿè®²æ¸…æ¥šâ€”â€”åŒ…æ‹¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšã€åº•å±‚å¦‚ä½•å®ç°ã€å¹¶å‘æ¨¡å‹å¦‚ä½•ä»‹å…¥ã€ä¸ checkpoint çš„å…³ç³»ã€å¸¸è§ç”¨æ³•ä¸è°ƒè¯•æŠ€å·§ç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. æ¦‚å¿µé€Ÿè§ˆï¼ˆä¸€å¥è¯ï¼‰</h2>
<p><strong>super-step = ä¸€è½®å¹¶è¡Œæ‰§è¡Œ + æ”¶é›†æ‰€æœ‰èŠ‚ç‚¹å†™å…¥ + ç”¨ reducer åŸå­åˆå¹¶åˆ°å…¨å±€çŠ¶æ€ + ç”Ÿæˆ checkpoint</strong>ã€‚
å®ƒæ¥æºäº Pregel / BSPï¼ˆBulk Synchronous Parallelï¼‰æ¨¡å‹ï¼Œæ˜¯ LangGraph çš„æ ¸å¿ƒæ‰§è¡Œè¯­ä¹‰ã€‚</p>
<hr/>
<h2 data-id="heading-1">2. ä¸ºä»€ä¹ˆç”¨ super-stepï¼ˆè®¾è®¡åŠ¨æœºï¼‰</h2>
<ul>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šåœ¨åŒä¸€è½®æ¬¡å†…æ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°çš„çŠ¶æ€ç›¸åŒï¼ˆè¯»æ—¶ç‚¹ä¸€è‡´ï¼ŒRead-time Consistencyï¼‰ï¼Œå†™å…¥åˆå¹¶æ—¶ç»Ÿä¸€å¤„ç†ï¼Œé¿å…äº¤å‰ä¾èµ–å¯¼è‡´çš„ä¸ç¡®å®šæ€§ã€‚</li>
<li><strong>å¯æ¢å¤ / å¯å›æ”¾</strong>ï¼šæ¯è½®ç»“æŸå³ checkpointï¼Œä¾¿äºæ¢å¤ã€æ—¶é—´æ—…è¡Œã€human-in-the-loopã€‚</li>
<li><strong>å¹¶è¡Œè¡¨è¾¾åŠ›</strong>ï¼šå¤šä¸ªé€»è¾‘ä¸Šç‹¬ç«‹çš„èŠ‚ç‚¹å¯ä»¥åœ¨åŒä¸€è½®æ¬¡ä¸­å¹¶å‘æ‰§è¡Œï¼Œé€‚åˆå¹¶è¡Œä»»åŠ¡ä¸ agent åä½œåœºæ™¯ã€‚</li>
<li><strong>æ˜ç¡®çš„åˆå¹¶è¯­ä¹‰</strong>ï¼šé€šè¿‡ reducerï¼ˆæˆ–é»˜è®¤è¦†ç›–è§„åˆ™ï¼‰å®šä¹‰å¦‚ä½•æŠŠå¤šä¸ªèŠ‚ç‚¹çš„å†™å…¥åˆå¹¶ä¸ºä¸€ä¸ªçŠ¶æ€ï¼Œä¾¿äºè®¾è®¡ç´¯ç§¯å‹å­—æ®µï¼ˆä¾‹å¦‚åˆ—è¡¨ç´¯åŠ ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-2">3. super-step çš„æ‰§è¡Œæµç¨‹ï¼ˆåˆ†æ­¥éª¤è¯¦è§£ï¼‰</h2>
<ol>
<li>
<p><strong>å‘ç° active nodes</strong></p>
<ul>
<li>æ ¹æ®å½“å‰ stateã€å›¾ç»“æ„ä»¥åŠä¸Šæ¬¡åˆå¹¶ç»“æœå†³å®šå“ªäº›èŠ‚ç‚¹åœ¨æœ¬è½®å¯æ‰§è¡Œï¼ˆrunnable / activeï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œ active nodesï¼ˆå¹¶å‘æˆ–ä¸²è¡Œï¼‰</strong></p>
<ul>
<li>æ‰§è¡Œå‡½æ•°/èŠ‚ç‚¹ä½“ï¼Œå¾—åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºï¼ˆé€šå¸¸åŒ…å« <code>update</code> å­—æ®µï¼Œå’Œ <code>goto</code> / control æŒ‡ä»¤ï¼‰ã€‚</li>
<li>èŠ‚ç‚¹è¾“å‡ºå…ˆå†™å…¥ä¸´æ—¶ç¼“å†²åŒºï¼ˆä¸ä¼šç«‹å³æ”¹å˜å…¨å±€ stateï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ”¶é›†æ‰€æœ‰ writes</strong></p>
<ul>
<li>æ±‡æ€»æ‰€æœ‰èŠ‚ç‚¹çš„ <code>update</code>ï¼ˆçŠ¶æ€å†™å…¥ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¯¹æ¯ä¸ªå­—æ®µæ‰§è¡Œ reducer åˆå¹¶</strong></p>
<ul>
<li>å¦‚æœå­—æ®µè¢« Annotated æŒ‡å®šäº†åˆå¹¶ç­–ç•¥ï¼ˆä¾‹å¦‚ <code>add</code>ï¼‰ï¼Œå°±ç”¨è¯¥ç­–ç•¥åˆå¹¶ï¼›å¦åˆ™æŒ‰é»˜è®¤è§„åˆ™ï¼ˆé€šå¸¸è¦†ç›–ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿæˆæ–°çš„ state snapshotï¼ˆStateSnapshotï¼‰</strong></p>
<ul>
<li>åŒ…å« <code>values</code>ï¼ˆåˆå¹¶åçŠ¶æ€ï¼‰ã€<code>next</code>ï¼ˆä¸‹è½®è¦æ‰§è¡Œçš„èŠ‚ç‚¹ï¼‰ã€<code>metadata</code>ã€<code>tasks</code> ç­‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æŒä¹…åŒ– checkpointï¼ˆcheckpointerï¼‰</strong></p>
<ul>
<li>æŠŠ snapshot å†™å…¥ä¿å­˜å™¨ï¼ˆInMemory/SQLite/Postgres ç­‰ï¼‰ï¼Œç”¨äºæ¢å¤ä¸å›æ”¾ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¾ªç¯æˆ–ç»“æŸ</strong></p>
<ul>
<li>å¦‚æœè¿˜æœ‰å¯æ‰§è¡ŒèŠ‚ç‚¹ï¼Œç»§ç»­ä¸‹ä¸€è½® super-stepï¼Œå¦åˆ™å›¾æ‰§è¡Œç»“æŸã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-3">4. åº•å±‚å®ç°ï¼šè°ƒåº¦å™¨ã€å¹¶å‘ã€åŒæ­¥ï¼ˆå…³é”®ç‚¹ä¸ä¼ªä»£ç ï¼‰</h2>
<p><strong>å…³é”®ç‚¹ï¼šsuper-step æ˜¯è°ƒåº¦æ¨¡å‹ï¼Œä¸æ˜¯å¹¶å‘æ¨¡å‹ã€‚</strong> è°ƒåº¦å™¨è´Ÿè´£åˆ†é˜¶æ®µæ‰§è¡Œä¸åˆå¹¶ï¼Œä½†æ˜¯å¦å¹¶å‘å–å†³äºèŠ‚ç‚¹æœ¬èº«æˆ–è¿è¡Œæ—¶é€‰æ‹©ã€‚</p>
<p>ä¼ªä»£ç ï¼ˆé«˜åº¦æ¦‚æ‹¬ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python">state = initial_state
<span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> finished(state):
    active_nodes = discover_active_nodes(state)
    <span class="hljs-comment"># 1) å¹¶å‘æ‰§è¡Œæˆ–ä¸²è¡Œæ‰§è¡Œ active nodes çš„ node.run</span>
    results = parallel_map(execute_node, active_nodes)  <span class="hljs-comment"># å¯ä»¥æ˜¯å¹¶è¡Œï¼Œä¹Ÿå¯ä»¥æ˜¯åŒæ­¥</span>
    <span class="hljs-comment"># 2) æ”¶é›†æ‰€æœ‰ writes</span>
    all_writes = collect_writes(results)
    <span class="hljs-comment"># 3) æŒ‰å­—æ®µ reducer åˆå¹¶æˆ new_state</span>
    new_state = reduce_state(state, all_writes)
    <span class="hljs-comment"># 4) ç”Ÿæˆå¹¶æŒä¹…åŒ– checkpoint</span>
    checkpointer.save(snapshot=new_state, metadata=...)
    state = new_state
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>parallel_map</code> å¯ä»¥ç”¨ <code>asyncio.gather</code>ï¼ˆè‹¥èŠ‚ç‚¹ä¸º asyncï¼‰æˆ– <code>ThreadPoolExecutor</code>ï¼ˆè‹¥ä½ å¸Œæœ›çº¿ç¨‹å¹¶å‘ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æ™®é€š for-loopï¼ˆå•çº¿ç¨‹ï¼‰ã€‚æ¡†æ¶æœ¬èº«å¹¶ä¸å¼ºåˆ¶åˆ›å»ºçº¿ç¨‹ã€‚</li>
<li><code>reduce_state</code> æ˜¯åŸå­æ“ä½œï¼šåŸºäºæ¯ä¸ªå­—æ®µçš„åˆå¹¶ç­–ç•¥ï¼ˆAnnotated metadataï¼‰ï¼ŒæŠŠæ‰€æœ‰å†™å…¥åˆå¹¶æˆä¸€ä»½ä¸€è‡´çŠ¶æ€ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">5. state åˆå¹¶ï¼ˆreducers / Annotated çš„è§’è‰²ï¼‰</h2>
<ul>
<li>
<p>LangGraph ä½¿ç”¨ Python ç±»å‹æ³¨è§£ï¼ˆ<code>typing.Annotated</code>ï¼‰æ¥ä¸ºçŠ¶æ€å­—æ®µ<strong>é™„åŠ å…ƒæ•°æ®</strong>ï¼Œå…¶ä¸­å¸¸è§å…ƒæ•°æ®æ˜¯â€œåˆå¹¶å‡½æ•°â€ï¼ˆreducerï¼‰ã€‚</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    foo: <span class="hljs-built_in">str</span>                  <span class="hljs-comment"># è¦†ç›–å¼ï¼ˆé»˜è®¤ï¼‰</span>
    bar: Annotated[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], add]  <span class="hljs-comment"># ä½¿ç”¨ add åˆå¹¶ï¼ˆåˆ—è¡¨æ‹¼æ¥ï¼‰</span>
</code></pre>
</li>
<li>
<p>åœ¨ä¸€ä¸ª super-step ä¸­ï¼Œè‹¥ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å†™ <code>bar</code>ï¼Œæ¡†æ¶ä¼šè°ƒç”¨ <code>add(existing, new)</code> è€Œä¸æ˜¯ç®€å•æ›¿æ¢ï¼Œä»è€Œå®ç°ç´¯ç§¯è¯­ä¹‰ï¼ˆä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶æ”¶é›†ã€ç»“æœåˆå¹¶ï¼‰ã€‚</p>
</li>
</ul>
<p>è¿™æ˜¯ LangGraph æ”¯æŒå¹¶è¡ŒèŠ‚ç‚¹å†™å…¥è€Œä»èƒ½ä¿è¯ç¡®å®šæ€§çš„å…³é”®æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-5">6. super-step ä¸ checkpoint / æŒä¹…åŒ–çš„å…³ç³»</h2>
<ul>
<li><strong>æ¯ä¸ª super-step ç»“æŸéƒ½ä¼šäº§ç”Ÿä¸€ä¸ª checkpointï¼ˆStateSnapshotï¼‰</strong>ï¼ŒåŒ…å«å½“æ—¶çš„ <code>values</code>, <code>metadata</code>, <code>next</code>, <code>tasks</code> ç­‰ã€‚</li>
<li>Checkpoint æä¾›èƒ½åŠ›ï¼š<strong>æ¢å¤ï¼ˆrestoreï¼‰ã€å›æ”¾ï¼ˆreplayï¼‰ã€æ—¶é—´æ—…è¡Œï¼ˆforkï¼‰ã€äººæœºä¸­æ–­/resumeï¼ˆinterruptï¼‰</strong>ã€‚</li>
<li>åº•å±‚å®ç°æ˜¯å¯æ’æ‹”çš„ <code>checkpointer</code>ï¼ˆInMemorySaverã€SqliteSaverã€PostgresSaver ç­‰ï¼‰ï¼Œå¹¶é…åˆ <code>Serializer</code>ï¼ˆJsonPlus/EncryptedSerializerï¼‰åšåºåˆ—åŒ–/åŠ å¯†ã€‚</li>
</ul>
<p>å› æ­¤ super-step â‰ˆ æ‰§è¡Œå•ä½ï¼Œcheckpoint â‰ˆ è®°å¿†/æŒä¹…åŒ–å‰¯æœ¬ï¼Œä¸¤è€…åˆèµ·æ¥å°±æ˜¯å¯æ¢å¤å¯å®¡è®¡çš„æœ‰çŠ¶æ€æ‰§è¡Œå¼•æ“ã€‚</p>
<hr/>
<h2 data-id="heading-6">7. å¹¶å‘æ¨¡å‹ï¼šå¤šçº¿ç¨‹ã€åç¨‹è¿˜æ˜¯åŒæ­¥ï¼Ÿï¼ˆå·¥ç¨‹å®è·µï¼‰</h2>
<ul>
<li>
<p><strong>super-step æœ¬èº«æ˜¯åŒæ­¥çš„ã€åˆ†é˜¶æ®µçš„è°ƒåº¦æ¨¡å‹</strong>ï¼ˆBSPï¼‰ã€‚</p>
</li>
<li>
<p><strong>LangGraph ä¸å¼ºåˆ¶ä½¿ç”¨å¤šçº¿ç¨‹æˆ–åç¨‹</strong>ã€‚å®ƒåœ¨è®¾è®¡ä¸Šå…è®¸å¹¶å‘æ‰§è¡ŒèŠ‚ç‚¹ï¼Œä½†å¹¶å‘æ˜¯â€œå¯é€‰çš„æ‰§è¡Œç­–ç•¥â€ï¼Œç”±è¿è¡Œæ—¶ä¸èŠ‚ç‚¹ç±»å‹å†³å®šã€‚</p>
<ul>
<li>èŠ‚ç‚¹å¦‚æœæ˜¯ <code>async def</code>ï¼Œæ¡†æ¶å¯ä»¥ç”¨ <code>asyncio</code> æ‰§è¡Œï¼ˆåç¨‹ï¼‰ã€‚</li>
<li>ä½ ä¹Ÿå¯ä»¥åœ¨èŠ‚ç‚¹å†…éƒ¨è‡ªå·±ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆ<code>ThreadPoolExecutor</code>ï¼‰æˆ–å¤–éƒ¨å¹¶å‘èµ„æºã€‚</li>
</ul>
</li>
<li>
<p>ä¼˜ç‚¹ï¼šè®©çŠ¶æ€åˆå¹¶ä¸ç¡®å®šæ€§ç•™åœ¨æ¡†æ¶å±‚ï¼ˆé¿å… race conditionï¼‰ï¼Œå¹¶å‘äº¤ç»™å¯æ§çš„æ‰§è¡Œç­–ç•¥ï¼ˆç”¨æˆ·æ˜¾å¼å¼€å¯ï¼‰ã€‚</p>
</li>
<li>
<p>è®¾è®¡ç†ç”±ï¼š<strong>å¯é‡ç°æ€§ä¸ç¡®å®šæ€§</strong>ã€‚è‡ªåŠ¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥å†™å…¥é¡ºåºä¸ç¡®å®šï¼Œå½±å“ reducer è¡Œä¸ºä¸ snapshot ä¸€è‡´æ€§ã€‚</p>
</li>
</ul>
<p>ç®€è¨€ä¹‹ï¼š<strong>super-step ä¿è¯â€œä½•æ—¶åˆå¹¶â€ï¼Œå¹¶å‘å®ç°å†³å®šâ€œå¦‚ä½•å¹¶å‘æ‰§è¡ŒèŠ‚ç‚¹â€ã€‚</strong></p>
<hr/>
<h2 data-id="heading-7">8. å¸¸è§æ¨¡å¼ä¸ç¤ºä¾‹ï¼ˆå« Email Agent åœºæ™¯ï¼‰</h2>
<h3 data-id="heading-8">8.1 å¹¶è¡Œå†³ç­–ï¼ˆB å’Œ C åŒè½®æ‰§è¡Œï¼‰</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
START --&gt; A --&gt; B
A --&gt; C --&gt; END
</code></pre>
<p>æ‰§è¡Œï¼š</p>
<ul>
<li>step 1ï¼šæ‰§è¡Œ Aï¼Œåˆå¹¶ stateï¼Œcheckpoint</li>
<li>step 2ï¼šåŒæ—¶è¿è¡Œ B å’Œ Cï¼ˆåŒä¸€ super-stepï¼‰ï¼Œæ”¶é›†ä¸¤è€…å†™å…¥å¹¶åˆå¹¶ï¼Œcheckpoint</li>
</ul>
<h3 data-id="heading-9">8.2 Email Agent</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75c9dae04ea644ab9ca9dff9182a4c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUxMSU5BSQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033279&amp;x-signature=O0g8DHMtWcyRYzD1CG%2F9X%2FQOfXU%3D" alt="graph.png" loading="lazy"/></p>
<ul>
<li>åˆå§‹ï¼š<code>read_email</code> â†’ <code>classify_intent</code></li>
<li>è‹¥åˆ†ç±»ä¸º <code>billing</code> ä¸” <code>critical</code>ï¼šè·¯ç”±åˆ° <code>human_review</code>ï¼ˆinterruptï¼‰</li>
<li>human_review ä¼šè§¦å‘ interruptï¼ˆä¸­æ–­ï¼‰å¹¶ç”Ÿæˆ checkpointï¼›ç¬¬ä¸€æ¬¡ invoke è¿”å›ä¸­æ–­ payloadï¼ˆæ²¡æœ‰ <code>draft_response</code>ï¼‰ï¼Œç­‰å¾…å¤–éƒ¨ resumeï¼ˆäººå·¥å®¡æ ¸ï¼‰</li>
<li>å½“ resume æäº¤ï¼ˆ<code>app.invoke(resume)</code>ï¼‰æ—¶ï¼Œä»ä¸­æ–­ç‚¹ç»§ç»­æ‰§è¡Œï¼Œè¿›å…¥ä¸‹ä¸€è½® super-step å¹¶åˆå¹¶æ¥è‡ªäººå·¥è¾“å…¥çš„æ›´æ–°ï¼ˆä¾‹å¦‚å·²æ‰¹å‡†çš„ <code>draft_response</code>ï¼‰ï¼Œç„¶åå‘é€é‚®ä»¶ï¼ˆsend_replyï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-10">9. ä¼˜åŠ¿ã€æƒè¡¡ä¸é™åˆ¶</h2>
<h3 data-id="heading-11">ä¼˜åŠ¿</h3>
<ul>
<li><strong>ç¡®å®šæ€§</strong>ï¼šç›¸åŒè¾“å…¥å’Œç›¸åŒ reducer é…ç½®ï¼Œæ‰§è¡Œå¯é‡å¤ï¼ˆå¯¹äºè°ƒè¯•ä¸åˆè§„é‡è¦ï¼‰ã€‚</li>
<li><strong>å¹¶è¡Œè¡¨è¾¾åŠ›</strong>ï¼šå¯ä»¥åœ¨ä¸€è½®é‡Œå¹¶æ‰§è¡Œå¤šä¸ªé€»è¾‘ç‹¬ç«‹èŠ‚ç‚¹ã€‚</li>
<li><strong>å¼ºå¤§çš„æŒä¹…åŒ–</strong>ï¼šæ¯æ­¥ snapshot éƒ½å¯å›æ”¾ä¸æ¢å¤ï¼Œæ˜¯æ„å»ºé•¿æœŸä»»åŠ¡ä¸å¯¹è¯è®°å¿†çš„åŸºç¡€ã€‚</li>
<li><strong>æ¸…æ™°çš„åˆå¹¶è¯­ä¹‰</strong>ï¼šé€šè¿‡ Annotated æŒ‡å®š reducerï¼Œé¿å…ç«æ€å†™å…¥æ­§ä¹‰ã€‚</li>
</ul>
<h3 data-id="heading-12">æƒè¡¡ä¸é™åˆ¶</h3>
<ul>
<li><strong>å»¶è¿Ÿçš„å¯è§æ€§</strong>ï¼šèŠ‚ç‚¹å†™å…¥åœ¨æœ¬è½®ç»“æŸä¹‹å‰å¯¹å…¶ä»–èŠ‚ç‚¹ä¸å¯è§ï¼ˆè¿™æ—¢æ˜¯ç‰¹æ€§ä¹Ÿæ˜¯é™åˆ¶ï¼‰ã€‚æŸäº›ç´§è€¦åˆåœºæ™¯éœ€æ›´ç»†ç²’åº¦äº¤äº’ã€‚</li>
<li><strong>å¹¶å‘ä¸è‡ªåŠ¨åŒ–</strong>ï¼šéœ€è¦å·¥ç¨‹ä¸Šæ˜¾å¼é€‰æ‹© async/thread æ‰èƒ½å¹¶è¡Œï¼Œå¢åŠ ä½¿ç”¨å¤æ‚åº¦ã€‚</li>
<li><strong>è®¾è®¡æˆæœ¬</strong>ï¼šéœ€è¦ä¸ºçŠ¶æ€å­—æ®µè€ƒè™‘åˆå¹¶ç­–ç•¥ï¼ˆå“ªäº›å­—æ®µåº”ç´¯ç§¯ã€è¦†ç›–ã€æˆ–ç”¨è‡ªå®šä¹‰ reducerï¼‰ã€‚</li>
<li><strong>å¤æ‚ debug</strong>ï¼šå¤šè½® super-step ä¸ reducer è¡Œä¸ºç»“åˆæ—¶ï¼Œç†è§£å†å²æ¼”å˜éœ€è¦è¯»å– checkpointsï¼ˆå¥½å¤„æ˜¯å¯è¯»ï¼Œä½†éœ€è¦å·¥å…·ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-13">10. å®æˆ˜å»ºè®®ä¸è°ƒè¯•è¦ç‚¹</h2>
<ul>
<li><strong>ä¸ºæ¯ä¸ªçŠ¶æ€å­—æ®µæ˜ç¡® reducer</strong>ï¼ˆç”¨ <code>Annotated</code> æ ‡æ³¨ï¼‰ï¼Œæ¯”å¦‚åˆ—è¡¨ç”¨ <code>add</code>ï¼Œå­—å…¸å¯èƒ½ç”¨ <code>dict_merge</code>ï¼ŒæŸäº›å­—æ®µé‡‡ç”¨è¦†ç›–ç­–ç•¥ã€‚</li>
<li><strong>ä½¿ç”¨ thread_id ä¸ checkpoint æ°å½“åˆ†å‰²ä¼šè¯</strong>ï¼Œå¯¹è¯/ä»»åŠ¡ç”¨ç‹¬ç«‹çº¿ç¨‹ IDï¼Œä¾¿äºå¹¶è¡Œç”¨æˆ·éš”ç¦»ä¸å›æ”¾ã€‚</li>
<li><strong>åœ¨éœ€è¦å¹¶å‘èŠ‚ç‚¹æ—¶</strong>ï¼šä¼˜å…ˆä½¿ç”¨ async èŠ‚ç‚¹æˆ–æ˜¾å¼çº¿ç¨‹æ± ï¼›ä½†è¦ç¡®ä¿ reducer æ­£ç¡®ï¼Œé¿å…é¡ºåºä¾èµ–ã€‚</li>
<li><strong>æ£€æŸ¥ç‚¹ä¸ä¸­æ–­è°ƒè¯•</strong>ï¼šå½“å‡ºç° KeyErrorï¼ˆä¾‹å¦‚ <code>draft_response</code> ä¸å­˜åœ¨ï¼‰ï¼Œæ£€æŸ¥é¦–æ¬¡ invoke æ˜¯å¦åœåœ¨ interruptï¼ˆhuman_reviewï¼‰èŠ‚ç‚¹ â€”â€” å› ä¸º interrupt ä¼šæš‚åœæ‰§è¡Œä¸”ä¸ä¼šå†™å›æŸäº›å­—æ®µã€‚</li>
<li><strong>è®°å½• metadata</strong>ï¼šå¼€å¯æˆ–ä¸°å¯Œ snapshot çš„ metadataï¼ˆæ¯”å¦‚å“ªä¸ªèŠ‚ç‚¹å†™äº†å“ªä¸ªå­—æ®µï¼‰ï¼Œä¾¿äºæ—¥åæ’æŸ¥ã€‚</li>
<li><strong>é™åˆ¶ snapshot å†å²</strong>ï¼šåœ¨ç”Ÿäº§ç³»ç»Ÿä¸­éœ€è¦åˆé€‚ä¿ç•™ç­–ç•¥æˆ–å½’æ¡£æ—§ checkpointï¼Œé¿å…æ— é™è†¨èƒ€ã€‚</li>
<li><strong>åŠ å¯†/åˆè§„</strong>ï¼šæŒä¹…åŒ–å¯¹è¯æ•°æ®æ•æ„Ÿæ—¶ï¼Œç”¨ <code>EncryptedSerializer</code> å¹¶é€‰æ‹©å¯é åç«¯ï¼ˆPostgres + AES key ç®¡ç†ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-14">ç»“è¯­</h2>
<p>LangGraph çš„ <strong>super-step</strong> å¹¶éç®€å•çš„â€œæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªèŠ‚ç‚¹â€ï¼Œè€Œæ˜¯ä¸€ä¸ªæœ‰æ„è¯†çš„<strong>åˆ†é˜¶æ®µæ‰§è¡Œæ¨¡å‹</strong>ï¼šä¿è¯å¹¶è¡Œè¡¨è¾¾ã€çŠ¶æ€ä¸€è‡´æ€§ä¸å¯æ¢å¤æ€§çš„åŒæ—¶ï¼ŒæŠŠå¹¶å‘ç­–ç•¥ç•™ç»™å¼€å‘è€…æ˜¾å¼æŒæ§ã€‚æ­£æ˜¯è¿™ä¸ªè®¾è®¡ï¼Œä½¿ LangGraph åœ¨æ„å»ºå¤æ‚å·¥ä½œæµã€agent åä½œã€äººæœºä¸­æ–­ä¸é•¿æœŸè®°å¿†ç­‰åœºæ™¯æ—¶ï¼Œæ—¢çµæ´»åˆå¯æ§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å°ç™½Expresså…¥é—¨ï¼šåˆè¯†Webæ¡†æ¶ä¸é¡¹ç›®æ­å»º]]></title>    <link>https://juejin.cn/post/7573525634213560363</link>    <guid>https://juejin.cn/post/7573525634213560363</guid>    <pubDate>2025-11-18T01:16:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525634213560363" data-draft-id="7573535624533377043" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å°ç™½Expresså…¥é—¨ï¼šåˆè¯†Webæ¡†æ¶ä¸é¡¹ç›®æ­å»º"/> <meta itemprop="keywords" content="Node.js,Express,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-18T01:16:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§å‰ç«¯å†é™©è®°"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å°ç™½Expresså…¥é—¨ï¼šåˆè¯†Webæ¡†æ¶ä¸é¡¹ç›®æ­å»º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§å‰ç«¯å†é™©è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:16:27.000Z" title="Tue Nov 18 2025 01:16:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰ç«¯å°ç™½Expresså…¥é—¨ï¼šåˆè¯†Webæ¡†æ¶ä¸é¡¹ç›®æ­å»º</h2>
<h3 data-id="heading-1">å‰è¨€ï¼šå‰ç«¯ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ Expressï¼Ÿ</h3>
<p>åœ¨å¼€å§‹å­¦ä¹ Expressä¹‹å‰ï¼Œå¾ˆå¤šå‰ç«¯åŒå­¦å¯èƒ½ä¼šé—®ï¼šæˆ‘å·²ç»ä¼šReact/Vueäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å­¦ä¹ åç«¯æ¡†æ¶ï¼Ÿå‰ç«¯å·¥ç¨‹å¸ˆä¸æ˜¯åº”è¯¥ä¸“æ³¨äºç•Œé¢å’Œç”¨æˆ·ä½“éªŒå—ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆåœ¨äºï¼šç°ä»£å‰ç«¯å¼€å‘å·²ç»è¿œè¿œè¶…è¶Šäº†"åˆ‡å›¾å†™ç•Œé¢"çš„èŒƒç•´ã€‚å…¨æ ˆèƒ½åŠ›æ­£åœ¨æˆä¸ºå‰ç«¯å·¥ç¨‹å¸ˆçš„æ ¸å¿ƒç«äº‰åŠ›ï¼Œè€ŒExpressæ˜¯ç†è§£Webå¼€å‘å…¨è²Œçš„æœ€ä½³å…¥å£ã€‚</strong></p>
<h3 data-id="heading-2">ä¸€ã€åŸç”ŸHTTPæ¨¡å— vs Expressï¼šç›´è§‚å¯¹æ¯”</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ„Ÿå—ä¸¤è€…çš„åŒºåˆ«ã€‚</p>
<h4 data-id="heading-3">1.1 ä½¿ç”¨Node.jsåŸç”ŸHTTPæ¨¡å—åˆ›å»ºæœåŠ¡å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-comment">// åˆ›å»ºHTTPæœåŠ¡å™¨</span>
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// æ‰‹åŠ¨è§£æURLå’Œè¯·æ±‚æ–¹æ³•</span>
  <span class="hljs-keyword">const</span> { url, method } = req;
  
  <span class="hljs-comment">// ç®€å•çš„è·¯ç”±åˆ¤æ–­</span>
  <span class="hljs-keyword">if</span> (url === <span class="hljs-string">'/'</span> &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;æ¬¢è¿æ¥åˆ°é¦–é¡µ&lt;/h1&gt;'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (url === <span class="hljs-string">'/api/users'</span> &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">users</span>: [<span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-string">'æå››'</span>] }));
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;é¡µé¢æœªæ‰¾åˆ°&lt;/h1&gt;'</span>);
  }
});

<span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span>
server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000'</span>);
});
</code></pre>
<p><strong>ç—›ç‚¹åˆ†æï¼š</strong></p>
<ul>
<li>éœ€è¦æ‰‹åŠ¨è§£æURLå’Œè¯·æ±‚æ–¹æ³•</li>
<li>è·¯ç”±å¤„ç†å˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤</li>
<li>ç¼ºå°‘ä¸­é—´ä»¶ç­‰é«˜çº§åŠŸèƒ½</li>
<li>ä»£ç ç»„ç»‡ä¸å¤Ÿç›´è§‚</li>
</ul>
<h4 data-id="heading-4">1.2 ä½¿ç”¨Expresså®ç°ç›¸åŒåŠŸèƒ½</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;

<span class="hljs-comment">// è·¯ç”±å¤„ç†å˜å¾—æå…¶ç®€å•</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'&lt;h1&gt;æ¬¢è¿æ¥åˆ°é¦–é¡µ&lt;/h1&gt;'</span>);
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">users</span>: [<span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-string">'æå››'</span>] });
});

<span class="hljs-comment">// 404å¤„ç†</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'&lt;h1&gt;é¡µé¢æœªæ‰¾åˆ°&lt;/h1&gt;'</span>);
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ExpressæœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<p><strong>Expressä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ç®€æ´çš„è·¯ç”±å®šä¹‰</li>
<li>å†…ç½®çš„å“åº”æ–¹æ³•ï¼ˆ<code>send</code>, <code>json</code>ç­‰ï¼‰</li>
<li>æ¸…æ™°çš„é”™è¯¯å¤„ç†</li>
<li>æ˜“äºæ‰©å±•çš„ä¸­é—´ä»¶ä½“ç³»</li>
</ul>
<h3 data-id="heading-5">äºŒã€å¿«é€Ÿåˆ›å»ºExpressé¡¹ç›®</h3>
<h4 data-id="heading-6">2.1 ç¯å¢ƒå‡†å¤‡</h4>
<p>é¦–å…ˆç¡®ä¿ä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…Node.jsï¼ˆå»ºè®®ç‰ˆæœ¬14+ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node --version  <span class="hljs-comment"># æ£€æŸ¥Node.jsç‰ˆæœ¬</span>
npm --version   <span class="hljs-comment"># æ£€æŸ¥npmç‰ˆæœ¬</span>
</code></pre>
<h4 data-id="heading-7">2.2 åˆå§‹åŒ–é¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®ç›®å½•</span>
<span class="hljs-built_in">mkdir</span> my-express-app
<span class="hljs-built_in">cd</span> my-express-app

<span class="hljs-comment"># åˆå§‹åŒ–package.json</span>
npm init -y

<span class="hljs-comment"># å®‰è£…Express</span>
npm install express
</code></pre>
<h4 data-id="heading-8">2.3 é¡¹ç›®ç»“æ„è§„åˆ’</h4>
<p>å»ºè®®é‡‡ç”¨æ¸…æ™°çš„é¡¹ç›®ç»“æ„ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">my-express-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js          <span class="hljs-meta"># Expressåº”ç”¨å®ä¾‹</span>
â”‚   â”œâ”€â”€ routes/         <span class="hljs-meta"># è·¯ç”±æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ middleware/     <span class="hljs-meta"># è‡ªå®šä¹‰ä¸­é—´ä»¶</span>
â”‚   â””â”€â”€ <span class="hljs-keyword">public</span>/         <span class="hljs-meta"># é™æ€èµ„æº</span>
â”œâ”€â”€ package.json
â””â”€â”€ README.md
</code></pre>
<h4 data-id="heading-9">2.4 ä½¿ç”¨Expressåº”ç”¨ç”Ÿæˆå™¨ï¼ˆè„šæ‰‹æ¶ï¼‰</h4>
<p>å¯¹äºæ›´å¤æ‚çš„é¡¹ç›®ï¼Œæ¨èä½¿ç”¨å®˜æ–¹ç”Ÿæˆå™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å…¨å±€å®‰è£…express-generator</span>
npm install -g express-generator

<span class="hljs-comment"># åˆ›å»ºé¡¹ç›®</span>
express --view=ejs my-advanced-app

<span class="hljs-comment"># å®‰è£…ä¾èµ–</span>
<span class="hljs-built_in">cd</span> my-advanced-app
npm install

<span class="hljs-comment"># å¯åŠ¨é¡¹ç›®</span>
npm start
</code></pre>
<p>ç”Ÿæˆçš„é¡¹ç›®ç»“æ„æ›´åŠ å®Œæ•´ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">my-advanced-app/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ www            <span class="hljs-meta"># æœåŠ¡å™¨å¯åŠ¨æ–‡ä»¶</span>
â”œâ”€â”€ <span class="hljs-keyword">public</span>/            <span class="hljs-meta"># é™æ€èµ„æº</span>
â”œâ”€â”€ routes/            <span class="hljs-meta"># è·¯ç”±æ–‡ä»¶</span>
â”œâ”€â”€ views/             <span class="hljs-meta"># æ¨¡æ¿æ–‡ä»¶</span>
â”œâ”€â”€ app.js             <span class="hljs-meta"># ä¸»åº”ç”¨æ–‡ä»¶</span>
â””â”€â”€ package.json
</code></pre>
<h3 data-id="heading-10">ä¸‰ã€ä¸­é—´ä»¶æ¦‚å¿µåˆæ¢ï¼šExpressçš„æ ¸å¿ƒçµé­‚</h3>
<h4 data-id="heading-11">3.1 ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ï¼Ÿ</h4>
<p><strong>ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰</strong> æ˜¯Expressä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ª<strong>å¤„ç†æµæ°´çº¿</strong>ï¼Œæ¯ä¸ªä¸­é—´ä»¶å°±åƒæ˜¯æµæ°´çº¿ä¸Šçš„ä¸€ä¸ªå·¥ä½œç«™ï¼Œå¯¹è¯·æ±‚è¿›è¡ŒåŠ å·¥å¤„ç†ã€‚</p>
<h4 data-id="heading-12">3.2 ä¸­é—´ä»¶çš„åŸºæœ¬ç»“æ„</h4>
<p>æ¯ä¸ªä¸­é—´ä»¶å‡½æ•°éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-comment">// å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);
  
  <span class="hljs-comment">// è°ƒç”¨next()å°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
  <span class="hljs-title function_">next</span>();
}
</code></pre>
<h4 data-id="heading-13">3.3 å®é™…åº”ç”¨ç¤ºä¾‹</h4>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹æ¥ç†è§£ä¸­é—´ä»¶çš„å·¥ä½œæµç¨‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// 1. æ—¥å¿—è®°å½•ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${timestamp}</span>] <span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);
  <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// å¿…é¡»è°ƒç”¨next()ï¼</span>
});

<span class="hljs-comment">// 2. é™æ€æ–‡ä»¶æœåŠ¡ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">'public'</span>));

<span class="hljs-comment">// 3.  bodyè§£æä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>()); <span class="hljs-comment">// è§£æJSONæ ¼å¼çš„è¯·æ±‚ä½“</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> })); <span class="hljs-comment">// è§£æè¡¨å•æ•°æ®</span>

<span class="hljs-comment">// 4. è‡ªå®šä¹‰è®¤è¯ä¸­é—´ä»¶ï¼ˆæ¨¡æ‹Ÿï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api'</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// æ£€æŸ¥APIè¯·æ±‚çš„è®¤è¯ä¿¡æ¯</span>
  <span class="hljs-keyword">const</span> token = req.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>;
  
  <span class="hljs-keyword">if</span> (!token) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'æœªæä¾›è®¤è¯ä»¤ç‰Œ'</span> });
  }
  
  <span class="hljs-comment">// æ¨¡æ‹ŸtokenéªŒè¯</span>
  <span class="hljs-keyword">if</span> (token !== <span class="hljs-string">'Bearer valid-token'</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'è®¤è¯å¤±è´¥'</span> });
  }
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¤è¯é€šè¿‡'</span>);
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-comment">// 5. ä¸šåŠ¡è·¯ç”±</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'æ¬¢è¿æ¥åˆ°é¦–é¡µï¼'</span>);
});

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/data'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¥æ”¶åˆ°çš„æ•°æ®:'</span>, req.<span class="hljs-property">body</span>);
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'æ•°æ®æ¥æ”¶æˆåŠŸ'</span>, <span class="hljs-attr">data</span>: req.<span class="hljs-property">body</span> });
});

<span class="hljs-comment">// 6. 404å¤„ç†ä¸­é—´ä»¶ï¼ˆæ”¾åœ¨æœ€åï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'é¡µé¢æœªæ‰¾åˆ°'</span>);
});

<span class="hljs-comment">// 7. é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼ˆå››ä¸ªå‚æ•°ï¼‰</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‘ç”Ÿé”™è¯¯:'</span>, err);
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'</span> });
});

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<h4 data-id="heading-14">3.4 ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº</h4>
<p>ç†è§£ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºè‡³å…³é‡è¦ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¯·æ±‚è¿›å…¥
    â†“
æ—¥å¿—ä¸­é—´ä»¶ï¼ˆè®°å½•è¯·æ±‚ä¿¡æ¯ï¼‰
    â†“
é™æ€æ–‡ä»¶ä¸­é—´ä»¶ï¼ˆå¦‚æœæ˜¯é™æ€æ–‡ä»¶è¯·æ±‚ï¼Œç›´æ¥è¿”å›ï¼‰
    â†“
<span class="hljs-selector-tag">Body</span>è§£æä¸­é—´ä»¶ï¼ˆè§£æè¯·æ±‚ä½“æ•°æ®ï¼‰
    â†“
è®¤è¯ä¸­é—´ä»¶ï¼ˆæ£€æŸ¥APIè®¤è¯ï¼‰
    â†“
è·¯ç”±å¤„ç†ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
    â†“
<span class="hljs-number">404</span>å¤„ç†ï¼ˆå¦‚æœæ²¡æœ‰åŒ¹é…çš„è·¯ç”±ï¼‰
    â†“
é”™è¯¯å¤„ç†ï¼ˆå¦‚æœå‘ç”Ÿé”™è¯¯ï¼‰
</code></pre>
<h3 data-id="heading-15">å››ã€æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±</h3>
<h4 data-id="heading-16">4.1 é¡¹ç›®åˆå§‹åŒ–æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json å»ºè®®é…ç½®</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-express-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Expresså®æˆ˜é¡¹ç›®"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/app.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node src/app.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nodemon src/app.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"jest"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"express"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"nodejs"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä½ çš„åå­—"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-17">4.2 å¸¸è§é™·é˜±åŠè§£å†³æ–¹æ¡ˆ</h4>
<p><strong>é™·é˜±1ï¼šå¿˜è®°è°ƒç”¨next()</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿™ä¸ªä¸­é—´ä»¶ä¼šé˜»å¡æ•´ä¸ªåº”ç”¨ï¼'</span>);
  <span class="hljs-comment">// å¿˜è®°è°ƒç”¨next()ï¼Œè¯·æ±‚ä¼šä¸€ç›´æŒ‚èµ·</span>
});

<span class="hljs-comment">// æ­£ç¡®åšæ³•</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ­£ç¡®å¤„ç†è¯·æ±‚'</span>);
  <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// å¿…é¡»è°ƒç”¨ï¼</span>
});
</code></pre>
<p><strong>é™·é˜±2ï¼šä¸­é—´ä»¶é¡ºåºé”™è¯¯</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯é¡ºåº - 404å¤„ç†æ”¾åœ¨å‰é¢</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'é¡µé¢æœªæ‰¾åˆ°'</span>);
});

<span class="hljs-comment">// åé¢çš„è·¯ç”±æ°¸è¿œä¸ä¼šæ‰§è¡Œ</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'è¿™ä¸ªé¡µé¢æ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°'</span>);
});

<span class="hljs-comment">// æ­£ç¡®é¡ºåº</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'é¦–é¡µ'</span>);
});

app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {  <span class="hljs-comment">// 404å¤„ç†æ”¾åœ¨æœ€å</span>
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'é¡µé¢æœªæ‰¾åˆ°'</span>);
});
</code></pre>
<h3 data-id="heading-18">äº”ã€å®æˆ˜ç»ƒä¹ </h3>
<p>ä¸ºäº†å·©å›ºç†è§£ï¼Œè¯·å°è¯•å®Œæˆä»¥ä¸‹ç»ƒä¹ ï¼š</p>
<ol>
<li>
<p><strong>åˆ›å»ºä¸€ä¸ªExpressæœåŠ¡å™¨</strong>ï¼Œå®ç°ä»¥ä¸‹è·¯ç”±ï¼š</p>
<ul>
<li><code>GET /</code>ï¼šè¿”å›"é¦–é¡µæ¬¢è¿è¯­"</li>
<li><code>GET /about</code>ï¼šè¿”å›"å…³äºæˆ‘ä»¬"</li>
<li><code>POST /contact</code>ï¼šæ¥æ”¶å¹¶è¿”å›è”ç³»äººä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>æ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶</strong>ï¼š</p>
<ul>
<li>è¯·æ±‚æ—¥å¿—è®°å½•</li>
<li>APIè¯·æ±‚æ—¶é—´è®¡ç®—</li>
<li>ç®€å•çš„è¯·æ±‚é¢‘ç‡é™åˆ¶</li>
</ul>
</li>
<li>
<p><strong>ç»„ç»‡é¡¹ç›®ç»“æ„</strong>ï¼š</p>
<ul>
<li>å°†è·¯ç”±åˆ†ç¦»åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­</li>
<li>åˆ›å»ºè‡ªå®šä¹‰ä¸­é—´ä»¶ç›®å½•</li>
</ul>
</li>
</ol>
<h3 data-id="heading-19">æ€»ç»“</h3>
<p>é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†ï¼š</p>
<ul>
<li>âœ… Expressç›¸å¯¹äºåŸç”ŸHTTPæ¨¡å—çš„ä¼˜åŠ¿</li>
<li>âœ… å¦‚ä½•ä»é›¶æ­å»ºExpressé¡¹ç›®</li>
<li>âœ… ä¸­é—´ä»¶çš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†</li>
<li>âœ… åˆç†çš„é¡¹ç›®ç»“æ„è§„åˆ’</li>
<li>âœ… å¸¸è§çš„é™·é˜±å’Œæœ€ä½³å®è·µ</li>
</ul>
<p><strong>Expressçš„ç²¾é«“åœ¨äº"çº¦å®šä¼˜äºé…ç½®"</strong> - å®ƒæä¾›äº†ä¸€å¥—ä¼˜é›…çš„çº¦å®šï¼Œè®©Webå¼€å‘å˜å¾—æ›´åŠ æ„‰å¿«å’Œé«˜æ•ˆã€‚</p>
<p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨<strong>Expressçš„è·¯ç”±ç³»ç»Ÿ</strong>ï¼Œå­¦ä¹ å¦‚ä½•æ„å»ºå¤æ‚çš„APIæ¥å£å’ŒRESTfulæœåŠ¡ã€‚</p>
<hr/>
<p><strong>åŠ¨æ‰‹æ—¶é—´</strong>ï¼šæŒ‰ç…§æ–‡ä¸­çš„ç¤ºä¾‹ä»£ç ï¼Œäº²æ‰‹æ­å»ºä½ çš„ç¬¬ä¸€ä¸ªExpressåº”ç”¨ã€‚é‡åˆ°é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼</p>
<p><em>æç¤ºï¼šè®°å¾—å®‰è£…nodemonç”¨äºå¼€å‘æ—¶çš„è‡ªåŠ¨é‡å¯ï¼š<code>npm install -D nodemon</code></em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ™ºèƒ½ä½“ä¸å°æ¨¡å‹ï¼šAIè¿ˆå‘å¹³æ°‘åŒ–çš„æ–°æµªæ½®]]></title>    <link>https://juejin.cn/post/7573528564027080750</link>    <guid>https://juejin.cn/post/7573528564027080750</guid>    <pubDate>2025-11-18T01:20:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573528564027080750" data-draft-id="7573528564026834990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ™ºèƒ½ä½“ä¸å°æ¨¡å‹ï¼šAIè¿ˆå‘å¹³æ°‘åŒ–çš„æ–°æµªæ½®"/> <meta itemprop="keywords" content="ç®—æ³•,è®¡ç®—æœºè§†è§‰,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-11-18T01:20:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ™ºèƒ½ä½“ä¸å°æ¨¡å‹ï¼šAIè¿ˆå‘å¹³æ°‘åŒ–çš„æ–°æµªæ½®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:20:35.000Z" title="Tue Nov 18 2025 01:20:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ•°ç™¾äº¿å‚æ•°ã€åºå¤§ç®—åŠ›éœ€æ±‚ã€æ˜‚è´µçš„éƒ¨ç½²æˆæœ¬â€¦â€¦å½“ç§‘æŠ€å·¨å¤´ä»¬è¿˜åœ¨è¿½æ±‚â€œæ›´å¤§æ›´å¼ºâ€çš„AIæ¨¡å‹æ—¶ï¼Œä¸€è‚¡åå‘è€Œè¡Œçš„è¶‹åŠ¿æ­£æ‚„ç„¶å…´èµ·ï¼Œå¹¶å¯èƒ½å½»åº•æ”¹å˜äººå·¥æ™ºèƒ½çš„åº”ç”¨æ ¼å±€ã€‚</p>
<p>è¿‡å»ä¸€å¹´ï¼ŒAIæ™ºèƒ½ä½“ï¼ˆAI Agentï¼‰çƒ­åº¦æ€¥å‰§æ”€å‡ï¼Œæˆä¸ºäººå·¥æ™ºèƒ½é¢†åŸŸæœ€å—å…³æ³¨çš„è¯é¢˜ä¹‹ä¸€ã€‚ä»ç§‘æŠ€å·¨å¤´åˆ°åˆåˆ›ä¼ä¸šï¼Œçº·çº·åŠ å…¥è¿™åœºæ™ºèƒ½ä½“ç«èµ›ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨è¿™æ³¢æ™ºèƒ½ä½“æµªæ½®èƒŒåï¼Œä¸€ä¸ªå…³é”®è½¬å˜æ­£åœ¨å‘ç”Ÿï¼šå°è€Œä¸“çš„æ¨¡å‹æ­£å–ä»£åºå¤§è€Œå…¨çš„æ¨¡å‹ï¼Œæˆä¸ºæ¨åŠ¨æ™ºèƒ½ä½“æ™®åŠçš„æ ¸å¿ƒåŠ›é‡ã€‚</p>
<h2 data-id="heading-0"><strong>æ™ºèƒ½ä½“çƒ­æ½®</strong></h2>
<p>2025å¹´è¢«ä¸šç•Œå¹¿æ³›ç§°ä¸º <strong>â€œAI Agentå…ƒå¹´â€</strong> ã€‚ä»Šå¹´ä¸ŠåŠå¹´ï¼Œéšç€OpenAIç›¸ç»§å‘å¸ƒOperatorï¼ˆæ‰§è¡Œç®€å•ä»»åŠ¡çš„Agentï¼‰ä¸Deep Researchï¼ˆè¿›è¡Œæ·±åº¦ç ”ç©¶çš„Agentï¼‰ï¼ŒAIæ™ºèƒ½ä½“é¢†åŸŸçš„ç«äº‰éª¤ç„¶åŠ å‰§ã€‚</p>
<p>æ™ºèƒ½ä½“ä¸æ—©æœŸAIåº”ç”¨æœ‰ç€æ ¹æœ¬åŒºåˆ«ã€‚</p>
<p>AIåº”ç”¨ç»å†äº†ä»æç¤ºè¯åˆ°å·¥ä½œæµï¼Œå†åˆ°æ™ºèƒ½ä½“çš„ä¸‰ä¸ªå‘å±•é˜¶æ®µã€‚æœ€åˆçš„æç¤ºè¯é˜¶æ®µï¼Œç”¨æˆ·é€šè¿‡å¯¹è¯ä¸å¤§æ¨¡å‹äº¤äº’ï¼›å·¥ä½œæµé˜¶æ®µåˆ™é€šè¿‡é¢„è®¾çš„èŠ‚ç‚¹ä¸è·¯å¾„å¤šæ­¥éª¤å®Œæˆä»»åŠ¡ã€‚</p>
<p>è€Œæ™ºèƒ½ä½“æ˜¯â€œèƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€è‡ªä¸»å†³ç­–ã€æ‰§è¡Œä»»åŠ¡å¹¶è¾¾æˆç›®æ ‡çš„æ™ºèƒ½ç³»ç»Ÿâ€ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºæ„ŸçŸ¥ç¯å¢ƒã€è‡ªä¸»å†³ç­–åŠå·¥å…·ä½¿ç”¨èƒ½åŠ›ã€‚</p>
<p>ç§‘æŠ€å·¨å¤´çº·çº·æŠ¼æ³¨æ™ºèƒ½ä½“èµ›é“ï¼šGoogleé¢„è®¡å‘å¸ƒèƒ½å¤Ÿæ“ä½œæµè§ˆå™¨å’Œå…¶ä»–è½¯ä»¶çš„Project Marinerï¼Œç™¾åº¦æ¨å‡ºâ€œå¿ƒå“â€APPï¼Œé˜¿é‡Œçš„â€œå¿ƒæµâ€é¡¹ç›®åˆ™æ·±å…¥æ¢ç´¢Agentçš„äººæœºååŒæ•ˆç‡ã€‚</p>
<h2 data-id="heading-1"><strong>å°æ¨¡å‹å´›èµ·ï¼šAIå¹³æ°‘åŒ–çš„å…³é”®æ¨åŠ›</strong></h2>
<p>å½“ä¼—å¤šä¼ä¸šè¿˜åœ¨è¿½é€æ›´å¤§å‚æ•°ã€æ›´å¼ºèƒ½åŠ›çš„å¤§æ¨¡å‹æ—¶ï¼Œå°æ¨¡å‹æ­£ä»¥æƒŠäººçš„é€Ÿåº¦å¡«è¡¥ç€å¤§æ¨¡å‹æ— æ³•è¦†ç›–çš„å¸‚åœºç©ºç™½ã€‚</p>
<p>æ®è‹±ä¼Ÿè¾¾çªç ´æ€§ç ”ç©¶æ˜¾ç¤ºï¼Œ40%è‡³70%çš„ä¼ä¸šçº§AIä»»åŠ¡å¯ä»¥é€šè¿‡å°å‹è¯­è¨€æ¨¡å‹æ›´é«˜æ•ˆåœ°å¤„ç†â€”â€”è¿™äº›å‚æ•°å°‘äº100äº¿çš„æ¨¡å‹é€Ÿåº¦æ¯”å·¨å‹æ¨¡å‹<strong>å¿«10å€</strong>ï¼Œéƒ¨ç½²å’Œç»´æŠ¤æˆæœ¬é™ä½<strong>5-20å€</strong>ã€‚</p>
<p>å°æ¨¡å‹ä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºå®ƒä»¬è§£å†³äº†å¤§æ¨¡å‹åœ¨å®é™…éƒ¨ç½²ä¸­çš„æ ¹æœ¬ç—›ç‚¹ï¼š<strong>åºå¤§çš„è®¡ç®—éœ€æ±‚ã€é«˜æ˜‚çš„æ¨ç†æˆæœ¬ä»¥åŠå¯¹ç¡¬ä»¶çš„è‹›åˆ»è¦æ±‚ã€‚</strong></p>
<p align="center">**<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdefc2041c594bf684d965832fdc6e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=KlosFRICae%2Fbj2JvXSmGrWR6Q3w%3D" alt="v2_3ba9d2b90a5b44af957964942c6dfb05@000000_oswg1382235oswg1000oswg1000_img_000.jpg" loading="lazy"/>**</p>
<p>åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ï¼Œå¦‚æ™ºèƒ½æ‰‹æœºã€å·¥å‚è½¦é—´ã€åŒ»ç–—ä»ªå™¨ç­‰è¾¹ç¼˜è®¾å¤‡ï¼Œå°æ¨¡å‹å‡ ä¹æ˜¯å”¯ä¸€å¯è¡Œçš„é€‰æ‹©ã€‚</p>
<p>åƒCoovallyè¿™æ ·çš„AIå¼€å‘å¹³å°ï¼Œè¿›ä¸€æ­¥é™ä½äº†å°æ¨¡å‹çš„åº”ç”¨é—¨æ§›ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/271e0a80230a4f0086f8821fba9dba21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=qtnr4KLjooR1%2BT5QUoQRWbh9q3E%3D" alt="Coovallyæ“ä½œåŠ¨å›¾.gif" loading="lazy"/></p>
<p>å®ƒæä¾›ä»æ•°æ®é¢„å¤„ç†ã€æ™ºèƒ½æ ‡æ³¨åˆ°æ¨¡å‹è®­ç»ƒå’Œéƒ¨ç½²çš„ä¸€ç«™å¼æœåŠ¡ï¼Œä½¿å¼€å‘è€…æ— éœ€æ·±åšçš„ä¸“ä¸šçŸ¥è¯†ä¹Ÿèƒ½å¿«é€Ÿæ„å»ºå’Œéƒ¨ç½²AIæ¨¡å‹ã€‚è¿™ç§å¹³æ°‘åŒ–å·¥å…·çš„å‡ºç°ï¼Œæ­£è®©å°æ¨¡å‹ä»ç ”ç©¶æœºæ„çš„å®éªŒå®¤èµ°å‘åƒè¡Œç™¾ä¸šçš„å®é™…åº”ç”¨ã€‚</p>
<h2 data-id="heading-2"><strong>è§†è§‰å°æ¨¡å‹ï¼šæ™ºèƒ½ä½“çš„â€œæ…§çœ¼â€</strong></h2>
<p>åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸï¼Œå°æ¨¡å‹åŒæ ·å±•ç°å‡ºä»¤äººæƒŠå¹çš„è¡¨ç°ã€‚</p>
<p>IDEAè®¡ç®—æœºè§†è§‰ä¸æœºå™¨äººç ”ç©¶ä¸­å¿ƒå‘å¸ƒçš„<strong>Rex-Omni</strong>æ˜¯ä¸€æ¬¾ä»…30äº¿å‚æ•°çš„å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼Œå®ƒæå‡äº†æ¨¡å‹å¯¹å¤æ‚è¯­ä¹‰å’Œç©ºé—´å…³ç³»çš„ç†è§£æ°´å¹³ï¼Œä½¿ç›®æ ‡æ£€æµ‹èƒ½åŠ›å®ç°è·ƒè¿›ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44e05eade6d64a20bd87de69bd680db5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=h04QWrrjWEJpSzHM4QLeJgd2JuU%3D" alt="rex-Demo-gif.gif" loading="lazy"/></p>
<p>Rex-Omniå°†æ‰€æœ‰è§†è§‰æ„ŸçŸ¥ä»»åŠ¡ç»Ÿä¸€åˆ°â€œåæ ‡é¢„æµ‹æ¡†æ¶â€ä¸‹ï¼Œå³æ¯ä¸ªä»»åŠ¡å‡è¢«æ„å»ºä¸ºâ€œç”Ÿæˆåæ ‡åºåˆ—â€ï¼Œé€šè¿‡åˆ›æ–°çš„ä»»åŠ¡æ„å»ºã€æ•°æ®å¼•æ“å’Œè®­ç»ƒæµç¨‹ï¼Œè§£å†³äº†ç°æœ‰å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹â€œè¯­è¨€å¼ºä½†å®šä½å¼±â€çš„ç—›ç‚¹ã€‚</p>
<p>åŒæ ·ï¼Œå°çº¢ä¹¦å›¢é˜Ÿæ¨å‡ºçš„<strong>DeepEyesV2</strong>å¤šæ¨¡æ€AIæ¨¡å‹é€šè¿‡æ™ºèƒ½åˆ©ç”¨å¤–éƒ¨å·¥å…·ï¼Œåœ¨å¤šé¡¹ä»»åŠ¡ä¸­è¶…è¶Šäº†æ›´å¤§å‹çš„æ¨¡å‹ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29df23b478f64a9596a7208fa1bbbddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=aqi2MIzITgZdNhzgiblUlOgxeLM%3D" alt="screenshot_2025-11-17_16-20-06.png" loading="lazy"/></p>
<p>è¯¥æ¨¡å‹èƒ½ç»„åˆä½¿ç”¨ä»£ç æ‰§è¡Œã€å›¾åƒæœç´¢å’Œæ–‡æœ¬æœç´¢ä¸‰ç±»å·¥å…·ï¼ŒæŠŠå›¾åƒæ“ä½œã€Pythonæ‰§è¡Œå’Œå›¾åƒ/æ–‡æœ¬æœç´¢æ•´åˆèµ·æ¥ï¼Œçµæ´»åº”å¯¹å„ç§æŸ¥è¯¢ã€‚</p>
<h2 data-id="heading-3"><strong>å°æ¨¡å‹é€†è¢­çš„å…³é”®</strong></h2>
<p>å°æ¨¡å‹ä¹‹æ‰€ä»¥èƒ½åœ¨æ™ºèƒ½ä½“ä¸­å‘æŒ¥é‡è¦ä½œç”¨ï¼Œå…³é”®åœ¨äº<strong>å·¥å…·ä½¿ç”¨èƒ½åŠ›</strong>çš„çªç ´ã€‚</p>
<p>2025å¹´ï¼ŒAgentçš„æ ¸å¿ƒå˜åŒ–åœ¨äºTool Useèƒ½åŠ›å–å¾—äº†å®è´¨æ€§è¿›å±•ã€‚ä»ç¼–ç¨‹åˆ°browser-useï¼ˆAgentæ¨¡æ‹Ÿç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­çš„æ“ä½œï¼‰ï¼Œå†åˆ°computer-useï¼ˆAgentæ“æ§è®¡ç®—æœºç³»ç»Ÿï¼‰ï¼ŒAgentçš„å·¥å…·ä½¿ç”¨èƒ½åŠ›å¾—åˆ°æ˜¾è‘—å¢å¼ºã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e05e46503884e75b569d358b7282dd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=Zk2d2Jrdk6JNv0A1RyAOB%2FWSIpw%3D" alt="v2_43ea98184f7041b7a23f0318f6303793@000000_oswg980865oswg1000oswg1000_img_000.jpg" loading="lazy"/></p>
<p>DeepEyesV2çš„ç ”ç©¶å›¢é˜Ÿå‘ç°ï¼Œä»…é å¼ºåŒ–å­¦ä¹ ï¼Œæ¨¡å‹æ— æ³•ç¨³å®šåœ°ç”¨å·¥å…·å®Œæˆå¤šæ¨¡æ€ä»»åŠ¡ã€‚ä»–ä»¬å¼€å‘å‡º<strong>ä¸¤é˜¶æ®µçš„è®­ç»ƒæµç¨‹</strong>ï¼šç¬¬ä¸€é˜¶æ®µå­¦ä¹ æŠŠå›¾åƒç†è§£å’Œå·¥å…·ä½¿ç”¨ç»“åˆèµ·æ¥ï¼›ç¬¬äºŒé˜¶æ®µå†ç”¨å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è¿™äº›è¡Œä¸ºã€‚</p>
<p>å·¥å…·ä½¿ç”¨èƒ½åŠ›çš„æå‡ï¼Œä½¿å°æ¨¡å‹èƒ½å¤Ÿçªç ´å‚æ•°é™åˆ¶ï¼Œåˆ©ç”¨å¤–éƒ¨èµ„æºæ‰©å±•è‡ªèº«èƒ½åŠ›ã€‚è¿™ç±»ä¼¼äºä¸€ä¸ªäººå­¦ä¼šä½¿ç”¨å›¾ä¹¦é¦†ï¼Œä¸å¿…è®°å¿†æ‰€æœ‰çŸ¥è¯†ï¼Œå´èƒ½åœ¨éœ€è¦æ—¶è·å–æ‰€éœ€ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-4"><strong>ä¸ºä½•å°æ¨¡å‹æ›´é€‚åˆæ™ºèƒ½ä½“</strong></h2>
<p>ä¸å°æ¨¡å‹ç›¸æ¯”ï¼Œå¤§å‹æ¨¡å‹åœ¨éƒ¨ç½²ä¸Šé¢ä¸´é‡é‡å›°éš¾ã€‚ä¼ ç»Ÿé—­æºAIè§£å†³æ–¹æ¡ˆéƒ¨ç½²æˆæœ¬é€šå¸¸åœ¨<strong>50ä¸‡åˆ°æ•°ç™¾ä¸‡äººæ°‘å¸</strong>ï¼Œè€Œé€šè¿‡å¼€æºç¤¾åŒºæ”¯æŒï¼Œä¸­å°ä¼ä¸šä»…éœ€20-50ä¸‡å…ƒå³å¯å®Œæˆå°æ¨¡å‹éƒ¨ç½²ã€‚</p>
<p>ç§æœ‰åŒ–éƒ¨ç½²è™½ç„¶è§£å†³äº†æ•°æ®å®‰å…¨ä¸å®šåˆ¶åŒ–éœ€æ±‚ï¼Œå´å¸¦æ¥äº†ä¸€ç³»åˆ—æ–°é—®é¢˜ï¼šå¸‚åœºç¢ç‰‡åŒ–ã€èµ„æºé‡å¤æŠ•å…¥ã€è®¡ç®—èµ„æºåˆ©ç”¨ç‡ä½ã€‚</p>
<p>æ€ç€šäº§ä¸šç ”ç©¶é™¢æ•°æ®æ˜¾ç¤ºï¼Œè¿‘60%ä¼ä¸šé€‰æ‹©åœ¨æœ¬åœ°æ•°æ®ä¸­å¿ƒæˆ–ç§æœ‰äº‘å’Œè¾¹ç¼˜ä½ç½®éƒ¨ç½²AIæ¨ç†æ¨¡å‹ï¼Œæ˜¾ç¤ºå‡ºå¯¹ç§æœ‰éƒ¨ç½²çš„åå¥½ã€‚</p>
<p>è¿™ç§â€œé‡ç¡¬è½»è½¯â€çš„æŠ•èµ„æƒ¯æ€§ï¼Œå¯¼è‡´ç¡¬ä»¶é‡å¤æŠ•èµ„ï¼Œå¢åŠ è´¢æ”¿è´Ÿæ‹…å’Œä¼ä¸šæˆæœ¬ã€‚</p>
<p>å°æ¨¡å‹åˆ™ä»¥å…¶<strong>è½»é‡ã€é«˜æ•ˆã€ä½æˆæœ¬</strong>çš„ç‰¹æ€§ï¼Œæˆä¸ºæ™ºèƒ½ä½“æ™®åŠçš„ç†æƒ³é€‰æ‹©ï¼šå‚æ•°æ›´å°‘ã€å¿«é€Ÿæ¨ç†ã€èµ„æºé«˜æ•ˆã€ç‰¹å®šä»»åŠ¡ä¼˜åŒ–ã€æ³¨é‡éšç§ã€æˆæœ¬æ•ˆç›Šé«˜ã€æ›´æ˜“äºå¾®è°ƒã€ä¾¿æºæ˜“éƒ¨ç½²ã€‚</p>
<h2 data-id="heading-5"><strong>å°æ¨¡å‹æ™ºèƒ½ä½“å·²æ— å¤„ä¸åœ¨</strong></h2>
<p>åœ¨æ™ºæ…§åŸå¸‚é¢†åŸŸï¼Œè”æƒ³é›†å›¢åœ¨æ­¦å¤·å±±ã€å®œæ˜Œç­‰åŸå¸‚ç›¸ç»§è½åœ° <strong>â€œåŸå¸‚è¶…çº§æ™ºèƒ½ä½“â€</strong> ï¼Œå°†AIèƒ½åŠ›è¾“é€ç»™åŸå¸‚çš„å„è¡Œå„ä¸šå’Œå¸‚æ°‘æ¸¸å®¢ï¼Œå®ç°ä»æ”¿åŠ¡åˆ°æ°‘ç”Ÿã€äº§ä¸šçš„å…¨é¢æ™ºèƒ½åŒ–ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/779ec3b251704edaaaad19d27cbf7d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=HYLlnbdo0RK9Iu0OvZHoFEzqDE8%3D" alt="dll8cyjpendofof9uobxneyd6yjash572342.jpg" loading="lazy"/></p>
<p>åœ¨æœºå™¨äººé¢†åŸŸï¼ŒGoogle DeepMindä¸Šçº¿çš„<strong>SIMA 2é¢„è§ˆç‰ˆ</strong>ä¾æ‰˜è½»é‡çº§çš„Gemini 2.5 Flash-liteæ¨¡å‹ï¼Œä»»åŠ¡æˆåŠŸç‡ç›¸è¾ƒäºSIMA 1å¤§å¹…æé«˜ï¼Œèƒ½åœ¨ä»æœªè§è¿‡çš„æ–°ç¯å¢ƒé‡Œå®Œæˆå¤æ‚æŒ‡ä»¤ï¼Œè¿˜å…·å¤‡è‡ªæˆ‘æ”¹è¿›èƒ½åŠ›ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77db5dbc545e4a2ba071c7c96da066c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=YSTP1PEUf0UV%2FXPnTQErQfD%2BwGw%3D" alt="screenshot_2025-11-17_16-37-05.png" loading="lazy"/></p>
<p>åœ¨å†…å®¹åˆ›ä½œã€çŸ¥è¯†é—®ç­”ã€æ™ºèƒ½åŠ©ç†ã€AIæœç´¢ç­‰åœºæ™¯ä¸­ï¼ŒåŸºäºå°æ¨¡å‹çš„æ™ºèƒ½ä½“ä¹Ÿå·²å®ç°å¹¿æ³›åº”ç”¨ã€‚</p>
<p>ä¸­å›½ä¿¡æ¯é€šä¿¡ç ”ç©¶é™¢äº‘è®¡ç®—ä¸å¤§æ•°æ®ç ”ç©¶æ‰€å‰¯æ‰€é•¿æ —è”šè¡¨ç¤ºï¼Œåœ¨ä¼ä¸šçº§åº”ç”¨æ–¹é¢ï¼Œå¯ä»¥åº”ç”¨æ™ºèƒ½ä½“æ¨åŠ¨ä¼ä¸šé™æœ¬å¢æ•ˆå’Œæ•°æ®é©±åŠ¨å†³ç­–çš„è¿›ä¸€æ­¥å®è·µã€‚</p>
<p><strong>åœ¨Coovallyä¸Šï¼ŒæŒç»­é›†æˆå’Œå¼€æºå¤šç±»é«˜è´¨é‡æ•°æ®é›†ï¼Œ</strong> è¦†ç›–æ— äººæœºå·¡æ£€ã€æ™ºæ…§å†œä¸šã€æ™ºæ…§æ¸”ä¸šç­‰å¤šä¸ªé¢†åŸŸï¼Œæ¨åŠ¨AIå¼€å‘æ›´åŠ é«˜æ•ˆä¸å¼€æ”¾ã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/050651adbc7e4c1cac57f88cea84414b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764033634&amp;x-signature=FYRba416dSkYqs33Tx7LdJDSteo%3D" alt="æ¨¡å‹æ•°æ®é›†.GIF" loading="lazy"/></p>
<p><strong>ï¼ï¼ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼Œç«‹å³ä½“éªŒCoovallyï¼ï¼</strong></p>
<p><strong>å¹³å°é“¾æ¥ï¼š</strong> <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coovally.com" target="_blank" title="https://www.coovally.com" ref="nofollow noopener noreferrer">www.coovally.com</a></strong></p>
<h2 data-id="heading-6"><strong>å°æ¨¡å‹æ™ºèƒ½ä½“çš„å‘å±•è·¯å¾„</strong></h2>
<p>å°æ¨¡å‹æ™ºèƒ½ä½“çš„å‘å±•ä¸ä¼šå–ä»£å¤§æ¨¡å‹ï¼Œè€Œæ˜¯å½¢æˆä¸€ç§<strong>äº’è¡¥å…±ç”Ÿçš„å…³ç³»</strong>ã€‚ä¼ä¸šæ­£åœ¨å°†ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œæ„å»ºæ··åˆæ¶æ„ï¼Œä»¥ä¼˜åŒ–ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼šå¤§æ¨¡å‹å¤„ç†å¤æ‚çš„æ¨ç†ã€æˆ˜ç•¥è§„åˆ’å’Œåˆ›é€ æ€§ä»»åŠ¡ï¼›</p>
<p>SLMæ‰§è¡Œå™¨ç®¡ç†é«˜é¢‘æ¬¡ã€ç‰¹å®šä»»åŠ¡çš„æ“ä½œï¼Œä¾‹å¦‚å®¢æˆ·æ”¯æŒã€æ•°æ®å¤„ç†å’Œç›‘æ§ã€‚</p>
<p>è¿™ç§åˆ†å·¥åä½œæ—¢èƒ½å®ç°æœ€ä½³èµ„æºåˆ†é…ï¼Œåˆèƒ½ä¿æŒå¤æ‚å·¥ä½œæµç¨‹æ‰€éœ€çš„æ™ºèƒ½æ€§ã€‚</p>
<p>æœªæ¥ï¼Œ<strong>å¼ºåŒ–å­¦ä¹ é©±åŠ¨çš„æŒç»­è¿­ä»£</strong>å°†æ˜¯Agentå‘å±•çš„å…³é”®è·¯å¾„ã€‚éšç€å·¥å…·ä½¿ç”¨èƒ½åŠ›çš„è¿›ä¸€æ­¥çªç ´ï¼Œå°æ¨¡å‹æ™ºèƒ½ä½“å°†èƒ½åœ¨æ›´å¤æ‚çš„ç¯å¢ƒä¸­æ„ŸçŸ¥ã€å†³ç­–å’Œè¡ŒåŠ¨ï¼ŒçœŸæ­£æˆä¸ºäººç±»çš„æ™ºèƒ½åŠ©æ‰‹ã€‚</p>
<p>AIæ™ºèƒ½ä½“æ­£åœ¨èµ°å‡ºå®éªŒå®¤ï¼Œèµ°è¿›æ™®é€šäººçš„æ—¥å¸¸ç”Ÿæ´»ã€‚å®ƒä»¬ä¸å†æ˜¯è¢«å¤§å‹ç§‘æŠ€å…¬å¸å„æ–­çš„å°–ç«¯æŠ€æœ¯ï¼Œè€Œæ˜¯æˆä¸ºä¸­å°ä¼ä¸šç”šè‡³ä¸ªäººéƒ½èƒ½é©¾é©­çš„æ™ºèƒ½å·¥å…·ã€‚</p>
<p>è®¡ç®—æœºè§†è§‰å°æ¨¡å‹ä¸æ™ºèƒ½ä½“çš„ç»“åˆï¼Œé¢„ç¤ºç€ä¸€ä¸ªå…¨æ–°æ–¹å‘çš„è¯ç”Ÿâ€”â€”äººå·¥æ™ºèƒ½ä¸å†è¿½æ±‚â€œæ›´å¤§æ›´å…¨â€ï¼Œè€Œæ˜¯æœç€â€œå°è€Œä¸“ã€ä¸“è€Œç²¾â€çš„æ–¹å‘æ¼”åŒ–ã€‚</p>
<p>è¿™æˆ–è®¸æ‰æ˜¯äººå·¥æ™ºèƒ½çœŸæ­£èµ°å‘æ™®åŠã€èµ°å‘å¹³æ°‘åŒ–çš„å¿…ç»ä¹‹è·¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äº‘åŸç”Ÿæ¸¸æˆç½‘å…³æ¶æ„ï¼šEKS + APISIX + Graviton æ„å»ºé«˜æ€§èƒ½æ¸¸æˆæœåŠ¡ç½‘å…³]]></title>    <link>https://juejin.cn/post/7573592952242323508</link>    <guid>https://juejin.cn/post/7573592952242323508</guid>    <pubDate>2025-11-18T01:37:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573592952242323508" data-draft-id="7573504290066694159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="äº‘åŸç”Ÿæ¸¸æˆç½‘å…³æ¶æ„ï¼šEKS + APISIX + Graviton æ„å»ºé«˜æ€§èƒ½æ¸¸æˆæœåŠ¡ç½‘å…³"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-18T01:37:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºšé©¬é€Šäº‘å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            äº‘åŸç”Ÿæ¸¸æˆç½‘å…³æ¶æ„ï¼šEKS + APISIX + Graviton æ„å»ºé«˜æ€§èƒ½æ¸¸æˆæœåŠ¡ç½‘å…³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºšé©¬é€Šäº‘å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:37:18.000Z" title="Tue Nov 18 2025 01:37:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ç°ä»£æ¸¸æˆè¿è¥ç¯å¢ƒä¸­ï¼Œéšç€æ¸¸æˆæœåŠ¡å™¨è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œä¼ ç»Ÿçš„æœåŠ¡å™¨ä»£ç†æ–¹æ¡ˆé¢ä¸´ç€è¯¸å¤šæŒ‘æˆ˜ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ API Six è¿™ä¸€é«˜æ€§èƒ½ç½‘å…³æ¥è§£å†³å¤§è§„æ¨¡æ¸¸æˆæœåŠ¡å™¨ä»£ç†çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹éœ€è¦ä½¿ç”¨å¤šä¸ª Network Load Balancer (NLB) çš„åœºæ™¯ï¼Œæä¾›ä¸€ä¸ªæ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚
åœ¨æ¸¸æˆæœåŠ¡æ¶æ„ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ä»¥ä¸‹å‡ ä¸ªå…³é”®æŒ‘æˆ˜ï¼š</p>
<p>1ã€ æœåŠ¡å™¨è§„æ¨¡é—®é¢˜</p>
<ul>
<li>éšç€æ¸¸æˆçš„æˆåŠŸè¿è¥ï¼ŒæœåŠ¡å™¨æ•°é‡å¯èƒ½ä»æœ€åˆçš„å‡ å°æ‰©å±•åˆ°æˆç™¾ä¸Šåƒå°</li>
<li>ä¼ ç»Ÿçš„ä½¿ç”¨å¤šä¸ª NLB è¿›è¡Œä»£ç†çš„æ–¹æ¡ˆåœ¨ç®¡ç†å’Œç»´æŠ¤ä¸Šå˜å¾—è¶Šæ¥è¶Šå¤æ‚</li>
<li>æˆæœ¬é—®é¢˜ï¼šæ¯å¢åŠ ä¸€ä¸ª NLB éƒ½ä¼šå¸¦æ¥é¢å¤–çš„è´¹ç”¨æ”¯å‡º</li>
</ul>
<p>2ã€ å®‰å…¨æ€§è€ƒè™‘</p>
<ul>
<li>æ¸¸æˆæœåŠ¡å™¨éœ€è¦é˜²æŠ¤å„ç§ç½‘ç»œæ”»å‡»</li>
<li>ä¼ ç»Ÿçš„ TCP åè®®ç¼ºä¹è¶³å¤Ÿçš„å®‰å…¨ä¿æŠ¤æœºåˆ¶</li>
<li>éœ€è¦åœ¨ä¸å½±å“æ€§èƒ½çš„å‰æä¸‹æä¾›å®‰å…¨ä¿éšœ</li>
</ul>
<p>3ã€è¿ç»´å¤æ‚æ€§</p>
<ul>
<li>å¤šä¸ª NLB çš„é…ç½®ç®¡ç†è¾ƒä¸ºç¹ç</li>
<li>æœåŠ¡å™¨æ‰©ç¼©å®¹æ—¶éœ€è¦é¢‘ç¹è°ƒæ•´è´Ÿè½½å‡è¡¡é…ç½®</li>
<li>ç›‘æ§å’Œæ•…éšœæ’æŸ¥çš„éš¾åº¦éšç€è§„æ¨¡å¢åŠ è€Œå¢åŠ </li>
</ul>
<p>é¢å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ç°ä»£åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚API Six ä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€å¯æ‰©å±•çš„ç½‘å…³ï¼Œç»“åˆ TLS åŠ å¯†ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³è¿™äº›é—®é¢˜ã€‚åœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ API Six æ„å»ºä¸€ä¸ªé«˜æ•ˆã€å®‰å…¨ã€æ˜“äºç®¡ç†çš„æ¸¸æˆæœåŠ¡ç½‘å…³ç³»ç»Ÿã€‚</p>
<blockquote>
<p>ğŸ“¢é™æ—¶æ’æ’­ï¼šåœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œä½ å¯ä»¥åœ¨åŸºäº Graviton çš„ EC2 å®ä¾‹ä¸Šè½»æ¾å¯åŠ¨ Milvus å‘é‡æ•°æ®åº“ï¼ŒåŠ é€Ÿæ‚¨çš„ç”Ÿæˆå¼ AI åº”ç”¨ã€‚</p>
<p>â©å¿«å¿«ç‚¹å‡»è¿›å…¥ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D668dfdebee6ab158880f2852%26visitfrom%3D3P_Juejinhead_0618%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejinhead_0618" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=668dfdebee6ab158880f2852&amp;visitfrom=3P_Juejinhead_0618&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejinhead_0618" ref="nofollow noopener noreferrer">åˆ›æ–°åŸºçŸ³ â€”â€” åŸºäº Graviton æ„å»ºå·®å¼‚åŒ–ç”Ÿæˆå¼AIå‘é‡æ•°æ®åº“</a>ã€‹å®éªŒ</p>
<p>ğŸ“± å³åˆ»åœ¨äº‘ä¸Šæ¢ç´¢å®éªŒå®¤ï¼Œå¼€å¯æ„å»ºå¼€å‘è€…æ¢ç´¢ä¹‹æ—…å§</p>
</blockquote>
<h2 data-id="heading-1">æ¶æ„ä»‹ç»</h2>
<h3 data-id="heading-2">1. æ¶æ„æ•´ä½“è¯´æ˜</h3>
<p>APIsixæ ¸å¿ƒç»„ä»¶è¿è¡Œäº Amazon EKSï¼ˆElastic Kubernetes Serviceï¼‰é›†ç¾¤å†…éƒ¨ã€‚æ•´ä¸ªç³»ç»Ÿä¸»è¦åˆ†ä¸ºä¸¤å¤§è®¿é—®å…¥å£ï¼šè¿ç»´ï¼ˆOpsï¼‰å’Œç©å®¶ï¼ˆPlayersï¼‰ï¼Œåˆ†åˆ«é€šè¿‡ç‹¬ç«‹çš„ ELBï¼ˆElastic Load Balancerï¼‰æ¥å…¥.(åœ¨æ­¤å»ºè®®å’±ä»¬åœ¨éƒ¨ç½²ç¯å¢ƒå‰å¯ä»¥å…ˆæ‰‹åŠ¨åˆ›å»ºELB, åœ¨EKSä¸­é€šè¿‡TargetGroupBindingçš„æ–¹å¼æ¥è¿›è¡Œç»‘å®šæœåŠ¡,è¿™æ ·å¯ä»¥ä¿è¯åç»­æœåŠ¡å˜æ›´æ—¶å‰ç«¯æ¥å…¥ELBä¸ºåŒä¸€ä¸ª.)</p>
<h3 data-id="heading-3">2. æµé‡å…¥å£</h3>
<ul>
<li>Opsï¼ˆè¿ç»´ï¼‰å…¥å£
è¿ç»´äººå‘˜é€šè¿‡ ELB è®¿é—® EKS é›†ç¾¤ä¸­çš„ Admin APIï¼Œå®ç°å¯¹å¹³å°çš„ç®¡ç†å’Œç›‘æ§ã€‚</li>
<li>Playersï¼ˆç©å®¶ï¼‰å…¥å£
ç©å®¶æµé‡åŒæ ·é€šè¿‡ç‹¬ç«‹çš„ ELB è¿›å…¥ EKS é›†ç¾¤ï¼Œä¸»è¦è®¿é—® API Gatewayï¼Œè¿›è€Œè·¯ç”±åˆ°å…·ä½“çš„æ¸¸æˆæœåŠ¡ï¼ˆGame Serverï¼‰æˆ–å¹³å°æœåŠ¡ï¼ˆPlatform Serviceï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-4">3. EKS é›†ç¾¤å†…éƒ¨ç»“æ„</h3>
<ul>
<li>Admin API å±‚
æä¾›ç®¡ç†æ¥å£ï¼Œä¾›è¿ç»´äººå‘˜æ“ä½œå’Œç®¡ç†æ•´ä¸ªç³»ç»Ÿã€‚</li>
<li>etcd å±‚
ä½œä¸ºåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼Œè´Ÿè´£æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚Admin API ä¼šå°†å˜æ›´å†™å…¥ etcdï¼ŒAPI Gateway é€šè¿‡ watch æœºåˆ¶å®æ—¶æ„ŸçŸ¥æœåŠ¡å˜åŒ–ã€‚</li>
<li>API Gateway å±‚
è¿™ä¸€å±‚æ˜¯ç©å®¶è®¿é—®çš„ä¸»è¦å…¥å£ï¼ŒAPI Gateway è´Ÿè´£æ ¹æ® etcd çš„æœåŠ¡å‘ç°ä¿¡æ¯ï¼Œå°†ç©å®¶è¯·æ±‚è·¯ç”±åˆ°åç«¯çš„å…·ä½“æœåŠ¡ï¼ˆå¦‚ Platform Service æˆ– Game Serverï¼‰ã€‚</li>
<li>ä¸šåŠ¡æœåŠ¡å±‚
åŒ…å«å¹³å°æœåŠ¡ï¼ˆPlatform Serviceï¼‰å’Œå¤šä¸ªæ¸¸æˆæœï¼ˆGame Server1ã€Game Server2 ç­‰ï¼‰ï¼Œè¿™äº›æœåŠ¡æ˜¯æœ€ç»ˆå¤„ç†ç©å®¶è¯·æ±‚çš„æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶ã€‚</li>
</ul>
<h2 data-id="heading-5">æ–¹æ¡ˆéƒ¨ç½²</h2>
<p>ä¸‹é¢æˆ‘ä»¬å°†é€æ­¥æ¥éªŒè¯æ•´ä¸ªæ–¹æ¡ˆ, æ–¹æ¡ˆä¸­æˆ‘ä»¬å°†é‡‡ç”¨æ¨¡æ‹ŸTCPåè®®çš„æ¸¸æˆæœåŠ¡,é€šè¿‡ELBæ¥å®ç°ä¸åŒæ¸¸æˆæœçš„è·¯ç”±åŠŸèƒ½.é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®éªŒEKSé›†ç¾¤, å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.aws.amazon.com%2Feks%2Flatest%2Fuserguide%2Fgetting-started.html" target="_blank" title="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html" ref="nofollow noopener noreferrer">EKSæ–‡æ¡£</a> åˆ›å»ºEKS.</p>
<h3 data-id="heading-6">åˆ›å»ºå¥½EKSå, æ·»åŠ ç”¨æˆ·æƒé™</h3>
<p>ç„¶ååˆ›å»ºAccess Entry</p>
<h3 data-id="heading-7">ä½¿ç”¨Helmæ¥å®‰è£…éƒ¨ç½²APISix</h3>
<p>æœ¬æ–‡é‡‡ç”¨çš„éƒ¨ç½²ç›®æ ‡æœåŠ¡å™¨ä¸ºäºšé©¬é€Šäº‘ç§‘æŠ€Gravitonæœºå‹,å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘æŒ¥APISixçš„æœ€å¤§æ€§èƒ½. å‚è€ƒæ­¥éª¤å¦‚ä¸‹:</p>
<p>1ã€æ·»åŠ ç›¸å…³helmåº“</p>
<pre><code class="hljs language-csharp" lang="csharp">helm repo <span class="hljs-keyword">add</span> apisix https:<span class="hljs-comment">//charts.apiseven.com</span>
helm repo update
</code></pre>
<p>2ã€æ•´ç†apisix-values.yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Tolerations for Graviton nodes (if needed)</span>
<span class="hljs-attr">tolerations:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">"kubernetes.io/arch"</span>
    <span class="hljs-attr">operator:</span> <span class="hljs-string">"Equal"</span>
    <span class="hljs-attr">value:</span> <span class="hljs-string">"arm64"</span>
    <span class="hljs-attr">effect:</span> <span class="hljs-string">"NoSchedule"</span>

<span class="hljs-comment"># Affinity to prefer Graviton nodes</span>
<span class="hljs-attr">affinity:</span>
  <span class="hljs-attr">nodeAffinity:</span>
    <span class="hljs-attr">preferredDuringSchedulingIgnoredDuringExecution:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">100</span>
      <span class="hljs-attr">preference:</span>
        <span class="hljs-attr">matchExpressions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">kubernetes.io/arch</span>
          <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>
<span class="hljs-comment">### values:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">arm64</span>
</code></pre>
<p>3ã€æ‰§è¡Œå‘½ä»¤æ›´æ–°æœåŠ¡</p>
<pre><code class="hljs language-css" lang="css">helm install apisix apisix/apisix <span class="hljs-attr">--create-namespace</span> <span class="hljs-attr">--namespace</span> ingress-apisix \
<span class="hljs-attr">--values</span> apisix-values<span class="hljs-selector-class">.yaml</span>
</code></pre>
<p>4ã€å¦‚æœæ­¤å¤„éƒ¨ç½²æœ‰é—®é¢˜,ä¸€å®šè¦å…³æ³¨ä¸€ä¸‹å½“å‰çš„storageclassæ˜¯å¦å­˜åœ¨.</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">etcd:</span>
  <span class="hljs-attr">persistence:</span>
    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">efs-sc</span> <span class="hljs-comment"># è¯·æ ¼å¤–æ³¨æ„æ­¤å¤„,å¦åˆ™å¯èƒ½æ–¹æ¡ˆéƒ¨ç½²å¤±è´¥.</span>
</code></pre>
<p>å¦æ¨èä¸€ä¸ªå°æŠ€å·§,å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜,å¯ä»¥ä½¿ç”¨Amazon Q CLIæ¥åšè¯Šæ–­,æ•´ä¸ªè¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–,ä¸‹é¢æ˜¯æˆ‘çš„æ­¥éª¤æˆªå›¾.</p>
<h3 data-id="heading-8">éƒ¨ç½² æ¸¸æˆæœåŠ¡</h3>
<p>æ¨¡æ‹Ÿæ¸¸æˆæœä»£ç </p>
<pre><code class="hljs language-python" lang="python"> <span class="hljs-comment"># Bind to all interfaces</span>
    server.bind((<span class="hljs-string">'0.0.0.0'</span>, port))
    server.listen(<span class="hljs-number">5</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[*] <span class="hljs-subst">{server_name}</span> listening on 0.0.0.0:<span class="hljs-subst">{port}</span>"</span>)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            client, addr = server.accept()
            client_handler = threading.Thread(target=handle_client, args=(client, addr))
            client_handler.daemon = <span class="hljs-literal">True</span>
            client_handler.start()
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{server_name}</span>] Shutting down server"</span>)
        server.close()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    start_server(<span class="hljs-number">9000</span>)
</code></pre>
<p>æ¨¡æ‹ŸEKSä¸­çš„æœåŠ¡éƒ¨ç½²ä»£ç : test-server-1.yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">test-server-1</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">game</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-1</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-1</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-1</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tcp-server</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">python:3.9-slim</span>
        <span class="hljs-attr">command:</span> [<span class="hljs-string">"python"</span>]
        <span class="hljs-attr">args:</span> [<span class="hljs-string">"-u"</span>, <span class="hljs-string">"/app/tcp-echo-server.py"</span>, <span class="hljs-string">"test-server-1"</span>]
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9000</span>
        <span class="hljs-attr">volumeMounts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">script-volume</span>
          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/app</span>
      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">script-volume</span>
        <span class="hljs-attr">configMap:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">tcp-echo-server</span>
          <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">0777</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">gs-1</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">game</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-1</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-1</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9000</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span> 
<span class="hljs-string">test-server-2.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">test-server-2</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">game</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-2</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-2</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-2</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tcp-server</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">python:3.9-slim</span>
        <span class="hljs-attr">command:</span> [<span class="hljs-string">"python"</span>]
        <span class="hljs-attr">args:</span> [<span class="hljs-string">"-u"</span>, <span class="hljs-string">"/app/tcp-echo-server.py"</span>, <span class="hljs-string">"test-server-2"</span>]
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9000</span>
        <span class="hljs-attr">volumeMounts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">script-volume</span>
          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/app</span>
      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">script-volume</span>
        <span class="hljs-attr">configMap:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">tcp-echo-server</span>
          <span class="hljs-attr">defaultMode:</span> <span class="hljs-number">0777</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">gs-2</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">game</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-2</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">test-server-2</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9000</span>
    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
</code></pre>
<p>éƒ¨ç½²æœåŠ¡</p>
<pre><code class="hljs language-vbscript" lang="vbscript">kubectl create namespace game
kubectl create configmap tcp-echo-<span class="hljs-built_in">server</span> --from-file=tcp-echo-<span class="hljs-built_in">server</span>.py --namespace game
kubectl apply -f test-<span class="hljs-built_in">server</span><span class="hljs-number">-1.</span>yaml
kubectl apply -f test-<span class="hljs-built_in">server</span><span class="hljs-number">-2.</span>yaml
</code></pre>
<h3 data-id="heading-9">é…ç½®è¯ä¹¦</h3>
<p>å½“ä½¿ç”¨TLSçš„SNIåŠŸèƒ½æ—¶,æ¯ä¸ªä½ æƒ³è¦ä½¿ç”¨SNIçš„åŸŸåæˆ–ä¸»æœºåéƒ½éœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„è¯ä¹¦ã€‚è¿™æ˜¯å› ä¸ºSNIå…è®¸ä»åŒä¸€ä¸ªIPåœ°å€å’Œç«¯å£æä¾›å¤šä¸ªä¸»æœºåæœåŠ¡,è€Œè¯ä¹¦ç”¨äºéªŒè¯æœåŠ¡å™¨çš„èº«ä»½å¹¶ä¸å®¢æˆ·ç«¯å»ºç«‹åŠ å¯†è¿æ¥ã€‚ä½¿ç”¨OpenSSLä¸º2ä¸ªGame ServeræœåŠ¡ç”Ÿæˆè¯ä¹¦æ–‡ä»¶å’Œå¯†é’¥æ–‡ä»¶ã€‚</p>
<p>1ã€ç”Ÿæˆè¯ä¹¦</p>
<pre><code class="hljs language-csharp" lang="csharp">openssl req -<span class="hljs-keyword">new</span> -newkey rsa:<span class="hljs-number">2048</span> -days <span class="hljs-number">365</span> -nodes -x509 -keyout gs<span class="hljs-number">-1.</span>key -<span class="hljs-keyword">out</span> gs<span class="hljs-number">-1.</span>crt -subj <span class="hljs-string">"/CN=gs-1.com"</span>
openssl req -<span class="hljs-keyword">new</span> -newkey rsa:<span class="hljs-number">2048</span> -days <span class="hljs-number">365</span> -nodes -x509 -keyout gs<span class="hljs-number">-2.</span>key -<span class="hljs-keyword">out</span> gs<span class="hljs-number">-2.</span>crt -subj <span class="hljs-string">"/CN=gs-2.com"</span>
</code></pre>
<p>2ã€ä¸Šä¼ è¯ä¹¦åˆ°apisix</p>
<pre><code class="hljs language-javascript" lang="javascript">kubectl port-forward -n ingress-apisix svc/apisix-admin <span class="hljs-number">9180</span>:<span class="hljs-number">9180</span> &amp;
sleep <span class="hljs-number">3</span>
curl  -X <span class="hljs-variable constant_">POST</span> <span class="hljs-attr">http</span>:<span class="hljs-comment">//127.0.0.1:9180/apisix/admin/ssls -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -d '</span>
{
    <span class="hljs-string">"cert"</span>: <span class="hljs-string">"'"</span>$(cat gs-<span class="hljs-number">1.</span>crt)<span class="hljs-string">"'"</span>,
    <span class="hljs-string">"key"</span>: <span class="hljs-string">"'"</span>$(cat gs-<span class="hljs-number">1.</span>key)<span class="hljs-string">"'"</span>,
    <span class="hljs-string">"snis"</span>: [<span class="hljs-string">"gs-1.com"</span>]
}<span class="hljs-string">'
# Create SSL certificate for gs-2.com
curl -X POST http://127.0.0.1:9180/apisix/admin/ssls -H '</span>X-<span class="hljs-variable constant_">API</span>-<span class="hljs-attr">KEY</span>: edd1c9f034335f136f87ad84b625c8f1<span class="hljs-string">'  -d '</span>
{
    <span class="hljs-string">"cert"</span>: <span class="hljs-string">"'"</span>$(cat gs-<span class="hljs-number">2.</span>crt)<span class="hljs-string">"'"</span>,
    <span class="hljs-string">"key"</span>: <span class="hljs-string">"'"</span>$(cat gs-<span class="hljs-number">2.</span>key)<span class="hljs-string">"'"</span>,
    <span class="hljs-string">"snis"</span>: [<span class="hljs-string">"gs-2.com"</span>]
}<span class="hljs-string">'
kill %1
</span></code></pre>
<p>3ã€éªŒè¯è¯ä¹¦ä¸Šä¼ </p>
<pre><code class="hljs language-ruby" lang="ruby">curl -X <span class="hljs-variable constant_">GET</span> <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/127.0.0.1:9180/apisix</span><span class="hljs-regexp">/admin/ssls</span> -H <span class="hljs-string">'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1'</span> 

</code></pre>
<h3 data-id="heading-10">é…ç½®è·¯ç”±</h3>
<p>ä¸‹é¢æˆ‘ä»¬åŸºäºå·²ç»é…ç½®å¥½çš„è¯ä¹¦æ¥é…ç½®ç›¸å…³çš„è·¯ç”±ä¿¡æ¯, ä¹Ÿå°±æ˜¯é€šå¸¸æˆ‘ä»¬åœ¨å¹³å°æœé…ç½®å¥½è¯ä¹¦å,å¯ä»¥è°ƒç”¨ç›¸å…³APIæ¥é…ç½®è·¯ç”±,å‘½ä»¤ä¿¡æ¯å¦‚ä¸‹:</p>
<pre><code class="hljs language-vbnet" lang="vbnet">kubectl port-forward -n ingress-apisix svc/apisix-admin <span class="hljs-number">9180</span>:<span class="hljs-number">9180</span> &amp;
sleep <span class="hljs-number">3</span>
curl -i -X POST http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9180</span>/apisix/admin/stream_routes -H <span class="hljs-comment">'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -d '{</span>
  <span class="hljs-string">"upstream"</span>: {
    <span class="hljs-string">"nodes"</span>: {
      <span class="hljs-string">"gs-1.game.svc.cluster.local:9000"</span>: <span class="hljs-number">1</span>
    },
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"roundrobin"</span>
  },
  <span class="hljs-string">"sni"</span>: <span class="hljs-string">"gs-1.com"</span>
}<span class="hljs-comment">'</span>

curl -i -X POST http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9180</span>/apisix/admin/stream_routes -H <span class="hljs-comment">'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -d '{</span>
  <span class="hljs-string">"upstream"</span>: {
    <span class="hljs-string">"nodes"</span>: {
      <span class="hljs-string">"gs-2.game.svc.cluster.local:9000"</span>: <span class="hljs-number">1</span>
    },
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"roundrobin"</span>
  },
  <span class="hljs-string">"sni"</span>: <span class="hljs-string">"gs-2.com"</span>
}<span class="hljs-comment">'</span>
</code></pre>
<h3 data-id="heading-11">æµ‹è¯•åŸºäºSNIçš„è®¿é—®</h3>
<p>é¦–å…ˆè·å–å¯¹åº”APIsixæœåŠ¡çš„ALBåœ°å€</p>
<pre><code class="hljs language-arduino" lang="arduino">&gt; kubectl get svc -n ingress-apisix apisix-gateway
NAME             TYPE           CLUSTER-IP      <span class="hljs-literal">EXTERNAL</span>-<span class="hljs-function">IP                                                                     <span class="hljs-title">PORT</span><span class="hljs-params">(S)</span>                       AGE
apisix-gateway   LoadBalancer   10.100.xxxx.12   k8s-ingressa-apisixga-xxxxxxx-xxx.elb.us-east-1.amazonaws.com   80:<span class="hljs-number">30496</span>/TCP,<span class="hljs-number">8888</span>:<span class="hljs-number">30694</span>/TCP   <span class="hljs-number">3</span>d2h

</span></code></pre>
<p>é€šè¿‡ä¸Šé¢è¿”å›è·å–çš„ALBçš„åœ°å€</p>
<pre><code class="hljs language-arduino" lang="arduino">openssl s_client -connect k8s-ingressa-apisixga-xxxxx.xxxx.elb.ap-northeast<span class="hljs-number">-1.</span>amazonaws.com:<span class="hljs-number">8888</span> \
-servername gs<span class="hljs-number">-1.</span>com -quiet
openssl s_client -connect k8s-ingressa-apisixga-xxxx.xxxx.elb.ap-northeast<span class="hljs-number">-1.</span>amazonaws.com:<span class="hljs-number">8888</span> \
-servername gs<span class="hljs-number">-2.</span>com -quiet
</code></pre>
<p>è‡³æ­¤å¯ä»¥çœ‹åˆ°é€šè¿‡ä¸åŒçš„SNIæˆ‘å°±å¯ä»¥è®¿é—®åˆ°ä¸åŒçš„æ¸¸æˆæœäº†,ä¹Ÿå°±è§£å†³äº†ä½¿ç”¨åŒä¸€ä¸ªNLB+APIsixçš„è®¿é—®ä¸åŒçš„æ¸¸æˆæœäº†.</p>
<h3 data-id="heading-12">APISix dashboardè®¿é—® (Optional)</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡Dashboardæ¥è®¿é—®å½“å‰çš„APIsixç³»ç»Ÿ,æŸ¥çœ‹ç›¸å…³çš„é…ç½®æ•°æ®. ä¸è¿‡è¿™é‡Œéœ€è¦æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹ALBçš„certificate ARN æ˜¯ä¸æ˜¯æ­£ç¡®.</p>
<p><code>kubectl get ingress -n ingress-apisix</code></p>
<h2 data-id="heading-13">APISix éƒ¨ç½²äºšé©¬é€Šäº‘ç§‘æŠ€æœ€ä½³å®è·µ</h2>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½² Apache APISIX æ—¶çš„å…³é”®æœ€ä½³å®è·µï¼Œå¸®åŠ©æå‡ç¨³å®šæ€§ã€æ€§èƒ½ä¸å¯ç»´æŠ¤æ€§ã€‚</p>
<h3 data-id="heading-14">æ ¸å¿ƒæ¶æ„ä¸ç»„ä»¶åˆ†ç¦»</h3>
<h4 data-id="heading-15">ä¸ºäº†ä¿è¯ç³»ç»Ÿå¯æ‰©å±•ä¸é«˜å¯ç”¨ï¼Œæ¨èå°† APISIX å„æ ¸å¿ƒç»„ä»¶è§£è€¦éƒ¨ç½²ï¼š</h4>
<ul>
<li>æ§åˆ¶å¹³é¢ï¼ˆetcdï¼‰ï¼šä½¿ç”¨å•ç‹¬éƒ¨ç½²çš„ etcd é›†ç¾¤å­˜å‚¨è·¯ç”±ä¸æ’ä»¶é…ç½®ï¼Œå»ºè®®åœ¨éƒ¨ç½²APISixçš„æ—¶å€™ç›´æ¥æŒ‡å‘é¢„å…ˆéƒ¨ç½²å¥½çš„etcdï¼Œè‡³å°‘éƒ¨ç½² 3 èŠ‚ç‚¹ï¼Œå¼€å¯æ•°æ®æŒä¹…åŒ–ä¸å¿«ç…§å¤‡ä»½ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœã€‚</li>
<li>æ•°æ®å¹³é¢ï¼ˆAPISIX èŠ‚ç‚¹ï¼‰ï¼šå¤–éƒ¨è¯·æ±‚ç”±å¤šä¸ª APISIX å®ä¾‹å¤„ç†ï¼ŒæŒ‰éœ€æ°´å¹³æ‰©å®¹ã€‚æ¯ä¸ªå®ä¾‹ä»…è´Ÿè´£æµé‡è½¬å‘ä¸æ’ä»¶æ‰§è¡Œï¼Œé…ç½®ä» etcd åŠ¨æ€æ‹‰å–ã€‚</li>
<li>è¿ç»´ç›‘æ§ï¼ˆPrometheus &amp; Grafanaï¼‰ï¼šéƒ¨ç½²ä¸“ç”¨çš„ç›‘æ§ç³»ç»Ÿï¼Œé‡‡é›† APISIX åŠ etcd çš„æŒ‡æ ‡ä¸æ—¥å¿—ï¼Œå®æ—¶å‘Šè­¦ä¸å¯è§†åŒ–ã€‚</li>
</ul>
<h4 data-id="heading-16">éƒ¨ç½²æ¨¡å¼ä¸æ‰©å±•ç­–ç•¥</h4>
<ul>
<li>æ— çŠ¶æ€éƒ¨ç½²
APISIX å®ä¾‹æœ¬èº«åº”ä¿æŒæ— çŠ¶æ€ï¼Œæ‰€æœ‰åŠ¨æ€é…ç½®å‡å­˜å‚¨åœ¨ etcdã€‚å®¹å™¨åŒ–æˆ–è™šæ‹ŸæœºåŒ–å‡å¯ï¼Œå€ŸåŠ© Kubernetes ç­‰å¹³å°å®ç°è‡ªåŠ¨ä¼¸ç¼©ä¸æ»šåŠ¨å‡çº§ã€‚</li>
<li>æ°´å¹³æ‰©å±•
æ ¹æ® QPS ä¸å“åº”å»¶è¿ŸæŒ‡æ ‡ï¼ŒåŠ¨æ€æ‰©ç¼©å®¹ã€‚å»ºè®®åœ¨ Kubernetes ä¸­é…ç½® HPAï¼ˆHorizontal Pod Autoscalerï¼‰ï¼Œç»“åˆè‡ªå®šä¹‰æŒ‡æ ‡ï¼ˆå¦‚ CPUã€å†…å­˜æˆ–è¯·æ±‚é€Ÿç‡ï¼‰è‡ªåŠ¨è°ƒæ•´å®ä¾‹æ•°ã€‚</li>
<li>ç°åº¦å‘å¸ƒä¸å›æ»š
é…åˆ Kubernetes Deployment æˆ–å…¶å®ƒå‘å¸ƒå·¥å…·ï¼Œåˆ©ç”¨ canary å‘å¸ƒç­–ç•¥é€æ­¥ä¸‹å‘æ–°ç‰ˆæœ¬ã€‚åœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¯å¿«é€Ÿå›æ»šè‡³ç¨³å®šç‰ˆæœ¬ï¼Œä¸”ä¸ä¸­æ–­å¤§éƒ¨åˆ†æµé‡ã€‚</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">lifecycle:
  preStop:
    <span class="hljs-built_in">exec</span>:
      <span class="hljs-built_in">command</span>: [<span class="hljs-string">"sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"sleep 15 &amp;&amp; apisix quit"</span>]
</code></pre>
<h3 data-id="heading-17">ç½‘ç»œä¸å®‰å…¨</h3>
<ul>
<li>é«˜æ€§èƒ½ç½‘ç»œ
é‡‡ç”¨ L4 è´Ÿè½½å‡è¡¡ï¼ˆå¦‚ Nginx Streamã€LVSï¼‰å°†æµé‡åˆ†å‘è‡³ APISIXï¼Œé¿å…åœ¨ L7 å±‚å¼•å…¥è¿‡å¤šé¢å¤–å»¶è¿Ÿã€‚</li>
<li>TLS ç»ˆç«¯
å¦‚éœ€ HTTPS æ”¯æŒï¼Œæ¨èåœ¨è¾¹ç¼˜å±‚ï¼ˆL4ï¼‰ç»ˆç«¯ TLSï¼Œå†ä»¥ HTTP é€šä¿¡è‡³ APISIXï¼›æˆ–ç›´æ¥åœ¨ APISIX ä¸Šä½¿ç”¨ ssl æ’ä»¶ç»ˆç«¯ TLSï¼Œå¹¶ç»“åˆ Cert-Manager è‡ªåŠ¨ç»­ç­¾è¯ä¹¦ã€‚</li>
<li>è®¿é—®æ§åˆ¶ä¸è®¤è¯
å¯ç”¨ IP é»‘ç™½åå•ã€ACL æ’ä»¶ï¼Œå¹¶æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥å…¥ JWTã€OAuth2 ç­‰è®¤è¯æ’ä»¶ï¼Œç¡®ä¿åç«¯æœåŠ¡å®‰å…¨ã€‚</li>
</ul>
<h3 data-id="heading-18">é…ç½®ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶</h3>
<ul>
<li>åŸºç¡€é…ç½®ä¸çƒ­æ›´æ–°
æŠŠè·¯ç”±ã€ä¸Šæ¸¸æœåŠ¡ã€æ’ä»¶é…ç½®ä»¥ YAML/JSON æ ¼å¼å­˜å‚¨äºä»£ç ä»“åº“ï¼Œç»“åˆ CI/CD æµæ°´çº¿è‡ªåŠ¨åŒæ­¥è‡³ etcdï¼Œå®ç°é…ç½®å³ä»£ç ï¼ˆConfiguration as Codeï¼‰ã€‚</li>
<li>ç‰ˆæœ¬ç®¡ç†
æ¯æ¬¡é…ç½®å˜æ›´éƒ½éœ€æ‰“ tag å¹¶åœ¨æµæ°´çº¿ä¸­æ ¡éªŒï¼ˆlintã€å•å…ƒæµ‹è¯•ã€ç°åº¦å‘å¸ƒï¼‰ï¼Œç¡®ä¿å˜æ›´å¯è¿½æº¯ã€å¯å›æ»šã€‚</li>
<li>é€‰æ‹©ç¨³å®šç‰ˆæœ¬,å¹¶åŠæ—¶è·Ÿè¿›ç¤¾åŒºçš„æ›´æ–°.</li>
<li>å‡çº§ç‰ˆæœ¬æ—¶éœ€è¦è¿›è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•,ä¿è¯æ–°ç‰ˆæœ¬çš„å…¼å®¹æ€§é—®é¢˜.</li>
</ul>
<h3 data-id="heading-19">æ€§èƒ½ä¼˜åŒ–ä¸æ’ä»¶æ²»ç†</h3>
<ul>
<li>å®ä¾‹é€‰æ‹©
ä¼˜å…ˆé€‰æ‹©Gravitonç±»å‹ä¸»æœºï¼Œç»è¿‡å¤šè½®æµ‹è¯•å‘ç°Gravitonçš„æœºå‹ç›¸å¯¹äºx86æœºå‹å¯ä»¥æä¾›è‡³å°‘2ä¸¤å€çš„æ€§èƒ½æå‡ï¼Œå…·ä½“è¯·å‚è€ƒç¤¾åŒº Benchmark <a href="https://link.juejin.cn?target=https%3A%2F%2Fapisix.apache.org%2Fblog%2F2022%2F08%2F12%2Farm-performance-google-aws-azure-with-apisix%2F" target="_blank" title="https://apisix.apache.org/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix/" ref="nofollow noopener noreferrer">é“¾æ¥</a>ï¼š.</li>
<li>æ’ä»¶å¼€å…³ç²’åº¦</li>
</ul>
<p>ä»…åœ¨éœ€è¦çš„è·¯ç”±ä¸Šå¯ç”¨æ’ä»¶ï¼Œé¿å…å…¨å±€åŠ è½½è¿‡å¤šæ’ä»¶å¯¼è‡´è¯·æ±‚è·¯å¾„å†—ä½™æ‰§è¡Œã€‚</p>
<ul>
<li>ç¼“å­˜ä¸é™æµ
åˆ©ç”¨ proxy-cache æ’ä»¶å¯¹é™æ€æˆ–å¯ç¼“å­˜å“åº”è¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œå‡è½»åç«¯å‹åŠ›ï¼›ç»“åˆ limit-reqã€limit-count æ’ä»¶é˜²æ­¢æµé‡çªå‘ä¸æ¶æ„æ”»å‡»ã€‚</li>
<li>æ—¥å¿—ä¸è¿½è¸ª
å¯ç”¨ skywalkingã€zipkin æˆ– opentelemetry æ’ä»¶ï¼Œå°†è¯·æ±‚é“¾è·¯ä¸æŒ‡æ ‡ä¸ŠæŠ¥è‡³åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆã€‚</li>
</ul>
<h3 data-id="heading-20">ç›‘æ§å‘Šè­¦ä¸å¥åº·æ£€æŸ¥</h3>
<ul>
<li>å¥åº·æ¢é’ˆ
åœ¨ Kubernetes ä¸­é…ç½® LivenessProbe ä¸ ReadinessProbeï¼ŒAPISIX èŠ‚ç‚¹å¼‚å¸¸æ—¶å¯è‡ªåŠ¨å‰”é™¤ã€‚</li>
<li>å…³é”®æŒ‡æ ‡
é‡ç‚¹ç›‘æ§è¯·æ±‚é€Ÿç‡ã€å“åº”å»¶è¿Ÿã€é”™è¯¯ç‡ï¼Œä»¥åŠ etcd çš„å»¶è¿Ÿä¸ leader é€‰ä¸¾çŠ¶æ€ã€‚æ ¹æ®é˜ˆå€¼é…ç½®å‘Šè­¦è§„åˆ™ï¼Œä¿è¯æ•…éšœå¯è¢«åŠæ—¶å‘ç°ä¸å“åº”</li>
<li>åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œå¦‚æœserviceæ•°é‡æ¯”è¾ƒå¤šä»¥åŠå¹¶å‘å¤§çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å¯¹netfilter.nf_conntrack_maxè¿›è¡Œè°ƒæ•´ã€‚å»ºè®®ç»“åˆprometheuså’Œgrafanaè¿›è¡Œå‘Šè­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜å¹¶ä¼˜åŒ–ç›¸å…³å‚æ•°ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é‡‡ç”¨ç±»ä¼¼C7gnçš„æœºå‹æ¥æå‡ç½‘ç»œååã€‚</li>
</ul>
<h3 data-id="heading-21">ç¾å¤‡ä¸é«˜å¯ç”¨è®¾è®¡</h3>
<ul>
<li>è·¨å¯ç”¨åŒºéƒ¨ç½²
å°† etcd å’Œ APISIX å®ä¾‹åˆ†å¸ƒåœ¨å¤šä¸ªå¯ç”¨åŒºæˆ–æœºæˆ¿ï¼Œä¿è¯å•åŒºæ•…éšœæ—¶ä»æœ‰æœåŠ¡å¯ç”¨ã€‚</li>
<li>å®šæœŸå¤‡ä»½
å¯¹ etcd æ•°æ®è¿›è¡Œå‘¨æœŸæ€§å…¨é‡ä¸å¢é‡å¤‡ä»½ï¼Œå¹¶åœ¨å¼‚åœ°å­˜å‚¨ï¼›åŒæ—¶éªŒè¯å¤‡ä»½å¯ç”¨æ€§ä¸æ¢å¤æµç¨‹ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šè¿°æœ€ä½³å®è·µï¼Œå¯ä»¥æ„å»ºä¸€å¥— é«˜å¯ç”¨ã€å¯æ‰©å±•ã€æ˜“è¿ç»´ çš„ APISIX æœåŠ¡éƒ¨ç½²ä½“ç³»ï¼Œæ»¡è¶³ä¸šåŠ¡åœ¨å¤æ‚æµé‡ä¸‹çš„ç¨³å®šè¿è¡Œä¸å¿«é€Ÿè¿­ä»£éœ€æ±‚ã€‚</p>
<h2 data-id="heading-22">æ€»ç»“</h2>
<p>å€ŸåŠ©ä»¥ä¸Šæ–¹æ¡ˆé€šè¿‡å°†æ‰€æœ‰ç©å®¶å’Œè¿ç»´æµé‡å…ˆæ±‡èšåˆ°å•ä¸ªNLBï¼Œå†ç”±éƒ¨ç½²åœ¨ EKS é›†ç¾¤å†…çš„ Apache APISIX æŒ‰ TLS SNI æŠŠè¯·æ±‚ç²¾å‡†åˆ†å‘åˆ°å„æ¸¸æˆæœï¼Œä»è€Œç”¨æœ€å°‘çš„è´Ÿè½½å‡è¡¡å®ä¾‹å®ç°ç»Ÿä¸€è·¯ç”±ã€åŠ¨æ€æœåŠ¡å‘ç°å’Œå…¨é“¾è·¯åŠ å¯†ï¼Œä¸ä»…æ˜¾è‘—é™ä½ NLB æˆæœ¬å’Œé…ç½®å¤æ‚åº¦ï¼Œè¿˜èƒ½åœ¨æœåŠ¡å™¨æ‰©ç¼©å®¹æ—¶ä¿æŒæµé‡æ— æ„ŸçŸ¥åˆ‡æ¢ï¼Œæˆä¸ºé«˜å¹¶å‘æ¸¸æˆåœºæ™¯ä¸‹ç»æµã€é«˜æ•ˆä¸”æ˜“ç»´æŠ¤çš„ç½‘å…³æ¶æ„ï¼ŒåŒæ—¶ï¼Œå€ŸåŠ©Gravitonï¼ŒAPISixèƒ½å¤Ÿå®ç°æé«˜çš„æ€§ä»·æ¯”ã€‚</p>
<p><strong>å‚è€ƒå†…å®¹</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi7.ai%2Fblog%2Fapi7-latency" target="_blank" title="https://api7.ai/blog/api7-latency" ref="nofollow noopener noreferrer">api7.ai/blog/api7-lâ€¦</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fapisix.apache.org%2Fblog%2F2022%2F08%2F12%2Farm-performance-google-aws-azure-with-apisix%2F" target="_blank" title="https://apisix.apache.org/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix/" ref="nofollow noopener noreferrer">apisix.apache.org/blog/2022/0â€¦</a></p>
<p><strong>æœ¬ç¯‡ä½œè€…</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dbcc637dd954715884de9dbe304a8bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764034638&amp;x-signature=77S98A2q6FfnfTPi%2FFXqUcqOsKs%3D" alt="æœ¬ç¯‡ä½œè€….webp" loading="lazy"/></p>
<blockquote>
<p>æœ¬æœŸæœ€æ–°å®éªŒä¸ºã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D668dfdebee6ab158880f2852%26visitfrom%3D3P_Juejintail_0418%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0418" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=668dfdebee6ab158880f2852&amp;visitfrom=3P_Juejintail_0418&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0418" ref="nofollow noopener noreferrer">åˆ›æ–°åŸºçŸ³ â€”â€” åŸºäº Graviton æ„å»ºå·®å¼‚åŒ–ç”Ÿæˆå¼AIå‘é‡æ•°æ®åº“</a>ã€‹</p>
<p>âœ¨ åœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œä½ å¯ä»¥åœ¨åŸºäº Graviton çš„ EC2 å®ä¾‹ä¸Šè½»æ¾å¯åŠ¨ Milvus å‘é‡æ•°æ®åº“ï¼ŒåŠ é€Ÿæ‚¨çš„ç”Ÿæˆå¼ AI åº”ç”¨ã€‚åŸºäº Graviton çš„ EC2 å®ä¾‹ä¸ºæ‚¨æä¾›æä½³æ€§ä»·æ¯”çš„å‘é‡æ•°æ®åº“éƒ¨ç½²é€‰é¡¹ã€‚</p>
<p>ğŸ“± å³åˆ»åœ¨äº‘ä¸Šæ¢ç´¢å®éªŒå®¤ï¼Œå¼€å¯æ„å»ºå¼€å‘è€…æ¢ç´¢ä¹‹æ—…å§ï¼</p>
<p>â©[<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D668dfdebee6ab158880f2852%26visitfrom%3D3P_Juejintail_0418%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0418" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=668dfdebee6ab158880f2852&amp;visitfrom=3P_Juejintail_0418&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0418" ref="nofollow noopener noreferrer">ç‚¹å‡»è¿›å…¥å®éªŒ</a>] æ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºUniappXå¼€å‘ç”µé”€APPï¼Œå®ç°é€šè¯å½•éŸ³ä¸Šä¼ ã€é€šæ—¶é€šæ¬¡]]></title>    <link>https://juejin.cn/post/7573528564025802798</link>    <guid>https://juejin.cn/post/7573528564025802798</guid>    <pubDate>2025-11-17T10:41:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573528564025802798" data-draft-id="7573508048141385737" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºUniappXå¼€å‘ç”µé”€APPï¼Œå®ç°é€šè¯å½•éŸ³ä¸Šä¼ ã€é€šæ—¶é€šæ¬¡"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-17T10:41:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çˆ±å¿ƒå‘ç”µä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/79577698543709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºUniappXå¼€å‘ç”µé”€APPï¼Œå®ç°é€šè¯å½•éŸ³ä¸Šä¼ ã€é€šæ—¶é€šæ¬¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/79577698543709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çˆ±å¿ƒå‘ç”µä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T10:41:45.000Z" title="Mon Nov 17 2025 10:41:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnicen.cn%2F8524.html" target="_blank" title="https://nicen.cn/8524.html" ref="nofollow noopener noreferrer">nicen.cn/8524.html</a></p>
<p>ä¹‹å‰é€šè¿‡Uniapp+Html5pluså®ç°è¿‡å®ç°é€šè¯å½•éŸ³ä¸Šä¼ çš„åŠŸèƒ½ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªç—›ç‚¹ï¼šå½•éŸ³æ–‡ä»¶å¾ˆå¤šçš„æ—¶å€™é€šè¿‡htmlplusæ¥è·å–å½•éŸ³æ–‡ä»¶ä¼šå¾ˆå¡ã€‚</p>
<p>åˆšå¥½çœ‹åˆ°æ–°å‡ºçš„UniappXå¯ä»¥ç›´æ¥æŠŠç±»ä¼¼tsçš„utsä»£ç ç¼–è¯‘æˆåŸç”Ÿä»£ç ï¼Œè€Œä¸”æ•´ä¸ªå¼€å‘æµç¨‹éƒ½å¯ä»¥åœ¨Hbuilderå†…å®Œæˆï¼Œäºæ˜¯ä¹æ¥äº†å…´è¶£ï¼Œè¯•ä¸Šä¸€è¯•ï¼</p>
<h2 data-id="heading-0">å¼€å‘æ€è·¯</h2>
<p>æ—¢ç„¶å¯ä»¥é€šè¿‡utsæ¥å®ç°åŸç”Ÿå¼€å‘ï¼Œä½†æ˜¯åˆæƒ³ä¿æŒWebæ¥è¿›è¡ŒAPPçš„å‰ç«¯å¼€å‘ï¼Œé‚£å°±ç›´æ¥ç”¨è€ä¸€å¥—çš„æ··åˆå¼€å‘çš„æ–¹å¼ï¼šé€šè¿‡JSè°ƒç”¨å†™å¥½çš„åŸç”Ÿæ–¹æ³•ã€‚</p>
<p>ç›¸å…³ä»£ç å·²å¼€æºï¼ŒGithubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffriend-nicen%2Funicall" target="_blank" title="https://github.com/friend-nicen/unicall" ref="nofollow noopener noreferrer">github.com/friend-niceâ€¦</a></p>
<h3 data-id="heading-1">1.é€šè¿‡utså®ç°è¯»å–å½•éŸ³æ–‡ä»¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/* å°†åŠŸèƒ½å°è£…ä¸ºç±»ï¼šåœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½® audioPath */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Scanner</span> {

    ....

<span class="hljs-comment">/* è¯»å–ç›®å½•ä¸‹æœ€æ–°çš„å½•éŸ³æ–‡ä»¶ */</span>
<span class="hljs-title function_">getLatestAudio</span>(option : <span class="hljs-title class_">QueryLatest</span>) : <span class="hljs-title class_">LatestAudioResult</span> {

    <span class="hljs-comment">/*  å®šä¹‰å½•éŸ³æ–‡ä»¶è·¯å¾„ */</span>
    <span class="hljs-keyword">if</span> (option.<span class="hljs-property">audioPath</span> != <span class="hljs-literal">null</span>) {
        option.<span class="hljs-property">audioPath</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sdRoot</span> + option.<span class="hljs-property">audioPath</span>;
        <span class="hljs-keyword">const</span> initDir = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(option.<span class="hljs-property">audioPath</span> <span class="hljs-keyword">as</span> string);
        <span class="hljs-keyword">if</span> (!initDir.<span class="hljs-title function_">exists</span>() || !!initDir.<span class="hljs-title function_">isDirectory</span>()) {
            option.<span class="hljs-property">audioPath</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDevicePath</span>();
        }
    } <span class="hljs-keyword">else</span> {
        option.<span class="hljs-property">audioPath</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDevicePath</span>();
    }

    <span class="hljs-comment">/* ç›®å½•å¯¹è±¡ */</span>
    <span class="hljs-keyword">const</span> dir = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(option.<span class="hljs-property">audioPath</span> <span class="hljs-keyword">as</span> string);

    <span class="hljs-keyword">if</span> (!dir.<span class="hljs-title function_">exists</span>() || !dir.<span class="hljs-title function_">isDirectory</span>()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UniError</span>(<span class="hljs-string">'scanner'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'å½•éŸ³æ–‡ä»¶ç›®å½•ä¸å­˜åœ¨'</span>);
    }

    <span class="hljs-keyword">const</span> files = dir.<span class="hljs-title function_">listFiles</span>();
    <span class="hljs-keyword">if</span> (files == <span class="hljs-literal">null</span> || files.<span class="hljs-property">size</span> == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UniError</span>(<span class="hljs-string">'scanner'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'æœ¬æ¬¡é€šè¯æ²¡æœ‰äº§ç”Ÿå½•éŸ³æ–‡ä»¶'</span>);
    }

    <span class="hljs-keyword">let</span> latest : <span class="hljs-title class_">File</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> countInt : <span class="hljs-title class_">Int</span> = files.<span class="hljs-property">size</span>;
    <span class="hljs-keyword">const</span> count : number = countInt;
    option.<span class="hljs-property">latestTime</span> = option.<span class="hljs-property">latestTime</span> * <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i : <span class="hljs-title class_">Int</span> = <span class="hljs-number">0</span>; i &lt; countInt; i = i + <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">const</span> f = files[i];
        <span class="hljs-keyword">if</span> (f != <span class="hljs-literal">null</span> &amp;&amp; f.<span class="hljs-title function_">isFile</span>()) {
            <span class="hljs-keyword">const</span> lm = f.<span class="hljs-title function_">lastModified</span>();
            <span class="hljs-keyword">if</span> (lm &gt;= option.<span class="hljs-property">latestTime</span>) {
                latest = f;
                option.<span class="hljs-property">latestTime</span> = lm;
            }
        }
    }

    <span class="hljs-keyword">if</span> (latest != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">file</span>: latest.<span class="hljs-title function_">getAbsolutePath</span>(), <span class="hljs-attr">count</span>: count };
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UniError</span>(<span class="hljs-string">'scanner'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'æœ¬æ¬¡é€šè¯æ²¡æœ‰äº§ç”Ÿå½•éŸ³æ–‡ä»¶'</span>);
}

	....
}
</code></pre>
<p>ä»¥ä¸‹çœç•¥äº†è‹¥å¹²ä»£ç ï¼Œä»…å±•ç¤ºæ ¸å¿ƒä»£ç ï¼Œå®Œæ•´ä»£ç è¯·æŸ¥çœ‹ä¸Šæ–¹å¼€æºé¡¹ç›®</p>
<h3 data-id="heading-2">2.é€šè¿‡webviewå¯¹è±¡å‘jsæä¾›ç›´æ¥è°ƒç”¨çš„æ–¹æ³•</h3>
<p>é€šè¿‡ç›‘å¬webviewç»„ä»¶çš„messageäº‹ä»¶ï¼Œæ¥è·å–jså‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œç„¶åè¿›è¡Œå¯¹åº”çš„å¤„ç†ï¼Œæœ€åé€šè¿‡webviewå¯¹è±¡çš„evalJsæ–¹æ³•ï¼Œå°†ç»“æœå›è°ƒç»™å‰ç«¯ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/* æ¶ˆæ¯ç›‘å¬ */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onPostMessage</span> = (<span class="hljs-params">e</span>) =&gt; {

  <span class="hljs-comment">/* æ•°æ® */</span>
  <span class="hljs-keyword">const</span> _list = e.<span class="hljs-property">detail</span>.<span class="hljs-property">data</span>;
  <span class="hljs-keyword">const</span> _action = _list[<span class="hljs-number">0</span>].<span class="hljs-property">action</span>;
  <span class="hljs-keyword">const</span> _data = _list[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>;


  <span class="hljs-comment">/* åˆå§‹åŒ– */</span>
  <span class="hljs-keyword">if</span> (!_wv) {

    <span class="hljs-comment">/* è·å–webviewå¯¹è±¡ */</span>
    <span class="hljs-keyword">const</span> _wvs = plus.<span class="hljs-property">webview</span>.<span class="hljs-title function_">getDisplayWebview</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">wv</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> wv.<span class="hljs-title function_">getURL</span>().<span class="hljs-title function_">indexOf</span>(host) &gt; -<span class="hljs-number">1</span>;
    });

    <span class="hljs-comment">/* å¼¹å‡ºå¼‚å¸¸ */</span>
    <span class="hljs-keyword">if</span> (!_wvs.<span class="hljs-property">length</span>) {
      load.<span class="hljs-title function_">toast</span>(<span class="hljs-string">"æœåŠ¡å¼‚å¸¸"</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">/* webviewå¯¹è±¡ */</span>
    _wv = _wvs[<span class="hljs-number">0</span>];
    _wv.<span class="hljs-property">onCall</span> = <span class="hljs-function">(<span class="hljs-params">action, success, payload</span>) =&gt;</span> {
      _wv.evalJS(<span class="hljs-string">'window.__onCall(`'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        action,
        success,
        payload
      }) + <span class="hljs-string">'`)'</span>);
    }
  }

  <span class="hljs-comment">/* åˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰è¿™ä¸ªå±æ€§ */</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (!!scanner[_action]) {
      _wv.<span class="hljs-title function_">onCall</span>(_action, <span class="hljs-literal">true</span>, scanner[_action](_data));
    }
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">const</span> match = e.<span class="hljs-property">message</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/errMsg='([^']+)'/</span>);
    _wv.<span class="hljs-title function_">onCall</span>(_action, <span class="hljs-literal">false</span>, match &amp;&amp; match[<span class="hljs-number">1</span>] ? match[<span class="hljs-number">1</span>] : <span class="hljs-string">'ç³»ç»Ÿå¼‚å¸¸'</span>);
  }


}
</code></pre>
<h3 data-id="heading-3">3.å‰ç«¯JSå°è£…å’ŒAPPé€šä¿¡çš„æ–¹æ³•</h3>
<p>é€šè¿‡ä¸‹æ–¹å°è£…çš„æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡awaitåŒæ­¥è°ƒç”¨APPå¯¹åº”çš„æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * NativeBridge.es6.js
 * ES Moduleï¼Œaction çº§å›è°ƒï¼Œé»˜è®¤ 15 s è¶…æ—¶
 * import { invoke } from './NativeBridge.es6.js';
 * await invoke({ action:'getDeviceId', timeout:10_000 });
 */</span>
<span class="hljs-keyword">const</span> pool = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);   <span class="hljs-comment">// action -&gt; {resolve, reject, timer}</span>

<span class="hljs-comment">/**
 * App å›ä¼ ç»“æœçš„å”¯ä¸€å…¨å±€é’©å­
 * è°ƒç”¨æ–¹å¼ï¼ˆAndroidï¼‰ï¼š
 * webView.evaluateJavascript('window.__onCall('{"action":"getDeviceId","success":true,"payload":"fake-123"}')', null);
 * payload å¯çœç•¥ã€‚
 */</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">__onCall</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">json</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> {action, success, payload} = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json);
        <span class="hljs-comment">/* æ ¼å¼éæ³•ï¼Œç›´æ¥ä¸¢å¼ƒ */</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> action !== <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">const</span> item = pool[action];
        <span class="hljs-comment">/* å·²è¶…æ—¶æˆ–é‡å¤å›è°ƒ */</span>
        <span class="hljs-keyword">if</span> (!item) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">const</span> {resolve, reject, timer} = item;
        <span class="hljs-built_in">clearTimeout</span>(timer);
        <span class="hljs-keyword">delete</span> pool[action];

        success ? <span class="hljs-title function_">resolve</span>(payload) : <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(payload ?? <span class="hljs-string">'native error'</span>));
    } <span class="hljs-keyword">catch</span> {
        <span class="hljs-comment">/* éåˆæ³• JSONï¼Œç›´æ¥å¿½ç•¥ */</span>
    }
};

<span class="hljs-comment">/**
 * è°ƒç”¨ App å†…éƒ¨æ–¹æ³•
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">opt</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} opt.action   - å¿…å¡«ï¼Œæ–¹æ³•å
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>}    [opt.params] - é€‰å¡«ï¼Œå‚æ•°ï¼Œé»˜è®¤ç©ºå¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} [opt.timeout=15000] - é€‰å¡«ï¼Œè¶…æ—¶æ¯«ç§’
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;any&gt;</span>}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">opt = {}</span>) {

    <span class="hljs-comment">/* é»˜è®¤é…ç½® */</span>
    <span class="hljs-keyword">const</span> {action, data = {}, timeout = <span class="hljs-number">15000</span>} = opt;

    <span class="hljs-comment">/* å‚æ•°æ ¡éªŒ */</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> action !== <span class="hljs-string">'string'</span> || !action)
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'action is required'</span>));

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        <span class="hljs-comment">/* å¦‚æœå·²å­˜åœ¨åŒ action çš„æœªå®Œæˆè°ƒç”¨ï¼Œå…ˆæ¸…æ‰ */</span>
        <span class="hljs-keyword">if</span> (pool[action]) {
            <span class="hljs-built_in">clearTimeout</span>(pool[action].<span class="hljs-property">timer</span>);
            pool[action].<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'covered by new call'</span>));
        }

        <span class="hljs-comment">/* è¶…æ—¶å™¨ï¼Œé˜²æ­¢è°ƒç”¨è¶…æ—¶ */</span>
        <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">delete</span> pool[action];
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`invoke <span class="hljs-subst">${action}</span> timeout`</span>));
        }, timeout);

        <span class="hljs-comment">/* å›è°ƒ */</span>
        pool[action] = {resolve, reject, timer};

        <span class="hljs-comment">/* å‘é€æ¶ˆæ¯ */</span>
        uni.<span class="hljs-title function_">postMessage</span>({
            <span class="hljs-attr">data</span>: {
                action,
                <span class="hljs-attr">data</span>: data
            }
        });

    });
}
</code></pre>
<h3 data-id="heading-4">4.ç›¸å…³æ‰©å±•</h3>
<p>ä¸Šæ–¹å±•ç¤ºäº†ä¸€ä¸ªé€šè¿‡UniappXç®€å•å®ç°çš„æ··åˆå¼€å‘çš„æ¡†æ¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å®ç°æ›´å¤šçš„åŸç”Ÿæ–¹æ³•æ¥æ‰©å±•åŠŸèƒ½ï¼ŒåŒæ—¶å…¼é¡¾æ€§èƒ½å’ŒWebå¼€å‘çš„ä¾¿æ·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ThreadLocalåº•å±‚å®ç°åŸç†æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7573506713866600499</link>    <guid>https://juejin.cn/post/7573506713866600499</guid>    <pubDate>2025-11-17T10:53:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573506713866600499" data-draft-id="7573508048141418505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ThreadLocalåº•å±‚å®ç°åŸç†æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-17T10:53:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·683335666080"/> <meta itemprop="url" content="https://juejin.cn/user/4418313847836760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ThreadLocalåº•å±‚å®ç°åŸç†æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4418313847836760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·683335666080
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T10:53:40.000Z" title="Mon Nov 17 2025 10:53:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆMDC.putä¼šä¸ºçº¿ç¨‹åˆ›å»ºThreadLocalï¼Ÿ</h2>
<h3 data-id="heading-1">1.1 é—®é¢˜çš„æœ¬è´¨</h3>
<p>å½“æˆ‘ä»¬è°ƒç”¨ <code>MDC.put("tid", "abc123")</code> æ—¶ï¼Œåº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æˆ‘ä»¬çœ‹åˆ°çš„ä»£ç </span>
MDC.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>);

<span class="hljs-comment">// åº•å±‚å®é™…æ‰§è¡Œ</span>
ThreadLocal&lt;Map&lt;String, String&gt;&gt; contextMap = ...;
contextMap.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;());  <span class="hljs-comment">// ä¸ºå½“å‰çº¿ç¨‹åˆ›å»ºThreadLocal</span>
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼šThreadLocalæœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œæ•°æ®å­˜å‚¨åœ¨<strong>Threadå¯¹è±¡</strong>ä¸­ï¼</p>
<h2 data-id="heading-2">äºŒã€ThreadLocalçš„åº•å±‚æ•°æ®ç»“æ„</h2>
<h3 data-id="heading-3">2.1 Threadå¯¹è±¡å†…éƒ¨ç»“æ„</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Threadç±»çš„ç®€åŒ–ç»“æ„ï¼ˆJDKæºç ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-comment">// æ¯ä¸ªThreadå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªThreadLocalMap</span>
    ThreadLocal.<span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">threadLocals</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// ç”¨äºInheritableThreadLocalï¼ˆå¯ç»§æ‰¿çš„ThreadLocalï¼‰</span>
    ThreadLocal.<span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">inheritableThreadLocals</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>å…³é”®ç†è§£</strong>ï¼š</p>
<ul>
<li>ThreadLocalMap ä¸æ˜¯å­˜å‚¨åœ¨ ThreadLocal ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ <strong>Thread å¯¹è±¡</strong>ä¸­</li>
<li>æ¯ä¸ª Thread å¯¹è±¡éƒ½æœ‰è‡ªå·±çš„ ThreadLocalMap</li>
<li>ThreadLocal åªæ˜¯ä¸€ä¸ª"é’¥åŒ™"ï¼Œç”¨æ¥è®¿é—® Thread å¯¹è±¡ä¸­çš„ Map</li>
</ul>
<h3 data-id="heading-4">2.2 ThreadLocalMapçš„å†…éƒ¨ç»“æ„</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocalMapçš„ç®€åŒ–å®ç°</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalMap</span> {
    <span class="hljs-comment">// å†…éƒ¨ä½¿ç”¨Entryæ•°ç»„å­˜å‚¨ï¼Œç±»ä¼¼HashMap</span>
    <span class="hljs-keyword">private</span> Entry[] table;
    
    <span class="hljs-comment">// Entryæ˜¯å¼±å¼•ç”¨ï¼Œkeyæ˜¯ThreadLocalå®ä¾‹ï¼Œvalueæ˜¯å®é™…å­˜å‚¨çš„å€¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; {
        Object value;  <span class="hljs-comment">// å®é™…å­˜å‚¨çš„å€¼</span>
        
        Entry(ThreadLocal&lt;?&gt; k, Object v) {
            <span class="hljs-built_in">super</span>(k);  <span class="hljs-comment">// ThreadLocalä½œä¸ºkeyï¼Œä½¿ç”¨å¼±å¼•ç”¨</span>
            value = v;  <span class="hljs-comment">// å®é™…å€¼</span>
        }
    }
}
</code></pre>
<p><strong>å†…å­˜ç»“æ„å›¾</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Threadå¯¹è±¡ (Thread-1)
  â””â”€ threadLocals: ThreadLocalMap
      â””â”€ table: Entry<span class="hljs-section">[]</span>
          â”œâ”€ Entry<span class="hljs-section">[0]</span>: <span class="hljs-attr">key</span>=MDCçš„ThreadLocalå®ä¾‹(å¼±å¼•ç”¨), value=Map{<span class="hljs-string">"tid"</span>: <span class="hljs-string">"abc123"</span>}
          â”œâ”€ Entry<span class="hljs-section">[1]</span>: <span class="hljs-attr">key</span>=å…¶ä»–ThreadLocalå®ä¾‹(å¼±å¼•ç”¨), value=å…¶ä»–å€¼
          â””â”€ Entry<span class="hljs-section">[2]</span>: null
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€MDC.putçš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹</h2>
<h3 data-id="heading-6">3.1 ä»£ç è¿½è¸ª</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ========== ç¬¬1æ­¥ï¼šè°ƒç”¨MDC.put ==========</span>
MDC.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>);

<span class="hljs-comment">// ========== ç¬¬2æ­¥ï¼šMDCå†…éƒ¨å®ç° ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MDC</span> {
    <span class="hljs-comment">// MDCå†…éƒ¨æœ‰ä¸€ä¸ªé™æ€çš„ThreadLocalå®ä¾‹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Map&lt;String, String&gt;&gt; contextMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, String value)</span> {
        <span class="hljs-comment">// 2.1 è·å–å½“å‰çº¿ç¨‹çš„Map</span>
        Map&lt;String, String&gt; map = contextMap.get();
        <span class="hljs-comment">// è¿™é‡Œä¼šè§¦å‘ThreadLocal.get()æ–¹æ³•</span>
        
        <span class="hljs-comment">// 2.2 å¦‚æœMapä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°Map</span>
        <span class="hljs-keyword">if</span> (map == <span class="hljs-literal">null</span>) {
            map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            contextMap.set(map);  <span class="hljs-comment">// è¿™é‡Œä¼šè§¦å‘ThreadLocal.set()æ–¹æ³•</span>
        }
        
        <span class="hljs-comment">// 2.3 å­˜å‚¨key-value</span>
        map.put(key, value);
    }
}
</code></pre>
<h3 data-id="heading-7">3.2 ThreadLocal.get()çš„åº•å±‚å®ç°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocal.get()çš„å®Œæ•´å®ç°ï¼ˆJDKæºç ç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    
    <span class="hljs-comment">// 2. è·å–çº¿ç¨‹å¯¹è±¡ä¸­çš„ThreadLocalMap</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-comment">// getMap(t) å®é™…å°±æ˜¯: return t.threadLocals;</span>
    
    <span class="hljs-comment">// 3. å¦‚æœMapå­˜åœ¨ï¼Œä»Mapä¸­è·å–å€¼</span>
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 3.1 ä»¥å½“å‰ThreadLocalå®ä¾‹ä¸ºkeyï¼ŒæŸ¥æ‰¾Entry</span>
        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
        <span class="hljs-comment">// this æ˜¯ MDCçš„ThreadLocalå®ä¾‹</span>
        
        <span class="hljs-comment">// 3.2 å¦‚æœæ‰¾åˆ°Entryï¼Œè¿”å›value</span>
        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
            <span class="hljs-keyword">return</span> result;
        }
    }
    
    <span class="hljs-comment">// 4. å¦‚æœMapä¸å­˜åœ¨æˆ–æ‰¾ä¸åˆ°Entryï¼Œè¿”å›null</span>
    <span class="hljs-keyword">return</span> setInitialValue();
}
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹å›¾</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">MDC.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>)
  â†“
contextMap.<span class="hljs-keyword">get</span>()
  â†“
Thread.currentThread()  â†’ è·å–å½“å‰çº¿ç¨‹å¯¹è±¡
  â†“
t.threadLocals  â†’ è·å–çº¿ç¨‹çš„ThreadLocalMap
  â†“
å¦‚æœthreadLocals == <span class="hljs-literal">null</span>
  â†“
è¿”å›<span class="hljs-literal">null</span>ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼‰
  â†“
contextMap.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">new</span> HashMap&lt;&gt;())
</code></pre>
<h3 data-id="heading-8">3.3 ThreadLocal.set()çš„åº•å±‚å®ç°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocal.set()çš„å®Œæ•´å®ç°ï¼ˆJDKæºç ç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
    <span class="hljs-comment">// 1. è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    
    <span class="hljs-comment">// 2. è·å–çº¿ç¨‹å¯¹è±¡ä¸­çš„ThreadLocalMap</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-comment">// getMap(t) å®é™…å°±æ˜¯: return t.threadLocals;</span>
    
    <span class="hljs-comment">// 3. å¦‚æœMapå­˜åœ¨ï¼Œç›´æ¥è®¾ç½®å€¼</span>
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-comment">// this æ˜¯ MDCçš„ThreadLocalå®ä¾‹</span>
        <span class="hljs-comment">// value æ˜¯ new HashMap&lt;&gt;()</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 4. å¦‚æœMapä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„ThreadLocalMap</span>
        createMap(t, value);
        <span class="hljs-comment">// createMap(t, value) å®é™…å°±æ˜¯:</span>
        <span class="hljs-comment">//     t.threadLocals = new ThreadLocalMap(this, value);</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><code>createMap(t, value)</code> ä¼šåˆ›å»ºæ–°çš„ ThreadLocalMap å¹¶èµ‹å€¼ç»™ <code>t.threadLocals</code></li>
<li>è¿™å°±æ˜¯"ä¸ºçº¿ç¨‹åˆ›å»ºThreadLocal"çš„æœ¬è´¨ï¼š<strong>åœ¨Threadå¯¹è±¡ä¸­åˆ›å»ºThreadLocalMap</strong></li>
</ul>
<h3 data-id="heading-9">3.4 createMapçš„è¯¦ç»†è¿‡ç¨‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocal.createMap()çš„å®ç°</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> {
    <span class="hljs-comment">// åˆ›å»ºæ–°çš„ThreadLocalMapï¼Œå¹¶èµ‹å€¼ç»™çº¿ç¨‹çš„threadLocalså­—æ®µ</span>
    t.threadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);
    <span class="hljs-comment">// this æ˜¯ MDCçš„ThreadLocalå®ä¾‹</span>
    <span class="hljs-comment">// firstValue æ˜¯ new HashMap&lt;&gt;()</span>
}

<span class="hljs-comment">// ThreadLocalMapçš„æ„é€ å‡½æ•°</span>
ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) {
    <span class="hljs-comment">// 1. åˆ›å»ºEntryæ•°ç»„ï¼ˆåˆå§‹å®¹é‡16ï¼‰</span>
    table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[INITIAL_CAPACITY];
    
    <span class="hljs-comment">// 2. è®¡ç®—ThreadLocalå®ä¾‹çš„hashå€¼ï¼Œç¡®å®šåœ¨æ•°ç»„ä¸­çš„ä½ç½®</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="hljs-number">1</span>);
    
    <span class="hljs-comment">// 3. åˆ›å»ºEntryå¹¶å­˜å‚¨åˆ°æ•°ç»„ä¸­</span>
    table[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(firstKey, firstValue);
    <span class="hljs-comment">// Entryå­˜å‚¨ï¼š</span>
    <span class="hljs-comment">//   - key: MDCçš„ThreadLocalå®ä¾‹ï¼ˆå¼±å¼•ç”¨ï¼‰</span>
    <span class="hljs-comment">//   - value: new HashMap&lt;&gt;()</span>
    
    size = <span class="hljs-number">1</span>;
}
</code></pre>
<h2 data-id="heading-10">å››ã€å®Œæ•´çš„å†…å­˜æ¨¡å‹</h2>
<h3 data-id="heading-11">4.1 ç¬¬ä¸€æ¬¡è°ƒç”¨MDC.putæ—¶çš„å†…å­˜çŠ¶æ€</h3>
<pre><code class="hljs language-csharp" lang="csharp">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œå‰ï¼š                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ Thread<span class="hljs-number">-1</span>å¯¹è±¡                                                      â”‚
â”‚   â””â”€ threadLocals: <span class="hljs-literal">null</span>  â† è¿˜æ²¡æœ‰ThreadLocalMap                 â”‚
â”‚                                                                   â”‚
â”‚ MDCç±»ï¼ˆé™æ€ï¼‰                                                     â”‚
â”‚   â””â”€ contextMap: ThreadLocalå®ä¾‹ï¼ˆæ‰€æœ‰çº¿ç¨‹å…±äº«è¿™ä¸ªå®ä¾‹ï¼‰          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œ: MDC.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ ç¬¬<span class="hljs-number">1</span>æ­¥: contextMap.<span class="hljs-keyword">get</span>()                                          â”‚
â”‚   â”œâ”€ Thread.currentThread() â†’ Thread<span class="hljs-number">-1</span>å¯¹è±¡                       â”‚
â”‚   â”œâ”€ Thread<span class="hljs-number">-1.</span>threadLocals â†’ <span class="hljs-literal">null</span>                              â”‚
â”‚   â””â”€ è¿”å›<span class="hljs-literal">null</span>                                                    â”‚
â”‚                                                                   â”‚
â”‚ ç¬¬<span class="hljs-number">2</span>æ­¥: contextMap.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">new</span> HashMap&lt;&gt;())                           â”‚
â”‚   â”œâ”€ Thread.currentThread() â†’ Thread<span class="hljs-number">-1</span>å¯¹è±¡                       â”‚
â”‚   â”œâ”€ Thread<span class="hljs-number">-1.</span>threadLocals â†’ <span class="hljs-literal">null</span>ï¼ˆä¸å­˜åœ¨ï¼‰                     â”‚
â”‚   â”œâ”€ createMap(Thread<span class="hljs-number">-1</span>, <span class="hljs-keyword">new</span> HashMap&lt;&gt;())                       â”‚
â”‚   â”‚   â””â”€ Thread<span class="hljs-number">-1.</span>threadLocals = <span class="hljs-keyword">new</span> ThreadLocalMap(...)       â”‚
â”‚   â”‚       â””â”€ table[<span class="hljs-number">0</span>] = Entry(MDCçš„ThreadLocalå®ä¾‹, HashMap)    â”‚
â”‚   â””â”€ ç°åœ¨Thread<span class="hljs-number">-1</span>æœ‰äº†ThreadLocalMap                             â”‚
â”‚                                                                   â”‚
â”‚ ç¬¬<span class="hljs-number">3</span>æ­¥: map.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>)                                 â”‚
â”‚   â””â”€ åœ¨HashMapä¸­å­˜å‚¨key-<span class="hljs-keyword">value</span>                                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œåï¼š                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ Thread<span class="hljs-number">-1</span>å¯¹è±¡                                                      â”‚
â”‚   â””â”€ threadLocals: ThreadLocalMap                                â”‚
â”‚       â””â”€ table: Entry[]                                          â”‚
â”‚           â””â”€ Entry[<span class="hljs-number">0</span>]:                                           â”‚
â”‚               â”œâ”€ key: MDCçš„ThreadLocalå®ä¾‹ï¼ˆå¼±å¼•ç”¨ï¼‰             â”‚
â”‚               â””â”€ <span class="hljs-keyword">value</span>: HashMap{<span class="hljs-string">"tid"</span>: <span class="hljs-string">"abc123"</span>}                 â”‚
â”‚                                                                   â”‚
â”‚ Thread<span class="hljs-number">-2</span>å¯¹è±¡ï¼ˆå¦ä¸€ä¸ªçº¿ç¨‹ï¼‰                                       â”‚
â”‚   â””â”€ threadLocals: <span class="hljs-literal">null</span>  â† è¿˜æ²¡æœ‰è°ƒç”¨MDC.put                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-12">4.2 ç¬¬äºŒæ¬¡è°ƒç”¨MDC.putæ—¶çš„å†…å­˜çŠ¶æ€</h3>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œ: MDC.<span class="hljs-built_in">put</span>(<span class="hljs-string">"EagleEye-TraceID"</span>, <span class="hljs-string">"abc123"</span>)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ ç¬¬<span class="hljs-number">1</span>æ­¥: contextMap.<span class="hljs-built_in">get</span>()                                          â”‚
â”‚   â”œâ”€ Thread.<span class="hljs-built_in">currentThread</span>() â†’ Thread-<span class="hljs-number">1</span>å¯¹è±¡                       â”‚
â”‚   â”œâ”€ Thread-<span class="hljs-number">1</span>.threadLocals â†’ ThreadLocalMapï¼ˆå·²å­˜åœ¨ï¼‰            â”‚
â”‚   â”œâ”€ map.<span class="hljs-built_in">getEntry</span>(MDCçš„ThreadLocalå®ä¾‹)                         â”‚
â”‚   â”‚   â””â”€ åœ¨tableä¸­æ‰¾åˆ°Entry[<span class="hljs-number">0</span>]                                  â”‚
â”‚   â””â”€ è¿”å›: HashMap{"tid": <span class="hljs-string">"abc123"</span>}                             â”‚
â”‚                                                                   â”‚
â”‚ ç¬¬<span class="hljs-number">2</span>æ­¥: map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"EagleEye-TraceID"</span>, <span class="hljs-string">"abc123"</span>)                    â”‚
â”‚   â””â”€ åœ¨å·²æœ‰çš„HashMapä¸­æ·»åŠ æ–°çš„key-value                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œåï¼š                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ Thread-<span class="hljs-number">1</span>å¯¹è±¡                                                      â”‚
â”‚   â””â”€ threadLocals: ThreadLocalMapï¼ˆåŒä¸€ä¸ªMapï¼‰                   â”‚
â”‚       â””â”€ table: Entry[]                                          â”‚
â”‚           â””â”€ Entry[<span class="hljs-number">0</span>]:                                           â”‚
â”‚               â”œâ”€ key: MDCçš„ThreadLocalå®ä¾‹ï¼ˆå¼±å¼•ç”¨ï¼‰             â”‚
â”‚               â””â”€ value: HashMap{                                 â”‚
â”‚                     "tid": <span class="hljs-string">"abc123"</span>,                             â”‚
â”‚                     <span class="hljs-string">"EagleEye-TraceID"</span>: <span class="hljs-string">"abc123"</span>                 â”‚
â”‚                   }                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 data-id="heading-13">äº”ã€ThreadLocalMapçš„å“ˆå¸Œç®—æ³•</h2>
<h3 data-id="heading-14">5.1 ä¸ºä»€ä¹ˆä½¿ç”¨æ•°ç»„è€Œä¸æ˜¯HashMapï¼Ÿ</h3>
<p><strong>ThreadLocalMapä½¿ç”¨æ•°ç»„+å¼€æ”¾åœ°å€æ³•</strong>ï¼Œè€Œä¸æ˜¯HashMapçš„æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocalMapçš„å“ˆå¸Œç®—æ³•</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getIndex</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key)</span> {
    <span class="hljs-comment">// 1. è·å–ThreadLocalå®ä¾‹çš„hashCode</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> key.threadLocalHashCode;
    
    <span class="hljs-comment">// 2. è®¡ç®—æ•°ç»„ç´¢å¼•ï¼ˆå–æ¨¡è¿ç®—ï¼‰</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> hashCode &amp; (table.length - <span class="hljs-number">1</span>);
    <span class="hljs-comment">// ç­‰ä»·äº: index = hashCode % table.length</span>
    <span class="hljs-comment">// ä½†ä½è¿ç®—æ›´å¿«</span>
    
    <span class="hljs-keyword">return</span> index;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨å¼€æ”¾åœ°å€æ³•ï¼Ÿ</strong></p>
<ul>
<li>ThreadLocalçš„æ•°é‡é€šå¸¸å¾ˆå°‘ï¼ˆæ¯ä¸ªçº¿ç¨‹å¯èƒ½åªæœ‰å‡ ä¸ªThreadLocalï¼‰</li>
<li>å¼€æ”¾åœ°å€æ³•åœ¨æ•°æ®é‡å°æ—¶æ€§èƒ½æ›´å¥½ï¼Œå†…å­˜å ç”¨æ›´å°‘</li>
<li>é¿å…é“¾è¡¨/çº¢é»‘æ ‘çš„é¢å¤–å†…å­˜å¼€é”€</li>
</ul>
<h3 data-id="heading-15">5.2 ThreadLocalçš„hashCodeç”Ÿæˆ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocalç±»ä¸­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; {
    <span class="hljs-comment">// æ¯ä¸ªThreadLocalå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„hashCode</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">threadLocalHashCode</span> <span class="hljs-operator">=</span> nextHashCode();
    
    <span class="hljs-comment">// é™æ€è®¡æ•°å™¨ï¼Œæ¯æ¬¡åˆ›å»ºThreadLocalå®ä¾‹æ—¶é€’å¢</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">nextHashCode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();
    
    <span class="hljs-comment">// æ¯æ¬¡é€’å¢çš„å€¼ï¼ˆé»„é‡‘æ¯”ä¾‹ç›¸å…³ï¼Œç”¨äºæ›´å¥½çš„å“ˆå¸Œåˆ†å¸ƒï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">HASH_INCREMENT</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x61c88647</span>;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextHashCode</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);
    }
}
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºç¬¬ä¸€ä¸ªThreadLocal</span>
ThreadLocal&lt;Map&gt; contextMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
<span class="hljs-comment">// threadLocalHashCode = 0</span>

<span class="hljs-comment">// åˆ›å»ºç¬¬äºŒä¸ªThreadLocal</span>
ThreadLocal&lt;String&gt; otherMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
<span class="hljs-comment">// threadLocalHashCode = 0x61c88647</span>

<span class="hljs-comment">// åˆ›å»ºç¬¬ä¸‰ä¸ªThreadLocal</span>
ThreadLocal&lt;Integer&gt; anotherMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
<span class="hljs-comment">// threadLocalHashCode = 0x61c88647 * 2</span>
</code></pre>
<h2 data-id="heading-16">å…­ã€å¼±å¼•ç”¨çš„ä½œç”¨</h2>
<h3 data-id="heading-17">6.1 Entryä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› </h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; {
    Object value;
    
    Entry(ThreadLocal&lt;?&gt; k, Object v) {
        <span class="hljs-built_in">super</span>(k);  <span class="hljs-comment">// ThreadLocalä½œä¸ºkeyï¼Œä½¿ç”¨å¼±å¼•ç”¨</span>
        value = v;
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆkeyä½¿ç”¨å¼±å¼•ç”¨ï¼Ÿ</strong></p>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¦‚æœkeyä½¿ç”¨å¼ºå¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    ThreadLocal&lt;Map&gt; local = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    local.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;());
    <span class="hljs-comment">// localå˜é‡è¶…å‡ºä½œç”¨åŸŸï¼Œä½†ThreadLocalMapä¸­çš„Entryä»ç„¶æŒæœ‰å¼ºå¼•ç”¨</span>
    <span class="hljs-comment">// ThreadLocalå¯¹è±¡æ— æ³•è¢«GCå›æ”¶ â†’ å†…å­˜æ³„æ¼</span>
}

<span class="hljs-comment">// å¦‚æœkeyä½¿ç”¨å¼±å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    ThreadLocal&lt;Map&gt; local = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    local.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;());
    <span class="hljs-comment">// localå˜é‡è¶…å‡ºä½œç”¨åŸŸ</span>
    <span class="hljs-comment">// ThreadLocalå¯¹è±¡å¯ä»¥è¢«GCå›æ”¶ï¼ˆå› ä¸ºåªæœ‰å¼±å¼•ç”¨ï¼‰</span>
    <span class="hljs-comment">// ä½†valueä»ç„¶å­˜åœ¨ â†’ éœ€è¦æ‰‹åŠ¨æ¸…ç†</span>
}
</code></pre>
<p><strong>å†…å­˜æ³„æ¼é£é™©</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">Thread-<span class="hljs-number">1</span><span class="hljs-selector-class">.threadLocals</span>
  â””â”€ Entry<span class="hljs-selector-attr">[0]</span>:
      â”œâ”€ key: ThreadLocalå®ä¾‹ï¼ˆå¼±å¼•ç”¨ï¼‰â† å¯ä»¥è¢«GCå›æ”¶
      â””â”€ value: HashMapï¼ˆå¼ºå¼•ç”¨ï¼‰â† å¦‚æœThreadLocalè¢«å›æ”¶ï¼Œè¿™ä¸ªvalueå°±<span class="hljs-string">"æ³„æ¼"</span>äº†
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ThreadLocalMapåœ¨get/setæ—¶ä¼šæ¸…ç†keyä¸ºnullçš„Entryï¼ˆstale entriesï¼‰</li>
<li>ä½†æœ€å¥½çš„åšæ³•æ˜¯ï¼š<strong>ä½¿ç”¨å®Œåè°ƒç”¨remove()æˆ–clear()</strong></li>
</ul>
<h2 data-id="heading-18">ä¸ƒã€å®Œæ•´æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h2>
<h3 data-id="heading-19">7.1 ç¬¬ä¸€æ¬¡è°ƒç”¨MDC.putçš„å®Œæ•´è¿‡ç¨‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ========== ä»£ç è°ƒç”¨ ==========</span>
MDC.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>);

<span class="hljs-comment">// ========== ç¬¬1æ­¥ï¼šMDC.put()æ–¹æ³• ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, String value)</span> {
    Map&lt;String, String&gt; map = contextMap.get();
    <span class="hljs-comment">// è°ƒç”¨ThreadLocal.get()</span>
}

<span class="hljs-comment">// ========== ç¬¬2æ­¥ï¼šThreadLocal.get() ==========</span>
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// t = Thread-http-nio-8001-exec-1å¯¹è±¡</span>
    
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-comment">// getMap(t) = t.threadLocals</span>
    <span class="hljs-comment">// æ­¤æ—¶ t.threadLocals = nullï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ï¼‰</span>
    
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// ä¸æ‰§è¡Œï¼ˆmapä¸ºnullï¼‰</span>
    }
    
    <span class="hljs-keyword">return</span> setInitialValue();
    <span class="hljs-comment">// è°ƒç”¨setInitialValue()</span>
}

<span class="hljs-comment">// ========== ç¬¬3æ­¥ï¼šThreadLocal.setInitialValue() ==========</span>
<span class="hljs-keyword">private</span> T <span class="hljs-title function_">setInitialValue</span><span class="hljs-params">()</span> {
    <span class="hljs-type">T</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> initialValue();
    <span class="hljs-comment">// initialValue()è¿”å›nullï¼ˆThreadLocalçš„é»˜è®¤å®ç°ï¼‰</span>
    
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-comment">// map = null</span>
    
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// ä¸æ‰§è¡Œ</span>
    } <span class="hljs-keyword">else</span> {
        createMap(t, value);
        <span class="hljs-comment">// åˆ›å»ºThreadLocalMap</span>
    }
    
    <span class="hljs-keyword">return</span> value;  <span class="hljs-comment">// è¿”å›null</span>
}

<span class="hljs-comment">// ========== ç¬¬4æ­¥ï¼šThreadLocal.createMap() ==========</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> {
    t.threadLocals = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocalMap</span>(<span class="hljs-built_in">this</span>, firstValue);
    <span class="hljs-comment">// this = MDCçš„ThreadLocalå®ä¾‹</span>
    <span class="hljs-comment">// firstValue = nullï¼ˆä½†åé¢ä¼šé‡æ–°setï¼‰</span>
}

<span class="hljs-comment">// ========== ç¬¬5æ­¥ï¼šThreadLocalMapæ„é€ å‡½æ•° ==========</span>
ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) {
    table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[INITIAL_CAPACITY];  <span class="hljs-comment">// åˆ›å»º16å¤§å°çš„æ•°ç»„</span>
    
    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="hljs-number">1</span>);
    <span class="hljs-comment">// è®¡ç®—å“ˆå¸Œç´¢å¼•ï¼Œå‡è®¾ i = 3</span>
    
    table[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(firstKey, firstValue);
    <span class="hljs-comment">// table[3] = Entry(MDCçš„ThreadLocalå®ä¾‹, null)</span>
    
    size = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// ========== ç¬¬6æ­¥ï¼šå›åˆ°MDC.put() ==========</span>
Map&lt;String, String&gt; map = contextMap.get();
<span class="hljs-comment">// map = nullï¼ˆå› ä¸ºsetInitialValueè¿”å›nullï¼‰</span>

<span class="hljs-keyword">if</span> (map == <span class="hljs-literal">null</span>) {
    map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    contextMap.set(map);
    <span class="hljs-comment">// è°ƒç”¨ThreadLocal.set()</span>
}

<span class="hljs-comment">// ========== ç¬¬7æ­¥ï¼šThreadLocal.set() ==========</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-comment">// map = ThreadLocalMapï¼ˆå·²å­˜åœ¨ï¼‰</span>
    
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-comment">// åœ¨ThreadLocalMapä¸­è®¾ç½®å€¼</span>
    }
}

<span class="hljs-comment">// ========== ç¬¬8æ­¥ï¼šThreadLocalMap.set() ==========</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key, Object value)</span> {
    Entry[] tab = table;
    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;
    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> key.threadLocalHashCode &amp; (len - <span class="hljs-number">1</span>);
    <span class="hljs-comment">// è®¡ç®—ç´¢å¼•ï¼Œå‡è®¾ i = 3</span>
    
    <span class="hljs-comment">// æŸ¥æ‰¾Entryï¼ˆå¤„ç†å“ˆå¸Œå†²çªï¼‰</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i]; e != <span class="hljs-literal">null</span>; e = tab[i = nextIndex(i, len)]) {
        ThreadLocal&lt;?&gt; k = e.get();
        
        <span class="hljs-keyword">if</span> (k == key) {
            <span class="hljs-comment">// æ‰¾åˆ°å¯¹åº”çš„Entryï¼Œæ›´æ–°value</span>
            e.value = value;
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// keyè¢«GCå›æ”¶äº†ï¼Œæ›¿æ¢è¿™ä¸ªstale entry</span>
            replaceStaleEntry(key, value, i);
            <span class="hljs-keyword">return</span>;
        }
    }
    
    <span class="hljs-comment">// æ²¡æ‰¾åˆ°ï¼Œåˆ›å»ºæ–°Entry</span>
    tab[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(key, value);
    <span class="hljs-comment">// table[3].value = new HashMap&lt;&gt;()</span>
    
    <span class="hljs-type">int</span> <span class="hljs-variable">sz</span> <span class="hljs-operator">=</span> ++size;
    <span class="hljs-keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) {
        rehash();  <span class="hljs-comment">// æ‰©å®¹</span>
    }
}

<span class="hljs-comment">// ========== ç¬¬9æ­¥ï¼šå›åˆ°MDC.put() ==========</span>
map.put(<span class="hljs-string">"tid"</span>, <span class="hljs-string">"abc123"</span>);
<span class="hljs-comment">// åœ¨HashMapä¸­å­˜å‚¨key-value</span>
</code></pre>
<h3 data-id="heading-20">7.2 å†…å­˜çŠ¶æ€å˜åŒ–</h3>
<pre><code class="hljs language-ini" lang="ini">æ‰§è¡Œå‰ï¼š
<span class="hljs-attr">Thread-1.threadLocals</span> = null

æ‰§è¡ŒcreateMapåï¼š
<span class="hljs-attr">Thread-1.threadLocals</span> = ThreadLocalMap {
    table<span class="hljs-section">[3]</span> = Entry(MDCçš„ThreadLocalå®ä¾‹, null)
}

æ‰§è¡Œsetåï¼š
<span class="hljs-attr">Thread-1.threadLocals</span> = ThreadLocalMap {
    table<span class="hljs-section">[3]</span> = Entry(MDCçš„ThreadLocalå®ä¾‹, HashMap{})
}

æ‰§è¡Œmap.putåï¼š
<span class="hljs-attr">Thread-1.threadLocals</span> = ThreadLocalMap {
    table<span class="hljs-section">[3]</span> = Entry(MDCçš„ThreadLocalå®ä¾‹, HashMap{"tid": "abc123"})
}
</code></pre>
<h2 data-id="heading-21">å…«ã€ä¸ºä»€ä¹ˆæ¯ä¸ªçº¿ç¨‹çš„ThreadLocalæ˜¯ç‹¬ç«‹çš„ï¼Ÿ</h2>
<h3 data-id="heading-22">8.1 å…³é”®æœºåˆ¶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadLocal.get()çš„å®ç°</span>
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();  <span class="hljs-comment">// â† å…³é”®ï¼šè·å–å½“å‰çº¿ç¨‹</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);     <span class="hljs-comment">// â† å…³é”®ï¼šä»å½“å‰çº¿ç¨‹è·å–Map</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ol>
<li><code>Thread.currentThread()</code> è¿”å›çš„æ˜¯<strong>å½“å‰æ‰§è¡Œä»£ç çš„çº¿ç¨‹å¯¹è±¡</strong></li>
<li>æ¯ä¸ªçº¿ç¨‹å¯¹è±¡éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ <code>threadLocals</code> å­—æ®µ</li>
<li>æ‰€ä»¥æ¯ä¸ªçº¿ç¨‹è®¿é—®çš„æ˜¯è‡ªå·±çš„ ThreadLocalMap</li>
</ol>
<h3 data-id="heading-23">8.2 å¤šçº¿ç¨‹ç¤ºä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çº¿ç¨‹1æ‰§è¡Œ</span>
Thread-<span class="hljs-number">1</span>: 
  Thread.currentThread() â†’ Thread-<span class="hljs-number">1</span>å¯¹è±¡
  Thread-<span class="hljs-number">1.</span>threadLocals â†’ Thread-<span class="hljs-number">1</span>çš„ThreadLocalMap
  MDC.get(<span class="hljs-string">"tid"</span>) â†’ ä»Thread-<span class="hljs-number">1</span>çš„Mapè¯»å–

<span class="hljs-comment">// çº¿ç¨‹2æ‰§è¡Œï¼ˆåŒæ—¶ï¼‰</span>
Thread-<span class="hljs-number">2</span>:
  Thread.currentThread() â†’ Thread-<span class="hljs-number">2</span>å¯¹è±¡
  Thread-<span class="hljs-number">2.</span>threadLocals â†’ Thread-<span class="hljs-number">2</span>çš„ThreadLocalMap
  MDC.get(<span class="hljs-string">"tid"</span>) â†’ ä»Thread-<span class="hljs-number">2</span>çš„Mapè¯»å–

<span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹äº’ä¸å¹²æ‰°</span>
</code></pre>
<h2 data-id="heading-24">ä¹ã€æ€»ç»“</h2>
<h3 data-id="heading-25">9.1 æ ¸å¿ƒåŸç†</h3>
<ol>
<li><strong>ThreadLocalä¸å­˜å‚¨æ•°æ®</strong>ï¼šThreadLocalåªæ˜¯ä¸€ä¸ª"é’¥åŒ™"</li>
<li><strong>æ•°æ®å­˜å‚¨åœ¨Threadå¯¹è±¡ä¸­</strong>ï¼šæ¯ä¸ªThreadå¯¹è±¡æœ‰<code>threadLocals</code>å­—æ®µ</li>
<li><strong>ThreadLocalMapæ˜¯å®é™…å­˜å‚¨</strong>ï¼šç±»ä¼¼HashMapï¼Œä½†ä½¿ç”¨æ•°ç»„+å¼€æ”¾åœ°å€æ³•</li>
<li><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆ›å»º</strong>ï¼šè°ƒç”¨<code>set()</code>æ—¶ï¼Œå¦‚æœThreadçš„<code>threadLocals</code>ä¸ºnullï¼Œä¼šåˆ›å»ºæ–°çš„ThreadLocalMap</li>
</ol>
<h3 data-id="heading-26">9.2 æ‰§è¡Œæµç¨‹</h3>
<pre><code class="hljs language-scss" lang="scss">MDC<span class="hljs-selector-class">.put</span>("tid", "abc123")
  â†“
ThreadLocal<span class="hljs-selector-class">.get</span>()
  â†“
Thread<span class="hljs-selector-class">.currentThread</span>() â†’ è·å–å½“å‰çº¿ç¨‹å¯¹è±¡
  â†“
t<span class="hljs-selector-class">.threadLocals</span> â†’ è·å–çº¿ç¨‹çš„ThreadLocalMapï¼ˆå¯èƒ½ä¸ºnullï¼‰
  â†“
å¦‚æœä¸ºnull â†’ <span class="hljs-built_in">createMap</span>() â†’ åˆ›å»ºThreadLocalMapå¹¶èµ‹å€¼ç»™t<span class="hljs-selector-class">.threadLocals</span>
  â†“
ThreadLocal<span class="hljs-selector-class">.set</span>() â†’ åœ¨ThreadLocalMapä¸­å­˜å‚¨å€¼
  â†“
Thread-<span class="hljs-number">1</span><span class="hljs-selector-class">.threadLocals</span><span class="hljs-selector-class">.table</span><span class="hljs-selector-attr">[i]</span> = <span class="hljs-built_in">Entry</span>(ThreadLocalå®ä¾‹, HashMap)
</code></pre>
<h3 data-id="heading-27">9.3 å…³é”®ç†è§£</h3>
<p><strong>"ä¸ºçº¿ç¨‹åˆ›å»ºThreadLocal"çš„æœ¬è´¨</strong>ï¼š</p>
<ul>
<li>ä¸æ˜¯åœ¨ThreadLocalä¸­åˆ›å»ºæ•°æ®</li>
<li>è€Œæ˜¯åœ¨<strong>Threadå¯¹è±¡ä¸­åˆ›å»ºThreadLocalMap</strong></li>
<li>ThreadLocalåªæ˜¯ç”¨æ¥è®¿é—®Threadå¯¹è±¡ä¸­æ•°æ®çš„"é’¥åŒ™"</li>
</ul>
<p><strong>å†…å­˜æ¨¡å‹</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Threadå¯¹è±¡
  â””â”€ threadLocals: ThreadLocalMapï¼ˆæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹ï¼‰
      â””â”€ table: Entry<span class="hljs-section">[]</span>ï¼ˆå­˜å‚¨å®é™…æ•°æ®ï¼‰
          â””â”€ Entry: <span class="hljs-attr">key</span>=ThreadLocalå®ä¾‹, value=å®é™…å€¼
</code></pre>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¯ä¸ªçº¿ç¨‹çš„MDCæ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å¹²æ‰°çš„æ ¹æœ¬åŸå› ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§£å†³ JavaScript Number ç²¾åº¦é—®é¢˜ï¼šå¤„ç†è¶…å¤§ Long ç±»å‹ ID]]></title>    <link>https://juejin.cn/post/7573525927793000474</link>    <guid>https://juejin.cn/post/7573525927793000474</guid>    <pubDate>2025-11-17T11:36:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525927793000474" data-draft-id="7573519273029959726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£å†³ JavaScript Number ç²¾åº¦é—®é¢˜ï¼šå¤„ç†è¶…å¤§ Long ç±»å‹ ID"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-17T11:36:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OlahOlah"/> <meta itemprop="url" content="https://juejin.cn/user/1576016232062667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£å†³ JavaScript Number ç²¾åº¦é—®é¢˜ï¼šå¤„ç†è¶…å¤§ Long ç±»å‹ ID
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1576016232062667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OlahOlah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T11:36:58.000Z" title="Mon Nov 17 2025 11:36:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å‰åç«¯äº¤äº’ä¸­ï¼Œå¸¸å¸¸éœ€è¦ä¼ é€’ <code>Long</code> ç±»å‹çš„ IDã€‚ä½† JavaScript çš„ <code>Number</code> ç±»å‹åŸºäº IEEE 754 æ ‡å‡†ï¼Œæœ€å¤§åªèƒ½ç²¾ç¡®è¡¨ç¤º 15 åˆ° 17 ä½çš„æ•´æ•°ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´ä¼šä¸¢å¤±ç²¾åº¦ã€‚ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•å¤„ç†è¶…å¤§æ•°å­—ã€‚</p>
<h4 data-id="heading-0">é—®é¢˜æè¿°</h4>
<p>JavaScript çš„ <code>Number</code> ç±»å‹çš„æœ€å¤§å®‰å…¨æ•´æ•°æ˜¯ <code>9007199254740991</code>ï¼Œè¶…è¿‡è¿™ä¸ªå€¼çš„æ•°å­—ä¼šå‡ºç°ç²¾åº¦ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼Œ<code>1234567890123456789</code> ä¼šè¢«è½¬ä¸º <code>1234567890123456700</code>ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p>
<h4 data-id="heading-1">é—®é¢˜çš„æ ¹æº</h4>
<p><code>Long</code> ç±»å‹æ˜¯è®¸å¤šåç«¯è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ç”¨äºè¡¨ç¤ºå¤§æ•´æ•°çš„ç±»å‹ï¼Œè€Œ JavaScript çš„ <code>Number</code> ç±»å‹ä¸èƒ½æ­£ç¡®è¡¨ç¤ºå¦‚æ­¤å¤§çš„æ•°å­—ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">// åç«¯ï¼šJava
Long <span class="hljs-attr">longId</span> = <span class="hljs-number">1234567890123456789</span>L<span class="hljs-comment">;</span>
</code></pre>
<p>å‰ç«¯æ¥æ”¶åˆ°è¯¥ ID åï¼Œä¼šå‡ºç°ç²¾åº¦ä¸¢å¤±ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯ï¼šJavaScript</span>
<span class="hljs-keyword">let</span> itemId = <span class="hljs-number">1234567890123456789</span>; Â <span class="hljs-comment">// é”™è¯¯ï¼Œç²¾åº¦ä¸¢å¤±</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(itemId); Â <span class="hljs-comment">// è¾“å‡ºï¼š1234567890123456700</span>
</code></pre>
<h4 data-id="heading-2">è§£å†³æ–¹æ¡ˆ</h4>
<p>å°† <code>Long</code> ç±»å‹ ID è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ç¡®ä¿å‰åç«¯éƒ½ä½¿ç”¨å­—ç¬¦ä¸²å½¢å¼ä¼ é€’ IDï¼Œé¿å…ç²¾åº¦ä¸¢å¤±ã€‚</p>
<ul>
<li><strong>åå°</strong>ï¼šå°† <code>Long</code> ç±»å‹ ID è½¬ä¸ºå­—ç¬¦ä¸²ã€‚</li>
<li><strong>å‰ç«¯</strong>ï¼šæ¥æ”¶ ID æ—¶ä¿æŒå­—ç¬¦ä¸²ç±»å‹ï¼Œé¿å…è½¬æ¢ä¸º <code>Number</code>ã€‚</li>
</ul>
<h4 data-id="heading-3">å®æ–½æ–¹æ¡ˆ</h4>
<h5 data-id="heading-4">åç«¯ï¼ˆJava ç¤ºä¾‹ï¼‰ï¼š</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
public class ItemController {
 Â  Â <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/items/{id}"</span>)
 Â  Â public ResponseEntity&lt;ItemVO&gt; <span class="hljs-built_in">getItem</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
 Â  Â  Â  Â <span class="hljs-selector-tag">Item</span> <span class="hljs-selector-tag">item</span> = <span class="hljs-selector-tag">itemService</span><span class="hljs-selector-class">.getItemById</span>(id);
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">ItemVO</span> <span class="hljs-selector-tag">itemVO</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ItemVO</span>();
 Â  Â  Â  Â <span class="hljs-selector-tag">itemVO</span><span class="hljs-selector-class">.setId</span>(String.<span class="hljs-built_in">valueOf</span>(id));
â€‹
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(itemVO);
 Â   }
}
</code></pre>
<h5 data-id="heading-5">å‰ç«¯ï¼ˆJavaScript ç¤ºä¾‹ï¼‰ï¼š</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ axios è¯·æ±‚ API</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/items/1234567890123456789'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
 Â  Â <span class="hljs-keyword">const</span> itemId = response.<span class="hljs-property">data</span>.<span class="hljs-property">id</span>; Â <span class="hljs-comment">// ä¿æŒä¸ºå­—ç¬¦ä¸²</span>
 Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(itemId); Â <span class="hljs-comment">// è¾“å‡ºåŸå§‹å­—ç¬¦ä¸²</span>
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
 Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error:'</span>, error);
  });
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonç¼–ç¨‹å®æˆ˜ï¼šç»¼åˆé¡¹ç›® â€”â€” è¿·ä½ çˆ¬è™«é¡¹ç›®]]></title>    <link>https://juejin.cn/post/7573595009552154634</link>    <guid>https://juejin.cn/post/7573595009552154634</guid>    <pubDate>2025-11-18T01:46:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573595009552154634" data-draft-id="7573579203460874291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonç¼–ç¨‹å®æˆ˜ï¼šç»¼åˆé¡¹ç›® â€”â€” è¿·ä½ çˆ¬è™«é¡¹ç›®"/> <meta itemprop="keywords" content="åç«¯,Python,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-18T01:46:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonç¼–ç¨‹å®æˆ˜ï¼šç»¼åˆé¡¹ç›® â€”â€” è¿·ä½ çˆ¬è™«é¡¹ç›®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T01:46:59.000Z" title="Tue Nov 18 2025 01:46:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¿™ä¸ªå®æˆ˜ä¸“é—¨è®©ä½ ä½“éªŒâ€œä»é›¶æ­ä¸€ä¸ªå¯ç”¨çš„å°çˆ¬è™«â€ï¼ŒåŠŸèƒ½è™½ç„¶è½»é‡ï¼Œä½†ç»“æ„ã€æµç¨‹ã€å®¹é”™ã€æ¨¡å—åŒ–éƒ½å®Œæ•´å¾—åƒæ ·ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é€‚åˆä½œä¸ºç»¼åˆè®­ç»ƒçš„é¡¹ç›®ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-0">ä¸€ã€é¡¹ç›®ç›®æ ‡</h3>
<p>å¼€å‘ä¸€ä¸ªè¿·ä½ çˆ¬è™«ï¼Œå®ç°ï¼š</p>
<ol>
<li>è¾“å…¥ä¸€ä¸ªç½‘é¡µ URL</li>
<li>è‡ªåŠ¨å‘èµ·è¯·æ±‚å¹¶è·å–ç½‘é¡µå†…å®¹</li>
<li>æå–ç½‘é¡µä¸­çš„æ ‡é¢˜ã€æ­£æ–‡æ–‡å­—ã€é“¾æ¥</li>
<li>å°†ç»“æœä¿å­˜åˆ°æœ¬åœ°</li>
<li>æä¾›åŸºç¡€çš„å¼‚å¸¸å¤„ç†ï¼ˆç½‘ç»œé”™è¯¯ã€è§£æé”™è¯¯ç­‰ï¼‰</li>
<li>ä½¿ç”¨æ¨¡å—åŒ–ç»“æ„å¯æ‰©å±•</li>
</ol>
<p>è¿™æ˜¯ä¸€ä¸ªâ€œåªç”¨ Python æ ‡å‡†åº“ + requests + BeautifulSoupâ€å°±èƒ½å®Œæˆçš„è½»é‡é¡¹ç›®ã€‚</p>
<hr/>
<h3 data-id="heading-1">äºŒã€æ‰€éœ€åº“</h3>
<pre><code class="hljs language-bash" lang="bash">pip install requests beautifulsoup4 lxml
</code></pre>
<p>é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°ï¼š</p>
<ul>
<li>requestsï¼šç”¨äºå‘é€ HTTP è¯·æ±‚</li>
<li>bs4ï¼ˆBeautifulSoupï¼‰ï¼šç”¨äºè§£æç½‘é¡µ</li>
<li>lxmlï¼šåŠ é€Ÿè§£æå¹¶æå‡ç¨³å®šæ€§</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€é¡¹ç›®ç»“æ„è®¾è®¡</h3>
<p>æ¨èè¿™æ ·çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mini_spider/
â”‚â”€â”€ main.py            <span class="hljs-comment"># ä¸»ç¨‹åºå…¥å£</span>
â”‚â”€â”€ fetcher.py         <span class="hljs-comment"># ç½‘ç»œè¯·æ±‚æ¨¡å—</span>
â”‚â”€â”€ parser.py          <span class="hljs-comment"># æ•°æ®è§£ææ¨¡å—</span>
â”‚â”€â”€ saver.py           <span class="hljs-comment"># æ–‡ä»¶ä¿å­˜æ¨¡å—</span>
â”‚â”€â”€ output/            <span class="hljs-comment"># ä¿å­˜çˆ¬å–ç»“æœ</span>
</code></pre>
<p>è¿™ä¼šè®©ç¨‹åºæ›´åƒâ€œå¯ç»´æŠ¤çš„å°é¡¹ç›®â€ï¼Œè€Œä¸æ˜¯é›¶æ•£è„šæœ¬ã€‚</p>
<hr/>
<h2 data-id="heading-3">å››ã€ç¼–å†™ç½‘ç»œè¯·æ±‚æ¨¡å— fetcher.py</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_html</span>(<span class="hljs-params">url, timeout=<span class="hljs-number">10</span></span>):
    headers = {
        <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Mini Spider Project)"</span>
    }
    <span class="hljs-keyword">try</span>:
        resp = requests.get(url, headers=headers, timeout=timeout)
        resp.raise_for_status()
        resp.encoding = resp.apparent_encoding
        <span class="hljs-keyword">return</span> resp.text
    <span class="hljs-keyword">except</span> requests.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¯·æ±‚å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<p>åŠŸèƒ½äº®ç‚¹ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰ UA é˜²æ­¢éƒ¨åˆ†ç½‘ç«™æ‹’ç»</li>
<li><code>raise_for_status()</code> å¸®ä½ æ•è· 404/500</li>
<li>timeout é˜²æ­¢å¡æ­»</li>
<li>ç¨³å¥çš„å¼‚å¸¸å¤„ç†</li>
</ul>
<hr/>
<h2 data-id="heading-4">äº”ã€ç¼–å†™è§£ææ¨¡å— parser.py</h2>
<p>ç¤ºä¾‹ï¼šæå–æ–‡ç« æ ‡é¢˜ã€æ­£æ–‡æ–‡æœ¬ã€æ‰€æœ‰è¶…é“¾æ¥ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

<span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_page</span>(<span class="hljs-params">html</span>):
    <span class="hljs-keyword">try</span>:
        soup = BeautifulSoup(html, <span class="hljs-string">"lxml"</span>)

        title = soup.title.string <span class="hljs-keyword">if</span> soup.title <span class="hljs-keyword">else</span> <span class="hljs-string">"æ— æ ‡é¢˜"</span>

        <span class="hljs-comment"># æå–æ­£æ–‡</span>
        paragraphs = [p.get_text(strip=<span class="hljs-literal">True</span>) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">"p"</span>)]
        content = <span class="hljs-string">"\n"</span>.join(paragraphs)

        <span class="hljs-comment"># æå–é“¾æ¥</span>
        links = [a[<span class="hljs-string">'href'</span>] <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">"a"</span>, href=<span class="hljs-literal">True</span>)]

        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"title"</span>: title,
            <span class="hljs-string">"content"</span>: content,
            <span class="hljs-string">"links"</span>: links
        }

    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è§£æå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<p>è¿™ä¸ªè§£æé€»è¾‘ç®€å•ä½†é€šç”¨ï¼Œèƒ½é€‚é…å¤§éƒ¨åˆ†æ™®é€šç½‘é¡µã€‚</p>
<hr/>
<h2 data-id="heading-5">å…­ã€ä¿å­˜æ¨¡å— saver.py</h2>
<p>æŠŠçˆ¬å–ç»“æœä¿å­˜ä¸º txt æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">save_result</span>(<span class="hljs-params">data, filename=<span class="hljs-string">"result.txt"</span></span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">"output"</span>):
        os.makedirs(<span class="hljs-string">"output"</span>)

    filepath = os.path.join(<span class="hljs-string">"output"</span>, filename)

    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">f"æ ‡é¢˜ï¼š<span class="hljs-subst">{data[<span class="hljs-string">'title'</span>]}</span>\n\n"</span>)
        f.write(<span class="hljs-string">"æ­£æ–‡å†…å®¹ï¼š\n"</span>)
        f.write(data[<span class="hljs-string">"content"</span>])
        f.write(<span class="hljs-string">"\n\né“¾æ¥åˆ—è¡¨ï¼š\n"</span>)
        <span class="hljs-keyword">for</span> link <span class="hljs-keyword">in</span> data[<span class="hljs-string">"links"</span>]:
            f.write(link + <span class="hljs-string">"\n"</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å·²ä¿å­˜åˆ° <span class="hljs-subst">{filepath}</span>"</span>)
</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥æ‰©å±•æˆï¼š</p>
<ul>
<li>ä¿å­˜ä¸º JSON</li>
<li>ä¿å­˜ä¸º CSV</li>
<li>ä¿å­˜ä¸º HTML</li>
<li>ä¿å­˜ä¸ºçŸ¥è¯†åº“</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸ƒã€ä¸»ç¨‹åº main.py</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fetcher <span class="hljs-keyword">import</span> fetch_html
<span class="hljs-keyword">from</span> parser <span class="hljs-keyword">import</span> parse_page
<span class="hljs-keyword">from</span> saver <span class="hljs-keyword">import</span> save_result

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    url = <span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥è¦çˆ¬å–çš„URLï¼š"</span>)

    html = fetch_html(url)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> html:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"è·å–ç½‘é¡µå¤±è´¥"</span>)
        <span class="hljs-keyword">return</span>

    data = parse_page(html)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"è§£æå¤±è´¥"</span>)
        <span class="hljs-keyword">return</span>

    save_result(data, filename=<span class="hljs-string">"çˆ¬å–ç»“æœ.txt"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"çˆ¬å–å®Œæˆï¼"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">è¯·è¾“å…¥è¦çˆ¬å–çš„URLï¼šhttp:<span class="hljs-comment">//example.com</span>
æ­£åœ¨ä¿å­˜...
çˆ¬å–å®Œæˆï¼
</code></pre>
<hr/>
<h2 data-id="heading-7">å…«ã€é¡¹ç›®ç‰¹è‰²äº®ç‚¹</h2>
<p>è¿™ä¸ªâ€œè¿·ä½ çˆ¬è™«é¡¹ç›®â€è™½ç„¶ç®€å•ï¼Œä½†æ¡†æ¶å¾ˆä¸“ä¸šï¼Œå› ä¸ºå®ƒåŒ…å«ï¼š</p>
<ul>
<li>æ¨¡å—åŒ–å¼€å‘</li>
<li>ç‹¬ç«‹ç½‘ç»œå±‚ + è§£æå±‚ + å­˜å‚¨å±‚</li>
<li>å¼‚å¸¸å¤„ç†å…¨é“¾è·¯</li>
<li>å¯¹ç½‘é¡µæŒ‰ç»“æ„ä¿¡æ¯æ‹†è§£</li>
<li>å·¥ç¨‹ç»“æ„å¯æ‰©å±•æ€§å¼º</li>
</ul>
<p>ä½ ç¨å¾®æ‰©å±•ä¸€ä¸‹å°±èƒ½å˜æˆï¼š</p>
<p>âœ” æ‰¹é‡ URL çˆ¬è™«
âœ” é‡‡é›†æ–°é—»ç½‘ç«™æ–‡ç« 
âœ” é‡‡é›†å•†å“æ ‡é¢˜ä»·æ ¼
âœ” ç›‘æ§ç½‘é¡µå˜åŒ–
âœ” å°è§„æ¨¡æ•°æ®é‡‡é›†è„šæœ¬</p>
<hr/>
<h2 data-id="heading-8">ä¹ã€å¯æ‰©å±•æ–¹å‘ï¼ˆé¡¹ç›®å‡çº§å»ºè®®ï¼‰</h2>
<p>å¦‚æœä½ æƒ³è¿›ä¸€æ­¥å¼ºåŒ–ï¼Œå¯ä»¥åŠ å…¥ï¼š</p>
<h4 data-id="heading-9">1. æ‰¹é‡ URL çˆ¬å–</h4>
<p>ä»æ–‡ä»¶è¯»å– URL åˆ—è¡¨ï¼Œä¸€æ¬¡æŠ“ä¸€æ‰¹ã€‚</p>
<h4 data-id="heading-10">2. è‡ªåŠ¨é™é€Ÿ &amp; é‡è¯•æœºåˆ¶</h4>
<p>é™ä½è¢«å°é£é™©ã€‚</p>
<h4 data-id="heading-11">3. ä»£ç†æ± </h4>
<p>æé«˜ç¨³å®šæ€§ã€‚</p>
<h4 data-id="heading-12">4. ç»“æ„åŒ–å­˜å‚¨ï¼ˆJSON/CSVï¼‰</h4>
<p>æ–¹ä¾¿åç»­åˆ†æã€‚</p>
<h4 data-id="heading-13">5. GUI å›¾å½¢ç•Œé¢ï¼ˆTkinterï¼‰</h4>
<p>å˜æˆçœŸæ­£çš„æ¡Œé¢å·¥å…·ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>