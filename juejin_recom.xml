<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[8 个支持一键导入 TRAE 使用的自定义智能体]]></title>    <link>https://juejin.cn/post/7583983152324378650</link>    <guid>https://juejin.cn/post/7583983152324378650</guid>    <pubDate>2025-12-16T05:33:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152324378650" data-draft-id="7583969283790274614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="8 个支持一键导入 TRAE 使用的自定义智能体"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-16T05:33:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            8 个支持一键导入 TRAE 使用的自定义智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:33:09.000Z" title="Tue Dec 16 2025 05:33:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e0d91ea29be403ea8f08e9c3c89cc41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=IlXT3cYI%2FmfofW5mTFCeaDxl6Zc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：桔梗，TRAE 技术专家；Jiaqi，TRAE 技术文档工程师</p>
</blockquote>
<p>针对项目开发中的不同场景，我们提供了一系列可直接导入 TRAE 并使用的自定义智能体示例。这些智能体可以被单独调用，或在开发流程的相应阶段由 SOLO Coder 自动调用，以完成特定任务。同时，这些自定义智能体也可以作为参考模板，你可以根据实际需求调整现有配置。</p>
<p>只需要在电脑端访问下表中相应的链接，即可将这些智能体快速导入 TRAE 中并使用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a96f1215441e4cf0b07488651d7a1189~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=CW4VIgltQmyOHO2%2FRLR3gJeVLEU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>UI 设计师</strong></h2>
<h3 data-id="heading-1"><strong>智能体名称</strong></h3>
<p>UI Designer</p>
<h3 data-id="heading-2"><strong>使用场景</strong></h3>
<p>UI Designer（ui-designer） 是一个专业的 UI/UX 设计智能体，用于创建界面、设计组件、搭建设计系统和提升视觉美感。它兼顾可访问性、用户体验、组件一致性和跨平台适配，能提供可落地的设计方案和技术指导。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>组件库设计：</strong> 设计统一按钮、表单等组件，包含多种状态和变体。</p>
</li>
<li>
<p><strong>界面优化：</strong> 改善布局和视觉层级，提升可用性。</p>
</li>
<li>
<p><strong>设计系统建设：</strong> 标准化颜色、排版、间距等设计 token，保证跨产品一致性。</p>
</li>
<li>
<p><strong>跨平台适配：</strong> 确保界面在不同屏幕和设备上表现一致。</p>
</li>
</ul>
<h3 data-id="heading-3"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li>
<p><strong>TRAE 中国版：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F8fdcb7" target="_blank" title="https://s.trae.com.cn/a/8fdcb7" ref="nofollow noopener noreferrer">s.trae.com.cn/a/8fdcb7</a></p>
</li>
<li>
<p><strong>TRAE 国际版：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F878f64" target="_blank" title="https://s.trae.ai/a/878f64" ref="nofollow noopener noreferrer">s.trae.ai/a/878f64</a></p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee3315025f8b4bc38431475d4692adf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=uyaIq%2FsNeejWw6byyfgM1KKLC7U%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/165dcfaba680418cb67f8b4f5f44c248~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=RA9iyYDKhn7Y9n6ZexfXYqZr9UI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>前端架构师</strong></h2>
<h3 data-id="heading-5"><strong>智能体名称</strong></h3>
<p>Frontend Architect</p>
<h3 data-id="heading-6"><strong>使用场景</strong></h3>
<p>Frontend Architect（frontend-architect） 是一个专业的前端架构智能体，擅长构建高性能、可扩展的前端界面，涵盖 React、Vue 和 Angular 等主流框架。它能够在组件开发、状态管理、性能优化、跨浏览器适配等方面提供专业指导，并输出可落地的前端实现方案。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>界面开发：</strong> 实现响应式、可访问的 UI，确保与设计系统一致，并支持动画和交互优化。</p>
</li>
<li>
<p><strong>组件架构：</strong> 设计可复用、可维护的组件体系，管理生命周期和组件接口。</p>
</li>
<li>
<p><strong>状态管理：</strong> 处理复杂状态逻辑，选型并实现 Redux、Vuex、NgRx 等状态管理方案。</p>
</li>
<li>
<p><strong>性能优化：</strong> 通过代码拆分、懒加载、虚拟滚动等技术提升渲染和加载效率。</p>
</li>
<li>
<p><strong>前端工程与质量保障：</strong> 配置构建工具、CI/CD、测试体系，确保代码质量、安全性和可维护性。</p>
</li>
</ul>
<h3 data-id="heading-7"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F3fbe5a" target="_blank" title="https://s.trae.com.cn/a/3fbe5a" ref="nofollow noopener noreferrer">s.trae.com.cn/a/3fbe5a</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2Ff8219e" target="_blank" title="https://s.trae.ai/a/f8219e" ref="nofollow noopener noreferrer">s.trae.ai/a/f8219e</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b814b287fe54a55b3086089602bcc82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=7hf2IA9hLtMvYD0GDSXx9umR2o8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8"><strong>后端架构师</strong></h2>
<h3 data-id="heading-9"><strong>智能体名称</strong></h3>
<p>Backend Architect</p>
<h3 data-id="heading-10"><strong>使用场景</strong></h3>
<p>Backend Architect（backend-architect） 是一个专业的后端架构智能体，擅长设计高性能、可扩展且安全的服务器端系统。它能够在 API 设计、业务逻辑实现、数据库架构、系统性能优化和可扩展性等方面提供专业指导，并输出可落地的后端解决方案。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>API 设计：</strong> 设计 RESTful 或 GraphQL 接口，规范请求/响应、认证和版本管理。</p>
</li>
<li>
<p><strong>业务逻辑实现：</strong> 构建可扩展的服务层，处理复杂业务规则、异步任务和缓存策略。</p>
</li>
<li>
<p><strong>数据库架构与优化：</strong> 设计高效数据库结构，优化查询性能，选择合适的数据存储方案。</p>
</li>
<li>
<p><strong>系统性能与可扩展性：</strong> 实现负载均衡、自动扩容、高可用和监控告警体系。</p>
</li>
<li>
<p><strong>安全与运维：</strong> 保证认证授权、数据加密、合规性，配置 CI/CD、容器化和基础设施管理。</p>
</li>
</ul>
<h3 data-id="heading-11"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F441a24" target="_blank" title="https://s.trae.com.cn/a/441a24" ref="nofollow noopener noreferrer">s.trae.com.cn/a/441a24</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F92731a" target="_blank" title="https://s.trae.ai/a/92731a" ref="nofollow noopener noreferrer">s.trae.ai/a/92731a</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceed2d16a6f4431bb84b3f7a0ae135e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=gDuCFGz8MnvwqbE4EKB%2BYgskZvM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09e89498e84640c186104663aae7d5a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=MOaBHVEMT%2FsJGT%2BN8hfJBI2cJzw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12"><strong>API 测试工程师</strong></h2>
<h3 data-id="heading-13"><strong>智能体名称</strong></h3>
<p>API Test Pro</p>
<h3 data-id="heading-14"><strong>使用场景</strong></h3>
<p>API Test Pro（api-test-pro） 是一个专业的 API 测试智能体，擅长功能验证、性能测试、负载测试和契约合规检查。它能够全面评估 REST、GraphQL、gRPC 等接口的可靠性、性能和安全性，并提供可落地的测试报告与改进建议。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>契约测试：</strong> 验证 API 与 OpenAPI/Swagger 规范一致，确保请求/响应符合设计。</p>
</li>
<li>
<p><strong>功能测试：</strong> 检测各接口的有效/无效输入处理、边界情况、错误处理和业务逻辑正确性。</p>
</li>
<li>
<p><strong>性能测试：</strong> 评估接口响应时间、识别瓶颈、验证性能 SLA。</p>
</li>
<li>
<p><strong>负载测试：</strong> 模拟并发用户、压力场景，检查系统在高负载下的稳定性和降级策略。</p>
</li>
<li>
<p><strong>安全测试：</strong> 发现常见漏洞，如 SQL 注入、XSS、认证绕过等。</p>
</li>
</ul>
<h3 data-id="heading-15"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F1ea8bb" target="_blank" title="https://s.trae.com.cn/a/1ea8bb" ref="nofollow noopener noreferrer">s.trae.com.cn/a/1ea8bb</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F55b143" target="_blank" title="https://s.trae.ai/a/55b143" ref="nofollow noopener noreferrer">s.trae.ai/a/55b143</a></p>
<p>如实例图所示，在项目重构中，SOLO Coder 先后调用了 UI 设计师、前端架构师、后端架构师和 API 测试工程师来协同完成任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40e5d6aa081247fbb1da74689789955d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=LictVjmvBGxIn%2Fa%2BKQi90sUw4Cc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57d1c8c212d046e0bfdbadb91ffdd0ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=VcyJ5IWuBop6QQuJea1F8IdC0Ek%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16"><strong>AI 集成工程师</strong></h2>
<h3 data-id="heading-17"><strong>智能体名称</strong></h3>
<p>AI Integration Eng</p>
<h3 data-id="heading-18"><strong>使用场景</strong></h3>
<p>AI Integration Engineer（ai-integration-engineer） 是一个专业的 AI/ML 集成智能体，擅长将人工智能功能整合到应用中，包括语言模型集成、推荐系统构建和智能自动化实现。它能够提供可落地的 AI 解决方案，兼顾性能、可靠性和业务价值。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>语言模型集成：</strong> 将 GPT 等大模型接入应用，处理对话、文本生成或自然语言理解任务。</p>
</li>
<li>
<p><strong>推荐系统开发：</strong> 构建基于协同过滤、内容或混合算法的个性化推荐引擎，支持实时推送与冷启动处理。</p>
</li>
<li>
<p><strong>智能自动化：</strong> 实现动态定价、流程自动化或决策系统，结合规则与 ML 预测提升效率。</p>
</li>
<li>
<p><strong>模型部署与优化：</strong> 容器化部署、蓝绿/金丝雀发布、性能优化和监控，确保模型可靠运行。</p>
</li>
<li>
<p><strong>数据与安全管理：</strong> 设计可扩展数据管道、隐私保护机制、偏差检测与合规性措施。</p>
</li>
</ul>
<h3 data-id="heading-19"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F16c32c" target="_blank" title="https://s.trae.com.cn/a/16c32c" ref="nofollow noopener noreferrer">s.trae.com.cn/a/16c32c</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F720a05" target="_blank" title="https://s.trae.ai/a/720a05" ref="nofollow noopener noreferrer">s.trae.ai/a/720a05</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b29ab31fd4ca4c0aa5f895c69798d981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=%2F16jyp2enh6ChvjXwiX2P1Uv8KA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20"><strong>DevOps 工程师</strong></h2>
<h3 data-id="heading-21"><strong>智能体名称</strong></h3>
<p>DevOps Architect</p>
<h3 data-id="heading-22"><strong>使用场景</strong></h3>
<p>DevOps Architect（devops-architect） 是一个专业的 DevOps 智能体，擅长构建自动化基础设施、CI/CD 流水线和监控系统，确保软件快速、可靠、安全地交付，并具备高可用性和可扩展性。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>CI/CD 流水线：</strong> 设计和实现自动化构建、测试和部署，支持回滚与多分支策略。</p>
</li>
<li>
<p><strong>云基础设施配置：</strong> 搭建可扩展、高可用、安全的云环境（AWS/Azure/GCP），使用基础设施即代码管理资源。</p>
</li>
<li>
<p><strong>监控与可观测性：</strong> 配置系统监控、告警、日志聚合和分布式追踪，提供可操作的运行洞察。</p>
</li>
<li>
<p><strong>部署自动化：</strong> 实现蓝绿、金丝雀、滚动部署策略，自动化数据库迁移和环境管理。</p>
</li>
<li>
<p><strong>安全与合规：</strong> 管理权限、密钥、加密和审计，确保符合 SOC2、HIPAA、PCI-DSS 等标准。</p>
</li>
</ul>
<h3 data-id="heading-23"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2Fbab503" target="_blank" title="https://s.trae.com.cn/a/bab503" ref="nofollow noopener noreferrer">s.trae.com.cn/a/bab503</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F8a2ce1" target="_blank" title="https://s.trae.ai/a/8a2ce1" ref="nofollow noopener noreferrer">s.trae.ai/a/8a2ce1</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97a0d5ad28384211ba2b06de1cf90823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=DD3aDKO9BT43rHQrQENjrzbI3OY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18b76553ee3745f9a97d12c676bceabb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=A5Xv9ZTyvwO9b5Ko%2Bd0YILjSW9o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-24"><strong>性能优化师</strong></h2>
<h3 data-id="heading-25"><strong>智能体名称</strong></h3>
<p>Performance Expert</p>
<h3 data-id="heading-26"><strong>使用场景</strong></h3>
<p>Performance Expert（performance-expert） 是一个专业的性能优化智能体，擅长系统、应用和数据库的性能分析与优化。它能够发现瓶颈、进行性能测试和压力测试，并提供可执行的优化方案，从而提升响应速度、吞吐量和整体系统效率。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>性能测试：</strong> 设计和执行负载、压力和耐久性测试，建立性能基准并模拟实际用户行为。</p>
</li>
<li>
<p><strong>性能分析与诊断：</strong> 对代码、数据库、前端和基础设施进行多层级分析，定位瓶颈和热点问题。</p>
</li>
<li>
<p><strong>系统优化：</strong> 从应用代码、数据库查询到基础设施配置，提供端到端性能改进建议。</p>
</li>
<li>
<p><strong>代码与数据库优化：</strong> 改进算法、数据结构、查询效率、缓存策略和 ORM 使用。</p>
</li>
<li>
<p><strong>基础设施优化：</strong> 调整线程池、容器配置、操作系统参数、负载均衡和 CDN 策略以提升整体性能。</p>
</li>
<li>
<p><strong>质量保证与报告：</strong> 提供清晰的性能分析报告、优化建议和验证方法，确保优化可衡量、可重复。</p>
</li>
</ul>
<h3 data-id="heading-27"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F7bb287" target="_blank" title="https://s.trae.com.cn/a/7bb287" ref="nofollow noopener noreferrer">s.trae.com.cn/a/7bb287</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F00067d" target="_blank" title="https://s.trae.ai/a/00067d" ref="nofollow noopener noreferrer">s.trae.ai/a/00067d</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e76487d18c9d494fbdf3d8c3422a6c55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467989&amp;x-signature=eVw5SKfI3AiYENC%2FyBI584MVgzk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-28"><strong>合规审查员</strong></h2>
<h3 data-id="heading-29"><strong>智能体名称</strong></h3>
<p>Compliance Checker</p>
<h3 data-id="heading-30"><strong>使用场景</strong></h3>
<p>Compliance Checker（compliance-checker） 是一个专业的法律合规模拟智能体，擅长审查法律文件、隐私政策和服务条款，确保符合各类法规和行业标准。它能够识别潜在风险、提出改进建议，并帮助企业降低法律合规风险。</p>
<p>主要使用场景如下：</p>
<ul>
<li>
<p><strong>文件审查：</strong> 检查服务条款、隐私政策等法律文档，识别缺失条款、歧义或过时内容。</p>
</li>
<li>
<p><strong>法规合规评估：</strong> 根据 GDPR、CCPA、PIPEDA、COPPA 等法规分析文档合规性，提供整改建议。</p>
</li>
<li>
<p><strong>风险识别与缓解：</strong> 发现可能带来法律责任的条款、消费者保护问题、知识产权或用户内容风险。</p>
</li>
<li>
<p><strong>最佳实践建议：</strong> 提供标准条款示例，优先级整改清单，并给出实施时间表和法律依据引用。</p>
</li>
<li>
<p><strong>操作指南：</strong> 区分法律要求与最佳实践，确保建议可落地、实用且符合法律标准。</p>
</li>
</ul>
<h3 data-id="heading-31"><strong>链接</strong></h3>
<p>访问以下链接，直接将智能体导入 TRAE 对应的版本中使用。</p>
<ul>
<li><strong>TRAE 中国版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.com.cn%2Fa%2F7a3bf7" target="_blank" title="https://s.trae.com.cn/a/7a3bf7" ref="nofollow noopener noreferrer">s.trae.com.cn/a/7a3bf7</a></p>
<ul>
<li><strong>TRAE 国际版：</strong></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2Fc10186" target="_blank" title="https://s.trae.ai/a/c10186" ref="nofollow noopener noreferrer">s.trae.ai/a/c10186</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙技术干货11：属性动画与转场效果实战]]></title>    <link>https://juejin.cn/post/7583973472323141647</link>    <guid>https://juejin.cn/post/7583973472323141647</guid>    <pubDate>2025-12-16T03:27:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583973472323141647" data-draft-id="7583955708318597120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙技术干货11：属性动画与转场效果实战"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-16T03:27:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="赵浩生"/> <meta itemprop="url" content="https://juejin.cn/user/4185170523982995"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙技术干货11：属性动画与转场效果实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185170523982995/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    赵浩生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:27:03.000Z" title="Tue Dec 16 2025 03:27:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p> 本文聚焦基础属性动画（animateTo）和页面转场动画（transition），通过「列表项滑动删除 + 页面切换渐变」的实战案例，带大家掌握动画开发核心逻辑～</p>
<h2 data-id="heading-0">一、核心认知：动画的应用场景与核心 API</h2>
<h3 data-id="heading-1">1. 应用场景</h3>
<ul>
<li>组件交互反馈（如按钮点击缩放、列表项操作动画）</li>
<li>页面切换过渡（如渐变、滑动进入）</li>
<li>数据变化可视化（如进度条加载、数字滚动）</li>
<li>引导用户注意力（如弹窗弹出、通知提示）</li>
</ul>
<h3 data-id="heading-2">2. 核心 API</h3>
<ul>
<li>属性动画：<code>animateTo</code>（声明式动画，无需手动控制动画帧）</li>
<li>转场动画：<code>transition</code>（组件转场配置）、<code>pageTransition</code>（页面转场配置）</li>
<li>关键参数：<code>duration</code>（时长）、<code>curve</code>（动画曲线）、<code>delay</code>（延迟执行）</li>
</ul>
<h2 data-id="heading-3">二、属性动画：animateTo 基础用法</h2>
<p>属性动画通过<code>animateTo</code>函数包裹组件属性修改逻辑，自动实现动画过渡，支持位置、透明度、尺寸等常见属性：</p>
<h3 data-id="heading-4">1. 基础效果示例（控制透明度、尺寸、位置）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { animateTo, <span class="hljs-title class_">Curve</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ui.animation'</span>;

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">AnimateToBasicDemo</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">opacity</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">30</span> })
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">30</span>)
      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-params"><span class="hljs-string">'#f5f5f5'</span></span>) {
      
      <span class="hljs-comment">// 动画目标组件</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'属性动画演示'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span>)
        .<span class="hljs-title function_">scale</span>({ <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> })
        .<span class="hljs-title function_">translate</span>({ <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span> })
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#2f54eb'</span>)
        .<span class="hljs-title function_">color</span>(<span class="hljs-string">'#ffffff'</span>)
        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)

      <span class="hljs-comment">// 控制按钮组</span>
      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'透明度变化'</span>)
          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">animateTo</span>({
              <span class="hljs-attr">duration</span>: <span class="hljs-number">800</span>, <span class="hljs-comment">// 动画时长（毫秒）</span>
              <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseInOut</span> <span class="hljs-comment">// 动画曲线（缓进缓出）</span>
            }, <span class="hljs-function">() =&gt;</span> {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> === <span class="hljs-number">1</span> ? <span class="hljs-number">0.3</span> : <span class="hljs-number">1</span>;
            });
          })

        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'缩放效果'</span>)
          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">animateTo</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-number">500</span> }, <span class="hljs-function">() =&gt;</span> {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> === <span class="hljs-number">1</span> ? <span class="hljs-number">1.2</span> : <span class="hljs-number">1</span>;
            });
          })

        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'水平位移'</span>)
          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">animateTo</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">() =&gt;</span> {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span> === <span class="hljs-number">0</span> ? <span class="hljs-number">100</span> : <span class="hljs-number">0</span>;
            });
          })
      }
    }
  }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-5">2. 核心参数说明</h3>
<ul>
<li><code>duration</code>：动画时长（默认 300 毫秒），数值越大动画越慢；</li>
<li><code>curve</code>：动画曲线（<code>Curve.Linear</code>匀速、<code>Curve.EaseIn</code>缓入、<code>Curve.EaseOut</code>缓出、<code>Curve.EaseInOut</code>缓进缓出）；</li>
<li><code>delay</code>：延迟执行时间（默认 0 毫秒），可实现动画排队效果；</li>
<li>回调函数：包裹需要动画的属性修改逻辑，属性变化会自动生成过渡动画。</li>
</ul>
<h2 data-id="heading-6">三、转场动画：transition 组件用法</h2>
<p>转场动画用于组件显示 / 隐藏、页面切换时的过渡效果，鸿蒙 5.0 + 支持通过<code>transition</code>直接配置，无需复杂逻辑：</p>
<h3 data-id="heading-7">1. 页面切换渐变效果</h3>
<p>在<code>main_pages.json</code>注册的页面中，通过<code>pageTransition</code>配置全局页面转场：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// pages/FirstPage.ets（首页）</span>
<span class="hljs-keyword">@Entry</span>
<span class="hljs-keyword">@Component</span>
struct FirstPage {
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">Column</span>({ space: <span class="hljs-number">30</span> })
      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
      <span class="hljs-selector-class">.padding</span>(<span class="hljs-number">30</span>)
      <span class="hljs-selector-class">.backgroundColor</span>('#f5f5f5') {
      
      Text('首页')
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">32</span>)
        <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)

      <span class="hljs-selector-tag">Button</span>('跳转到第二页')
        <span class="hljs-selector-class">.type</span>(ButtonType.Capsule)
        <span class="hljs-selector-class">.width</span>(<span class="hljs-number">200</span>)
        <span class="hljs-selector-class">.height</span>(<span class="hljs-number">50</span>)
        <span class="hljs-selector-class">.backgroundColor</span>('#<span class="hljs-number">2</span>f54eb')
        <span class="hljs-selector-class">.onClick</span>(() =&gt; {
          router<span class="hljs-selector-class">.pushUrl</span>({ url: 'pages/SecondPage' });
        })
    }
  }

  <span class="hljs-comment">// 页面转场配置（渐变效果）</span>
  <span class="hljs-built_in">pageTransition</span>() {
    <span class="hljs-built_in">PageTransition</span>()
      <span class="hljs-selector-class">.enter</span>('fade', { duration: <span class="hljs-number">800</span>, curve: Curve.EaseInOut }) <span class="hljs-comment">// 进入渐变</span>
      <span class="hljs-selector-class">.exit</span>('fade', { duration: <span class="hljs-number">800</span>, curve: Curve.EaseInOut }) <span class="hljs-comment">// 退出渐变</span>
  }
}

<span class="hljs-comment">// pages/SecondPage.ets（第二页）</span>
<span class="hljs-keyword">@Entry</span>
<span class="hljs-keyword">@Component</span>
struct SecondPage {
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">Column</span>({ space: <span class="hljs-number">30</span> })
      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
      <span class="hljs-selector-class">.padding</span>(<span class="hljs-number">30</span>)
      <span class="hljs-selector-class">.backgroundColor</span>('#f5f5f5') {
      
      Text('第二页')
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">32</span>)
        <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)

      <span class="hljs-selector-tag">Button</span>('返回首页')
        <span class="hljs-selector-class">.type</span>(ButtonType.Capsule)
        <span class="hljs-selector-class">.width</span>(<span class="hljs-number">200</span>)
        <span class="hljs-selector-class">.height</span>(<span class="hljs-number">50</span>)
        <span class="hljs-selector-class">.backgroundColor</span>('#ff4d4f')
        <span class="hljs-selector-class">.onClick</span>(() =&gt; {
          router<span class="hljs-selector-class">.backUrl</span>();
        })
    }
  }

  <span class="hljs-comment">// 复用渐变转场配置</span>
  <span class="hljs-built_in">pageTransition</span>() {
    <span class="hljs-built_in">PageTransition</span>()
      <span class="hljs-selector-class">.enter</span>('fade', { duration: <span class="hljs-number">800</span>, curve: Curve.EaseInOut })
      <span class="hljs-selector-class">.exit</span>('fade', { duration: <span class="hljs-number">800</span>, curve: Curve.EaseInOut })
  }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-8">2. 组件转场（列表项滑动删除前置）</h3>
<p>组件显示 / 隐藏时的转场效果，可结合<code>if</code>或<code>visibility</code>控制：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 组件转场示例（渐变+位移）</span>
<span class="hljs-selector-tag">Text</span>(<span class="hljs-string">'可隐藏组件'</span>)
  <span class="hljs-selector-class">.transition</span>([
    TransitionEffect.<span class="hljs-built_in">fade</span>({ <span class="hljs-attribute">duration</span>: <span class="hljs-number">500</span> }), <span class="hljs-comment">// 渐变</span>
    TransitionEffect.<span class="hljs-built_in">slide</span>({ <span class="hljs-attribute">direction</span>: SlideDirection.Bottom, <span class="hljs-attribute">duration</span>: <span class="hljs-number">500</span> }) <span class="hljs-comment">// 底部滑入滑出</span>
  ])
  <span class="hljs-selector-class">.visibility</span>(this.isShow ? Visibility.<span class="hljs-attribute">Visible </span>: Visibility.Hidden)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-9">四、实战整合：列表项滑动删除 + 页面渐变</h2>
<h3 data-id="heading-10">1. 列表项滑动删除（属性动画核心应用）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { animateTo, <span class="hljs-title class_">Curve</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ui.animation'</span>;
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.router'</span>;

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">SlideDeleteList</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">taskList</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'学习属性动画'</span>, <span class="hljs-string">'实现转场效果'</span>, <span class="hljs-string">'开发滑动删除'</span>, <span class="hljs-string">'整合页面渐变'</span>];
  <span class="hljs-meta">@State</span> <span class="hljs-attr">deleteOffsetX</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskList</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-number">0</span>); <span class="hljs-comment">// 每个列表项的位移</span>

  <span class="hljs-comment">// 滑动删除动画</span>
  <span class="hljs-title function_">handleSwipe</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, offsetX: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-comment">// 限制滑动范围（-200到0，200为删除按钮宽度）</span>
    <span class="hljs-keyword">if</span> (offsetX &lt; -<span class="hljs-number">200</span>) offsetX = -<span class="hljs-number">200</span>;
    <span class="hljs-keyword">if</span> (offsetX &gt; <span class="hljs-number">0</span>) offsetX = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deleteOffsetX</span>[index] = offsetX;
  }

  <span class="hljs-comment">// 删除列表项（带动画）</span>
  <span class="hljs-title function_">deleteItem</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-title function_">animateTo</span>({
      <span class="hljs-attr">duration</span>: <span class="hljs-number">500</span>,
      <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseOut</span>
    }, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">deleteOffsetX</span>[index] = -<span class="hljs-variable language_">this</span>.<span class="hljs-property">taskList</span>.<span class="hljs-property">length</span> * <span class="hljs-number">200</span>; <span class="hljs-comment">// 快速滑出屏幕</span>
    }, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskList</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">deleteOffsetX</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>); <span class="hljs-comment">// 移除对应位移状态</span>
    });
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> })
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">30</span>)
      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-params"><span class="hljs-string">'#f5f5f5'</span></span>) {
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'滑动删除列表'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">28</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">marginBottom</span>(<span class="hljs-number">20</span>)

      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {
        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">taskList</span>, <span class="hljs-function">(<span class="hljs-params">task, index</span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-title class_">Stack</span>() {
              <span class="hljs-comment">// 删除按钮（默认隐藏在右侧）</span>
              <span class="hljs-title class_">Button</span>(<span class="hljs-string">'删除'</span>)
                .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
                .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
                .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff4d4f'</span>)
                .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
                .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">left</span>: -<span class="hljs-number">200</span> })

              <span class="hljs-comment">// 列表项内容（可滑动）</span>
              <span class="hljs-title class_">Text</span>(task)
                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
                .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)
                .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">80</span>)
                .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
                .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ffffff'</span>)
                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
                .<span class="hljs-title function_">translate</span>({ <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">deleteOffsetX</span>[index] })
                .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">type</span> === <span class="hljs-title class_">TouchType</span>.<span class="hljs-property">MOVE</span>) {
                    <span class="hljs-comment">// 监听滑动事件，更新位移</span>
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleSwipe</span>(index, e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">x</span> - e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">startX</span>);
                  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.<span class="hljs-property">type</span> === <span class="hljs-title class_">TouchType</span>.<span class="hljs-property">END</span>) {
                    <span class="hljs-comment">// 滑动距离不足100，回弹</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">deleteOffsetX</span>[index] &gt; -<span class="hljs-number">100</span>) {
                      <span class="hljs-title function_">animateTo</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span> }, <span class="hljs-function">() =&gt;</span> {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">deleteOffsetX</span>[index] = <span class="hljs-number">0</span>;
                      });
                    }
                  }
                })
            }
          }
        })
      }

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'跳转到详情页（渐变效果）'</span>)
        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#2f54eb'</span>)
        .<span class="hljs-title function_">marginTop</span>(<span class="hljs-number">30</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          router.<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/DetailPage'</span> });
        })
    }
  }
}

<span class="hljs-comment">// 详情页（复用页面渐变转场）</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">DetailPage</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>()
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#f5f5f5'</span>)
      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-params">FlexAlign.Center</span>) {
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'详情页'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">32</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'返回列表页'</span>)
        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff4d4f'</span>)
        .<span class="hljs-title function_">marginTop</span>(<span class="hljs-number">30</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          router.<span class="hljs-title function_">backUrl</span>();
        })
    }
  }

  <span class="hljs-title function_">pageTransition</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">PageTransition</span>()
      .<span class="hljs-title function_">enter</span>(<span class="hljs-string">'fade'</span>, { <span class="hljs-attr">duration</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseInOut</span> })
      .<span class="hljs-title function_">exit</span>(<span class="hljs-string">'fade'</span>, { <span class="hljs-attr">duration</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseInOut</span> })
  }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-11">2. 核心效果说明</h3>
<ul>
<li>列表项滑动：通过<code>onTouch</code>监听滑动事件，<code>animateTo</code>控制<code>translate</code>位移，实现滑动露出删除按钮；</li>
<li>删除动画：点击删除后，列表项快速滑出屏幕，动画结束后移除数据；</li>
<li>页面渐变：通过<code>pageTransition</code>配置<code>fade</code>效果，跳转和返回时均有平滑渐变过渡。</li>
</ul>
<h2 data-id="heading-12">五、实战踩坑指南</h2>
<h3 data-id="heading-13">1. 动画不生效</h3>
<ul>
<li>确保属性是「响应式状态」：必须用<code>@State</code>/<code>@Link</code>等装饰器，普通变量修改无法触发动画；</li>
<li>动画函数包裹正确：<code>animateTo</code>的回调函数内必须直接修改属性，不可嵌套异步操作；</li>
<li>版本适配：HarmonyOS 5.0 + 支持<code>PageTransition</code>的<code>fade</code>/<code>slide</code>简化配置，低版本需手动配置<code>TransitionEffect</code>。</li>
</ul>
<h3 data-id="heading-14">2. 滑动删除效果异常</h3>
<ul>
<li>限制滑动范围：避免滑动过度导致 UI 错乱，建议限制在删除按钮宽度范围内；</li>
<li>状态同步：<code>deleteOffsetX</code>数组需与列表数据一一对应，删除数据时同步移除对应位移状态。</li>
</ul>
<h3 data-id="heading-15">3. 转场效果卡顿</h3>
<ul>
<li>减少动画元素：避免同时对多个复杂组件添加动画；</li>
<li>简化动画逻辑：优先使用系统提供的<code>fade</code>/<code>slide</code>等基础效果，自定义动画避免复杂计算。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F46b54a56c7e54e74973e0af43c077bff%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" title="https://developer.huawei.com/consumer/cn/training/classDetail/46b54a56c7e54e74973e0af43c077bff?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" target="_blank" ref="nofollow noopener noreferrer">加入班级，学习鸿蒙开发</a></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[银河麒麟 V10 安装部署瀚高数据库 HighGoDB 4.5 全流程（统信UOS Server 20同理）]]></title>    <link>https://juejin.cn/post/7583984122235781162</link>    <guid>https://juejin.cn/post/7583984122235781162</guid>    <pubDate>2025-12-16T03:51:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122235781162" data-draft-id="7583984122235732010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="银河麒麟 V10 安装部署瀚高数据库 HighGoDB 4.5 全流程（统信UOS Server 20同理）"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-12-16T03:51:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="路遥_13"/> <meta itemprop="url" content="https://juejin.cn/user/2863549167699853"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            银河麒麟 V10 安装部署瀚高数据库 HighGoDB 4.5 全流程（统信UOS Server 20同理）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2863549167699853/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    路遥_13
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:51:14.000Z" title="Tue Dec 16 2025 03:51:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 环境准备</h2>
<p>操作系统：银河麒麟 V10
数据库版本：HighGoDB 4.5（瀚高数据库，兼容 PostgreSQL）
安装文件：hgdb-4.5-e94b212-20250227.x86_64.rpm
将安装包上传至服务器（本文目录：/home）。</p>
<h2 data-id="heading-1">2. 安装数据库</h2>
<p>进入安装包目录，执行安装命令,安装完成后，会自动在 systemd 中注册服务：</p>
<pre><code class="hljs language-perl" lang="perl">[root@localhost home]<span class="hljs-comment"># rpm -ivh hgdb-4.5-e94b212-20250227.x86_64.rpm </span>
Verifying...                          <span class="hljs-comment">################################# [100%]</span>
准备中...                          <span class="hljs-comment">################################# [100%]</span>
正在升级/安装...
   <span class="hljs-number">1</span>:hgdb-<span class="hljs-number">4.5</span>-e94b212                 <span class="hljs-comment">################################# [100%]</span>
Created <span class="hljs-keyword">symlink</span> /etc/systemd/<span class="hljs-keyword">system</span>/multi-user.target.wants/hgdb-<span class="hljs-number">4.5</span>.service → /usr/lib/systemd/<span class="hljs-keyword">system</span>/hgdb-<span class="hljs-number">4.5</span>.service.
Created <span class="hljs-keyword">symlink</span> /etc/systemd/<span class="hljs-keyword">system</span>/graphical.target.wants/hgdb-<span class="hljs-number">4.5</span>.service → /usr/lib/systemd/<span class="hljs-keyword">system</span>/hgdb-<span class="hljs-number">4.5</span>.service.
</code></pre>
<p>UOS Server 20安装命令：<code>yum install hgdb-4.5-29a3ba5-20250619.x86_64.rpm</code></p>
<p>默认安装目录为：</p>
<pre><code class="hljs language-bash" lang="bash">/opt/highgo/hgdb-4.5/
</code></pre>
<h2 data-id="heading-2">3. 初始化数据库</h2>
<p>进入 <code>bin</code> 目录，执行初始化命令：</p>
<pre><code class="hljs language-sql" lang="sql">[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">~</span>]# cd <span class="hljs-operator">/</span>opt<span class="hljs-operator">/</span>highgo<span class="hljs-operator">/</span>hgdb<span class="hljs-number">-4.5</span><span class="hljs-operator">/</span>bin
[root<span class="hljs-variable">@localhost</span> bin]# .<span class="hljs-operator">/</span>initdb <span class="hljs-operator">-</span>D ..<span class="hljs-operator">/</span>data <span class="hljs-operator">-</span>A scram<span class="hljs-operator">-</span>sha<span class="hljs-number">-256</span> <span class="hljs-operator">&gt;</span> <span class="hljs-operator">/</span>opt<span class="hljs-operator">/</span>highgo<span class="hljs-operator">/</span>hgdb<span class="hljs-number">-4.5</span><span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>initdb.log
initdb: could <span class="hljs-keyword">not</span> find suitable text <span class="hljs-keyword">search</span> configuration <span class="hljs-keyword">for</span> locale "zh_CN.UTF-8"
Enter <span class="hljs-keyword">new</span> sysdba password: 
再输入一遍: 
Enter <span class="hljs-keyword">new</span> syssao password: 
再输入一遍: 
Enter <span class="hljs-keyword">new</span> syssso password: 
再输入一遍: 
<span class="hljs-number">2025</span><span class="hljs-number">-08</span><span class="hljs-number">-20</span> <span class="hljs-number">09</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15.770</span> CST [<span class="hljs-number">16233</span>] 日志:  Switchover the SSHA Role. <span class="hljs-keyword">Current</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">NONE</span>
<span class="hljs-number">2025</span><span class="hljs-number">-08</span><span class="hljs-number">-20</span> <span class="hljs-number">09</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15.839</span> CST [<span class="hljs-number">16235</span>] 日志:  Switchover the SSHA Role. <span class="hljs-keyword">Current</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">NONE</span>
</code></pre>
<p>初始化时会要求设置 三类用户密码：</p>
<ul>
<li>sysdba（系统管理员）</li>
<li>syssao（安全保密管理员）</li>
<li>syssso（安全审计员）
完成后执行 SSL 证书生成：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">root@localhost bin</span>]<span class="hljs-meta"># ./hg_sslkeygen.sh /opt/highgo/hgdb-4.5/data</span>
Setting the ssl configuration to /opt/highgo/hgdb<span class="hljs-number">-4.5</span>/data
Generating RSA <span class="hljs-keyword">private</span> key, <span class="hljs-number">2048</span> <span class="hljs-function">bit <span class="hljs-built_in">long</span> <span class="hljs-title">modulus</span> (<span class="hljs-params"><span class="hljs-number">2</span> primes</span>)
................................................................+++++
...+++++
e <span class="hljs-keyword">is</span> 65537 (<span class="hljs-params"><span class="hljs-number">0x010001</span></span>)
</span></code></pre>
<h2 data-id="heading-3">4. 配置环境变量</h2>
<p>进入 etc 目录，拷贝环境变量模板：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">root@localhost bin</span>]<span class="hljs-meta"># cd /opt/highgo/hgdb-4.5/etc</span>
[<span class="hljs-meta">root@localhost etc</span>]<span class="hljs-meta"># cp hgdbenv.sample hgdb.env</span>
[<span class="hljs-meta">root@localhost etc</span>]<span class="hljs-meta"># vim hgdb.env 		# 根据自己的需求修改</span>
[<span class="hljs-meta">root@localhost etc</span>]<span class="hljs-meta"># source hgdb.env		# 加载环境变量</span>
[<span class="hljs-meta">root@localhost etc</span>]<span class="hljs-meta"># echo $HGDB_HOME		# 测试环境变量</span>
</code></pre>
<h2 data-id="heading-4">5、配置IP访问</h2>
<pre><code class="hljs language-sql" lang="sql">[root<span class="hljs-variable">@localhost</span> etc]# systemctl <span class="hljs-keyword">start</span> hgdb<span class="hljs-number">-4.5</span>.service		# 启动服务
[root<span class="hljs-variable">@localhost</span> etc]# psql <span class="hljs-operator">-</span>d highgo <span class="hljs-operator">-</span>U sysdba				# 连接数据库
用户 sysdba 的口令：
注意:  
<span class="hljs-comment">-------------------------------------------</span>
Login <span class="hljs-keyword">User</span>: sysdba 
Login <span class="hljs-type">time</span>: <span class="hljs-number">2025</span><span class="hljs-number">-08</span><span class="hljs-number">-20</span> <span class="hljs-number">10</span>:<span class="hljs-number">08</span>:<span class="hljs-number">31.795855</span><span class="hljs-operator">+</span><span class="hljs-number">08</span> 
Login Address: [<span class="hljs-keyword">local</span>] 
<span class="hljs-keyword">Last</span> Login Status: SUCCESS 
Login Failures: <span class="hljs-number">0</span> 
Valied Until: <span class="hljs-number">2025</span><span class="hljs-number">-08</span><span class="hljs-number">-27</span> <span class="hljs-number">09</span>:<span class="hljs-number">59</span>:<span class="hljs-number">15</span><span class="hljs-operator">+</span><span class="hljs-number">08</span> 
<span class="hljs-comment">-------------------------------------------</span>

psql (<span class="hljs-number">4.5</span>)
输入 "help" 来获取帮助信息.

highgo<span class="hljs-operator">=</span># <span class="hljs-keyword">show</span> listen_addresses;			# 查看监听地址
 listen_addresses 
<span class="hljs-comment">------------------</span>
 localhost
(<span class="hljs-number">1</span> 行记录)

highgo<span class="hljs-operator">=</span># <span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">set</span> listen_addresses <span class="hljs-operator">=</span> <span class="hljs-string">'*'</span>;	# 修改监听地址
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span>
highgo<span class="hljs-operator">=</span># exit;
[root<span class="hljs-variable">@localhost</span> etc]#
[root<span class="hljs-variable">@localhost</span> <span class="hljs-operator">/</span>]# vim <span class="hljs-operator">/</span>opt<span class="hljs-operator">/</span>highgo<span class="hljs-operator">/</span>hgdb<span class="hljs-number">-4.5</span><span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>pg_hba.conf		# 修改 pg_hba.conf
# 新增一行，允许所有 IP 连接：
host    <span class="hljs-keyword">all</span>    <span class="hljs-keyword">all</span>    <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-operator">/</span><span class="hljs-number">0</span>    scram<span class="hljs-operator">-</span>sha<span class="hljs-number">-256</span>
</code></pre>
<p>重启数据库
<code>systemctl restart hgdb-4.5.service</code></p>
<h2 data-id="heading-5">6. 开放防火墙端口</h2>
<p>瀚高数据库默认端口是 5866，需要在防火墙放行：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 永久放行 5866 端口</span>
firewall-cmd <span class="hljs-attr">--zone</span>=public --add-port=<span class="hljs-number">5866</span>/tcp --permanent

<span class="hljs-comment"># 重新加载防火墙配置</span>
firewall-cmd --reload

<span class="hljs-comment"># 查看端口是否已开放</span>
firewall-cmd <span class="hljs-attr">--zone</span>=public --list-ports
</code></pre>
<h2 data-id="heading-6">7. 验证远程连接</h2>
<p>在客户端使用 psql 或 Navicat / DBeaver 等工具连接：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">host:</span> <span class="hljs-string">服务器IP</span>
<span class="hljs-attr">port:</span> <span class="hljs-number">5866</span>
<span class="hljs-attr">database:</span> <span class="hljs-string">highgo</span>
<span class="hljs-attr">username:</span> <span class="hljs-string">sysdba</span>
<span class="hljs-attr">password:</span> <span class="hljs-string">初始化时设置的密码</span>
</code></pre>
<h2 data-id="heading-7">8. 更新瀚高数据库lic</h2>
<pre><code class="hljs language-bash" lang="bash">/opt/highgo/hgdb-4.5/bin/hg_lic -l -P /opt/highgo/hgdb-4.5 -F /opt/highgo/hgdb-4.5/data/hgdb.lic
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elpis 第三阶段· 领域模型架构建设]]></title>    <link>https://juejin.cn/post/7583980250734444607</link>    <guid>https://juejin.cn/post/7583980250734444607</guid>    <pubDate>2025-12-16T05:01:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250734444607" data-draft-id="7583912899389554731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elpis 第三阶段· 领域模型架构建设"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2025-12-16T05:01:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一念之间lq"/> <meta itemprop="url" content="https://juejin.cn/user/2541726616524583"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elpis 第三阶段· 领域模型架构建设
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726616524583/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一念之间lq
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:01:37.000Z" title="Tue Dec 16 2025 05:01:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.概述</h2>
<p>在Elpis项目领域模型架构主要是以基于 <strong>JSON Schema</strong> 的 DSL（领域特定语言）数据配置驱动页面渲染的架构。我们以一套标准项目提取出公共的<code>Model</code>配置结合可全自定义化的<code>Project</code>配置继承合并成独立完整项目的<code>JSON Schema</code>配置文件,结合<code>dashboard</code> 模板引擎解析最终生成我们需要的中后台项目。基于这样的<code>DSL配置化</code>领域模型架构下将80%业务逻辑沉淀,提高开发效率。</p>
<h2 data-id="heading-1">2.领域模型架构</h2>
<h3 data-id="heading-2">1.领域模型架构设计</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b36d22e26ed479d9c30d65652d76fdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15LmL6Ze0bHE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766466449&amp;x-signature=bTiDwSzjBD6WSg0WuBfetw2FGC8%3D" alt="ScreenShot_2025-12-16_090523_054.png" loading="lazy"/></p>
<h3 data-id="heading-3">2.领域模型架构流程</h3>
<h4 data-id="heading-4">1.项目DSL配置文件生成</h4>
<p>通过<code>Model</code>基础配置与各个<code>Project</code>独立项目配置合并,形成各个项目完整的项目配置内容,并且在<code>BFF Server</code>层提供Api 获取配置项供给前端使用。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">//`Model`基础配置与各个`Project`独立项目配置合并继承</span>
<span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);

<span class="hljs-comment">// project 继承 model</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">projectExtendModel</span> = (<span class="hljs-params">model, project</span>) =&gt; {
    <span class="hljs-keyword">return</span> _.<span class="hljs-title function_">mergeWith</span>({}, model, project, <span class="hljs-function">(<span class="hljs-params">modelValue, projValue</span>) =&gt;</span> {
        <span class="hljs-comment">//处理数组合并的特殊情况</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(modelValue) &amp;&amp; <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(projValue)) {
            <span class="hljs-keyword">let</span> result = []

            <span class="hljs-comment">//因为 project 继承model,所以需要修改和新增内容的情况</span>
            <span class="hljs-comment">//project 有的键值,model也有 =&gt; 修改(重载)</span>
            <span class="hljs-comment">//project 有的键值,model没有 =&gt; 新增 拓展)</span>
            <span class="hljs-comment">//model 有的键值,project没有 =&gt; 保留(继承)</span>

            <span class="hljs-comment">//处理修改和保留</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; modelValue.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">let</span> modelItem = modelValue[i]
                <span class="hljs-keyword">const</span> projItem = projValue.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">projItem</span> =&gt;</span> projItem.<span class="hljs-property">key</span> === modelItem.<span class="hljs-property">key</span>)
                <span class="hljs-comment">// project有的键值,model也有,则递归调用 projectExtendModel 方法覆盖修改</span>
                result.<span class="hljs-title function_">push</span>(projItem ? <span class="hljs-title function_">projectExtendModel</span>(modelItem, projItem) : modelItem)
            }
            <span class="hljs-comment">//处理新增</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; projValue.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">let</span> projItem = projValue[i]
                <span class="hljs-keyword">const</span> modelItem = modelValue.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">modelItem</span> =&gt;</span> modelItem.<span class="hljs-property">key</span> === projItem.<span class="hljs-property">key</span>)
                <span class="hljs-keyword">if</span> (!modelItem) {
                    result.<span class="hljs-title function_">push</span>(projItem)
                }
            }
            <span class="hljs-keyword">return</span> result
        }
    });
}
</code></pre>
<h4 data-id="heading-5">2. Dashboard 模板引擎搭建</h4>
<p>先了解下DSL中<code>JSON Schema</code>配置文件字段以便于好了解Dashboard 模板引擎是如何进行解析</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">{
    <span class="hljs-attr">model</span>: <span class="hljs-string">'Dashboard'</span>,<span class="hljs-comment">//模版类型,不同模版类型对应不一样的模版数据结构</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">""</span>,<span class="hljs-comment">//模版名称</span>
    <span class="hljs-attr">desc</span>: <span class="hljs-string">""</span>,<span class="hljs-comment">//模版描述</span>
    <span class="hljs-attr">icon</span>: <span class="hljs-string">""</span>,<span class="hljs-comment">//模版图标</span>
    <span class="hljs-attr">homePage</span>: <span class="hljs-string">""</span>,<span class="hljs-comment">//首页路径(项目配置)</span>
    <span class="hljs-comment">//头部菜单</span>
    <span class="hljs-attr">menu</span>: [{
        <span class="hljs-attr">key</span>: <span class="hljs-string">''</span>,<span class="hljs-comment">//菜单key,唯一标识</span>
        <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,<span class="hljs-comment">//菜单名称</span>
        <span class="hljs-attr">menuType</span>: <span class="hljs-string">''</span>,<span class="hljs-comment">//菜单类型,枚举值,group / module</span>

        <span class="hljs-comment">// 当menuType == group 可填,展示子菜单</span>
        <span class="hljs-attr">subMenu</span>: [{
            <span class="hljs-comment">//可递归menuItem,{ key,name,menuType... } </span>
        }, ...]
        
        <span class="hljs-comment">// 当 menuType == module 可填</span>
        <span class="hljs-attr">moduleType</span>: <span class="hljs-string">''</span>,<span class="hljs-comment">//模块类型,枚举值: sider / iframe / custom/ schema</span>
        
        <span class="hljs-comment">// 当 moduleType == sider 时</span>
        siderConfig={
            <span class="hljs-attr">menu</span>: [{
                <span class="hljs-comment">// 可递归menuItem(除去moduleType == sider)</span>
                <span class="hljs-comment">//也就是说在侧边栏的菜单配置不能再 进行moduleType == sider 配置这样不合理</span>
                <span class="hljs-comment">//多级菜单 menuType=group 配置子菜单</span>
            }]
        }
        
        <span class="hljs-comment">// 当 moduleType == iframe 时</span>
        <span class="hljs-attr">iframeConfig</span>: {
            <span class="hljs-attr">path</span>: <span class="hljs-string">''</span><span class="hljs-comment">//iframe 路径</span>
        },
        
        <span class="hljs-comment">// 当 moduleType == custom 时</span>
        <span class="hljs-attr">customConfig</span>: {
            <span class="hljs-attr">path</span>: <span class="hljs-string">''</span><span class="hljs-comment">//自定义路由路径</span>
        },
        
        <span class="hljs-comment">// 当 moduleType == schema 时</span>
        schemaConfig={...}
    }]
}
</code></pre>
<h5 data-id="heading-6">1. 导航栏与侧边栏</h5>
<p>在DSL中根据<code>menu</code>字段进行导航栏上的菜单的渲染,在通过<code>menuType</code>字段判断是否导航栏上当前菜单需要子菜单展示,<code>moduleType</code>表示当前菜单在页面上的展示方式。只是<code>moduleType=sider</code>时需要侧边栏菜单。</p>
<ul>
<li><strong>header-container(导航栏组件)</strong> : 根据<code>menu</code>菜单配置内容生成导航栏</li>
<li><strong>sider-container(侧边栏组件)</strong>: 根据<code>siderConfig.menu</code>配置内容生成侧边栏</li>
</ul>
<h5 data-id="heading-7">2. 页面内容展示方式</h5>
<p>我们将<strong>main-content</strong> 插槽下作为页面的核心渲染区域,主要有三种方式展示页面,以配置项<code>moduleType</code>(iframe/custom/schema)值进行展示区分,在前端以划分不同路由分别解析对应的页面组件。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">[
   <span class="hljs-comment">// moduleType === iframe 时,处理iframeConfig</span>
   {
       <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/dashboard/iframe'</span>,
       <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./complex-view/iframe-view/iframe-view.vue'</span>)
   },
   <span class="hljs-comment">// moduleType === schema 时,处理schemaConfig</span>
   {
       <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/dashboard/schema'</span>,
       <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./complex-view/schema-view/schema-view.vue'</span>)
   },
   <span class="hljs-comment">// moduleType === custom 时,处理customConfig</span>
   {
       <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/dashboard/todo'</span>,
       <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./todo/todo.vue'</span>)
   },
   <span class="hljs-comment">// moduleType === sider 时,处理siderConfig</span>
   {
       <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/dashboard/sider'</span>,
       <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./complex-view/sider-view/sider-view.vue'</span>),
       <span class="hljs-attr">children</span>: [
           {
               <span class="hljs-attr">path</span>: <span class="hljs-string">'iframe'</span>,
               <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./complex-view/iframe-view/iframe-view.vue'</span>)
           },
           {
               <span class="hljs-attr">path</span>: <span class="hljs-string">'schema'</span>,
               <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./complex-view/schema-view/schema-view.vue'</span>)
           },
           {
               <span class="hljs-attr">path</span>: <span class="hljs-string">'todo'</span>,
               <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./todo/todo.vue'</span>)
           },
       ]
   },
   <span class="hljs-comment">//进行sider路由兜底</span>
   {
       <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/dashboard/sider/:chapters'</span>,
       <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./complex-view/sider-view/sider-view.vue'</span>),
   },
]
</code></pre>
<h6 data-id="heading-8">2.1 <strong>iframe-view</strong></h6>
<p>这种方式主要使用<code>iframe</code>控件加载第三方页面,实现不同页面的集成方案</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">moduleType</span>: <span class="hljs-string">'iframe'</span>,
<span class="hljs-attr">iframeConfig</span>: {
   <span class="hljs-attr">path</span>: <span class="hljs-string">'https://www.baidu.com/'</span>,
}
</code></pre>
<h6 data-id="heading-9">2.2 <strong>custom-view</strong></h6>
<p>当然以这种方式进行加载时,没有特定组件进行加载,因为这个属于<code>用户自定义路由方式</code>进行呈现,
这样就给用户在该架构下进行定制化开发。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 因为在该架构下首屏采用SSR方式加载,后续页面采用CSR模式进行路由跳转</span>
<span class="hljs-comment">// 当 moduleType == custom 时 </span>
<span class="hljs-attr">moduleType</span>: <span class="hljs-string">'custom'</span>,
<span class="hljs-attr">customConfig</span>: { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/todo'</span>  <span class="hljs-comment">//自定义路由路径</span>
},

<span class="hljs-comment">//前端routes 路由定义</span>
{
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/dashboard/todo'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./todo/todo.vue'</span>)
},
</code></pre>
<h6 data-id="heading-10">2.3 <strong>schema-view</strong> 重点</h6>
<p><code>schema-view</code>解析架构图,以商品管理模块进行展示
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a8f94b9284e48358e9c57e164aa49a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15LmL6Ze0bHE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766466449&amp;x-signature=EnJ8a3YITcrePdMSYG0P9xPV8JQ%3D" alt="ScreenShot_2025-12-16_113038_589.png" loading="lazy"/>
商品管理Schema配置如下</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">        {
            <span class="hljs-attr">key</span>: <span class="hljs-string">'product'</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">'商品管理'</span>,
            <span class="hljs-attr">menuType</span>: <span class="hljs-string">'module'</span>,
            <span class="hljs-attr">moduleType</span>: <span class="hljs-string">'schema'</span>,
            <span class="hljs-attr">schemaConfig</span>: {
                <span class="hljs-attr">api</span>: <span class="hljs-string">'/api/proj/product'</span>,
                <span class="hljs-attr">schema</span>: {
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
                    <span class="hljs-attr">properties</span>: {
                        <span class="hljs-attr">product_id</span>: {
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
                            <span class="hljs-attr">label</span>: <span class="hljs-string">'商品ID'</span>,
                            <span class="hljs-attr">tableOption</span>: {
                                <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>,
                                <span class="hljs-string">"show-overflow-tooltip"</span>: <span class="hljs-literal">true</span>
                            },
                        },
                        <span class="hljs-attr">product_name</span>: {
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
                            <span class="hljs-attr">label</span>: <span class="hljs-string">'商品名称'</span>,
                            <span class="hljs-attr">tableOption</span>: {
                                <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
                            },
                            <span class="hljs-attr">searchOption</span>: {
                                <span class="hljs-attr">comType</span>: <span class="hljs-string">'dynamicSelect'</span>,
                                <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'请选择商品名称'</span>,
                                <span class="hljs-attr">api</span>: <span class="hljs-string">'/api/proj/product_enum/list'</span>,
                            }
                        },
                        <span class="hljs-attr">price</span>: {
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
                            <span class="hljs-attr">label</span>: <span class="hljs-string">'价格'</span>,
                            <span class="hljs-attr">tableOption</span>: {
                                <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
                            },
                            <span class="hljs-attr">searchOption</span>: {
                                <span class="hljs-attr">comType</span>: <span class="hljs-string">'select'</span>,
                                <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'请选择价格'</span>,
                                <span class="hljs-attr">enumList</span>: [{
                                    <span class="hljs-attr">value</span>: -<span class="hljs-number">999</span>,
                                    <span class="hljs-attr">label</span>: <span class="hljs-string">'全部'</span>
                                }, {
                                    <span class="hljs-attr">value</span>: <span class="hljs-string">'39.9'</span>,
                                    <span class="hljs-attr">label</span>: <span class="hljs-string">'¥39.9'</span>
                                }, {
                                    <span class="hljs-attr">value</span>: <span class="hljs-string">'199'</span>,
                                    <span class="hljs-attr">label</span>: <span class="hljs-string">'¥199'</span>
                                }, {
                                    <span class="hljs-attr">value</span>: <span class="hljs-string">'699'</span>,
                                    <span class="hljs-attr">label</span>: <span class="hljs-string">'¥699'</span>
                                }]
                            }
                        },
                        <span class="hljs-attr">inventory</span>: {
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
                            <span class="hljs-attr">label</span>: <span class="hljs-string">'库存'</span>,
                            <span class="hljs-attr">tableOption</span>: {
                                <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
                            },
                            <span class="hljs-attr">searchOption</span>: {
                                <span class="hljs-attr">comType</span>: <span class="hljs-string">'input'</span>,
                                <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'请输入商品名称'</span>
                            }
                        },
                        <span class="hljs-attr">create_time</span>: {
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
                            <span class="hljs-attr">label</span>: <span class="hljs-string">'创建时间'</span>,
                            <span class="hljs-attr">tableOption</span>: {},
                            <span class="hljs-attr">searchOption</span>: {
                                <span class="hljs-attr">comType</span>: <span class="hljs-string">'dateRange'</span>,
                            }
                        },
                    }
                },
                <span class="hljs-attr">tableConfig</span>: {
                    <span class="hljs-attr">headerButtons</span>: [{
                        <span class="hljs-attr">label</span>: <span class="hljs-string">'新增商品'</span>,
                        <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'showComponent'</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">'primary'</span>,
                        <span class="hljs-attr">plain</span>: <span class="hljs-literal">true</span>
                    }],
                    <span class="hljs-attr">rowButtons</span>: [
                        {
                            <span class="hljs-attr">label</span>: <span class="hljs-string">"修改"</span>,
                            <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'showComponent'</span>,
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
                        },
                        {
                            <span class="hljs-attr">label</span>: <span class="hljs-string">"删除"</span>,
                            <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'remove'</span>,
                            <span class="hljs-attr">eventOption</span>: {
                                <span class="hljs-attr">params</span>: {
                                    <span class="hljs-attr">product_id</span>: <span class="hljs-string">"schema::product_id"</span>
                                }
                            },
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'danger'</span>,
                        }],
                }
            }
        },
</code></pre>
<p>在<code>schema-view</code>中<code>search-panel</code>(搜索）与 <code>table-panel</code>（表格）组成,首先我们就要针对<code>schema</code>配置进行拆分找出我们需要的配置内容,给其下的组件进行使用</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">    <span class="hljs-comment">//通用构建 schema方法</span>
    <span class="hljs-comment">// _schema配置选项, comName=&gt;table / search</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">buildDtoSchema</span> = (<span class="hljs-params">_schema, comName</span>) =&gt; {
        <span class="hljs-keyword">if</span> (!_schema?.<span class="hljs-property">properties</span>) { <span class="hljs-keyword">return</span> {} }
        <span class="hljs-keyword">const</span> dtoSchema = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
            <span class="hljs-attr">properties</span>: {}
        }
        <span class="hljs-comment">// 提取有效 schema 字段量</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> _schema.<span class="hljs-property">properties</span>) {
            <span class="hljs-keyword">const</span> props = _schema.<span class="hljs-property">properties</span>[key]
            <span class="hljs-keyword">if</span> (props[<span class="hljs-string">`<span class="hljs-subst">${comName}</span>Option`</span>]) {
                <span class="hljs-keyword">let</span> dtoProps = {}
                <span class="hljs-comment">//提取 props 中非 option的部分,存放到 dtoProps中</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> pKey <span class="hljs-keyword">in</span> props) {
                    <span class="hljs-keyword">if</span> (pKey.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'Option'</span>) &lt; <span class="hljs-number">0</span>) {
                        dtoProps[pKey] = props[pKey]
                    }
                }
                <span class="hljs-comment">//处理 comName Option</span>
                dtoProps = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, dtoProps, { <span class="hljs-attr">option</span>: props[<span class="hljs-string">`<span class="hljs-subst">${comName}</span>Option`</span>] })
                dtoSchema.<span class="hljs-property">properties</span>[key] = dtoProps
            }
        }
        <span class="hljs-keyword">return</span> dtoSchema
    }
</code></pre>
<h6 data-id="heading-11">2.3.1 <strong>table-panel</strong></h6>
<p>该组件主要完成表格Schema配置页面渲染</p>
<ol>
<li>通过<code>tableConfig.headerButtons</code>完成表格上面操作<code>新增商品</code>按钮渲染</li>
<li>通过<code>tableConfig.rowButtons</code>完成表格每列操作栏上完成<code>修改,删除</code>按钮,并针对按钮的事件<code>eventKey</code>进行相关的配置<code>eventOption</code>完成业务操作</li>
<li>使用<code>schema-table</code> 组件,完成业务接口请求,并通过<code>schema.properties</code>中每一项<code>key</code>完成表格渲染</li>
</ol>
<h6 data-id="heading-12">2.3.2 <strong>search-panel</strong></h6>
<p>该组件主要完成表单搜索栏,进行对表格数据的筛选搜索功能</p>
<ol>
<li>通过<code>schema.properties</code>中每一项的<code>searchOption.comType</code>完成对应的<code>动态表单</code>加载展示,</li>
<li>并使用<code>tableOption</code> 进行属性透传,使用UI组件已有的功能</li>
<li>以及针对不同表单类型提供自定义选项或者api请求获取选项数据</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">//不同表单组件的统一导出</span>
<span class="hljs-keyword">import</span> input <span class="hljs-keyword">from</span> <span class="hljs-string">"./complex-view/input/input.vue"</span>;
<span class="hljs-keyword">import</span> select <span class="hljs-keyword">from</span> <span class="hljs-string">"./complex-view/select/select.vue"</span>;
<span class="hljs-keyword">import</span> dynamicSelect <span class="hljs-keyword">from</span> <span class="hljs-string">"./complex-view/dynamic-select/dynamic-select.vue"</span>;
<span class="hljs-keyword">import</span> dateRange <span class="hljs-keyword">from</span> <span class="hljs-string">"./complex-view/date-range/date-range.vue"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">SearchItemConfig</span> = {
    <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">component</span>: input,
    },
    <span class="hljs-attr">select</span>: {
        <span class="hljs-attr">component</span>: select,
    },
    <span class="hljs-attr">dynamicSelect</span>: {
        <span class="hljs-attr">component</span>: dynamicSelect,
    },
    <span class="hljs-attr">dateRange</span>: {
        <span class="hljs-attr">component</span>: dateRange,
    }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">SearchItemConfig</span>


<span class="hljs-comment">//表单组件的引用</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchItemConfig</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./search-item-config.js'</span>

&lt;!-- 动态组件 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(schemaItem, key) in schema.properties"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"key"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"schemaItem.label"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 子控件展示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:ref</span>=<span class="hljs-string">"handleSearchComList"</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"SearchItemConfig[schemaItem.option?.comType].component"</span>
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"key"</span> <span class="hljs-attr">:schemaKey</span>=<span class="hljs-string">"key"</span> <span class="hljs-attr">:schema</span>=<span class="hljs-string">"schemaItem"</span> @<span class="hljs-attr">loaded</span>=<span class="hljs-string">"handleLoaded"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span>

</code></pre>
<h2 data-id="heading-13">3.总结</h2>
<ol>
<li>学习了<code>JsonShema</code>配置化形成领域模型架构思路</li>
<li>学会提炼关键业务,从以前的开发代码的编写转变为业务需求的配置定义</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue---scoped,deep,CSS Modules]]></title>    <link>https://juejin.cn/post/7583955708318695424</link>    <guid>https://juejin.cn/post/7583955708318695424</guid>    <pubDate>2025-12-16T03:31:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318695424" data-draft-id="7583955708318662656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue---scoped,deep,CSS Modules"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T03:31:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="永远少年"/> <meta itemprop="url" content="https://juejin.cn/user/3967483738859639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue---scoped,deep,CSS Modules
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3967483738859639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    永远少年
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:31:33.000Z" title="Tue Dec 16 2025 03:31:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0"> scoped</h2>
<blockquote>
<p>scoped是Vue组件标签中的一个特性,作用是限制CSS 只作用于当前组件，防止影响全局或其他组件。
</p></blockquote>
<h4 data-id="heading-1">作用原理</h4>
<blockquote>
<p> Vue 通过 自动添加属性选择器（如 <code>data-v-xxxx</code>）来作用于当前组件的元素，从而实现 CSS 作用域隔离。</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    Scoped 样式示例
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p> 编译后</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="container" data-v-abc123&gt;Scoped 样式示例&lt;/<span class="hljs-selector-tag">div</span>&gt;
<span class="hljs-selector-class">.container</span><span class="hljs-selector-attr">[data-v-abc123]</span> {
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-2">deep</h2>
<blockquote>
<p><code>/deep/</code>（或 <code>::v-deep</code>）在 Vue 中用于<strong>穿透 scoped 样式</strong>，作用是让<strong>样式作用于子组件的深层次元素</strong>，即使它们位于 <code>scoped</code> 作用域内。</p>
</blockquote>
<h4 data-id="heading-3">实际开发应用</h4>
<ul>
<li> 修改第三方库(Element UI,Ant等)组件样式</li>
<li>直接作用子组件深层次的元素</li>
</ul>
<h4 data-id="heading-4">使用方式</h4>
<h5 data-id="heading-5">vue2(/deep/或者&gt;&gt;&gt;)</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
/deep/ <span class="hljs-selector-class">.child-element</span> {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 或者使用 &gt;&gt;&gt;，它是 `/deep/` 的别名 */</span>
&gt;&gt;&gt; <span class="hljs-selector-class">.child-element</span> {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h5 data-id="heading-6"> vue3(::v-deep() 或者:deep())</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
::<span class="hljs-built_in">v-deep</span>(.child-element) {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
:<span class="hljs-built_in">deep</span>(.child-element) {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-7">CSS Modules</h2>
<h4 data-id="heading-8">优点</h4>
<ul>
<li><strong>避免全局样式冲突</strong>：每个组件的样式都是局部的，不会影响其他组件。</li>
<li><strong>支持动态绑定</strong>：可以用 <code>:class</code> 绑定动态样式。</li>
<li><strong>适用于 Vue 组件化开发</strong>，特别是在大型项目中更容易管理。</li>
</ul>
<h4 data-id="heading-9">基本使用</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"$style.title"</span>&gt;</span>Hello CSS Modules<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">module</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.title</span> {
  <span class="hljs-attribute">color</span>: red;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-10">作用原理</h4>
<p>1.title类名会被自动转换成一个唯一的名称</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.title___3ghj2</span> { <span class="hljs-attribute">color</span>: red; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>; }
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>2.组件中的 <code>:class="$style.title"</code> 会被转换成这个唯一类名</p>
<h4 data-id="heading-11">父组件传递 CSS Modules </h4>
<p>父组件: </p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">:styles</span>=<span class="hljs-string">"$style"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">module</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.parentTitle</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">color</span>: green;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>子组件</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"styles.parentTitle"</span>&gt;</span>我是子组件<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>([<span class="hljs-string">"styles"</span>]);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-12"> Vue 组件外部使用 CSS Modules</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">"./style.module.css"</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"styles.box"</span>&gt;</span>外部 CSS Modules<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>style.module.css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background-color</span>: yellow;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3---(1)项目工程创建]]></title>    <link>https://juejin.cn/post/7583973613197361167</link>    <guid>https://juejin.cn/post/7583973613197361167</guid>    <pubDate>2025-12-16T03:42:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583973613197361167" data-draft-id="7583971282892472372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3---(1)项目工程创建"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T03:42:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端无涯"/> <meta itemprop="url" content="https://juejin.cn/user/3967483738859639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3---(1)项目工程创建
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3967483738859639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端无涯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:42:24.000Z" title="Tue Dec 16 2025 03:42:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0"> 1.基于vue-cli 创建</h2>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment"># 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span></span>
vue --version
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># 安装或者升级你的@vue/cli</span></span> 
npm install -g @vue/cli
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># 执行创建命令</span></span>
vue create vue3_project
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">#  随后选择3.x</span></span>
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">#  Choose a version of Vue.js that you want to start the project with (Use arrow keys)</span></span>
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">#  &gt; 3.x</span></span>
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">#    2.x</span></span>
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># 启动</span></span>
cd vue3_project
npm run serve
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-1">2.基于vite创建</h2>
<p><strong>前提条件:</strong></p>
<ul>
<li>熟悉命令行</li>
<li>已安装 18.3 或更高版本的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" title="https://nodejs.org/" target="_blank" ref="nofollow noopener noreferrer">Node.js</a></li>
</ul>
<p> 运行命令行命令_</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> vue<span class="hljs-variable">@latest</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>根据自己项目的实际情况选择配置项,完成项目工程基本配置</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd24e04ece954288a5274dc4a3bd85c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5peg5rav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461344&amp;x-signature=9mjZuNWoHNYMk3YkKsfxIlfkk2o%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p><strong>补充提示:</strong></p>
<ul>
<li>推荐的 IDE 配置是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2F" title="https://code.visualstudio.com/" target="_blank" ref="nofollow noopener noreferrer">Visual Studio Code</a> + <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarketplace.visualstudio.com%2Fitems%3FitemName%3DVue.volar" title="https://marketplace.visualstudio.com/items?itemName=Vue.volar" target="_blank" ref="nofollow noopener noreferrer">Vue - Official 扩展</a></li>
<li>要了解构建工具 Vite 更多背后的细节，请查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2F" title="https://cn.vitejs.dev/" target="_blank" ref="nofollow noopener noreferrer">Vite 文档</a>。</li>
<li>如果你选择使用 TypeScript，请阅读 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Ftypescript%2Foverview.html" title="https://cn.vuejs.org/guide/typescript/overview.html" target="_blank" ref="nofollow noopener noreferrer">TypeScript 使用指南</a>。 </li>
</ul>
<h2 data-id="heading-2">3.工程文件列表</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cb42aac090e418cb072f61a4e39d22a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5peg5rav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461344&amp;x-signature=AP3r7vZRrAsq82OxOPvFfPxbqcs%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<pre><code class="hljs language-csharp" lang="csharp">vue3-project-vite/
│── node_modules/        <span class="hljs-meta"># 依赖库，`npm install` 后生成</span>
│── <span class="hljs-keyword">public</span>/              <span class="hljs-meta"># 静态资源目录，不会被 Vite 处理，直接映射到根目录</span>
│   ├── favicon.ico      <span class="hljs-meta"># 网站图标</span>
│── src/                 <span class="hljs-meta"># 源代码目录（Vue 组件、页面、状态管理等）</span>
│   ├── assets/          <span class="hljs-meta"># 存放静态资源（图片、CSS）</span>
│   ├── components/      <span class="hljs-meta"># 复用组件,常用封装功能组件</span>
│   ├── views/           <span class="hljs-meta"># 主要页面（通常按路由划分）</span>
│   ├── router/          <span class="hljs-meta"># Vue Router 配置,管理页面路由</span>
│   ├── store/           <span class="hljs-meta"># Vuex / Pinia 状态管理</span>
│   ├── App.vue          <span class="hljs-meta"># 根组件,所有页面组件的父组件</span>
│   ├── main.js / main.ts <span class="hljs-meta"># 入口文件，初始化 Vue 实例</span>
│── .gitignore           <span class="hljs-meta"># Git 忽略文件</span>
│── index.html           <span class="hljs-meta"># 入口 HTML 文件</span>
│── package.json         <span class="hljs-meta"># 依赖和脚本配置</span>
│── vite.config.js       <span class="hljs-meta"># Vite 配置文件</span>
│── tsconfig.json        <span class="hljs-meta"># TypeScript 配置（仅 TypeScript 项目）</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>重点区别:</strong> vue3与vue2工程文件区别点最大的地方在于,入口文件vue3是index.html文件,浏览器加载时最先解析,vite处理HTML文件通过
</p><pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">""</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/favicon.ico"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3---(2)setup]]></title>    <link>https://juejin.cn/post/7583992239102394420</link>    <guid>https://juejin.cn/post/7583992239102394420</guid>    <pubDate>2025-12-16T03:43:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583992239102394420" data-draft-id="7583992239102378036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3---(2)setup"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T03:43:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端无涯"/> <meta itemprop="url" content="https://juejin.cn/user/3967483738859639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3---(2)setup
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3967483738859639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端无涯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:43:31.000Z" title="Tue Dec 16 2025 03:43:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0">概述</h2>
<blockquote>
<p>Vue 3 引入了 <code>setup</code> 语法，使 Composition API 成为核心特性之一。它相比 Options API 提供了更清晰的逻辑组织，提高了代码可维护性。组件中所用到的：数据、方法、计算属性、监视......等等，均配置在<code>setup</code>中。</p>
</blockquote>
<h2 data-id="heading-1">基本语法 </h2>
<h4 data-id="heading-2"><strong>传统 <code>setup</code></strong></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">name</span>:<span class="hljs-string">'Test'</span>,
    <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>){
      <span class="hljs-comment">// 数据(vue2 写在data中)</span>
      <span class="hljs-keyword">let</span> name = <span class="hljs-string">'张三'</span>
      <span class="hljs-keyword">let</span> age = <span class="hljs-number">18</span>
      <span class="hljs-comment">// 方法(vue2 写在method中)</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>){
        name = <span class="hljs-string">'zhang-san'</span> <span class="hljs-comment">//注意：此时这么修改name页面是不变化的</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name)
      }
      <span class="hljs-comment">// 返回一个对象，对象中的内容，模板中可以直接使用</span>
      <span class="hljs-keyword">return</span> {name,age,test}
    }
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>注意:setup返回值如果返回一个对象,那么对象的属性方法都可以在模板中使用,但是如果返回一个函数,则可以自定义渲染内容</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params"/>){
 <span class="hljs-keyword">return</span> <span class="hljs-function">()=&gt;</span><span class="hljs-string">'自定义文字显示'</span>
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-3"><strong><code>&lt;script setup&gt;</code></strong></h4>
<blockquote>
<p>不需要 <code>return</code>，变量和方法会自动暴露给 <code>template</code></p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">

  <span class="hljs-comment">// 数据</span>
  <span class="hljs-keyword">let</span> name = <span class="hljs-string">'张三'</span>
  <span class="hljs-keyword">let</span> age = <span class="hljs-number">18</span>
  <span class="hljs-comment">// 方法</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>){
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>扩展：上述代码，还需要编写一个不写<code>setup</code>的<code>script</code>标签，去指定组件名字，比较麻烦，我们可以借助<code>vite</code>中的插件简化</p>
<ol>
<li><code>npm i vite-plugin-vue-setup-extend -D</code></li>
<li><code>vite.config.ts</code>中使用插件</li>
<li><code>&lt;script setup lang="ts" name="Person"&gt;</code></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueSetupName</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-vue-setup-extend'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [ <span class="hljs-title class_">VueSetupName</span> () ]
})
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-4"/>
<h2 data-id="heading-5">执行时机</h2>
<ul>
<li><strong>在 <code>beforeCreate</code> 之前执行</strong></li>
<li><strong>不能访问 <code>this</code></strong>（因为 <code>this</code> 还未初始化,this输出为undefined）</li>
<li><strong>只能在 <code>&lt;script setup&gt;</code> 或 <code>setup()</code> 中使用</strong></li>
</ul>
<h2 data-id="heading-6"> 重点</h2>
<ol>
<li>可与vue2中的data,method,computed 等混用,而且在data,method...中也可以访问到setup中的属性和方法(因为setup先执行,数据方法都挂载到vm上,可以通过this访问到)</li>
<li>setup不能访问vue2中的配置(data,method),原因在于setup先执行,此时this还是undefined</li>
</ol>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3---(3)ref,reactive,toRefs,toRef]]></title>    <link>https://juejin.cn/post/7583973472323272719</link>    <guid>https://juejin.cn/post/7583973472323272719</guid>    <pubDate>2025-12-16T03:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583973472323272719" data-draft-id="7583971282892505140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3---(3)ref,reactive,toRefs,toRef"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T03:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端无涯"/> <meta itemprop="url" content="https://juejin.cn/user/3967483738859639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3---(3)ref,reactive,toRefs,toRef
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3967483738859639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端无涯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:44:29.000Z" title="Tue Dec 16 2025 03:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0">ref</h2>
<ul>
<li>
<p><strong>作用：</strong> 定义响应式变量。</p>
</li>
<li>
<p><strong>语法：</strong> <code>let name= ref('测试')</code>。</p>
</li>
<li>
<p><strong>返回值：</strong> 一个<code>RefImpl</code>的实例对象，简称<code>ref对象</code>或<code>ref</code>，<code>ref</code>对象的<code>value</code><strong>属性是响应式的</strong>。</p>
</li>
<li>
<p><strong>注意点：</strong></p>
<ul>
<li><code>JS</code>中操作数据需要：<code>name.value</code>，但模板中不需要<code>.value</code>，直接使用即可。</li>
<li>对于<code>let name = ref('测试')</code>来说，<code>name</code>不是响应式的，<code>name.value</code>是响应式的。</li>
<li>其实<code>ref</code>接收的数据可以是：<strong>基本类型</strong>、<strong>对象类型</strong>。</li>
<li>若<code>ref</code>接收的是对象类型，内部其实也是调用了<code>reactive</code>函数。</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>姓名：{{name}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {ref} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">let</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'测试'</span>)

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-1"> reactive</h2>
<ul>
<li><strong>作用：</strong> 定义一个<strong>响应式对象</strong>（基本类型不要用它，要用<code>ref</code>，否则报错）</li>
<li><strong>语法：</strong> <code>let 响应式对象= reactive(源对象)</code>。</li>
<li><strong>返回值：</strong> 一个<code>Proxy</code>的实例对象，简称：响应式对象。</li>
<li><strong>注意点：</strong> <code>reactive</code>定义的响应式数据是“深层次”的。</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>姓名：{{people.name}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>年龄：{{people.age}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {reactive} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">let</span> people = <span class="hljs-title function_">reactive</span>({<span class="hljs-attr">name</span>:<span class="hljs-string">'测试'</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>})

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-2"> ref和reactive区别</h2>
<h4 data-id="heading-3">定义数据类型</h4>
<p><strong>ref</strong>:基本数据类型(如 <code>string</code>、<code>number</code>、<code>boolean</code>),对象数据类型(如 数组,对象)</p>
<p><strong>reactive</strong>: 对象数据类型</p>
<h4 data-id="heading-4">使用区别</h4>
<ol>
<li><code>ref</code>创建的变量必须使用<code>.value</code>（可以使用<code>volar</code>插件自动添加<code>.value</code>）。</li>
<li><code>reactive</code>重新分配一个新对象，会<strong>失去</strong>响应式（可以使用<code>Object.assign</code>去整体替换）。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bcb5cb99b0542c0b43dc6de5cdcd1e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5peg5rav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461469&amp;x-signature=zLbFLqU5euf1Z2Ipsieg04u9NM8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<blockquote>
<p>实际使用过程中, 一个基本类型的响应式数据，必须使用<code>ref</code> ,对象层级不深ref,reactive两者都行,层级比较多一般用reactive(实际可以ref一把梭,就是代码里面.value比较多,看起来不美观)</p>
</blockquote>
<h2 data-id="heading-5">toRefs和toRef </h2>
<ul>
<li>作用：将一个响应式对象中的每一个属性，转换为<code>ref</code>对象。常用于 <strong>解构</strong> 时保持响应式。</li>
<li>备注：<code>toRefs</code>与<code>toRef</code>功能一致，但<code>toRefs</code>可以批量转换。</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>姓名：{{people.name}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>年龄：{{people.age}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {reactive} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">let</span> people = <span class="hljs-title function_">reactive</span>({<span class="hljs-attr">name</span>:<span class="hljs-string">'测试'</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>})
<span class="hljs-comment">// 通过toRefs 将people中的多个属性取出,并保持响应式能力</span>
<span class="hljs-keyword">let</span> {name,age} = <span class="hljs-title function_">toRefs</span>(people)
<span class="hljs-comment">// 通过toRef 将people中的某个属性取出,并保持响应式能力</span>
<span class="hljs-keyword">let</span> age = <span class="hljs-title function_">toRef</span>(people,<span class="hljs-string">'age'</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-6">面试重点</h2>
<h4 data-id="heading-7">为什么ref要用.value</h4>
<blockquote>
<ul>
<li><strong>基本数据类型</strong>：<code>ref</code> 包装的基本数据类型（如数字、字符串）并不直接是一个对象，它们是原始值。因此，<code>ref</code> 使用 <code>.value</code> 来访问或修改实际的值。</li>
<li><strong>包装行为</strong>：<code>ref</code> 是为了让 Vue 追踪这些数据的变化并保持响应式，使用 <code>.value</code> 是 Vue 设计的一部分，用来明确区分原始值和响应式对象。</li>
</ul>
</blockquote>
<h4 data-id="heading-8">为什么reactive不使用.value</h4>
<blockquote>
<ul>
<li><code>reactive</code> 是通过 <strong>代理对象</strong> 来实现响应式的。<code>reactive</code> 返回的是一个 <strong>代理对象</strong>，当你访问对象的属性时，代理会处理 getter 和 setter 操作来实现响应式。</li>
<li>这种方式是 Vue 3 中的 <strong>Proxy</strong> API 工作机制的体现，因此不需要 <code>.value</code>，可以直接访问对象的属性。</li>
</ul>
</blockquote>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手摸手快速搭建 Vue3 + ElementPlus 后台管理系统模板，使用 JavaScript]]></title>    <link>https://juejin.cn/post/7584014975241879562</link>    <guid>https://juejin.cn/post/7584014975241879562</guid>    <pubDate>2025-12-16T03:34:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584014975241879562" data-draft-id="7581412607061180462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手摸手快速搭建 Vue3 + ElementPlus 后台管理系统模板，使用 JavaScript"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T03:34:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金挖土"/> <meta itemprop="url" content="https://juejin.cn/user/3681619519481069"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手摸手快速搭建 Vue3 + ElementPlus 后台管理系统模板，使用 JavaScript
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3681619519481069/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金挖土
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:34:51.000Z" title="Tue Dec 16 2025 03:34:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 + Vite + ElementPlus + JavaScript 后台管理系统模板</h2>
<h3 data-id="heading-1">废话写在前面</h3>
<p>对于咱这些在小公司摸爬滚打（混吃等死）的前端胶水工程师来说，经常面对的业务就是各种纷繁复杂（大差不差）的后台管理系统了，以前是 <code>Vue2 + ElementUI</code> 一把梭，现在都快 2026 年了 bro，AI 都不写公元前的那一套了，咱再不动一动挪一挪，那真有点说不过去了，新项目还是上点略新一点的活整整吧</p>
<p>话说小公司讲究一个什么，那就是不讲究，额额，讲究一个快速开发业务，这里就不得不提一下 JavaScript 最初的灵活性了，用 TypeScript 总感觉有点自缚手脚，大炮打苍蝇的赶脚，而且就砸门那两碗水，写到最后也是 anyScript。所以还是使用 JavaScript 吧，不过该有的规范还是得有的，不然成石山了扣到咱头上也不好处理不是</p>
<p>ok 话不多杯，准备开整！（进入正题就不废话了，什么？你问我前面为啥要废话，废话，不是废话正经人谁看啊）</p>
<hr/>
<h3 data-id="heading-2">创建项目</h3>
<p>环境准备：</p>
<ul>
<li>nodejs 版本：建议大于 20</li>
<li>使用 pnpm</li>
<li>VSCode 插件 - <code>Vue (Official)</code></li>
</ul>
<p>找一个看得顺眼的目录执行命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create vite elementplus-js-admin -- --template vue
</code></pre>
<p>解释下这段命令干啥的：</p>



































<table><thead><tr><th>分段</th><th>含义</th><th>注意事项</th></tr></thead><tbody><tr><td><code>pnpm create</code></td><td>调用 <code>pnpm</code> 的「脚手架生成器」</td><td>等价于 <code>npm create</code> / <code>yarn create</code></td></tr><tr><td><code>vite</code></td><td>告诉 <code>pnpm</code> 要拉取的脚手架包是 <code>create-vite</code></td><td>底层会运行 <code>npx create-vite</code></td></tr><tr><td><code>elementplus-admin-js</code></td><td>生成的<strong>项目文件夹名</strong></td><td>不要带空格、特殊符号</td></tr><tr><td><code>--</code></td><td><strong>参数分隔符</strong></td><td>告诉 pnpm：后面是传给脚手架的参数，不是给 pnpm 的</td></tr><tr><td><code>--template vue</code></td><td>传给 <code>create-vite</code> 的参数<strong>指定模板</strong></td><td>只能是 <code>vue</code>, <code>react</code>, <code>vanilla</code>… 之一</td></tr></tbody></table>
<p>进入到刚创建的目录并执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> elementplus-js-admin
pnpm dev
</code></pre>
<p>好了，嗖的一下，大功告成（就问你快不快吧）</p>
<h3 data-id="heading-3">配置路径别名</h3>
<p><code>vue.config.js</code> 中：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./src'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)),
    },
  },
})
</code></pre>
<p>另外，想要让 VSCode 在输入 <code>@</code> 的时候有智能提示，需要新建 <code>jsconfig.json</code> 文件：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exclude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node_modules"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dist"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">Element Plus</h3>
<h4 data-id="heading-5">安装</h4>
<pre><code class="hljs language-bash" lang="bash">pnpm add element-plus
</code></pre>
<h4 data-id="heading-6">配置自动导入 (推荐)</h4>
<p>为了获得最佳的开发体验和打包体积优化，推荐使用<strong>自动导入</strong>。需要安装两个插件：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D unplugin-vue-components unplugin-auto-import
</code></pre>
<p>简单介绍一下这两个插件的作用：</p>
<ul>
<li>AutoImport ：让你在 JS 代码中直接使用 ElementPlus 的 <strong>API</strong></li>
<li>Components ：让你在模板中直接使用 ElementPlus 的<strong>组件</strong></li>
</ul>
<p>如果要使用 ElementPlus 的图标，还需要安装自动导入 icons 依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D unplugin-icons
</code></pre>
<p>然后修改 <code>vite.config.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">IconsResolver</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-icons/resolver'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Icons</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-icons/vite'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElementPlusResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/resolvers'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-comment">// https://vite.dev/config/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title class_">AutoImport</span>({
      <span class="hljs-comment">// 自动导入 vue 相关函数，如：ref, reactive, toRef 等</span>
      <span class="hljs-comment">// imports: ['vue'], // 我是说如果，对 Vue3 还不熟，建议注释该行，手动导入 vue 相关函数</span>
      <span class="hljs-attr">resolvers</span>: [
        <span class="hljs-comment">// 自动导入 Element Plus 相关函数，如：ElMessage, ElNotification 等</span>
        <span class="hljs-title class_">ElementPlusResolver</span>(),
        <span class="hljs-comment">// 自动导入图标组件</span>
        <span class="hljs-title class_">IconsResolver</span>(),
      ],
      <span class="hljs-attr">eslintrc</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> }, <span class="hljs-comment">// 生成 .eslintrc-auto-import.json，eslint 不报错</span>
    }),
    <span class="hljs-title class_">Components</span>({
      <span class="hljs-attr">resolvers</span>: [
        <span class="hljs-comment">// 自动注册 Element Plus 组件</span>
        <span class="hljs-title class_">ElementPlusResolver</span>(),
        <span class="hljs-comment">// 自动注册图标组件</span>
        <span class="hljs-title class_">IconsResolver</span>({
          <span class="hljs-attr">enabledCollections</span>: [<span class="hljs-string">'ep'</span>], <span class="hljs-comment">// element-plus 图标库</span>
        }),
      ],
    }),
    <span class="hljs-title class_">Icons</span>({
      <span class="hljs-comment">// 自动安装图标库</span>
      <span class="hljs-attr">autoInstall</span>: <span class="hljs-literal">true</span>,
    }),
  ],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./src'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)),
    },
  },
})
</code></pre>
<p>实际使用示例：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Components 插件处理这些组件的自动注册 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showMessage"</span>&gt;</span>click me<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 图标组件 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-search</span> /&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 图标按钮 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i-ep-CirclePlus</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon--left"</span> /&gt;</span>click me<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">showMessage</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// AutoImport 插件处理这些 API 的自动导入</span>
  <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'操作成功！'</span>);
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">主题配置</h3>
<p>新建 <code>src/styles/theme.scss</code>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* Element Plus Theme Overrides */</span>
<span class="hljs-comment">/* https://element-plus.org/en-US/guide/theme.html#how-to-override-it */</span>
<span class="hljs-keyword">@forward</span> <span class="hljs-string">'element-plus/theme-chalk/src/common/var.scss'</span> with (
  <span class="hljs-variable">$colors</span>: (
    <span class="hljs-string">'primary'</span>: (
      <span class="hljs-string">'base'</span>: <span class="hljs-number">#165dff</span>,
    ),
    <span class="hljs-string">'success'</span>: (
      <span class="hljs-string">'base'</span>: <span class="hljs-number">#009298</span>,
    ),
    <span class="hljs-string">'warning'</span>: (
      <span class="hljs-string">'base'</span>: <span class="hljs-number">#e6a23c</span>,
    ),
    <span class="hljs-string">'danger'</span>: (
      <span class="hljs-string">'base'</span>: <span class="hljs-number">#ff2664</span>,
    ),
    <span class="hljs-string">'error'</span>: (
      <span class="hljs-string">'base'</span>: <span class="hljs-number">#ff2664</span>,
    ),
    <span class="hljs-string">'info'</span>: (
      <span class="hljs-string">'base'</span>: <span class="hljs-number">#909399</span>,
    ),
  )
);
</code></pre>
<p>配置 <code>vite.config.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElementPlusResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/resolvers'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-title class_">AutoImport</span>({
        <span class="hljs-attr">resolvers</span>: [
          <span class="hljs-title class_">ElementPlusResolver</span>({
            <span class="hljs-attr">importStyle</span>: <span class="hljs-string">'sass'</span>, <span class="hljs-comment">// 核心作用是告诉 Vite 自动导入 Element Plus 组件的 SCSS 源码，而不是编译好的 CSS 文件，这是自定义主题生效的关键。如果不写（默认）：插件会自动导入组件对应的预编译 .css 文件。这些 CSS 是已经打包死的（例如主色定死了是 #409eff），在项目中定义的 SCSS 变量无法渗透进去，主题配置会失效</span>
          }),
        ],
      }),
      <span class="hljs-title class_">Components</span>({
        <span class="hljs-attr">resolvers</span>: [
          <span class="hljs-comment">// 自动注册 Element Plus 组件</span>
          <span class="hljs-title class_">ElementPlusResolver</span>({
            <span class="hljs-attr">importStyle</span>: <span class="hljs-string">'sass'</span>,
          }),
        ],
      }),
    ],
    <span class="hljs-attr">css</span>: {
      <span class="hljs-attr">preprocessorOptions</span>: {
        <span class="hljs-attr">scss</span>: {
          <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@use "@/styles/theme.scss" as *;`</span>,
        },
      },
    },
  }
})
</code></pre>
<h3 data-id="heading-8">本地图标</h3>
<p>前面说了如何使用 ElementPlus （第三方）的图标，如果要使用本地 svg 图标，需要安装插件：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D vite-plugin-svg-icons
</code></pre>
<p>此插件核心作用：</p>
<ol>
<li><strong>自动扫描目录</strong> → 递归读取 <code>src/assets/icons/*.svg</code></li>
<li><strong>生成 SVG 雪碧图</strong> → 打包成 <strong>单个 .js</strong> 文件，<strong>减少 HTTP 请求</strong></li>
<li><strong>组件化调用</strong> → 通过 <code>&lt;svg&gt;&lt;use href="#icon-name"&gt;&lt;/use&gt;&lt;/svg&gt;</code> 引用，<strong>零配置</strong></li>
<li><strong>按需加载</strong> → <strong>只打包使用的图标</strong>，<strong>体积↓30%+</strong></li>
<li><strong>热更新</strong> → <strong>修改 SVG → 页面实时刷新</strong></li>
<li><strong>样式继承</strong> → <strong>CSS 改颜色/大小</strong>，<strong>无 DOM 操作</strong></li>
</ol>
<p>如果会报错提示缺失 <code>fast-glob</code> 依赖，安装一下：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D fast-glob
</code></pre>
<p><code>vite.config.js</code> 中配置：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { createSvgIconsPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-svg-icons'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">createSvgIconsPlugin</span>({
      <span class="hljs-attr">iconDirs</span>: [<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./src/assets/icons'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))],
      <span class="hljs-attr">symbolId</span>: <span class="hljs-string">'icon-[dir]-[name]'</span>,
    }),
  ],
})
</code></pre>
<p>准备图标：</p>
<pre><code class="hljs language-arduino" lang="arduino">src/assets/icons/          ← 放所有 .svg
├─ home.svg
├─ user.svg
└─ logo.svg
</code></pre>
<p>新建 <code>src/components/SvgIcon.vue</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">name</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
  },
  <span class="hljs-attr">prefix</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'icon'</span>,
  },
  <span class="hljs-attr">className</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>,
  },
})

<span class="hljs-keyword">const</span> symbolId = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`#<span class="hljs-subst">${props.prefix}</span>-<span class="hljs-subst">${props.name}</span>`</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"className"</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">use</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"symbolId"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
svg {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1em</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1em</span>;
  <span class="hljs-attribute">vertical-align</span>: -<span class="hljs-number">0.15em</span>; <span class="hljs-comment">/* 因 icon 大小被设置为和字体大小一致，而 span 等标签的下边缘会和字体的基线对齐，故需设置一个往下的偏移比例，来纠正视觉上的未对齐效果 */</span>
  fill: currentcolor; <span class="hljs-comment">/* 支持外部 color/font-size 控制 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><code>main.js</code> 引入：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-string">'virtual:svg-icons-register'</span> <span class="hljs-comment">// vite-plugin-svg-icons 插件注册，生成雪碧图并注入 DOM，不引入会导致 svg 图标无法正常显示</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SvgIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/SvgIcon.vue'</span>

app.<span class="hljs-title function_">component</span>(<span class="hljs-string">'SvgIcon'</span>, <span class="hljs-title class_">SvgIcon</span>)
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">SvgIcon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home"</span> /&gt;</span>
</code></pre>
<h3 data-id="heading-9">Pinia</h3>
<p>安装：</p>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> pinia
</code></pre>
<p>可以把 pinia 看作船新版本的 vuex，使用 composition API，类比一下，新建 <code>src/store/modules/index.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ref -&gt; state</span>
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

  <span class="hljs-comment">// computed -&gt; getters</span>
  <span class="hljs-keyword">const</span> double = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> count.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>
  })

  <span class="hljs-comment">// function -&gt; actions</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
    count.<span class="hljs-property">value</span>++
  }

  <span class="hljs-keyword">return</span> { count, double, increment }
})
</code></pre>
<p>导出创建的 store 模块，新建  <code>src/store/index.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/counter'</span>
</code></pre>
<p>main.js 中引入：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p>实际使用案例：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- src/App.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>
<span class="hljs-keyword">const</span> counterStore = <span class="hljs-title function_">useCounterStore</span>()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"counterStore.increment"</span>&gt;</span>爸爸点我<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">HelloWorld</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- src/components/HelloWorld.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>
<span class="hljs-keyword">const</span> counterStore = <span class="hljs-title function_">useCounterStore</span>()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>我被点了：{{ counterStore.count }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>加倍：{{ counterStore.double }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">Vue Router</h3>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add vue-router
</code></pre>
<p>新建 <code>src/router/index.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-comment">// 导入布局组件 (后续创建)</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/layout/index.vue'</span> 

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'dashboard'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Dashboard'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/dashboard/index.vue'</span>), <span class="hljs-comment">// 自行创建</span>
        <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'首页'</span> }
      }
    ]
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Login'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/login/index.vue'</span>), <span class="hljs-comment">// 自行创建</span>
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'登录'</span> }
  }
]

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  routes
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<p>在 <code>src/main.js</code> 中注册路由：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-title function_">use</span>(router)
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-11">Axios</h3>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add axios
</code></pre>
<p>新建 <code>src/utils/request.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
})

<span class="hljs-comment">// 请求拦截器</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
    <span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">token</span>) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">token</span> = userStore.<span class="hljs-property">token</span>
    }
    <span class="hljs-keyword">return</span> config
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-comment">// 响应拦截器</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { code, message } = response.<span class="hljs-property">data</span>
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
    }

    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(message || <span class="hljs-string">'Error'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message || <span class="hljs-string">'Error'</span>))
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>) {
      <span class="hljs-keyword">const</span> { code, message } = error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>
      <span class="hljs-keyword">if</span> (code === <span class="hljs-number">500</span>) {
        <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'当前页面已失效，请重新登录'</span>, <span class="hljs-string">'提示'</span>, {
          <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
        }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>()
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/'</span>
        })
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(message || <span class="hljs-string">'Error'</span>)
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error.<span class="hljs-property">message</span>)
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service
</code></pre>
<blockquote>
<p>需要根据后端实际返回格式调整相应部分代码</p>
</blockquote>
<p>新建 <code>src/api/user.js</code> ，待会 mock 数据后模拟请求：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = (<span class="hljs-params">data</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/login'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
    data,
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserInfo</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/info'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'get'</span>,
  })
}
</code></pre>
<h3 data-id="heading-12">Mock 数据</h3>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D vite-plugin-mock mockjs
</code></pre>
<p><code>vite.config.js</code> 中：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { viteMockServe } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-mock'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-comment">// ...</span>
      <span class="hljs-title function_">viteMockServe</span>({
        <span class="hljs-attr">mockPath</span>: <span class="hljs-string">'mock'</span>,
        <span class="hljs-attr">enable</span>: mode === <span class="hljs-string">'development'</span>,
      }),
    ],
  }
})
</code></pre>
<p>项目根目录下新建 <code>mock/user.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> mockjs <span class="hljs-keyword">from</span> <span class="hljs-string">'mockjs'</span>

<span class="hljs-keyword">const</span> userList = mockjs.<span class="hljs-title function_">mock</span>({
  <span class="hljs-comment">// 属性 list 的值是一个数组，其中含有 1 到 10 个元素</span>
  <span class="hljs-string">'list|1-10'</span>: [
    {
      <span class="hljs-comment">// 随机生成id号</span>
      <span class="hljs-attr">id</span>: <span class="hljs-string">'@id'</span>,
      <span class="hljs-comment">// 随机生成中文姓名</span>
      <span class="hljs-attr">name</span>: <span class="hljs-string">'@cname'</span>,
      <span class="hljs-comment">// 属性 id 是一个自增数，起始值为 1，每次增 1</span>
      <span class="hljs-string">'id|+1'</span>: <span class="hljs-number">1</span>,
      <span class="hljs-comment">// 随机生成ip地址</span>
      <span class="hljs-attr">ip</span>: <span class="hljs-string">'@ip'</span>,
      <span class="hljs-comment">// 随机生成省市区地址</span>
      <span class="hljs-attr">address</span>: <span class="hljs-string">'@county(true)'</span>,
      <span class="hljs-comment">// 随机生成邮政编码</span>
      <span class="hljs-attr">zip</span>: <span class="hljs-string">'@zip'</span>,
      <span class="hljs-comment">// 随机生成18-70之间的年龄</span>
      <span class="hljs-string">'age|18-70'</span>: <span class="hljs-number">20</span>,
      <span class="hljs-comment">// 随机生成日期</span>
      <span class="hljs-attr">date</span>: <span class="hljs-string">'@date("yyyy-MM-dd")'</span>,
      <span class="hljs-comment">// 随机生成头像</span>
      <span class="hljs-attr">avatar</span>: <span class="hljs-string">"@image('')"</span>,
    },
  ],
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/list'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'get'</span>,
    <span class="hljs-attr">response</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">data</span>: userList,
      }
    },
  },
]
</code></pre>
<p>执行 <code>pnpm dev</code>，<code>vite-plugin-mock</code> 会根据你提供的 mock 数据自动代理接口。此时，你就可以在前端代码中正常请求 <code>/api/user</code>，并且获取到模拟的响应数据，使用示例：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { getUserList } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/user'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserList</span>()
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
}

<span class="hljs-title function_">getData</span>()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c004ebf01f3a40058b17722404b8040e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5oyW5Zyf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461042&amp;x-signature=33L%2BUbBRycUhM10K9ihGCz41bWw%3D" alt="userlist.png" loading="lazy"/></p>
<h3 data-id="heading-13">搭建基础布局 (Layout)</h3>
<p>准备用 AI 写个简单布局页面，新建 <code>src/layout/index.vue</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>
<span class="hljs-keyword">import</span> { computed, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useRoute, useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()

<span class="hljs-comment">// 侧边栏折叠控制</span>
<span class="hljs-keyword">const</span> isCollapse = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleSidebar</span> = (<span class="hljs-params"/>) =&gt; {
  isCollapse.<span class="hljs-property">value</span> = !isCollapse.<span class="hljs-property">value</span>
}

<span class="hljs-comment">// 当前激活菜单</span>
<span class="hljs-keyword">const</span> activeMenu = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> route.<span class="hljs-property">path</span>)

<span class="hljs-comment">// 面包屑数据生成</span>
<span class="hljs-keyword">const</span> breadcrumbs = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> matched = route.<span class="hljs-property">matched</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">meta</span> &amp;&amp; item.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>)
  <span class="hljs-keyword">const</span> first = matched[<span class="hljs-number">0</span>]

  <span class="hljs-keyword">if</span> (!first || first.<span class="hljs-property">path</span> !== <span class="hljs-string">'/dashboard'</span>) {
    <span class="hljs-keyword">return</span> [{ <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>, <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'首页'</span> } }].<span class="hljs-title function_">concat</span>(matched)
  }
  <span class="hljs-keyword">return</span> matched
})

<span class="hljs-comment">// 退出登录</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogout</span> = (<span class="hljs-params"/>) =&gt; {
  router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
}

<span class="hljs-comment">// 下拉菜单指令处理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCommand</span> = (<span class="hljs-params">command</span>) =&gt; {
  <span class="hljs-keyword">if</span> (command === <span class="hljs-string">'logout'</span>) {
    <span class="hljs-title function_">handleLogout</span>()
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-container</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-wrapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 侧边栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sidebar-resize"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-aside</span> <span class="hljs-attr">:width</span>=<span class="hljs-string">"isCollapse ? '64px' : '220px'"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sidebar-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo-container"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ collapsed: isCollapse }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo-box"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-element-plus</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo-icon"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo-text"</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">"!isCollapse"</span>&gt;</span>Admin Elite<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">el-scrollbar</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span> <span class="hljs-attr">:default-active</span>=<span class="hljs-string">"activeMenu"</span> <span class="hljs-attr">:collapse</span>=<span class="hljs-string">"isCollapse"</span> <span class="hljs-attr">:collapse-transition</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">unique-opened</span> <span class="hljs-attr">router</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-menu-vertical"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"/dashboard"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i-ep-odometer</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>仪表盘<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">el-sub-menu</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"/user"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i-ep-user</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"/user/list"</span>&gt;</span>用户列表<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"/user/role"</span>&gt;</span>角色权限<span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-sub-menu</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"/settings"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i-ep-setting</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>系统设置<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-scrollbar</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-aside</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主容器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-container</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-container"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 顶部导航栏 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-left"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hamburger"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toggleSidebar"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"20"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ 'is-active': isCollapse }"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-fold</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!isCollapse"</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-expand</span> <span class="hljs-attr">v-else</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-breadcrumb-item</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in breadcrumbs"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.path"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"index === breadcrumbs.length - 1"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"no-redirect"</span>&gt;</span>{{ item.meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">v-else</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">"router.push(item.path)"</span>&gt;</span>{{ item.meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb-item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-breadcrumb</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-right"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> <span class="hljs-attr">trigger</span>=<span class="hljs-string">"click"</span> @<span class="hljs-attr">command</span>=<span class="hljs-string">"handleCommand"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"avatar-wrapper"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-avatar</span> <span class="hljs-attr">:size</span>=<span class="hljs-string">"32"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"userStore.avatar"</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-name"</span>&gt;</span>{{ userStore.username }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon--right"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i-ep-arrow-down</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">dropdown</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span>&gt;</span>个人中心<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">divided</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"logout"</span>&gt;</span>退出登录<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-header</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 内容区 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-main"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> <span class="hljs-attr">v-slot</span>=<span class="hljs-string">"{ Component }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fade-transform"</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"out-in"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"Component"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.app-wrapper</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">display</span>: flex;
}

<span class="hljs-comment">/* Sidebar Styling - Light Theme */</span>
<span class="hljs-selector-class">.sidebar-container</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffffff</span>;
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--el-border-color-light);
  <span class="hljs-attribute">transition</span>: width <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.25</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">1</span>);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1001</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">29</span>, <span class="hljs-number">35</span>, <span class="hljs-number">41</span>, <span class="hljs-number">0.05</span>);

  <span class="hljs-selector-class">.logo-container</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
    <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: center;
    // <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--el-border-color-lighter);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffffff</span>;
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">overflow</span>: hidden;

    <span class="hljs-selector-class">.logo-box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">32px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
    }

    <span class="hljs-selector-class">.logo-text</span> {
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-text-color-primary);
      <span class="hljs-attribute">white-space</span>: nowrap;
      <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, sans-serif;
    }

    &amp;<span class="hljs-selector-class">.collapsed</span> {
      <span class="hljs-selector-class">.logo-box</span> {
        <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">0</span>;
      }
    }
  }

  <span class="hljs-selector-class">.el-menu-vertical</span> {
    <span class="hljs-attribute">border-right</span>: none;

    :<span class="hljs-built_in">deep</span>(.el-menu-item) {
      &amp;<span class="hljs-selector-class">.is-active</span> {
        <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary-light-<span class="hljs-number">9</span>);
        <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
        <span class="hljs-attribute">border-right</span>: <span class="hljs-number">3px</span> solid <span class="hljs-built_in">var</span>(--el-color-primary);
      }

      &amp;<span class="hljs-selector-pseudo">:hover</span> {
        <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--el-fill-color-light);
      }
    }
  }
}

<span class="hljs-comment">/* Navbar Styling */</span>
<span class="hljs-selector-class">.navbar</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">21</span>, <span class="hljs-number">41</span>, <span class="hljs-number">0.08</span>);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;

  <span class="hljs-selector-class">.navbar-left</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
  }

  <span class="hljs-selector-class">.hamburger</span> {
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-text-color-regular);
    <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.3s</span>;

    &amp;<span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
    }
  }

  <span class="hljs-selector-class">.breadcrumb</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;

    <span class="hljs-selector-class">.no-redirect</span> {
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-text-color-primary);
      <span class="hljs-attribute">cursor</span>: text;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
    }

    <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-text-color-regular);
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">font-weight</span>: normal;

      &amp;<span class="hljs-selector-pseudo">:hover</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
      }
    }
  }

  <span class="hljs-selector-class">.navbar-right</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;

    <span class="hljs-selector-class">.avatar-wrapper</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.3s</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;

      &amp;<span class="hljs-selector-pseudo">:hover</span> {
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.025</span>);
      }

      <span class="hljs-selector-class">.user-name</span> {
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span>;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
        <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--el-text-color-regular);
      }
    }
  }
}

<span class="hljs-comment">/* Main Content Styling */</span>
<span class="hljs-selector-class">.main-container</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">transition</span>: margin-left <span class="hljs-number">0.28s</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--app-bg-color);
}

<span class="hljs-selector-class">.app-main</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">overflow-x</span>: hidden;
}

<span class="hljs-comment">/* Transitions */</span>
<span class="hljs-selector-class">.fade-transform-enter-active</span>,
<span class="hljs-selector-class">.fade-transform-leave-active</span> {
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span>;
}

<span class="hljs-selector-class">.fade-transform-enter-from</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">30px</span>);
}

<span class="hljs-selector-class">.fade-transform-leave-to</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">30px</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">创建基础页面</h3>
<p>在 <code>src/views</code> 下创建自己的业务页面，新建 <code>src/views/dashboard/index.vue</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-card</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"welcome-text"</span>&gt;</span>
      欢迎使用 Element Plus 后台管理系统
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.welcome-text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-15">登录页面</h3>
<p>为了有头有脸再用 AI 搞个登录页面 <code>src/views/login</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { getUserInfo, login } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/user'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>
<span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
<span class="hljs-keyword">const</span> loginFormRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> loginForm = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">rememberMe</span>: <span class="hljs-literal">false</span>,
})

<span class="hljs-keyword">const</span> loginRules = {
  <span class="hljs-attr">username</span>: [
    { <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入用户名'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
    { <span class="hljs-attr">min</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'用户名长度不能少于3位'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
  ],
  <span class="hljs-attr">password</span>: [
    { <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入密码'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
    { <span class="hljs-attr">min</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'密码长度不能少于6位'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
  ],
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!loginFormRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">await</span> loginFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> (valid) =&gt; {
    <span class="hljs-keyword">if</span> (valid) {
      loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>

      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">login</span>(loginForm)

        <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
        userStore.<span class="hljs-property">token</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>

        <span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>()
        userStore.<span class="hljs-property">avatar</span> = userInfo.<span class="hljs-property">data</span>.<span class="hljs-property">avatar</span>
        userStore.<span class="hljs-property">username</span> = userInfo.<span class="hljs-property">data</span>.<span class="hljs-property">username</span>
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(res.<span class="hljs-property">message</span> || <span class="hljs-string">'登录成功'</span>)
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>)
      } <span class="hljs-keyword">finally</span> {
        loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
      }
    }
  })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-bg-animation"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bubble bubble-1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bubble bubble-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bubble bubble-3"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo-container"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-element-plus</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo-icon"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-title"</span>&gt;</span>欢迎回来<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-subtitle"</span>&gt;</span>请登录您的账户以继续<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"loginFormRef"</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"loginForm"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"loginRules"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-form"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"username"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"loginForm.username"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"用户名 / 邮箱"</span> <span class="hljs-attr">:prefix-icon</span>=<span class="hljs-string">"undefined"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">prefix</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-user</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-icon"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"password"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"loginForm.password"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"密码"</span> <span class="hljs-attr">show-password</span> @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">"handleLogin"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">prefix</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-lock</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-icon"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-options"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-checkbox</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"loginForm.rememberMe"</span>&gt;</span>记住我<span class="hljs-tag">&lt;/<span class="hljs-name">el-checkbox</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">:underline</span>=<span class="hljs-string">"false"</span>&gt;</span>忘记密码？<span class="hljs-tag">&lt;/<span class="hljs-name">el-link</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-button"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleLogin"</span> <span class="hljs-attr">round</span>&gt;</span>
            {{ loading ? '登录中...' : '登 录' }}
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-footer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"divider"</span>&gt;</span>或者<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"social-login"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">circle</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-chat-dot-round</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">circle</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">i-ep-share</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 容器与背景 */</span>
<span class="hljs-selector-class">.login-container</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#1a1f38</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#252a4a</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Inter'</span>, -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, sans-serif;
}

<span class="hljs-comment">/* 动态背景气泡 */</span>
<span class="hljs-selector-class">.login-bg-animation</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">pointer-events</span>: none;
}

<span class="hljs-selector-class">.bubble</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">60px</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
  <span class="hljs-attribute">animation</span>: float <span class="hljs-number">10s</span> infinite ease-in-out;
}

<span class="hljs-selector-class">.bubble-1</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#409eff</span>;
  <span class="hljs-attribute">top</span>: -<span class="hljs-number">100px</span>;
  <span class="hljs-attribute">left</span>: -<span class="hljs-number">100px</span>;
  <span class="hljs-attribute">animation-delay</span>: <span class="hljs-number">0s</span>;
}

<span class="hljs-selector-class">.bubble-2</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#8e44ad</span>;
  <span class="hljs-attribute">bottom</span>: -<span class="hljs-number">50px</span>;
  <span class="hljs-attribute">right</span>: -<span class="hljs-number">50px</span>;
  <span class="hljs-attribute">animation-delay</span>: -<span class="hljs-number">2s</span>;
}

<span class="hljs-selector-class">.bubble-3</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#2ecc71</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">20%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">30%</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.4</span>;
  <span class="hljs-attribute">animation-delay</span>: -<span class="hljs-number">5s</span>;
}

<span class="hljs-keyword">@keyframes</span> float {
  <span class="hljs-number">0%</span>,
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(<span class="hljs-number">20px</span>, <span class="hljs-number">40px</span>);
  }
}

<span class="hljs-comment">/* 登录卡片 (Glassmorphism) */</span>
<span class="hljs-selector-class">.login-card</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">420px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.05</span>);
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);
  -webkit-backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">25px</span> <span class="hljs-number">50px</span> -<span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.login-card</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>);
  <span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);
}

<span class="hljs-comment">/* 头部 */</span>
<span class="hljs-selector-class">.login-header</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
}

<span class="hljs-selector-class">.logo-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">56px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">56px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#409eff</span>, <span class="hljs-number">#337ecc</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">16px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">64</span>, <span class="hljs-number">158</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-selector-class">.logo-icon</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.login-title</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">700</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">0.5px</span>;
}

<span class="hljs-selector-class">.login-subtitle</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.6</span>);
}

<span class="hljs-comment">/* 表单样式调整 */</span>
:<span class="hljs-built_in">deep</span>(.el-input__wrapper) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
  <span class="hljs-attribute">box-shadow</span>: none <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

:<span class="hljs-built_in">deep</span>(.el-input__inner) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">caret-color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">height</span>: auto;
}

:<span class="hljs-built_in">deep</span>(.el-input__wrapper:hover),
:<span class="hljs-built_in">deep</span>(.el-input__wrapper.is-focus) {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#409eff</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-comment">/* 修复浏览器自动填充背景变白问题 */</span>
:<span class="hljs-built_in">deep</span>(.el-input__inner:-webkit-autofill),
:<span class="hljs-built_in">deep</span>(.el-input__inner:-webkit-autofill:hover),
:<span class="hljs-built_in">deep</span>(.el-input__inner:-webkit-autofill:focus),
:<span class="hljs-built_in">deep</span>(.el-input__inner:-webkit-autofill:active) {
  -webkit-text-fill-<span class="hljs-attribute">color</span>: <span class="hljs-number">#ffffff</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">99999s</span> ease-in-out <span class="hljs-number">0s</span>;
  <span class="hljs-attribute">background-color</span>: transparent <span class="hljs-meta">!important</span>;
}

<span class="hljs-selector-class">.input-icon</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>);
}

<span class="hljs-selector-class">.form-options</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">24px</span>;
}

:<span class="hljs-built_in">deep</span>(.el-checkbox) {
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.7</span>);
}

:<span class="hljs-built_in">deep</span>(.el-checkbox__input.is-checked + .el-checkbox__label) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#409eff</span>;
}

<span class="hljs-selector-class">.login-button</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">22px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#409eff</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#0077ff</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">14px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">64</span>, <span class="hljs-number">158</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.39</span>);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.login-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.02</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">6px</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">64</span>, <span class="hljs-number">158</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>);
}

<span class="hljs-comment">/* 底部 */</span>
<span class="hljs-selector-class">.login-footer</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.divider</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-selector-class">.social-login</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
}

:<span class="hljs-built_in">deep</span>(.social-login .el-button) {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.7</span>);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

:<span class="hljs-built_in">deep</span>(.social-login .el-button:hover) {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
}

<span class="hljs-comment">/* 移动端适配 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
  <span class="hljs-selector-class">.login-card</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">30px</span> <span class="hljs-number">20px</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>简单模拟下登录逻辑，需要在 mock 中创建模拟接口，然后在 <code>src/api</code> 下封装请求函数，最后到相关组件中进行调用</p>
<h3 data-id="heading-16">效果</h3>
<p>登录页：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c96f4f350c4f4794aacd3ebe1814b46a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5oyW5Zyf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461042&amp;x-signature=dlmf09dsScI9Eth74gBdK4L90QY%3D" alt="login.png" loading="lazy"/></p>
<p>布局首页：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c34032d74ec48fba9e1739f37f80586~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5oyW5Zyf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461042&amp;x-signature=ePvMbWDlUvGS6S1XEDYKPYytkj8%3D" alt="layout.png" loading="lazy"/></p>
<p>感觉比我写得好。。不想丸辣</p>
<h3 data-id="heading-17">后续</h3>
<p>如果还有后续的话。。</p>
<ul>
<li>使用 Nest.js 搭建一个权限系统后端</li>
<li>左侧路由菜单根据权限系统返回内容动态生成</li>
<li>完善页面基础内容</li>
<li>团队协作：代码风格统一与 git 提交规范</li>
</ul>
<p>源码会提交到这个地址 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FsingleGou%2Felementplus-js-admin" target="_blank" title="https://github.com/singleGou/elementplus-js-admin" ref="nofollow noopener noreferrer">elementplus-js-admin</a>，欢迎 spa</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js 国际化实现方案详解]]></title>    <link>https://juejin.cn/post/7583971282892685364</link>    <guid>https://juejin.cn/post/7583971282892685364</guid>    <pubDate>2025-12-16T04:00:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583971282892685364" data-draft-id="7583973472323371023" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js 国际化实现方案详解"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2025-12-16T04:00:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="少卿"/> <meta itemprop="url" content="https://juejin.cn/user/26044010879709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js 国际化实现方案详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044010879709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    少卿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:00:42.000Z" title="Tue Dec 16 2025 04:00:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文详细介绍如何在 Next.js 15 (App Router) 中使用 next-intl 实现完整的国际化方案，包括路由国际化、内容翻译和 UI 组件库（Ant Design）的国际化。</p>
<h2 data-id="heading-0">技术栈</h2>
<ul>
<li><strong>Next.js 15</strong> - React 框架</li>
<li><strong>next-intl</strong> - 国际化库</li>
<li><strong>Ant Design</strong> - UI 组件库</li>
<li><strong>TypeScript</strong> - 类型安全</li>
</ul>
<h2 data-id="heading-1">项目结构</h2>
<pre><code class="hljs language-ini" lang="ini">src/
├── app/
│   └── <span class="hljs-section">[locale]</span>/              <span class="hljs-comment"># 动态语言路由</span>
│       ├── layout.tsx         <span class="hljs-comment"># 布局组件</span>
│       ├── page.tsx           <span class="hljs-comment"># 页面组件</span>
│       └── AntdProvider.tsx   <span class="hljs-comment"># Ant Design 国际化配置</span>
├── i18n/
│   ├── routing.ts             <span class="hljs-comment"># 路由配置</span>
│   └── request.ts             <span class="hljs-comment"># 请求配置</span>
└── middleware.ts              <span class="hljs-comment"># 中间件</span>
messages/
├── en-US.json                 <span class="hljs-comment"># 英文翻译</span>
└── zh-CN.json                 <span class="hljs-comment"># 中文翻译</span>
</code></pre>
<h2 data-id="heading-2">实现步骤</h2>
<h3 data-id="heading-3">1. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash">npm install next-intl
npm install antd @ant-design/nextjs-registry
</code></pre>
<h3 data-id="heading-4">2. 配置路由 (<code>src/i18n/routing.ts</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineRouting } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/routing'</span>;
<span class="hljs-keyword">import</span> { createNavigation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/navigation'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> routing = <span class="hljs-title function_">defineRouting</span>({
  <span class="hljs-attr">locales</span>: [<span class="hljs-string">'zh-CN'</span>, <span class="hljs-string">'en-US'</span>],
  <span class="hljs-attr">defaultLocale</span>: <span class="hljs-string">'en-US'</span>,
  <span class="hljs-attr">localePrefix</span>: <span class="hljs-string">'as-needed'</span>  <span class="hljs-comment">// 默认语言不显示前缀</span>
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> { <span class="hljs-title class_">Link</span>, redirect, usePathname, useRouter } =
  <span class="hljs-title function_">createNavigation</span>(routing);
</code></pre>
<p><strong>配置说明：</strong></p>
<ul>
<li><code>locales</code>: 支持的语言列表</li>
<li><code>defaultLocale</code>: 默认语言（英文）</li>
<li><code>localePrefix: 'as-needed'</code>: 默认语言 URL 不显示前缀</li>
</ul>
<p><strong>URL 结构：</strong></p>
<pre><code class="hljs language-bash" lang="bash">/              → 英文首页（默认语言，无前缀）
/about         → 英文关于页
/zh-CN         → 中文首页
/zh-CN/about   → 中文关于页
</code></pre>
<h3 data-id="heading-5">3. 配置中间件 (<code>src/middleware.ts</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> createMiddleware <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/middleware'</span>;
<span class="hljs-keyword">import</span> { routing } <span class="hljs-keyword">from</span> <span class="hljs-string">'./i18n/routing'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createMiddleware</span>(routing);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">matcher</span>: [<span class="hljs-string">'/'</span>, <span class="hljs-string">'/(zh-CN|en-US)/:path*'</span>, <span class="hljs-string">'/((?!api|_next|_vercel|.*\\..*).*)'</span>]
};
</code></pre>
<p><strong>中间件作用：</strong></p>
<ul>
<li>拦截所有请求</li>
<li>自动识别和处理语言路由</li>
<li>将无效语言重定向到默认语言</li>
<li>排除 API 路由和静态资源</li>
</ul>
<h3 data-id="heading-6">4. 配置请求处理 (<code>src/i18n/request.ts</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { getRequestConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/server'</span>;
<span class="hljs-keyword">import</span> { routing } <span class="hljs-keyword">from</span> <span class="hljs-string">'./routing'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">getRequestConfig</span>(<span class="hljs-keyword">async</span> ({ requestLocale }) =&gt; {
  <span class="hljs-keyword">let</span> locale = <span class="hljs-keyword">await</span> requestLocale;

  <span class="hljs-keyword">if</span> (!locale || !routing.<span class="hljs-property">locales</span>.<span class="hljs-title function_">includes</span>(locale <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)) {
    locale = routing.<span class="hljs-property">defaultLocale</span>;
  }

  <span class="hljs-keyword">return</span> {
    locale,
    <span class="hljs-attr">messages</span>: (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`../../messages/<span class="hljs-subst">${locale}</span>.json`</span>)).<span class="hljs-property">default</span>
  };
});
</code></pre>
<p><strong>功能：</strong></p>
<ul>
<li>验证请求的语言是否合法</li>
<li>动态导入对应的翻译文件</li>
<li>不合法时回退到默认语言</li>
</ul>
<h3 data-id="heading-7">5. 配置 Next.js (<code>next.config.ts</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> createNextIntlPlugin <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/plugin'</span>;

<span class="hljs-keyword">const</span> withNextIntl = <span class="hljs-title function_">createNextIntlPlugin</span>(<span class="hljs-string">'./src/i18n/request.ts'</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withNextIntl</span>({
  <span class="hljs-comment">// 其他 Next.js 配置</span>
});
</code></pre>
<h3 data-id="heading-8">6. 创建布局组件 (<code>src/app/[locale]/layout.tsx</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Metadata</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextIntlClientProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl'</span>;
<span class="hljs-keyword">import</span> { getMessages } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/server'</span>;
<span class="hljs-keyword">import</span> { notFound } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>;
<span class="hljs-keyword">import</span> { routing } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/routing'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AntdProvider</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./AntdProvider'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"./globals.css"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">Metadata</span> = {
  <span class="hljs-attr">title</span>: <span class="hljs-string">"Mogotech Web"</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">"Next.js project with i18n support"</span>,
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LocaleLayout</span>(<span class="hljs-params">{
  children,
  params
}: {
  children: React.ReactNode;
  params: <span class="hljs-built_in">Promise</span>&lt;{ locale: <span class="hljs-built_in">string</span> }&gt;;
}</span>) {
  <span class="hljs-keyword">const</span> { locale } = <span class="hljs-keyword">await</span> params;

  <span class="hljs-comment">// 验证语言参数</span>
  <span class="hljs-keyword">if</span> (!routing.<span class="hljs-property">locales</span>.<span class="hljs-title function_">includes</span>(locale <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)) {
    <span class="hljs-title function_">notFound</span>();
  }

  <span class="hljs-comment">// 获取翻译消息</span>
  <span class="hljs-keyword">const</span> messages = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMessages</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">{locale}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">NextIntlClientProvider</span> <span class="hljs-attr">messages</span>=<span class="hljs-string">{messages}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">AntdProvider</span> <span class="hljs-attr">locale</span>=<span class="hljs-string">{locale}</span>&gt;</span>
            {children}
          <span class="hljs-tag">&lt;/<span class="hljs-name">AntdProvider</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">NextIntlClientProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li>使用 <code>[locale]</code> 动态路由捕获语言参数</li>
<li>验证语言合法性，不合法返回 404</li>
<li><code>NextIntlClientProvider</code> 提供翻译上下文</li>
<li><code>AntdProvider</code> 配置 Ant Design 国际化</li>
</ul>
<h3 data-id="heading-9">7. 配置 Ant Design 国际化 (<code>src/app/[locale]/AntdProvider.tsx</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">'use client'</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> zhCN <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/locale/zh_CN'</span>;
<span class="hljs-keyword">import</span> enUS <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/locale/en_US'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">locales</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {
  <span class="hljs-string">'zh-CN'</span>: zhCN,
  <span class="hljs-string">'en-US'</span>: enUS,
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AntdProvider</span>(<span class="hljs-params">{
  children,
  locale,
}: {
  children: React.ReactNode;
  locale: <span class="hljs-built_in">string</span>;
}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span> <span class="hljs-attr">locale</span>=<span class="hljs-string">{locales[locale]</span> || <span class="hljs-attr">enUS</span>}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>作用：</strong></p>
<ul>
<li>配置 Ant Design 组件的语言</li>
<li>影响日期选择器、表单验证、分页等组件的文本</li>
</ul>
<h3 data-id="heading-10">8. 创建翻译文件</h3>
<p><strong>英文翻译 (<code>messages/en-US.json</code>)：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"common"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"welcome"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Welcome"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"home"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Home"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"about"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"About"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Contact Us"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"home"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Welcome to Mogotech"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"This is a Next.js project with internationalization support"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>中文翻译 (<code>messages/zh-CN.json</code>)：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"common"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"welcome"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"欢迎"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"home"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"首页"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"about"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"关于"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"contact"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"联系我们"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"home"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"欢迎来到 Mogotech"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"这是一个支持国际化的 Next.js 项目"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>组织方式：</strong></p>
<ul>
<li>使用命名空间（<code>common</code>、<code>home</code>）组织翻译</li>
<li>支持嵌套结构</li>
<li>JSON 格式，易于维护</li>
</ul>
<h3 data-id="heading-11">9. 在页面中使用 (<code>src/app/[locale]/page.tsx</code>)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useTranslations } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/routing'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> t = <span class="hljs-title function_">useTranslations</span>(<span class="hljs-string">'home'</span>);
  <span class="hljs-keyword">const</span> tc = <span class="hljs-title function_">useTranslations</span>(<span class="hljs-string">'common'</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"min-h-screen p-8"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mb-8 flex gap-4"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">locale</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>中文<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">locale</span>=<span class="hljs-string">"en-US"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>English<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-4xl mx-auto"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-4xl font-bold mb-4"</span>&gt;</span>{t('title')}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-lg text-gray-600 mb-8"</span>&gt;</span>{t('description')}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex gap-4"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&gt;</span>{tc('home')}<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>{tc('about')}<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>{tc('contact')}<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>使用方式：</strong></p>
<ul>
<li><code>useTranslations('namespace')</code>: 获取指定命名空间的翻译函数</li>
<li><code>t('key')</code>: 获取翻译文本</li>
<li><code>Link</code> 组件: 使用国际化路由，自动处理语言前缀</li>
</ul>
<h2 data-id="heading-12">工作流程</h2>
<pre><code class="hljs language-bash" lang="bash">用户访问 /about
    ↓
middleware.ts 拦截请求
    ↓
识别语言为 en-US（默认）
    ↓
request.ts 加载 messages/en-US.json
    ↓
layout.tsx 接收 locale 和 messages
    ↓
NextIntlClientProvider 提供翻译上下文
    ↓
AntdProvider 配置 Ant Design 语言
    ↓
page.tsx 使用 useTranslations 获取翻译
    ↓
渲染英文内容
</code></pre>
<h2 data-id="heading-13">语言切换流程</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 用户点击语言切换按钮</span>
&lt;<span class="hljs-title class_">Link</span> href=<span class="hljs-string">"/"</span> locale=<span class="hljs-string">"zh-CN"</span>&gt;中文&lt;/<span class="hljs-title class_">Link</span>&gt;

<span class="hljs-comment">// Link 组件生成 URL: /zh-CN</span>
<span class="hljs-comment">// 页面跳转到 /zh-CN</span>
<span class="hljs-comment">// middleware 识别语言为 zh-CN</span>
<span class="hljs-comment">// 加载 messages/zh-CN.json</span>
<span class="hljs-comment">// 重新渲染页面，显示中文内容</span>
</code></pre>
<h2 data-id="heading-14">核心特性</h2>
<h3 data-id="heading-15">1. 路由国际化</h3>
<ul>
<li>URL 包含语言信息，SEO 友好</li>
<li>默认语言无前缀，URL 简洁</li>
<li>支持语言切换时保持当前路径</li>
</ul>
<h3 data-id="heading-16">2. 服务端渲染</h3>
<ul>
<li>翻译在服务端完成</li>
<li>首屏加载即显示正确语言</li>
<li>有利于 SEO</li>
</ul>
<h3 data-id="heading-17">3. 按需加载</h3>
<ul>
<li>翻译文件动态导入</li>
<li>减少初始包体积</li>
<li>提升加载性能</li>
</ul>
<h3 data-id="heading-18">4. 类型安全</h3>
<ul>
<li>TypeScript 支持</li>
<li>编译时检查翻译键</li>
<li>减少运行时错误</li>
</ul>
<h3 data-id="heading-19">5. UI 组件国际化</h3>
<ul>
<li>Ant Design 组件自动适配语言</li>
<li>日期、表单、分页等组件文本自动翻译</li>
</ul>
<h2 data-id="heading-20">最佳实践</h2>
<h3 data-id="heading-21">1. 翻译文件组织</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"common"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 全局通用翻译</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"home"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 首页专用翻译</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"about"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 关于页专用翻译</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-22">2. 使用命名空间</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 避免翻译键冲突</span>
<span class="hljs-keyword">const</span> t = <span class="hljs-title function_">useTranslations</span>(<span class="hljs-string">'home'</span>);
<span class="hljs-title function_">t</span>(<span class="hljs-string">'title'</span>)  <span class="hljs-comment">// home.title</span>

<span class="hljs-keyword">const</span> tc = <span class="hljs-title function_">useTranslations</span>(<span class="hljs-string">'common'</span>);
<span class="hljs-title function_">tc</span>(<span class="hljs-string">'title'</span>)  <span class="hljs-comment">// common.title</span>
</code></pre>
<h3 data-id="heading-23">3. 语言切换保持路径</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在任何页面切换语言，保持当前路径</span>
&lt;<span class="hljs-title class_">Link</span> href={pathname} locale=<span class="hljs-string">"zh-CN"</span>&gt;中文&lt;/<span class="hljs-title class_">Link</span>&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{pathname}</span> <span class="hljs-attr">locale</span>=<span class="hljs-string">"en-US"</span>&gt;</span>English<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-24">4. 处理缺失翻译</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// request.ts 中设置回退</span>
<span class="hljs-keyword">return</span> {
  locale,
  <span class="hljs-attr">messages</span>: (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`../../messages/<span class="hljs-subst">${locale}</span>.json`</span>)).<span class="hljs-property">default</span>,
  <span class="hljs-attr">defaultTranslationValues</span>: {
    <span class="hljs-comment">// 设置默认值</span>
  }
};
</code></pre>
<h2 data-id="heading-25">常见问题</h2>
<h3 data-id="heading-26">Q1: 如何添加新语言？</h3>
<ol>
<li>在 <code>routing.ts</code> 中添加语言代码</li>
<li>创建对应的翻译文件 <code>messages/ja-JP.json</code></li>
<li>在 <code>AntdProvider.tsx</code> 中添加 Ant Design 语言包</li>
<li>更新 middleware matcher</li>
</ol>
<h3 data-id="heading-27">Q2: 如何让所有语言都显示前缀？</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// routing.ts</span>
<span class="hljs-attr">localePrefix</span>: <span class="hljs-string">'always'</span>  <span class="hljs-comment">// 改为 always</span>
</code></pre>
<h3 data-id="heading-28">Q3: 如何在服务端组件中使用翻译？</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { getTranslations } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-intl/server'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> t = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getTranslations</span>(<span class="hljs-string">'home'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{t('title')}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-29">Q4: 如何根据用户浏览器语言自动跳转？</h3>
<p>middleware 会自动处理，基于 <code>Accept-Language</code> 请求头。</p>
<h2 data-id="heading-30">总结</h2>
<p>这套方案实现了：</p>
<ul>
<li>完整的路由国际化</li>
<li>服务端渲染支持</li>
<li>UI 组件库国际化</li>
<li>类型安全</li>
<li>SEO 友好</li>
<li>性能优化</li>
</ul>
<p>适用于需要多语言支持的 Next.js 项目，特别是面向国际用户的公开网站。</p>
<h2 data-id="heading-31">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnext-intl-docs.vercel.app%2F" target="_blank" title="https://next-intl-docs.vercel.app/" ref="nofollow noopener noreferrer">next-intl 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fbuilding-your-application%2Frouting%2Finternationalization" target="_blank" title="https://nextjs.org/docs/app/building-your-application/routing/internationalization" ref="nofollow noopener noreferrer">Next.js 国际化指南</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fant.design%2Fdocs%2Freact%2Fi18n" target="_blank" title="https://ant.design/docs/react/i18n" ref="nofollow noopener noreferrer">Ant Design 国际化</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 try/catch 地狱：用三元组重新定义 JavaScript 错误处理]]></title>    <link>https://juejin.cn/post/7583970267133378566</link>    <guid>https://juejin.cn/post/7583970267133378566</guid>    <pubDate>2025-12-16T03:43:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267133378566" data-draft-id="7583980250734002239" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 try/catch 地狱：用三元组重新定义 JavaScript 错误处理"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-12-16T03:43:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoderHing"/> <meta itemprop="url" content="https://juejin.cn/user/1992782705853159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 try/catch 地狱：用三元组重新定义 JavaScript 错误处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1992782705853159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoderHing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:43:53.000Z" title="Tue Dec 16 2025 03:43:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">告别 try/catch 地狱：用三元组重新定义 JavaScript 错误处理</h2>
<blockquote>
<p>写了五年前端，我终于受够了 try/catch。</p>
</blockquote>
<h3 data-id="heading-1">一个真实的场景</h3>
<p>上周重构一个老项目，打开一个文件，200 行代码里有 47 行是 try/catch。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadDashboard</span>(<span class="hljs-params">userId</span>) {
  <span class="hljs-keyword">let</span> user;
  <span class="hljs-keyword">try</span> {
    user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(userId);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">let</span> posts;
  <span class="hljs-keyword">try</span> {
    posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPosts</span>(user.<span class="hljs-property">id</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取文章失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">let</span> comments;
  <span class="hljs-keyword">try</span> {
    comments = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchComments</span>(posts[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取评论失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-title function_">render</span>(user, posts, comments);
}
</code></pre>
<p>看着这坨代码，我问自己：<strong>这真的是 2024 年该有的写法吗？</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 😵 典型的 try/catch 地狱</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processOrder</span>(<span class="hljs-params">orderId</span>) {
  <span class="hljs-keyword">let</span> order;
  <span class="hljs-keyword">try</span> {
    order = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchOrder</span>(orderId);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取订单失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">let</span> user;
  <span class="hljs-keyword">try</span> {
    user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(order.<span class="hljs-property">userId</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">let</span> payment;
  <span class="hljs-keyword">try</span> {
    payment = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processPayment</span>(order, user);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'支付处理失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">let</span> shipping;
  <span class="hljs-keyword">try</span> {
    shipping = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createShipping</span>(order, user);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'创建物流失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">let</span> notification;
  <span class="hljs-keyword">try</span> {
    notification = <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendNotification</span>(user, order);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'发送通知失败'</span>, e);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">return</span> { order, payment, shipping, notification };
}
<span class="hljs-comment">// 50+ 行代码，真正的业务逻辑只有 5 行</span>
</code></pre>
<h3 data-id="heading-2">问题出在哪？</h3>
<p>try/catch 本身没错，但它有几个让人难受的地方：</p>
<p><strong>1. 打断思维流</strong></p>
<p>正常逻辑和错误处理交织在一起，读代码时要不断切换上下文。</p>
<p><strong>2. 变量作用域问题</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> data;
<span class="hljs-keyword">try</span> {
  data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>();
} <span class="hljs-keyword">catch</span> (e) {
  <span class="hljs-comment">// ...</span>
}
<span class="hljs-comment">// data 可能是 undefined，TypeScript 也帮不了你</span>
</code></pre>
<p><strong>3. 无法优雅组合</strong></p>
<p>想把多个异步操作串起来？要么嵌套，要么一堆临时变量。</p>
<p><strong>4. 错误类型丢失</strong></p>
<p>catch 里的 <code>e</code> 是 <code>unknown</code>，每次都要手动判断类型。</p>
<h3 data-id="heading-3">Go 语言给的启发</h3>
<p>Go 程序员处理错误的方式很不一样：</p>
<pre><code class="hljs language-go" lang="go">user, err := fetchUser(id)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> err
}
</code></pre>
<p>错误不是被"抛出"的，而是作为返回值的一部分。这种方式有个好处：<strong>错误处理变成了数据流的一部分</strong>，而不是控制流的中断。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ✅ Go 风格：错误是值，不是异常</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processOrder</span><span class="hljs-params">(orderId <span class="hljs-type">string</span>)</span></span> (*Result, <span class="hljs-type">error</span>) {
    order, err := fetchOrder(orderId)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"获取订单失败: %w"</span>, err)
    }

    user, err := fetchUser(order.UserId)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"获取用户失败: %w"</span>, err)
    }

    payment, err := processPayment(order, user)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"支付处理失败: %w"</span>, err)
    }

    <span class="hljs-keyword">return</span> &amp;Result{Order: order, User: user, Payment: payment}, <span class="hljs-literal">nil</span>
}
<span class="hljs-comment">// 逻辑清晰，错误处理紧跟调用，一目了然</span>
</code></pre>
<h3 data-id="heading-4">把这个思路搬到 JavaScript</h3>
<p>我写了一个小工具库 <code>await-to-tuple</code>，核心思想很简单：</p>
<p><strong>把 Promise 的结果包装成 <code>[ok, error, data]</code> 三元组。</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { to } <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;

<span class="hljs-keyword">const</span> [ok, err, user] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>(id));

<span class="hljs-keyword">if</span> (!ok) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户失败:'</span>, err.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">return</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>); <span class="hljs-comment">// TypeScript 知道这里 user 一定有值</span>
</code></pre>
<h4 data-id="heading-5">为什么是三元组？</h4>
<p>你可能见过 <code>await-to-js</code> 这个库，它返回 <code>[err, data]</code>。但这有个问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [err, data] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>());

<span class="hljs-comment">// 如果 data 本身就是 undefined 或 null 呢？</span>
<span class="hljs-comment">// 你分不清是"成功但值为空"还是"失败了"</span>
</code></pre>
<p>三元组通过第一个布尔值 <code>ok</code> 明确区分成功和失败：</p>























<table><thead><tr><th>ok</th><th>err</th><th>data</th><th>含义</th></tr></thead><tbody><tr><td>true</td><td>null</td><td>值</td><td>成功</td></tr><tr><td>false</td><td>Error</td><td>null</td><td>失败</td></tr></tbody></table>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 二元组的问题：await-to-js 风格</span>
<span class="hljs-keyword">const</span> [err, data] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>());
<span class="hljs-keyword">if</span> (err) { <span class="hljs-comment">/* 处理错误 */</span> }
<span class="hljs-comment">// 问题：如果 API 返回 null 或 undefined 怎么办？</span>
<span class="hljs-comment">// data 为空到底是"成功但值为空"还是"失败了"？</span>

<span class="hljs-comment">// ✅ 三元组的优势：await-to-tuple 风格</span>
<span class="hljs-keyword">const</span> [ok, err, data] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>());
<span class="hljs-keyword">if</span> (!ok) { <span class="hljs-comment">/* 一定是失败 */</span> }
<span class="hljs-comment">// ok 明确告诉你成功还是失败，不存在歧义</span>

<span class="hljs-comment">// 对比表：</span>
<span class="hljs-comment">// | ok    | err   | data | 含义           |</span>
<span class="hljs-comment">// |-------|-------|------|----------------|</span>
<span class="hljs-comment">// | true  | null  | 值   | 成功，有数据   |</span>
<span class="hljs-comment">// | true  | null  | null | 成功，值为空   |</span>
<span class="hljs-comment">// | false | Error | null | 失败           |</span>
</code></pre>
<h3 data-id="heading-6">实际效果</h3>
<p>还记得开头那 47 行代码吗？用 <code>await-to-tuple</code> 重写：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { to } <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadDashboard</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> [ok1, err1, user] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>(userId));
  <span class="hljs-keyword">if</span> (!ok1) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户失败:'</span>, err1.<span class="hljs-property">message</span>);

  <span class="hljs-keyword">const</span> [ok2, err2, posts] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchPosts</span>(user.<span class="hljs-property">id</span>));
  <span class="hljs-keyword">if</span> (!ok2) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取文章失败:'</span>, err2.<span class="hljs-property">message</span>);

  <span class="hljs-keyword">const</span> [ok3, err3, comments] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchComments</span>(posts[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>));
  <span class="hljs-keyword">if</span> (!ok3) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取评论失败:'</span>, err3.<span class="hljs-property">message</span>);

  <span class="hljs-title function_">render</span>(user, posts, comments);
}
</code></pre>
<p><strong>从 47 行变成 12 行。</strong> 逻辑清晰，错误处理紧跟在调用后面，一目了然。</p>
<h3 data-id="heading-7">类型安全是重点</h3>
<p><code>await-to-tuple</code> 完全用 TypeScript 写的，类型推导非常准确：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [ok, err, user] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>(id));

<span class="hljs-keyword">if</span> (!ok) {
  <span class="hljs-comment">// 这里 TypeScript 知道：</span>
  <span class="hljs-comment">// - err 是 SafeError（非 null）</span>
  <span class="hljs-comment">// - user 是 null</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">return</span>;
}

<span class="hljs-comment">// 这里 TypeScript 知道：</span>
<span class="hljs-comment">// - err 是 null</span>
<span class="hljs-comment">// - user 是 User 类型（非 null）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>); <span class="hljs-comment">// ✅ 不会报错</span>
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScript 类型收窄演示</span>
<span class="hljs-keyword">const</span> [ok, err, user] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchUser</span>(id));
<span class="hljs-comment">//    ^ok: boolean</span>
<span class="hljs-comment">//         ^err: SafeError | null</span>
<span class="hljs-comment">//              ^user: User | null</span>

<span class="hljs-keyword">if</span> (!ok) {
  <span class="hljs-comment">// ✅ 这个分支里 TypeScript 自动推断：</span>
  <span class="hljs-comment">// err: SafeError (非 null，可以安全访问 .message)</span>
  <span class="hljs-comment">// user: null</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">message</span>);  <span class="hljs-comment">// ✅ 不报错</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>);      <span class="hljs-comment">// ❌ 报错：user 是 null</span>
  <span class="hljs-keyword">return</span>;
}

<span class="hljs-comment">// ✅ 这个分支里 TypeScript 自动推断：</span>
<span class="hljs-comment">// err: null</span>
<span class="hljs-comment">// user: User (非 null，可以安全访问属性)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>);        <span class="hljs-comment">// ✅ 不报错</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>);      <span class="hljs-comment">// ❌ 报错：err 是 null</span>
</code></pre>
<h3 data-id="heading-8">不只是异步</h3>
<p>同步代码也能用：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { sync } <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;

<span class="hljs-keyword">const</span> [ok, err, config] = <span class="hljs-title function_">sync</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonString));

<span class="hljs-keyword">if</span> (!ok) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'JSON 解析失败:'</span>, err.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getDefaultConfig</span>();
}

<span class="hljs-keyword">return</span> config;
</code></pre>
<h3 data-id="heading-9">还有一些实用工具</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { to, or, map, pipe } <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;

<span class="hljs-comment">// 失败时用默认值</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-title function_">or</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchName</span>()), <span class="hljs-string">'匿名用户'</span>);

<span class="hljs-comment">// 转换成功的结果</span>
<span class="hljs-keyword">const</span> upperName = <span class="hljs-title function_">map</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetchName</span>()), <span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n.<span class="hljs-title function_">toUpperCase</span>());

<span class="hljs-comment">// 链式调用，遇到错误自动中断</span>
<span class="hljs-keyword">const</span> [ok, err, result] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">pipe</span>(
  userId,
  fetchUser,
  validateUser,
  saveUser
);
</code></pre>
<h3 data-id="heading-10">和其他方案的对比</h3>






























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>try/catch</td><td>原生支持</td><td>冗长、打断逻辑、类型不安全</td></tr><tr><td>await-to-js</td><td>简洁</td><td>二元组有歧义</td></tr><tr><td><strong>await-to-tuple</strong></td><td>三元组无歧义、类型安全、工具丰富</td><td>需要安装依赖</td></tr><tr><td>TC39 try 操作符提案</td><td>语言原生</td><td>还在 Stage 1，遥遥无期</td></tr></tbody></table>
<h3 data-id="heading-11">立即开始</h3>
<h4 data-id="heading-12">安装</h4>
<p>选择你喜欢的包管理器：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># npm</span>
npm install await-to-tuple

<span class="hljs-comment"># pnpm（推荐）</span>
pnpm add await-to-tuple

<span class="hljs-comment"># yarn</span>
yarn add await-to-tuple
</code></pre>
<h4 data-id="heading-13">基础用法</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { to, sync } <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;

<span class="hljs-comment">// 异步操作</span>
<span class="hljs-keyword">const</span> [ok, err, data] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/users'</span>));
<span class="hljs-keyword">if</span> (!ok) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, err.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">return</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);

<span class="hljs-comment">// 同步操作</span>
<span class="hljs-keyword">const</span> [ok2, err2, json] = <span class="hljs-title function_">sync</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(str));
<span class="hljs-keyword">if</span> (!ok2) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'解析失败:'</span>, err2.<span class="hljs-property">message</span>);
  <span class="hljs-keyword">return</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json);
</code></pre>
<h4 data-id="heading-14">完整 API</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { 
  to,      <span class="hljs-comment">// 包装 Promise</span>
  sync,    <span class="hljs-comment">// 包装同步函数</span>
  or,      <span class="hljs-comment">// 获取值或默认值</span>
  map,     <span class="hljs-comment">// 转换成功结果</span>
  pipe,    <span class="hljs-comment">// 链式调用</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;

<span class="hljs-comment">// 别名也可以用</span>
<span class="hljs-keyword">import</span> { 
  go,        <span class="hljs-comment">// = to</span>
  safeAwait, <span class="hljs-comment">// = to</span>
  safeCall,  <span class="hljs-comment">// = sync</span>
  unwrapOr,  <span class="hljs-comment">// = or</span>
  safePipe,  <span class="hljs-comment">// = pipe</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'await-to-tuple'</span>;
</code></pre>
<h4 data-id="heading-15">零依赖，超轻量</h4>
<ul>
<li>📦 gzip 后 &lt; 1KB</li>
<li>🌳 完全 Tree-shakeable</li>
<li>🔷 100% TypeScript，类型完备</li>
<li>✅ 完整测试覆盖</li>
</ul>
<hr/>
<h3 data-id="heading-16">链接</h3>
<ul>
<li>📦 <strong>npm</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fawait-to-tuple" target="_blank" title="https://www.npmjs.com/package/await-to-tuple" ref="nofollow noopener noreferrer">www.npmjs.com/package/awa…</a></li>
<li>🐙 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fasdzbb123%2Fawait-to-tuple" target="_blank" title="https://github.com/asdzbb123/await-to-tuple" ref="nofollow noopener noreferrer">github.com/asdzbb123/a…</a></li>
</ul>
<hr/>
<h3 data-id="heading-17">写在最后</h3>
<p>错误处理不应该是代码里最丑的部分。</p>
<p><code>await-to-tuple</code> 不是什么革命性的东西，它只是把一个简单的想法——<strong>错误是值，不是异常</strong>——用最小的代码量实现出来。</p>
<p>如果你也受够了 try/catch，不妨试试。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [ok, err, future] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">to</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'更好的代码'</span>));
</code></pre>
<hr/>
<p><strong>如果这篇文章对你有帮助：</strong></p>
<ul>
<li>⭐ 给个 Star：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fasdzbb123%2Fawait-to-tuple" target="_blank" title="https://github.com/asdzbb123/await-to-tuple" ref="nofollow noopener noreferrer">github.com/asdzbb123/a…</a></li>
<li>📦 npm 安装试试：<code>npm install await-to-tuple</code></li>
<li>💬 有问题欢迎提 Issue</li>
</ul>
<p>让我们一起告别 try/catch 地狱 🎉</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 源码项目结构详解]]></title>    <link>https://juejin.cn/post/7583992239102705716</link>    <guid>https://juejin.cn/post/7583992239102705716</guid>    <pubDate>2025-12-16T04:06:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583992239102705716" data-draft-id="7583971282892537908" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 源码项目结构详解"/> <meta itemprop="keywords" content="Vue.js,前端"/> <meta itemprop="datePublished" content="2025-12-16T04:06:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端水很深"/> <meta itemprop="url" content="https://juejin.cn/user/3562890820588077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 源码项目结构详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562890820588077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端水很深
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:06:47.000Z" title="Tue Dec 16 2025 04:06:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>基于版本：Vue 3.5.25</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Ftree%2Fv3.5.25" target="_blank" title="https://github.com/vuejs/core/tree/v3.5.25" ref="nofollow noopener noreferrer">源码地址</a></strong></p>
<h2 data-id="heading-0">1. 项目概览</h2>
<p>Vue 3 是一个渐进式 JavaScript 框架，用于构建用户界面。它采用了模块化的架构设计，将核心功能拆分为多个独立的包，以实现更好的代码组织、可维护性和按需引入。</p>
<h2 data-id="heading-1">2. 根目录结构</h2>
<pre><code class="hljs language-bash" lang="bash">vuejs/core/
├── .github/            <span class="hljs-comment"># GitHub 配置文件</span>
├── .vscode/            <span class="hljs-comment"># VSCode 配置文件</span>
├── .well-known/        <span class="hljs-comment"># 知名配置文件</span>
├── changelogs/         <span class="hljs-comment"># 版本变更日志</span>
├── packages/           <span class="hljs-comment"># 核心包目录</span>
├── packages-private/   <span class="hljs-comment"># 私有包目录（测试、工具等）</span>
├── scripts/            <span class="hljs-comment"># 构建和开发脚本</span>
├── .git-blame-ignore-revs <span class="hljs-comment"># Git blame 忽略文件</span>
├── .gitignore          <span class="hljs-comment"># Git 忽略文件</span>
├── .node-version       <span class="hljs-comment"># Node.js 版本要求</span>
├── .prettierignore     <span class="hljs-comment"># Prettier 忽略文件</span>
├── .prettierrc         <span class="hljs-comment"># Prettier 配置</span>
├── BACKERS.md          <span class="hljs-comment"># 支持者列表</span>
├── CHANGELOG.md        <span class="hljs-comment"># 主变更日志</span>
├── FUNDING.json        <span class="hljs-comment"># 资助信息</span>
├── LICENSE             <span class="hljs-comment"># 许可证</span>
├── README.md           <span class="hljs-comment"># 项目说明</span>
├── SECURITY.md         <span class="hljs-comment"># 安全信息</span>
├── eslint.config.js    <span class="hljs-comment"># ESLint 配置</span>
├── netlify.toml        <span class="hljs-comment"># Netlify 配置</span>
├── package.json        <span class="hljs-comment"># 项目依赖和脚本</span>
</code></pre>
<h2 data-id="heading-2">3. 核心包结构 (packages/)</h2>
<p>Vue 3 的核心功能被拆分为多个独立的包，每个包负责特定的功能域。</p>
<h3 data-id="heading-3">3.1 compiler-core</h3>
<p>核心编译器，提供跨平台的编译能力，与具体渲染目标无关。</p>
<pre><code class="hljs language-python" lang="python">compiler-core/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── compat/         <span class="hljs-comment"># 兼容性处理</span>
│   ├── transforms/     <span class="hljs-comment"># AST 转换插件</span>
│   ├── ast.ts          <span class="hljs-comment"># AST 节点定义</span>
│   ├── codegen.ts      <span class="hljs-comment"># 代码生成器</span>
│   ├── <span class="hljs-built_in">compile</span>.ts      <span class="hljs-comment"># 编译主函数</span>
│   ├── parser.ts       <span class="hljs-comment"># 模板解析器</span>
│   └── transform.ts    <span class="hljs-comment"># AST 转换器</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-4">3.2 compiler-dom</h3>
<p>DOM 编译器，基于 compiler-core 扩展，用于将模板编译为 DOM 渲染函数。</p>
<pre><code class="hljs language-bash" lang="bash">compiler-dom/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── transforms/     <span class="hljs-comment"># DOM 特定转换</span>
│   └── index.ts        <span class="hljs-comment"># 入口文件</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-5">3.3 compiler-sfc</h3>
<p>单文件组件 (SFC) 编译器，用于编译 .vue 文件。</p>
<pre><code class="hljs language-bash" lang="bash">compiler-sfc/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── script/         <span class="hljs-comment"># 脚本处理</span>
│   ├── style/          <span class="hljs-comment"># 样式处理</span>
│   ├── template/       <span class="hljs-comment"># 模板处理</span>
│   ├── compileScript.ts <span class="hljs-comment"># 脚本编译</span>
│   ├── compileStyle.ts <span class="hljs-comment"># 样式编译</span>
│   ├── compileTemplate.ts <span class="hljs-comment"># 模板编译</span>
│   └── parse.ts        <span class="hljs-comment"># SFC 解析器</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-6">3.4 compiler-ssr</h3>
<p>服务端渲染 (SSR) 编译器，用于将模板编译为 SSR 渲染函数。</p>
<pre><code class="hljs language-bash" lang="bash">compiler-ssr/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── transforms/     <span class="hljs-comment"># SSR 特定转换</span>
│   └── index.ts        <span class="hljs-comment"># 入口文件</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-7">3.5 reactivity</h3>
<p>响应式系统核心，实现了 Vue 3 的响应式机制。</p>
<pre><code class="hljs language-csharp" lang="csharp">reactivity/
├── __benchmarks__/     <span class="hljs-meta"># 基准测试</span>
├── __tests__/          <span class="hljs-meta"># 测试文件</span>
├── src/
│   ├── effect.ts       <span class="hljs-meta"># 副作用系统</span>
│   ├── reactive.ts     <span class="hljs-meta"># 响应式对象</span>
│   ├── <span class="hljs-keyword">ref</span>.ts          <span class="hljs-meta"># 响应式引用</span>
│   ├── computed.ts     <span class="hljs-meta"># 计算属性</span>
│   └── watch.ts        <span class="hljs-meta"># 监听器</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-8">3.6 reactivity-transform</h3>
<p><strong>注意：该包已被移除</strong></p>
<p>响应式转换，曾提供实验性的响应式语法转换功能。根据 Vue 3.4 的变更日志，该功能在 Vue 3.3 中被标记为弃用，并在 Vue 3.4 中被完全移除。</p>
<p><strong>替代方案</strong>：</p>
<ul>
<li>用户如果想要继续使用响应式转换功能，可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvue-macros.dev%2Ffeatures%2Freactivity-transform.html" target="_blank" title="https://vue-macros.dev/features/reactivity-transform.html" ref="nofollow noopener noreferrer">Vue Macros 插件</a> 来实现。</li>
<li>官方推荐使用标准的 <code>ref()</code>、<code>reactive()</code> 和 <code>computed()</code> API 替代。</li>
</ul>
<h3 data-id="heading-9">3.7 runtime-core</h3>
<p>核心运行时，提供与平台无关的运行时功能，是Vue 3跨平台能力的基础。</p>
<pre><code class="hljs language-bash" lang="bash">runtime-core/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── component.ts    <span class="hljs-comment"># 组件系统</span>
│   ├── renderer.ts     <span class="hljs-comment"># 渲染器</span>
│   ├── vnode.ts        <span class="hljs-comment"># 虚拟节点</span>
│   ├── scheduler.ts    <span class="hljs-comment"># 调度器</span>
│   └── h.ts            <span class="hljs-comment"># 创建虚拟节点的函数</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<p><strong>详细解析敬请关注</strong></p>
<h3 data-id="heading-10">3.8 runtime-dom</h3>
<p>DOM 运行时，基于 runtime-core 扩展，提供 DOM 特定的运行时功能。</p>
<pre><code class="hljs language-bash" lang="bash">runtime-dom/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── components/     <span class="hljs-comment"># DOM 特定组件</span>
│   ├── directives/     <span class="hljs-comment"># DOM 特定指令</span>
│   ├── modules/        <span class="hljs-comment"># DOM 模块</span>
│   ├── nodeOps.ts      <span class="hljs-comment"># DOM 节点操作</span>
│   └── patchProp.ts    <span class="hljs-comment"># 属性补丁</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-11">3.9 runtime-test</h3>
<p>测试运行时，用于测试 Vue 组件和功能。</p>
<h3 data-id="heading-12">3.10 server-renderer</h3>
<p>服务器渲染器，用于将 Vue 组件渲染为 HTML 字符串。</p>
<h3 data-id="heading-13">3.11 shared</h3>
<p>共享工具函数，供其他包使用。</p>
<h3 data-id="heading-14">3.12 vue</h3>
<p>主包，整合了核心功能，提供完整的 Vue 3 API。</p>
<pre><code class="hljs language-bash" lang="bash">vue/
├── __tests__/          <span class="hljs-comment"># 测试文件</span>
├── src/
│   ├── index.ts        <span class="hljs-comment"># 入口文件</span>
│   └── runtime.ts      <span class="hljs-comment"># 运行时入口</span>
├── LICENSE
├── README.md
└── package.json
</code></pre>
<h3 data-id="heading-15">3.13 vue-compat</h3>
<p>Vue 2 兼容性包，帮助从 Vue 2 迁移到 Vue 3。</p>
<h2 data-id="heading-16">4. 私有包结构 (packages-private/)</h2>
<p>私有包主要用于测试、开发工具和内部使用。</p>
<pre><code class="hljs language-csharp" lang="csharp">packages-<span class="hljs-keyword">private</span>/
├── dts-built-test/     <span class="hljs-meta"># 类型定义构建测试</span>
├── dts-test/           <span class="hljs-meta"># 类型定义测试</span>
├── sfc-playground/     <span class="hljs-meta"># SFC  playground</span>
├── template-explorer/  <span class="hljs-meta"># 模板浏览器</span>
├── vite-debug/         <span class="hljs-meta"># Vite 调试</span>
├── <span class="hljs-keyword">global</span>.d.ts         <span class="hljs-meta"># 全局类型定义</span>
└── tsconfig.json       <span class="hljs-meta"># TypeScript 配置</span>
</code></pre>
<h2 data-id="heading-17">5. 脚本目录 (scripts/)</h2>
<p>包含项目的构建、开发和发布脚本。</p>
<pre><code class="hljs language-bash" lang="bash">scripts/
├── aliases.js          <span class="hljs-comment"># 别名配置</span>
├── build.js            <span class="hljs-comment"># 构建脚本</span>
├── dev.js              <span class="hljs-comment"># 开发脚本</span>
├── inline-enums.js     <span class="hljs-comment"># 枚举内联脚本</span>
├── pre-dev-sfc.js      <span class="hljs-comment"># SFC 开发前置脚本</span>
├── release.js          <span class="hljs-comment"># 发布脚本</span>
├── setup-vitest.ts     <span class="hljs-comment"># Vitest 配置</span>
├── size-report.js      <span class="hljs-comment"># 大小报告脚本</span>
├── usage-size.js       <span class="hljs-comment"># 使用大小脚本</span>
├── utils.js            <span class="hljs-comment"># 工具函数</span>
├── verify-commit.js    <span class="hljs-comment"># 提交验证脚本</span>
└── verify-treeshaking.js <span class="hljs-comment"># 树摇验证脚本</span>
</code></pre>
<h2 data-id="heading-18">6. 包之间的依赖关系</h2>
<p>Vue 3 的包之间存在清晰的依赖关系，以下是详细的依赖关系图：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">vue
├── compiler-sfc
│   ├── compiler-core
│   └── compiler-dom
├── runtime-dom
│   ├── runtime-core
│   │   ├── reactivity
│   │   └── <span class="hljs-keyword">shared</span>
│   └── <span class="hljs-keyword">shared</span>
└── server-renderer
    ├── compiler-ssr
    │   ├── compiler-core
    │   └── compiler-dom
    └── runtime-core
</code></pre>
<h3 data-id="heading-19">详细依赖关系图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph 基础依赖
        shared
    end

    subgraph 编译器
        compiler-core --&gt; shared
        compiler-dom --&gt; compiler-core
        compiler-dom --&gt; shared
        compiler-ssr --&gt; compiler-core
        compiler-ssr --&gt; shared
        compiler-sfc --&gt; compiler-core
        compiler-sfc --&gt; compiler-dom
        compiler-sfc --&gt; compiler-ssr
        compiler-sfc --&gt; shared
    end

    subgraph 响应式系统
        reactivity --&gt; shared
        %% reactivity-transform --&gt; reactivity (已移除)
    end

    subgraph 运行时
        runtime-core --&gt; shared
        runtime-core --&gt; reactivity
        runtime-dom --&gt; runtime-core
        runtime-dom --&gt; shared
        server-renderer --&gt; runtime-core
        server-renderer --&gt; compiler-ssr
        server-renderer --&gt; shared
        runtime-test --&gt; runtime-core
        runtime-test --&gt; shared
    end

    subgraph 主包
        vue --&gt; compiler-sfc
        vue --&gt; runtime-dom
        vue --&gt; server-renderer
        vue --&gt; shared
        vue-compat --&gt; vue
        vue-compat --&gt; shared
    end
</code></pre>
<h3 data-id="heading-20">依赖关系说明</h3>
<ol>
<li>
<p><strong>共享依赖</strong>：</p>
<ul>
<li><code>shared</code> 包被所有其他包依赖，提供共享的工具函数</li>
</ul>
</li>
<li>
<p><strong>编译器链</strong>：</p>
<ul>
<li><code>compiler-core</code> 是所有编译器的基础</li>
<li><code>compiler-dom</code> 和 <code>compiler-ssr</code> 分别扩展 <code>compiler-core</code> 以支持 DOM 和 SSR 环境</li>
<li><code>compiler-sfc</code> 依赖 <code>compiler-core</code> 和 <code>compiler-dom</code> 来编译单文件组件</li>
</ul>
</li>
<li>
<p><strong>响应式系统</strong>：</p>
<ul>
<li><code>reactivity</code> 是响应式系统的核心</li>
</ul>
</li>
<li>
<p><strong>运行时链</strong>：</p>
<ul>
<li><code>runtime-core</code> 提供与平台无关的运行时功能</li>
<li><code>runtime-dom</code> 扩展 <code>runtime-core</code> 以支持 DOM 环境</li>
<li><code>server-renderer</code> 用于服务器端渲染</li>
</ul>
</li>
<li>
<p><strong>主包</strong>：</p>
<ul>
<li><code>vue</code> 主包整合了所有核心功能</li>
<li><code>vue-compat</code> 提供 Vue 2 兼容性支持</li>
</ul>
</li>
</ol>
<p>这种模块化的依赖设计使得 Vue 3 具有很好的可扩展性和可维护性，开发者可以根据需要只引入必要的包。</p>
<h2 data-id="heading-21">7. 构建流程</h2>
<ol>
<li>使用 <code>scripts/build.js</code> 脚本构建项目</li>
<li>支持多种构建格式：ES modules、CommonJS、UMD</li>
<li>支持开发环境和生产环境构建</li>
<li>支持按需构建特定包</li>
</ol>
<h2 data-id="heading-22">8. 开发流程</h2>
<ol>
<li>使用 <code>scripts/dev.js</code> 脚本启动开发服务器</li>
<li>支持热模块替换</li>
<li>提供 SFC playground 用于实时编辑和预览组件</li>
</ol>
<h2 data-id="heading-23">9. 测试体系</h2>
<ol>
<li>使用 Vitest 进行单元测试和基准测试</li>
<li>提供完整的 E2E 测试</li>
<li>支持类型定义测试</li>
<li>支持代码覆盖率报告</li>
</ol>
<h2 data-id="heading-24">10. 发布流程</h2>
<ol>
<li>使用 <code>scripts/release.js</code> 脚本发布版本</li>
<li>自动生成变更日志</li>
<li>支持语义化版本控制</li>
<li>自动发布到 npm</li>
</ol>
<h2 data-id="heading-25">11. 总结</h2>
<p>Vue 3 采用了模块化的架构设计，将核心功能拆分为多个独立的包，以实现更好的代码组织、可维护性和按需引入。这种设计使得 Vue 3 更加灵活、高效，并且易于扩展和定制。</p>
<p>通过了解 Vue 3 的项目结构，开发者可以更好地理解框架的内部工作原理，从而更有效地使用和扩展 Vue 3。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[模式匹配-基础使用]]></title>    <link>https://juejin.cn/post/7583933107690717247</link>    <guid>https://juejin.cn/post/7583933107690717247</guid>    <pubDate>2025-12-16T03:37:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690717247" data-draft-id="7583980250733592639" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="模式匹配-基础使用"/> <meta itemprop="keywords" content="Scala"/> <meta itemprop="datePublished" content="2025-12-16T03:37:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小冻梨"/> <meta itemprop="url" content="https://juejin.cn/user/3009826775398218"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            模式匹配-基础使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3009826775398218/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小冻梨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:37:41.000Z" title="Tue Dec 16 2025 03:37:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>内容：</strong></p>
<p>1.Scala 中的模式匹配</p>
<h4 data-id="heading-0">（一）问题导入</h4>
<p>我们今天接到一个开发任务，就是根据身份证号码，输出这个人的籍贯。例如：42表示湖北，33表示浙江，11表示北京，31表示上海。</p>
<h4 data-id="heading-1">（二）具体代码</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> matchcase

<span class="hljs-comment">/**
   match case

   三大结构
     1. 顺序结构
     2. 选择结构
        (1) if, if else if else;
        (2) match case
               case_ 不能省略，否则，匹配失败会报错
               case_ 必需写在最后
     3. 循环结构:
        (1) for
        (2) while, do...while
* */</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">case01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
<span class="hljs-comment">//    val code = "11"</span>
<span class="hljs-comment">//    var province = ""</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//    if(code == "42"){</span>
<span class="hljs-comment">//      province = "湖北"</span>
<span class="hljs-comment">//    } else if(code == "11") {</span>
<span class="hljs-comment">//      province = "北京"</span>
<span class="hljs-comment">//    } else  {</span>
<span class="hljs-comment">//      province = "未知"</span>
<span class="hljs-comment">//    }</span>

    <span class="hljs-keyword">val</span> code = <span class="hljs-string">"11"</span>
    <span class="hljs-keyword">val</span> province = code <span class="hljs-keyword">match</span> {
      <span class="hljs-keyword">case</span> <span class="hljs-string">"42"</span> =&gt; <span class="hljs-string">"湖北"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">"11"</span> =&gt; <span class="hljs-string">"北京"</span>
      <span class="hljs-keyword">case</span> _ =&gt; <span class="hljs-string">"未知"</span>
    }

    println(<span class="hljs-string">s"<span class="hljs-subst">${code}</span> 对应的省份是：<span class="hljs-subst">${province}</span>"</span>)
  }
}
</code></pre>
<p>【运行结果】
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5ad29aa0a7d48968fd342882b72f390~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Ya75qKo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461061&amp;x-signature=PRH%2BckV%2BU1Yj%2BWW74sCwUw6LGQc%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">(三)match case的基本格式</h4>
<p>格式如下:</p>
<pre><code class="hljs language-scala" lang="scala">value <span class="hljs-keyword">match</span> {

  <span class="hljs-keyword">case</span> pattern1 =&gt; result1

  <span class="hljs-keyword">case</span> pattern2 =&gt; result2

...

  <span class="hljs-keyword">case</span> patternN =&gt; resultN

<span class="hljs-keyword">case</span> _ =&gt; 其他

}
</code></pre>
<p>执行流程是：如果value匹配到了pattern1，就执行结果1，如果都没有匹配到，就执行 _ 对应的内容。</p>
<p>通过<strong>例子</strong>来巩固下:</p>
<p>输入一个1~5的数字，打印它对应的英语单词</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> matchcase

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">case02</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 输入一个1~5的数字，打印它对应的英语单词</span>
    <span class="hljs-keyword">val</span> num = <span class="hljs-number">2</span>
    <span class="hljs-keyword">val</span> word = num <span class="hljs-keyword">match</span> {
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> =&gt; <span class="hljs-string">"One"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span> =&gt; <span class="hljs-string">"Two"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> =&gt; <span class="hljs-string">"Three"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span> =&gt; <span class="hljs-string">"Four"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span> =&gt; <span class="hljs-string">"Five"</span>
      <span class="hljs-keyword">case</span> _ =&gt; <span class="hljs-string">"Other"</span>
    }
    println(<span class="hljs-string">s"<span class="hljs-subst">${num}</span> 对应的英文是：<span class="hljs-subst">${word}</span>"</span>)
  }
}
</code></pre>
<p>【运行结果】
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e2bc48810284c8db94a2b245282e8c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Ya75qKo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461061&amp;x-signature=0IHiJXunf02Mf6bMp9z2WBfAwa8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">（四）高阶匹配之元组元素数量</h4>
<p>前面的匹配都是精准匹配：变量和值是相等的。但是呢，scala中的模式匹配的规则是非常强大的，不一定是精准的匹配值，还可以根据元组的元素的个数来匹配。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> matchcase

<span class="hljs-comment">/*
*  match case 高阶匹配
*   1.匹配元组不同的元素的数量
*
*
* */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">case03</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-comment">// 元组</span>
    <span class="hljs-keyword">val</span> t1 = (<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)

    t1 <span class="hljs-keyword">match</span> {
      <span class="hljs-keyword">case</span> (a,b) =&gt; println(<span class="hljs-string">s"有二个元素<span class="hljs-subst">${a}</span>,<span class="hljs-subst">${b}</span>"</span>)
      <span class="hljs-keyword">case</span> _ =&gt; println(<span class="hljs-string">"未知"</span>)
    }

    <span class="hljs-keyword">val</span> arr1 = <span class="hljs-type">Array</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)

    arr1 <span class="hljs-keyword">match</span> {
      <span class="hljs-keyword">case</span> <span class="hljs-type">Array</span>(<span class="hljs-number">1</span>,x,y) =&gt; println(<span class="hljs-string">"数组，第一个元素是1，长度为3"</span>)
      <span class="hljs-keyword">case</span> <span class="hljs-type">Array</span>(<span class="hljs-number">10</span>,x) =&gt; println(<span class="hljs-string">"数组，第一个元素是10，长度为2"</span>)
      <span class="hljs-keyword">case</span> _ =&gt; println(<span class="hljs-string">"其他"</span>)
    }
  }
}
</code></pre>
<p>【运行结果】
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c397de6ddb4d21b343c9e3a8649bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Ya75qKo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461061&amp;x-signature=4zp386tUKg%2F9HrUtHXEr0%2FX%2BQ7o%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[python3.13 3.14 新特性 好好好]]></title>    <link>https://juejin.cn/post/7584013833992945698</link>    <guid>https://juejin.cn/post/7584013833992945698</guid>    <pubDate>2025-12-16T04:53:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584013833992945698" data-draft-id="7583992239102853172" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="python3.13 3.14 新特性 好好好 "/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-16T04:53:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户722786812344"/> <meta itemprop="url" content="https://juejin.cn/user/4100515739233513"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            python3.13 3.14 新特性 好好好 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100515739233513/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户722786812344
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:53:43.000Z" title="Tue Dec 16 2025 04:53:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>带来了许多激动人心的改进，下面这个表格汇总了它们的核心新特性，可以帮助你快速了解这两个版本的主要变化。</p>






























<table><thead><tr><th>特性类别</th><th>Python 3.13 新特性</th><th>Python 3.14 新特性</th></tr></thead><tbody><tr><td><strong>🚀 性能与并发</strong>​</td><td>实验性免GIL模式、初步JIT编译器</td><td>解释器级GIL控制、尾调用解释器优化</td></tr><tr><td><strong>✨ 开发体验</strong>​</td><td>全新交互式REPL、更智能的错误提示</td><td>模板字符串(t-string)、增强的错误建议</td></tr><tr><td><strong>🛡️ 类型系统</strong>​</td><td><code>ReadOnly</code>、<code>TypeIs</code>、类型参数默认值</td><td><code>ReadOnly</code>与 <code>TypeIs</code>增强</td></tr><tr><td><strong>🔧 工具与库</strong>​</td><td>清理过时模块、新的<code>dbm.sqlite3</code>后端</td><td>原生Zstandard压缩、零开销调试接口</td></tr></tbody></table>
<h3 data-id="heading-0">🐍 Python 3.13 核心特性详解</h3>
<p>Python 3.13 是一个为未来打下坚实基础的版本，引入了一些实验性但极具潜力的特性。</p>
<ul>
<li>
<p><strong>实验性的免GIL模式</strong>：这是最具革命性的特性。<strong>GIL</strong>​ 是限制Python利用多核CPU性能的历史包袱。3.13 允许通过特殊的构建（如 <code>python3.13t</code>）或运行时标志来<strong>禁用GIL</strong>，从而实现真正的线程并行。这意味着专为多线程设计的程序在多核机器上能获得显著性能提升。需要注意的是，这仍是实验性功能，可能存在兼容性问题和单线程性能损耗。</p>
</li>
<li>
<p><strong>初步的JIT编译器</strong>：3.13 引入了一个基于 <strong>Copy-and-patch</strong>​ 技术的实验性JIT编译器。它通过将“热”字节码编译成机器码来提升执行效率，尤其有利于计算密集型任务。目前需手动启用，为未来的性能飞跃铺平了道路。</p>
</li>
<li>
<p><strong>全新的交互式解释器</strong>：基于PyPy项目的代码，新的REPL带来了现代编程体验，支持<strong>多行编辑</strong>、<strong>彩色语法高亮</strong>和<strong>彩色异常回溯</strong>，使得在命令行中与Python交互更加直观和高效。</p>
</li>
<li>
<p><strong>类型系统增强</strong>：</p>
<ul>
<li><code>ReadOnly</code>类型：可在 <code>TypedDict</code>中将特定字段标记为只读，静态类型检查器会阻止对它们的修改，增强代码安全性。</li>
<li><code>TypeIs</code>类型：提供比 <code>TypeGuard</code>更精确的类型收窄能力，帮助类型检查器在条件判断后更准确地推断变量类型。</li>
<li>类型参数默认值：<code>TypeVar</code>等类型参数现在可以指定默认类型，提升了泛型编程的灵活性。</li>
</ul>
</li>
<li>
<p><strong>清理过时模块</strong>：根据PEP 594，移除了大量长期废弃的“死电池”模块，如 <code>aifc</code>, <code>cgi</code>, <code>telnetlib</code>等，让标准库更加轻量和现代化。</p>
</li>
</ul>
<h3 data-id="heading-1">🐍 Python 3.14 核心特性详解</h3>
<p>Python 3.14 在 3.13 的基础上，进一步优化并引入了更实用的新功能。</p>
<ul>
<li><strong>模板字符串</strong>：引入了 <strong>t-string</strong>，语法为 <code>t"Hello, {name}!"</code>。与即时求值的f-string不同，t-string创建的是一个<strong>模板对象</strong>，可以延迟求值并在不同上下文中<strong>重复使用</strong>，特别适用于生成大量相似字符串的场景，如HTML模板或消息模板。</li>
<li><strong>增强的模式匹配</strong>：在Python 3.10模式匹配的基础上，引入了<strong>守卫表达式</strong>。允许在 <code>case</code>语句中直接使用 <code>if</code>进行条件判断，让模式匹配更强大和简洁。</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">match</span> request:
    <span class="hljs-keyword">case</span> {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: path} <span class="hljs-keyword">if</span> path.startswith(<span class="hljs-string">"/api/"</span>):  <span class="hljs-comment"># 守卫表达式</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"API request to <span class="hljs-subst">{path}</span>"</span>
</code></pre>
<p>🐍 Python 3.13 新特性代码示例</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8616c5bea84fbaa502550c3f5c133a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=3GEDR8ObGPh2QQeLuPMsSe9yXFQ%3D" alt="复制代码" loading="lazy"/></a></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 启用免GIL模式运行程序</span>
<span class="hljs-comment"># 命令行方式：python3.13t --disable-gil your_script.py</span>
<span class="hljs-comment"># 或通过环境变量：PYTHON_GIL=0 python3.13 your_script.py</span>

<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_intensive_work</span>(<span class="hljs-params">worker_id, iterations=<span class="hljs-number">10_000_000</span></span>):
    <span class="hljs-string">"""CPU密集型任务，适合多线程并行"""</span>
    result = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(iterations):
        result += i * i
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Worker <span class="hljs-subst">{worker_id}</span> 完成，结果: <span class="hljs-subst">{result}</span>"</span>)
    <span class="hljs-keyword">return</span> result

<span class="hljs-comment"># 在免GIL模式下，多个CPU密集型线程可以真正并行执行</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_free_gil</span>():
    threads = []
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):  <span class="hljs-comment"># 创建4个工作线程</span>
        t = threading.Thread(target=compute_intensive_work, args=(i, <span class="hljs-number">5_000_000</span>))
        threads.append(t)
        t.start()
    
    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
        t.join()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"所有线程完成"</span>)

<span class="hljs-comment"># 注意：在标准GIL模式下，这些线程是并发而非并行</span>
<span class="hljs-comment"># 在免GIL模式下，它们可以在多核CPU上真正并行执行</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37fe0e3c50ce4d5686b6a091c42fe1c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=q33BrGol22%2BTcY1T%2FUpp%2FliXfO4%3D" alt="复制代码" loading="lazy"/></a></p>
<h3 data-id="heading-2"><strong>2. ReadOnly 类型</strong></h3>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c189a75ea44da89672504c0c1ff6e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=ZfoKjpzWGxXyqdoNWilxtJ%2F4Vc0%3D" alt="复制代码" loading="lazy"/></a></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, ReadOnly
<span class="hljs-keyword">from</span> typing_extensions <span class="hljs-keyword">import</span> NotRequired  <span class="hljs-comment"># Python 3.11+</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserData</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    name: <span class="hljs-built_in">str</span>
    email: ReadOnly[<span class="hljs-built_in">str</span>]  <span class="hljs-comment"># ✅ 只读字段</span>
    is_active: <span class="hljs-built_in">bool</span>
    metadata: NotRequired[<span class="hljs-built_in">dict</span>]  <span class="hljs-comment"># 可选字段</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_user</span>(<span class="hljs-params">data: UserData</span>) -&gt; <span class="hljs-literal">None</span>:
    data[<span class="hljs-string">"name"</span>] = <span class="hljs-string">"New Name"</span>  <span class="hljs-comment"># ✅ 允许修改</span>
    <span class="hljs-comment"># data["email"] = "new@email.com"  # ❌ 类型检查器会报错：ReadOnly字段</span>
    
    <span class="hljs-comment"># 读取是允许的</span>
    email = data[<span class="hljs-string">"email"</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"用户邮箱: <span class="hljs-subst">{email}</span>"</span>)

<span class="hljs-comment"># 使用示例</span>
user: UserData = {
    <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"alice@example.com"</span>,  <span class="hljs-comment"># 这个值不能被修改</span>
    <span class="hljs-string">"is_active"</span>: <span class="hljs-literal">True</span>
}

process_user(user)
</code></pre>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e8777ab3e73433e9f7108438ba59e5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=Mw7LBafV70cB93Ffl6fkqGYb0lc%3D" alt="复制代码" loading="lazy"/></a></p>
<h2 data-id="heading-3">🐍 Python 3.14 新特性代码示例 </h2>
<h3 data-id="heading-4"><strong>1. 模板字符串（t-strings）</strong></h3>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a027afd29f75476c9ffd00cff690764a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=lf0a%2BFFWOwGcIuaBL%2FNpMaQlgGU%3D" alt="复制代码" loading="lazy"/></a></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># t-string 创建模板对象，可以重复使用</span>
from string import Template

<span class="hljs-comment"># 传统 Template</span>
<span class="hljs-attr">template1</span> = Template(<span class="hljs-string">"Hello, $name! You have $count messages."</span>)
<span class="hljs-attr">result1</span> = template1.substitute(name=<span class="hljs-string">"Alice"</span>, count=<span class="hljs-number">5</span>)
print(result1)  <span class="hljs-comment"># Hello, Alice! You have 5 messages.</span>

<span class="hljs-comment"># 新特性：t-string（模板字符串）</span>
<span class="hljs-comment"># 语法：t"字符串 {变量}"</span>
<span class="hljs-comment"># 注意：这是语法层面的新特性，需要Python 3.14+</span>

<span class="hljs-comment"># 假设的 t-string 用法（实际语法可能有所不同）：</span>
<span class="hljs-comment"># t_template = t"Hello, {name}! You have {count} messages."</span>

<span class="hljs-comment"># 实际可以这样使用：</span>
def create_email_template():
    """创建可重用的邮件模板"""
    <span class="hljs-comment"># 在 3.14 中可能会有直接的 t"" 语法</span>
    <span class="hljs-comment"># 暂时用 Template 模拟</span>
    return Template("""
尊敬的 ${name}：

感谢您购买 ${product}。
订单号: ${order_id}
总金额: $${amount}

${store_name} 团队
""")

<span class="hljs-comment"># 多次使用同一个模板</span>
<span class="hljs-attr">template</span> = create_email_template()

<span class="hljs-attr">email1</span> = template.substitute(
    <span class="hljs-attr">name</span>=<span class="hljs-string">"张三"</span>,
    <span class="hljs-attr">product</span>=<span class="hljs-string">"Python编程指南"</span>,
    <span class="hljs-attr">order_id</span>=<span class="hljs-string">"ORD-2024-001"</span>,
    <span class="hljs-attr">amount</span>=<span class="hljs-string">"99.99"</span>,
    <span class="hljs-attr">store_name</span>=<span class="hljs-string">"编程书店"</span>
)

<span class="hljs-attr">email2</span> = template.substitute(
    <span class="hljs-attr">name</span>=<span class="hljs-string">"李四"</span>, 
    <span class="hljs-attr">product</span>=<span class="hljs-string">"数据结构与算法"</span>,
    <span class="hljs-attr">order_id</span>=<span class="hljs-string">"ORD-2024-002"</span>,
    <span class="hljs-attr">amount</span>=<span class="hljs-string">"129.99"</span>,
    <span class="hljs-attr">store_name</span>=<span class="hljs-string">"编程书店"</span>
)

print(email1)
print("\n<span class="hljs-attr">" + "</span>=<span class="hljs-string">"*50 + "</span>\n<span class="hljs-string">")
print(email2)
</span></code></pre>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e30d98d2942e4cb793f71786fc48df5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=zHFth0fBrx97RbaQS7ryAoJbxl8%3D" alt="复制代码" loading="lazy"/></a></p>
<h3 data-id="heading-5"><strong>2. 模式匹配守卫表达式</strong></h3>
<p> </p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d74c3d6d5a14a319ba0fd9a40f7783f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=iqEtQUvO%2FMeul5CbXdWzHdZMKxU%3D" alt="复制代码" loading="lazy"/></a></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.10 引入了模式匹配</span>
<span class="hljs-comment"># Python 3.14 增强了守卫表达式</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_http_request</span>(<span class="hljs-params">https://www.falvce.com/: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""处理HTTP请求，使用模式匹配和守卫表达式"""</span>
    
    <span class="hljs-keyword">match</span> request:
        <span class="hljs-comment"># 基本模式匹配</span>
        <span class="hljs-keyword">case</span> {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api/users"</span>}:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"获取用户列表"</span>
        
        <span class="hljs-comment"># 带守卫表达式 (Python 3.14+)</span>
        <span class="hljs-keyword">case</span> {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: path} <span class="hljs-keyword">if</span> path.startswith(<span class="hljs-string">"/api/"</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"API请求: <span class="hljs-subst">{path}</span>"</span>
        
        <span class="hljs-comment"># 复杂守卫条件</span>
        <span class="hljs-keyword">case</span> {<span class="hljs-string">"method"</span>: <span class="hljs-string">"POST"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api/data"</span>, <span class="hljs-string">"body"</span>: body} 
             <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(body, <span class="hljs-built_in">dict</span>) <span class="hljs-keyword">and</span> <span class="hljs-string">"data"</span> <span class="hljs-keyword">in</span> body:
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"处理数据: <span class="hljs-subst">{body[<span class="hljs-string">'data'</span>]}</span>"</span>
        
        <span class="hljs-comment"># 带时间戳的守卫</span>
        <span class="hljs-keyword">case</span> {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/status"</span>, <span class="hljs-string">"timestamp"</span>: ts} 
             <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(ts, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">and</span> ts &gt; <span class="hljs-number">1700000000</span>:
            <span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
            dt = datetime.fromtimestamp(ts)
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"状态检查于: <span class="hljs-subst">{dt}</span>"</span>
        
        <span class="hljs-comment"># 默认情况</span>
        <span class="hljs-keyword">case</span> _:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"未知请求"</span>

<span class="hljs-comment"># 测试用例</span>
test_requests = [
    {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api/users"</span>},
    {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api/products/123"</span>},
    {<span class="hljs-string">"method"</span>: <span class="hljs-string">"POST"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api/data"</span>, <span class="hljs-string">"body"</span>: {<span class="hljs-string">"data"</span>: <span class="hljs-string">"test"</span>}},
    {<span class="hljs-string">"method"</span>: <span class="hljs-string">"GET"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/status"</span>, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1704067200</span>},
    {<span class="hljs-string">"method"</span>: <span class="hljs-string">"DELETE"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/old/path"</span>},
]

<span class="hljs-keyword">for</span> req <span class="hljs-keyword">in</span> test_requests:
    result = process_http_request(req)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{req}</span> -&gt; <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/028e69e4461143ab9b127c05a456cf71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=ClbK4bGJRBZ8Cw9l23jfH3%2BVUqU%3D" alt="复制代码" loading="lazy"/></a></p>
<h3 data-id="heading-6"><strong>3. 解释器级GIL控制</strong></h3>
<p> </p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ffd414ae8ec458582253d13302c9fe5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=vfQW7HwgwJ3nylXWKjaJmM7VLAk%3D" alt="复制代码" loading="lazy"/></a></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_runtime_gil_control</span>():
    <span class="hljs-string">"""运行时动态控制GIL"""</span>
    
    <span class="hljs-comment"># 检查当前GIL状态</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"当前GIL启用: <span class="hljs-subst">{sys._is_gil_enabled()}</span>"</span>)
    
    <span class="hljs-comment"># 动态禁用GIL（Python 3.14+）</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(sys, <span class="hljs-string">'set_gil_enabled'</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"禁用GIL以执行CPU密集型任务..."</span>)
        sys.set_gil_enabled(<span class="hljs-literal">False</span>)
        
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_intensive_task</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>, n=<span class="hljs-number">10_000_000</span></span>):
            result = <span class="hljs-number">0</span>
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):
                result += i * i
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"任务 <span class="hljs-subst">{<span class="hljs-built_in">id</span>}</span> 完成: <span class="hljs-subst">{result}</span>"</span>)
            <span class="hljs-keyword">return</span> result
        
        <span class="hljs-comment"># 创建并行线程</span>
        threads = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):
            t = threading.Thread(target=cpu_intensive_task, args=(i, <span class="hljs-number">5_000_000</span>))
            threads.append(t)
            t.start()
        
        <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
            t.join(https://www.falvce.com/)
        
        <span class="hljs-comment"># 重新启用GIL</span>
        sys.set_gil_enabled(<span class="hljs-literal">True</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"GIL已重新启用"</span>)
    
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"当前Python版本不支持运行时GIL控制"</span>)

<span class="hljs-comment"># 注意：动态GIL控制需要谨慎使用</span>
<span class="hljs-comment"># 某些C扩展可能依赖GIL</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f3347acbbba4024b4e051100b21d592~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=1RlprG6SjBjBaW2hvMAnhPNNc1o%3D" alt="复制代码" loading="lazy"/></a></p>
<h3 data-id="heading-7"><strong>4. 原生Zstandard压缩</strong></h3>
<p> </p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/630878569eb64fd39632671a099077ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766465623&amp;x-signature=fTQKuvNyxaOM5oRNEXbniZyEGOg%3D" alt="复制代码" loading="lazy"/></a></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.14 内置 zstd 支持</span>
<span class="hljs-keyword">import</span> compression.zstd <span class="hljs-keyword">as</span> zstd
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_zstd_compression</span>():
    <span class="hljs-string">"""演示Zstandard压缩"""</span>
    
    <span class="hljs-comment"># 创建测试数据</span>
    data = {
        <span class="hljs-string">"users"</span>: [
            {<span class="hljs-string">"id"</span>: i, <span class="hljs-string">"name"</span>: <span class="hljs-string">f"User_<span class="hljs-subst">{i}</span>"</span>, <span class="hljs-string">"email"</span>: <span class="hljs-string">f"user<span class="hljs-subst">{i}</span>@example.com"</span>}
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>)
        ]
    }
    
    json_str = json.dumps(data, indent=<span class="hljs-number">2</span>)
    original_size = <span class="hljs-built_in">len</span>(json_str.encode(<span class="hljs-string">'utf-8'</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"原始数据大小: <span class="hljs-subst">{original_size:,}</span> 字节"</span>)
    
    <span class="hljs-comment"># 使用Zstandard压缩</span>
    compressed = zstd.compress(json_str.encode(<span class="hljs-string">'utf-8'</span>))
    compressed_size = <span class="hljs-built_in">len</span>(compressed)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"压缩后大小: <span class="hljs-subst">{compressed_size:,}</span> 字节"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"压缩率: <span class="hljs-subst">{compressed_size/original_size:<span class="hljs-number">.1</span>%}</span>"</span>)
    
    <span class="hljs-comment"># 解压缩</span>
    decompressed = zstd.decompress(compressed)
    decompressed_str = https://www.falvce.com/ decompressed.decode(<span class="hljs-string">'utf-8'</span>)
    
    <span class="hljs-comment"># 验证数据完整性</span>
    <span class="hljs-keyword">assert</span> json_str == decompressed_str
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"数据完整性验证通过"</span>)
    
    <span class="hljs-comment"># 流式压缩</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n流式压缩示例:"</span>)
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test_data.json"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        f.write(json_str)
    
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test_data.json"</span>, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> src, \
         <span class="hljs-built_in">open</span>(<span class="hljs-string">"test_data.json.zst"</span>, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> dst:
        zstd.compress_stream(src, dst)
    
    compressed_file_size = os.path.getsize(<span class="hljs-string">"test_data.json.zst"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文件压缩后大小: <span class="hljs-subst">{compressed_file_size:,}</span> 字节"</span>)
    
    <span class="hljs-comment"># 清理</span>
    os.remove(<span class="hljs-string">"test_data.json"</span>)
    os.remove(<span class="hljs-string">"test_data.json.zst"</span>)

<span class="hljs-comment"># 与gzip对比</span>
<span class="hljs-keyword">import</span> gzip

<span class="hljs-keyword">def</span> <span class="hljs-title function_">compare_compression</span>():
    data = <span class="hljs-string">b"x"</span> * <span class="hljs-number">1000000</span>
    
    <span class="hljs-comment"># gzip</span>
    gzipped = gzip.compress(data)
    
    <span class="hljs-comment"># zstd</span>
    zstd_compressed = zstd.compress(data)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"原始: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(data):,}</span> 字节"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"gzip: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(gzipped):,}</span> 字节"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"zstd: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(zstd_compressed):,}</span> 字节"</span>)
    
    <span class="hljs-comment"># 性能对比</span>
    <span class="hljs-keyword">import</span> time
    
    start = time.time()
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):
        gzip.compress(data[:<span class="hljs-number">10000</span>])
    gzip_time = time.time() - start
    
    start = time.time()
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):
        zstd.compress(data[:<span class="hljs-number">10000</span>])
    zstd_time = time.time() - start
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n压缩速度对比 (100次):"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"gzip: <span class="hljs-subst">{gzip_time:<span class="hljs-number">.3</span>f}</span>秒"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"zstd: <span class="hljs-subst">{zstd_time:<span class="hljs-number">.3</span>f}</span>秒"</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[物联网场景中常见的方案MQTT+WebSocket]]></title>    <link>https://juejin.cn/post/7584043969686356020</link>    <guid>https://juejin.cn/post/7584043969686356020</guid>    <pubDate>2025-12-16T05:44:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584043969686356020" data-draft-id="7583973472323698703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="物联网场景中常见的方案MQTT+WebSocket"/> <meta itemprop="keywords" content="物联网"/> <meta itemprop="datePublished" content="2025-12-16T05:44:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机制的侏儒"/> <meta itemprop="url" content="https://juejin.cn/user/166781495807214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            物联网场景中常见的方案MQTT+WebSocket
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781495807214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机制的侏儒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:44:16.000Z" title="Tue Dec 16 2025 05:44:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MQTT 与 WebSocket 的结合是物联网场景中非常常见的方案，核心是<strong>让 MQTT 协议运行在 WebSocket 之上</strong>（即 MQTT over WebSocket），既保留 MQTT 轻量、适合设备通信的特性，又利用 WebSocket 的浏览器 / 网页端友好性，同时解决了部分网络环境下仅允许 HTTP/WebSocket 端口通行的问题。以下从<strong>结合原理、部署实现、使用场景</strong>三个维度详细说明：</p>
<h3 data-id="heading-0">一、MQTT 与 WebSocket 结合的核心原理</h3>
<p>MQTT 原本是基于<strong>TCP/IP</strong>的应用层协议，而 WebSocket 是在 HTTP 基础上建立的双向长连接协议，二者的结合本质是：</p>
<ol>
<li><strong>协议封装</strong>：将 MQTT 的数据包封装在 WebSocket 的帧中进行传输，WebSocket 作为 “传输通道”，MQTT 作为 “应用层逻辑”；</li>
<li><strong>端口复用</strong>：WebSocket 默认使用 80（ws://）或 443（wss://）端口，这些端口通常不会被防火墙 / 路由器拦截，解决了传统 MQTT 的 1883（TCP）/8883（SSL/TCP）端口被屏蔽的问题；</li>
<li><strong>双向通信</strong>：二者均为长连接、双向通信，完美匹配物联网设备实时上报状态、服务器下发指令的需求。</li>
</ol>
<p>简单来说：<strong>WebSocket 负责 “打通网络通道”，MQTT 负责 “定义设备通信的规则”</strong> 。</p>
<h3 data-id="heading-1">二、具体实现方式（以主流的 EMQX 为例）</h3>
<p>EMQX 是开源的高性能 MQTT Broker，原生支持 MQTT over WebSocket，是物联网场景的首选，以下是从<strong>服务端配置、客户端接入</strong>的完整实现步骤：</p>
<h4 data-id="heading-2">1. 服务端：配置 EMQX 支持 MQTT over WebSocket</h4>
<p>EMQX 默认开启了 WebSocket 监听，无需复杂配置即可使用，关键参数可参考：</p>
<ul>
<li>
<p><strong>默认端口</strong>：</p>
<ul>
<li>非加密 WebSocket（ws://）：8083 端口（对应 MQTT TCP 的 1883）；</li>
<li>加密 WebSocket（wss://）：8084 端口（对应 MQTT TCP 的 8883）；</li>
</ul>
</li>
<li>
<p><strong>验证配置</strong>：打开 EMQX 的配置文件（<code>emqx.conf</code>），确认 WebSocket 监听器已启用：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 启用WebSocket监听器</span>
listeners.ws.default {
  <span class="hljs-attr">bind</span> = <span class="hljs-string">"0.0.0.0:8083"</span>
  <span class="hljs-attr">max_connections</span> = <span class="hljs-number">1024000</span> <span class="hljs-comment"># 最大连接数</span>
}
<span class="hljs-comment"># 启用WSS（加密）监听器</span>
listeners.wss.default {
  <span class="hljs-attr">bind</span> = <span class="hljs-string">"0.0.0.0:8084"</span>
  ssl_options {
    <span class="hljs-attr">certfile</span> = <span class="hljs-string">"/etc/emqx/certs/emqx.pem"</span>
    <span class="hljs-attr">keyfile</span> = <span class="hljs-string">"/etc/emqx/certs/emqx.key"</span>
  }
}
</code></pre>
</li>
<li>
<p><strong>启动 EMQX</strong>：启动后可通过 EMQX Dashboard（默认<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A18083%2F" target="_blank" title="http://localhost:18083/" ref="nofollow noopener noreferrer">http://localhost:18083</a>）查看 WebSocket 连接状态，确认监听器正常运行。</p>
</li>
</ul>
<h4 data-id="heading-3">2. 客户端接入：设备 / 前端通过 WebSocket 连接 MQTT Broker</h4>
<p>根据客户端类型（嵌入式设备、网页前端、后端服务），有不同的接入方式，核心是使用支持 MQTT over WebSocket 的客户端库。</p>
<h5 data-id="heading-4">（1）网页前端（浏览器）接入（最常见场景）</h5>
<p>浏览器本身不支持原生 MQTT，但可通过 WebSocket 连接 EMQX 的 8083 端口，使用 MQTT 客户端库（如<code>mqtt.js</code>）实现通信：</p>
<ul>
<li>
<p><strong>安装依赖</strong>：</p>
<pre><code class="hljs language-css" lang="css">npm install mqtt <span class="hljs-attr">--save</span>
</code></pre>
</li>
<li>
<p><strong>代码示例</strong>：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> mqtt <span class="hljs-keyword">from</span> <span class="hljs-string">'mqtt'</span>;

<span class="hljs-comment">// 连接配置：WebSocket地址格式为 ws://broker地址:8083/mqtt</span>
<span class="hljs-keyword">const</span> client = mqtt.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'ws://localhost:8083/mqtt'</span>, {
  <span class="hljs-attr">clientId</span>: <span class="hljs-string">'web-client-123'</span>, <span class="hljs-comment">// 唯一客户端ID</span>
  <span class="hljs-attr">username</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-comment">// 可选，EMQX默认用户名</span>
  <span class="hljs-attr">password</span>: <span class="hljs-string">'public'</span>, <span class="hljs-comment">// 可选，EMQX默认密码</span>
  <span class="hljs-attr">keepalive</span>: <span class="hljs-number">60</span>, <span class="hljs-comment">// 心跳间隔（秒）</span>
});

<span class="hljs-comment">// 连接成功回调</span>
client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WebSocket + MQTT 连接成功'</span>);
  <span class="hljs-comment">// 订阅设备状态主题</span>
  client.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">'device/aircon/status'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!err) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'订阅成功'</span>);
  });
  <span class="hljs-comment">// 发布指令（控制空调）</span>
  client.<span class="hljs-title function_">publish</span>(<span class="hljs-string">'device/aircon/control'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">temp</span>: <span class="hljs-number">26</span> }));
});

<span class="hljs-comment">// 接收消息回调</span>
client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">topic, payload</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`收到主题 <span class="hljs-subst">${topic}</span> 的消息：<span class="hljs-subst">${payload.toString()}</span>`</span>);
});
</code></pre>
<p><strong>关键注意</strong>：WebSocket 的 URL 路径必须是<code>/mqtt</code>（EMQX 等 Broker 的约定），否则会连接失败。</p>
</li>
</ul>
<h5 data-id="heading-5">（2）嵌入式设备接入（如小米空调 / 电视）</h5>
<p>嵌入式设备（如基于 ESP32、Linux 的智能设备）可使用 MQTT 客户端库（如<code>paho-mqtt</code>、<code>emqx-mqtt-c</code>），通过 WebSocket 协议连接 Broker：</p>
<ul>
<li>
<p>以 C 语言的<code>emqx-mqtt-c</code>为例，核心配置：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-id">#include</span> "emqx_mqtt_c<span class="hljs-selector-class">.h</span>"

int <span class="hljs-selector-tag">main</span>() {
  <span class="hljs-comment">// 连接参数：指定WebSocket协议，端口8083</span>
  mqtt_client_t client;
  <span class="hljs-built_in">mqtt_client_init</span>(&amp;client);
  <span class="hljs-built_in">mqtt_client_set_port</span>(&amp;client, <span class="hljs-number">8083</span>);
  <span class="hljs-built_in">mqtt_client_set_protocol</span>(&amp;client, MQTT_PROTOCOL_WS); <span class="hljs-comment">// 启用WebSocket</span>
  <span class="hljs-built_in">mqtt_client_set_host</span>(&amp;client, "localhost");
  <span class="hljs-built_in">mqtt_client_set_client_id</span>(&amp;client, "device-aircon-<span class="hljs-number">456</span>");

  <span class="hljs-comment">// 连接Broker</span>
  if (mqtt_client_connect(&amp;client) == <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">printf</span>("设备通过WebSocket连接MQTT成功\n");
    <span class="hljs-comment">// 上报状态</span>
    <span class="hljs-built_in">mqtt_client_publish</span>(&amp;client, "device/aircon/status", "{"temp":<span class="hljs-number">26</span>}", <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  }
  return <span class="hljs-number">0</span>;
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-6">（3）后端服务接入</h5>
<p>后端服务（如 Java、Python）可通过 MQTT 客户端库直接连接 WebSocket 端口，实现对设备的管理：</p>
<ul>
<li>
<p>Python 示例（使用<code>paho-mqtt</code>）：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> paho.mqtt.client <span class="hljs-keyword">as</span> mqtt

<span class="hljs-keyword">def</span> <span class="hljs-title function_">on_connect</span>(<span class="hljs-params">client, userdata, flags, rc</span>):
  <span class="hljs-built_in">print</span>(<span class="hljs-string">f"连接成功，状态码：<span class="hljs-subst">{rc}</span>"</span>)
  client.subscribe(<span class="hljs-string">"device/#"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">client, userdata, msg</span>):
  <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{msg.topic}</span> : <span class="hljs-subst">{msg.payload.decode()}</span>"</span>)

<span class="hljs-comment"># 连接WebSocket端口</span>
client = mqtt.Client(client_id=<span class="hljs-string">"server-client-789"</span>, transport=<span class="hljs-string">"websockets"</span>)
client.on_connect = on_connect
client.on_message = on_message
client.username_pw_set(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"public"</span>)
client.connect(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">8083</span>, <span class="hljs-number">60</span>)

client.loop_forever()
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">三、MQTT+WebSocket 的部署优化（应对大规模设备）</h3>
<p>当设备量上升时，需对架构进行优化，避免单点瓶颈：</p>
<ol>
<li>
<p><strong>负载均衡</strong>：使用 Nginx 或 HAProxy 代理 WebSocket 连接，将请求分发到多个 EMQX 节点：</p>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Nginx配置示例</span>
http {
  upstream emqx_ws {
    server 192.168.1.10:8083<span class="hljs-comment">;</span>
    server 192.168.1.11:8083<span class="hljs-comment">;</span>
  }

  server {
    listen 80<span class="hljs-comment">;</span>
    server_name mqtt.example.com<span class="hljs-comment">;</span>

    location /mqtt {
      proxy_pass http://emqx_ws<span class="hljs-comment">;</span>
      proxy_http_version 1.1<span class="hljs-comment">;</span>
      proxy_set_header Upgrade $http_upgrade<span class="hljs-comment">;</span>
      proxy_set_header Connection "upgrade"<span class="hljs-comment">;</span>
      proxy_set_header Host $host<span class="hljs-comment">;</span>
    }
  }
}
</code></pre>
</li>
<li>
<p><strong>集群化部署</strong>：将 EMQX 部署为集群，实现连接数的水平扩展，支撑十万 / 百万级设备连接。</p>
</li>
<li>
<p><strong>协议分层</strong>：</p>
<ul>
<li>设备端：对低功耗设备，可使用 MQTT over WebSocket 的轻量变体（如 MQTT-SN）；</li>
<li>服务端：使用 EMQX 的规则引擎，将 MQTT 消息转发到 Kafka/Redis，降低实时转发压力。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">四、适用场景与优势总结</h3>





















<table><thead><tr><th>场景</th><th>优势体现</th></tr></thead><tbody><tr><td>网页端控制智能设备</td><td>浏览器无需插件，通过 WebSocket 直接与 MQTT Broker 通信，实时性强</td></tr><tr><td>跨网络设备通信</td><td>WebSocket 的 80/443 端口易穿透防火墙，解决传统 MQTT 端口被屏蔽的问题</td></tr><tr><td>混合终端接入</td><td>设备（TCP/MQTT）、网页（WebSocket/MQTT）、服务端可统一接入同一 Broker</td></tr></tbody></table>
<h3 data-id="heading-9">五、核心总结</h3>
<p>MQTT 与 WebSocket 的结合是 <strong>“协议复用 + 场景适配”</strong> 的典型应用：</p>
<ul>
<li><strong>底层</strong>：WebSocket 提供可靠的长连接通道，解决网络穿透和网页端接入问题；</li>
<li><strong>上层</strong>：MQTT 提供轻量的发布 / 订阅机制，适配物联网设备的低带宽、高并发需求。</li>
</ul>
<p>通过 EMQX 等成熟的 MQTT Broker，可快速实现二者的结合，且支持从中小规模到百万级设备的平滑扩展，是物联网远程控制的首选方案之一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 In-context Learning 到 RLHF：大语言模型的范式跃迁]]></title>    <link>https://juejin.cn/post/7583984122236026922</link>    <guid>https://juejin.cn/post/7583984122236026922</guid>    <pubDate>2025-12-16T04:28:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122236026922" data-draft-id="7583969283790749750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 In-context Learning 到 RLHF：大语言模型的范式跃迁"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-16T04:28:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星辞树"/> <meta itemprop="url" content="https://juejin.cn/user/200544183650531"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 In-context Learning 到 RLHF：大语言模型的范式跃迁
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/200544183650531/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星辞树
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:28:36.000Z" title="Tue Dec 16 2025 04:28:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从 In-context Learning 到 RLHF：大语言模型的范式跃迁</h2>
<p><strong>—— CS224n Lecture 10 深度笔记</strong></p>
<p>自然语言处理（NLP）在过去几年经历了一场无声的革命。我们不再为每个任务微调（Fine-tune）一个专用模型，而是转向了<strong>通用大模型</strong>的训练。</p>
<p>这一转变并非一蹴而就。从 GPT-2 的零样本尝试，到 GPT-3 的惊艳涌现，再到 InstructGPT 引入的强化学习，这是一条从“预测下一个词”走向“理解人类意图”的进化之路。</p>
<h3 data-id="heading-1">一、 涌现：从 Zero-shot 到 In-context Learning</h3>
<p>在 BERT 时代，范式是“预训练 + 下游任务微调”。但 GPT 系列证明了，当模型足够大、语料足够多时，<strong>任务处理能力会自然涌现</strong>。</p>
<h4 data-id="heading-2">1. GPT-2 与 零样本学习 (Zero-shot)</h4>
<p>GPT-2 展示了只要你有足够的<strong>提示词（Prompt）创造力</strong>，模型就能完成未见过的任务。</p>
<ul>
<li><strong>摘要任务</strong>：研究人员发现，只需在文章末尾加上 <code>TL;DR:</code>（Too Long; Didn't Read），模型就会自动进入“总结模式”。</li>
<li><strong>问答与指代消歧</strong>：通过构建特定的序列预测问题（如 Winograd Schema Challenge），模型利用概率分布 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mtext>context</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(\text{context})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord text"><span class="mord">context</span></span><span class="mclose">)</span></span></span></span></span> 就能在没有梯度更新的情况下做出选择。</li>
</ul>
<h4 data-id="heading-3">2. GPT-3 与 上下文学习 (In-context Learning)</h4>
<p>GPT-3 进一步提出了 <strong>Few-shot Learning</strong>，或者更准确地说是 <strong>In-context Learning</strong>。</p>
<ul>
<li><strong>机制</strong>：在输入中前置几个示例（Examples），例如 <code>gaot =&gt; goat</code>，模型就能理解“拼写纠正”的任务意图。</li>
<li><strong>本质</strong>：关键在于 <strong>No Gradient Updates</strong>。模型参数 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> 没有改变，模型是在推理阶段通过 Attention 机制，利用上下文中的示例来定位任务分布。</li>
</ul>
<hr/>
<h3 data-id="heading-4">二、 规训：指令微调 (Instruction Finetuning)</h3>
<p>虽然 GPT-3 很强，但它本质上还是一个“文本补全机”，而非“助手”。为了让模型听懂指令，我们进入了 <strong>Instruction Finetuning</strong> 阶段。</p>
<ul>
<li><strong>方法</strong>：将大量 NLP 任务（翻译、推理、问答）转化为指令格式，对预训练模型（如 T5）进行全量微调，得到 Flan-T5。</li>
<li><strong>效果</strong>：实验表明，模型越大，指令微调带来的性能增益（<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">Δ</span></span></span></span></span>）越显著（Scaling Law）。</li>
</ul>
<p>局限性 (The Limitations)</p>
<p>然而，传统的监督微调（SFT）存在瓶颈：</p>
<ol>
<li><strong>数据昂贵</strong>：收集高质量的“标准答案”成本极高。</li>
<li><strong>缺乏细微差别</strong>：对于开放式任务（如“写一个关于狗和蚱蜢的故事”），没有唯一的正确答案。</li>
<li><strong>惩罚机制僵化</strong>：在 Cross-Entropy Loss 下，将“冒险片”预测为“奇幻片”（接近正确）和预测为“音乐剧”（完全错误）受到的惩罚是一样的。</li>
</ol>
<hr/>
<h3 data-id="heading-5">三、 对齐：基于人类反馈的强化学习 (RLHF)</h3>
<p>为了解决 SFT 的局限，我们需要一种能理解“好坏优劣”而非单纯“对错”的机制。这正是 <strong>RLHF (Reinforcement Learning from Human Feedback)</strong> 的用武之地。</p>
<h4 data-id="heading-6">1. 为什么是 RL？</h4>
<p>虽然 RL 在游戏领域（AlphaGo）早已大放异彩，但在语言模型上的应用是较新的突破（PPO 算法的出现解决了稳定性问题）。RL 允许我们要针对<strong>不可导</strong>的奖励函数（人类偏好）进行优化。</p>
<h4 data-id="heading-7">2. 核心组件：奖励模型 (Reward Model)</h4>
<p>既然人类打分噪声太大，我们采用了 <strong>Pairwise Comparison（成对比较）</strong> 。</p>
<ul>
<li>
<p>让模型生成两个回答 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mi>w</mi></msup></mrow><annotation encoding="application/x-tex">s^w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mi>l</mi></msup></mrow><annotation encoding="application/x-tex">s^l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span></span></span></span></span>，人类只需判断 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mi>w</mi></msup><mo>&gt;</mo><msup><mi>s</mi><mi>l</mi></msup></mrow><annotation encoding="application/x-tex">s^w &gt; s^l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7035em;vertical-align:-0.0391em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8491em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span></span></span></span></span>。</p>
</li>
<li>
<p>通过 Bradley-Terry 模型 训练奖励模型 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><msub><mi>M</mi><mi>ϕ</mi></msub></mrow><annotation encoding="application/x-tex">RM_\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>，使其满足：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mrow><mi>R</mi><mi>M</mi></mrow></msub><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><msub><mi mathvariant="double-struck">E</mi><mrow><mo stretchy="false">(</mo><msup><mi>s</mi><mi>w</mi></msup><mo separator="true">,</mo><msup><mi>s</mi><mi>l</mi></msup><mo stretchy="false">)</mo><mo>∼</mo><mi>D</mi></mrow></msub><mo stretchy="false">[</mo><mi>log</mi><mo>⁡</mo><mi>σ</mi><mo stretchy="false">(</mo><mi>R</mi><msub><mi>M</mi><mi>ϕ</mi></msub><mo stretchy="false">(</mo><msup><mi>s</mi><mi>w</mi></msup><mo stretchy="false">)</mo><mo>−</mo><mi>R</mi><msub><mi>M</mi><mi>ϕ</mi></msub><mo stretchy="false">(</mo><msup><mi>s</mi><mi>l</mi></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">J_{RM}(\phi) = -\mathbb{E}_{(s^w, s^l) \sim D} [\log \sigma (RM_\phi(s^w) - RM_\phi(s^l))]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">RM</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">ϕ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1276em;vertical-align:-0.3776em;"/><span class="mord">−</span><span class="mord"><span class="mord mathbb">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.4974em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5935em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.782em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mrel mtight">∼</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3776em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1352em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span></span></span></span><span class="mclose">))]</span></span></span></span></span></p>
<p>这一步将人类模糊的价值观固化为了一个可计算的神经网络。</p>
</li>
</ul>
<h4 data-id="heading-8">3. 终极循环：PPO 与 KL 散度惩罚</h4>
<p>这是 ChatGPT 训练流程的最后一块拼图。我们需要训练一个新的策略模型 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>p</mi><mi>θ</mi><mrow><mi>R</mi><mi>L</mi></mrow></msubsup></mrow><annotation encoding="application/x-tex">p_\theta^{RL}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1244em;vertical-align:-0.2831em;"/><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4169em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831em;"><span/></span></span></span></span></span></span></span></span></span>，优化目标如下：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>=</mo><mi>R</mi><msub><mi>M</mi><mi>ϕ</mi></msub><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>−</mo><mi>β</mi><mi>log</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><mfrac><mrow><msubsup><mi>p</mi><mi>θ</mi><mrow><mi>R</mi><mi>L</mi></mrow></msubsup><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><mrow><msup><mi>p</mi><mrow><mi>P</mi><mi>T</mi></mrow></msup><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(s) = RM_\phi(s) - \beta \log \left( \frac{p_\theta^{RL}(s)}{p^{PT}(s)} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.8036em;vertical-align:-0.65em;"/><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1536em;"><span style="top:-2.6481em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7741em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">PT</span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.5102em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5269em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p>
<ul>
<li>
<p><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><msub><mi>M</mi><mi>ϕ</mi></msub><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">RM_\phi(s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span></span></strong> ：驱使模型尽可能获得高分（讨好人类）。</p>
</li>
<li>
<p><strong>KL Penalty</strong>：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>β</mi><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>…</mo><mtext> </mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">-\beta \log (\dots)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mclose">)</span></span></span></span></span> 是一道紧箍咒。它强迫新模型的分布 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>p</mi><mrow><mi>R</mi><mi>L</mi></mrow></msup></mrow><annotation encoding="application/x-tex">p^{RL}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">L</span></span></span></span></span></span></span></span></span></span></span></span></span> 不能偏离原始预训练模型 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>p</mi><mrow><mi>P</mi><mi>T</mi></mrow></msup></mrow><annotation encoding="application/x-tex">p^{PT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">PT</span></span></span></span></span></span></span></span></span></span></span></span></span> 太远。</p>
<ul>
<li><strong>如果没有它</strong>：模型会利用 Reward Model 的漏洞进行“刷分”（Reward Hacking），输出人类无法理解的乱码。</li>
<li><strong>有了它</strong>：模型在保持语言流利度（不忘初心）的前提下，尽可能符合人类偏好。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-9">四、 未来：Constitutional AI</h3>
<p>RLHF 虽然强大，但依赖大量人类标注（Data Expensive）。未来的方向是 <strong>RLAIF (RL from AI Feedback)</strong> ，即“宪法 AI”。</p>
<p>通过给定一套原则（Constitution），让 AI 自己对自己生成的回答进行 <strong>Critique（批判）</strong> 和 <strong>Revision（修正）</strong> ，从而实现自我迭代。如果说 RLHF 是“依人法治”，那么 RLAIF 就是“依宪法治”。</p>
<blockquote>
<p>结语</p>
<p>从 GPT-2 的 TL;DR 到 GPT-4 的 RLHF，本质上是我们不仅希望 AI 懂得多（Pre-training），更希望 AI 懂我们（Alignment）。这一过程，正是从“统计概率”向“类人智能”跨越的关键一步。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端一行代码生成数千页PDF，dompdf.js新增分页功能]]></title>    <link>https://juejin.cn/post/7583912637470769203</link>    <guid>https://juejin.cn/post/7583912637470769203</guid>    <pubDate>2025-12-15T18:46:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912637470769203" data-draft-id="7576559408659529780" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端一行代码生成数千页PDF，dompdf.js新增分页功能 "/> <meta itemprop="keywords" content="前端,开源,TypeScript"/> <meta itemprop="datePublished" content="2025-12-15T18:46:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘发财"/> <meta itemprop="url" content="https://juejin.cn/user/4089838985816968"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端一行代码生成数千页PDF，dompdf.js新增分页功能 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4089838985816968/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘发财
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T18:46:14.000Z" title="Mon Dec 15 2025 18:46:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#2c3e50;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;font-weight:600;margin-top:35px;margin-bottom:8px;padding-bottom:5px}.markdown-body h1 :before,.markdown-body h2 :before,.markdown-body h3 :before,.markdown-body h4 :before,.markdown-body h5 :before,.markdown-body h6 :before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:8px;margin-top:50px;font-size:24px;border-bottom:1px solid #eaecef}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #eaecef;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;font-weight:400;background-color:rgba(27,31,35,.05);color:#476582;margin:0;font-size:.85em;border-radius:3px;font-size:.87em;padding:.165em .5em}.markdown-body code,.markdown-body pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.6;padding:20px 24px;background-color:#282c34;border-radius:6px}.markdown-body pre&gt;code{font-size:14px;padding:0;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff}.markdown-body a{text-decoration:none;color:#3eaf7c;font-weight:500}.markdown-body a:active,.markdown-body a:hover{color:#42b983;border-bottom:1px solid #42b983}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;margin:16px 0;border-collapse:collapse}.markdown-body thead{background:#f6f6f6;background:#3eaf7c;color:#000;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f6f8fa}.markdown-body td,.markdown-body th{border:1px solid #dfe2e5;padding:10px 16px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{font-size:14px;padding:6px 23px;margin:22px 0;border-left:6px solid #42b983;background-color:#f3f5f7;font-weight:400}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body p,.markdown-body ul{line-height:1.7}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="base16/tomorrow-night">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端生成 PDF 不清晰？文字无法搜索选中编辑？体积太大？分页切割不精准？生成页数太少？<code>dompdf.js</code>V1.1.0 版本更新后，这些都不在是问题，只需要一行代码，就可以将 html 页面生成数千页 PDF 文件，这可能是前端首个实现这一功能的 js 库。</p>
<p>dompdf.js 是作者开源的前端 PDF 生成库。可以纯前端将 html 生成为非图片式的，可编辑，小体积的 PDF 文件。<a href="https://juejin.cn/post/7559886023661649958" target="_blank" title="https://juejin.cn/post/7559886023661649958">上一篇文章 https://juejin.cn/post/7559886023661649958</a>有做相关介绍。之前的版本只能生成单页 PDF，很多开发者反馈有生成多页 PDF 的需求，作者花了点时间在 V1.1.0 版本新增了分页功能，<strong>可以将 html 页面生成为多页 PDF 文件</strong>。</p>
<h3 data-id="heading-0">代码示例</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> dompdf <span class="hljs-keyword">from</span> <span class="hljs-string">"dompdf.js"</span>;

<span class="hljs-title function_">dompdf</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#capture"</span>), { <span class="hljs-attr">pagination</span>: <span class="hljs-literal">true</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">
  blob
</span>) {
  <span class="hljs-comment">//文件操作</span>
});
</code></pre>
<p>实现效果如下(数千页PDF)：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c9c550042fa491b936f450e3036a7f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=Kk4HEMgBPl4It7%2FzfmxoUR63%2BdI%3D" alt="总页数.png" loading="lazy"/></p>
<p><strong>当然，生成数千页的 PDF 是非常极端的情况才能达成，决定能生成多少页 PDF 的，要看文件大小，如果是纯文字 PDF，就能生成更多的页数，反之如果 PDF 中有图片，生成的页数就会少</strong></p>
<h2 data-id="heading-1">1. 在线体验</h2>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdompdfjs.lisky.com.cn" target="_blank" title="https://dompdfjs.lisky.com.cn" ref="nofollow noopener noreferrer">dompdfjs.lisky.com.cn</a></p>
</blockquote>
<h2 data-id="heading-2">2. Git 仓库地址 (欢迎 Star⭐⭐⭐)</h2>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flmn1919%2Fdompdf.js" target="_blank" title="https://github.com/lmn1919/dompdf.js" ref="nofollow noopener noreferrer">github.com/lmn1919/dom…</a></p>
</blockquote>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fliu-facai%2Fdompdf.js" target="_blank" title="https://gitee.com/liu-facai/dompdf.js" ref="nofollow noopener noreferrer">gitee.com/liu-facai/d…</a></p>
</blockquote>
<h2 data-id="heading-3">3.版本新功能特性</h2>
<h3 data-id="heading-4">1. 分页功能-精准的页面分割</h3>
<h4 data-id="heading-5">图片分页效果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58764661c6044b2b92094cfb00561eb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=2l859tm8n6%2BCgtqWpClmel2QAw0%3D" alt="图片分割效果.png" loading="lazy"/></p>
<h4 data-id="heading-6">左右布局分页效果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/283574b2fc6b4b82bc5b944cc366e3fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=y6mlDjrHcyfzViNCOwGwsEHihNg%3D" alt="左右布局分割.png" loading="lazy"/></p>
<h4 data-id="heading-7">文本分页效果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/245d2186177843a7b0c74acef7d7042f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=%2FekBgW35AIfGy6hfT4Jd77n5qts%3D" alt="文本分割效果.png" loading="lazy"/></p>
<h4 data-id="heading-8">复杂表格分页效果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9acff792081a4de19dadbc7b29832026~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=L6OHp4hx2radYQe5tdqbaNX5plo%3D" alt="复杂表格分割.png" loading="lazy"/></p>
<h3 data-id="heading-9">2. 自定义页眉页脚</h3>
<p>可以设置页眉页脚的高度，内容，字体大小，字体颜色等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f42db54b4bd2456db89ec291d40954bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=Yu5LJoONuQNtB6iXH6MfFhkMbAI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">3. PDF 密码、操作权限设置，PDF 压缩</h3>
<h2 data-id="heading-11">4.分页实现原理</h2>
<p><code>dompdf.js</code> 是如何将 html 页面生成为多页 PDF 文件的？</p>
<ol>
<li>
<p>先将 html 解析为 DOM 树。DOM 树主要包含 DOM 元素的位置信息（bounds: width|height|left|top）、样式数据、文本节点数据等。
大致的结构为：</p>
<pre><code class="hljs language-javascript" lang="javascript">{
<span class="hljs-attr">bounds</span>: {<span class="hljs-attr">height</span>: <span class="hljs-number">1303.6875</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">top</span>: -<span class="hljs-number">298.5625</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">1273</span>},
<span class="hljs-attr">elements</span>: [
        {
        <span class="hljs-attr">bounds</span>: {<span class="hljs-attr">left</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">top</span>: -<span class="hljs-number">298.5625</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">1273</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">1303.6875</span>},
        <span class="hljs-attr">elements</span>: [
                {
                <span class="hljs-attr">bounds</span>: {<span class="hljs-attr">left</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">top</span>: -<span class="hljs-number">298.5625</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">1273</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">1303.6875</span>},
                <span class="hljs-attr">elements</span>: [
                        {<span class="hljs-attr">styles</span>: <span class="hljs-title class_">CSSParsedDeclaration</span>, <span class="hljs-attr">textNodes</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">elements</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">0</span>), <span class="hljs-attr">bounds</span>: <span class="hljs-title class_">Bounds</span>, <span class="hljs-attr">flags</span>: <span class="hljs-number">0</span>},
                        {<span class="hljs-attr">styles</span>: <span class="hljs-title class_">CSSParsedDeclaration</span>, <span class="hljs-attr">textNodes</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">elements</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">0</span>), <span class="hljs-attr">bounds</span>: <span class="hljs-title class_">Bounds</span>, <span class="hljs-attr">flags</span>: <span class="hljs-number">0</span>},
                        ...
                ],
                <span class="hljs-attr">flags</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">styles</span>: {<span class="hljs-attr">backgroundClip</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">backgroundColor</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">backgroundImage</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">0</span>), <span class="hljs-attr">backgroundOrigin</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">backgroundPosition</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), …},
                <span class="hljs-attr">textNodes</span>: []
                }
        ],
        <span class="hljs-attr">flags</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">styles</span>: <span class="hljs-title class_">CSSParsedDeclaration</span> {<span class="hljs-attr">backgroundClip</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">backgroundColor</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">backgroundImage</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">0</span>), <span class="hljs-attr">backgroundOrigin</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">backgroundPosition</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), …},
        <span class="hljs-attr">textNodes</span>: []
        }
],
<span class="hljs-attr">flags</span>: <span class="hljs-number">4</span>,
<span class="hljs-attr">styles</span>: <span class="hljs-title class_">CSSParsedDeclaration</span> {<span class="hljs-attr">backgroundClip</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">backgroundColor</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">backgroundImage</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">0</span>), <span class="hljs-attr">backgroundOrigin</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">backgroundPosition</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>), …},
<span class="hljs-attr">textNodes</span>: []
}
</code></pre>
</li>
<li>
<p>递归 DOM 树的 elements 以及 textNodes，通过 bounds.top+bounds.height 判断是否需要分页，将 DOM 树按照页面分割成多个分页 DOM 树，并重新计算 elements 和 textNodes 的 bounds。
比如一个 textNodes 的位置信息是这样的：</p>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">{
 <span class="hljs-attr">bounds</span>: {<span class="hljs-attr">left</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">1115</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">850</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">24</span>},
 <span class="hljs-attr">text</span>: <span class="hljs-string">"这是一个文本节点"</span>
}
</code></pre>
<p>如果我们要按照 <code>a4</code> 纸张的高度（1123px）来分页，那么当文本节点的 top 加上 height 大于 1123px 时，而 top 的值 1115px 小于 1123px，那么这个文本节点就会分割到第二页。并且 top 值会重置为 0，后续项的 top 值也会减少相应的值，确保元素位置的准确性。</p>
<ol start="3">
<li>
<p>循环 DOM 树分页数组，调用 <code>jspdf.addPage()</code> 方法添加新页面，并绘制页眉页脚。根据不同的元素类型，以及元素的位置信息，调用不同的 jspdf 方法生成 pdf。
比如绘制文字：</p>
<pre><code class="hljs language-javascript" lang="javascript">jspdf.<span class="hljs-title function_">text</span>(<span class="hljs-string">"这是一个文本节点"</span>, <span class="hljs-number">1115</span>, <span class="hljs-number">8</span>);
</code></pre>
<p>绘制图片：</p>
<pre><code class="hljs language-javascript" lang="javascript">jspdf.<span class="hljs-title function_">image</span>(img, x, y, width, height);
</code></pre>
</li>
</ol>
<h2 data-id="heading-12">5.使用文档</h2>
<p>安装：</p>
<pre><code class="hljs language-BASH" lang="BASH">npm install dompdf.js --save
</code></pre>
<p>CDN 引入：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/dompdf.js@latest/dist/dompdf.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">基础用法</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> dompdf <span class="hljs-keyword">from</span> <span class="hljs-string">"dompdf.js"</span>;

<span class="hljs-title function_">dompdf</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#capture"</span>), options)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
    <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
    a.<span class="hljs-property">href</span> = url;
    a.<span class="hljs-property">download</span> = <span class="hljs-string">"example.pdf"</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
    a.<span class="hljs-title function_">click</span>();
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  });
</code></pre>
<h4 data-id="heading-14">PDF 分页渲染</h4>
<p>默认情况下，dompdf 会将整个文档渲染到单页中。</p>
<p>您可以通过设置 <code>pagination</code> 选项为 <code>true</code> 来开启分页渲染。通过 pageConfig 字段自定义页眉页脚的尺寸，内容，字体颜色/大小，位置等信息。</p>
<p><strong>非常重要！！！！非常重要！！！！非常重要！！！！非常重要！！！！非常重要！！！！</strong></p>
<p><strong>需要将要生成PDF的dom节点设置为对应的页面宽度（px）,比如a4要设置宽度为794px,这里是页面尺寸对照表，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdompdfjs.lisky.com.cn%2Fdocumentation.html" target="_blank" title="https://dompdfjs.lisky.com.cn/documentation.html" ref="nofollow noopener noreferrer">请点击查看</a></strong></p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
    <span class="hljs-attr">id</span>=<span class="hljs-string">"capture"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"width:794px"</span>
    &gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> dompdf <span class="hljs-keyword">from</span> <span class="hljs-string">"dompdf.js"</span>;

<span class="hljs-title function_">dompdf</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#capture"</span>), {
  <span class="hljs-attr">pagination</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">format</span>: <span class="hljs-string">"a4"</span>,
  <span class="hljs-attr">pageConfig</span>: {
    <span class="hljs-attr">header</span>: {
      <span class="hljs-attr">content</span>: <span class="hljs-string">"这是页眉"</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
      <span class="hljs-attr">contentColor</span>: <span class="hljs-string">"#333333"</span>,
      <span class="hljs-attr">contentFontSize</span>: <span class="hljs-number">12</span>,
      <span class="hljs-attr">contentPosition</span>: <span class="hljs-string">"center"</span>,
      <span class="hljs-attr">padding</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    },
    <span class="hljs-attr">footer</span>: {
      <span class="hljs-attr">content</span>: <span class="hljs-string">"第${currentPage}页/共${totalPages}页"</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
      <span class="hljs-attr">contentColor</span>: <span class="hljs-string">"#333333"</span>,
      <span class="hljs-attr">contentFontSize</span>: <span class="hljs-number">12</span>,
      <span class="hljs-attr">contentPosition</span>: <span class="hljs-string">"center"</span>,
      <span class="hljs-attr">padding</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    },
  },
})
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
    <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
    a.<span class="hljs-property">href</span> = url;
    a.<span class="hljs-property">download</span> = <span class="hljs-string">"example.pdf"</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
    a.<span class="hljs-title function_">click</span>();
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  });
</code></pre>
<h5 data-id="heading-15">更精准的分页控制-<code>divisionDisable</code> 属性</h5>
<p>如果您不希望某个容器在分页时被拆分时，为该元素添加 <code>divisionDisable</code> 属性，跨页时它会整体移至下一页。</p>
<pre><code class="hljs language-html" lang="html"> <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">""</span>
  <span class="hljs-attr">alt</span>=<span class="hljs-string">"PDF Generation Example"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
  <span class="hljs-attr">divisionDisable</span>
/&gt;</span>
</code></pre>
<p>右边为使用divisionDisable属性的效果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20956c6ce960489395b4432ffcbe58cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5Y-R6LSi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766429174&amp;x-signature=fQqVhnOaHUPFywIzV9E3E01ss8o%3D" alt="不分割的效果.png" loading="lazy"/></p>
<h4 data-id="heading-16">options 参数</h4>


















































































<table><thead><tr><th>参数名</th><th>必传</th><th>默认值</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>useCORS</code></td><td>否</td><td><code>false</code></td><td><code>boolean</code></td><td>允许跨域资源（需服务端 CORS 配置）</td></tr><tr><td><code>backgroundColor</code></td><td>否</td><td>自动解析/白色</td><td><code>string | null</code></td><td>覆盖页面背景色；传 <code>null</code> 生成透明背景</td></tr><tr><td><code>fontConfig</code></td><td>否</td><td>-</td><td><code>object</code></td><td>非英文字体配置，见下表</td></tr><tr><td><code>encryption</code></td><td>否</td><td>空配置</td><td><code>object</code></td><td>PDF 加密配置，属性<code>userPassword</code> 用于给定权限列表下用户的密码；属性<code>ownerPassword</code> 需要设置 userPassword 和 ownerPassword 以进行正确的身份验证；属性<code>userPermissions</code> 用于指定用户权限，可选值为 <code>['print', 'modify', 'copy', 'annot-forms']</code></td></tr><tr><td><code>precision</code></td><td>否</td><td><code>16</code></td><td><code>number</code></td><td>元素位置的精度</td></tr><tr><td><code>compress</code></td><td>否</td><td><code>false</code></td><td><code>boolean</code></td><td>是否压缩是否压缩 PDF</td></tr><tr><td><code>putOnlyUsedFonts</code></td><td>否</td><td><code>false</code></td><td><code>boolean</code></td><td>仅将实际使用的字体嵌入 PDF</td></tr><tr><td><code>pagination</code></td><td>否</td><td><code>false</code></td><td><code>boolean</code></td><td>开启分页渲染</td></tr><tr><td><code>format</code></td><td>否</td><td><code>'a4'</code></td><td><code>string</code></td><td>页面规格，支持 <code>a0–a10</code>、<code>b0–b10</code>、<code>c0–c10</code>、<code>letter</code> 等</td></tr><tr><td><code>pageConfig</code></td><td>否</td><td>见下表</td><td><code>object</code></td><td>页眉页脚配置</td></tr></tbody></table>
<h5 data-id="heading-17"><code>pageConfig</code>字段：</h5>























<table><thead><tr><th>参数名</th><th>默认值</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>header</code></td><td>见下表 pageConfigOptions</td><td>object</td><td>页眉设置</td></tr><tr><td><code>footer</code></td><td>见下表 pageConfigOptions</td><td>object</td><td>页脚设置</td></tr></tbody></table>
<h5 data-id="heading-18"><code>pageConfigOptions</code> 字段：</h5>















































<table><thead><tr><th>参数名</th><th>默认值</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>content</code></td><td>页眉默认值为空,页脚默认值为<code>${currentPage}/${totalPages}</code></td><td><code>string</code></td><td>文本内容，支持 <code>${currentPage}</code>、<code>${totalPages}</code>，<code>${currentPage}</code>为当前页码，<code>${totalPages}</code>为总页码</td></tr><tr><td><code>height</code></td><td><code>50</code></td><td><code>number</code></td><td>区域高度（px）</td></tr><tr><td><code>contentPosition</code></td><td><code>'center'</code></td><td><code>string | [number, number]</code></td><td>文本位置枚举 <code>center</code>、<code>centerLeft</code> 、 <code>centerRight</code>、<code>centerTop</code>、 <code>centerBottom</code>、<code>leftTop</code>、 <code>leftBottom</code>、<code>rightTop</code>、<code>rightBottom</code>或坐标 <code>[x,y]</code></td></tr><tr><td><code>contentColor</code></td><td><code>'#333333'</code></td><td><code>string</code></td><td>文本颜色</td></tr><tr><td><code>contentFontSize</code></td><td><code>16</code></td><td><code>number</code></td><td>文本字号（px）</td></tr><tr><td><code>padding</code></td><td><code>[0,24,0,24]</code></td><td><code>[number, number, number, number]</code></td><td>上/右/下/左内边距（px）</td></tr></tbody></table>
<h5 data-id="heading-19">字体配置（<code>fontConfig</code>）字段：</h5>


























<table><thead><tr><th>字段</th><th>必传</th><th>默认值</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>fontFamily</code></td><td>是（启用自定义字体时）</td><td><code>''</code></td><td><code>string</code></td><td>字体家族名（与注入的 <code>.ttf</code> 同名）</td></tr><tr><td><code>fontBase64</code></td><td>是（启用自定义字体时）</td><td><code>''</code></td><td><code>string</code></td><td><code>.ttf</code> 的 Base64 字符串内容</td></tr></tbody></table>
<h4 data-id="heading-20">乱码问题-字体导入支持</h4>
<p>由于 jspdf 只支持英文，所以其他语言会出现乱码的问题，需要导入对应的字体文件来解决，如果需要自定义字体，在<a href="https://link.juejin.cn?target=https%3A%2F%2Frawgit.com%2FMrRio%2FjsPDF%2Fmaster%2Ffontconverter%2Ffontconverter.html" target="_blank" title="https://rawgit.com/MrRio/jsPDF/master/fontconverter/fontconverter.html" ref="nofollow noopener noreferrer">这里</a>将字体 tff 文件转化成 base64 格式的 js 文件，中文字体推荐使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flmn1919%2Fdompdf.js%2Fblob%2Fmain%2Fexamples%2FSourceHanSansSC-Normal-Min-normal.js" target="_blank" title="https://github.com/lmn1919/dompdf.js/blob/main/examples/SourceHanSansSC-Normal-Min-normal.js" ref="nofollow noopener noreferrer">思源黑体</a>,体积较小。
在代码中引入该文件即可。</p>
<pre><code class="hljs language-js" lang="js">&lt;script type=<span class="hljs-string">"text/javascript"</span> src=<span class="hljs-string">"./SourceHanSansSC-Normal-Min-normal.js"</span>&gt;&lt;/script&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-title function_">dompdf</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#capture'</span>), {
    <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">fontConfig</span>: {
      <span class="hljs-attr">fontFamily</span>: <span class="hljs-string">'SourceHanSansSC-Normal-Min'</span>,
      <span class="hljs-attr">fontBase64</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">fontBase64</span>
    }
  })
    .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">blob</span>) {
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
      <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
      a.<span class="hljs-property">href</span> = url;
      a.<span class="hljs-property">download</span> = <span class="hljs-string">'example.pdf'</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
      a.<span class="hljs-title function_">click</span>();
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h4 data-id="heading-21">绘制渐变色、阴影等复杂样式-foreignObjectRendering 使用</h4>
<p>在 dom 十分复杂，或者 pdf 无法绘制的情况（比如：复杂的表格，边框阴影，渐变等），可以考虑使用 foreignObjectRendering。
给要渲染的元素添加 foreignObjectRendering 属性，就可以通过 svg 的 foreignObject 将它渲染成一张背景图插入到 pdf 文件中。</p>
<p>但是，由于 foreignObject 元素的渲染依赖于浏览器的实现，因此在不同的浏览器中可能会有不同的表现。
所以，在使用 foreignObjectRendering 时，需要注意以下事项：</p>
<ol>
<li>foreignObject 元素的渲染依赖于浏览器的实现，因此在不同的浏览器中可能会有不同的表现。</li>
<li>IE 浏览器完全不支持，推荐在 chrome 和 firefox,edge 中使用。</li>
<li>生成的图片会导致 pdf 文件体积变大。</li>
</ol>
<p>示例</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;height: 100px;"</span> <span class="hljs-attr">foreignObjectRendering</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 50px;height: 50px;border: 1px solid #000;box-shadow: 2px 2px 5px rgba(0,0,0,0.3);background: linear-gradient(45deg, #ff6b6b, #4ecdc4);"</span>
  &gt;</span>
    这是一个div元素
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-22">浏览器兼容性</h3>
<p>该库应该可以在以下浏览器上正常工作（需要 <code>Promise</code> polyfill）：</p>
<ul>
<li>Firefox 3.5+</li>
<li>Google Chrome</li>
<li>Opera 12+</li>
<li>IE9+</li>
<li>Safari 6+</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从图文到视频，如何用Coze跑通“小红书儿童绘本”的商业闭环？]]></title>    <link>https://juejin.cn/post/7584094504630910985</link>    <guid>https://juejin.cn/post/7584094504630910985</guid>    <pubDate>2025-12-16T05:57:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584094504630910985" data-draft-id="7584028251166507035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从图文到视频，如何用Coze跑通“小红书儿童绘本”的商业闭环？"/> <meta itemprop="keywords" content="Coze,AIGC,人工智能"/> <meta itemprop="datePublished" content="2025-12-16T05:57:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="后端小肥肠"/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从图文到视频，如何用Coze跑通“小红书儿童绘本”的商业闭环？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    后端小肥肠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:57:47.000Z" title="Tue Dec 16 2025 05:57:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是小肥肠！上周的儿童绘本图文教程大家反响热烈，但我也听到了大家的呼声：<strong>视频才是现在的流量密码！</strong> 没问题，今天直接安排！本期教程教你用 <strong>Coze + Nano Banana</strong> <strong>Pro</strong> 搭建全自动<strong>视频绘本</strong> <strong>工作流</strong>。从创意到成品，几分钟内搞定。想在小红书视频赛道分一杯羹的朋友，这篇干货千万别错过，跟练走起~</p>
<h2 data-id="heading-0">1. 为什么要做视频绘本？</h2>
<p>上周我做了一个儿童绘本工作流<a href="https://juejin.cn/post/7581415427516416042" target="_blank" title="https://juejin.cn/post/7581415427516416042">小红书儿童绘本这样做！Coze+Nano Banana Pro批量生产挂橱窗</a>，社群小伙伴反响热烈，我们也顺势开启了儿童绘本实战训练营。在陪跑的过程中，我敏锐地发现了一个更具潜力的风口：<strong>动起来的绘本</strong>。在许多高热度的绘本笔记评论区，我发现大量家长都在求视频版资源。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d46f490c255b4722bedd53991c276e19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=ZTZsKOh3N3pwWo8lkNehmvSSgGI%3D" alt="" loading="lazy"/></p>
<p>我去调研了一下，发现这类视频不仅涵盖中英文，而且热度极高。相比于普通图文，视频绘本的完播率和互动数据简直是降维打击，点赞量轻松破万。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9ebfd4832b14c85a670905bfa1724ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=iFUbZvuntYpawtMerBoammSE%2FI8%3D" alt="" loading="lazy"/></p>
<p>我进入了一个数据不错的博主主页的橱窗，品类都是儿童绘本，他的数据挺不错。其实到这里完整一套商业逻辑已经呈现，即通过制作高质量的儿童绘本图文或视频再挂橱窗。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b2b230b78824f7f9440627068a247b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=rogxurCasw5D64lP6soKeXDBfBw%3D" alt="" loading="lazy"/></p>
<p>今天这期教程将教大家用coze工作流一键生成儿童绘本视频，支持中英文，你要做的仅仅是<strong>提供绘本视频主题</strong>和<strong>将coze生成的剪映草稿导出到剪映中</strong>。</p>
<p><strong>效果演示：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83ca0b4f103a468c9225fb8ecd6f71a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=u8tVD0bFx8NjBwjiS0ac5njq7fM%3D" alt="" loading="lazy"/></p>
<p>coze工作流的使用很简单，我们找到coze工作流界面，点击【试运行】按钮，输入主题，语言（支持zh/en），上传背景音乐音乐后再点击底部【试运行】按钮。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6d1e86950df4da98bdf04fa58d15833~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=rWUD6JbK1BbGgawus7uZb8P3tFs%3D" alt="" loading="lazy"/></p>
<p>等待几分钟后就会生成剪映草稿链接。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f1294b6756640a98e9655a0209eefc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=j7KYhqbXARTTAb3B%2BoYlgqhhvcQ%3D" alt="" loading="lazy"/></p>
<p>只需将其导出至剪映即可获得成品视频，可以微调或直接导出上传到平台。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efc1279faaee45b791cdd10ebaad0c10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=5Q2tQlXiLIJJyJcvVHUNVP6rjIM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">2. 工作流搭建</h2>
<p>完整工作流如下图，整体工作流并不复杂，工作流的运行可拆解为以下几步：</p>
<ol>
<li>
<p>用户输入主题、绘本视频语言（zh或en）、生图模型（支持豆包和nano banana pro）和上传背景音乐</p>
</li>
<li>
<p>大模型创作绘本故事大纲、故事片段列表和主角形象</p>
</li>
<li>
<p>进入循环遍历对每个故事片段进行配音、文生图、图生视频操作</p>
</li>
<li>
<p>退出循环获取视频列表、配音列表等视频素材</p>
</li>
<li>
<p>基于代码将视频素材转换为剪映小助手所需格式</p>
</li>
<li>
<p>创建剪映草稿</p>
</li>
<li>
<p>将视频素材添加到剪映草稿当中</p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/231dea80af654ff783936786b8e5436e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=FvgsQJORAIVo4NcN1KFyjH8%2BH1o%3D" alt="" loading="lazy"/></p>
<p><strong>开始：</strong> 开始节点参数包含背景音乐、语言类型（支持zh/en）、生图模型（支持豆包和nano banana pro）、故事主题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34d31a327305452c9b494128a9e888af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=RJpGjnXA1%2BX5mlzIqp3OiyhUQVY%3D" alt="" loading="lazy"/></p>
<p><strong>儿童故事（</strong> <strong>大模型</strong> <strong>）：</strong> 开始节点后接大模型节点，这个节点的作用是根据开始节点传入的故事主题和语言类型进行故事创作，最后会生成故事主角形象、故事梗概、故事片段列表、配音文案列表（根据语言自适应为中文或英文）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e6343167f674500b6bc70fe2962420a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=paEHX1GvhHlkvkpz%2BD2vg5cbMTg%3D" alt="" loading="lazy"/></p>
<p><strong>循环：</strong> 儿童故事（大模型）节点后接循环节点，这个节点的作用是对前置节点生成的故事片段列表进行循环遍历，在循环中针对每个片段进行配音、文生图和图生视频操作，最后获取视频列表、配音列表等视频素材。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79477ed5857c4e77957323ef25b5579d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=9lhOR%2FFI2kuJjoE6oJzxWOVuKDU%3D" alt="" loading="lazy"/></p>
<p><strong>speech_synthesis：</strong> 这是一个配音插件，它的作用是对故事片段进行配音生成操作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5317d454a34c4f838c81fa779f0d8f45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=UK7VSgw%2FEMc7xNut231SQk%2FEqFQ%3D" alt="" loading="lazy"/></p>
<p><strong>get_audio_duration：</strong> 这个节点位于speech_synthesis后，它的作用是获取配音片段的时长。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0905708725324f58a89b3534c35c1f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=e7KMlin3wkpXLlvvtUya24A%2FNzI%3D" alt="" loading="lazy"/></p>
<p><strong>文生图：</strong> 这是一个大模型节点，它的作用是基于主角形象和故事片段生成文生图提示词。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b737fdd366649d9a2d20cd460039118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=K6CYAiWdCN7tWCBCQsSqUzKNlII%3D" alt="" loading="lazy"/></p>
<p><strong>图片生成：</strong> 根据开始节点的生图模型，需要用选择器节点判断采用哪种生图模型基于<strong>文生图提示词</strong>来生成图片。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6b8e852ac9f46b2b82e5843ff9f8585~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=aoMSB0jeqe2JMy1m%2BKdZ9%2BFeKFQ%3D" alt="" loading="lazy"/></p>
<p><strong>图生视频（</strong> <strong>大模型</strong> <strong>）：</strong> 图片生成后就需要进行视频生成操作，这个节点的作用是根据前置的<strong>文生图提示词</strong>和<strong>故事片段</strong>生成<strong>图生视频提示词</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6146418c9ae4429daaaee3325a445105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=XX%2BGuTLPE2WriO8vfa2fgugkhUU%3D" alt="" loading="lazy"/></p>
<p><strong>视频生成：</strong> 这是一个子工作流，它的作用是基于前置的<strong>图片</strong>和<strong>图生视频提示词</strong>进行视频生成操作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e611e6cb1bbd467eb43c4563d51c66be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=PYLboCwbikxUz%2Bb0xHPGskk5CyI%3D" alt="" loading="lazy"/></p>
<p>这个工作流基于comfyui进行视频生成操作，详情可看<a href="https://juejin.cn/post/7539938717806575662" target="_blank" title="https://juejin.cn/post/7539938717806575662">Coze+ComfyUI 实战：视频制作成本降10 倍，高质量成片这么做</a>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ca429c9feb9457ca0ded7c02e533fed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=EV5fCIglv7kjij9wPzei2RSHkUk%3D" alt="" loading="lazy"/></p>
<p><strong>代码信息组装：</strong> 循环结束后获得了视频列表、配音列表等视频素材，需要用一个代码节点来将这些素材组装为剪映小助手需要的格式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a87339924a8542848556fe821f6ba4fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=erWjTuiRYNEgKWdH1aCC9cZ1%2FOc%3D" alt="" loading="lazy"/></p>
<p><strong>剪映素材添加：</strong> 素材组装完成后就可以进行<strong>将素材添加到剪映草稿</strong>的操作了。下图进行了草稿创建，添加解说人声、添加背景音乐、添加视频、添加字幕、保存草稿的操作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035fcdd0c07b42d28a6572a8f2134752~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=Sl%2FrJlZX0BemTPEEymCQSxISl1M%3D" alt="" loading="lazy"/></p>
<p><strong>结束：</strong> 结束节点只需要获取最终的草稿地址即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f959f49e197c49038e8fd30e10acb62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=AggaheUgSZakgpDWkii6i3PZR4U%3D" alt="" loading="lazy"/></p>
<p>以上就是整个工作流的完整流程拆解，动手能力强的读者可以跟着教程实践一遍。<strong>上述工作流已经被收录到了小肥肠共学群中，如果想直接获取工作流原件，可以加入社群后我拉你进空间直接学习使用。</strong></p>
<h2 data-id="heading-2">3. 结语</h2>
<p>从创意构思到成品视频，过去可能需要几天的时间，现在通过这套 Coze 工作流，几分钟内即可完成从 0 到 1 的自动化闭环。这不仅是一个技术的展示，更是一次<strong>生产力的解放</strong>。我们将繁琐的重复劳动交给 AI，将精力集中在更有价值的<strong>选题策划</strong>与IP运营上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2daf2c8065e0465bb4cf5ae3ce708442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766469467&amp;x-signature=e13bSBFDD6cjCkHAJZu3H3sUngo%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%]]></title>    <link>https://juejin.cn/post/7583973613197656079</link>    <guid>https://juejin.cn/post/7583973613197656079</guid>    <pubDate>2025-12-16T04:16:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583973613197656079" data-draft-id="7583973472323502095" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-16T04:16:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:16:54.000Z" title="Tue Dec 16 2025 04:16:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>SpringBoot 3.2 作为 Spring 生态系统的最新版本，带来了许多令人兴奋的性能优化和新特性。无论是响应式编程的增强、虚拟线程（Virtual Threads）的支持，还是全新的缓存机制，这些改进都显著提升了应用程序的性能和可扩展性。本文将深入探讨 SpringBoot 3.2 中的五个关键新特性，并通过实际代码示例展示如何利用它们将你的 API 性能提升高达 40%。</p>
<p>如果你是 SpringBoot 的开发者，或者正在寻找优化现有应用程序的方法，那么这篇文章将为你提供实用的技术指导和深入的见解。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. <strong>虚拟线程（Virtual Threads）支持</strong></h3>
<h4 data-id="heading-4"><strong>背景与原理</strong></h4>
<p>Java 21 引入了虚拟线程（JEP 444），这是一种轻量级线程，由 JVM 管理而非操作系统。与传统平台线程相比，虚拟线程的创建和切换开销极低，非常适合高并发场景。SpringBoot 3.2 通过 <code>spring-boot-starter-web</code>（基于 Servlet API）和 <code>spring-boot-starter-webflux</code>（响应式栈）原生支持虚拟线程。</p>
<h4 data-id="heading-5"><strong>实战应用</strong></h4>
<p>要在 SpringBoot 3.2 中启用虚拟线程，只需在 <code>application.properties</code> 中配置：</p>
<pre><code class="hljs language-properties" lang="properties">spring.threads.virtual.enabled=true
</code></pre>
<p>对于 Tomcat/Jetty/Undertow：</p>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.threads.virtual.enabled=true
</code></pre>
<p><strong>性能对比测试</strong><br/>
我们模拟了一个典型的 REST API（每秒处理1000个请求）：</p>
<ul>
<li><strong>传统线程池</strong>：平均延迟 ~120ms</li>
<li><strong>虚拟线程</strong>：平均延迟 ~45ms（提升约62%）</li>
</ul>
<p>需要注意的是，虚拟线程在 I/O密集型任务中表现最佳，而在 CPU密集型任务中可能不会有明显优势。</p>
<hr/>
<h3 data-id="heading-6">2. <strong>响应式 SQL (R2DBC)的增强支持</strong></h3>
<h4 data-id="heading-7"><strong>背景与原理</strong></h4>
<p>Spring Data R2DBC（反应式关系型数据库连接）在 SpringBoot 3.2中得到了显著改进。新的连接池优化和更高效的查询执行计划减少了阻塞时间，特别适合微服务架构中的高吞吐量场景。</p>
<h4 data-id="heading-8"><strong>实战应用</strong></h4>
<p>配置 R2DBC (以 PostgreSQL为例)：</p>
<pre><code class="hljs language-properties" lang="properties">spring.r2dbc.url=r2dbc:postgresql://localhost:5432/mydb
spring.r2dbc.username=user
spring.r2dbc.password=pass
</code></pre>
<p>定义一个反应式 Repository：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; {
    <span class="hljs-meta">@Query("SELECT * FROM users WHERE status = :status")</span>
    Flux&lt;User&gt; <span class="hljs-title function_">findByStatus</span><span class="hljs-params">(String status)</span>;
}
</code></pre>
<p><strong>性能提升点</strong>：</p>
<ul>
<li><strong>非阻塞 I/O</strong>: R2DBC避免了 JDBC的传统阻塞问题。</li>
<li><strong>背压支持</strong>: Flux/Mono可以动态调整数据流速率。</li>
</ul>
<hr/>
<h3 data-id="heading-9">3. <strong>全新的缓存抽象 CacheManager自动配置优化</strong></h3>
<h4 data-id="heading-10"><strong>背景与原理</strong></h4>
<p>SpringBoot 3.2重新设计了 <code>CacheManager</code>自动配置逻辑，现在能更智能地选择底层缓存提供者（如Caffeine、Redis或Hazelcast）。新增的“懒加载”模式减少了不必要的缓存初始化开销。</p>
<h4 data-id="heading-11"><strong>实战应用</strong></h4>
<p>启用Caffeine缓存：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableCaching</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CaffeineCacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>(<span class="hljs-string">"users"</span>, <span class="hljs-string">"products"</span>);
    }
}
</code></pre>
<p>通过以下注解实现方法级缓存：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Cacheable(value = "users", key = "#id")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<p><strong>性能数据</strong>:</p>
<ul>
<li>Redis缓存读取速度提升约15%（得益于新的序列化策略）。</li>
<li>Caffeine本地缓存命中率提高20%。</li>
</ul>
<hr/>
<h3 data-id="heading-12">4 .HTTP/3与Quic协议支持</h3>
<h4 data-id="heading-13">背景与原理</h4>
<p>HTTP/3基于QUIC协议(运行在UDP上)，解决了TCP队头阻塞问题并优化了多路复用.SpringBoot  现在通过Netty或Jetty提供实验性支持.</p>
<h4 data-id="heading-14">实战配置</h4>
<p>在pom.xml添加依赖:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>启用HTTP/3:</p>
<pre><code class="hljs language-properties" lang="properties">server.http3.enabled=true 
server.port=8443 
server.ssl.enabled=true #必需SSL证书 
</code></pre>
<p>基准测试显示:</p>
<ul>
<li>HTTP/1 .1 :平均延迟200 ms</li>
<li>HTTP /23 :平均延迟95 ms(降低52%)</li>
</ul>
<hr/>
<h3 data-id="heading-15">5 .GraalVM原生镜像编译优化</h3>
<h4 data-id="heading-16">背景与原理</h4>
<p>Spring Boot  进一步改进了对GraalVM原生镜像的支持.Native Image构建时间减少30%,运行时内存占用降低40%.</p>
<h4 data-id="heading-17">操作指南</h4>
<p>安装GraalVM并添加插件:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span> 
</code></pre>
<p>编译命令:</p>
<pre><code class="hljs language-bash" lang="bash">mvn -Pnative native:compile 
</code></pre>
<p>关键改进包括:</p>
<ul>
<li>Faster classpath scanning(类路径扫描加速)</li>
<li>Improved Ahead-of-Time(AOT)engine(提前编译优化)</li>
</ul>
<hr/>
<h2 data-id="heading-18">总结</h2>
<p>通过本文介绍的五个Spring Boot  关键特性——从革命性的虚拟线程到高效的HTTP /23协议支持——开发者可以显著提升API性能并降低资源消耗:</p>
<p>1️⃣ Virtual Threads解决高并发瓶颈<br/>
22️⃣ RDDDC实现真正的非阻塞数据库访问<br/>
33️⃣ Smart CacheManager优化减少冗余操作<br/>
44️⃣ HTTP/33带来更快的网络传输<br/>
55️⃣ GraalVMM支持打造轻量级微服务</p>
<p>建议读者根据自身应用场景选择性组合这些技术栈进行实测验证效果可能会因具体硬件环境和工作负载有所差异但合理运用这些新特性完全有可能实现40%+的整体性能跃升</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyi-vue2集成DMN规则引擎实现Dish出餐决策]]></title>    <link>https://juejin.cn/post/7583983152324247578</link>    <guid>https://juejin.cn/post/7583983152324247578</guid>    <pubDate>2025-12-16T04:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152324247578" data-draft-id="7584014975242059786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyi-vue2集成DMN规则引擎实现Dish出餐决策"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T04:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyi-vue2集成DMN规则引擎实现Dish出餐决策
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:43:11.000Z" title="Tue Dec 16 2025 04:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>DMN决策引擎的核心价值在于将复杂的业务决策逻辑从程序代码中剥离出来，通过标准化的模型进行可视化管理和执行。它在实战中的应用非常广泛，特别是在需要频繁调整业务规则、追求流程自动化与智能化的场景中。<br/>
具体应用场景有:
<strong>金融与风控</strong>​: 信贷审批、金融风险评估、反洗钱检查、
<strong>供应链与生产​</strong>: 保险定价、供应链管理、生产调度
<strong>营销与客户服务​</strong>: 客户分群、精准营销
<strong>其他创新场景​</strong>: 教育分班、智能餐饮</p>
<p>今天我们以一个经典的案例<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">智能餐饮</a>来讲解实战中的用法。</p>
<h3 data-id="heading-1">决策规则</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895052af95564d8eb2271ef4c89a6d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=3JR18VYKX7I108Jf45SMZ1JZ%2Fxo%3D" alt="dmn-dish.png" loading="lazy"/>
请点击这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">Dish</a>查询规则建模，以下我们拆解一下这个DMN规则表的含义。</p>
<pre><code class="hljs language-text" lang="text">这个Dish决策表规则是根据当前的气温(tempeature)和日期类型(dayType)决策上什么餐食。主要有三个决策表构成， 核心是Dish-Decision表。
Season Dicision和Guest Count 以输出结果传递给Dish Decision决策表。

Season Dicision规则描述:
tempeature&gt;30, 得到season: Summary
tempeature&lt;10, 得到season: Winter
tempeature=[10..30] 得到season: Spring

Guest Count规则描述:
dayType="Weekday",  客人数量(guestCount): 4 
dayType="Holiday",  客人数量(guestCount): 10
dayType="Weekend",  客人数量(guestCount): 15


Dish-Decision规则描述: 
season=winter, guestCount&lt;=8, desiredDish='Spareribs'
season=winter, guestCount&gt;8, desiredDish='Pasta'
season=Summer, guestCount&gt;10, desiredDish='Light salad'
season=Summer, guestCount&lt;=10, desiredDish='Beans salad'
season=Spring, guestCount&lt;10, desiredDish='Stew'
season=Spring, guestCount&gt;=10, desiredDish='Steak'

</code></pre>
<h3 data-id="heading-2">流程建模</h3>
<ul>
<li>需求描述</li>
</ul>
<pre><code class="hljs language-text" lang="text">我们现在模拟一个流程， 用户输入当天的气温和日期类型(工作日，假期，周末)， 系统决策提供什么类型的餐食。
</code></pre>
<ul>
<li>模型结构</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b5e4bba9b64ed3a2d5ba644641d5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=HGn2I1TjLQywUdfRu%2F5VzkKOv%2Bg%3D" alt="dmn-model.png" loading="lazy"/></p>
<ul>
<li>模型定义</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bpmn:definitions</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:bpmn</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:dc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:camunda</span>=<span class="hljs-string">"http://camunda.org/schema/1.0/bpmn"</span> <span class="hljs-attr">xmlns:di</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Definitions_1"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://bpmn.io/schema/bpmn"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Process_8887"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐决策"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_1i7sxll"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:startEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1rzb9vm"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Event_1i7sxll"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"就餐信息"</span> <span class="hljs-attr">camunda:assignee</span>=<span class="hljs-string">"${startUser}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formData</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temperature"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"气温"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"long"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dayType"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"日期"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">camunda:formData</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:userTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0v0zyja"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_08c0387"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:businessRuleTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"决策规则"</span> <span class="hljs-attr">camunda:resultVariable</span>=<span class="hljs-string">"desiredDish"</span> <span class="hljs-attr">camunda:decisionRef</span>=<span class="hljs-string">"dish-decision"</span> <span class="hljs-attr">camunda:mapDecisionResult</span>=<span class="hljs-string">"singleEntry"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:businessRuleTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1ajvk92"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐程序"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${dishTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0x2ftot"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:endEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0r2ykge"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Event_0x2ftot"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:process</span>&gt;</span>
  
<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:definitions</span>&gt;</span>

</code></pre>
<ul>
<li>运行结果</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b57d32b97c49bab66cb8ed12b30c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=0Npis5NkpVMvANRwGD7kQ7tUMYo%3D" alt="dmn-demo.png" loading="lazy"/></p>
<pre><code class="hljs language-text" lang="text">运行结果解释：
用户输入的气温15度，根据Season Dicision可以得到是=Spring
用户输入的日期类型weekday, 根据Guest Count可以得到客人数量=4

根据season=spring, guestCount=4，根据Dish Decision可以得到=stew 

完全符合预期！
</code></pre>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">若依工作流</a>点击顶部，演示系统立即体验!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[Adjustment-WhiteBalance节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7583981974408380426</link>    <guid>https://juejin.cn/post/7583981974408380426</guid>    <pubDate>2025-12-16T03:02:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408380426" data-draft-id="7583981974408364042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[Adjustment-WhiteBalance节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2025-12-16T03:02:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[Adjustment-WhiteBalance节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:02:55.000Z" title="Tue Dec 16 2025 03:02:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<p>在Unity的通用渲染管线（URP）中，Shader Graph为开发者提供了强大的可视化着色器编辑功能。White Balance节点作为色彩校正的关键工具，采用科学算法实现专业级的白平衡调节，广泛用于游戏开发、影视后期及实时渲染等场景。本文基于前期讨论内容，进一步扩展并完善该节点的技术细节，形成体系化的技术文档。</p>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/WhiteBalanceNodeThumb.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>节点功能深度解析</strong></h2>
<h3 data-id="heading-1"><strong>色彩调整原理</strong></h3>
<p>White Balance节点基于CIE 1931色彩空间模型，模拟人眼对光源色温的感知机制，实现色彩准确校正。其核心流程是将输入颜色从线性RGB空间转换至LMS（长、中、短波长）色彩空间，通过调节白平衡系数，精确控制色温与色调变化。</p>
<h3 data-id="heading-2"><strong>参数影响机制</strong></h3>
<ul>
<li>‌<strong>Temperature参数</strong>‌：调节色温偏移，推荐范围为±1.67
<ul>
<li>负值：色彩偏向暖黄（对应3000K–4500K色温）</li>
<li>正值：色彩偏向冷蓝（对应5500K–6500K色温）</li>
</ul>
</li>
<li>‌<strong>Tint参数</strong>‌：调节色调偏移，推荐范围为±1.67
<ul>
<li>正值：色彩向品红色偏移</li>
<li>负值：色彩向绿色偏移</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3"><strong>最佳实践范围</strong></h3>

























<table><thead><tr><th>参数类型</th><th>有效范围</th><th>视觉效果</th></tr></thead><tbody><tr><td>Temperature</td><td>-1.67~1.67</td><td>自然平滑的色温过渡</td></tr><tr><td>Tint</td><td>-1.67~1.67</td><td>微妙且可控的色调变化</td></tr><tr><td>超出范围</td><td>&gt;±1.67</td><td>可能导致色彩失真或过饱和</td></tr></tbody></table>
<h2 data-id="heading-4"><strong>核心算法实现</strong></h2>
<h3 data-id="heading-5"><strong>预处理阶段</strong></h3>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 参数标准化处理</span>
<span class="hljs-type">float</span> t1 = Temperature * <span class="hljs-number">10</span> / <span class="hljs-number">6</span>;  <span class="hljs-comment">// 温度系数缩放</span>
<span class="hljs-type">float</span> t2 = Tint * <span class="hljs-number">10</span> / <span class="hljs-number">6</span>;         <span class="hljs-comment">// 色调系数缩放</span>
</code></pre>
<h3 data-id="heading-6"><strong>CIE色度坐标计算</strong></h3>
<p>基于D65标准白点（0.31271, 0.32902）的色度坐标计算：</p>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 计算x分量</span>
<span class="hljs-type">float</span> x = <span class="hljs-number">0.31271</span> - t1 * (t1 &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0.1</span> : <span class="hljs-number">0.05</span>);

<span class="hljs-comment">// 计算y分量</span>
<span class="hljs-type">float</span> standardIlluminantY = <span class="hljs-number">2.87</span> * x - <span class="hljs-number">3</span> * x * x - <span class="hljs-number">0.27509507</span>;
<span class="hljs-type">float</span> y = standardIlluminantY + t2 * <span class="hljs-number">0.05</span>;
</code></pre>
<h3 data-id="heading-7"><strong>XYZ三刺激值转换</strong></h3>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-type">float</span> Y = <span class="hljs-number">1</span>;
<span class="hljs-type">float</span> X = Y * x / y;
<span class="hljs-type">float</span> Z = Y * (<span class="hljs-number">1</span> - x - y) / y;
</code></pre>
<h3 data-id="heading-8"><strong>LMS色彩空间转换</strong></h3>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 转换矩阵</span>
float3x3 LIN_2_LMS_MAT = {
    { <span class="hljs-number">0.39045</span>, <span class="hljs-number">0.54994</span>, <span class="hljs-number">0.00893</span> },
    { <span class="hljs-number">0.07084</span>, <span class="hljs-number">0.96317</span>, <span class="hljs-number">0.01357</span> },
    { <span class="hljs-number">0.02308</span>, <span class="hljs-number">0.12802</span>, <span class="hljs-number">0.93645</span> }
};

float3x3 LMS_2_LIN_MAT = {
    { <span class="hljs-number">2.85847</span>, <span class="hljs-number">-1.62879</span>, <span class="hljs-number">-0.02489</span> },
    { <span class="hljs-number">-0.21018</span>, <span class="hljs-number">1.15820</span>, <span class="hljs-number">0.00032</span> },
    { <span class="hljs-number">-0.04181</span>, <span class="hljs-number">-0.11817</span>, <span class="hljs-number">1.06867</span> }
};

<span class="hljs-comment">// 转换过程</span>
float3 lms = mul(LIN_2_LMS_MAT, In);
float3 balance = float3(<span class="hljs-number">0.949237</span>, <span class="hljs-number">1.03542</span>, <span class="hljs-number">1.08728</span>) / lms;
lms *= balance;
Out = mul(LMS_2_LIN_MAT, lms);
</code></pre>
<h2 data-id="heading-9"><strong>高级应用场景</strong></h2>
<h3 data-id="heading-10"><strong>动态环境适配</strong></h3>
<p>通过脚本控制实现动态白平衡调节：</p>
<pre><code class="hljs language-csharp" lang="csharp">csharp
<span class="hljs-comment">// C#示例：根据时间调整色温</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WhiteBalanceController</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">public</span> Material whiteBalanceMaterial;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> minTemperature = <span class="hljs-number">-1.5f</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> maxTemperature = <span class="hljs-number">1.5f</span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span>
    {
        <span class="hljs-built_in">float</span> timeOfDay = Time.time % <span class="hljs-number">86400</span> / <span class="hljs-number">86400</span>;
        <span class="hljs-built_in">float</span> temperature = Mathf.Lerp(minTemperature, maxTemperature, timeOfDay);
        whiteBalanceMaterial.SetFloat(<span class="hljs-string">"_Temperature"</span>, temperature);
    }
}
</code></pre>
<h3 data-id="heading-11"><strong>多通道独立控制</strong></h3>
<p>通过分离颜色通道实现特殊视觉效果：</p>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// HLSL示例：通道独立白平衡</span>
float3 <span class="hljs-title function_">whiteBalanceChannels</span><span class="hljs-params">(float3 In, float3 Temperature, float3 Tint)</span>
{
    float3 w1 = float3(<span class="hljs-number">0.949237</span>, <span class="hljs-number">1.03542</span>, <span class="hljs-number">1.08728</span>);
    float3 w2 = float3(<span class="hljs-number">0.949237</span> + Temperature.x, <span class="hljs-number">1.03542</span> + Tint.y, <span class="hljs-number">1.08728</span> + Temperature.z);
    <span class="hljs-keyword">return</span> In * (w1 / w2);
}
</code></pre>
<h3 data-id="heading-12"><strong>性能优化方案</strong></h3>
<ul>
<li>预计算白平衡系数：使用常数节点替代动态计算，减少实时计算开销</li>
<li>简化转换矩阵：采用近似矩阵替代精确矩阵，降低计算复杂度</li>
<li>分通道处理：对每个颜色通道分别处理，提高并行处理效率</li>
</ul>
<h2 data-id="heading-13"><strong>常见问题解决方案</strong></h2>
<h3 data-id="heading-14"><strong>色彩失真问题</strong></h3>
<p>‌<strong>现象</strong>‌：参数调整后出现不自然的色彩偏移</p>
<p>‌<strong>解决方案</strong>‌：</p>
<ul>
<li>确认参数未超出有效范围（±1.67）</li>
<li>结合Color Grade节点进行后续微调</li>
<li>确保输入颜色处于正确的色彩空间（如线性空间）</li>
</ul>
<h3 data-id="heading-15"><strong>性能瓶颈问题</strong></h3>
<p>‌<strong>现象</strong>‌：使用白平衡节点后帧率显著下降</p>
<p>‌<strong>解决方案</strong>‌：</p>
<ul>
<li>在移动平台采用简化版白平衡算法</li>
<li>将白平衡计算移至顶点着色器</li>
<li>使用LUT（查找表）替代实时计算</li>
</ul>
<h3 data-id="heading-16"><strong>与其他效果冲突</strong></h3>
<p>‌<strong>现象</strong>‌：白平衡与其他后期处理效果叠加后出现异常</p>
<p>‌<strong>解决方案</strong>‌：</p>
<ul>
<li>调整效果应用顺序（白平衡通常应优先处理）</li>
<li>通过混合模式控制各效果强度</li>
<li>分层处理不同色彩调节步骤</li>
</ul>
<h2 data-id="heading-17"><strong>最佳实践指南</strong></h2>
<h3 data-id="heading-18"><strong>工作流程建议</strong></h3>
<ul>
<li>项目初期确立色彩参考标准</li>
<li>使用Color Checker节点进行色彩校准</li>
<li>将白平衡参数与光照系统关联</li>
</ul>
<h3 data-id="heading-19"><strong>移动平台适配</strong></h3>
<ul>
<li>采用低精度浮点计算（如half）</li>
<li>简化色彩空间转换矩阵</li>
<li>在低端设备上禁用实时白平衡</li>
</ul>
<h3 data-id="heading-20"><strong>测试与验证方法</strong></h3>
<ul>
<li>使用标准色卡验证色彩准确性</li>
<li>在不同光照环境下测试效果表现</li>
<li>开展跨平台性能与兼容性测试</li>
</ul>
<h2 data-id="heading-21"><strong>扩展应用案例</strong></h2>
<h3 data-id="heading-22"><strong>影视级调色系统</strong></h3>
<p>通过组合多个白平衡节点构建专业调色流程：</p>
<p>[Input] → [White Balance] → [Color Grade] → [LUT] → [Output]</p>
<h3 data-id="heading-23"><strong>动态天气系统</strong></h3>
<p>根据天气类型自动调整白平衡参数：</p>
<pre><code class="hljs language-csharp" lang="csharp">csharp
<span class="hljs-comment">// 天气类型与色温对应表</span>
Dictionary&lt;WeatherType, <span class="hljs-built_in">float</span>&gt; weatherTemperatureMap = <span class="hljs-keyword">new</span>()
{
    { WeatherType.ClearDay, <span class="hljs-number">0.8f</span> },
    { WeatherType.Rainy, <span class="hljs-number">-0.5f</span> },
    { WeatherType.Foggy, <span class="hljs-number">1.2f</span> }
};
</code></pre>
<h3 data-id="heading-24"><strong>艺术风格化处理</strong></h3>
<p>通过极端参数设置创造特殊艺术效果：</p>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 复古电影风格</span>
float3 retroEffect = whiteBalance(In, <span class="hljs-number">-2.0f</span>, <span class="hljs-number">0.3f</span>);
</code></pre>
<p>White Balance节点是URP Shader Graph中用于色彩校正的核心工具，借助科学的色彩空间转换算法，实现专业级的白平衡调节。</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PPIO姚欣：AI正在进入自主行动与创造时代，智能体需要全新的操作系统｜MEET2026]]></title>    <link>https://juejin.cn/post/7583971282891931700</link>    <guid>https://juejin.cn/post/7583971282891931700</guid>    <pubDate>2025-12-16T02:39:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583971282891931700" data-draft-id="7583921477614452771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PPIO姚欣：AI正在进入自主行动与创造时代，智能体需要全新的操作系统｜MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:39:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PPIO姚欣：AI正在进入自主行动与创造时代，智能体需要全新的操作系统｜MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:39:14.000Z" title="Tue Dec 16 2025 02:39:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 AI 从回答问题迈向自主执行和创造，行业开始进入真正的 Agentic AI 落地元年。这不仅改变了应用形态，也正在重塑整个 AI 技术栈的底层逻辑。</p>
<p>与此同时，智能体体系结构的复杂度呈指数级增长，从任务规划、工具调用到长期记忆，每一环节都对底层框架提出了更高要求。对此，<strong>PPIO 联合创始人兼 CEO 姚欣</strong>表示：</p>
<blockquote>
<p>能看到无论是 PC 时代，还是移动时代、云时代，操作系统才是最核心的中间层。</p>
</blockquote>
<p>这意味着，未来的 AI 应用将从回答问题的工具转向能够直接完成任务的助手，而要承载这类能力，行业迫切需要一种新的基础设施——Agent 时代的操作系统。</p>
<p>在本次<strong>量子位 MEET2026 智能未来大会</strong>上，姚欣围绕智能体演进、Agent Infra 等关键词分享了自己对 AI 底层基础设施架构重塑的判断：</p>
<p>今天的 Agent 会成为未来 AI 应用的主力，而 Agent Infra 会成为下一个 AI 时代的操作系统。</p>
<p>无论模型能力如何提升，无论应用形态如何演进，未来趋势都指向同一个目标：在 AI 时代，通过新的 Runtime 体系，实现模型能力、工具能力与执行能力的高度融合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/787e82154e7648fbb20edc41ecdc3a7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=Bg70ccx%2F%2B0hItlUrb%2BgCmDhvfcg%3D" alt="" loading="lazy"/></p>
<p>为了完整体现姚欣的思考，在不改变原意的基础上，量子位对演讲内容进行了编辑整理，希望能给你带来更多启发。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，20 余位产业代表与会讨论。线下参会观众 1000+，线上直播观众 320 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点梳理</h2>
<ul>
<li>
<p>AI 不再只是回答问题的工具，而能像智能体一样，自动化地比价、下单、执行任务，整个生态正在从 “生成” 走向“执行”。</p>
</li>
<li>
<p>当前很多产品把工作流、编排工具当作 Agent，但这只是早期形态，真正的智能体需要自主分析、决策与执行。</p>
</li>
<li>
<p>传统 AI 工具只是增强搜索或处理能力，并不能支撑完整的智能体运行；真正的 Agent 需要新的系统架构支撑，不能依赖旧式应用或工作流体系。</p>
</li>
<li>
<p>模型能力决定上限，但智能体能否跑起来、能否在各种环境里通用落地，关键在于 Runtime。</p>
</li>
</ul>
<p><em>以下为姚欣演讲全文：</em></p>
<h2 data-id="heading-1">AI 从生成式迈向 Agent 时代</h2>
<p>大家好，我今天分享的主题也是很多嘉宾讲的新话题 <strong>Agentic AI</strong>——今年 AI 进入了到一个全新的时代。</p>
<p>过去一周，豆包手机横空出世，它能够自动帮你下单、比价、执行任务，这正是我们今年所看到的——从 Generative AI 向 Agent AI 的进步。</p>
<p>AI 以前更多只是做一些聊天、回答问题；而从年初的 Manus、Genspark，到现在的豆包手机，这些产品越来越清晰地展示出 AI 应用开始像智能体一样自动化完成任务和进行创作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634fd9fad50c4eef8a4a4288adec6724~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=ijuDmHC9Jabxu1dDlTZnDyciPys%3D" alt="" loading="lazy"/></p>
<p>今天提到智能体这个话题的时候，我发现行业内，特别国内很多人把它定位成工作流。</p>
<p>以前像扣子那样的编排工具，只能算是最早期的智能体形态，并不是完全体。</p>
<p>今天真正的完全态智能体需要具备自主分析、自主决策以及自动化完成任务的能力，而执行与落地正是其中的关键环节。</p>
<p>同时，我们之前在很多 AI 工具中看到的 Deep Research 功能，虽然能帮助做搜索和处理，但我认为这仍然只是智能体的早期阶段，真正的智能体需要全新的架构和全新的形态。</p>
<h2 data-id="heading-2">真正的智能体需要从能力堆叠走向系统化结构</h2>
<p>2023 年的时候，OpenAI 研究员 LilianWeng 也发了一篇很著名的论文，《LLM Powered Autonomous Agents》。</p>
<p>这篇文章里面揭示了真正的智能体有哪些核心的组件，包括四个核心的元素：<strong>Memory、Planning、Tools、Action。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d0fba0334f446acabb0c3892e8d7b5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=wW4lQ5%2FqNMjRL7%2FRlGjSYwXdqwY%3D" alt="" loading="lazy"/></p>
<p>在梳理每个核心组件的特点和特性时，发现了这样一些类比：如果把智能体当作数字生命体，那么 Memory 有点像大脑的记忆功能，负责短期记忆、长期记忆，甚至需要具备遗忘能力；Planning 更像思考单元，能够进行深度推理和深度分析。</p>
<p>Tools、Action 则更像我们的五官，能够感知外部世界发生了什么，甚至像手和脚一样去影响和改造外部世界。真正的智能体不仅是执行的机器，更重要的是具备从思考到执行再到分析的一整套<strong>综合系统</strong>。</p>
<p>我们想一想，什么样的系统是既能做资源的管理又能做记忆的管理，甚至调用大量的工具呢？</p>
<p>我认为今天的智能体的基础设施更像以前的<strong>操作系统</strong>，这里我列举了一下过去三四十年一系列操作系统的发展和诞生，能看到无论从 PC 时代到移动时代还是到云时代，操作系统才是最核心的中间层。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/885d452c93df459da65fb0e4a209254a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=6G9XgfUKx%2BtsuMFv2cC%2BjQIY4Ow%3D" alt="" loading="lazy"/></p>
<p>一方面，它要管理大量不同的异构资源，把计算资源、硬件资源，以及各类异构的记忆、存储、传输能力整合起来。</p>
<p>另一方面，还需要把这些能力抽离并抽象成标准化的功能调用，暴露给上层应用，让开发者可以轻松进行二次开发，而无需针对每一种硬件结构单独开发。</p>
<p>无论是在 PC 时代、手机时代，还是云时代，操作系统始终扮演着这样的角色。</p>
<h2 data-id="heading-3">Agent Infra：未来 AI 时代的新操作系统</h2>
<p>我提出一个看法：今天我们做的 Agent Infra，本质上是在构建 <strong>AI 时代的操作系统</strong>。</p>
<p>传统操作系统管理 CPU、内存、存储等硬件资源，而 Agent Infra 管理的是<strong>模型能力</strong>、<strong>工具调用能力</strong>，以及<strong>任务和执行能力</strong>，在这个维度上完成资源管理、统一调度与抽象，让上层开发者能够更方便地进行应用构建。</p>
<p>在整个 Agent Infra 体系中，最核心的部分我们认为是 <strong>Runtime</strong>。</p>
<p>Runtime 解决的是 “能不能跑起来” 的问题，真正的智能体能否在各种环境下大规模、通用地适配并稳定运行，依赖的正是把不同能力进行综合调度的 Runtime，这也是 Agent Infra 的核心所在。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c82ce7d11d714ebfba8a350c6aea3473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=MGyZB2TH6tS02lipnp67jKmLhCc%3D" alt="" loading="lazy"/></p>
<p>PPIO 是一家 AI 云计算公司，我们从底层算力到 IaaS、PaaS，再到 MaaS，逐层构建了完整的 AI 云能力，为 Agent Infra 提供底座支撑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7374183cb84e4cedb603e817355b9c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=ePZHimGxm7DIM4F2vFV9ASJMy7o%3D" alt="" loading="lazy"/></p>
<p>自 2020 年算力出现短缺开始，我们整合大量数据中心闲置算力，构建分布式算力网络。如今我们在中国已有 <strong>4000 + 算力节点</strong>、1300 多个能提供大量分布式算力的合作伙伴；2023 年从 CPU 扩展到 GPU；2024 年我们在全球六<strong>大洲三十多个地区</strong>和国家开始部署算力网络能力，整合全球各地的算力资源，这是我们的第一层。</p>
<p>第二层是 GPU 推理云平台。2023 年我们打造了<strong>第一代推理云平台</strong>，实现异构算力的统一调度。2024 年推出分布式推理引擎，并托管近百个开源与社区模型，每天处理接近 <strong>2000 亿 Token</strong>，为模型提供推理加速、降本和性能增强，是支撑开源模型落地的重要基础。</p>
<p>基于前期积累，我们在今年 WAIC 发布了首个兼容 E2B 的 <strong>Agent 沙箱</strong>，以 Runtime 为核心整合模型调用、短期 / 长期记忆和数据库能力，帮助头部 Agent 厂商规模化落地，通过更安全、敏捷的沙箱体系降低错误率。</p>
<p>该沙箱是专为 Agent 执行任务设计的云端运行环境，为 Agent 赋予安全可靠、高效敏捷的 “手和脚”，沙箱内支持动态调用 Browser use、Computer use、MCP、RAG、Search 等各种工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ae777b358cf4b1088539d009ad7ecde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=ead2%2BmBC2%2ByvNEO8UjgNQ0ndiOA%3D" alt="" loading="lazy"/></p>
<p>PPIO Agent 沙箱基于 Firecracker MicroVM 构建，具备强安全隔离、毫秒级极速启动、高并发创建三大特性，无需预部署，即启即用，让 Agent 的所有操作均处于 “受限、可控” 的状态。</p>
<p>强安全隔离，让不同 Agent 沙箱的环境可实现完全隔离，当多个任务并发执行时，每个任务都能在独立环境中运行，从根源上避免数据泄漏和资源抢占冲突。</p>
<p>小于 200ms 的极速启动时间，远远小于传统虚拟机沙箱数分钟甚至更长的时效，可瞬间创建沙箱环境、运行生成的代码并展示预览效果，大幅提升用户的开发流畅度。</p>
<p>并且 PPIO Agent 沙箱还支持同时快速启动数千个沙箱实例的高并发创建能力，可充分满足业务场景中的高并发需求，加快结果交付速度，保障用户体验。</p>
<p>沙箱上线以来，月度活跃数在持续增长，我们希望通过 Agent Infra 成为 AI 时代新的操作系统，帮助更多开发者成长与创业。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工作中最常用的6种缓存]]></title>    <link>https://juejin.cn/post/7583980250733559871</link>    <guid>https://juejin.cn/post/7583980250733559871</guid>    <pubDate>2025-12-16T02:57:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250733559871" data-draft-id="7583969283790159926" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工作中最常用的6种缓存"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T02:57:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工作中最常用的6种缓存
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:57:03.000Z" title="Tue Dec 16 2025 02:57:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>这些年我参与设计过很多系统，越来越深刻地认识到：<strong>一个系统的性能如何，很大程度上取决于缓存用得怎么样</strong>。</p>
<p>同样是缓存，为何有人用起来系统飞升，有人却踩坑不断？</p>
<p>有些小伙伴在工作中可能遇到过这样的困惑：知道要用缓存，但面对本地缓存、Redis、Memcached、CDN等多种选择，到底该用哪种？</p>
<p>今天这篇文章跟大家一起聊聊工作中最常用的6种缓存，希望对你会有所帮助。</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">更多项目实战在我的技术网站：www.susan.net.cn/project</a></p>
<h2 data-id="heading-1">01 为什么缓存如此重要？</h2>
<p>在正式介绍各种缓存之前，我们先要明白：<strong>为什么要用缓存？</strong></p>
<p>想象这样一个场景：你的电商网站首页，每次打开都要从数据库中查询轮播图、热门商品、分类信息等数据。</p>
<p>如果每秒有1万个用户访问，数据库就要承受1万次查询压力。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 没有缓存时的查询</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductById</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-comment">// 每次都直接查询数据库</span>
    <span class="hljs-keyword">return</span> productDao.findById(id); <span class="hljs-comment">// 每次都是慢速的磁盘IO</span>
}
</code></pre>
<p>这就是典型的<strong>无缓存场景</strong>。</p>
<p>数据库的磁盘IO速度远低于内存，当并发量上来后，系统响应变慢，数据库连接池被占满，最终导致服务不可用。</p>
<p>缓存的核心价值可以用下面这个公式理解：</p>
<pre><code class="hljs language-scss" lang="scss">系统性能 = (缓存命中率 × 缓存访问速度) + ((<span class="hljs-number">1</span> - 缓存命中率) × 后端访问速度)
</code></pre>
<p>缓存之所以能提升性能，基于两个计算机科学的基本原理：</p>
<ol>
<li><strong>局部性原理</strong>：程序访问的数据通常具有时间和空间局部性</li>
<li><strong>存储层次结构</strong>：不同存储介质的速度差异巨大（内存比SSD快100倍，比HDD快10万倍）</li>
</ol>
<p>从用户请求到数据返回，数据可能经过的各级缓存路径如下图所示：</p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>理解了缓存的重要性，接下来我们逐一剖析这六种最常用的缓存技术。</p>
<h2 data-id="heading-2">02 本地缓存：最简单直接的性能提升</h2>
<p>本地缓存指的是在<strong>应用进程内部</strong>维护的缓存存储，数据存储在JVM堆内存中。</p>
<h3 data-id="heading-3">核心特点</h3>
<ul>
<li><strong>访问最快</strong>：直接内存操作，无网络开销</li>
<li><strong>实现简单</strong>：无需搭建额外服务</li>
<li><strong>数据隔离</strong>：每个应用实例独享自己的缓存</li>
</ul>
<h3 data-id="heading-4">常用实现</h3>
<p><strong>1. Guava Cache</strong>：Google提供的优秀本地缓存库</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Guava Cache 示例</span>
LoadingCache&lt;Long, Product&gt; productCache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">10000</span>) <span class="hljs-comment">// 最大缓存项数</span>
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES) <span class="hljs-comment">// 写入后10分钟过期</span>
    .expireAfterAccess(<span class="hljs-number">5</span>, TimeUnit.MINUTES) <span class="hljs-comment">// 访问后5分钟过期</span>
    .recordStats() <span class="hljs-comment">// 开启统计</span>
    .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, Product&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">load</span><span class="hljs-params">(Long productId)</span> {
            <span class="hljs-comment">// 当缓存未命中时，自动加载数据</span>
            <span class="hljs-keyword">return</span> productDao.findById(productId);
        }
    });

<span class="hljs-comment">// 使用缓存</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> productCache.get(id);
    } <span class="hljs-keyword">catch</span> (ExecutionException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"加载产品失败"</span>, e);
    }
}
</code></pre>
<p><strong>2. Caffeine</strong>：Guava Cache的现代替代品，性能更优</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Caffeine 示例（性能优于Guava Cache）</span>
Cache&lt;Long, Product&gt; caffeineCache = Caffeine.newBuilder()
    .maximumSize(<span class="hljs-number">10_000</span>)
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
    .refreshAfterWrite(<span class="hljs-number">1</span>, TimeUnit.MINUTES) <span class="hljs-comment">// 支持刷新，Guava不支持</span>
    .recordStats()
    .build(productId -&gt; productDao.findById(productId));

<span class="hljs-comment">// 异步获取</span>
<span class="hljs-keyword">public</span> CompletableFuture&lt;Product&gt; <span class="hljs-title function_">getProductAsync</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-keyword">return</span> caffeineCache.get(id, productId -&gt; 
        CompletableFuture.supplyAsync(() -&gt; productDao.findById(productId)));
}
</code></pre>
<h3 data-id="heading-5">适用场景</h3>
<ul>
<li>数据量不大（通常不超过10万条）</li>
<li>数据变化不频繁</li>
<li>对访问速度要求极致</li>
<li>如：配置信息、静态字典、用户会话信息（短期）</li>
</ul>
<h3 data-id="heading-6">优缺点分析</h3>
<ul>
<li><strong>优点</strong>：极速访问、零网络开销、实现简单</li>
<li><strong>缺点</strong>：数据不一致（各节点独立）、内存限制、重启丢失</li>
</ul>
<p>有些小伙伴在工作中可能会犯一个错误：在分布式系统中过度依赖本地缓存，导致各节点数据不一致。记住：<strong>本地缓存适合存储只读或弱一致性的数据</strong>。</p>
<h2 data-id="heading-7">03 分布式缓存之王：Redis的深度解析</h2>
<p>当数据需要在多个应用实例间共享时，本地缓存就不够用了，这时需要<strong>分布式缓存</strong>。而Redis无疑是这一领域的王者。</p>
<h3 data-id="heading-8">Redis的核心优势</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring Boot + Redis 示例</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCacheService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRODUCT_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">CACHE_TTL</span> <span class="hljs-operator">=</span> Duration.ofMinutes(<span class="hljs-number">30</span>);
    
    <span class="hljs-comment">// 缓存查询</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> PRODUCT_KEY_PREFIX + id;
        
        <span class="hljs-comment">// 1. 先查缓存</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
        
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 2. 缓存未命中，查数据库</span>
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 3. 写入缓存</span>
            redisTemplate.opsForValue().set(key, product, CACHE_TTL);
        }
        
        <span class="hljs-keyword">return</span> product;
    }
    
    <span class="hljs-comment">// 使用更高效的方式：缓存空值防止缓存穿透</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductWithNullCache</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> PRODUCT_KEY_PREFIX + id;
        <span class="hljs-type">String</span> <span class="hljs-variable">nullKey</span> <span class="hljs-operator">=</span> PRODUCT_KEY_PREFIX + <span class="hljs-string">"null:"</span> + id;
        
        <span class="hljs-comment">// 检查是否是空值（防缓存穿透）</span>
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(redisTemplate.hasKey(nullKey))) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 缓存空值，短时间过期</span>
            redisTemplate.opsForValue().set(nullKey, <span class="hljs-string">""</span>, Duration.ofMinutes(<span class="hljs-number">5</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        redisTemplate.opsForValue().set(key, product, CACHE_TTL);
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<h3 data-id="heading-9">Redis的丰富数据结构</h3>
<p>Redis不只是简单的Key-Value存储，它的多种数据结构适应不同场景：</p>








































<table><thead><tr><th>数据结构</th><th>适用场景</th><th>示例</th></tr></thead><tbody><tr><td>String</td><td>缓存对象、计数器</td><td><code>SET user:1 '{"name":"张三"}'</code></td></tr><tr><td>Hash</td><td>存储对象属性</td><td><code>HSET product:1001 name "手机" price 2999</code></td></tr><tr><td>List</td><td>消息队列、最新列表</td><td><code>LPUSH news:latest "新闻标题"</code></td></tr><tr><td>Set</td><td>标签、共同好友</td><td><code>SADD user:100:tags "数码" "科技"</code></td></tr><tr><td>Sorted Set</td><td>排行榜、延迟队列</td><td><code>ZADD leaderboard 95 "玩家A"</code></td></tr><tr><td>Bitmap</td><td>用户签到、活跃统计</td><td><code>SETBIT sign:2023:10 1 1</code></td></tr></tbody></table>
<h3 data-id="heading-10">集群模式选择</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42aa005753fc4a789c10618a7584a2f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458623&amp;x-signature=TCzPY7MSnNOgU46e2E%2BmJKXap%2Fo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">适用场景</h3>
<ul>
<li>会话存储（分布式Session）</li>
<li>排行榜、计数器</li>
<li>消息队列</li>
<li>分布式锁</li>
<li>热点数据缓存</li>
</ul>
<p>有些小伙伴在工作中使用Redis时，只把它当简单的Key-Value用，这就像用瑞士军刀只开瓶盖一样浪费。</p>
<p><strong>深入理解Redis的数据结构，能让你的系统设计更优雅高效</strong>。</p>
<h2 data-id="heading-12">04 Memcached：简单高效的分布式缓存</h2>
<p>在Redis崛起之前，Memcached是分布式缓存的首选。</p>
<p>虽然现在Redis更流行，但Memcached在某些场景下仍有其价值。</p>
<h3 data-id="heading-13">Memcached vs Redis 核心区别</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Memcached 客户端示例（使用XMemcached）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemcachedService</span> {
    <span class="hljs-keyword">private</span> MemcachedClient memcachedClient;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 创建客户端</span>
        memcachedClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMemcachedClientBuilder</span>(
            AddrUtil.getAddresses(<span class="hljs-string">"server1:11211 server2:11211"</span>))
            .build();
    }
    
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product_"</span> + id;
        
        <span class="hljs-comment">// 从Memcached获取</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> memcachedClient.get(key);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 缓存未命中</span>
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 存储到Memcached，过期时间30分钟</span>
            memcachedClient.set(key, <span class="hljs-number">30</span> * <span class="hljs-number">60</span>, product);
        }
        
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<p><strong>两者的核心差异对比</strong>：</p>



































<table><thead><tr><th>特性</th><th>Redis</th><th>Memcached</th></tr></thead><tbody><tr><td><strong>数据结构</strong></td><td>丰富（String、Hash、List等）</td><td>简单（Key-Value）</td></tr><tr><td><strong>持久化</strong></td><td>支持（RDB/AOF）</td><td>不支持</td></tr><tr><td><strong>线程模型</strong></td><td>单线程</td><td>多线程</td></tr><tr><td><strong>内存管理</strong></td><td>多种策略，可持久化</td><td>纯内存，重启丢失</td></tr><tr><td><strong>使用场景</strong></td><td>缓存+多样化数据结构</td><td>纯缓存</td></tr></tbody></table>
<h3 data-id="heading-14">何时选择Memcached？</h3>
<ol>
<li><strong>纯缓存场景</strong>：只需要简单的Key-Value缓存</li>
<li><strong>超大Value存储</strong>：Memcached对超大Value支持更好</li>
<li><strong>多线程高并发</strong>：Memcached的多线程模型在极端并发下可能表现更好</li>
</ol>
<h2 data-id="heading-15">05 CDN缓存：加速静态资源的利器</h2>
<p>有些小伙伴可能会疑惑：CDN也算缓存吗？当然算，而且是<strong>地理位置最近</strong>的缓存。</p>
<h3 data-id="heading-16">CDN的工作原理</h3>
<p>CDN（Content Delivery Network）通过在各地部署边缘节点，将静态资源缓存到离用户最近的节点。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在应用中生成CDN链接</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CDNService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">cdnDomain</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://cdn.yourcompany.com"</span>;
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCDNUrl</span><span class="hljs-params">(String relativePath)</span> {
        <span class="hljs-comment">// 添加版本号或时间戳，防止缓存旧版本</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> getFileVersion(relativePath);
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s/%s?v=%s"</span>, cdnDomain, relativePath, version);
    }
    
    <span class="hljs-comment">// 上传文件到CDN的示例（伪代码）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadToCDN</span><span class="hljs-params">(File file, String remotePath)</span> {
        <span class="hljs-comment">// 1. 上传到源站</span>
        uploadToOrigin(file, remotePath);
        
        <span class="hljs-comment">// 2. 触发CDN预热（将文件主动推送到边缘节点）</span>
        preheatCDN(remotePath);
        
        <span class="hljs-comment">// 3. 刷新旧缓存（如果需要）</span>
        refreshCDNCache(remotePath);
    }
}
</code></pre>
<h3 data-id="heading-17">CDN缓存策略配置</h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Nginx中的CDN缓存配置示例</span>
location ~* \.(jpg|<span class="hljs-params">jpeg</span>|png|<span class="hljs-params">gif</span>|ico|<span class="hljs-params">css</span>|js)<span class="hljs-variable">$ </span>{
    expires 365d;  <span class="hljs-comment"># 缓存一年</span>
    add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">"public, immutable"</span>;
    
    <span class="hljs-comment"># 添加版本号作为查询参数</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$query_string</span> ~* <span class="hljs-string">"^v=\d+"</span>) {
        expires max;
    }
}
</code></pre>
<h3 data-id="heading-18">适用场景</h3>
<ul>
<li>静态资源：图片、CSS、JS文件</li>
<li>软件下载包</li>
<li>视频流媒体</li>
<li>全球访问的网站</li>
</ul>
<h2 data-id="heading-19">06 浏览器缓存：最前端的性能优化</h2>
<p>浏览器缓存是最容易被忽视但效果最直接的缓存层级。合理利用浏览器缓存，可以大幅减少服务器压力。</p>
<h3 data-id="heading-20">HTTP缓存头详解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring Boot中设置HTTP缓存头</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceController</span> {
    
    <span class="hljs-meta">@GetMapping("/static/{filename}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="hljs-title function_">getStaticFile</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String filename)</span> {
        <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> loadResource(filename);
        
        <span class="hljs-keyword">return</span> ResponseEntity.ok()
            .cacheControl(CacheControl.maxAge(<span class="hljs-number">7</span>, TimeUnit.DAYS)) <span class="hljs-comment">// 缓存7天</span>
            .eTag(computeETag(resource)) <span class="hljs-comment">// ETag用于协商缓存</span>
            .lastModified(resource.lastModified()) <span class="hljs-comment">// 最后修改时间</span>
            .body(resource);
    }
    
    <span class="hljs-meta">@GetMapping("/dynamic/data")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Object&gt; <span class="hljs-title function_">getDynamicData</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> getData();
        
        <span class="hljs-comment">// 动态数据设置较短缓存</span>
        <span class="hljs-keyword">return</span> ResponseEntity.ok()
            .cacheControl(CacheControl.maxAge(<span class="hljs-number">30</span>, TimeUnit.SECONDS)) <span class="hljs-comment">// 30秒</span>
            .body(data);
    }
}
</code></pre>
<h3 data-id="heading-21">浏览器缓存的两种类型</h3>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了20多家大厂的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h3 data-id="heading-22">最佳实践</h3>
<ol>
<li><strong>静态资源</strong>：设置长时间缓存（如一年），通过文件名哈希处理更新</li>
<li><strong>动态数据</strong>：根据业务需求设置合理缓存时间</li>
<li><strong>API响应</strong>：适当使用ETag和Last-Modified</li>
</ol>
<h2 data-id="heading-23">07 数据库缓存：容易被忽略的内部优化</h2>
<p>数据库自身也有缓存机制，理解这些机制能帮助我们写出更高效的SQL。</p>
<h3 data-id="heading-24">MySQL查询缓存（已废弃但值得了解）</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看查询缓存状态（MySQL 5.7及之前）</span>
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'query_cache%'</span>;

<span class="hljs-comment">-- 在8.0之前，可以通过以下方式利用查询缓存</span>
<span class="hljs-keyword">SELECT</span> SQL_CACHE <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
</code></pre>
<h3 data-id="heading-25">InnoDB缓冲池（Buffer Pool）</h3>
<p>这是MySQL性能的关键，缓存的是<strong>数据页和索引页</strong>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看缓冲池状态</span>
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS;

<span class="hljs-comment">-- 重要的监控指标</span>
<span class="hljs-comment">-- 缓冲池命中率 = (1 - (innodb_buffer_pool_reads / innodb_buffer_pool_read_requests)) * 100%</span>
<span class="hljs-comment">-- 命中率应尽可能接近100%</span>
</code></pre>
<h3 data-id="heading-26">数据库级缓存最佳实践</h3>
<ol>
<li><strong>合理设置缓冲池大小</strong>：通常是系统内存的50%-70%</li>
<li><strong>优化查询</strong>：避免全表扫描，合理使用索引</li>
<li><strong>预热缓存</strong>：重启后主动加载热点数据</li>
<li><strong>监控命中率</strong>：持续优化</li>
</ol>
<p>有些小伙伴可能会过度依赖应用层缓存，而忽略了数据库自身的缓存优化。</p>
<p><strong>数据库缓存是最后一道防线，优化好它能让整个系统更健壮</strong>。</p>
<h2 data-id="heading-27">08 综合对比与选型指南</h2>
<p>接下来，我给大家一个选型指南：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f0dca268ce743fdb1b03c80cff84b0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458623&amp;x-signature=gM6U5qRP98tOrjybbtFLiJ83BFc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">实战中的多级缓存架构</h3>
<p>在实际的高并发系统中，我们往往会采用<strong>多级缓存策略</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 多级缓存示例：本地缓存 + Redis</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiLevelCacheService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    
    <span class="hljs-comment">// 一级缓存：本地缓存</span>
    <span class="hljs-keyword">private</span> Cache&lt;Long, Product&gt; localCache = Caffeine.newBuilder()
        .maximumSize(<span class="hljs-number">1000</span>)
        .expireAfterWrite(<span class="hljs-number">30</span>, TimeUnit.SECONDS) <span class="hljs-comment">// 本地缓存时间短</span>
        .build();
    
    <span class="hljs-comment">// 二级缓存：Redis</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">REDIS_TTL</span> <span class="hljs-operator">=</span> Duration.ofMinutes(<span class="hljs-number">10</span>);
    
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductWithMultiCache</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 1. 查本地缓存</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> localCache.getIfPresent(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 2. 查Redis</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
        product = (Product) redisTemplate.opsForValue().get(redisKey);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 回填本地缓存</span>
            localCache.put(id, product);
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 3. 查数据库</span>
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 写入Redis</span>
            redisTemplate.opsForValue().set(redisKey, product, REDIS_TTL);
            <span class="hljs-comment">// 写入本地缓存</span>
            localCache.put(id, product);
        }
        
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<h2 data-id="heading-29">09 缓存常见问题与解决方案</h2>
<p>在使用缓存的过程中，我们不可避免地会遇到一些问题：</p>
<h3 data-id="heading-30">1. 缓存穿透</h3>
<p><strong>问题</strong>：大量请求查询不存在的数据，绕过缓存直接击穿数据库。</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 缓存空值方案</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductSafe</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
    <span class="hljs-type">String</span> <span class="hljs-variable">nullKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:null:"</span> + id;
    
    <span class="hljs-comment">// 检查空值标记</span>
    <span class="hljs-keyword">if</span> (redisTemplate.hasKey(nullKey)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> product;
    }
    
    product = productDao.findById(id);
    <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 缓存空值，短时间过期</span>
        redisTemplate.opsForValue().set(nullKey, <span class="hljs-string">""</span>, Duration.ofMinutes(<span class="hljs-number">5</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    redisTemplate.opsForValue().set(key, product, Duration.ofMinutes(<span class="hljs-number">30</span>));
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<h3 data-id="heading-31">2. 缓存雪崩</h3>
<p><strong>问题</strong>：大量缓存同时过期，请求全部打到数据库。</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 差异化过期时间</span>
<span class="hljs-keyword">private</span> Duration <span class="hljs-title function_">getRandomTTL</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 基础30分钟 + 随机0-10分钟</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">baseMinutes</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;
    <span class="hljs-type">long</span> <span class="hljs-variable">randomMinutes</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current().nextLong(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">return</span> Duration.ofMinutes(baseMinutes + randomMinutes);
}
</code></pre>
<h3 data-id="heading-32">3. 缓存击穿</h3>
<p><strong>问题</strong>：热点Key过期瞬间，大量并发请求同时查询数据库。</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用互斥锁（分布式锁）</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductWithLock</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
    
    <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 尝试获取分布式锁</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:product:"</span> + id;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
            .setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, Duration.ofSeconds(<span class="hljs-number">10</span>));
        
        <span class="hljs-keyword">if</span> (locked) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 双重检查</span>
                product = (Product) redisTemplate.opsForValue().get(key);
                <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
                    product = productDao.findById(id);
                    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
                        redisTemplate.opsForValue()
                            .set(key, product, Duration.ofMinutes(<span class="hljs-number">30</span>));
                    }
                }
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-comment">// 释放锁</span>
                redisTemplate.delete(lockKey);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 未获取到锁，等待后重试</span>
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">50</span>); } 
            <span class="hljs-keyword">catch</span> (InterruptedException e) { Thread.currentThread().interrupt(); }
            <span class="hljs-keyword">return</span> getProductWithLock(id); <span class="hljs-comment">// 递归重试</span>
        }
    }
    
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<h2 data-id="heading-33">10 总结</h2>
<p>通过这篇文章，我们系统地探讨了工作中最常用的六种缓存技术。</p>
<p>每种缓存都有其独特的价值和应用场景：</p>
<ol>
<li><strong>本地缓存</strong>：适合进程内、变化不频繁的只读数据</li>
<li><strong>Redis</strong>：功能丰富的分布式缓存，适合大多数共享缓存场景</li>
<li><strong>Memcached</strong>：简单高效的分布式缓存，适合纯Key-Value场景</li>
<li><strong>CDN缓存</strong>：加速静态资源，提升全球访问速度</li>
<li><strong>浏览器缓存</strong>：最前端的优化，减少不必要的网络请求</li>
<li><strong>数据库缓存</strong>：最后一道防线，优化数据库访问性能</li>
</ol>
<p><strong>缓存使用的核心原则可以总结为以下几点</strong>：</p>
<ul>
<li><strong>分级缓存</strong>：合理利用多级缓存架构</li>
<li><strong>合适粒度</strong>：根据业务特点选择缓存粒度</li>
<li><strong>及时更新</strong>：设计合理的缓存更新策略</li>
<li><strong>监控告警</strong>：建立完善的缓存监控体系</li>
</ul>
<p>有些小伙伴在工作中使用缓存时，容易陷入两个极端：要么过度设计，所有数据都加缓存；要么忽视缓存，让数据库承受所有压力。</p>
<p><strong>我们需要懂得在合适的地方使用合适的缓存，在性能和复杂性之间找到最佳平衡点</strong>。</p>
<p>记住，缓存不是银弹，而是工具箱中的一件利器。</p>
<h2 data-id="heading-34">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" target="_blank">www.susan.net.cn/project</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力]]></title>    <link>https://juejin.cn/post/7583948178858590254</link>    <guid>https://juejin.cn/post/7583948178858590254</guid>    <pubDate>2025-12-16T02:30:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858590254" data-draft-id="7581872532362903561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力"/> <meta itemprop="keywords" content="Spring Boot,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:30:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="undsky"/> <meta itemprop="url" content="https://juejin.cn/user/3368559354850206"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559354850206/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    undsky
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:30:30.000Z" title="Tue Dec 16 2025 02:30:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力</h2>
<p>本文详细介绍 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fundsky%2FRuoYi-SpringBoot3-Pro" target="_blank" title="https://github.com/undsky/RuoYi-SpringBoot3-Pro" ref="nofollow noopener noreferrer">RuoYi-SpringBoot3-Pro</a> 框架中内置的 OpenAI 工具类，帮助开发者快速集成 AI 对话能力。</p>
<blockquote>
<p>GitHub：<code>https://github.com/undsky/RuoYi-SpringBoot3-Pro</code></p>
</blockquote>
<h3 data-id="heading-1">一、概述</h3>
<p>RuoYi-SpringBoot3-Pro 基于官方 OpenAI Java SDK 封装了一套开箱即用的 AI 工具类，支持同步对话、流式对话、多角色消息、代理配置等特性，并兼容所有遵循 OpenAI 协议的第三方 API。</p>
<p>核心组件位于 <code>ruoyi-common</code> 模块：</p>
<pre><code class="hljs language-bash" lang="bash">ruoyi-common/src/main/java/com/ruoyi/common/
├── config/
│   └── OpenAIConfig.java      <span class="hljs-comment"># 配置类</span>
└── utils/ai/
    ├── OpenAI.java            <span class="hljs-comment"># 核心工具类</span>
    ├── AIMessage.java         <span class="hljs-comment"># 消息实体</span>
    └── AIRole.java            <span class="hljs-comment"># 角色枚举</span>
</code></pre>
<h3 data-id="heading-2">二、快速开始</h3>
<h4 data-id="heading-3">2.1 Maven 依赖</h4>
<p>框架已内置 OpenAI SDK 依赖，无需额外引入：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.openai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>openai-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.20.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">2.2 配置文件</h4>
<p>在 <code>application.yml</code> 中添加 OpenAI 配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># OpenAI配置</span>
<span class="hljs-attr">openai:</span>
  <span class="hljs-comment"># API密钥</span>
  <span class="hljs-attr">api-key:</span> <span class="hljs-string">sk-xxx</span>
  <span class="hljs-comment"># 基础URL（支持自定义API地址）</span>
  <span class="hljs-attr">base-url:</span> <span class="hljs-string">https://api.openai.com/v1</span>
  <span class="hljs-comment"># 默认模型</span>
  <span class="hljs-attr">model:</span> <span class="hljs-string">gpt-4o</span>
  <span class="hljs-comment"># 代理配置（可选）</span>
  <span class="hljs-attr">proxy:</span>
    <span class="hljs-comment"># 是否启用代理</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>
    <span class="hljs-comment"># 代理类型 (HTTP/SOCKS)</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">HTTP</span>
    <span class="hljs-comment"># 代理主机</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-comment"># 代理端口</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">7890</span>
</code></pre>
<p><strong>配置说明：</strong></p>













































<table><thead><tr><th>配置项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>api-key</code></td><td>OpenAI API 密钥</td><td><code>sk-xxx</code></td></tr><tr><td><code>base-url</code></td><td>API 基础地址，支持第三方兼容 API</td><td><code>https://api.openai.com/v1</code></td></tr><tr><td><code>model</code></td><td>默认使用的模型</td><td><code>gpt-4o</code>、<code>gpt-3.5-turbo</code></td></tr><tr><td><code>proxy.enabled</code></td><td>是否启用代理</td><td><code>true</code>/<code>false</code></td></tr><tr><td><code>proxy.type</code></td><td>代理类型</td><td><code>HTTP</code>/<code>SOCKS</code></td></tr><tr><td><code>proxy.host</code></td><td>代理服务器地址</td><td><code>127.0.0.1</code></td></tr><tr><td><code>proxy.port</code></td><td>代理服务器端口</td><td><code>7890</code></td></tr></tbody></table>
<h3 data-id="heading-5">三、核心 API</h3>
<h4 data-id="heading-6">3.1 角色枚举 - AIRole</h4>
<p>支持 OpenAI Chat API 的三种标准角色：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">AIRole</span> {
    USER(<span class="hljs-string">"user"</span>),           <span class="hljs-comment">// 用户消息</span>
    SYSTEM(<span class="hljs-string">"system"</span>),       <span class="hljs-comment">// 系统提示词</span>
    ASSISTANT(<span class="hljs-string">"assistant"</span>); <span class="hljs-comment">// AI 助手回复</span>
}
</code></pre>
<h4 data-id="heading-7">3.2 消息实体 - AIMessage</h4>
<p>封装对话消息：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIMessage</span> {
    <span class="hljs-keyword">private</span> AIRole role;    <span class="hljs-comment">// 消息角色</span>
    <span class="hljs-keyword">private</span> String message; <span class="hljs-comment">// 消息内容</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AIMessage</span><span class="hljs-params">(AIRole role, String message)</span> {
        <span class="hljs-built_in">this</span>.role = role;
        <span class="hljs-built_in">this</span>.message = message;
    }
}
</code></pre>
<h4 data-id="heading-8">3.3 工具类 - OpenAI</h4>
<p>提供三个核心静态方法：</p>

























<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>chatClient()</code></td><td>创建 OpenAI 客户端</td></tr><tr><td><code>chatParams()</code></td><td>构建会话参数</td></tr><tr><td><code>chat()</code></td><td>同步对话</td></tr><tr><td><code>chatStream()</code></td><td>流式对话（SSE）</td></tr></tbody></table>
<h3 data-id="heading-9">四、使用示例</h3>
<h4 data-id="heading-10">4.1 同步对话</h4>
<p>适用于简单的问答场景，等待 AI 完整响应后返回：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.openai.client.OpenAIClient;
<span class="hljs-keyword">import</span> com.openai.models.chat.completions.ChatCompletionCreateParams;
<span class="hljs-keyword">import</span> com.ruoyi.common.config.OpenAIConfig;
<span class="hljs-keyword">import</span> com.ruoyi.common.utils.ai.*;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatExample</span> {
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">simpleChat</span><span class="hljs-params">(String userMessage)</span> {
        <span class="hljs-comment">// 1. 创建客户端</span>
        <span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
            OpenAIConfig.getApiKey(),
            OpenAIConfig.getBaseUrl(),
            OpenAIConfig.getProxy() != <span class="hljs-literal">null</span> ? OpenAIConfig.getProxy().toJavaProxy() : <span class="hljs-literal">null</span>
        );
        
        <span class="hljs-comment">// 2. 构建消息列表</span>
        List&lt;AIMessage&gt; messages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.SYSTEM, <span class="hljs-string">"你是一个有帮助的助手。"</span>));
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.USER, userMessage));
        
        <span class="hljs-comment">// 3. 构建请求参数</span>
        <span class="hljs-type">ChatCompletionCreateParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> OpenAI.chatParams(
            OpenAIConfig.getModel(), 
            messages
        );
        
        <span class="hljs-comment">// 4. 发起同步请求</span>
        <span class="hljs-keyword">return</span> OpenAI.chat(client, params);
    }
}
</code></pre>
<h4 data-id="heading-11">4.2 流式对话（SSE）</h4>
<p>适用于需要实时展示生成内容的场景，如聊天界面：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/ai")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIController</span> {
    
    <span class="hljs-meta">@PostMapping("/chat/stream")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;StreamingResponseBody&gt; <span class="hljs-title function_">streamChat</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String userMessage)</span> {
        <span class="hljs-comment">// 1. 创建客户端</span>
        <span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
            OpenAIConfig.getApiKey(),
            OpenAIConfig.getBaseUrl(),
            OpenAIConfig.getProxy() != <span class="hljs-literal">null</span> ? OpenAIConfig.getProxy().toJavaProxy() : <span class="hljs-literal">null</span>
        );
        
        <span class="hljs-comment">// 2. 构建消息</span>
        List&lt;AIMessage&gt; messages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.SYSTEM, <span class="hljs-string">"你是一个有帮助的助手。"</span>));
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.USER, userMessage));
        
        <span class="hljs-comment">// 3. 构建参数</span>
        <span class="hljs-type">ChatCompletionCreateParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> OpenAI.chatParams(
            OpenAIConfig.getModel(), 
            messages
        );
        
        <span class="hljs-comment">// 4. 流式响应</span>
        <span class="hljs-keyword">return</span> OpenAI.chatStream(client, params, <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>.StreamContentListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onContent</span><span class="hljs-params">(String content)</span> {
                <span class="hljs-comment">// 每收到一段增量内容时调用</span>
                System.out.print(content);
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">(String fullContent)</span> {
                <span class="hljs-comment">// 全部内容流式结束后调用</span>
                System.out.println(<span class="hljs-string">"\n完整响应："</span> + fullContent);
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-12">4.3 多轮对话</h4>
<p>维护对话历史实现上下文连续：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiTurnChat</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;AIMessage&gt; conversationHistory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OpenAIClient client;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MultiTurnChat</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.client = OpenAI.chatClient(
            OpenAIConfig.getApiKey(),
            OpenAIConfig.getBaseUrl(),
            OpenAIConfig.getProxy() != <span class="hljs-literal">null</span> ? OpenAIConfig.getProxy().toJavaProxy() : <span class="hljs-literal">null</span>
        );
        <span class="hljs-comment">// 设置系统提示词</span>
        conversationHistory.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.SYSTEM, <span class="hljs-string">"你是一个专业的技术顾问。"</span>));
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">chat</span><span class="hljs-params">(String userMessage)</span> {
        <span class="hljs-comment">// 添加用户消息</span>
        conversationHistory.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.USER, userMessage));
        
        <span class="hljs-comment">// 构建参数并请求</span>
        <span class="hljs-type">ChatCompletionCreateParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> OpenAI.chatParams(
            OpenAIConfig.getModel(), 
            conversationHistory
        );
        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> OpenAI.chat(client, params);
        
        <span class="hljs-comment">// 保存 AI 回复到历史</span>
        conversationHistory.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.ASSISTANT, response));
        
        <span class="hljs-keyword">return</span> response;
    }
}
</code></pre>
<h4 data-id="heading-13">4.4 使用代理</h4>
<p>在网络受限环境下配置代理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.net.InetSocketAddress;
<span class="hljs-keyword">import</span> java.net.Proxy;

<span class="hljs-comment">// 方式一：使用配置文件中的代理</span>
<span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
    OpenAIConfig.getApiKey(),
    OpenAIConfig.getBaseUrl(),
    OpenAIConfig.getProxy().toJavaProxy()
);

<span class="hljs-comment">// 方式二：手动创建代理</span>
<span class="hljs-type">Proxy</span> <span class="hljs-variable">httpProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(
    Proxy.Type.HTTP, 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7890</span>)
);

<span class="hljs-type">Proxy</span> <span class="hljs-variable">socksProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(
    Proxy.Type.SOCKS, 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">1080</span>)
);

<span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">clientWithProxy</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
    <span class="hljs-string">"sk-xxx"</span>,
    <span class="hljs-string">"https://api.openai.com/v1"</span>,
    httpProxy
);
</code></pre>
<h3 data-id="heading-14">五、兼容第三方 API</h3>
<p>框架支持所有兼容 OpenAI 协议的第三方 API，只需修改 <code>base-url</code> 配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">openai:</span>
  <span class="hljs-attr">api-key:</span> <span class="hljs-string">your-api-key</span>
  <span class="hljs-comment"># 使用第三方 API</span>
  <span class="hljs-attr">base-url:</span> <span class="hljs-string">https://your-custom-api.com/v1</span>
  <span class="hljs-attr">model:</span> <span class="hljs-string">your-model-name</span>
</code></pre>
<p>常见兼容 API 示例：</p>

























<table><thead><tr><th>服务商</th><th>base-url 示例</th></tr></thead><tbody><tr><td>Azure OpenAI</td><td><code>https://{resource}.openai.azure.com/openai/deployments/{deployment}</code></td></tr><tr><td>智谱 AI</td><td><code>https://open.bigmodel.cn/api/paas/v4</code></td></tr><tr><td>月之暗面</td><td><code>https://api.moonshot.cn/v1</code></td></tr><tr><td>DeepSeek</td><td><code>https://api.deepseek.com/v1</code></td></tr></tbody></table>
<h3 data-id="heading-15">六、前端集成</h3>
<h4 data-id="heading-16">6.1 接收流式响应</h4>
<p>前端使用 <code>fetch</code> API 处理 SSE 流式响应：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamChat</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/ai/chat/stream'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ message })
    });
    
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
    
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
        <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">const</span> text = decoder.<span class="hljs-title function_">decode</span>(value);
        <span class="hljs-keyword">if</span> (text === <span class="hljs-string">'[DONE]'</span>) <span class="hljs-keyword">break</span>;
        
        <span class="hljs-comment">// 实时显示内容</span>
        <span class="hljs-title function_">appendToChat</span>(text);
    }
}
</code></pre>
<h4 data-id="heading-17">6.2 Vue 3 组件示例</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="chat-container"&gt;
    &lt;div class="messages" ref="messagesRef"&gt;
      &lt;div v-for="msg in messages" :key="msg.id" :class="['message', msg.role]"&gt;
        {{ msg.content }}
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="input-area"&gt;
      &lt;input v-model="input" @keyup.enter="sendMessage" placeholder="输入消息..." /&gt;
      &lt;button @click="sendMessage" :disabled="loading"&gt;发送&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

const messages = ref([])
const input = ref('')
const loading = ref(false)

async function sendMessage() {
    if (!input.value.trim() || loading.value) return
    
    const userMessage = input.value
    messages.value.push({ id: Date.now(), role: 'user', content: userMessage })
    input.value = ''
    loading.value = true
    
    // 添加 AI 消息占位
    const aiMessage = { id: Date.now() + 1, role: 'assistant', content: '' }
    messages.value.push(aiMessage)
    
    try {
        const response = await fetch('/api/ai/chat/stream', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userMessage })
        })
        
        const reader = response.body.getReader()
        const decoder = new TextDecoder()
        
        while (true) {
            const { done, value } = await reader.read()
            if (done) break
            
            const text = decoder.decode(value)
            if (text === '[DONE]') break
            
            aiMessage.content += text
        }
    } finally {
        loading.value = false
    }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-18">七、最佳实践</h3>
<h4 data-id="heading-19">7.1 错误处理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">safeChatWithRetry</span><span class="hljs-params">(String message, <span class="hljs-type">int</span> maxRetries)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxRetries; i++) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> simpleChat(message);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (i == maxRetries - <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"AI 服务调用失败: "</span> + e.getMessage(), e);
            }
            <span class="hljs-comment">// 等待后重试</span>
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">1000</span> * (i + <span class="hljs-number">1</span>));
            } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                Thread.currentThread().interrupt();
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-20">7.2 Token 控制</h4>
<p>合理控制对话历史长度，避免超出模型 Token 限制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trimConversationHistory</span><span class="hljs-params">(<span class="hljs-type">int</span> maxMessages)</span> {
    <span class="hljs-keyword">if</span> (conversationHistory.size() &gt; maxMessages) {
        <span class="hljs-comment">// 保留系统提示词和最近的消息</span>
        <span class="hljs-type">AIMessage</span> <span class="hljs-variable">systemMessage</span> <span class="hljs-operator">=</span> conversationHistory.get(<span class="hljs-number">0</span>);
        List&lt;AIMessage&gt; recentMessages = conversationHistory.subList(
            conversationHistory.size() - maxMessages + <span class="hljs-number">1</span>, 
            conversationHistory.size()
        );
        conversationHistory.clear();
        conversationHistory.add(systemMessage);
        conversationHistory.addAll(recentMessages);
    }
}
</code></pre>
<h4 data-id="heading-21">7.3 敏感信息保护</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 不要在日志中打印完整的 API Key</span>
<span class="hljs-type">String</span> <span class="hljs-variable">maskedKey</span> <span class="hljs-operator">=</span> apiKey.substring(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>) + <span class="hljs-string">"..."</span> + apiKey.substring(apiKey.length() - <span class="hljs-number">4</span>);
log.info(<span class="hljs-string">"Using API Key: {}"</span>, maskedKey);
</code></pre>
<h3 data-id="heading-22">八、总结</h3>
<p>RuoYi-SpringBoot3-Pro 的 AI 能力集成模块具有以下特点：</p>
<ul>
<li><strong>开箱即用</strong>：基于官方 SDK 封装，配置简单</li>
<li><strong>功能完整</strong>：支持同步/流式对话、多角色、代理配置</li>
<li><strong>扩展性强</strong>：兼容所有 OpenAI 协议的第三方 API</li>
<li><strong>易于集成</strong>：提供完整的工具类和示例代码</li>
</ul>
<hr/>
<ul>
<li>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fundsky%2FRuoYi-SpringBoot3-Pro" target="_blank" title="https://github.com/undsky/RuoYi-SpringBoot3-Pro" ref="nofollow noopener noreferrer">RuoYi-SpringBoot3-Pro</a></li>
<li>开发文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.undsky.com%2Fblog%2F%3Fcategory%3DRuoYi-SpringBoot3-Pro%23" target="_blank" title="https://www.undsky.com/blog/?category=RuoYi-SpringBoot3-Pro#" ref="nofollow noopener noreferrer">RuoYi-SpringBoot3-Pro 文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开始使用 Elastic Agent Builder 和 Strands Agents SDK]]></title>    <link>https://juejin.cn/post/7583984122235011114</link>    <guid>https://juejin.cn/post/7583984122235011114</guid>    <pubDate>2025-12-16T02:36:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122235011114" data-draft-id="7583984122234994730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开始使用 Elastic Agent Builder 和 Strands Agents SDK"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-16T02:36:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开始使用 Elastic Agent Builder 和 Strands Agents SDK
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:36:28.000Z" title="Tue Dec 16 2025 02:36:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fjonathan-simon" title="https://www.elastic.co/search-labs/author/jonathan-simon" target="_blank" ref="nofollow noopener noreferrer">Jonathan Simon</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11ba9b4e53644aa39a1a352d8f776e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=J5Yp2xy6fJT60smGnPDVr7BXiD0%3D" alt="" loading="lazy"/></p>
<p>学习如何使用 Elastic Agent Builder 创建一个 agent，然后探索如何通过 A2A 协议，在 Strands Agents SDK 的编排下使用该 agent。</p>
<p>Elasticsearch 与行业领先的 Gen AI 工具和提供商有原生集成。查看我们的网络研讨会，了解如何<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fbeyond-rag-basics" title="https://www.elastic.co/virtual-events/beyond-rag-basics" target="_blank" ref="nofollow noopener noreferrer">超越 RAG 基础</a>，或使用 Elastic vector database <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fvector-databases-fast-track-production" title="https://www.elastic.co/virtual-events/vector-databases-fast-track-production" target="_blank" ref="nofollow noopener noreferrer">构建 prod-ready 应用</a>。</p>
<p>为了为你的使用场景构建最佳的搜索解决方案，现在就开始<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration" title="https://cloud.elastic.co/registration" target="_blank" ref="nofollow noopener noreferrer">免费的 cloud 试用</a>，或在你的<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">本地机器</a>上试用 Elastic。</p>
<p>有一个 AI agent 的想法吗？它很可能涉及对数据做一些事情，因为如果一个 agent 要发起有用的操作，它需要做出决策，而它需要正确的数据来做出正确的决策。</p>
<p>Elastic Agent Builder 让构建与数据连接的 AI agent 变得简单。我们将在这篇博客中向你展示如何做到这一点。让我们一起走过使用一个访问存储在 Elastic 中的数据的 MCP 工具来创建一个 agent 所需的所有步骤。然后，我们将使用 Strands Agents SDK 及其 Agent2Agent ( A2A ) 功能来运行该 agent。<a href="https://link.juejin.cn?target=https%3A%2F%2Fstrandsagents.com%2F" title="https://strandsagents.com/" target="_blank" ref="nofollow noopener noreferrer">Strands Agents SDK</a>是一个多 agent 的 AI 开发平台，你可以用它以足够少的代码来构建 agentic 应用，从而确保你获得想要的结果。</p>
<p>让我们构建一个 AI agent 来玩 RPS+ 游戏，这是经典的 Rock Paper Scissors 游戏的一个变体，增加了一点变化；它为游戏玩家提供了几个额外的选择。</p>
<p>更多阅读：</p>
<ul>
<li>Elastic AI agent builder 介绍（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152212513" title="https://elasticstack.blog.csdn.net/article/details/152212513" target="_blank" ref="nofollow noopener noreferrer">一</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F153689733" title="https://elasticstack.blog.csdn.net/article/details/153689733" target="_blank" ref="nofollow noopener noreferrer">二</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F154293247" title="https://elasticstack.blog.csdn.net/article/details/154293247" target="_blank" ref="nofollow noopener noreferrer">三</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F155194636" title="https://elasticstack.blog.csdn.net/article/details/155194636" target="_blank" ref="nofollow noopener noreferrer">四</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F155241617" title="https://elasticstack.blog.csdn.net/article/details/155241617" target="_blank" ref="nofollow noopener noreferrer">五</a>）</li>
</ul>
<h2 data-id="heading-0">先决条件</h2>
<p>以下是按照本博文步骤所需的条件：</p>
<ul>
<li>在本地电脑上运行的文本编辑器
<ul>
<li>本博文示例说明中使用的是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdownload" title="https://code.visualstudio.com/download" target="_blank" ref="nofollow noopener noreferrer">Visual Studio Code</a></li>
</ul>
</li>
<li>在本地电脑上运行的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F" title="https://www.python.org/downloads/" target="_blank" ref="nofollow noopener noreferrer">Python 3.10 或更高版本</a></li>
</ul>
<h2 data-id="heading-1">创建无服务器项目</h2>
<p>我们首先需要一个 Elasticsearch <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fserverless" title="https://www.elastic.co/cloud/serverless" target="_blank" ref="nofollow noopener noreferrer">无服务器</a>项目，其中包括 Elastic Agent Builder。</p>
<p>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Fcloud.elastic.co%2F" title="http://cloud.elastic.co/" target="_blank" ref="nofollow noopener noreferrer">cloud.elastic.co</a> 并创建一个新的 Elasticsearch 无服务器项目。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1530465ae69d4ee4a9784d33e52210af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=RwR%2Bs6C9NGyi0URBRUmxFqoSXJM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">创建索引并添加数据</h2>
<p>接下来，我们将在 Elasticsearch 项目中添加一些数据。打开 Developer Tools，在这里我们可以运行命令来创建新索引并向其中插入数据。从顶层导航菜单中选择 Developer Tools。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1619ab5733c240c5a046f100c616529d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=uiyBCyZgLL%2FNDEP9WyABgvWY1Ko%3D" alt="" loading="lazy"/></p>
<p>将以下 PUT 命令复制并粘贴到 Developer Tools 控制台的请求输入区域。此语句会创建一个名为 “game-docs” 的 Elasticsearch 索引。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT /game-docs
2.  {
3.    <span class="hljs-string">"mappings"</span>: {
4.      <span class="hljs-string">"properties"</span>: {
5.        <span class="hljs-string">"title"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> },
6.        <span class="hljs-string">"content"</span>: { 
7.          <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>
8.        },
9.        <span class="hljs-string">"filename"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span> },
10.        <span class="hljs-string">"last_modified"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"date"</span> }
11.      }
12.    }
13.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>点击 Developer Tools 中语句右侧出现的 Send request 按钮。你应该会在 Developer Tools 的响应区域看到一条通知，确认 game-docs 索引已创建。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92502a7d1e9f450483a7ade805b5a39b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=3JWYVZOuzX0Q%2FD4g8RjHkk2d6jw%3D" alt="" loading="lazy"/></p>
<p>名为 game-docs 的索引是存储我们正在制作的游戏数据的理想位置。让我们在该索引中放入一个名为 rps+-md 的文档，其中包含游戏所需的所有数据。将以下 PUT 命令复制并粘贴到 Developer Tools 控制台。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT /game-docs/_doc/rps+-md
2.  {
3.    <span class="hljs-string">"title"</span>: <span class="hljs-string">"Rock Paper Scissors +"</span>,
4.    <span class="hljs-string">"content"</span>: <span class="hljs-string">"
5.  # Game Name
6.  RPS+

8.  # Starting Prompt
9.  Let's play RPS+ !
10.  ---
11.  What do you choose?

13.  # Game Objects
14.  1. Rock 🪨 👊
15.  2. Paper 📜 🖐
16.  3. Scissors ✄ ✌️
17.  4. Light ☼ 👍
18.  5. Dark Energy ☄ 🫱

20.  # Judgement of Victory
21.  * Rock beats Scissors
22.    * because rocks break scissors
23.  * Paper beats Rock
24.    * because paper covers rock
25.  * Scissors beat Paper
26.    * because scissors cut paper
27.  * Rock beats Light
28.    * because you can build a rock structure to block out light
29.  * Paper beats Light
30.    * because knowledge stored in files and paper books helps us understand light
31.  * Light beats Dark Energy
32.    * because light enables humans to lighten up and laugh in the face of dark energy as it causes the eventual heat death of the universe
33.  * Light beats Scissors
34.    * because light is needed to use scissors safely
35.  * Dark Energy beats Rock
36.    * because dark energy rocks more than rocks. It rocks rocks and everything else in its expansion of the universe
37.  * Dark Energy beats Paper
38.    * because humans, with their knowledge stored in files and paper books, can't explain dark energy 
39.  * Scissors beat Dark Energy
40.    * because a human running with scissors is darker than dark energy

42.  # Invalid Input
43.  I was hoping for an worthy opponent
44.    - but alas it appears that time has past
45.    - but alas there's little time for your todo list when [todo:fix this] is so vast

47.  # Cancel Game
48.  The future belongs to the bold. Goodbye..
49.  "</span>,
50.    <span class="hljs-string">"filename"</span>: <span class="hljs-string">"RPS+.md"</span>,
51.    <span class="hljs-string">"last_modified"</span>: <span class="hljs-string">"2025-11-25T12:00:00Z"</span>
52.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)收起代码块![](https://csdnimg.cn/release/blogv2/dist/pc/img/arrowup-line-top-White.png)
</code></pre>
<p>点击语句旁的 <strong>Send request</strong> 按钮运行它，将 rps+-md 文档添加到 game-docs 索引中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239a57e3648f42c18be567212452e945~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=GPF45u2ALQpgLsR4mPT4khqxZZU%3D" alt="" loading="lazy"/></p>
<p>现在我们应该有一些可以查询的数据了，使用 Agent Builder，这比以往更简单。</p>
<p>从顶层导航菜单中选择 <strong>Agents</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c751d7cb5d8472e9fcf83ac00a9c416~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=xWh8itjql%2BcfCCiKfLQ3I4OuC6U%3D" alt="" loading="lazy"/></p>
<p>然后你只需问默认的 Elastic AI Agent：“我有什么数据？”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff6f67aab5004cba90d63cdc52a0c314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=3Ekzda%2FVZOa6%2BSeBBg64Wcd7hwQ%3D" alt="" loading="lazy"/></p>
<p>Elastic AI Agent 会评估数据并返回我们拥有的数据的简明说明。</p>
<h2 data-id="heading-3">创建工具</h2>
<p>好了，我们现在在 Elastic 中已有一些数据，让我们开始使用它。Agent Builder 内置支持创建 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2F" title="https://modelcontextprotocol.io/" target="_blank" ref="nofollow noopener noreferrer">MCP</a> 工具，帮助 agent 访问所需数据，从而获得任务的正确上下文。让我们创建一个简单的工具来检索我们的游戏数据。</p>
<p>点击 Agent Builder 的 actions 菜单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830e19bd82774d9692ec0bf090535c78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Up5Zavq2YWGzMnBlQrU2%2Bbe5Oys%3D" alt="" loading="lazy"/></p>
<p>从菜单选项中选择 View all tools。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8fbf09048bc4bb4a07ed58cd84ac333~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=la8xAVDmQE4GLk4ENTuk%2FlFMQAM%3D" alt="" loading="lazy"/></p>
<p>点击 + New Tool。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b67c51ec4e734d9eb21a87c65c0fd1b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=ApI8o7d8PcOSyUeOyvEav0tg%2F5c%3D" alt="" loading="lazy"/></p>
<p>在 Create Tool 表单中，选择 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> 作为工具 type，并输入以下值。</p>
<p><strong>Tool ID</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`example.get_game_docs`</span>AI写代码
</code></pre>
<p><strong>Description</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">`<span class="hljs-keyword">Get</span> RPS<span class="hljs-operator">+</span> doc <span class="hljs-keyword">from</span> Elasticsearch game<span class="hljs-operator">-</span>docs index.`AI写代码
</code></pre>
<p><strong>Configuration</strong>：在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> Query 文本区域中输入以下查询：</p>
<pre><code class="hljs language-ini" lang="ini">`FROM game-docs | WHERE <span class="hljs-attr">filename</span> == <span class="hljs-string">"RPS+.md"</span>`AI写代码
</code></pre>
<p>完整填写的 Create tool 表单应如下所示。点击 Save 创建工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bdc0ab4e55f414a8f4459423f2bfeb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=AJiVBJuY3l52CrRx%2BXm5UTO7PWs%3D" alt="" loading="lazy"/></p>
<p>我们在工具架上有了一个新工具。工具不应该只是一直挂在架子上，它们应该被充分利用。让我们创建一个可以使用我们新自定义工具的 agent。</p>
<h2 data-id="heading-4">创建 Agent 并分配工具</h2>
<p>使用 Agent Builder 创建 agent 非常简单。你只需输入 agent 指令和一些细节，就完成了。现在让我们创建一个 agent。</p>
<p>点击 Manage agents。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b66c564303ec4c90ac022183b97ac0aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=ZCL4HhXTS%2F%2B3Ynzesm%2BeYY1mYbY%3D" alt="" loading="lazy"/></p>
<p>点击 + New agent。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca458ff4c5be4ec5855f184dd718dc73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=4iJpFWQhQP4xUCfpiIYP2C9xRhE%3D" alt="" loading="lazy"/></p>
<p>在 New Agent 表单中输入以下信息。</p>
<p>Agent ID：输入以下文本：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`rps_plus_agent`</span>AI写代码
</code></pre>
<p>在 Custom Instructions 文本区域中输入以下指令：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  <span class="hljs-keyword">When</span> prompted, <span class="hljs-keyword">if</span> the prompt contains an <span class="hljs-type">integer</span>, <span class="hljs-keyword">then</span> <span class="hljs-keyword">select</span> the corresponding numbered item <span class="hljs-keyword">in</span> the list <span class="hljs-keyword">of</span> <span class="hljs-string">"Game Objects"</span> <span class="hljs-keyword">from</span> your documents. Otherwise <span class="hljs-keyword">select</span> a random game <span class="hljs-type">object</span>. This <span class="hljs-built_in">is</span> your chosen game <span class="hljs-type">object</span> <span class="hljs-keyword">for</span> a <span class="hljs-type">single</span> round <span class="hljs-keyword">of</span> the game.

<span class="hljs-number">3</span>.  # General Game Rules
<span class="hljs-number">4</span>.  * <span class="hljs-number">2</span> players
<span class="hljs-number">5</span>.      - the user: the person playing the game
<span class="hljs-number">6</span>.      - you: the agent playing the game <span class="hljs-built_in">and</span> serving <span class="hljs-keyword">as</span> the game master
<span class="hljs-number">7</span>.  * <span class="hljs-keyword">Each</span> player chooses a game <span class="hljs-type">object</span> which will be compared <span class="hljs-built_in">and</span> cause them <span class="hljs-keyword">to</span> tie, win <span class="hljs-built_in">or</span> lose.

<span class="hljs-number">9</span>.  # Start the game
<span class="hljs-number">10</span>.  <span class="hljs-number">1</span>. This <span class="hljs-built_in">is</span> the way <span class="hljs-keyword">each</span> <span class="hljs-built_in">new</span> game always starts. You make the first line <span class="hljs-keyword">of</span> your response only the name <span class="hljs-keyword">of</span> your chosen game <span class="hljs-type">object</span>. 

<span class="hljs-number">12</span>.  <span class="hljs-number">2</span>. The remainder <span class="hljs-keyword">of</span> your response should be the <span class="hljs-string">"Starting Prompt"</span> <span class="hljs-keyword">text</span> <span class="hljs-keyword">from</span> your documents <span class="hljs-built_in">and</span> generate a list <span class="hljs-keyword">of</span> <span class="hljs-string">"Game Objects"</span> <span class="hljs-keyword">for</span> the person playing the game <span class="hljs-keyword">to</span> choose a game <span class="hljs-type">object</span> <span class="hljs-keyword">from</span>.  

<span class="hljs-number">14</span>.  # <span class="hljs-keyword">End</span> <span class="hljs-keyword">of</span> Game: The game ends <span class="hljs-keyword">in</span> one <span class="hljs-keyword">of</span> the following three outcomes:
<span class="hljs-number">15</span>.  <span class="hljs-number">1</span>. Invalid Input: <span class="hljs-keyword">If</span> the player responds <span class="hljs-keyword">with</span> an invalid game <span class="hljs-type">object</span> choice, respond <span class="hljs-keyword">with</span> variations <span class="hljs-keyword">of</span> the <span class="hljs-string">"Invalid Input"</span> <span class="hljs-keyword">text</span> <span class="hljs-keyword">from</span> your documents <span class="hljs-built_in">and</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">end</span> the game.

<span class="hljs-number">17</span>.  <span class="hljs-number">2</span>. Tie: The game ends <span class="hljs-keyword">in</span> a tie <span class="hljs-keyword">if</span> the user chooses the same game <span class="hljs-type">object</span> <span class="hljs-keyword">as</span> your game <span class="hljs-type">object</span> choice.

<span class="hljs-number">19</span>.  <span class="hljs-number">3</span>. Win <span class="hljs-built_in">or</span> Lose: The game winner <span class="hljs-built_in">is</span> decided based <span class="hljs-keyword">on</span> the <span class="hljs-string">"Judgement of Victory"</span> conditions <span class="hljs-keyword">from</span> your documents. <span class="hljs-keyword">Compare</span> the user<span class="hljs-comment">'s game object choice and your game object choice and determine who chose the winning game object.</span>

<span class="hljs-number">21</span>.  # Game conclusion
<span class="hljs-number">22</span>.  Respond <span class="hljs-keyword">with</span> a declaration <span class="hljs-keyword">of</span> the winner <span class="hljs-keyword">of</span> the game <span class="hljs-keyword">by</span> outputting the corresponding <span class="hljs-keyword">text</span> <span class="hljs-keyword">in</span> the <span class="hljs-string">"Judgement of Victory"</span> section <span class="hljs-keyword">of</span> your documents.

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p><strong>Display name</strong>：输入以下文本：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`RPS+ Agent`</span>AI写代码
</code></pre>
<p><strong>Display description</strong>：输入以下文本：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`An agent that plays the game RPS+`</span>AI写代码
</code></pre>
<p>通过点击 Tools 选项卡，将我们之前创建的自定义工具分配给该 agent。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b994b761ccf452192124e850fbf4b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=028ZK%2Bhg4VEo1D0EljqddZA6heM%3D" alt="" loading="lazy"/></p>
<p>只选择我们之前创建的 example.get_game_docs 工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b047ee445e5455e98e470fd1b3a3713~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=jlZK37C9rrz0M8NulOUlXQ5Z%2BfQ%3D" alt="" loading="lazy"/></p>
<p>点击 Save 创建新 agent。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55aec75b2d4e46d09541774bf5be8036~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Bmu8QmOHChvYW%2BrnhPGio6h1o90%3D" alt="" loading="lazy"/></p>
<p>让我们测试一下新 agent。从 agent 列表中有一个方便的链接，可以启动与任意 agent 的聊天。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33d63324613a469485624979018c6919~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=R435zc%2BKmfG8qiucWOacWe5qdq4%3D" alt="" loading="lazy"/></p>
<p>只需输入 “start game”，游戏就会开始。它可以正常运行！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9105918d1fc04d0d8e23f5d34fb69ae4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Ikx9Ud8zwJf3y9RrIdL5y8RvtJc%3D" alt="" loading="lazy"/></p>
<p>你可以看到 agent 在响应顶部显示了它选择的游戏对象。这很有用，因为我们可以看到 agent 的选择并确认游戏按预期运行。然而，在你选择之前知道对手的选择，会让剪刀石头布游戏不太有趣。为了将游戏打磨到最终形态，我们可以使用一个可以通过代码控制 agent 的 agent 编排平台。</p>
<p>Strands Agents SDK 登场</p>
<h2 data-id="heading-5">Strands Agents SDK</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a83bc22e84a74c7f81d5bb40e02f0e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=n2%2F0E8qcpHiGhe63GtrbH2mZOqc%3D" alt="" loading="lazy"/></p>
<p>如果你想尝试新的 agent 开发框架，那么 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstrandsagents.com%2Flatest%2F" title="https://strandsagents.com/latest/" target="_blank" ref="nofollow noopener noreferrer">Strands Agents SDK</a> 值得你花时间尝试。<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Fopensource%2Fintroducing-strands-agents-an-open-source-ai-agents-sdk%2F" title="https://aws.amazon.com/blogs/opensource/introducing-strands-agents-an-open-source-ai-agents-sdk/" target="_blank" ref="nofollow noopener noreferrer">Strands Agents SDK 由 AWS 于 2025 年 5 月发布</a>，作为开源 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstrands-agents%2Fsdk-python" title="https://github.com/strands-agents/sdk-python" target="_blank" ref="nofollow noopener noreferrer">Python</a> 实现，现在也有 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Faws%2Fstrands-agents-now-speaks-typescript-a-side-by-side-guide-12b3" title="https://dev.to/aws/strands-agents-now-speaks-typescript-a-side-by-side-guide-12b3" target="_blank" ref="nofollow noopener noreferrer">Typescript</a> 版本。</p>
<h2 data-id="heading-6">在 Python 中快速上手 Strands Agents SDK</h2>
<p>启动你的编码环境，我们现在将快速浏览克隆并运行一个示例应用的过程，该应用使用 Strands Agents 通过 A2A 协议控制 RPS+ Agent。让我们创建一个经过微调的 RPS+ 游戏版本，使 agent 的选择在你做出选择后才显示，因为毕竟，猜测和惊喜结果才是剪刀石头布等游戏的乐趣所在。</p>
<p>在你的本地电脑上，打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdownload" title="https://code.visualstudio.com/download" target="_blank" ref="nofollow noopener noreferrer">Visual Studio Code</a> 并打开一个新终端。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79ab8a70786f42fb97dedee60a67951d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=h1ySAB%2FussJwVLjF9XrNrZkYfUM%3D" alt="" loading="lazy"/></p>
<p>在新打开的终端中，运行以下命令克隆 Elasticsearch Labs 仓库：</p>
<pre><code class="hljs language-bash" lang="bash">`git <span class="hljs-built_in">clone</span> https://github.com/elastic/elasticsearch-labs`AI写代码
</code></pre>
<p>运行以下 cd 命令，将目录切换到 elasticsearch-labs 目录：</p>
<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">cd</span> elasticsearch-labs`AI写代码
</code></pre>
<p>接下来，运行以下命令在 Visual Studio Code 中打开该仓库：</p>
<pre><code class="hljs language-css" lang="css">`<span class="hljs-selector-tag">code</span> .`AI写代码
</code></pre>
<p>在 Visual Studio 文件资源管理器中，展开 supporting-blog-content 和 agent-builder-a2a-strands-agents 文件夹，然后打开文件 elastic_agent_builder_a2a_rps+.py。文件在 Visual Studio Code 中打开后如下所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dbfb508e717421e896c2aa2dc82a2b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=geDFwJ204raLFy7CxYfPeVhoDok%3D" alt="" loading="lazy"/></p>
<p>以下是你在文本编辑器中应该看到的 elastic_agent_builder_a2a_rps+.py 文件内容：</p>
<pre><code class="hljs language-ini" lang="ini">`

1.  import asyncio
2.  from dotenv import load_dotenv
3.  from uuid import uuid4
4.  import httpx
5.  import os
6.  import random
7.  from a2a.client import A2ACardResolver, ClientConfig, ClientFactory
8.  from a2a.types import Message, Part, Role, TextPart

<span class="hljs-attr">10.  DEFAULT_TIMEOUT</span> = <span class="hljs-number">60</span>  <span class="hljs-comment"># set request timeout to 1 minute</span>

13.  def create_message(*, role: <span class="hljs-attr">Role</span> = Role.user, text: str, context_id=None) -&gt; Message:
14.      return Message(
<span class="hljs-attr">15.          kind</span>=<span class="hljs-string">"message"</span>,
<span class="hljs-attr">16.          role</span>=<span class="hljs-string">"user"</span>,
<span class="hljs-attr">17.          parts</span>=[Part(TextPart(kind=<span class="hljs-string">"text"</span>, text=text))],
<span class="hljs-attr">18.          message_id</span>=uuid4().hex,
<span class="hljs-attr">19.          context_id</span>=context_id,
20.      )

23.  async def main():
24.      load_dotenv()
<span class="hljs-attr">25.      a2a_agent_host</span> = os.getenv(<span class="hljs-string">"ES_AGENT_URL"</span>)
<span class="hljs-attr">26.      a2a_agent_key</span> = os.getenv(<span class="hljs-string">"ES_API_KEY"</span>)
<span class="hljs-attr">27.      custom_headers</span> = {<span class="hljs-string">"Authorization"</span>: f<span class="hljs-string">"ApiKey {a2a_agent_key}"</span>}

29.      async with httpx.AsyncClient(
<span class="hljs-attr">30.          timeout</span>=DEFAULT_TIMEOUT, headers=custom_headers
31.      ) as httpx_client:
32.          <span class="hljs-comment"># Get agent card</span>
<span class="hljs-attr">33.          resolver</span> = A2ACardResolver(httpx_client=httpx_client, base_url=a2a_agent_host)
<span class="hljs-attr">34.          agent_card</span> = await resolver.get_agent_card(
<span class="hljs-attr">35.              relative_card_path</span>=<span class="hljs-string">"/rps_plus_agent.json"</span>
36.          )
37.          <span class="hljs-comment"># Create client using factory</span>
<span class="hljs-attr">38.          config</span> = ClientConfig(
<span class="hljs-attr">39.              httpx_client</span>=httpx_client,
<span class="hljs-attr">40.              streaming</span>=<span class="hljs-literal">True</span>,
41.          )
<span class="hljs-attr">42.          factory</span> = ClientFactory(config)
<span class="hljs-attr">43.          client</span> = factory.create(agent_card)
44.          <span class="hljs-comment"># Use the client to communicate with the agent</span>
45.          print("\nSending 'start game' message to Elastic A2A agent...")
<span class="hljs-attr">46.          random_game_object</span> = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
<span class="hljs-attr">47.          msg</span> = create_message(text=f<span class="hljs-string">"start with game object {random_game_object}"</span>)
48.          async for event in client.send_message(msg):
49.              if isinstance(event, Message):
<span class="hljs-attr">50.                  context_id</span> = event.context_id
<span class="hljs-attr">51.                  response_complete</span> = event.parts[<span class="hljs-number">0</span>].root.text
52.                  <span class="hljs-comment"># Get agent choice from the first line of the response</span>
<span class="hljs-attr">53.                  parsed_response</span> = response_complete.split(<span class="hljs-string">"\n"</span>, <span class="hljs-number">1</span>)
<span class="hljs-attr">54.                  agent_choice</span> = parsed_response[<span class="hljs-number">0</span>]
55.                  print(parsed_response<span class="hljs-section">[1]</span>)
56.          <span class="hljs-comment"># User choice sent for game results from the agent</span>
<span class="hljs-attr">57.          prompt</span> = input(<span class="hljs-string">"Your Choice  : "</span>)
<span class="hljs-attr">58.          msg</span> = create_message(text=prompt, context_id=context_id)
59.          async for event in client.send_message(msg):
60.              if isinstance(event, Message):
61.                  print(f"Agent Choice : {agent_choice}")
62.                  print(event.parts<span class="hljs-section">[0]</span>.root.text)

65.  if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
66.      asyncio.run(main())

`AI写代码!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)收起代码块!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/arrowup-line-top-White.png)
</code></pre>
<p>让我们来回顾一下这段代码的作用。从 main() 方法开始，代码首先访问 agent URL 和 API Key 的环境变量。然后我们使用这些值创建一个 httpx 客户端，用于获取该 agent 的 agent card。客户端随后使用 agent card 的详细信息向 agent 发送 “start game” 请求。这里有一个有趣的地方是，我们在 “start game” 请求中包含了 random_game_object 值。这个值是使用 Python 标准库的 random 模块生成的随机数。这样做的原因是，强大的 LLM（使 AI agent 成为可能）在生成随机性方面表现不佳。没问题，Python 来救场。</p>
<p>继续代码，当 agent 响应 “start game” 请求后，代码会提取 agent 的游戏对象选择，并将其保存在 agent_choice 变量中。其余的响应内容以文本形式显示给最终用户。然后提示用户输入他们的游戏对象选择，并将其发送给 agent。代码随后显示 agent 的游戏对象选择以及 agent 对游戏结果的最终判断。</p>
<h2 data-id="heading-7">将 agent URL 和 API Key 设置为环境变量</h2>
<p>由于示例应用将在本地电脑上运行，为了与我们的 Agent Builder agent 通信，我们需要为 Strands Agents SDK 提供 agent 的 A2A URL 和 API Key。示例应用使用名为 .env 的文件来存储这些值。</p>
<p>复制 env.example 文件，并将新文件命名为 .env。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/763b1ca501654248a0a0276d02f951b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=bvBH8uTNDNKkmAMJV73o7gD0LV4%3D" alt="" loading="lazy"/></p>
<p>返回 Elastic Agent Builder，我们可以在这里获取所需的两个值。</p>
<p>从页面右上角的 Agent Builder actions 菜单中选择 <strong>View all tools</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2d658c959d7434d926b1cbfa643131f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=IcqL%2FsByh7TZw2ea%2FUT%2FkZhuH4A%3D" alt="" loading="lazy"/></p>
<p>点击 Tools 页面顶部的 MCP Server 下拉菜单，并选择 Copy MCP Server URL。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d592dee70764e1ab0add80017647311~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=wbzVMyPz5OuD4CnNtjG7xeV%2BY0Y%3D" alt="" loading="lazy"/></p>
<p>将 MCP Server URL 粘贴到 .env 文件中，替换 <strong/> 占位符。现在我们需要对 URL 做一个修改，即将结尾的 “mcp” 替换为 “a2a”，因为 Strands Agents SDK 将使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fa2a-protocol.org%2F" title="https://a2a-protocol.org/" target="_blank" ref="nofollow noopener noreferrer">A2A 协议</a>与运行在 Elastic Agent Builder 中的 agent 通信。</p>
<p>修改后的 URL 应该类似这样：</p>
<pre><code class="hljs language-bash" lang="bash">`https://rps-game-project-12345a.kb.us-east-1.aws.elastic.cloud/api/agent_builder/a2a`AI写代码
</code></pre>
<p>我们在 Elastic Cloud 中还需要获取另一个值 —— API Key。点击顶层导航中的 Elasticsearch。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e06fdc288c463691c3e3e8798786f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=M35GlEN9UdWP478IjJZe3Mn95GE%3D" alt="" loading="lazy"/></p>
<p>点击 Copy API Key 按钮复制 API Key。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895e5561acdc4772b4cef6b258445f19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=qAMx%2B6Pcry9EgdsFE%2Bhjuk%2BsjxM%3D" alt="" loading="lazy"/></p>
<p>现在回到 Visual Studio Code，在 .env 文件中粘贴 API Key，替换 <strong/> 占位符文本。你的 .env 文件应类似如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40e611adbc874a02a2cf1b02b021d378~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Iwij59c8OjdlB3DUGYKjNCd8Zy4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">运行示例应用</h2>
<p>在 Visual Studio Code 中打开一个新终端。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ca6ca135b3e46c384700808ec34006b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=mvGa2uF9tr0ziA0hJDBfHDIxsCw%3D" alt="" loading="lazy"/></p>
<p>首先在终端中运行以下 cd 命令：</p>
<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">cd</span> elasticsearch-labs/supporting-blog-content/agent-builder-a2a-strands-agents`AI写代码
</code></pre>
<p>运行以下命令以创建 Python 虚拟环境。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`python -m venv .venv`</span>AI写代码
</code></pre>
<p>根据你本地电脑的操作系统，运行以下命令来激活虚拟环境。</p>
<ul>
<li>MacOS/Linux</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">source</span> .venv/bin/activate`AI写代码
</code></pre>
<ul>
<li>Windows</li>
</ul>

<pre><code class="hljs language-r" lang="r">`.venv\Scripts\activate`AI写代码
</code></pre>
<p>示例应用使用 Strands Agents SDK，现在我们在本教程中需要安装它。运行以下命令安装 Strands Agents SDK 及其所有必需的 Python 库依赖。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`pip install -r requirements.txt`</span>AI写代码
</code></pre>
<p>是时候清理发射平台并开始倒计时了。我们准备好启动这个应用。后退一步。使用以下命令运行它：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`python elastic_agent_builder_a2a_rps+.py`</span>AI写代码
</code></pre>
<p>你应该会迎来一场 RPS+ 游戏。干得好，祝你好运！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d82240f7964140ecbf371022f215f060~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=EIM%2FG82mftB%2BYa0NMEupOOu8yNw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">用相关上下文构建你的 AI 应用</h2>
<p>构建 AI Agent 现在已成为你的技能工具之一。你已经看到，通过 A2A 使用 Elastic Builder agent 在像 Strands Agents SDK 这样的 agent 开发框架中是多么容易。尝试<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration%3Futm_source%3Dagentic-ai-category%26utm_medium%3Dsearch-labs%26utm_campaign%3Dagent-builder" title="https://cloud.elastic.co/registration?utm_source=agentic-ai-category&amp;utm_medium=search-labs&amp;utm_campaign=agent-builder" target="_blank" ref="nofollow noopener noreferrer">使用 Elastic</a> 构建与自定义数据相关上下文相连接的 AI agent。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fagent-builder-a2a-strands-agents-guide" title="https://www.elastic.co/search-labs/blog/agent-builder-a2a-strands-agents-guide" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniPush 2.0 实战指南：工单提醒与多厂商通道配置]]></title>    <link>https://juejin.cn/post/7583955708318351360</link>    <guid>https://juejin.cn/post/7583955708318351360</guid>    <pubDate>2025-12-16T02:53:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318351360" data-draft-id="7583921477614518307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniPush 2.0 实战指南：工单提醒与多厂商通道配置"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T02:53:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hellsing"/> <meta itemprop="url" content="https://juejin.cn/user/4433705584572302"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniPush 2.0 实战指南：工单提醒与多厂商通道配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4433705584572302/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hellsing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:53:55.000Z" title="Tue Dec 16 2025 02:53:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 方案选型与架构策略</h2>
<h3 data-id="heading-1">1.1 云服务商选择：推荐腾讯云</h3>
<p>在 uniCloud 的服务商选择上，针对企业级项目（尤其是涉及到工单、预警等需要稳定推送的场景），推荐选择 <strong>腾讯云</strong>。</p>
<ul>
<li><strong>核心优势</strong>：开启“云函数 URL 化”时，腾讯云<strong>不需要</strong>重新进行域名备案（ICP备案），可以直接使用腾讯云提供的默认域名。</li>
<li><strong>成本考量</strong>：虽然单价略高于阿里云，但省去了繁琐的行政备案流程，对于项目快速上线和维护极为有利。</li>
</ul>
<h3 data-id="heading-2">1.2 核心业务流程</h3>
<p>我们需要实现的是“点对点”的工单通知，核心逻辑如下：</p>
<ol>
<li><strong>前端（APP端）</strong> ：用户登录后，获取设备的 <code>push_clientid</code>。</li>
<li><strong>绑定关系</strong>：前端调用云函数或接口，将 <code>user_id</code> 与 <code>push_clientid</code> 存入 <code>uni-id-device</code> 表中（建立用户与设备的映射）。</li>
<li><strong>后端触发</strong>：由于工单状态变更通常发生在后台（Java/Python/Go等），后端通过 HTTP 请求调用 <strong>云函数 URL 化接口</strong>。</li>
<li><strong>云函数执行</strong>：云函数根据传入的 <code>user_id</code> 查库找到 CID，调用 <code>uniPush</code> 下发消息。</li>
</ol>
<hr/>
<h2 data-id="heading-3">2. 云函数实现（Core Code）</h2>
<p>此云函数作为统一的推送入口，处理了设备查找和多厂商参数适配。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">const</span> uniPush = uniCloud.<span class="hljs-title function_">getPushManager</span>({ <span class="hljs-attr">appId</span>: <span class="hljs-string">"__UNI__XXXXXX"</span> }) <span class="hljs-comment">// 替换你的 appId</span>
<span class="hljs-keyword">const</span> db = uniCloud.<span class="hljs-title function_">database</span>();
<span class="hljs-keyword">const</span> dbCmd = db.<span class="hljs-property">command</span>;

<span class="hljs-built_in">exports</span>.<span class="hljs-property">main</span> = <span class="hljs-keyword">async</span> (event, context) =&gt; {
    <span class="hljs-comment">// 假设后端通过 POST 请求传入 JSON body</span>
    <span class="hljs-keyword">let</span> body = event.<span class="hljs-property">body</span>;
    <span class="hljs-keyword">if</span>(event.<span class="hljs-property">isBase64Encoded</span>){
        body = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(body, <span class="hljs-string">'base64'</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'utf8'</span>);
    }
    <span class="hljs-keyword">const</span> { userIds, title, content } = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// --- 3. 查库：获取目标用户的 Push Client ID ---</span>
        <span class="hljs-keyword">const</span> deviceRes = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'uni-id-device'</span>)
            .<span class="hljs-title function_">where</span>({
                <span class="hljs-attr">user_id</span>: dbCmd.<span class="hljs-title function_">in</span>(userIds)
            })
            .<span class="hljs-title function_">field</span>({ <span class="hljs-string">'push_clientid'</span>: <span class="hljs-literal">true</span> })
            .<span class="hljs-title function_">get</span>();

        <span class="hljs-keyword">if</span> (deviceRes.<span class="hljs-property">data</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: <span class="hljs-number">404</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">'指定的用户均未绑定任何设备'</span> };
        }

        <span class="hljs-comment">// 去重，防止同一设备收到多条（如果用户多端登录）</span>
        <span class="hljs-keyword">const</span> cids = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(deviceRes.<span class="hljs-property">data</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">push_clientid</span>))];

        <span class="hljs-comment">// --- 4. 执行推送：配置多厂商通道 ---</span>
        <span class="hljs-keyword">const</span> pushRes = <span class="hljs-keyword">await</span> uniPush.<span class="hljs-title function_">sendMessage</span>({
            <span class="hljs-string">"push_clientid"</span>: cids,
            <span class="hljs-string">"title"</span>: title,
            <span class="hljs-string">"content"</span>: content,
            <span class="hljs-string">"force_notification"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 强制显示通知栏</span>
            <span class="hljs-string">"request_id"</span>: context.<span class="hljs-property">requestId</span>,
            <span class="hljs-string">"options"</span>: {
                <span class="hljs-string">"android"</span>: {
                    <span class="hljs-comment">// --- 小米 (XM) 配置 ---</span>
                    <span class="hljs-string">"XM"</span>: {
                        <span class="hljs-comment">// 必须在小米后台申请 Channel ID，否则可能被折叠或静音</span>
                        <span class="hljs-string">"/extra.channel_id"</span>: <span class="hljs-string">"你的小米ChannelID"</span>, 
                    },
                    <span class="hljs-comment">// --- 华为 (HW) 配置 ---</span>
                    <span class="hljs-string">"HW"</span>: {
                        <span class="hljs-comment">// 必须配置自分类权益，"SERVICE" 为服务提醒，权重高于默认</span>
                        <span class="hljs-string">"/message/android/category"</span>: <span class="hljs-string">"WORK"</span>, <span class="hljs-comment">// 或 SERVICE</span>
                    },
                    <span class="hljs-comment">// --- OPPO (OP) 配置 ---</span>
                    <span class="hljs-string">"OP"</span>: {
                        <span class="hljs-string">"/channel_id"</span>: <span class="hljs-string">"你的OPPO通道ID"</span>,
                        <span class="hljs-string">"/category"</span>: <span class="hljs-string">"MARKETING"</span>, <span class="hljs-comment">// 注意：OPPO 营销类消息限制较多，重要通知建议申请私信通道</span>
                        <span class="hljs-string">"/notify_level"</span>: <span class="hljs-number">16</span>
                    },
                    <span class="hljs-comment">// --- VIVO (VV) 配置 ---</span>
                    <span class="hljs-string">"VV"</span>: {
                        <span class="hljs-string">"/classification"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 1: 系统类消息 (需要申请)，0: 运营类</span>
                    }
                }
            }
        });

        <span class="hljs-comment">// --- 5. 返回结果 ---</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">msg</span>: <span class="hljs-string">'推送请求已下发'</span>,
            <span class="hljs-attr">target_user_count</span>: userIds.<span class="hljs-property">length</span>,
            <span class="hljs-attr">target_device_count</span>: cids.<span class="hljs-property">length</span>,
            <span class="hljs-attr">uni_push_result</span>: pushRes
        };

    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">code</span>: <span class="hljs-number">500</span>,
            <span class="hljs-attr">msg</span>: <span class="hljs-string">'服务端内部错误'</span>,
            <span class="hljs-attr">error</span>: e.<span class="hljs-property">message</span>
        };
    }
};
</code></pre>
<hr/>
<h2 data-id="heading-4">3. 安卓厂商特殊配置（必读）</h2>
<p>随着 Android 8.0+ 通知渠道（Notification Channels）的引入，如果不进行额外配置，工单提醒很可能会被归类为“营销广告”从而<strong>静音</strong>或<strong>折叠</strong>。</p>
<h3 data-id="heading-5">3.1 小米 (Xiaomi) 配置</h3>
<p>小米需要创建自定义 Channel 才能让消息正常响铃或震动。</p>
<ol>
<li>
<p><strong>操作路径</strong>：小米开放平台 -&gt; 消息推送 -&gt; 配置管理 -&gt; 通知类别（Channel）管理。</p>
</li>
<li>
<p><strong>申请</strong>：新建一个类别，例如“工单提醒”或“事务通知”。</p>
</li>
<li>
<p><strong>获取 ID</strong>：申请通过后，会获得一个 <code>Channel ID</code>（如 <code>Channel_A</code>）。</p>
</li>
<li>
<p><strong>代码映射</strong>：</p>
<p>JavaScript</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"XM"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"/extra.channel_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你申请的Channel_ID"</span> 
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>：如果不填，默认走“普通消息”通道，限制较多。</p>
</blockquote>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf50699285b04afa816720aa68116146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbHNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458434&amp;x-signature=nYCUnmyTaUN6rzZD50Du60K9qZY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 华为 (Huawei) 配置</h3>
<p>华为引入了“自分类权益”，需要将消息分类为“服务与通讯”类，否则会被当做“资讯营销”处理。</p>
<ol>
<li>
<p><strong>操作路径</strong>：华为开发者联盟 -&gt; 我的项目 -&gt; 推送服务 -&gt; 配置 -&gt; <strong>自分类权益</strong>。</p>
</li>
<li>
<p><strong>申请权益</strong>：点击申请，按照指引填写（通常需要上传APP截图证明场景）。</p>
</li>
<li>
<p><strong>参数设置</strong>：</p>
<ul>
<li>在代码中设置 <code>category</code> 字段。</li>
<li><code>WORK</code>：工作事项提醒（适合工单）。</li>
<li><code>IM</code>：即时聊天。</li>
<li>如果不传，默认为 <code>MARKETING</code>（营销），极易被拦截。</li>
</ul>
<p>JavaScript</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"HW"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"/message/android/category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"WORK"</span> 
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a0e94e85f84de8a5c0bb3d2934204f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbHNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458434&amp;x-signature=GC2VYc560Jc%2FkrvQ2UpNHc1Ezco%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.3 OPPO &amp; VIVO 注意事项</h3>
<ul>
<li><strong>OPPO</strong>：同样有 Channel 概念。私信通道（高权重）需要单独申请邮件报备，且门槛较高。代码中演示的 <code>MARKETING</code> 仅供测试，正式上线建议申请 <code>IM</code> 或业务相关通道。</li>
<li><strong>VIVO</strong>：<code>classification</code> 为 1 代表系统消息，0 代表运营消息。系统消息配额更高，提醒更明显。</li>
</ul>
<hr/>
<h2 data-id="heading-8">4. 故障排查流程 (Troubleshooting)</h2>
<p>当消息没有送达时，请按以下步骤排查：</p>
<h3 data-id="heading-9">📌 阶段一：基础环境检查</h3>
<ol>
<li>
<p><strong>CID 是否获取成功</strong>：前端 <code>uni.getPushClientId</code> 是否拿到了 ID？如果是在模拟器运行，通常无法获取有效的厂商 CID。</p>
</li>
<li>
<p><strong>云函数报错</strong>：查看 uniCloud Web 控制台的云函数日志，检查是否有 <code>appId</code> 不匹配或数据库查询为空的情况。</p>
</li>
<li>
<p><strong>打包检查</strong>：</p>
<ul>
<li>UniPush 2.0 严重依赖应用签名。</li>
<li><strong>必须使用正式签名打包的自定义基座</strong>进行调试，标准基座无法测试厂商通道。</li>
<li>确保 <code>manifest.json</code> 中勾选了 UniPush 2.0 并正确填写了各厂商的 AppID/AppKey。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">📌 阶段二：离线推送检查（厂商通道）</h3>
<p>如果 APP 打开时能收到（走的是个推在线通道），但杀掉进程后收不到（走的是厂商通道），则是<strong>厂商配置问题</strong>。</p>
<ol>
<li>
<p><strong>检查厂商后台开关</strong>：确保在华为/小米等后台，推送服务已“启用”。</p>
</li>
<li>
<p><strong>包名与签名 SHA1</strong>：</p>
<ul>
<li>华为/小米后台填写的 <code>SHA256</code> 或 <code>SHA1</code> 必须与你打包证书的指纹<strong>完全一致</strong>。</li>
<li>这是最常见的错误原因。</li>
</ul>
</li>
<li>
<p><strong>参数映射</strong>：</p>
<ul>
<li>检查云函数代码中 <code>options</code> 里的参数键值对是否按照厂商最新文档编写（如华为的 <code>category</code> 拼写）。</li>
</ul>
</li>
<li>
<p><strong>限流与配额</strong>：</p>
<ul>
<li>如果是测试阶段，某些厂商（如 VIVO/OPPO）对未上架应用的推送数量有限制（如一天只能推几条）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">参考文档</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F40291" target="_blank" title="https://ask.dcloud.net.cn/article/40291" ref="nofollow noopener noreferrer">DCloud 官方：UniPush 2.0 常见问题索引</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F40283" target="_blank" title="https://ask.dcloud.net.cn/article/40283" ref="nofollow noopener noreferrer">DCloud 官方：厂商通道参数设置指南</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[入围AA总榜Top 10，Non-Reasoning Model榜单第一！KAT-Coder-Pro V1 新版本踏浪归来！]]></title>    <link>https://juejin.cn/post/7583933107690422335</link>    <guid>https://juejin.cn/post/7583933107690422335</guid>    <pubDate>2025-12-16T03:00:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690422335" data-draft-id="7583980250733641791" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="入围AA总榜Top 10，Non-Reasoning Model榜单第一！KAT-Coder-Pro V1 新版本踏浪归来！"/> <meta itemprop="keywords" content="前端,后端,前端框架"/> <meta itemprop="datePublished" content="2025-12-16T03:00:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="快手技术"/> <meta itemprop="url" content="https://juejin.cn/user/3736571181793721"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            入围AA总榜Top 10，Non-Reasoning Model榜单第一！KAT-Coder-Pro V1 新版本踏浪归来！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3736571181793721/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    快手技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:00:39.000Z" title="Tue Dec 16 2025 03:00:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>KAT-Coder-Pro V1 迎来 1210 版关键迭代，本次更新聚焦 Agentic Coding 领域核心能力升级，旨在为全球开发者提供更高效、更贴合业务场景的 AI 编码辅助体验。凭借此次迭代，KAT-Coder-Pro V1 在权威评测机构 Artificial Analysis（AA）榜单中表现亮眼，以 64 分综合评分跻身全球总榜 TOP 10，更以绝对优势在 Non-Reasoning Model 中斩获第一名，再次印证其在 AI 编码领域的顶尖实力。</p>
<h3 data-id="heading-0">四大维度深度优化，筑牢 Agentic Coding 核心竞争力</h3>
<p>为应对复杂编程场景，KAT-Coder-Pro V1 新版本围绕开发者实际需求，在以下四大关键维度完成进一步升级：</p>
<ul>
<li>
<p><strong>卓越 Agentic 交互体验</strong>：深度优化了模型在 Claude Code、Kilo Code、Roo Code、Cline、Zed 等数十种主流 Agent 工具中的集成表现，显著提升了模型在不同开发环境下的交互流畅度和响应精确性。</p>
</li>
<li>
<p><strong>强化代码推理与工具调用</strong>：进一步提升了模型的 Agentic Coding 能力，强化模型在不同场景下调用 Coding Tools 和 Web Search Tools 解决实际问题的能力。</p>
</li>
<li>
<p>**提升工具调用稳定性：**降低了工具（API）调用的整体错误率，提升了复杂任务流的稳定性。</p>
</li>
<li>
<p>**增强前端代码生成能力：**通过生成式奖励模型大幅度提升前端页面美感，显著增强了 HTML、CSS、JavaScript 等前端代码的生成质量与准确性。</p>
</li>
</ul>
<h3 data-id="heading-1">AA 榜单成绩亮眼，多维度性能比肩国际顶尖模型</h3>
<p>随着我们进一步提升模型的通用任务能力，KAT-Coder-Pro V1 在 Artificial Analysis（AA）权威评测中展现出全面且强劲的性能提升，核心指标表现如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c35bdbbcf6240b8b76c16a6e7b9c03e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=j2K49up7AAXNazjONHXiGKVSSfk%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>综合排名跻身全球 TOP 10</strong>：Artificial Analysis intelligence index 取得 64 分，综合模型能力排名第十名，超越 Claude 4.5 Sonnet，成为榜单中表现最突出的国产编码模型之一；在 Non-Reasoning Model 赛道中，更是以绝对优势拿下榜单第一。</p>
</li>
<li>
<p><strong>工具调用能力领先</strong>：在𝜏²-Bench Telecom（Agentic Tool Use）中取得 89% 的优异成绩，充分验证其在复杂工具调用场景下的高效性与可靠性。</p>
</li>
<li>
<p><strong>通用任务能力提升</strong>：在各类高难度学科推理基准测试中表现显著提升，进一步贴近实际开发需求，AA-LCR（Long Context Reasoning）达到 74%；Humanity's Last Exam 达到 33.4%；AIME 2025 达到 95%。</p>
</li>
<li>
<p><strong>指令遵循能力突出</strong>：IFBench（Instruction Following）指标达 68%，超过 Claude Opus 4.5、Deepseek V3.2 等模型，能更精准理解开发者意图，减少因指令偏差导致的无效输出，提升开发效率。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/287073d794d541d0a18d01c47386bdb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=%2BmimrOrUtrauGz4Vdm86dWzLTS8%3D" alt="" loading="lazy"/></p>
<p>在 AA 榜单的官方评测结果中，我们也清晰看到了 KAT-Coder-Pro V1 除性能外的其他优点。</p>
<ul>
<li><strong>极致性价比</strong></li>
</ul>
<p>在 AA 评测任务中，KAT-Coder-Pro V1 的输出 Token 消耗量远低于同性能区间的其他模型（如 Claude 4.5 Sonnet、Grok 4.1 Fast）。这意味着，搭配 KAT-Coder-Pro V1 极具竞争力的定价，在真实世界的相同编程任务中，KAT-Coder-Pro V1 能让用户以更低成本获得稳定且高质量的输出，更好的实现了价格与质量的平衡，无疑是 AI 编程场景下极具竞争力的高性价比之选。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d965feb5cdc4fc7b9cf8c42dc56b406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=%2FGokwyyncIabUU0AgzzY6CCMxTI%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>极速响应，保障沉浸式编码体验</strong></li>
</ul>
<p>KAT-Coder-Pro V1 兼具卓越的服务性能，端到端响应耗时也远优于同性能区间的其他模型。在真实开发场景中，响应慢的模型，很容易让开发者陷入 “等待焦虑”，及在 Vibe coding 过程中，需要停下来等待模型加载输出，突然冒出来的思路灵感容易在等待输出的过程中被打断跑偏。KAT-Coder-Pro V1 可以做 “即输即得”，让开发者在沉浸式开发中彻底告别等待，尽享行云流水般的编码体验。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9f0d3d50c5f4e5c80c857c4af7dd2ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=jT8de0CD7SRj1XFr2hHl7ONiZiE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">技术揭秘：如何解决 MOE 模型 RL 训练的不稳定性？</h3>
<p>当前业界大多把模型在 RL 训练时出现 reward 崩溃的问题归因于“训推不一致”。然而，<strong>我们的实验发现：当前阶段 RL 训练不稳定的主导因素并不是训推不一致，而是采样噪声（Sampling Noise）本身</strong>。当我们显式抑制噪声强度后，即使存在明显的训推差异，训练依旧保持稳定，并能获得更快的收敛速度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a772b9e5746841ac9a071a647f8b7fb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=S5dEhAyf3vrSpgDyanyZOo9bxEU%3D" alt="" loading="lazy"/></p>
<p>图中 mean_8(黄线)代表我们提出的抑制采样噪声方法，其余曲线为 TIS 等业界常用方法。对比可见，我们的方法能获得更好的训练效果。</p>
<p><strong>具体技术细节详见：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Flink%3Ftarget%3Dhttps%253A%252F%252Fkwaikat.github.io%252Fkwaikat-blog%252Fposts%252Fkatcoder_1201%252F" target="_blank" title="https://xie.infoq.cn/link?target=https%3A%2F%2Fkwaikat.github.io%2Fkwaikat-blog%2Fposts%2Fkatcoder_1201%2F" ref="nofollow noopener noreferrer">kwaikat.github.io/kwaikat-blo…</a></p>
<h3 data-id="heading-3">便捷接入，限时免费体验顶尖 AI 编码能力</h3>
<p>目前，StreamLake 官方 API 已同步更新，接口与调用方式保持不变。且与 OpenRouter、Novita AI、AtlasCloud、ZenMux 等合作伙伴完成兼容适配，开发者无需重新配置即可继续免费体验最新模型。</p>
<p><strong>开发工具接入指南</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Flink%3Ftarget%3Dhttps%253A%252F%252Fwww.streamlake.com%252Fdocument%252FWANQING%252Fme6ymdjrqv8lp4iq0o9" target="_blank" title="https://xie.infoq.cn/link?target=https%3A%2F%2Fwww.streamlake.com%2Fdocument%2FWANQING%2Fme6ymdjrqv8lp4iq0o9" ref="nofollow noopener noreferrer">www.streamlake.com/document/WA…</a></p>
<p><strong>API KEY 申请</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Flink%3Ftarget%3Dhttps%253A%252F%252Fstreamlake.com%252Fproduct%252Fkat-coder" target="_blank" title="https://xie.infoq.cn/link?target=https%3A%2F%2Fstreamlake.com%2Fproduct%2Fkat-coder" ref="nofollow noopener noreferrer">streamlake.com/product/kat…</a></p>
<p>期待与您携手，共同创造新的未来。</p>
<p>扫码即可进入「KwaiKAT 交流群」获取最新资讯！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f79a638b5fe4dfd8c8706ee875366e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=H%2FAVjl3N9WqORVeqqB2s5bVuQMQ%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[记录曾经打开半屏小程序遇到的事]]></title>    <link>https://juejin.cn/post/7583971282891882548</link>    <guid>https://juejin.cn/post/7583971282891882548</guid>    <pubDate>2025-12-16T02:33:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583971282891882548" data-draft-id="7582529173828141090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="记录曾经打开半屏小程序遇到的事"/> <meta itemprop="keywords" content="前端,微信小程序"/> <meta itemprop="datePublished" content="2025-12-16T02:33:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wangpq"/> <meta itemprop="url" content="https://juejin.cn/user/2172290705137415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            记录曾经打开半屏小程序遇到的事
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290705137415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wangpq
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:33:40.000Z" title="Tue Dec 16 2025 02:33:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今年8月开发新疆项目时，曾接到个需求，需要我们这边配合第三方的小程序（立克办）半屏打开我们的新疆一码游小程序，并且需要做单点登录，从立克办那边直接无感登录我们小程序。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b9cb609343f4d2b8bec25e4e4705ca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=3KqYnWB%2BRltQCYOT7VhGoCW0K7k%3D" alt="53a3eb48-2bf3-4a4e-b000-8b04b21eea40.png" loading="lazy"/></p>
<p>刚开始觉得没多少事，事后做下来，还是出了一些问题。主要原因还是因为涉及第三方，事先缺少沟通，有些东西想当然了。当时听产品描述需求，以为第三方（立克办）那边半屏打开我们的新疆一码游小程序，所有参数都在<code>wx.navigateToMiniProgram</code>方法的<code>path</code>参数里面（实际他们一部分参数在<code>path</code>中，另一部分在<code>extraData</code>中）。结果做完上线生产（第三方没有提供开发版和体验版，只有生产版本），才发现问题，经过和第三方多番线上语言沟通，才搞清楚问题所在，沟通过程中，第三方因为一些理由拒绝修改传参方式，所以我这边又只好配合修改了接收参数方式。最终才线上测试搞定。</p>
<p>啰嗦了半天，还没讲到正题，今天在这里，我主要是想记录以下几个问题，方便以后查阅，都说好记性不如烂笔头嘛，下面开始记录。</p>
<h2 data-id="heading-0">一、关于打开半屏小程序</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fopen-ability%2FopenEmbeddedMiniProgram.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/openEmbeddedMiniProgram.html" ref="nofollow noopener noreferrer">打开半屏小程序</a>，我们可以从微信官方文档中知道，使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fnavigate%2Fwx.openEmbeddedMiniProgram.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/api/navigate/wx.openEmbeddedMiniProgram.html" ref="nofollow noopener noreferrer">wx.openEmbeddedMiniProgram</a> 即可，下面介绍下它的几个重要参数。</p>
<h3 data-id="heading-1">1、envVersion</h3>
<p><code>envVersion</code>表示要打开的小程序版本，包含develop、trial、release,从文档</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa63b09a559b473688009a1cc9a0a1e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=x%2F0Xw1YC7UuSyileyV%2FXqjEj8Hs%3D" alt="a5dbe248-974c-4210-aaea-a4ce93400199.png" loading="lazy"/>
中我们可以了解到，如果主动打开方的小程序未设置<code>envVersion</code>,或者设置为正式版<code>release</code>，那么被打开方的小程序也必须是正式版。通俗讲就是，我开发，你也开发，我体验，你也体验，我正式，你也正式。</p>
<p>如果双方还在开发调试阶段，最好还是设置为体验版<code>trial</code>比较好，双方都是体验版版，方便开发调试，等开发测试没啥问题了，再改为<code>release</code>或者去掉<code>envVersion</code>参数，以避免在正式版发现错误，盲改后再线上测试。</p>
<p>我们当时就是在正式版，我这里只能盲改开发，易出错，效率低。</p>
<h3 data-id="heading-2">2、appId、path、extraData</h3>
<p><code>appId</code>为要打开的小程序 appId，无需多言。<code>path</code>为要打开的页面路径，值为字符串<code>string</code>类型，<code>extraData</code>为需要传递给目标小程序的数据，值为对象<code>object</code>类型。这里的<code>path</code>不仅仅可以设置要打开的小程序页面路径，还能传递参数，path 中 ? 后面的部分会成为 query。</p>
<p>虽然<code>path</code>、<code>extraData</code>两者都可以传递参数，不过大家需要注意两者获取参数的区别。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b71d3f6caa104544b410f7c352abc965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=kjMsfR2%2F0sE3d9WbrUXthEkOig0%3D" alt="2abe8e13-7b1c-4358-a53a-f67382131344.png" loading="lazy"/></p>
<p>从文档中我们已经得知，两者传参方式都可以在app生命周期<code>onLaunch</code>,<code>onShow</code>中获取，只有<code>path</code>传递的参数，可以在页面级生命周期<code>onLoad</code>中取得。这里大家开发的时候，一定得注意。</p>
<p>关于如何获取<code>extraData</code>参数，我们可以在小程序App.vue的<code>onLaunch</code>、<code>onShow</code>中按如下方式获取：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-comment">//onLaunch(opts) {</span>
        <span class="hljs-comment">// let extraData = opts?.referrerInfo?.extraData</span>
    <span class="hljs-comment">//},</span>
    <span class="hljs-comment">// 建议如无特殊要求只执行一次，获取extraData参数，都在onShow中执行</span>
    onShow (opts) {
        <span class="hljs-keyword">let</span> extraData = opts?.<span class="hljs-property">referrerInfo</span>?.<span class="hljs-property">extraData</span>
    }
}
</code></pre>
<p>从上次配合半屏打开小程序，开发单点登录的经验来看，一般写在<code>onShow</code>中最好，大家都知道，<code>onLaunch</code>只在小程序初始化完成时触发，<code>onShow</code>则是当小程序启动，或每次从后台进入前台显示时都会触发。如果没有需求说只要执行一次，那么使用<code>onShow</code>则是最为稳妥。</p>
<p>我当时就是最先写在<code>onLaunch</code>中，导致他们立克办小程序用户打开我们一码游小程序，之后退出我们小程序后(用户没有删除我们一码游小程序)，再次操作，这时，登录失败。原因就是进入我们小程序，不会再执行<code>onLaunch</code>中的代码，获取不到<code>extraData</code>参数，从而导致登录失败。后来我又改到<code>onShow</code>中才解决了问题，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82fb935052fc4e299c636b33bbfb64c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=ry2xHV141IcHINfjPf5Pht833o8%3D" alt="2cd48bac-714f-4799-b0dc-f4bb3ab52d98.png" loading="lazy"/></p>
<h2 data-id="heading-3">二、同时在<code>path</code>、<code>extraData</code>中传了参，被半屏打开的小程序这边，如何处理参数？</h2>
<p>拿我们上次对接立克办为例，后来了解到，他们是这样传的参数，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9228a662e77743ae826b60e7b5ca4d28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=8oo9Ve5efUfzLNJV9fv34FfcPTs%3D" alt="81bb6b34b67ffbcceadd63d319690459.png" loading="lazy"/></p>
<p><code>path</code>中传递了参数<code>?cityCode=650200000000</code>,<code>extraData</code>中传了state、token。从立克办小程序跳转过来，是需要直接进入我们一码游小程序的指定地区的首页。</p>
<p>由于<code>extraData</code>中也有传参，但处理逻辑只能在被跳转的页面中处理，所以我在<code>app.onShow</code>中获取参数后，将参数存储到了store中，这样在页面中就能获取到传递过来的<code>extraData</code>参数了（不过在小程序退出或者退出登录时，记得销毁，避免其他用户登录误用立克办的登录逻辑）。</p>
<p>App.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onUnload</span>(<span class="hljs-params"/>){ 
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'lkbToken'</span>, <span class="hljs-string">""</span>) 
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>, <span class="hljs-literal">null</span>) 
}
</code></pre>
<p>store/index.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">logout</span>(<span class="hljs-params">state</span>) {
    <span class="hljs-comment">// 其他代码已省略</span>
    state.<span class="hljs-property">extraData</span> = <span class="hljs-literal">null</span>
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'extraData'</span>, <span class="hljs-literal">null</span>)
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'lkbToken'</span>,  <span class="hljs-string">""</span>)  
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'platformOpenId'</span>,  <span class="hljs-string">""</span>)
}
</code></pre>
<h2 data-id="heading-4">三、完整的半屏打开小程序，单点登录功能涉及的改动如下：</h2>
<p>1、小程序 App.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  onShow (opt) {
    <span class="hljs-keyword">let</span> extraData = opt?.<span class="hljs-property">referrerInfo</span>?.<span class="hljs-property">extraData</span>
    <span class="hljs-keyword">if</span>(extraData){
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>,extraData);
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>, <span class="hljs-literal">null</span>)
    }
  },
  <span class="hljs-title function_">onUnload</span>(<span class="hljs-params"/>){
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'lkbToken'</span>, <span class="hljs-string">""</span>)  
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>, <span class="hljs-literal">null</span>)
  }
}
</code></pre>
<p>2、小程序 pages/index/main.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">q</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 是否是扫码/传参切换城市,原来设置的是-1，但是当为-1时永远都不可能会展示推荐景区和城市</span>
            query : {},
            lkbLoading : <span class="hljs-literal">false</span>
        };
    },
    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params">opt</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = opt
        <span class="hljs-comment">// 扫描二维码进入小程序，二维码参数获取</span>
        <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">q</span>) {
            <span class="hljs-keyword">const</span> query = <span class="hljs-built_in">decodeURIComponent</span>(opt.<span class="hljs-property">q</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">"?"</span>)[<span class="hljs-number">1</span>];
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$qs</span>.<span class="hljs-title function_">parse</span>(query)
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">cityCode</span>;
        } 
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">cityCode</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span> = opt.<span class="hljs-property">cityCode</span>;
        }
        <span class="hljs-comment">// 立克办半屏打开我们小程序,默认进入克拉玛依首页(这里的opt.token是立克办的token字符串)</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLkbBool</span>() ){
            opt.<span class="hljs-property">cityCode</span>= <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">cityCode</span> || <span class="hljs-string">'650200000000'</span> 
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span> = opt.<span class="hljs-property">cityCode</span>;
            <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"token"</span>)) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">likeBanLogin</span>()
            };
        }
        
         <span class="hljs-comment">// 其他无关逻辑略...</span>
    },

    <span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLkbBool</span>()){
            <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"token"</span>)) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">likeBanLogin</span>()
            };
            <span class="hljs-keyword">return</span> 
        }
        
        <span class="hljs-comment">// 其他无关逻辑略...</span>
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-comment">// 判断是否立克办传参</span>
        <span class="hljs-title function_">getLkbBool</span>(<span class="hljs-params"/>){
            <span class="hljs-keyword">const</span> extraData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>.<span class="hljs-property">extraData</span>;
            <span class="hljs-keyword">return</span> (extraData.<span class="hljs-property">token</span> &amp;&amp; extraData.<span class="hljs-property">state</span>===<span class="hljs-string">'likeban'</span>) || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"lkbToken"</span>)
        },
        <span class="hljs-comment">// 获取小程序登录用户openid等信息</span>
        <span class="hljs-title function_">getOpenId</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                uni.<span class="hljs-title function_">showLoading</span>();
                uni.<span class="hljs-title function_">login</span>({
                    <span class="hljs-comment">//获取登录凭证</span>
                    <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">{ code }</span>) =&gt;</span> {
                        <span class="hljs-keyword">if</span> (code) {
                            <span class="hljs-keyword">let</span> url = <span class="hljs-string">""</span>;
                            <span class="hljs-comment">// #ifdef MP-WEIXIN</span>
                            url = <span class="hljs-string">"/auth/getOpenId"</span>;
                            <span class="hljs-comment">// #endif</span>
                            <span class="hljs-comment">// #ifdef MP-ALIPAY</span>
                            url = <span class="hljs-string">"/auth/getAliPayUserId"</span>;
                            <span class="hljs-comment">// #endif</span>
                            <span class="hljs-comment">//获取 openid</span>
                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$http</span>.<span class="hljs-title function_">post</span>(url, {
                                <span class="hljs-attr">code</span>: code.<span class="hljs-title function_">split</span>(<span class="hljs-string">"&amp;"</span>)[<span class="hljs-number">0</span>],
                            }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
                                uni.<span class="hljs-title function_">hideLoading</span>();
                                <span class="hljs-title function_">resolve</span>(res)
                            }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
                                uni.<span class="hljs-title function_">hideLoading</span>();
                                <span class="hljs-title function_">reject</span>()
                            });
                        }
                    },
                    <span class="hljs-title function_">fail</span>(<span class="hljs-params">err</span>) {
                        uni.<span class="hljs-title function_">hideLoading</span>();
                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"uni.login失败"</span>, err);
                        <span class="hljs-title function_">reject</span>(err)
                    },
                });
            })
        },
        <span class="hljs-comment">// 立克办用户单点登录</span>
        <span class="hljs-title function_">likeBanLogin</span>(<span class="hljs-params"/>){
            <span class="hljs-keyword">const</span> extraToken = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>.<span class="hljs-property">extraData</span>?.<span class="hljs-property">token</span>;
            <span class="hljs-keyword">if</span>(extraToken){
                <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>,<span class="hljs-string">'token'</span>,extraToken)
                uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"lkbToken"</span>,extraToken);
            }
            <span class="hljs-comment">// 这里的query.platformOpenId最终没用到，最先从商城跳转回来使用的 wx.miniProgram.switchTab,</span>
            <span class="hljs-comment">// 实际测试发现无法带参跳转，改为 wx.miniProgram.redirectTo 跳转回小程序中转页 pages/lkb/main.vue 后，</span>
            <span class="hljs-comment">// 已经将 platformOpenId 参数设置在了Storage中（可查看后面的代码）</span>
            <span class="hljs-comment">//let platformOpenId = this.query.platformOpenId || uni.getStorageSync("platformOpenId"); </span>
            <span class="hljs-keyword">let</span> platformOpenId = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>);
            <span class="hljs-keyword">if</span> (!platformOpenId) {
                <span class="hljs-comment">// let url = `${process.env.VUE_APP_H5_HOST}/yytour/wechat/mp-auth?source=${process.env.VUE_APP_SOURCE}&amp;lkbToken=${extraToken}`;</span>
                <span class="hljs-keyword">let</span> url = <span class="hljs-string">`<span class="hljs-subst">${process.env.VUE_APP_H5_HOST}</span>/yytour/wechat/mp-auth?source=<span class="hljs-subst">${process.env.VUE_APP_SOURCE}</span>`</span>;
                uni.<span class="hljs-title function_">redirectTo</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/webView/main?url=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(url)}</span>`</span>,
                });
                <span class="hljs-keyword">return</span> 
            } 

            !uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>) &amp;&amp; uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>, platformOpenId);
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span>){
                <span class="hljs-keyword">return</span> 
            }
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOpenId</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>{
                <span class="hljs-keyword">const</span> data = res.<span class="hljs-property">data</span>
                <span class="hljs-comment">// #ifdef MP-WEIXIN</span>
                uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"openid"</span>, data.<span class="hljs-property">openId</span>);
                <span class="hljs-comment">// #endif</span>
                <span class="hljs-comment">// #ifdef MP-ALIPAY</span>
                uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"aliPayUserId"</span>, data.<span class="hljs-property">aliPayUserId</span>);
                <span class="hljs-comment">// #endif</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"updateUserInfo"</span>, data);
                <span class="hljs-keyword">let</span> storageLkbToken = extraToken || <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">token</span> || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"lkbToken"</span>)
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/auth/miniLoginOfLiKeBan"</span>, {
                    <span class="hljs-attr">openId</span>: data.<span class="hljs-property">openId</span>,
                    <span class="hljs-attr">platformOpenId</span>: data.<span class="hljs-property">platformOpenId</span> || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>),
                    liKeBanEncryptToken : storageLkbToken
                })
                .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"updateUserInfo"</span>, res.<span class="hljs-property">data</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"setToken"</span>, res.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"setShopToken"</span>, res.<span class="hljs-property">data</span>.<span class="hljs-property">merchantToken</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">()=&gt;</span>{
                        <span class="hljs-comment">//this.autoMarketing()</span>
                    })
                }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>{
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">errorCode</span> === <span class="hljs-string">'00012'</span>) {
                        <span class="hljs-keyword">let</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
                            uni.<span class="hljs-title function_">navigateTo</span>({
                                <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/login/main?redirect=true`</span> 
                            })
                            <span class="hljs-built_in">clearTimeout</span>(timer)
                        },<span class="hljs-number">1500</span>)
                    }
                    <span class="hljs-comment">// $http 中已经做提示，这里就不再重复写了</span>
                    <span class="hljs-comment">// else{</span>
                            <span class="hljs-comment">// uni.showToast({ title: res.message, icon: 'none' })</span>
                    <span class="hljs-comment">// }</span>
                });
            })
        },
    }
}
</code></pre>
<p>上面<code>likeBanLogin</code>方法中有一段代码，</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> platformOpenId = <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">platformOpenId</span> || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>);
<span class="hljs-comment">// console.log('---likeBanLogin---platformOpenId---',platformOpenId)</span>
<span class="hljs-keyword">if</span> (!platformOpenId) {
    <span class="hljs-comment">// console.log('---likeBanLogin---!platformOpenId---')</span>
    <span class="hljs-keyword">let</span> url = <span class="hljs-string">`<span class="hljs-subst">${process.env.VUE_APP_H5_HOST}</span>/yytour/wechat/mp-auth?source=<span class="hljs-subst">${process.env.VUE_APP_SOURCE}</span>&amp;lkbToken=<span class="hljs-subst">${extraToken}</span>`</span>;
    uni.<span class="hljs-title function_">redirectTo</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/webView/main?url=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(url)}</span>`</span>,
    });
    <span class="hljs-keyword">return</span> 
} 
</code></pre>
<p>这是我们从商城获取登录接口的必填参数<code>platformOpenId</code>,商城前端用的是H5开发的，具体为啥要获取这个参数，这是这个项目的一些后台逻辑需要，我们没必要去纠结这个问题。</p>
<p>商城H5页面 pages/mp-auth/index.vue</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">if</span> (!code) {
            <span class="hljs-variable language_">this</span>.$toAuthUrl() <span class="hljs-comment">// 去授权 获取code</span>
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 已获取code, 进行登录.</span>
            <span class="hljs-keyword">let</span> newMchId = (source == <span class="hljs-number">1</span> || source == <span class="hljs-number">0</span> || !source) ? mchId : -<span class="hljs-number">1</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'merchant/mch-user/userInfoByCode'</span>, {
              code,
              <span class="hljs-attr">mchId</span>: newMchId
            }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ data }</span>) =&gt;</span> {
              <span class="hljs-keyword">if</span> (!data) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'登录接口出错, data为空'</span>)
                <span class="hljs-keyword">return</span>
              }
              <span class="hljs-comment">// 立克办登录处理逻辑</span>
              <span class="hljs-keyword">if</span>(lkbToken){
                <span class="hljs-comment">// switchTab 无法带参数跳转,使用一个中转页面`/pages/lkb/main`接收参数并处理相应逻辑，然后从中转页面跳转首页`/pages/index/main`</span>
                <span class="hljs-comment">// wx.miniProgram.switchTab({</span>
                <span class="hljs-comment">//   url: `/pages/index/main?platformOpenId=${data.platformOpenId}&amp;token=${lkbToken}`</span>
                <span class="hljs-comment">// })</span>
                wx.<span class="hljs-property">miniProgram</span>.<span class="hljs-title function_">redirectTo</span>({
                  <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/lkb/main?platformOpenId=<span class="hljs-subst">${data.platformOpenId}</span>&amp;token=<span class="hljs-subst">${lkbToken}</span>`</span>
                })
              }<span class="hljs-keyword">else</span>{
                wx.<span class="hljs-property">miniProgram</span>.<span class="hljs-title function_">redirectTo</span>({
                  <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/login/main?platformOpenId=<span class="hljs-subst">${data.platformOpenId}</span>&amp;redirect=<span class="hljs-subst">${redirect}</span>`</span>
                })
              }
            })
          }
        }
    }
</code></pre>
<p>本来登录前从小程序跳转到商城这个页面获取到参数后就可以直接返回小程序首页的，可要返回的小程序页面是tab首页，<code>wx.miniProgram.switchTab</code>的url中无法传递query参数，我只好使用<code>wx.miniProgram.redirectTo</code>，又特意在小程序中建了一个页面文件 <code>pages/lkb/main.vue</code>，用于在小程序中接收从商城H5获取到的登录接口参数<code>platformOpenId</code>。</p>
<p>小程序 pages/lkb/main.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params">opts</span>) {
        <span class="hljs-keyword">let</span> { platformOpenId, token } = opts;
        uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>, platformOpenId);
        <span class="hljs-comment">//token &amp;&amp; uni.setStorageSync("lkbToken", token);</span>
        <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
            uni.<span class="hljs-title function_">switchTab</span>({
                <span class="hljs-attr">url</span>: <span class="hljs-string">"/pages/index/main"</span>
            });
        });
    },
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[插槽(Slots)（完整详细版）]]></title>    <link>https://juejin.cn/post/7583981974408445962</link>    <guid>https://juejin.cn/post/7583981974408445962</guid>    <pubDate>2025-12-16T03:13:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408445962" data-draft-id="7582528397866123291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="插槽(Slots)（完整详细版）"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T03:13:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="nnnnna"/> <meta itemprop="url" content="https://juejin.cn/user/248908298065256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            插槽(Slots)（完整详细版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/248908298065256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    nnnnna
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:13:40.000Z" title="Tue Dec 16 2025 03:13:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、匿名插槽</h2>
<h3 data-id="heading-1">1.适用场景</h3>
<p>子组件中只有一个位置允许父组件自定义内容</p>
<h3 data-id="heading-2">2.使用方法</h3>
<p>第一步：在子组件中定义slot插槽</p>
<pre><code class="hljs language-子组件" lang="子组件">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot&gt;&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>第二步：在父组件中的子组件标签内直接填写需要插入的内容</p>
<pre><code class="hljs language-父组件" lang="父组件">&lt;template&gt;
  &lt;div&gt;
    &lt;TestComOne&gt;
      &lt;p&gt;插入的新内容&lt;/p&gt;
    &lt;/TestComOne&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>最终在子组件渲染出来的结果：</p>
<pre><code class="hljs language-渲染" lang="渲染">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;p&gt;插入的新内容&lt;/p&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>当父组件中没有提供插槽内容时，我们也可以给子组件的插槽中添加默认内容</p>
<pre><code class="hljs language-添加默认内容" lang="添加默认内容">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot&gt;默认内容&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>最终在子组件渲染出来的结果：</p>
<pre><code class="hljs language-渲染" lang="渲染">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    默认内容
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-3">二、具名插槽</h2>
<h3 data-id="heading-4">1.适用场景</h3>
<p>子组件中有多个位置允许父组件自定义内容</p>
<h3 data-id="heading-5">2.使用方法</h3>
<p>第一步：在子组件中定义多个slot插槽，并且为每个插槽添加一个特殊的attribute <code>name</code></p>
<pre><code class="hljs language-多个插槽" lang="多个插槽">&lt;template&gt;
  &lt;div&gt;
    &lt;slot name="slotTop"&gt;&lt;/slot&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot name="slotContent"&gt;&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
    &lt;slot name="slotBottom"&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>第二步：在父组件中使用对应的插槽名</p>
<pre><code class="hljs language-父组件中使用多个插槽" lang="父组件中使用多个插槽">&lt;template&gt;
  &lt;div&gt;
    &lt;TestComOne&gt;
      &lt;template #slotTop&gt;头部上面&lt;/template&gt;
      &lt;template #slotContent&gt;中间&lt;/template&gt;
      &lt;template #slotBottom&gt;尾部下面&lt;/template&gt;
    &lt;/TestComOne&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-6">三、作用域插槽</h2>
<h3 data-id="heading-7">1.为什么要使用作用域插槽</h3>
<p>在某些场景下，我们想要插槽的内容使用到子组件域内的数据，这时候就需要用到插槽</p>
<h3 data-id="heading-8">2.使用方法</h3>
<p>第一步：在子组件中，可以像组件传递props那样，向一个插槽slot传递<code>attributes</code></p>
<pre><code class="hljs language-子组件添加attributes" lang="子组件添加attributes">&lt;template&gt;
  &lt;div&gt;
    &lt;slot name="slotTop"&gt;&lt;/slot&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot name="slotContent" height="180" :list="list"&gt;&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
    &lt;slot name="slotBottom"&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from "vue";
const list = ref({ name: "张三", old: 18 });
&lt;/script&gt;
</code></pre>
<p>第二步：在父组件中使用解构赋值，拿到对应的值</p>
<pre><code class="hljs language-父组件中使用" lang="父组件中使用">&lt;template&gt;
  &lt;div&gt;
    &lt;TestComOne&gt;
      &lt;template #slotContent="{ height, list }"&gt;
        &lt;p&gt;身高：{{ height }}&lt;/p&gt;
        &lt;p&gt;姓名：{{ list.name }}&lt;/p&gt;
        &lt;p&gt;年龄：{{ list.old }}&lt;/p&gt;
      &lt;/template&gt;
    &lt;/TestComOne&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import TestComOne from "./components/index.vue";
&lt;/script&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手教你用 RAG 打造专属知识库问答系统]]></title>    <link>https://juejin.cn/post/7583921477614239779</link>    <guid>https://juejin.cn/post/7583921477614239779</guid>    <pubDate>2025-12-16T02:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477614239779" data-draft-id="7583955708317990912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手教你用 RAG 打造专属知识库问答系统"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T02:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星浩AI"/> <meta itemprop="url" content="https://juejin.cn/user/2904236059009760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手教你用 RAG 打造专属知识库问答系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2904236059009760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星浩AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:15:17.000Z" title="Tue Dec 16 2025 02:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E4%B8%80rag%E7%AE%80%E4%BB%8B" title="#%E4%B8%80rag%E7%AE%80%E4%BB%8B">一、RAG简介</a></li>
<li><a href="#%E4%BA%8Cembedding%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9" title="#%E4%BA%8Cembedding%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9">二、Embedding模型选择</a></li>
<li><a href="#%E4%B8%89rag%E5%AE%9E%E6%88%98" title="#%E4%B8%89rag%E5%AE%9E%E6%88%98">三、RAG实战</a></li>
<li><a href="#%E5%9B%9Blangchain%E4%B8%AD%E7%9A%84%E9%97%AE%E7%AD%94%E9%93%BE" title="#%E5%9B%9Blangchain%E4%B8%AD%E7%9A%84%E9%97%AE%E7%AD%94%E9%93%BE">四、LangChain中的问答链</a></li>
<li><a href="#%E4%BA%94%E5%A6%82%E6%9E%9Cllm%E5%8F%AF%E4%BB%A5%E5%A4%84%E7%90%86%E6%97%A0%E9%99%90%E4%B8%8A%E4%B8%8B%E6%96%87rag%E8%BF%98%E6%9C%89%E6%84%8F%E4%B9%89%E5%90%97" title="#%E4%BA%94%E5%A6%82%E6%9E%9Cllm%E5%8F%AF%E4%BB%A5%E5%A4%84%E7%90%86%E6%97%A0%E9%99%90%E4%B8%8A%E4%B8%8B%E6%96%87rag%E8%BF%98%E6%9C%89%E6%84%8F%E4%B9%89%E5%90%97">五、如果LLM可以处理无限上下文，RAG还有意义吗？</a></li>
</ol>
<hr/>
<p>大模型能力强大，却受限于静态知识库，还容易"一本正经地胡说八道"。RAG（检索增强生成）正是破局关键！本文深入浅出讲解 RAG 的核心原理——通过实时检索外部知识库，为生成模型注入最新、最准的上下文信息，显著提升回答的准确性、专业性与可解释性。</p>
<p>带你<strong>从零搭建本地 RAG 系统</strong>：使用 PyPDF2 解析 PDF、DashScope 嵌入模型向量化、Faiss 构建高效检索库，并通过 LangChain 调用 DeepSeek 大模型实现智能问答。全流程覆盖数据预处理、索引构建到问答生成，附关键技术细节与工程实践建议。</p>
<p>无论你是开发者、AI 爱好者，还是企业技术决策者，这篇干货都能帮你快速掌握 RAG 落地的核心能力！</p>
<hr/>
<h2 data-id="heading-1">一、RAG简介</h2>
<h3 data-id="heading-2">1. 什么是RAG？</h3>
<p><strong>RAG（Retrieval-Augmented Generation）：</strong></p>
<p>检索增强生成，是一种结合信息检索（Retrieval）和文本生成（Generation）的技术。</p>
<p>RAG技术通过实时检索相关文档或信息，并将其作为上下文输入到生成模型中，从而提高生成结果的时效性和准确性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7093c10b77e6404a916a6c430d91a3d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=z4ypXr30oYGdWzQ2QSYHs%2B6IN8g%3D" alt="img_1.jpg" loading="lazy"/></p>
<h3 data-id="heading-3">2. RAG的优势是什么？</h3>
<ul>
<li>
<p><strong>解决知识时效性问题</strong><br/>
大模型的训练数据通常是静态的，无法涵盖最新信息，而RAG可以检索外部知识库实时更新信息。</p>
</li>
<li>
<p><strong>减少模型幻觉</strong><br/>
通过引入外部知识，RAG能够减少模型生成虚假或不准确内容的可能性。</p>
</li>
<li>
<p><strong>提升专业领域回答质量</strong><br/>
RAG能够结合垂直领域的专业知识库，生成更具专业深度的回答。</p>
</li>
<li>
<p><strong>生成内容的溯源（可解释性）</strong></p>
</li>
</ul>
<h3 data-id="heading-4">3. RAG 的核心原理与流程</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f2f0580e6cf4700ab79c85d5b1b9044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=Ug3S4qdCTYRUyEKs4IyOTfdDoKQ%3D" alt="img_2.jpg" loading="lazy"/></p>
<p><strong>步骤1：数据预处理，构建索引库</strong></p>
<ul>
<li>
<p><strong>知识库构建：</strong><br/>
收集并整理文档、网页、数据库等多源数据，构建外部知识库。</p>
</li>
<li>
<p><strong>文档分块：</strong><br/>
将文档切分为适当大小的片段（chunks），以便后续检索。分块策略需要在语义完整性与检索效率之间取得平衡。</p>
</li>
<li>
<p><strong>向量化处理</strong><br/>
使用嵌入模型（如BGE、M3E、ChineseAlpaca2等）将文本块转换为向量，并存储在向量数据库中</p>
</li>
</ul>
<p><strong>步骤2：检索阶段</strong></p>
<ul>
<li>
<p><strong>查询处理</strong><br/>
将用户输入的问题转换为向量，并在向量数据库中进行相似度检索，找到最相关的文本片段。</p>
</li>
<li>
<p><strong>重排序</strong><br/>
对检索结果进行相关性排序，选择最相关的片段作为生成阶段的输入。</p>
</li>
</ul>
<p><strong>步骤3：生成阶段</strong></p>
<ul>
<li>
<p><strong>上下文组装</strong><br/>
将检索到的相关文档片段与用户问题组合，形成完整的上下文。</p>
</li>
<li>
<p><strong>生成回答</strong><br/>
将组合后的上下文输入到生成模型中，生成最终答案。</p>
</li>
</ul>
<blockquote>
<p>💡 <strong>划重点：</strong> RAG本质上就是重构了一个新的 Prompt！</p>
</blockquote>
<h3 data-id="heading-5">4. NativeRAG</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd85c5e7c0564c34aaab273dd0827abf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=CzjtYuAkXR%2B77qgf41tTqlo%2Fauk%3D" alt="img_3.jpg" loading="lazy"/></p>
<p><strong>NativeRAG的步骤：</strong></p>
<ul>
<li>
<p><strong>Indexing</strong><br/>
如何更好地把知识存起来。</p>
</li>
<li>
<p><strong>Retrieval</strong><br/>
如何在大量的知识中，找到一小部分有用的，给到模型参考。</p>
</li>
<li>
<p><strong>Generation</strong><br/>
如何结合用户的提问和检索到的知识，让模型生成有用的答案。</p>
</li>
</ul>
<blockquote>
<p>⚠️ <strong>提示：</strong> 上面三个步骤虽然看似简单，但在 RAG 应用从构建到落地实施的整个过程中，涉及较多复杂的工作内容！</p>
</blockquote>
<h3 data-id="heading-6">5. Prompt vs RAG vs Fine-tuning 什么时候使用？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49706febc28c4892ab83c9645f8ed214~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=Bg%2FishuklGgWouRk0MhUi4u45Eo%3D" alt="img_4.jpg" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">二、Embedding模型选择</h2>
<h3 data-id="heading-8">1. 通用文本嵌入模型</h3>
<p><strong>BGE-M3（智源研究院）</strong></p>
<ul>
<li><strong>特点：</strong> 支持100+语言，输入长度达8192tokens，融合密集、稀疏、多向量混合检索，适合跨语言长文档检索。</li>
<li><strong>适用场景：</strong> 跨语言长文档检索、高精度RAG应用。</li>
<li><strong>文件大小：</strong> 2.3G</li>
</ul>
<p><strong>text-embedding-3-large（OpenAI）</strong></p>
<ul>
<li><strong>特点：</strong> 向量维度3072维，长文本语义捕捉能力强，英文表现优秀。</li>
<li><strong>适用场景：</strong> 英文内容优先的全球化应用。</li>
</ul>
<p><strong>jina-embedding-v2-small（Jina AI）</strong></p>
<ul>
<li><strong>特点：</strong> 参数量仅35M，支持实时推理（RT&lt;50ms），适合轻量化部署。</li>
<li><strong>适用场景：</strong> 轻量级文本处理、实时推理任务。</li>
</ul>
<h3 data-id="heading-9">2. 中文嵌入模型</h3>
<p><strong>M3E-Base</strong></p>
<ul>
<li><strong>特点：</strong> 针对中文优化的轻量模型，适合本地化部署。</li>
<li><strong>适用场景：</strong> 中文法律、医疗领域检索任务。</li>
<li><strong>文件大小：</strong> 0.4G</li>
</ul>
<p><strong>xiaobu-embedding-v2</strong></p>
<ul>
<li><strong>特点：</strong> 针对中文语义优化，语义理解能力强。</li>
<li><strong>适用场景：</strong> 中文文本分类、语义检索。</li>
</ul>
<p><strong>stella-mrl-large-zh-v3.5-1792</strong></p>
<ul>
<li><strong>特点：</strong> 处理大规模中文数据能力强，捕捉细微语义关系。</li>
<li><strong>适用场景：</strong> 中文文本高级语义分析、自然语言处理任务。</li>
</ul>
<h3 data-id="heading-10">3. 指令驱动与复杂任务模型</h3>
<p><strong>gte-Qwen2-7B-instruct（阿里巴巴）</strong></p>
<ul>
<li><strong>特点：</strong> 基于Qwen大模型微调，支持代码与文本跨模态检索。</li>
<li><strong>适用场景：</strong> 复杂指令驱动任务、智能问答系统。</li>
</ul>
<p><strong>E5-mistral-7B（Microsoft）</strong></p>
<ul>
<li><strong>特点：</strong> 基于Microsoft架构，Zero-shot任务表现优异。</li>
<li><strong>适用场景：</strong> 动态调整语义密度的复杂系统。</li>
</ul>
<h3 data-id="heading-11">4. 企业级与复杂系统</h3>
<p><strong>BGE-M3（智源研究院）</strong></p>
<ul>
<li><strong>特点：</strong> 适合企业级部署，支持混合检索。</li>
<li><strong>适用场景：</strong> 企业级语义检索、复杂RAG应用。</li>
</ul>
<p><strong>E5-mistral-7B（Microsoft）</strong></p>
<ul>
<li><strong>特点：</strong> 适合企业级部署，支持指令微调。</li>
<li><strong>适用场景：</strong> 需要动态调整语义密度的复杂系统。</li>
</ul>
<h3 data-id="heading-12">5. CASE-BGE-M3使用</h3>
<p><strong>模型下载</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> FlagEmbedding <span class="hljs-keyword">import</span> BGEM3FlagModel
model = BGEM3FlagModel(<span class="hljs-string">'/root/models/BAAI/bge-m3'</span>,
                       use_fp16=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> FlagEmbedding <span class="hljs-keyword">import</span> BGEM3FlagModel
model = BGEM3FlagModel(<span class="hljs-string">'/root/models/BAAI/bge-m3'</span>,
                       use_fp16=<span class="hljs-literal">True</span>)
sentences_1 = [<span class="hljs-string">"什么是 BGE M3？"</span>, <span class="hljs-string">"BM25 的定义"</span>]
sentences_2 = [<span class="hljs-string">"BGE M3 是一种嵌入模型，支持稠密检索、词汇匹配和多向量交互。"</span>,
               <span class="hljs-string">"BM25 是一种基于词袋的检索函数，根据查询词在每个文档中出现的情况对文档集合进行排序。"</span>]
embeddings_1 = model.encode(sentences_1,
                            batch_size=<span class="hljs-number">12</span>,
                            max_length=<span class="hljs-number">8192</span>,  <span class="hljs-comment"># 如果不需要这么长的长度，可以设置一个较小的值以加快编码速度。</span>
                            )[<span class="hljs-string">'dense_vecs'</span>]
embeddings_2 = model.encode(sentences_2)[<span class="hljs-string">'dense_vecs'</span>]
similarity = embeddings_1 @ embeddings_2.T
<span class="hljs-built_in">print</span>(similarity)
<span class="hljs-comment"># [[0.6265, 0.3477], [0.3499, 0.678 ]]</span>
</code></pre>
<p><strong>代码解释</strong></p>
<ul>
<li>
<p><code>similarity = embeddings_1 @ embeddings_2.T</code><br/>
计算两组嵌入向量（embeddings）之间的相似度矩阵。<br/>
<code>embeddings_1</code>包含了第一组句子(sentences_1)的嵌入向量，形状为[sentences_1的数量，嵌入维度]<br/>
<code>embeddings_2</code>包含了第二组句子(sentences_2)的嵌入向量，形状为[sentences_2的数量，嵌入维度]<br/>
<code>embeddings_2.T</code>是对embeddings_2进行转置操作，形态变为[嵌入维度，sentences_2的数量]</p>
</li>
<li>
<p><code>@</code>符号在Python中表示矩阵乘法运算<br/>
通过矩阵乘法计算了两组句子之间的余弦相似度矩阵。结果similarity形状是[sentences_1的数量，sentences_2的数量]</p>
</li>
</ul>
<h3 data-id="heading-13">6. gte-qwen2使用</h3>
<p><strong>模型下载</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
model_dir = <span class="hljs-string">"/root/models/iic/gte_Qwen2-1___5B-instruct"</span>
model = SentenceTransformer(model_dir, trust_remote_code=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
model_dir = <span class="hljs-string">"/root/models/iic/gte_Qwen2-1___5B-instruct"</span>
model = SentenceTransformer(model_dir, trust_remote_code=<span class="hljs-literal">True</span>)
model.max_seq_length = <span class="hljs-number">8192</span>
queries = [    <span class="hljs-string">"女性每天应该摄入多少蛋白质？"</span>,    <span class="hljs-string">""</span>summit<span class="hljs-string">"的定义是什么？"</span>,]
documents = [    <span class="hljs-string">"根据一般指南，美国疾控中心（CDC）建议19至70岁女性每日平均蛋白质摄入量为46克。但如下面图表所示，如果你正在备孕或备战马拉松，就需要增加摄入量。请查看下方图表，了解你每天应摄入多少蛋白质。"</span>,    <span class="hljs-string">""</span>summit<span class="hljs-string">"对英语学习者的定义：1. 山的最高点；山顶。2. 最高水平。3. 两个或多个国家领导人之间的会议或系列会议。"</span>,]
document_embeddings = model.encode(documents)
<span class="hljs-built_in">print</span>(scores.tolist())
</code></pre>
<hr/>
<h2 data-id="heading-14">三、RAG实战</h2>
<p>基于LangChain，采用DeepSeek+Faiss快速搭建本地知识库检索。</p>
<h3 data-id="heading-15">3.1 环境准备</h3>
<ol>
<li>
<p>本地安装好Conda环境</p>
</li>
<li>
<p>推荐使用阿里大模型平台百炼：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F" target="_blank" title="https://bailian.console.aliyun.com/" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/</a></p>
</li>
<li>
<p>百炼平台使用：注册登录、申请api key。</p>
</li>
</ol>
<h3 data-id="heading-16">3.2 技术选型</h3>
<ul>
<li><strong>向量数据库：</strong> Faiss作为高效的向量检索</li>
<li><strong>嵌入模型：</strong> 阿里云DashScope的text-embedding-v1</li>
<li><strong>大语言模型：</strong> deepseek-v3</li>
<li><strong>文档处理：</strong> PyPDF2用于PDF文本提取</li>
</ul>
<h3 data-id="heading-17">3.3 程序逻辑结构介绍</h3>
<p><strong>步骤1：文档预处理</strong></p>
<p>PDF文件 → 文本提取 → 文本分割 → 页码映射</p>
<p><strong>1) PDF文本提取</strong></p>
<ul>
<li>逐页提取文本内容</li>
<li>记录每行文本对应的页码信息</li>
<li>处理空页和异常情况</li>
</ul>
<p><strong>2）文本分割策略</strong></p>
<ul>
<li>使用递归字符分割器</li>
<li>分割参数：<code>chunk_size=1000</code>, <code>chunk_overlap=200</code></li>
<li>分割优先级：段落 → 句子 → 空格 → 字符</li>
</ul>
<p><strong>3）页面映射处理</strong></p>
<ul>
<li>基于字符位置计算每个文本块的页面</li>
<li>使用众数统计确定文本块的主要来源页码</li>
<li>建立文本块与页码的映射关系</li>
</ul>
<p><strong>步骤2：知识库构建</strong></p>
<p>文本块 → 嵌入向量 → Faiss索引 → 本地持久化</p>
<p><strong>1）向量数据库构建</strong></p>
<ul>
<li>使用DashScope嵌入模型生成向量</li>
<li>将向量存储到Faiss索引结构</li>
</ul>
<p><strong>2）数据持久化</strong></p>
<ul>
<li>保存Faiss索引文件（.faiss）</li>
<li>保存元数据信息（.pkl）</li>
<li>保存页码映射关系（page_info.pkl）</li>
</ul>
<p><strong>步骤3：问答查询</strong></p>
<p>用户问题 → 向量检索 → 文档组合 → LLM生成 → 答案输出</p>
<p><strong>1）相似度检索</strong></p>
<ul>
<li>将用户问题转换为向量</li>
<li>在Faiss中搜索最相似的文档块，返回Top-K相关文档</li>
</ul>
<p><strong>2）问答链处理</strong></p>
<ul>
<li>使用LangChain的<code>load_qa_chain</code></li>
<li>采用stuff策略组合文档</li>
<li>将组合后的上下文和问题发送给LLM</li>
</ul>
<p><strong>3）答案生成与展示</strong></p>
<h3 data-id="heading-18">3.4 代码实例</h3>
<p><strong>安装依赖的包</strong></p>
<pre><code class="hljs language-bash" lang="bash">!pip install pypdf2
!pip install dashscope
!pip install langchain
!pip install langchain-openai
!pip install langchain-community
!pip install faiss-cpu
</code></pre>
<p><strong>导入依赖的包</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> PyPDF2 <span class="hljs-keyword">import</span> PdfReader
<span class="hljs-keyword">from</span> langchain.chains.question_answering <span class="hljs-keyword">import</span> load_qa_chain
<span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter
<span class="hljs-keyword">from</span> langchain_community.embeddings <span class="hljs-keyword">import</span> DashScopeEmbeddings
<span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> FAISS
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> pickle
</code></pre>
<p><strong>从PDF中提取文本并记录每个字符对应的页码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_text_with_page_numbers</span>(<span class="hljs-params">pdf</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]]]:
    <span class="hljs-string">"""
    从PDF中提取文本并记录每个字符对应的页码
    参数:
        pdf: PDF文件对象
    返回:
        text: 提取的文本内容
        char_page_mapping: 每个字符对应的页码列表
    """</span>
    text = <span class="hljs-string">""</span>
    char_page_mapping = []
    <span class="hljs-keyword">for</span> page_number, page <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(pdf.pages, start=<span class="hljs-number">1</span>):
        extracted_text = page.extract_text()
        <span class="hljs-keyword">if</span> extracted_text:
            text += extracted_text
            <span class="hljs-comment"># 为当前页面的每个字符记录页码</span>
            char_page_mapping.extend([page_number] * <span class="hljs-built_in">len</span>(extracted_text))
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"No text found on page <span class="hljs-subst">{page_number}</span>."</span>)
    <span class="hljs-keyword">return</span> text, char_page_mapping
</code></pre>
<p><strong>处理文本并创建向量存储</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_text_with_splitter</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span>, char_page_mapping: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], save_path: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>) -&gt; FAISS:
    <span class="hljs-string">"""
    处理文本并创建向量存储
    参数:
        text: 提取的文本内容
        char_page_mapping: 每个字符对应的页码列表
        save_path: 可选，保存向量数据库的路径
    返回:
        knowledgeBase: 基于FAISS的向量存储对象
    """</span>
    <span class="hljs-comment"># 创建文本分割器，用于将长文本分割成小块</span>
    text_splitter = RecursiveCharacterTextSplitter(
        separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"."</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>],
        chunk_size=<span class="hljs-number">1000</span>,
        chunk_overlap=<span class="hljs-number">200</span>,
        length_function=<span class="hljs-built_in">len</span>,
    )
    <span class="hljs-comment"># 分割文本</span>
    chunks = text_splitter.split_text(text)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文本被分割成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunks)}</span> 个块。"</span>)
    <span class="hljs-comment"># 创建嵌入模型</span>
    embeddings = DashScopeEmbeddings(
        model=<span class="hljs-string">"text-embedding-v1"</span>,
        dashscope_api_key=DASHSCOPE_API_KEY,
    )
    <span class="hljs-comment"># 从文本块创建知识库</span>
    knowledgeBase = FAISS.from_texts(chunks, embeddings)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"已从文本块创建知识库。"</span>)
    <span class="hljs-comment"># 为每个文本块找到对应的页码信息</span>
    page_info = {}
    current_pos = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks:
        chunk_start = current_pos
        chunk_end = current_pos + <span class="hljs-built_in">len</span>(chunk)
        <span class="hljs-comment"># 找到这个文本块中字符对应的页码</span>
        chunk_pages = char_page_mapping[chunk_start:chunk_end]
        <span class="hljs-comment"># 取页码的众数（出现最多的页码）作为该块的页码</span>
        <span class="hljs-keyword">if</span> chunk_pages:
            <span class="hljs-comment"># 统计每个页码出现的次数</span>
            page_counts = {}
            <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> chunk_pages:
                page_counts[page] = page_counts.get(page, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
            <span class="hljs-comment"># 找到出现次数最多的页码</span>
            most_common_page = <span class="hljs-built_in">max</span>(page_counts, key=page_counts.get)
            page_info[chunk] = most_common_page
        <span class="hljs-keyword">else</span>:
            page_info[chunk] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 默认页码</span>
        current_pos = chunk_end
    knowledgeBase.page_info = page_info
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'页码映射完成，共 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(page_info)}</span> 个文本块'</span>)
    <span class="hljs-comment"># 如果提供了保存路径，则保存向量数据库和页码信息</span>
    <span class="hljs-keyword">if</span> save_path:
        <span class="hljs-comment"># 确保目录存在</span>
        os.makedirs(save_path, exist_ok=<span class="hljs-literal">True</span>)
        <span class="hljs-comment"># 保存FAISS向量数据库</span>
        knowledgeBase.save_local(save_path)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"向量数据库已保存到: <span class="hljs-subst">{save_path}</span>"</span>)
        <span class="hljs-comment"># 保存页码信息到同一目录</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(save_path, <span class="hljs-string">"page_info.pkl"</span>), <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> f:
            pickle.dump(page_info, f)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"页码信息已保存到: <span class="hljs-subst">{os.path.join(save_path, <span class="hljs-string">'page_info.pkl'</span>)}</span>"</span>)
    <span class="hljs-keyword">return</span> knowledgeBase
</code></pre>
<p><strong>从磁盘加载向量数据库和页码信息</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_knowledge_base</span>(<span class="hljs-params">load_path: <span class="hljs-built_in">str</span>, embeddings = <span class="hljs-literal">None</span></span>) -&gt; FAISS:
    <span class="hljs-string">"""
    从磁盘加载向量数据库和页码信息
    参数:
        load_path: 向量数据库的保存路径
        embeddings: 可选，嵌入模型。如果为None，将创建一个新的DashScopeEmbeddings实例
    返回:
        knowledgeBase: 加载的FAISS向量数据库对象
    """</span>
    <span class="hljs-comment"># 如果没有提供嵌入模型，则创建一个新的</span>
    <span class="hljs-keyword">if</span> embeddings <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        embeddings = DashScopeEmbeddings(
            model=<span class="hljs-string">"text-embedding-v1"</span>,
            dashscope_api_key=DASHSCOPE_API_KEY,
        )
    <span class="hljs-comment"># 加载FAISS向量数据库，添加allow_dangerous_deserialization=True参数以允许反序列化</span>
    knowledgeBase = FAISS.load_local(load_path, embeddings, allow_dangerous_deserialization=<span class="hljs-literal">True</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"向量数据库已从 <span class="hljs-subst">{load_path}</span> 加载。"</span>)
    <span class="hljs-comment"># 加载页码信息</span>
    page_info_path = os.path.join(load_path, <span class="hljs-string">"page_info.pkl"</span>)
    <span class="hljs-keyword">if</span> os.path.exists(page_info_path):
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(page_info_path, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> f:
            page_info = pickle.load(f)
        knowledgeBase.page_info = page_info
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"页码信息已加载。"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"警告: 未找到页码信息文件。"</span>)
    <span class="hljs-keyword">return</span> knowledgeBase
</code></pre>
<p><strong>读取PDF文件，并写入到知识库</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 读取PDF文件</span>
pdf_reader = PdfReader(<span class="hljs-string">'./考核办法.pdf'</span>)
<span class="hljs-comment"># 提取文本和页码信息</span>
text, char_page_mapping = extract_text_with_page_numbers(pdf_reader)
<span class="hljs-comment">#print('page_numbers=',page_numbers)</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"提取的文本长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(text)}</span> 个字符。"</span>)
<span class="hljs-comment"># 处理文本并创建知识库，同时保存到磁盘</span>
save_dir = <span class="hljs-string">"./vector_db"</span>
knowledgeBase = process_text_with_splitter(text, char_page_mapping, save_path=save_dir)
</code></pre>
<p><strong>如何加载已保存的向量数据库</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建嵌入模型</span>
embeddings = DashScopeEmbeddings(
    model=<span class="hljs-string">"text-embedding-v1"</span>,
    dashscope_api_key=DASHSCOPE_API_KEY,
)
<span class="hljs-comment"># 从磁盘加载向量数据库</span>
loaded_knowledgeBase = load_knowledge_base(<span class="hljs-string">"./vector_db"</span>, embeddings)
<span class="hljs-comment"># 使用加载的知识库进行查询</span>
docs = loaded_knowledgeBase.similarity_search(<span class="hljs-string">"客户经理每年评聘申报时间是怎样的？"</span>)
<span class="hljs-comment"># 直接使用FAISS.load_local方法加载（替代方法）</span>
<span class="hljs-comment"># loaded_knowledgeBase = FAISS.load_local("./vector_db", embeddings, allow_dangerous_deserialization=True)</span>
<span class="hljs-comment"># 注意：使用这种方法加载时，需要手动加载页码信息</span>
</code></pre>
<p><strong>对话调用</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_community.llms <span class="hljs-keyword">import</span> Tongyi
llm = Tongyi(model_name=<span class="hljs-string">"deepseek-v3"</span>, dashscope_api_key=DASHSCOPE_API_KEY) <span class="hljs-comment"># qwen-turbo</span>
<span class="hljs-comment"># 设置查询问题</span>
query = <span class="hljs-string">"客户经理被投诉了，投诉一次扣多少分"</span>
<span class="hljs-comment">#query = "客户经理每年评聘申报时间是怎样的？"</span>
<span class="hljs-keyword">if</span> query:
    <span class="hljs-comment"># 执行相似度搜索，找到与查询相关的文档</span>
    docs = knowledgeBase.similarity_search(query,k=<span class="hljs-number">10</span>)
    <span class="hljs-comment"># 加载问答链</span>
    chain = load_qa_chain(llm, chain_type=<span class="hljs-string">"stuff"</span>)
    <span class="hljs-comment"># 准备输入数据</span>
    input_data = {<span class="hljs-string">"input_documents"</span>: docs, <span class="hljs-string">"question"</span>: query}
    <span class="hljs-comment"># 执行问答链</span>
    response = chain.invoke(<span class="hljs-built_in">input</span>=input_data)
    <span class="hljs-built_in">print</span>(response[<span class="hljs-string">"output_text"</span>])
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"来源:"</span>)
    <span class="hljs-comment"># 记录唯一的页码</span>
    unique_pages = <span class="hljs-built_in">set</span>()
    <span class="hljs-comment"># 显示每个文档块的来源页码</span>
    <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs:
        <span class="hljs-comment">#print('doc=',doc)</span>
        text_content = <span class="hljs-built_in">getattr</span>(doc, <span class="hljs-string">"page_content"</span>, <span class="hljs-string">""</span>)
        source_page = knowledgeBase.page_info.get(
            text_content.strip(), <span class="hljs-string">"未知"</span>
        )
        <span class="hljs-keyword">if</span> source_page <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> unique_pages:
            unique_pages.add(source_page)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文本块页码: <span class="hljs-subst">{source_page}</span>"</span>)
</code></pre>
<h3 data-id="heading-19">3.5 示例总结</h3>
<p><strong>1. PDF文本提取与处理</strong></p>
<ul>
<li>使用PyPDF2库的PdfReader从PDF文件中提取文本在提取过程中记录每行文本对应的页码，便于后续溯源。</li>
<li>使用RecursiveCharacterTextSplitter将长文本分割成小块，便于向量化处理。</li>
</ul>
<p><strong>2. 向量数据库构建</strong></p>
<ul>
<li>使用OpenAIEmbeddings / DashScopeEmbeddings将文本块转换为向量表示。</li>
<li>使用FAISS向量数据库存储文本向量，支持高效的相似度搜索为每个文本块保存对应的页码信息，实现查询结果溯源。</li>
</ul>
<p><strong>3. 语义搜索与问答链</strong></p>
<ul>
<li>基于用户查询，使用similarity_search在向量数据库中检索相关文本块。</li>
<li>使用文本语言模型和load_qa_chain构建问答链将检索到的文档和用户问题作为输入，生成回答。</li>
</ul>
<p><strong>4. 成本跟踪与结果展示</strong></p>
<ul>
<li>使用get_openai_callback跟踪API调用成本。</li>
<li>展示问答结果和来源页码，方便用户验证信息。</li>
</ul>
<hr/>
<h2 data-id="heading-20">四、LangChain中的问答链</h2>
<p>在LangChain问答链中，有4种chain_type，chain_type参数决定了RAG流程中，如何将检索到的多个相关文档块与用户的问题组合起来，发送给大模型以生成最终答案。需要根据应用场景，选择不同的chain_type，以保证在效果、成本和速度上的权衡。</p>
<h3 data-id="heading-21">1. stuff（堆叠式）</h3>
<p><strong>工作原理：</strong></p>
<p>将所有检索到的文档片段直接拼接成一个长上下文，与问题一起构造 Prompt，单次调用 LLM 生成答案。</p>
<p><strong>优点：</strong></p>
<ul>
<li>实现最简单、延迟最低；</li>
<li>单次LLM调用，成本最低；</li>
<li>所有信息同时可见，利于全局理解。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>受限于LLM的最大上下文长度，文档过多或过长时会截断；</li>
<li>若检索结果包含噪声，可能干扰生成质量。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>检索返回的文档数量少、内容精炼（如chunk_size较小）；</li>
<li>对响应速度和成本敏感的轻量级应用。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cc4ad927c3b473e9ef8f9bbc44ed5d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=2vw%2BeNDnAYwe13Xup6lZFmaaVRg%3D" alt="img_5.jpg" loading="lazy"/></p>
<h3 data-id="heading-22">2. map_reduce（映射-归约）</h3>
<p><strong>工作原理：</strong></p>
<ul>
<li><strong>Map阶段：</strong> 对每个文档（chunk）独立构造Prompt，分别调用LLM生成中间摘要或回答。</li>
<li><strong>Reduce阶段：</strong> 将所有中间结果合并，再次调用LLM生成最终答案。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>可处理超长文档集合，不受单次上下文长度限制；</li>
<li>Map阶段可并行执行，提升吞吐率；</li>
<li>适合信息分散在多个片段中的场景。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>至少需要N+1次LLM调用（N为文档数），成本高，延迟大；</li>
<li>各文档独立处理，缺乏文档上下文关联。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>检索结果较多且分散；</li>
<li>需要对大量文档进行综合归纳（如报告生成，多源信息整合）。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3022ff0f25bd416d9902444c1c62bd38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=JlLCkfRPHY7XDskW0qYqo5yRY3M%3D" alt="img_6.jpg" loading="lazy"/></p>
<h3 data-id="heading-23">3. refine（迭代细化）</h3>
<p>在第一个chunk上做prompt得到结果，然后再合并下一个文件再输出结果</p>
<p><strong>工作原理：</strong></p>
<p>先用第一个文档和问题生成初步答案；依次将后续文档与当前答案合并，逐步"细化"输出，每次更新答案。</p>
<p><strong>优点：</strong></p>
<ul>
<li>能在一定程度上保留跨文档上下文信息；</li>
<li>每次只处理一个新文档 + 当前答案，Token使用较为可控；</li>
<li>最终答案融合了所有文档的信息流。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>必须串行处理，无法并行，延迟较高；</li>
<li>早期错误可能被累积放大；</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>文档间存在逻辑递进或补充关系；</li>
<li>需要在有限上下文窗口内处理中等数量文档；</li>
<li>对答案连续性要求较高。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0859013afd47481d81016a623278a51a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=V4csTvhZWyT%2Ff49oFbA09d7HZ9Q%3D" alt="img_7.jpg" loading="lazy"/></p>
<h3 data-id="heading-24">4. map_rerank（映射重排序）</h3>
<p>对每个chunk做prompt，然后打个分，然后根据分数返回最好的文档中的结果。</p>
<p>会大量地调用LLM，每个document之间是独立处理。</p>
<p><strong>工作原理：</strong></p>
<p>对每个文档独立构造Prompt，要求LLM输出一个答案+置信度分数；根据分数排序，返回得分最高的答案（通常只取Top-1）。</p>
<p><strong>优点：</strong></p>
<ul>
<li>能有效过滤低质量或无关文档；</li>
<li>返回的答案来自最相关片段，精准度高。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>每个文档都需要调用一次LLM，成本高；</li>
<li>不副合多文档信息，仅返回单个最佳答案，可能丢失互补信息；</li>
<li>依赖LLM对"打分"的一致性，部分模型不擅长此任务。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>检索结果中存在明显"最佳匹配"文档；</li>
<li>任务为事实型问答（如"XX 的定义是什么？"）；</li>
<li>需要高置信度、简洁答案，而非综合归纳。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/effc4d5952394d47913e0cadfae60649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=Of91seJnUkyhxsdcu%2B4DrqgUDbE%3D" alt="img_8.jpg" loading="lazy"/></p>
<h3 data-id="heading-25">5. 总结</h3>






















































<table><thead><tr><th>特性</th><th>stuff</th><th>map_reduce</th><th>refine</th><th>map_rerank</th></tr></thead><tbody><tr><td>LLM调用次数</td><td>1</td><td>N + 1</td><td>N</td><td>N</td></tr><tr><td>速度</td><td>最快</td><td>中等</td><td>最慢</td><td>慢</td></tr><tr><td>Token 消耗</td><td>低</td><td>高</td><td>高</td><td>高</td></tr><tr><td>处理长文档能力</td><td>差</td><td>好</td><td>好</td><td>好</td></tr><tr><td>答案质量</td><td>高 (上下文完整)</td><td>中等 (可能丢失关联)</td><td>最高 (迭代细化)</td><td>取决于最佳块</td></tr><tr><td>适用场景</td><td>默认选择，文档短</td><td>文档多，需平衡</td><td>文档多，要求高精度</td><td>事实型问题，答案在单块中</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-26">五、如果LLM可以处理无限上下文，RAG还有意义吗？</h2>
<ul>
<li>
<p><strong>效率成本</strong><br/>
LLM处理上下文时计算资源消耗大，响应时间增加。RAG通过检索相关片段，减少输入长度。</p>
</li>
<li>
<p><strong>知识更新</strong><br/>
LLM的知识截止于训练数据，无法实时更新。RAG可以连接外部知识库，增强时效性。</p>
</li>
<li>
<p><strong>可解释性</strong><br/>
RAG的检索过程透明，用户可查看来源，增强信任。LLM的生成过程则较难追溯。</p>
</li>
<li>
<p><strong>定制化</strong><br/>
RAG可针对特定领域定制检索系统，提供更精准的结果，而LLM的通用性可能无法满足特定需求。</p>
</li>
<li>
<p><strong>数据隐私</strong><br/>
RAG允许在本地或私有数据源上检索，避免敏感数据上传云端，适合隐私要求高的场景。</p>
</li>
</ul>
<p>结合LLM的生成能力和RAG的检索能力，可以提升整体性能，提供更全面、准确的回答。</p>
<hr/>
<p>如果你觉得本文有帮助，欢迎点赞、在看、转发，也欢迎留言分享你的经验！</p>
<p><strong>往期文章回顾：</strong></p>
<ul>
<li><strong>一文看懂主流向量数据库：选型不再踩坑</strong></li>
<li><a href="https://juejin.cn/post/7583598943071731747" target="_blank" title="https://juejin.cn/post/7583598943071731747">一文看懂主流向量数据库：选型不再踩坑</a></li>
<li><a href="https://juejin.cn/post/7582857981893918761" target="_blank" title="https://juejin.cn/post/7582857981893918761">AI 并不懂文字，它只认向量：一文搞懂 Embedding</a></li>
<li><a href="https://juejin.cn/post/7582470341924077602" target="_blank" title="https://juejin.cn/post/7582470341924077602">不会写提示词？难怪你的AI总在胡说八道！</a></li>
<li><a href="https://juejin.cn/post/7582073642869702671" target="_blank" title="https://juejin.cn/post/7582073642869702671">AI大模型原理与API使用</a></li>
<li><a href="https://juejin.cn/post/7581814484065419316" target="_blank" title="https://juejin.cn/post/7581814484065419316">Spec Kit+Cursor：AI驱动的软件开发新范式</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pnpm 你用了吗？]]></title>    <link>https://juejin.cn/post/7583981974408478730</link>    <guid>https://juejin.cn/post/7583981974408478730</guid>    <pubDate>2025-12-16T03:14:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408478730" data-draft-id="7583948178859032622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pnpm 你用了吗？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T03:14:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hayzone"/> <meta itemprop="url" content="https://juejin.cn/user/1750078243241607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pnpm 你用了吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078243241607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hayzone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:14:30.000Z" title="Tue Dec 16 2025 03:14:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">pnpm 详解：更快、更省空间的现代化包管理器</h2>
<h3 data-id="heading-1">一、什么是 pnpm？</h3>
<p><strong>pnpm</strong>（<strong>p</strong>erformant <strong>npm</strong>）是一个快速、节省磁盘空间的 Node.js 包管理器。它通过 <strong>硬链接 + 符号链接</strong> 的方式，在全局存储中只保存一份依赖包，多个项目共享同一份物理文件，从而显著减少磁盘占用并提升安装速度。</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2F" target="_blank" title="https://pnpm.io/" ref="nofollow noopener noreferrer">pnpm.io</a></p>
<hr/>
<h3 data-id="heading-2">二、核心优势</h3>
<h4 data-id="heading-3">✅ 1. <strong>节省磁盘空间</strong></h4>
<ul>
<li><strong>npm/yarn</strong> 每个项目都会复制完整依赖树。</li>
<li><strong>pnpm</strong> 使用 <strong>内容可寻址存储（Content-addressable store）</strong> ，相同版本的包只存一次。</li>
<li><strong>实测</strong>：10 个相似项目，pnpm 可节省 <strong>70%+</strong> 磁盘空间。</li>
</ul>
<h4 data-id="heading-4">✅ 2. <strong>安装速度更快</strong></h4>
<ul>
<li>无需重复下载/解压相同包。</li>
<li>并行化处理 + 高效的依赖解析算法。</li>
<li><strong>CI/CD 或大型项目中优势显著</strong>。</li>
</ul>
<h4 data-id="heading-5">✅ 3. <strong>严格的依赖隔离（无幽灵依赖）</strong></h4>
<ul>
<li>pnpm 严格遵循 <code>node_modules</code> 的 <strong>symlink 结构</strong>，只暴露显式声明的依赖。</li>
<li>避免 npm/yarn 中常见的“未声明却能引用”的 <strong>幽灵依赖</strong> 问题，提升项目健壮性。</li>
</ul>
<h4 data-id="heading-6">✅ 4. <strong>原生支持 Monorepo（多项目管理）</strong></h4>
<ul>
<li>内置 <code>pnpm workspace</code> 功能，无需额外工具（如 Lerna）即可高效管理多个子项目。</li>
<li>支持跨项目链接、统一依赖升级、脚本批量执行等。</li>
</ul>
<hr/>
<h3 data-id="heading-7">三、安装 pnpm</h3>
<h4 data-id="heading-8">全局安装（推荐）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm</span>
npm install -g pnpm

<span class="hljs-comment"># 使用 corepack（Node.js 16.13+ 内置）</span>
corepack <span class="hljs-built_in">enable</span>
corepack prepare pnpm@latest --activate
</code></pre>
<blockquote>
<p>💡 建议使用 <code>corepack</code>，它是官方推荐的包管理器分发方式，避免全局污染。</p>
</blockquote>
<h4 data-id="heading-9">验证安装</h4>
<pre><code class="hljs language-bash" lang="bash">pnpm -v
<span class="hljs-comment"># 输出如：9.12.0</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">四、基本使用命令</h3>









































<table><thead><tr><th>功能</th><th>命令</th></tr></thead><tbody><tr><td>初始化项目</td><td><code>pnpm init</code></td></tr><tr><td>安装依赖</td><td><code>pnpm install</code> 或 <code>pnpm i</code></td></tr><tr><td>添加依赖</td><td><code>pnpm add lodash</code></td></tr><tr><td>添加开发依赖</td><td><code>pnpm add -D typescript</code></td></tr><tr><td>删除依赖</td><td><code>pnpm remove lodash</code></td></tr><tr><td>运行脚本</td><td><code>pnpm run dev</code></td></tr><tr><td>查看依赖树</td><td><code>pnpm list</code></td></tr><tr><td>清理 store</td><td><code>pnpm store prune</code></td></tr></tbody></table>
<blockquote>
<p>⚠️ 注意：<code>pnpm</code> 不支持 <code>npm install package --save</code> 这种写法，必须用 <code>pnpm add</code>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">五、版本策略</h3>
<ul>
<li>pnpm 遵循 <strong>SemVer（语义化版本）</strong> 。</li>
<li>主版本更新较快（目前 v9.x），但 API 稳定。</li>
<li>推荐使用 <strong>最新稳定版</strong>，可通过 <code>pnpm env use --global latest</code> 自动管理 Node.js + pnpm 版本。</li>
</ul>
<hr/>
<h3 data-id="heading-12">六、多项目管理：pnpm Workspace 详解（核心亮点）</h3>
<h4 data-id="heading-13">1. 什么是 Workspace？</h4>
<p>Workspace 是 pnpm 提供的 <strong>Monorepo 管理方案</strong>，允许在一个仓库中管理多个相互关联的包（如组件库、微前端、工具链等）。</p>
<h4 data-id="heading-14">2. 配置步骤</h4>
<h5 data-id="heading-15">(1) 根目录创建 <code>pnpm-workspace.yaml</code></h5>
<pre><code class="hljs language-bash" lang="bash">packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除测试目录</span>
</code></pre>
<h5 data-id="heading-16">(2) 子项目结构示例</h5>
<pre><code class="hljs language-go" lang="go">my-monorepo/
├── packages/
│   ├── ui-components/
│   └── utils/
├── apps/
│   ├── web-app/
│   └── admin/
├── pnpm-workspace.yaml
└── <span class="hljs-keyword">package</span>.json
</code></pre>
<h5 data-id="heading-17">(3) 跨项目引用（自动软链接）</h5>
<p>在 <code>apps/web-app/package.json</code> 中：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ui-components"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:^1.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>运行 <code>pnpm install</code> 后，<code>ui-components</code> 和 <code>utils</code> 会自动以 <strong>符号链接</strong> 形式链接到 <code>web-app/node_modules</code>，实现 <strong>实时开发调试</strong>，无需 <code>npm link</code>。</p>
<h4 data-id="heading-18">3. 批量操作命令</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在所有 workspace 中运行 build</span>
pnpm -r run build

<span class="hljs-comment"># 仅在包含 test 脚本的项目中运行</span>
pnpm -r --filter=<span class="hljs-string">'./packages/**'</span> run <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 查看所有 workspace 依赖关系图</span>
pnpm m <span class="hljs-built_in">ls</span>
</code></pre>
<h4 data-id="heading-19">4. 优势总结（vs Lerna + Yarn/NPM）</h4>



































<table><thead><tr><th>能力</th><th>pnpm Workspace</th><th>Lerna + Yarn</th></tr></thead><tbody><tr><td>依赖安装</td><td>单次 <code>pnpm install</code> 完成</td><td>需 <code>lerna bootstrap</code></td></tr><tr><td>磁盘占用</td><td>极低（共享 store）</td><td>高（每个项目独立 node_modules）</td></tr><tr><td>幽灵依赖</td><td>严格禁止</td><td>可能存在</td></tr><tr><td>配置复杂度</td><td>极简（一个 yaml 文件）</td><td>需 Lerna + Yarn 配置</td></tr><tr><td>性能</td><td>快</td><td>较慢</td></tr></tbody></table>
<blockquote>
<p>🚀 <strong>结论</strong>：对于新项目，<strong>直接使用 pnpm workspace 是 Monorepo 的最佳实践</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">七、常见问题 &amp; 最佳实践</h3>
<h4 data-id="heading-21">Q1: pnpm 和 npm/yarn 兼容吗？</h4>
<ul>
<li>完全兼容 <code>package.json</code> 和 npm registry。</li>
<li>可无缝迁移：删除 <code>node_modules</code> 和 <code>package-lock.json</code>，运行 <code>pnpm import</code>（从 yarn.lock/npm-lock）或直接 <code>pnpm install</code>。</li>
</ul>
<h4 data-id="heading-22">Q2: 如何迁移现有项目到 pnpm？</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 删除旧依赖</span>
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 2. 安装 pnpm 依赖</span>
pnpm install

<span class="hljs-comment"># 3. （可选）从 yarn.lock 导入</span>
pnpm import  <span class="hljs-comment"># 自动读取 yarn.lock 或 package-lock.json</span>
</code></pre>
<h4 data-id="heading-23">Q3: pnpm 支持 .npmrc 吗？</h4>
<ul>
<li>支持！配置方式与 npm 一致，如设置 registry、token 等。</li>
</ul>
<h4 data-id="heading-24">最佳实践建议：</h4>
<ul>
<li>在 <code>.nvmrc</code> 或 <code>.tool-versions</code> 中指定 Node.js 版本。</li>
<li>使用 <code>pnpm dlx</code> 临时运行包（替代 <code>npx</code>）：<code>pnpm dlx create-react-app my-app</code></li>
<li>开启 <code>hoist=false</code>（默认）以保持严格依赖隔离。</li>
</ul>
<hr/>
<h3 data-id="heading-25">八、结语</h3>
<p><strong>pnpm 不仅是一个更快的 npm 替代品，更是现代前端工程化的基础设施</strong>。它在 <strong>磁盘效率、安装速度、依赖安全性和 Monorepo 支持</strong> 上全面领先，已被 Vite、Next.js、Nuxt、Turborepo 等主流工具链官方推荐。</p>
<p>如果你还在忍受 <code>node_modules</code> 的臃肿和幽灵依赖的困扰，<strong>现在就是切换到 pnpm 的最佳时机</strong>！</p>
<hr/>
<blockquote>
<p>🔗 <strong>参考链接</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2F" target="_blank" title="https://pnpm.io/" ref="nofollow noopener noreferrer">pnpm 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fbenchmarks" target="_blank" title="https://pnpm.io/benchmarks" ref="nofollow noopener noreferrer">pnpm vs npm vs yarn 性能对比</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2Fguide%2F%23scaffolding-your-first-vite-project" target="_blank" title="https://vitejs.dev/guide/#scaffolding-your-first-vite-project" ref="nofollow noopener noreferrer">Vite 官方推荐使用 pnpm</a></li>
</ul>
</blockquote>
<hr/>
<p><strong>欢迎点赞、收藏、评论交流！你用过 pnpm 吗？体验如何？</strong> 😊</p>
<hr/>
<h4 data-id="heading-26">📄 附：文档结构说明</h4>









































<table><thead><tr><th>章节</th><th>内容</th></tr></thead><tbody><tr><td>一</td><td>pnpm 简介</td></tr><tr><td>二</td><td>核心优势（含多项目管理）</td></tr><tr><td>三</td><td>安装方法</td></tr><tr><td>四</td><td>常用命令</td></tr><tr><td>五</td><td>版本管理</td></tr><tr><td>六</td><td>Monorepo 深度解析</td></tr><tr><td>七</td><td>常见问题与迁移指南</td></tr><tr><td>八</td><td>总结与推荐</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[环境变量]export命令的作用是什么]]></title>    <link>https://juejin.cn/post/7583980250733494335</link>    <guid>https://juejin.cn/post/7583980250733494335</guid>    <pubDate>2025-12-16T02:49:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250733494335" data-draft-id="7583933107690307647" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[环境变量]export命令的作用是什么"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-16T02:49:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [环境变量]export命令的作用是什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:49:13.000Z" title="Tue Dec 16 2025 02:49:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 <strong>.zshrc</strong> 文件中使用 <code>export</code> 命令的主要作用是将变量设置为 <strong>环境变量</strong>，使其在整个Shell会话及其子进程中可用。具体作用如下：</p>
<h2 data-id="heading-0">主要功能：</h2>
<h3 data-id="heading-1">1. <strong>使变量全局可见</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
<ul>
<li>将 <code>PATH</code> 变量导出，使所有子进程（包括其他程序、脚本等）都能访问这个变量</li>
</ul>
<h3 data-id="heading-2">2. <strong>作用域扩展</strong></h3>
<pre><code class="hljs language-bash" lang="bash">MY_VAR=<span class="hljs-string">"hello"</span>       <span class="hljs-comment"># 仅当前Shell可见</span>
<span class="hljs-built_in">export</span> MY_VAR        <span class="hljs-comment"># 变为环境变量，子进程可见</span>
</code></pre>
<ul>
<li>没有 <code>export</code>：变量只在当前Shell中可用</li>
<li>有 <code>export</code>：变量可被子进程继承</li>
</ul>
<h3 data-id="heading-3">3. <strong>持久化配置</strong></h3>
<p>在 <code>.zshrc</code> 中使用 <code>export</code>，每次启动新终端时都会自动设置这些环境变量。</p>
<h2 data-id="heading-4">常见用例示例：</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Java环境</span>
<span class="hljs-built_in">export</span> JAVA_HOME=<span class="hljs-string">"/usr/lib/jvm/java-11-openjdk"</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>"</span>

<span class="hljs-comment"># 编辑器设置</span>
<span class="hljs-built_in">export</span> EDITOR=<span class="hljs-string">"vim"</span>

<span class="hljs-comment"># 语言设置</span>
<span class="hljs-built_in">export</span> LANG=<span class="hljs-string">"en_US.UTF-8"</span>

<span class="hljs-comment"># 自定义变量</span>
<span class="hljs-built_in">export</span> MY_PROJECT_HOME=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/projects"</span>
<span class="hljs-built_in">export</span> GITHUB_TOKEN=<span class="hljs-string">"your_token_here"</span>  <span class="hljs-comment"># 注意：不推荐在此硬编码敏感信息</span>
</code></pre>
<h2 data-id="heading-5">注意事项：</h2>
<ol>
<li>
<p><strong>安全性</strong>：不要在 <code>.zshrc</code> 中导出敏感信息（如密码、API密钥），建议使用专用配置文件或安全存储</p>
</li>
<li>
<p><strong>立即生效</strong>：修改 <code>.zshrc</code> 后需要重新加载：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
<span class="hljs-comment"># 或</span>
<span class="hljs-built_in">exec</span> zsh
</code></pre>
<ol start="3">
<li><strong>路径添加顺序</strong>：<code>PATH</code> 变量按顺序查找，常用做法是将自定义路径放在前面：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/usr/local/bin:<span class="hljs-variable">$PATH</span>"</span>  <span class="hljs-comment"># 优先使用/usr/local/bin</span>
</code></pre>
<ol start="4">
<li><strong>查看环境变量</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span>        <span class="hljs-comment"># 查看所有导出变量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>    <span class="hljs-comment"># 查看PATH变量</span>
</code></pre>
<h2 data-id="heading-6">与其他方式的区别：</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 临时设置（仅当前会话有效）</span>
<span class="hljs-built_in">export</span> TEMP_VAR=<span class="hljs-string">"value"</span>

<span class="hljs-comment"># 永久设置（写入.zshrc）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export MY_VAR="value"'</span> &gt;&gt; ~/.zshrc

<span class="hljs-comment"># 局部变量（不导出）</span>
<span class="hljs-built_in">local</span> LOCAL_VAR=<span class="hljs-string">"only_in_current_scope"</span>
</code></pre>
<p>总之，<code>export</code> 在 <code>.zshrc</code> 中的作用是确保你设置的变量在整个Shell环境和所有启动的程序中都可用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 整合 ElasticSearch，给搜索插上“光速翅膀”]]></title>    <link>https://juejin.cn/post/7583955708318564352</link>    <guid>https://juejin.cn/post/7583955708318564352</guid>    <pubDate>2025-12-16T03:23:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318564352" data-draft-id="7583973472322961423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 整合 ElasticSearch，给搜索插上“光速翅膀”"/> <meta itemprop="keywords" content="后端,Java,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-16T03:23:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="悟空码字"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 整合 ElasticSearch，给搜索插上“光速翅膀”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    悟空码字
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:23:48.000Z" title="Tue Dec 16 2025 03:23:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是小悟。</p>
<h2 data-id="heading-0">一、ElasticSearch 是什么？</h2>
<p>你有一个超级健忘的朋友（比如金鱼记忆的那种），但他却能在0.0001秒内从100万本书里找到你想要的句子。这就是 ElasticSearch（简称 ES）！</p>
<p><strong>ES 的“人格特征”：</strong></p>
<ul>
<li><strong>速度狂魔</strong>：搜索速度比咖啡因过量的程序员找Bug还快</li>
<li><strong>文档收藏家</strong>：什么JSON、日志都能存</li>
<li><strong>超级侦探</strong>：模糊搜索、精确搜索、拼音搜索样样精通</li>
<li><strong>大象胃口</strong>：数据量再大也不怕（毕竟名字里就有“elastic”弹性）</li>
<li><strong>马戏团团长</strong>：天生分布式，节点之间跳来跳去从不出错</li>
</ul>
<h2 data-id="heading-1">二、整合大冒险：SpringBoot 与 ES 的“相亲大会”</h2>
<h3 data-id="heading-2">第 1 步：先来个“相亲介绍人”（Maven 依赖）</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml 里加入这些“红娘” --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- SpringBoot 给 ES 的专属“情书” --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 防止程序说“我不会JSON” --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">第 2 步：配置“约会地点”（application.yml）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span>  <span class="hljs-comment"># ES 的“家庭地址”</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">elastic</span>  <span class="hljs-comment"># 用户名（默认是这个）</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your_password</span>  <span class="hljs-comment"># 密码（安装时设置的）</span>
    
  <span class="hljs-comment"># 可选：让日志“多说点话”，方便调试</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">elasticsearch:</span>
      <span class="hljs-attr">repositories:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment"># 给 ES 客户端一点“咖啡因”，让它更精神</span>
<span class="hljs-attr">elasticsearch:</span>
  <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">5000</span>  <span class="hljs-comment"># 连接超时（毫秒）</span>
  <span class="hljs-attr">socket-timeout:</span> <span class="hljs-number">30000</span>  <span class="hljs-comment"># socket超时</span>
</code></pre>
<h3 data-id="heading-4">第 3 步：创建“相亲对象”（实体类）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">annotation</span>.Id;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Document;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Field;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.FieldType;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Document(indexName = <span class="hljs-string">"book_index"</span>)</span>  <span class="hljs-comment">// 告诉ES：“这是我家的书架名字”</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {
    
    <span class="hljs-meta">@Id</span>  <span class="hljs-comment">// 相当于书的“身份证号”</span>
    <span class="hljs-keyword">private</span> String id;
    
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_max_word"</span>)</span>  <span class="hljs-comment">// 用中文分词器</span>
    <span class="hljs-keyword">private</span> String title;  <span class="hljs-comment">// 书名</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_smart"</span>)</span>
    <span class="hljs-keyword">private</span> String author;  <span class="hljs-comment">// 作者</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Double)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Double</span> price;  <span class="hljs-comment">// 价格</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Date)</span>
    <span class="hljs-keyword">private</span> Date publishDate;  <span class="hljs-comment">// 出版日期</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>  <span class="hljs-comment">// 关键词，不分词</span>
    <span class="hljs-keyword">private</span> String category;  <span class="hljs-comment">// 分类</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Nested)</span>  <span class="hljs-comment">// 嵌套对象</span>
    <span class="hljs-keyword">private</span> List&lt;Tag&gt; tags;
    
    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> static <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tag</span> {
        <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>
        <span class="hljs-keyword">private</span> String name;
        <span class="hljs-meta">@Field(type = FieldType.Integer)</span>
        <span class="hljs-keyword">private</span> Integer priority;
    }
}
</code></pre>
<h3 data-id="heading-5">第 4 步：找个“媒婆”（Repository 接口）</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.annotations.Query;
<span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> interface <span class="hljs-type">BookRepository</span> extends <span class="hljs-type">ElasticsearchRepository</span>&lt;<span class="hljs-type">Book</span>, <span class="hljs-type">String</span>&gt; {
    
    <span class="hljs-comment">// 方法名就是查询！Spring Data 的“魔法”</span>
    
    <span class="hljs-comment">// 1. 按作者精确查找（比找失散多年的兄弟还准）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByAuthor(<span class="hljs-type">String</span> author);
    
    <span class="hljs-comment">// 2. 按标题模糊查找（支持分词）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByTitleContaining(<span class="hljs-type">String</span> keyword);
    
    <span class="hljs-comment">// 3. 价格区间查找（找买得起的书）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByPriceBetween(<span class="hljs-type">Double</span> minPrice, <span class="hljs-type">Double</span> maxPrice);
    
    <span class="hljs-comment">// 4. 多条件查询（作者+分类）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByAuthorAndCategory(<span class="hljs-type">String</span> author, <span class="hljs-type">String</span> category);
    
    <span class="hljs-comment">// 5. 自定义查询（展示真正的技术）</span>
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"{<span class="hljs-subst">\"</span>bool<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>must<span class="hljs-subst">\"</span>: [{<span class="hljs-subst">\"</span>match<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>title<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>?0<span class="hljs-subst">\"</span>}}]}}"</span>)
    <span class="hljs-type">Page</span>&lt;<span class="hljs-type">Book</span>&gt; customSearch(<span class="hljs-type">String</span> keyword, <span class="hljs-type">Pageable</span> pageable);
    
    <span class="hljs-comment">// 6. 统计某个作者有多少书</span>
    <span class="hljs-type">Long</span> countByAuthor(<span class="hljs-type">String</span> author);
}
</code></pre>
<h3 data-id="heading-6">第 5 步：写个“恋爱导师”（Service 层）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">Page</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">Pageable</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Optional</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">BookRepository</span> bookRepository;
    
    <span class="hljs-comment">/**
     * 添加/更新一本书
     * 如果书有id，就是更新；没有id，就是新增
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Book</span> <span class="hljs-title function_">saveBook</span>(<span class="hljs-params">Book book</span>) {
        <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">save</span>(book);
    }
    
    <span class="hljs-comment">/**
     * 批量添加（ES最喜欢批量操作了，效率高）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">saveAllBooks</span>(<span class="hljs-params">List&lt;Book&gt; books</span>) {
        bookRepository.<span class="hljs-title function_">saveAll</span>(books);
    }
    
    <span class="hljs-comment">/**
     * 按ID查找（速度飞快）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Optional</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">findById</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) {
        <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findById</span>(id);
    }
    
    <span class="hljs-comment">/**
     * 复杂搜索：按标题和作者搜索
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">searchBooks</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> title, <span class="hljs-built_in">String</span> author</span>) {
        <span class="hljs-comment">// 这里可以写更复杂的逻辑</span>
        <span class="hljs-keyword">if</span> (title != <span class="hljs-literal">null</span> &amp;&amp; author != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findByTitleContainingAndAuthor</span>(title, author);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (title != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findByTitleContaining</span>(title);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findByAuthor</span>(author);
        }
    }
    
    <span class="hljs-comment">/**
     * 删除一本书（谨慎操作！）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteBook</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) {
        bookRepository.<span class="hljs-title function_">deleteById</span>(id);
    }
    
    <span class="hljs-comment">/**
     * 分页查询（大数据量的好朋友）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Page</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">findAllBooks</span>(<span class="hljs-params">Pageable pageable</span>) {
        <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findAll</span>(pageable);
    }
    
    <span class="hljs-comment">/**
     * 高级搜索：使用QueryBuilder
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">advancedSearch</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> keyword, Double minPrice, Double maxPrice</span>) {
        <span class="hljs-comment">// 使用NativeSearchQueryBuilder构建复杂查询</span>
        <span class="hljs-comment">// 这里先省略，下面会有详细示例</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-7">第 6 步：高级搜索的“秘密武器”</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;
<span class="hljs-keyword">import</span> org.elasticsearch.index.query.QueryBuilders;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.ElasticsearchRestTemplate;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.SearchHits;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.NativeSearchQuery;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.NativeSearchQueryBuilder;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedSearchService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate;
    
    <span class="hljs-comment">/**
     * 多条件组合搜索（布尔查询）
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Book&gt; multiConditionSearch(String keyword, <span class="hljs-built_in">Double</span> minPrice, 
                                           <span class="hljs-built_in">Double</span> maxPrice, String category) {
        
        <span class="hljs-comment">// 1. 创建布尔查询构建器（相当于SQL的WHERE）</span>
        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();
        
        <span class="hljs-comment">// 2. 添加必须条件（must = AND）</span>
        <span class="hljs-keyword">if</span> (keyword != <span class="hljs-literal">null</span> &amp;&amp; !keyword.trim().isEmpty()) {
            boolQuery.must(QueryBuilders.multiMatchQuery(keyword, <span class="hljs-string">"title"</span>, <span class="hljs-string">"author"</span>)
                    .analyzer(<span class="hljs-string">"ik_max_word"</span>));
        }
        
        <span class="hljs-comment">// 3. 添加价格范围（range查询）</span>
        <span class="hljs-keyword">if</span> (minPrice != <span class="hljs-literal">null</span> || maxPrice != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> rangeQuery = QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>);
            <span class="hljs-keyword">if</span> (minPrice != <span class="hljs-literal">null</span>) {
                rangeQuery.gte(minPrice);
            }
            <span class="hljs-keyword">if</span> (maxPrice != <span class="hljs-literal">null</span>) {
                rangeQuery.lte(maxPrice);
            }
            boolQuery.must(rangeQuery);
        }
        
        <span class="hljs-comment">// 4. 添加分类过滤（filter不计算分数，更快）</span>
        <span class="hljs-keyword">if</span> (category != <span class="hljs-literal">null</span> &amp;&amp; !category.trim().isEmpty()) {
            boolQuery.filter(QueryBuilders.termQuery(<span class="hljs-string">"category"</span>, category));
        }
        
        <span class="hljs-comment">// 5. 构建查询</span>
        NativeSearchQuery searchQuery = new NativeSearchQueryBuilder()
                .withQuery(boolQuery)
                .withSorts(org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.SortBuilders
                        .fieldSort(<span class="hljs-string">"price"</span>).order(org.springframework.<span class="hljs-keyword">data</span>.domain.Sort.Direction.ASC))
                .withPageable(org.springframework.<span class="hljs-keyword">data</span>.domain.PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))
                .build();
        
        <span class="hljs-comment">// 6. 执行查询</span>
        SearchHits&lt;Book&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, Book.<span class="hljs-keyword">class</span>);
        
        <span class="hljs-comment">// 7. 转换结果</span>
        <span class="hljs-keyword">return</span> searchHits.getSearchHits().stream()
                .map(hit -&gt; hit.getContent())
                .collect(Collectors.toList());
    }
    
    <span class="hljs-comment">/**
     * 聚合查询：统计每个分类有多少本书
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, <span class="hljs-built_in">Long</span>&gt; categoryStatistics() {
        NativeSearchQuery query = new NativeSearchQueryBuilder()
                .addAggregation(org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.aggregation.AggregationBuilders
                        .terms(<span class="hljs-string">"category_agg"</span>).field(<span class="hljs-string">"category.keyword"</span>))
                .build();
        
        SearchHits&lt;Book&gt; searchHits = elasticsearchRestTemplate.search(query, Book.<span class="hljs-keyword">class</span>);
        
        <span class="hljs-comment">// 处理聚合结果（这里简化了，实际需要解析Aggregations）</span>
        <span class="hljs-keyword">return</span> new HashMap&lt;&gt;();
    }
}
</code></pre>
<h3 data-id="heading-8">第 7 步：REST API 控制器（对外接口）</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.Page</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.PageRequest</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ResponseEntity</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Optional</span>;

@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/books"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">BookController</span> {
    
    <span class="hljs-variable">@Autowired</span>
    private BookService bookService;
    
    <span class="hljs-variable">@Autowired</span>
    private AdvancedSearchService advancedSearchService;
    
    <span class="hljs-comment">/**
     * 创建新书
     */</span>
    <span class="hljs-variable">@PostMapping</span>
    public ResponseEntity&lt;Book&gt; <span class="hljs-built_in">createBook</span>(<span class="hljs-variable">@RequestBody</span> Book book) {
        <span class="hljs-selector-tag">Book</span> <span class="hljs-selector-tag">savedBook</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.saveBook</span>(book);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(savedBook);
    }
    
    <span class="hljs-comment">/**
     * 批量导入（适合初始化数据）
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">batchImport</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Book&gt; books) {
        <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.saveAllBooks</span>(books);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(<span class="hljs-string">"成功导入 "</span> + books.<span class="hljs-built_in">size</span>() + <span class="hljs-string">" 本书"</span>);
    }
    
    <span class="hljs-comment">/**
     * 搜索书籍（简单版）
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt;&gt; <span class="hljs-selector-tag">searchBooks</span>(
            <span class="hljs-variable">@RequestParam</span>(required = false) String title,
            <span class="hljs-variable">@RequestParam</span>(required = false) String author) {
        
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">books</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.searchBooks</span>(title, author);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(books);
    }
    
    <span class="hljs-comment">/**
     * 高级搜索（多条件）
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/advanced-search"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt;&gt; <span class="hljs-selector-tag">advancedSearch</span>(
            <span class="hljs-variable">@RequestParam</span>(required = false) String keyword,
            <span class="hljs-variable">@RequestParam</span>(required = false) Double minPrice,
            <span class="hljs-variable">@RequestParam</span>(required = false) Double maxPrice,
            <span class="hljs-variable">@RequestParam</span>(required = false) String category) {
        
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">books</span> = <span class="hljs-selector-tag">advancedSearchService</span>
                <span class="hljs-selector-class">.multiConditionSearch</span>(keyword, minPrice, maxPrice, category);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(books);
    }
    
    <span class="hljs-comment">/**
     * 分页查询
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">Book</span>&gt;&gt; <span class="hljs-selector-tag">getBooksByPage</span>(
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"0"</span>) int page,
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"10"</span>) int size) {
        
        <span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">books</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findAllBooks</span>(PageRequest.<span class="hljs-built_in">of</span>(page, size));
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(books);
    }
}
</code></pre>
<h3 data-id="heading-9">第 8 步：配置类（锦上添花）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.client.ClientConfiguration;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.client.RestClients;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.ElasticsearchRestTemplate;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.repository.config.EnableElasticsearchRepositories;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableElasticsearchRepositories(basePackages = <span class="hljs-string">"com.yourpackage.repository"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticsearchConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestHighLevelClient elasticsearchClient() {
        ClientConfiguration clientConfiguration = ClientConfiguration.builder()
                .connectedTo(<span class="hljs-string">"localhost:9200"</span>)
                .withBasicAuth(<span class="hljs-string">"elastic"</span>, <span class="hljs-string">"your_password"</span>)
                .withConnectTimeout(<span class="hljs-number">5000</span>)
                .withSocketTimeout(<span class="hljs-number">30000</span>)
                .build();
        
        <span class="hljs-keyword">return</span> RestClients.create(clientConfiguration).rest();
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ElasticsearchRestTemplate elasticsearchRestTemplate() {
        <span class="hljs-keyword">return</span> new ElasticsearchRestTemplate(elasticsearchClient());
    }
}
</code></pre>
<h2 data-id="heading-10">三、测试一下我们的“杰作”</h2>
<h3 data-id="heading-11">测试数据（JSON格式）</h3>
<pre><code class="hljs language-bash" lang="bash">POST /api/books/batch
[
  {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"SpringBoot从入门到放弃"</span>,
    <span class="hljs-string">"author"</span>: <span class="hljs-string">"程序猿老张"</span>,
    <span class="hljs-string">"price"</span>: 68.5,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"技术"</span>,
    <span class="hljs-string">"publishDate"</span>: <span class="hljs-string">"2023-01-01"</span>,
    <span class="hljs-string">"tags"</span>: [
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Java"</span>, <span class="hljs-string">"priority"</span>: 1},
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"后端"</span>, <span class="hljs-string">"priority"</span>: 2}
    ]
  },
  {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"ElasticSearch实战指南"</span>,
    <span class="hljs-string">"author"</span>: <span class="hljs-string">"搜索达人李"</span>,
    <span class="hljs-string">"price"</span>: 89.0,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"技术"</span>,
    <span class="hljs-string">"publishDate"</span>: <span class="hljs-string">"2023-02-15"</span>,
    <span class="hljs-string">"tags"</span>: [
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"搜索"</span>, <span class="hljs-string">"priority"</span>: 1},
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"大数据"</span>, <span class="hljs-string">"priority"</span>: 2}
    ]
  }
]
</code></pre>
<h3 data-id="heading-12">搜索示例</h3>
<pre><code class="hljs language-ini" lang="ini">GET /api/books/search?<span class="hljs-attr">title</span>=SpringBoot&amp;author=程序猿老张
GET /api/books/advanced-search?<span class="hljs-attr">keyword</span>=实战&amp;minPrice=<span class="hljs-number">50</span>&amp;maxPrice=<span class="hljs-number">100</span>
</code></pre>
<h2 data-id="heading-13">四、遇到的“坑”和解决方案</h2>
<ol>
<li>
<p><strong>连接问题</strong>：确保ES服务已启动，检查端口9200</p>
<pre><code class="hljs language-arduino" lang="arduino">curl http:<span class="hljs-comment">//localhost:9200</span>
</code></pre>
</li>
<li>
<p><strong>版本兼容</strong>：SpringBoot版本和ES版本要匹配</p>
<ul>
<li>SpringBoot 2.7.x → ES 7.17.x</li>
<li>SpringBoot 3.x → ES 8.x</li>
</ul>
</li>
<li>
<p><strong>中文分词</strong>：安装IK分词器</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入ES容器/安装目录的plugins文件夹</span>
./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.17.3/elasticsearch-analysis-ik-7.17.3.zip
</code></pre>
</li>
<li>
<p><strong>内存不足</strong>：调整JVM参数</p>
<pre><code class="hljs language-diff" lang="diff"># config/jvm.options
<span class="hljs-deletion">-Xms1g</span>
<span class="hljs-deletion">-Xmx1g</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-14">五、总结：为什么选择这对“黄金搭档”？</h2>
<h3 data-id="heading-15">SpringBoot + ES = 天作之合</h3>
<p><strong>优点大放送：</strong></p>
<ol>
<li><strong>开发速度</strong>：SpringBoot的自动配置 + ES的简单API = 生产力翻倍</li>
<li><strong>性能表现</strong>：ES的倒排索引 + 分布式架构 = 搜索如飞</li>
<li><strong>扩展性</strong>：微服务架构中，ES可作为独立的搜索服务</li>
<li><strong>生态完善</strong>：Spring Data Elasticsearch 封装了大多数常用操作</li>
<li><strong>实时性</strong>：近实时搜索，数据一秒内可查</li>
</ol>
<h3 data-id="heading-16">适用场景（ES大显身手的时候）</h3>
<ol>
<li><strong>电商网站</strong>：商品搜索、筛选、排序</li>
<li><strong>日志分析</strong>：ELK栈中的核心组件</li>
<li><strong>内容平台</strong>：文章、新闻的全文检索</li>
<li><strong>监控系统</strong>：实时数据分析</li>
<li><strong>推荐系统</strong>：用户行为分析+相似度搜索</li>
</ol>
<h3 data-id="heading-17">最后</h3>
<ul>
<li><strong>不要滥用</strong>：简单的CRUD用MySQL，复杂搜索再用ES</li>
<li><strong>数据同步</strong>：考虑使用Logstash或自定义同步机制</li>
<li><strong>索引设计</strong>：合理的mapping设计是性能的关键</li>
<li><strong>监控告警</strong>：用Kibana监控ES集群健康状态</li>
</ul>
<hr/>
<p>SpringBoot整合ElasticSearch，就像给程序装上了“谷歌大脑”——存得多、找得快、查得准。虽然配置过程像在组装乐高，偶尔会找不到零件（版本兼容），但一旦搭建完成，你就能享受到“秒级搜索”的快感。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c58b062b574dc1af8c3b721e0928b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460228&amp;x-signature=o4lBBo1a6LzEydy1NhMjtdyxURo%3D" alt="Spring Boot 整合 Elasticsearch 及实战应用.png" loading="lazy"/></p>
<p><strong>谢谢你看我的文章，既然看到这里了，如果觉得不错，随手点个赞、转发、在看三连吧，感谢感谢。那我们，下次再见。</strong></p>
<p>您的一键三连，是我更新的最大动力，谢谢</p>
<p>山水有相逢，来日皆可期，谢谢阅读，我们再会</p>
<p>我手中的金箍棒，上能通天，下能探海</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git 配置与使用全攻略（含工作流对比与 AI 协作）]]></title>    <link>https://juejin.cn/post/7583983152323903514</link>    <guid>https://juejin.cn/post/7583983152323903514</guid>    <pubDate>2025-12-16T03:22:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152323903514" data-draft-id="7583983152323887130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git 配置与使用全攻略（含工作流对比与 AI 协作）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T03:22:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hayzone"/> <meta itemprop="url" content="https://juejin.cn/user/1750078243241607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git 配置与使用全攻略（含工作流对比与 AI 协作）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078243241607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hayzone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:22:23.000Z" title="Tue Dec 16 2025 03:22:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Git 基础配置与操作流程</h2>
<h3 data-id="heading-1">1. 安装与初始化</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 下载地址：https://git-scm.com/</span>
<span class="hljs-meta"># 安装后检查版本</span>
git --version

<span class="hljs-meta"># 配置全局身份（必填）</span>
git config --<span class="hljs-keyword">global</span> user.name <span class="hljs-string">"YourName"</span>
git config --<span class="hljs-keyword">global</span> user.email <span class="hljs-string">"your@email.com"</span>

<span class="hljs-meta"># 生成 SSH 密钥（用于远程认证）</span>
ssh-keygen -t rsa -C <span class="hljs-string">"your@email.com"</span>
</code></pre>
<h3 data-id="heading-2">2. 核心操作流程图</h3>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[初始化仓库]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[拉取代码]</span>
    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[切换分支]</span>
    C --&gt; D<span class="hljs-selector-attr">[修改文件]</span>
    D --&gt; E<span class="hljs-selector-attr">[添加缓存]</span>
    E --&gt; F<span class="hljs-selector-attr">[提交本地]</span>
    F --&gt; G<span class="hljs-selector-attr">[推送远程]</span>
    G --&gt; H<span class="hljs-selector-attr">[合并分支]</span>
</code></pre>
<h3 data-id="heading-3">3. 常用命令速查</h3>




























































<table><thead><tr><th>操作类型</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>初始化</td><td><code>git init</code></td><td>创建新仓库</td></tr><tr><td>克隆远程代码</td><td><code>git clone [仓库地址]</code></td><td>复制远程仓库到本地</td></tr><tr><td>分支操作</td><td><code>git checkout [分支名]</code></td><td>切换分支</td></tr><tr><td>状态检查</td><td><code>git status</code></td><td>查看工作区状态</td></tr><tr><td>文件管理</td><td><code>git add .</code></td><td>添加所有文件到缓存区</td></tr><tr><td>提交更改</td><td><code>git commit -m "描述"</code></td><td>提交到本地仓库</td></tr><tr><td>推送远程</td><td><code>git push origin [分支名]</code></td><td>上传到远程服务器</td></tr><tr><td>合并分支</td><td><code>git merge origin/[分支名]</code></td><td>将指定分支合并到当前分支</td></tr><tr><td>撤销合并</td><td><code>git merge --abort</code></td><td>中止未完成的合并操作</td></tr><tr><td>历史追踪</td><td><code>git reflog</code></td><td>查看所有操作记录</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">二、Git 工作流实践对比</h2>
<h3 data-id="heading-5">1. 常见工作流模式</h3>
<ul>
<li>
<p><strong>集中式工作流</strong><br/>
所有开发人员直接向主分支提交代码，适合小型团队快速迭代。</p>
</li>
<li>
<p><strong>功能分支工作流</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建功能分支</span>
git checkout -b feature/login
<span class="hljs-comment"># 完成开发后合并回主分支</span>
git checkout main
git merge feature/login
</code></pre>
</li>
<li>
<p><strong>GitFlow 工作流</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">main</span>(生产) ← <span class="hljs-built_in">develop</span>(开发)
      ↗ <span class="hljs-built_in">release</span>(发布) → <span class="hljs-built_in">hotfix</span>(紧急修复)
</code></pre>
</li>
<li>
<p><strong>Trunk-Based 开发</strong><br/>
强调短周期提交（&lt;1天），持续集成测试，适合 CI/CD 流水线。</p>
</li>
</ul>
<h3 data-id="heading-6">2. 与 SVN 的关键差异对比</h3>








































<table><thead><tr><th>特性</th><th>Git (分布式)</th><th>SVN (集中式)</th></tr></thead><tbody><tr><td>架构</td><td>每个开发者独立完整仓库</td><td>依赖中央服务器</td></tr><tr><td>提交速度</td><td>本地提交即时完成</td><td>需要网络连接</td></tr><tr><td>分支管理</td><td>轻量级分支（毫秒级创建）</td><td>重型分支（资源消耗大）</td></tr><tr><td>合并冲突处理</td><td>支持非快进式合并</td><td>必须快进式合并</td></tr><tr><td>数据安全性</td><td>本地备份+远程备份双重保障</td><td>单点故障风险高</td></tr><tr><td>适合场景</td><td>并行开发、开源协作、CI/CD</td><td>传统瀑布式开发、文档版本控制</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">三、主流代码托管平台推荐</h2>






























<table><thead><tr><th>平台</th><th>特点</th><th>主要用户群体</th></tr></thead><tbody><tr><td>GitHub</td><td>社区活跃，支持开源项目，集成 CI/CD</td><td>全球开发者、开源爱好者</td></tr><tr><td>GitLab</td><td>企业级解决方案，内置 DevOps 流水线</td><td>企业团队、私有项目</td></tr><tr><td>Gitee</td><td>国内镜像加速，深度集成 AI 协作工具</td><td>中文开发者、企业团队</td></tr><tr><td>Bitbucket</td><td>与 Jira 深度集成，支持私有仓库</td><td>Atlassian 生态用户</td></tr></tbody></table>
<p><em>Gitee AI 协作亮点</em></p>
<ul>
<li>自动 PR 代码审查</li>
<li>智能需求解析（支持自然语言转技术文档）</li>
<li>AI 代码补全（实时提示优化方案）</li>
<li>项目进度预测（基于历史数据的交付时间估算）</li>
</ul>
<hr/>
<h2 data-id="heading-8">四、高级操作与最佳实践</h2>
<h3 data-id="heading-9">1. 提交历史优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改最近一次提交</span>
git commit --amend

<span class="hljs-comment"># 合并连续提交</span>
git rebase -i HEAD~3
<span class="hljs-comment"># 将 pick 改为 squash 后保存</span>
</code></pre>
<h3 data-id="heading-10">2. 桃花岛操作（Cherry-pick）</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 复制特定提交到当前分支</span>
git cherry-pick <span class="hljs-section">[commit-id]</span>
</code></pre>
<h3 data-id="heading-11">3. 分支变基（Rebase）</h3>
<pre><code class="hljs language-css" lang="css"># 将 feature 分支变基到 <span class="hljs-selector-tag">main</span>
git checkout feature
git rebase <span class="hljs-selector-tag">main</span>
</code></pre>
<h3 data-id="heading-12">4. 撤销操作</h3>
<pre><code class="hljs language-css" lang="css"># 撤销某次提交（保留更改）
git reset <span class="hljs-attr">--mixed</span> <span class="hljs-selector-attr">[commit-id]</span>
# 彻底删除提交
git reset <span class="hljs-attr">--hard</span> <span class="hljs-selector-attr">[commit-id]</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">五、Git 在 AI 项目中的应用</h2>
<ol>
<li>
<p><strong>模型版本管理</strong><br/>
使用 DVC（Data Version Control）配合 Git 管理 ML 模型权重与数据集。</p>
</li>
<li>
<p><strong>AI 代码审查</strong><br/>
Gitee AI 自动检测：</p>
<ul>
<li>代码规范（PEP8/ESLint）</li>
<li>潜在 Bug 预警</li>
<li>性能优化建议</li>
<li>安全漏洞扫描</li>
</ul>
</li>
<li>
<p><strong>智能 PR 生成</strong><br/>
输入自然语言需求 → AI 生成代码草案 → 人工验证 → 提交 PR</p>
</li>
<li>
<p><strong>AI 驱动的分支策略</strong><br/>
根据项目复杂度自动推荐：</p>
<ul>
<li>GitFlow（大型项目）</li>
<li>Feature Toggle（微服务架构）</li>
<li>Monorepo（多语言统一管理）</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-14">六、常见问题排查</h2>
<ol>
<li>
<p><strong>合并冲突解决</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 标记冲突文件</span>
git status
<span class="hljs-meta"># 手动编辑冲突文件</span>
<span class="hljs-meta"># 标记已解决</span>
git <span class="hljs-keyword">add</span> [文件名]
<span class="hljs-meta"># 完成合并</span>
git commit
</code></pre>
</li>
<li>
<p><strong>密钥丢失恢复</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 重新生成密钥</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"your@email.com"</span>
<span class="hljs-comment"># 添加到系统</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(ssh-agent)</span>"</span>
ssh-add ~/.ssh/id_ed25519
</code></pre>
</li>
<li>
<p><strong>大文件误提交修复</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 移除文件历史</span>
git <span class="hljs-built_in">filter</span>-branch --tree-<span class="hljs-built_in">filter</span> <span class="hljs-string">'rm -f large_file'</span> HEAD
<span class="hljs-comment"># 强制推送</span>
git push origin --force
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Coding老跑偏？用Comate Rules功能，少走十年弯路！]]></title>    <link>https://juejin.cn/post/7583955708318613504</link>    <guid>https://juejin.cn/post/7583955708318613504</guid>    <pubDate>2025-12-16T03:28:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318613504" data-draft-id="7583973472322813967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Coding老跑偏？用Comate Rules功能，少走十年弯路！"/> <meta itemprop="keywords" content="前端,架构,前端框架"/> <meta itemprop="datePublished" content="2025-12-16T03:28:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="文心快码BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Coding老跑偏？用Comate Rules功能，少走十年弯路！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    文心快码BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:28:27.000Z" title="Tue Dec 16 2025 03:28:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你的Comate，我的Comate，好像不一样？</p>
<p>为什么大佬用AI Coding又快又好，而我总遇到各种阻碍？</p>
<p>原来，是他们已经用上了效率神器——Rules！</p>
<p>没听过、不会用，怎么办？</p>
<p>没关系！我们邀请了<strong>Rules资深用户、前端开发崔同学</strong>，跟大家分享一下——</p>
<p>什么是Rules？为什么要用Rules？还有Rules的使用心得～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3e3b2ae0ee245469d66a86a269033bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=uJd6mqHOspVfxgGTBHih4ZXVZNQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>带好笔记本，下面，让我们一起听听Ta怎么说👇</p>
<h2 data-id="heading-0">01 初识Rules：从陌生到熟练</h2>
<p>😎使用Rules是一个什么样的契机呢？就是之前我和AI Coding对话的时候，比较头疼的一点是，经常遇到<strong>重复性的对话</strong>。后期我发现，每次对话时，保留对话框里的聊天记录，向它提问：“你想想我之前说了什么，再回答我这个问题”，它就会说，“好的，我知道了”。 然后它开始检索之前的聊天记录，就知道怎么做了。</p>
<p>🤔当时我想，<strong>这类无意义的对话可以规避么，不能直接输出之前那种想要的结果吗</strong>？于是我找到研发同学，从他那里了解到 <strong>【Rules】</strong> 。</p>
<p>🤯我第一次试效果也不太理想，感觉区别不大。后面大概用了3天的时间，就配置好了符合我个人习惯的Rules。</p>
<p>😍到现在，<strong>我的日常工作中已经离不开Rules，团队中也配置了Rules</strong>，并且这种Rules是适用于团队所有人且不与自己Rules冲突的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fcaa7497c2443ca83dd79b6c16f1a0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=khsMKoNGnoKrjxkczIRSP6wq1OI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这样听起来，Rules好像就是一个有memory的AI Coding工具，那它究竟是什么呢？</p>
<p><strong>定义：</strong> 字面翻译为 “规则”，是和 AI工具相辅相成的 “行为规范手册”，约定 AI 工具的执行流程、输出结果和偏好，<strong>让 AI 按个人 or 团队习惯工作，减少弯路和错误</strong>。</p>
<p><strong>Rules 的效果主要分几个层面</strong>：</p>
<p><strong>1. 命名约定 —— 代码界的“起名大会”</strong></p>
<p><strong>有了命名规则之后，模型就能统一风格、保证可读性</strong>。不再出现一堆“temp1”、“data2”、“final_final_true_version”的奇怪名字。从此团队协作更顺畅，调试也不再像拆盲盒。</p>
<p><strong>2.代码结构 —— 给模型戴上“紧箍咒”</strong></p>
<p>代码结构约束就像是给模型戴了个“紧箍咒”。它不允许模型写“俄罗斯套娃”式的嵌套结构，也不允许函数变成一团“意大利面条式”的灾难代码。<strong>有了结构约束后，代码层次清晰、逻辑明了</strong>，就像写作文有大纲，模型不会乱飙自由发挥。</p>
<p><strong>3.业务逻辑层 —— 模型的“逻辑交警”</strong></p>
<p>业务逻辑层是大模型的“脑回路”，而 Rules 在这里扮演的角色，就像一个“逻辑交警”。它负责指挥——“这个流程该往哪跑”、“那个判断在哪停”。<strong>防止模型乱开车、逻辑撞车，让业务流转更顺畅、更可控。</strong></p>
<p><strong>属性：</strong> 不是独立工具，而是 AI 工具的 “优化补充”——AI 像 “百科全书” 懂很多，但 Rules 能明确使用方式，让输出更贴合需求，还能记录用户喜好，更具人性化。</p>
<p><strong>应用：</strong> 我现在常用的AI Coding工具，像<strong>Comate</strong>这种，还是很好用的。面对大量的知识库文档、需求文档时，就可以<strong>让Comate帮我们总结其中的关键信息和功能，再用Rules去输出结果</strong>，<strong>就会更加贴合实际的开发场景，节省了一遍遍调试、输出结果的时间和精力</strong>。</p>
<p>之前的AI Coding我们可以看作是搜索的合集，把所有知识汇总起来，但是不是所有东西都是我们想要的，现在有了Rules帮我们精挑细选过滤掉一些，<strong>最终结果是更加精细、定制化和符合预期的</strong>。</p>
<p>打开Comate IDE，点击更多—Rules，即可书写规则🔽</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54763214e77944f5af8b87ae5d9eae34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=GVmdJuuzRv0CO6dVLQj%2FyGakwWo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-1">02 实战应用：用Rule为电商开发赋能提效</h2>
<p>Rules现在可以说是我不可或缺的工作搭子！在【电商业务前端开发】中，模块和场景的<strong>重复度比较高</strong>，比如某个搜索页、商品卡的模块或者订单列表页大同小异，这时就没必要每一个都去人工生成。</p>
<p>使用<strong>Comate + Rules就可以替我完成这部分重复工作：</strong> 可以<strong>参考demo去生成</strong>，还可以<strong>设置业务规则</strong>（比如所有的价格展示统一使用一个组件、涉及到的订单状态统一维护一个组件等等），以及<strong>定义错误处理机制</strong>，比如所有可能出错的地方，我们都去使用统一的一个机制去处理，例如统一弹出错误信息、异常捕获等......</p>
<p>让我们以一个<strong>数据看板的需求</strong>为例子：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed28c15a768440588ce42b3855d34583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=tHkocwaPAsxu5hBYmfRo9o%2BMuYc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/809b6d2b34dc4aeb8b504618af8bd660~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=OALfbpW0%2BIECT4jq4SDr%2FN8Huac%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-2">03 团队协作：从1天到10分钟，Rules立大功</h2>
<p>Rules的好用不仅体现在提升个人Coding效率上；<strong>团队协作里，匹配上Rules的团队也是如有神助</strong>。它让团队间的不同同学朝着一个方向、按照一个规范产出，这样就大大降低了大家调整风格、统一规范的时间。</p>
<p>在项目中AI Coding 时，我会把所有Rules和团队其他同学规定好，按照这个当前的Rules去实现我们的项目。这样的一个好处是什么呢？我能规定团队其他人和我一样的规则，他会帮你在后续的提交代码和线上的稳定性方面把关，而不是说像之前咱们固有的方式——人工去把关，<strong>我们每一个的代码的质量，代码的风格、代码的流程，现在是通过 AI 工具去帮我们更多的把关</strong>，大大节省了团队成员间协作的成本｡</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8927a07130eb40a9a6616a2406ab4737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=cYiYQh6oKtutuRMeDwV7DOp%2Bc3E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>跟大家分享2个我最近印象比较深的案例：</p>
<p>✨前阵我们出现了一个 bug，如果正常用人来排查的话，大概需要<strong>1天</strong>时间，但是我通过工具去排查的话，大概<strong>10分钟</strong>排查出的问题，并且帮我改正，这是一个AI提效很好的案例｡</p>
<p>🌟再比如实际开发中，生成页面的任务使用了Rules后可以很快提交，<strong>能从5天压缩到3天</strong>，为什么会有这么快的速度呢？因为一些重复性较高的页面或者模块生成，我们不需要再重复提示大模型，这样就大大提效了。</p>
<p>💫而且在团队推广 Rules 时，大家最担心的其实是代码隐私问题。选用 Comate 也是看重了它的<strong>企业级安全合规</strong>。我们把团队的 Rules 配置好后，一键同步给所有成员，<strong>大家不需要把代码传到不可控的公有云，在保障数据安全的前提下，实现了全员 Coding 效率的飞升。</strong></p>
<h2 data-id="heading-3">04 避坑指南：手把手教你玩转Rules</h2>
<p>最后，我也总结了Rules使用的一些经验和心得，这里分享给大家：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf98f06cca5146b7a32cdb851b66ab71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=VkgD%2BINeWKVSaBRIIjk3YwiNub4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5260e1fb2d104d44aa9ad1ba9d6a58a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=lX3PmA6mzPpDBeIHoDHcQuLyGqA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>🌟 一言以蔽之，为什么我推荐<strong>用 Comate 跑 Rules</strong>？</p>
<ul>
<li><strong>更懂中文：</strong> 国内业务逻辑和文档理解无障碍，沟通成本低。</li>
<li><strong>反应快：</strong> 尤其是代码续写的速度，配合 Rules 简直是“如丝般顺滑”。</li>
<li><strong>生态好：</strong> 像我们这次提到的 Rules 配置，Comate 的兼容性和执行严格度是我试过工具里表现最好的之一。</li>
</ul>
<p>（本内容由百度崔同学&amp;曹同学提供）</p>
<p><strong>👇 别光心动，现在就上手开造！</strong></p>
<p><strong>一键下载 Comate，把你的脑洞变成现实</strong></p>
<p><strong>方式一：</strong> 点击 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fdownload" target="_blank" title="https://comate.baidu.com/zh/download" ref="nofollow noopener noreferrer">comate.baidu.com/zh/download</a> 下载Comate AI IDE，享受丝滑开发过程</p>
<p><strong>方式二：</strong> 在 VS Code 或 Jetbrains IDE 中搜索“文心快码”插件，安装即用</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这份中国人写的大模型书，在外网竟然被刷爆了！]]></title>    <link>https://juejin.cn/post/7584014975241797642</link>    <guid>https://juejin.cn/post/7584014975241797642</guid>    <pubDate>2025-12-16T03:29:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584014975241797642" data-draft-id="7582755817670557706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这份中国人写的大模型书，在外网竟然被刷爆了！"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-16T03:29:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这份中国人写的大模型书，在外网竟然被刷爆了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:29:07.000Z" title="Tue Dec 16 2025 03:29:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>这本中国人写的大模型书已经在外网被很多人引用为 2025 年最好的大模型教材，reddit、X 上很多人在推荐，有人说第一次知道大模型到底在干嘛。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7142106f98514b5992e661ec575f00e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=tfsVimfNJMzb%2FmB9AuMHuQvp7YA%3D" alt="" loading="lazy"/></p>
<p>这本书把transformer 架构、预训练、微调、对齐、推理、token 流过程这些以前绕来绕去的知识点统统串在了一起，构成了一套有体系的解释框架。</p>
<p>它把 Chain-of-Thought（CoT）提示词的原理、发展脉络、不同类型、改进方向全都做了非常细致的归纳，比如：</p>
<p>为什么“分步骤提示”能提升模型的推理能力 ？</p>
<p>自动生成 CoT 的方法有哪些 ？</p>
<p>各类 CoT prompt到底有什么区别？</p>
<p>这些方法在什么场景下有效，什么模型上适配性最好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c95de2cd77244bd8feab6c093a4400b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=6ewnTNEnZOjUyCm4jyYqaESThrM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9517f40e573450aaa86b78d86cf6611~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=%2BooWEP37XdhFvPH8T4PkyoDq2Ls%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20af43abacb0423486ae420165973775~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=6lTYzczGAcJ2lXl1dBZQ53lghak%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1e4ff15a86542c6bae5f2488f5fa473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=s4x54d9Li7vthVj8jkv7Zs17xms%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5e4194945ab4bbeb961ae88d770f641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=V35X3gZuMUSVYmMfZdlnirbkSx8%3D" alt="" loading="lazy"/></p>
<p>如果你打算了解大模型怎么做逻辑推理、怎么构造有效 prompt，这篇文章的参考价值远高于那些碎片博主总结。</p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebP/AVIF 有多香？比 JPEG 小 30%，<picture>标签完美解决兼容性]]></title>    <link>https://juejin.cn/post/7584014975241912330</link>    <guid>https://juejin.cn/post/7584014975241912330</guid>    <pubDate>2025-12-16T03:37:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584014975241912330" data-draft-id="7583948178858917934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebP/AVIF 有多香？比 JPEG 小 30%，&lt;picture&gt;标签完美解决兼容性"/> <meta itemprop="keywords" content="前端,面试,性能优化"/> <meta itemprop="datePublished" content="2025-12-16T03:37:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PineappleCoder"/> <meta itemprop="url" content="https://juejin.cn/user/3323167184272627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebP/AVIF 有多香？比 JPEG 小 30%，&lt;picture&gt;标签完美解决兼容性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323167184272627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PineappleCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:37:18.000Z" title="Tue Dec 16 2025 03:37:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🖼️ 告别“图多杀猫”：前端图片加载策略全攻略，让你的页面又快又美！</h2>
<blockquote>
<p><strong>前端性能优化专栏 - 第七篇</strong></p>
</blockquote>
<p>在前端性能优化的战场上，<strong>图片</strong>无疑是最大的“资源杀手”。它们通常占据了网页下载体积的<strong>一半以上</strong>。一个图片加载策略不当的网站，就像一辆装满了超重行李的跑车，再好的引擎也跑不快。</p>
<p>本篇，我们就来深入探讨如何系统性地优化图片加载，让你的页面既高清又秒开！</p>
<hr/>
<h3 data-id="heading-1">⚠️ 图片优化的意义：不仅仅是快</h3>
<p>图片优化是一种<strong>系统性工程</strong>，它的意义远超乎“加载快一点”：</p>
<ul>
<li><strong>体积最大：</strong> 图片是网页中体积最大的静态资源之一，优化可显著降低页面首屏加载时间。</li>
<li><strong>影响 SEO：</strong> 页面加载速度是搜索引擎排名的重要指标。</li>
<li><strong>影响转化率：</strong> 页面每延迟一秒，用户流失率和转化率都会受到负面影响。</li>
<li><strong>用户留存：</strong> 快速、流畅的体验是用户留下的关键。</li>
</ul>
<h3 data-id="heading-2">✨ 策略一：格式选择 — 新旧格式的博弈</h3>
<p>选择合适的图片格式是优化的第一步，也是最重要的一步。我们必须根据场景和兼容性，在新旧格式之间做出权衡。</p>
<h4 data-id="heading-3">1. 新一代格式：WebP 与 AVIF</h4>























<table><thead><tr><th>格式</th><th>优势</th><th>适用场景</th><th>兼容性</th></tr></thead><tbody><tr><td><strong>WebP</strong></td><td>更高压缩率，体积比 JPEG 小约 30%，支持无损和有损压缩，支持透明度。</td><td>网页中的大部分图片，尤其是需要透明度的图标。</td><td>广泛支持（Chrome, Firefox, Edge, Safari）。</td></tr><tr><td><strong>AVIF</strong></td><td>基于 AV1 视频编码，压缩率比 WebP 更高，体积更小。</td><td>对性能要求极高，且目标用户群浏览器支持度较高的场景。</td><td>较新，支持度稍低于 WebP。</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a3acb337f824d21b3b4be715a92211d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461038&amp;x-signature=iPOITbpHwYrjl96%2BJNyenHlcepI%3D" alt="图片格式体积与质量对比图" loading="lazy"/></p>
<h4 data-id="heading-4">2. 传统格式：JPEG 与 PNG</h4>
<ul>
<li><strong>JPEG：</strong> 适合色彩丰富的<strong>照片</strong>或<strong>大图</strong>，采用有损压缩，不支持透明度。</li>
<li><strong>PNG：</strong> 适合需要<strong>透明背景</strong>的图标、Logo 或截图，采用无损压缩，体积通常较大。</li>
</ul>
<h3 data-id="heading-5">🔄 策略二：响应式图片 — 按需加载的智慧</h3>
<p>在移动设备、平板和高清屏并存的今天，给所有设备都加载同一张大图是极大的浪费。<strong>响应式图片</strong>就是解决这个问题的“智慧大脑”。</p>
<h4 data-id="heading-6">1. <code>srcset</code> 实现分辨率适配</h4>
<p><code>srcset</code> 允许浏览器根据设备的<strong>分辨率</strong>和<strong>视口大小</strong>来选择最合适的图片源。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img <span class="hljs-attr">srcset</span>=<span class="hljs-string">"image-480w.jpg 480w,
             image-800w.jpg 800w"</span>（图片源的集合）
     <span class="hljs-attr">sizes</span>=<span class="hljs-string">"(max-width: 600px) 480px, 800px"</span>（提供上下文，&lt;=<span class="hljs-number">600</span>像素使用<span class="hljs-number">480</span>，大于使用<span class="hljs-number">800</span>）
     <span class="hljs-attr">src</span>=<span class="hljs-string">"image-800w.jpg"</span>（降级方案，为旧浏览器提供）
     <span class="hljs-attr">alt</span>=<span class="hljs-string">"响应式图片"</span>&gt;
</code></pre>
<ul>
<li><strong><code>srcset</code>：</strong> 告诉浏览器有哪些可用的图片资源及其对应的宽度（<code>w</code>）。</li>
<li><strong><code>sizes</code>：</strong> 告诉浏览器在不同视口大小下，图片将占据的宽度。</li>
<li><strong><code>src</code>：</strong> 作为旧浏览器的<strong>降级方案</strong>，保证兼容性。</li>
</ul>
<h4 data-id="heading-7">2. <code>&lt;picture&gt;</code> 元素实现格式切换</h4>
<p><code>&lt;picture&gt;</code> 元素可以实现更高级的控制，让浏览器根据<strong>格式兼容性</strong>来选择图片源，完美解决新格式的兼容性问题。</p>
<pre><code class="hljs language-bash" lang="bash">&lt;picture&gt;（从上往下依次询问是否符合这个<span class="hljs-built_in">source</span>）
  &lt;<span class="hljs-built_in">source</span> srcset=<span class="hljs-string">"image.avif"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"image/avif"</span>&gt;
  &lt;<span class="hljs-built_in">source</span> srcset=<span class="hljs-string">"image.webp"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"image/webp"</span>&gt;
  &lt;img src=<span class="hljs-string">"image.jpg"</span> alt=<span class="hljs-string">"多格式图片"</span>&gt;
&lt;/picture&gt;
</code></pre>
<p><strong>工作原理：</strong> 浏览器会从上往下依次检查 <code>&lt;source&gt;</code> 标签，一旦找到一个它支持的 <code>type</code> 或符合条件的 <code>srcset</code>，就会加载该资源，并忽略后续的 <code>&lt;source&gt;</code>。如果所有 <code>&lt;source&gt;</code> 都不支持，则会加载最后的 <code>&lt;img&gt;</code> 标签中的 <code>src</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/229ddac3b6894cabadeb7f1b19fddbf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461038&amp;x-signature=dxKr6gYZoMzDofx0H%2BbZhxcCVds%3D" alt="picture 和 srcset 响应式加载示意图" loading="lazy"/></p>
<p><strong>核心优势：</strong></p>
<ul>
<li><strong>浏览器自动选择最佳格式与尺寸</strong>。</li>
<li><strong>避免浪费带宽与不必要的下载</strong>。</li>
</ul>
<h3 data-id="heading-8">🔧 策略三：加载时机 — 懒加载与预加载</h3>
<p>除了图片本身，何时加载图片也至关重要。</p>
<h4 data-id="heading-9">1. 懒加载（Lazy Loading）</h4>
<p>对于<strong>首屏以外</strong>的图片，应采用懒加载。即只有当图片进入或即将进入用户视口时才开始加载。</p>
<ul>
<li>
<p><strong>原生支持：</strong> 现代浏览器已支持 <code>loading="lazy"</code> 属性，无需 JavaScript 库。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img <span class="hljs-attr">src</span>=<span class="hljs-string">"image.jpg"</span> loading=<span class="hljs-string">"lazy"</span> alt=<span class="hljs-string">"懒加载图片"</span>&gt;
</code></pre>
</li>
</ul>
<h4 data-id="heading-10">2. 预加载（Preloading）</h4>
<p>对于<strong>首屏关键</strong>的图片（如 Logo、背景图），应使用预加载，确保它们尽快被加载。</p>
<ul>
<li>
<p><strong>HTML 标签：</strong></p>
<pre><code class="hljs language-ini" lang="ini">&lt;link <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> href=<span class="hljs-string">"critical-image.jpg"</span> as=<span class="hljs-string">"image"</span>&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-11">✅ 总结与实践：图片优化 Check List</h3>
<p>图片优化是一个多维度的工程，以下是实践中的 Check List：</p>



































<table><thead><tr><th>优化层面</th><th>实践方法</th><th>目标</th></tr></thead><tbody><tr><td><strong>格式层面</strong></td><td>优先使用 <strong>WebP / AVIF</strong>，PNG/JPEG 作为降级。</td><td>最小化文件体积。</td></tr><tr><td><strong>响应式层面</strong></td><td>利用 <strong><code>&lt;picture&gt;</code></strong> 和 <strong><code>srcset</code></strong> 实现格式和尺寸的按需加载。</td><td>避免加载不必要的资源。</td></tr><tr><td><strong>加载层面</strong></td><td><strong>首屏关键图</strong>使用预加载，<strong>非首屏图</strong>使用懒加载。</td><td>优化加载时机，提升首屏速度。</td></tr><tr><td><strong>压缩层面</strong></td><td>在构建阶段使用工具（如 <code>imagemin</code>）进行<strong>自动化无损/有损压缩</strong>。</td><td>保证图片质量的同时进一步减小体积。</td></tr><tr><td><strong>架构层面</strong></td><td>接入 <strong>CDN</strong> 与专业的<strong>图片服务</strong>（如阿里云 OSS、七牛云等）。</td><td>自动处理格式转换、缩放和压缩。</td></tr></tbody></table>
<hr/>
<p><strong>下一篇预告：</strong> 面对大量的图标和小图片，一个个请求不仅慢，还会造成大量的 HTTP 开销。下一篇我们将探讨如何将这些零散的资源“打包”起来，学习 <strong>雪碧图（CSS Sprites）</strong> 的原理和实践，以及如何利用它来优化 <strong>SVG</strong> 的加载。敬请期待！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 宣布 Runtime 编译速度史诗级提升：在编译时间上优化了 18%]]></title>    <link>https://juejin.cn/post/7583980250733969471</link>    <guid>https://juejin.cn/post/7583980250733969471</guid>    <pubDate>2025-12-16T03:40:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250733969471" data-draft-id="7583933107690750015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 宣布 Runtime 编译速度史诗级提升：在编译时间上优化了 18%"/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2025-12-16T03:40:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 宣布 Runtime 编译速度史诗级提升：在编译时间上优化了 18%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:40:54.000Z" title="Tue Dec 16 2025 03:40:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近期，<strong>Android 官方宣布了 Android Runtime 在编译时间上实现了 18% 的显著优化，同时不牺牲编译代码的质量，也没有增加峰值内存使用</strong>，换句话说，这属于是一个“<strong>速度提升 + 零损失</strong>”的优化成果。</p>
<p>实际上这个调整作为 2025 年的关键 KPI ，目前已经实现了分阶段 rollout：<strong>部分优化已经在 2025 年 6 月的 Android 发布中上线，其余会在年底发布中完成</strong>，所有运行 Android 12 及以上版本的用户都可以通过 mainline 更新得到这些改进。</p>
<blockquote>
<p>“mainline 更新”（ Project Mainline / Google Play System Updates） 是一种模块化更新机制，它支持 Google 通过 Google Play 直接更新 Android 系统的核心组件（如Android Runtime、媒体框架、安全模块等），这个更新不需要用户等待 OTA 。</p>
</blockquote>
<p>而这次优化更加具体的说就是：</p>
<ul>
<li><strong>编译时间减少了 18%</strong></li>
</ul>

<ul>
<li>对编译器最终输出质量没有负面影响</li>
</ul>

<ul>
<li>没有出现内存回归（就是提升过程中不增加内存占用峰值）</li>
</ul>
<p>并且，这些改进对于 JIT 和 AOT（预先编译） 都有用，当然<strong>这里提到的 Android Runtime（ART）“编译速度”不是你在本地用 Gradle 构建 APK 的速度，而是「设备端 ART 对 app 字节码进行 AOT / JIT 编译的速度」</strong> ，一般而言针对ART 内部的“编译器执行速度”会有：</p>
<ul>
<li>JIT 编译速度</li>
<li>AOT / dex2oat 编译速度</li>
<li>编译器各个 IR / 优化 pass 的执行时间</li>
</ul>
<p>例如在 ART 里有很多 pass（比如 GVN、某些数据流分析），每次都会遍历 IR，即使当前方法根本不满足优化条件也会完整跑一遍逻辑，这种行为带来的开销并没有产生收益：</p>
<blockquote>
<p>官方提到，在之前有一个名为全局值编号 (GVN) 的阶段，这个过程里它有一个名为 <code>Kill</code> 的方法，这个方法会根据过滤器删除一些节点，由于它需要遍历所有节点并逐个检查，因此非常耗时，而事实上无论当时有多少节点存活，其实都能预先知道检查结果为 false ，那么在这种情况下完全可以跳过遍历，从而将性能消耗从 1.023% 降低到约 0.3%，并将 GVN 的运行时间缩短约 15%。</p>
</blockquote>
<p>其他的一些案例，包括有：</p>
<h4 data-id="heading-0"><code>FindReferenceInfoOf</code> 的查找优化</h4>
<p><code>LoadStoreAnalysis</code> 阶段的方法 <code>FindReferenceInfoOf</code> 原本使用线性搜索 O(n) 在向量中查找，而现在将数据结构改为以指令 ID 为索引，实现 O(1) 查找，并预分配向量以避免 resize ， <strong>从而在这个阶段加速 34 - 66%，总编译时间提升 0.5-1.8%，虽然增加了一个计数字段，但峰值内存没有增加</strong>。</p>
<h4 data-id="heading-1">结构调整</h4>
<p>代码库中使用了一个自定义的 <code>HashSet</code>，多年前是为了处理极少数的大型集合而优化的，但现在的用法变成了创建大量小型的、短生命周期的集合，所以本地调整实现以适应“小而短”的用法，减少创建和销毁开销，<strong>从而让编译时间提升 1.3-2%，且内存使用量反而下降了 0.5-1%</strong> 。</p>
<p>还有通过将数据结构以引用方式传递给 lambda 表达式，避免了数据结构的复制，从而将编译时间缩短了约 0.5% 到 1% ，这一点在最初的代码审查中被忽略了，并在代码库中保留了多年：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5884e1bdbb1451ba34bb04a5b1dcd18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=OnHrUf%2B0SjuZ0%2FkUTWq74fGATSo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">内联 (Inlining) 检查</h4>
<p>编译器为了性能会内联函数，原本的流程是先计算大量数据，最后再做“最终检查”（如指令数、寄存器需求）决定是否内联，而现在将这些检查从“计算后”移到了“计算前”作为启发式规则（Heuristics），避免了大量无效计算，<strong>仅指令数检查一项的移动就带来了约 2% 的提升</strong>。</p>
<p>事实上官方在进行这些调整时也遇到了不少问题，因为即使你发现某个区域占用了大量编译时间，并且投入了开发时间尝试改进，有时也找不到解决方案，当你修改了 A 问题后，自然而然就带了 B 问题，比如：</p>
<ul>
<li><strong>内存回归</strong> ：在优化“输出写入”阶段时，团队通过缓存计算值来加速（原本预计提升 1.3-2.8%），但自动化测试时发现，额外的缓存数据结构导致了内存使用量的显著增加</li>
<li><strong>历史遗留负担</strong> ：许多低效代码是因为历史原因遗留下来的（比如上述的 <code>HashSet</code>），或者是因为代码审查疏忽（将对象按值传递而不是按引用传递）</li>
<li><strong>复杂度的权衡</strong> ：某些优化方案可能过于复杂，或者会增加代码维护难度</li>
</ul>
<p>针对这些问题，官方进行了一系列的调整尝试：</p>
<ul>
<li><strong>重构解决内存回归</strong> ：针对“输出写入”阶段的内存问题，本次直接重构了该阶段的逻辑，这里设计了一种新方案，移除了两个冗余数据结构中的一个，这不仅解决了内存回退问题，还进一步提升了 0.5-1.8% 的速度<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50691e9c962d41e7b558bfec3faf585d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=y4RTZRiorDUOScj7jbBlN682d%2BM%3D" alt="" loading="lazy"/></li>
<li><strong>使用 pprof 进行深度分析</strong> ：利用 <code>pprof</code> 工具生成 Flame Graph和 Bottom-up 视图，精准定位那些“隐形”的开销（如频繁的 <code>Kill</code> 方法或意外的对象拷贝）<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44d769a04d2c4ba09f63dd56f255a84b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=oJMfUQSxGNIY9tA4UfQDKs01wwk%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8a0e32ebaca42288fd5b5af85f5da4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=Y8%2B%2FsUtI717%2BYsyJ%2FxFtXxUsP9E%3D" alt="" loading="lazy"/></li>
<li><strong>“快速迭代”策略</strong> ：为了节省开发时间，先用原型（Prototype）在典型应用（First-party apps, Android OS）上快速验证想法，确认收益后再进行完整的工程实现和测试</li>
<li><strong>利用全新 C++ 特性</strong> ：比如使用 <code>BitVectorView</code> 替代可变长的 <code>BitVector</code>，并利用模板化实现让 <code>Union()</code> 操作在 64 位平台上一次处理两倍的位数</li>
</ul>
<p>除此之外还有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3469440" target="_blank" title="http://r.android.com/3469440" ref="nofollow noopener noreferrer">Add bookkeeping</a> 将编译时间缩短约 0.6-1.6%</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3492151" target="_blank" title="http://r.android.com/3492151" ref="nofollow noopener noreferrer">Lazily compute data</a> 来避免循环计算</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2Fbd15b243cda3f9c5038b76099e703e050890f280%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/bd15b243cda3f9c5038b76099e703e050890f280%5E!/#F0" ref="nofollow noopener noreferrer">Refactor our code</a> 跳过不会用到的预计算工作</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3497214" target="_blank" title="http://r.android.com/3497214" ref="nofollow noopener noreferrer">Avoid some dependent load chains</a> 如果可以从其他地方轻松获取 allocator</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2Fbf625ebd279484bc5b0214e1659797dac2f27c8d%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/bf625ebd279484bc5b0214e1659797dac2f27c8d%5E!/#F0" ref="nofollow noopener noreferrer">避免在寄存器分配中频繁地对寄存器类型（核心/浮点）进行分支</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3802063" target="_blank" title="http://r.android.com/3802063" ref="nofollow noopener noreferrer">确保某些数组</a>在编译时已初始化，不要依赖 clang 来完成这项工作</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2F77a5d1e6464a03460fad1daa6f357f3a9e5d8f19%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/77a5d1e6464a03460fad1daa6f357f3a9e5d8f19%5E!/#F0" ref="nofollow noopener noreferrer">优化一些循环 </a>，使用范围循环，因为 clang 可以更好地优化范围循环，避免因循环副作用而重新加载容器的内部指针，避免在循环中通过内联的 <code>InputAt(.)</code> 为每个输入调用虚函数 <code>HInstruction::GetInputRecords()</code></li>
<li>利用编译器优化，<a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2F85f6b01b978b0543e964fa65d9d66adfedfd90cb%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/85f6b01b978b0543e964fa65d9d66adfedfd90cb%5E!/#F0" ref="nofollow noopener noreferrer"> 避免在访问者模式中使用 Accept() 函数</a></li>
</ul>
<h2 data-id="heading-3">最后</h2>
<p>最后，看不懂不要紧，只需要知道它很牛逼，并且还能让 Android 12 以后的机器变得更快，在用户端体现出来就是：</p>
<ul>
<li>app 启动更快</li>
<li>冷启动更少卡顿</li>
<li>低端机更友好</li>
<li>安装 / 更新变快</li>
</ul>
<p>同时也展示了教科书级别的优化策略，不仅要看速度，更要看内存、稳定性、可维护性等综合指标，所以官方这份报告不仅仅是技术公告，更是一份优秀的编译器工程的案例研究。</p>
<h2 data-id="heading-4">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid-developers.googleblog.com%2F2025%2F12%2F18-faster-compiles-0-compromises.html" target="_blank" title="https://android-developers.googleblog.com/2025/12/18-faster-compiles-0-compromises.html" ref="nofollow noopener noreferrer">android-developers.googleblog.com/2025/12/18-…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚]]></title>    <link>https://juejin.cn/post/7583921477614125091</link>    <guid>https://juejin.cn/post/7583921477614125091</guid>    <pubDate>2025-12-16T02:00:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477614125091" data-draft-id="7583921477614108707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T02:00:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="软件求生"/> <meta itemprop="url" content="https://juejin.cn/user/1038379932466263"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1038379932466263/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    软件求生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:00:07.000Z" title="Tue Dec 16 2025 02:00:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很久很久以前，在 JavaScript 世界里，有一个叫<strong>变量镇</strong>的地方。这里住着三兄弟：<strong>var、let、const</strong>。他们都能“装东西”，但性格、规矩、出身背景完全不一样。也正因为这三兄弟的性格差异，程序员江湖里每天都在上演各种事故现场。</p>
<p>今天，我就带你走进变量镇，看看他们各自是怎么“翻车”的，又该如何正确相处。</p>
<h2 data-id="heading-0">老大哥 var：江湖老油条</h2>
<p><strong>1、var 关键字：最早的居民</strong></p>
<p>var 是 JavaScript 最早的变量声明方式，堪称<strong>上古神器</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28deaf0d6a844195bc7caa30a7d83813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=K5h9NfGX4vJhCr5eXQY39Yn1TC8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 ES6 之前，整个变量镇几乎被 var 一统江湖。但问题也正是从这里开始的。</p>
<p><strong>2、 var 声明作用域：没有块级概念</strong></p>
<p>在变量镇里，var 有个非常“随意”的性格：<strong>它只认函数，不认花括号。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90c1c989eb804ddca7096d90f7f8ed13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=gy9p6ovTp72ZeMgJwkIjCgGyphM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很多新手第一次看到这个结果时，内心都是崩溃的：</p>
<blockquote>
<p>“不是写在 if 里面吗？怎么跑出来了？”</p>
</blockquote>
<p>在 var 眼里，if、for、while 都不算地盘，只有<strong>函数</strong>才算真正的边界。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c521decb3ca434bad59a00cd849abd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=GQ89rjnJsrksrRD9q7j2zUKqfJM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>总结一句话：</strong></p>
<blockquote>
<p>var 只有<strong>函数作用域</strong>，没有<strong>块级作用域</strong>。</p>
</blockquote>
<p><strong>3、 var 声明提升：先上车后补票</strong></p>
<p>var 还有一个让人又爱又恨的能力——<strong>声明提升</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e9618edf554564a30ece01961a99d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=quTfGnFQINMvYsufwrgWLwHK65E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 JavaScript 引擎眼里，上面的代码其实是这样执行的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a44dab9927434a12bc7492bc16cfd15a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=NEN3PckLYYbDzc1WN0YmdrVjsyI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>变量声明被“偷偷”提到了最前面，但赋值还在原地。这就像你先报了名字进群，但个人资料还没填完。</p>
<p><strong>风险点：</strong></p>
<ul>
<li>不报错</li>
<li>但结果是 undefined</li>
<li>很容易掩盖 bug</li>
</ul>
<h2 data-id="heading-1">二哥 let：讲规矩的现代青年</h2>
<p>后来，ES6 来了，变量镇迎来了新居民：<strong>let</strong>。</p>
<p><strong>1、let 声明：有边界感的人</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e565c0f2e2e4bdeb395f4761792a373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=caJzDKseBQ8go%2FV7Pnobl%2Bnvi6g%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>let 的出现，第一件事就是：<strong>给变量加上边界感。</strong></p>
<p><strong>2、 暂时性死区：我没到，你别碰</strong></p>
<p>let 有一个非常重要的概念：<strong>暂时性死区（TDZ）</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/582ff83b22fe4eb489cc1741590d777a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=MVK95A9FF28Icyo9cto7YH3KAfw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>直接报错：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01e120eb692d4432b224699cb9db5bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=CemmIat1%2Bg5sceDsIwjyRVmGHis%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 let 看来：“你可以提前知道我会来，但在我真正登场之前，你不能碰我。”</p>
<p>这和 var 的“先声明后赋值”完全不同。</p>
<p><strong>3、 let 的块级作用域</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ed80bd1aa9245d193e6ae511c39ea52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=9S3ym4G83zBZUXoGpnJbSdwbgzU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这一次，变量终于<strong>老老实实待在自己的花括号里</strong>。</p>
<p>这也是 let 最大的价值之一：<strong>减少变量污染，降低心智负担。</strong></p>
<p><strong>4、 全局声明：不会挂到 window 上</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d178b524c6da45748148b6ac15cfb3da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=mUPRLfA0g5oII5VMsQv79gLIVnE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>而如果是 var：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e4b9c139ee648a0a970f8173e678795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=5JUs6kK%2FRjSDmhQ4prqVxLJgdoM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这意味着：</p>
<ul>
<li>var 会污染全局对象</li>
<li>let 不会</li>
</ul>
<p>在大型项目里，这一点尤为重要。</p>
<p><strong>5、 for 循环中的 let：为循环而生</strong></p>
<p>这是 let 最让人拍手叫好的地方。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b857d92ae73f4ac59dc1234451dd9237~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=4ZXthja%2Bp3xGjeZbsNk6I057lQU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>输出结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d7d53fafa7c45f9b4f1ad5e23dd2899~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=vY7c0QgEmmyV93zs5yx7A48KWc0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>如果换成 var：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f1769498364d04869548c5da3453e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=yy6fYvuds95yKSH3aj6lnJSbs0I%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>结果是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1941834751b74ef4b0fa4655cf95b9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=aQIQXRRrXyep9BLeErfEykt7A4s%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>原因很简单：</p>
<ul>
<li>var 只有一个 i</li>
<li>let 每次循环都会创建一个新的 i</li>
</ul>
<p><strong>一句话总结：</strong> 只要是循环变量，<strong>优先 let</strong>。</p>
<h2 data-id="heading-2">三弟 const：外冷内热的守护者</h2>
<p><strong>1、const 声明：不可变的承诺</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00cd682707604f38ac220f49152b3557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=HXpQGuXLZUCN%2BxA%2Fz%2BSWT3R9hLg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>const 的核心思想是：<strong>一旦绑定，就不能重新绑定。</strong></p>
<p>但很多人会误解这一点。</p>
<p><strong>2、const 并不等于“值不可变”</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7ab00b41a524ccc9fead1cae57efaf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=1kSW7Q8nuOJ5nYSNVYcKuxVryfc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>真正不能做的是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082a2566fb12457884a6a0a87bace289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=DpbQbIDRMsvxpRba39hUvWF80BA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>也就是说：</p>
<ul>
<li>const 锁的是<strong>引用</strong></li>
<li>不是对象内部的属性</li>
</ul>
<h2 data-id="heading-3">三兄弟性格对比表</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4560ae2f8654a0187941b086fe36a3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=nEue4PvJZSvSHs77j1%2B3weI8cn8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-4">声明风格及最佳实践</h2>
<p>讲完故事，我们回到现实世界。</p>
<p><strong>1、 不使用 var</strong></p>
<p>这是现代 JavaScript 项目的共识。原因很简单：</p>
<ul>
<li>容易产生隐式 bug</li>
<li>作用域不直观</li>
<li>不符合现代工程化需求</li>
</ul>
<p>除非你在维护<strong>非常古老的代码</strong>，否则：<strong>请忘记 var 的存在。</strong></p>
<p><strong>2、 const 优先，let 次之</strong></p>
<p>这是我在团队里反复强调的一条规则。<strong>推荐顺序：</strong></p>
<ol>
<li>能用 const 就用 const</li>
<li>需要重新赋值时，用 let</li>
<li>永远不要用 var</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bb341c4c39f42f7ad5099fcd910ee3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=q79NRTPN5SeETVz4kiv6MTi5ePo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这样做的好处是：</p>
<ul>
<li>一眼就能看出哪些变量不会变</li>
<li>降低认知成本</li>
<li>代码更安全、更自解释</li>
</ul>
<h2 data-id="heading-5">总结：变量，其实是人的影子</h2>
<p>写到这里，我越来越觉得：</p>
<blockquote>
<p>JavaScript 的变量声明，其实特别像人。</p>
<p>var 像没边界感的老前辈，热心但容易添乱</p>
<p>let 像讲规则的现代职场人，清晰、可靠</p>
<p>const 像立下承诺的人，一旦决定就不会轻易改变</p>
</blockquote>
<p>当你开始<strong>认真选择变量声明方式</strong>的时候，说明你已经不再只是“写能跑的代码”，而是在写<strong>长期可维护的工程</strong>。</p>
<h2 data-id="heading-6">END</h2>
<p>如果你觉得这篇文章对你有帮助，欢迎<strong>点赞、在看、转发</strong>，让更多人认识变量镇的三兄弟。</p>
<p>我是小米，一个喜欢分享技术的31岁程序员。如果你喜欢我的文章，欢迎关注我的微信公众号“<strong>软件求生</strong>”，获取更多技术干货！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 pnpm + Workspaces 构建 Monorepo 的完整指南]]></title>    <link>https://juejin.cn/post/7583970267132821510</link>    <guid>https://juejin.cn/post/7583970267132821510</guid>    <pubDate>2025-12-16T02:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132821510" data-draft-id="7583980250733232191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 pnpm + Workspaces 构建 Monorepo 的完整指南"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T02:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 pnpm + Workspaces 构建 Monorepo 的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:05:01.000Z" title="Tue Dec 16 2025 02:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心概念：pnpm Workspace</h2>
<p>pnpm 内置了对 Monorepo（单一代码仓库）的原生支持，通过 <strong>Workspace（工作区）</strong> ​ 机制实现。Workspace 允许你在一个仓库中管理多个相互关联但独立的项目（包），并智能地处理它们之间的依赖关系。</p>
<h2 data-id="heading-1">二、将普通仓库转变为 Monorepo 的步骤</h2>
<h3 data-id="heading-2">步骤 1：初始化项目结构</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 创建项目根目录</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-monorepo
cd <span class="hljs-keyword">my</span>-monorepo

<span class="hljs-comment"># 初始化根目录 package.json</span>
pnpm init
</code></pre>
<h3 data-id="heading-3">步骤 2：配置根目录 package.json</h3>
<p>修改根目录的 <code>package.json</code>，关键配置如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-monorepo"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-regexp">//</span> 必须设置为 <span class="hljs-literal">true</span>，避免误发布到 npm
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"pnpm -r run dev"</span>,      <span class="hljs-regexp">//</span> -r 表示递归执行所有子包
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"pnpm -r run build"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"pnpm -r run test"</span>
  },
  <span class="hljs-string">"keywords"</span>: [],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>
}
</code></pre>
<p><strong>重要说明</strong>：</p>
<ul>
<li><code>"private": true</code>是必须的，确保整个 Monorepo 不会被意外发布</li>
<li>可以移除 <code>main</code>、<code>test</code>等字段，因为根目录通常不包含业务代码</li>
</ul>
<h3 data-id="heading-4">步骤 3：创建 pnpm-workspace.yaml 配置文件</h3>
<p>在根目录创建 <code>pnpm-workspace.yaml</code>文件，这是 pnpm Workspace 的核心配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  <span class="hljs-comment"># packages 目录下的所有直接子目录</span>
  - <span class="hljs-string">'packages/*'</span>
  
  <span class="hljs-comment"># apps 目录下的所有直接子目录</span>
  - <span class="hljs-string">'apps/*'</span>
  
  <span class="hljs-comment"># components 目录下的所有层级子目录</span>
  - <span class="hljs-string">'components/**'</span>
  
  <span class="hljs-comment"># 排除包含 test 的目录</span>
  - <span class="hljs-string">'!**/test/**'</span>
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>packages/*</code>：匹配 <code>packages</code>目录下的所有一级子目录</li>
<li><code>apps/*</code>：匹配 <code>apps</code>目录下的所有一级子目录</li>
<li><code>components/**</code>：匹配 <code>components</code>目录下的所有层级子目录</li>
<li><code>!**/test/**</code>：排除所有包含 <code>test</code>的目录</li>
</ul>
<p>pnpm 中的两种配置方式</p>
<h4 data-id="heading-5">方式一：使用 <code>package.json</code>的 <code>workspaces</code>字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"apps/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-6">方式二：使用 <code>pnpm-workspace.yaml</code>文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除包含 test 的目录</span>
</code></pre>
<h4 data-id="heading-7">两种方式的优先级与兼容性</h4>
<ol>
<li>
<p><strong>pnpm 的读取顺序</strong>：</p>
<ul>
<li>优先读取 <code>pnpm-workspace.yaml</code></li>
<li>如果不存在，则读取 <code>package.json</code>中的 <code>workspaces</code>字段</li>
<li>如果两者都存在，<strong><code>pnpm-workspace.yaml</code>优先级更高</strong>​</li>
</ul>
</li>
<li>
<p><strong>推荐使用 <code>pnpm-workspace.yaml</code>的原因</strong>：</p>
<ul>
<li><strong>更丰富的配置选项</strong>：支持排除模式（<code>!**/test/**</code>）</li>
<li><strong>更好的可读性</strong>：YAML 格式更适合复杂配置</li>
<li><strong>工具兼容性</strong>：明确标识为 pnpm 工作区</li>
<li><strong>未来扩展性</strong>：pnpm 的新功能会优先在 YAML 配置中支持</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">步骤 4：创建子项目结构</h3>
<p>典型的 Monorepo 目录结构如下：</p>
<pre><code class="hljs language-csharp" lang="csharp">my-monorepo/
├── pnpm-workspace.yaml
├── package.json
├── pnpm-<span class="hljs-keyword">lock</span>.yaml
├── packages/
│   ├── shared-utils/     <span class="hljs-meta"># 共享工具库</span>
│   │   ├── package.json
│   │   └── src/
│   ├── ui-components/    <span class="hljs-meta"># UI 组件库</span>
│   │   ├── package.json
│   │   └── src/
│   └── core-lib/         <span class="hljs-meta"># 核心库</span>
│       ├── package.json
│       └── src/
├── apps/
│   ├── web-app/          <span class="hljs-meta"># 前端应用</span>
│   │   ├── package.json
│   │   └── src/
│   └── mobile-app/       <span class="hljs-meta"># 移动应用</span>
│       ├── package.json
│       └── src/
└── docs/                 <span class="hljs-meta"># 文档</span>
</code></pre>
<h3 data-id="heading-9">步骤 5：配置子项目的 package.json</h3>
<p>每个子项目都需要有自己的 <code>package.json</code>，关键配置如下： <strong>示例：共享工具库 (packages/shared-utils/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@my-monorepo/shared-utils"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/index.d.ts"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc"</span>,
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"tsc --watch"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<p><strong>示例：前端应用 (apps/web-app/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"web-app"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"preview"</span>: <span class="hljs-string">"vite preview"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,  <span class="hljs-regexp">//</span> 关键：引用本地包
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"@types/react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-10">三、关键配置详解</h2>
<h3 data-id="heading-11">1. workspace:* 协议</h3>
<p>这是 pnpm Workspace 的核心特性，用于声明对本地其他包的依赖：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,      <span class="hljs-regexp">//</span> 使用最新版本
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:^1.0.0"</span>, <span class="hljs-regexp">//</span> 指定版本范围
    <span class="hljs-string">"@my-monorepo/core-lib"</span>: <span class="hljs-string">"workspace:../packages/core-lib"</span> // 相对路径
  }
}
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>建立本地包之间的软链接，无需发布到 npm</li>
<li>修改本地包时，依赖它的项目能立即看到变化</li>
<li>确保所有包使用同一份依赖，避免重复安装</li>
</ul>
<h3 data-id="heading-12">2. 依赖安装与管理</h3>
<h4 data-id="heading-13">在根目录安装全局依赖（所有包共享）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安装到根目录，所有包共享</span>
pnpm <span class="hljs-keyword">add</span> typescript -w
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> typescript --workspace-root
</code></pre>
<h4 data-id="heading-14">为特定包安装依赖</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 为 web-app 安装 react</span>
pnpm <span class="hljs-keyword">add</span> react --filter web-app
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> react -F web-app

<span class="hljs-meta"># 为多个包安装依赖</span>
pnpm <span class="hljs-keyword">add</span> axios --filter <span class="hljs-string">"web-app"</span> --filter <span class="hljs-string">"mobile-app"</span>
</code></pre>
<h4 data-id="heading-15">安装本地包依赖</h4>
<pre><code class="hljs language-sql" lang="sql"># 在 web<span class="hljs-operator">-</span>app 中安装 shared<span class="hljs-operator">-</span>utils
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>monorepo<span class="hljs-operator">/</span>shared<span class="hljs-operator">-</span>utils <span class="hljs-comment">--filter web-app</span>
</code></pre>
<h3 data-id="heading-16">3. 脚本执行</h3>
<h4 data-id="heading-17">在所有包中执行相同脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归执行所有包的 build 脚本</span>
pnpm -r run build

<span class="hljs-comment"># 递归执行所有包的 test 脚本</span>
pnpm -r run <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-18">在特定包中执行脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 仅在 web-app 中执行 dev 脚本</span>
pnpm --filter web-app run dev

<span class="hljs-comment"># 使用包名（package.json 中的 name）</span>
pnpm -F @my-monorepo/shared-utils run build
</code></pre>
<h2 data-id="heading-19">四、完整示例：Vue 项目 Monorepo</h2>
<h3 data-id="heading-20">项目结构</h3>
<pre><code class="hljs language-lua" lang="lua">vue-monorepo/
├── pnpm-workspace.yaml
├── <span class="hljs-built_in">package</span>.json
├── packages/
│   ├── ui-lib/          # UI 组件库
│   │   ├── <span class="hljs-built_in">package</span>.json
│   │   ├── src/
│   │   └── vite.<span class="hljs-built_in">config</span>.ts
│   └── utils/           # 工具函数库
│       ├── <span class="hljs-built_in">package</span>.json
│       └── src/
└── apps/
    ├── admin/           # 后台管理系统
    │   ├── <span class="hljs-built_in">package</span>.json
    │   └── src/
    └── portal/          # 门户网站
        ├── <span class="hljs-built_in">package</span>.json
        └── src/
</code></pre>
<h3 data-id="heading-21">pnpm-workspace.yaml</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">packages:</span>
  - <span class="hljs-comment">'packages/*'</span>
  - <span class="hljs-comment">'apps/*'</span>
</code></pre>
<h3 data-id="heading-22">根目录 package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run lint"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-23">包间依赖示例 (apps/admin/package.json)</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@vue-monorepo/ui-lib"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"@vue-monorepo/utils"</span>: <span class="hljs-string">"workspace:*"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-24">五、最佳实践与注意事项</h2>
<h3 data-id="heading-25">1. 命名规范</h3>
<ul>
<li>根项目：使用项目总名称，如 <code>my-monorepo</code></li>
<li>子包：使用作用域名称，如 <code>@my-monorepo/ui-components</code></li>
<li>应用：使用描述性名称，如 <code>web-app</code>、<code>admin-console</code></li>
</ul>
<h3 data-id="heading-26">2. 依赖管理</h3>
<ul>
<li>公共依赖（如 TypeScript、ESLint）安装在根目录</li>
<li>业务依赖安装在各自包中</li>
<li>使用 <code>pnpm-lock.yaml</code>确保依赖一致性</li>
</ul>
<h3 data-id="heading-27">3. 版本控制</h3>
<ul>
<li>提交 <code>pnpm-lock.yaml</code>到版本控制系统</li>
<li>考虑使用 Changesets 或 Lerna 进行版本管理和发布</li>
</ul>
<h3 data-id="heading-28">4. 性能优化</h3>
<ul>
<li>pnpm 使用硬链接和符号链接，节省磁盘空间</li>
<li>所有包共享同一份依赖，安装速度快</li>
<li>支持过滤命令，只构建需要的包</li>
</ul>
<h3 data-id="heading-29">5. CI/CD 集成</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions 示例</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-30">六、常见问题解决</h2>
<h3 data-id="heading-31">1. 幽灵依赖问题</h3>
<p>确保所有依赖都在 <code>package.json</code>中明确声明，避免直接引用 <code>node_modules</code>中的未声明包。</p>
<h3 data-id="heading-32">2. 循环依赖检测</h3>
<p>使用 <code>pnpm why &lt;package-name&gt;</code>检查依赖关系，避免包之间的循环依赖。</p>
<h3 data-id="heading-33">3. 包找不到错误</h3>
<p>如果出现 <code>no matches found</code>错误，检查：</p>
<ul>
<li>包名是否正确（包括作用域）</li>
<li>包是否在 <code>pnpm-workspace.yaml</code>配置的目录中</li>
<li>包是否有正确的 <code>name</code>字段</li>
</ul>
<h3 data-id="heading-34">4. 跨包类型引用</h3>
<p>对于 TypeScript 项目，配置 <code>tsconfig.json</code>中的 <code>paths</code>：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@my-monorepo/*"</span>: [<span class="hljs-string">"packages/*/src"</span>]
    }
  }
}
</code></pre>
<h2 data-id="heading-35">总结</h2>
<p>通过 pnpm + Workspaces 构建 Monorepo 的主要优势包括：</p>
<ol>
<li><strong>依赖共享</strong>：所有包共享同一份依赖，节省磁盘空间和安装时间</li>
<li><strong>原子提交</strong>：跨包变更可以一次性提交，保持一致性</li>
<li><strong>本地链接</strong>：使用 <code>workspace:*</code>协议，本地开发无需发布到 npm</li>
<li><strong>精细控制</strong>：支持按包过滤的命令执行</li>
<li><strong>统一管理</strong>：集中的 CI/CD 和代码质量检查</li>
</ol>
<p>这种架构特别适合中大型项目、微前端架构、组件库开发等场景，能显著提升开发效率和代码复用性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端工程化实践：打包工具的选择与思考]]></title>    <link>https://juejin.cn/post/7583984122234798122</link>    <guid>https://juejin.cn/post/7583984122234798122</guid>    <pubDate>2025-12-16T02:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122234798122" data-draft-id="7583984122234732586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端工程化实践：打包工具的选择与思考"/> <meta itemprop="keywords" content="前端,JavaScript,Webpack"/> <meta itemprop="datePublished" content="2025-12-16T02:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="转转技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端工程化实践：打包工具的选择与思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    转转技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:16:24.000Z" title="Tue Dec 16 2025 02:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从静态页面到模块化开发，前端工程化经历了怎样的演进？Webpack、Vite、Rspack 这些打包工具各自解决了什么问题，在实际项目中又该如何选择？</p>
</blockquote>
<h2 data-id="heading-0">前端工程化的出现与发展</h2>
<p>前端工程化的发展经历了几个重要阶段。在 1990 年代到 2000 年代初期的静态页面时代，开发者主要使用 Photoshop 切图和 Dreamweaver 等工具制作页面，代码通常直接写在 HTML 中，大量使用内联样式和事件处理器，所有逻辑集中在一个文件中，导致代码组织混乱、全局变量污染严重、维护困难。到了 2000 年代中期到 2010 年代初期，jQuery 等类库的出现解决了浏览器兼容性问题，简化了 DOM 操作，但代码组织问题依然存在，文件体积持续增长，模块间的依赖关系仍需人工管理。2010 年代初期进入模块化探索阶段，出现了多种模块化方案：CommonJS 主要用于 Node.js 环境，AMD 专注于浏览器端的异步模块加载，CMD 强调按需加载，但这些方案标准不统一，工具链不兼容，给项目协作带来困难。2010 年代中期至今，随着 ES6 模块标准的确定，<code>import / export</code> 语法成为主流，Webpack 等打包工具统一了模块化处理流程，Vite 等新一代工具利用原生 ESM 提升了开发体验，同时 Babel 提供了语法转换能力，TypeScript 提供了类型系统支持，ESLint 和 Prettier 规范了代码风格，前端工程化体系逐步完善，前端开发进入了工具链驱动的时代。</p>
<p>前端工程化的出现主要源于项目规模扩大、团队协作需求增加、业务复杂度提升以及人工管理代码的局限性。首先，传统开发方式中代码组织混乱，所有脚本文件需要在 HTML 中按正确顺序引入，依赖关系必须人工维护，删除或调整文件顺序容易导致错误。工程化后通过 ES Modules 等模块化方案，依赖关系由工具自动管理，开发者只需关注业务逻辑。其次，浏览器兼容性问题突出，使用 <code>Promise</code>、<code>async/await</code> 等新特性时，旧版本浏览器无法识别，需要通过 Babel 将高级语法转换为兼容的 ES5 代码，并通过 polyfill 为旧浏览器补充缺失的 API 支持。第三，开发效率低下，传统方式需要手动刷新页面、重复操作才能看到修改效果，构建过程需要手动进行代码压缩、合并、添加文件哈希等操作，工程化后通过热模块替换实现代码修改后自动更新，通过构建工具自动化完成压缩、文件指纹、代码分包等流程。第四，性能优化缺乏系统性方案，未打包的项目会产生大量 HTTP 请求，未进行代码分割会导致用户需要加载全部代码才能使用部分功能，工程化后通过代码压缩、Tree-shaking 消除无用代码、按需加载、资源预加载等技术手段系统性地优化性能。第五，团队协作缺乏统一规范，代码风格不统一、类型使用不规范、注释缺失等问题影响代码质量和可维护性，工程化后通过 ESLint 进行代码质量检查，通过 Prettier 统一代码格式，通过 TypeScript 在编译期进行类型检查，从而提升代码质量和团队协作效率。</p>
<h2 data-id="heading-1">前端工程化与打包工具</h2>
<h3 data-id="heading-2">打包工具的核心作用</h3>
<p>在前端工程化的工具链中，打包工具承担着核心的构建职责。它的主要功能包括模块依赖解析、代码转换、资源优化以及开发体验提升。</p>
<h4 data-id="heading-3">模块依赖解析</h4>
<p>项目开发中会使用大量的 <code>import</code> 和 <code>require</code> 语句来组织代码，打包工具从入口文件开始，递归分析模块间的依赖关系，构建完整的依赖图，最终将分散的模块文件合并成浏览器可以直接加载的 JavaScript、CSS 等资源文件。这个过程解决了传统开发中需要手动维护脚本加载顺序的问题。</p>
<h4 data-id="heading-4">代码转换与预处理</h4>
<p>现代前端开发中广泛使用的 TypeScript、JSX、Vue 单文件组件、Less/SCSS 等语法和格式，浏览器本身并不支持。打包工具通过配置相应的 Loader 或 Plugin，将这些代码转换为浏览器能够理解的 JavaScript 和 CSS。例如，Babel 可以将 ES6+ 语法转换为 ES5，TypeScript 编译器可以将 TypeScript 代码转换为 JavaScript。</p>
<h4 data-id="heading-5">构建优化</h4>
<p>打包工具在构建过程中会自动执行多种优化操作。代码压缩可以减小文件体积，Tree-shaking 可以移除未使用的代码，代码分割可以将大型应用拆分为多个按需加载的代码块，文件指纹 hash 可以实现长期缓存，资源压缩可以优化图片、字体等静态资源。这些优化如果手动完成，不仅工作量大，而且容易出错。</p>
<h4 data-id="heading-6">开发体验</h4>
<p>打包工具通常还提供开发服务器功能，支持 HMR，当代码修改后可以自动更新页面，无需手动刷新。同时提供清晰的错误提示和 Source Map 支持，方便开发者调试代码。</p>
<p>目前主流的打包工具包括 Webpack、Vite、Rollup、Rspack 等，它们在解决上述问题的同时，由于设计理念和时代背景的不同，在实现方式和性能表现上各有特点。</p>
<h2 data-id="heading-7">主流打包工具全景</h2>
<h3 data-id="heading-8">Webpack</h3>
<p>Webpack 是前端打包工具领域的成熟方案，自 2012 年发布以来，在前端工程化中占据重要地位。它支持多种模块格式，包括 CommonJS、AMD 和 ES Modules，能够处理各种类型的静态资源，如样式文件、图片、字体等，只要编写相应的 Loader，几乎可以将任何资源类型纳入打包流程。Webpack 的插件生态非常丰富，涵盖了 HTML 模板生成、体积分析、代码压缩混淆、国际化等各个方面，为开发者提供了大量现成的解决方案。</p>
<p>Webpack 的构建流程可以概括为：读取配置文件，确定入口文件，递归分析模块依赖关系，通过 Loader 对各类资源进行转换处理，将处理后的模块组织成 Chunk，最终输出优化后的资源文件。在整个构建过程中，Webpack 会触发各种生命周期钩子，Plugin 通过监听这些钩子来扩展功能，实现自定义的构建逻辑。</p>
<p>Webpack 适合在以下场景使用：项目规模较大、结构复杂，需要对打包过程进行精细控制；已有项目基于 Webpack 构建，迁移成本较高；需要处理多种特殊资源类型，对丰富的插件生态有较强依赖。</p>
<p>Webpack 的不足之处在于：配置文件较为复杂，学习曲线较陡，新成员上手需要一定时间；开发环境需要先进行打包，冷启动速度相对较慢；对于大型项目，如果不进行针对性优化，构建时间可能较长。</p>
<h3 data-id="heading-9">Vite</h3>
<p>Vite 的设计目标是提供极速的开发体验，实现开发服务器的快速启动和代码修改的即时反馈。Vite 的核心思路与 Webpack 不同：在开发环境中，Vite 不进行全量打包，而是启动一个轻量级的开发服务器，当浏览器请求某个模块时，Vite 才对该模块进行实时编译和转换。对于第三方依赖，Vite 使用 esbuild 进行预构建，将 CommonJS 或 UMD 格式的依赖转换为 ESM 格式，通常缓存在 node_modules/.vite/deps 目录下，后续直接预构建缓存的结果，大幅提升开发启动速度。在生产环境中，Vite 使用 Rollup 进行构建（Vite 5 及之后版本也可以选择基于 Rust 的 Rolldown），执行 Tree-shaking、代码分割、压缩等优化操作，生成生产环境所需的资源文件。</p>
<p>Vite 的开发体验优势明显：新项目配置简单，几乎可以开箱即用；开发服务器启动速度快，HMR 更新迅速；对 Vue、React 等主流框架提供了良好的内置支持。Vite 的局限性在于：对旧版本浏览器的支持需要额外的插件和配置；对于已经深度定制 Webpack 的复杂项目，迁移到 Vite 的成本可能较高。</p>
<h3 data-id="heading-10">Rspack</h3>
<p>Rspack 是由字节跳动开发的基于 Rust 实现的打包工具，于 2023 年发布。Rspack 与 Webpack 保持高度兼容，API 兼容度达到 95% 以上，这意味着大多数 Webpack 配置可以直接迁移到 Rspack。在官方基准测试和实际项目实践中，Rspack 的构建速度通常比同等配置的 Webpack 快 5 到 10 倍。</p>
<p>Rspack 的核心实现使用 Rust 重写了 Webpack 的核心逻辑，同时保持了 Webpack 的配置方式和插件生态系统。Rspack 内置了 SWC 编译器和 Lightning CSS，无需额外配置 Babel 即可处理 TypeScript、JSX 等语法，在性能上相比传统方案有显著提升。</p>
<p>Rspack 与 Webpack 高度兼容，迁移成本较低，现有 Webpack 项目可以相对平滑地切换到 Rspack；构建速度快，中大型项目的冷启动时间通常在 1 到 3 秒之间；支持大部分 Webpack Loader 和 Plugin，生态兼容性好；内置 SWC 编译器，无需额外配置 Babel；提供文件系统缓存机制，二次构建速度更快。</p>
<p>测试项目打包速度对比结果：同一套项目代码（大概 400 个小文件） + 配置；webpack 采用了 babel，rspack 采用了内置的 SWC(仅是测试代码测试，仅做参考) <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed69c9392fee41cca3b90c4a655f148d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456184&amp;x-signature=EykjQ%2FiWRyq3VuI12OthQXlZCCM%3D" alt="compare" loading="lazy"/></p>
<h2 data-id="heading-11">打包原理浅析</h2>
<h3 data-id="heading-12">Webpack 打包原理速通</h3>
<h4 data-id="heading-13">整体架构</h4>
<p>Webpack 的核心是一个模块打包器，它将项目中的所有资源（JavaScript、CSS、图片等）视为模块，通过构建依赖关系图将它们组织起来。Webpack 的架构基于几个核心概念：Compiler 是编译器实例，负责整个编译过程的生命周期管理；Compilation 代表单次编译过程，包含模块、chunk、资源等编译信息；Module 是模块，可以是 JavaScript、CSS、图片等任何类型的文件；Chunk 是代码块，由多个模块按照一定规则组织而成；Asset 是资源文件，即最终输出的文件。</p>
<h4 data-id="heading-14">构建流程（生产环境）</h4>
<p>Webpack 的构建流程可以分为初始化、编译、输出和完成四个主要阶段。</p>
<p>在初始化阶段，Webpack 读取配置文件（webpack.config.js），创建 Compiler 实例，然后注册所有配置的插件。插件通过 <code>apply</code> 方法注册到 Compiler 的钩子上，以便在构建的不同阶段执行自定义逻辑。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">compiler</span> = webpack(config)<span class="hljs-comment">;</span>
plugins.forEach((plugin) =&gt; plugin.apply(compiler))<span class="hljs-comment">;</span>
</code></pre>
<p>编译阶段是 Webpack 的核心处理过程。首先确定入口文件，从配置的 entry 开始，找到所有入口文件。然后从入口文件开始，递归解析所有依赖关系，使用 AST 解析 import 和 require 语句，构建完整的模块依赖图。接下来对每个模块执行对应的 Loader 进行转换，例如使用 babel-loader 处理 JavaScript 文件，使用 css-loader 和 style-loader 处理 CSS 文件。最后根据入口和代码分割规则，将模块组织成 Chunk。</p>
<pre><code class="hljs language-css" lang="css">entry: {
  <span class="hljs-selector-tag">main</span>: <span class="hljs-string">'./src/index.js'</span>,
  vendor: <span class="hljs-string">'./src/vendor.js'</span>
}

module: {
  rules: [
    { test: /.js$/, use: <span class="hljs-string">'babel-loader'</span> },
    { test: /.css$/, use: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>] }
  ]
}
</code></pre>
<p>在输出阶段，Webpack 首先生成运行时代码，注入模块加载的运行时函数（如 <code>__webpack_require__</code>）。然后执行代码分割和优化，通过 SplitChunksPlugin 根据配置规则将代码分割成多个 chunk，例如将 node_modules 中的第三方库单独打包。最后将 Chunk 转换为最终的 JavaScript 文件，执行压缩、混淆等优化操作。</p>
<pre><code class="hljs language-css" lang="css">optimization: {
  splitChunks: {
    chunks: <span class="hljs-string">'all'</span>,
    cacheGroups: {
      vendor: {
        test: /[\/]node_modules[\/]/,
        name: <span class="hljs-string">'vendors'</span>,
        priority: <span class="hljs-number">10</span>
      }
    }
  }
}
</code></pre>
<p>最后，根据 output 配置将处理后的文件写入文件系统，生成最终的构建产物。</p>
<pre><code class="hljs language-css" lang="css">output: {
  path: path.<span class="hljs-built_in">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
  filename: <span class="hljs-string">'[name].[contenthash].js'</span>
}
</code></pre>
<h4 data-id="heading-15">开发环境（webpack-dev-server）</h4>
<p>开发环境与生产环境的主要区别在于：开发环境采用内存编译，文件不写入磁盘，而是保存在内存中，这样可以提升编译速度；支持热模块替换（HMR），只更新变更的模块，无需刷新整个页面；生成 Source Map 便于调试，可以定位到原始源码位置；文件变更后能够快速重新编译，提供即时的反馈。</p>
<p>HMR 的工作流程如下：当启动 webpack-dev-server 时，会在页面中注入 HMR 客户端脚本，然后建立 WebSocket 连接，实现客户端与开发服务器之间的双向通信。当开发者修改源码文件时，Webpack 会监听到文件变更事件，然后重新编译受影响的模块，生成新的 hash 值和热更新清单文件（如 <code>main.[hash].hot-update.json</code>）。服务器通过 WebSocket 将新的 hash 值通知给客户端，客户端收到通知后，会对比本地的 lastHash 和服务端返回的 hash 值。如果检测到有更新，客户端会发起请求获取热更新清单文件和更新后的模块代码（<code>hot-update.json</code> 和 <code>hot-update.js</code>），HMR runtime 会加载并执行更新后的模块，然后调用 <code>module.hot.accept</code> 等回调函数，只替换发生变更的模块，尽量保持页面状态不变。如果遇到异常情况或模块不支持 HMR，系统会回退到整页刷新的方式，确保功能正常。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea23b12f3729442ba0b49f9b3d1235b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456184&amp;x-signature=5rxZ0uaDtinwO5lomVdtEuVN%2FRI%3D" alt="test" loading="lazy"/></p>
<p>test</p>
<h4 data-id="heading-16">模块解析机制</h4>
<p>Webpack 的模块解析机制包括路径解析、别名处理和 node_modules 查找。当遇到相对路径导入时，Webpack 会根据 <code>resolve.extensions</code> 配置尝试不同的文件扩展名，例如 <code>./utils</code> 会依次尝试 <code>./utils.js</code>、<code>./utils.json</code>、<code>./utils/index.js</code> 等。对于使用别名的导入，Webpack 根据 <code>resolve.alias</code> 配置将别名解析为实际路径，例如 <code>@/components/Component</code> 会被解析为配置的实际路径。对于第三方模块，Webpack 会从 node_modules 目录中查找对应的包。</p>
<h3 data-id="heading-17">Vite 打包原理速通</h3>
<h4 data-id="heading-18">整体架构</h4>
<p>Vite 采用双模式架构，在开发环境和生产环境中采用不同的策略。开发环境基于浏览器原生 ESM，无需进行打包操作，而是通过 HTTP 服务器按需编译模块。生产环境则回归传统打包思路，使用 Rollup 进行代码打包和优化。这种设计使得开发体验和生产构建各取所长，既保证了开发时的极速启动，又确保了生产环境的代码优化。</p>
<h4 data-id="heading-19">开发环境原理</h4>
<p>Vite 开发环境的核心思想是 No Bundle，即不进行预先打包。当执行 <code>vite dev</code> 命令时，Vite 首先启动一个 HTTP 服务器，默认监听 5173 端口。这个服务器会拦截浏览器的模块请求，并根据请求的模块类型进行实时编译和返回。整个过程是动态的，只有在浏览器真正需要某个模块时，Vite 才会对其进行编译处理。</p>
<p>在第一次启动时，Vite 会执行依赖预构建流程。它会扫描项目的 package.json 文件，识别出所有的第三方依赖，然后使用 esbuild 对这些依赖进行预构建处理。预构建的结果会被缓存到 <code>node_modules/.vite/deps</code> 目录中，后续启动时可以直接使用缓存，大幅提升启动速度。预构建的主要目的包括三个方面：首先是将 CommonJS 或 UMD 格式的依赖转换为浏览器可识别的 ESM 格式，因为浏览器原生不支持 CommonJS；其次是合并多个小文件，减少 HTTP 请求数量，例如 lodash 这样的库包含数百个文件，预构建可以将其合并为单个文件；最后是优化依赖结构，扁平化某些包内部的复杂路径引用。</p>
<p>当浏览器发起模块请求时，例如请求 <code>http://localhost:5173/src/main.js</code>，Vite 服务器会首先检查该模块是否是已经预构建的第三方依赖。如果是预构建的依赖，直接返回缓存的结果。如果是项目源码文件，Vite 会进行实时编译，将文件转换为浏览器可执行的 ESM 代码并返回。以 Vue 单文件组件为例，当浏览器请求 <code>.vue</code> 文件时，Vite 会实时编译 Vue SFC，将其转换为 JavaScript 代码返回给浏览器。</p>
<p>Vite 的热模块替换机制同样基于 ESM 实现。当文件发生变更时，Vite 能够精确地知道哪些模块需要更新，因为每个模块都是独立的 ESM 模块。Vite 通过 WebSocket 连接通知客户端哪些模块发生了变化，客户端接收到通知后，可以直接替换对应的 ESM 模块，利用浏览器原生的模块系统能力，无需重新加载整个页面。这种基于 ESM 的 HMR 机制相比传统的打包工具更加精确和高效。</p>
<h4 data-id="heading-20">生产环境原理</h4>
<p>在生产环境中，Vite 会执行完整的打包流程。默认情况下，Vite 使用 Rollup 作为打包核心引擎。在 Vite 5 及之后的版本中，可以在部分配置或实验特性下切换为 Rolldown，但整体构建阶段和思路与 Rollup 基本一致。构建流程首先从入口文件开始，构建完整的依赖图，分析所有模块之间的依赖关系，确定需要打包的模块范围。随后使用 esbuild 对依赖进行预构建，这一步在官方基准测试中通常能比传统方式快一个数量级，具体提升幅度在 10 到 100 倍之间，实际效果取决于项目规模和配置。预构建完成后，Rollup 会执行代码分析、转换、优化和打包等步骤，最终输出优化后的生产代码。</p>
<h4 data-id="heading-21">预构建</h4>
<p>预构建是 Vite 架构中的关键环节，其必要性主要体现在三个方面。首先是兼容性问题，许多 npm 包仍然采用 CommonJS 格式发布，而浏览器原生不支持 CommonJS 模块系统，因此需要将这些依赖转换为浏览器可识别的 ESM 格式。其次是性能问题，某些大型库如 lodash 包含数百个独立的文件，如果直接使用会产生大量的 HTTP 请求，严重影响加载性能，预构建可以将这些文件合并为单个文件，大幅减少请求数量。最后是路径问题，某些包内部使用复杂的相对路径引用，预构建可以扁平化这种依赖结构，简化模块解析过程。</p>
<h4 data-id="heading-22">开发 vs 生产对比</h4>
<p>开发环境和生产环境在多个维度上存在显著差异。在打包方式上，开发环境采用不打包、按需编译的策略，而生产环境则执行完整的 Rollup 打包流程。启动速度方面，开发环境通常能在 1 秒内完成启动，而生产环境的构建时间通常在 5 到 10 秒之间。编译方式上，开发环境是实时编译，只有被请求的模块才会被编译，生产环境则是全量编译，所有模块都会被处理。输出格式上，开发环境统一输出 ESM 格式，生产环境则可以根据配置输出多种格式。代码优化方面，开发环境不进行代码优化以保持编译速度，生产环境则会执行压缩、混淆、tree-shaking 等优化操作。Source Map 的生成策略也不同，开发环境采用快速生成策略，生产环境则生成完整的 Source Map 以便调试。</p>
<h3 data-id="heading-23">核心差异对比</h3>
<h4 data-id="heading-24">性能差异</h4>
<p>这里可以先按一个中等偏上的单页应用来想象一下，大概的时间量级会是下面这样（只是经验值，不是严谨 benchmark，具体还是要看你项目的体量和机器性能）：</p>





























<table><thead><tr><th>场景</th><th>Webpack</th><th>Vite</th><th>原因</th></tr></thead><tbody><tr><td><strong>冷启动</strong></td><td>10 ～ 30s</td><td>&lt; 1s</td><td>Vite 不打包，按需编译</td></tr><tr><td><strong>HMR</strong></td><td>1 ～ 3s</td><td>&lt; 100ms</td><td>Vite 基于 ESM，更精确</td></tr><tr><td><strong>生产构建</strong></td><td>30 ～ 60s</td><td>10 ～ 20s</td><td>Vite 使用 esbuild 预构建</td></tr></tbody></table>
<h2 data-id="heading-25">深度对比分析</h2>
<h3 data-id="heading-26">性能对比</h3>
<p>从开发者最关心的几个维度来看，三个工具在性能表现上存在明显差异。需要说明的是，以下对比更多是基于日常项目实践的经验总结，而非严谨的基准测试，具体表现会因项目规模和机器性能而有所不同。</p>
<p>在开发启动速度方面，Webpack 在大型项目中首次启动时需要进行完整的打包过程，开发者能够明显感受到冷启动的等待时间，十几秒甚至几十秒的情况很常见。Vite 则基本实现秒开，启动瓶颈更多在于浏览器打开速度，而非打包过程本身。Rspack 相比 Webpack 有明显提升，特别是在多入口和大体积项目中，启动速度的提升更为显著。</p>
<p>在热模块替换的反馈速度上，Webpack 在处理简单样式修改时表现尚可，但在进行大型组件改动时，通常需要等待 1 到 2 秒才能看到更新效果。Vite 在大部分场景下能够实现保存即刷新，几乎感觉不到延迟。Rspack 配合开发服务器使用时，HMR 体验也比传统 Webpack 更加流畅。</p>
<p>在生产构建时间方面，Webpack 在配置合理的情况下，中型项目的构建时间通常在几十秒，对于超大项目则需要重点进行代码拆分和缓存优化。Vite 使用 Rollup 进行生产构建时，在中小型项目上通常优于 Webpack，随着项目规模增大，这种优势会更加明显。Rspack 在官方对比和社区实践中，普遍比等价配置的 Webpack 快一截，特别适合那些希望保持 Webpack 配置方式但需要提升构建速度的场景。</p>
<h3 data-id="heading-27">配置复杂度</h3>
<p>Webpack 的配置相对复杂，需要开发者理解一整套概念体系，包括入口配置 entry、输出配置 output、模块处理规则 module.rules、各种 loader、插件系统 plugin、优化配置 optimization、路径解析 resolve 等。一个典型的 Webpack 配置文件需要明确指定入口文件路径、输出目录和文件名模式、各种文件类型的处理规则、使用的 loader 和插件、代码拆分策略等。这种配置方式虽然灵活，但也意味着学习曲线较为陡峭，新手需要花费一定时间才能掌握。</p>
<p>相比之下，Vite 的配置要简洁得多。Vite 的默认配置已经能够运行绝大多数单页应用，开发者通常只需要添加框架插件、配置路径别名、按需调整一些构建选项即可。一个典型的 Vite 配置文件可能只需要几行代码，指定使用的框架插件和少量构建选项。这种设计大大降低了配置门槛，使得开发者能够快速上手，将更多精力投入到业务开发中。</p>
<h3 data-id="heading-28">生态支持</h3>
<p>在生态支持方面，三个工具呈现出不同的成熟度。Webpack 作为最早发布的工具，自 2012 年发布以来已经积累了最完善的生态系统，拥有最多的插件和 loader，社区支持也是最好的。Vite 虽然发布时间较晚，自 2020 年发布以来生态成熟度已经达到较高水平，社区支持快速增长，插件数量也相当丰富。Rspack 作为最新的工具，2023 年才发布，生态成熟度相对较低，但社区支持也在快速增长，插件数量也在逐步增加。总体而言，Webpack 拥有最成熟的生态，Vite 的生态已经相当完善，Rspack 作为新工具正在快速发展中。</p>
<h2 data-id="heading-29">总结</h2>
<p>前端打包工具的选择没有标准答案，需要根据项目特点、团队情况、技术栈等因素综合考虑：</p>
<h3 data-id="heading-30">未来展望</h3>
<p>前端工程化工具正在向<strong>更快、更简单、更智能</strong>的方向发展：</p>
<ul>
<li><strong>性能</strong>：Rust/Go 实现的工具将成为主流</li>
<li><strong>兼容性</strong>：新工具会保持与现有生态的兼容</li>
<li><strong>开发体验</strong>：零配置、智能提示、更好的错误信息</li>
<li><strong>标准化</strong>：ESM 成为标准，工具链统一</li>
</ul>
<hr/>
<p><strong>参考资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.js.org%2F" target="_blank" title="https://webpack.js.org/" ref="nofollow noopener noreferrer">Webpack 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2F" target="_blank" title="https://vitejs.dev/" ref="nofollow noopener noreferrer">Vite 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2F" target="_blank" title="https://rollupjs.org/" ref="nofollow noopener noreferrer">Rollup 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" title="https://esbuild.github.io/" ref="nofollow noopener noreferrer">esbuild 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frspack.dev%2F" target="_blank" title="https://rspack.dev/" ref="nofollow noopener noreferrer">Rspack 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dart 的 Lazy Iterable]]></title>    <link>https://juejin.cn/post/7583933107690029119</link>    <guid>https://juejin.cn/post/7583933107690029119</guid>    <pubDate>2025-12-16T02:24:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690029119" data-draft-id="7583591656177123364" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dart 的 Lazy Iterable"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-16T02:24:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dart 的 Lazy Iterable
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:24:55.000Z" title="Tue Dec 16 2025 02:24:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>相关文章: <a href="https://juejin.cn/post/7109433427245400078" target="_blank" title="https://juejin.cn/post/7109433427245400078">juejin.cn/post/710943…</a></p>
<p>这里主要提到两个我们经常用的操作符 where/map</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> list = [<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>];
<span class="hljs-keyword">var</span> map = list.<span class="hljs-title function_">map</span>((e) {
  <span class="hljs-keyword">var</span> result = int.<span class="hljs-title function_">parse</span>(e) + <span class="hljs-number">10</span>;
  <span class="hljs-title function_">print</span>(<span class="hljs-string">"######### $result"</span>);
  <span class="hljs-keyword">return</span> result;
});
</code></pre>
<p>像上面的代码 运行是不会有日志输出的。只有每次调用 toList 或者遍历map的时候才会输出。</p>
<p><code>一般情况下 如果你这里返回的知识基本类型 比如 String 或者 int 啥的,直接用也不会有太大问题。但是你如果返回的是对象，当你去做一些判断是否是同一个对象的时候就会有问题，因为你每次遍历返回的都是新的对象，再去判断是否是同一个对象，大概率是不一样的。</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[企业级 AI 编程 Prompt 体系]]></title>    <link>https://juejin.cn/post/7583981974407970826</link>    <guid>https://juejin.cn/post/7583981974407970826</guid>    <pubDate>2025-12-16T02:29:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974407970826" data-draft-id="7583981974407921674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="企业级 AI 编程 Prompt 体系"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:29:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            企业级 AI 编程 Prompt 体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:29:07.000Z" title="Tue Dec 16 2025 02:29:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>定位说明</strong>：<br/>
这不是“教你怎么用 AI 写代码”的教程，而是一套 <strong>企业可复制、可治理、可审计的 AI 编程方法论</strong>。</p>
<p><strong>适用对象：</strong></p>
<ul>
<li>CTO / 技术负责人</li>
<li>技术中台 / 架构组</li>
<li>正在推进 AI 编程落地的企业</li>
</ul>
<h2 data-id="heading-0">一、为什么“会用 AI 写代码”不等于“能在企业落地”</h2>
<p>当前大多数团队在使用 AI 编程时，都会遇到三个典型问题：</p>
<ol>
<li><strong>产出不稳定</strong>：同一个需求，不同人问，结果完全不同</li>
<li><strong>风险不可控</strong>：AI 擅自重构、编造逻辑、引入依赖</li>
<li><strong>无法评估价值</strong>：到底有多少代码是 AI 参与产出的？</li>
</ol>
<p><strong>根本原因只有一个：</strong></p>
<blockquote>
<p>企业缺的不是 AI，而是一套「约束 AI 行为的工程体系」。</p>
</blockquote>
<h2 data-id="heading-1">二、核心方法论：三层 Prompt 治理模型</h2>
<p>我们将 AI 编程中的提示词，拆解为 <strong>三层、三种职责、三种稳定度</strong>。</p>
<pre><code class="hljs language-arduino" lang="arduino">System Prompt（企业级｜几乎不变）
   ↓
Project Prompt（项目级｜随项目变化）
   ↓
<span class="hljs-built_in">Task</span> Prompt（任务级｜每次开发）
</code></pre>
<h2 data-id="heading-2">三、System Prompt：AI 的“公司宪法”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 在公司里“能不能做”</li>
<li>什么时候必须停下来</li>
</ul>
<p><strong>核心特征</strong>：</p>
<ul>
<li>稳定性优先于效率</li>
<li>明确禁止 AI 幻觉、编造、擅自决策</li>
<li>内置“中止机制”（信息不足即停）</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>防止 AI 成为风险源</li>
<li>为所有项目提供统一底线</li>
</ul>
<h2 data-id="heading-3">四、Project Prompt：AI 的“项目说明书”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 在“这个项目里该怎么写代码”</li>
</ul>
<p><strong>核心内容</strong>：</p>
<ul>
<li>技术栈与版本锁定</li>
<li>架构分层规则</li>
<li>项目级编码与异常规范</li>
<li>项目特有的 AI 行为约束</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>消除 AI 的“通用最佳实践幻觉”</li>
<li>让 AI 的输出贴合具体项目</li>
</ul>
<h2 data-id="heading-4">五、Task Prompt：AI 的“任务工单”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 这一次具体要做什么</li>
</ul>
<p><strong>标准结构</strong>：</p>
<ul>
<li>任务目标</li>
<li>已有上下文</li>
<li>具体要求</li>
<li>强约束</li>
<li>输出验收标准</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>降低不确定性</li>
<li>让 AI 输出具备可验收性</li>
</ul>
<h2 data-id="heading-5">六、为什么这套体系“可治理、可审计”</h2>
<h3 data-id="heading-6">1️⃣ Prompt 即制度</h3>
<ul>
<li>Prompt 本身就是工程规则</li>
<li>可纳入版本管理</li>
</ul>
<h3 data-id="heading-7">2️⃣ Prompt 即证据</h3>
<ul>
<li>每一段 AI 产出，都有对应 Prompt</li>
<li>可复盘、可追责</li>
</ul>
<h3 data-id="heading-8">3️⃣ Prompt 即统计基础</h3>
<ul>
<li>可以区分：
<ul>
<li>AI 主导</li>
<li>AI 辅助</li>
<li>人工编写</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">七、AI 代码参与度的正确评估方式（对外常见误区）</h2>
<p><strong>错误方式</strong>：</p>
<ul>
<li>看是否“用过 AI”</li>
<li>看是否“复制过代码”</li>
</ul>
<p><strong>正确方式</strong>：</p>
<ul>
<li>是否使用 Task Prompt 产出核心逻辑</li>
<li>是否在 Prompt 约束下完成代码</li>
<li>是否通过人工 Review 验收</li>
</ul>
<blockquote>
<p><strong>结论</strong>：<br/>
AI 价值不在“用了没用”，而在“被管理地使用”。</p>
</blockquote>
<h2 data-id="heading-10">八、这套方法论的边界（很重要）</h2>
<ul>
<li>不追求 100% AI 生成代码</li>
<li>不鼓励完全无人审查</li>
<li>不替代工程责任主体</li>
</ul>
<p>AI 的定位始终是：</p>
<blockquote>
<p><strong>受约束的生产力，而不是自主决策者</strong>。</p>
</blockquote>
<h2 data-id="heading-11">九、结语：真正的竞争力是什么</h2>
<blockquote>
<p>当所有公司都能用 AI 写代码时，<br/>
真正的差距在于：</p>
<p><strong>谁能把 AI 纳入工程体系，而不是工具清单。</strong></p>
</blockquote>
<p>这套三层 Prompt 方法论，本质上是：</p>
<ul>
<li>把“人类的软件工程经验”</li>
<li>翻译成“AI 可执行的规则体系”</li>
</ul>
<p>也是企业在 AI 时代构建长期技术竞争力的关键基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了]]></title>    <link>https://juejin.cn/post/7583991680748945435</link>    <guid>https://juejin.cn/post/7583991680748945435</guid>    <pubDate>2025-12-16T02:29:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583991680748945435" data-draft-id="7583952017674502195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T02:29:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:29:37.000Z" title="Tue Dec 16 2025 02:29:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当前，AI 领域的研究者与开发者在关注 OpenAI、Google 等领先机构最新进展的同时，也将目光投向了由前 OpenAI CTO Mira Murati 创办的 Thinking Machines Lab。</p>
<p>今年早些时候，他们推出了首款产品 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650993756%26idx%3D1%26sn%3D4bd29a2b9fdaf00b29f97f6f2139decb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650993756&amp;idx=1&amp;sn=4bd29a2b9fdaf00b29f97f6f2139decb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Tinker</a>：这是一个 API，用于帮开发者 / 研究人员微调语言模型。你只需要专注于训练数据和算法，而你不擅长的关于 Infra 的部分 —— 调度、调优、资源管理和 Infra 可靠性 —— 统统由 Tinker 来搞定，从而大大简化了 LLM 的后训练过程。</p>
<p>此前，Tinker 仅向研究人员和开发者开放内部测试；而如今，Thinking Machines 宣布正式取消候选名单，所有用户都可以直接使用 Tinker。</p>
<p>除此以外，Tinker 还带来了其他三项更新：</p>
<p>首先，更强推理能力：用户现在可以在 Tinker 上对 Kimi K2 Thinking 进行微调。 Kimi K2 拥有万亿参数规模，是 Thinking Machines 目前规模最大的模型，专为长链推理和工具调用场景而设计。</p>
<p>其次，兼容 OpenAI API 的全新推理接口：Tinker 提供了标准的推理接口，例如：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544708e9fd5f43eb80bc50bc3dc288f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=lqYKQG1PJOGx6aaO%2FCqlmShk0jo%3D" alt="图片" loading="lazy"/></p>
<p>借助本次发布，Tinker 还新增了兼容 OpenAI API 的接口封装，用户只需通过指定模型路径，即可对模型进行快速采样，即使模型仍处于训练过程中也可以使用。</p>
<p>这也意味着，Tinker 现在可以即插即用地接入任何兼容 OpenAI API 的平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba51a97d2c741419f9afa70c6bf04a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=GXT4wcUCQVbzXyuCTSkWYk9uukQ%3D" alt="图片" loading="lazy"/></p>
<p>最后，Qwen3-VL 支持视觉输入。Tinker 新增了两款视觉模型：Qwen3-VL-30B-A3B-Instruct 和 Qwen3-VL-235B-A22B-Instruct。借助这些模型，用户可以在多种应用场景中处理图片、截图以及示意图等视觉内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a234dee031d4f6890f1cf0dcbec275d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=DxIx7ZdyVoE0sw%2BPaN3HVd6Rrrc%3D" alt="图片" loading="lazy"/></p>
<p>这些视觉输入开箱即用，可直接应用于多种任务场景，包括监督微调和强化学习微调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d7ab75624241ed93a1c2a6771ac6ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=x0FrQdtvBFU6V7rUHeIc0BkJfQw%3D" alt="图片" loading="lazy"/></p>
<p>Tinker支持的模型</p>
<p>过去，开发者若想训练或微调前沿大模型，必须自行采购 GPU、搭建集群、处理 CUDA/NCCL 环境、维护分布式训练稳定性，门槛极高且成本巨大。</p>
<p>而 Tinker 通过将所有训练基础设施抽象为一个 API，使开发者无需管理任何算力资源，只需准备数据和算法即可训练模型。更重要的是，此次更新首次让普通开发者能够微调万亿参数的 Kimi K2 Thinking，这本来是只有顶级实验室才能掌握的能力，视觉输入的加入进一步降低了 VLM 应用门槛。</p>
<p>对此，研究者纷纷表示：「能够在无需自行管理 GPU 基础设施的情况下训练自定义图文数据，对开发者来说是一项巨大的进步。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c223f5243224b2f9b190ae4b4210c5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=12Q%2F8GTbGFB%2FBtCdjI3%2Fnvg2Lcc%3D" alt="图片" loading="lazy"/></p>
<p>使用 Tinker 训练图像分类模型</p>
<p>为了展示 Tinker 新增的视觉能力，Thinking Machines Lab 对 Qwen3-VL-235B-A22B-Instruct 进行了微调，并将其应用于多项经典图像分类基准测试中。</p>
<p>具体而言，研究团队选择了四个常用的数据集进行评估，包括：</p>
<ul>
<li>
<p>Caltech-101：包含 101 类常见物体的数据集</p>
</li>
<li>
<p>Stanford Cars：涵盖汽车品牌、型号和年份的数据集</p>
</li>
<li>
<p>Oxford Flowers：花卉品种数据集</p>
</li>
<li>
<p>Oxford Pets：宠物品种数据集</p>
</li>
</ul>
<p>由于 Qwen3-VL 本质上是语言模型，研究中将图像分类任务建模为文本生成问题：给定一张图片，模型直接输出对应的类别名称。研究人员将这一方法与传统的视觉基线方案 DINOv2 进行了对比。</p>
<p>DINOv2 是一种通过自监督方式训练的视觉 Transformer，常被用作纯计算机视觉任务的 backbone。对于 DINOv2，研究中在其模型之上添加了一个分类头，用于预测所有 N 个类别的概率分布。两种模型均采用 LoRA 方式进行微调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ce8137e96154616bcf6ff0662715f8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=SpQK8lqLZAwRiVWzQIw%2BFcS7D4g%3D" alt="图片" loading="lazy"/></p>
<p>图中展示了经过微调的 Qwen3-VL-235B-A22B 与 DINOv2 在简单图像分类任务上的性能对比。</p>
<p>在小样本数据场景下，Qwen3-VL-235B-A22B 的表现优于 DINOv2。这不仅是因为其模型规模更大，更重要的是，作为视觉语言模型（VLM），它天然具备语言知识（例如知道「向日葵」指代什么）。正是这种通用的语言与视觉联合能力，使得 Qwen3-VL 在图像分类之外，也能够更方便地迁移到其他视觉任务中。</p>
<p>还没体验的小伙伴，Tinker 绝对值得一试。</p>
<p>参考链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Ftinker%2F" target="_blank" title="https://thinkingmachines.ai/tinker/" ref="nofollow noopener noreferrer">thinkingmachines.ai/tinker/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Fblog%2Ftinker-general-availability%2F" target="_blank" title="https://thinkingmachines.ai/blog/tinker-general-availability/" ref="nofollow noopener noreferrer">thinkingmachines.ai/blog/tinker…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026]]></title>    <link>https://juejin.cn/post/7583955708318269440</link>    <guid>https://juejin.cn/post/7583955708318269440</guid>    <pubDate>2025-12-16T02:35:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318269440" data-draft-id="7583921477614387235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:35:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:35:05.000Z" title="Tue Dec 16 2025 02:35:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>从生物进化的漫长历程到 AI 技术的疯狂迭代，两者遵循着惊人相似的底层逻辑。</p>
<p>在探寻下一代 AI 架构的关键时刻，著名的 “Kaldi 之父”、小米集团首席语音科学家、IEEE Fellow <strong>Daniel Povey</strong> 提出：</p>
<blockquote>
<p>就像生物进化一样， AI“配方”的设计本质上就是一个不断试错的过程，而进化的速度，取决于 “复制” 一个新想法所需的时间。</p>
</blockquote>
<p>在本次<strong>量子位 MEET2026 智能未来大会</strong>上，他也将开源视为 AI 进化的核心加速器——</p>
<p>若没有开源，行业的进化速度恐怕要慢上一千倍；正是因为有了开源，技术才能像生物适应新环境一样，经历 “长期停滞 + 瞬间爆发” 的非线性跃迁。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60925c12fed84c5aacaf536dfc93bf07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=TA9%2FR3h9yzbU3KROc1h96ZDRE9k%3D" alt="" loading="lazy"/></p>
<p>至于如何在未来的竞争中生存，在他看来，大公司最明智的策略是 “两条腿走路”——</p>
<p>一边利用 Transformer 赋能当下的产品，一边保留资源探索未知，赌中下一个颠覆世界的机会。</p>
<p>为了完整体现 Daniel Povey 的思考，在不改变原意的基础上，量子位对演讲内容进行了翻译和编辑整理，希望能给你带来更多启发。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点梳理</h2>
<ul>
<li>
<p>AI 的演进和自然界生物的进化过程非常相似，通过尝试不同的技术变体，然后筛选出在目标任务上表现更优的方案；</p>
</li>
<li>
<p>类比生物进化中的 “间断平衡”，AI 的发展并非连续，而是 “长期停滞 + 突然跃迁”，停滞期也不会永远持续；</p>
</li>
<li>
<p>开源对进化速度至关重要，如果每家公司都闭源，那么研究速度可能会降低为原来的千分之一；</p>
</li>
<li>
<p>不要押注单一任务或单一路线，在进化过程中找到 AI“通才”与 “专才” 的平衡，保留多种不同模型架构的存续，从而增加发掘实用新技术的机会；</p>
</li>
<li>
<p>大公司双管齐下是有意义的，一方面使用当前业界领先的技术方案，另一方面进行探索性研究，以寻找下一个重大突破。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb210310f564a2dbdee1a79800f10b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=wCWLanNYbmnHbDzWB%2F0UdMFSq5g%3D" alt="" loading="lazy"/></p>
<p><em>以下为 Daniel Povey 演讲原文中译本</em></p>
<h2 data-id="heading-1">像生物进化一样快速试错</h2>
<p>大家好，今天我想和大家分享一些关于 “进化” 和“AI”的思考，以及我们如何从生物演化中汲取关于 AI 未来的启示。我将主要从科研和模型本身的角度解读这个问题。</p>
<p>人们设计 AI“配方” 的过程，本质上主要还是一个不断试错的过程。</p>
<p>当人们有了新的理解，就会发表许多富含公式的论文，但其中 99% 的内容都没什么真正可操作的价值，最后能落地的通常只是 “配方” 本身。</p>
<p>所以设计 AI“配方” 的基本流程就是尝试不同变体，然后筛选出有效的进行发布，别人再照着做。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/353e35fc4c02427c84d2edcdec53ad46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=VibhUMmINBiV5Kamhb0dDtD%2B06k%3D" alt="" loading="lazy"/></p>
<p>这其实和生物进化非常相似。</p>
<p>在生物进化中，进化过程也会和外部环境相互影响，例如地球上的进化会受到太阳辐射变化、大气成分变化的影响，而生命本身也会反过来影响这些环境因素，比如改变大气成分。</p>
<p>AI 的进化也是如此，可能会受到硬件、数据等资源的限制；同时，AI 也会通过商业效应、群体行为效应反作用于这些外部条件。</p>
<p>在历史上，生物进化甚至曾经多次 “破坏” 自身的生存环境，例如“大氧化事件”<em>（Great Oxygenation Event）</em>，不过最终生命又从中恢复了过来。</p>
<p><em>（注：大氧化事件是指约 26 亿年前，大气中的游离氧含量突然增加的事件，其具体原因不明。该事件使地球上矿物的成分发生了变化，也使得日后动物的出现成为了可能。）</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b11f57b54874f9f894957efb552b9e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=MY0vJ7HwhdJdqa8G%2FJFJOLIrxnQ%3D" alt="" loading="lazy"/></p>
<p>生物学中 “世代间隔”_（Generation time）_类比到 AI，就是复制一个新想法所需的时间，通常这个时间会持续数个月。</p>
<p>因为当你有了新的发现，往往要先写论文，而且一般是写完才对外公开，有些期刊甚至规定发表前不能先上传 arXiv 之类的预印本。</p>
<p>过去这样的周期可能需要大概两年，但现在可能缩短到了<strong>六个月</strong>。</p>
<p>现在，有了 PyTorch 这样的工具，人们可以近乎完美地复现他人发布的 “配方”。</p>
<p>当然，有时人们可能只给出了描述_（而没有代码）_，这会使得复现过程稍慢一些，但整体上，代际周期的长短决定了进化的快慢。</p>
<p>就像世代间隔漫长的大型生物，往往进化缓慢；而那些能够快速繁衍的小型生物，进化速度则要快得多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f26e0426551f4dd4b5f56f2f486553e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=9kcQNBLBNHD5e9FfL4sVcGOm%2F%2Fc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">去不同领域寻找 AI 突破口</h2>
<p>在自然界的进化中，往往存在一种 “停停走走” 的节奏，很长一段时间里几乎没有什么动静，随后突然发生剧变。</p>
<p>对于自然界的物种来说，这种变化通常是由迁移到新环境所导致的；但偶尔，它也源于生命 “解锁” 了某种新事物，比如光合作用演化出来时，整个进化的节奏便迅速发生了改变。</p>
<p>我从事 AI 领域大概有 30 年了，特别是在语音领域，也经历过长时间没有太大进展的阶段，当时我们甚至以为 “这就是终点”。</p>
<p>当年我们做高斯混合模型、判别式训练时，以为语音识别的最终形态就是那样了，没人能想象未来的改变。所以也许十年后，也会出现今天谁都无法想象的全新模型。</p>
<p>AI 的发展中，不同任务之间的相互作用非常重要，比如视觉领域的新方法，后来可能会用于语音、语言等任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a873ff2d68e480981d1f638d265c634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=5i28sC3HOgx1LRT%2BCt1BvaFj9c4%3D" alt="" loading="lazy"/></p>
<p>最近一个典型例子就是 Transformers，它最初是专门为语言模型设计的，后来却在各种任务中大放异彩。</p>
<p>在进化中也是如此，海豚绝无可能仅在海洋里就进化成型，因为它那些呼吸空气的机能，原本是为了适应陆地生活才演化出来的。但当它重返海洋后，却成了最成功的顶级捕食者。</p>
<p>这说明，<strong>有时候你确实需要暂时去做一些截然不同的事情，最终才能在原本的目标上取得成功</strong>。</p>
<h2 data-id="heading-3">如果不开源，AI 得慢上一千倍</h2>
<p>当然，拿生物进化做类比也有局限性。毕竟我们可以<strong>主动去理解事物</strong>，可以利用数学推导，或者改进可视化和调试工具，从而加速技术的发展。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43d79290e3364a0ab5111bcdd265332f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=ff5n3unEEmIBa7rCoschSGiNNX4%3D" alt="" loading="lazy"/></p>
<p>此外，提速也非常关键。实验跑得越快，进化的迭代就越快，这对研究价值巨大。</p>
<p>而在这一点上，<strong>开源</strong>起到了至关重要的作用。</p>
<p>如果每家公司都得自己从头重复造轮子，研究速度恐怕要慢上一千倍。</p>
<p>我们可以设想一个平行世界，如果大公司决定不开源 PyTorch，我也没有开源 Kaldi 项目，那 AI 研发的局面会很不相同。</p>
<p>不过，不开源在某些行业确实是常态，尤其是涉及<strong>实体工程</strong>的领域，因为开发一款工具往往极其昂贵，可能要砸出数百万美元，所以没人会把他们的模型开源出来。</p>
<p>其实，2012 年我之所以离开工业界，就是因为这个问题。当时的大公司普遍对开源都不怎么感冒，所以我转去学术界待了一段时间。</p>
<p>但如今很多公司都开始拥抱开源了，像小米就非常支持我的工作，也支持开源，所以我又回到了工业界。</p>
<h2 data-id="heading-4">寻找 Transformer 之后的下一个颠覆者</h2>
<p>回到关于进化的比喻，我刚才吐槽过论文中的那些数学理论往往不够具体，没法落地。那么，我们到底能从中能学到什么实实在在的东西呢？</p>
<p>有一点很关键，那就是我们需要在各种不同的任务上不断探索新思路。</p>
<p>因为在进化这件事上，很难预判哪种生物最终会胜出。就像啮齿类动物，起初可能只是为了吃竹子种子这种极具体的目的而进化的。</p>
<p>但结果谁曾想，这反而让它们演化出了一种极强的 “通才” 式生存能力，最终遍布全球、无所不能。</p>
<p>可在当时，谁能想到吃竹子种子这事儿能带来这么大的突破呢？这种事真的太难预测了。</p>
<p>所以说，关键就在于要<strong>多尝试不同的任务</strong>，因为我们为了突破某个任务特有限制研发出的解决方案，可能最后会被证明具有极高的通用价值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36641dd5f354d8db9fc4b5b624f0e4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=rN08PLNODxb43NIETQ7w5tlJIRc%3D" alt="" loading="lazy"/></p>
<p>我们需要关注进化过程中 “通才” 与“专才”之间的权衡，我并非要分出孰优孰劣，但是从长远来看，不同的进化策略能够适应不同的环境——</p>
<p>如果环境长期稳定，自然界往往会涌现出大量像熊猫这样的 “专才”，它们虽然只吃一种食物，却能做到极致适应；</p>
<p>可一旦环境变得动荡多变，像老鼠这种适应力极强的 “通才” 往往更具生存优势。</p>
<p>所以，这两种生存策略很可能是缺一不可的。</p>
<p>对于 AI 而言，我们应该让模型在多个不同的生态位里同时演进，这就像自然界在不同环境中进行的进化一样。毕竟，每个物种通常都有其最适应的特定生存空间。</p>
<p>如果我们能同时保留多种不同的技术路线，说不定其中某一条在经过进一步打磨后，就能带来巨大的回报。但这事儿很难提前预判，没人知道眼下哪个模型会在未来称王。</p>
<p>出于同样的理由，我们也应该维持<strong>模型架构的多样性</strong>。这就像大自然保留了丰富多样的物种一样，因为我们根本无法确定，到底哪一种架构会孕育出下一轮的重大突破。</p>
<p>在我看来，大多数大型机构采取两头并重的策略是比较明智的——既要沿用像 Transformer 等当前最顶尖的成熟模型，同时也得投入一些资源去做探索性研究，去寻找下一个技术突破口。</p>
<p>在我看来，Transformer 这种技术领域的竞争现状，就像是 “抢椅子”——只要音乐还在响，你就得跟着一直跳。</p>
<p>毕竟在 Transformer 和 LLM 依然称霸的当下，任何一家公司都绝无可能把身家性命都押在别的路线上。</p>
<p>但大家心里也都清楚，音乐迟早有停下来的那一天。</p>
<p>所以，小米在 LLM 上的研究主线很明确，那就是利用 SOTA 级别的 AI 和大模型技术，去全方位赋能我们的 “人车家全生态”。</p>
<p>我个人其实并没有深度参与这些工作，因为我和团队主要负责的是探索性研究。我们尝试了大量不同的方向，就是希望能找到能产生巨大影响的成果，但这事的成功率向来极低。</p>
<p>回首我的整个研究生涯，尝试过的点子恐怕得有上万个。现在回头看，其中有一两个如果当时我能推广得再好一点，说不定真能成为颠覆性的技术。</p>
<p>比如，早在大家连 BatchNorm 都还没开始用的时候，我们组其实就已经设计出了一种类似于 LayerNorm 的归一化模块。</p>
<p>但我也不想像 Jürgen Schmidhuber 那样说 “我在所有人之前发明了一切”。</p>
<p><em>（注：Jurgen Schmidhuber 是著名计算机科学家、LSTM 之父，喜欢在 AI 领域出现新成果时发表文章或评论，列举自己上世纪的论文，表示 “这个东西我几十年前就发明过了”。）</em></p>
<p>因为作为一名研究人员，有责任去判断哪些是有价值的想法，并对其进行妥善推广。如果你没做到，那就得承认是自己的失误。</p>
<p>言归正传，我的团队目前正在研发一种针对语音的新模型架构，叫 <strong>Zapformer</strong>，是一个通用声音基座。</p>
<p>相较于我们去年推出的 Zipformer 而言，Zapformer 实现了三大跨越：</p>
<ul>
<li>
<p>从 “人声” 到“万声”的跨越：从专注于人声建模，到成为能同时理解人声、环境音等多元信息的通用声音基座；</p>
</li>
<li>
<p>从优化结构到创新理论的跨越：通过引入梯度流（Gradient Flow）理论指导模型设计，在已属业界标杆的 Zipformer 基础上，将语音识别精度再次显著提升 10%-15%；</p>
</li>
<li>
<p>从专用优化到通用健壮的跨越：为适应海量数据训练移除了 Dropout 层，增强了大数据拟合能力，同时将优化器升级为 TransformAdam，在保持极速收敛的同时，大幅提升了训练的通用性与稳定性。</p>
</li>
</ul>
<p>我不想把话说太满，说它就是 “下一个大热门”，但它确实包含了不少有意思的想法。</p>
<p>当然，我们希望能押中下一个 “大杀器”，但这事儿谁也没法打包票。</p>
<p>所有这些成果全都是开源的，因为我是开源的坚定信徒。除了我的项目，小米还有很多其他的开源项目。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文读懂大模型智能体（Agent）：从理论到实践]]></title>    <link>https://juejin.cn/post/7583943503556788274</link>    <guid>https://juejin.cn/post/7583943503556788274</guid>    <pubDate>2025-12-16T02:37:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556788274" data-draft-id="7583613222345064474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文读懂大模型智能体（Agent）：从理论到实践"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:37:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文读懂大模型智能体（Agent）：从理论到实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:37:08.000Z" title="Tue Dec 16 2025 02:37:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<blockquote>
<p>★</p>
<p>本文全面梳理了智能体(Agent)的核心概念、架构设计与实现方法，以及主流框架的对比分析。</p>
</blockquote>
<h2 data-id="heading-0">1.  智能体基础：理解Agent的工作原理</h2>
<hr/>
<h4 data-id="heading-1">1.1 任务环境分析：PEAS模型</h4>
<p>要理解智能体的运作，我们必须先理解它所处的任务环境。在人工智能领域，通常使用PEAS模型来精确描述一个任务环境，即分析其：</p>
<ul>
<li><strong>性能度量</strong>(Performance)：评估智能体成功与否的标准</li>
<li><strong>环境</strong>(Environment)：智能体运作的场景与条件</li>
<li><strong>执行器</strong>(Actuators)：智能体影响环境的方式</li>
<li><strong>传感器</strong>(Sensors)：智能体获取环境信息的渠道</li>
</ul>
<h4 data-id="heading-2">1.2 智能体循环：持续交互的核心机制</h4>
<p>智能体并非一次性完成任务，而是通过一个持续的循环与环境进行交互，这个核心机制被称为<strong>智能体循环</strong>(Agent Loop)。在这个循环中，智能体接收环境信息，进行内部推理，然后执行动作，再观察结果，如此反复，直到达成目标。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b0c72a75308473389b1898bddf8bd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=4JkOEtGG3ryleqVOtohXIlvjUa4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">1.3 提示工程：驱动LLM的关键</h4>
<p>驱动真实LLM的关键在于提示工程(Prompt Engineering)。我们需要设计一个"指令模板"，告诉LLM它应该扮演什么角色、拥有哪些工具、以及如何格式化它的思考和行动。这是我们智能体的"说明书"，它将作为system_prompt传递给LLM。</p>
<p>例如，一个旅行助手智能体的系统提示可能是：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">AGENT_SYSTEM_PROMPT</span> = <span class="hljs-string">"""  
你是一个智能旅行助手。你的任务是分析用户的请求,并使用可用工具一步步地解决问题。    
  
# 可用工具:    
- `get_weather(city: str)`: 查询指定城市的实时天气。   
- `get_attraction(city: str, weather: str)`: 根据城市和天气搜索推荐的旅游景点。    
  
# 行动格式:    
你的回答必须严格遵循以下格式。首先是你的思考过程,然后是你要执行的具体行动。    
Thought: [这里是你的思考过程和下一步计划]    
Action: [这里是你要调用的工具,格式为 function_name(arg_name="arg_value")]    
  
# 任务完成:    
当你收集到足够的信息,能够回答用户的最终问题时,你必须在`Action:`字段后使用 `finish(answer="...")`    
来输出最终答案。    
  
请开始吧!  
"""</span>
</code></pre>
<h2 data-id="heading-4">2.  智能体 vs 传统工作流：本质区别</h2>
<hr/>
<h4 data-id="heading-5">2.1 工作流(Workflow)模式</h4>
<p>工作流是一种传统的自动化范式，其核心是对一系列任务或步骤进行预先定义的、结构化的编排。它本质上是一个精确的、静态的流程图，规定了在何种条件下、以何种顺序执行哪些操作。</p>
<h4 data-id="heading-6">2.2 智能体(Agent)模式</h4>
<p>基于大型语言模型的智能体是一个具备自主性的、以目标为导向的系统。它不仅仅是执行预设指令，而是能够在一定程度上理解环境、进行推理、制定计划，并动态地采取行动以达成最终目标。LLM在其中扮演着"大脑"的角色。这种基于实时信息进行动态推理和决策的能力，正是Agent的核心价值所在。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb4dfb1618934a0d963747e54fd9b12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=O4kcSQyCM%2FLUwDsh3RhIREIYAFo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">3.  模型参数调优：提升Agent性能的关键</h2>
<hr/>
<h4 data-id="heading-8">3.1 温度(Temperature)参数</h4>
<p>Temperature这类的可配置参数，其本质是通过调整模型对"概率分布"的采样策略，让输出匹配具体场景需求，配置合适的参数可以提升Agent在特定场景的性能。</p>
<h4 data-id="heading-9">3.2 Top-k与Top-p采样</h4>
<ul>
<li><strong>Top-k</strong>：将所有token按概率从高到低排序，取排名前k个的token组成"候选集"，随后对筛选出的k个token的概率进行"归一化"</li>
<li><strong>Top-p</strong>：将所有token按概率从高到低排序，从排序后的第一个token开始，逐步累加概率，直到累积和首次达到或超过阈值p</li>
</ul>
<h4 data-id="heading-10">3.3 参数协同工作机制</h4>
<p>在文本生成中，当同时设置Top-p、Top-k和温度系数时，这些参数会按照分层过滤的方式协同工作，其优先级顺序为：温度调整→Top-k→Top-p。温度调整整体分布的陡峭程度，Top-k会先保留概率最高的k个候选，然后Top-p会从Top-k的结果中选取累积概率≥p的最小集合作为最终的候选集。</p>
<h2 data-id="heading-11">4.  核心智能体架构与实现</h2>
<hr/>
<h4 data-id="heading-12">4.1 ReAct智能体</h4>
<p>ReAct是一种将推理(Reasoning)与行动(Action)相结合的智能体架构。其核心思想是让智能体在思考过程中明确表达推理步骤，然后基于推理选择适当的行动，再根据行动结果更新认知，形成一个持续的循环。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d696e9f05cd546fe98e100dc3ae441e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=y1ESV2NkPQiw51VF%2Bfm6Mh0dNBY%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ReAct提示词模板  </span>
<span class="hljs-attr">REACT_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
请注意,你是一个有能力调用外部工具的智能助手。    
可用工具如下:  {tools}    
  
请严格按照以下格式进行回应:    
Thought: 你的思考过程,用于分析问题、拆解任务和规划下一步行动。    
Action: 你决定采取的行动,必须是以下格式之一:    
- `{tool_name}[{tool_input}]`:调用一个可用工具。   
- `Finish[最终答案]`:当你认为已经获得最终答案时。    
- 当你收集到足够的信息,能够回答用户的最终问题时,你必须在Action:字段后使用 finish(answer="...") 来输出最终答案。    
  
现在,请开始解决以下问题:  
Question: {question}    
History: {history}    
"""</span>
</code></pre>
<p>智能体将不断重复这个Thought -&gt; Action -&gt; Observation的循环，将新的观察结果追加到历史记录中，形成一个不断增长的上下文，直到它在Thought中认为已经找到了最终答案，然后输出结果。这个过程形成了一个强大的协同效应：推理使得行动更具目的性，而行动则为推理提供了事实依据。</p>
<h4 data-id="heading-13">4.2 Plan-and-Solve智能体</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4ef1a7c03546e098fa946fdd8939ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=ufKPUFYMk1IeKbOYye8D7co2f0M%3D" alt="" loading="lazy"/></p>
<p>Plan-and-Solve将整个流程解耦为两个核心阶段：</p>
<ol>
<li>规划阶段(Planning Phase)：首先，智能体会接收用户的完整问题。它的第一个任务不是直接去解决问题或调用工具，而是将问题分解，并制定出一个清晰、分步骤的行动计划。这个计划本身就是一次大语言模型的调用产物。</li>
<li>执行阶段(Solving Phase)：在获得完整的计划后，智能体进入执行阶段。它会严格按照计划中的步骤，逐一执行。每一步的执行都可能是一次独立的LLM调用，或者是对上一步结果的加工处理，直到计划中的所有步骤都完成，最终得出答案。</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 规划器提示词模板  </span>
<span class="hljs-attr">PLANNER_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一个顶级的AI规划专家。你的任务是将用户提出的复杂问题分解成一个由多个简单步骤组成的行动计划。    
请确保计划中的每个步骤都是一个独立的、可执行的子任务,并且严格按照逻辑顺序排列。    
你的输出必须是一个Python列表,其中每个元素都是一个描述子任务的字符串。    
  
问题: {question}    
请严格按照以下格式输出你的计划,`python与`作为前后缀是必要的:    
`python    
["步骤1", "步骤2", "步骤3", ...]    
`    
"""</span>  
  
<span class="hljs-comment"># 执行器提示词模板  </span>
<span class="hljs-attr">EXECUTOR_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位顶级的AI执行专家。你的任务是严格按照给定的计划,一步步地解决问题。    
你将收到原始问题、完整的计划、以及到目前为止已经完成的步骤和结果。    
请你专注于解决"当前步骤",并仅输出该步骤的最终答案,不要输出任何额外的解释或对话。    
  
# 原始问题:    
{question}    
  
# 完整计划:    
{plan}    
  
# 历史步骤与结果:    
{history}    
  
# 当前步骤:    
{current_step}    
  
请仅输出针对"当前步骤"的回答:    
"""</span>
</code></pre>
<h4 data-id="heading-14">4.3 Reflection智能体</h4>
<p>Reflection机制的核心思想是为智能体引入一种事后(post-hoc)的自我校正循环，使其能够像人类一样，审视自己的工作，发现不足，并进行迭代优化。它为智能体提供了一个内部纠错回路，使其不再完全依赖于外部工具的反馈(ReAct的Observation)，从而能够修正更高层次的逻辑和策略错误。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5696d4cbb0e46f981d1145ae840f40a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=OhqKXGZu%2FWvio9RHzNFvAQX08Hs%3D" alt="" loading="lazy"/></p>
<p>Reflection机制的优势：</p>
<ul>
<li>将一次性的任务执行转变为一个持续优化的过程，显著提升复杂任务的最终成功率和答案质量</li>
<li>为智能体构建了一个临时的"短期记忆"，整个"执行-反思-优化"的轨迹形成了宝贵的经验记录</li>
<li>支持多模态反思，可以反思和修正文本以外的输出(如代码、图像等)</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 初始执行提示词  </span>
<span class="hljs-attr">INITIAL_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位资深的Python程序员。请根据以下要求,编写一个Python函数。    
你的代码必须包含完整的函数签名、文档字符串,并遵循PEP 8编码规范。    
要求: {task}    
请直接输出代码,不要包含任何额外的解释。    
"""</span>  
  
<span class="hljs-comment"># 反思提示词  </span>
<span class="hljs-attr">REFLECT_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位极其严格的代码评审专家和资深算法工程师,对代码的性能有极致的要求。    
你的任务是审查以下Python代码,并专注于找出其在&lt;strong&gt;算法效率&lt;/strong&gt;上的主要瓶颈。    
  
# 原始任务:    
{task}  
  
# 待审查的代码:    
`python    
{code}    
`  
  
请分析该代码的时间复杂度,并思考是否存在一种&lt;strong&gt;算法上更优&lt;/strong&gt;的解决方案来显著提升性能。    
如果存在,请清晰地指出当前算法的不足,并提出具体的、可行的改进算法建议(例如,使用筛法替代试除法)。    
如果代码在算法层面已经达到最优,才能回答"无需改进"。    
  
请直接输出你的反馈,不要包含任何额外的解释。    
"""</span>  
  
<span class="hljs-comment"># 优化提示词  </span>
<span class="hljs-attr">REFINE_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位资深的Python程序员。你正在根据一位代码评审专家的反馈来优化你的代码。    
  
# 原始任务:    
{task}    
  
# 你上一轮尝试的代码:    
`    
{last_code_attempt}    
`  
  
评审员的反馈:    
{feedback}    
  
请根据评审员的反馈,生成一个优化后的新版本代码。    
你的代码必须包含完整的函数签名、文档字符串,并遵循PEP 8编码规范。    
请直接输出优化后的代码,不要包含任何额外的解释。    
"""</span>
</code></pre>
<h2 data-id="heading-15">5.  智能体框架对比分析</h2>
<hr/>
<h4 data-id="heading-16">5.1 框架的本质与价值</h4>
<p>框架的本质，是提供一套经过验证的"规范"。它将所有智能体共有的、重复性的工作(如主循环、状态管理、工具调用、日志记录等)进行抽象和封装，让我们在构建新的智能体时，能够专注于其独特的业务逻辑，而非通用的底层实现。</p>
<h4 data-id="heading-17">5.2 AutoGen：基于对话的协作</h4>
<p>AutoGen的核心思想是通过对话实现协作。它将多智能体系统抽象为一个由多个"可对话"智能体组成的群聊。开发者可以定义不同角色(如Coder, ProductManager, Tester)，并设定它们之间的交互规则(例如，Coder写完代码后由Tester自动接管)。任务的解决过程，就是这些智能体在群聊中通过自动化消息传递，不断对话、协作、迭代直至最终目标达成的过程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eb195e18354402a8f2d7243b908295e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=UAlBCKjaXH3JYr%2FiI7xwdmjqga4%3D" alt="" loading="lazy"/></p>
<p>AutoGen的核心机制：</p>
<ul>
<li><strong>轮询群聊</strong>(RoundRobinGroupChat)：这是一种明确的、顺序化的对话协调机制。它会让参与的智能体按照预定义的顺序依次发言。这种模式非常适用于流程固定的任务，例如一个典型的软件开发流程：产品经理先提出需求，然后工程师编写代码，最后由代码审查员进行检查。</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_product_manager</span>(<span class="hljs-params">model_client</span>):  
    <span class="hljs-string">"""创建产品经理智能体"""</span>  
    system_message = <span class="hljs-string">"""  
    你是一位经验丰富的产品经理，专门负责软件产品的需求分析和项目规划。  
      
    你的核心职责包括：  
    1. **需求分析**：深入理解用户需求，识别核心功能和边界条件  
    2. **技术规划**：基于需求制定清晰的技术实现路径  
    3. **风险评估**：识别潜在的技术风险和用户体验问题  
    4. **协调沟通**：与工程师和其他团队成员进行有效沟通  
      
    当接到开发任务时，请按以下结构进行分析：  
    1. 需求理解与分析  
    2. 功能模块划分  
    3. 技术选型建议  
    4. 实现优先级排序  
    5. 验收标准定义  
      
    请简洁明了地回应，并在分析完成后说"请工程师开始实现"。  
    """</span>  
  
    <span class="hljs-keyword">return</span> AssistantAgent(  
        name=<span class="hljs-string">"ProductManager"</span>,  
        model_client=model_client,  
        system_message=system_message,  
    )
</code></pre>
<p>工作流程：</p>
<ol>
<li>创建一个RoundRobinGroupChat实例，并将所有参与协作的智能体加入其中</li>
<li>当任务开始时，群聊按预设顺序依次激活相应智能体</li>
<li>被选中的智能体根据当前对话上下文进行响应</li>
<li>群聊将新回复加入对话历史，并激活下一个智能体</li>
<li>过程持续进行，直到达到最大对话轮次或满足预设终止条件</li>
</ol>
<h4 data-id="heading-18">5.3 AgentScope：工业级多智能体平台</h4>
<p>AgentScope是一个专为多智能体应用设计的、功能全面的开发平台。它的核心特点是易用性和工程化。它提供了一套非常友好的编程接口，让开发者可以轻松定义智能体、构建通信网络，并管理整个应用的生命周期。其内置的消息传递机制和对分布式部署的支持，使其非常适合构建和运维复杂、大规模的多智能体系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c18803f92ccd43ca8b1ebff650fbd8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=xcJfigC2JoZoQLuUPtbDirYyN2s%3D" alt="" loading="lazy"/></p>
<p>与AutoGen相比，AgentScope的核心差异在于其消息驱动的架构设计和工业级的工程实践。如果说AutoGen更像是一个灵活的"对话工作室"，那么AgentScope就是一个完整的"智能体操作系统"，为开发者提供了从开发、测试到部署的全生命周期支持。与许多框架采用的继承式设计不同，AgentScope选择了组合式架构和消息驱动模式。这种设计不仅增强了系统的模块化程度，也为其出色的并发性能和分布式能力奠定了基础。</p>
<p>AgentScope的工程化优势也带来了一定的复杂性成本。其消息驱动架构虽然强大，但对开发者的技术要求较高，需要理解异步编程、分布式通信等概念。对于简单的多智能体对话场景，这种架构可能显得过于复杂，存在"过度工程化"的风险。此外，作为相对较新的框架，其生态系统和社区资源还有待进一步完善。因此，AgentScope更适合需要构建大规模、高可靠性的生产级多智能体系统，而对于快速原型开发或简单应用场景，选择更轻量级的框架可能更为合适。</p>
<h4 data-id="heading-19">5.4 CAMEL：角色扮演协作</h4>
<p>CAMEL最初的核心目标是探索如何在最少的人类干预下，让两个智能体通过"角色扮演"自主协作解决复杂任务。CAMEL实现自主协作的基石是两大核心概念：角色扮演(Role-Playing)和引导性提示(Inception Prompting)。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d2ed53fdd64f1d8f2f8e78d5354587~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=XuTqOxlfiZ%2FN3JtXJa6LFmf5DyA%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">5.5 LangGraph：图结构工作流</h4>
<p>作为LangChain生态的扩展，LangGraph另辟蹊径，将智能体的执行流程建模为图(Graph)。在传统的链式结构中，信息只能单向流动。而LangGraph将每一步操作(如调用LLM、执行工具)定义为图中的一个节点(Node)，并用边(Edge)来定义节点之间的跳转逻辑。这种设计天然支持循环(Cycles)，使得实现如Reflection这样的迭代、修正、自我反思的复杂工作流变得异常简单和直观。</p>
<p>与前面介绍的基于"对话"的框架(如AutoGen和CAMEL)不同，LangGraph将智能体的执行流程建模为一种状态机(State Machine)，并将其表示为有向图(Directed Graph)。在这种范式中，图的节点(Nodes)代表一个具体的计算步骤(如调用LLM、执行工具)，而边(Edges)则定义了从一个节点到另一个节点的跳转逻辑。这种设计的革命性之处在于它天然支持循环，使得构建能够进行迭代、反思和自我修正的复杂智能体工作流变得前所未有的直观和简单。</p>
<hr/>
<p>当前主流的低代码智能体开发平台呈现多元化发展格局，字节跳动旗下的Coze凭借可视化拖拽式界面和丰富的模板库，成为零代码用户的入门首选，尤其适合对话类应用开发，但其扩展性有限且仅支持云服务部署。国产开源平台Dify则以灵活定制和企业级能力见长，支持云服务与本地部署双模式，集成了主流大模型和低代码工作流功能，深受开发者青睐。德国工具n8n凭借其工匠精神和强大的工作流编排能力，在轻量级应用领域占据一席之地。此外，专注于企业级知识库系统和智能问答应用的FastGPT，以及全栈式企业平台得助智能等，共同构成了2025年智能体低代码开发平台的生态矩阵。</p>
<p>为了在本地实现高性能、生产级的模型推理服务，社区涌现出了VLLM和Ollama等优秀工具。这些工具能够显著提升推理速度，降低资源消耗，使智能体在本地环境中也能获得接近云端的性能表现。</p>
<p>随着框架的成熟和工具链的完善，智能体开发的门槛正在逐步降低，但对开发者来说，理解其底层原理和设计模式仍然是构建高性能、高可靠性智能体系统的关键。未来，随着多模态能力的增强和与物理世界的深度结合，智能体将在更广泛的应用场景中发挥重要作用。</p>
<h3 data-id="heading-21">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx HTTPS代理大文件加载失败的排查与解决方案]]></title>    <link>https://juejin.cn/post/7583970267132919814</link>    <guid>https://juejin.cn/post/7583970267132919814</guid>    <pubDate>2025-12-16T02:26:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132919814" data-draft-id="7583980250733346879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx HTTPS代理大文件加载失败的排查与解决方案"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-12-16T02:26:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="枫叶梨花"/> <meta itemprop="url" content="https://juejin.cn/user/3913917123816055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx HTTPS代理大文件加载失败的排查与解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917123816055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    枫叶梨花
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:26:48.000Z" title="Tue Dec 16 2025 02:26:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题背景</h2>
<p>今日运维人员告知我，突然网站的登录页访问变白屏，我登录后台发现服务一切正常，Nginx也正常运行，我尝试访问网站登录页，并连点十几次会访问正常，之后就会正常，但是登录以后也会<strong>某些页面存在白屏状态</strong>，查看浏览器请求发现<strong>某些JS、CSS文件没有正常返回</strong>，Nginx的<strong>访问日志出现206等问题</strong>，想到前几天刚续费了HTTPS的域名证书，证书也换过了，然后切换到<strong>内网HTTP发现正常</strong>，猜想应该是Nginx中的HTTPS的配置有问题，缓存类配置可能存在问题。</p>
<h2 data-id="heading-1">二、问题现象</h2>
<p>总结出现以下异常：</p>
<ul>
<li><strong>HTTPS访问登录页白屏</strong>，连续刷新20次后偶现正常；</li>
<li><strong>HTTP内网访问正常</strong>，无异常；</li>
<li>浏览器开发者工具显示：<strong>大体积JS文件（如<code>chunk-vendors.js</code>）加载失败</strong>，状态码为<code>206 Partial Content</code>；</li>
<li>Nginx访问日志记录：
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">10.</span>xx.xxx<span class="hljs-number">.90</span> - - <span class="hljs-number">443</span> [<span class="hljs-number">25</span>/Oct/<span class="hljs-number">2025</span>:<span class="hljs-number">17</span>:<span class="hljs-number">40</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0800</span>] 
  <span class="hljs-string">"GET /js/chunk-vendors.6112ac08.js HTTP/1.1"</span> <span class="hljs-number">206</span> <span class="hljs-number">1</span> 
  <span class="hljs-string">"https://xxxx/login"</span> 
  <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、问题定位与根因分析</h2>
<h3 data-id="heading-3">1. 核心问题：Nginx代理缓冲区不足</h3>
<h4 data-id="heading-4">（1）Nginx代理工作原理</h4>
<p>当Nginx作为反向代理时，其处理上游响应的流程如下：</p>
<ol>
<li>接收后端服务返回的响应数据；</li>
<li>将数据<strong>缓存到内存缓冲区</strong>中；</li>
<li>若缓冲区不足，则将数据写入临时文件（<code>proxy_max_temp_file_size</code>控制）；</li>
<li>最终将数据发送给客户端（浏览器）。</li>
</ol>
<h4 data-id="heading-5">（2）默认配置的限制</h4>
<p>Nginx默认配置的缓冲区大小为：</p>
<pre><code class="hljs language-nginx" lang="nginx">proxy_buffer_size 4k|8k;        # 响应头缓冲区
proxy_buffers 8 4k|8k;          # 响应体缓冲区（数量 × 大小）
proxy_busy_buffers_size 8k|16k; # 忙碌时可发送的最大缓冲区
</code></pre>
<ul>
<li><strong>总缓冲容量</strong>：<code>8 × 4k = 32KB</code>，不足以承载1~2MB的前端资源；</li>
<li><strong>HTTPS加重问题</strong>：TLS加密/解密消耗更多CPU资源，导致缓冲区更容易被撑满；</li>
<li><strong>206状态码的含义</strong>：<code>Partial Content</code>，表示响应未完整传输，Nginx在临时文件写入过程中可能因超时或中断导致加载失败。</li>
</ul>
<h4 data-id="heading-6">（3）为何HTTP正常？</h4>
<p>HTTP无需加密，Nginx处理速度更快，缓冲区在短时间内能完成数据传输，因此未触发问题。</p>
<hr/>
<h2 data-id="heading-7">四、解决方案与配置说明</h2>
<h3 data-id="heading-8">1. 调整Nginx代理缓冲区参数</h3>
<p>在Nginx配置文件的<code>http</code>块中添加以下配置：</p>
<pre><code class="hljs language-nginx" lang="nginx"># 增加内存缓冲区大小，避免写入临时文件
proxy_buffer_size 128k;         # 存储响应头（含Cookie/CSP等）
proxy_buffers 32 128k;          # 存储响应体（32 × 128k = 4MB）
proxy_busy_buffers_size 128k;   # 忙碌时最大发送缓冲区
</code></pre>
<h4 data-id="heading-9">参数详解：</h4>





























<table><thead><tr><th>参数</th><th>作用</th><th>推荐值</th><th>说明</th></tr></thead><tbody><tr><td><code>proxy_buffer_size</code></td><td>响应头缓冲区</td><td>128k</td><td>确保大头信息（如Cookie、CSP）完整加载</td></tr><tr><td><code>proxy_buffers</code></td><td>响应体缓冲区</td><td>32 × 128k</td><td>总容量4MB，覆盖常见前端资源大小</td></tr><tr><td><code>proxy_busy_buffers_size</code></td><td>忙碌时发送缓冲区</td><td>128k</td><td>避免缓冲区争用导致发送中断</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>生效范围</strong>：配置应放在<code>http</code>块中全局生效，或针对特定<code>server</code>/<code>location</code>块。</p>
</blockquote>
<h3 data-id="heading-10">2. 重载Nginx配置</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查配置语法</span>
sudo nginx -t

<span class="hljs-comment"># 重载配置</span>
sudo nginx -s reload
</code></pre>
<hr/>
<h2 data-id="heading-11">五、验证与测试</h2>
<p><strong>清除浏览器缓存</strong>之后重新访问，一切正常，问题解决。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[maven项目使用指定JDK版本打包]]></title>    <link>https://juejin.cn/post/7583970267132985350</link>    <guid>https://juejin.cn/post/7583970267132985350</guid>    <pubDate>2025-12-16T02:39:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132985350" data-draft-id="7583991680748814363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="maven项目使用指定JDK版本打包"/> <meta itemprop="keywords" content="后端,Java,maven"/> <meta itemprop="datePublished" content="2025-12-16T02:39:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="考虑考虑"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335157287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            maven项目使用指定JDK版本打包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335157287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    考虑考虑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:39:48.000Z" title="Tue Dec 16 2025 02:39:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在使用多个JDK版本环境打包过程中，有时候懒得配置环境变量，使用maven打包的时候,会报版本对应不上</p>
<h3 data-id="heading-1">maven打包</h3>
<p>没有配置对应项目jdk环境而打包时，会报</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0933efb769c94abd8f63cdd0b692b8a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICD6JmR6ICD6JmR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457587&amp;x-signature=2FfNwazhF5EdRZcbSAz7NnS5WHo%3D" alt="image.png" loading="lazy"/>
这个时候，可以在<code>pom.xml</code>文件配置</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>D:/soft/jdk-25.0.1/bin/javac<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">fork</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">fork</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>执行JDK路径</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4103657bb5ff47fd9ef22b21a05d78ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICD6JmR6ICD6JmR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457587&amp;x-signature=EXqe2UgpC092x2oUIb2oitvpRLg%3D" alt="image.png" loading="lazy"/>
或者使用mvn命令</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用指定JDK版本编译打包</span>
mvn clean package <span class="hljs-attr">-Dmaven.compiler.source</span>=<span class="hljs-number">25</span> -Dmaven.compiler.target=<span class="hljs-number">25</span>

<span class="hljs-comment"># 如果需要指定JDK安装路径 </span>
mvn clean package <span class="hljs-attr">-Dmaven.compiler.executable</span>=D:/soft/jdk-<span class="hljs-number">25.0</span>.<span class="hljs-number">1</span>/bin/javac
</code></pre>
<h3 data-id="heading-2">总结</h3>
<p>maven打包可以指定对应的JDK版本打包，这样就不用每次需要切换路径</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统]]></title>    <link>https://juejin.cn/post/7583933107690176575</link>    <guid>https://juejin.cn/post/7583933107690176575</guid>    <pubDate>2025-12-16T02:36:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690176575" data-draft-id="7583933107690127423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统"/> <meta itemprop="keywords" content="前端,TypeScript"/> <meta itemprop="datePublished" content="2025-12-16T02:36:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只秋刀鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2907533671935453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2907533671935453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只秋刀鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:36:57.000Z" title="Tue Dec 16 2025 02:36:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统</h2>
<p>在企业级后台管理系统开发中，React 结合 TypeScript 已是主流技术栈 ——TypeScript 的类型校验能大幅降低大型项目的维护成本，React 的组件化特性则适配后台系统复杂的 UI 与交互场景。本文以<strong>车辆租赁后台管理系统</strong>为例，拆解从技术选型、架构设计到核心功能实现的全流程，为前端开发者提供可落地的实战思路。</p>
<h3 data-id="heading-1">一、项目背景与技术栈选型</h3>
<h4 data-id="heading-2">1. 业务场景特点</h4>
<p>车辆租赁后台需覆盖「车辆管理、订单调配、客户管理、财务结算、操作日志」等核心模块，具有以下特点：</p>
<ul>
<li>数据交互频繁（如实时查询车辆状态、订单流转）；</li>
<li>表单 / 表格操作密集（如批量派发任务、筛选车辆信息）；</li>
<li>权限分级严格（不同角色可见 / 可操作的模块不同）；</li>
<li>需兼容多端（PC 端为主，部分功能适配平板）。</li>
</ul>
<h4 data-id="heading-3">2. 核心技术栈</h4>

































<table><thead><tr><th>技术 / 框架</th><th>选型理由</th></tr></thead><tbody><tr><td>React 18</td><td>组件化开发、Hooks 简化状态管理、Concurrent Mode 提升交互流畅度</td></tr><tr><td>TypeScript 5.x</td><td>强类型约束避免类型错误、提升代码可读性、便于团队协作</td></tr><tr><td>Umi 4</td><td>开箱即用的路由 / 构建 / 权限方案，适配中后台开发的工程化需求</td></tr><tr><td>Ant Design Pro</td><td>提供 ProTable/ProForm/Descriptions 等中后台高频组件，减少重复造轮子</td></tr><tr><td>ahooks</td><td>封装常用 Hooks（如 useRequest、useSelections），简化异步请求 / 状态管理</td></tr><tr><td>axios</td><td>统一封装请求拦截、响应处理，适配后端接口规范</td></tr></tbody></table>
<h3 data-id="heading-4">二、项目架构设计</h3>
<p>遵循「高内聚、低耦合」原则，采用分层式架构，目录结构如下：</p>
<p>plaintext</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">src</span>/
├── api/            <span class="hljs-comment">// 接口请求封装（按模块拆分）</span>
│   ├── car<span class="hljs-selector-class">.ts</span>      <span class="hljs-comment">// 车辆管理接口</span>
│   ├── <span class="hljs-attribute">order</span><span class="hljs-selector-class">.ts</span>    <span class="hljs-comment">// 订单调配接口</span>
│   └── user<span class="hljs-selector-class">.ts</span>     <span class="hljs-comment">// 用户/权限接口</span>
├── components/     <span class="hljs-comment">// 通用业务组件（如OperationRecord、PreviewFiles）</span>
├── pages/          <span class="hljs-comment">// 页面级组件（按业务模块拆分）</span>
│   ├── CarManage/  <span class="hljs-comment">// 车辆管理</span>
│   ├── OrderAlloc/ <span class="hljs-comment">// 订单调配（核心模块）</span>
│   └── System/     <span class="hljs-comment">// 系统设置</span>
├── utils/          <span class="hljs-comment">// 工具函数（如字典映射、时间格式化）</span>
├── typings/        <span class="hljs-comment">// TS类型声明（接口返回值、组件Props）</span>
└── access<span class="hljs-selector-class">.ts</span>       <span class="hljs-comment">// 权限控制配置</span>
</code></pre>
<h4 data-id="heading-5">关键设计原则</h4>
<ol>
<li><strong>类型先行</strong>：所有接口返回值、组件 Props、全局状态均定义 TS 类型，例如订单调配模块的核心类型：</li>
</ol>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// typings/order.d.ts</span>
<span class="hljs-comment">/** 订单基础信息 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AllocOrder</span> {
  <span class="hljs-attr">orderNo</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 工单编号</span>
  <span class="hljs-attr">orderStatus</span>: <span class="hljs-string">'toFormulate'</span> | <span class="hljs-string">'toDistribute'</span> | <span class="hljs-string">'completed'</span>; <span class="hljs-comment">// 订单状态</span>
  <span class="hljs-attr">carNo</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 车牌</span>
  <span class="hljs-attr">vin</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 车架号</span>
  <span class="hljs-attr">allocateInfo</span>: {
    <span class="hljs-attr">batchNo</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">deliveryType</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 交付类型</span>
    <span class="hljs-attr">outContactsName</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 调出联系人</span>
  };
}

<span class="hljs-comment">/** 订单列表请求参数 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AllocOrderParams</span> {
  <span class="hljs-attr">orderSource</span>: <span class="hljs-built_in">string</span>;
  batchNo?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">current</span>: <span class="hljs-built_in">number</span>;
}
</code></pre>
<ol start="2">
<li><strong>复用性优先</strong>：抽离通用业务组件（如操作记录组件 OperationRecord），避免重复代码：</li>
</ol>
<p>tsx</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/OperationRecordSection/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ActionType</span>, <span class="hljs-title class_">ProColumns</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> { operationListPage } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OperationRecordSectionProps</span> {
  <span class="hljs-attr">formValues</span>: {
    orderNo?: <span class="hljs-built_in">string</span>;
    [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
  };
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">OperationRecordSection</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">OperationRecordSectionProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ formValues }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> actionRef = useRef&lt;<span class="hljs-title class_">ActionType</span>&gt;();

  <span class="hljs-comment">// 监听工单编号变化，自动刷新操作记录</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (formValues?.<span class="hljs-property">orderNo</span>) {
      actionRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">reload</span>();
    }
  }, [formValues?.<span class="hljs-property">orderNo</span>]);

  <span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">ProColumns</span>[] = [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作节点'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNode'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作人'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'operationName'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作时间'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'createdDate'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作详情'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'operatorDetail'</span> },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
      <span class="hljs-attr">search</span>=<span class="hljs-string">{false}</span>
      <span class="hljs-attr">actionRef</span>=<span class="hljs-string">{actionRef}</span>
      <span class="hljs-attr">request</span>=<span class="hljs-string">{async</span> (<span class="hljs-attr">params</span>) =&gt;</span> {
        if (!formValues?.orderNo) return { data: [], total: 0 };
        return operationListPage({ ...params, orderNo: formValues.orderNo });
      }}
      columns={columns}
      pagination={{ defaultPageSize: 5 }}
    /&gt;</span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OperationRecordSection</span>;
</code></pre>
<h3 data-id="heading-6">三、核心功能实现</h3>
<h4 data-id="heading-7">1. 订单调配模块（核心场景）</h4>
<p>订单调配是车辆租赁后台的核心，需实现「方案制定、任务派发、详情查看」等功能，且需结合状态控制权限与交互。</p>
<h5 data-id="heading-8">（1）带状态控制的表格渲染</h5>
<p>使用 ProTable 实现订单列表，根据订单状态（toFormulate/toDistribute）动态展示操作按钮，且仅允许勾选「方案制定」状态的行：</p>
<p>tsx</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/OrderAlloc/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PageHeaderWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-layout'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, message } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> { getAllocationList } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Func</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/Func'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">OrderAlloc</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [selectedRowKeys, setSelectedRowKeys] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [selectedRows, setSelectedRows] = useState&lt;<span class="hljs-title class_">AllocOrder</span>[]&gt;([]);

  <span class="hljs-comment">// 表格列配置</span>
  <span class="hljs-keyword">const</span> columns = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'工单编号'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNo'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'orderNo'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'订单状态'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderStatus'</span>,
      <span class="hljs-attr">valueEnum</span>: <span class="hljs-title class_">Func</span>.<span class="hljs-title function_">dictEnum</span>(dictMap, <span class="hljs-string">'AllocOrderStatus'</span>), <span class="hljs-comment">// 字典映射</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'车牌'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'carNo'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'操作'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'option'</span>,
      <span class="hljs-attr">valueType</span>: <span class="hljs-string">'option'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, record</span>) =&gt;</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
          {/* 仅「方案制定」状态显示「方案制定」按钮 */}
          {record.orderStatus === 'toFormulate' &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenFormulateModal(record)}&gt;方案制定<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          )}
          {/* 仅「待派发」状态显示「派发任务」按钮 */}
          {record.orderStatus === 'toDistribute' &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenDispatchModal(record)}&gt;派发任务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          )}
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenDetail(record)}&gt;详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
      ),
    },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PageHeaderWrapper</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
        <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"orderNo"</span>
        <span class="hljs-attr">rowSelection</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">selectedRowKeys</span>,
          <span class="hljs-attr">onChange:</span> (<span class="hljs-attr">keys</span>, <span class="hljs-attr">rows</span>) =&gt;</span> {
            // 仅保留「方案制定」状态的选中行
            const validRows = rows.filter(row =&gt; row.orderStatus === 'toFormulate');
            setSelectedRowKeys(validRows.map(row =&gt; row.orderNo));
            setSelectedRows(validRows);
            if (rows.length &gt; validRows.length) {
              message.warning('仅"方案制定"状态的订单可勾选');
            }
          },
          // 禁用非「方案制定」状态的行勾选
          getCheckboxProps: (record) =&gt; ({
            disabled: record.orderStatus !== 'toFormulate',
          }),
        }}
        request={(params) =&gt; getAllocationList({ ...params, orderSource: 'ALLOCATE' })}
        columns={columns}
        toolBarRender={() =&gt; [
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{selectedRows.length</span> === <span class="hljs-string">0}</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleBatchFormulate()}
          &gt;
            批量方案制定
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>,
        ]}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">PageHeaderWrapper</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OrderAlloc</span>;
</code></pre>
<h5 data-id="heading-9">（2）详情弹窗实现</h5>
<p>通过 Modal 封装详情弹窗，整合 ProTable、Descriptions 组件展示订单多维度信息，并复用操作记录组件：</p>
<p>tsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/OrderAlloc/components/DeploymentDetail.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Modal</span>, <span class="hljs-title class_">Descriptions</span>, <span class="hljs-title class_">Collapse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OperationRecordSection</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/OperationRecordSection'</span>;
<span class="hljs-keyword">import</span> { allocatePlanDetail } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Func</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/Func'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DeploymentDetail</span> = (<span class="hljs-params">{ visible, onCancel, formValues }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [orderDetail, setOrderDetail] = useState&lt;<span class="hljs-title class_">AllocOrder</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [taskList, setTaskList] = useState&lt;<span class="hljs-title class_">AllocOrder</span>[]&gt;([]);

  <span class="hljs-comment">// 获取订单详情</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (visible &amp;&amp; formValues?.<span class="hljs-property">batchNo</span>) {
      <span class="hljs-title function_">allocatePlanDetail</span>({ <span class="hljs-attr">batchNo</span>: formValues.<span class="hljs-property">batchNo</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-title function_">setOrderDetail</span>(res.<span class="hljs-property">data</span>);
        <span class="hljs-title function_">setTaskList</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">taskList</span> || []);
      });
    }
  }, [visible, formValues]);

  <span class="hljs-comment">// 工单信息表格列</span>
  <span class="hljs-keyword">const</span> workColumns = [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'工单编号'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNo'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'车型'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'modelName'</span>, <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, r</span>) =&gt;</span> r.<span class="hljs-property">carInfo</span>?.<span class="hljs-property">modelName</span> || <span class="hljs-string">'-'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'交付类型'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'deliveryType'</span>, <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, r</span>) =&gt;</span> <span class="hljs-title class_">Func</span>.<span class="hljs-title function_">dictLabel</span>(dictMap, <span class="hljs-string">'DeliveryType'</span>, r.<span class="hljs-property">allocateInfo</span>?.<span class="hljs-property">deliveryType</span>) || <span class="hljs-string">'-'</span> },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
      <span class="hljs-attr">open</span>=<span class="hljs-string">{visible}</span>
      <span class="hljs-attr">onCancel</span>=<span class="hljs-string">{onCancel}</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"80%"</span>
      <span class="hljs-attr">footer</span>=<span class="hljs-string">{null}</span>
      <span class="hljs-attr">destroyOnClose</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Collapse</span> <span class="hljs-attr">defaultActiveKey</span>=<span class="hljs-string">{[</span>'<span class="hljs-attr">1</span>', '<span class="hljs-attr">2</span>', '<span class="hljs-attr">3</span>']}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"工单信息"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"1"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span> <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{taskList}</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{workColumns}</span> <span class="hljs-attr">pagination</span>=<span class="hljs-string">{false}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"调配信息"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions</span> <span class="hljs-attr">column</span>=<span class="hljs-string">{3}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"交付类型"</span>&gt;</span>
              {Func.dictLabel(dictMap, 'DeliveryType', orderDetail?.allocateInfo?.deliveryType) || '-'}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions.Item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"备注"</span>&gt;</span>{orderDetail?.remark || '-'}<span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions.Item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"操作记录"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"3"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">OperationRecordSection</span> <span class="hljs-attr">formValues</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">...formValues</span>, <span class="hljs-attr">orderNo:</span> <span class="hljs-attr">orderDetail</span>?<span class="hljs-attr">.orderNo</span> }} /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DeploymentDetail</span>;
</code></pre>
<h4 data-id="heading-10">2. 字典映射封装</h4>
<p>车辆租赁系统包含大量枚举值（如交付类型、订单状态），封装通用字典工具函数，统一处理类型映射：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/Func.ts</span>
<span class="hljs-comment">/**
 * 字典转下拉/表格枚举格式
 * <span class="hljs-doctag">@param</span> dictMap 全局字典对象
 * <span class="hljs-doctag">@param</span> dictKey 字典key
 * <span class="hljs-doctag">@returns</span> 枚举对象
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">dictEnum</span> = (<span class="hljs-params">dictMap: <span class="hljs-built_in">any</span>, dictKey: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!dictMap?.[dictKey]) <span class="hljs-keyword">return</span> {};
  <span class="hljs-keyword">return</span> dictMap[dictKey].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc: <span class="hljs-built_in">any</span>, item: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    acc[item.<span class="hljs-property">value</span>] = item.<span class="hljs-property">label</span>;
    <span class="hljs-keyword">return</span> acc;
  }, {});
};

<span class="hljs-comment">/**
 * 根据值获取字典标签
 * <span class="hljs-doctag">@param</span> dictMap 全局字典对象
 * <span class="hljs-doctag">@param</span> dictKey 字典key
 * <span class="hljs-doctag">@param</span> value 字典值
 * <span class="hljs-doctag">@returns</span> 字典标签
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">dictLabel</span> = (<span class="hljs-params">dictMap: <span class="hljs-built_in">any</span>, dictKey: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!dictMap?.[dictKey] || !value) <span class="hljs-keyword">return</span> <span class="hljs-string">'-'</span>;
  <span class="hljs-keyword">const</span> item = dictMap[dictKey].<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> item.<span class="hljs-property">value</span> === value);
  <span class="hljs-keyword">return</span> item?.<span class="hljs-property">label</span> || <span class="hljs-string">'-'</span>;
};
</code></pre>
<h3 data-id="heading-11">四、项目优化要点</h3>
<h4 data-id="heading-12">1. 性能优化</h4>
<ul>
<li><strong>数据缓存</strong>：使用 ahooks 的 useRequest 配置 cacheKey，缓存高频查询的订单列表，避免重复请求；</li>
<li><strong>组件懒加载</strong>：通过 Umi 的 dynamicImport 实现页面级懒加载，减少首屏加载体积；</li>
<li><strong>表格虚拟滚动</strong>：ProTable 开启 scroll={{y: 600}} + virtual={true}，优化大数据量表格渲染。</li>
</ul>
<h4 data-id="heading-13">2. 体验优化</h4>
<ul>
<li><strong>状态联动</strong>：勾选行时实时过滤无效行并给出提示，避免用户误操作；</li>
<li><strong>兜底显示</strong>：所有字典映射、嵌套数据访问均添加兜底（|| '-'），避免页面空白；</li>
<li><strong>加载状态</strong>：异步请求时添加骨架屏 / 加载动画，提升交互体验。</li>
</ul>
<h4 data-id="heading-14">3. 可维护性优化</h4>
<ul>
<li><strong>统一请求封装</strong>：拦截请求 / 响应，统一处理 token、错误提示；</li>
<li><strong>注释规范</strong>：关键业务逻辑、工具函数添加 TSDoc 注释；</li>
<li><strong>分支管理</strong>：按「功能分支 - 测试分支 - 主分支」流程开发，避免代码冲突。</li>
</ul>
<h3 data-id="heading-15">五、总结</h3>
<p>React + TypeScript 构建车辆租赁后台管理系统，核心在于「类型约束降低风险、组件复用提升效率、业务逻辑分层解耦」。本文从架构设计到核心功能实现，覆盖了中后台开发的高频场景：表格状态控制、字典映射、通用组件封装、权限控制等。</p>
<p>实际开发中，需结合业务场景灵活调整 —— 例如车辆租赁的「车辆定位、合同管理」等扩展模块，可复用本文的架构思路，通过 TypeScript 定义类型、Pro 组件快速实现 UI，最终打造高性能、易维护的企业级后台系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>